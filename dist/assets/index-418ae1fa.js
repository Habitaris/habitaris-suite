import{r as F,a as Tc,R as ka}from"./vendor-b1791c80.js";import{createClient as Bc}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";import{L as zn,I as dl,P as Wo,C as ft,T as qe,a as Pe,X as $t,S as vi,F as At,b as Hi,c as Cd,B as Ic,d as Gi,e as da,A as kd,D as wo,f as Co,g as Uo,H as kn,h as Zs,U as wd,i as bn,R as ca,M as En,j as xr,k as Rc,l as wa,m as el,E as yn,n as Mc,o as _c,p as tl,q as An,r as si,s as za,t as Fi,u as mr,v as Ea,w as io,x as Vo,y as Fn,z as Dc,G as zo,J as zd,K as Es,N as Tn,O as $c,Z as cl,Q as Ed,V as Pc,W as Ad,Y as Oc,_ as Lc,$ as Aa,a0 as Fd,a1 as Wc,a2 as Nc,a3 as Td,a4 as nr,a5 as Bd,a6 as Id,a7 as Rd,a8 as Md,a9 as _d,aa as Uc,ab as Vc,ac as qc,ad as Dd,ae as Hc,af as Gc,ag as Kc,ah as Jc,ai as Yc,aj as Xc,ak as Qc,al as Zc,am as ep,an as tp}from"./icons-76b39fe4.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=o(a);fetch(a.href,r)}})();var $d={exports:{}},Fa={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ip=F,op=Symbol.for("react.element"),np=Symbol.for("react.fragment"),rp=Object.prototype.hasOwnProperty,ap=ip.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,sp={key:!0,ref:!0,__self:!0,__source:!0};function Pd(t,i,o){var n,a={},r=null,s=null;o!==void 0&&(r=""+o),i.key!==void 0&&(r=""+i.key),i.ref!==void 0&&(s=i.ref);for(n in i)rp.call(i,n)&&!sp.hasOwnProperty(n)&&(a[n]=i[n]);if(t&&t.defaultProps)for(n in i=t.defaultProps,i)a[n]===void 0&&(a[n]=i[n]);return{$$typeof:op,type:t,key:r,ref:s,props:a,_owner:ap.current}}Fa.Fragment=np;Fa.jsx=Pd;Fa.jsxs=Pd;$d.exports=Fa;var e=$d.exports;function Ta(t,i){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(o[n[a]]=t[n[a]]);return o}function lp(t,i,o,n){function a(r){return r instanceof o?r:new o(function(s){s(r)})}return new(o||(o=Promise))(function(r,s){function d(j){try{b(n.next(j))}catch(w){s(w)}}function u(j){try{b(n.throw(j))}catch(w){s(w)}}function b(j){j.done?r(j.value):a(j.value).then(d,u)}b((n=n.apply(t,i||[])).next())})}const dp=t=>t?(...i)=>t(...i):(...i)=>fetch(...i);class il extends Error{constructor(i,o="FunctionsError",n){super(i),this.name=o,this.context=n}}class cp extends il{constructor(i){super("Failed to send a request to the Edge Function","FunctionsFetchError",i)}}class pl extends il{constructor(i){super("Relay Error invoking the Edge Function","FunctionsRelayError",i)}}class gl extends il{constructor(i){super("Edge Function returned a non-2xx status code","FunctionsHttpError",i)}}var As;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(As||(As={}));class pp{constructor(i,{headers:o={},customFetch:n,region:a=As.Any}={}){this.url=i,this.headers=o,this.region=a,this.fetch=dp(n)}setAuth(i){this.headers.Authorization=`Bearer ${i}`}invoke(i){return lp(this,arguments,void 0,function*(o,n={}){var a;let r,s;try{const{headers:d,method:u,body:b,signal:j,timeout:w}=n;let S={},{region:m}=n;m||(m=this.region);const x=new URL(`${this.url}/${o}`);m&&m!=="any"&&(S["x-region"]=m,x.searchParams.set("forceFunctionRegion",m));let p;b&&(d&&!Object.prototype.hasOwnProperty.call(d,"Content-Type")||!d)?typeof Blob<"u"&&b instanceof Blob||b instanceof ArrayBuffer?(S["Content-Type"]="application/octet-stream",p=b):typeof b=="string"?(S["Content-Type"]="text/plain",p=b):typeof FormData<"u"&&b instanceof FormData?p=b:(S["Content-Type"]="application/json",p=JSON.stringify(b)):b&&typeof b!="string"&&!(typeof Blob<"u"&&b instanceof Blob)&&!(b instanceof ArrayBuffer)&&!(typeof FormData<"u"&&b instanceof FormData)?p=JSON.stringify(b):p=b;let c=j;w&&(s=new AbortController,r=setTimeout(()=>s.abort(),w),j?(c=s.signal,j.addEventListener("abort",()=>s.abort())):c=s.signal);const g=yield this.fetch(x.toString(),{method:u||"POST",headers:Object.assign(Object.assign(Object.assign({},S),this.headers),d),body:p,signal:c}).catch(h=>{throw new cp(h)}),l=g.headers.get("x-relay-error");if(l&&l==="true")throw new pl(g);if(!g.ok)throw new gl(g);let f=((a=g.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),y;return f==="application/json"?y=yield g.json():f==="application/octet-stream"||f==="application/pdf"?y=yield g.blob():f==="text/event-stream"?y=g:f==="multipart/form-data"?y=yield g.formData():y=yield g.text(),{data:y,error:null,response:g}}catch(d){return{data:null,error:d,response:d instanceof gl||d instanceof pl?d.context:void 0}}finally{r&&clearTimeout(r)}})}}var gp=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},up=class{constructor(t){var i,o,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(i=t.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=t.signal,this.isMaybeSingle=(o=t.isMaybeSingle)!==null&&o!==void 0?o:!1,this.urlLengthLimit=(n=t.urlLengthLimit)!==null&&n!==void 0?n:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,i){return this.headers=new Headers(this.headers),this.headers.set(t,i),this}then(t,i){var o=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let a=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let s=null,d=null,u=null,b=r.status,j=r.statusText;if(r.ok){var w,S;if(o.method!=="HEAD"){var m;const g=await r.text();g===""||(o.headers.get("Accept")==="text/csv"||o.headers.get("Accept")&&(!((m=o.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?d=g:d=JSON.parse(g))}const p=(w=o.headers.get("Prefer"))===null||w===void 0?void 0:w.match(/count=(exact|planned|estimated)/),c=(S=r.headers.get("content-range"))===null||S===void 0?void 0:S.split("/");p&&c&&c.length>1&&(u=parseInt(c[1])),o.isMaybeSingle&&o.method==="GET"&&Array.isArray(d)&&(d.length>1?(s={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,u=null,b=406,j="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{var x;const p=await r.text();try{s=JSON.parse(p),Array.isArray(s)&&r.status===404&&(d=[],s=null,b=200,j="OK")}catch{r.status===404&&p===""?(b=204,j="No Content"):s={message:p}}if(s&&o.isMaybeSingle&&(!(s==null||(x=s.details)===null||x===void 0)&&x.includes("0 rows"))&&(s=null,b=200,j="OK"),s&&o.shouldThrowOnError)throw new gp(s)}return{error:s,data:d,count:u,status:b,statusText:j}});return this.shouldThrowOnError||(a=a.catch(r=>{var s;let d="",u="",b="";const j=r==null?void 0:r.cause;if(j){var w,S,m,x;const g=(w=j==null?void 0:j.message)!==null&&w!==void 0?w:"",l=(S=j==null?void 0:j.code)!==null&&S!==void 0?S:"";d=`${(m=r==null?void 0:r.name)!==null&&m!==void 0?m:"FetchError"}: ${r==null?void 0:r.message}`,d+=`

Caused by: ${(x=j==null?void 0:j.name)!==null&&x!==void 0?x:"Error"}: ${g}`,l&&(d+=` (${l})`),j!=null&&j.stack&&(d+=`
${j.stack}`)}else{var p;d=(p=r==null?void 0:r.stack)!==null&&p!==void 0?p:""}const c=this.url.toString().length;return(r==null?void 0:r.name)==="AbortError"||(r==null?void 0:r.code)==="ABORT_ERR"?(b="",u="Request was aborted (timeout or manual cancellation)",c>this.urlLengthLimit&&(u+=`. Note: Your request URL is ${c} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((j==null?void 0:j.name)==="HeadersOverflowError"||(j==null?void 0:j.code)==="UND_ERR_HEADERS_OVERFLOW")&&(b="",u="HTTP headers exceeded server limits (typically 16KB)",c>this.urlLengthLimit&&(u+=`. Your request URL is ${c} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(s=r==null?void 0:r.name)!==null&&s!==void 0?s:"FetchError"}: ${r==null?void 0:r.message}`,details:d,hint:u,code:b},data:null,count:null,status:0,statusText:""}})),a.then(t,i)}returns(){return this}overrideTypes(){return this}},hp=class extends up{select(t){let i=!1;const o=(t??"*").split("").map(n=>/\s/.test(n)&&!i?"":(n==='"'&&(i=!i),n)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:i=!0,nullsFirst:o,foreignTable:n,referencedTable:a=n}={}){const r=a?`${a}.order`:"order",s=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${s?`${s},`:""}${t}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:i,referencedTable:o=i}={}){const n=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(n,`${t}`),this}range(t,i,{foreignTable:o,referencedTable:n=o}={}){const a=typeof n>"u"?"offset":`${n}.offset`,r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(a,`${t}`),this.url.searchParams.set(r,`${i-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:i=!1,settings:o=!1,buffers:n=!1,wal:a=!1,format:r="text"}={}){var s;const d=[t?"analyze":null,i?"verbose":null,o?"settings":null,n?"buffers":null,a?"wal":null].filter(Boolean).join("|"),u=(s=this.headers.get("Accept"))!==null&&s!==void 0?s:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${u}"; options=${d};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const ul=new RegExp("[,()]");var dn=class extends hp{eq(t,i){return this.url.searchParams.append(t,`eq.${i}`),this}neq(t,i){return this.url.searchParams.append(t,`neq.${i}`),this}gt(t,i){return this.url.searchParams.append(t,`gt.${i}`),this}gte(t,i){return this.url.searchParams.append(t,`gte.${i}`),this}lt(t,i){return this.url.searchParams.append(t,`lt.${i}`),this}lte(t,i){return this.url.searchParams.append(t,`lte.${i}`),this}like(t,i){return this.url.searchParams.append(t,`like.${i}`),this}likeAllOf(t,i){return this.url.searchParams.append(t,`like(all).{${i.join(",")}}`),this}likeAnyOf(t,i){return this.url.searchParams.append(t,`like(any).{${i.join(",")}}`),this}ilike(t,i){return this.url.searchParams.append(t,`ilike.${i}`),this}ilikeAllOf(t,i){return this.url.searchParams.append(t,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(t,i){return this.url.searchParams.append(t,`ilike(any).{${i.join(",")}}`),this}regexMatch(t,i){return this.url.searchParams.append(t,`match.${i}`),this}regexIMatch(t,i){return this.url.searchParams.append(t,`imatch.${i}`),this}is(t,i){return this.url.searchParams.append(t,`is.${i}`),this}isDistinct(t,i){return this.url.searchParams.append(t,`isdistinct.${i}`),this}in(t,i){const o=Array.from(new Set(i)).map(n=>typeof n=="string"&&ul.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`in.(${o})`),this}notIn(t,i){const o=Array.from(new Set(i)).map(n=>typeof n=="string"&&ul.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`not.in.(${o})`),this}contains(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cs.{${i.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(i)}`),this}containedBy(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cd.{${i.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(i)}`),this}rangeGt(t,i){return this.url.searchParams.append(t,`sr.${i}`),this}rangeGte(t,i){return this.url.searchParams.append(t,`nxl.${i}`),this}rangeLt(t,i){return this.url.searchParams.append(t,`sl.${i}`),this}rangeLte(t,i){return this.url.searchParams.append(t,`nxr.${i}`),this}rangeAdjacent(t,i){return this.url.searchParams.append(t,`adj.${i}`),this}overlaps(t,i){return typeof i=="string"?this.url.searchParams.append(t,`ov.${i}`):this.url.searchParams.append(t,`ov.{${i.join(",")}}`),this}textSearch(t,i,{config:o,type:n}={}){let a="";n==="plain"?a="pl":n==="phrase"?a="ph":n==="websearch"&&(a="w");const r=o===void 0?"":`(${o})`;return this.url.searchParams.append(t,`${a}fts${r}.${i}`),this}match(t){return Object.entries(t).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(t,i,o){return this.url.searchParams.append(t,`not.${i}.${o}`),this}or(t,{foreignTable:i,referencedTable:o=i}={}){const n=o?`${o}.or`:"or";return this.url.searchParams.append(n,`(${t})`),this}filter(t,i,o){return this.url.searchParams.append(t,`${i}.${o}`),this}},fp=class{constructor(t,{headers:i={},schema:o,fetch:n,urlLengthLimit:a=8e3}){this.url=t,this.headers=new Headers(i),this.schema=o,this.fetch=n,this.urlLengthLimit=a}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,i){const{head:o=!1,count:n}=i??{},a=o?"HEAD":"GET";let r=!1;const s=(t??"*").split("").map(b=>/\s/.test(b)&&!r?"":(b==='"'&&(r=!r),b)).join(""),{url:d,headers:u}=this.cloneRequestState();return d.searchParams.set("select",s),n&&u.append("Prefer",`count=${n}`),new dn({method:a,url:d,headers:u,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:i,defaultToNull:o=!0}={}){var n;const a="POST",{url:r,headers:s}=this.cloneRequestState();if(i&&s.append("Prefer",`count=${i}`),o||s.append("Prefer","missing=default"),Array.isArray(t)){const d=t.reduce((u,b)=>u.concat(Object.keys(b)),[]);if(d.length>0){const u=[...new Set(d)].map(b=>`"${b}"`);r.searchParams.set("columns",u.join(","))}}return new dn({method:a,url:r,headers:s,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:i,ignoreDuplicates:o=!1,count:n,defaultToNull:a=!0}={}){var r;const s="POST",{url:d,headers:u}=this.cloneRequestState();if(u.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&d.searchParams.set("on_conflict",i),n&&u.append("Prefer",`count=${n}`),a||u.append("Prefer","missing=default"),Array.isArray(t)){const b=t.reduce((j,w)=>j.concat(Object.keys(w)),[]);if(b.length>0){const j=[...new Set(b)].map(w=>`"${w}"`);d.searchParams.set("columns",j.join(","))}}return new dn({method:s,url:d,headers:u,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:i}={}){var o;const n="PATCH",{url:a,headers:r}=this.cloneRequestState();return i&&r.append("Prefer",`count=${i}`),new dn({method:n,url:a,headers:r,schema:this.schema,body:t,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var i;const o="DELETE",{url:n,headers:a}=this.cloneRequestState();return t&&a.append("Prefer",`count=${t}`),new dn({method:o,url:n,headers:a,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}};function rr(t){"@babel/helpers - typeof";return rr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},rr(t)}function xp(t,i){if(rr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(rr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function mp(t){var i=xp(t,"string");return rr(i)=="symbol"?i:i+""}function bp(t,i,o){return(i=mp(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function hl(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),o.push.apply(o,n)}return o}function wr(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?hl(Object(o),!0).forEach(function(n){bp(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):hl(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}var yp=class Od{constructor(i,{headers:o={},schema:n,fetch:a,timeout:r,urlLengthLimit:s=8e3}={}){this.url=i,this.headers=new Headers(o),this.schemaName=n,this.urlLengthLimit=s;const d=a??globalThis.fetch;r!==void 0&&r>0?this.fetch=(u,b)=>{const j=new AbortController,w=setTimeout(()=>j.abort(),r),S=b==null?void 0:b.signal;if(S){if(S.aborted)return clearTimeout(w),d(u,b);const m=()=>{clearTimeout(w),j.abort()};return S.addEventListener("abort",m,{once:!0}),d(u,wr(wr({},b),{},{signal:j.signal})).finally(()=>{clearTimeout(w),S.removeEventListener("abort",m)})}return d(u,wr(wr({},b),{},{signal:j.signal})).finally(()=>clearTimeout(w))}:this.fetch=d}from(i){if(!i||typeof i!="string"||i.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new fp(new URL(`${this.url}/${i}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(i){return new Od(this.url,{headers:this.headers,schema:i,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(i,o={},{head:n=!1,get:a=!1,count:r}={}){var s;let d;const u=new URL(`${this.url}/rpc/${i}`);let b;const j=m=>m!==null&&typeof m=="object"&&(!Array.isArray(m)||m.some(j)),w=n&&Object.values(o).some(j);w?(d="POST",b=o):n||a?(d=n?"HEAD":"GET",Object.entries(o).filter(([m,x])=>x!==void 0).map(([m,x])=>[m,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([m,x])=>{u.searchParams.append(m,x)})):(d="POST",b=o);const S=new Headers(this.headers);return w?S.set("Prefer",r?`count=${r},return=minimal`:"return=minimal"):r&&S.set("Prefer",`count=${r}`),new dn({method:d,url:u,headers:S,schema:this.schemaName,body:b,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}};class vp{constructor(){}static detectEnvironment(){var i;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((i=navigator.userAgent)===null||i===void 0)&&i.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const o=globalThis.process;if(o){const n=o.versions;if(n&&n.node){const a=n.node,r=parseInt(a.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const i=this.detectEnvironment();if(i.constructor)return i.constructor;let o=i.error||"WebSocket not supported in this environment.";throw i.workaround&&(o+=`

Suggested solution: ${i.workaround}`),new Error(o)}static createWebSocket(i,o){const n=this.getWebSocketConstructor();return new n(i,o)}static isWebSocketSupported(){try{const i=this.detectEnvironment();return i.type==="native"||i.type==="ws"}catch{return!1}}}const jp="2.97.0",Sp=`realtime-js/${jp}`,Cp="1.0.0",Ld="2.0.0",fl=Ld,Fs=1e4,kp=1e3,wp=100;var xo;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(xo||(xo={}));var Nt;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Nt||(Nt={}));var wi;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(wi||(wi={}));var Ts;(function(t){t.websocket="websocket"})(Ts||(Ts={}));var Do;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Do||(Do={}));class zp{constructor(i){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=i??[]}encode(i,o){if(i.event===this.BROADCAST_EVENT&&!(i.payload instanceof ArrayBuffer)&&typeof i.payload.event=="string")return o(this._binaryEncodeUserBroadcastPush(i));let n=[i.join_ref,i.ref,i.topic,i.event,i.payload];return o(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(i){var o;return this._isArrayBuffer((o=i.payload)===null||o===void 0?void 0:o.payload)?this._encodeBinaryUserBroadcastPush(i):this._encodeJsonUserBroadcastPush(i)}_encodeBinaryUserBroadcastPush(i){var o,n;const a=(n=(o=i.payload)===null||o===void 0?void 0:o.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(i,this.BINARY_ENCODING,a)}_encodeJsonUserBroadcastPush(i){var o,n;const a=(n=(o=i.payload)===null||o===void 0?void 0:o.payload)!==null&&n!==void 0?n:{},s=new TextEncoder().encode(JSON.stringify(a)).buffer;return this._encodeUserBroadcastPush(i,this.JSON_ENCODING,s)}_encodeUserBroadcastPush(i,o,n){var a,r;const s=i.topic,d=(a=i.ref)!==null&&a!==void 0?a:"",u=(r=i.join_ref)!==null&&r!==void 0?r:"",b=i.payload.event,j=this.allowedMetadataKeys?this._pick(i.payload,this.allowedMetadataKeys):{},w=Object.keys(j).length===0?"":JSON.stringify(j);if(u.length>255)throw new Error(`joinRef length ${u.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`ref length ${d.length} exceeds maximum of 255`);if(s.length>255)throw new Error(`topic length ${s.length} exceeds maximum of 255`);if(b.length>255)throw new Error(`userEvent length ${b.length} exceeds maximum of 255`);if(w.length>255)throw new Error(`metadata length ${w.length} exceeds maximum of 255`);const S=this.USER_BROADCAST_PUSH_META_LENGTH+u.length+d.length+s.length+b.length+w.length,m=new ArrayBuffer(this.HEADER_LENGTH+S);let x=new DataView(m),p=0;x.setUint8(p++,this.KINDS.userBroadcastPush),x.setUint8(p++,u.length),x.setUint8(p++,d.length),x.setUint8(p++,s.length),x.setUint8(p++,b.length),x.setUint8(p++,w.length),x.setUint8(p++,o),Array.from(u,g=>x.setUint8(p++,g.charCodeAt(0))),Array.from(d,g=>x.setUint8(p++,g.charCodeAt(0))),Array.from(s,g=>x.setUint8(p++,g.charCodeAt(0))),Array.from(b,g=>x.setUint8(p++,g.charCodeAt(0))),Array.from(w,g=>x.setUint8(p++,g.charCodeAt(0)));var c=new Uint8Array(m.byteLength+n.byteLength);return c.set(new Uint8Array(m),0),c.set(new Uint8Array(n),m.byteLength),c.buffer}decode(i,o){if(this._isArrayBuffer(i)){let n=this._binaryDecode(i);return o(n)}if(typeof i=="string"){const n=JSON.parse(i),[a,r,s,d,u]=n;return o({join_ref:a,ref:r,topic:s,event:d,payload:u})}return o({})}_binaryDecode(i){const o=new DataView(i),n=o.getUint8(0),a=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(i,o,a)}}_decodeUserBroadcast(i,o,n){const a=o.getUint8(1),r=o.getUint8(2),s=o.getUint8(3),d=o.getUint8(4);let u=this.HEADER_LENGTH+4;const b=n.decode(i.slice(u,u+a));u=u+a;const j=n.decode(i.slice(u,u+r));u=u+r;const w=n.decode(i.slice(u,u+s));u=u+s;const S=i.slice(u,i.byteLength),m=d===this.JSON_ENCODING?JSON.parse(n.decode(S)):S,x={type:this.BROADCAST_EVENT,event:j,payload:m};return s>0&&(x.meta=JSON.parse(w)),{join_ref:null,ref:null,topic:b,event:this.BROADCAST_EVENT,payload:x}}_isArrayBuffer(i){var o;return i instanceof ArrayBuffer||((o=i==null?void 0:i.constructor)===null||o===void 0?void 0:o.name)==="ArrayBuffer"}_pick(i,o){return!i||typeof i!="object"?{}:Object.fromEntries(Object.entries(i).filter(([n])=>o.includes(n)))}}class Wd{constructor(i,o){this.callback=i,this.timerCalc=o,this.timer=void 0,this.tries=0,this.callback=i,this.timerCalc=o}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Tt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Tt||(Tt={}));const xl=(t,i,o={})=>{var n;const a=(n=o.skipTypes)!==null&&n!==void 0?n:[];return i?Object.keys(i).reduce((r,s)=>(r[s]=Ep(s,t,i,a),r),{}):{}},Ep=(t,i,o,n)=>{const a=i.find(d=>d.name===t),r=a==null?void 0:a.type,s=o[t];return r&&!n.includes(r)?Nd(r,s):Bs(s)},Nd=(t,i)=>{if(t.charAt(0)==="_"){const o=t.slice(1,t.length);return Bp(i,o)}switch(t){case Tt.bool:return Ap(i);case Tt.float4:case Tt.float8:case Tt.int2:case Tt.int4:case Tt.int8:case Tt.numeric:case Tt.oid:return Fp(i);case Tt.json:case Tt.jsonb:return Tp(i);case Tt.timestamp:return Ip(i);case Tt.abstime:case Tt.date:case Tt.daterange:case Tt.int4range:case Tt.int8range:case Tt.money:case Tt.reltime:case Tt.text:case Tt.time:case Tt.timestamptz:case Tt.timetz:case Tt.tsrange:case Tt.tstzrange:return Bs(i);default:return Bs(i)}},Bs=t=>t,Ap=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Fp=t=>{if(typeof t=="string"){const i=parseFloat(t);if(!Number.isNaN(i))return i}return t},Tp=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},Bp=(t,i)=>{if(typeof t!="string")return t;const o=t.length-1,n=t[o];if(t[0]==="{"&&n==="}"){let r;const s=t.slice(1,o);try{r=JSON.parse("["+s+"]")}catch{r=s?s.split(","):[]}return r.map(d=>Nd(i,d))}return t},Ip=t=>typeof t=="string"?t.replace(" ","T"):t,Ud=t=>{const i=new URL(t);return i.protocol=i.protocol.replace(/^ws/i,"http"),i.pathname=i.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),i.pathname===""||i.pathname==="/"?i.pathname="/api/broadcast":i.pathname=i.pathname+"/api/broadcast",i.href};class $a{constructor(i,o,n={},a=Fs){this.channel=i,this.event=o,this.payload=n,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(i){this.timeout=i,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(i){this.payload=Object.assign(Object.assign({},this.payload),i)}receive(i,o){var n;return this._hasReceived(i)&&o((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:i,callback:o}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const i=o=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=o,this._matchReceive(o)};this.channel._on(this.refEvent,{},i),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(i,o){this.refEvent&&this.channel._trigger(this.refEvent,{status:i,response:o})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:i,response:o}){this.recHooks.filter(n=>n.status===i).forEach(n=>n.callback(o))}_hasReceived(i){return this.receivedResp&&this.receivedResp.status===i}}var ml;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(ml||(ml={}));class Yn{constructor(i,o){this.channel=i,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(o==null?void 0:o.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},a=>{const{onJoin:r,onLeave:s,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Yn.syncState(this.state,a,r,s),this.pendingDiffs.forEach(u=>{this.state=Yn.syncDiff(this.state,u,r,s)}),this.pendingDiffs=[],d()}),this.channel._on(n.diff,{},a=>{const{onJoin:r,onLeave:s,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Yn.syncDiff(this.state,a,r,s),d())}),this.onJoin((a,r,s)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:r,newPresences:s})}),this.onLeave((a,r,s)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:r,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(i,o,n,a){const r=this.cloneDeep(i),s=this.transformState(o),d={},u={};return this.map(r,(b,j)=>{s[b]||(u[b]=j)}),this.map(s,(b,j)=>{const w=r[b];if(w){const S=j.map(c=>c.presence_ref),m=w.map(c=>c.presence_ref),x=j.filter(c=>m.indexOf(c.presence_ref)<0),p=w.filter(c=>S.indexOf(c.presence_ref)<0);x.length>0&&(d[b]=x),p.length>0&&(u[b]=p)}else d[b]=j}),this.syncDiff(r,{joins:d,leaves:u},n,a)}static syncDiff(i,o,n,a){const{joins:r,leaves:s}={joins:this.transformState(o.joins),leaves:this.transformState(o.leaves)};return n||(n=()=>{}),a||(a=()=>{}),this.map(r,(d,u)=>{var b;const j=(b=i[d])!==null&&b!==void 0?b:[];if(i[d]=this.cloneDeep(u),j.length>0){const w=i[d].map(m=>m.presence_ref),S=j.filter(m=>w.indexOf(m.presence_ref)<0);i[d].unshift(...S)}n(d,j,u)}),this.map(s,(d,u)=>{let b=i[d];if(!b)return;const j=u.map(w=>w.presence_ref);b=b.filter(w=>j.indexOf(w.presence_ref)<0),i[d]=b,a(d,b,u),b.length===0&&delete i[d]}),i}static map(i,o){return Object.getOwnPropertyNames(i).map(n=>o(n,i[n]))}static transformState(i){return i=this.cloneDeep(i),Object.getOwnPropertyNames(i).reduce((o,n)=>{const a=i[n];return"metas"in a?o[n]=a.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):o[n]=a,o},{})}static cloneDeep(i){return JSON.parse(JSON.stringify(i))}onJoin(i){this.caller.onJoin=i}onLeave(i){this.caller.onLeave=i}onSync(i){this.caller.onSync=i}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var bl;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(bl||(bl={}));var Xn;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Xn||(Xn={}));var Xi;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Xi||(Xi={}));class un{constructor(i,o={config:{}},n){var a,r;if(this.topic=i,this.params=o,this.socket=n,this.bindings={},this.state=Nt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=i.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},o.config),this.timeout=this.socket.timeout,this.joinPush=new $a(this,wi.join,this.params,this.timeout),this.rejoinTimer=new Wd(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Nt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Nt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(wi.reply,{},(s,d)=>{this._trigger(this._replyEventName(d),s)}),this.presence=new Yn(this),this.broadcastEndpointURL=Ud(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((r=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||r===void 0)&&r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(i,o=this.timeout){var n,a,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Nt.closed){const{config:{broadcast:s,presence:d,private:u}}=this.params,b=(a=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(m=>m.filter))!==null&&a!==void 0?a:[],j=!!this.bindings[Xn.PRESENCE]&&this.bindings[Xn.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,w={},S={broadcast:s,presence:Object.assign(Object.assign({},d),{enabled:j}),postgres_changes:b,private:u};this.socket.accessTokenValue&&(w.access_token=this.socket.accessTokenValue),this._onError(m=>i==null?void 0:i(Xi.CHANNEL_ERROR,m)),this._onClose(()=>i==null?void 0:i(Xi.CLOSED)),this.updateJoinPayload(Object.assign({config:S},w)),this.joinedOnce=!0,this._rejoin(o),this.joinPush.receive("ok",async({postgres_changes:m})=>{var x;if(this.socket._isManualToken()||this.socket.setAuth(),m===void 0){i==null||i(Xi.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,c=(x=p==null?void 0:p.length)!==null&&x!==void 0?x:0,g=[];for(let l=0;l<c;l++){const f=p[l],{filter:{event:y,schema:h,table:v,filter:A}}=f,z=m&&m[l];if(z&&z.event===y&&un.isFilterValueEqual(z.schema,h)&&un.isFilterValueEqual(z.table,v)&&un.isFilterValueEqual(z.filter,A))g.push(Object.assign(Object.assign({},f),{id:z.id}));else{this.unsubscribe(),this.state=Nt.errored,i==null||i(Xi.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,i&&i(Xi.SUBSCRIBED);return}}).receive("error",m=>{this.state=Nt.errored,i==null||i(Xi.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{i==null||i(Xi.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(i,o={}){return await this.send({type:"presence",event:"track",payload:i},o.timeout||this.timeout)}async untrack(i={}){return await this.send({type:"presence",event:"untrack"},i)}on(i,o,n){return this.state===Nt.joined&&i===Xn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(i,o,n)}async httpSend(i,o,n={}){var a;if(o==null)return Promise.reject("Payload is required for httpSend()");const r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const s={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})},d=await this._fetchWithTimeout(this.broadcastEndpointURL,s,(a=n.timeout)!==null&&a!==void 0?a:this.timeout);if(d.status===202)return{success:!0};let u=d.statusText;try{const b=await d.json();u=b.error||b.message||u}catch{}return Promise.reject(new Error(u))}async send(i,o={}){var n,a;if(!this._canPush()&&i.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:r,payload:s}=i,d={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(d.Authorization=`Bearer ${this.socket.accessTokenValue}`);const u={method:"POST",headers:d,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:s,private:this.private}]})};try{const b=await this._fetchWithTimeout(this.broadcastEndpointURL,u,(n=o.timeout)!==null&&n!==void 0?n:this.timeout);return await((a=b.body)===null||a===void 0?void 0:a.cancel()),b.ok?"ok":"error"}catch(b){return b.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var s,d,u;const b=this._push(i.type,i,o.timeout||this.timeout);i.type==="broadcast"&&!(!((u=(d=(s=this.params)===null||s===void 0?void 0:s.config)===null||d===void 0?void 0:d.broadcast)===null||u===void 0)&&u.ack)&&r("ok"),b.receive("ok",()=>r("ok")),b.receive("error",()=>r("error")),b.receive("timeout",()=>r("timed out"))})}updateJoinPayload(i){this.joinPush.updatePayload(i)}unsubscribe(i=this.timeout){this.state=Nt.leaving;const o=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(wi.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(a=>{n=new $a(this,wi.leave,{},i),n.receive("ok",()=>{o(),a("ok")}).receive("timeout",()=>{o(),a("timed out")}).receive("error",()=>{a("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(i=>i.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Nt.closed,this.bindings={}}async _fetchWithTimeout(i,o,n){const a=new AbortController,r=setTimeout(()=>a.abort(),n),s=await this.socket.fetch(i,Object.assign(Object.assign({},o),{signal:a.signal}));return clearTimeout(r),s}_push(i,o,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${i}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new $a(this,i,o,n);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(i){if(i.startTimeout(),this.pushBuffer.push(i),this.pushBuffer.length>wp){const o=this.pushBuffer.shift();o&&(o.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${o.event}`,o.payload))}}_onMessage(i,o,n){return o}_isMember(i){return this.topic===i}_joinRef(){return this.joinPush.ref}_trigger(i,o,n){var a,r;const s=i.toLocaleLowerCase(),{close:d,error:u,leave:b,join:j}=wi;if(n&&[d,u,b,j].indexOf(s)>=0&&n!==this._joinRef())return;let S=this._onMessage(s,o,n);if(o&&!S)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(m=>{var x,p,c;return((x=m.filter)===null||x===void 0?void 0:x.event)==="*"||((c=(p=m.filter)===null||p===void 0?void 0:p.event)===null||c===void 0?void 0:c.toLocaleLowerCase())===s}).map(m=>m.callback(S,n)):(r=this.bindings[s])===null||r===void 0||r.filter(m=>{var x,p,c,g,l,f;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in m){const y=m.id,h=(x=m.filter)===null||x===void 0?void 0:x.event;return y&&((p=o.ids)===null||p===void 0?void 0:p.includes(y))&&(h==="*"||(h==null?void 0:h.toLocaleLowerCase())===((c=o.data)===null||c===void 0?void 0:c.type.toLocaleLowerCase()))}else{const y=(l=(g=m==null?void 0:m.filter)===null||g===void 0?void 0:g.event)===null||l===void 0?void 0:l.toLocaleLowerCase();return y==="*"||y===((f=o==null?void 0:o.event)===null||f===void 0?void 0:f.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===s}).map(m=>{if(typeof S=="object"&&"ids"in S){const x=S.data,{schema:p,table:c,commit_timestamp:g,type:l,errors:f}=x;S=Object.assign(Object.assign({},{schema:p,table:c,commit_timestamp:g,eventType:l,new:{},old:{},errors:f}),this._getPayloadRecords(x))}m.callback(S,n)})}_isClosed(){return this.state===Nt.closed}_isJoined(){return this.state===Nt.joined}_isJoining(){return this.state===Nt.joining}_isLeaving(){return this.state===Nt.leaving}_replyEventName(i){return`chan_reply_${i}`}_on(i,o,n){const a=i.toLocaleLowerCase(),r={type:a,filter:o,callback:n};return this.bindings[a]?this.bindings[a].push(r):this.bindings[a]=[r],this}_off(i,o){const n=i.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(a=>{var r;return!(((r=a.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&un.isEqual(a.filter,o))})),this}static isEqual(i,o){if(Object.keys(i).length!==Object.keys(o).length)return!1;for(const n in i)if(i[n]!==o[n])return!1;return!0}static isFilterValueEqual(i,o){return(i??void 0)===(o??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(i){this._on(wi.close,{},i)}_onError(i){this._on(wi.error,{},o=>i(o))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(i=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Nt.joining,this.joinPush.resend(i))}_getPayloadRecords(i){const o={new:{},old:{}};return(i.type==="INSERT"||i.type==="UPDATE")&&(o.new=xl(i.columns,i.record)),(i.type==="UPDATE"||i.type==="DELETE")&&(o.old=xl(i.columns,i.old_record)),o}}const Pa=()=>{},zr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Rp=[1e3,2e3,5e3,1e4],Mp=1e4,_p=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Dp{constructor(i,o){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Fs,this.transport=null,this.heartbeatIntervalMs=zr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Pa,this.ref=0,this.reconnectTimer=null,this.vsn=fl,this.logger=Pa,this.conn=null,this.sendBuffer=[],this.serializer=new zp,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=a=>a?(...r)=>a(...r):(...r)=>fetch(...r),!(!((n=o==null?void 0:o.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=o.params.apikey,this.endPoint=`${i}/${Ts.websocket}`,this.httpEndpoint=Ud(i),this._initializeOptions(o),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(o==null?void 0:o.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=vp.createWebSocket(this.endpointURL())}catch(i){this._setConnectionState("disconnected");const o=i.message;throw o.includes("Node.js")?new Error(`${o}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${o}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(i,o){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(i?this.conn.close(i,o??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(i){const o=await i.unsubscribe();return this.channels.length===0&&this.disconnect(),o}async removeAllChannels(){const i=await Promise.all(this.channels.map(o=>o.unsubscribe()));return this.channels=[],this.disconnect(),i}log(i,o,n){this.logger(i,o,n)}connectionState(){switch(this.conn&&this.conn.readyState){case xo.connecting:return Do.Connecting;case xo.open:return Do.Open;case xo.closing:return Do.Closing;default:return Do.Closed}}isConnected(){return this.connectionState()===Do.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(i,o={config:{}}){const n=`realtime:${i}`,a=this.getChannels().find(r=>r.topic===n);if(a)return a;{const r=new un(`realtime:${i}`,o,this);return this.channels.push(r),r}}push(i){const{topic:o,event:n,payload:a,ref:r}=i,s=()=>{this.encode(i,d=>{var u;(u=this.conn)===null||u===void 0||u.send(d)})};this.log("push",`${o} ${n} (${r})`,a),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(i=null){this._authPromise=this._performAuth(i);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var i;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(o){this.log("error","error in heartbeat callback",o)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(o){this.log("error","error in heartbeat callback",o)}this._wasManualDisconnect=!1,(i=this.conn)===null||i===void 0||i.close(kp,"heartbeat timeout"),setTimeout(()=>{var o;this.isConnected()||(o=this.reconnectTimer)===null||o===void 0||o.scheduleTimeout()},zr.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(o){this.log("error","error in heartbeat callback",o)}this._setAuthSafely("heartbeat")}onHeartbeat(i){this.heartbeatCallback=i}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(i=>i()),this.sendBuffer=[])}_makeRef(){let i=this.ref+1;return i===this.ref?this.ref=0:this.ref=i,this.ref.toString()}_leaveOpenTopic(i){let o=this.channels.find(n=>n.topic===i&&(n._isJoined()||n._isJoining()));o&&(this.log("transport",`leaving duplicate topic "${i}"`),o.unsubscribe())}_remove(i){this.channels=this.channels.filter(o=>o.topic!==i.topic)}_onConnMessage(i){this.decode(i.data,o=>{if(o.topic==="phoenix"&&o.event==="phx_reply"&&o.ref&&o.ref===this.pendingHeartbeatRef){const b=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(o.payload.status==="ok"?"ok":"error",b)}catch(j){this.log("error","error in heartbeat callback",j)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:a,payload:r,ref:s}=o,d=s?`(${s})`:"",u=r.status||"";this.log("receive",`${u} ${n} ${a} ${d}`.trim(),r),this.channels.filter(b=>b._isMember(n)).forEach(b=>b._trigger(a,r,s)),this._triggerStateCallbacks("message",o)})}_clearTimer(i){var o;i==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):i==="reconnect"&&((o=this.reconnectTimer)===null||o===void 0||o.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=i=>this._onConnError(i),this.conn.onmessage=i=>this._onConnMessage(i),this.conn.onclose=i=>this._onConnClose(i),this.conn.readyState===xo.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===xo.open||this.conn.readyState===xo.connecting)try{this.conn.close()}catch(i){this.log("error","Error closing connection",i)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(i=>i.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(o=>{this.log("error","error waiting for auth on connect",o),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const i=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(i),this.workerRef.onerror=o=>{this.log("worker","worker error",o.message),this._terminateWorker()},this.workerRef.onmessage=o=>{o.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(i){var o;this._setConnectionState("disconnected"),this.log("transport","close",i),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(o=this.reconnectTimer)===null||o===void 0||o.scheduleTimeout(),this._triggerStateCallbacks("close",i)}_onConnError(i){this._setConnectionState("disconnected"),this.log("transport",`${i}`),this._triggerChanError(),this._triggerStateCallbacks("error",i);try{this.heartbeatCallback("error")}catch(o){this.log("error","error in heartbeat callback",o)}}_triggerChanError(){this.channels.forEach(i=>i._trigger(wi.error))}_appendParams(i,o){if(Object.keys(o).length===0)return i;const n=i.match(/\?/)?"&":"?",a=new URLSearchParams(o);return`${i}${n}${a}`}_workerObjectUrl(i){let o;if(i)o=i;else{const n=new Blob([_p],{type:"application/javascript"});o=URL.createObjectURL(n)}return o}_setConnectionState(i,o=!1){this._connectionState=i,i==="connecting"?this._wasManualDisconnect=!1:i==="disconnecting"&&(this._wasManualDisconnect=o)}async _performAuth(i=null){let o,n=!1;if(i)o=i,n=!0;else if(this.accessToken)try{o=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),o=this.accessTokenValue}else o=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=o&&(this.accessTokenValue=o,this.channels.forEach(a=>{const r={access_token:o,version:Sp};o&&a.updateJoinPayload(r),a.joinedOnce&&a._isJoined()&&a._push(wi.access_token,{access_token:o})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(i="general"){this._isManualToken()||this.setAuth().catch(o=>{this.log("error",`Error setting auth in ${i}`,o)})}_triggerStateCallbacks(i,o){try{this.stateChangeCallbacks[i].forEach(n=>{try{n(o)}catch(a){this.log("error",`error in ${i} callback`,a)}})}catch(n){this.log("error",`error triggering ${i} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Wd(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},zr.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(i){var o,n,a,r,s,d,u,b,j,w,S,m;switch(this.transport=(o=i==null?void 0:i.transport)!==null&&o!==void 0?o:null,this.timeout=(n=i==null?void 0:i.timeout)!==null&&n!==void 0?n:Fs,this.heartbeatIntervalMs=(a=i==null?void 0:i.heartbeatIntervalMs)!==null&&a!==void 0?a:zr.HEARTBEAT_INTERVAL,this.worker=(r=i==null?void 0:i.worker)!==null&&r!==void 0?r:!1,this.accessToken=(s=i==null?void 0:i.accessToken)!==null&&s!==void 0?s:null,this.heartbeatCallback=(d=i==null?void 0:i.heartbeatCallback)!==null&&d!==void 0?d:Pa,this.vsn=(u=i==null?void 0:i.vsn)!==null&&u!==void 0?u:fl,i!=null&&i.params&&(this.params=i.params),i!=null&&i.logger&&(this.logger=i.logger),(i!=null&&i.logLevel||i!=null&&i.log_level)&&(this.logLevel=i.logLevel||i.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(b=i==null?void 0:i.reconnectAfterMs)!==null&&b!==void 0?b:x=>Rp[x-1]||Mp,this.vsn){case Cp:this.encode=(j=i==null?void 0:i.encode)!==null&&j!==void 0?j:(x,p)=>p(JSON.stringify(x)),this.decode=(w=i==null?void 0:i.decode)!==null&&w!==void 0?w:(x,p)=>p(JSON.parse(x));break;case Ld:this.encode=(S=i==null?void 0:i.encode)!==null&&S!==void 0?S:this.serializer.encode.bind(this.serializer),this.decode=(m=i==null?void 0:i.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=i==null?void 0:i.workerUrl}}}var ar=class extends Error{constructor(t,i){var o;super(t),this.name="IcebergError",this.status=i.status,this.icebergType=i.icebergType,this.icebergCode=i.icebergCode,this.details=i.details,this.isCommitStateUnknown=i.icebergType==="CommitStateUnknownException"||[500,502,504].includes(i.status)&&((o=i.icebergType)==null?void 0:o.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function $p(t,i,o){const n=new URL(i,t);if(o)for(const[a,r]of Object.entries(o))r!==void 0&&n.searchParams.set(a,r);return n.toString()}async function Pp(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function Op(t){const i=t.fetchImpl??globalThis.fetch;return{async request({method:o,path:n,query:a,body:r,headers:s}){const d=$p(t.baseUrl,n,a),u=await Pp(t.auth),b=await i(d,{method:o,headers:{...r?{"Content-Type":"application/json"}:{},...u,...s},body:r?JSON.stringify(r):void 0}),j=await b.text(),w=(b.headers.get("content-type")||"").includes("application/json"),S=w&&j?JSON.parse(j):j;if(!b.ok){const m=w?S:void 0,x=m==null?void 0:m.error;throw new ar((x==null?void 0:x.message)??`Request failed with status ${b.status}`,{status:b.status,icebergType:x==null?void 0:x.type,icebergCode:x==null?void 0:x.code,details:m})}return{status:b.status,headers:b.headers,data:S}}}}function Er(t){return t.join("")}var Lp=class{constructor(t,i=""){this.client=t,this.prefix=i}async listNamespaces(t){const i=t?{parent:Er(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:i})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(t,i){const o={namespace:t.namespace,properties:i==null?void 0:i.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:o})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Er(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Er(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Er(t.namespace)}`}),!0}catch(i){if(i instanceof ar&&i.status===404)return!1;throw i}}async createNamespaceIfNotExists(t,i){try{return await this.createNamespace(t,i)}catch(o){if(o instanceof ar&&o.status===409)return;throw o}}};function Ho(t){return t.join("")}var Wp=class{constructor(t,i="",o){this.client=t,this.prefix=i,this.accessDelegation=o}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables`})).data.identifiers}async createTable(t,i){const o={};return this.accessDelegation&&(o["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables`,body:i,headers:o})).data.metadata}async updateTable(t,i){const o=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables/${t.name}`,body:i});return{"metadata-location":o.data["metadata-location"],metadata:o.data.metadata}}async dropTable(t,i){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((i==null?void 0:i.purge)??!1)}})}async loadTable(t){const i={};return this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables/${t.name}`,headers:i})).data.metadata}async tableExists(t){const i={};this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables/${t.name}`,headers:i}),!0}catch(o){if(o instanceof ar&&o.status===404)return!1;throw o}}async createTableIfNotExists(t,i){try{return await this.createTable(t,i)}catch(o){if(o instanceof ar&&o.status===409)return await this.loadTable({namespace:t.namespace,name:i.name});throw o}}},Np=class{constructor(t){var n;let i="v1";t.catalogName&&(i+=`/${t.catalogName}`);const o=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=Op({baseUrl:o,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(n=t.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new Lp(this.client,i),this.tableOps=new Wp(this.client,i,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,i){return this.namespaceOps.createNamespace(t,i)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,i){return this.tableOps.createTable(t,i)}async updateTable(t,i){return this.tableOps.updateTable(t,i)}async dropTable(t,i){await this.tableOps.dropTable(t,i)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,i){return this.namespaceOps.createNamespaceIfNotExists(t,i)}async createTableIfNotExists(t,i){return this.tableOps.createTableIfNotExists(t,i)}},Ba=class extends Error{constructor(t,i="storage",o,n){super(t),this.__isStorageError=!0,this.namespace=i,this.name=i==="vectors"?"StorageVectorsError":"StorageError",this.status=o,this.statusCode=n}};function Ia(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var Ar=class extends Ba{constructor(t,i,o,n="storage"){super(t,n,i,o),this.name=n==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=i,this.statusCode=o}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Vd=class extends Ba{constructor(t,i,o="storage"){super(t,o),this.name=o==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=i}};const Up=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),Vp=t=>{if(typeof t!="object"||t===null)return!1;const i=Object.getPrototypeOf(t);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Is=t=>{if(Array.isArray(t))return t.map(o=>Is(o));if(typeof t=="function"||t!==Object(t))return t;const i={};return Object.entries(t).forEach(([o,n])=>{const a=o.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));i[a]=Is(n)}),i},qp=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function sr(t){"@babel/helpers - typeof";return sr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},sr(t)}function Hp(t,i){if(sr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(sr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function Gp(t){var i=Hp(t,"string");return sr(i)=="symbol"?i:i+""}function Kp(t,i,o){return(i=Gp(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function yl(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),o.push.apply(o,n)}return o}function nt(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?yl(Object(o),!0).forEach(function(n){Kp(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):yl(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}const vl=t=>{var i;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(i=t.error)===null||i===void 0?void 0:i.message)||JSON.stringify(t)},Jp=async(t,i,o,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(o!=null&&o.noResolveJson)){const a=t,r=a.status||500;if(typeof a.json=="function")a.json().then(s=>{const d=(s==null?void 0:s.statusCode)||(s==null?void 0:s.code)||r+"";i(new Ar(vl(s),r,d,n))}).catch(()=>{if(n==="vectors"){const s=r+"";i(new Ar(a.statusText||`HTTP ${r} error`,r,s,n))}else{const s=r+"";i(new Ar(a.statusText||`HTTP ${r} error`,r,s,n))}});else{const s=r+"";i(new Ar(a.statusText||`HTTP ${r} error`,r,s,n))}}else i(new Vd(vl(t),t,n))},Yp=(t,i,o,n)=>{const a={method:t,headers:(i==null?void 0:i.headers)||{}};return t==="GET"||t==="HEAD"||!n?nt(nt({},a),o):(Vp(n)?(a.headers=nt({"Content-Type":"application/json"},i==null?void 0:i.headers),a.body=JSON.stringify(n)):a.body=n,i!=null&&i.duplex&&(a.duplex=i.duplex),nt(nt({},a),o))};async function _n(t,i,o,n,a,r,s){return new Promise((d,u)=>{t(o,Yp(i,n,a,r)).then(b=>{if(!b.ok)throw b;if(n!=null&&n.noResolveJson)return b;if(s==="vectors"){const j=b.headers.get("content-type");if(b.headers.get("content-length")==="0"||b.status===204)return{};if(!j||!j.includes("application/json"))return{}}return b.json()}).then(b=>d(b)).catch(b=>Jp(b,u,n,s))})}function qd(t="storage"){return{get:async(i,o,n,a)=>_n(i,"GET",o,n,a,void 0,t),post:async(i,o,n,a,r)=>_n(i,"POST",o,a,r,n,t),put:async(i,o,n,a,r)=>_n(i,"PUT",o,a,r,n,t),head:async(i,o,n,a)=>_n(i,"HEAD",o,nt(nt({},n),{},{noResolveJson:!0}),a,void 0,t),remove:async(i,o,n,a,r)=>_n(i,"DELETE",o,a,r,n,t)}}const Xp=qd("storage"),{get:lr,post:ki,put:Rs,head:Qp,remove:ol}=Xp,gi=qd("vectors");var Bn=class{constructor(t,i={},o,n="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=i,this.fetch=Up(o),this.namespace=n}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,i){return this.headers=nt(nt({},this.headers),{},{[t]:i}),this}async handleOperation(t){var i=this;try{return{data:await t(),error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(Ia(o))return{data:null,error:o};throw o}}},Zp=class{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i}then(t,i){return this.execute().then(t,i)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Ia(i))return{data:null,error:i};throw i}}};let Hd;Hd=Symbol.toStringTag;var eg=class{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i,this[Hd]="BlobDownloadBuilder",this.promise=null}asStream(){return new Zp(this.downloadFn,this.shouldThrowOnError)}then(t,i){return this.getPromise().then(t,i)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Ia(i))return{data:null,error:i};throw i}}};const tg={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},jl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var ig=class extends Bn{constructor(t,i={},o,n){super(t,i,n,"storage"),this.bucketId=o}async uploadOrUpdate(t,i,o,n){var a=this;return a.handleOperation(async()=>{let r;const s=nt(nt({},jl),n);let d=nt(nt({},a.headers),t==="POST"&&{"x-upsert":String(s.upsert)});const u=s.metadata;typeof Blob<"u"&&o instanceof Blob?(r=new FormData,r.append("cacheControl",s.cacheControl),u&&r.append("metadata",a.encodeMetadata(u)),r.append("",o)):typeof FormData<"u"&&o instanceof FormData?(r=o,r.has("cacheControl")||r.append("cacheControl",s.cacheControl),u&&!r.has("metadata")&&r.append("metadata",a.encodeMetadata(u))):(r=o,d["cache-control"]=`max-age=${s.cacheControl}`,d["content-type"]=s.contentType,u&&(d["x-metadata"]=a.toBase64(a.encodeMetadata(u))),(typeof ReadableStream<"u"&&r instanceof ReadableStream||r&&typeof r=="object"&&"pipe"in r&&typeof r.pipe=="function")&&!s.duplex&&(s.duplex="half")),n!=null&&n.headers&&(d=nt(nt({},d),n.headers));const b=a._removeEmptyFolders(i),j=a._getFinalPath(b),w=await(t=="PUT"?Rs:ki)(a.fetch,`${a.url}/object/${j}`,r,nt({headers:d},s!=null&&s.duplex?{duplex:s.duplex}:{}));return{path:b,id:w.Id,fullPath:w.Key}})}async upload(t,i,o){return this.uploadOrUpdate("POST",t,i,o)}async uploadToSignedUrl(t,i,o,n){var a=this;const r=a._removeEmptyFolders(t),s=a._getFinalPath(r),d=new URL(a.url+`/object/upload/sign/${s}`);return d.searchParams.set("token",i),a.handleOperation(async()=>{let u;const b=nt({upsert:jl.upsert},n),j=nt(nt({},a.headers),{"x-upsert":String(b.upsert)});return typeof Blob<"u"&&o instanceof Blob?(u=new FormData,u.append("cacheControl",b.cacheControl),u.append("",o)):typeof FormData<"u"&&o instanceof FormData?(u=o,u.append("cacheControl",b.cacheControl)):(u=o,j["cache-control"]=`max-age=${b.cacheControl}`,j["content-type"]=b.contentType),{path:r,fullPath:(await Rs(a.fetch,d.toString(),u,{headers:j})).Key}})}async createSignedUploadUrl(t,i){var o=this;return o.handleOperation(async()=>{let n=o._getFinalPath(t);const a=nt({},o.headers);i!=null&&i.upsert&&(a["x-upsert"]="true");const r=await ki(o.fetch,`${o.url}/object/upload/sign/${n}`,{},{headers:a}),s=new URL(o.url+r.url),d=s.searchParams.get("token");if(!d)throw new Ba("No token returned by API");return{signedUrl:s.toString(),path:t,token:d}})}async update(t,i,o){return this.uploadOrUpdate("PUT",t,i,o)}async move(t,i,o){var n=this;return n.handleOperation(async()=>await ki(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:t,destinationKey:i,destinationBucket:o==null?void 0:o.destinationBucket},{headers:n.headers}))}async copy(t,i,o){var n=this;return n.handleOperation(async()=>({path:(await ki(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:t,destinationKey:i,destinationBucket:o==null?void 0:o.destinationBucket},{headers:n.headers})).Key}))}async createSignedUrl(t,i,o){var n=this;return n.handleOperation(async()=>{let a=n._getFinalPath(t),r=await ki(n.fetch,`${n.url}/object/sign/${a}`,nt({expiresIn:i},o!=null&&o.transform?{transform:o.transform}:{}),{headers:n.headers});const s=o!=null&&o.download?`&download=${o.download===!0?"":o.download}`:"";return{signedUrl:encodeURI(`${n.url}${r.signedURL}${s}`)}})}async createSignedUrls(t,i,o){var n=this;return n.handleOperation(async()=>{const a=await ki(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:i,paths:t},{headers:n.headers}),r=o!=null&&o.download?`&download=${o.download===!0?"":o.download}`:"";return a.map(s=>nt(nt({},s),{},{signedUrl:s.signedURL?encodeURI(`${n.url}${s.signedURL}${r}`):null}))})}download(t,i,o){const n=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),r=a?`?${a}`:"",s=this._getFinalPath(t),d=()=>lr(this.fetch,`${this.url}/${n}/${s}${r}`,{headers:this.headers,noResolveJson:!0},o);return new eg(d,this.shouldThrowOnError)}async info(t){var i=this;const o=i._getFinalPath(t);return i.handleOperation(async()=>Is(await lr(i.fetch,`${i.url}/object/info/${o}`,{headers:i.headers})))}async exists(t){var i=this;const o=i._getFinalPath(t);try{return await Qp(i.fetch,`${i.url}/object/${o}`,{headers:i.headers}),{data:!0,error:null}}catch(n){if(i.shouldThrowOnError)throw n;if(Ia(n)&&n instanceof Vd){const a=n.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:n}}throw n}}getPublicUrl(t,i){const o=this._getFinalPath(t),n=[],a=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";a!==""&&n.push(a);const r=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",s=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});s!==""&&n.push(s);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${o}${d}`)}}}async remove(t){var i=this;return i.handleOperation(async()=>await ol(i.fetch,`${i.url}/object/${i.bucketId}`,{prefixes:t},{headers:i.headers}))}async list(t,i,o){var n=this;return n.handleOperation(async()=>{const a=nt(nt(nt({},tg),i),{},{prefix:t||""});return await ki(n.fetch,`${n.url}/object/list/${n.bucketId}`,a,{headers:n.headers},o)})}async listV2(t,i){var o=this;return o.handleOperation(async()=>{const n=nt({},t);return await ki(o.fetch,`${o.url}/object/list-v2/${o.bucketId}`,n,{headers:o.headers},i)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const i=[];return t.width&&i.push(`width=${t.width}`),t.height&&i.push(`height=${t.height}`),t.resize&&i.push(`resize=${t.resize}`),t.format&&i.push(`format=${t.format}`),t.quality&&i.push(`quality=${t.quality}`),i.join("&")}};const og="2.97.0",br={"X-Client-Info":`storage-js/${og}`};var ng=class extends Bn{constructor(t,i={},o,n){const a=new URL(t);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase."));const r=a.href.replace(/\/$/,""),s=nt(nt({},br),i);super(r,s,o,"storage")}async listBuckets(t){var i=this;return i.handleOperation(async()=>{const o=i.listBucketOptionsToQueryString(t);return await lr(i.fetch,`${i.url}/bucket${o}`,{headers:i.headers})})}async getBucket(t){var i=this;return i.handleOperation(async()=>await lr(i.fetch,`${i.url}/bucket/${t}`,{headers:i.headers}))}async createBucket(t,i={public:!1}){var o=this;return o.handleOperation(async()=>await ki(o.fetch,`${o.url}/bucket`,{id:t,name:t,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:o.headers}))}async updateBucket(t,i){var o=this;return o.handleOperation(async()=>await Rs(o.fetch,`${o.url}/bucket/${t}`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:o.headers}))}async emptyBucket(t){var i=this;return i.handleOperation(async()=>await ki(i.fetch,`${i.url}/bucket/${t}/empty`,{},{headers:i.headers}))}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await ol(i.fetch,`${i.url}/bucket/${t}`,{},{headers:i.headers}))}listBucketOptionsToQueryString(t){const i={};return t&&("limit"in t&&(i.limit=String(t.limit)),"offset"in t&&(i.offset=String(t.offset)),t.search&&(i.search=t.search),t.sortColumn&&(i.sortColumn=t.sortColumn),t.sortOrder&&(i.sortOrder=t.sortOrder)),Object.keys(i).length>0?"?"+new URLSearchParams(i).toString():""}},rg=class extends Bn{constructor(t,i={},o){const n=t.replace(/\/$/,""),a=nt(nt({},br),i);super(n,a,o,"storage")}async createBucket(t){var i=this;return i.handleOperation(async()=>await ki(i.fetch,`${i.url}/bucket`,{name:t},{headers:i.headers}))}async listBuckets(t){var i=this;return i.handleOperation(async()=>{const o=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&o.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&o.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&o.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&o.set("sortOrder",t.sortOrder),t!=null&&t.search&&o.set("search",t.search);const n=o.toString(),a=n?`${i.url}/bucket?${n}`:`${i.url}/bucket`;return await lr(i.fetch,a,{headers:i.headers})})}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await ol(i.fetch,`${i.url}/bucket/${t}`,{},{headers:i.headers}))}from(t){var i=this;if(!qp(t))throw new Ba("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const o=new Np({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>i.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(o,{get(a,r){const s=a[r];return typeof s!="function"?s:async(...d)=>{try{return{data:await s.apply(a,d),error:null}}catch(u){if(n)throw u;return{data:null,error:u}}}}})}},ag=class extends Bn{constructor(t,i={},o){const n=t.replace(/\/$/,""),a=nt(nt({},br),{},{"Content-Type":"application/json"},i);super(n,a,o,"vectors")}async createIndex(t){var i=this;return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/CreateIndex`,t,{headers:i.headers})||{})}async getIndex(t,i){var o=this;return o.handleOperation(async()=>await gi.post(o.fetch,`${o.url}/GetIndex`,{vectorBucketName:t,indexName:i},{headers:o.headers}))}async listIndexes(t){var i=this;return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/ListIndexes`,t,{headers:i.headers}))}async deleteIndex(t,i){var o=this;return o.handleOperation(async()=>await gi.post(o.fetch,`${o.url}/DeleteIndex`,{vectorBucketName:t,indexName:i},{headers:o.headers})||{})}},sg=class extends Bn{constructor(t,i={},o){const n=t.replace(/\/$/,""),a=nt(nt({},br),{},{"Content-Type":"application/json"},i);super(n,a,o,"vectors")}async putVectors(t){var i=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/PutVectors`,t,{headers:i.headers})||{})}async getVectors(t){var i=this;return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/GetVectors`,t,{headers:i.headers}))}async listVectors(t){var i=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/ListVectors`,t,{headers:i.headers}))}async queryVectors(t){var i=this;return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/QueryVectors`,t,{headers:i.headers}))}async deleteVectors(t){var i=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/DeleteVectors`,t,{headers:i.headers})||{})}},lg=class extends Bn{constructor(t,i={},o){const n=t.replace(/\/$/,""),a=nt(nt({},br),{},{"Content-Type":"application/json"},i);super(n,a,o,"vectors")}async createBucket(t){var i=this;return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:i.headers})||{})}async getBucket(t){var i=this;return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/GetVectorBucket`,{vectorBucketName:t},{headers:i.headers}))}async listBuckets(t={}){var i=this;return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/ListVectorBuckets`,t,{headers:i.headers}))}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await gi.post(i.fetch,`${i.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:i.headers})||{})}},dg=class extends lg{constructor(t,i={}){super(t,i.headers||{},i.fetch)}from(t){return new cg(this.url,this.headers,t,this.fetch)}async createBucket(t){var i=()=>super.createBucket,o=this;return i().call(o,t)}async getBucket(t){var i=()=>super.getBucket,o=this;return i().call(o,t)}async listBuckets(t={}){var i=()=>super.listBuckets,o=this;return i().call(o,t)}async deleteBucket(t){var i=()=>super.deleteBucket,o=this;return i().call(o,t)}},cg=class extends ag{constructor(t,i,o,n){super(t,i,n),this.vectorBucketName=o}async createIndex(t){var i=()=>super.createIndex,o=this;return i().call(o,nt(nt({},t),{},{vectorBucketName:o.vectorBucketName}))}async listIndexes(t={}){var i=()=>super.listIndexes,o=this;return i().call(o,nt(nt({},t),{},{vectorBucketName:o.vectorBucketName}))}async getIndex(t){var i=()=>super.getIndex,o=this;return i().call(o,o.vectorBucketName,t)}async deleteIndex(t){var i=()=>super.deleteIndex,o=this;return i().call(o,o.vectorBucketName,t)}index(t){return new pg(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},pg=class extends sg{constructor(t,i,o,n,a){super(t,i,a),this.vectorBucketName=o,this.indexName=n}async putVectors(t){var i=()=>super.putVectors,o=this;return i().call(o,nt(nt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async getVectors(t){var i=()=>super.getVectors,o=this;return i().call(o,nt(nt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async listVectors(t={}){var i=()=>super.listVectors,o=this;return i().call(o,nt(nt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async queryVectors(t){var i=()=>super.queryVectors,o=this;return i().call(o,nt(nt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async deleteVectors(t){var i=()=>super.deleteVectors,o=this;return i().call(o,nt(nt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}},gg=class extends ng{constructor(t,i={},o,n){super(t,i,o,n)}from(t){return new ig(this.url,this.headers,t,this.fetch)}get vectors(){return new dg(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new rg(this.url+"/iceberg",this.headers,this.fetch)}};const Gd="2.97.0",cn=30*1e3,Ms=3,Oa=Ms*cn,ug="http://localhost:9999",hg="supabase.auth.token",fg={"X-Client-Info":`gotrue-js/${Gd}`},_s="X-Supabase-Api-Version",Kd={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},xg=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,mg=10*60*1e3;class dr extends Error{constructor(i,o,n){super(i),this.__isAuthError=!0,this.name="AuthError",this.status=o,this.code=n}}function Ye(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class bg extends dr{constructor(i,o,n){super(i,o,n),this.name="AuthApiError",this.status=o,this.code=n}}function yg(t){return Ye(t)&&t.name==="AuthApiError"}class $o extends dr{constructor(i,o){super(i),this.name="AuthUnknownError",this.originalError=o}}class so extends dr{constructor(i,o,n,a){super(i,n,a),this.name=o,this.status=n}}class ci extends so{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function La(t){return Ye(t)&&t.name==="AuthSessionMissingError"}class Go extends so{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Fr extends so{constructor(i){super(i,"AuthInvalidCredentialsError",400,void 0)}}class Tr extends so{constructor(i,o=null){super(i,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function vg(t){return Ye(t)&&t.name==="AuthImplicitGrantRedirectError"}class Sl extends so{constructor(i,o=null){super(i,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jg extends so{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Ds extends so{constructor(i,o){super(i,"AuthRetryableFetchError",o,void 0)}}function Wa(t){return Ye(t)&&t.name==="AuthRetryableFetchError"}class Cl extends so{constructor(i,o,n){super(i,"AuthWeakPasswordError",o,"weak_password"),this.reasons=n}}class $s extends so{constructor(i){super(i,"AuthInvalidJwtError",400,"invalid_jwt")}}const pa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),kl=` 	
\r=`.split(""),Sg=(()=>{const t=new Array(128);for(let i=0;i<t.length;i+=1)t[i]=-1;for(let i=0;i<kl.length;i+=1)t[kl[i].charCodeAt(0)]=-2;for(let i=0;i<pa.length;i+=1)t[pa[i].charCodeAt(0)]=i;return t})();function wl(t,i,o){if(t!==null)for(i.queue=i.queue<<8|t,i.queuedBits+=8;i.queuedBits>=6;){const n=i.queue>>i.queuedBits-6&63;o(pa[n]),i.queuedBits-=6}else if(i.queuedBits>0)for(i.queue=i.queue<<6-i.queuedBits,i.queuedBits=6;i.queuedBits>=6;){const n=i.queue>>i.queuedBits-6&63;o(pa[n]),i.queuedBits-=6}}function Jd(t,i,o){const n=Sg[t];if(n>-1)for(i.queue=i.queue<<6|n,i.queuedBits+=6;i.queuedBits>=8;)o(i.queue>>i.queuedBits-8&255),i.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function zl(t){const i=[],o=s=>{i.push(String.fromCodePoint(s))},n={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},r=s=>{wg(s,n,o)};for(let s=0;s<t.length;s+=1)Jd(t.charCodeAt(s),a,r);return i.join("")}function Cg(t,i){if(t<=127){i(t);return}else if(t<=2047){i(192|t>>6),i(128|t&63);return}else if(t<=65535){i(224|t>>12),i(128|t>>6&63),i(128|t&63);return}else if(t<=1114111){i(240|t>>18),i(128|t>>12&63),i(128|t>>6&63),i(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function kg(t,i){for(let o=0;o<t.length;o+=1){let n=t.charCodeAt(o);if(n>55295&&n<=56319){const a=(n-55296)*1024&65535;n=(t.charCodeAt(o+1)-56320&65535|a)+65536,o+=1}Cg(n,i)}}function wg(t,i,o){if(i.utf8seq===0){if(t<=127){o(t);return}for(let n=1;n<6;n+=1)if(!(t>>7-n&1)){i.utf8seq=n;break}if(i.utf8seq===2)i.codepoint=t&31;else if(i.utf8seq===3)i.codepoint=t&15;else if(i.utf8seq===4)i.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");i.utf8seq-=1}else if(i.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");i.codepoint=i.codepoint<<6|t&63,i.utf8seq-=1,i.utf8seq===0&&o(i.codepoint)}}function vn(t){const i=[],o={queue:0,queuedBits:0},n=a=>{i.push(a)};for(let a=0;a<t.length;a+=1)Jd(t.charCodeAt(a),o,n);return new Uint8Array(i)}function zg(t){const i=[];return kg(t,o=>i.push(o)),new Uint8Array(i)}function Po(t){const i=[],o={queue:0,queuedBits:0},n=a=>{i.push(a)};return t.forEach(a=>wl(a,o,n)),wl(null,o,n),i.join("")}function Eg(t){return Math.round(Date.now()/1e3)+t}function Ag(){return Symbol("auth-callback")}const Jt=()=>typeof window<"u"&&typeof document<"u",Ao={tested:!1,writable:!1},Yd=()=>{if(!Jt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ao.tested)return Ao.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ao.tested=!0,Ao.writable=!0}catch{Ao.tested=!0,Ao.writable=!1}return Ao.writable};function Fg(t){const i={},o=new URL(t);if(o.hash&&o.hash[0]==="#")try{new URLSearchParams(o.hash.substring(1)).forEach((a,r)=>{i[r]=a})}catch{}return o.searchParams.forEach((n,a)=>{i[a]=n}),i}const Xd=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),Tg=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",pn=async(t,i,o)=>{await t.setItem(i,JSON.stringify(o))},Fo=async(t,i)=>{const o=await t.getItem(i);if(!o)return null;try{return JSON.parse(o)}catch{return o}},Kt=async(t,i)=>{await t.removeItem(i)};class Ra{constructor(){this.promise=new Ra.promiseConstructor((i,o)=>{this.resolve=i,this.reject=o})}}Ra.promiseConstructor=Promise;function Br(t){const i=t.split(".");if(i.length!==3)throw new $s("Invalid JWT structure");for(let n=0;n<i.length;n++)if(!xg.test(i[n]))throw new $s("JWT not in base64url format");return{header:JSON.parse(zl(i[0])),payload:JSON.parse(zl(i[1])),signature:vn(i[2]),raw:{header:i[0],payload:i[1]}}}async function Bg(t){return await new Promise(i=>{setTimeout(()=>i(null),t)})}function Ig(t,i){return new Promise((n,a)=>{(async()=>{for(let r=0;r<1/0;r++)try{const s=await t(r);if(!i(r,null,s)){n(s);return}}catch(s){if(!i(r,s)){a(s);return}}})()})}function Rg(t){return("0"+t.toString(16)).substr(-2)}function Mg(){const i=new Uint32Array(56);if(typeof crypto>"u"){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=o.length;let a="";for(let r=0;r<56;r++)a+=o.charAt(Math.floor(Math.random()*n));return a}return crypto.getRandomValues(i),Array.from(i,Rg).join("")}async function _g(t){const o=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",o),a=new Uint8Array(n);return Array.from(a).map(r=>String.fromCharCode(r)).join("")}async function Dg(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const o=await _g(t);return btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ko(t,i,o=!1){const n=Mg();let a=n;o&&(a+="/PASSWORD_RECOVERY"),await pn(t,`${i}-code-verifier`,a);const r=await Dg(n);return[r,n===r?"plain":"s256"]}const $g=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Pg(t){const i=t.headers.get(_s);if(!i||!i.match($g))return null;try{return new Date(`${i}T00:00:00.0Z`)}catch{return null}}function Og(t){if(!t)throw new Error("Missing exp claim");const i=Math.floor(Date.now()/1e3);if(t<=i)throw new Error("JWT has expired")}function Lg(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Wg=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Jo(t){if(!Wg.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Na(){const t={};return new Proxy(t,{get:(i,o)=>{if(o==="__isUserNotAvailableProxy")return!0;if(typeof o=="symbol"){const n=o.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${o}" property of the session object is not supported. Please use getUser() instead.`)},set:(i,o)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${o}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(i,o)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${o}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ng(t,i){return new Proxy(t,{get:(o,n,a)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)"||r==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(o,n,a)}return!i.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i.value=!0),Reflect.get(o,n,a)}})}function El(t){return JSON.parse(JSON.stringify(t))}const _o=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Ug=[502,503,504];async function Al(t){var i;if(!Tg(t))throw new Ds(_o(t),0);if(Ug.includes(t.status))throw new Ds(_o(t),t.status);let o;try{o=await t.json()}catch(r){throw new $o(_o(r),r)}let n;const a=Pg(t);if(a&&a.getTime()>=Kd["2024-01-01"].timestamp&&typeof o=="object"&&o&&typeof o.code=="string"?n=o.code:typeof o=="object"&&o&&typeof o.error_code=="string"&&(n=o.error_code),n){if(n==="weak_password")throw new Cl(_o(o),t.status,((i=o.weak_password)===null||i===void 0?void 0:i.reasons)||[]);if(n==="session_not_found")throw new ci}else if(typeof o=="object"&&o&&typeof o.weak_password=="object"&&o.weak_password&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.reasons.reduce((r,s)=>r&&typeof s=="string",!0))throw new Cl(_o(o),t.status,o.weak_password.reasons);throw new bg(_o(o),t.status||500,n)}const Vg=(t,i,o,n)=>{const a={method:t,headers:(i==null?void 0:i.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},i==null?void 0:i.headers),a.body=JSON.stringify(n),Object.assign(Object.assign({},a),o))};async function rt(t,i,o,n){var a;const r=Object.assign({},n==null?void 0:n.headers);r[_s]||(r[_s]=Kd["2024-01-01"].name),n!=null&&n.jwt&&(r.Authorization=`Bearer ${n.jwt}`);const s=(a=n==null?void 0:n.query)!==null&&a!==void 0?a:{};n!=null&&n.redirectTo&&(s.redirect_to=n.redirectTo);const d=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",u=await qg(t,i,o+d,{headers:r,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(u):{data:Object.assign({},u),error:null}}async function qg(t,i,o,n,a,r){const s=Vg(i,n,a,r);let d;try{d=await t(o,Object.assign({},s))}catch(u){throw console.error(u),new Ds(_o(u),0)}if(d.ok||await Al(d),n!=null&&n.noResolveJson)return d;try{return await d.json()}catch(u){await Al(u)}}function Si(t){var i;let o=null;Kg(t)&&(o=Object.assign({},t),t.expires_at||(o.expires_at=Eg(t.expires_in)));const n=(i=t.user)!==null&&i!==void 0?i:t;return{data:{session:o,user:n},error:null}}function Fl(t){const i=Si(t);return!i.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((o,n)=>o&&typeof n=="string",!0)&&(i.data.weak_password=t.weak_password),i}function yo(t){var i;return{data:{user:(i=t.user)!==null&&i!==void 0?i:t},error:null}}function Hg(t){return{data:t,error:null}}function Gg(t){const{action_link:i,email_otp:o,hashed_token:n,redirect_to:a,verification_type:r}=t,s=Ta(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),d={action_link:i,email_otp:o,hashed_token:n,redirect_to:a,verification_type:r},u=Object.assign({},s);return{data:{properties:d,user:u},error:null}}function Tl(t){return t}function Kg(t){return t.access_token&&t.refresh_token&&t.expires_in}const Ua=["global","local","others"];class Jg{constructor({url:i="",headers:o={},fetch:n}){this.url=i,this.headers=o,this.fetch=Xd(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(i,o=Ua[0]){if(Ua.indexOf(o)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ua.join(", ")}`);try{return await rt(this.fetch,"POST",`${this.url}/logout?scope=${o}`,{headers:this.headers,jwt:i,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async inviteUserByEmail(i,o={}){try{return await rt(this.fetch,"POST",`${this.url}/invite`,{body:{email:i,data:o.data},headers:this.headers,redirectTo:o.redirectTo,xform:yo})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async generateLink(i){try{const{options:o}=i,n=Ta(i,["options"]),a=Object.assign(Object.assign({},n),o);return"newEmail"in n&&(a.new_email=n==null?void 0:n.newEmail,delete a.newEmail),await rt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:Gg,redirectTo:o==null?void 0:o.redirectTo})}catch(o){if(Ye(o))return{data:{properties:null,user:null},error:o};throw o}}async createUser(i){try{return await rt(this.fetch,"POST",`${this.url}/admin/users`,{body:i,headers:this.headers,xform:yo})}catch(o){if(Ye(o))return{data:{user:null},error:o};throw o}}async listUsers(i){var o,n,a,r,s,d,u;try{const b={nextPage:null,lastPage:0,total:0},j=await rt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(o=i==null?void 0:i.page)===null||o===void 0?void 0:o.toString())!==null&&n!==void 0?n:"",per_page:(r=(a=i==null?void 0:i.perPage)===null||a===void 0?void 0:a.toString())!==null&&r!==void 0?r:""},xform:Tl});if(j.error)throw j.error;const w=await j.json(),S=(s=j.headers.get("x-total-count"))!==null&&s!==void 0?s:0,m=(u=(d=j.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&u!==void 0?u:[];return m.length>0&&(m.forEach(x=>{const p=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(x.split(";")[1].split("=")[1]);b[`${c}Page`]=p}),b.total=parseInt(S)),{data:Object.assign(Object.assign({},w),b),error:null}}catch(b){if(Ye(b))return{data:{users:[]},error:b};throw b}}async getUserById(i){Jo(i);try{return await rt(this.fetch,"GET",`${this.url}/admin/users/${i}`,{headers:this.headers,xform:yo})}catch(o){if(Ye(o))return{data:{user:null},error:o};throw o}}async updateUserById(i,o){Jo(i);try{return await rt(this.fetch,"PUT",`${this.url}/admin/users/${i}`,{body:o,headers:this.headers,xform:yo})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async deleteUser(i,o=!1){Jo(i);try{return await rt(this.fetch,"DELETE",`${this.url}/admin/users/${i}`,{headers:this.headers,body:{should_soft_delete:o},xform:yo})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async _listFactors(i){Jo(i.userId);try{const{data:o,error:n}=await rt(this.fetch,"GET",`${this.url}/admin/users/${i.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:o,error:n}}catch(o){if(Ye(o))return{data:null,error:o};throw o}}async _deleteFactor(i){Jo(i.userId),Jo(i.id);try{return{data:await rt(this.fetch,"DELETE",`${this.url}/admin/users/${i.userId}/factors/${i.id}`,{headers:this.headers}),error:null}}catch(o){if(Ye(o))return{data:null,error:o};throw o}}async _listOAuthClients(i){var o,n,a,r,s,d,u;try{const b={nextPage:null,lastPage:0,total:0},j=await rt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(o=i==null?void 0:i.page)===null||o===void 0?void 0:o.toString())!==null&&n!==void 0?n:"",per_page:(r=(a=i==null?void 0:i.perPage)===null||a===void 0?void 0:a.toString())!==null&&r!==void 0?r:""},xform:Tl});if(j.error)throw j.error;const w=await j.json(),S=(s=j.headers.get("x-total-count"))!==null&&s!==void 0?s:0,m=(u=(d=j.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&u!==void 0?u:[];return m.length>0&&(m.forEach(x=>{const p=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(x.split(";")[1].split("=")[1]);b[`${c}Page`]=p}),b.total=parseInt(S)),{data:Object.assign(Object.assign({},w),b),error:null}}catch(b){if(Ye(b))return{data:{clients:[]},error:b};throw b}}async _createOAuthClient(i){try{return await rt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:i,headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Ye(o))return{data:null,error:o};throw o}}async _getOAuthClient(i){try{return await rt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Ye(o))return{data:null,error:o};throw o}}async _updateOAuthClient(i,o){try{return await rt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${i}`,{body:o,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(i){try{return await rt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(o){if(Ye(o))return{data:null,error:o};throw o}}async _regenerateOAuthClientSecret(i){try{return await rt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${i}/regenerate_secret`,{headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Ye(o))return{data:null,error:o};throw o}}}function Bl(t={}){return{getItem:i=>t[i]||null,setItem:(i,o)=>{t[i]=o},removeItem:i=>{delete t[i]}}}const Yo={debug:!!(globalThis&&Yd()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Qd extends Error{constructor(i){super(i),this.isAcquireTimeout=!0}}class Il extends Qd{}async function Yg(t,i,o){Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,i);const n=new globalThis.AbortController;i>0&&setTimeout(()=>{n.abort(),Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},i),await Promise.resolve();try{return await globalThis.navigator.locks.request(t,i===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async a=>{if(a){Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await o()}finally{Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(i===0)throw Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Il(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Yo.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await o()}})}catch(a){throw(a==null?void 0:a.name)==="AbortError"?new Il(`Acquiring an exclusive Navigator LockManager lock "${t}" timed out waiting ${i}ms`):a}}function Xg(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Zd(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Qg(t){return parseInt(t,16)}function Zg(t){const i=new TextEncoder().encode(t);return"0x"+Array.from(i,n=>n.toString(16).padStart(2,"0")).join("")}function eu(t){var i;const{chainId:o,domain:n,expirationTime:a,issuedAt:r=new Date,nonce:s,notBefore:d,requestId:u,resources:b,scheme:j,uri:w,version:S}=t;{if(!Number.isInteger(o))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${o}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(s&&s.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${s}`);if(!w)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(S!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${S}`);if(!((i=t.statement)===null||i===void 0)&&i.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const m=Zd(t.address),x=j?`${j}://${n}`:n,p=t.statement?`${t.statement}
`:"",c=`${x} wants you to sign in with your Ethereum account:
${m}

${p}`;let g=`URI: ${w}
Version: ${S}
Chain ID: ${o}${s?`
Nonce: ${s}`:""}
Issued At: ${r.toISOString()}`;if(a&&(g+=`
Expiration Time: ${a.toISOString()}`),d&&(g+=`
Not Before: ${d.toISOString()}`),u&&(g+=`
Request ID: ${u}`),b){let l=`
Resources:`;for(const f of b){if(!f||typeof f!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${f}`);l+=`
- ${f}`}g+=l}return`${c}
${g}`}class Pt extends Error{constructor({message:i,code:o,cause:n,name:a}){var r;super(i,{cause:n}),this.__isWebAuthnError=!0,this.name=(r=a??(n instanceof Error?n.name:void 0))!==null&&r!==void 0?r:"Unknown Error",this.code=o}}class ga extends Pt{constructor(i,o){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o,message:i}),this.name="WebAuthnUnknownError",this.originalError=o}}function tu({error:t,options:i}){var o,n,a;const{publicKey:r}=i;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Pt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((o=r.authenticatorSelection)===null||o===void 0?void 0:o.requireResidentKey)===!0)return new Pt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(i.mediation==="conditional"&&((n=r.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Pt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=r.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new Pt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Pt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Pt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return r.pubKeyCredParams.filter(d=>d.type==="public-key").length===0?new Pt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Pt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(ec(s)){if(r.rp.id!==s)return new Pt({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Pt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new Pt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Pt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Pt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function iu({error:t,options:i}){const{publicKey:o}=i;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Pt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Pt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const n=window.location.hostname;if(ec(n)){if(o.rpId!==n)return new Pt({message:`The RP ID "${o.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Pt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Pt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Pt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class ou{createNewAbortSignal(){if(this.controller){const o=new Error("Cancelling existing WebAuthn API call for new one");o.name="AbortError",this.controller.abort(o)}const i=new AbortController;return this.controller=i,i.signal}cancelCeremony(){if(this.controller){const i=new Error("Manually cancelling existing WebAuthn API call");i.name="AbortError",this.controller.abort(i),this.controller=void 0}}}const nu=new ou;function ru(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:i,user:o,excludeCredentials:n}=t,a=Ta(t,["challenge","user","excludeCredentials"]),r=vn(i).buffer,s=Object.assign(Object.assign({},o),{id:vn(o.id).buffer}),d=Object.assign(Object.assign({},a),{challenge:r,user:s});if(n&&n.length>0){d.excludeCredentials=new Array(n.length);for(let u=0;u<n.length;u++){const b=n[u];d.excludeCredentials[u]=Object.assign(Object.assign({},b),{id:vn(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return d}function au(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:i,allowCredentials:o}=t,n=Ta(t,["challenge","allowCredentials"]),a=vn(i).buffer,r=Object.assign(Object.assign({},n),{challenge:a});if(o&&o.length>0){r.allowCredentials=new Array(o.length);for(let s=0;s<o.length;s++){const d=o[s];r.allowCredentials[s]=Object.assign(Object.assign({},d),{id:vn(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return r}function su(t){var i;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const o=t;return{id:t.id,rawId:t.id,response:{attestationObject:Po(new Uint8Array(t.response.attestationObject)),clientDataJSON:Po(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(i=o.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function lu(t){var i;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const o=t,n=t.getClientExtensionResults(),a=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Po(new Uint8Array(a.authenticatorData)),clientDataJSON:Po(new Uint8Array(a.clientDataJSON)),signature:Po(new Uint8Array(a.signature)),userHandle:a.userHandle?Po(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(i=o.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function ec(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Rl(){var t,i;return!!(Jt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((i=navigator==null?void 0:navigator.credentials)===null||i===void 0?void 0:i.get)=="function")}async function du(t){try{const i=await navigator.credentials.create(t);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new ga("Browser returned unexpected credential type",i)}:{data:null,error:new ga("Empty credential response",i)}}catch(i){return{data:null,error:tu({error:i,options:t})}}}async function cu(t){try{const i=await navigator.credentials.get(t);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new ga("Browser returned unexpected credential type",i)}:{data:null,error:new ga("Empty credential response",i)}}catch(i){return{data:null,error:iu({error:i,options:t})}}}const pu={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},gu={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ua(...t){const i=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),o=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),n={};for(const a of t)if(a)for(const r in a){const s=a[r];if(s!==void 0)if(Array.isArray(s))n[r]=s;else if(o(s))n[r]=s;else if(i(s)){const d=n[r];i(d)?n[r]=ua(d,s):n[r]=ua(s)}else n[r]=s}return n}function uu(t,i){return ua(pu,t,i||{})}function hu(t,i){return ua(gu,t,i||{})}class fu{constructor(i){this.client=i,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(i){return this.client.mfa.enroll(Object.assign(Object.assign({},i),{factorType:"webauthn"}))}async _challenge({factorId:i,webauthn:o,friendlyName:n,signal:a},r){var s;try{const{data:d,error:u}=await this.client.mfa.challenge({factorId:i,webauthn:o});if(!d)return{data:null,error:u};const b=a??nu.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:j}=d.webauthn.credential_options.publicKey;if(!j.name){const w=n;if(w)j.name=`${j.id}:${w}`;else{const m=(await this.client.getUser()).data.user,x=((s=m==null?void 0:m.user_metadata)===null||s===void 0?void 0:s.name)||(m==null?void 0:m.email)||(m==null?void 0:m.id)||"User";j.name=`${j.id}:${x}`}}j.displayName||(j.displayName=j.name)}switch(d.webauthn.type){case"create":{const j=uu(d.webauthn.credential_options.publicKey,r==null?void 0:r.create),{data:w,error:S}=await du({publicKey:j,signal:b});return w?{data:{factorId:i,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:w}},error:null}:{data:null,error:S}}case"request":{const j=hu(d.webauthn.credential_options.publicKey,r==null?void 0:r.request),{data:w,error:S}=await cu(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:j,signal:b}));return w?{data:{factorId:i,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:w}},error:null}:{data:null,error:S}}}}catch(d){return Ye(d)?{data:null,error:d}:{data:null,error:new $o("Unexpected error in challenge",d)}}}async _verify({challengeId:i,factorId:o,webauthn:n}){return this.client.mfa.verify({factorId:o,challengeId:i,webauthn:n})}async _authenticate({factorId:i,webauthn:{rpId:o=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},r){if(!o)return{data:null,error:new dr("rpId is required for WebAuthn authentication")};try{if(!Rl())return{data:null,error:new $o("Browser does not support WebAuthn",null)};const{data:s,error:d}=await this.challenge({factorId:i,webauthn:{rpId:o,rpOrigins:n},signal:a},{request:r});if(!s)return{data:null,error:d};const{webauthn:u}=s;return this._verify({factorId:i,challengeId:s.challengeId,webauthn:{type:u.type,rpId:o,rpOrigins:n,credential_response:u.credential_response}})}catch(s){return Ye(s)?{data:null,error:s}:{data:null,error:new $o("Unexpected error in authenticate",s)}}}async _register({friendlyName:i,webauthn:{rpId:o=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},r){if(!o)return{data:null,error:new dr("rpId is required for WebAuthn registration")};try{if(!Rl())return{data:null,error:new $o("Browser does not support WebAuthn",null)};const{data:s,error:d}=await this._enroll({friendlyName:i});if(!s)return await this.client.mfa.listFactors().then(j=>{var w;return(w=j.data)===null||w===void 0?void 0:w.all.find(S=>S.factor_type==="webauthn"&&S.friendly_name===i&&S.status!=="unverified")}).then(j=>j?this.client.mfa.unenroll({factorId:j==null?void 0:j.id}):void 0),{data:null,error:d};const{data:u,error:b}=await this._challenge({factorId:s.id,friendlyName:s.friendly_name,webauthn:{rpId:o,rpOrigins:n},signal:a},{create:r});return u?this._verify({factorId:s.id,challengeId:u.challengeId,webauthn:{rpId:o,rpOrigins:n,type:u.webauthn.type,credential_response:u.webauthn.credential_response}}):{data:null,error:b}}catch(s){return Ye(s)?{data:null,error:s}:{data:null,error:new $o("Unexpected error in register",s)}}}}Xg();const xu={url:ug,storageKey:hg,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:fg,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function Ml(t,i,o){return await o()}const Xo={};class cr{get jwks(){var i,o;return(o=(i=Xo[this.storageKey])===null||i===void 0?void 0:i.jwks)!==null&&o!==void 0?o:{keys:[]}}set jwks(i){Xo[this.storageKey]=Object.assign(Object.assign({},Xo[this.storageKey]),{jwks:i})}get jwks_cached_at(){var i,o;return(o=(i=Xo[this.storageKey])===null||i===void 0?void 0:i.cachedAt)!==null&&o!==void 0?o:Number.MIN_SAFE_INTEGER}set jwks_cached_at(i){Xo[this.storageKey]=Object.assign(Object.assign({},Xo[this.storageKey]),{cachedAt:i})}constructor(i){var o,n,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const r=Object.assign(Object.assign({},xu),i);if(this.storageKey=r.storageKey,this.instanceID=(o=cr.nextInstanceID[this.storageKey])!==null&&o!==void 0?o:0,cr.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.instanceID>0&&Jt()){const s=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(s),this.logDebugMessages&&console.trace(s)}if(this.persistSession=r.persistSession,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Jg({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Xd(r.fetch),this.lock=r.lock||Ml,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,this.throwOnError=r.throwOnError,this.lockAcquireTimeout=r.lockAcquireTimeout,r.lock?this.lock=r.lock:this.persistSession&&Jt()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=Yg:this.lock=Ml,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new fu(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:Yd()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Bl(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Bl(this.memoryStorage)),Jt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s);try{await this._notifyAllSubscribers(s.data.event,s.data.session,!1)}catch(d){this._debug("#broadcastChannel","error",d)}})}r.skipAutoInitialize||this.initialize().catch(s=>{this._debug("#initialize()","error",s)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(i){if(this.throwOnError&&i&&i.error)throw i.error;return i}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Gd}) ${new Date().toISOString()}`}_debug(...i){return this.logDebugMessages&&this.logger(this._logPrefix(),...i),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var i;try{let o={},n="none";if(Jt()&&(o=Fg(window.location.href),this._isImplicitGrantCallback(o)?n="implicit":await this._isPKCECallback(o)&&(n="pkce")),Jt()&&this.detectSessionInUrl&&n!=="none"){const{data:a,error:r}=await this._getSessionFromURL(o,n);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),vg(r)){const u=(i=r.details)===null||i===void 0?void 0:i.code;if(u==="identity_already_exists"||u==="identity_not_found"||u==="single_identity_not_deletable")return{error:r}}return{error:r}}const{session:s,redirectType:d}=a;return this._debug("#_initialize()","detected session in URL",s,"redirect type",d),await this._saveSession(s),setTimeout(async()=>{d==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(o){return Ye(o)?this._returnResult({error:o}):this._returnResult({error:new $o("Unexpected error during initialization",o)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(i){var o,n,a;try{const r=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(o=i==null?void 0:i.options)===null||o===void 0?void 0:o.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(a=i==null?void 0:i.options)===null||a===void 0?void 0:a.captchaToken}},xform:Si}),{data:s,error:d}=r;if(d||!s)return this._returnResult({data:{user:null,session:null},error:d});const u=s.session,b=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",u)),this._returnResult({data:{user:b,session:u},error:null})}catch(r){if(Ye(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signUp(i){var o,n,a;try{let r;if("email"in i){const{email:j,password:w,options:S}=i;let m=null,x=null;this.flowType==="pkce"&&([m,x]=await Ko(this.storage,this.storageKey)),r=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:S==null?void 0:S.emailRedirectTo,body:{email:j,password:w,data:(o=S==null?void 0:S.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:S==null?void 0:S.captchaToken},code_challenge:m,code_challenge_method:x},xform:Si})}else if("phone"in i){const{phone:j,password:w,options:S}=i;r=await rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:j,password:w,data:(n=S==null?void 0:S.data)!==null&&n!==void 0?n:{},channel:(a=S==null?void 0:S.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:S==null?void 0:S.captchaToken}},xform:Si})}else throw new Fr("You must provide either an email or phone number and a password");const{data:s,error:d}=r;if(d||!s)return await Kt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:d});const u=s.session,b=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",u)),this._returnResult({data:{user:b,session:u},error:null})}catch(r){if(await Kt(this.storage,`${this.storageKey}-code-verifier`),Ye(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithPassword(i){try{let o;if("email"in i){const{email:r,password:s,options:d}=i;o=await rt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:Fl})}else if("phone"in i){const{phone:r,password:s,options:d}=i;o=await rt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:Fl})}else throw new Fr("You must provide either an email or phone number and a password");const{data:n,error:a}=o;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!n||!n.session||!n.user){const r=new Go;return this._returnResult({data:{user:null,session:null},error:r})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:a})}catch(o){if(Ye(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithOAuth(i){var o,n,a,r;return await this._handleProviderSignIn(i.provider,{redirectTo:(o=i.options)===null||o===void 0?void 0:o.redirectTo,scopes:(n=i.options)===null||n===void 0?void 0:n.scopes,queryParams:(a=i.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(r=i.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(i){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(i))}async signInWithWeb3(i){const{chain:o}=i;switch(o){case"ethereum":return await this.signInWithEthereum(i);case"solana":return await this.signInWithSolana(i);default:throw new Error(`@supabase/auth-js: Unsupported chain "${o}"`)}}async signInWithEthereum(i){var o,n,a,r,s,d,u,b,j,w,S;let m,x;if("message"in i)m=i.message,x=i.signature;else{const{chain:p,wallet:c,statement:g,options:l}=i;let f;if(Jt())if(typeof c=="object")f=c;else{const k=window;if("ethereum"in k&&typeof k.ethereum=="object"&&"request"in k.ethereum&&typeof k.ethereum.request=="function")f=k.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof c!="object"||!(l!=null&&l.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");f=c}const y=new URL((o=l==null?void 0:l.url)!==null&&o!==void 0?o:window.location.href),h=await f.request({method:"eth_requestAccounts"}).then(k=>k).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!h||h.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const v=Zd(h[0]);let A=(n=l==null?void 0:l.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!A){const k=await f.request({method:"eth_chainId"});A=Qg(k)}const z={domain:y.host,address:v,statement:g,uri:y.href,version:"1",chainId:A,nonce:(a=l==null?void 0:l.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(s=(r=l==null?void 0:l.signInWithEthereum)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date,expirationTime:(d=l==null?void 0:l.signInWithEthereum)===null||d===void 0?void 0:d.expirationTime,notBefore:(u=l==null?void 0:l.signInWithEthereum)===null||u===void 0?void 0:u.notBefore,requestId:(b=l==null?void 0:l.signInWithEthereum)===null||b===void 0?void 0:b.requestId,resources:(j=l==null?void 0:l.signInWithEthereum)===null||j===void 0?void 0:j.resources};m=eu(z),x=await f.request({method:"personal_sign",params:[Zg(m),v]})}try{const{data:p,error:c}=await rt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:x},!((w=i.options)===null||w===void 0)&&w.captchaToken?{gotrue_meta_security:{captcha_token:(S=i.options)===null||S===void 0?void 0:S.captchaToken}}:null),xform:Si});if(c)throw c;if(!p||!p.session||!p.user){const g=new Go;return this._returnResult({data:{user:null,session:null},error:g})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:c})}catch(p){if(Ye(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(i){var o,n,a,r,s,d,u,b,j,w,S,m;let x,p;if("message"in i)x=i.message,p=i.signature;else{const{chain:c,wallet:g,statement:l,options:f}=i;let y;if(Jt())if(typeof g=="object")y=g;else{const v=window;if("solana"in v&&typeof v.solana=="object"&&("signIn"in v.solana&&typeof v.solana.signIn=="function"||"signMessage"in v.solana&&typeof v.solana.signMessage=="function"))y=v.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(f!=null&&f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=g}const h=new URL((o=f==null?void 0:f.url)!==null&&o!==void 0?o:window.location.href);if("signIn"in y&&y.signIn){const v=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},f==null?void 0:f.signInWithSolana),{version:"1",domain:h.host,uri:h.href}),l?{statement:l}:null));let A;if(Array.isArray(v)&&v[0]&&typeof v[0]=="object")A=v[0];else if(v&&typeof v=="object"&&"signedMessage"in v&&"signature"in v)A=v;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)x=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),p=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in y)||typeof y.signMessage!="function"||!("publicKey"in y)||typeof y!="object"||!y.publicKey||!("toBase58"in y.publicKey)||typeof y.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${h.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...l?["",l,""]:[""],"Version: 1",`URI: ${h.href}`,`Issued At: ${(a=(n=f==null?void 0:f.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((r=f==null?void 0:f.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${f.signInWithSolana.notBefore}`]:[],...!((s=f==null?void 0:f.signInWithSolana)===null||s===void 0)&&s.expirationTime?[`Expiration Time: ${f.signInWithSolana.expirationTime}`]:[],...!((d=f==null?void 0:f.signInWithSolana)===null||d===void 0)&&d.chainId?[`Chain ID: ${f.signInWithSolana.chainId}`]:[],...!((u=f==null?void 0:f.signInWithSolana)===null||u===void 0)&&u.nonce?[`Nonce: ${f.signInWithSolana.nonce}`]:[],...!((b=f==null?void 0:f.signInWithSolana)===null||b===void 0)&&b.requestId?[`Request ID: ${f.signInWithSolana.requestId}`]:[],...!((w=(j=f==null?void 0:f.signInWithSolana)===null||j===void 0?void 0:j.resources)===null||w===void 0)&&w.length?["Resources",...f.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const v=await y.signMessage(new TextEncoder().encode(x),"utf8");if(!v||!(v instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=v}}try{const{data:c,error:g}=await rt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:Po(p)},!((S=i.options)===null||S===void 0)&&S.captchaToken?{gotrue_meta_security:{captcha_token:(m=i.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Si});if(g)throw g;if(!c||!c.session||!c.user){const l=new Go;return this._returnResult({data:{user:null,session:null},error:l})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:Object.assign({},c),error:g})}catch(c){if(Ye(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async _exchangeCodeForSession(i){const o=await Fo(this.storage,`${this.storageKey}-code-verifier`),[n,a]=(o??"").split("/");try{if(!n&&this.flowType==="pkce")throw new jg;const{data:r,error:s}=await rt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:i,code_verifier:n},xform:Si});if(await Kt(this.storage,`${this.storageKey}-code-verifier`),s)throw s;if(!r||!r.session||!r.user){const d=new Go;return this._returnResult({data:{user:null,session:null,redirectType:null},error:d})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign(Object.assign({},r),{redirectType:a??null}),error:s})}catch(r){if(await Kt(this.storage,`${this.storageKey}-code-verifier`),Ye(r))return this._returnResult({data:{user:null,session:null,redirectType:null},error:r});throw r}}async signInWithIdToken(i){try{const{options:o,provider:n,token:a,access_token:r,nonce:s}=i,d=await rt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:a,access_token:r,nonce:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Si}),{data:u,error:b}=d;if(b)return this._returnResult({data:{user:null,session:null},error:b});if(!u||!u.session||!u.user){const j=new Go;return this._returnResult({data:{user:null,session:null},error:j})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:u,error:b})}catch(o){if(Ye(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithOtp(i){var o,n,a,r,s;try{if("email"in i){const{email:d,options:u}=i;let b=null,j=null;this.flowType==="pkce"&&([b,j]=await Ko(this.storage,this.storageKey));const{error:w}=await rt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:(o=u==null?void 0:u.data)!==null&&o!==void 0?o:{},create_user:(n=u==null?void 0:u.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:b,code_challenge_method:j},redirectTo:u==null?void 0:u.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:w})}if("phone"in i){const{phone:d,options:u}=i,{data:b,error:j}=await rt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:d,data:(a=u==null?void 0:u.data)!==null&&a!==void 0?a:{},create_user:(r=u==null?void 0:u.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},channel:(s=u==null?void 0:u.channel)!==null&&s!==void 0?s:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:b==null?void 0:b.message_id},error:j})}throw new Fr("You must provide either an email or phone number.")}catch(d){if(await Kt(this.storage,`${this.storageKey}-code-verifier`),Ye(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async verifyOtp(i){var o,n;try{let a,r;"options"in i&&(a=(o=i.options)===null||o===void 0?void 0:o.redirectTo,r=(n=i.options)===null||n===void 0?void 0:n.captchaToken);const{data:s,error:d}=await rt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},i),{gotrue_meta_security:{captcha_token:r}}),redirectTo:a,xform:Si});if(d)throw d;if(!s)throw new Error("An error occurred on token verification.");const u=s.session,b=s.user;return u!=null&&u.access_token&&(await this._saveSession(u),await this._notifyAllSubscribers(i.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",u)),this._returnResult({data:{user:b,session:u},error:null})}catch(a){if(Ye(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(i){var o,n,a,r,s;try{let d=null,u=null;this.flowType==="pkce"&&([d,u]=await Ko(this.storage,this.storageKey));const b=await rt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in i?{provider_id:i.providerId}:null),"domain"in i?{domain:i.domain}:null),{redirect_to:(n=(o=i.options)===null||o===void 0?void 0:o.redirectTo)!==null&&n!==void 0?n:void 0}),!((a=i==null?void 0:i.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:i.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:d,code_challenge_method:u}),headers:this.headers,xform:Hg});return!((r=b.data)===null||r===void 0)&&r.url&&Jt()&&!(!((s=i.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(b.data.url),this._returnResult(b)}catch(d){if(await Kt(this.storage,`${this.storageKey}-code-verifier`),Ye(d))return this._returnResult({data:null,error:d});throw d}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async i=>{const{data:{session:o},error:n}=i;if(n)throw n;if(!o)throw new ci;const{error:a}=await rt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:o.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(i){if(Ye(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async resend(i){try{const o=`${this.url}/resend`;if("email"in i){const{email:n,type:a,options:r}=i,{error:s}=await rt(this.fetch,"POST",o,{headers:this.headers,body:{email:n,type:a,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:s})}else if("phone"in i){const{phone:n,type:a,options:r}=i,{data:s,error:d}=await rt(this.fetch,"POST",o,{headers:this.headers,body:{phone:n,type:a,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:s==null?void 0:s.message_id},error:d})}throw new Fr("You must provide either an email or phone number and a type")}catch(o){if(Ye(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async o=>o))}async _acquireLock(i,o){this._debug("#_acquireLock","begin",i);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await n,await o()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,i,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=o();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(i){this._debug("#_useSession","begin");try{const o=await this.__loadSession();return await i(o)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let i=null;const o=await Fo(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",o),o!==null&&(this._isValidSession(o)?i=o:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!i)return{data:{session:null},error:null};const n=i.expires_at?i.expires_at*1e3-Date.now()<Oa:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",i.expires_at),!n){if(this.userStorage){const s=await Fo(this.userStorage,this.storageKey+"-user");s!=null&&s.user?i.user=s.user:i.user=Na()}if(this.storage.isServer&&i.user&&!i.user.__isUserNotAvailableProxy){const s={value:this.suppressGetSessionWarning};i.user=Ng(i.user,s),s.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:i},error:null}}const{data:a,error:r}=await this._callRefreshToken(i.refresh_token);return r?this._returnResult({data:{session:null},error:r}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(i){if(i)return await this._getUser(i);await this.initializePromise;const o=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return o.data.user&&(this.suppressGetSessionWarning=!0),o}async _getUser(i){try{return i?await rt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:i,xform:yo}):await this._useSession(async o=>{var n,a,r;const{data:s,error:d}=o;if(d)throw d;return!(!((n=s.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ci}:await rt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(a=s.session)===null||a===void 0?void 0:a.access_token)!==null&&r!==void 0?r:void 0,xform:yo})})}catch(o){if(Ye(o))return La(o)&&(await this._removeSession(),await Kt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:o});throw o}}async updateUser(i,o={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(i,o))}async _updateUser(i,o={}){try{return await this._useSession(async n=>{const{data:a,error:r}=n;if(r)throw r;if(!a.session)throw new ci;const s=a.session;let d=null,u=null;this.flowType==="pkce"&&i.email!=null&&([d,u]=await Ko(this.storage,this.storageKey));const{data:b,error:j}=await rt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:o==null?void 0:o.emailRedirectTo,body:Object.assign(Object.assign({},i),{code_challenge:d,code_challenge_method:u}),jwt:s.access_token,xform:yo});if(j)throw j;return s.user=b.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),this._returnResult({data:{user:s.user},error:null})})}catch(n){if(await Kt(this.storage,`${this.storageKey}-code-verifier`),Ye(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(i){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(i))}async _setSession(i){try{if(!i.access_token||!i.refresh_token)throw new ci;const o=Date.now()/1e3;let n=o,a=!0,r=null;const{payload:s}=Br(i.access_token);if(s.exp&&(n=s.exp,a=n<=o),a){const{data:d,error:u}=await this._callRefreshToken(i.refresh_token);if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!d)return{data:{user:null,session:null},error:null};r=d}else{const{data:d,error:u}=await this._getUser(i.access_token);if(u)return this._returnResult({data:{user:null,session:null},error:u});r={access_token:i.access_token,refresh_token:i.refresh_token,user:d.user,token_type:"bearer",expires_in:n-o,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return this._returnResult({data:{user:r.user,session:r},error:null})}catch(o){if(Ye(o))return this._returnResult({data:{session:null,user:null},error:o});throw o}}async refreshSession(i){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(i))}async _refreshSession(i){try{return await this._useSession(async o=>{var n;if(!i){const{data:s,error:d}=o;if(d)throw d;i=(n=s.session)!==null&&n!==void 0?n:void 0}if(!(i!=null&&i.refresh_token))throw new ci;const{data:a,error:r}=await this._callRefreshToken(i.refresh_token);return r?this._returnResult({data:{user:null,session:null},error:r}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(o){if(Ye(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async _getSessionFromURL(i,o){try{if(!Jt())throw new Tr("No browser detected.");if(i.error||i.error_description||i.error_code)throw new Tr(i.error_description||"Error in URL with unspecified error_description",{error:i.error||"unspecified_error",code:i.error_code||"unspecified_code"});switch(o){case"implicit":if(this.flowType==="pkce")throw new Sl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Tr("Not a valid implicit grant flow url.");break;default:}if(o==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!i.code)throw new Sl("No code detected.");const{data:l,error:f}=await this._exchangeCodeForSession(i.code);if(f)throw f;const y=new URL(window.location.href);return y.searchParams.delete("code"),window.history.replaceState(window.history.state,"",y.toString()),{data:{session:l.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:a,access_token:r,refresh_token:s,expires_in:d,expires_at:u,token_type:b}=i;if(!r||!d||!s||!b)throw new Tr("No session defined in URL");const j=Math.round(Date.now()/1e3),w=parseInt(d);let S=j+w;u&&(S=parseInt(u));const m=S-j;m*1e3<=cn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${w}s`);const x=S-w;j-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,S,j):j-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,S,j);const{data:p,error:c}=await this._getUser(r);if(c)throw c;const g={provider_token:n,provider_refresh_token:a,access_token:r,expires_in:w,expires_at:S,refresh_token:s,token_type:b,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:i.type},error:null})}catch(n){if(Ye(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(i){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),i):!!(i.access_token||i.error_description)}async _isPKCECallback(i){const o=await Fo(this.storage,`${this.storageKey}-code-verifier`);return!!(i.code&&o)}async signOut(i={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(i))}async _signOut({scope:i}={scope:"global"}){return await this._useSession(async o=>{var n;const{data:a,error:r}=o;if(r&&!La(r))return this._returnResult({error:r});const s=(n=a.session)===null||n===void 0?void 0:n.access_token;if(s){const{error:d}=await this.admin.signOut(s,i);if(d&&!(yg(d)&&(d.status===404||d.status===401||d.status===403)||La(d)))return this._returnResult({error:d})}return i!=="others"&&(await this._removeSession(),await Kt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(i){const o=Ag(),n={id:o,callback:i,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",o),this.stateChangeEmitters.delete(o)}};return this._debug("#onAuthStateChange()","registered callback with id",o),this.stateChangeEmitters.set(o,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(o)})))(),{data:{subscription:n}}}async _emitInitialSession(i){return await this._useSession(async o=>{var n,a;try{const{data:{session:r},error:s}=o;if(s)throw s;await((n=this.stateChangeEmitters.get(i))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",i,"session",r)}catch(r){await((a=this.stateChangeEmitters.get(i))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",i,"error",r),console.error(r)}})}async resetPasswordForEmail(i,o={}){let n=null,a=null;this.flowType==="pkce"&&([n,a]=await Ko(this.storage,this.storageKey,!0));try{return await rt(this.fetch,"POST",`${this.url}/recover`,{body:{email:i,code_challenge:n,code_challenge_method:a,gotrue_meta_security:{captcha_token:o.captchaToken}},headers:this.headers,redirectTo:o.redirectTo})}catch(r){if(await Kt(this.storage,`${this.storageKey}-code-verifier`),Ye(r))return this._returnResult({data:null,error:r});throw r}}async getUserIdentities(){var i;try{const{data:o,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(i=o.user.identities)!==null&&i!==void 0?i:[]},error:null})}catch(o){if(Ye(o))return this._returnResult({data:null,error:o});throw o}}async linkIdentity(i){return"token"in i?this.linkIdentityIdToken(i):this.linkIdentityOAuth(i)}async linkIdentityOAuth(i){var o;try{const{data:n,error:a}=await this._useSession(async r=>{var s,d,u,b,j;const{data:w,error:S}=r;if(S)throw S;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,i.provider,{redirectTo:(s=i.options)===null||s===void 0?void 0:s.redirectTo,scopes:(d=i.options)===null||d===void 0?void 0:d.scopes,queryParams:(u=i.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:!0});return await rt(this.fetch,"GET",m,{headers:this.headers,jwt:(j=(b=w.session)===null||b===void 0?void 0:b.access_token)!==null&&j!==void 0?j:void 0})});if(a)throw a;return Jt()&&!(!((o=i.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:i.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(Ye(n))return this._returnResult({data:{provider:i.provider,url:null},error:n});throw n}}async linkIdentityIdToken(i){return await this._useSession(async o=>{var n;try{const{error:a,data:{session:r}}=o;if(a)throw a;const{options:s,provider:d,token:u,access_token:b,nonce:j}=i,w=await rt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=r==null?void 0:r.access_token)!==null&&n!==void 0?n:void 0,body:{provider:d,id_token:u,access_token:b,nonce:j,link_identity:!0,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Si}),{data:S,error:m}=w;return m?this._returnResult({data:{user:null,session:null},error:m}):!S||!S.session||!S.user?this._returnResult({data:{user:null,session:null},error:new Go}):(S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("USER_UPDATED",S.session)),this._returnResult({data:S,error:m}))}catch(a){if(await Kt(this.storage,`${this.storageKey}-code-verifier`),Ye(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(i){try{return await this._useSession(async o=>{var n,a;const{data:r,error:s}=o;if(s)throw s;return await rt(this.fetch,"DELETE",`${this.url}/user/identities/${i.identity_id}`,{headers:this.headers,jwt:(a=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0})})}catch(o){if(Ye(o))return this._returnResult({data:null,error:o});throw o}}async _refreshAccessToken(i){const o=`#_refreshAccessToken(${i.substring(0,5)}...)`;this._debug(o,"begin");try{const n=Date.now();return await Ig(async a=>(a>0&&await Bg(200*Math.pow(2,a-1)),this._debug(o,"refreshing attempt",a),await rt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:i},headers:this.headers,xform:Si})),(a,r)=>{const s=200*Math.pow(2,a);return r&&Wa(r)&&Date.now()+s-n<cn})}catch(n){if(this._debug(o,"error",n),Ye(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(o,"end")}}_isValidSession(i){return typeof i=="object"&&i!==null&&"access_token"in i&&"refresh_token"in i&&"expires_at"in i}async _handleProviderSignIn(i,o){const n=await this._getUrlForProvider(`${this.url}/authorize`,i,{redirectTo:o.redirectTo,scopes:o.scopes,queryParams:o.queryParams});return this._debug("#_handleProviderSignIn()","provider",i,"options",o,"url",n),Jt()&&!o.skipBrowserRedirect&&window.location.assign(n),{data:{provider:i,url:n},error:null}}async _recoverAndRefresh(){var i,o;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const a=await Fo(this.storage,this.storageKey);if(a&&this.userStorage){let s=await Fo(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!s&&(s={user:a.user},await pn(this.userStorage,this.storageKey+"-user",s)),a.user=(i=s==null?void 0:s.user)!==null&&i!==void 0?i:Na()}else if(a&&!a.user&&!a.user){const s=await Fo(this.storage,this.storageKey+"-user");s&&(s!=null&&s.user)?(a.user=s.user,await Kt(this.storage,this.storageKey+"-user"),await pn(this.storage,this.storageKey,a)):a.user=Na()}if(this._debug(n,"session from storage",a),!this._isValidSession(a)){this._debug(n,"session is not valid"),a!==null&&await this._removeSession();return}const r=((o=a.expires_at)!==null&&o!==void 0?o:1/0)*1e3-Date.now()<Oa;if(this._debug(n,`session has${r?"":" not"} expired with margin of ${Oa}s`),r){if(this.autoRefreshToken&&a.refresh_token){const{error:s}=await this._callRefreshToken(a.refresh_token);s&&(console.error(s),Wa(s)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",s),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:s,error:d}=await this._getUser(a.access_token);!d&&(s!=null&&s.user)?(a.user=s.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(s){console.error("Error getting user data:",s),this._debug(n,"error getting user data, skipping SIGNED_IN notification",s)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(n,"error",a),console.error(a);return}finally{this._debug(n,"end")}}async _callRefreshToken(i){var o,n;if(!i)throw new ci;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${i.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Ra;const{data:r,error:s}=await this._refreshAccessToken(i);if(s)throw s;if(!r.session)throw new ci;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const d={data:r.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(r){if(this._debug(a,"error",r),Ye(r)){const s={data:null,error:r};return Wa(r)||await this._removeSession(),(o=this.refreshingDeferred)===null||o===void 0||o.resolve(s),s}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(i,o,n=!0){const a=`#_notifyAllSubscribers(${i})`;this._debug(a,"begin",o,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:i,session:o});const r=[],s=Array.from(this.stateChangeEmitters.values()).map(async d=>{try{await d.callback(i,o)}catch(u){r.push(u)}});if(await Promise.all(s),r.length>0){for(let d=0;d<r.length;d+=1)console.error(r[d]);throw r[0]}}finally{this._debug(a,"end")}}async _saveSession(i){this._debug("#_saveSession()",i),this.suppressGetSessionWarning=!0,await Kt(this.storage,`${this.storageKey}-code-verifier`);const o=Object.assign({},i),n=o.user&&o.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&o.user&&await pn(this.userStorage,this.storageKey+"-user",{user:o.user});const a=Object.assign({},o);delete a.user;const r=El(a);await pn(this.storage,this.storageKey,r)}else{const a=El(o);await pn(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Kt(this.storage,this.storageKey),await Kt(this.storage,this.storageKey+"-code-verifier"),await Kt(this.storage,this.storageKey+"-user"),this.userStorage&&await Kt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const i=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{i&&Jt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",i)}catch(o){console.error("removing visibilitychange callback failed",o)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const i=setInterval(()=>this._autoRefreshTokenTick(),cn);this.autoRefreshTicker=i,i&&typeof i=="object"&&typeof i.unref=="function"?i.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(i);const o=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=o,o&&typeof o=="object"&&typeof o.unref=="function"?o.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(o)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const i=this.autoRefreshTicker;this.autoRefreshTicker=null,i&&clearInterval(i);const o=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,o&&clearTimeout(o)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const i=Date.now();try{return await this._useSession(async o=>{const{data:{session:n}}=o;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((n.expires_at*1e3-i)/cn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${cn}ms, refresh threshold is ${Ms} ticks`),a<=Ms&&await this._callRefreshToken(n.refresh_token)})}catch(o){console.error("Auto refresh tick failed with error. This is likely a transient error.",o)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(i){if(i.isAcquireTimeout||i instanceof Qd)this._debug("auto refresh token tick lock not available");else throw i}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Jt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(i){this._debug("#visibilityChangedCallback","error",i)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(i){console.error("_handleVisibilityChange",i)}}async _onVisibilityChanged(i){const o=`#_onVisibilityChanged(${i})`;this._debug(o,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),i||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(o,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(i,o,n){const a=[`provider=${encodeURIComponent(o)}`];if(n!=null&&n.redirectTo&&a.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&a.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[r,s]=await Ko(this.storage,this.storageKey),d=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(s)}`});a.push(d.toString())}if(n!=null&&n.queryParams){const r=new URLSearchParams(n.queryParams);a.push(r.toString())}return n!=null&&n.skipBrowserRedirect&&a.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${i}?${a.join("&")}`}async _unenroll(i){try{return await this._useSession(async o=>{var n;const{data:a,error:r}=o;return r?this._returnResult({data:null,error:r}):await rt(this.fetch,"DELETE",`${this.url}/factors/${i.factorId}`,{headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(o){if(Ye(o))return this._returnResult({data:null,error:o});throw o}}async _enroll(i){try{return await this._useSession(async o=>{var n,a;const{data:r,error:s}=o;if(s)return this._returnResult({data:null,error:s});const d=Object.assign({friendly_name:i.friendlyName,factor_type:i.factorType},i.factorType==="phone"?{phone:i.phone}:i.factorType==="totp"?{issuer:i.issuer}:{}),{data:u,error:b}=await rt(this.fetch,"POST",`${this.url}/factors`,{body:d,headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return b?this._returnResult({data:null,error:b}):(i.factorType==="totp"&&u.type==="totp"&&(!((a=u==null?void 0:u.totp)===null||a===void 0)&&a.qr_code)&&(u.totp.qr_code=`data:image/svg+xml;utf-8,${u.totp.qr_code}`),this._returnResult({data:u,error:null}))})}catch(o){if(Ye(o))return this._returnResult({data:null,error:o});throw o}}async _verify(i){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async o=>{var n;const{data:a,error:r}=o;if(r)return this._returnResult({data:null,error:r});const s=Object.assign({challenge_id:i.challengeId},"webauthn"in i?{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_response:i.webauthn.type==="create"?su(i.webauthn.credential_response):lu(i.webauthn.credential_response)})}:{code:i.code}),{data:d,error:u}=await rt(this.fetch,"POST",`${this.url}/factors/${i.factorId}/verify`,{body:s,headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});return u?this._returnResult({data:null,error:u}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+d.expires_in},d)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",d),this._returnResult({data:d,error:u}))})}catch(o){if(Ye(o))return this._returnResult({data:null,error:o});throw o}})}async _challenge(i){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async o=>{var n;const{data:a,error:r}=o;if(r)return this._returnResult({data:null,error:r});const s=await rt(this.fetch,"POST",`${this.url}/factors/${i.factorId}/challenge`,{body:i,headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});if(s.error)return s;const{data:d}=s;if(d.type!=="webauthn")return{data:d,error:null};switch(d.webauthn.type){case"create":return{data:Object.assign(Object.assign({},d),{webauthn:Object.assign(Object.assign({},d.webauthn),{credential_options:Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:ru(d.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},d),{webauthn:Object.assign(Object.assign({},d.webauthn),{credential_options:Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:au(d.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(o){if(Ye(o))return this._returnResult({data:null,error:o});throw o}})}async _challengeAndVerify(i){const{data:o,error:n}=await this._challenge({factorId:i.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:i.factorId,challengeId:o.id,code:i.code})}async _listFactors(){var i;const{data:{user:o},error:n}=await this.getUser();if(n)return{data:null,error:n};const a={all:[],phone:[],totp:[],webauthn:[]};for(const r of(i=o==null?void 0:o.factors)!==null&&i!==void 0?i:[])a.all.push(r),r.status==="verified"&&a[r.factor_type].push(r);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(i){var o,n,a,r;if(i)try{const{payload:m}=Br(i);let x=null;m.aal&&(x=m.aal);let p=x;const{data:{user:c},error:g}=await this.getUser(i);if(g)return this._returnResult({data:null,error:g});((n=(o=c==null?void 0:c.factors)===null||o===void 0?void 0:o.filter(y=>y.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(p="aal2");const f=m.amr||[];return{data:{currentLevel:x,nextLevel:p,currentAuthenticationMethods:f},error:null}}catch(m){if(Ye(m))return this._returnResult({data:null,error:m});throw m}const{data:{session:s},error:d}=await this.getSession();if(d)return this._returnResult({data:null,error:d});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=Br(s.access_token);let b=null;u.aal&&(b=u.aal);let j=b;((r=(a=s.user.factors)===null||a===void 0?void 0:a.filter(m=>m.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(j="aal2");const S=u.amr||[];return{data:{currentLevel:b,nextLevel:j,currentAuthenticationMethods:S},error:null}}async _getAuthorizationDetails(i){try{return await this._useSession(async o=>{const{data:{session:n},error:a}=o;return a?this._returnResult({data:null,error:a}):n?await rt(this.fetch,"GET",`${this.url}/oauth/authorizations/${i}`,{headers:this.headers,jwt:n.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new ci})})}catch(o){if(Ye(o))return this._returnResult({data:null,error:o});throw o}}async _approveAuthorization(i,o){try{return await this._useSession(async n=>{const{data:{session:a},error:r}=n;if(r)return this._returnResult({data:null,error:r});if(!a)return this._returnResult({data:null,error:new ci});const s=await rt(this.fetch,"POST",`${this.url}/oauth/authorizations/${i}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:d=>({data:d,error:null})});return s.data&&s.data.redirect_url&&Jt()&&!(o!=null&&o.skipBrowserRedirect)&&window.location.assign(s.data.redirect_url),s})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(i,o){try{return await this._useSession(async n=>{const{data:{session:a},error:r}=n;if(r)return this._returnResult({data:null,error:r});if(!a)return this._returnResult({data:null,error:new ci});const s=await rt(this.fetch,"POST",`${this.url}/oauth/authorizations/${i}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:d=>({data:d,error:null})});return s.data&&s.data.redirect_url&&Jt()&&!(o!=null&&o.skipBrowserRedirect)&&window.location.assign(s.data.redirect_url),s})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async i=>{const{data:{session:o},error:n}=i;return n?this._returnResult({data:null,error:n}):o?await rt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:o.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new ci})})}catch(i){if(Ye(i))return this._returnResult({data:null,error:i});throw i}}async _revokeOAuthGrant(i){try{return await this._useSession(async o=>{const{data:{session:n},error:a}=o;return a?this._returnResult({data:null,error:a}):n?(await rt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:i.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new ci})})}catch(o){if(Ye(o))return this._returnResult({data:null,error:o});throw o}}async fetchJwk(i,o={keys:[]}){let n=o.keys.find(d=>d.kid===i);if(n)return n;const a=Date.now();if(n=this.jwks.keys.find(d=>d.kid===i),n&&this.jwks_cached_at+mg>a)return n;const{data:r,error:s}=await rt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(s)throw s;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=a,n=r.keys.find(d=>d.kid===i),!n)?null:n}async getClaims(i,o={}){try{let n=i;if(!n){const{data:m,error:x}=await this.getSession();if(x||!m.session)return this._returnResult({data:null,error:x});n=m.session.access_token}const{header:a,payload:r,signature:s,raw:{header:d,payload:u}}=Br(n);o!=null&&o.allowExpired||Og(r.exp);const b=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,o!=null&&o.keys?{keys:o.keys}:o==null?void 0:o.jwks);if(!b){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:r,header:a,signature:s},error:null}}const j=Lg(a.alg),w=await crypto.subtle.importKey("jwk",b,j,!0,["verify"]);if(!await crypto.subtle.verify(j,w,s,zg(`${d}.${u}`)))throw new $s("Invalid JWT signature");return{data:{claims:r,header:a,signature:s},error:null}}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}}cr.nextInstanceID={};const mu=cr,bu="2.97.0";let Kn="";typeof Deno<"u"?Kn="deno":typeof document<"u"?Kn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Kn="react-native":Kn="node";const yu={"X-Client-Info":`supabase-js-${Kn}/${bu}`},vu={headers:yu},ju={schema:"public"},Su={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Cu={};function pr(t){"@babel/helpers - typeof";return pr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},pr(t)}function ku(t,i){if(pr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(pr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function wu(t){var i=ku(t,"string");return pr(i)=="symbol"?i:i+""}function zu(t,i,o){return(i=wu(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function _l(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),o.push.apply(o,n)}return o}function _t(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?_l(Object(o),!0).forEach(function(n){zu(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):_l(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}const Eu=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),Au=()=>Headers,Fu=(t,i,o)=>{const n=Eu(o),a=Au();return async(r,s)=>{var d;const u=(d=await i())!==null&&d!==void 0?d:t;let b=new a(s==null?void 0:s.headers);return b.has("apikey")||b.set("apikey",t),b.has("Authorization")||b.set("Authorization",`Bearer ${u}`),n(r,_t(_t({},s),{},{headers:b}))}};function Tu(t){return t.endsWith("/")?t:t+"/"}function Bu(t,i){var o,n;const{db:a,auth:r,realtime:s,global:d}=t,{db:u,auth:b,realtime:j,global:w}=i,S={db:_t(_t({},u),a),auth:_t(_t({},b),r),realtime:_t(_t({},j),s),storage:{},global:_t(_t(_t({},w),d),{},{headers:_t(_t({},(o=w==null?void 0:w.headers)!==null&&o!==void 0?o:{}),(n=d==null?void 0:d.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return t.accessToken?S.accessToken=t.accessToken:delete S.accessToken,S}function Iu(t){const i=t==null?void 0:t.trim();if(!i)throw new Error("supabaseUrl is required.");if(!i.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Tu(i))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Ru=class extends mu{constructor(t){super(t)}},Mu=class{constructor(t,i,o){var n,a;this.supabaseUrl=t,this.supabaseKey=i;const r=Iu(t);if(!i)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const s=`sb-${r.hostname.split(".")[0]}-auth-token`,d={db:ju,realtime:Cu,auth:_t(_t({},Su),{},{storageKey:s}),global:vu},u=Bu(o??{},d);if(this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(a=u.global.headers)!==null&&a!==void 0?a:{},u.accessToken)this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(j,w)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(w)} is not possible`)}});else{var b;this.auth=this._initSupabaseAuthClient((b=u.auth)!==null&&b!==void 0?b:{},this.headers,u.global.fetch)}this.fetch=Fu(i,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(_t({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(j=>this.realtime.setAuth(j)).catch(j=>console.warn("Failed to set initial Realtime auth token:",j)),this.rest=new yp(new URL("rest/v1",r).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch,timeout:u.db.timeout,urlLengthLimit:u.db.urlLengthLimit}),this.storage=new gg(this.storageUrl.href,this.headers,this.fetch,o==null?void 0:o.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new pp(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,i={},o={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,i,o)}channel(t,i={config:{}}){return this.realtime.channel(t,i)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,i,o;if(t.accessToken)return await t.accessToken();const{data:n}=await t.auth.getSession();return(i=(o=n.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:o,storage:n,userStorage:a,storageKey:r,flowType:s,lock:d,debug:u,throwOnError:b},j,w){const S={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ru({url:this.authUrl.href,headers:_t(_t({},S),j),storageKey:r,autoRefreshToken:t,persistSession:i,detectSessionInUrl:o,storage:n,userStorage:a,flowType:s,lock:d,debug:u,throwOnError:b,fetch:w,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Dp(this.realtimeUrl.href,_t(_t({},t),{},{params:_t(_t({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,i)=>{this._handleTokenChanged(t,"CLIENT",i==null?void 0:i.access_token)})}_handleTokenChanged(t,i,o){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==o?(this.changedAccessToken=o,this.realtime.setAuth(o)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const _u=(t,i,o)=>new Mu(t,i,o);function Du(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const i=t.version;if(i==null)return!1;const o=i.match(/^v(\d+)\./);return o?parseInt(o[1],10)<=18:!1}Du()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const $u="https://xlzkasdskatnikuavefh.supabase.co",Pu="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rzc2thdG5pa3VhdmVmaCIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzQwMTUyOTk3LCJleHAiOjIwNTU3Mjg5OTd9.DP5x1hNbnTSzIFRMFOG7tYbykaAJMc6BRXYC_dFNFgE",Ir=_u($u,Pu),ha=new Map,Ou=3e4;function Lu(t){const i=ha.get(t);if(i){if(Date.now()-i.ts>Ou){ha.delete(t);return}return i.val}}function Va(t,i){ha.set(t,{val:i,ts:Date.now()})}console.log(" Storage: Supabase cloud + localStorage cache");window.storage={async get(t,i){const o=i?`shared:${t}`:t,n=Lu(o);if(n!==void 0)return{key:t,value:n,shared:!!i};try{const{data:a,error:r}=await Ir.from("kv_store").select("value").eq("key",o).maybeSingle();if(!r&&a){const s=typeof a.value=="string"?a.value:JSON.stringify(a.value);return Va(o,s),localStorage.setItem(o,s),{key:t,value:s,shared:!!i}}}catch(a){console.warn("[storage] Cloud read failed:",a)}try{const a=localStorage.getItem(o);if(a!==null)return Va(o,a),{key:t,value:a,shared:!!i}}catch{}return null},async set(t,i,o){const n=o?`shared:${t}`:t,a=typeof i=="string"?i:JSON.stringify(i);Va(n,a);try{localStorage.setItem(n,a)}catch{}try{let r;try{r=JSON.parse(a)}catch{r=a}const{error:s}=await Ir.from("kv_store").upsert({key:n,value:r,user_id:"shared",updated_at:new Date().toISOString()},{onConflict:"key"});s&&console.warn("[storage] Cloud write failed:",s)}catch(r){console.warn("[storage] Cloud write error:",r)}return{key:t,value:a,shared:!!o}},async delete(t,i){const o=i?`shared:${t}`:t;ha.delete(o);try{localStorage.removeItem(o)}catch{}try{await Ir.from("kv_store").delete().eq("key",o)}catch(n){console.warn("[storage] Cloud delete failed:",n)}return{key:t,deleted:!0,shared:!!i}},async list(t,i){const o=i?`shared:${t||""}`:t||"";try{const{data:a,error:r}=await Ir.from("kv_store").select("key").like("key",`${o}%`);if(!r&&a)return{keys:a.map(d=>i?d.key.replace(/^shared:/,""):d.key),prefix:t||"",shared:!!i}}catch(a){console.warn("[storage] Cloud list failed:",a)}const n=[];for(let a=0;a<localStorage.length;a++){const r=localStorage.key(a);r&&r.startsWith(o)&&n.push(i?r.replace(/^shared:/,""):r)}return{keys:n,prefix:t||"",shared:!!i}}};var Ps={},Dl=Tc;Ps.createRoot=Dl.createRoot,Ps.hydrateRoot=Dl.hydrateRoot;const fa=()=>Math.random().toString(36).slice(2,11)+Date.now().toString(36),gr=()=>new Date().toISOString(),Wu=()=>gr().split("T")[0],Nu={async get(t){try{const i=await window.storage.get(t);return i?JSON.parse(i.value):null}catch{return null}},async set(t,i){try{return await window.storage.set(t,JSON.stringify(i)),!0}catch{return!1}},async del(t){try{return await window.storage.delete(t),!0}catch{return!1}},async list(t){try{const i=await window.storage.list(t);return(i==null?void 0:i.keys)||[]}catch{return[]}},async getShared(t){try{const i=await window.storage.get(t,!0);return i?JSON.parse(i.value):null}catch{return null}},async setShared(t,i){try{return await window.storage.set(t,JSON.stringify(i),!0),!0}catch{return!1}}},ni=Nu,Qo=[{id:"david",nombre:"David Parra Galera",cargo:"Director Ejecutivo y de Produccin",email:"david@habitaris.com",rol:"admin",puedeAprobar:!0,puedeFirmar:!0},{id:"ana",nombre:"Ana Mara Daz Buitrago",cargo:"Directora Creativa y de Diseo",email:"ana@habitaris.com",rol:"admin",puedeAprobar:!0,puedeFirmar:!0}],$l="hab:crm:aprobaciones",Pl={async getAll(){return await ni.get($l)||[]},async getByOferta(t){return(await this.getAll()).filter(o=>o.ofertaId===t).sort((o,n)=>o.fecha>n.fecha?1:-1)},async add(t){const i=await this.getAll(),o={id:fa(),fecha:gr(),...t};return i.push(o),await ni.set($l,i),o},async getLastByOferta(t){const i=await this.getByOferta(t);return i.length>0?i[i.length-1]:null}},Zo="hab:portal",Uu={_tokenKey(t){return`${Zo}:${t}`},async crear(t,i,o=0){const n=fa()+fa(),a={token:n,ofertaId:t,revision:o,clienteEmail:i.emailCliente||"",clienteNombre:i.cliente||"",fechaCreacion:gr(),fechaExpiracion:new Date(Date.now()+20*24*60*60*1e3).toISOString(),estado:"pendiente",respuestas:[],datosOferta:{titulo:i.ent_titulo||(i.tipoProyecto==="OBRA"?"PRESUPUESTO DE EJECUCIN":"PROPUESTA DE DISEO"),ref:i.codigoOferta||"",cliente:i.cliente||"",proyecto:i.proyecto||"",ubicacion:i.ubicacion||"",fecha:i.fechaOferta||Wu(),pvp:i._pvp||0,pvpIva:i._pvpIva||0,iva:i._iva||0,divisa:i.divisa||"COP",alcance:i.ent_alcance||"",fases:i.ent_fases||"",exclusiones:i.ent_exclusiones||"",condPago:i.ent_condPago||"",plazo:i.ent_plazo||"",garantias:i.ent_garantias||"",terminos:i.ent_terminos||"",notaLegal:i.ent_notaLegal||"",presupuesto:i.borradorLineas||[],nivelDetalle:i.ent_nivelDetalle||"capitulos",firmante:i.firmaRepresentante||"David Parra Galera"}};await ni.setShared(this._tokenKey(n),a);const r=await ni.get(`${Zo}:index`)||[];return r.push({token:n,ofertaId:t,revision:o,fecha:a.fechaCreacion,estado:"pendiente"}),await ni.set(`${Zo}:index`,r),a},async getByToken(t){return await ni.getShared(this._tokenKey(t))},async responder(t,i,o="",n=""){const a=await this.getByToken(t);if(!a)return null;a.respuestas.push({fecha:gr(),accion:i,comentarios:o,por:n||a.clienteNombre}),a.estado=i,await ni.setShared(this._tokenKey(t),a);const r=await ni.get(`${Zo}:index`)||[],s=r.find(d=>d.token===t);return s&&(s.estado=i,await ni.set(`${Zo}:index`,r)),a},async getIndex(){return await ni.get(`${Zo}:index`)||[]},async getByOferta(t){const o=(await this.getIndex()).filter(a=>a.ofertaId===t),n=[];for(const a of o){const r=await this.getByToken(a.token);r&&n.push(r)}return n}},Rr="hab:notificaciones",Vu={async add(t){const i=await ni.get(Rr)||[];i.push({id:fa(),fecha:gr(),leida:!1,...t}),await ni.set(Rr,i)},async getAll(){return await ni.get(Rr)||[]},async getNoLeidas(){return(await this.getAll()).filter(i=>!i.leida)},async marcarLeida(t){const i=await this.getAll(),o=i.find(n=>n.id===t);o&&(o.leida=!0,await ni.set(Rr,i))}},qu="https://xlzkasdskatnikuavefh.supabase.co",Hu="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0MTkxNTMsImV4cCI6MjA1NTk5NTE1M30.kNYsPMsRB0GaxrF1VDqIMeGmxD_K43zQXJIFMn1KlHk",xa=Bc(qu,Hu);function Gu(){const t="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789";let i="";for(let o=0;o<24;o++)i+=t[Math.floor(Math.random()*t.length)];return i}async function Ku(t,i,o,n=null){const a=Gu();let r=1;if(n){const{data:u}=await xa.from("offer_portals").select("revision_number").eq("token",n).single();u&&(r=(u.revision_number||1)+1)}const{data:s,error:d}=await xa.from("offer_portals").insert({token:a,offer_id:t,revision:o||"Rev."+String(r).padStart(2,"0"),offer_data:i,status:"pendiente",parent_token:n||null,revision_number:r}).select().single();if(d)throw console.error("createPortal:",d),d;return{...s,portalUrl:window.location.origin+"/portal#"+a}}async function Ju(t){const{data:i,error:o}=await xa.from("offer_portals").select("*").eq("token",t).single();return o?null:i}async function Yu(t,i,o=""){const{data:n,error:a}=await xa.from("offer_portals").update({status:i,client_comments:o,client_responded_at:new Date().toISOString()}).eq("token",t).select().single();if(a)throw console.error("respondPortal:",a),a;return n}const Xu="habitaris_config",Ol="https://xlzkasdskatnikuavefh.supabase.co",Ll="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM";function In(){var t,i;try{const o=localStorage.getItem(Xu);if(o){const n=JSON.parse(o),a=(((t=n.supabase)==null?void 0:t.url)||"").replace(/\/$/,""),r=((i=n.supabase)==null?void 0:i.anonKey)||"";if(a&&r)return{url:a,key:r}}return{url:Ol,key:Ll}}catch{return{url:Ol,key:Ll}}}function Rn(t){return{apikey:t,Authorization:`Bearer ${t}`,"Content-Type":"application/json",Prefer:"return=representation"}}async function tc(t,i=""){const o=In();if(!o)return null;try{const n=await fetch(`${o.url}/rest/v1/${t}?${i}`,{headers:Rn(o.key)});return n.ok?await n.json():null}catch{return null}}async function Ma(t,i){const o=In();if(!o)return null;try{const n=await fetch(`${o.url}/rest/v1/${t}`,{method:"POST",headers:Rn(o.key),body:JSON.stringify(i)});return n.ok?await n.json():(console.warn("Supabase insert error:",n.status),null)}catch(n){return console.warn("Supabase insert error:",n),null}}async function Qu(t,i,o){const n=In();if(!n)return null;try{const a=await fetch(`${n.url}/rest/v1/${t}?${i}`,{method:"PATCH",headers:Rn(n.key),body:JSON.stringify(o)});return a.ok?await a.json():null}catch{return null}}async function Zu(){const t=In();if(!t)return{ok:!1,error:"URL o clave no configuradas"};try{const i=await fetch(`${t.url}/rest/v1/`,{headers:Rn(t.key)});return i.ok?{ok:!0}:{ok:!1,error:`Error HTTP ${i.status}`}}catch(i){return{ok:!1,error:i.message}}}async function eh(){const t=In();if(!t)return{ok:!1,error:"Configura Supabase primero"};const i=`
    -- Form events (opens, views, time tracking)
    CREATE TABLE IF NOT EXISTS form_events (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      event_type TEXT NOT NULL DEFAULT 'open',
      link_id TEXT,
      client_name TEXT,
      client_email TEXT,
      duration_seconds INTEGER DEFAULT 0,
      user_agent TEXT,
      ip TEXT,
      metadata JSONB DEFAULT '{}'
    );

    -- Form responses (actual submitted data)
    CREATE TABLE IF NOT EXISTS form_responses (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      link_id TEXT,
      client_name TEXT,
      client_email TEXT,
      client_tel TEXT,
      module TEXT DEFAULT 'general',
      data JSONB DEFAULT '{}',
      processed BOOLEAN DEFAULT false,
      processed_at TIMESTAMPTZ,
      notes TEXT
    );

    -- Form links (track each shared link)
    CREATE TABLE IF NOT EXISTS form_links (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      link_id TEXT UNIQUE NOT NULL,
      client_name TEXT,
      client_email TEXT,
      max_uses INTEGER DEFAULT 0,
      current_uses INTEGER DEFAULT 0,
      expires_at TIMESTAMPTZ,
      active BOOLEAN DEFAULT true
    );

    -- Enable RLS but allow anon access (simple setup)
    ALTER TABLE form_events ENABLE ROW LEVEL SECURITY;
    ALTER TABLE form_responses ENABLE ROW LEVEL SECURITY;
    ALTER TABLE form_links ENABLE ROW LEVEL SECURITY;

    -- Policies: allow all for anon (single-tenant app)
    DO $$ BEGIN
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_events') THEN
        CREATE POLICY anon_all_events ON form_events FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_responses') THEN
        CREATE POLICY anon_all_responses ON form_responses FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_links') THEN
        CREATE POLICY anon_all_links ON form_links FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
    END $$;
  `;try{return(await fetch(`${t.url}/rest/v1/rpc/exec_sql`,{method:"POST",headers:Rn(t.key),body:JSON.stringify({query:i})})).ok?{ok:!0}:await Wl(t)}catch{return await Wl(t)}}async function Wl(t){const i=["form_events","form_responses","form_links"],o=[];for(const n of i)try{(await fetch(`${t.url}/rest/v1/${n}?select=id&limit=1`,{headers:Rn(t.key)})).ok||o.push(n)}catch{o.push(n)}return o.length===0?{ok:!0,msg:"Tablas ya existen"}:{ok:!1,error:"manual_sql",missing:o,sql:Os()}}function Os(){return`-- Ejecuta esto en Supabase  SQL Editor  New Query  Run

CREATE TABLE IF NOT EXISTS form_events (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  event_type TEXT NOT NULL DEFAULT 'open',
  link_id TEXT,
  client_name TEXT,
  client_email TEXT,
  duration_seconds INTEGER DEFAULT 0,
  user_agent TEXT,
  metadata JSONB DEFAULT '{}'
);

CREATE TABLE IF NOT EXISTS form_responses (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  link_id TEXT,
  client_name TEXT,
  client_email TEXT,
  client_tel TEXT,
  module TEXT DEFAULT 'general',
  data JSONB DEFAULT '{}',
  processed BOOLEAN DEFAULT false,
  processed_at TIMESTAMPTZ,
  notes TEXT
);

CREATE TABLE IF NOT EXISTS form_links (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  link_id TEXT UNIQUE NOT NULL,
  client_name TEXT,
  client_email TEXT,
  max_uses INTEGER DEFAULT 0,
  current_uses INTEGER DEFAULT 0,
  expires_at TIMESTAMPTZ,
  active BOOLEAN DEFAULT true
);

-- Habilitar RLS
ALTER TABLE form_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE form_responses ENABLE ROW LEVEL SECURITY;
ALTER TABLE form_links ENABLE ROW LEVEL SECURITY;

-- Polticas de acceso
CREATE POLICY anon_all_events ON form_events FOR ALL TO anon USING (true) WITH CHECK (true);
CREATE POLICY anon_all_responses ON form_responses FOR ALL TO anon USING (true) WITH CHECK (true);
CREATE POLICY anon_all_links ON form_links FOR ALL TO anon USING (true) WITH CHECK (true);
`}async function th(t,i,o,n,a){return Ma("form_events",{form_id:t,form_name:i,event_type:"open",link_id:o||null,client_name:n||null,client_email:a||null,user_agent:navigator.userAgent||null})}async function Nl(t,i,o){return Ma("form_events",{form_id:t,event_type:"close",link_id:i||null,duration_seconds:Math.round(o)})}async function ih(t,i,o,n,a){return Ma("form_events",{form_id:t,form_name:i,event_type:"submit",link_id:o||null,client_name:n||null,client_email:a||null})}async function oh(t){return Ma("form_responses",t)}async function nh(){return tc("form_responses","order=created_at.desc&limit=500")}async function ic(t){const i=await tc("form_links",`link_id=eq.${t}&limit=1`);return i&&i.length>0?i[0]:null}async function rh(t){const i=await ic(t);return i?Qu("form_links",`link_id=eq.${t}`,{current_uses:(i.current_uses||0)+1}):null}function jo(){return In()!==null}const it={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",border:"#E0E0E0",success:"#111111",successBg:"#E8F4EE",accent:"#3B3B3B",accentBg:"#F0F0F0",gold:"#C9A84C"},Di={fontFamily:"'DM Sans',sans-serif"};function ah(){try{const t=window.location.hash.slice(1);return t?JSON.parse(decodeURIComponent(atob(t))):null}catch{return null}}function oc(t){try{return btoa(encodeURIComponent(JSON.stringify(t)))}catch{return""}}function Ul({campo:t,value:i,onChange:o,accent:n,allVals:a}){const{tipo:r,label:s,placeholder:d,required:u}=t,b=n||it.ink,j={...Di,fontSize:12,fontWeight:600,color:it.ink,display:"block",marginBottom:6},w={...Di,width:"100%",padding:"12px 16px",border:"1px solid "+it.border,borderRadius:8,fontSize:14,color:it.ink,boxSizing:"border-box",background:"#fff",outline:"none"};let S=t.opciones||[],m=s;if(t.dynamicOpciones&&a){const x=a[t.dynamicOpciones.dependsOn]||"",p=t.dynamicOpciones.map[x];p?S=p:t.dynamicOpciones.fallback?S=t.dynamicOpciones.fallback:S=[]}if(t.dynamicLabel&&a){const x=a[t.dynamicLabel.dependsOn]||"",p=t.dynamicLabel.map[x];p&&(m=p)}if(r==="tel_combo"&&a){const x=t.paisRef||"",p=a[x]||"",c={Colombia:"+57",Espaa:"+34",Mxico:"+52",Chile:"+56",Per:"+51",Ecuador:"+593",Argentina:"+54",Panam:"+507","Estados Unidos":"+1",Otro:"+"},g="_cod_"+t.id,l=a[g]||c[p]||"+57",f=t.opciones||["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"];return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,u&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("select",{value:l,onChange:y=>o(i,y.target.value),style:{...w,width:90,flexShrink:0,borderRadius:"8px 0 0 8px",borderRight:"none",fontWeight:700,fontSize:13,color:"#3B3B3B",background:"#F5F4F1"},children:f.map(y=>e.jsx("option",{value:y,children:y},y))}),e.jsx("input",{type:"tel",value:i||"",onChange:y=>o(y.target.value),placeholder:d||"",style:{...w,flex:1,borderRadius:"0 8px 8px 0"}})]})]})}if(["text","email","tel","number","date"].includes(r))return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,u&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("input",{type:r,value:i||"",onChange:x=>o(x.target.value),placeholder:d||"",style:w})]});if(r==="textarea")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,u&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("textarea",{value:i||"",onChange:x=>o(x.target.value),rows:3,placeholder:d||"",style:{...w,resize:"vertical"}})]});if(r==="select"||r==="rango")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,u&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsxs("select",{value:i||"",onChange:x=>o(x.target.value),style:w,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),(S||[]).map(x=>e.jsx("option",{value:x,children:x},x))]})]});if(r==="chips"){const x=Array.isArray(i)?i:[];return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,u&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:6},children:(S||[]).map(p=>{const c=x.includes(p);return e.jsx("button",{type:"button",onClick:()=>o(c?x.filter(g=>g!==p):[...x,p]),style:{...Di,padding:"8px 16px",fontSize:12,fontWeight:c?700:400,borderRadius:20,border:c?"2px solid "+b:"1px solid "+it.border,background:c?b:"#fff",color:c?"#fff":it.inkMid,cursor:"pointer",transition:"all .15s"},children:p},p)})})]})}if(r==="radio")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,u&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginTop:6},children:(S||[]).map(x=>e.jsxs("label",{style:{...Di,display:"flex",alignItems:"center",gap:10,fontSize:13,cursor:"pointer",padding:"10px 14px",borderRadius:8,background:i===x?b:"#fff",color:i===x?"#fff":it.ink,border:i===x?"2px solid "+b:"1px solid "+it.border,transition:"all .15s"},children:[e.jsx("input",{type:"radio",checked:i===x,onChange:()=>o(x),style:{display:"none"}}),x]},x))})]});if(r==="rating"){const x=parseInt(i)||0;return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,u&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:6},children:[1,2,3,4,5].map(p=>e.jsx("button",{type:"button",onClick:()=>o(p),style:{background:"none",border:"none",cursor:"pointer",fontSize:32,filter:p<=x?"none":"grayscale(1)",opacity:p<=x?1:.3},children:""},p))})]})}return r==="yesno"?e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,u&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginTop:6},children:["S","No"].map(x=>e.jsx("button",{type:"button",onClick:()=>o(x),style:{...Di,padding:"12px 32px",fontSize:14,fontWeight:i===x?700:400,borderRadius:24,border:i===x?"2px solid "+b:"1px solid "+it.border,background:i===x?b:"#fff",color:i===x?"#fff":it.inkMid,cursor:"pointer",transition:"all .15s",flex:1,textAlign:"center"},children:x},x))})]}):r==="info"?e.jsx("div",{style:{marginBottom:20,padding:"14px 18px",background:it.accentBg,borderRadius:8,border:"1px solid "+it.accent+"22"},children:e.jsx("p",{style:{...Di,fontSize:12,color:it.accent,margin:0,lineHeight:1.6},children:m})}):r==="seccion"?e.jsxs("div",{style:{marginTop:28,marginBottom:14,paddingTop:18,borderTop:"2px solid "+b},children:[e.jsx("h3",{style:{...Di,fontSize:15,fontWeight:700,color:it.ink,margin:0},children:m}),t.desc&&e.jsx("p",{style:{...Di,fontSize:11,color:it.inkLight,margin:"4px 0 0"},children:t.desc})]}):null}function sh(){var q,I;const[t,i]=F.useState(null),[o,n]=F.useState({}),[a,r]=F.useState(!1),[s,d]=F.useState(""),[u,b]=F.useState(0),[j,w]=F.useState("next"),[S,m]=F.useState(0),[x,p]=F.useState(null),c=F.useRef(null),g=F.useRef(Date.now());if(F.useEffect(()=>{i(ah())},[]),F.useEffect(()=>{var Te;if(!t)return;const $=t.campos||[],H=t.cliente||null;if(H){const Oe={};$.forEach(ct=>{H.email&&ct.mapKey==="email"&&(Oe[ct.id]=H.email),H.nombre&&ct.mapKey==="nombre"&&(Oe[ct.id]=H.nombre),H.tel&&ct.mapKey==="telefono"&&(Oe[ct.id]=H.tel)}),n(ct=>({...Oe,...ct}))}const U=((Te=t.config)==null?void 0:Te.paisProyecto)||"Colombia",_={};$.forEach(Oe=>{Oe.mapKey==="pais"&&(_[Oe.id]=U)}),n(Oe=>({..._,...Oe}));const ce=t.linkConfig||{};if(ce.blocked){p("blocked");return}if(ce.fechaCaducidad&&new Date(ce.fechaCaducidad)<new Date){p("expired");return}if(ce.maxUsos&&ce.maxUsos>0){const Oe="hab_link_uses_"+(ce.linkId||t.id||"");if(parseInt(localStorage.getItem(Oe)||"0")>=ce.maxUsos){p("maxuses");return}}const ve=ce.linkId;ve&&jo()&&ic(ve).then(Oe=>{if(Oe){if(!Oe.active){p("inactive");return}if(Oe.expires_at&&new Date(Oe.expires_at)<new Date){p("expired");return}if(Oe.max_uses>0&&Oe.current_uses>=Oe.max_uses){p("maxuses");return}}}).catch(()=>{}),g.current=Date.now(),jo()&&th(t.id,t.nombre,ce.linkId,H==null?void 0:H.nombre,H==null?void 0:H.email).catch(()=>{});const Ie=()=>{const Oe=Math.round((Date.now()-g.current)/1e3);jo()&&Nl(t.id,ce.linkId,Oe).catch(()=>{})};return window.addEventListener("beforeunload",Ie),()=>window.removeEventListener("beforeunload",Ie)},[t]),!t)return e.jsxs("div",{style:{minHeight:"100vh",background:it.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');"}),e.jsxs("div",{style:{background:it.surface,borderRadius:12,padding:40,maxWidth:400,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:40,marginBottom:16},children:""}),e.jsx("h2",{style:{...Di,fontSize:18,fontWeight:700,color:it.ink},children:"Formulario no disponible"}),e.jsx("p",{style:{...Di,fontSize:13,color:it.inkMid,marginTop:8},children:"Este enlace no es vlido o ha expirado."})]})]});if(x){const $={expired:{icon:"",title:"Formulario expirado",desc:"La fecha de caducidad de este formulario ha pasado. Contacta a quien te lo envi."},maxuses:{icon:"",title:"Lmite de envos alcanzado",desc:"Este formulario ya fue completado el nmero mximo de veces permitido."},inactive:{icon:"",title:"Enlace desactivado",desc:"Este enlace ha sido desactivado. Contacta a quien te lo envi."},blocked:{icon:"",title:"Formulario bloqueado",desc:"Este formulario ha sido bloqueado por el remitente. Si crees que es un error, contacta a quien te lo envi."}},H=$[x]||$.expired,U=((q=t==null?void 0:t.marca)==null?void 0:q.tipografia)||"DM Sans";return e.jsxs("div",{style:{minHeight:"100vh",background:it.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${U.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:it.surface,borderRadius:12,padding:40,maxWidth:400,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[((I=t==null?void 0:t.marca)==null?void 0:I.logo)&&e.jsx("img",{src:t.marca.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:H.icon}),e.jsx("h2",{style:{fontFamily:`'${U}',sans-serif`,fontSize:18,fontWeight:700,color:it.ink},children:H.title}),e.jsx("p",{style:{fontFamily:`'${U}',sans-serif`,fontSize:13,color:it.inkMid,marginTop:8,lineHeight:1.6},children:H.desc})]})]})}const l=t.campos||[],f=t.config||{},y=t.cliente||null,h=t.marca||{},v=f.colorAccent||h.colorPrimario||"#111111",A=h.colorSecundario||"#3B3B3B",z=h.colorAcento||"#C9A84C",k=h.tipografia||"DM Sans",T={fontFamily:`'${k}',sans-serif`},C=f.vista||"pasos",D=f.botonTexto||"Enviar formulario",K=($,H)=>{n(U=>({...U,[$]:H})),d("")},oe=$=>te($)?P($)?ae($):$.tipo==="tel_combo"?e.jsx(Ul,{campo:$,value:o[$.id],onChange:(H,U)=>{U!==void 0?K("_cod_"+$.id,U):K($.id,H)},accent:v,allVals:o},$.id):e.jsx(Ul,{campo:$,value:o[$.id],onChange:H=>K($.id,H),accent:v,allVals:o},$.id):null,te=$=>{if(!$.logica||!$.logica.fieldId||!$.logica.value&&!$.logica.notValues&&!$.logica.notValue)return!0;const H=o[$.logica.fieldId];if($.logica.notValues)return!$.logica.notValues.includes(String(H||""));if($.logica.notValue)return String(H||"")!==$.logica.notValue;const U=$.logica.value;return Array.isArray(H)?H.includes(U):String(H||"")===U},P=$=>y?!!(y.email&&$.mapKey==="email"||y.nombre&&$.mapKey==="nombre"||y.tel&&y.tel.trim()&&($.mapKey==="telefono"||$.tipo==="tel_combo")||$.mapKey==="pais"):$.mapKey==="pais",ie=[],me=l.find($=>$.mapKey==="aceptaPrivacidad"),Q=l.find($=>$.tipo==="info"&&$.label&&$.label.includes("Aviso de Privacidad"));me&&ie.push({title:"Aviso de Privacidad",desc:"Antes de comenzar, necesitamos tu autorizacin",icon:"",fields:[Q,me].filter(Boolean),isPrivacy:!0});let je={title:f.titulo||t.nombre||"Formulario",desc:f.subtitulo||"",icon:"",fields:[]};l.forEach($=>{$.id===(me&&me.id)||$.id===(Q&&Q.id)||($.tipo==="seccion"?(je.fields.length>0&&ie.push(je),je={title:$.label,desc:$.desc||"",icon:"",fields:[]}):je.fields.push($))}),je.fields.length>0&&ie.push(je);const re=ie.filter($=>$.isPrivacy||$.fields.some(H=>te(H)));if(me&&o[me.id]==="No")return e.jsxs("div",{style:{minHeight:"100vh",background:it.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${k.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:it.surface,borderRadius:12,padding:40,maxWidth:480,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[h.logo&&e.jsx("img",{src:h.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),e.jsx("h2",{style:{...T,fontSize:20,fontWeight:700,color:it.ink},children:"Gracias por tu tiempo"}),e.jsx("p",{style:{...T,fontSize:13,color:it.inkMid,lineHeight:1.6,marginTop:8},children:"Para continuar necesitamos tu autorizacin para el tratamiento de datos personales."})]})]});const M=!me||o[me.id]==="S"?u:0,B=re.length,V=re[M]||re[0],X=M>=B-1,R=l.filter($=>$.required&&$.tipo!=="seccion"&&$.tipo!=="info").length,W=l.filter($=>$.required&&$.tipo!=="seccion"&&$.tipo!=="info"&&o[$.id]&&(Array.isArray(o[$.id])?o[$.id].length>0:!0)).length,se=R>0?Math.round(W/R*100):0,le=B>1?Math.round(M/(B-1)*100):0,de=($,H)=>{w(H||"next"),m(U=>U+1),b($),d(""),c.current&&c.current.scrollIntoView({behavior:"smooth"})},Z=()=>{if(!V)return!0;for(const $ of V.fields)if(te($)&&$.required&&$.tipo!=="seccion"&&$.tipo!=="info"){const H=o[$.id];if(!H||Array.isArray(H)&&H.length===0)return d('El campo "'+$.label+'" es obligatorio.'),!1}return!0},ue=()=>{for(const $ of l)if(te($)&&$.required&&$.tipo!=="seccion"&&$.tipo!=="info"){const H=o[$.id];if(!H||Array.isArray(H)&&H.length===0)return d('El campo "'+$.label+'" es obligatorio.'),!1}return!0},N=()=>{Z()&&(X?L():de(M+1,"next"))},G=()=>{M>0&&de(M-1,"prev")},L=async()=>{if(C==="pasos"&&!Z()||C==="scroll"&&!ue())return;const $=t.linkConfig||{},H={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36)};H.fecha=new Date().toISOString().split("T")[0],H.formularioId=t.id,H.formularioNombre=t.nombre,y&&(H.clienteNombre=y.nombre,H.clienteEmail=y.email,H.clienteTel=y.tel);const U=l.find(_=>_.tipo==="tel_combo");if(U&&o[U.id]){const _=(o["_cod_"+U.id]||"")+" "+o[U.id];H.clienteTel=H.clienteTel||_,U.mapKey&&(H[U.mapKey]=o[U.id]),U.codMapKey&&(H[U.codMapKey]=o["_cod_"+U.id]||"")}l.forEach(_=>{_.tipo!=="seccion"&&o[_.id]!==void 0&&(H[_.mapKey||_.id]=o[_.id]),_.tipo==="tel_combo"&&_.codMapKey&&(H[_.codMapKey]=o["_cod_"+_.id]||"")});try{const _="hab:briefing:"+H.id;window.storage?await window.storage.set(_,JSON.stringify(H),!0):localStorage.setItem("shared:"+_,JSON.stringify(H))}catch{}try{const _="hab:form:responses";let ce=[];try{const ve=window.storage?await window.storage.get(_,!0):{value:localStorage.getItem("shared:"+_)};ve&&ve.value&&(ce=JSON.parse(ve.value))}catch{}ce.push({id:H.id,formId:t.id,fecha:H.fecha,nombre:H.nombre||H.email||""}),window.storage?await window.storage.set(_,JSON.stringify(ce),!0):localStorage.setItem("shared:"+_,JSON.stringify(ce))}catch{}if(jo())try{await oh({form_id:t.id,form_name:t.nombre,link_id:$.linkId||null,client_name:(y==null?void 0:y.nombre)||H.clienteNombre||null,client_email:(y==null?void 0:y.email)||H.clienteEmail||null,client_tel:(y==null?void 0:y.tel)||H.clienteTel||null,module:t.modulo||f.modulo||"general",data:H}),await ih(t.id,t.nombre,$.linkId,y==null?void 0:y.nombre,y==null?void 0:y.email);const _=Math.round((Date.now()-g.current)/1e3);_>0&&await Nl(t.id,$.linkId,_).catch(()=>{}),$.linkId&&await rh($.linkId)}catch(_){console.warn("Supabase save error:",_)}if($.maxUsos&&$.maxUsos>0){const _="hab_link_uses_"+($.linkId||t.id||""),ce=parseInt(localStorage.getItem(_)||"0");localStorage.setItem(_,String(ce+1))}r(!0);try{const _=l.filter(at=>{var xt;return(xt=at.scoring)==null?void 0:xt.enabled});let ce="";if(_.length>0){let at=0,xt=0,Ft=0,zt=0,Vt=0;const Ti=[];_.forEach(qt=>{const li=qt.scoring.weight||1,ll=qt.mapKey||qt.id;let Yi=o[qt.id];if(Yi===void 0)return;xt+=li;const kr=qt.scoring.rules||{};let Y="neutral";if(Array.isArray(Yi)){const yt=Yi.map(Et=>kr[Et]||"neutral");yt.includes("red")?Y="red":yt.every(Et=>Et==="green")?Y="green":Y="neutral"}else Y=kr[String(Yi)]||"neutral";let Fe=Y==="green"?li:Y==="neutral"?li*.5:0;at+=Fe,Y==="green"?Ft++:Y==="red"?zt++:Vt++;const $e=Y==="green"?"":Y==="red"?"":"",Qe=Y==="green"?"#111111":Y==="red"?"#B91C1C":"#8C6A00",pt=Array.isArray(Yi)?Yi.join(", "):Yi;Ti.push(`<tr><td style="padding:5px 10px;font-size:11px;font-weight:600;">${qt.label}</td><td style="padding:5px 10px;font-size:11px;">${pt}</td><td style="padding:5px 10px;text-align:center;font-weight:700;color:${Qe};">${Fe}/${li}</td><td style="padding:5px 10px;text-align:center;">${$e}</td></tr>`)});const lo=xt>0?Math.round(at/xt*100)/10:0,ji=lo>=7?"green":lo>=4?"yellow":"red",Ji={green:{bg:"#E8F4EE",text:"#111111"},yellow:{bg:"#FAF0E0",text:"#8C6A00"},red:{bg:"#FAE8E8",text:"#B91C1C"}}[ji],Sr=ji==="green"?" Cliente potencial":ji==="yellow"?" Revisar":" No califica",Cr=ji==="green"?"Contactar en las prximas 24h.":ji==="yellow"?"Agendar llamada exploratoria.":"Responder cortsmente y archivar.";ce=`<div style="margin:16px 0;border:1px solid ${Ji.text}33;border-radius:8px;overflow:hidden;">
          <div style="display:flex;align-items:center;gap:14px;padding:14px 16px;background:${Ji.bg};">
            <div style="font-size:24px;font-weight:800;color:${Ji.text};">${lo.toFixed(1)}/10</div>
            <div><div style="font-size:13px;font-weight:700;color:${Ji.text};">${Sr}</div><div style="font-size:9px;color:${Ji.text};">${Cr}</div></div>
            <div style="margin-left:auto;display:flex;gap:8px;"><span>${Ft}</span><span>${Vt}</span><span>${zt}</span></div>
          </div>
          <table style="width:100%;border-collapse:collapse;">${Ti.join("")}</table>
        </div>`}let ve=ce,Ie="";l.forEach(at=>{if(at.tipo==="seccion"){Ie=at.label,ve+=`<div style="margin-top:16px;padding:10px 14px;background:#F5F5F5;border-radius:6px;border-left:3px solid #C9A84C;">
            <p style="margin:0;font-size:12px;font-weight:bold;color:#111;">${at.label}</p>
            ${at.desc?`<p style="margin:2px 0 0;font-size:10px;color:#888;">${at.desc}</p>`:""}
          </div>`;return}if(at.tipo==="info")return;const xt=o[at.id];if(xt===void 0||xt===""||Array.isArray(xt)&&xt.length===0)return;const Ft=Array.isArray(xt)?xt.join(", "):xt;ve+=`<div style="padding:8px 14px;border-bottom:1px solid #f0f0f0;">
          <p style="margin:0;font-size:10px;color:#888;font-weight:600;">${at.label}</p>
          <p style="margin:3px 0 0;font-size:13px;color:#111;">${Ft}</p>
        </div>`});const Te=(y==null?void 0:y.nombre)||H.clienteNombre||H.nombre||"Sin nombre",Oe=(y==null?void 0:y.email)||H.clienteEmail||H.email||"",ct=(y==null?void 0:y.tel)||H.clienteTel||H.telefono||"";await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:"service_6x3478l",template_id:"template_6lla2i8",user_id:"64nk2FHknwpLqc1p4",template_params:{form_name:t.nombre||"Formulario",client_name:Te,client_email:Oe,client_tel:ct,fecha:H.fecha+"  "+new Date().toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}),contenido:ve}})})}catch(_){console.warn("Email notification error:",_)}};if(a)return e.jsxs("div",{style:{minHeight:"100vh",background:it.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${k.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:it.surface,borderRadius:12,padding:40,maxWidth:480,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[h.logo&&e.jsx("img",{src:h.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),e.jsx("h2",{style:{...T,fontSize:20,fontWeight:700,color:it.success,margin:"0 0 8px"},children:"Enviado!"}),e.jsx("p",{style:{...T,fontSize:13,color:it.inkMid,lineHeight:1.6},children:f.mensajeExito||"Gracias por completar el formulario."}),h.empresa&&e.jsxs("p",{style:{...T,fontSize:10,color:it.inkLight,marginTop:16},children:[h.empresa,h.slogan?`  ${h.slogan}`:""]})]})]});const ae=$=>{if($.tipo==="tel_combo"){const H=o["_cod_"+$.id]||"+57";return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:{...T,fontSize:12,fontWeight:600,color:it.ink,display:"block",marginBottom:6},children:[$.label," ",e.jsx("span",{style:{fontSize:9,color:A,fontWeight:400},children:" prellenado"})]}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("div",{style:{...T,width:90,flexShrink:0,padding:"12px 0",border:`1px solid ${A}33`,borderRadius:"8px 0 0 8px",borderRight:"none",fontSize:14,color:A,background:A+"15",fontWeight:700,textAlign:"center"},children:H}),e.jsx("input",{type:"text",value:o[$.id]||"",disabled:!0,style:{...T,flex:1,padding:"12px 16px",border:`1px solid ${A}33`,borderRadius:"0 8px 8px 0",fontSize:14,color:A,boxSizing:"border-box",background:A+"15",fontWeight:600}})]})]},$.id)}return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:{...T,fontSize:12,fontWeight:600,color:it.ink,display:"block",marginBottom:6},children:[$.label," ",e.jsx("span",{style:{fontSize:9,color:A,fontWeight:400},children:" prellenado"})]}),e.jsx("input",{type:"text",value:o[$.id]||"",disabled:!0,style:{...T,width:"100%",padding:"12px 16px",border:`1px solid ${A}33`,borderRadius:8,fontSize:14,color:A,boxSizing:"border-box",background:A+"15",fontWeight:600}})]},$.id)},pe=()=>e.jsxs("div",{style:{background:v,padding:"14px 24px"},children:[e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[h.logo?e.jsx("img",{src:h.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("div",{style:{...T,fontWeight:700,fontSize:14,letterSpacing:3,color:"#fff",textTransform:"uppercase"},children:h.empresa||"HABITARIS"}),h.slogan&&e.jsx("div",{style:{...T,fontSize:7,letterSpacing:2,color:"rgba(255,255,255,.4)",textTransform:"uppercase"},children:h.slogan})]}),e.jsx("div",{style:{...T,fontSize:10,color:"rgba(255,255,255,.5)"},children:C==="pasos"?"Paso "+(M+1)+" de "+B:se+"% completo"})]}),e.jsx("div",{style:{maxWidth:640,margin:"8px auto 0",height:3,background:"rgba(255,255,255,.15)",borderRadius:2},children:e.jsx("div",{style:{width:(C==="pasos"?le:se)+"%",height:"100%",background:z,borderRadius:2,transition:"width .4s ease"}})})]}),he=()=>!y||C==="pasos"&&M!==(me?1:0)?null:e.jsxs("div",{style:{background:A+"15",border:`1px solid ${A}22`,borderRadius:10,padding:"14px 18px",marginBottom:20,display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:A,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,flexShrink:0},children:(y.nombre||"?")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{style:{...T,fontSize:13,fontWeight:700,color:A},children:["Formulario para: ",y.nombre||y.email]}),y.email&&e.jsx("div",{style:{...T,fontSize:10,color:A+"99"},children:y.email})]})]}),ze=()=>s?e.jsxs("div",{style:{...T,fontSize:12,color:"#B91C1C",textAlign:"center",margin:"14px 0",padding:"10px 16px",background:"#FAE8E8",borderRadius:6,border:"1px solid #B91C1C22"},children:[" ",s]}):null;return C==="scroll"?e.jsxs("div",{style:{minHeight:"100vh",background:it.bg},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${k.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0}body{font-family:'${k}',sans-serif}input:focus,textarea:focus,select:focus{border-color:${v}!important;box-shadow:0 0 0 3px ${v}15}`}),e.jsx(pe,{}),e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",padding:"28px 20px 100px"},children:[e.jsx(he,{}),e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("h1",{style:{...T,fontSize:22,fontWeight:700,margin:"0 0 6px"},children:f.titulo||t.nombre||"Formulario"}),f.subtitulo&&e.jsx("p",{style:{...T,fontSize:13,color:it.inkMid},children:f.subtitulo})]}),e.jsx("div",{style:{background:it.surface,borderRadius:12,padding:"28px 28px 12px",border:"1px solid "+it.border,boxShadow:"0 2px 16px rgba(0,0,0,.04)"},children:l.map($=>oe($))}),e.jsx(ze,{})]}),e.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:it.surface,borderTop:"1px solid "+it.border,padding:"12px 20px",zIndex:200,boxShadow:"0 -4px 20px rgba(0,0,0,.06)"},children:e.jsx("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"center"},children:e.jsxs("button",{onClick:L,style:{...T,padding:"14px 40px",background:v,color:"#fff",border:"none",borderRadius:8,fontSize:15,fontWeight:700,cursor:"pointer"},children:[D," "]})})})]}):e.jsxs("div",{style:{minHeight:"100vh",background:it.bg},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${k.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0}body{font-family:'${k}',sans-serif}@keyframes slideNext{from{opacity:0;transform:translateX(40px)}to{opacity:1;transform:translateX(0)}}@keyframes slidePrev{from{opacity:0;transform:translateX(-40px)}to{opacity:1;transform:translateX(0)}}.step-next{animation:slideNext .3s ease both}.step-prev{animation:slidePrev .3s ease both}input:focus,textarea:focus,select:focus{border-color:${v}!important;box-shadow:0 0 0 3px ${v}15}`}),e.jsx("div",{ref:c}),e.jsx(pe,{}),e.jsx("div",{style:{maxWidth:640,margin:"0 auto",padding:"16px 20px 0"},children:e.jsx("div",{style:{display:"flex",gap:4,justifyContent:"center"},children:re.map(($,H)=>e.jsx("div",{style:{height:4,flex:1,maxWidth:40,borderRadius:2,background:H<M?it.success:H===M?v:it.border,transition:"background .3s"}},H))})}),e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",padding:"20px 20px 140px"},children:[e.jsx(he,{}),e.jsxs("div",{className:j==="next"?"step-next":"step-prev",children:[e.jsxs("div",{style:{marginBottom:20},children:[V&&V.icon&&e.jsx("div",{style:{fontSize:28,marginBottom:4},children:V.icon}),e.jsx("h2",{style:{...T,fontSize:22,fontWeight:700,color:it.ink,margin:"0 0 4px"},children:V&&V.title}),V&&V.desc&&e.jsx("p",{style:{...T,fontSize:13,color:it.inkMid},children:V.desc})]}),e.jsx("div",{style:{background:it.surface,borderRadius:12,padding:"28px 28px 12px",border:"1px solid "+it.border,boxShadow:"0 2px 16px rgba(0,0,0,.04)"},children:V&&V.fields.map($=>$.tipo==="seccion"?null:oe($))}),e.jsx(ze,{})]},S)]}),e.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:it.surface,borderTop:"1px solid "+it.border,padding:"14px 20px",zIndex:200,boxShadow:"0 -4px 20px rgba(0,0,0,.06)"},children:e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[M>0?e.jsx("button",{onClick:G,style:{...T,padding:"12px 24px",background:"#fff",color:it.ink,border:"1px solid "+it.border,borderRadius:8,fontSize:13,fontWeight:600,cursor:"pointer"},children:" Atrs"}):e.jsx("div",{}),e.jsxs("div",{style:{...T,fontSize:10,color:it.inkLight},children:[M+1," / ",B]}),e.jsx("button",{onClick:N,style:{...T,padding:"12px 32px",background:v,color:"#fff",border:"none",borderRadius:8,fontSize:14,fontWeight:700,cursor:"pointer"},children:X?(D||"Enviar")+" ":"Siguiente "})]})})]})}const Vl=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 14px; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; color: #111; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
    input:focus, select:focus, textarea:focus { outline: none; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    .fade { animation: fadeUp .2s ease; }
    @media print {
      .no-print { display:none!important; visibility:hidden!important; height:0!important; overflow:hidden!important; margin:0!important; padding:0!important; }
      body { background:#fff!important; -webkit-print-color-adjust:exact; print-color-adjust:exact; margin:0; padding:0; font-size:10pt; line-height:1.55; color:#111; }
      * { box-shadow:none!important; animation:none!important; }
      @page { size:A4; margin:12mm 16mm 14mm 16mm; }
      main,[style*="marginLeft"]{ margin-left:0!important; max-width:100%!important; padding:0!important; }
      div[style*="position: fixed"],div[style*="position:fixed"]{ display:none!important; }
      div[style*="width: 200"],div[style*="width:200px"]{ display:none!important; width:0!important; }
      table { page-break-inside:auto; width:100%!important; border-collapse:collapse; font-size:9pt; }
      tr { page-break-inside:avoid; }
      h1,h2,h3 { page-break-after:avoid; }
      img { max-width:100%!important; }
      input,select { border:none!important; background:transparent!important; padding:1px 0!important; font-size:10pt!important; -webkit-appearance:none!important; color:#111!important; font-family:'DM Sans',sans-serif!important; }
      textarea { display:none!important; }
      .ptr { display:block!important; white-space:pre-wrap; font-size:10pt; line-height:1.55; color:#111; }
      button { display:none!important; }
      .print-only { display:block!important; }
      .print-flex { display:flex!important; }
      .print-page-break { page-break-before:always; }
      .print-section { page-break-inside:avoid; margin-bottom:10pt!important; }
      .p-cover { display:flex!important; flex-direction:column; justify-content:center; align-items:center; min-height:92vh; page-break-after:always; text-align:center; }
      .p-hdr { display:flex!important; justify-content:space-between; align-items:center; border-bottom:1.5pt solid #111; padding-bottom:6pt; margin-bottom:12pt; }
    }
    @media (max-width:1200px) {
      [style*="gridTemplateColumns: 1fr 1fr 1fr"]{ grid-template-columns:1fr 1fr!important; }
    }
    @media (max-width:900px) {
      [style*="gridTemplateColumns: 1fr 1fr 1fr"],[style*="gridTemplateColumns: 1fr 1fr"]{ grid-template-columns:1fr!important; }
    }
    .print-only,.print-flex,.p-cover,.p-hdr,.ptr { display:none; }
  `}),E={bg:"#F5F4F1",surface:"#FFFFFF",sidebar:"#111111",sidebarHov:"#1C1C1C",sidebarAct:"#242424",ink:"#111111",inkMid:"#555555",inkLight:"#999999",inkXLight:"#BBBBBB",border:"#E0E0E0",borderMid:"#CCCAC4",accentBg:"#EDEBE7",success:"#2B7A52",successBg:"#E6F4EC",warning:"#8A6020",warningBg:"#FAF2E2",error:"#B91C1C",errorBg:"#FAE8E8",info:"#2A5F8C",infoBg:"#E8F1FA",shadow:"0 1px 2px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04)",shadowMd:"0 4px 20px rgba(0,0,0,0.10)",accent:"#111111",danger:"#B91C1C"},nl=({size:t=34,color:i="#fff"})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"4.5",y:"2.5",width:"25",height:"25",stroke:i,strokeWidth:"0.7",opacity:"0.4"}),e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:i,strokeWidth:"1.1"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:i}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:i}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:i})]}),Ls=["Proyecto Arquitectnico Completo","Proyecto Interiorismo","Proyecto Interiorismo Espacio"],lh=[{nombre:"Planta arquitectnica levantamiento",arq:5,int:3,esp:2},{nombre:"Planta arquitectnica propuesta",arq:8,int:5,esp:2},{nombre:"Cortes longitudinal y transversal",arq:3,int:2,esp:1},{nombre:"Fachadas",arq:3,int:0,esp:0},{nombre:"Planta arquitectnica demoliciones",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica constructiva / cotas",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica cielo rasos",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica pisos y enchapes",arq:2,int:2,esp:1},{nombre:"Planta de iluminacin y puntos elctricos",arq:4,int:3,esp:1},{nombre:"Tabla de iluminacin",arq:5,int:3,esp:2},{nombre:"Planos de carpinteras, detalles y despieces",arq:8,int:6,esp:3},{nombre:"Detalles constructivos",arq:8,int:6,esp:2},{nombre:"Plano de puertas y ventanas",arq:8,int:4,esp:2},{nombre:"Plano de amueblamiento",arq:4,int:4,esp:2},{nombre:"Moodboard",arq:3,int:2,esp:1},{nombre:"Tabla de acabados y especificaciones",arq:16,int:8,esp:6},{nombre:"Lista de compras / FF&E",arq:8,int:8,esp:5},{nombre:"Memoria de calidades",arq:8,int:6,esp:3},{nombre:"Modelado 3D",arq:24,int:16,esp:8},{nombre:"Renderizado",arq:8,int:6,esp:3}],nc=()=>lh.map(t=>({nombre:t.nombre,incluir:!1,cant:1,horasArq:t.arq,horasInt:t.int,horasEsp:t.esp})),Mr=[{grupo:"DISEO",cod:"DAN",label:"Diseo arquitectnico  Obra nueva"},{grupo:"DISEO",cod:"DAR",label:"Diseo arquitectnico  Reforma parcial"},{grupo:"DISEO",cod:"DIN",label:"Diseo de interiores"},{grupo:"DISEO",cod:"DBI",label:"Biointeriorismo"},{grupo:"EJECUCIN",cod:"REF",label:"Reforma parcial"},{grupo:"EJECUCIN",cod:"RIN",label:"Reforma integral"},{grupo:"EJECUCIN",cod:"ONV",label:"Obra nueva (ejecucin)"},{grupo:"DIRECCIN / CONTROL",cod:"SUP",label:"Supervisin presencial"},{grupo:"DIRECCIN / CONTROL",cod:"SUO",label:"Supervisin online"},{grupo:"SERVICIOS COMPLEMENTARIOS",cod:"ASC",label:"Asesora de compras"}],qa=[{val:"apartamento",label:"Apartamento",ph1:"Nombre del edificio",ph2:"Ej: Apto 403"},{val:"casa_conjunto",label:"Casa en conjunto",ph1:"Nombre del conjunto",ph2:"Ej: Casa 12"},{val:"casa_independiente",label:"Casa independiente",ph1:"Nombre del lugar",ph2:"Ej: La Colina"},{val:"local",label:"Local / Oficina",ph1:"Nombre del edificio",ph2:"Ej: Local 201"},{val:"otro",label:"Otro",ph1:"Lugar / Referencia",ph2:"Referencia adicional"}],ql=(t,i="01",o=0)=>{const n=new Date,a=String(n.getFullYear()).slice(2),r=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0"),d=`R${String(o).padStart(2,"0")}`;return`${t}_${a}${r}${s}_${String(i).padStart(2,"0")}_${d}`},dh=(t,i,o)=>{if(!i&&!o)return"";const n=(i==null?void 0:i.trim())||"",a=(o==null?void 0:o.trim())||"";return!n&&!a?"":a?n?`${n}  ${a}`:a:n},rl=["Borrador","Presentada","En revisin","Ganada","Perdida","Cancelada"],Hl={Borrador:{bg:"#EDEBE7",txt:"#777"},Presentada:{bg:E.infoBg,txt:E.info},"En revisin":{bg:E.warningBg,txt:E.warning},Ganada:{bg:E.successBg,txt:E.success},Perdida:{bg:E.errorBg,txt:E.error},Cancelada:{bg:"#EDE8F0",txt:"#826B82"}},ch={actividadCod:"DIN",digitoControl:"01",revision:0,codigoOferta:"",tipoInmueble:"apartamento",lugarNombre:"",lugarReferencia:"",cliente:"",proyecto:"",ubicacion:"",estado:"Borrador",notas:"",relacionadaCon:null,emailCliente:"",telCliente:"",fechaInicio:"",fechaEntrega:"",firmaRepresentante:"David Parra Galera",elaboradoPor:"",tipoProyecto:"OBRA",subtipoDiseno:Ls[1],tarifaIVA:.19,margen:.25,uDecl:.1,uDeclMode:"auto",modoCalcObra:"margen",aiuA:.08,aiuI:.03,aiuU:.07,tipoCliente:"PN",medioPago:"PSE",aplicar4x1000:"SI",pctRCE:.007,pctTRC:.007,pctAdm:.002,pctICA:.009,pctReteFuente:0,pctReteICA:0,pctReteIVA:0,costosDirectos:[],apuSalarioAnual:0,apuPrestaciones:.65,apuHDia:8,apuDiasSem:5,apuSemanas:52,apuPctProductivas:.6,apuLicencias:0,apuEquipos:0,apuAccesorios:0,apuIndirectos:0,apuModoHora:"AUTO",apuCostoHoraManual:0,planos:nc(),pais:"CO",divisa:"COP",borradorLineas:[],pctU:.07,gg:.13,bi:.06,orgNodos:[],matProveedores:[],matCotizaciones:{},ofertaEquipos:[]};function Qn(t){const{tarifaIVA:i,margen:o,tipoProyecto:n,subtipoDiseno:a,medioPago:r,aplicar4x1000:s,pctRCE:d,pctTRC:u,pctAdm:b,pctICA:j,pctReteFuente:w,pctReteICA:S,pctReteIVA:m,costosDirectos:x,apuSalarioAnual:p,apuPrestaciones:c,apuHDia:g,apuDiasSem:l,apuSemanas:f,apuPctProductivas:y,apuLicencias:h,apuEquipos:v,apuAccesorios:A,apuIndirectos:z,apuModoHora:k,apuCostoHoraManual:T,planos:C}=t,D=g*l*f*y,K=p*(1+c)+Number(h)+Number(v)+Number(A)+Number(z),oe=k==="MANUAL"?Number(T):D>0?K/D:0,te=I=>a===Ls[0]?I.horasArq:a===Ls[1]?I.horasInt:I.horasEsp,P=C.filter(I=>I.incluir).reduce((I,$)=>I+Number($.cant)*te($),0),ie=P*oe,me=x.filter(I=>I.tipo==="M").reduce((I,$)=>I+(parseFloat($.valor)||0),0),Q=x.filter(I=>I.tipo==="MO").reduce((I,$)=>I+(parseFloat($.valor)||0),0),je=x.filter(I=>I.tipo==="SUB").reduce((I,$)=>I+(parseFloat($.valor)||0),0),re=(t.borradorLineas||[]).filter(I=>!I.esCapitulo).reduce((I,$)=>I+($.precioCD||0),0),M=re>0?re:me+Q+je+(n==="DISEO"?ie:0),B=t.ivaComision??.19;let V=0;r==="PSE"?V=(t.pctComPSE??.012)*(1+B):r==="Tarjeta"?V=(t.pctComTarjeta??.036)*(1+B):r==="Transferencia"?V=(t.pctComTransf??0)*(1+B):r==="Manual"&&(V=t.pctComManual??0);const R=V+(s==="SI"?.004:0),W=d+u+b+j,se=t.modoCalcObra||"margen",le=t.ggPct||0;let de,Z,ue,N,G,L;if(n==="OBRA"&&(t.pais||"CO")==="CO"&&se==="aiu"){const I=t.aiuA??.08,$=t.aiuI??.03,H=t.aiuU??.07,U=I+$+H,_=M*(1+U);Z=1-W,ue=1-R;const ce=Z*ue;de=ce>0?_/ce:0,N=ce>0?(1+U)/ce:0,G=H,L=U}else{Z=1-o-W-le,ue=1-R;const I=Z*ue;de=I>0?M/I:0,N=I>0?1/I:0,G=n==="OBRA"?t.uDecl??o:o,L=o}const ae=Z*ue,pe=n==="OBRA"?G*de*i:de*i,he=de+pe,ze=(w+S+m)*de,q=n==="OBRA"&&se==="aiu"?de-M-W*de-R*de:L*de;return{COSTO:M,costoDis:ie,cdM:me,cdMO:Q,cdSB:je,f:R,g:W,ggPct:le,den:ae,den1:Z,denGF:ue,coefMult:N,U:G,margenEfectivo:L,hAnio:D,estr:K,costoH:oe,hDis:P,PVP:de,IVA:pe,PVP_IVA:he,GC:W*de,GG:le*de,ICA:j*de,fin:R*de,margenCOP:q,ret:ze,neto:he-ze}}const Je=(t,i=0)=>t==null||isNaN(t)?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:i,minimumFractionDigits:i}).format(t),et=t=>`${(t*100).toFixed(2)}%`,Ct=()=>Math.random().toString(36).substr(2,9),Dt=()=>new Date().toISOString().split("T")[0];async function ph(){try{const t=localStorage.getItem("hab:v4");return t?JSON.parse(t):[]}catch{return[]}}async function Ha(t){try{localStorage.setItem("hab:v4",JSON.stringify(t))}catch(i){console.error(i)}}async function ma(){try{const t=[];for(let i=0;i<localStorage.length;i++){const o=localStorage.key(i);if(o&&o.startsWith("shared:hab:briefing:"))try{const n=JSON.parse(localStorage.getItem(o));n&&t.push(n)}catch{}}return t.sort((i,o)=>new Date(o.fecha||0)-new Date(i.fecha||0))}catch{return[]}}async function Ws(t){try{localStorage.setItem("shared:hab:briefing:"+t.id,JSON.stringify(t))}catch{}}async function gh(t){try{localStorage.removeItem("shared:hab:briefing:"+t)}catch{}}function Ns(t){var i,o,n,a;return{cliente:t.nombre||"",email:t.email||"",telefono:t.telefono||"",ubicacion:[t.ciudad,t.edificio].filter(Boolean).join("  ")||"",proyecto:[t.edificio,(i=t.nombre)==null?void 0:i.split(" ").slice(-1)[0]].filter(Boolean).join("  ")||"",estado:"Prospecto",notas:[(o=t.estilo)!=null&&o.length?`Estilo: ${Array.isArray(t.estilo)?t.estilo.join(", "):t.estilo}`:"",(n=t.espacios)!=null&&n.length?`Espacios: ${Array.isArray(t.espacios)?t.espacios.join(", "):t.espacios}`:"",t.colores_materiales?`Materiales: ${t.colores_materiales}`:"",(a=t.que_esperas)!=null&&a.length?`Expectativas: ${Array.isArray(t.que_esperas)?t.que_esperas.join("; "):t.que_esperas}`:"",t.links_ref?`Referencias: ${t.links_ref}`:""].filter(Boolean).join(`
`),razonSocial:t.razon_social||"",documento:t.documento||"",emailFactura:t.email_factura||t.email||"",dirFacturacion:t.dir_facturacion||"",retencion:t.retenciones==="S",detalleRet:t.detalle_retenciones||"",anticipoAcept:t.anticipo||"",formaPago:t.forma_pago||"",briefingId:t.id}}function rc(t){return{id:Math.random().toString(36).slice(2,9),nombre:t.razon_social||t.nombre||"",tipo:t.razon_social?"Empresa":"Persona natural",nit:t.documento||"",email:t.email||"",telMovil:t.telefono||"",prefijoMovil:"+57",ciudad:t.ciudad||"",pais:"CO",notas:[t.edificio?`Proyecto: ${t.edificio}`:"",t.tipo_proyecto?`Tipo: ${t.tipo_proyecto}`:"",t.area_m2?`rea: ${t.area_m2} m`:"",t.presupuesto?`Presupuesto: $ ${Number(t.presupuesto).toLocaleString("es-CO")}`:"",t.como_conociste?`Canal: ${t.como_conociste}`:""].filter(Boolean).join(" | "),emailFactura:t.email_factura||t.email||"",dirFacturacion:t.dir_facturacion||"",briefingId:t.id,fechaAlta:new Date().toISOString().split("T")[0]}}const Us=({e:t})=>{const i=Hl[t]||Hl.Borrador;return e.jsx("span",{style:{background:i.bg,color:i.txt,padding:"3px 10px",borderRadius:2,fontSize:10,fontWeight:600,letterSpacing:.8,textTransform:"uppercase",display:"inline-block",whiteSpace:"nowrap",fontFamily:"'DM Sans', sans-serif"},children:t})},Ke=({children:t,style:i,...o})=>e.jsx("div",{style:{background:E.surface,borderRadius:3,boxShadow:E.shadow,border:`1px solid ${E.border}`,...i},...o,children:t}),ht=({children:t,v:i="pri",on:o,icon:n,sm:a,style:r,dis:s,...d})=>{const u={display:"inline-flex",alignItems:"center",gap:6,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontWeight:500,cursor:s?"not-allowed":"pointer",transition:"all .15s",border:"none",fontSize:a?11:12,padding:a?"5px 11px":"9px 16px",letterSpacing:.4,opacity:s?.5:1,...r},b={pri:{background:E.ink,color:"#fff"},sec:{background:E.accentBg,color:E.ink},ghost:{background:"transparent",color:E.inkMid},danger:{background:E.errorBg,color:E.error},out:{background:"transparent",color:E.ink,border:`1px solid ${E.borderMid}`}};return e.jsxs("button",{style:{...u,...b[i]},onClick:o,disabled:s,...d,children:[n&&e.jsx(n,{size:a?12:13}),t]})},st=({lbl:t,val:i,on:o,type:n="text",ph:a,rt:r,note:s,step:d,min:u,style:b})=>{const[j,w]=F.useState(String(i??"")),[S,m]=F.useState(!1);return F.useEffect(()=>{S||w(String(i??""))},[i,S]),e.jsxs("div",{style:{marginBottom:14},children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1,fontFamily:"'DM Sans', sans-serif"},children:t}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:n,value:j,placeholder:a,step:d,min:u,onChange:x=>{w(x.target.value),o(x)},style:{width:"100%",padding:"9px 12px",paddingRight:r?38:12,border:`1px solid ${E.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:E.ink,background:E.bg,transition:"border .15s",...b},onFocus:x=>{m(!0),x.target.style.borderColor=E.ink,x.target.select()},onBlur:x=>{m(!1),x.target.style.borderColor=E.border}}),r&&e.jsx("span",{style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",fontSize:11,color:E.inkLight},children:r})]}),s&&e.jsx("p",{style:{fontSize:10,color:E.inkLight,margin:"3px 0 0"},children:s})]})},jn=({lbl:t,val:i,on:o,opts:n,note:a})=>e.jsxs("div",{style:{marginBottom:14},children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:t}),e.jsx("select",{value:i,onChange:o,style:{width:"100%",padding:"9px 12px",border:`1px solid ${E.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:E.ink,background:E.bg},onFocus:r=>r.target.style.borderColor=E.ink,onBlur:r=>r.target.style.borderColor=E.border,children:n.map(r=>e.jsx("option",{value:r.v??r,children:r.l??r},r.v??r))}),a&&e.jsx("p",{style:{fontSize:10,color:E.inkLight,margin:"3px 0 0"},children:a})]}),vt=({t,s:i})=>e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h3",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:15,fontWeight:600,color:E.ink,margin:0,letterSpacing:.2,textTransform:"uppercase"},children:t}),i&&e.jsx("p",{style:{fontSize:11,color:E.inkLight,margin:"3px 0 0",fontWeight:400},children:i})]}),_r=({lbl:t,val:i,icon:o,col:n,sub:a})=>e.jsx(Ke,{style:{padding:"18px 20px",flex:1,minWidth:150},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,fontWeight:600,color:E.inkLight,margin:"0 0 8px",textTransform:"uppercase",letterSpacing:1.5},children:t}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:22,fontWeight:700,color:n,margin:0},children:i}),a&&e.jsx("p",{style:{fontSize:10,color:E.inkLight,margin:"4px 0 0"},children:a})]}),e.jsx("div",{style:{background:`${n}15`,borderRadius:2,padding:8},children:e.jsx(o,{size:15,color:n})})]})}),uh=[{key:"nombre",lbl:"Nombre",icon:""},{key:"email",lbl:"Email",icon:""},{key:"telefono",lbl:"Telfono",icon:""},{key:"como_conociste",lbl:"Cmo nos conoci?",icon:""},{key:"ciudad",lbl:"Ciudad",icon:""},{key:"edificio",lbl:"Edificio / Conjunto",icon:""},{key:"direccion_proyecto",lbl:"Direccin proyecto",icon:""},{key:"tipo_proyecto",lbl:"Tipo de proyecto",icon:""},{key:"area_m2",lbl:"rea (m)",icon:""},{key:"num_habitaciones",lbl:"Habitaciones / reas",icon:""},{key:"estilo",lbl:"Estilo preferido",icon:""},{key:"colores_materiales",lbl:"Colores y materiales",icon:""},{key:"espacios",lbl:"Espacios a intervenir",icon:""},{key:"fecha_inicio",lbl:"Fecha tentativa inicio",icon:""},{key:"plazo",lbl:"Plazo de finalizacin",icon:""},{key:"presupuesto",lbl:"Presupuesto (COP)",icon:""},{key:"financiacion",lbl:"Financiacin",icon:""},{key:"lo_mas_importante",lbl:"Prioridad principal",icon:""},{key:"que_esperas",lbl:"Qu espera lograr?",icon:""},{key:"contratistas",lbl:"Recomendar contratistas?",icon:""},{key:"forma_pago",lbl:"Forma de pago",icon:""},{key:"razon_social",lbl:"Razn social",icon:""},{key:"documento",lbl:"Documento",icon:""},{key:"email_factura",lbl:"Email facturacin",icon:""},{key:"dir_facturacion",lbl:"Direccin facturacin",icon:""},{key:"retenciones",lbl:"Retenciones especiales",icon:""},{key:"detalle_retenciones",lbl:"Detalle retenciones",icon:""}];function hh({b:t,onClose:i,onCreateOffer:o,onCreateClient:n}){const a=(s,d)=>!d||d===""?"":Array.isArray(d)?d.join(", "):s==="presupuesto"?`$ ${Number(d).toLocaleString("es-CO")} COP`:String(d),r=uh.filter(s=>t[s.key]&&t[s.key]!=="");return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:s=>s.target===s.currentTarget&&i(),children:e.jsxs("div",{style:{background:E.surface,borderRadius:4,width:"100%",maxWidth:680,maxHeight:"85vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:E.shadowMd},children:[e.jsxs("div",{style:{padding:"18px 22px",borderBottom:`1px solid ${E.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:16,fontWeight:700,margin:0},children:t.nombre||"Sin nombre"}),e.jsxs("p",{style:{fontSize:11,color:E.inkLight,margin:"3px 0 0",letterSpacing:.5},children:["Briefing recibido  ",t.fecha||"","  ",t.ciudad||""]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[n&&e.jsx("button",{onClick:n,style:{padding:"8px 16px",background:E.infoBg,color:E.info,border:`1px solid ${E.info}33`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:700,cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"+ Crear cliente"}),e.jsx("button",{onClick:o,style:{padding:"8px 16px",background:E.ink,color:"#fff",border:"none",borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:700,cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"+ Crear oferta"}),e.jsx("button",{onClick:i,style:{padding:"8px 12px",background:"transparent",border:`1px solid ${E.border}`,borderRadius:3,cursor:"pointer",color:E.inkMid},children:e.jsx($t,{size:14})})]})]}),e.jsxs("div",{style:{overflowY:"auto",padding:"18px 22px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:r.map(s=>e.jsxs("div",{style:{padding:"10px 12px",background:E.bg,borderRadius:3,border:`1px solid ${E.border}`},children:[e.jsxs("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:E.inkLight,margin:"0 0 4px"},children:[s.icon," ",s.lbl]}),e.jsx("p",{style:{fontSize:13,fontWeight:500,color:E.ink,margin:0,lineHeight:1.4},children:a(s.key,t[s.key])})]},s.key))}),t.links_ref&&e.jsxs("div",{style:{marginTop:10,padding:"10px 12px",background:E.infoBg,borderRadius:3,border:`1px solid ${E.info}22`},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:E.info,margin:"0 0 4px"},children:" Links de referencia"}),e.jsx("p",{style:{fontSize:12,color:E.ink,margin:0,wordBreak:"break-all"},children:t.links_ref})]})]})]})})}async function fh(){var t;try{const i=[];for(let a=0;a<localStorage.length;a++){const r=localStorage.key(a);r&&r.startsWith("hab:forms:")&&i.push(r)}const o={keys:i};return(t=o==null?void 0:o.keys)!=null&&t.length?(await Promise.all(o.keys.map(a=>Promise.resolve(localStorage.getItem(a)).then(r=>r?JSON.parse(r):null).catch(()=>null)))).filter(Boolean).sort((a,r)=>(r.updatedAt||"").localeCompare(a.updatedAt||"")):[]}catch{return[]}}async function xh(t){try{t.updatedAt=new Date().toISOString(),localStorage.setItem(`hab:forms:${t.id}`,JSON.stringify(t))}catch{}}async function mh(t){try{localStorage.removeItem(`hab:forms:${t}`)}catch{}}const Dr=()=>Math.random().toString(36).slice(2,8),bh=[{nombre:"Briefing Diseo Interior",desc:"Formulario completo para proyectos de diseo",icon:"",config:{titulo:"Cuntanos sobre tu proyecto",subtitulo:"Solo toma 5-7 minutos. Tus respuestas nos ayudan a preparar una propuesta personalizada.",mensajeExito:"Gracias! Nos pondremos en contacto pronto con tu propuesta.",telRespuesta:"573183818736"},campos:[{tipo:"seccion",label:"Datos personales",icon:"",desc:"Informacin de contacto"},{tipo:"text",label:"Nombre completo",required:!0,mapKey:"nombre"},{tipo:"email",label:"Correo electrnico",required:!0,mapKey:"email"},{tipo:"tel",label:"WhatsApp / Celular",required:!0,mapKey:"telefono"},{tipo:"select",label:"Cmo nos conociste?",mapKey:"como_conociste",opciones:["Instagram","Google","Referido","Pgina web","Evento","Otro"]},{tipo:"seccion",label:"Tu proyecto",icon:""},{tipo:"text",label:"Ciudad",required:!0,mapKey:"ciudad"},{tipo:"text",label:"Edificio / Conjunto",mapKey:"edificio"},{tipo:"text",label:"Direccin del proyecto",mapKey:"direccion_proyecto"},{tipo:"select",label:"Tipo de proyecto",required:!0,mapKey:"tipo_proyecto",opciones:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"]},{tipo:"number",label:"rea aproximada (m)",mapKey:"area_m2"},{tipo:"text",label:"Nmero de habitaciones o reas",mapKey:"num_habitaciones"},{tipo:"seccion",label:"Estilo y preferencias",icon:""},{tipo:"chips",label:"Estilos que te gustan",mapKey:"estilo",opciones:["Moderno","Contemporneo","Minimalista","Industrial","Nrdico","Clsico","Rstico","Eclctico","Japandi","Otro"]},{tipo:"chips",label:"Espacios a intervenir",mapKey:"espacios",opciones:["Sala","Comedor","Cocina","Hab. principal","Hab. secundaria","Bao social","Bao privado","Estudio","Terraza/Balcn","Lavandera"]},{tipo:"textarea",label:"Colores y materiales que te gustan",mapKey:"colores_materiales",placeholder:"Ej: tonos clidos, madera natural, mrmol..."},{tipo:"textarea",label:"Links de referencia (Pinterest, Instagram...)",mapKey:"links_ref",placeholder:"Pega aqu los links de inspiracin"},{tipo:"seccion",label:"Presupuesto y tiempos",icon:""},{tipo:"rango",label:"Presupuesto aproximado",mapKey:"presupuesto",opciones:["Menos de $20M","$20M - $50M","$50M - $100M","$100M - $200M","Ms de $200M","An no definido"]},{tipo:"select",label:"Financiacin",mapKey:"financiacion",opciones:["Recursos propios","Crdito hipotecario","Leasing","Otro"]},{tipo:"date",label:"Fecha tentativa de inicio",mapKey:"fecha_inicio"},{tipo:"text",label:"Plazo deseado de finalizacin",mapKey:"plazo",placeholder:"Ej: 3 meses"},{tipo:"seccion",label:"Expectativas",icon:""},{tipo:"textarea",label:"Qu es lo ms importante para ti en este proyecto?",mapKey:"lo_mas_importante"},{tipo:"textarea",label:"Qu esperas lograr con el diseo?",mapKey:"que_esperas"},{tipo:"radio",label:"Necesitas que recomendemos contratistas?",mapKey:"contratistas",opciones:["S","No","Tal vez"]},{tipo:"seccion",label:"Facturacin (opcional)",icon:"",desc:"Solo si necesita factura"},{tipo:"text",label:"Razn social",mapKey:"razon_social"},{tipo:"text",label:"NIT / Cdula",mapKey:"documento"},{tipo:"email",label:"Email de facturacin",mapKey:"email_factura"},{tipo:"text",label:"Direccin de facturacin",mapKey:"dir_facturacion"},{tipo:"radio",label:"Tiene retenciones especiales?",mapKey:"retenciones",opciones:["No","S"]},{tipo:"radio",label:"Confirmo que la informacin es correcta",mapKey:"confirmacion",required:!0,opciones:["S"]}]},{nombre:"Briefing Obra / Remodelacin",desc:"Enfocado en construccin y remodelacin",icon:"",config:{titulo:"Cuntanos sobre tu obra",subtitulo:"Necesitamos algunos datos para preparar tu presupuesto.",mensajeExito:"Gracias! Te enviaremos el presupuesto pronto.",telRespuesta:"573183818736"},campos:[{tipo:"seccion",label:"Datos de contacto",icon:""},{tipo:"text",label:"Nombre completo",required:!0,mapKey:"nombre"},{tipo:"email",label:"Correo electrnico",required:!0,mapKey:"email"},{tipo:"tel",label:"WhatsApp / Celular",required:!0,mapKey:"telefono"},{tipo:"seccion",label:"La obra",icon:""},{tipo:"text",label:"Ciudad",required:!0,mapKey:"ciudad"},{tipo:"text",label:"Direccin de la obra",mapKey:"direccion_proyecto"},{tipo:"select",label:"Tipo de obra",required:!0,mapKey:"tipo_proyecto",opciones:["Remodelacin total","Remodelacin parcial","Obra nueva","Ampliacin","Adecuacin","Otro"]},{tipo:"number",label:"rea total (m)",mapKey:"area_m2"},{tipo:"chips",label:"reas a intervenir",mapKey:"espacios",opciones:["Estructura","Mampostera","Pisos","Cielos","Cocina","Baos","Instalaciones elctricas","Instalaciones hidrulicas","Pintura","Carpintera","Fachada"]},{tipo:"textarea",label:"Descripcin de lo que necesita",mapKey:"lo_mas_importante",placeholder:"Describe brevemente el alcance de la obra"},{tipo:"seccion",label:"Tiempos y presupuesto",icon:""},{tipo:"rango",label:"Presupuesto aproximado",mapKey:"presupuesto",opciones:["Menos de $30M","$30M - $80M","$80M - $150M","$150M - $300M","Ms de $300M","Sin definir"]},{tipo:"date",label:"Fecha deseada de inicio",mapKey:"fecha_inicio"},{tipo:"text",label:"Plazo esperado",mapKey:"plazo"},{tipo:"radio",label:"Ya tiene planos?",mapKey:"tiene_planos",opciones:["S","No","En proceso"]},{tipo:"radio",label:"Ya tiene permisos/licencias?",mapKey:"tiene_licencias",opciones:["S","No","En trmite","No s si aplica"]},{tipo:"seccion",label:"Facturacin",icon:""},{tipo:"text",label:"Razn social",mapKey:"razon_social"},{tipo:"text",label:"NIT / Cdula",mapKey:"documento"},{tipo:"email",label:"Email de facturacin",mapKey:"email_factura"}]},{nombre:"Encuesta de satisfaccin",desc:"Post-proyecto para feedback del cliente",icon:"",config:{titulo:"Cmo fue tu experiencia?",subtitulo:"Tu opinin nos ayuda a mejorar.",mensajeExito:"Gracias por tu feedback! Lo valoramos mucho.",telRespuesta:"573183818736"},campos:[{tipo:"text",label:"Nombre",required:!0,mapKey:"nombre"},{tipo:"text",label:"Proyecto",mapKey:"edificio"},{tipo:"radio",label:"Satisfaccin general",required:!0,mapKey:"satisfaccion",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Calidad del diseo",mapKey:"calidad_diseno",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Comunicacin del equipo",mapKey:"comunicacion",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Cumplimiento de plazos",mapKey:"cumplimiento",opciones:[" Excelente"," Bueno"," Regular"," Malo"]},{tipo:"radio",label:"Nos recomendara?",required:!0,mapKey:"recomendaria",opciones:["Definitivamente s","Probablemente s","No estoy seguro","Probablemente no"]},{tipo:"textarea",label:"Qu fue lo mejor del proyecto?",mapKey:"lo_mejor"},{tipo:"textarea",label:"Qu podramos mejorar?",mapKey:"mejorar"},{tipo:"textarea",label:"Comentarios adicionales",mapKey:"comentarios"}]}],Ga=[{tipo:"text",label:"Texto corto",icon:"Aa"},{tipo:"email",label:"Email",icon:"@"},{tipo:"tel",label:"Telfono",icon:""},{tipo:"number",label:"Nmero",icon:"#"},{tipo:"date",label:"Fecha",icon:""},{tipo:"textarea",label:"Texto largo",icon:""},{tipo:"select",label:"Desplegable",icon:""},{tipo:"radio",label:"Opcin nica",icon:""},{tipo:"chips",label:"Seleccin mlt.",icon:""},{tipo:"rango",label:"Rango",icon:""},{tipo:"seccion",label:"Separador",icon:""}];function yh(){var K,oe,te,P,ie,me;const[t,i]=F.useState([]),[o,n]=F.useState(!0),[a,r]=F.useState(null),[s,d]=F.useState(!1),[u,b]=F.useState(null),[j,w]=F.useState(""),[S,m]=F.useState(""),[x,p]=F.useState(""),[c,g]=F.useState(!1);F.useEffect(()=>{fh().then(Q=>{i(Q),n(!1)})},[]);const l=Q=>{const je={id:Dr()+Date.now().toString(36),nombre:Q.nombre,config:{...Q.config},campos:Q.campos.map(re=>({...re,id:re.id||Dr()})),createdAt:new Date().toISOString()};r(je)},f=()=>{r({id:Dr()+Date.now().toString(36),nombre:"Nuevo formulario",config:{titulo:"",subtitulo:"",mensajeExito:"Gracias por tu respuesta!",telRespuesta:"573183818736"},campos:[],createdAt:new Date().toISOString()})},y=async()=>{a&&(await xh(a),i(Q=>Q.find(re=>re.id===a.id)?Q.map(re=>re.id===a.id?a:re):[a,...Q]),r(null))},h=async Q=>{window.confirm("Eliminar este formulario?")&&(await mh(Q),i(je=>je.filter(re=>re.id!==Q)))},v=Q=>{const je=oc(Q);return`${window.location.origin}/form#${je}`},A=Q=>{var je;try{const re=v(Q);(je=navigator.clipboard)==null||je.writeText(re),g(!0),setTimeout(()=>g(!1),2e3)}catch{}},z=Q=>{var M;const je=v(Q),re=`Hola${x?` ${x}`:""}!  Te invitamos a completar este formulario:

 ${((M=Q.config)==null?void 0:M.titulo)||Q.nombre}
${je}

Gracias!`,J=j.replace(/\D/g,"");window.open(J?`https://wa.me/57${J}?text=${encodeURIComponent(re)}`:`https://wa.me/?text=${encodeURIComponent(re)}`,"_blank")},k=Q=>{var M,B;const je=v(Q),re=encodeURIComponent(((M=Q.config)==null?void 0:M.titulo)||Q.nombre),J=encodeURIComponent(`Hola${x?` ${x}`:""},

Te invitamos a completar este formulario:

${((B=Q.config)==null?void 0:B.titulo)||Q.nombre}
${je}

Gracias!
Equipo Habitaris`);window.open(`mailto:${S}?subject=${re}&body=${J}`,"_blank")},T={width:"100%",padding:"7px 10px",border:`1px solid ${E.border}`,borderRadius:4,fontFamily:"'DM Sans',sans-serif",fontSize:12,background:E.surface,color:E.ink,boxSizing:"border-box"},C={fontSize:9,fontWeight:600,color:E.inkLight,display:"block",marginBottom:4,textTransform:"uppercase",letterSpacing:1};if(a){const Q=a,je=V=>r(X=>({...X,...V})),re=(V,X)=>r(R=>({...R,campos:R.campos.map((W,se)=>se===V?{...W,...X}:W)})),J=V=>r(X=>({...X,campos:X.campos.filter((R,W)=>W!==V)})),M=(V,X)=>r(R=>{const W=[...R.campos],se=V+X;return se<0||se>=W.length?R:([W[V],W[se]]=[W[se],W[V]],{...R,campos:W})}),B=V=>{var R;const X={id:Dr(),tipo:V,label:((R=Ga.find(W=>W.tipo===V))==null?void 0:R.label)||V,required:!1,mapKey:""};["select","radio","chips","rango"].includes(V)&&(X.opciones=["Opcin 1","Opcin 2"]),V==="seccion"&&(X.icon="",X.desc=""),r(W=>({...W,campos:[...W.campos,X]}))};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("button",{onClick:()=>{window.confirm("Descartar cambios?")&&r(null)},style:{background:"none",border:"none",cursor:"pointer",color:E.inkMid,padding:4},children:e.jsx(kd,{size:18})}),e.jsxs("div",{children:[e.jsx("input",{value:Q.nombre,onChange:V=>je({nombre:V.target.value}),style:{border:"none",fontSize:18,fontWeight:700,fontFamily:"'DM Sans',sans-serif",background:"transparent",width:320},placeholder:"Nombre del formulario"}),e.jsxs("p",{style:{fontSize:10,color:E.inkLight,margin:0},children:[Q.campos.length," campos"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(ht,{v:"out",on:()=>d(!s),children:s?" Editar":" Preview"}),e.jsx(ht,{icon:ft,on:y,children:"Guardar formulario"})]})]}),!s&&e.jsx(Ke,{style:{padding:16,marginBottom:16,borderLeft:`3px solid ${E.info}`},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:C,children:"Ttulo visible al cliente"}),e.jsx("input",{value:((K=Q.config)==null?void 0:K.titulo)||"",onChange:V=>je({config:{...Q.config,titulo:V.target.value}}),style:T,placeholder:"Cuntanos sobre tu proyecto"})]}),e.jsxs("div",{children:[e.jsx("label",{style:C,children:"Subttulo"}),e.jsx("input",{value:((oe=Q.config)==null?void 0:oe.subtitulo)||"",onChange:V=>je({config:{...Q.config,subtitulo:V.target.value}}),style:T,placeholder:"Solo toma 5 minutos"})]}),e.jsxs("div",{children:[e.jsx("label",{style:C,children:"Mensaje al enviar"}),e.jsx("input",{value:((te=Q.config)==null?void 0:te.mensajeExito)||"",onChange:V=>je({config:{...Q.config,mensajeExito:V.target.value}}),style:T})]}),e.jsxs("div",{children:[e.jsx("label",{style:C,children:"WhatsApp de respuestas"}),e.jsx("input",{value:((P=Q.config)==null?void 0:P.telRespuesta)||"",onChange:V=>je({config:{...Q.config,telRespuesta:V.target.value}}),style:T,placeholder:"573183818736"})]})]})}),s?e.jsxs(Ke,{style:{padding:24,maxWidth:640,margin:"0 auto"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:20},children:[e.jsx("h2",{style:{fontSize:18,fontWeight:700,margin:"0 0 4px"},children:((ie=Q.config)==null?void 0:ie.titulo)||Q.nombre}),((me=Q.config)==null?void 0:me.subtitulo)&&e.jsx("p",{style:{fontSize:12,color:E.inkMid},children:Q.config.subtitulo})]}),Q.campos.map((V,X)=>V.tipo==="seccion"?e.jsxs("div",{style:{marginTop:20,marginBottom:8,paddingTop:12,borderTop:`2px solid ${E.ink}`},children:[e.jsxs("h3",{style:{fontSize:13,fontWeight:700},children:[V.icon||""," ",V.label]}),V.desc&&e.jsx("p",{style:{fontSize:11,color:E.inkMid},children:V.desc})]},X):e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("label",{style:{fontSize:11,fontWeight:600,display:"block",marginBottom:4},children:[V.label,V.required&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),["text","email","tel","number","date"].includes(V.tipo)&&e.jsx("input",{disabled:!0,style:{...T,opacity:.6},placeholder:V.placeholder||"",type:V.tipo}),V.tipo==="textarea"&&e.jsx("textarea",{disabled:!0,rows:2,style:{...T,opacity:.6,resize:"none"},placeholder:V.placeholder||""}),(V.tipo==="select"||V.tipo==="rango")&&e.jsx("select",{disabled:!0,style:{...T,opacity:.6},children:e.jsx("option",{children:(V.opciones||[])[0]||"..."})}),V.tipo==="radio"&&e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:2},children:(V.opciones||[]).map(R=>e.jsxs("label",{style:{fontSize:11,display:"flex",gap:4,alignItems:"center"},children:[e.jsx("input",{type:"radio",disabled:!0}),R]},R))}),V.tipo==="chips"&&e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:2},children:(V.opciones||[]).map(R=>e.jsx("span",{style:{padding:"3px 10px",fontSize:10,border:`1px solid ${E.border}`,borderRadius:20},children:R},R))})]},X))]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[Q.campos.map((V,X)=>{var R;return e.jsxs(Ke,{style:{padding:"10px 14px",borderLeft:V.tipo==="seccion"?`3px solid ${E.ink}`:`3px solid ${E.border}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2,alignItems:"center",paddingTop:2},children:[e.jsx("button",{onClick:()=>M(X,-1),disabled:X===0,style:{background:"none",border:"none",cursor:X>0?"pointer":"default",opacity:X>0?1:.3,fontSize:10,padding:0},children:""}),e.jsx("span",{style:{fontSize:8,color:E.inkLight,background:E.bg,borderRadius:2,padding:"1px 5px",letterSpacing:.5,textTransform:"uppercase"},children:((R=Ga.find(W=>W.tipo===V.tipo))==null?void 0:R.icon)||"?"}),e.jsx("button",{onClick:()=>M(X,1),disabled:X===Q.campos.length-1,style:{background:"none",border:"none",cursor:X<Q.campos.length-1?"pointer":"default",opacity:X<Q.campos.length-1?1:.3,fontSize:10,padding:0},children:""})]}),e.jsxs("div",{style:{flex:1,display:"grid",gridTemplateColumns:V.tipo==="seccion"?"1fr auto":"2fr 1fr 1fr auto",gap:6,alignItems:"center"},children:[e.jsx("input",{value:V.label,onChange:W=>re(X,{label:W.target.value}),style:{...T,fontWeight:V.tipo==="seccion"?700:400,fontSize:V.tipo==="seccion"?13:12},placeholder:"Etiqueta"}),V.tipo!=="seccion"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{value:V.mapKey||"",onChange:W=>re(X,{mapKey:W.target.value}),style:{...T,fontSize:10,fontFamily:"'DM Mono',monospace"},placeholder:"clave",title:"Clave para mapeo a briefing"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:10,color:E.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:!!V.required,onChange:W=>re(X,{required:W.target.checked})}),"Obligatorio"]})]}),e.jsx("button",{onClick:()=>J(X),style:{background:"none",border:"none",cursor:"pointer",color:E.error,padding:2},children:e.jsx(qe,{size:12})})]})]}),["select","radio","chips","rango"].includes(V.tipo)&&e.jsxs("div",{style:{marginTop:6,marginLeft:28},children:[e.jsx("label",{style:{...C,marginBottom:3},children:"Opciones (una por lnea)"}),e.jsx("textarea",{value:(V.opciones||[]).join(`
`),onChange:W=>re(X,{opciones:W.target.value.split(`
`)}),rows:Math.min((V.opciones||[]).length+1,6),style:{...T,fontSize:11,resize:"vertical"}})]}),["text","email","tel","number","textarea"].includes(V.tipo)&&e.jsx("div",{style:{marginTop:4,marginLeft:28},children:e.jsx("input",{value:V.placeholder||"",onChange:W=>re(X,{placeholder:W.target.value}),style:{...T,fontSize:10,color:E.inkLight},placeholder:"Placeholder (opcional)"})}),V.tipo==="seccion"&&e.jsxs("div",{style:{marginTop:4,marginLeft:28,display:"flex",gap:6},children:[e.jsx("input",{value:V.icon||"",onChange:W=>re(X,{icon:W.target.value}),style:{...T,width:40,textAlign:"center"},placeholder:""}),e.jsx("input",{value:V.desc||"",onChange:W=>re(X,{desc:W.target.value}),style:{...T,flex:1,fontSize:10},placeholder:"Descripcin de la seccin"})]})]},V.id||X)}),e.jsxs(Ke,{style:{padding:"12px 16px",background:E.bg,borderStyle:"dashed"},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:E.inkLight,margin:"0 0 8px"},children:"Agregar campo"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:Ga.map(V=>e.jsxs("button",{onClick:()=>B(V.tipo),style:{padding:"5px 10px",fontSize:10,fontFamily:"'DM Sans',sans-serif",border:`1px solid ${E.border}`,borderRadius:4,background:E.surface,cursor:"pointer",color:E.ink,display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{fontSize:11},children:V.icon})," ",V.label]},V.tipo))})]})]})]})}const D=u&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:Q=>Q.target===Q.currentTarget&&b(null),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",padding:24,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("h3",{style:{fontSize:15,fontWeight:700,margin:0},children:[" Compartir: ",u.nombre]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:E.inkMid},children:e.jsx($t,{size:18})})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:C,children:"Link del formulario"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("div",{style:{flex:1,padding:"8px 10px",background:E.bg,border:`1px solid ${E.border}`,borderRadius:4,fontSize:10,color:E.inkMid,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:"'DM Mono',monospace"},children:v(u)}),e.jsx("button",{onClick:()=>A(u),style:{padding:"8px 14px",border:`1px solid ${E.border}`,borderRadius:4,fontSize:11,fontWeight:600,background:c?E.successBg:E.surface,color:c?E.success:E.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap"},children:c?" Copiado":" Copiar"})]})]}),e.jsx("div",{style:{marginBottom:16,textAlign:"center"},children:e.jsx("a",{href:v(u),target:"_blank",rel:"noreferrer",style:{fontSize:11,color:E.info},children:" Ver preview en nueva pestaa"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("label",{style:C,children:"Nombre (opc.)"}),e.jsx("input",{value:x,onChange:Q=>p(Q.target.value),style:T,placeholder:"Juan"})]}),e.jsxs("div",{children:[e.jsx("label",{style:C,children:"WhatsApp"}),e.jsx("input",{value:j,onChange:Q=>w(Q.target.value),style:T,placeholder:"300 123 4567"})]}),e.jsxs("div",{children:[e.jsx("label",{style:C,children:"Email"}),e.jsx("input",{value:S,onChange:Q=>m(Q.target.value),style:T,placeholder:"juan@mail.com"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>z(u),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"12px",background:"#25D366",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:700,color:"#fff",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(xr,{size:16})," WhatsApp"]}),e.jsxs("button",{onClick:()=>k(u),disabled:!S,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"12px",background:S?E.ink:E.bg,border:"none",borderRadius:6,cursor:S?"pointer":"default",fontSize:13,fontWeight:600,color:S?"#fff":E.inkLight,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(En,{size:16})," Email"]})]})]})});return e.jsxs("div",{className:"fade",children:[D,e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("p",{style:{fontSize:10,letterSpacing:1.5,textTransform:"uppercase",color:E.inkLight,margin:"0 0 10px"},children:"Crear desde plantilla"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:10},children:[bh.map((Q,je)=>e.jsxs("div",{onClick:()=>l(Q),style:{background:E.surface,border:`1px solid ${E.border}`,borderRadius:6,padding:16,cursor:"pointer",transition:"all .15s"},onMouseEnter:re=>{re.currentTarget.style.borderColor=E.ink,re.currentTarget.style.boxShadow=E.shadowSm},onMouseLeave:re=>{re.currentTarget.style.borderColor=E.border,re.currentTarget.style.boxShadow="none"},children:[e.jsx("div",{style:{fontSize:28,marginBottom:8},children:Q.icon}),e.jsx("div",{style:{fontSize:13,fontWeight:700,marginBottom:2},children:Q.nombre}),e.jsx("div",{style:{fontSize:11,color:E.inkLight},children:Q.desc}),e.jsxs("div",{style:{fontSize:9,color:E.inkXLight,marginTop:6},children:[Q.campos.length," campos"]})]},je)),e.jsxs("div",{onClick:f,style:{background:E.bg,border:`2px dashed ${E.border}`,borderRadius:6,padding:16,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:120,transition:"all .15s"},onMouseEnter:Q=>Q.currentTarget.style.borderColor=E.ink,onMouseLeave:Q=>Q.currentTarget.style.borderColor=E.border,children:[e.jsx(Pe,{size:24,style:{color:E.inkLight,marginBottom:6}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:E.inkMid},children:"En blanco"})]})]})]}),o?e.jsx("div",{style:{textAlign:"center",padding:40,color:E.inkLight},children:"Cargando..."}):t.length>0&&e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:10,letterSpacing:1.5,textTransform:"uppercase",color:E.inkLight,margin:"0 0 10px"},children:["Mis formularios (",t.length,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map(Q=>{var je;return e.jsxs("div",{style:{background:E.surface,border:`1px solid ${E.border}`,borderRadius:4,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:Q.nombre}),e.jsxs("div",{style:{fontSize:10,color:E.inkLight,marginTop:2},children:[((je=Q.campos)==null?void 0:je.length)||0," campos  ",Q.updatedAt?new Date(Q.updatedAt).toLocaleDateString("es-CO"):""]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>b(Q),style:{padding:"6px 12px",background:"#25D366",color:"#fff",border:"none",borderRadius:4,fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Compartir"}),e.jsx("button",{onClick:()=>{var re;return r({...Q,campos:((re=Q.campos)==null?void 0:re.map(J=>({...J})))||[]})},style:{padding:"6px 12px",background:E.surface,border:`1px solid ${E.border}`,borderRadius:4,fontSize:10,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Editar"}),e.jsx("button",{onClick:()=>h(Q.id),style:{padding:"6px 8px",background:"transparent",border:`1px solid ${E.border}`,borderRadius:4,cursor:"pointer",color:E.error},children:e.jsx(qe,{size:11})})]})]},Q.id)})})]})]})}function vh(){return e.jsx(yh,{})}function jh({sv:t,onCreateOfferFromBriefing:i,onCreateClientFromBriefing:o}){const[n,a]=F.useState("enviar"),[r,s]=F.useState([]),[d,u]=F.useState(!0),[b,j]=F.useState(null),[w,S]=F.useState(null),[m,x]=F.useState(!1),[p,c]=F.useState(""),[g,l]=F.useState(null);F.useEffect(()=>{ma().then(C=>{s(C),u(!1)})},[]);const f=()=>{u(!0),ma().then(C=>{s(C),u(!1)})},y=async C=>{window.confirm("Eliminar este briefing?")&&(S(C),await gh(C),s(D=>D.filter(K=>K.id!==C)),S(null))},h=async C=>{const D={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0],...C};return await Ws(D),s(K=>[D,...K]),D},v=async()=>{try{let C=JSON.parse(p);if(Array.isArray(C)){for(const D of C)await h(D);alert(` ${C.length} briefing(s) importados`)}else await h(C),alert(" Briefing importado");c(""),x(!1)}catch{alert(" JSON invlido. Copia el JSON exacto de Getformly.")}},A=()=>({nombre:"",email:"",telefono:"",como_conociste:"",ciudad:"",edificio:"",direccion_proyecto:"",tipo_proyecto:"Diseo interior",area_m2:"",num_habitaciones:"",estilo:[],colores_materiales:"",espacios:[],fecha_inicio:"",plazo:"",presupuesto:"",financiacion:"",lo_mas_importante:"",que_esperas:[],contratistas:"",forma_pago:"",razon_social:"",documento:"",email_factura:"",dir_facturacion:"",retenciones:"No",detalle_retenciones:"",links_ref:""}),z=[{id:"enviar",lbl:"Mis formularios",I:zn},{id:"recibidos",lbl:`Recibidos (${r.length})`,I:dl},{id:"ingresar",lbl:"Ingresar manual",I:Wo}],k={width:"100%",padding:"7px 10px",border:`1px solid ${E.border}`,borderRadius:4,fontFamily:"'DM Sans',sans-serif",fontSize:12,background:E.surface,color:E.ink,boxSizing:"border-box"},T={fontSize:9,fontWeight:600,color:E.inkLight,display:"block",marginBottom:4,textTransform:"uppercase",letterSpacing:1};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,letterSpacing:-.5,margin:"0 0 4px"},children:"Formularios"}),e.jsx("p",{style:{fontSize:12,color:E.inkLight,margin:0},children:"Enva el briefing, ingresa respuestas y crea clientes y ofertas"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>x(!0),style:{padding:"7px 14px",border:`1px solid ${E.border}`,borderRadius:3,background:E.surface,color:E.inkMid,fontFamily:"'DM Sans',sans-serif",fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:" Importar JSON"}),e.jsx("button",{onClick:f,style:{padding:"7px 14px",border:`1px solid ${E.border}`,borderRadius:3,background:E.surface,color:E.inkMid,fontFamily:"'DM Sans',sans-serif",fontSize:11,cursor:"pointer"},children:" Actualizar"})]})]}),m&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:C=>C.target===C.currentTarget&&x(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:560,width:"100%",padding:24,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsx("h3",{style:{fontSize:15,fontWeight:700,margin:"0 0 8px"},children:" Importar JSON de Getformly"}),e.jsx("p",{style:{fontSize:11,color:E.inkMid,margin:"0 0 12px"},children:"Pega el JSON de la respuesta del formulario. Acepta un objeto o un array de objetos."}),e.jsx("textarea",{value:p,onChange:C=>c(C.target.value),placeholder:'{"nombre": "Juan Prez", "email": "juan@mail.com", ...}',rows:10,style:{...k,fontSize:11,fontFamily:"'DM Mono',monospace",resize:"vertical"}}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:v,style:{padding:"8px 18px",background:E.ink,color:"#fff",border:"none",borderRadius:4,fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Importar"}),e.jsx("button",{onClick:()=>{x(!1),c("")},style:{padding:"8px 18px",background:"transparent",color:E.inkMid,border:`1px solid ${E.border}`,borderRadius:4,fontSize:12,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"})]})]})}),e.jsx("div",{style:{display:"flex",gap:2,marginBottom:20,borderBottom:`1px solid ${E.border}`,paddingBottom:0},children:z.map(C=>e.jsxs("button",{onClick:()=>a(C.id),style:{display:"flex",alignItems:"center",gap:7,padding:"10px 18px",border:"none",borderBottom:n===C.id?`2px solid ${E.ink}`:"2px solid transparent",background:"transparent",color:n===C.id?E.ink:E.inkLight,fontFamily:"'DM Sans',sans-serif",fontSize:12,fontWeight:n===C.id?700:400,cursor:"pointer",letterSpacing:.5,marginBottom:-1},children:[e.jsx(C.I,{size:13}),C.lbl]},C.id))}),n==="enviar"&&e.jsx(vh,{}),n==="ingresar"&&(()=>{const C=g||A(),D=(P,ie)=>l(me=>({...me||A(),[P]:ie}));g||l(A());const K=["Moderno","Contemporneo","Minimalista","Industrial","Nrdico","Clsico","Rstico","Eclctico","Japandi","Otro"],oe=["Sala","Comedor","Cocina","Habitacin principal","Habitacin secundaria","Bao social","Bao privado","Estudio","Terraza/Balcn","Zona de lavandera","Lobby/Hall"],te=async()=>{if(!C.nombre){alert("El nombre es obligatorio");return}const P=await h(C);l(A()),a("recibidos"),alert(` Briefing de "${P.nombre}" guardado`)};return e.jsx("div",{className:"fade",children:e.jsxs(Ke,{style:{padding:22,borderLeft:`3px solid ${E.ink}`},children:[e.jsx(vt,{t:"Ingresar respuesta de briefing",s:"Completa los campos segn la informacin proporcionada por el cliente"}),e.jsxs("div",{style:{marginTop:16,marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:E.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${E.border}`},children:" Datos del cliente"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Nombre completo *"}),e.jsx("input",{value:C.nombre,onChange:P=>D("nombre",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Email"}),e.jsx("input",{type:"email",value:C.email,onChange:P=>D("email",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Telfono"}),e.jsx("input",{value:C.telefono,onChange:P=>D("telefono",P.target.value),placeholder:"300 123 4567",style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Cmo nos conoci?"}),e.jsxs("select",{value:C.como_conociste,onChange:P=>D("como_conociste",P.target.value),style:k,children:[e.jsx("option",{value:"",children:""}),["Instagram","Google","Referido","Pgina web","Evento","Otro"].map(P=>e.jsx("option",{children:P},P))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Ciudad"}),e.jsx("input",{value:C.ciudad,onChange:P=>D("ciudad",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Edificio / Conjunto"}),e.jsx("input",{value:C.edificio,onChange:P=>D("edificio",P.target.value),style:k})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:E.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${E.border}`},children:" Datos del proyecto"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Tipo de proyecto"}),e.jsx("select",{value:C.tipo_proyecto,onChange:P=>D("tipo_proyecto",P.target.value),style:k,children:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"].map(P=>e.jsx("option",{children:P},P))})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Direccin del proyecto"}),e.jsx("input",{value:C.direccion_proyecto,onChange:P=>D("direccion_proyecto",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"rea (m)"}),e.jsx("input",{type:"number",value:C.area_m2,onChange:P=>D("area_m2",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"N habitaciones / reas"}),e.jsx("input",{value:C.num_habitaciones,onChange:P=>D("num_habitaciones",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Fecha tentativa inicio"}),e.jsx("input",{type:"date",value:C.fecha_inicio,onChange:P=>D("fecha_inicio",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Plazo deseado"}),e.jsx("input",{value:C.plazo,onChange:P=>D("plazo",P.target.value),placeholder:"Ej: 3 meses",style:k})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:E.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${E.border}`},children:" Estilo y preferencias"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Estilos preferidos (seleccionar varios)"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:2},children:K.map(P=>{const ie=(C.estilo||[]).includes(P);return e.jsx("button",{onClick:()=>D("estilo",ie?(C.estilo||[]).filter(me=>me!==P):[...C.estilo||[],P]),style:{padding:"4px 10px",fontSize:10,fontWeight:ie?700:400,borderRadius:20,border:ie?`1px solid ${E.ink}`:`1px solid ${E.border}`,background:ie?E.ink:"#fff",color:ie?"#fff":E.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:P},P)})})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Espacios a intervenir"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:2},children:oe.map(P=>{const ie=(C.espacios||[]).includes(P);return e.jsx("button",{onClick:()=>D("espacios",ie?(C.espacios||[]).filter(me=>me!==P):[...C.espacios||[],P]),style:{padding:"4px 10px",fontSize:10,fontWeight:ie?700:400,borderRadius:20,border:ie?`1px solid ${E.info}`:`1px solid ${E.border}`,background:ie?E.infoBg:"#fff",color:ie?E.info:E.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:P},P)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Colores y materiales preferidos"}),e.jsx("textarea",{value:C.colores_materiales,onChange:P=>D("colores_materiales",P.target.value),rows:2,style:{...k,resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Links de referencia (Pinterest, etc.)"}),e.jsx("textarea",{value:C.links_ref,onChange:P=>D("links_ref",P.target.value),rows:2,style:{...k,resize:"vertical"}})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:E.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${E.border}`},children:" Presupuesto y expectativas"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Presupuesto aproximado (COP)"}),e.jsx("input",{type:"number",value:C.presupuesto,onChange:P=>D("presupuesto",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Financiacin"}),e.jsxs("select",{value:C.financiacion,onChange:P=>D("financiacion",P.target.value),style:k,children:[e.jsx("option",{value:"",children:""}),["Recursos propios","Crdito hipotecario","Leasing","Otro"].map(P=>e.jsx("option",{children:P},P))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Forma de pago"}),e.jsxs("select",{value:C.forma_pago,onChange:P=>D("forma_pago",P.target.value),style:k,children:[e.jsx("option",{value:"",children:""}),["Transferencia","Tarjeta de crdito","Efectivo","Cheque","Otro"].map(P=>e.jsx("option",{children:P},P))]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Lo ms importante del proyecto"}),e.jsx("textarea",{value:C.lo_mas_importante,onChange:P=>D("lo_mas_importante",P.target.value),rows:2,style:{...k,resize:"vertical"},placeholder:"Qu es lo que ms le importa al cliente?"})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Qu espera lograr?"}),e.jsx("textarea",{value:Array.isArray(C.que_esperas)?C.que_esperas.join(`
`):C.que_esperas||"",onChange:P=>D("que_esperas",P.target.value.split(`
`)),rows:2,style:{...k,resize:"vertical"},placeholder:"Una lnea por expectativa"})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:E.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${E.border}`},children:" Datos de facturacin (si aplica)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Razn social"}),e.jsx("input",{value:C.razon_social,onChange:P=>D("razon_social",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"NIT / Cdula"}),e.jsx("input",{value:C.documento,onChange:P=>D("documento",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Email facturacin"}),e.jsx("input",{value:C.email_factura,onChange:P=>D("email_factura",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Direccin facturacin"}),e.jsx("input",{value:C.dir_facturacion,onChange:P=>D("dir_facturacion",P.target.value),style:k})]}),e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Retenciones especiales"}),e.jsx("select",{value:C.retenciones,onChange:P=>D("retenciones",P.target.value),style:k,children:["No","S"].map(P=>e.jsx("option",{children:P},P))})]}),C.retenciones==="S"&&e.jsxs("div",{children:[e.jsx("label",{style:T,children:"Detalle retenciones"}),e.jsx("input",{value:C.detalle_retenciones,onChange:P=>D("detalle_retenciones",P.target.value),style:k})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16,paddingTop:16,borderTop:`1px solid ${E.border}`},children:[e.jsx(ht,{icon:ft,on:te,children:"Guardar briefing"}),e.jsx(ht,{v:"out",on:async()=>{if(!C.nombre){alert("El nombre es obligatorio");return}const P=await h(C);o&&o(P),l(A()),a("recibidos")},children:" Guardar + Crear cliente"}),e.jsx(ht,{v:"out",on:async()=>{if(!C.nombre){alert("El nombre es obligatorio");return}const P=await h(C);i(P,t),l(A())},children:" Guardar + Crear oferta"}),e.jsx(ht,{v:"out",on:()=>l(A()),children:"Limpiar"})]})]})})})(),n==="recibidos"&&(d?e.jsx("div",{style:{textAlign:"center",padding:"60px 0",color:E.inkLight},children:"Cargando briefings..."}):r.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"80px 0"},children:[e.jsx(dl,{size:40,style:{color:E.inkXLight,display:"block",margin:"0 auto 14px"}}),e.jsx("p",{style:{color:E.inkLight,fontSize:14},children:"No hay briefings recibidos an"}),e.jsx("p",{style:{color:E.inkXLight,fontSize:12,marginTop:6},children:"Ingresa uno manualmente o importa un JSON desde Getformly"}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:16},children:[e.jsxs("button",{onClick:()=>a("ingresar"),style:{padding:"8px 18px",background:E.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(Wo,{size:12,style:{marginRight:4}})," Ingresar manualmente"]}),e.jsx("button",{onClick:()=>x(!0),style:{padding:"8px 18px",background:"transparent",color:E.inkMid,border:`1px solid ${E.border}`,borderRadius:6,cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:" Importar JSON"})]})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:r.map(C=>e.jsxs("div",{style:{background:E.surface,border:`1px solid ${E.border}`,borderRadius:3,padding:"14px 18px",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"border-color .15s"},onMouseEnter:D=>D.currentTarget.style.borderColor=E.borderMid,onMouseLeave:D=>D.currentTarget.style.borderColor=E.border,children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("span",{style:{fontWeight:600,fontSize:14,color:E.ink},children:C.nombre||"Sin nombre"}),C.confirmacion==="S"&&e.jsx("span",{style:{fontSize:9,letterSpacing:1,textTransform:"uppercase",background:E.successBg,color:E.success,border:`1px solid ${E.success}33`,padding:"2px 7px",borderRadius:2,fontWeight:700},children:"Completo"})]}),e.jsx("div",{style:{display:"flex",gap:16,marginTop:4,flexWrap:"wrap"},children:[C.email&&{ic:"",v:C.email},C.ciudad&&{ic:"",v:C.ciudad},C.tipo_proyecto&&{ic:"",v:C.tipo_proyecto},C.area_m2&&{ic:"",v:`${C.area_m2} m`},C.presupuesto&&{ic:"",v:`$ ${Number(C.presupuesto).toLocaleString("es-CO")} COP`}].filter(Boolean).map((D,K)=>e.jsxs("span",{style:{fontSize:11,color:E.inkLight},children:[D.ic," ",D.v]},K))})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexShrink:0,marginLeft:16},children:[e.jsx("span",{style:{fontSize:10,color:E.inkXLight,marginRight:4},children:C.fecha||""}),e.jsx("button",{onClick:()=>j(C),style:{padding:"6px 12px",background:E.accentBg,border:`1px solid ${E.border}`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:E.ink,fontWeight:600},children:"Ver detalle"}),e.jsx("button",{onClick:()=>{o&&o(C)},style:{padding:"6px 12px",background:E.infoBg,border:`1px solid ${E.info}33`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:E.info,fontWeight:600},children:"+ Cliente"}),e.jsx("button",{onClick:()=>i(C,t),style:{padding:"6px 12px",background:E.ink,border:"none",borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:"#fff",fontWeight:700,letterSpacing:.5},children:"+ Oferta"}),e.jsx("button",{onClick:()=>y(C.id),disabled:w===C.id,style:{padding:"6px 8px",background:"transparent",border:`1px solid ${E.border}`,borderRadius:3,cursor:"pointer",color:E.error,opacity:w===C.id?.4:1},children:e.jsx(qe,{size:11})})]})]},C.id))})),b&&e.jsx(hh,{b,onClose:()=>j(null),onCreateOffer:()=>{j(null),i(b,t)},onCreateClient:()=>{j(null),o&&o(b)}})]})}function Sh(){const t="hab:crm:clientes2",[i,o]=F.useState([]),[n,a]=F.useState(null),[r,s]=F.useState(""),[d,u]=F.useState([]),[b,j]=F.useState(!1);F.useEffect(()=>{(async()=>{var g,l;try{const f=await((l=(g=window.storage)==null?void 0:g.get)==null?void 0:l.call(g,t));f&&o(JSON.parse(f.value)||[])}catch{}})(),ma().then(g=>u(g))},[]);const w=g=>{var l,f;o(g);try{(f=(l=window.storage)==null?void 0:l.set)==null||f.call(l,t,JSON.stringify(g))}catch{}},S=()=>Math.random().toString(36).slice(2,9),m=()=>({id:S(),nombre:"",tipo:"Empresa",nit:"",email:"",tel:"",ciudad:"",pais:"CO",notas:""}),x=i.filter(g=>!r||g.nombre.toLowerCase().includes(r.toLowerCase())||(g.nit||"").includes(r)),p=g=>{const l=rc(g);a(l),j(!1)},c=(g={})=>({border:"1px solid #E0E0E0",borderRadius:6,padding:"7px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",width:"100%",...g});return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Clientes"}),e.jsxs("p",{style:{fontSize:12,color:E.inkLight,margin:"3px 0 0"},children:[i.length," registros"]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[d.length>0&&e.jsxs("button",{onClick:()=>j(!0),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:E.infoBg,color:E.info,border:`1px solid ${E.info}33`,borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600},children:[" Desde briefing (",d.length,")"]}),e.jsxs("button",{onClick:()=>a(m()),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:E.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:600},children:[e.jsx(Pe,{size:14})," Nuevo cliente"]})]})]}),b&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:g=>g.target===g.currentTarget&&j(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",maxHeight:"65vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:"Crear cliente desde briefing"}),e.jsx("div",{style:{fontSize:10,color:"#888",marginTop:2},children:"Los datos se pre-llenarn en el formulario"})]}),e.jsx("button",{onClick:()=>j(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:18})})]}),e.jsxs("div",{style:{overflowY:"auto",padding:14},children:[d.map(g=>e.jsxs("div",{onClick:()=>p(g),style:{padding:"12px 14px",border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,cursor:"pointer"},onMouseEnter:l=>l.currentTarget.style.background="#F5F4F1",onMouseLeave:l=>l.currentTarget.style.background="#fff",children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:g.nombre||"Sin nombre"}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2,display:"flex",gap:12},children:[g.email&&e.jsxs("span",{children:[" ",g.email]}),g.telefono&&e.jsxs("span",{children:[" ",g.telefono]}),g.ciudad&&e.jsxs("span",{children:[" ",g.ciudad]}),g.razon_social&&e.jsxs("span",{children:[" ",g.razon_social]})]})]},g.id)),d.length===0&&e.jsx("div",{style:{textAlign:"center",padding:30,color:"#888",fontSize:12},children:"No hay briefings. Ingresa uno en Formularios  Ingresar manual."})]})]})}),e.jsxs("div",{style:{position:"relative",marginBottom:16},children:[e.jsx(vi,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:E.inkLight}}),e.jsx("input",{value:r,onChange:g=>s(g.target.value),placeholder:"Buscar por nombre o NIT...",style:{...c(),paddingLeft:32}})]}),n&&e.jsxs(Ke,{style:{padding:22,marginBottom:20,borderLeft:`3px solid ${E.ink}`},children:[e.jsx(vt,{t:n.id&&i.find(g=>g.id===n.id)?"Editar cliente":"Nuevo cliente",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(st,{lbl:"Nombre / Razn social",val:n.nombre,on:g=>a(l=>({...l,nombre:g.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Tipo"}),e.jsx("select",{value:n.tipo,onChange:g=>a(l=>({...l,tipo:g.target.value})),style:{...c()},children:["Empresa","Persona natural","Promotor","Particular"].map(g=>e.jsx("option",{children:g},g))})]}),e.jsx(st,{lbl:"NIT / CIF / DNI",val:n.nit,on:g=>a(l=>({...l,nit:g.target.value}))}),e.jsx(st,{lbl:"Email",val:n.email,on:g=>a(l=>({...l,email:g.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mvil"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoMovil||"+57",onChange:g=>a(l=>({...l,prefijoMovil:g.target.value})),style:{...c(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(g=>e.jsx("option",{value:g.split(" ")[0],children:g},g))}),e.jsx("input",{value:n.telMovil||n.tel||"",onChange:g=>a(l=>({...l,telMovil:g.target.value})),placeholder:"300 123 4567",style:{...c()}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Fijo"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoFijo||"+57",onChange:g=>a(l=>({...l,prefijoFijo:g.target.value})),style:{...c(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(g=>e.jsx("option",{value:g.split(" ")[0],children:g},g))}),e.jsx("input",{value:n.telFijo||"",onChange:g=>a(l=>({...l,telFijo:g.target.value})),placeholder:"601 234 5678",style:{...c()}})]})]}),e.jsx(st,{lbl:"Ciudad",val:n.ciudad,on:g=>a(l=>({...l,ciudad:g.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Pas"}),e.jsx("select",{value:n.pais,onChange:g=>a(l=>({...l,pais:g.target.value})),style:{...c()},children:["CO","ES","MX","US","Otro"].map(g=>e.jsx("option",{children:g},g))})]}),e.jsxs("div",{style:{gridColumn:"2 / -1"},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas"}),e.jsx("textarea",{value:n.notas,onChange:g=>a(l=>({...l,notas:g.target.value})),rows:2,style:{...c(),resize:"vertical"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:14},children:[e.jsx(ht,{icon:ft,on:()=>{if(!n.nombre){alert("El nombre es obligatorio");return}const g=i.find(l=>l.id===n.id);w(g?i.map(l=>l.id===n.id?n:l):[...i,n]),a(null)},children:"Guardar"}),e.jsx(ht,{v:"out",on:()=>a(null),children:"Cancelar"}),i.find(g=>g.id===n.id)&&e.jsxs(ht,{v:"out",on:()=>{window.confirm("Eliminar?")&&(w(i.filter(g=>g.id!==n.id)),a(null))},children:[e.jsx(qe,{size:13})," Eliminar"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280px,1fr))",gap:12},children:[x.map(g=>e.jsxs(Ke,{style:{padding:18,cursor:"pointer",transition:"box-shadow .15s"},onClick:()=>a({...g}),onMouseEnter:l=>l.currentTarget.style.boxShadow=E.shadowMd,onMouseLeave:l=>l.currentTarget.style.boxShadow=E.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:E.ink},children:g.nombre}),e.jsxs("div",{style:{fontSize:11,color:E.inkLight,marginTop:2},children:[g.tipo,"  ",g.ciudad||"","  ",g.pais]})]}),e.jsx("div",{style:{background:E.accentBg,borderRadius:4,padding:"2px 7px",fontSize:10,color:E.inkMid},children:g.nit||""})]}),(g.email||g.telMovil||g.tel||g.telFijo)&&e.jsxs("div",{style:{marginTop:8,fontSize:11,color:E.inkMid,display:"flex",gap:12,flexWrap:"wrap"},children:[g.email&&e.jsxs("span",{children:[" ",g.email]}),(g.telMovil||g.tel)&&e.jsxs("span",{children:[" ",g.prefijoMovil||"+57"," ",g.telMovil||g.tel]}),g.telFijo&&e.jsxs("span",{children:[" ",g.prefijoFijo||"+57"," ",g.telFijo]})]})]},g.id)),x.length===0&&e.jsx("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:40,color:E.inkLight,fontSize:13},children:r?"Sin resultados. Prueba otro trmino.":"Sin clientes. Aade el primero."})]})]})}function Ch(){const t="hab:crm:proveedores",[i,o]=F.useState([]),[n,a]=F.useState(null),[r,s]=F.useState(""),[d,u]=F.useState("Todos"),b=["Todos","Preliminares","Demoliciones","Movimiento de tierras","Cimentaciones","Estructura","Mampostera","Cubierta","Instalaciones elctricas","Instalaciones hidrosanitarias","Instalaciones de gas","Acabados","Pisos y enchapes","Pintura","Carpintera metlica","Carpintera madera / mobiliario","Obras exteriores","Equipamiento especial","Diseo y direccin","Otros"];F.useEffect(()=>{(async()=>{var p,c;try{const g=await((c=(p=window.storage)==null?void 0:p.get)==null?void 0:c.call(p,t));g&&o(JSON.parse(g.value)||[])}catch{}})()},[]);const j=p=>{var c,g;o(p);try{(g=(c=window.storage)==null?void 0:c.set)==null||g.call(c,t,JSON.stringify(p))}catch{}},w=()=>Math.random().toString(36).slice(2,9),S=()=>({id:w(),nombre:"",categoria:"Materiales",nit:"",email:"",tel:"",contacto:"",ciudad:"",web:"",notas:"",calificacion:5,metodoPago:"Transferencia",formaPago:"Contado",prefijoFijo:"+601"}),m=i.filter(p=>(d==="Todos"||p.categoria===d)&&(!r||p.nombre.toLowerCase().includes(r.toLowerCase()))),x=(p={})=>({border:"1px solid #E0E0E0",borderRadius:6,padding:"7px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",width:"100%",...p});return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Proveedores"}),e.jsxs("p",{style:{fontSize:12,color:E.inkLight,margin:"3px 0 0"},children:[i.length," registros"]})]}),e.jsxs("button",{onClick:()=>a(S()),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:E.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:600},children:[e.jsx(Pe,{size:14})," Nuevo proveedor"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(vi,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:E.inkLight}}),e.jsx("input",{value:r,onChange:p=>s(p.target.value),placeholder:"Buscar proveedor...",style:{...x(),paddingLeft:32}})]}),b.map(p=>e.jsx("button",{onClick:()=>u(p),style:{padding:"6px 12px",border:`1px solid ${d===p?E.ink:E.border}`,borderRadius:20,background:d===p?E.ink:"transparent",color:d===p?"#fff":E.inkMid,cursor:"pointer",fontSize:11,fontFamily:"'DM Sans',sans-serif",fontWeight:d===p?600:400},children:p},p))]}),n&&e.jsxs(Ke,{style:{padding:22,marginBottom:20,borderLeft:"3px solid #3B3B3B"},children:[e.jsx(vt,{t:i.find(p=>p.id===n.id)?"Editar proveedor":"Nuevo proveedor",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(st,{lbl:"Nombre / Razn social",val:n.nombre,on:p=>a(c=>({...c,nombre:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Categora"}),e.jsx("select",{value:n.categoria,onChange:p=>a(c=>({...c,categoria:p.target.value})),style:{...x()},children:b.filter(p=>p!=="Todos").map(p=>e.jsx("option",{children:p},p))})]}),e.jsx(st,{lbl:"NIT / CIF",val:n.nit,on:p=>a(c=>({...c,nit:p.target.value}))}),e.jsx(st,{lbl:"Contacto",val:n.contacto,on:p=>a(c=>({...c,contacto:p.target.value}))}),e.jsx(st,{lbl:"Email",val:n.email,on:p=>a(c=>({...c,email:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mvil"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoMovil||"+57",onChange:p=>a(c=>({...c,prefijoMovil:p.target.value})),style:{...x(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(p=>e.jsx("option",{value:p.split(" ")[0],children:p},p))}),e.jsx("input",{value:n.telMovil||n.tel||"",onChange:p=>a(c=>({...c,telMovil:p.target.value})),placeholder:"300 123 4567",style:{...x()}})]})]}),e.jsx(st,{lbl:"Ciudad",val:n.ciudad,on:p=>a(c=>({...c,ciudad:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Telfono fijo"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoFijo||"+601",onChange:p=>a(c=>({...c,prefijoFijo:p.target.value})),style:{...x(),width:90,flexShrink:0,fontSize:12},children:["+601  Bog","+602  Cali","+604  Med","+605  B/manga","+91  Mad","+93  Bcn"].map(p=>e.jsx("option",{value:p.split(" ")[0],children:p},p))}),e.jsx("input",{value:n.telFijo||"",onChange:p=>a(c=>({...c,telFijo:p.target.value})),placeholder:"234 5678",style:{...x()}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mtodo de pago"}),e.jsx("select",{value:n.metodoPago||"Transferencia",onChange:p=>a(c=>({...c,metodoPago:p.target.value})),style:{...x()},children:["Transferencia","Cheque","Efectivo","PSE","Consignacin","Otro"].map(p=>e.jsx("option",{children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Forma de pago (plazo)"}),e.jsx("select",{value:n.formaPago||"Contado",onChange:p=>a(c=>({...c,formaPago:p.target.value})),style:{...x()},children:["Contado","Crdito 15d","Crdito 30d","Crdito 45d","Crdito 60d","Crdito 90d","Anticipo + saldo","Otro"].map(p=>e.jsx("option",{children:p},p))})]}),e.jsx(st,{lbl:"Sitio web",val:n.web,on:p=>a(c=>({...c,web:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Calificacin (1-5)"}),e.jsx("div",{style:{display:"flex",gap:4},children:[1,2,3,4,5].map(p=>e.jsx("button",{onClick:()=>a(c=>({...c,calificacion:p})),style:{fontSize:20,background:"none",border:"none",cursor:"pointer",color:p<=n.calificacion?"#F5A623":"#DDD"},children:""},p))})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas"}),e.jsx("textarea",{value:n.notas,onChange:p=>a(c=>({...c,notas:p.target.value})),rows:2,style:{...x(),resize:"vertical"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:14},children:[e.jsx(ht,{icon:ft,on:()=>{if(!n.nombre){alert("El nombre es obligatorio");return}const p=i.find(c=>c.id===n.id);j(p?i.map(c=>c.id===n.id?n:c):[...i,n]),a(null)},children:"Guardar"}),e.jsx(ht,{v:"out",on:()=>a(null),children:"Cancelar"}),i.find(p=>p.id===n.id)&&e.jsxs(ht,{v:"out",on:()=>{window.confirm("Eliminar?")&&(j(i.filter(p=>p.id!==n.id)),a(null))},children:[e.jsx(qe,{size:13})," Eliminar"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(290px,1fr))",gap:12},children:[m.map(p=>e.jsxs(Ke,{style:{padding:18,cursor:"pointer",transition:"box-shadow .15s"},onClick:()=>a({...p}),onMouseEnter:c=>c.currentTarget.style.boxShadow=E.shadowMd,onMouseLeave:c=>c.currentTarget.style.boxShadow=E.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:E.ink},children:p.nombre}),e.jsxs("div",{style:{fontSize:11,color:E.inkLight,marginTop:2},children:[p.categoria,"  ",p.ciudad||""]})]}),e.jsx("div",{style:{display:"flex",gap:1},children:[1,2,3,4,5].map(c=>e.jsx("span",{style:{fontSize:12,color:c<=(p.calificacion||0)?"#F5A623":"#DDD"},children:""},c))})]}),(p.contacto||p.email||p.telMovil||p.tel||p.telFijo)&&e.jsxs("div",{style:{marginTop:8,fontSize:11,color:E.inkMid,display:"flex",gap:10,flexWrap:"wrap"},children:[p.contacto&&e.jsxs("span",{children:[" ",p.contacto]}),p.email&&e.jsxs("span",{children:[" ",p.email]}),(p.telMovil||p.tel)&&e.jsxs("span",{children:[" ",p.prefijoMovil||"+57"," ",p.telMovil||p.tel]}),p.telFijo&&e.jsxs("span",{children:[" ",p.prefijoFijo||"+601"," ",p.telFijo]})]}),(p.formaPago||p.metodoPago||p.nit)&&e.jsxs("div",{style:{marginTop:4,fontSize:10,color:E.inkLight,display:"flex",gap:10},children:[p.nit&&e.jsxs("span",{children:["NIT: ",p.nit]}),p.metodoPago&&e.jsxs("span",{children:[" ",p.metodoPago]}),p.formaPago&&e.jsxs("span",{children:[" ",p.formaPago]})]})]},p.id)),m.length===0&&e.jsx("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:40,color:E.inkLight,fontSize:13},children:r||d!=="Todos"?"Sin resultados.":"Sin proveedores. Aade el primero."})]})]})}const kh=[{id:"dashboard",lbl:"Dashboard",en:"Dashboard",I:Rc},{id:"offers",lbl:"Ofertas",en:"Offers",I:At},{id:"clientes",lbl:"Clientes",en:"Clients",I:wd},{id:"proveedores",lbl:"Proveedores",en:"Suppliers",I:kn},{id:"formularios",lbl:"Formularios",en:"Forms",I:Uo},{id:"encuestas",lbl:"Encuestas ISO",en:"ISO Surveys",I:wa},{id:"settings",lbl:"Configuracin",en:"Settings",I:el}];function wh({view:t,sv:i,lang:o,setLang:n,open:a,toggle:r}){return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,className:"no-print",style:{position:"fixed",top:10,left:a?208:10,zIndex:1002,width:28,height:28,background:a?"rgba(255,255,255,0.1)":"#111",color:a?"rgba(255,255,255,0.5)":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",transition:"left .2s ease"},children:a?"":""}),e.jsxs("div",{className:"no-print",style:{width:200,background:E.sidebar,height:"100vh",position:"fixed",left:a?0:-200,top:0,display:"flex",flexDirection:"column",transition:"left .2s ease",zIndex:1001},children:[e.jsx("div",{style:{padding:"22px 18px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(nl,{size:32,color:"#fff"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:"'DM Sans', sans-serif",fontWeight:600,fontSize:14,letterSpacing:4,color:"#fff",textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:9,letterSpacing:2,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",fontWeight:400},children:o==="en"?"CRM  Offers":"CRM  Ofertas"})]})]})}),e.jsx("nav",{style:{padding:"12px 8px",flex:1},children:kh.map(s=>{const d=t===s.id||t.startsWith("offer-")&&s.id==="offers";return e.jsxs("button",{onClick:()=>i(s.id),style:{display:"flex",alignItems:"center",gap:10,width:"100%",padding:"10px 12px",borderRadius:2,border:"none",cursor:"pointer",background:d?E.sidebarAct:"transparent",color:d?"#fff":"rgba(255,255,255,0.35)",fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:d?600:400,letterSpacing:1.2,textTransform:"uppercase",marginBottom:1,transition:"all .15s",borderLeft:d?"2px solid rgba(255,255,255,0.6)":"2px solid transparent"},children:[e.jsx(s.I,{size:13}),o==="en"&&s.en?s.en:s.lbl]},s.id)})}),e.jsxs("div",{style:{padding:"14px 18px",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("div",{style:{display:"flex",gap:0,marginBottom:8},children:[["es"," ES"],["en"," EN"]].map(([s,d])=>e.jsx("button",{onClick:()=>n(s),style:{flex:1,padding:"5px 0",fontSize:10,fontWeight:600,cursor:"pointer",border:"1px solid rgba(255,255,255,0.15)",fontFamily:"'DM Sans',sans-serif",borderRadius:s==="es"?"4px 0 0 4px":"0 4px 4px 0",background:o===s?"#fff":"transparent",color:o===s?"#111":"rgba(255,255,255,0.4)"},children:d},s))}),e.jsx("p",{style:{fontSize:9,color:"rgba(255,255,255,0.15)",margin:0,letterSpacing:1,textTransform:"uppercase"},children:"v3.0  Fase 2  2025"})]})]})]})}function zh({offers:t,sv:i,sei:o,lang:n}){const a=F.useMemo(()=>{const s=t.filter(b=>b.estado==="Ganada"),d=t.filter(b=>b.estado==="Perdida"),u=t.filter(b=>!["Ganada","Perdida","Cancelada"].includes(b.estado));return{gan:s,per:d,act:u,pip:u.reduce((b,j)=>b+(Qn(j).PVP_IVA||0),0),ganado:s.reduce((b,j)=>b+(Qn(j).PVP_IVA||0),0),tasa:s.length+d.length>0?(s.length/(s.length+d.length)*100).toFixed(0):0}},[t]),r=[...t].sort((s,d)=>new Date(d.updatedAt)-new Date(s.updatedAt)).slice(0,6);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{marginBottom:28},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:E.inkLight,margin:"0 0 6px"},children:n==="en"?"General panel":"Panel general"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:E.ink,margin:0,letterSpacing:-.5},children:"Dashboard"})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[e.jsx(_r,{lbl:n==="en"?"Total offers":"Total ofertas",val:t.length,icon:At,col:E.ink}),e.jsx(_r,{lbl:n==="en"?"Active pipeline":"Pipeline activo",val:Je(a.pip),icon:Hi,col:E.info,sub:`${a.act.length} ${n==="en"?"offer(s)":"oferta(s)"}`}),e.jsx(_r,{lbl:n==="en"?"Total won":"Total ganado",val:Je(a.ganado),icon:Cd,col:E.success,sub:`${a.gan.length} ${n==="en"?"won":"ganada(s)"}`}),e.jsx(_r,{lbl:n==="en"?"Win rate":"% Adjudicacin",val:`${a.tasa}%`,icon:Ic,col:E.warning,sub:`${a.per.length} ${n==="en"?"lost":"perdida(s)"}`})]}),e.jsx("div",{style:{display:"flex",gap:8,marginBottom:22,flexWrap:"wrap"},children:rl.map(s=>{const d=t.filter(u=>u.estado===s).length;return d?e.jsxs("div",{onClick:()=>i("offers"),style:{display:"flex",alignItems:"center",gap:8,background:E.surface,border:`1px solid ${E.border}`,borderRadius:2,padding:"7px 13px",cursor:"pointer"},children:[e.jsx(Us,{e:s}),e.jsx("span",{style:{fontSize:13,fontWeight:700,color:E.ink},children:d})]},s):null})}),e.jsxs(Ke,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${E.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:13,fontWeight:700,color:E.ink,margin:0,textTransform:"uppercase",letterSpacing:.5},children:"Ofertas recientes"}),e.jsx(ht,{v:"ghost",sm:!0,icon:Gi,on:()=>i("offers"),children:"Ver todas"})]}),r.length===0?e.jsxs("div",{style:{padding:48,textAlign:"center",color:E.inkLight},children:[e.jsx(At,{size:30,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{margin:"0 0 14px",fontSize:13},children:"An no hay ofertas"}),e.jsx(ht,{icon:Pe,on:()=>i("offer-new"),children:"Nueva oferta"})]}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Cliente","Proyecto","Tipo","PVP c/IVA","Estado",""].map(s=>e.jsx("th",{style:{padding:"10px 16px",textAlign:"left",fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:1.2},children:s},s))})}),e.jsx("tbody",{children:r.map(s=>{const d=Qn(s);return e.jsxs("tr",{style:{borderTop:`1px solid ${E.border}`},onMouseEnter:u=>u.currentTarget.style.background="#FFFFFF",onMouseLeave:u=>u.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"12px 16px",fontSize:13,fontWeight:500,color:E.ink},children:s.cliente||""}),e.jsx("td",{style:{padding:"12px 16px",fontSize:12,color:E.inkMid},children:s.proyecto||""}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("span",{style:{fontSize:9,background:E.accentBg,color:E.ink,padding:"2px 8px",borderRadius:2,fontWeight:700,letterSpacing:1,textTransform:"uppercase"},children:s.tipoProyecto==="DISEO"?(s.subtipoDiseno||"Diseo").split(" ").pop():s.tipoProyecto})}),e.jsx("td",{style:{padding:"12px 16px",fontSize:13,fontWeight:700,color:E.ink},children:Je(d.PVP_IVA)}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(Us,{e:s.estado})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(ht,{sm:!0,v:"ghost",icon:Wo,on:()=>{o(s.id),i("offer-edit")}})})]},s.id)})})]})]})]})}function Eh({offers:t,sv:i,sei:o,onDel:n,onDup:a}){const[r,s]=F.useState(""),[d,u]=F.useState("Todos"),[b,j]=F.useState("Todos"),w=F.useMemo(()=>t.filter(S=>(!r||[S.cliente,S.proyecto,S.ubicacion].join(" ").toLowerCase().includes(r.toLowerCase()))&&(d==="Todos"||S.estado===d)&&(b==="Todos"||S.tipoProyecto===b)).sort((S,m)=>new Date(m.updatedAt)-new Date(S.updatedAt)),[t,r,d,b]);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:28},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:E.inkLight,margin:"0 0 6px"},children:"Biblioteca"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:E.ink,margin:0,letterSpacing:-.5},children:"Ofertas"}),e.jsxs("p",{style:{color:E.inkLight,fontSize:11,margin:"4px 0 0"},children:[t.length," oferta(s) registrada(s)"]})]}),e.jsx(ht,{icon:Pe,on:()=>i("offer-new"),children:"Nueva oferta"})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(vi,{size:13,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:E.inkLight}}),e.jsx("input",{value:r,onChange:S=>s(S.target.value),placeholder:"Buscar cliente, proyecto...",style:{width:"100%",padding:"9px 12px 9px 32px",border:`1px solid ${E.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:E.surface,color:E.ink}})]}),[{val:d,sv:u,opts:["Todos",...rl]},{val:b,sv:j,opts:["Todos","OBRA","DISEO"]}].map(({val:S,sv:m,opts:x},p)=>e.jsx("select",{value:S,onChange:c=>m(c.target.value),style:{padding:"9px 12px",border:`1px solid ${E.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:E.surface,color:E.ink},children:x.map(c=>e.jsx("option",{value:c,children:c},c))},p))]}),e.jsx(Ke,{style:{padding:0,overflow:"hidden"},children:w.length===0?e.jsx("div",{style:{padding:40,textAlign:"center",color:E.inkLight},children:e.jsx("p",{style:{fontSize:13},children:"No se encontraron ofertas"})}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["#","Cliente / Proyecto","Modalidad","Costo dir.","PVP c/IVA","Margen","Estado","Fecha",""].map(S=>e.jsx("th",{style:{padding:"10px 14px",textAlign:"left",fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,whiteSpace:"nowrap"},children:S},S))})}),e.jsx("tbody",{children:w.map((S,m)=>{const x=Qn(S);return e.jsxs("tr",{style:{borderTop:`1px solid ${E.border}`},onMouseEnter:p=>p.currentTarget.style.background="#FFFFFF",onMouseLeave:p=>p.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"11px 14px",fontSize:10,color:E.inkLight,fontWeight:600},children:String(m+1).padStart(3,"0")}),e.jsxs("td",{style:{padding:"11px 14px"},children:[e.jsx("p",{style:{margin:0,fontSize:13,fontWeight:600,color:E.ink},children:S.cliente||""}),e.jsx("p",{style:{margin:0,fontSize:11,color:E.inkLight},children:S.proyecto||"Sin nombre"})]}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsx("span",{style:{fontSize:9,background:E.accentBg,color:E.ink,padding:"2px 8px",borderRadius:2,fontWeight:700,letterSpacing:.8,textTransform:"uppercase"},children:S.tipoProyecto==="DISEO"?S.subtipoDiseno||"Diseo":S.tipoProyecto})}),e.jsx("td",{style:{padding:"11px 14px",fontSize:12,color:E.inkMid},children:Je(x.COSTO)}),e.jsx("td",{style:{padding:"11px 14px",fontSize:13,fontWeight:700,color:E.ink},children:Je(x.PVP_IVA)}),e.jsx("td",{style:{padding:"11px 14px",fontSize:12,color:x.PVP>0?E.success:E.inkLight},children:x.PVP>0?et(S.margen):""}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsx(Us,{e:S.estado})}),e.jsx("td",{style:{padding:"11px 14px",fontSize:10,color:E.inkLight,whiteSpace:"nowrap"},children:S.updatedAt?new Date(S.updatedAt).toLocaleDateString("es-CO"):""}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsxs("div",{style:{display:"flex",gap:3},children:[e.jsx(ht,{sm:!0,v:"ghost",icon:Wo,on:()=>{o(S.id),i("offer-edit")}}),e.jsx(ht,{sm:!0,v:"ghost",icon:da,on:()=>a(S.id)}),e.jsx(ht,{sm:!0,v:"danger",icon:qe,on:()=>n(S.id)})]})})]},S.id)})})]})})]})}const Zr=[{id:"DIS",label:"Diseo",color:"#5B3A8C",icon:"",modo:"diseno"},{id:"REF",label:"Reforma / construccin",color:"#8C6A00",icon:"",modo:"ejecucion"},{id:"INS",label:"Instalaciones",color:"#3B3B3B",icon:"",modo:"ejecucion"},{id:"MOB",label:"Carpintera y mobiliario",color:"#6B4226",icon:"",modo:"ejecucion"},{id:"DIR",label:"Direccin / supervisin",color:"#0D5E6E",icon:"",modo:"diseno"},{id:"SER",label:"Servicios tcnicos",color:"#555555",icon:"",modo:"diseno"}],Dn=[{id:"CAP00",label:"00  Preliminares e instalaciones provisionales",color:"#555555"},{id:"CAP01",label:"01  Demoliciones y desmonte",color:"#8C6A00"},{id:"CAP02",label:"02  Movimiento de tierras",color:"#6B4226"},{id:"CAP03",label:"03  Cimentaciones",color:"#5B3A8C"},{id:"CAP04",label:"04  Estructura",color:"#3B3B3B"},{id:"CAP05",label:"05  Mampostera y cerramientos",color:"#0D5E6E"},{id:"CAP06",label:"06  Cubierta e impermeabilizacin",color:"#8C6A00"},{id:"CAP07",label:"07  Instalaciones elctricas",color:"#111111"},{id:"CAP08",label:"08  Instalaciones hidrosanitarias",color:"#3B3B3B"},{id:"CAP09",label:"09  Instalaciones de gas",color:"#B91C1C"},{id:"CAP10",label:"10  Acabados generales",color:"#555555"},{id:"CAP11",label:"11  Pisos y enchapes",color:"#6B4226"},{id:"CAP12",label:"12  Pintura",color:"#5B3A8C"},{id:"CAP13",label:"13  Carpintera metlica y vidriera",color:"#0D5E6E"},{id:"CAP14",label:"14  Carpintera de madera y mobiliario",color:"#6B4226"},{id:"CAP15",label:"15  Obras exteriores y urbanismo",color:"#111111"},{id:"CAP16",label:"16  Equipamiento especial",color:"#555555"},{id:"CAP17",label:"17  Diseo y direccin tcnica",color:"#5B3A8C"},{id:"CAP18",label:"18  Admin, imprevistos y utilidad (AIU)",color:"#3B3B3B"}],Gl=[{id:"lev",nombre:"Levantamiento arquitectnico",horas:4,tipo:"plano"},{id:"propArq",nombre:"Propuesta arquitectnica",horas:8,tipo:"plano"},{id:"propInt",nombre:"Propuesta de interiores",horas:6,tipo:"plano"},{id:"cortes",nombre:"Cortes y fachadas",horas:3,tipo:"plano"},{id:"det",nombre:"Detalles constructivos",horas:4,tipo:"plano"},{id:"inst_e",nombre:"Plano instalaciones elctricas",horas:3,tipo:"plano"},{id:"inst_h",nombre:"Plano instalaciones hidrosanitarias",horas:3,tipo:"plano"},{id:"render",nombre:"Renders 3D exteriores (x3)",horas:12,tipo:"render"},{id:"render_i",nombre:"Renders 3D interiores (x5)",horas:10,tipo:"render"},{id:"recorrido",nombre:"Recorrido virtual 360",horas:16,tipo:"render"},{id:"memoria",nombre:"Memoria descriptiva",horas:4,tipo:"doc"},{id:"cuadro",nombre:"Cuadro de reas",horas:2,tipo:"doc"},{id:"presup",nombre:"Presupuesto de obra (tem por tem)",horas:8,tipo:"doc"},{id:"licencia",nombre:"Gestin licencia construccin",horas:20,tipo:"tramite"},{id:"topog",nombre:"Levantamiento topogrfico",horas:0,tipo:"subcontrata"},{id:"estruc",nombre:"Clculo estructural",horas:0,tipo:"subcontrata"},{id:"suelos",nombre:"Estudio de suelos",horas:0,tipo:"subcontrata"}],to=[{codigo:"EPP-001",nombre:"Casco de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:24,precioRef:35e3},{codigo:"EPP-002",nombre:"Botas de seguridad",familia:"epp",unidad:"par",vidaUtilMeses:12,precioRef:12e4},{codigo:"EPP-003",nombre:"Guantes de carnaza",familia:"epp",unidad:"par",vidaUtilMeses:3,precioRef:12e3},{codigo:"EPP-004",nombre:"Gafas de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:12,precioRef:18e3},{codigo:"EPP-005",nombre:"Chaleco reflectivo",familia:"epp",unidad:"ud",vidaUtilMeses:12,precioRef:25e3},{codigo:"EPP-006",nombre:"Proteccin auditiva",familia:"epp",unidad:"ud",vidaUtilMeses:6,precioRef:8e3},{codigo:"EPP-007",nombre:"Mascarilla con filtro",familia:"epp",unidad:"ud",vidaUtilMeses:1,precioRef:15e3},{codigo:"EPP-008",nombre:"Arns de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:36,precioRef:18e4},{codigo:"EPP-009",nombre:"Guantes de nitrilo",familia:"epp",unidad:"caja",vidaUtilMeses:1,precioRef:28e3},{codigo:"EPP-010",nombre:"Careta de soldar",familia:"epp",unidad:"ud",vidaUtilMeses:24,precioRef:85e3},{codigo:"DOT-001",nombre:"Overol de trabajo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:65e3},{codigo:"DOT-002",nombre:"Camiseta con logo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:3e4},{codigo:"DOT-003",nombre:"Pantaln de trabajo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:45e3},{codigo:"HM-001",nombre:"Martillo de ua",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:35e3},{codigo:"HM-002",nombre:"Juego destornilladores",familia:"herr_menor",unidad:"jgo",vidaUtilMeses:24,precioRef:45e3},{codigo:"HM-003",nombre:"Flexmetro 5m",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:22e3},{codigo:"HM-004",nombre:"Nivel de burbuja 60cm",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:38e3},{codigo:"HM-005",nombre:"Llana dentada",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:18e3},{codigo:"HM-006",nombre:"Llana lisa",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:15e3},{codigo:"HM-007",nombre:"Maceta 2lb",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:25e3},{codigo:"HM-008",nombre:"Cincel plano",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:12e3},{codigo:"HM-009",nombre:"Pala redonda",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:3e4},{codigo:"HM-010",nombre:"Pica",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:28e3},{codigo:"HM-011",nombre:"Carretilla",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:95e3},{codigo:"HM-012",nombre:"Pinza pelacables",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:25e3},{codigo:"HM-013",nombre:"Alicate universal",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:28e3},{codigo:"HM-014",nombre:'Llave ajustable 10"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:36,precioRef:32e3},{codigo:"HM-015",nombre:'Esptula 3"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:6,precioRef:8e3},{codigo:"HM-016",nombre:"Rodillo de pintura",familia:"herr_menor",unidad:"ud",vidaUtilMeses:3,precioRef:12e3},{codigo:"HM-017",nombre:'Brocha 4"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:3,precioRef:8e3},{codigo:"HY-001",nombre:"Taladro percutor",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:28e4},{codigo:"HY-002",nombre:'Pulidora 7"',familia:"herr_mayor",unidad:"ud",vidaUtilMeses:36,precioRef:35e4},{codigo:"HY-003",nombre:"Sierra circular",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:42e4},{codigo:"HY-004",nombre:"Rotomartillo SDS",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:65e4},{codigo:"HY-005",nombre:"Cortadora de baldosa",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:36,precioRef:38e4},{codigo:"HY-006",nombre:"Compresor de aire",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:60,precioRef:85e4},{codigo:"HY-007",nombre:"Equipo de soldadura",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:60,precioRef:95e4},{codigo:"EO-001",nombre:"Andamio certificado",familia:"equipo_obra",unidad:"cuerpo",vidaUtilMeses:60,precioRef:18e4},{codigo:"EO-002",nombre:"Escalera tijera 2m",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:18e4},{codigo:"EO-003",nombre:"Escalera extensin 4m",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:35e4},{codigo:"EO-004",nombre:"Mezcladora de concreto",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:60,precioRef:25e5},{codigo:"EO-005",nombre:"Vibrador de concreto",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:12e5},{codigo:"EO-006",nombre:"Pluma gra manual",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:60,precioRef:35e5},{codigo:"EM-001",nombre:"Flexmetro lser",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:25e4},{codigo:"EM-002",nombre:"Nivel lser",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:48e4},{codigo:"EM-003",nombre:"Multmetro digital",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:12e4},{codigo:"CO-001",nombre:"Cinta aislante",familia:"consumible",unidad:"rollo",vidaUtilMeses:1,precioRef:5e3},{codigo:"CO-002",nombre:"Silicona transparente",familia:"consumible",unidad:"tubo",vidaUtilMeses:1,precioRef:12e3},{codigo:"CO-003",nombre:'Disco de corte 7"',familia:"consumible",unidad:"ud",vidaUtilMeses:1,precioRef:8e3},{codigo:"CO-004",nombre:"Broca para concreto set",familia:"consumible",unidad:"jgo",vidaUtilMeses:3,precioRef:35e3},{codigo:"CO-005",nombre:"Lija #80 pliego",familia:"consumible",unidad:"pliego",vidaUtilMeses:1,precioRef:3e3},{codigo:"SC-001",nombre:"Cinta de demarcacin",familia:"seguridad",unidad:"rollo",vidaUtilMeses:1,precioRef:15e3},{codigo:"SC-002",nombre:"Malla de cerramiento",familia:"seguridad",unidad:"rollo",vidaUtilMeses:6,precioRef:45e3},{codigo:"SC-003",nombre:"Sealizacin obra",familia:"seguridad",unidad:"jgo",vidaUtilMeses:12,precioRef:85e3},{codigo:"SC-004",nombre:"Extintor multipropsito",familia:"seguridad",unidad:"ud",vidaUtilMeses:12,precioRef:65e3},{codigo:"SC-005",nombre:"Botiqun tipo A",familia:"seguridad",unidad:"ud",vidaUtilMeses:12,precioRef:12e4}],hn={peon:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],ayudante:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","DOT-001"],oficial2:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],oficial1:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],encargado:["EPP-001","EPP-002","EPP-004","EPP-005","DOT-002","DOT-003"],residente:["EPP-001","EPP-002","EPP-005","DOT-002"],jefe_obra:["EPP-001","EPP-002","EPP-005","DOT-002"],arq:["EPP-001","EPP-005"],ing:["EPP-001","EPP-002","EPP-005","DOT-002"]},Vs={eq_elec_basico:["HY-001","HM-002","HM-012","HM-013","EM-003","CO-001","EO-002"],eq_obra_civil:["HM-009","HM-010","HM-011","HM-004","HM-003","HM-007","HM-008","HM-005","EO-003","EO-001"],eq_diseno_int:["EM-001","EM-002","HM-003"]},Jn={epp:"EPP",dotacion:"Dotacin",herr_menor:"Herram. menor",herr_mayor:"Herram. mayor",equipo_obra:"Equipo obra",equipo_medic:"Medicin",consumible:"Consumible",seguridad:"Seguridad"},ba={epp:"",dotacion:"",herr_menor:"",herr_mayor:"",equipo_obra:"",equipo_medic:"",consumible:"",seguridad:""},Oo=t=>to.find(i=>i.codigo===t),Eo={CO:{categorias:[{id:"peon",label:"Pen de obra",salario:1423500,factor:1.618,horasMes:192},{id:"oficial2",label:"Oficial 2",salario:175e4,factor:1.618,horasMes:192},{id:"oficial1",label:"Oficial 1",salario:21e5,factor:1.618,horasMes:192},{id:"encargado",label:"Encargado de obra",salario:28e5,factor:1.618,horasMes:192},{id:"residente",label:"Residente / Inspector",salario:42e5,factor:1.618,horasMes:192},{id:"arq",label:"Arquitecto",salario:35e5,factor:1.618,horasMes:192},{id:"ing",label:"Ingeniero",salario:45e5,factor:1.618,horasMes:192}]},ES:{categorias:[{id:"peon",label:"Pen ordinario",salarioAnual:20800,ss:.299,horasAnio:1736},{id:"ayudante",label:"Ayudante",salarioAnual:22400,ss:.299,horasAnio:1736},{id:"oficial2",label:"Oficial 2",salarioAnual:24600,ss:.299,horasAnio:1736},{id:"oficial1",label:"Oficial 1",salarioAnual:27200,ss:.299,horasAnio:1736},{id:"encargado",label:"Encargado",salarioAnual:32e3,ss:.299,horasAnio:1736},{id:"jefe_obra",label:"Jefe de obra",salarioAnual:45e3,ss:.299,horasAnio:1736},{id:"arq",label:"Arquitecto/Aparejador",salarioAnual:4e4,ss:.299,horasAnio:1736}]}},Ah=t=>t.salario*t.factor/t.horasMes,Fh=t=>t.salarioAnual*(1+t.ss)/t.horasAnio,ro=(t,i)=>{var a;const n=(((a=Eo[i])==null?void 0:a.categorias)||[]).find(r=>r.id===t);return n?i==="CO"?Ah(n):Fh(n):0},Th=(t,i)=>{const o=i.pais||"CO",n=o==="CO"?"COP":"EUR",a=t.apu||{},r=t.tipo;if(r==="diseno_arq"||r==="diseno_int"){const p=a.estudios||[],c=a.mo||[],g=a.subcontratas||[],l=p.reduce((z,k)=>z+(k.horas||0),0),f=i.apuModoHora==="MANUAL"?i.apuCostoHoraManual||0:(()=>{const z=(i.apuHDia||8)*(i.apuDiasSem||5)*(i.apuSemanas||52)*(i.apuPctProductivas||.6),k=(i.apuSalarioAnual||0)*(1+(i.apuPrestaciones||.65))+(i.apuLicencias||0)+(i.apuEquipos||0)+(i.apuAccesorios||0);return z>0?k/z:0})(),y=l*f,h=c.reduce((z,k)=>z+(k.horas||0)*ro(k.catId,o),0),v=g.reduce((z,k)=>z+(k.importe||0),0);return{CD:y+h+v,cdDis:y,cdMO:h,cdSub:v,horasTotal:l,costoH:f,moneda:n}}a.cuadrillas;const s=a.materiales||[],d=a.equipos||[],u=a.subcontratas||[],j=(a.equiposUsados||[]).reduce((p,c)=>{var y,h,v;let g=null;try{g=(JSON.parse(((v=(h=(y=window.storage)==null?void 0:y.get)==null?void 0:h.call(y,"hab:crm:equipos"))==null?void 0:v.value)||"null")||ya).find(z=>z.id===c.eqId)}catch{}if(!g)return p;const f=(c.rendimientoOverride??g.rendimiento)*(t.cantidad||1);return p+g.cargos.reduce((A,z)=>{const k=ro(z.catId,o);return A+k*f*(z.cantidad||1)},0)+(g.equiposCosto||0)+(g.licenciasCosto||0)},0),w=s.reduce((p,c)=>p+(c.cantidad||0)*(c.precio||0),0),S=d.reduce((p,c)=>p+(c.cantidad||0)*(c.precio||0),0),m=u.reduce((p,c)=>p+(c.importe||0),0);return{CD:j+w+S+m,cdMO:j,cdMat:w,cdEq:S,cdSub:m,moneda:n}},ya=[{id:"eq_elec_basico",nombre:"Equipo elctrico bsico",cargos:[{id:"c1",catId:"oficial1",cantidad:1},{id:"c2",catId:"ayudante",cantidad:1}],equiposCosto:15e3,licenciasCosto:0,rendimiento:.05},{id:"eq_obra_civil",nombre:"Equipo obra civil",cargos:[{id:"c3",catId:"oficial1",cantidad:1},{id:"c4",catId:"peon",cantidad:2}],equiposCosto:25e3,licenciasCosto:0,rendimiento:.08},{id:"eq_diseno_int",nombre:"Equipo diseo",cargos:[{id:"c5",catId:"arq",cantidad:1}],equiposCosto:0,licenciasCosto:8e3,rendimiento:1}];function ac(){const[t,i]=F.useState(()=>{var n,a;try{const r=(a=(n=window.storage)==null?void 0:n.get)==null?void 0:a.call(n,"hab:crm:equipos"),s=r?JSON.parse(r.value):null;return s!=null&&s.length?s:ya}catch{return ya}});return[t,n=>{var a,r;i(n);try{(r=(a=window.storage)==null?void 0:a.set)==null||r.call(a,"hab:crm:equipos",JSON.stringify(n))}catch{}}]}function Bh({pais:t,onClose:i}){var p;const[o,n]=ac(),[a,r]=F.useState(null),[s,d]=F.useState(null),u=((p=Eo[t])==null?void 0:p.categorias)||[],b=()=>Math.random().toString(36).slice(2,9),j=c=>c!=null&&!isNaN(c)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(c):"0",w=t==="CO"?"COP":"EUR",S=()=>{var c;return{id:b(),nombre:"",rendimiento:.1,cargos:[{id:b(),catId:((c=u[0])==null?void 0:c.id)||"",cantidad:1}],equiposCosto:0,licenciasCosto:0}},m=c=>c.cargos.reduce((g,l)=>{const f=ro(l.catId,t);return g+f*c.rendimiento*(l.cantidad||1)},0)+(c.equiposCosto||0)+(c.licenciasCosto||0),x=(c={})=>({border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 7px",fontSize:12,fontFamily:"'DM Sans',sans-serif",...c});return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:1100,display:"flex",alignItems:"flex-start",justifyContent:"center",overflowY:"auto",padding:"20px 16px"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,width:"100%",maxWidth:680,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Biblioteca global"}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:"#111"},children:"Equipos de trabajo"})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>{d(S()),r(null)},style:{padding:"6px 12px",background:"#111111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Pe,{size:12})," Nuevo equipo"]}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:20})})]})]}),e.jsxs("div",{style:{padding:"14px 18px"},children:[s&&e.jsxs("div",{style:{border:"1px solid #111111",borderRadius:8,padding:14,marginBottom:16,background:"#F0FAF5"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#111111",marginBottom:10},children:a?"Editando equipo":"Nuevo equipo"}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[e.jsxs("div",{style:{flex:2},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Nombre del equipo"}),e.jsx("input",{value:s.nombre,onChange:c=>d(g=>({...g,nombre:c.target.value})),placeholder:"Ej: Equipo elctrico bsico",style:{...x(),width:"100%",fontSize:13}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Rendimiento (h/ud)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:s.rendimiento,onChange:c=>d(g=>({...g,rendimiento:parseFloat(c.target.value)||0})),style:{...x(),width:"100%",textAlign:"center"}})]})]}),e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:5},children:"Cargos"}),s.cargos.map((c,g)=>e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6,alignItems:"center"},children:[e.jsx("select",{value:c.catId,onChange:l=>d(f=>({...f,cargos:f.cargos.map((y,h)=>h===g?{...y,catId:l.target.value}:y)})),style:{...x(),flex:2},children:u.map(l=>e.jsx("option",{value:l.id,children:l.label},l.id))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flex:1},children:[e.jsx("span",{style:{fontSize:11,color:"#888"},children:""}),e.jsx("input",{type:"number",min:"1",value:c.cantidad,onChange:l=>d(f=>({...f,cargos:f.cargos.map((y,h)=>h===g?{...y,cantidad:parseInt(l.target.value)||1}:y)})),style:{...x(),width:50,textAlign:"center"}})]}),e.jsxs("span",{style:{fontSize:11,color:"#888",fontFamily:"'DM Mono',monospace",flex:1},children:[j(ro(c.catId,t))," ",w,"/h"]}),e.jsx("button",{onClick:()=>d(l=>({...l,cargos:l.cargos.filter((f,y)=>y!==g)})),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:12})})]},c.id)),e.jsxs("button",{onClick:()=>d(c=>{var g;return{...c,cargos:[...c.cargos,{id:b(),catId:((g=u[0])==null?void 0:g.id)||"",cantidad:1}]}}),style:{fontSize:11,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:3,marginBottom:10},children:[e.jsx(Pe,{size:11})," Aadir cargo"]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Equipos/herramientas"}),e.jsx("input",{type:"number",min:"0",value:s.equiposCosto,onChange:c=>d(g=>({...g,equiposCosto:parseFloat(c.target.value)||0})),style:{...x(),width:"100%"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Licencias/medios"}),e.jsx("input",{type:"number",min:"0",value:s.licenciasCosto,onChange:c=>d(g=>({...g,licenciasCosto:parseFloat(c.target.value)||0})),style:{...x(),width:"100%"}})]})]}),e.jsxs("div",{style:{fontSize:12,color:"#111111",fontWeight:600,marginBottom:10},children:["Costo/ud estimado: ",j(m(s))," ",w]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>{if(!s.nombre){alert("Pon un nombre al equipo");return}n(a?o.map(c=>c.id===a?{...s,id:a}:c):[...o,s]),d(null),r(null)},style:{padding:"6px 14px",background:"#111111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(ft,{size:12})," Guardar"]}),e.jsx("button",{onClick:()=>{d(null),r(null)},style:{padding:"6px 14px",border:"1px solid #E0E0E0",background:"#fff",borderRadius:6,cursor:"pointer",fontSize:12},children:"Cancelar"})]})]}),o.map((c,g)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:"1px solid #E0E0E0"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,color:"#111"},children:c.nombre}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2},children:[c.cargos.map(l=>{var y,h;const f=(h=(y=Eo[t])==null?void 0:y.categorias)==null?void 0:h.find(v=>v.id===l.catId);return`${l.cantidad} ${(f==null?void 0:f.label)||l.catId}`}).join("  "),c.equiposCosto>0?`  +${j(c.equiposCosto)} eq.`:"",c.licenciasCosto>0?`  +${j(c.licenciasCosto)} lic.`:""]})]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:600,color:"#111111",minWidth:100,textAlign:"right"},children:[j(m(c)),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:10,fontWeight:400,color:"#888"},children:[w,"/ud  rend ",c.rendimiento,"h"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>{d({...c}),r(c.id)},style:{background:"none",border:"1px solid #E0E0E0",borderRadius:4,cursor:"pointer",padding:"4px 8px",fontSize:11,color:"#555"},children:"Editar"}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar este equipo?")&&n(o.filter(l=>l.id!==c.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:13})})]})]},c.id)),o.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"24px",color:"#888",fontSize:13},children:"Sin equipos. Crea el primero."})]})]})})}function Ih({pais:t,linea:i,apu:o,setApu:n}){const[a,r]=ac(),[s,d]=F.useState(!1),u=t==="CO"?"COP":"EUR",b=c=>c!=null?new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(c):"0",j=o.equiposUsados||[],w=c=>{j.find(l=>l.eqId===c)||!a.find(l=>l.id===c)||n(l=>({...l,equiposUsados:[...l.equiposUsados||[],{id:Math.random().toString(36).slice(2,8),eqId:c,rendimientoOverride:null}]}))},S=c=>n(g=>({...g,equiposUsados:(g.equiposUsados||[]).filter(l=>l.id!==c)})),m=(c,g,l)=>n(f=>({...f,equiposUsados:(f.equiposUsados||[]).map(y=>y.id===c?{...y,[g]:l}:y)})),x=(c,g)=>{const l=g??c.rendimiento;return c.cargos.reduce((f,y)=>{const h=ro(y.catId,t);return f+h*l*(y.cantidad||1)},0)+(c.equiposCosto||0)+(c.licenciasCosto||0)},p=j.reduce((c,g)=>{const l=a.find(y=>y.id===g.eqId);if(!l)return c;const f=g.rendimientoOverride??l.rendimiento;return c+x(l,f)*(i.cantidad||1)},0);return e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8,paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Equipos de trabajo (MO)"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("select",{defaultValue:"",onChange:c=>{c.target.value&&(w(c.target.value),c.target.value="")},style:{border:"1px solid #3B3B3B",borderRadius:5,padding:"3px 8px",fontSize:12,color:"#3B3B3B",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:"#F0F0F0"},children:[e.jsx("option",{value:"",children:"+ Aadir equipo de biblioteca"}),a.map(c=>e.jsxs("option",{value:c.id,children:[c.nombre,"  ",b(x(c,null)),u,"/ud"]},c.id))]}),e.jsx("button",{onClick:()=>d(!0),style:{border:"1px solid #E0E0E0",borderRadius:5,padding:"3px 8px",fontSize:11,cursor:"pointer",background:"#fff",color:"#555",fontFamily:"'DM Sans',sans-serif"},children:"Gestionar biblioteca"})]})]}),j.length===0&&e.jsx("div",{style:{color:"#BBB",fontSize:12,padding:"8px 0",textAlign:"center"},children:"Selecciona equipos de la biblioteca para calcular MO"}),j.map(c=>{var v;const g=a.find(A=>A.id===c.eqId);if(!g)return null;const l=c.rendimientoOverride??g.rendimiento,f=x(g,l),y=f*(i.cantidad||1),h=((v=Eo[t])==null?void 0:v.categorias)||[];return e.jsxs("div",{style:{border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,overflow:"hidden"},children:[e.jsxs("div",{style:{background:"#F5F4F1",padding:"7px 12px",display:"flex",alignItems:"center",gap:10,borderBottom:"1px solid #E0E0E0"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,color:"#111",flex:1},children:g.nombre}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#555"},children:[e.jsx("span",{children:"Rendimiento:"}),e.jsx("input",{type:"number",min:"0",step:"0.001",value:l,onChange:A=>m(c.id,"rendimientoOverride",parseFloat(A.target.value)||0),style:{width:65,border:"1px solid #E0E0E0",borderRadius:4,padding:"3px 5px",fontSize:12,textAlign:"center",fontFamily:"'DM Sans',sans-serif"}}),e.jsxs("span",{children:["h/",i.unidad||"ud"]}),e.jsxs("span",{style:{fontSize:10,color:"#BBB",marginLeft:2},children:["(bib: ",g.rendimiento,"h)"]})]}),e.jsx("button",{onClick:()=>S(c.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:13})})]}),e.jsxs("div",{style:{padding:"8px 12px",fontSize:12,color:"#555"},children:[g.cargos.map((A,z)=>{const k=h.find(C=>C.id===A.catId),T=ro(A.catId,t);return e.jsxs("span",{style:{marginRight:12},children:[A.cantidad," ",(k==null?void 0:k.label)||A.catId," (",b(T),u,"/h)"]},z)}),g.equiposCosto>0&&e.jsxs("span",{style:{marginRight:12},children:["+",b(g.equiposCosto)," eq."]}),g.licenciasCosto>0&&e.jsxs("span",{children:["+",b(g.licenciasCosto)," lic."]}),e.jsxs("span",{style:{float:"right",fontWeight:700,color:"#111111",fontFamily:"'DM Mono',monospace"},children:[b(f),"/ud  ",b(y)," total"]})]})]},c.id)}),j.length>0&&e.jsxs("div",{style:{textAlign:"right",fontSize:13,fontWeight:600,color:"#111111",fontFamily:"'DM Mono',monospace",marginBottom:8},children:["Total MO: ",b(p)," ",u]}),s&&e.jsx(Bh,{pais:t,onClose:()=>d(!1)})]})}function Rh({linea:t,oferta:i,onSave:o,onClose:n}){var f;const a=i.pais||"CO",r=a==="CO"?"COP":"EUR",s=t.tipo,d=Zr.find(y=>y.id===s),u=(d==null?void 0:d.modo)==="diseno",[b,j]=F.useState(t.apu||{estudios:[],mo:[],subcontratas:[],equiposUsados:[],materiales:[],equipos:[]}),w=Th({...t,apu:b},i);(f=Eo[a])!=null&&f.categorias;const S=(y,h,v,A)=>j(z=>({...z,[y]:z[y].map(k=>k.id===h?{...k,[v]:A}:k)})),m=(y,h)=>j(v=>({...v,[y]:v[y].filter(A=>A.id!==h)})),x=(y,h)=>j(v=>({...v,[y]:[...v[y]||[],{id:Ct(),...h}]})),p=(y,h=0)=>y!=null&&!isNaN(y)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:h,maximumFractionDigits:h}).format(y):"0",c={padding:"5px 8px",fontSize:10,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",textAlign:"left"},g={padding:"5px 6px",borderBottom:"1px solid #E0E0E0",fontSize:13,verticalAlign:"middle"},l=(y={})=>({border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 6px",fontSize:12,fontFamily:"'DM Sans',sans-serif",...y});return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:999,display:"flex",alignItems:"flex-start",justifyContent:"center",overflowY:"auto",padding:"20px 16px"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,width:"100%",maxWidth:820,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:["APU  ",d==null?void 0:d.icon," ",d==null?void 0:d.label]}),e.jsxs("div",{style:{fontSize:15,fontWeight:700,color:"#111",marginTop:2},children:[t.descripcion||"Partida sin nombre","  ",t.cantidad," ",t.unidad]})]}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:20})})]}),e.jsxs("div",{style:{padding:"14px 18px"},children:[u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:8,paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Estudios / Entregables"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:8},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:c,children:"Entregable"}),e.jsx("th",{style:{...c,textAlign:"center",width:80},children:"Horas"}),e.jsx("th",{style:{...c,textAlign:"center",width:60},children:"Incl."}),e.jsx("th",{style:c})]})}),e.jsx("tbody",{children:(b.estudios||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:g,children:e.jsxs("select",{value:y.estudioId,onChange:h=>{const v=Gl.find(A=>A.id===h.target.value);S("estudios",y.id,"estudioId",h.target.value),v&&S("estudios",y.id,"nombre",v.nombre),v&&y.tipo!=="subcontrata"&&S("estudios",y.id,"horas",v.horas),S("estudios",y.id,"tipo",(v==null?void 0:v.tipo)||"plano")},style:{...l(),width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),["plano","render","doc","tramite","subcontrata"].map(h=>e.jsx("optgroup",{label:h.toUpperCase(),children:Gl.filter(v=>v.tipo===h).map(v=>e.jsx("option",{value:v.id,children:v.nombre},v.id))},h))]})}),e.jsx("td",{style:g,children:y.tipo==="subcontrata"?e.jsx("input",{type:"number",value:y.importe||0,onChange:h=>S("estudios",y.id,"importe",parseFloat(h.target.value)||0),placeholder:"importe",style:{...l(),width:90,textAlign:"right"}}):e.jsx("input",{type:"number",value:y.horas||0,onChange:h=>S("estudios",y.id,"horas",parseFloat(h.target.value)||0),style:{...l(),width:60,textAlign:"center"}})}),e.jsx("td",{style:{...g,textAlign:"center"},children:y.tipo==="subcontrata"?e.jsx("span",{style:{fontSize:11,color:"#888"},children:"sub"}):e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:12},children:p((y.horas||0)*w.costoH,0)})}),e.jsx("td",{style:g,children:e.jsx("button",{onClick:()=>m("estudios",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:12})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>x("estudios",{estudioId:"",nombre:"",horas:0,tipo:"plano",importe:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:12},children:[e.jsx(Pe,{size:12})," Aadir entregable"]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:6,padding:"8px 12px",fontSize:11,color:"#555",marginBottom:8,display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:600},children:"Costo/hora:"}),i.apuModoHora==="MANUAL"?e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:["Manual: ",p(i.apuCostoHoraManual||0,0)," ",r,"/h"]}):e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:[p(w.costoH||0,0)," ",r,"/h",e.jsxs("span",{style:{color:"#888",fontFamily:"'DM Sans',sans-serif"},children:["(salario ",(i.apuSalarioAnual||0).toLocaleString("es-CO")," +",((i.apuPrestaciones||0)*100).toFixed(0),"% SS ",p((i.apuHDia||8)*(i.apuDiasSem||5)*(i.apuSemanas||52)*(i.apuPctProductivas||.6),0),"h prod.)"]})]}),e.jsx("span",{style:{color:"#BBB",marginLeft:"auto",fontSize:10},children:"Configurable en tab APU Diseo (oferta)"})]}),e.jsxs("div",{style:{textAlign:"right",fontSize:13,fontWeight:600,color:"#111",marginBottom:12},children:["Total horas: ",e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[p(w.horasTotal||0,1)," h"]}),"Subtotal MO diseo: ",e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:[p(w.cdDis||0,0)," ",r]})]})]}),!u&&e.jsxs(e.Fragment,{children:[e.jsx(Ih,{pais:a,linea:t,apu:b,setApu:j}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Materiales"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...c,width:90},children:"Cdigo"}),e.jsx("th",{style:{...c,width:"35%"},children:"Descripcin"}),e.jsx("th",{style:c,children:"Unidad"}),e.jsx("th",{style:{...c,textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{...c,textAlign:"right",width:110},children:"Precio unit."}),e.jsx("th",{style:{...c,textAlign:"right",width:100},children:"Subtotal"}),e.jsx("th",{style:c})]})}),e.jsx("tbody",{children:(b.materiales||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:g,children:e.jsxs("select",{value:y.codigoCat||"",onChange:h=>{const v=h.target.value,A=to.find(z=>z.codigo===v);A?(S("materiales",y.id,"codigoCat",v),S("materiales",y.id,"descripcion",A.nombre),S("materiales",y.id,"unidad",A.unidad||"ud"),!y.precio&&A.precioRef&&S("materiales",y.id,"precio",A.precioRef)):S("materiales",y.id,"codigoCat","")},style:{...l(),width:"100%",fontSize:10,fontFamily:"'DM Mono',monospace",padding:"3px 4px"},children:[e.jsx("option",{value:"",children:""}),to.filter(h=>["consumible","seguridad"].includes(h.familia)).map(h=>e.jsx("option",{value:h.codigo,children:h.codigo},h.codigo))]})}),e.jsx("td",{style:g,children:e.jsx("input",{value:y.descripcion||"",onChange:h=>S("materiales",y.id,"descripcion",h.target.value),style:{...l(),width:"100%"},placeholder:"Material..."})}),e.jsx("td",{style:g,children:e.jsx("select",{value:y.unidad||"ud",onChange:h=>S("materiales",y.id,"unidad",h.target.value),style:l(),children:["m","m","ml","kg","ton","ud","gl","l","m","rollo","pliego","jgo","caja","tubo","par"].map(h=>e.jsx("option",{children:h},h))})}),e.jsx("td",{style:g,children:e.jsx("input",{type:"number",min:"0",step:"0.001",value:y.cantidad||0,onChange:h=>S("materiales",y.id,"cantidad",parseFloat(h.target.value)||0),style:{...l(),width:70,textAlign:"center"}})}),e.jsx("td",{style:g,children:e.jsx("input",{type:"number",min:"0",value:y.precio||0,onChange:h=>S("materiales",y.id,"precio",parseFloat(h.target.value)||0),style:{...l(),width:100,textAlign:"right"}})}),e.jsx("td",{style:{...g,textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:600},children:p((y.cantidad||0)*(y.precio||0),0)}),e.jsx("td",{style:g,children:e.jsx("button",{onClick:()=>m("materiales",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>x("materiales",{codigoCat:"",descripcion:"",unidad:"ud",cantidad:0,precio:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[e.jsx(Pe,{size:12})," Aadir material"]}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Equipos / herramientas directos"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...c,width:90},children:"Cdigo"}),e.jsx("th",{style:{...c,width:"35%"},children:"Descripcin"}),e.jsx("th",{style:c,children:"Unidad"}),e.jsx("th",{style:{...c,textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{...c,textAlign:"right",width:110},children:"Precio unit."}),e.jsx("th",{style:{...c,textAlign:"right",width:100},children:"Subtotal"}),e.jsx("th",{style:c})]})}),e.jsx("tbody",{children:(b.equipos||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:g,children:e.jsxs("select",{value:y.codigoCat||"",onChange:h=>{const v=h.target.value,A=to.find(z=>z.codigo===v);A?(S("equipos",y.id,"codigoCat",v),S("equipos",y.id,"descripcion",A.nombre),S("equipos",y.id,"unidad",A.unidad||"ud"),!y.precio&&A.precioRef&&S("equipos",y.id,"precio",A.precioRef)):S("equipos",y.id,"codigoCat","")},style:{...l(),width:"100%",fontSize:10,fontFamily:"'DM Mono',monospace",padding:"3px 4px"},children:[e.jsx("option",{value:"",children:""}),to.filter(h=>["herr_menor","herr_mayor","equipo_obra","equipo_medic"].includes(h.familia)).map(h=>e.jsxs("option",{value:h.codigo,children:[h.codigo," ",h.nombre]},h.codigo))]})}),e.jsx("td",{style:g,children:e.jsx("input",{value:y.descripcion||y.nombre||"",onChange:h=>S("equipos",y.id,"descripcion",h.target.value),style:{...l(),width:"100%"},placeholder:"Equipo..."})}),e.jsx("td",{style:g,children:e.jsx("select",{value:y.unidad||"ud",onChange:h=>S("equipos",y.id,"unidad",h.target.value),style:l(),children:["ud","h","da","mes","gl","cuerpo","jgo"].map(h=>e.jsx("option",{children:h},h))})}),e.jsx("td",{style:g,children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:y.cantidad||0,onChange:h=>S("equipos",y.id,"cantidad",parseFloat(h.target.value)||0),style:{...l(),width:70,textAlign:"center"}})}),e.jsx("td",{style:g,children:e.jsx("input",{type:"number",min:"0",value:y.precio||0,onChange:h=>S("equipos",y.id,"precio",parseFloat(h.target.value)||0),style:{...l(),width:100,textAlign:"right"}})}),e.jsx("td",{style:{...g,textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:600},children:p((y.cantidad||0)*(y.precio||0),0)}),e.jsx("td",{style:g,children:e.jsx("button",{onClick:()=>m("equipos",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>x("equipos",{codigoCat:"",descripcion:"",unidad:"ud",cantidad:0,precio:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[e.jsx(Pe,{size:12})," Aadir equipo/herramienta"]})]}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Subcontratas"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...c,width:"70%"},children:"Descripcin del trabajo subcontratado"}),e.jsx("th",{style:{...c,textAlign:"right"},children:"Importe"}),e.jsx("th",{style:c})]})}),e.jsx("tbody",{children:(b.subcontratas||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:g,children:e.jsx("input",{value:y.descripcion||"",onChange:h=>S("subcontratas",y.id,"descripcion",h.target.value),style:{...l(),width:"100%"}})}),e.jsx("td",{style:g,children:e.jsx("input",{type:"number",min:"0",value:y.importe||0,onChange:h=>S("subcontratas",y.id,"importe",parseFloat(h.target.value)||0),style:{...l(),width:120,textAlign:"right"}})}),e.jsx("td",{style:g,children:e.jsx("button",{onClick:()=>m("subcontratas",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>x("subcontratas",{descripcion:"",importe:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:12},children:[e.jsx(Pe,{size:12})," Aadir subcontrata"]}),e.jsxs("div",{style:{background:"#E8F4EE",border:"1px solid #B8DEC9",borderRadius:8,padding:"12px 14px",marginTop:8},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#111111",marginBottom:8,textTransform:"uppercase",letterSpacing:.5},children:"Resumen costos directos"}),u?[["Diseo/planos",w.cdDis],["MO directa",w.cdMO],["Subcontratas",w.cdSub]].map(([y,h])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,padding:"2px 0",borderBottom:"1px solid #B8DEC9"},children:[e.jsx("span",{style:{color:"#111111"},children:y}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:[p(h||0,0)," ",r]})]},y)):[["Mano de obra (cuadrillas)",w.cdMO],["Materiales",w.cdMat],["Equipos directos",w.cdEq],["Subcontratas",w.cdSub]].map(([y,h])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,padding:"2px 0",borderBottom:"1px solid #B8DEC9"},children:[e.jsx("span",{style:{color:"#111111"},children:y}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:[p(h||0,0)," ",r]})]},y)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:15,padding:"8px 0 0",fontWeight:700,color:"#111111"},children:[e.jsx("span",{children:"CD Total"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[p(w.CD||0,0)," ",r]})]})]})]}),e.jsxs("div",{style:{padding:"12px 18px",borderTop:"1px solid #E0E0E0",display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx("button",{onClick:n,style:{padding:"7px 16px",border:"1px solid #E0E0E0",borderRadius:6,background:"#fff",cursor:"pointer",fontSize:13},children:"Cancelar"}),e.jsxs("button",{onClick:()=>o({apu:b,precioCD:w.CD}),style:{padding:"7px 16px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:13,fontWeight:600,display:"flex",alignItems:"center",gap:5},children:[e.jsx(ft,{size:14})," Guardar APU"]})]})]})})}const Ht=(t,i,o)=>{o.pais;const n=o.margen||.25,a=o.ggPct||0,r=(o.pctRCE||0)+(o.pctTRC||0)+(o.pctAdm||0)+(o.pctICA||0),s=o.ivaComision??.19;let d=0;o.medioPago==="PSE"?d=(o.pctComPSE??.012)*(1+s):o.medioPago==="Tarjeta"?d=(o.pctComTarjeta??.036)*(1+s):o.medioPago==="Transferencia"?d=(o.pctComTransf??0)*(1+s):o.medioPago==="Manual"&&(d=o.pctComManual??0);const u=o.aplicar4x1000==="SI"?.004:0,b=d+u,j=o.modoCalcObra||"margen",w=o.tipoProyecto==="OBRA"&&j==="aiu"?1-r:1-n-r-a,S=1-b,m=w*S;let x=t;if(o.tipoProyecto==="OBRA"&&j==="aiu"){const l=(o.aiuA||.08)+(o.aiuI||.03)+(o.aiuU||.07);x=t*(1+l)}const p=m>0?x/m:0,c=i||1,g=j==="aiu"?(o.aiuA||.08)*t:a*p;return{puCoste:c>0?t/c:0,totalCoste:t,puVenta:c>0?p/c:0,totalVenta:p,cd:t,gc:r*p,gg:g,gf:b*p,margenCOP:n*p,pvp:p,coefMult:m>0?(j==="aiu"?x/t:1)/m:0,den:m}};function Mh({d:t,set:i,r:o}){const n=t.pais||"CO",a=n==="CO"?"COP":"EUR",r=(R,W=0)=>R!=null&&!isNaN(R)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:W,maximumFractionDigits:W}).format(R):"0",[s,d]=F.useState(null),[u,b]=F.useState(null),[j,w]=F.useState(!1),[S,m]=F.useState("todos"),[x,p]=F.useState(!1),[c,g]=F.useState("detallado"),[l,f]=F.useState(null),y=t.borradorLineas||[],h=R=>i("borradorLineas",R),v=()=>h([...y,{id:Ct(),esCapitulo:!0,nombre:"CAPTULO "+(y.filter(R=>R.esCapitulo).length+1),tipo:Dn[0].id}]),A=R=>h([...y,{id:Ct(),esCapitulo:!1,tipo:R||Dn[0].id,codigo:"",descripcion:"",unidad:"m",cantidad:1,apu:null,precioCD:0}]),z=(R,W,se)=>h(y.map(le=>le.id===R?{...le,[W]:se}:le)),k=R=>h(y.filter(W=>W.id!==R)),T=(R,W)=>{const se=[...y],le=se.findIndex(de=>de.id===R);le+W<0||le+W>=se.length||([se[le],se[le+W]]=[se[le+W],se[le]],h(se))},C=R=>f(R),D=R=>R.preventDefault(),K=R=>{if(!l||l===R){f(null);return}const W=[...y],se=W.findIndex(Z=>Z.id===l),le=W.findIndex(Z=>Z.id===R);if(se<0||le<0){f(null);return}const[de]=W.splice(se,1);W.splice(le,0,de),h(W),f(null)},oe=(R,W)=>{h(y.map(se=>se.id===R?{...se,...W}:se)),d(null)},te=()=>{var W;const R=y.filter(se=>!se.esCapitulo&&se.descripcion).map(se=>({id:se.id,otId:t.id,otNombre:t.proyecto||t.cliente,codigo:se.codigo,nombre:se.descripcion,unidad:se.unidad,cantidad:se.cantidad,presupuesto:se.precioCD||0,avance:0,estado:"pendiente"}));try{(W=window.storage)==null||W.set("hab:proj:actividades:"+t.id,JSON.stringify(R)),alert(` ${R.length} actividades exportadas al mdulo Proyectos.`)}catch(se){alert("Error: "+se.message)}},P=y.filter(R=>!R.esCapitulo).reduce((R,W)=>R+(W.precioCD||0),0),ie=t.pctU||.07,me=.08,Q=.03,je=n==="CO"?P*(me+Q+ie):0,re=n==="ES"?P*(t.gg||.13):0,J=n==="ES"?P*(t.bi||.06):0,M=n==="CO"?t.tarifaIVA||.19:t.tarifaIVA||.1,B=y.find(R=>R.id===s),V=["m","m","ml","m","kg","ton","ud","gl","h","da","sem","mes","l","mxl","vje"],X=()=>{for(let R=y.length-1;R>=0;R--)if(y[R].esCapitulo)return y[R].tipo;return Dn[0].id};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("button",{onClick:v,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"1px solid #E0E0E0",borderRadius:6,background:"#F5F4F1",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:500},children:[e.jsx(zn,{size:13})," Aadir captulo"]}),e.jsxs("button",{onClick:()=>A(X()),style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:600},children:[e.jsx(Pe,{size:13})," Nueva partida"]}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{display:"flex",border:"1px solid #E0E0E0",borderRadius:6,overflow:"hidden"},children:[["coste","Vista interna",!1],["venta","Vista cliente",!0]].map(([R,W,se])=>e.jsx("button",{onClick:()=>p(se),style:{padding:"6px 14px",border:"none",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:x===se?"#111":"#fff",color:x===se?"#fff":"#555",transition:"all .15s"},children:W},R))}),x&&e.jsx("div",{style:{display:"flex",border:"1px solid #E0E0E0",borderRadius:6,overflow:"hidden",marginLeft:8},children:[["detallado","Detallado"],["capitulos","Captulos"],["total","Total"]].map(([R,W])=>e.jsx("button",{onClick:()=>g(R),style:{padding:"6px 10px",border:"none",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:c===R?"#3B3B3B":"#fff",color:c===R?"#fff":"#888",transition:"all .15s"},children:W},R))}),e.jsxs("button",{onClick:()=>w(!0),style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",marginLeft:8,border:"none",borderRadius:6,background:"#3B3B3B",color:"#fff",cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif",fontWeight:700},children:[e.jsx(yn,{size:13})," APUs de Venta"]}),t.estado==="Ganada"&&e.jsxs("button",{onClick:te,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"none",borderRadius:6,background:"#3B3B3B",color:"#fff",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:600},children:[e.jsx(Mc,{size:13})," Exportar al Gantt"]})]}),(()=>{const R=y.filter(Z=>!Z.esCapitulo&&Z.precioCD).reduce((Z,ue)=>Z+Ht(ue.precioCD||0,ue.cantidad||1,t).totalVenta,0),W=R*M,se=R+W,le=R-P,de=R>0?(le/R*100).toFixed(1):0;return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(145px,1fr))",gap:8,marginBottom:14},children:[["Costos directos",r(P,0)+" "+a,"#555"],n==="CO"?["AIU "+((me+Q+ie)*100).toFixed(0)+"%",r(je,0)+" "+a,"#8C6A00"]:["GG+BI "+((t.gg||.13)*100+(t.bi||.06)*100).toFixed(0)+"%",r(re+J,0)+" "+a,"#3B3B3B"],["Venta s/IVA",r(R,0)+" "+a,"#3B3B3B"],["IVA "+(M*100).toFixed(0)+"%",r(W,0)+" "+a,"#555"],["TOTAL c/IVA",r(se,0)+" "+a,"#111111"],["Margen",de+"%  "+r(le,0),"#2B7A52"]].map(([Z,ue,N])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"8px 10px",borderLeft:"3px solid "+N},children:[e.jsx("div",{style:{fontSize:9,color:"#888",marginBottom:2},children:Z}),e.jsx("div",{style:{fontSize:12,fontWeight:700,color:N,fontFamily:"'DM Mono',monospace"},children:ue})]},Z))})})(),e.jsx("div",{style:{border:"1px solid #E0E0E0",borderRadius:8,overflow:"hidden",marginBottom:14,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:x?700:1100},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:[{l:"Cd",w:52},{l:"Descripcin / Actividad",w:"20%"},{l:"Tipo",w:96},{l:"Unid",w:52},{l:"Cant.",w:68},...x?[]:[{l:"PU coste",w:86},{l:"CD Total ",w:100}],{l:"PU venta",w:96},{l:"Total venta",w:106},...x?[]:[{l:"% Inc.",w:52}],...x?[{l:"APU Vta",w:64}]:[{l:"APU",w:64}],{l:"",w:52}].filter(R=>R.w!==0).map(R=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"2px solid #E0E0E0",textAlign:"left",width:R.w,minWidth:typeof R.w=="number"?R.w:void 0},children:R.l},R.l))})}),e.jsxs("tbody",{children:[y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:x?8:12,style:{padding:"32px",textAlign:"center",color:"#999",fontSize:13},children:"Aade un captulo y partidas para construir el borrador."})}),x&&c==="total"&&y.length>0&&(()=>{const R=y.filter(W=>!W.esCapitulo&&W.precioCD).reduce((W,se)=>W+Ht(se.precioCD||0,se.cantidad||1,t).totalVenta,0);return e.jsxs("tr",{style:{background:"#fff"},children:[e.jsxs("td",{colSpan:5,style:{padding:"12px 12px",fontSize:13,fontWeight:600},children:[t.proyecto||"Proyecto","  Precio total"]}),e.jsx("td",{style:{padding:"12px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"12px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700,color:"#111111"},children:r(R,0)}),e.jsx("td",{})]})})(),x&&c==="capitulos"&&y.length>0&&(()=>{const R=[];let W=null,se=[];y.forEach(Z=>{Z.esCapitulo?(W&&R.push({cap:W,items:se}),W=Z,se=[]):se.push(Z)}),W&&R.push({cap:W,items:se});const le=[];let de=!1;return y.forEach(Z=>{Z.esCapitulo&&(de=!0),!de&&!Z.esCapitulo&&le.push(Z)}),e.jsxs(e.Fragment,{children:[le.length>0&&e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("td",{colSpan:5,style:{padding:"10px 12px",fontSize:12,fontWeight:600,fontStyle:"italic"},children:"Partidas sin captulo"}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:"#111111"},children:r(le.reduce((Z,ue)=>Z+(ue.precioCD>0?Ht(ue.precioCD,ue.cantidad||1,t).totalVenta:0),0),0)}),e.jsx("td",{})]}),R.map(({cap:Z,items:ue},N)=>{const G=ue.reduce((L,ae)=>L+(ae.precioCD>0?Ht(ae.precioCD,ae.cantidad||1,t).totalVenta:0),0);return e.jsxs("tr",{style:{background:N%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${E.border}`},children:[e.jsxs("td",{colSpan:5,style:{padding:"10px 12px"},children:[e.jsx("span",{style:{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5},children:Z.nombre||"Captulo"}),e.jsxs("span",{style:{marginLeft:8,fontSize:10,color:E.inkLight},children:[ue.length," partida",ue.length!==1?"s":""]})]}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:700,color:"#111111"},children:r(G,0)}),e.jsx("td",{})]},Z.id)})]})})(),(!x||c==="detallado")&&y.map((R,W)=>{var de,Z,ue,N;if(R.esCapitulo){const G=Dn.find(L=>L.id===(R.tipo||"CAP00"));return e.jsxs("tr",{draggable:!0,onDragStart:()=>C(R.id),onDragOver:D,onDrop:()=>K(R.id),style:{background:l===R.id?"#D5D2CC":"#EDEBE7",cursor:"grab",opacity:l===R.id?.5:1},children:[e.jsx("td",{colSpan:2,style:{padding:"8px 12px"},children:e.jsx("input",{value:R.nombre||"",onChange:L=>z(R.id,"nombre",L.target.value),style:{fontWeight:700,fontSize:13,color:"#111",background:"transparent",border:"none",outline:"none",width:"100%",textTransform:"uppercase",letterSpacing:.5}})}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("select",{value:R.tipo||"CAP00",onChange:L=>z(R.id,"tipo",L.target.value),style:{border:"1px solid #CCC",borderRadius:5,padding:"3px 7px",fontSize:11,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:(G==null?void 0:G.color)||"#8C6A00",width:"100%"},children:Dn.map(L=>e.jsx("option",{value:L.id,children:L.label},L.id))})}),e.jsx("td",{colSpan:x?4:7,style:{padding:"6px 8px",color:"#AAA",fontSize:10,fontStyle:"italic"},children:"Captulo agrupador"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right"},children:e.jsx("button",{onClick:()=>k(R.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:12})})})]},R.id)}const se=Zr.find(G=>G.id===R.tipo),le=R.apu&&(((de=R.apu.estudios)==null?void 0:de.length)||0)+(((Z=R.apu.equiposUsados)==null?void 0:Z.length)||0)+(((ue=R.apu.materiales)==null?void 0:ue.length)||0)+(((N=R.apu.subcontratas)==null?void 0:N.length)||0)>0;return e.jsxs("tr",{draggable:!0,onDragStart:()=>C(R.id),onDragOver:D,onDrop:()=>K(R.id),style:{background:l===R.id?"#D5E8F9":W%2===0?"#fff":"#F9F8F5",transition:"background .1s",cursor:"grab",opacity:l===R.id?.5:1},onMouseEnter:G=>{l||(G.currentTarget.style.background="#F0F0F0")},onMouseLeave:G=>{l||(G.currentTarget.style.background=W%2===0?"#fff":"#F9F8F5")},children:[e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{value:R.codigo||"",onChange:G=>z(R.id,"codigo",G.target.value),style:{width:52,border:"1px solid #E0E0E0",borderRadius:4,padding:"3px 5px",fontSize:11,fontFamily:"'DM Mono',monospace",textAlign:"center"}})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{value:R.descripcion||"",onChange:G=>z(R.id,"descripcion",G.target.value),placeholder:"Descripcin de la actividad...",style:{width:"100%",border:"1px solid #E0E0E0",borderRadius:4,padding:"5px 8px",fontSize:13}})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("select",{value:R.tipo||Zr[0].id,onChange:G=>z(R.id,"tipo",G.target.value),style:{border:"1px solid #E0E0E0",borderRadius:5,padding:"3px 6px",fontSize:11,background:"transparent",cursor:"pointer",color:(se==null?void 0:se.color)||"#555",fontFamily:"'DM Sans',sans-serif",maxWidth:110},children:Zr.map(G=>e.jsxs("option",{value:G.id,children:[G.icon," ",G.label]},G.id))})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("select",{value:R.unidad||"m",onChange:G=>z(R.id,"unidad",G.target.value),style:{border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 4px",fontSize:12,width:56},children:V.map(G=>e.jsx("option",{children:G},G))})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:R.cantidad||0,onChange:G=>z(R.id,"cantidad",parseFloat(G.target.value)||0),style:{width:72,border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 6px",fontSize:13,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),(()=>{const G=le||R.precioCD>0?Ht(R.precioCD||0,R.cantidad||1,t):null,L=y.filter(he=>!he.esCapitulo&&he.precioCD).reduce((he,ze)=>he+Ht(ze.precioCD||0,ze.cantidad||1,t).totalVenta,0),ae=G&&L>0?G.totalVenta/L*100:0,pe={padding:"5px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,verticalAlign:"middle"};return e.jsxs(e.Fragment,{children:[!x&&e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...pe,color:le||R.precioCD>0?"#555":"#DDD"},children:(le||R.precioCD>0)&&G?r(G.puCoste,0):""}),e.jsx("td",{style:{...pe,fontWeight:le||R.precioCD>0?600:400,color:le||R.precioCD>0?"#111":"#DDD"},children:e.jsx("input",{type:"number",min:"0",step:"100",value:R.precioCD||"",placeholder:"0",onChange:he=>z(R.id,"precioCD",parseFloat(he.target.value)||0),style:{width:90,border:`1px solid ${R.precioCD>0?"#111111":"#E0E0E0"}`,borderRadius:4,padding:"3px 6px",fontSize:12,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,background:R.precioCD>0?"#E6F4EC":"#fff",color:R.precioCD>0?"#111":"#999"}})})]}),e.jsx("td",{style:{...pe,color:le||R.precioCD>0?"#3B3B3B":"#DDD",fontWeight:600},children:(le||R.precioCD>0)&&G?r(G.puVenta,0):""}),e.jsx("td",{style:{...pe,color:le||R.precioCD>0?"#111111":"#DDD",fontWeight:700},children:(le||R.precioCD>0)&&G?r(G.totalVenta,0):""}),!x&&e.jsx("td",{style:{...pe,fontSize:10,color:ae>5?"#111111":"#999"},children:le||R.precioCD>0?ae.toFixed(1)+"%":""})]})})(),!x&&e.jsx("td",{style:{padding:"5px 8px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:3,justifyContent:"center"},children:[e.jsxs("button",{onClick:()=>d(R.id),style:{background:le?"#111111":"transparent",color:le?"#fff":"#3B3B3B",border:`1px solid ${le?"#111111":"#3B3B3B"}`,borderRadius:5,padding:"3px 8px",fontSize:11,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:3},children:[e.jsx(_c,{size:10}),le?"APU ":"+ APU"]}),(Number(R.precioCD)>0||le)&&e.jsxs("button",{onClick:()=>b(R.id),style:{background:"#3B3B3B",color:"#fff",border:"none",borderRadius:5,padding:"3px 7px",fontSize:10,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:2},children:[e.jsx(yn,{size:10})," Venta"]})]})}),e.jsx("td",{style:{padding:"5px 4px"},children:e.jsxs("div",{style:{display:"flex",gap:1},children:[x&&(Number(R.precioCD)>0||le)&&e.jsxs("button",{onClick:()=>b(R.id),style:{background:"#3B3B3B",color:"#fff",border:"none",borderRadius:4,padding:"3px 7px",fontSize:10,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:2},children:[e.jsx(yn,{size:10}),"APU Venta"]}),!x&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(R.id,-1),style:{background:"none",border:"none",cursor:"pointer",color:"#BBB",padding:2},children:e.jsx(tl,{size:11})}),e.jsx("button",{onClick:()=>T(R.id,1),style:{background:"none",border:"none",cursor:"pointer",color:"#BBB",padding:2},children:e.jsx(An,{size:11})}),e.jsx("button",{onClick:()=>k(R.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C",padding:2},children:e.jsx(qe,{size:11})})]})]})})]},R.id)})]}),e.jsx("tfoot",{children:(()=>{const R=y.filter(ue=>!ue.esCapitulo&&ue.precioCD).reduce((ue,N)=>ue+Ht(N.precioCD||0,N.cantidad||1,t).totalVenta,0),W=t.tipoProyecto==="OBRA",se=o.U||t.margen,le=W?se*R*(t.tarifaIVA||.19):R*(t.tarifaIVA||.19),de=R+le,Z=x?8:12;return x?e.jsxs(e.Fragment,{children:[e.jsxs("tr",{style:{background:"#F5F4F1",borderTop:"2px solid #333"},children:[e.jsx("td",{colSpan:Z-1,style:{padding:"10px 12px",fontSize:12,fontWeight:700},children:"Subtotal"}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700},children:[r(R,0)," ",a]})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:Z-1,style:{padding:"6px 12px",fontSize:11,color:E.inkMid},children:W?`IVA ${((t.tarifaIVA||.19)*100).toFixed(0)}% sobre utilidad`:`IVA ${((t.tarifaIVA||.19)*100).toFixed(0)}%`}),e.jsxs("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12},children:[r(le,0)," ",a]})]}),e.jsxs("tr",{style:{background:"#111"},children:[e.jsx("td",{colSpan:Z-1,style:{padding:"12px 12px",color:"#fff",fontSize:14,fontWeight:700},children:"TOTAL"}),e.jsxs("td",{style:{padding:"12px 8px",textAlign:"right",color:"#fff",fontFamily:"'DM Mono',monospace",fontSize:16,fontWeight:700},children:[r(de,0)," ",a]})]})]}):e.jsxs("tr",{style:{background:"#111"},children:[e.jsx("td",{colSpan:4,style:{padding:"10px 12px",color:"#fff",fontSize:13,fontWeight:600},children:"TOTALES"}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",color:"#ccc",fontFamily:"'DM Mono',monospace",fontSize:11},children:[y.filter(ue=>!ue.esCapitulo).length," partidas"]}),e.jsx("td",{style:{padding:"10px 8px"}}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",color:"#aaa",fontFamily:"'DM Mono',monospace",fontSize:12},children:r(P,0)}),e.jsx("td",{style:{padding:"10px 8px"}}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",color:"#fff",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700},children:[r(R,0)," ",a]}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",color:"#aaa",fontSize:10},children:"100%"}),e.jsx("td",{colSpan:2})]})})()})]})}),s&&B&&e.jsx(Rh,{linea:B,oferta:t,onSave:R=>oe(B.id,R),onClose:()=>d(null)}),j&&(()=>{var he;const R=t.tipoProyecto==="OBRA",W=o.U||t.margen;y.filter(ze=>ze.esCapitulo);const se=y.filter(ze=>!ze.esCapitulo&&Number(ze.precioCD)>0),le={};let de=null;y.forEach(ze=>{if(ze.esCapitulo){de=ze;return}if(!ze.esCapitulo&&Number(ze.precioCD)>0){const q=de?de.id:"__sin_cap__",I=de?de.descripcion:"Sin captulo";le[q]||(le[q]={nombre:I,items:[]});const $=Ht(Number(ze.precioCD),ze.cantidad||1,t),H=R?W*$.pvp*(t.tarifaIVA||.19):$.pvp*(t.tarifaIVA||.19);le[q].items.push({...ze,v:$,ivaL:H})}});const Z=Object.keys(le),ue=S==="todos"?Z:Z.filter(ze=>ze===S),N=se.reduce((ze,q)=>ze+Ht(q.precioCD||0,q.cantidad||1,t).pvp,0),G=se.reduce((ze,q)=>ze+Number(q.precioCD||0),0),L=()=>{const ze=["Captulo","Cdigo","Descripcin","Und","Cant","PU Coste","CD Total","GC","GF","Margen","PVP s/IVA","PU Venta","IVA","PVP c/IVA","Coef.Mult"],q=[];ue.forEach(U=>{const _=le[U];_.items.forEach(ce=>{q.push([_.nombre,ce.codigo||"",ce.descripcion||"",ce.und||"",ce.cantidad||1,(ce.v.puCoste||0).toFixed(0),(ce.v.cd||0).toFixed(0),(ce.v.gc||0).toFixed(0),(ce.v.gf||0).toFixed(0),(ce.v.margenCOP||0).toFixed(0),(ce.v.pvp||0).toFixed(0),(ce.v.puVenta||0).toFixed(0),(ce.ivaL||0).toFixed(0),(ce.v.pvp+ce.ivaL).toFixed(0),(ce.v.coefMult||0).toFixed(4)])})});const I=[ze.join(";"),...q.map(U=>U.join(";"))].join(`
`),$=new Blob(["\uFEFF"+I],{type:"text/csv;charset=utf-8"}),H=document.createElement("a");H.href=URL.createObjectURL($),H.download=`APUs_Venta_${t.codigoOferta||"oferta"}.csv`,H.click()},ae=()=>{const ze=window.open("","_blank");let q=`<html><head><title>APUs de Venta - ${t.codigoOferta||""}</title>
          <style>@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@400;600;700&family=DM+Mono:wght@400;500&display=swap');
          *{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;padding:28px;color:#111;font-size:11px}
          h1{font-size:18px;margin-bottom:4px}h2{font-size:13px;margin:20px 0 8px;padding:6px 0;border-bottom:2px solid #111}
          .meta{color:#888;font-size:10px;margin-bottom:16px}
          table{width:100%;border-collapse:collapse;margin-bottom:16px}
          th{background:#F5F4F1;padding:5px 6px;font-size:8px;text-transform:uppercase;letter-spacing:0.5px;text-align:right;border-bottom:2px solid #E0E0E0}
          th:nth-child(1),th:nth-child(2){text-align:left}
          td{padding:5px 6px;border-bottom:1px solid #E0E0E0;font-size:10px;text-align:right}
          td:nth-child(1),td:nth-child(2){text-align:left}
          .mono{font-family:'DM Mono',monospace}.bold{font-weight:700}.green{color:#111111}.blue{color:#3B3B3B}
          .totrow td{font-weight:700;border-top:2px solid #111;padding-top:8px}
          .param{background:#F5F4F1;padding:10px 14px;border-radius:4px;font-size:9px;color:#555;margin-bottom:16px}
          @media print{body{padding:12px}}
          </style></head><body>`;q+=`<h1>APUs de Venta  ${t.proyecto||t.codigoOferta||"Oferta"}</h1>`,q+=`<div class="meta">${t.codigoOferta||""}  ${t.cliente||""}  ${a}  ${new Date().toLocaleDateString("es-CO")}</div>`,q+=`<div class="param">Margen: ${(t.margen*100).toFixed(1)}%  GC: ${((o.g||0)*100).toFixed(2)}%  GF: ${((o.f||0)*100).toFixed(2)}%  IVA: ${((t.tarifaIVA||.19)*100).toFixed(0)}%${R?" (sobre utilidad)":""}</div>`,ue.forEach(I=>{const $=le[I];q+=`<h2>${$.nombre}</h2><table><tr><th>Descripcin</th><th>Und</th><th>Cant</th><th>PU Coste</th><th>CD</th><th>GC</th><th>GF</th><th>Margen</th><th>PVP s/IVA</th><th>PU Venta</th><th>IVA</th><th>PVP c/IVA</th></tr>`;let H=0;$.items.forEach(U=>{const _=U.v.pvp+U.ivaL;H+=_,q+=`<tr><td>${U.descripcion||""}</td><td>${U.und||""}</td><td class="mono">${U.cantidad||1}</td>`,q+=`<td class="mono">${r(U.v.puCoste,0)}</td><td class="mono">${r(U.v.cd,0)}</td>`,q+=`<td class="mono">${r(U.v.gc,0)}</td><td class="mono">${r(U.v.gf,0)}</td>`,q+=`<td class="mono">${r(U.v.margenCOP,0)}</td>`,q+=`<td class="mono bold blue">${r(U.v.pvp,0)}</td>`,q+=`<td class="mono">${r(U.v.puVenta,0)}</td>`,q+=`<td class="mono">${r(U.ivaL,0)}</td>`,q+=`<td class="mono bold green">${r(_,0)}</td></tr>`}),q+=`<tr class="totrow"><td colspan="8">Subtotal ${$.nombre}</td><td colspan="4" class="mono green">${r(H,0)} ${a}</td></tr></table>`}),q+=`<table style="margin-top:16px"><tr class="totrow"><td colspan="8" style="font-size:14px">TOTAL VENTA</td><td colspan="4" class="mono green" style="font-size:14px">${r(N+se.reduce((I,$)=>{const H=Ht($.precioCD||0,$.cantidad||1,t);return I+(R?W*H.pvp*(t.tarifaIVA||.19):H.pvp*(t.tarifaIVA||.19))},0),0)} ${a}</td></tr></table>`,q+="</body></html>",ze.document.write(q),ze.document.close(),setTimeout(()=>ze.print(),300)},pe={fontFamily:"'DM Mono',monospace",fontSize:11,textAlign:"right"};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:16},onClick:()=>w(!1),children:e.jsxs("div",{onClick:ze=>ze.stopPropagation(),style:{background:"#fff",borderRadius:10,width:"95%",maxWidth:1100,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.25)"},children:[e.jsxs("div",{style:{padding:"16px 22px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:17,fontWeight:700,margin:0},children:" APUs de Venta"}),e.jsxs("p",{style:{fontSize:10,color:"#888",margin:"3px 0 0"},children:[t.codigoOferta||"","  ",t.cliente||"","  ",se.length," partidas con precio"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsxs("select",{value:S,onChange:ze=>m(ze.target.value),style:{padding:"6px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:11,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"todos",children:"Todos los captulos"}),Z.map(ze=>e.jsx("option",{value:ze,children:le[ze].nombre},ze))]}),e.jsxs("button",{onClick:L,style:{padding:"6px 14px",background:"#fff",border:"1px solid #E0E0E0",borderRadius:4,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(wo,{size:12})," CSV"]}),e.jsxs("button",{onClick:ae,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:4,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(At,{size:12})," PDF / Imprimir"]}),e.jsx("button",{onClick:()=>w(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888",padding:4},children:e.jsx($t,{size:18})})]})]}),e.jsxs("div",{style:{padding:"8px 22px",background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",display:"flex",gap:20,flexShrink:0,fontSize:10,color:"#555"},children:[e.jsxs("span",{children:["Margen: ",e.jsxs("strong",{children:[(t.margen*100).toFixed(1),"%"]})]}),e.jsxs("span",{children:["GC: ",e.jsxs("strong",{children:[((o.g||0)*100).toFixed(2),"%"]})]}),e.jsxs("span",{children:["GF: ",e.jsxs("strong",{children:[((o.f||0)*100).toFixed(2),"%"]})]}),e.jsxs("span",{children:["IVA: ",e.jsxs("strong",{children:[((t.tarifaIVA||.19)*100).toFixed(0),"%"]}),R?" (sobre U)":""]}),e.jsxs("span",{children:["Coef. mult: ",e.jsxs("strong",{children:[" ",se.length>0?(he=Ht(1,1,t).coefMult)==null?void 0:he.toFixed(4):""]})]}),e.jsxs("span",{style:{marginLeft:"auto",fontWeight:700,color:"#111111"},children:["Total coste: ",r(G,0),"  Total venta: ",r(N,0)," ",a]})]}),e.jsxs("div",{style:{overflowY:"auto",flex:1,padding:"0 22px 22px"},children:[se.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 0",color:"#888"},children:[e.jsx("p",{style:{fontSize:14},children:"No hay partidas con precio para mostrar APUs de venta."}),e.jsx("p",{style:{fontSize:11,marginTop:6},children:"Aade partidas con costo directo en el borrador."})]}):ue.map(ze=>{const q=le[ze],I=q.items.reduce((H,U)=>H+U.v.pvp,0),$=q.items.reduce((H,U)=>H+U.ivaL,0);return e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:12,fontWeight:700,margin:"18px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:q.nombre}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:[r(I+$,0)," ",a]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Descripcin","Und","Cant","PU Coste","CD Total","GC","GF","Margen","PVP s/IVA","PU Venta","IVA","PVP c/IVA"].map(H=>e.jsx("th",{style:{padding:"5px 6px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,textAlign:H==="Descripcin"||H==="Und"?"left":"right",borderBottom:"1px solid #E0E0E0"},children:H},H))})}),e.jsxs("tbody",{children:[q.items.map(H=>{const U=H.v.pvp+H.ivaL;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},onMouseEnter:_=>_.currentTarget.style.background="#FFFFFF",onMouseLeave:_=>_.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"6px",fontSize:11,maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:H.descripcion||""}),e.jsx("td",{style:{padding:"6px",fontSize:10,color:"#888"},children:H.und||""}),e.jsx("td",{style:{...pe,padding:"6px"},children:H.cantidad||1}),e.jsx("td",{style:{...pe,padding:"6px",color:"#888"},children:r(H.v.puCoste,0)}),e.jsx("td",{style:{...pe,padding:"6px"},children:r(H.v.cd,0)}),e.jsx("td",{style:{...pe,padding:"6px",color:"#888"},children:r(H.v.gc,0)}),e.jsx("td",{style:{...pe,padding:"6px",color:"#888"},children:r(H.v.gf,0)}),e.jsx("td",{style:{...pe,padding:"6px",color:"#D4A017"},children:r(H.v.margenCOP,0)}),e.jsx("td",{style:{...pe,padding:"6px",fontWeight:700,color:"#3B3B3B"},children:r(H.v.pvp,0)}),e.jsx("td",{style:{...pe,padding:"6px"},children:r(H.v.puVenta,0)}),e.jsx("td",{style:{...pe,padding:"6px",color:"#888"},children:r(H.ivaL,0)}),e.jsx("td",{style:{...pe,padding:"6px",fontWeight:700,color:"#111111"},children:r(U,0)})]},H.id)}),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsxs("td",{colSpan:8,style:{padding:"8px 6px",fontWeight:700,fontSize:11},children:["Subtotal ",q.nombre]}),e.jsx("td",{style:{...pe,padding:"8px 6px",fontWeight:700,color:"#3B3B3B"},children:r(I,0)}),e.jsx("td",{style:{...pe,padding:"8px 6px"},children:""}),e.jsx("td",{style:{...pe,padding:"8px 6px",color:"#888"},children:r($,0)}),e.jsx("td",{style:{...pe,padding:"8px 6px",fontWeight:700,color:"#111111"},children:r(I+$,0)})]})]})]})]},ze)}),se.length>0&&e.jsxs("div",{style:{marginTop:20,padding:"14px 0",borderTop:"3px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:16,fontWeight:700},children:"TOTAL VENTA"}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:18,fontWeight:700,color:"#111111"},children:[r(N+se.reduce((ze,q)=>{const I=Ht(q.precioCD||0,q.cantidad||1,t);return ze+(R?W*I.pvp*(t.tarifaIVA||.19):I.pvp*(t.tarifaIVA||.19))},0),0)," ",a]}),e.jsxs("div",{style:{fontSize:10,color:"#888",marginTop:2},children:["sin IVA: ",r(N,0)," + IVA: ",r(se.reduce((ze,q)=>{const I=Ht(q.precioCD||0,q.cantidad||1,t);return ze+(R?W*I.pvp*(t.tarifaIVA||.19):I.pvp*(t.tarifaIVA||.19))},0),0)]})]})]})]})]})})})(),u&&(()=>{var N,G;const R=y.find(L=>L.id===u);if(!R||Number(R.precioCD)<=0)return null;const W=Ht(Number(R.precioCD),R.cantidad||1,t),se=t.tipoProyecto==="OBRA",le=o.U||t.margen,de=se?le*W.pvp*(t.tarifaIVA||.19):W.pvp*(t.tarifaIVA||.19),Z={display:"flex",justifyContent:"space-between",padding:"7px 0",borderBottom:`1px solid ${E.border}`,fontSize:13},ue={fontFamily:"'DM Mono',monospace",fontWeight:600};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(null),children:e.jsxs("div",{onClick:L=>L.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,maxWidth:520,width:"90%",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"APU de Venta"}),e.jsxs("p",{style:{margin:"4px 0 0",fontSize:11,color:E.inkLight},children:[R.descripcion||"Partida","  Cant: ",R.cantidad||1," ",R.und||"und"]})]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:E.inkLight},children:e.jsx($t,{size:18})})]}),e.jsxs("div",{style:Z,children:[e.jsx("span",{children:"Costo directo (CD)"}),e.jsx("span",{style:ue,children:Je(W.cd)})]}),e.jsxs("div",{style:Z,children:[e.jsx("span",{style:{color:E.inkMid,paddingLeft:12},children:" PU coste"}),e.jsx("span",{style:{...ue,color:E.inkMid},children:Je(W.puCoste)})]}),e.jsxs("div",{style:Z,children:[e.jsxs("span",{children:["Gastos contratacin (GC) ",et(o.g||0)]}),e.jsx("span",{style:ue,children:Je(W.gc)})]}),e.jsxs("div",{style:Z,children:[e.jsxs("span",{children:["Gastos financieros (GF) ",et(o.f||0)]}),e.jsx("span",{style:ue,children:Je(W.gf)})]}),e.jsxs("div",{style:Z,children:[e.jsxs("span",{children:["Margen ",et(t.margen)]}),e.jsx("span",{style:ue,children:Je(W.margenCOP)})]}),e.jsxs("div",{style:{...Z,fontWeight:700,fontSize:15,borderBottom:"2px solid #111"},children:[e.jsx("span",{children:"PVP sin IVA"}),e.jsx("span",{style:ue,children:Je(W.pvp)})]}),e.jsxs("div",{style:Z,children:[e.jsx("span",{style:{color:E.inkMid,paddingLeft:12},children:" PU venta"}),e.jsx("span",{style:{...ue,color:E.inkMid},children:Je(W.puVenta)})]}),e.jsxs("div",{style:Z,children:[e.jsxs("span",{children:["IVA ",se?`(U ${et(le)}  ${et(t.tarifaIVA)})`:et(t.tarifaIVA)]}),e.jsx("span",{style:ue,children:Je(de)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px 0",fontSize:16,fontWeight:700},children:[e.jsx("span",{children:"PVP con IVA"}),e.jsx("span",{style:{...ue,color:E.success},children:Je(W.pvp+de)})]}),e.jsxs("div",{style:{background:E.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:E.inkMid,marginTop:8},children:["Coef. multiplicador: ",e.jsxs("strong",{children:[" ",(N=W.coefMult)==null?void 0:N.toFixed(4)]}),"  Denominador: ",e.jsx("strong",{children:(G=W.den)==null?void 0:G.toFixed(4)})]})]})})})()]})}const _h=[{id:"general",lbl:"General",en:"General"},{id:"params",lbl:"Parmetros",en:"Parameters"},{id:"borrador",lbl:"Borrador + APU",en:"Draft + APU"},{id:"cronograma",lbl:"Cronograma",en:"Schedule"},{id:"flujo",lbl:"Flujo de caja",en:"Cash Flow"},{id:"organigrama",lbl:"Organigrama",en:"Org Chart"},{id:"gg",lbl:"Gastos generales",en:"Overhead"},{id:"insumos",lbl:"Insumos",en:"Supplies"},{id:"equipos",lbl:"Equipos trabajo",en:"Work Teams"},{id:"resumen",lbl:"Resumen",en:"Summary"},{id:"entrega",lbl:"Entrega cliente",en:"Client Delivery"}];function Dh({offers:t,editId:i,prefillData:o,onSave:n,onBack:a,lang:r}){const s=i?t.find(g=>g.id===i):null,[d,u]=F.useState(()=>({...ch,...s||{},...!i&&o?o:{},id:(s==null?void 0:s.id)||Ct(),createdAt:(s==null?void 0:s.createdAt)||Dt(),updatedAt:Dt(),planos:(s==null?void 0:s.planos)||nc()})),[b,j]=F.useState("general"),[w,S]=F.useState(!1),m=(g,l)=>u(f=>({...f,[g]:l,updatedAt:Dt()})),x=F.useMemo(()=>Qn(d),[d]),p=()=>{n(d),S(!0),setTimeout(()=>S(!1),2200)},c=()=>{const g=[["Campo","Valor"],["Cliente",d.cliente],["Proyecto",d.proyecto],["Estado",d.estado],["Tipo",d.tipoProyecto],...d.tipoProyecto==="DISEO"?[["Modalidad",d.subtipoDiseno]]:[],["Costo (COP)",x.COSTO],["PVP sin IVA",x.PVP],["IVA",x.IVA],["PVP c/IVA",x.PVP_IVA],["Margen $",x.margenCOP],["Financieros",x.fin],["Retenciones",x.ret],["Neto",x.neto]],l=new Blob(["\uFEFF"+g.map(h=>h.map(v=>`"${v}"`).join(",")).join(`
`)],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(l),y=document.createElement("a");y.href=f,y.download=`Oferta_${d.cliente||"Habitaris"}_${d.proyecto||"SN"}.csv`,y.click(),URL.revokeObjectURL(f)};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:22,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",color:E.inkMid,padding:4},children:e.jsx(kd,{size:18})}),e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",color:E.inkLight,margin:"0 0 3px"},children:[i?r==="en"?"Edit offer":"Editar oferta":r==="en"?"New offer":"Nueva oferta",!i&&(o==null?void 0:o.briefingId)&&e.jsxs("span",{style:{marginLeft:8,background:"#E6F4EC",color:"#2B7A52",border:"1px solid #2B7A5233",borderRadius:2,padding:"1px 7px",fontSize:8,fontWeight:700,letterSpacing:.5},children:[" ",r==="en"?"FROM BRIEFING":"DESDE BRIEFING"]})]}),e.jsxs("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:22,fontWeight:700,color:E.ink,margin:0},children:[d.cliente||(r==="en"?"No client":"Sin cliente"),d.proyecto?`  ${d.proyecto}`:""]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ht,{v:"out",icon:wo,sm:!0,on:c,children:r==="en"?"Export CSV":"Exportar CSV"}),e.jsxs(ht,{v:"out",icon:At,sm:!0,on:()=>window.print(),children:["PDF / ",r==="en"?"Print":"Imprimir"]}),e.jsx(ht,{icon:Co,on:p,style:w?{background:E.success}:{},children:w?r==="en"?"Saved!":"Guardado!":r==="en"?"Save offer":"Guardar oferta"})]})]}),e.jsx("div",{className:"no-print",style:{display:"flex",borderBottom:`1px solid ${E.border}`,marginBottom:22,overflowX:"auto",whiteSpace:"nowrap"},children:_h.map(g=>e.jsx("button",{onClick:()=>j(g.id),style:{padding:"10px 16px",border:"none",cursor:"pointer",fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:600,letterSpacing:1,textTransform:"uppercase",background:"transparent",color:b===g.id?E.ink:E.inkLight,borderBottom:b===g.id?`2px solid ${E.ink}`:"2px solid transparent",transition:"all .15s",marginBottom:-1},children:r==="en"&&g.en?g.en:g.lbl},g.id))}),b==="general"&&e.jsx($h,{d,set:m,offers:t}),b==="params"&&e.jsx(Ph,{d,set:m,r:x}),b==="borrador"&&e.jsx(Mh,{d,set:m,r:x}),b==="cronograma"&&e.jsx(Oh,{d,set:m,r:x}),b==="flujo"&&e.jsx(Wh,{d,set:m,r:x}),b==="organigrama"&&e.jsx(Vh,{d,set:m}),b==="gg"&&e.jsx(Lh,{d,set:m,r:x}),b==="insumos"&&e.jsx(Uh,{d,set:m,r:x}),b==="equipos"&&e.jsx(Nh,{d,set:m}),b==="resumen"&&e.jsx(qh,{d,r:x}),b==="entrega"&&e.jsx(Hh,{d,set:m,r:x})]})}function $h({d:t,set:i,offers:o}){const n=qa.find(f=>f.val===t.tipoInmueble)||qa[0];Mr.find(f=>f.cod===t.actividadCod)||Mr[0];const a=[...new Set(Mr.map(f=>f.grupo))],[r,s]=F.useState([]),[d,u]=F.useState(!1),[b,j]=F.useState(!1);F.useEffect(()=>{ma().then(f=>s(f))},[]);const w=(f,y,h)=>{const v=ql(f,y,h);i("codigoOferta",v)},S=(f,y)=>{i("proyecto",dh(t.tipoInmueble,f,y))},m=f=>{i("actividadCod",f),w(f,t.digitoControl,t.revision)},x=f=>{i("digitoControl",f),w(t.actividadCod,f,t.revision)},p=f=>{i("revision",f),w(t.actividadCod,t.digitoControl,f)},c=f=>{i("lugarNombre",f),S(f,t.lugarReferencia)},g=f=>{i("lugarReferencia",f),S(t.lugarNombre,f)},l=t.codigoOferta||ql(t.actividadCod,t.digitoControl,t.revision);return e.jsxs("div",{className:"fade",children:[t.briefingId?e.jsxs("div",{style:{background:"#E8F4EE",border:"1px solid #B8DEC9",borderRadius:8,padding:"10px 16px",marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(Cd,{size:14,style:{color:"#111111"}}),e.jsx("span",{style:{fontSize:12,color:"#111111",fontWeight:600},children:"Oferta creada desde briefing"})]}):e.jsxs("div",{style:{background:"#F0F0F0",border:"1px solid #B8D4F0",borderRadius:8,padding:"12px 16px",marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(Uo,{size:16,style:{color:"#3B3B3B"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#3B3B3B"},children:r.length>0?`${r.length} briefing${r.length>1?"s":""} disponible${r.length>1?"s":""}`:"Tienes datos de un briefing?"}),e.jsx("div",{style:{fontSize:10,color:"#3B3B3B99"},children:r.length>0?"Importa los datos del cliente para pre-llenar la oferta":"Ingresa un briefing en Formularios y luego imprtalo aqu"})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[r.length>0&&e.jsx("button",{onClick:()=>u(!0),style:{padding:"6px 14px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:11,fontWeight:700,display:"flex",alignItems:"center",gap:5,fontFamily:"'DM Sans',sans-serif"},children:" Importar briefing"}),e.jsx("button",{onClick:()=>j(!0),style:{padding:"6px 14px",background:r.length>0?"#fff":"#3B3B3B",color:r.length>0?"#3B3B3B":"#fff",border:r.length>0?"1px solid #3B3B3B33":"none",borderRadius:6,cursor:"pointer",fontSize:11,fontWeight:600,display:"flex",alignItems:"center",gap:5,fontFamily:"'DM Sans',sans-serif"},children:" Ingresar rpido"})]})]}),d&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:f=>f.target===f.currentTarget&&u(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",maxHeight:"65vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:"Seleccionar briefing"}),e.jsx("button",{onClick:()=>u(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:18})})]}),e.jsx("div",{style:{overflowY:"auto",padding:14},children:r.map(f=>e.jsxs("div",{onClick:()=>{const y=Ns(f);Object.entries(y).forEach(([h,v])=>i(h,v)),i("briefingId",f.id),u(!1)},style:{padding:"12px 14px",border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,cursor:"pointer"},onMouseEnter:y=>y.currentTarget.style.background="#F5F4F1",onMouseLeave:y=>y.currentTarget.style.background="#fff",children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:f.nombre||"Sin nombre"}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2},children:[f.email||"","  ",new Date(f.creadoEn||Date.now()).toLocaleDateString("es-CO")]})]},f.id))})]})}),b&&(()=>{const f=[{k:"nombre",l:"Nombre completo *",ph:"Juan Prez",required:!0},{k:"email",l:"Email",ph:"juan@mail.com",type:"email"},{k:"telefono",l:"WhatsApp",ph:"300 123 4567",type:"tel"},{k:"ciudad",l:"Ciudad",ph:"Bogot"},{k:"edificio",l:"Edificio / Conjunto",ph:"Torres del Parque"},{k:"tipo_proyecto",l:"Tipo de proyecto",ph:"",sel:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"]},{k:"area_m2",l:"rea (m)",ph:"80",type:"number"},{k:"presupuesto",l:"Presupuesto (COP)",ph:"50000000",type:"number"},{k:"lo_mas_importante",l:"Qu necesita el cliente?",ph:"Descripcin breve del proyecto...",ta:!0},{k:"razon_social",l:"Razn social",ph:"Empresa S.A.S"},{k:"documento",l:"NIT / Cdula",ph:"901.000.000-0"}];return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:y=>y.target===y.currentTarget&&j(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:600,width:"100%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:" Ingreso rpido de briefing"}),e.jsx("div",{style:{fontSize:10,color:"#888",marginTop:2},children:"Los datos se importarn directamente a esta oferta"})]}),e.jsx("button",{onClick:()=>j(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:18})})]}),e.jsx("div",{style:{overflowY:"auto",padding:"16px 20px"},id:"qb-form",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:f.map(y=>e.jsxs("div",{style:y.ta?{gridColumn:"1/-1"}:{},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#888",marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:y.l}),y.sel?e.jsxs("select",{"data-qb":y.k,defaultValue:"",style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),y.sel.map(h=>e.jsx("option",{value:h,children:h},h))]}):y.ta?e.jsx("textarea",{"data-qb":y.k,rows:2,placeholder:y.ph,style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical",boxSizing:"border-box"}}):e.jsx("input",{"data-qb":y.k,type:y.type||"text",placeholder:y.ph,style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",boxSizing:"border-box"}})]},y.k))})}),e.jsxs("div",{style:{padding:"12px 20px",borderTop:"1px solid #E0E0E0",display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:async()=>{const y={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0]};if(document.querySelectorAll("[data-qb]").forEach(v=>{const A=v.getAttribute("data-qb");v.value&&(y[A]=v.value)}),!y.nombre){alert("El nombre es obligatorio");return}await Ws(y),s(v=>[y,...v]);const h=Ns(y);Object.entries(h).forEach(([v,A])=>i(v,A)),i("briefingId",y.id),j(!1)},style:{padding:"8px 20px",background:"#111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:700,fontFamily:"'DM Sans',sans-serif"},children:"Importar a esta oferta"}),e.jsx("button",{onClick:async()=>{const y={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0]};if(document.querySelectorAll("[data-qb]").forEach(h=>{const v=h.getAttribute("data-qb");h.value&&(y[v]=h.value)}),!y.nombre){alert("El nombre es obligatorio");return}await Ws(y),s(h=>[y,...h]),j(!1),alert(" Briefing guardado. Puedes importarlo cuando quieras.")},style:{padding:"8px 20px",background:"transparent",color:"#555",border:"1px solid #E0E0E0",borderRadius:6,cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:"Solo guardar briefing"})]})]})})})(),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Codificacin del proyecto",s:"Cdigo automtico segn formato Habitaris"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Tipo de actividad"}),e.jsx("select",{value:t.actividadCod,onChange:f=>m(f.target.value),style:{width:"100%",padding:"9px 12px",border:`1px solid ${E.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:E.ink,background:E.bg},onFocus:f=>f.target.style.borderColor=E.ink,onBlur:f=>f.target.style.borderColor=E.border,children:a.map(f=>e.jsx("optgroup",{label:f,children:Mr.filter(y=>y.grupo===f).map(y=>e.jsxs("option",{value:y.cod,children:[y.cod,"  ",y.label]},y.cod))},f))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(st,{lbl:"Dgito de control",val:t.digitoControl,on:f=>x(f.target.value),ph:"01",note:"2 dgitos  orden del da"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Revisin"}),e.jsx("select",{value:t.revision,onChange:f=>p(+f.target.value),style:{width:"100%",padding:"9px 12px",border:`1px solid ${E.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:E.ink,background:E.bg},onFocus:f=>f.target.style.borderColor=E.ink,onBlur:f=>f.target.style.borderColor=E.border,children:[0,1,2,3,4,5,6,7,8,9].map(f=>e.jsxs("option",{value:f,children:["R",String(f).padStart(2,"0")]},f))})]})]}),e.jsxs("div",{style:{background:E.ink,borderRadius:2,padding:"14px 16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 3px",fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:1.5},children:"Cdigo de oferta"}),e.jsx("p",{style:{margin:0,fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:"#fff",letterSpacing:1.5},children:l})]}),e.jsx("button",{onClick:()=>{var f;return(f=navigator.clipboard)==null?void 0:f.writeText(l)},style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:2,padding:"6px 12px",color:"#fff",fontFamily:"'DM Sans', sans-serif",fontSize:10,cursor:"pointer",letterSpacing:.8},children:"COPIAR"})]})]}),e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Identificacin del proyecto",s:"Nombre automtico segn tipo de inmueble"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:8,textTransform:"uppercase",letterSpacing:1},children:"Tipo de inmueble"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:qa.map(f=>e.jsx("button",{onClick:()=>i("tipoInmueble",f.val),style:{padding:"5px 12px",borderRadius:2,border:`1px solid ${t.tipoInmueble===f.val?E.ink:E.border}`,fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:t.tipoInmueble===f.val?700:400,background:t.tipoInmueble===f.val?E.ink:"transparent",color:t.tipoInmueble===f.val?"#fff":E.inkMid,cursor:"pointer",transition:"all .15s"},children:f.label},f.val))})]}),e.jsx(st,{lbl:n.ph1,val:t.lugarNombre,on:f=>c(f.target.value),ph:`Ej: ${n.ph1}`}),e.jsx(st,{lbl:n.ph2,val:t.lugarReferencia,on:f=>g(f.target.value),ph:n.ph2}),e.jsxs("div",{style:{background:E.accentBg,borderRadius:2,padding:"12px 16px",border:`1px solid ${E.borderMid}`,marginBottom:14},children:[e.jsx("p",{style:{margin:"0 0 3px",fontSize:9,color:E.inkLight,textTransform:"uppercase",letterSpacing:1.5},children:"Nombre del proyecto"}),e.jsx("p",{style:{margin:0,fontSize:15,fontWeight:700,color:E.ink},children:t.proyecto||e.jsx("span",{style:{color:E.inkLight,fontWeight:400},children:"Se completar automticamente"})})]}),e.jsx(st,{lbl:"Cliente / Empresa",val:t.cliente,on:f=>i("cliente",f.target.value),ph:"Nombre del cliente"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(st,{lbl:"Email cliente",val:t.emailCliente||"",on:f=>i("emailCliente",f.target.value),ph:"cliente@email.com"}),e.jsx(st,{lbl:"Telfono cliente",val:t.telCliente||"",on:f=>i("telCliente",f.target.value),ph:"+57 300 000 0000"})]}),e.jsx(st,{lbl:"Ciudad / Barrio",val:t.ubicacion,on:f=>i("ubicacion",f.target.value),ph:"Ej: Bogot, Chapinero"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(st,{lbl:"Fecha inicio estimada",type:"date",val:t.fechaInicio||"",on:f=>i("fechaInicio",f.target.value)}),e.jsx(st,{lbl:"Fecha entrega estimada",type:"date",val:t.fechaEntrega||"",on:f=>i("fechaEntrega",f.target.value)})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(jn,{lbl:"Firma / Representante",val:t.firmaRepresentante||"David Parra Galera",on:f=>i("firmaRepresentante",f.target.value),opts:["David Parra Galera","Ana Mara Daz Buitrago"]}),e.jsx(st,{lbl:"Elaborado por",val:t.elaboradoPor||"",on:f=>i("elaboradoPor",f.target.value),ph:"Nombre de quien elabora"})]}),e.jsx(jn,{lbl:"Estado",val:t.estado,on:f=>i("estado",f.target.value),opts:rl})]}),e.jsx(Ke,{style:{padding:22,gridColumn:"1 / -1"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:E.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas internas"}),e.jsx("textarea",{value:t.notas,onChange:f=>i("notas",f.target.value),rows:3,placeholder:"Observaciones, acuerdos, follow-ups...",style:{width:"100%",padding:"9px 12px",border:`1px solid ${E.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:E.bg,resize:"vertical",color:E.ink}})]}),e.jsxs("div",{children:[e.jsx(jn,{lbl:"Relacionada con oferta",val:t.relacionadaCon||"",on:f=>i("relacionadaCon",f.target.value||null),note:"Vincula a una revisin o variante anterior",opts:[{v:"",l:" Ninguna "},...o.filter(f=>f.id!==t.id).map(f=>({v:f.id,l:`${f.codigoOferta||f.cliente}  ${f.proyecto||"sin nombre"}`}))]}),e.jsxs("div",{style:{background:E.accentBg,borderRadius:2,padding:"10px 14px",fontSize:11,color:E.inkMid},children:["Creada: ",e.jsx("strong",{children:t.createdAt}),"  Actualizada: ",e.jsx("strong",{children:t.updatedAt})]})]})]})}),e.jsxs(Ke,{style:{padding:22,marginTop:16},children:[e.jsx(vt,{t:"Alcance del proyecto",s:"Descripcin del servicio para la propuesta"}),e.jsx("div",{style:{display:"flex",gap:6,marginBottom:10},children:(t.tipoProyecto==="OBRA"?[["obra_integral","Obra integral"],["obra_parcial","Obra parcial"],["remodelacion","Remodelacin"],["custom","Personalizado"]]:[["diseno_integral","Diseo integral"],["diseno_espacios","Diseo de espacios"],["consultoria","Consultora"],["custom","Personalizado"]]).map(([f,y])=>e.jsx("button",{onClick:()=>{i("alcanceTipo",f),f!=="custom"&&i("alcanceTexto",{obra_integral:`El presente presupuesto comprende la ejecucin integral de obra civil, acabados e instalaciones del proyecto, incluyendo:

 Obra civil: cimentacin, estructura, mampostera, cubierta
 Instalaciones: hidrosanitarias, elctricas, gas, red de datos
 Acabados: pisos, enchapes, pintura, carpintera metlica y en madera
 Equipamiento fijo: cocina, baos, closets

No incluye: mobiliario suelto, electrodomsticos, decoracin ni paisajismo exterior salvo que se indique expresamente.`,obra_parcial:`El presente presupuesto comprende la ejecucin parcial de las actividades indicadas en el borrador de costes, segn las especificaciones tcnicas acordadas.

El alcance se limita estrictamente a las partidas incluidas en el presupuesto detallado. Cualquier trabajo adicional ser objeto de una adenda o presupuesto complementario.`,remodelacion:`El presente presupuesto comprende los trabajos de remodelacin del espacio indicado, incluyendo:

 Demoliciones y retiro de escombros
 Modificaciones en instalaciones existentes
 Nuevos acabados segn diseo aprobado
 Carpintera y mobiliario fijo indicado

Se asume que la estructura existente se encuentra en buen estado. Cualquier refuerzo estructural requerido ser presupuestado aparte.`,diseno_integral:`El servicio de diseo integral comprende:

 Levantamiento y diagnstico del espacio existente
 Propuesta conceptual y desarrollo de concepto
 Diseo arquitectnico: plantas, cortes, fachadas
 Diseo interior: seleccin de materiales, mobiliario, iluminacin
 Planos tcnicos de detalle para ejecucin
 Especificaciones tcnicas y libro de acabados
 Acompaamiento en la seleccin de proveedores

Incluye hasta 2 rondas de ajustes por etapa de diseo.`,diseno_espacios:`El servicio de diseo de espacios comprende:

 Anlisis funcional del espacio
 Propuesta de distribucin y layout
 Seleccin de paleta de materiales y acabados
 Renders 3D fotorrealistas (3 vistas principales)
 Planos de mobiliario y especificaciones

No incluye planos tcnicos de instalaciones ni direccin de obra.`,consultoria:`El servicio de consultora incluye:

 Visita tcnica al sitio
 Informe de diagnstico y recomendaciones
 Estimacin presupuestaria de referencia
 Cronograma indicativo

No incluye desarrollo de diseo ni planos tcnicos.`}[f]||"")},style:{padding:"6px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${t.alcanceTipo===f?E.ink:E.border}`,borderRadius:4,background:t.alcanceTipo===f?E.ink:"#fff",color:t.alcanceTipo===f?"#fff":E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:y},f))}),e.jsx("textarea",{value:t.alcanceTexto||"",onChange:f=>i("alcanceTexto",f.target.value),rows:10,placeholder:"Describe el alcance del servicio...",style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:4,padding:"10px 12px",fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical",lineHeight:1.6,background:E.bg,color:E.ink}}),e.jsx("p",{style:{fontSize:10,color:E.inkLight,marginTop:6,margin:0},children:'Este texto aparecer en la seccin "Alcance" del documento de entrega al cliente.'})]})]})]})}function Ph({d:t,set:i,r:o}){const n=t.pais||"CO",a=(r,s)=>{s==="CO"?r==="PN"?(i("pctReteFuente",.02),i("pctReteICA",.009),i("pctReteIVA",.15)):(i("pctReteFuente",.035),i("pctReteICA",.009),i("pctReteIVA",.15)):(i("pctReteFuente",.15),i("pctReteICA",0),i("pctReteIVA",0))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fade",style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:20},children:[e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Pas y Tipo Fiscal",s:"Localizacin y mrgenes"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Pas / Mercado"}),e.jsx("div",{style:{display:"flex",gap:6},children:[{id:"CO",flag:"",label:"Colombia"},{id:"ES",flag:"",label:"Espaa"}].map(r=>e.jsxs("button",{onClick:()=>{i("pais",r.id),i("divisa",r.id==="CO"?"COP":"EUR"),i("tarifaIVA",r.id==="CO"?.19:.1)},style:{flex:1,padding:"7px 4px",border:`2px solid ${n===r.id?r.id==="CO"?"#111111":"#3B3B3B":"#E0E0E0"}`,borderRadius:6,background:n===r.id?r.id==="CO"?"#E8F4EE":"#F0F0F0":"transparent",cursor:"pointer",fontSize:12,fontWeight:n===r.id?700:400,color:n===r.id?r.id==="CO"?"#111111":"#3B3B3B":"#555",fontFamily:"'DM Sans',sans-serif"},children:[r.flag," ",r.label]},r.id))})]}),e.jsx(jn,{lbl:"Tipo fiscal",val:t.tipoProyecto,on:r=>i("tipoProyecto",r.target.value),opts:["OBRA","DISEO"],note:"OBRA  IVA sobre utilidad  DISEO  IVA pleno"}),e.jsx(st,{lbl:n==="CO"?"Tarifa IVA":"IVA (21%=general, 10%=obra, 4%=superred.)",type:"number",val:(t.tarifaIVA*100).toFixed(0),on:r=>i("tarifaIVA",+r.target.value/100),rt:"%",step:"1"}),t.pais==="CO"&&t.tipoProyecto==="OBRA"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:10,marginTop:6},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Modo de clculo (OBRA)"}),e.jsx("div",{style:{display:"flex",gap:0},children:[{id:"margen",lbl:"Margen"},{id:"aiu",lbl:"AIU"}].map(r=>e.jsx("button",{onClick:()=>i("modoCalcObra",r.id),style:{flex:1,padding:"8px 12px",fontSize:12,cursor:"pointer",fontWeight:600,border:"1px solid #111",fontFamily:"'DM Sans',sans-serif",borderRadius:r.id==="margen"?"6px 0 0 6px":"0 6px 6px 0",background:(t.modoCalcObra||"margen")===r.id?"#111":"#fff",color:(t.modoCalcObra||"margen")===r.id?"#fff":"#555"},children:r.lbl},r.id))})]}),(t.modoCalcObra||"margen")==="margen"?e.jsxs(e.Fragment,{children:[e.jsx(st,{lbl:"Margen (%)",type:"number",val:(t.margen*100).toFixed(1),on:r=>i("margen",+r.target.value/100),rt:"%",step:"0.1",note:`PVP = CD / ${(1-t.margen).toFixed(2)} (ej: 30%  /0.70, 20%  /0.80)`}),e.jsx(st,{lbl:"U declarada para IVA (%)",type:"number",val:((t.uDecl||.1)*100).toFixed(1),on:r=>i("uDecl",+r.target.value/100),rt:"%",step:"0.1",note:"Solo para calcular el IVA sobre utilidad. No afecta al PVP."}),e.jsxs("div",{style:{background:E.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:E.inkMid},children:["PVP = CD / ",e.jsx("strong",{children:(1-t.margen).toFixed(2)}),"  IVA = U ",e.jsxs("strong",{children:[((t.uDecl||.1)*100).toFixed(1),"%"]}),"  PVP  ",e.jsxs("strong",{children:[(t.tarifaIVA*100).toFixed(0),"%"]})," = ",Je(o.IVA)]})]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{lbl:"A  Administracin (%)",type:"number",val:((t.aiuA||.08)*100).toFixed(1),on:r=>i("aiuA",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(st,{lbl:"I  Imprevistos (%)",type:"number",val:((t.aiuI||.03)*100).toFixed(1),on:r=>i("aiuI",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(st,{lbl:"U  Utilidad (%)",type:"number",val:((t.aiuU||.07)*100).toFixed(1),on:r=>i("aiuU",+r.target.value/100),rt:"%",step:"0.1"}),e.jsxs("div",{style:{background:E.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:E.inkMid},children:["AIU = ",e.jsxs("strong",{children:[(((t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))*100).toFixed(1),"%"]})," sobre CD  IVA = U ",e.jsxs("strong",{children:[((t.aiuU||.07)*100).toFixed(1),"%"]}),"  PVP  ",e.jsxs("strong",{children:[(t.tarifaIVA*100).toFixed(0),"%"]})," = ",Je(o.IVA)]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{lbl:"Margen objetivo",type:"number",val:(t.margen*100).toFixed(1),on:r=>i("margen",+r.target.value/100),rt:"%",step:"0.1",note:"Para clculo del PVP"}),e.jsxs("div",{style:{background:E.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:E.inkMid},children:["IVA ",t.pais==="ES"?"ES":"DISEO"," = IVA pleno sobre ",e.jsx("strong",{children:"PVP completo"})," = ",Je(o.IVA)]})]}),n==="ES"&&e.jsxs(e.Fragment,{children:[e.jsx(st,{lbl:"% Gastos Generales (GG)",type:"number",val:((t.gg||.13)*100).toFixed(1),on:r=>i("gg",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(st,{lbl:"% Beneficio Industrial (BI)",type:"number",val:((t.bi||.06)*100).toFixed(1),on:r=>i("bi",+r.target.value/100),rt:"%",step:"0.1"})]})]}),e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Gastos de Contratacin (GC)",s:"Coste directo  llevan margen"}),e.jsx(st,{lbl:"% RCE",type:"number",val:(t.pctRCE*100).toFixed(2),on:r=>i("pctRCE",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(st,{lbl:"% TRC",type:"number",val:(t.pctTRC*100).toFixed(2),on:r=>i("pctTRC",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(st,{lbl:"% Adm. contratacin PH",type:"number",val:(t.pctAdm*100).toFixed(2),on:r=>i("pctAdm",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(st,{lbl:"% ICA (Bogot)",type:"number",val:(t.pctICA*100).toFixed(2),on:r=>i("pctICA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsxs("div",{style:{background:E.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:E.inkMid,marginTop:6},children:["Total GC: ",e.jsx("strong",{children:et((t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0)+(t.pctICA||0))}),"  sobre PVP, llevan margen"]})]}),e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Retenciones",s:"Solo impactan flujo de caja"}),e.jsx(jn,{lbl:"Tipo de cliente",val:t.tipoCliente,on:r=>{i("tipoCliente",r.target.value),a(r.target.value,n)},opts:["PN","EMPRESA"],note:n==="CO"?t.tipoCliente==="PN"?"PN  ReteFuente 2%  ReteICA 0.9%  ReteIVA 15%":"Empresa  ReteFuente 3.5%  ReteICA 0.9%  ReteIVA 15%":"ES  IRPF 15%"}),e.jsx(st,{lbl:"% ReteFuente",type:"number",val:(t.pctReteFuente*100).toFixed(2),on:r=>i("pctReteFuente",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(st,{lbl:"% ReteICA",type:"number",val:(t.pctReteICA*100).toFixed(2),on:r=>i("pctReteICA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(st,{lbl:"% ReteIVA",type:"number",val:(t.pctReteIVA*100).toFixed(2),on:r=>i("pctReteIVA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsxs("div",{style:{background:E.accentBg,borderRadius:2,padding:"10px 14px",fontSize:11,color:E.inkMid,marginTop:8},children:["Total retenciones: ",e.jsx("strong",{children:et(t.pctReteFuente+t.pctReteICA+t.pctReteIVA)})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginTop:20},children:[e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Condiciones de pago",s:"Para el documento de entrega al cliente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:10},children:[["Anticipo / firma","condPct1",.3],["Avance 50%","condPct2",.3],["Entrega final","condPct3",.3],["Retencin (30 das)","condPct4",.1]].map(([r,s,d])=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:r}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"number",value:((t[s]??d)*100).toFixed(0),min:0,max:100,onChange:u=>i(s,+u.target.value/100),style:{width:60,border:`1px solid ${E.border}`,borderRadius:4,padding:"6px 8px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:E.bg,textAlign:"right"}}),e.jsx("span",{style:{fontSize:11,color:E.inkLight},children:"%"}),e.jsxs("span",{style:{fontSize:11,color:E.inkLight},children:["= ",Je((t[s]??d)*(o.PVP||0))]})]})]},s))}),e.jsxs("div",{style:{fontSize:11,color:Math.abs((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1)-1)<.001?E.success:E.warning},children:["Total: ",(((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1))*100).toFixed(0),"%",Math.abs((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1)-1)>=.001?"  debe sumar 100%":" "]})]}),e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Gastos Financieros (GF)",s:"NO llevan margen  Editables"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6,marginBottom:10},children:[["PSE","PSE"],["Tarjeta","Tarjeta"],["Transferencia","Transf."],["Manual","Manual"]].map(([r,s])=>e.jsx("button",{onClick:()=>i("medioPago",r),style:{padding:"5px 6px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${t.medioPago===r?E.ink:E.border}`,borderRadius:4,background:t.medioPago===r?E.ink:"#fff",color:t.medioPago===r?"#fff":E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:s},r))}),t.medioPago==="PSE"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#999",marginBottom:3,textTransform:"uppercase",letterSpacing:.8},children:"Banco PSE"}),e.jsx("select",{value:t.bancoPSE||"custom",onChange:r=>{const s=r.target.value;i("bancoPSE",s);const d={bancolombia:.01,davivienda:.009,nequi:.012,bbva:.01};d[s]!==void 0&&i("pctComPSE",d[s])},style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:E.bg},children:[["bancolombia","Bancolombia (1.0%)"],["davivienda","Davivienda (0.9%)"],["nequi","Nequi (1.2%)"],["bbva","BBVA (1.0%)"],["custom","Otro"]].map(([r,s])=>e.jsx("option",{value:r,children:s},r))})]}),t.medioPago==="Tarjeta"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#999",marginBottom:3,textTransform:"uppercase",letterSpacing:.8},children:"Pasarela"}),e.jsx("select",{value:t.pasarelaTarjeta||"custom",onChange:r=>{const s=r.target.value;i("pasarelaTarjeta",s);const d={wompi:.029,getnet:.025,epayco:.032,mercadopago:.0349,redsys:.005};d[s]!==void 0&&i("pctComTarjeta",d[s])},style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:E.bg},children:(n==="CO"?[["wompi","Wompi (2.9%)"],["getnet","Getnet (2.5%)"],["epayco","ePayco (3.2%)"],["mercadopago","M.Pago (3.49%)"],["custom","Otra"]]:[["redsys","Redsys (0.5%)"],["custom","Otra"]]).map(([r,s])=>e.jsx("option",{value:r,children:s},r))})]}),e.jsx(st,{lbl:t.medioPago==="PSE"?"Tasa PSE (% sin IVA)":t.medioPago==="Tarjeta"?"Tasa tarjeta (% sin IVA)":t.medioPago==="Manual"?"Comisin manual (%)":"Tasa transferencia (%)",type:"number",val:((t.medioPago==="PSE"?t.pctComPSE??.012:t.medioPago==="Tarjeta"?t.pctComTarjeta??.036:t.medioPago==="Manual"?t.pctComManual??0:t.pctComTransf??0)*100).toFixed(2),on:r=>{const s=+r.target.value/100;t.medioPago==="PSE"?i("pctComPSE",s):t.medioPago==="Tarjeta"?i("pctComTarjeta",s):t.medioPago==="Manual"?i("pctComManual",s):i("pctComTransf",s)},rt:"%",step:"0.01"}),t.medioPago!=="Manual"&&e.jsx(st,{lbl:"IVA sobre comisin",type:"number",val:((t.ivaComision??.19)*100).toFixed(0),on:r=>i("ivaComision",+r.target.value/100),rt:"%",step:"1"}),e.jsx(jn,{lbl:"Aplicar 41000",val:t.aplicar4x1000,on:r=>i("aplicar4x1000",r.target.value),opts:["SI","NO"]}),e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"8px 12px",fontSize:11,color:"#8C6A00",marginTop:6,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:["Total GF: ",e.jsx("strong",{children:et(o.f||0)})," = ",Je(o.fin||0)]}),e.jsx("button",{onClick:()=>{i("pctComPSE",.012),i("pctComTarjeta",.036),i("pctComTransf",0),i("pctComManual",0),i("ivaComision",n==="CO"?.19:.21),i("aplicar4x1000","SI")},style:{background:"none",border:"1px solid #C9A254",borderRadius:3,padding:"2px 8px",fontSize:9,fontWeight:600,color:"#8C6A00",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Restablecer"})]})]})]}),e.jsxs(Ke,{style:{padding:22,marginTop:20},children:[e.jsx(vt,{t:"Representantes Habitaris",s:"Para documentos de entrega y firma"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Firma del documento"}),e.jsxs("select",{value:t.firmaRepresentante||"David Parra Galera",onChange:r=>i("firmaRepresentante",r.target.value),style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:E.bg},children:[e.jsx("option",{value:"David Parra Galera",children:"David Parra Galera  Dir. Ejecutivo y Produccin"}),e.jsx("option",{value:"Ana Mara Daz Buitrago",children:"Ana Mara Daz Buitrago  Dir. Creativa y Diseo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Elaborado por"}),e.jsx("input",{value:t.elaboradoPor||"",onChange:r=>i("elaboradoPor",r.target.value),placeholder:"Nombre de quien elabor la oferta",style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:E.bg,marginBottom:6}}),e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Cargo elaborador"}),e.jsx("input",{value:t.cargoElaborador||"",onChange:r=>i("cargoElaborador",r.target.value),placeholder:"Cargo",style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:E.bg}})]})]})]}),(()=>{const r=t.pais||"CO";let s=0,d="Sin comisin";const u=t.ivaComision??.19;t.medioPago==="PSE"&&(s=(t.pctComPSE??.012)*(1+u),d=`PSE ${((t.pctComPSE??.012)*100).toFixed(2)}% + IVA ${(u*100).toFixed(0)}%`),t.medioPago==="Tarjeta"&&(s=(t.pctComTarjeta??.036)*(1+u),d=`Tarjeta ${((t.pctComTarjeta??.036)*100).toFixed(2)}% + IVA ${(u*100).toFixed(0)}%`),t.medioPago==="Transferencia"&&(s=(t.pctComTransf??0)*(1+u),d=s>0?`Transf. ${((t.pctComTransf??0)*100).toFixed(2)}% + IVA ${(u*100).toFixed(0)}%`:"Transferencia (sin comisin)"),t.medioPago==="Manual"&&(s=t.pctComManual??0,d=`Manual ${((t.pctComManual??0)*100).toFixed(2)}%`);const b=t.aplicar4x1000==="SI"?.004:0,j=s+b,w=(t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0),S=t.pctICA||0,m=w+S,x=t.modoCalcObra||"margen",p=t.margen||.25,c=x==="aiu"?1-m:1-p-m,g=1-j,l=c*g,f=l>0?x==="aiu"?(1+(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))/l:1/l:0,y={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:"1px solid #E0E0E0",fontSize:12},h={fontFamily:"'DM Mono',monospace",fontWeight:600,fontSize:12},v={fontSize:11,color:E.inkLight,marginLeft:12};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginTop:20},children:[e.jsxs(Ke,{style:{padding:18},children:[e.jsx(vt,{t:"Gastos Financieros (GF)",s:"NO llevan margen  se suman al final"}),e.jsxs("div",{style:y,children:[e.jsxs("span",{children:["Comisin cobro ",e.jsx("span",{style:v,children:d})]}),e.jsx("span",{style:h,children:et(s)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Gravamen 41000"}),e.jsx("span",{style:h,children:et(b)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0 0",fontWeight:700,fontSize:13},children:[e.jsx("span",{children:"Total GF"}),e.jsx("span",{style:{...h,color:j>0?E.warning:E.inkLight},children:et(j)})]})]}),e.jsxs(Ke,{style:{padding:18},children:[e.jsx(vt,{t:"Gastos de Contratacin (GC)",s:"Coste directo  LLEVA margen"}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Pliza RCE"}),e.jsx("span",{style:h,children:et(t.pctRCE||0)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Pliza TRC"}),e.jsx("span",{style:h,children:et(t.pctTRC||0)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Adm. contratacin"}),e.jsx("span",{style:h,children:et(t.pctAdm||0)})]}),e.jsxs("div",{style:y,children:[e.jsxs("span",{children:["ICA ",r==="CO"?"(Bogot)":"(municipal)"]}),e.jsx("span",{style:h,children:et(t.pctICA||0)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0 0",fontWeight:700,fontSize:13},children:[e.jsx("span",{children:"Total GC"}),e.jsx("span",{style:{...h,color:m>0?E.warning:E.inkLight},children:et(m)})]})]}),e.jsxs(Ke,{style:{padding:18,gridColumn:"1 / -1",background:E.ink,borderRadius:6},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:12},children:[[x==="aiu"?"AIU":"Margen",et(x==="aiu"?(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07):p),"#aaa"],["GC (lleva M)",et(m),"#aaa"],["Den (1MGC)",c.toFixed(4),"#fff"],["GF (sin M)",et(j),"#aaa"],["Den (1GF)",g.toFixed(4),"#fff"]].map(([A,z,k])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:A}),e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:16,fontWeight:700,color:k},children:z})]},A))}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:14,paddingTop:12,borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:"Denominador total"}),e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:20,fontWeight:700,color:"#fff"},children:l.toFixed(4)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:"Coeficiente multiplicador"}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:20,fontWeight:700,color:"#fff"},children:[" ",f.toFixed(4)]})]})]}),e.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:"1px solid rgba(255,255,255,0.1)",fontSize:11,color:"rgba(255,255,255,0.5)"},children:[x==="aiu"?"Frmula AIU: PVP = CD  (1+AIU) / (1GC) / (1GF)":"Frmula: PVP = CD / (1MGC) / (1GF)","  un CD de 1.000.000 genera PVP = ",l>0?Je(x==="aiu"?1e6*(1+(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))/l:1e6/l):""]})]})]})})()]})}function Oh({d:t,set:i,r:o}){const n=t.pais||"CO",a=n==="CO"?"COP":"EUR",r=J=>J?new Intl.NumberFormat(n==="CO"?"es-CO":"es-ES",{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:0}).format(J):"",s=t.cronogramaActivos||[],d=J=>i("cronogramaActivos",typeof J=="function"?J(s):J),u=()=>{const J=t.borradorLineas||[],M=[];J.forEach(B=>{if(B.esCapitulo)s.find(V=>V.srcId===B.id)?M.push(s.find(V=>V.srcId===B.id)):M.push({id:Ct(),srcId:B.id,nombre:B.nombre||B.descripcion||"Captulo",inicio:t.fechaInicio||Dt(),duracion:30,avance:0,nivel:0,responsable:"",color:"#111111",precioCD:0,esCapitulo:!0});else{const V=B.precioCD>0?Ht(B.precioCD,B.cantidad||1,t):null;if(!s.find(X=>X.srcId===B.id))M.push({id:Ct(),srcId:B.id,nombre:B.descripcion||"Actividad",inicio:t.fechaInicio||Dt(),duracion:15,avance:0,nivel:1,responsable:"",color:"#2A5F8C",pred:"",precioCD:B.precioCD||0,totalVenta:(V==null?void 0:V.totalVenta)||0,esCapitulo:!1});else{const X=s.find(R=>R.srcId===B.id);M.push({...X,precioCD:B.precioCD||0,totalVenta:(V==null?void 0:V.totalVenta)||0})}}}),s.filter(B=>!B.srcId).forEach(B=>M.push(B)),d(M)},b=()=>d([...s,{id:Ct(),nombre:"Nueva actividad",inicio:t.fechaInicio||Dt(),duracion:7,avance:0,nivel:0,responsable:"",color:"#2A5F8C",pred:"",precioCD:0,esCapitulo:!1}]),j=()=>d([...s,{id:Ct(),nombre:"NUEVO CAPTULO",inicio:t.fechaInicio||Dt(),duracion:30,avance:0,nivel:0,responsable:"",color:"#111111",precioCD:0,esCapitulo:!0}]),w=J=>d(s.filter(M=>M.id!==J)),S=(J,M,B)=>d(s.map(V=>V.id===J?{...V,[M]:B}:V)),m=J=>d(s.map(M=>M.id===J?{...M,nivel:Math.min(3,(M.nivel||0)+1)}:M)),x=J=>d(s.map(M=>M.id===J?{...M,nivel:Math.max(0,(M.nivel||0)-1)}:M)),p=(J,M)=>{const B=[...s],V=B.findIndex(X=>X.id===J);M===-1&&V>0&&([B[V-1],B[V]]=[B[V],B[V-1]]),M===1&&V<B.length-1&&([B[V],B[V+1]]=[B[V+1],B[V]]),d(B)},c=J=>{var Z,ue;const M=[];for(let N=J+1;N<s.length&&!(s[N].esCapitulo||(s[N].nivel||0)===0);N++)M.push(s[N]);if(M.length===0)return{start:(Z=s[J])==null?void 0:Z.inicio,dur:((ue=s[J])==null?void 0:ue.duracion)||30,cd:0,venta:0,avance:0};const B=M.map(N=>new Date(N.inicio||Dt()).getTime()),V=M.map(N=>{const G=new Date(N.inicio||Dt());return G.setDate(G.getDate()+(N.duracion||1)-1),G.getTime()}),X=Math.min(...B),R=Math.max(...V),W=Math.ceil((R-X)/864e5)+1,se=M.reduce((N,G)=>N+(G.precioCD||0),0),le=M.reduce((N,G)=>N+(G.totalVenta||0),0),de=M.length>0?Math.round(M.reduce((N,G)=>N+(G.avance||0),0)/M.length):0;return{start:new Date(X).toISOString().split("T")[0],dur:W,cd:se,venta:le,avance:de}},g=J=>{const M=new Date(J.inicio||Dt());return M.setDate(M.getDate()+(J.duracion||1)-1),M.toISOString().split("T")[0]},l=s.flatMap(J=>[new Date(J.inicio||Dt()).getTime(),new Date(g(J)).getTime()]),f=new Date(l.length?Math.min(...l):Date.now()),y=new Date(l.length?Math.max(...l):Date.now()+90*864e5),h=Math.max(30,Math.ceil((y-f)/864e5)+14),v=4,A=J=>Math.max(0,Math.ceil((new Date(J||Dt())-f)/864e5)),z=[];for(let J=0;J<Math.ceil(h/7);J++){const M=new Date(f);M.setDate(M.getDate()+J*7),z.push(M)}const[k,T]=F.useState(!1),[C,D]=F.useState(50),[K,oe]=F.useState(!1),te=s.filter(J=>!J.esCapitulo).reduce((J,M)=>J+(M.precioCD||0),0),P=s.filter(J=>!J.esCapitulo).reduce((J,M)=>J+(M.totalVenta||0),0),ie=()=>{const J=window.open("","_blank"),M=t.fechaInicio?new Date(t.fechaInicio).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"",B=t.fechaEntrega?new Date(t.fechaEntrega).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"",V=s.length>0?h:"";let X=`<html><head><title>Cronograma - ${t.codigoOferta||""}</title>
    <style>@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    @page{size:landscape;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'DM Sans',sans-serif;color:#111;font-size:10px;padding:20px}
    .header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;padding-bottom:12px;border-bottom:3px solid #111}
    .logo{font-size:16px;font-weight:800;letter-spacing:3px}
    .logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}
    .project-info{text-align:right}
    .project-title{font-size:14px;font-weight:700}
    .project-meta{font-size:9px;color:#555;margin-top:2px}
    .kpis{display:flex;gap:16px;margin-bottom:14px;padding:8px 0;border-bottom:1px solid #E0E0E0}
    .kpi{font-size:9px;color:#555}.kpi strong{color:#111;font-size:11px}
    table{width:100%;border-collapse:collapse;margin-bottom:8px}
    th{background:#F5F4F1;padding:4px 6px;font-size:7px;text-transform:uppercase;letter-spacing:0.5px;font-weight:700;color:#888;text-align:left;border-bottom:2px solid #E0E0E0}
    td{padding:4px 6px;border-bottom:1px solid #F5F5F5;font-size:9px}
    .cap td{font-weight:700;background:#F5F4F1;border-bottom:2px solid #E0E0E0;font-size:10px}
    .mono{font-family:'DM Mono',monospace}.green{color:#111111}.blue{color:#3B3B3B}
    .bar-row{height:18px;position:relative;margin:1px 0}
    .bar{height:14px;border-radius:3px;position:absolute;top:2px;min-width:4px}
    .avance{height:14px;border-radius:3px;position:absolute;top:2px;opacity:0.3}
    .gantt-header{font-size:7px;color:#888;border-bottom:1px solid #E0E0E0;padding:2px 0}
    .footer{margin-top:12px;padding-top:8px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:8px;color:#888}
    .totrow td{font-weight:700;border-top:2px solid #111;padding-top:6px}
    @media print{body{padding:0}}
    </style></head><body>`;X+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',X+=`<div class="project-info"><div class="project-title">${t.proyecto||t.codigoOferta||"Proyecto"}</div>`,X+=`<div class="project-meta">${t.codigoOferta||""}  Rev. ${t.revision||"R00"}  ${t.cliente||"Sin cliente"}</div>`,X+=`<div class="project-meta">${t.ubicacion||""}</div></div></div>`,X+='<div class="kpis">',X+=`<div class="kpi">Inicio: <strong>${M}</strong></div>`,X+=`<div class="kpi">Entrega: <strong>${B}</strong></div>`,X+=`<div class="kpi">Duracin: <strong>${V} das</strong></div>`,X+=`<div class="kpi">Actividades: <strong>${s.filter(W=>!W.esCapitulo).length}</strong></div>`,X+=`<div class="kpi">CD Total: <strong class="mono">${r(te)}</strong></div>`,X+=`<div class="kpi">Venta Total: <strong class="mono green">${r(P)}</strong></div>`,X+="</div>",X+='<table><thead><tr><th>#</th><th>WBS</th><th style="min-width:140px">Actividad</th><th>Das</th><th>Inicio</th><th>Fin</th><th>Avance</th><th>Pred</th><th>CD</th><th>Venta</th><th>Responsable</th></tr></thead><tbody>';let R=[0];s.forEach((W,se)=>{const le=W.esCapitulo,de=W.nivel||0;R=R.slice(0,de+1),R[de]=(R[de]||0)+1;const Z=R.filter((q,I)=>I<=de).join("."),ue=de*16,N=le?c(se):null,G=le&&N?N.dur:W.duracion||0,L=(()=>{const q=new Date(W.inicio||Dt());return q.setDate(q.getDate()+G-1),q.toLocaleDateString("es-CO")})(),ae=new Date(le&&(N!=null&&N.start)?N.start:W.inicio||Dt()).toLocaleDateString("es-CO"),pe=le&&N?N.avance:W.avance||0,he=le&&N?N.cd:W.precioCD||0,ze=le&&N?N.venta:W.totalVenta||0;X+=`<tr class="${le?"cap":""}">`,X+=`<td>${se+1}</td><td>${Z}</td>`,X+=`<td style="padding-left:${6+ue}px">${W.nombre||""}</td>`,X+=`<td class="mono">${G}</td><td>${ae}</td><td>${L}</td>`,X+=`<td>${pe}%</td><td>${W.pred||""}</td>`,X+=`<td class="mono">${he>0?r(he):""}</td>`,X+=`<td class="mono green">${ze>0?r(ze):""}</td>`,X+=`<td>${W.responsable||""}</td></tr>`}),X+='<tr class="totrow"><td colspan="8"><strong>TOTAL PROYECTO</strong></td>',X+=`<td class="mono"><strong>${r(te)}</strong></td>`,X+=`<td class="mono green"><strong>${r(P)}</strong></td><td></td></tr>`,X+="</tbody></table>",X+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Cronograma valorado</span>`,X+=`<span>Generado: ${new Date().toLocaleDateString("es-CO")}  Pgina 1</span></div>`,X+="</body></html>",J.document.write(X),J.document.close(),setTimeout(()=>J.print(),400)},me=()=>{var de,Z,ue;const J=t.borradorLineas||[],M=t.pais||"CO",B=((de=Eo[M])==null?void 0:de.categorias)||[];let V=ya;try{const N=(ue=(Z=window.storage)==null?void 0:Z.get)==null?void 0:ue.call(Z,"hab:crm:equipos");N!=null&&N.value&&(V=JSON.parse(N.value))}catch{}const X={},R={},W={},se={},le=(N,G)=>{var L;return((L=G==null?void 0:G.recursosAsignados)==null?void 0:L.length)>0?G.recursosAsignados:hn[N]||[]};return s.filter(N=>!N.esCapitulo).forEach(N=>{const G=J.find(I=>I.id===N.srcId||I.descripcion===N.nombre);if(!G)return;const L=G.apu||{},ae=N.inicio||t.fechaInicio||Dt(),pe=(()=>{const I=new Date(ae);return I.setDate(I.getDate()+(N.duracion||1)-1),I.toISOString().split("T")[0]})(),he=t.ofertaEquipos||[];(L.equiposUsados||[]).forEach(I=>{const $=V.find(ve=>ve.id===I.eqId);if(!$)return;const U=(I.rendimientoOverride??$.rendimiento)*(G.cantidad||1),_=he.find(ve=>ve.nombre===$.nombre);((_==null?void 0:_.herrAsignadas)||Vs[$.id]||[]).forEach(ve=>{const Ie=Oo(ve);if(!Ie)return;const Te=ve;R[Te]||(R[Te]={codigo:ve,nombre:Ie.nombre,familia:Ie.familia,unidad:Ie.unidad||"ud",cantTotal:0,precioRef:Ie.precioRef||0,actividades:[]}),R[Te].cantTotal=Math.max(R[Te].cantTotal,1),R[Te].actividades.push({nombre:N.nombre,inicio:ae,fin:pe,cant:1})}),$.cargos.forEach(ve=>{var xt;const Ie=B.find(Ft=>Ft.id===ve.catId);if(!Ie)return;const Te=U*(ve.cantidad||1),Oe=ro(ve.catId,M);X[ve.catId]||(X[ve.catId]={label:Ie.label,catId:ve.catId,horas:0,costo:0,actividades:[],personas:0}),X[ve.catId].horas+=Te,X[ve.catId].costo+=Te*Oe,X[ve.catId].actividades.push({nombre:N.nombre,equipo:$.nombre,inicio:ae,fin:pe,horas:Te,cant:ve.cantidad,dias:N.duracion||0});const ct=(xt=_==null?void 0:_.cargos)==null?void 0:xt.find(Ft=>Ft.cargoId===ve.catId);le(ve.catId,ct).forEach(Ft=>{const zt=Oo(Ft);if(zt){se[Ft]||(se[Ft]={codigo:Ft,nombre:zt.nombre,familia:zt.familia,unidad:zt.unidad,precioRef:zt.precioRef||0,personas:new Set,actividades:[],cantTotal:0});for(let Vt=0;Vt<(ve.cantidad||1);Vt++)se[Ft].personas.add(`${ve.catId}_${N.id}_${Vt}`);se[Ft].actividades.push({nombre:N.nombre,inicio:ae,fin:pe,cant:ve.cantidad||1})}})})}),(L.mo||[]).forEach(I=>{const $=B.find(_=>_.id===I.catId);if(!$)return;const H=ro(I.catId,M);X[I.catId]||(X[I.catId]={label:$.label,catId:I.catId,horas:0,costo:0,actividades:[],personas:0}),X[I.catId].horas+=I.horas||0,X[I.catId].costo+=(I.horas||0)*H,X[I.catId].actividades.push({nombre:N.nombre,equipo:"MO directa",inicio:ae,fin:pe,horas:I.horas||0,cant:1,dias:N.duracion||0}),(hn[I.catId]||[]).forEach(_=>{const ce=Oo(_);ce&&(se[_]||(se[_]={codigo:_,nombre:ce.nombre,familia:ce.familia,unidad:ce.unidad,precioRef:ce.precioRef||0,personas:new Set,actividades:[],cantTotal:0}),se[_].personas.add(`${I.catId}_${N.id}_mo`),se[_].actividades.push({nombre:N.nombre,inicio:ae,fin:pe,cant:1}))})}),(L.equipos||[]).forEach(I=>{const $=I.descripcion||I.nombre||"Equipo";W[$]||(W[$]={codigo:"",nombre:$,familia:"equipo_obra",unidad:I.unidad||"ud",cantTotal:0,precioRef:I.precio||0,actividades:[]}),W[$].cantTotal=Math.max(W[$].cantTotal,I.cantidad||1),W[$].actividades.push({nombre:N.nombre,inicio:ae,fin:pe,cant:I.cantidad||1})})}),Object.values(X).forEach(N=>{const G={};N.actividades.forEach(L=>{const ae=new Date(L.inicio);for(let pe=0;pe<L.dias;pe++){const he=new Date(ae.getTime()+pe*864e5).toISOString().split("T")[0];G[he]=(G[he]||0)+(L.cant||1)}}),N.personas=Math.max(1,...Object.values(G)),N.inicioMasTemprano=N.actividades.reduce((L,ae)=>ae.inicio<L?ae.inicio:L,"9999"),N.finMasTardio=N.actividades.reduce((L,ae)=>ae.fin>L?ae.fin:L,"0000")}),Object.values(se).forEach(N=>{N.cantTotal=N.personas.size,N.inicioNecesario=N.actividades.reduce((G,L)=>L.inicio<G?L.inicio:G,"9999"),N.costoTotal=N.cantTotal*(N.precioRef||0)}),Object.values(R).forEach(N=>{N.inicioNecesario=N.actividades.reduce((G,L)=>L.inicio<G?L.inicio:G,"9999")}),Object.values(W).forEach(N=>{N.inicioNecesario=N.actividades.reduce((G,L)=>L.inicio<G?L.inicio:G,"9999")}),{personal:Object.values(X).sort((N,G)=>G.horas-N.horas),herramientas:Object.values(R).sort((N,G)=>N.inicioNecesario.localeCompare(G.inicioNecesario)),equiposObra:Object.values(W).sort((N,G)=>N.inicioNecesario.localeCompare(G.inicioNecesario)),epps:Object.values(se).sort((N,G)=>G.cantTotal-N.cantTotal)}},Q=J=>J&&J!=="9999"?new Date(J).toLocaleDateString("es-CO",{day:"numeric",month:"short",year:"numeric"}):"",je=J=>{const M=window.open("","_blank"),{personal:B,herramientas:V,equiposObra:X,epps:R}=J,W=B.reduce((ue,N)=>ue+N.horas,0),se=B.reduce((ue,N)=>ue+N.costo,0),le=B.reduce((ue,N)=>ue+N.personas,0);t.pais;const de="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:10px;border-bottom:3px solid #111}.logo{font-size:16px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:12px;margin:14px 0 6px;padding:5px 0;border-bottom:2px solid #111}h3{font-size:10px;margin:8px 0 4px}.kpis{display:flex;gap:16px;margin-bottom:12px;font-size:9px;color:#555}.kpi strong{color:#111}table{width:100%;border-collapse:collapse;margin-bottom:10px}th{background:#F5F4F1;padding:3px 5px;font-size:7px;text-transform:uppercase;letter-spacing:.4px;font-weight:700;color:#888;text-align:left;border-bottom:2px solid #E0E0E0}td{padding:3px 5px;border-bottom:1px solid #F5F5F5;font-size:8px}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.blue{color:#3B3B3B}.bold{font-weight:700}.totrow td{font-weight:700;border-top:2px solid #111}.badge{background:#F0F0F0;color:#3B3B3B;padding:2px 8px;border-radius:3px;font-weight:700;font-size:10px}.footer{margin-top:12px;padding-top:6px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}@media print{body{padding:8px}}";let Z=`<html><head><title>Plan de Recursos - ${t.codigoOferta||""}</title><style>${de}</style></head><body>`;Z+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',Z+='<div style="text-align:right"><div style="font-size:14px;font-weight:700">Plan de Recursos y Contratacin</div>',Z+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,Z+=`<div class="kpis"><div class="kpi">Total personas: <strong class="badge">${le}</strong></div>`,Z+=`<div class="kpi">Horas MO: <strong class="mono">${W.toFixed(0)} h</strong></div>`,Z+=`<div class="kpi">Costo MO: <strong class="mono green">${r(se)}</strong></div>`,Z+=`<div class="kpi">EPPs: <strong>${R.length} tems</strong></div>`,Z+=`<div class="kpi">Herramientas: <strong>${V.length+X.length} tems</strong></div></div>`,Z+="<h2> 1. Personal  Contratacin</h2>",Z+="<table><tr><th>Categora</th><th>Personas</th><th>Horas</th><th>Costo</th><th>Ingreso estimado</th><th>Hasta</th><th>Actividades</th></tr>",B.forEach(ue=>{Z+=`<tr><td class="bold">${ue.label}</td><td class="badge mono">${ue.personas}</td>`,Z+=`<td class="mono">${ue.horas.toFixed(0)}h</td><td class="mono green">${r(ue.costo)}</td>`,Z+=`<td class="mono">${Q(ue.inicioMasTemprano)}</td><td class="mono">${Q(ue.finMasTardio)}</td>`,Z+=`<td>${ue.actividades.map(N=>N.nombre).filter((N,G,L)=>L.indexOf(N)===G).join(", ")}</td></tr>`}),Z+=`<tr class="totrow"><td>TOTAL</td><td class="badge mono">${le}</td><td class="mono">${W.toFixed(0)}h</td><td class="mono green">${r(se)}</td><td colspan="3"></td></tr></table>`,Z+="<h2> 2. Elementos de Proteccin Personal (EPP)</h2>",Z+="<table><tr><th>Cdigo</th><th>Elemento</th><th>Cant.</th><th>Precio ref.</th><th>Subtotal</th><th>Necesario desde</th></tr>",R.forEach(ue=>{Z+=`<tr><td class="mono bold">${ue.codigo||""}</td><td>${ue.nombre}</td><td class="mono">${ue.cantTotal}</td><td class="mono">${r(ue.precioRef||0)}</td><td class="mono green bold">${r(ue.costoTotal||0)}</td><td class="mono">${Q(ue.inicioNecesario)}</td></tr>`}),Z+=`<tr class="totrow"><td colspan="2">TOTAL EPPs</td><td class="mono">${R.reduce((ue,N)=>ue+N.cantTotal,0)}</td><td></td><td class="mono green bold">${r(R.reduce((ue,N)=>ue+(N.costoTotal||0),0))}</td><td></td></tr></table>`,Z+="<h2> 3. Herramientas y Equipos</h2>",Z+="<table><tr><th>Cdigo</th><th>Recurso</th><th>Tipo</th><th>Cant.</th><th>Precio ref.</th><th>Necesario desde</th><th>Actividades</th></tr>",[...V,...X].forEach(ue=>{Z+=`<tr><td class="mono bold">${ue.codigo||""}</td><td>${ue.nombre}</td><td>${Jn[ue.familia]||""}</td><td class="mono">${ue.cantTotal}</td>`,Z+=`<td class="mono">${r(ue.precioRef||0)}</td><td class="mono">${Q(ue.inicioNecesario)}</td>`,Z+=`<td>${ue.actividades.map(N=>N.nombre).filter((N,G,L)=>L.indexOf(N)===G).join(", ")}</td></tr>`}),Z+="</table>",Z+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Plan de recursos</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,Z+="</body></html>",M.document.write(Z),M.document.close(),setTimeout(()=>M.print(),400)},re={border:`1px solid ${E.border}`,borderRadius:3,padding:"3px 5px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:E.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Cronograma valorado"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[s.length," actividades  ",r(te)," CD  ",r(P)," venta"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[e.jsxs(ht,{sm:!0,v:"sec",on:u,children:[e.jsx(wo,{size:11})," Importar borrador"]}),e.jsxs(ht,{sm:!0,v:"sec",on:j,children:[e.jsx(Pe,{size:11})," Captulo"]}),e.jsxs(ht,{sm:!0,on:b,children:[e.jsx(Pe,{size:11})," Actividad"]}),e.jsx("button",{onClick:()=>T(!k),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${k?E.accent:E.border}`,borderRadius:4,background:k?"#E6F4EC":"#fff",color:k?"#111111":E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:k?" Valorado":" Valorado"}),e.jsxs("button",{onClick:ie,style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:"none",borderRadius:4,background:"#111",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(At,{size:11})," Vista PDF"]}),e.jsxs("button",{onClick:()=>oe(!0),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:"none",borderRadius:4,background:"#3B3B3B",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(kn,{size:11})," Recursos"]})]})]}),s.length===0?e.jsxs(Ke,{style:{padding:40,textAlign:"center"},children:[e.jsx(Zs,{size:32,style:{color:E.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:E.inkLight,fontSize:13,margin:0},children:"Sin actividades. Importa desde el borrador o aade manualmente."})]}):e.jsx(Ke,{style:{padding:0,overflow:"hidden"},children:e.jsxs("div",{style:{display:"flex",minHeight:200},children:[e.jsx("div",{style:{width:`${C}%`,minWidth:400,flexShrink:0,borderRight:`2px solid ${E.border}`,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{width:30,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"#"}),e.jsx("th",{style:{width:34,padding:"6px 2px",fontSize:8,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"WBS"}),e.jsx("th",{style:{padding:"6px 8px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`,textAlign:"left",minWidth:160},children:"ACTIVIDAD"}),e.jsx("th",{style:{width:50,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"DAS"}),e.jsx("th",{style:{width:95,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"INICIO"}),e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"FIN"}),e.jsx("th",{style:{width:50,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"%"}),e.jsx("th",{style:{width:60,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"PRED"}),k&&e.jsxs(e.Fragment,{children:[e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"CD"}),e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${E.border}`},children:"VENTA"})]}),e.jsx("th",{style:{width:64,padding:"6px 4px",borderBottom:`2px solid ${E.border}`}})]})}),e.jsx("tbody",{children:s.map((J,M)=>{const B=J.nivel||0,V=J.esCapitulo,X=V?c(M):null,R=V&&X?X.dur:J.duracion,W=V&&X?X.avance:J.avance||0;return e.jsxs("tr",{style:{background:V?"#F5F4F1":M%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${V?E.border:"#F5F5F5"}`,height:V?32:28},children:[e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",fontSize:9,color:"#BBB"},children:M+1}),e.jsx("td",{style:{padding:"2px 2px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:1,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>x(J.id),title:"Quitar sangra",style:{background:"none",border:"none",cursor:"pointer",color:B>0?"#888":"#DDD",padding:0,fontSize:10,lineHeight:1},children:""}),e.jsx("button",{onClick:()=>m(J.id),title:"Aadir sangra",style:{background:"none",border:"none",cursor:"pointer",color:B<3?"#888":"#DDD",padding:0,fontSize:10,lineHeight:1},children:""})]})}),e.jsx("td",{style:{padding:"2px 6px"},children:e.jsxs("div",{style:{paddingLeft:B*16,display:"flex",alignItems:"center",gap:4},children:[V&&e.jsx("span",{style:{background:"#111111",color:"#fff",padding:"0px 4px",borderRadius:2,fontSize:7,fontWeight:700,lineHeight:"14px"},children:""}),e.jsx("input",{value:J.nombre||"",onChange:se=>S(J.id,"nombre",se.target.value),style:{border:"none",background:"transparent",outline:"none",width:"100%",fontWeight:V?700:400,fontSize:V?11:10.5,color:E.ink,textTransform:V?"uppercase":"none",padding:"1px 0"}})]})}),e.jsx("td",{style:{padding:"2px 3px"},children:V?e.jsx("span",{style:{fontSize:10,color:E.inkMid,textAlign:"center",display:"block"},children:R}):e.jsx("input",{type:"number",value:J.duracion||"",min:1,onChange:se=>S(J.id,"duracion",+se.target.value),style:{...re,width:40,textAlign:"center",padding:"2px 3px"}})}),e.jsx("td",{style:{padding:"2px 3px"},children:V?e.jsx("span",{style:{fontSize:9,color:E.inkMid},children:(X==null?void 0:X.start)||""}):e.jsx("input",{type:"date",value:J.inicio||"",onChange:se=>S(J.id,"inicio",se.target.value),style:{...re,width:90,fontSize:10,padding:"2px 3px"}})}),e.jsx("td",{style:{padding:"2px 4px",fontSize:9,color:E.inkMid,textAlign:"center"},children:g(J)}),e.jsx("td",{style:{padding:"2px 3px",textAlign:"center"},children:e.jsxs("span",{style:{fontSize:9,fontWeight:W>0?600:400,color:W>=100?"#111111":W>0?"#3B3B3B":"#CCC"},children:[W,"%"]})}),e.jsx("td",{style:{padding:"2px 3px"},children:!V&&e.jsx("input",{value:J.pred||"",placeholder:"",onChange:se=>S(J.id,"pred",se.target.value),title:"Predecesor: n de fila (ej: 3, 5)",style:{...re,width:36,textAlign:"center",fontSize:9,padding:"2px 2px"}})}),k&&e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{padding:"2px 4px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:V?700:400,color:E.inkMid},children:V?r((X==null?void 0:X.cd)||0):J.precioCD>0?r(J.precioCD):""}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:V?700:400,color:V?"#111111":"#3B3B3B"},children:V?r((X==null?void 0:X.venta)||0):J.totalVenta>0?r(J.totalVenta):""})]}),e.jsxs("td",{style:{padding:"2px 2px",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>p(J.id,-1),style:{background:"none",border:"none",cursor:"pointer",color:"#CCC",padding:1,fontSize:9},children:""}),e.jsx("button",{onClick:()=>p(J.id,1),style:{background:"none",border:"none",cursor:"pointer",color:"#CCC",padding:1,fontSize:9},children:""}),e.jsx("button",{onClick:()=>w(J.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx(qe,{size:10})})]})]},J.id)})}),k&&e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:"#E6F4EC",borderTop:"2px solid #111111"},children:[e.jsx("td",{colSpan:8,style:{padding:"6px 8px",fontSize:10,fontWeight:700,color:"#111111"},children:"TOTAL PROYECTO"}),e.jsx("td",{style:{padding:"6px 4px",textAlign:"right",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace",color:"#111111"},children:r(te)}),e.jsx("td",{style:{padding:"6px 4px",textAlign:"right",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace",color:"#111111"},children:r(P)}),e.jsx("td",{})]})})]})}),e.jsxs("div",{style:{flex:1,overflowX:"auto",overflowY:"hidden",background:"#FFFFFF"},children:[e.jsx("div",{style:{display:"flex",borderBottom:`2px solid ${E.border}`,background:"#EDEBE7",height:28,position:"sticky",top:0},children:z.map((J,M)=>e.jsx("div",{style:{width:7*v,minWidth:7*v,flexShrink:0,fontSize:8,color:"#888",textAlign:"center",borderRight:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},children:J.toLocaleDateString("es",{month:"short",day:"numeric"})},M))}),s.map((J,M)=>{const B=J.esCapitulo,V=B?c(M):null,X=B&&V?V.start:J.inicio,R=B&&V?V.dur:Math.max(1,J.duracion||1),W=B&&V?V.avance:J.avance||0,se=A(X),le=W/100,de=se*v,Z=Math.max(R*v,4),ue=B?32:28,N=B?8:18,G=(ue-N)/2,L=J.pred?parseInt(J.pred)-1:-1,ae=L>=0&&L<s.length?s[L]:null;return e.jsxs("div",{style:{position:"relative",height:ue,borderBottom:`1px solid ${B?"#E0E0E0":"#F5F5F5"}`},children:[M===0&&(()=>{const pe=A(Dt())*v;return pe>0?e.jsx("div",{style:{position:"absolute",left:pe,top:0,bottom:0,width:1,background:"#E44",zIndex:2,opacity:.5}}):null})(),e.jsx("div",{style:{position:"absolute",left:de,top:G,width:Z,height:N,background:B?"#999":J.color||"#2A5F8C",borderRadius:B?"2px 2px 0 0":3,opacity:.2}}),e.jsx("div",{style:{position:"absolute",left:de,top:G,width:Z*le,height:N,background:B?"#555":J.color||"#2A5F8C",borderRadius:B?"2px 2px 0 0":3}}),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",left:de-3,top:G+N-2,width:6,height:6,background:"#555",transform:"rotate(45deg)"}}),e.jsx("div",{style:{position:"absolute",left:de+Z-3,top:G+N-2,width:6,height:6,background:"#555",transform:"rotate(45deg)"}})]}),!B&&Z>30&&e.jsx("span",{style:{position:"absolute",left:de+4,top:G+1,fontSize:8,color:"#fff",fontWeight:600,lineHeight:N+"px",textShadow:"0 1px 2px rgba(0,0,0,0.5)",pointerEvents:"none",maxWidth:Z-8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:W>0?`${W}%`:""}),ae&&(()=>{const pe=(A(ae.inicio)+Math.max(1,ae.duracion||1))*v;return pe<de?e.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:ue,pointerEvents:"none",overflow:"visible"},children:[e.jsx("line",{x1:pe,y1:ue/2,x2:de,y2:ue/2,stroke:"#E44",strokeWidth:1,strokeDasharray:"3,2",markerEnd:"url(#arrow)"}),e.jsx("defs",{children:e.jsx("marker",{id:"arrow",markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto",children:e.jsx("path",{d:"M0,0 L6,2 L0,4",fill:"#E44"})})})]}):null})(),!B&&e.jsx("input",{type:"range",min:0,max:100,value:W,onChange:pe=>S(J.id,"avance",+pe.target.value),title:`Avance: ${W}%`,style:{position:"absolute",left:de,top:G,width:Z,height:N,opacity:0,cursor:"pointer"}})]},J.id)})]})]})}),K&&(()=>{const J=me(),{personal:M,herramientas:B,equiposObra:V,epps:X}=J,R=M.reduce((N,G)=>N+G.horas,0),W=M.reduce((N,G)=>N+G.costo,0),se=M.reduce((N,G)=>N+G.personas,0);t.pais;const le=M.length>0||B.length>0||V.length>0,de=()=>{let N=`\uFEFFSeccin;Cdigo;Recurso;Familia;Cantidad;Horas;Costo;Precio ref.;Necesario desde;Hasta;Actividades
`;M.forEach(ae=>{N+=`Personal;;${ae.label};;${ae.personas};${ae.horas.toFixed(0)};${ae.costo.toFixed(0)};;${ae.inicioMasTemprano||""};${ae.finMasTardio||""};${ae.actividades.map(pe=>pe.nombre).filter((pe,he,ze)=>ze.indexOf(pe)===he).join(" | ")}
`}),X.forEach(ae=>{N+=`EPP;${ae.codigo||""};${ae.nombre};${Jn[ae.familia]||""};${ae.cantTotal};;${ae.costoTotal||0};${ae.precioRef||0};${ae.inicioNecesario||""};;${ae.actividades.map(pe=>pe.nombre).filter((pe,he,ze)=>ze.indexOf(pe)===he).join(" | ")}
`}),[...B,...V].forEach(ae=>{N+=`Herramienta;${ae.codigo||""};${ae.nombre};${Jn[ae.familia]||""};${ae.cantTotal};;;${ae.precioRef||0};${ae.inicioNecesario||""};;${ae.actividades.map(pe=>pe.nombre).filter((pe,he,ze)=>ze.indexOf(pe)===he).join(" | ")}
`});const G=new Blob([N],{type:"text/csv;charset=utf-8"}),L=document.createElement("a");L.href=URL.createObjectURL(G),L.download=`Recursos_${t.codigoOferta||"proyecto"}.csv`,L.click()},Z={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"2px solid #E0E0E0",textAlign:"left"},ue={...Z,textAlign:"right"};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:16},onClick:()=>oe(!1),children:e.jsxs("div",{onClick:N=>N.stopPropagation(),style:{background:"#fff",borderRadius:10,width:"95%",maxWidth:1050,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.25)"},children:[e.jsxs("div",{style:{padding:"14px 22px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:0},children:" Plan de Recursos y Contratacin"}),e.jsxs("p",{style:{fontSize:10,color:"#888",margin:"2px 0 0"},children:["Desde APUs + cronograma  ",t.codigoOferta||"","  ",t.cliente||""]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("button",{onClick:de,style:{padding:"5px 12px",background:"#fff",border:"1px solid #E0E0E0",borderRadius:4,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(wo,{size:11})," CSV"]}),e.jsxs("button",{onClick:()=>je(J),style:{padding:"5px 12px",background:"#111",color:"#fff",border:"none",borderRadius:4,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(At,{size:11})," PDF"]}),e.jsx("button",{onClick:()=>oe(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:18})})]})]}),e.jsxs("div",{style:{padding:"8px 22px",background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",display:"flex",gap:18,flexWrap:"wrap",flexShrink:0,fontSize:10,color:"#555"},children:[e.jsxs("span",{children:[" Personas: ",e.jsx("strong",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 8px",borderRadius:3,fontFamily:"'DM Mono',monospace"},children:se})]}),e.jsxs("span",{children:[" Horas MO: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:[R.toFixed(0),"h"]})]}),e.jsxs("span",{children:[" Costo MO: ",e.jsx("strong",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:r(W)})]}),e.jsxs("span",{children:[" EPPs: ",e.jsxs("strong",{children:[X.length," tems"]})]}),e.jsxs("span",{children:[" Herr./Equipos: ",e.jsx("strong",{children:B.length+V.length})]})]}),e.jsx("div",{style:{overflowY:"auto",flex:1,padding:"0 22px 22px"},children:le?e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 1. Personal  Contratacin y fechas de ingreso"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:Z,children:"Categora"}),e.jsx("th",{style:ue,children:"Personas"}),e.jsx("th",{style:ue,children:"Horas"}),e.jsx("th",{style:ue,children:"Costo"}),e.jsx("th",{style:Z,children:"Ingreso estimado"}),e.jsx("th",{style:Z,children:"Hasta"}),e.jsx("th",{style:Z,children:"Actividades"})]})}),e.jsxs("tbody",{children:[M.map(N=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"7px 8px",fontWeight:600},children:N.label}),e.jsx("td",{style:{padding:"7px 8px",textAlign:"right"},children:e.jsx("span",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 10px",borderRadius:4,fontWeight:700,fontFamily:"'DM Mono',monospace",fontSize:13},children:N.personas})}),e.jsxs("td",{style:{padding:"7px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[N.horas.toFixed(0),"h"]}),e.jsx("td",{style:{padding:"7px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",color:"#111111",fontWeight:600},children:r(N.costo)}),e.jsx("td",{style:{padding:"7px 8px"},children:e.jsxs("span",{style:{background:"#E8F4EE",color:"#111111",padding:"2px 8px",borderRadius:3,fontWeight:600,fontSize:10},children:[" ",Q(N.inicioMasTemprano)]})}),e.jsx("td",{style:{padding:"7px 8px",fontSize:10,color:"#888"},children:Q(N.finMasTardio)}),e.jsx("td",{style:{padding:"7px 8px",fontSize:9,color:"#888",maxWidth:180},children:N.actividades.map(G=>G.nombre).filter((G,L,ae)=>ae.indexOf(G)===L).join(", ")})]},N.catId)),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsx("td",{style:{padding:"8px",fontWeight:700,fontSize:12},children:"TOTAL"}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:e.jsx("span",{style:{background:"#111",color:"#fff",padding:"3px 12px",borderRadius:4,fontWeight:700,fontFamily:"'DM Mono',monospace",fontSize:14},children:se})}),e.jsxs("td",{style:{padding:"8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:[R.toFixed(0),"h"]}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111",fontSize:13},children:r(W)}),e.jsx("td",{colSpan:3})]})]})]}),X.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6,justifyContent:"space-between"},children:[e.jsx("span",{children:" 2. Elementos de Proteccin Personal (EPP)"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:11,color:"#111111",fontWeight:600},children:["Est. ",r(X.reduce((N,G)=>N+(G.costoTotal||0),0))]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:Z,children:"Cdigo"}),e.jsx("th",{style:Z,children:"Elemento"}),e.jsx("th",{style:ue,children:"Cant."}),e.jsx("th",{style:ue,children:"Precio ref."}),e.jsx("th",{style:ue,children:"Subtotal"}),e.jsx("th",{style:Z,children:"Necesario desde"})]})}),e.jsxs("tbody",{children:[X.map((N,G)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#FFF8E7",color:"#8C6A00",padding:"1px 6px",borderRadius:3},children:N.codigo||""})}),e.jsxs("td",{style:{padding:"6px 8px",fontWeight:600},children:[ba[N.familia]||""," ",N.nombre]}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:N.cantTotal}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"},children:r(N.precioRef||0)}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:r(N.costoTotal||0)}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsxs("span",{style:{background:"#FFF8E7",color:"#8C6A00",padding:"2px 8px",borderRadius:3,fontSize:10,fontWeight:600},children:[" ",Q(N.inicioNecesario)]})})]},G)),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsx("td",{colSpan:2,style:{padding:"6px 8px",fontWeight:700},children:"TOTAL EPPs"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:X.reduce((N,G)=>N+G.cantTotal,0)}),e.jsx("td",{}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111"},children:r(X.reduce((N,G)=>N+(G.costoTotal||0),0))}),e.jsx("td",{})]})]})]})]}),(B.length>0||V.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 3. Herramientas y Equipos de Obra"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:Z,children:"Cdigo"}),e.jsx("th",{style:Z,children:"Recurso"}),e.jsx("th",{style:Z,children:"Tipo"}),e.jsx("th",{style:ue,children:"Cant."}),e.jsx("th",{style:ue,children:"Precio ref."}),e.jsx("th",{style:Z,children:"Necesario desde"}),e.jsx("th",{style:Z,children:"Actividades"})]})}),e.jsx("tbody",{children:[...B,...V].map((N,G)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#F0F0F0",color:"#3B3B3B",padding:"1px 6px",borderRadius:3},children:N.codigo||""})}),e.jsxs("td",{style:{padding:"6px 8px",fontWeight:600},children:[ba[N.familia]||""," ",N.nombre]}),e.jsx("td",{style:{padding:"6px 8px",fontSize:9,color:"#888"},children:Jn[N.familia]||N.familia}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:N.cantTotal}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"},children:r(N.precioRef||0)}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsxs("span",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 8px",borderRadius:3,fontSize:10,fontWeight:600},children:[" ",Q(N.inicioNecesario)]})}),e.jsx("td",{style:{padding:"6px 8px",fontSize:9,color:"#888"},children:N.actividades.map(L=>L.nombre).filter((L,ae,pe)=>pe.indexOf(L)===ae).join(", ")})]},G))})]})]}),e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 4. Detalle de personal por actividad"}),M.map(N=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("h4",{style:{fontSize:11,fontWeight:700,margin:"8px 0 4px",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:N.label}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111",fontWeight:600,fontSize:10},children:[N.personas," pers.  ",N.horas.toFixed(0),"h  ",r(N.costo)]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:10},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Actividad","Equipo","Pers.","Horas","Inicio","Fin","Das"].map(G=>e.jsx("th",{style:{padding:"3px 6px",fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"1px solid #E0E0E0",textAlign:G==="Actividad"||G==="Equipo"||G==="Inicio"||G==="Fin"?"left":"right"},children:G},G))})}),e.jsx("tbody",{children:N.actividades.map((G,L)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"4px 6px"},children:G.nombre}),e.jsx("td",{style:{padding:"4px 6px",color:"#888"},children:G.equipo}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:G.cant}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:G.horas.toFixed(1)}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9},children:Q(G.inicio)}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9},children:Q(G.fin)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:G.dias})]},L))})]})]},N.catId))]}):e.jsxs("div",{style:{textAlign:"center",padding:"50px 0",color:"#888"},children:[e.jsx(kn,{size:32,style:{opacity:.3,marginBottom:10}}),e.jsx("p",{style:{fontSize:13,fontWeight:600},children:"No se encontraron recursos en los APUs."}),e.jsx("p",{style:{fontSize:11,marginTop:8,lineHeight:1.6,maxWidth:400,margin:"8px auto 0"},children:"Para generar el plan necesitas: partidas con APU en el borrador (con cuadrillas/MO asignada)  importar actividades al cronograma."})]})})]})})})()]})}const $r=[{id:"personal_dir",label:" Personal de direccin y administracin",items:[{desc:"Director de proyecto",unidad:"mes",cant:0,valorUnit:0},{desc:"Residente de obra / Coordinador",unidad:"mes",cant:0,valorUnit:0},{desc:"Profesional HSE / SISO",unidad:"mes",cant:0,valorUnit:0},{desc:"Coordinador administrativo",unidad:"mes",cant:0,valorUnit:0},{desc:"Almacenista",unidad:"mes",cant:0,valorUnit:0}]},{id:"seguridad",label:" Seguridad y salud en el trabajo",items:[{desc:"Ambulancia / servicio mdico",unidad:"mes",cant:0,valorUnit:0},{desc:"Sealizacin y demarcacin",unidad:"gl",cant:0,valorUnit:0},{desc:"Botiqun y elementos de emergencia",unidad:"gl",cant:0,valorUnit:0},{desc:"Capacitaciones SST",unidad:"gl",cant:0,valorUnit:0},{desc:"Exmenes mdicos ocupacionales",unidad:"gl",cant:0,valorUnit:0}]},{id:"instalaciones",label:" Instalaciones provisionales",items:[{desc:"Campamento / oficina temporal",unidad:"mes",cant:0,valorUnit:0},{desc:"Baos porttiles",unidad:"mes",cant:0,valorUnit:0},{desc:"Cerramiento provisional",unidad:"ml",cant:0,valorUnit:0},{desc:"Acometidas temporales (agua, luz)",unidad:"gl",cant:0,valorUnit:0}]},{id:"servicios",label:" Servicios y seguros",items:[{desc:"Pliza todo riesgo construccin",unidad:"gl",cant:0,valorUnit:0},{desc:"Pliza responsabilidad civil",unidad:"gl",cant:0,valorUnit:0},{desc:"Servicios pblicos obra",unidad:"mes",cant:0,valorUnit:0},{desc:"Transporte y logstica",unidad:"mes",cant:0,valorUnit:0},{desc:"Comunicaciones",unidad:"mes",cant:0,valorUnit:0}]},{id:"otros",label:" Otros gastos generales",items:[{desc:"Papelera y consumibles oficina",unidad:"mes",cant:0,valorUnit:0},{desc:"Ensayos y laboratorio",unidad:"gl",cant:0,valorUnit:0},{desc:"Imprevistos",unidad:"gl",cant:0,valorUnit:0}]}];function Lh({d:t,set:i,r:o}){const n=t.pais||"CO",a=n==="CO"?"COP":"EUR",r=C=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(C||0),s=t.ggMeses||6,d=(()=>{const C=(t.cronogramaActivos||[]).filter(oe=>!oe.esCapitulo&&oe.duracion>0);if(C.length===0)return 0;const D=t.fechaInicio?new Date(t.fechaInicio):new Date;let K=D.getTime();return C.forEach(oe=>{const te=new Date(oe.inicio||D).getTime()+(oe.duracion||1)*864e5;te>K&&(K=te)}),Math.max(1,Math.ceil((K-D.getTime())/(30*864e5)))})(),u=s,[b,j]=F.useState(()=>{var D;if(((D=t.ggItems)==null?void 0:D.length)>0)return t.ggItems;const C=[];return $r.forEach(K=>{K.items.forEach(oe=>{C.push({id:Ct(),categoria:K.id,desc:oe.desc,unidad:oe.unidad,cant:oe.cant,valorUnit:oe.valorUnit})})}),C});F.useEffect(()=>{i("ggItems",b)},[b]);const w=(C,D,K)=>j(oe=>oe.map(te=>te.id===C?{...te,[D]:K}:te)),S=C=>j(D=>D.filter(K=>K.id!==C)),m=C=>j(D=>[...D,{id:Ct(),categoria:C,desc:"",unidad:"mes",cant:0,valorUnit:0}]),x=C=>(C.cant||0)*(C.valorUnit||0),p=b.reduce((C,D)=>C+x(D),0),c=o.COSTO||0,g=c>0?p/c:0,l=(t.borradorLineas||[]).filter(C=>!C.esCapitulo).length||1,f=()=>{j(C=>C.map(D=>D.unidad==="mes"?{...D,cant:s}:D))},y=C=>{d<=0||(i("ggMeses",d+(C?1:0)),C&&i("ggMesCierre",!0))},h=d>0&&d!==s&&d+1!==s,v=t.ggCriterio||"costo";F.useEffect(()=>{t.modoCalcObra==="aiu"&&i("aiuA",Math.round(g*1e4)/1e4),i("ggPct",Math.round(g*1e4)/1e4)},[p,c]);const A=()=>{const C=[],D=b.filter(re=>re.categoria==="personal_dir"&&re.desc.trim().length>0),K={director:"#111111",residente:"#2A5F8C",hse:"#8C2A2A",siso:"#8C2A2A",coordinador:"#6B5B8C",almacen:"#5B8DB8",admin:"#6B5B8C"},oe={director:"",residente:"",hse:"",siso:"",coordinador:"",almacen:"",admin:""},te=re=>{const J=re.toLowerCase();for(const[M,B]of Object.entries(K))if(J.includes(M))return M;return null},P=D.find(re=>re.desc.toLowerCase().includes("director")),ie=Ct();P?C.push({id:ie,parentId:null,nombre:"",cargo:P.desc,color:"#111111",icon:""}):C.push({id:ie,parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""}),D.filter(re=>re!==P).forEach(re=>{const J=te(re.desc);C.push({id:Ct(),parentId:ie,nombre:"",cargo:re.desc,color:J?K[J]:"#555",icon:J?oe[J]:""})});const me=C.find(re=>re.cargo.toLowerCase().includes("residente"))||C.find(re=>re.parentId===ie)||C[0],Q=t.ofertaEquipos||[],je=new Set;Q.forEach(re=>{(re.cargos||[]).forEach(J=>{var V;const M=(((V=Eo[n])==null?void 0:V.categorias)||[]).find(X=>X.id===J.cargoId),B=(M==null?void 0:M.label)||J.cargoId;!je.has(B)&&!C.find(X=>X.cargo.toLowerCase()===B.toLowerCase())&&(je.add(B),C.push({id:Ct(),parentId:(me==null?void 0:me.id)||ie,nombre:"",cargo:B,color:"#5B8DB8",icon:""}))})}),i("orgNodos",C)},z=()=>{const C=window.open("","_blank"),D="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:12px;margin:10px 0 4px;padding:6px 0 4px;border-bottom:2px solid #111}.kpis{display:flex;gap:14px;margin-bottom:10px;font-size:9px;color:#555}.kpi strong{color:#111}.kpi .badge{background:#111111;color:#fff;padding:1px 8px;border-radius:3px;font-weight:700;font-family:'DM Mono',monospace}table{width:100%;border-collapse:collapse;margin-bottom:8px}th{background:#F5F4F1;padding:3px 6px;font-size:7px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:left;border-bottom:1px solid #E0E0E0}td{padding:3px 6px;font-size:8px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.bold{font-weight:700}.r{text-align:right}.cat{background:#E8E6E1;font-weight:700;font-size:7px;text-transform:uppercase;letter-spacing:.4px;padding:4px 6px}.totrow td{border-top:2px solid #111;font-weight:700}.footer{margin-top:10px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}";let K=`<html><head><title>Gastos Generales - ${t.codigoOferta||""}</title><style>${D}</style></head><body>`;K+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',K+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Gastos Generales de Obra</div>',K+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,K+=`<div class="kpis"><div class="kpi">Costo directo: <strong class="mono">${r(c)}</strong></div>`,K+=`<div class="kpi">Total GG: <strong class="mono green">${r(p)}</strong></div>`,K+=`<div class="kpi">% GG: <span class="badge">${(g*100).toFixed(2)}%</span></div>`,K+=`<div class="kpi">Duracin: <strong>${u} meses</strong></div></div>`,$r.forEach(oe=>{const te=b.filter(ie=>ie.categoria===oe.id&&x(ie)>0);if(te.length===0)return;const P=te.reduce((ie,me)=>ie+x(me),0);K+=`<h2>${oe.label}  ${r(P)}</h2>`,K+='<table><tr><th>Descripcin</th><th>Unidad</th><th class="r">Cant.</th><th class="r">Valor unit.</th><th class="r">Subtotal</th></tr>',te.forEach(ie=>{K+=`<tr><td>${ie.desc}</td><td>${ie.unidad}</td><td class="mono r">${ie.cant}</td>`,K+=`<td class="mono r">${r(ie.valorUnit)}</td><td class="mono r bold green">${r(x(ie))}</td></tr>`}),K+="</table>"}),K+='<table style="margin-top:12px"><tr class="totrow"><td colspan="4" class="bold">TOTAL GASTOS GENERALES</td>',K+=`<td class="mono r bold green" style="font-size:11px">${r(p)} ${a}</td></tr>`,K+=`<tr><td colspan="4">Incidencia sobre costo directo</td><td class="mono r bold" style="font-size:11px">${(g*100).toFixed(2)}%</td></tr></table>`,K+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Gastos generales</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,K+="</body></html>",C.document.write(K),C.document.close(),setTimeout(()=>C.print(),400)},k=()=>{let C=`\uFEFFCategora;Descripcin;Unidad;Cantidad;Valor unitario;Subtotal
`;$r.forEach(oe=>{b.filter(te=>te.categoria===oe.id).forEach(te=>{C+=`${oe.label};${te.desc};${te.unidad};${te.cant};${te.valorUnit};${x(te)}
`})}),C+=`;;;;;;TOTAL;${p}
;;;;;;% GG;${(g*100).toFixed(2)}%
`;const D=new Blob([C],{type:"text/csv;charset=utf-8"}),K=document.createElement("a");K.href=URL.createObjectURL(D),K.download=`GG_${t.codigoOferta||"proyecto"}.csv`,K.click()},T={border:`1px solid ${E.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:E.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Gastos generales de obra"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Costos indirectos distribuibles"})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[e.jsxs("button",{onClick:f,style:{padding:"6px 12px",border:`1px solid ${E.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:E.inkMid},children:[" Auto ",s," meses"]}),e.jsx("button",{onClick:A,style:{padding:"6px 12px",border:`1px solid ${E.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:E.inkMid},children:"  Organigrama"}),e.jsx("button",{onClick:k,style:{padding:"6px 12px",border:`1px solid ${E.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:E.inkMid},children:" CSV"}),e.jsxs("button",{onClick:z,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(At,{size:11})," Vista PDF"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:16},children:[[["Costo directo",r(c),E.ink],["Total GG",r(p),"#111111"],["% GG / CD",(g*100).toFixed(2)+"%","#3B3B3B"],["GG por actividad",r(l>0?p/l:0),"#8C6A00"]].map(([C,D,K])=>e.jsxs(Ke,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:C}),e.jsx("div",{style:{fontSize:18,fontWeight:800,color:K,fontFamily:"'DM Mono',monospace",marginTop:2},children:D})]},C)),e.jsxs(Ke,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Duracin GG"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,marginTop:2},children:[e.jsx("input",{type:"number",min:1,max:120,value:s,onChange:C=>i("ggMeses",Math.max(1,parseInt(C.target.value)||1)),style:{width:50,fontSize:18,fontWeight:800,color:E.ink,fontFamily:"'DM Mono',monospace",textAlign:"center",border:"none",borderBottom:`2px solid ${E.border}`,background:"transparent",outline:"none"}}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#888"},children:"meses"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,marginTop:5,fontSize:8,color:E.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:!!t.ggMesCierre,onChange:C=>{const D=C.target.checked;i("ggMesCierre",D),i("ggMeses",D?s+1:Math.max(1,s-1))},style:{width:12,height:12,accentColor:"#111111"}}),"+1 mes cierre admin."]}),h&&e.jsxs("div",{style:{marginTop:6,background:"#FFF8E6",border:"1px solid #E6D44D55",borderRadius:4,padding:"5px 8px"},children:[e.jsxs("div",{style:{fontSize:8,color:"#8C6A00",fontWeight:600,marginBottom:3},children:[" Cronograma da ",d," meses, tienes ",s]}),e.jsxs("div",{style:{display:"flex",gap:3},children:[e.jsxs("button",{onClick:()=>y(!1),style:{flex:1,padding:"3px 4px",fontSize:7,fontWeight:700,cursor:"pointer",border:"1px solid #3B3B3B44",borderRadius:3,background:"#F0F0F0",color:"#3B3B3B",fontFamily:"'DM Sans',sans-serif"},children:["Usar ",d,"m"]}),e.jsxs("button",{onClick:()=>y(!0),style:{flex:1,padding:"3px 4px",fontSize:7,fontWeight:700,cursor:"pointer",border:"1px solid #11111144",borderRadius:3,background:"#E8F4EE",color:"#111111",fontFamily:"'DM Sans',sans-serif"},children:[d,"m + 1 cierre"]})]})]}),d>0&&!h&&e.jsx("div",{style:{fontSize:7,color:"#111111",marginTop:4},children:" Sincronizado con cronograma"})]})]}),e.jsx(Ke,{style:{padding:"12px 16px",marginBottom:14},children:e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"flex-start",flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:"0 0 260px"},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Criterio de distribucin"}),e.jsx("div",{style:{display:"flex",gap:0},children:[{id:"costo",lbl:" Prop. al CD",desc:"Segn costo directo de cada actividad"},{id:"duracion",lbl:" Prop. duracin",desc:"Segn das de duracin"},{id:"mo",lbl:" Prop. a M.O.",desc:"Segn mano de obra"}].map((C,D)=>e.jsx("button",{onClick:()=>i("ggCriterio",C.id),style:{flex:1,padding:"5px 4px",fontSize:9,cursor:"pointer",fontWeight:600,border:`1px solid ${E.border}`,fontFamily:"'DM Sans',sans-serif",borderRadius:D===0?"4px 0 0 4px":D===2?"0 4px 4px 0":"0",borderLeft:D>0?"none":void 0,background:v===C.id?"#F0F0F0":"#fff",color:v===C.id?"#3B3B3B":E.inkMid},children:C.lbl},C.id))}),e.jsx("div",{style:{fontSize:9,color:"#888",marginTop:4},children:v==="costo"?"Cada actividad recibe GG proporcional a su costo directo":v==="duracion"?"Cada actividad recibe GG proporcional a su duracin en das":"Cada actividad recibe GG proporcional a su componente de mano de obra"})]}),e.jsxs("div",{style:{flex:1,background:"#F0F0F0",borderRadius:4,padding:"8px 12px"},children:[e.jsxs("div",{style:{fontSize:11,color:"#3B3B3B"},children:[" Estos gastos se ",e.jsx("strong",{children:"distribuyen en cada actividad"})," como coeficiente indirecto.",t.modoCalcObra==="aiu"?` En AIU  entra como A (Administracin) = ${(g*100).toFixed(2)}%. Se multiplica: CD  (1 + ${(g*100).toFixed(1)}% + I + U).`:` En modo margen  GG = ${(g*100).toFixed(2)}% entra en el denominador: PVP = CD / (1  M  GC  GG)  (1  GF).`]}),e.jsx("div",{style:{fontSize:10,color:"#3B3B3B",marginTop:4,fontWeight:600},children:"No visible en presupuesto de venta salvo que se solicite la estructura de costos."})]})]})}),$r.map(C=>{const D=b.filter(oe=>oe.categoria===C.id),K=D.reduce((oe,te)=>oe+x(te),0);return e.jsxs(Ke,{style:{padding:0,marginBottom:12,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"8px 14px",background:"#F5F4F1",borderBottom:`1px solid ${E.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:E.ink},children:C.label}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:K>0?"#111111":"#CCC"},children:[r(K)," ",a]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"left",width:"40%"},children:"Descripcin"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"center",width:70},children:"Unidad"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"right",width:120},children:"Valor unit."}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"right",width:120},children:"Subtotal"}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:D.map(oe=>e.jsxs("tr",{style:{borderBottom:`1px solid ${E.border}`},children:[e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{value:oe.desc,onChange:te=>w(oe.id,"desc",te.target.value),style:{...T,width:"100%"},placeholder:"Descripcin del gasto"})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:e.jsx("select",{value:oe.unidad,onChange:te=>w(oe.id,"unidad",te.target.value),style:{...T,textAlign:"center"},children:["mes","gl","ud","ml","m","jgo","da"].map(te=>e.jsx("option",{children:te},te))})}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{type:"number",min:"0",step:"0.1",value:oe.cant||0,onChange:te=>w(oe.id,"cant",parseFloat(te.target.value)||0),style:{...T,width:"100%",textAlign:"center",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{type:"number",min:"0",value:oe.valorUnit||0,onChange:te=>w(oe.id,"valorUnit",parseFloat(te.target.value)||0),style:{...T,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:x(oe)>0?"#111111":"#CCC"},children:r(x(oe))}),e.jsx("td",{style:{padding:"4px 4px"},children:e.jsx("button",{onClick:()=>S(oe.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx(qe,{size:10})})})]},oe.id))})]}),e.jsx("div",{style:{padding:"4px 8px"},children:e.jsx("button",{onClick:()=>m(C.id),style:{width:"100%",padding:"4px 8px",fontSize:10,cursor:"pointer",border:`1px dashed ${E.border}`,borderRadius:3,background:"#fff",color:E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir tem"})})]},C.id)}),e.jsx(Ke,{style:{padding:"14px 18px",background:"#E8F4EE",border:"1px solid #B8DEC9"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#111111",textTransform:"uppercase",letterSpacing:.5},children:"Total gastos generales"}),e.jsxs("div",{style:{fontSize:10,color:"#111111",marginTop:2},children:["Incidencia: ",e.jsxs("strong",{children:[(g*100).toFixed(2),"%"]})," sobre costo directo ",t.modoCalcObra==="aiu"?` AIU  A = ${(g*100).toFixed(2)}%`:` Coeficiente GG = ${(g*100).toFixed(2)}%`]})]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:22,fontWeight:800,color:"#111111"},children:[r(p)," ",e.jsx("span",{style:{fontSize:11,fontWeight:600},children:a})]})]})}),(()=>{const C=(t.borradorLineas||[]).filter(P=>!P.esCapitulo&&(P.precioCD||0)>0);if(C.length===0||p===0)return null;const D=C.reduce((P,ie)=>P+(ie.precioCD||0),0),K=C.reduce((P,ie)=>P+(ie.duracion||ie.cantidad||1),0),oe=C.reduce((P,ie)=>{const me=ie.apuData;if(!me)return P;const Q=(me.equiposUsados||[]).reduce((je,re)=>je+(re.cuadrilla||[]).reduce((J,M)=>J+(M.cant||0)*(M.jornal||0)*(M.rendimiento||1),0),0)+(me.moDirecta||[]).reduce((je,re)=>je+(re.cant||0)*(re.jornal||0)*(re.rendimiento||1),0);return P+Q},0),te=P=>{if(v==="duracion")return K>0?(P.duracion||P.cantidad||1)/K:0;if(v==="mo"){const ie=P.apuData;if(!ie||oe===0)return D>0?(P.precioCD||0)/D:0;const me=(ie.equiposUsados||[]).reduce((Q,je)=>Q+(je.cuadrilla||[]).reduce((re,J)=>re+(J.cant||0)*(J.jornal||0)*(J.rendimiento||1),0),0)+(ie.moDirecta||[]).reduce((Q,je)=>Q+(je.cant||0)*(je.jornal||0)*(je.rendimiento||1),0);return oe>0?me/oe:0}return D>0?(P.precioCD||0)/D:0};return e.jsxs(Ke,{style:{padding:0,marginTop:12,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"8px 14px",background:"#F5F4F1",borderBottom:`1px solid ${E.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:700},children:[" Distribucin por actividad",e.jsxs("span",{style:{fontSize:9,fontWeight:400,color:"#888",marginLeft:8},children:["Criterio: ",v==="costo"?"proporcional al CD":v==="duracion"?"proporcional a duracin":"proporcional a M.O."]})]}),e.jsxs("div",{style:{fontSize:10,color:"#888"},children:[C.length," actividades"]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left"},children:"Actividad"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"CD"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"Peso %"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"GG asignado"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"CD + GG"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"Incid. GG"})]})}),e.jsxs("tbody",{children:[C.slice(0,20).map((P,ie)=>{const me=te(P),Q=p*me,je=(P.precioCD||0)+Q;return e.jsxs("tr",{style:{borderBottom:`1px solid ${E.border}`},children:[e.jsx("td",{style:{padding:"3px 8px",fontSize:10,maxWidth:250,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:P.descripcion||P.partida||"Lnea "+(ie+1)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:r(P.precioCD||0)}),e.jsxs("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:[(me*100).toFixed(1),"%"]}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:r(Q)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:r(je)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right"},children:e.jsx("div",{style:{background:"#F0F0F0",borderRadius:10,height:6,overflow:"hidden"},children:e.jsx("div",{style:{background:"#3B3B3B",height:"100%",width:`${Math.min(me*100*3,100)}%`,borderRadius:10}})})})]},P.id||ie)}),C.length>20&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,style:{padding:"4px 8px",fontSize:9,color:"#888",textAlign:"center"},children:["... y ",C.length-20," actividades ms"]})})]})]})})]})})()]})}function Wh({d:t,set:i,r:o}){var W,se,le,de,Z,ue;const n=t.pais||"CO",a=n==="CO"?"COP":"EUR",r=N=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(N||0),s=t.modoCobro||"avance_anticipo",d=t.fuenteAvance||"cronograma",u=t.fluPctAnticipo??.3,b=t.fluMesPrimerCobro??1,j=t.condDiasPago||30,w=t.condDiasCobro||30,m=(()=>{const N=(t.cronogramaActivos||[]).filter(G=>!G.esCapitulo&&G.duracion>0);if(N.length>0){const G=t.fechaInicio?new Date(t.fechaInicio):new Date;let L=G.getTime();return N.forEach(ae=>{const he=new Date(ae.inicio||G).getTime()+(ae.duracion||1)*864e5;he>L&&(L=he)}),Math.max(1,Math.ceil((L-G.getTime())/(30*864e5)))}if(t.fechaInicio&&t.fechaEntrega){const G=new Date(t.fechaEntrega)-new Date(t.fechaInicio);return Math.max(1,Math.ceil(G/(30*864e5)))}return t.ggMeses||6})(),x=Math.ceil(w/30),p=Math.ceil(j/30),c=(()=>{if(s==="hitos"){const N=Math.max(0,...(t.flujoCobros||[]).map(G=>G.mes||0));return Math.max(12,N+x+2)}return Math.max(12,m+Math.max(x,p)+2)})(),[g,l]=F.useState(()=>t.flujoCobros||[{id:Ct(),nombre:"Anticipo / Firma",pct:.3,mes:0},{id:Ct(),nombre:"Avance 50%",pct:.3,mes:2},{id:Ct(),nombre:"Entrega final",pct:.3,mes:4},{id:Ct(),nombre:"Retencin final",pct:.1,mes:5}]);F.useEffect(()=>{i("flujoCobros",g)},[g]);const f=(N,G,L)=>l(ae=>ae.map(pe=>pe.id===N?{...pe,[G]:L}:pe)),y=()=>l(N=>[...N,{id:Ct(),nombre:"Nuevo hito",pct:0,mes:0}]),h=N=>l(G=>G.filter(L=>L.id!==N)),v=g.reduce((N,G)=>N+(G.pct||0),0),[A,z]=F.useState(()=>t.fluAvanceManual||Array.from({length:12},()=>0));F.useEffect(()=>{i("fluAvanceManual",A)},[A]);const k=(N,G)=>z(L=>L.map((ae,pe)=>pe===N?G:ae)),T=A.reduce((N,G)=>N+G,0),D=d==="manual"?A:(()=>{const N=(t.cronogramaActivos||[]).filter(pe=>!pe.esCapitulo&&(pe.precioVenta||pe.precioCD)>0),G=N.reduce((pe,he)=>pe+(he.precioVenta||he.precioCD||0),0);if(G===0)return Array.from({length:c},()=>0);const L=t.fechaInicio?new Date(t.fechaInicio):new Date,ae=Array.from({length:c},()=>0);return N.forEach(pe=>{const he=new Date(pe.inicio||L),ze=Math.max(0,Math.round((he-L)/(30*864e5))),q=Math.max(1,Math.ceil((pe.duracion||30)/30)),I=(pe.precioVenta||pe.precioCD||0)/G;for(let $=ze;$<ze+q&&$<c;$++)ae[$]+=I/q}),ae})(),K=o.PVP||0,oe=o.IVA||0,te=K+oe,P=o.COSTO||0,ie=o.ret||0,me=n==="CO"?{reteFuente:{pct:t.pctReteFuente||0},reteICA:{pct:t.pctReteICA||0},reteIVA:{pct:t.pctReteIVA||0},iva:{pct:t.tarifaIVA||.19}}:{iva:{pct:t.tarifaIVA||.21}},Q=n==="CO"?(((W=me.reteFuente)==null?void 0:W.pct)||0)+(((se=me.reteICA)==null?void 0:se.pct)||0)+(((le=me.reteIVA)==null?void 0:le.pct)||0):0,je=(t.cronogramaActivos||[]).filter(N=>!N.esCapitulo&&N.precioCD>0),re=N=>{if(je.length>0){const G=t.fechaInicio?new Date(t.fechaInicio):new Date;let L=0;return je.forEach(ae=>{const pe=new Date(ae.inicio||G),he=Math.max(0,Math.round((pe-G)/(30*864e5))),ze=Math.max(1,Math.ceil((ae.duracion||30)/30));N>=he&&N<he+ze&&(L+=(ae.precioCD||0)/ze)}),L}return N>=0&&N<m?P/Math.max(1,m):0},J=Array.from({length:c},(N,G)=>G);let M=0;const B=J.map(N=>{var $,H;let G=0,L=0,ae=0;if(s==="hitos")G=g.filter(U=>U.mes===N).reduce((U,_)=>U+(_.pct||0)*K,0);else{const U=s==="avance_anticipo";if(U&&N===0)L=u*K,G=L;else if(N>=b){const _=D[N-b]||0,ce=_*K;U?(ae=_*u*K,G=ce-ae):G=ce}}const pe=G>0?t.tipoProyecto==="OBRA"?(o.U||t.margen||0)*G*((($=me.iva)==null?void 0:$.pct)||0):G*(((H=me.iva)==null?void 0:H.pct)||0):0,he=G>0&&n==="CO"?G*Q:0,ze=G+pe-he,q=re(N),I=ze-q;return M+=I,{m:N,cobro:G,anticipoM:L,amortM:ae,ivaM:pe,retM:he,ingNeto:ze,cos:q,neto:I,acum:M,avPct:s!=="hitos"&&N>=b&&D[N-b]||0}}),V=()=>{const N=window.open("","_blank"),G=B.reduce((I,$)=>I+$.cobro,0),L=B.reduce((I,$)=>I+$.ivaM,0),ae=B.reduce((I,$)=>I+$.retM,0),pe=B.reduce((I,$)=>I+$.cos,0),he=B.length>0?B[B.length-1].acum:0,ze="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:10mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:8px;padding:16px}.header{display:flex;justify-content:space-between;margin-bottom:10px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:11px;margin:10px 0 4px}.kpis{display:flex;gap:14px;margin-bottom:8px;font-size:8px;color:#555}.kpi strong{color:#111}table{width:100%;border-collapse:collapse}th{background:#F5F4F1;padding:2px 4px;font-size:6px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:right;border-bottom:1px solid #E0E0E0}th:first-child{text-align:left}td{padding:2px 4px;font-size:7px;text-align:right;border-bottom:1px solid #F5F5F5}td:first-child{text-align:left;font-weight:600;background:#FFFFFF}td.section{background:#E8E6E1;font-weight:700;font-size:6px;text-transform:uppercase;letter-spacing:.4px;text-align:left;padding:3px 4px}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.red{color:#B91C1C}.bold{font-weight:700}.footer{margin-top:8px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:6px;color:#888}";let q=`<html><head><title>Flujo de caja - ${t.codigoOferta||""}</title><style>${ze}</style></head><body>`;q+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',q+='<div style="text-align:right"><div style="font-size:12px;font-weight:700">Flujo de Caja Proyectado</div>',q+=`<div style="font-size:7px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,q+=`<div class="kpis"><div class="kpi">PVP: <strong class="mono">${r(K)}</strong></div>`,q+=`<div class="kpi">Costo: <strong class="mono">${r(P)}</strong></div>`,q+=`<div class="kpi">Duracin: <strong>${m} meses</strong></div>`,q+=`<div class="kpi">Modo: <strong>${s==="hitos"?"Hitos":s==="avance"?"Avance s/anticipo":"Avance c/anticipo"}</strong></div>`,q+=`${s!=="hitos"?`<div class="kpi">Anticipo: <strong>${(u*100).toFixed(0)}%</strong></div>`:""}</div>`,q+="<table><thead><tr><th>Concepto</th>",B.forEach(I=>{q+=`<th>${I.m===0?"M0":I.m+""}</th>`}),q+='<th style="background:#E6F4EC;color:#111111">Total</th></tr></thead><tbody>',s!=="hitos"&&(q+=`<tr><td class="section" colspan="${B.length+2}">AVANCE</td></tr>`,q+="<tr><td>% Avance</td>",B.forEach(I=>{q+=`<td class="mono">${I.avPct>0?(I.avPct*100).toFixed(1)+"%":""}</td>`}),q+=`<td class="mono bold">${(B.reduce((I,$)=>I+$.avPct,0)*100).toFixed(1)}%</td></tr>`),q+=`<tr><td class="section" colspan="${B.length+2}">COBROS</td></tr>`,q+="<tr><td>Cobros</td>",B.forEach(I=>{q+=`<td class="mono ${I.cobro>0?"green":""}">${I.cobro?r(I.cobro):""}</td>`}),q+=`<td class="mono green bold">${r(G)}</td></tr>`,s==="avance_anticipo"&&(q+="<tr><td> Anticipo</td>",B.forEach(I=>{q+=`<td class="mono">${I.anticipoM?r(I.anticipoM):""}</td>`}),q+=`<td class="mono">${r(B.reduce((I,$)=>I+$.anticipoM,0))}</td></tr>`,q+="<tr><td> Amortizacin</td>",B.forEach(I=>{q+=`<td class="mono">${I.amortM?r(I.amortM):""}</td>`}),q+=`<td class="mono">${r(B.reduce((I,$)=>I+$.amortM,0))}</td></tr>`),q+=`<tr><td class="section" colspan="${B.length+2}">IVA</td></tr>`,q+="<tr><td>IVA facturado</td>",B.forEach(I=>{q+=`<td class="mono">${I.ivaM?r(I.ivaM):""}</td>`}),q+=`<td class="mono">${r(L)}</td></tr>`,n==="CO"&&(q+=`<tr><td class="section" colspan="${B.length+2}">RETENCIONES</td></tr>`,q+="<tr><td>Total retenciones</td>",B.forEach(I=>{q+=`<td class="mono red">${I.retM?r(I.retM):""}</td>`}),q+=`<td class="mono red bold">${r(ae)}</td></tr>`),q+=`<tr><td class="section" colspan="${B.length+2}">COSTOS</td></tr>`,q+="<tr><td>Costos directos</td>",B.forEach(I=>{q+=`<td class="mono red">${I.cos?r(I.cos):""}</td>`}),q+=`<td class="mono red bold">${r(pe)}</td></tr>`,q+=`<tr><td class="section" colspan="${B.length+2}">RESULTADO</td></tr>`,q+='<tr style="background:#F0F7FF"><td style="background:#F0F7FF" class="bold">Caja mensual</td>',B.forEach(I=>{q+=`<td class="mono bold ${I.neto>=0?"green":"red"}">${r(I.neto)}</td>`}),q+="<td></td></tr>",q+='<tr style="background:#E6F4EC"><td style="background:#E6F4EC" class="bold">Caja acumulada</td>',B.forEach(I=>{q+=`<td class="mono bold ${I.acum>=0?"green":"red"}">${r(I.acum)}</td>`}),q+=`<td class="mono bold ${he>=0?"green":"red"}">${r(he)}</td></tr>`,q+="</tbody></table>",q+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Flujo de caja</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,q+="</body></html>",N.document.write(q),N.document.close(),setTimeout(()=>N.print(),400)},X={border:`1px solid ${E.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:E.bg},R=[{id:"hitos",lbl:"Hitos de pago",desc:"Pagos en fechas especficas"},{id:"avance",lbl:"Avance s/ anticipo",desc:"Certificacin mensual por avance"},{id:"avance_anticipo",lbl:"Avance c/ anticipo",desc:"Anticipo + certificacin - amortizacin"}];return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:E.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Flujo de caja proyectado"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[m," meses  ",r(K)," PVP  ",r(P)," costo"]})]}),e.jsxs("button",{onClick:V,style:{padding:"7px 16px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:6},children:[e.jsx(At,{size:12})," Vista PDF"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[e.jsxs(Ke,{style:{padding:18},children:[e.jsx(vt,{t:"Configuracin de cobros",s:"Selecciona modalidad de facturacin"}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:R.map((N,G)=>e.jsx("button",{onClick:()=>i("modoCobro",N.id),style:{flex:1,padding:"8px 6px",fontSize:10,cursor:"pointer",fontWeight:600,border:`1px solid ${E.ink}`,fontFamily:"'DM Sans',sans-serif",borderRadius:G===0?"5px 0 0 5px":G===2?"0 5px 5px 0":"0",borderLeft:G>0?"none":void 0,background:s===N.id?E.ink:"#fff",color:s===N.id?"#fff":E.inkMid},children:N.lbl},N.id))}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:12},children:[e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Duracin"}),e.jsxs("div",{style:{fontSize:15,fontWeight:700},children:[m," meses"]}),e.jsxs("div",{style:{fontSize:8,color:"#888"},children:[" ",(t.cronogramaActivos||[]).length>0?"cronograma":"estimado"]})]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Primer mes cobro"}),e.jsx("input",{type:"number",value:b,min:0,max:12,onChange:N=>i("fluMesPrimerCobro",+N.target.value),style:{...X,width:"100%",fontSize:14,fontWeight:700,textAlign:"center",padding:"2px 6px"}})]}),s==="avance_anticipo"&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#8C6A00",textTransform:"uppercase"},children:"% Anticipo"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"number",value:(u*100).toFixed(0),min:0,max:100,onChange:N=>i("fluPctAnticipo",+N.target.value/100),style:{...X,width:50,fontSize:14,fontWeight:700,textAlign:"center",padding:"2px 6px"}}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#8C6A00"},children:"%"})]}),e.jsxs("div",{style:{fontSize:8,color:"#8C6A00"},children:[r(u*K)," ",a]})]}),s==="hitos"&&e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Meses mostrados"}),e.jsx("div",{style:{fontSize:15,fontWeight:700},children:c})]})]}),s==="hitos"&&e.jsxs(e.Fragment,{children:[g.map(N=>e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:6},children:[e.jsx("input",{style:{...X,flex:2,minWidth:0},value:N.nombre,onChange:G=>f(N.id,"nombre",G.target.value),placeholder:"Descripcin"}),e.jsxs("div",{style:{position:"relative",flex:"0 0 60px"},children:[e.jsx("input",{type:"number",style:{...X,width:"100%",paddingRight:16},value:(N.pct*100).toFixed(0),min:0,max:100,onChange:G=>f(N.id,"pct",+G.target.value/100)}),e.jsx("span",{style:{position:"absolute",right:6,top:"50%",transform:"translateY(-50%)",fontSize:10,color:E.inkLight},children:"%"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flex:"0 0 65px"},children:[e.jsx("span",{style:{fontSize:10,color:E.inkLight},children:"Mes"}),e.jsx("input",{type:"number",style:{...X,width:36},value:N.mes,min:0,onChange:G=>f(N.id,"mes",+G.target.value)})]}),e.jsx("button",{onClick:()=>h(N.id),style:{background:"none",border:"none",cursor:"pointer",color:E.danger,padding:4},children:e.jsx(qe,{size:12})})]},N.id)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:6},children:[e.jsxs(ht,{sm:!0,v:"ghost",on:y,children:[e.jsx(Pe,{size:11})," Aadir hito"]}),e.jsxs("span",{style:{fontSize:11,color:Math.abs(v-1)<.001?E.success:E.warning},children:["Total: ",(v*100).toFixed(0),"% ",Math.abs(v-1)>=.001?"":""]})]})]}),s!=="hitos"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",gap:0,marginBottom:10},children:[{id:"cronograma",lbl:" Desde cronograma"},{id:"manual",lbl:" Manual"}].map((N,G)=>e.jsx("button",{onClick:()=>i("fuenteAvance",N.id),style:{flex:1,padding:"6px 10px",fontSize:10,cursor:"pointer",fontWeight:600,border:`1px solid ${E.border}`,fontFamily:"'DM Sans',sans-serif",borderRadius:G===0?"4px 0 0 4px":"0 4px 4px 0",borderLeft:G>0?"none":void 0,background:d===N.id?"#F0F0F0":"#fff",color:d===N.id?"#3B3B3B":E.inkMid},children:N.lbl},N.id))}),d==="cronograma"?e.jsxs("div",{style:{background:"#E6F4EC",borderRadius:4,padding:"8px 10px",fontSize:11,color:"#111111"},children:[" Avance calculado desde ",e.jsxs("strong",{children:[(t.cronogramaActivos||[]).filter(N=>!N.esCapitulo).length," actividades"]})," del cronograma. El % de avance mensual se distribuye proporcionalmente al valor de cada actividad."]}):e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:E.inkLight,marginBottom:6},children:"Ingresa % de avance por mes (debe sumar 100%). Mes 1 = primer mes de ejecucin."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:4},children:Array.from({length:Math.max(m,6)},(N,G)=>G).map(N=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:8,color:"#888",fontWeight:700},children:["Mes ",N+1]}),e.jsx("input",{type:"number",min:0,max:100,value:((A[N]||0)*100).toFixed(0),onChange:G=>k(N,+G.target.value/100),style:{...X,width:"100%",textAlign:"center",fontSize:12,fontWeight:600,padding:"3px 2px"}})]},N))}),e.jsxs("div",{style:{textAlign:"right",fontSize:11,marginTop:4,color:Math.abs(T-1)<.01?E.success:E.warning},children:["Total: ",(T*100).toFixed(0),"% ",Math.abs(T-1)>=.01?"":""]})]}),s==="avance_anticipo"&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"8px 10px",fontSize:10,color:"#8C6A00",marginTop:8},children:[e.jsx("strong",{children:"Anticipo amortizable:"})," Mes 0  prefactura ",(u*100).toFixed(0),"% (",r(u*K),"). Desde mes ",b,"  certificacin por avance  amortizacin proporcional del anticipo."]}),s==="avance"&&e.jsxs("div",{style:{background:"#F0F0F0",borderRadius:4,padding:"8px 10px",fontSize:10,color:"#3B3B3B",marginTop:8},children:[e.jsx("strong",{children:"Sin anticipo:"})," Desde mes ",b,"  certificacin directa por % de avance ejecutado."]})]})]}),e.jsxs(Ke,{style:{padding:18},children:[e.jsx(vt,{t:"Resumen proyectado",s:"Flujo neto con IVA y retenciones"}),[["PVP sin IVA",r(K),E.ink],["+ IVA facturado",r(oe),E.info],["PVP con IVA",r(te),E.ink],...n==="CO"?[[" ReteFuente",r(K*(((de=me.reteFuente)==null?void 0:de.pct)||0)),E.warning],[" ReteICA",r(K*(((Z=me.reteICA)==null?void 0:Z.pct)||0)),E.warning],[" ReteIVA",r(K*(((ue=me.reteIVA)==null?void 0:ue.pct)||0)),E.warning]]:[],["Total retenciones",r(ie),E.danger],["Costo total",r(P),E.warning],["Neto a recibir",r(te-ie),E.success]].map(([N,G,L])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:`1px solid ${E.border}`,fontSize:12},children:[e.jsx("span",{style:{color:E.inkMid},children:N}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:L},children:G})]},N))]})]}),e.jsxs(Ke,{style:{padding:0,overflow:"auto"},children:[e.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${E.border}`},children:e.jsx(vt,{t:"Proyeccin mes a mes",s:`${s==="hitos"?"Hitos":s==="avance"?"Avance":"Avance + anticipo"}  ${d==="manual"?"Manual":"Cronograma"}  ${c} meses`})}),e.jsx("div",{style:{overflowX:"auto"},children:(()=>{const N=B,G={padding:"5px 6px",fontSize:8,fontWeight:700,color:"#666",textTransform:"uppercase",letterSpacing:.3,borderBottom:"2px solid #CCC",textAlign:"right",whiteSpace:"nowrap"},L={padding:"4px 8px",fontSize:10,fontWeight:600,color:"#333",whiteSpace:"nowrap",borderRight:"1px solid #E0E0E0",background:"#F5F4F1",position:"sticky",left:0,zIndex:1,minWidth:160},ae=(U,_)=>({padding:"4px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",textAlign:"right",color:U===0||U===void 0?"#CCC":_||"#333",whiteSpace:"nowrap"}),pe=U=>U===0?"":new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(U),he=(U,_)=>e.jsxs("tr",{style:{background:_||"#E8E6E1"},children:[e.jsx("td",{style:{...L,background:_||"#E8E6E1",fontWeight:700,fontSize:9,textTransform:"uppercase",letterSpacing:.5},children:U}),N.map(ce=>e.jsx("td",{style:{padding:"3px",borderBottom:"1px solid #DDD"}},ce.m)),e.jsx("td",{style:{padding:"3px",borderBottom:"1px solid #DDD"}})]},U),ze=N.reduce((U,_)=>U+_.cobro,0),q=N.reduce((U,_)=>U+_.ivaM,0),I=N.reduce((U,_)=>U+_.retM,0),$=N.reduce((U,_)=>U+_.cos,0),H=N.length>0?N[N.length-1].acum:0;return e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:N.length*72+170},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...G,textAlign:"left",position:"sticky",left:0,background:"#F5F4F1",zIndex:2,minWidth:160},children:"CONCEPTO"}),N.map(U=>e.jsx("th",{style:G,children:U.m===0?"MES 0":U.m+""},U.m)),e.jsx("th",{style:{...G,background:"#E8F4EE",color:"#111111"},children:"TOTAL"})]})}),e.jsxs("tbody",{children:[s!=="hitos"&&e.jsxs(e.Fragment,{children:[he("% AVANCE","#F0F0F0"),e.jsxs("tr",{children:[e.jsx("td",{style:L,children:"% Avance ejecutado"}),N.map(U=>e.jsx("td",{style:ae(U.avPct,"#3B3B3B"),children:U.avPct>0?(U.avPct*100).toFixed(1)+"%":""},U.m)),e.jsx("td",{style:ae(1,"#3B3B3B"),children:e.jsxs("strong",{children:[(N.reduce((U,_)=>U+_.avPct,0)*100).toFixed(1),"%"]})})]})]}),he("COBROS","#D4EDDA"),e.jsxs("tr",{children:[e.jsx("td",{style:L,children:s==="hitos"?"Cobros hitos":"Cobro neto"}),N.map(U=>e.jsx("td",{style:ae(U.cobro,"#111111"),children:pe(U.cobro)},U.m)),e.jsx("td",{style:ae(ze,"#111111"),children:e.jsx("strong",{children:pe(ze)})})]}),s==="avance_anticipo"&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsxs("td",{style:L,children:[" Anticipo (",(u*100).toFixed(0),"%)"]}),N.map(U=>e.jsx("td",{style:ae(U.anticipoM,"#8C6A00"),children:pe(U.anticipoM)},U.m)),e.jsx("td",{style:ae(N.reduce((U,_)=>U+_.anticipoM,0),"#8C6A00"),children:e.jsx("strong",{children:pe(N.reduce((U,_)=>U+_.anticipoM,0))})})]}),e.jsxs("tr",{children:[e.jsx("td",{style:L,children:" Amortizacin anticipo"}),N.map(U=>e.jsx("td",{style:ae(U.amortM,"#8C6A00"),children:pe(U.amortM)},U.m)),e.jsx("td",{style:ae(N.reduce((U,_)=>U+_.amortM,0),"#8C6A00"),children:e.jsx("strong",{children:pe(N.reduce((U,_)=>U+_.amortM,0))})})]})]}),he("IMPUESTOS","#FFF3CD"),e.jsxs("tr",{children:[e.jsx("td",{style:L,children:"IVA facturado"}),N.map(U=>e.jsx("td",{style:ae(U.ivaM,"#8C6A00"),children:pe(U.ivaM)},U.m)),e.jsx("td",{style:ae(q,"#8C6A00"),children:e.jsx("strong",{children:pe(q)})})]}),n==="CO"&&e.jsxs(e.Fragment,{children:[he("RETENCIONES","#FCE4EC"),e.jsxs("tr",{children:[e.jsx("td",{style:L,children:"Total retenciones"}),N.map(U=>e.jsx("td",{style:ae(U.retM,"#B91C1C"),children:pe(U.retM)},U.m)),e.jsx("td",{style:ae(I,"#B91C1C"),children:e.jsx("strong",{children:pe(I)})})]})]}),he("COSTOS","#F8D7DA"),e.jsxs("tr",{children:[e.jsx("td",{style:L,children:je.length>0?"Costos (cronograma)":"Costos (distribucin lineal)"}),N.map(U=>e.jsx("td",{style:ae(U.cos,"#B91C1C"),children:pe(U.cos)},U.m)),e.jsx("td",{style:ae($,"#B91C1C"),children:e.jsx("strong",{children:pe($)})})]}),he("RESULTADO","#D6E9F8"),e.jsxs("tr",{style:{background:"#F0F7FF"},children:[e.jsx("td",{style:{...L,background:"#F0F7FF",fontWeight:700},children:"Caja mensual"}),N.map(U=>e.jsx("td",{style:{...ae(U.neto,U.neto>=0?"#111111":"#B91C1C"),fontWeight:700},children:pe(U.neto)},U.m)),e.jsx("td",{style:{...ae(0),fontWeight:700}})]}),e.jsxs("tr",{style:{background:"#E6F4EC"},children:[e.jsx("td",{style:{...L,background:"#E6F4EC",fontWeight:700},children:"Caja acumulada"}),N.map(U=>e.jsx("td",{style:{...ae(U.acum,U.acum>=0?"#111111":"#B91C1C"),fontWeight:700,fontSize:11},children:pe(U.acum)},U.m)),e.jsx("td",{style:{...ae(H,H>=0?"#111111":"#B91C1C"),fontWeight:700,fontSize:11},children:e.jsx("strong",{children:pe(H)})})]})]})]})})()})]})]})}function Nh({d:t,set:i}){var ze;const o=t.pais||"CO",n=o==="CO"?"COP":"EUR",a=q=>q?new Intl.NumberFormat(o==="CO"?"es-CO":"es-ES",{maximumFractionDigits:0}).format(q):"0",[r,s]=F.useState([]),[d,u]=F.useState([]),[b,j]=F.useState([]),[w,S]=F.useState({hDia:8,diasSemana:5,semanasAnio:50,pctProductivas:75,diasFestivos:18,diasAusencias:5}),[m,x]=F.useState([]),[p,c]=F.useState(!1);F.useEffect(()=>{(async()=>{var q,I,$,H,U,_,ce,ve,Ie,Te;try{const[Oe,ct,at,xt,Ft]=await Promise.all([(I=(q=window.storage)==null?void 0:q.get)==null?void 0:I.call(q,"hab:rrhh:cargos"),(H=($=window.storage)==null?void 0:$.get)==null?void 0:H.call($,"hab:rrhh:activos"),(_=(U=window.storage)==null?void 0:U.get)==null?void 0:_.call(U,"hab:rrhh:licencias"),(ve=(ce=window.storage)==null?void 0:ce.get)==null?void 0:ve.call(ce,"hab:rrhh:jornada"),(Te=(Ie=window.storage)==null?void 0:Ie.get)==null?void 0:Te.call(Ie,"hab:logistica:items")]);Oe&&s(JSON.parse(Oe.value)||[]),ct&&u(JSON.parse(ct.value)||[]),at&&j(JSON.parse(at.value)||[]),xt&&S(JSON.parse(xt.value)),Ft&&x(JSON.parse(Ft.value)||[])}catch{}c(!0)})()},[]);const g=F.useMemo(()=>{const q=w;return(q.diasSemana*q.semanasAnio-(q.diasFestivos||18)-(q.diasAusencias||5))*q.hDia*((q.pctProductivas||75)/100)},[w]),l=q=>{const I=r.find(U=>U.id===q);if(!I||!I.salarioBruto)return 0;const $=1+((I.prestaciones||52.18)+(I.segSocial||12.5)+(I.parafiscales||9))/100,H=I.salarioBruto*$;return g>0?H/g:0},f=((ze=Eo[o])==null?void 0:ze.categorias)||[],y=r.filter(q=>q.activo!==!1).length===0,h=y?f.map(q=>({id:q.id,nombre:q.label,_fallback:!0})):r.filter(q=>q.activo!==!1),v=q=>y?ro(q,o):l(q),A=q=>{const I=h.find($=>$.id===q);return(I==null?void 0:I.nombre)||(I==null?void 0:I.label)||q},z=d.filter(q=>q.activo!==!1&&q.valorCompra>0),k=b.filter(q=>q.activo!==!1&&q.costoAnual>0),T=q=>{const I=d.find(U=>U.id===q);if(!I||!I.valorCompra)return 0;const $=I.valorCompra/(I.vidaUtilAnios||5),H=I.usoAnual||1760;return $/H},C=t.ofertaEquipos||[],D=q=>i("ofertaEquipos",typeof q=="function"?q(C):q),[K,oe]=F.useState(null),te=q=>{var $;const I={id:Ct(),nombre:q?q.nombre:"Nuevo equipo",cargos:((q==null?void 0:q.cargos)||[{cargoId:(($=h[0])==null?void 0:$.id)||"",cantidad:1}]).map(H=>({...H,id:Ct()})),activosUsados:(q==null?void 0:q.activosUsados)||[],licenciasUsadas:(q==null?void 0:q.licenciasUsadas)||[],rendimiento:(q==null?void 0:q.rendimiento)||.1,notas:""};D([...C,I]),oe(I.id)},P=q=>{D(C.filter(I=>I.id!==q)),K===q&&oe(null)},ie=(q,I,$)=>D(C.map(H=>H.id===q?{...H,[I]:$}:H)),me=q=>D(C.map(I=>{var $;return I.id===q?{...I,cargos:[...I.cargos,{id:Ct(),cargoId:(($=h[0])==null?void 0:$.id)||"",cantidad:1}]}:I})),Q=(q,I)=>D(C.map($=>$.id===q?{...$,cargos:$.cargos.filter(H=>H.id!==I)}:$)),je=(q,I,$,H)=>D(C.map(U=>U.id===q?{...U,cargos:U.cargos.map(_=>_.id===I?{..._,[$]:H}:_)}:U)),re=q=>D(C.map(I=>I.id===q?{...I,activosUsados:[...I.activosUsados||[],{id:Ct(),activoId:"",cantidad:1}]}:I)),J=(q,I)=>D(C.map($=>$.id===q?{...$,activosUsados:($.activosUsados||[]).filter(H=>H.id!==I)}:$)),M=(q,I,$,H)=>D(C.map(U=>U.id===q?{...U,activosUsados:(U.activosUsados||[]).map(_=>_.id===I?{..._,[$]:H}:_)}:U)),B=q=>D(C.map(I=>I.id===q?{...I,licenciasUsadas:[...I.licenciasUsadas||[],{id:Ct(),licId:"",cantidad:1}]}:I)),V=(q,I)=>D(C.map($=>$.id===q?{...$,licenciasUsadas:($.licenciasUsadas||[]).filter(H=>H.id!==I)}:$)),X=(q,I,$,H)=>D(C.map(U=>U.id===q?{...U,licenciasUsadas:(U.licenciasUsadas||[]).map(_=>_.id===I?{..._,[$]:H}:_)}:U)),R=q=>D(C.map(I=>I.id===q?{...I,logItemsUsados:[...I.logItemsUsados||[],{id:Ct(),itemId:"",cantidad:1}]}:I)),W=(q,I)=>D(C.map($=>$.id===q?{...$,logItemsUsados:($.logItemsUsados||[]).filter(H=>H.id!==I)}:$)),se=(q,I,$,H)=>D(C.map(U=>U.id===q?{...U,logItemsUsados:(U.logItemsUsados||[]).map(_=>_.id===I?{..._,[$]:H}:_)}:U)),le=m.filter(q=>q.familia==="epp"||q.familia==="dotacion"),de=m.filter(q=>q.familia==="herr_menor"||q.familia==="herr_mayor"||q.familia==="consumible"),Z=m.filter(q=>q.familia==="equipo_obra"||q.familia==="equipo_medic"||q.familia==="equipo_computo"),ue=[...le,...de,...Z],N={epp:"",dotacion:"",herr_menor:"",herr_mayor:"",equipo_obra:"",equipo_medic:"",equipo_computo:"",consumible:"",seguridad:"",transporte:""},G=q=>{const I=m.find(U=>U.id===q);if(!I||!I.precio)return 0;const H=(I.vidaUtil||12)*(g||1760)/12;return I.precio/H},L=q=>{const I=q.cargos.map($=>$.cargoId);return m.filter($=>($.familia==="epp"||$.familia==="dotacion")&&$.asociadoACargo&&($.cargosAsociados||[]).some(H=>I.includes(H)))},ae=q=>{const I=q.cargos.reduce((Ie,Te)=>Ie+v(Te.cargoId)*(Te.cantidad||1),0),$=(q.activosUsados||[]).reduce((Ie,Te)=>Ie+T(Te.activoId)*(Te.cantidad||1),0),H=(q.licenciasUsadas||[]).reduce((Ie,Te)=>{const Oe=b.find(ct=>ct.id===Te.licId);return Oe?Ie+(Oe.costoAnual||0)/(g||1760)*(Te.cantidad||1):Ie},0),U=(q.logItemsUsados||[]).reduce((Ie,Te)=>Ie+G(Te.itemId)*(Te.cantidad||1),0),ce=L(q).reduce((Ie,Te)=>Ie+G(Te.id),0),ve=U+ce;return{moH:I,eqH:$,licH:H,logH:ve,totalH:I+$+H+ve,totalMes:(I+$+H+ve)*((g||1760)/12)}},pe={border:`1px solid ${E.border}`,borderRadius:3,padding:"4px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},he=()=>{const q=window.open("","_blank"),I="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}.eq-card{border:1.5px solid #3B3B3B;border-radius:6px;margin-bottom:10px;overflow:hidden;page-break-inside:avoid}.eq-header{background:#F0F0F0;padding:6px 12px;border-bottom:1px solid #C4D8EE}.eq-name{font-size:12px;font-weight:700}.eq-sub{font-size:7px;color:#555;margin-top:1px}.eq-body{padding:8px 12px}.section-title{font-size:7px;font-weight:700;color:#888;text-transform:uppercase;letter-spacing:.5px;margin:6px 0 3px;padding-bottom:2px;border-bottom:1px solid #F5F5F5}table{width:100%;border-collapse:collapse}th{font-size:6px;font-weight:700;color:#888;text-transform:uppercase;text-align:left;padding:2px 4px;border-bottom:1px solid #E0E0E0}td{padding:2px 4px;font-size:8px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.bold{font-weight:700}.r{text-align:right}.blue{color:#3B3B3B}.green{color:#111111}.tag{font-size:7px;background:#FFF8E7;color:#8C6A00;padding:1px 5px;border-radius:3px;display:inline-block;margin:1px}.tag-blue{background:#F0F0F0;color:#3B3B3B}.cost-box{background:#F5F4F1;border-radius:4px;padding:6px 10px;margin-top:6px;font-size:9px}.cost-row{display:flex;justify-content:space-between;margin-bottom:2px}.cost-total{border-top:1px solid #DDD;padding-top:3px;margin-top:3px;font-weight:700}.footer{margin-top:14px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}";let $=`<html><head><title>Equipos - ${t.codigoOferta||""}</title><style>${I}</style></head><body>`;$+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',$+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Equipos de Trabajo</div>',$+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div>`,$+=`<div style="font-size:8px;color:#888;margin-top:2px">${C.length} equipos  ${h.length} cargos disponibles</div></div></div>`,C.forEach(H=>{const U=ae(H);$+=`<div class="eq-card"><div class="eq-header"><div class="eq-name">${H.nombre}</div>`,$+=`<div class="eq-sub">${H.cargos.length} cargos  Rendimiento: ${H.rendimiento} h/ud  Total: ${a(U.totalH)} ${n}/h</div></div>`,$+='<div class="eq-body">',$+='<div class="section-title"> Mano de obra</div>',$+=`<table><tr><th>Cargo</th><th class="r">Cant</th><th class="r">${n}/h</th><th class="r">Subtotal/h</th></tr>`,H.cargos.forEach(_=>{const ce=v(_.cargoId);$+=`<tr><td>${A(_.cargoId)}</td><td class="mono r">${_.cantidad||1}</td>`,$+=`<td class="mono r">${a(ce)}</td><td class="mono r bold">${a(ce*(_.cantidad||1))}</td></tr>`;const ve=_.recursosAsignados||hn[_.cargoId]||[];ve.length>0&&($+='<tr><td colspan="4" style="padding-left:16px">',ve.forEach(Ie=>{const Te=Oo(Ie);Te&&($+=`<span class="tag">${Ie} ${Te.nombre}</span> `)}),$+="</td></tr>")}),$+="</table>",(H.herrAsignadas||[]).length>0&&($+='<div class="section-title"> Herramientas y equipos</div><div>',(H.herrAsignadas||[]).forEach(_=>{const ce=Oo(_);ce&&($+=`<span class="tag tag-blue">${_} ${ce.nombre}</span> `)}),$+="</div>"),$+='<div class="cost-box">',$+=`<div class="cost-row"><span>M.O. / hora</span><span class="mono bold">${a(U.moH)}</span></div>`,U.eqH>0&&($+=`<div class="cost-row"><span>Equipos / hora</span><span class="mono">${a(U.eqH)}</span></div>`),U.licH>0&&($+=`<div class="cost-row"><span>Licencias / hora</span><span class="mono">${a(U.licH)}</span></div>`),U.logH>0&&($+=`<div class="cost-row"><span>EPPs+Herram. / hora</span><span class="mono">${a(U.logH)}</span></div>`),$+=`<div class="cost-row cost-total"><span>Total / hora</span><span class="mono blue" style="font-size:11px">${a(U.totalH)} ${n}</span></div>`,$+="</div></div></div>"}),$+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Equipos de trabajo</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,$+="</body></html>",q.document.write($),q.document.close(),setTimeout(()=>q.print(),400)};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:E.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Conformacin de equipos de trabajo"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[C.length," equipos / cuadrillas"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(ht,{sm:!0,on:()=>te(null),children:[e.jsx(Pe,{size:11})," Nuevo equipo"]}),C.length>0&&e.jsxs("button",{onClick:he,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(At,{size:11})," Vista PDF"]})]})]}),e.jsx(Ke,{style:{padding:"10px 14px",marginBottom:14,background:y?"#FFF8E7":"#E6F4EC"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",fontSize:11},children:y?e.jsx(e.Fragment,{children:e.jsxs("span",{style:{color:"#8C6A00"},children:[" ",e.jsx("strong",{children:"Sin cargos en RRHH"}),"  Usando tarifas predeterminadas. Crea cargos en el mdulo ",e.jsx("strong",{children:"RRHH  Cargos"})," para que se reflejen aqu."]})}):e.jsx(e.Fragment,{children:e.jsxs("span",{style:{color:"#111111"},children:[" ",e.jsxs("strong",{children:[r.filter(q=>q.activo!==!1).length," cargos"]})," desde RRHH ",e.jsxs("strong",{children:[z.length," activos"]}),"  ",e.jsxs("strong",{children:[k.length," licencias"]}),"  Horas productivas/ao: ",e.jsx("strong",{children:Math.round(g)}),m.length>0&&e.jsxs(e.Fragment,{children:["  ",e.jsxs("strong",{children:[m.length," tems"]})," desde Logstica"]})]})})})}),C.length===0?e.jsxs(Ke,{style:{padding:40,textAlign:"center"},children:[e.jsx(kn,{size:32,style:{color:E.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:E.inkLight,fontSize:13,margin:"0 0 12px"},children:"Sin equipos definidos. Crea el primero."}),e.jsxs(ht,{sm:!0,on:()=>te(null),children:[e.jsx(Pe,{size:11})," Nuevo equipo"]})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(380px, 1fr))",gap:14},children:C.map(q=>{const I=ae(q),$=K===q.id;return e.jsxs(Ke,{style:{padding:0,overflow:"hidden",border:$?"2px solid #3B3B3B":`1px solid ${E.border}`},children:[e.jsxs("div",{style:{padding:"10px 14px",background:$?"#F0F0F0":"#F5F4F1",borderBottom:`1px solid ${E.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[$?e.jsx("input",{value:q.nombre,onChange:H=>ie(q.id,"nombre",H.target.value),style:{...pe,fontSize:13,fontWeight:700,width:"100%",background:"#fff"}}):e.jsx("div",{style:{fontSize:13,fontWeight:700,color:E.ink},children:q.nombre}),e.jsxs("div",{style:{fontSize:9,color:E.inkLight,marginTop:2},children:[q.cargos.length," cargo",q.cargos.length!==1?"s":"","  Rend: ",q.rendimiento," h/ud"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>oe($?null:q.id),style:{background:"none",border:"none",cursor:"pointer",color:$?"#3B3B3B":E.inkLight,padding:4},children:e.jsx(Wo,{size:13})}),e.jsx("button",{onClick:()=>P(q.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:4},children:e.jsx(qe,{size:13})})]})]}),e.jsxs("div",{style:{padding:"10px 14px"},children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:[" Mano de obra ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH)"})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6,fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${E.border}`},children:[e.jsx("th",{style:{padding:"3px 4px",textAlign:"left",fontSize:8,color:"#888",fontWeight:700},children:"CARGO"}),e.jsx("th",{style:{padding:"3px 4px",textAlign:"center",fontSize:8,color:"#888",fontWeight:700,width:40},children:"CANT"}),e.jsxs("th",{style:{padding:"3px 4px",textAlign:"right",fontSize:8,color:"#888",fontWeight:700,width:70},children:[n,"/H"]}),e.jsx("th",{style:{padding:"3px 4px",textAlign:"right",fontSize:8,color:"#888",fontWeight:700,width:75},children:"SUBTOT/H"}),$&&e.jsx("th",{style:{width:20}})]})}),e.jsx("tbody",{children:q.cargos.map(H=>{const U=v(H.cargoId);return e.jsxs(ka.Fragment,{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"3px 4px"},children:$?e.jsxs("select",{value:H.cargoId,onChange:_=>je(q.id,H.id,"cargoId",_.target.value),style:{...pe,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar "}),h.map(_=>e.jsx("option",{value:_.id,children:_.nombre||_.label},_.id))]}):e.jsx("span",{children:A(H.cargoId)})}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"center"},children:$?e.jsx("input",{type:"number",value:H.cantidad||1,min:1,onChange:_=>je(q.id,H.id,"cantidad",+_.target.value),style:{...pe,width:36,textAlign:"center",fontSize:10}}):e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:H.cantidad||1})}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:E.inkMid},children:a(U)}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600},children:a(U*(H.cantidad||1))}),$&&e.jsx("td",{children:e.jsx("button",{onClick:()=>Q(q.id,H.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx($t,{size:10})})})]}),e.jsx("tr",{children:e.jsx("td",{colSpan:$?5:4,style:{padding:"0 4px 4px 20px"},children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:7,color:"#888",fontWeight:700,textTransform:"uppercase"},children:"EPP:"}),(H.recursosAsignados||hn[H.cargoId]||[]).map(_=>{const ce=Oo(_);return ce?e.jsxs("span",{style:{fontSize:8,background:"#FFF8E7",color:"#8C6A00",padding:"1px 5px",borderRadius:3,display:"inline-flex",alignItems:"center",gap:2},children:[ba[ce.familia]||""," ",e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:_})," ",ce.nombre,$&&e.jsx("button",{onClick:()=>{const ve=H.recursosAsignados||[...hn[H.cargoId]||[]];je(q.id,H.id,"recursosAsignados",ve.filter(Ie=>Ie!==_))},style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0,marginLeft:2},children:""})]},_):null}),$&&e.jsxs("select",{value:"",onChange:_=>{if(!_.target.value)return;const ce=H.recursosAsignados||[...hn[H.cargoId]||[]];ce.includes(_.target.value)||je(q.id,H.id,"recursosAsignados",[...ce,_.target.value]),_.target.value=""},style:{fontSize:8,padding:"1px 4px",border:`1px dashed ${E.border}`,borderRadius:3,background:"#fff",cursor:"pointer",maxWidth:130},children:[e.jsx("option",{value:"",children:"+ EPP/Dotacin"}),to.filter(_=>_.familia==="epp"||_.familia==="dotacion").map(_=>e.jsxs("option",{value:_.codigo,children:[_.codigo," ",_.nombre]},_.codigo))]})]})})})]},H.id)})})]}),$&&e.jsx("button",{onClick:()=>me(q.id),style:{background:"none",border:`1px dashed ${E.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:E.inkMid,width:"100%",marginBottom:8},children:"+ Aadir cargo"}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:" Herramientas y equipos asignados"}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginBottom:6},children:[(q.herrAsignadas||[]).map(H=>{const U=Oo(H);return U?e.jsxs("span",{style:{fontSize:8,background:"#F0F0F0",color:"#3B3B3B",padding:"2px 6px",borderRadius:3,display:"inline-flex",alignItems:"center",gap:2},children:[ba[U.familia]||""," ",e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:H})," ",U.nombre,$&&e.jsx("button",{onClick:()=>{ie(q.id,"herrAsignadas",(q.herrAsignadas||[]).filter(_=>_!==H))},style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0,marginLeft:2},children:""})]},H):null}),(q.herrAsignadas||[]).length===0&&!$&&e.jsx("span",{style:{fontSize:9,color:"#999",fontStyle:"italic"},children:"Sin herramientas asignadas"}),$&&e.jsxs("select",{value:"",onChange:H=>{if(!H.target.value)return;const U=q.herrAsignadas||[];U.includes(H.target.value)||ie(q.id,"herrAsignadas",[...U,H.target.value]),H.target.value=""},style:{fontSize:8,padding:"2px 6px",border:`1px dashed ${E.border}`,borderRadius:3,background:"#fff",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"+ Herramienta / Equipo"}),to.filter(H=>["herr_menor","herr_mayor","equipo_obra","equipo_medic","consumible","seguridad"].includes(H.familia)).map(H=>e.jsxs("option",{value:H.codigo,children:[H.codigo," ",H.nombre," (",Jn[H.familia],")"]},H.codigo))]}),$&&(q.herrAsignadas||[]).length===0&&(()=>{const H=Object.keys(Vs).find(U=>{var _;return(_=q.nombre)==null?void 0:_.toLowerCase().includes(U.replace("eq_","").replace("_"," "))});return H?e.jsx("button",{onClick:()=>ie(q.id,"herrAsignadas",[...q.herrAsignadas||[],...Vs[H]]),style:{fontSize:8,padding:"2px 8px",background:"#E6F4EC",border:"1px solid #111111",borderRadius:3,color:"#111111",cursor:"pointer",fontWeight:600},children:" Cargar defaults"}):null})()]}),($||(q.activosUsados||[]).length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" Equipos / herramientas ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH  Activos)"})]}),(q.activosUsados||[]).length===0&&z.length===0?e.jsx("div",{style:{fontSize:10,color:"#999",marginBottom:6},children:"Sin activos en RRHH. Regstralos en RRHH  Activos fijos."}):e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:(q.activosUsados||[]).map(H=>{const U=d.find(ce=>ce.id===H.activoId),_=T(H.activoId);return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:$?e.jsxs("select",{value:H.activoId,onChange:ce=>M(q.id,H.id,"activoId",ce.target.value),style:{...pe,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar activo "}),z.map(ce=>e.jsxs("option",{value:ce.id,children:[ce.nombre," (",ce.categoria,")"]},ce.id))]}):e.jsx("span",{children:(U==null?void 0:U.nombre)||""})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:$?e.jsx("input",{type:"number",value:H.cantidad||1,min:1,onChange:ce=>M(q.id,H.id,"cantidad",+ce.target.value),style:{...pe,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:H.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:E.inkMid,width:60},children:[a(_),"/h"]}),$&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>J(q.id,H.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx($t,{size:9})})})]},H.id)})})}),$&&z.length>0&&e.jsx("button",{onClick:()=>re(q.id),style:{background:"none",border:`1px dashed ${E.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:E.inkMid,width:"100%",marginBottom:6},children:"+ Aadir equipo/herramienta"})]}),($||(q.licenciasUsadas||[]).length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" Licencias software ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH  Licencias)"})]}),(q.licenciasUsadas||[]).length===0&&k.length===0?e.jsx("div",{style:{fontSize:10,color:"#999",marginBottom:6},children:"Sin licencias en RRHH."}):e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:(q.licenciasUsadas||[]).map(H=>{const U=b.find(ce=>ce.id===H.licId),_=U?(U.costoAnual||0)/(g||1760):0;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:$?e.jsxs("select",{value:H.licId,onChange:ce=>X(q.id,H.id,"licId",ce.target.value),style:{...pe,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar licencia "}),k.map(ce=>e.jsxs("option",{value:ce.id,children:[ce.nombre," (",ce.plan||"",")"]},ce.id))]}):e.jsx("span",{children:(U==null?void 0:U.nombre)||""})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:$?e.jsx("input",{type:"number",value:H.cantidad||1,min:1,onChange:ce=>X(q.id,H.id,"cantidad",+ce.target.value),style:{...pe,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:H.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:E.inkMid,width:60},children:[a(_),"/h"]}),$&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>V(q.id,H.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx($t,{size:9})})})]},H.id)})})}),$&&k.length>0&&e.jsx("button",{onClick:()=>B(q.id),style:{background:"none",border:`1px dashed ${E.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:E.inkMid,width:"100%",marginBottom:6},children:"+ Aadir licencia"})]}),(()=>{const H=L(q),U=q.logItemsUsados||[];return H.length>0||U.length>0||$?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" EPPs  Dotaciones  Herramientas ",e.jsx("span",{style:{fontWeight:400},children:"(desde Logstica)"})]}),H.length>0&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:3,padding:"4px 8px",marginBottom:4,fontSize:9},children:[e.jsx("span",{style:{fontWeight:600,color:E.warning},children:"Auto por cargo:"}),H.map(ce=>e.jsxs("span",{style:{marginLeft:6,color:E.inkMid},children:[N[ce.familia]||""," ",ce.nombre," (",a(G(ce.id)),"/h)"]},ce.id))]}),U.length>0&&e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:U.map(ce=>{const ve=m.find(Te=>Te.id===ce.itemId),Ie=G(ce.itemId);return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:$?e.jsxs("select",{value:ce.itemId,onChange:Te=>se(q.id,ce.id,"itemId",Te.target.value),style:{...pe,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar "}),ue.map(Te=>e.jsxs("option",{value:Te.id,children:[N[Te.familia]||""," ",Te.nombre," (",Te.familia,")"]},Te.id))]}):e.jsxs("span",{children:[N[ve==null?void 0:ve.familia]||""," ",(ve==null?void 0:ve.nombre)||""]})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:$?e.jsx("input",{type:"number",value:ce.cantidad||1,min:1,onChange:Te=>se(q.id,ce.id,"cantidad",+Te.target.value),style:{...pe,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:ce.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:E.inkMid,width:60},children:[a(Ie),"/h"]}),$&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>W(q.id,ce.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx($t,{size:9})})})]},ce.id)})})}),$&&ue.length>0&&e.jsx("button",{onClick:()=>R(q.id),style:{background:"none",border:`1px dashed ${E.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:E.inkMid,width:"100%",marginBottom:6},children:"+ Aadir EPP / herramienta"}),$&&ue.length===0&&e.jsx("div",{style:{fontSize:9,color:"#999",marginBottom:6},children:"Sin tems en Logstica. Regstralos en el mdulo Logstica."})]}):null})(),$&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:8,marginBottom:6},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:8,color:E.inkLight,fontWeight:600,textTransform:"uppercase",marginBottom:2},children:"Rendimiento (h/ud)"}),e.jsx("input",{type:"number",value:q.rendimiento||0,step:.01,onChange:H=>ie(q.id,"rendimiento",+H.target.value),style:{...pe,width:"100%",textAlign:"right"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:8,color:E.inkLight,fontWeight:600,textTransform:"uppercase",marginBottom:2},children:"Notas"}),e.jsx("input",{value:q.notas||"",onChange:H=>ie(q.id,"notas",H.target.value),placeholder:"Observaciones...",style:{...pe,width:"100%"}})]})]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px",fontSize:10,marginTop:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:E.inkLight},children:"M.O. / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:a(I.moH)})]}),I.eqH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:E.inkLight},children:"Equipos / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:a(I.eqH)})]}),I.licH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:E.inkLight},children:"Licencias / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:a(I.licH)})]}),I.logH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:E.inkLight},children:"EPPs+Herram. / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:a(I.logH)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:`1px solid ${E.border}`,paddingTop:3,marginTop:3},children:[e.jsx("span",{style:{fontWeight:600},children:"Total / hora"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#3B3B3B"},children:[a(I.totalH)," ",n]})]})]}),$&&e.jsxs("button",{onClick:()=>oe(null),style:{width:"100%",marginTop:10,padding:"7px 12px",fontSize:11,fontWeight:700,cursor:"pointer",border:"none",borderRadius:4,background:"#111111",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",justifyContent:"center",gap:5},children:[e.jsx(ft,{size:12})," Guardar equipo"]})]})]},q.id)})})]})}function Uh({d:t,set:i,r:o}){var U;const n=t.pais||"CO",a=_=>_?new Intl.NumberFormat(n==="CO"?"es-CO":"es-ES",{maximumFractionDigits:0}).format(_):"",r=[{id:"civil",label:" Materiales civiles",icon:""},{id:"electrico",label:" Materiales elctricos",icon:""},{id:"hidro",label:" Hidrulico / sanitario",icon:""},{id:"acabados",label:" Acabados",icon:""},{id:"epp",label:" EPPs y dotacin",icon:""},{id:"herr",label:" Herramientas y equipos",icon:""},{id:"transporte",label:" Transporte",icon:""},{id:"otros",label:" Otros insumos",icon:""}],[s,d]=F.useState("civil"),[u,b]=F.useState(!1),[j,w]=F.useState(!1),[S,m]=F.useState(null),[x,p]=F.useState({codigo:"",descripcion:"",unidad:"ud",familia:"civil"}),[c,g]=F.useState({nombre:"",contacto:"",tel:"",email:"",nit:""}),[l,f]=F.useState(""),[y,h]=F.useState([]),[v,A]=F.useState(!1);F.useState(null);const z=t.insumosLista||[],k=_=>i("insumosLista",typeof _=="function"?_(z):_),T=t.matProveedores||[],C=_=>i("matProveedores",typeof _=="function"?_(T):_),D=t.insCotizaciones2||{},K=_=>i("insCotizaciones2",typeof _=="function"?_(D):_),oe=t.insAdjudicacion||{},te=_=>i("insAdjudicacion",typeof _=="function"?_(oe):_),P=["slot1","slot2","slot3"],ie={slot1:"Cotizacin 1",slot2:"Cotizacin 2",slot3:"Cotizacin 3"},me={slot1:"#3B3B3B",slot2:"#8C6A00",slot3:"#5B3A8C"},Q={slot1:"#F0F0F0",slot2:"#FAF0E0",slot3:"#F0ECF6"},je=_=>{const ce={civil:"MC",electrico:"ME",hidro:"MH",acabados:"MA",epp:"EPP",herr:"HE",transporte:"TR",otros:"OT"}[_]||"XX",Ie=z.filter(Te=>Te.familia===_).reduce((Te,Oe)=>{const ct=Oe.codigo.match(/(\d+)$/);return ct?Math.max(Te,parseInt(ct[1])):Te},0);return`${ce}-${String(Ie+1).padStart(3,"0")}`},re=()=>{const _=x.familia||s,ce=x.codigo||je(_);k([...z,{id:Ct(),codigo:ce,descripcion:x.descripcion,unidad:x.unidad,familia:_,precioPrevisto:0,cantidad:1}]),p({codigo:"",descripcion:"",unidad:"ud",familia:_}),b(!1)},J=(_,ce,ve)=>k(z.map(Ie=>Ie.id===_?{...Ie,[ce]:ve}:Ie)),M=_=>{k(z.filter(Ie=>Ie.id!==_));const ce={...D};delete ce[_],K(ce);const ve={...oe};delete ve[_],te(ve),h(y.filter(Ie=>Ie!==_))},B=()=>{if(!c.nombre.trim())return;const _={...c,id:Ct(),fecha:Dt()};C([...T,_]),g({nombre:"",contacto:"",tel:"",email:"",nit:""}),w(!1)},V=_=>{C(T.filter(ve=>ve.id!==_));const ce={...D};Object.keys(ce).forEach(ve=>{P.forEach(Ie=>{var Te,Oe;((Oe=(Te=ce[ve])==null?void 0:Te[Ie])==null?void 0:Oe.provId)===_&&delete ce[ve][Ie]})}),K(ce)},X=(_,ce)=>{var ve;return((ve=D[_])==null?void 0:ve[ce])||null},R=(_,ce,ve)=>{const Ie={...D};Ie[_]||(Ie[_]={}),Ie[_][ce]={...Ie[_][ce]||{},...ve},K(Ie)},W=(_,ce)=>{const ve={...D};if(ve[_]&&delete ve[_][ce],K(ve),oe[_]===ce){const Ie={...oe};delete Ie[_],te(Ie)}},se=(_,ce)=>{const ve={...D};y.forEach(Ie=>{ve[Ie]||(ve[Ie]={}),ve[Ie][ce]={provId:_,precio:0,cotArchivo:"",correoRef:""}}),K(ve),A(!1),h([])},le=(_,ce,ve)=>{var Ie,Te,Oe;R(_,ce,{provId:ve,precio:((Ie=X(_,ce))==null?void 0:Ie.precio)||0,cotArchivo:((Te=X(_,ce))==null?void 0:Te.cotArchivo)||"",correoRef:((Oe=X(_,ce))==null?void 0:Oe.correoRef)||""})},de=(_,ce)=>{te({...oe,[_]:ce})},Z=_=>{const ce={...oe};delete ce[_],te(ce)},ue=_=>{const ce=oe[_];if(ce){const ve=X(_,ce);if((ve==null?void 0:ve.precio)>0){const Ie=T.find(Te=>Te.id===ve.provId);return{precio:ve.precio,provNombre:(Ie==null?void 0:Ie.nombre)||"",slot:ce,adjudicado:!0}}}return{precio:0,provNombre:"",slot:null,adjudicado:!1}},N=()=>{const _=[];(to||[]).filter(ce=>ce.familia==="epp"||ce.familia==="dotacion").forEach(ce=>{z.find(ve=>ve.codigo===ce.codigo)||_.push({id:Ct(),codigo:ce.codigo,descripcion:ce.nombre,unidad:ce.unidad,familia:"epp",precioPrevisto:ce.precioRef||0,cantidad:1})}),_.length>0&&k([...z,..._])},G=()=>{const _=[];(to||[]).filter(ce=>["herr_menor","herr_mayor","equipo_obra","equipo_medic","consumible","seguridad"].includes(ce.familia)).forEach(ce=>{z.find(ve=>ve.codigo===ce.codigo)||_.push({id:Ct(),codigo:ce.codigo,descripcion:ce.nombre,unidad:ce.unidad,familia:"herr",precioPrevisto:ce.precioRef||0,cantidad:1})}),_.length>0&&k([...z,..._])},L=z.filter(_=>!(_.familia!==s||l&&!_.descripcion.toLowerCase().includes(l.toLowerCase())&&!_.codigo.toLowerCase().includes(l.toLowerCase()))),ae=z.length,pe=Object.keys(oe).length;z.filter(_=>P.some(ce=>{var ve;return((ve=X(_.id,ce))==null?void 0:ve.precio)>0})).length;const he=L.length>0&&L.every(_=>y.includes(_.id)),ze=()=>{h(he?y.filter(_=>!L.find(ce=>ce.id===_)):[...new Set([...y,...L.map(_=>_.id)])])},q=_=>{h(y.includes(_)?y.filter(ce=>ce!==_):[...y,_])},I=()=>{const _=window.open("","_blank"),ce="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:10mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:8px;padding:16px}.header{display:flex;justify-content:space-between;margin-bottom:10px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}h2{font-size:11px;margin:10px 0 4px;border-bottom:2px solid #111;padding-bottom:4px}table{width:100%;border-collapse:collapse;margin-bottom:8px}th{background:#F5F4F1;padding:3px 4px;font-size:6px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:left;border-bottom:1px solid #E0E0E0}td{padding:2px 4px;font-size:7px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.r{text-align:right}.bold{font-weight:700}.adj{background:#D4EDDA;font-weight:700;color:#111111}.footer{margin-top:10px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:6px;color:#888}";let ve=`<html><head><title>Comparativo - ${t.codigoOferta||""}</title><style>${ce}</style></head><body>`;ve+='<div class="header"><div><div class="logo">HABITARIS</div></div>',ve+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Comparativo de Insumos</div>',ve+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}</div></div></div>`,r.forEach(Ie=>{const Te=z.filter(Oe=>Oe.familia===Ie.id);Te.length!==0&&(ve+=`<h2>${Ie.label} (${Te.length})</h2>`,ve+='<table><tr><th>Cdigo</th><th>Descripcin</th><th>Und</th><th>Cant</th><th class="r">P. Previsto</th>',P.forEach(Oe=>ve+=`<th class="r">${ie[Oe]}</th>`),ve+='<th class="r" style="background:#E6F4EC">P. Final</th><th>Adjudicado a</th></tr>',Te.forEach(Oe=>{const ct=ue(Oe.id);ve+=`<tr><td class="mono bold">${Oe.codigo}</td><td>${Oe.descripcion}</td><td>${Oe.unidad}</td><td class="mono">${Oe.cantidad||1}</td>`,ve+=`<td class="mono r">${a(Oe.precioPrevisto)}</td>`,P.forEach(at=>{const xt=X(Oe.id,at),Ft=oe[Oe.id]===at,zt=xt!=null&&xt.provId?T.find(Vt=>Vt.id===xt.provId):null;ve+=`<td class="mono r ${Ft?"adj":""}">${zt?zt.nombre+": ":""}${(xt==null?void 0:xt.precio)>0?a(xt.precio):""}</td>`}),ve+=`<td class="mono r bold green">${ct.adjudicado?a(ct.precio):""}</td>`,ve+=`<td>${ct.adjudicado?ct.provNombre:"Pendiente"}</td></tr>`}),ve+="</table>")}),ve+=`<div class="footer"><span>HABITARIS  Comparativo  ${t.codigoOferta||""}</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,ve+="</body></html>",_.document.write(ve),_.document.close(),setTimeout(()=>_.print(),400)},$={border:`1px solid ${E.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},H={width:15,height:15,accentColor:"#111111",cursor:"pointer"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:E.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Insumos y comparativo de proveedores"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[ae," insumos  ",T.length," proveedores  ",pe," adjudicados"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[y.length>0&&e.jsxs("button",{onClick:()=>A(!0),style:{padding:"6px 14px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" Asignar proveedor a ",y.length," insumos"]}),e.jsx("button",{onClick:()=>{p({...x,familia:s}),b(!0)},style:{padding:"6px 12px",border:`1px solid ${E.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:E.inkMid},children:"+ Insumo"}),e.jsx("button",{onClick:()=>{g({nombre:"",contacto:"",tel:"",email:"",nit:""}),m(null),w(!0)},style:{padding:"6px 12px",border:`1px solid ${E.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:E.inkMid},children:"+ Proveedor"}),e.jsxs("button",{onClick:I,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(At,{size:11})," Vista PDF"]})]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14,overflowX:"auto"},children:r.map((_,ce)=>{const ve=z.filter(Ie=>Ie.familia===_.id).length;return e.jsxs("button",{onClick:()=>{d(_.id),h([])},style:{padding:"8px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${E.border}`,borderLeft:ce>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:ce===0?"5px 0 0 5px":ce===r.length-1?"0 5px 5px 0":"0",background:s===_.id?"#111":"#fff",color:s===_.id?"#fff":E.inkMid},children:[_.icon," ",_.label.split(" ").slice(1).join(" ")," ",ve>0&&e.jsx("span",{style:{marginLeft:4,background:s===_.id?"rgba(255,255,255,0.2)":"#F5F5F5",padding:"0 5px",borderRadius:8,fontSize:9},children:ve})]},_.id)})}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsxs("div",{style:{width:240,flexShrink:0},children:[e.jsxs(Ke,{style:{padding:"8px 10px",marginBottom:10},children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:["Proveedores (",T.length,")"]}),T.map(_=>e.jsx("div",{style:{padding:"6px 0",borderBottom:`1px solid ${E.border}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:_.nombre}),_.contacto&&e.jsx("div",{style:{fontSize:9,color:"#888"},children:_.contacto}),_.email&&e.jsxs("div",{style:{fontSize:8,color:"#3B3B3B"},children:[" ",_.email]}),_.nit&&e.jsxs("div",{style:{fontSize:8,color:"#888"},children:["NIT: ",_.nit]})]}),e.jsxs("div",{style:{display:"flex",gap:2},children:[e.jsx("button",{onClick:()=>{m(_.id),g({nombre:_.nombre,contacto:_.contacto||"",tel:_.tel||"",email:_.email||"",nit:_.nit||""}),w(!0)},style:{background:"none",border:"none",cursor:"pointer",color:"#3B3B3B",padding:2,fontSize:10},children:""}),e.jsx("button",{onClick:()=>V(_.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx($t,{size:10})})]})]})},_.id)),T.length===0&&e.jsx("div",{style:{fontSize:10,color:"#CCC",padding:"8px 0"},children:"Sin proveedores"}),e.jsx("button",{onClick:()=>{g({nombre:"",contacto:"",tel:"",email:"",nit:""}),m(null),w(!0)},style:{width:"100%",marginTop:6,padding:"5px",fontSize:10,cursor:"pointer",border:`1px dashed ${E.border}`,borderRadius:4,background:"#fff",color:E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir proveedor"})]}),s==="epp"&&e.jsx("button",{onClick:N,style:{width:"100%",padding:"6px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${E.border}`,borderRadius:4,background:"#FFF8E7",color:"#8C6A00",fontFamily:"'DM Sans',sans-serif",marginBottom:8},children:" Cargar EPPs desde catlogo"}),s==="herr"&&e.jsx("button",{onClick:G,style:{width:"100%",padding:"6px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${E.border}`,borderRadius:4,background:"#FFF8E7",color:"#8C6A00",fontFamily:"'DM Sans',sans-serif",marginBottom:8},children:" Cargar herramientas desde catlogo"}),e.jsx("input",{value:l,onChange:_=>f(_.target.value),placeholder:" Buscar insumo...",style:{...$,width:"100%",marginBottom:8}}),y.length>0&&e.jsxs("div",{style:{background:"#F0F0F0",border:"1px solid #3B3B3B33",borderRadius:6,padding:"8px 10px",fontSize:10},children:[e.jsx("strong",{children:y.length})," insumos seleccionados",e.jsx("button",{onClick:()=>A(!0),style:{display:"block",width:"100%",marginTop:4,padding:"5px",fontSize:10,fontWeight:700,cursor:"pointer",border:"none",borderRadius:4,background:"#3B3B3B",color:"#fff",fontFamily:"'DM Sans',sans-serif"},children:" Asignar proveedor"}),e.jsx("button",{onClick:()=>h([]),style:{display:"block",width:"100%",marginTop:3,padding:"4px",fontSize:9,cursor:"pointer",border:`1px solid ${E.border}`,borderRadius:4,background:"#fff",color:E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"Deseleccionar todo"})]})]}),e.jsxs(Ke,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:900},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{padding:"6px 4px",width:30,borderBottom:"2px solid #CCC"},children:e.jsx("input",{type:"checkbox",checked:he,onChange:ze,style:H})}),e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"left",width:80},children:"Cdigo"}),e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"left",minWidth:150},children:"Descripcin"}),e.jsx("th",{style:{padding:"6px 4px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"center",width:35},children:"Und"}),e.jsx("th",{style:{padding:"6px 4px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"center",width:40},children:"Cant"}),e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"right",width:80},children:"P. Prev."}),P.map(_=>e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,textTransform:"uppercase",borderBottom:`2px solid ${me[_]}`,textAlign:"center",minWidth:140,color:me[_],background:Q[_]},children:ie[_]},_)),e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,color:"#111111",textTransform:"uppercase",borderBottom:"2px solid #111111",textAlign:"center",width:120,background:"#E6F4EC"},children:"P. Final / Adjud."}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:"24px",textAlign:"center",color:"#CCC",fontSize:12},children:'Sin insumos en esta categora. Pulsa "+ Insumo" para aadir.'})}):L.map((_,ce)=>{const ve=ue(_.id),Ie=y.includes(_.id);return e.jsxs("tr",{style:{background:Ie?"#F0F0F022":ce%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${E.border}`},children:[e.jsx("td",{style:{padding:"4px 4px",textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:Ie,onChange:()=>q(_.id),style:H})}),e.jsx("td",{style:{padding:"4px 6px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#F5F5F5",padding:"1px 6px",borderRadius:3},children:_.codigo})}),e.jsx("td",{style:{padding:"4px 6px"},children:e.jsx("input",{value:_.descripcion,onChange:Te=>J(_.id,"descripcion",Te.target.value),style:{...$,width:"100%",border:"none",background:"transparent",fontWeight:500,fontSize:11},placeholder:"Descripcin"})}),e.jsx("td",{style:{padding:"2px 2px",textAlign:"center"},children:e.jsx("select",{value:_.unidad,onChange:Te=>J(_.id,"unidad",Te.target.value),style:{...$,fontSize:9,border:"none",background:"transparent",textAlign:"center",padding:"2px"},children:["ud","m","m","m","ml","kg","gl","l","par","jgo","rollo","bulto","caneca","caja","saco","da","mes","h","viaje"].map(Te=>e.jsx("option",{children:Te},Te))})}),e.jsx("td",{style:{padding:"2px 2px"},children:e.jsx("input",{type:"number",value:_.cantidad||1,min:1,onChange:Te=>J(_.id,"cantidad",parseInt(Te.target.value)||1),style:{...$,width:36,textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:10,border:"none",background:"transparent"}})}),e.jsx("td",{style:{padding:"2px 4px"},children:e.jsx("input",{type:"number",value:_.precioPrevisto||"",placeholder:"0",onChange:Te=>J(_.id,"precioPrevisto",parseFloat(Te.target.value)||0),style:{...$,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"}})}),P.map(Te=>{const Oe=X(_.id,Te);Oe!=null&&Oe.provId&&T.find(at=>at.id===Oe.provId);const ct=oe[_.id]===Te;return e.jsx("td",{style:{padding:"3px 4px",borderLeft:`1px solid ${me[Te]}22`,background:ct?"#D4EDDA":Oe?Q[Te]+"44":"transparent",verticalAlign:"top"},children:Oe?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[e.jsxs("select",{value:Oe.provId||"",onChange:at=>R(_.id,Te,{provId:at.target.value}),style:{fontSize:8,fontWeight:700,color:me[Te],border:"none",background:"transparent",cursor:"pointer",maxWidth:100},children:[e.jsx("option",{value:"",children:" Prov "}),T.map(at=>e.jsx("option",{value:at.id,children:at.nombre},at.id))]}),e.jsx("button",{onClick:()=>W(_.id,Te),title:"Quitar",style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0},children:""})]}),e.jsx("input",{type:"number",value:Oe.precio||"",placeholder:"Precio",onChange:at=>R(_.id,Te,{precio:parseFloat(at.target.value)||0}),style:{...$,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:ct?700:400,border:ct?"2px solid #111111":`1px solid ${E.border}`,background:ct?"#D4EDDA":"#fff"}}),e.jsxs("div",{style:{display:"flex",gap:2,marginTop:2},children:[e.jsx("input",{value:Oe.cotArchivo||"",placeholder:" Cotizacin",onChange:at=>R(_.id,Te,{cotArchivo:at.target.value}),style:{fontSize:7,padding:"1px 3px",border:`1px solid ${E.border}`,borderRadius:2,width:"50%",background:"#fff"}}),e.jsx("input",{value:Oe.correoRef||"",placeholder:" Correo",onChange:at=>R(_.id,Te,{correoRef:at.target.value}),style:{fontSize:7,padding:"1px 3px",border:`1px solid ${E.border}`,borderRadius:2,width:"50%",background:"#fff"}})]}),Oe.precio>0&&e.jsx("button",{onClick:()=>ct?Z(_.id):de(_.id,Te),style:{width:"100%",marginTop:3,padding:"2px",fontSize:8,fontWeight:700,border:ct?"1px solid #111111":`1px dashed ${E.border}`,borderRadius:3,background:ct?"#111111":"#fff",color:ct?"#fff":"#888",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:ct?" Adjudicado":"Adjudicar"})]}):e.jsx("div",{style:{textAlign:"center",padding:"6px 0"},children:e.jsxs("select",{value:"",onChange:at=>{at.target.value&&le(_.id,Te,at.target.value)},style:{fontSize:8,padding:"2px 4px",border:`1px dashed ${E.border}`,borderRadius:3,background:"#fff",cursor:"pointer",color:E.inkMid,width:"100%"},children:[e.jsx("option",{value:"",children:"+ Proveedor"}),T.map(at=>e.jsx("option",{value:at.id,children:at.nombre},at.id))]})})},Te)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",background:"#E6F4EC",verticalAlign:"middle"},children:ve.adjudicado?e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:800,color:"#111111"},children:a(ve.precio)}),e.jsxs("div",{style:{fontSize:7,color:"#111111",fontWeight:600},children:[" ",ve.provNombre]})]}):e.jsx("span",{style:{fontSize:8,color:"#999",fontStyle:"italic"},children:"Pendiente"})}),e.jsx("td",{style:{padding:"2px 4px"},children:e.jsx("button",{onClick:()=>M(_.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx(qe,{size:10})})})]},_.id)})})]})}),e.jsx("div",{style:{padding:"6px 8px",borderTop:`1px solid ${E.border}`},children:e.jsxs("button",{onClick:()=>{p({...x,familia:s}),b(!0)},style:{width:"100%",padding:"5px 8px",fontSize:10,cursor:"pointer",border:`1px dashed ${E.border}`,borderRadius:3,background:"#fff",color:E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:["+ Aadir insumo a ",((U=r.find(_=>_.id===s))==null?void 0:U.label)||""]})})]})]}),u&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:_=>_.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(vt,{t:"Nuevo insumo",s:"Se agrega a la maestra del proyecto"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:"0 0 100px"},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Cdigo"}),e.jsx("input",{value:x.codigo||je(x.familia||s),onChange:_=>p({...x,codigo:_.target.value}),style:{...$,width:"100%",fontFamily:"'DM Mono',monospace",fontWeight:700}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Descripcin"}),e.jsx("input",{value:x.descripcion,onChange:_=>p({...x,descripcion:_.target.value}),style:{...$,width:"100%"},placeholder:"Ej: Cemento Portland tipo I"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Familia"}),e.jsx("select",{value:x.familia||s,onChange:_=>p({...x,familia:_.target.value}),style:{...$,width:"100%"},children:r.map(_=>e.jsx("option",{value:_.id,children:_.label},_.id))})]}),e.jsxs("div",{style:{flex:"0 0 80px"},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Unidad"}),e.jsx("select",{value:x.unidad,onChange:_=>p({...x,unidad:_.target.value}),style:{...$,width:"100%"},children:["ud","m","m","m","ml","kg","gl","l","par","jgo","rollo","bulto","caneca","caja","saco","da","mes","h","viaje"].map(_=>e.jsx("option",{children:_},_))})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ht,{on:re,style:{flex:1},children:[e.jsx(ft,{size:11})," Aadir"]}),e.jsx(ht,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})}),j&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>w(!1),children:e.jsxs("div",{onClick:_=>_.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(vt,{t:S?"Editar proveedor":"Nuevo proveedor",s:"Para comparar cotizaciones"}),e.jsx(st,{lbl:"Nombre / Empresa",val:c.nombre,on:_=>g({...c,nombre:_.target.value}),ph:"Ej: Ferretera El Tornillo"}),e.jsx(st,{lbl:"NIT / CIF",val:c.nit||"",on:_=>g({...c,nit:_.target.value}),ph:"900.123.456-7"}),e.jsx(st,{lbl:"Contacto",val:c.contacto,on:_=>g({...c,contacto:_.target.value}),ph:"Nombre persona"}),e.jsx(st,{lbl:"Telfono",val:c.tel,on:_=>g({...c,tel:_.target.value}),ph:"+57 300..."}),e.jsx(st,{lbl:"Email",val:c.email,on:_=>g({...c,email:_.target.value}),ph:"prov@email.com"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(ht,{on:()=>{S?(C(T.map(_=>_.id===S?{..._,...c}:_)),w(!1),m(null)):B()},style:{flex:1},children:[e.jsx(ft,{size:11})," ",S?"Guardar":"Aadir"]}),e.jsx(ht,{v:"sec",on:()=>{w(!1),m(null)},style:{flex:1},children:"Cancelar"})]})]})}),v&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>A(!1),children:e.jsxs("div",{onClick:_=>_.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:480,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(vt,{t:`Asignar proveedor a ${y.length} insumos`,s:"Elige proveedor y columna de cotizacin"}),T.length===0?e.jsx("div",{style:{padding:16,textAlign:"center",color:"#888",fontSize:12},children:"Primero aade proveedores"}):e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,marginBottom:8,color:"#555"},children:"A qu columna asignar?"}),P.map(_=>e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:me[_],textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:ie[_]}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:T.map(ce=>e.jsx("button",{onClick:()=>se(ce.id,_),style:{padding:"6px 14px",border:`1px solid ${me[_]}44`,borderRadius:5,background:Q[_],color:me[_],fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:ce.nombre},ce.id))})]},_))]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ht,{v:"sec",on:()=>A(!1),style:{width:"100%"},children:"Cerrar"})})]})})]})}function Vh({d:t,set:i}){const o=t.orgNodos||[],n=A=>i("orgNodos",typeof A=="function"?A(o):A),[a,r]=F.useState(null),[s,d]=F.useState(!0),u={obra:{label:" Obra civil",nodes:[{id:"o1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"o2",parentId:"o1",nombre:"",cargo:"Director de Obra",color:"#2A5F8C",icon:""},{id:"o3",parentId:"o2",nombre:"",cargo:"Residente de Obra",color:"#5B8DB8",icon:""},{id:"o4",parentId:"o2",nombre:"",cargo:"Maestro de Obra",color:"#5B8DB8",icon:""},{id:"o5",parentId:"o2",nombre:"",cargo:"Almacenista",color:"#5B8DB8",icon:""},{id:"o6",parentId:"o1",nombre:"",cargo:"Directora de Diseo",color:"#8C5B2A",icon:""},{id:"o7",parentId:"o6",nombre:"",cargo:"Arquitecto",color:"#B88C5B",icon:""},{id:"o8",parentId:"o1",nombre:"",cargo:"Ing. HSE / SISO",color:"#8C2A2A",icon:""},{id:"o9",parentId:"o1",nombre:"",cargo:"Coord. Administrativo",color:"#6B5B8C",icon:""}]},diseno:{label:" Diseo interior",nodes:[{id:"d1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"d2",parentId:"d1",nombre:"",cargo:"Directora Creativa",color:"#8C5B2A",icon:""},{id:"d3",parentId:"d2",nombre:"",cargo:"Diseador Senior",color:"#B88C5B",icon:""},{id:"d4",parentId:"d2",nombre:"",cargo:"Diseador Junior",color:"#B88C5B",icon:""},{id:"d5",parentId:"d2",nombre:"",cargo:"Visualizador 3D",color:"#B88C5B",icon:""},{id:"d6",parentId:"d1",nombre:"",cargo:"Coord. Tcnico",color:"#2A5F8C",icon:""},{id:"d7",parentId:"d6",nombre:"",cargo:"Dibujante / Planos",color:"#5B8DB8",icon:""}]},mixto:{label:" Obra + Diseo",nodes:[{id:"m1",parentId:null,nombre:"",cargo:"Gerente de Proyecto",color:"#111111",icon:""},{id:"m2",parentId:"m1",nombre:"",cargo:"Director de Obra",color:"#2A5F8C",icon:""},{id:"m3",parentId:"m2",nombre:"",cargo:"Residente de Obra",color:"#5B8DB8",icon:""},{id:"m4",parentId:"m2",nombre:"",cargo:"Maestro de Obra",color:"#5B8DB8",icon:""},{id:"m5",parentId:"m2",nombre:"",cargo:"Almacenista",color:"#5B8DB8",icon:""},{id:"m6",parentId:"m1",nombre:"",cargo:"Directora de Diseo",color:"#8C5B2A",icon:""},{id:"m7",parentId:"m6",nombre:"",cargo:"Arquitecto",color:"#B88C5B",icon:""},{id:"m8",parentId:"m6",nombre:"",cargo:"Diseador Interior",color:"#B88C5B",icon:""},{id:"m9",parentId:"m1",nombre:"",cargo:"Ing. HSE / SISO",color:"#8C2A2A",icon:""},{id:"m10",parentId:"m1",nombre:"",cargo:"Coord. Administrativo",color:"#6B5B8C",icon:""},{id:"m11",parentId:"m1",nombre:"",cargo:"Coord. Compras",color:"#6B5B8C",icon:""}]},pequeno:{label:" Proyecto pequeo",nodes:[{id:"p1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"p2",parentId:"p1",nombre:"",cargo:"Arquitecto / Diseador",color:"#8C5B2A",icon:""},{id:"p3",parentId:"p1",nombre:"",cargo:"Maestro de Obra",color:"#2A5F8C",icon:""}]}},b=A=>{const z=u[A].nodes,k=z.map(C=>({...C,id:Ct()})),T=z.map(C=>C.id);k.forEach((C,D)=>{const K=T.indexOf(z[D].parentId);C.parentId=K>=0?k[K].id:null}),n(k),r(null)},j=A=>{const z={id:Ct(),parentId:A,nombre:"",cargo:"Nuevo cargo",color:"#555",icon:""};n([...o,z]),r(z.id)},w=A=>{const z=new Set([A]);let k=!0;for(;k;)k=!1,o.forEach(T=>{T.parentId&&z.has(T.parentId)&&!z.has(T.id)&&(z.add(T.id),k=!0)});n(o.filter(T=>!z.has(T.id))),a&&z.has(a)&&r(null)},S=(A,z,k)=>n(o.map(T=>T.id===A?{...T,[z]:k}:T)),m=o.filter(A=>!A.parentId),x=A=>o.filter(z=>z.parentId===A),p=A=>{let z=0,k=o.find(T=>T.id===A);for(;k!=null&&k.parentId;)z++,k=o.find(T=>T.id===k.parentId);return z},c=(()=>{const A=[],z=k=>{o.filter(T=>T.parentId===k).forEach(T=>{A.push(T),z(T.id)})};return m.forEach(k=>{A.push(k),z(k.id)}),A})(),g=["","","","","","","","","","","","","","","","","","","","","","","",""],l=["#111111","#2A5F8C","#8C5B2A","#8C2A2A","#6B5B8C","#5B8DB8","#B88C5B","#555","#2B7A52","#3B3B3B","#C44","#888"],f={border:`1px solid ${E.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},y=({node:A})=>{const z=x(A.id),k=a===A.id;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{background:"#fff",border:`2px solid ${A.color||"#555"}`,borderRadius:8,padding:"8px 12px",minWidth:120,maxWidth:180,textAlign:"center",cursor:"pointer",boxShadow:k?`0 0 0 3px ${A.color||"#555"}44`:"0 1px 6px rgba(0,0,0,0.06)"},onClick:()=>r(A.id),children:[e.jsx("div",{style:{fontSize:18,marginBottom:2},children:A.icon||""}),s&&A.nombre&&e.jsx("div",{style:{fontSize:11,fontWeight:700,color:E.ink,lineHeight:1.2},children:A.nombre}),e.jsx("div",{style:{fontSize:9,color:A.color||"#555",fontWeight:700,textTransform:"uppercase",letterSpacing:.4,lineHeight:1.3,marginTop:1},children:A.cargo})]}),z.length>0&&e.jsx("div",{style:{width:2,height:16,background:"#DDD"}}),z.length>0&&e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start",position:"relative"},children:[z.length>1&&e.jsx("div",{style:{position:"absolute",top:0,height:2,background:"#DDD",left:`${100/(z.length*2)}%`,right:`${100/(z.length*2)}%`}}),z.map(T=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:2,height:16,background:"#DDD"}}),e.jsx(y,{node:T})]},T.id))]})]})},h=()=>{const A=window.open("","_blank"),z="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:16px;padding-bottom:10px;border-bottom:3px solid #111}.logo{font-size:16px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}.org-container{display:flex;justify-content:center;padding:16px 0}.node{background:#fff;border:2px solid var(--c);border-radius:8px;padding:8px 14px;min-width:120px;max-width:180px;text-align:center;display:inline-flex;flex-direction:column;align-items:center}.node .icon{font-size:18px;margin-bottom:2px}.node .name{font-size:10px;font-weight:700;color:#111;line-height:1.2}.node .role{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:.4px;color:var(--c);line-height:1.2;margin-top:1px}.branch{display:flex;flex-direction:column;align-items:center}.children{display:flex;gap:12px;align-items:flex-start;position:relative}.vline{width:2px;height:16px;background:#DDD;margin:0 auto}.hline{position:absolute;top:0;height:2px;background:#DDD}.footer{margin-top:20px;padding-top:6px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}",k=C=>{const D=x(C.id);let K=`<div class="branch"><div class="node" style="--c:${C.color||"#555"}"><div class="icon">${C.icon||""}</div>`;return s&&C.nombre&&(K+=`<div class="name">${C.nombre}</div>`),K+=`<div class="role">${C.cargo}</div></div>`,D.length>0&&(K+='<div class="vline"></div><div class="children">',D.length>1&&(K+=`<div class="hline" style="left:${100/(D.length*2)}%;right:${100/(D.length*2)}%"></div>`),D.forEach(oe=>{K+=`<div class="branch"><div class="vline"></div>${k(oe)}</div>`}),K+="</div>"),K+="</div>",K};let T=`<html><head><title>Organigrama - ${t.codigoOferta||""}</title><style>${z}</style></head><body>`;T+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',T+='<div style="text-align:right"><div style="font-size:14px;font-weight:700">Organigrama del Proyecto</div>',T+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div>`,T+=`<div style="font-size:8px;color:#888;margin-top:2px">${o.length} integrantes</div></div></div>`,T+='<div class="org-container">',m.forEach(C=>{T+=k(C)}),T+="</div>",T+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Organigrama</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,T+="</body></html>",A.document.write(T),A.document.close(),setTimeout(()=>A.print(),400)},v=o.find(A=>A.id===a);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:E.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Organigrama del proyecto"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[o.length," integrantes"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:10,color:E.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:s,onChange:A=>d(A.target.checked)})," Mostrar nombres"]}),e.jsxs("button",{onClick:h,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(At,{size:11})," Vista PDF"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{width:300,flexShrink:0},children:[e.jsxs(Ke,{style:{padding:"10px 12px",marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Plantilla"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4},children:Object.entries(u).map(([A,z])=>e.jsx("button",{onClick:()=>b(A),style:{padding:"6px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${E.border}`,borderRadius:4,background:"#fff",fontFamily:"'DM Sans',sans-serif",color:E.inkMid,textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:z.label},A))})]}),e.jsxs(Ke,{style:{padding:"6px 0",maxHeight:520,overflowY:"auto"},children:[e.jsx("div",{style:{padding:"4px 12px 6px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,borderBottom:`1px solid ${E.border}`},children:"Cargos del proyecto"}),c.map(A=>{const z=p(A.id),k=a===A.id;return e.jsxs("div",{onClick:()=>r(k?null:A.id),style:{padding:"5px 10px 5px "+(12+z*16)+"px",display:"flex",alignItems:"center",gap:6,cursor:"pointer",background:k?"#F0F0F0":"transparent",borderLeft:k?`3px solid ${A.color||"#555"}`:"3px solid transparent",borderBottom:`1px solid ${E.border}`,transition:"background .1s"},children:[e.jsx("span",{style:{fontSize:14,flexShrink:0},children:A.icon||""}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:A.color||"#555",textTransform:"uppercase",letterSpacing:.3,lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:A.cargo}),e.jsx("div",{style:{fontSize:10,color:E.ink,lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:A.nombre||e.jsx("span",{style:{color:"#CCC",fontStyle:"italic"},children:"Sin asignar"})})]}),e.jsx("button",{onClick:T=>{T.stopPropagation(),j(A.id)},title:"Aadir subordinado",style:{background:"none",border:"none",cursor:"pointer",color:A.color||"#555",padding:2,fontSize:14},children:"+"})]},A.id)}),o.length===0&&e.jsx("div",{style:{padding:"16px 12px",textAlign:"center",color:"#CCC",fontSize:11},children:"Selecciona una plantilla o aade un cargo"}),e.jsx("div",{style:{padding:"6px 12px"},children:e.jsx("button",{onClick:()=>j(null),style:{width:"100%",padding:"5px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px dashed ${E.border}`,borderRadius:4,background:"#fff",color:E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir cargo raz"})})]}),v&&e.jsxs(Ke,{style:{padding:14,marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:700,color:v.color||"#555"},children:["Editar: ",v.cargo]}),e.jsx("button",{onClick:()=>r(null),style:{background:"none",border:"none",cursor:"pointer",color:E.inkLight,padding:2},children:e.jsx($t,{size:14})})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Cargo"}),e.jsx("input",{value:v.cargo,onChange:A=>S(v.id,"cargo",A.target.value),style:{...f,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Nombre"}),e.jsx("input",{value:v.nombre||"",onChange:A=>S(v.id,"nombre",A.target.value),placeholder:"Nombre completo",style:{...f,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Contacto"}),e.jsx("input",{value:v.contacto||"",onChange:A=>S(v.id,"contacto",A.target.value),placeholder:"Tel o email",style:{...f,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Reporta a"}),e.jsxs("select",{value:v.parentId||"",onChange:A=>S(v.id,"parentId",A.target.value||null),style:{...f,width:"100%"},children:[e.jsx("option",{value:"",children:" Raz (sin jefe) "}),o.filter(A=>A.id!==v.id).map(A=>e.jsxs("option",{value:A.id,children:[A.cargo," ",A.nombre?`(${A.nombre})`:""]},A.id))]})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Icono"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:g.map(A=>e.jsx("button",{onClick:()=>S(v.id,"icon",A),style:{width:24,height:24,border:`1px solid ${v.icon===A?"#111":"#E0E0E0"}`,borderRadius:3,background:v.icon===A?"#F5F4F1":"#fff",cursor:"pointer",fontSize:12,display:"flex",alignItems:"center",justifyContent:"center"},children:A},A))})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Color"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:l.map(A=>e.jsx("button",{onClick:()=>S(v.id,"color",A),style:{width:20,height:20,borderRadius:3,background:A,cursor:"pointer",border:v.color===A?"2px solid #111":"2px solid #E0E0E0"}},A))})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>j(v.id),style:{flex:1,padding:"5px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${E.border}`,borderRadius:4,background:"#fff",color:E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Subordinado"}),e.jsx("button",{onClick:()=>w(v.id),style:{padding:"5px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:"1px solid #C44",borderRadius:4,background:"#FEE",color:"#C44",fontFamily:"'DM Sans',sans-serif"},children:e.jsx(qe,{size:10})})]})]})]}),e.jsx(Ke,{style:{flex:1,padding:20,overflowX:"auto",minHeight:300},children:o.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx(wd,{size:32,style:{color:E.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:E.inkLight,fontSize:13,margin:"0 0 12px"},children:"Selecciona una plantilla para comenzar"}),e.jsx("div",{style:{display:"flex",gap:6,justifyContent:"center",flexWrap:"wrap"},children:Object.entries(u).map(([A,z])=>e.jsx(ht,{sm:!0,v:"sec",on:()=>b(A),children:z.label},A))})]}):e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:8,paddingBottom:20},children:m.map(A=>e.jsx(y,{node:A},A.id))})})]})]})}function qh({d:t,r:i}){const o=t.tipoProyecto==="OBRA",n=t.modoCalcObra||"margen",a=i.U||0,r=[{l:"Costo directo total (CD)",v:i.COSTO,b:!0},{l:" Materiales (M)",v:i.cdM,sub:!0},{l:" Mano de obra (MO)",v:i.cdMO,sub:!0},{l:" Subcontratas (SUB)",v:i.cdSB,sub:!0},...t.tipoProyecto==="DISEO"?[{l:" Diseo APU",v:i.costoDis,sub:!0}]:[],null,{l:"Gastos de contratacin (GC) "+et(i.g),v:i.GC},{l:" Plizas (RCE+TRC+Adm)",v:((t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0))*i.PVP,sub:!0},{l:" ICA",v:i.ICA,sub:!0},{l:"Gastos financieros (GF) "+et(i.f),v:i.fin},null,{l:`Margen objetivo ${et(t.margen)}`,v:i.margenCOP,b:!0,col:E.success},...o?[{l:` Utilidad declarada para IVA (U): ${et(a)}${n==="aiu"?" (AIU)":" (manual)"}`,v:a*i.PVP,sub:!0,col:"#3B3B3B"},{l:n==="aiu"?` AIU: A ${et(t.aiuA||.08)} + I ${et(t.aiuI||.03)} + U ${et(t.aiuU||.07)} = ${et((t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))}`:` Margen ${et(t.margen)} sobre PVP  U para IVA: ${et(a)}`,v:null,sub:!0,note:!0}]:[],null,{l:"PVP sin IVA",v:i.PVP,b:!0},{l:o?`IVA ${et(t.tarifaIVA)} sobre U ${et(a)} del PVP`:t.pais==="ES"?`IVA ${et(t.tarifaIVA)} (Espaa)`:`IVA ${et(t.tarifaIVA)} pleno (DISEO)`,v:i.IVA,sub:!0},{l:"PVP con IVA",v:i.PVP_IVA,b:!0,col:E.ink}];return e.jsxs("div",{className:"fade",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(Ke,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${E.border}`},children:e.jsx(vt,{t:"Desglose de costos",s:"Construccin del precio de venta"})}),e.jsx("div",{style:{padding:"6px 0"},children:r.map((s,d)=>s===null?e.jsx("div",{style:{borderTop:`1px solid ${E.border}`,margin:"6px 0"}},d):e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"7px 20px",background:s.b&&!s.sub?E.accentBg:""},children:[e.jsx("span",{style:{fontSize:s.sub?11:12,color:s.col||E.inkMid,paddingLeft:s.sub?12:0,fontWeight:s.b?700:400},children:s.l}),s.v!=null&&e.jsx("span",{style:{fontSize:s.sub?11:12,color:s.col||E.ink,fontWeight:s.b?700:500,fontFamily:"'DM Mono',monospace"},children:Je(s.v)})]},d))}),e.jsxs("div",{style:{borderTop:`2px solid ${E.border}`,padding:"14px 20px",background:"#F5F4F1"},children:[e.jsx("p",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,margin:"0 0 8px"},children:"Coeficientes aplicados"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8},children:[["Den. (1MGC)",(i.den1||0).toFixed(4)],["Den. (1GF)",(i.denGF||0).toFixed(4)],["Den. total",(i.den||0).toFixed(4)],["Coef. ",(i.coefMult||0).toFixed(4)]].map(([s,d])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"#999",marginBottom:2},children:s}),e.jsx("div",{style:{fontSize:11,fontWeight:600,fontFamily:"'DM Mono',monospace"},children:d})]},s))})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{style:{background:E.ink,borderRadius:3,padding:"28px 28px"},children:[e.jsx("p",{style:{margin:"0 0 6px",fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:"rgba(255,255,255,0.4)"},children:"PVP Total al cliente"}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:40,fontWeight:700,color:"#fff",margin:"0 0 10px",letterSpacing:-1},children:Je(i.PVP_IVA)}),e.jsxs("p",{style:{fontSize:10,color:"rgba(255,255,255,0.4)",margin:0},children:["IVA ",et(t.tarifaIVA),"  Modo ",t.tipoProyecto,o&&`  U declarada ${et(a)}`,t.tipoProyecto==="DISEO"&&`  ${t.subtipoDiseno}`]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[["PVP sin IVA",Je(i.PVP),E.ink],["IVA",Je(i.IVA),E.info],["Margen ("+et(t.margen)+")",Je(i.margenCOP),E.success],...o?[["Utilidad decl. ("+et(a)+")",Je(a*i.PVP),"#3B3B3B"]]:[],["Retenciones",Je(i.ret),E.warning],["Neto a recibir",Je(i.neto),E.ink]].map(([s,d,u])=>e.jsxs(Ke,{style:{padding:"13px 16px"},children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:1},children:s}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:u,margin:0},children:d})]},s))}),e.jsxs(Ke,{style:{padding:16},children:[e.jsx("p",{style:{fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,margin:"0 0 10px"},children:"Parmetros aplicados"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:[`Margen ${et(t.margen)}`,...o?[`U decl. ${et(a)}`]:[],`IVA ${et(t.tarifaIVA)}`,t.medioPago,t.aplicar4x1000==="SI"?"41000":"Sin 41000",`GC ${et(i.g||0)}`,`GF ${et(i.f||0)}`,`Coef. ${(i.coefMult||0).toFixed(4)}`].map(s=>e.jsx("span",{style:{background:E.accentBg,color:E.inkMid,fontSize:10,padding:"3px 8px",borderRadius:2,letterSpacing:.4},children:s},s))})]})]})]})}function Hh({d:t,set:i,r:o}){var ue,N,G;const n=(L,ae)=>t["ent_"+L]??ae,a=(L,ae)=>i("ent_"+L,ae),r=t.tipoProyecto==="OBRA",s=t.condPct4??.1,d=(L,ae,pe=3)=>e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:n(L,ae),rows:pe,onChange:he=>a(L,he.target.value),style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical",lineHeight:1.5,background:E.bg,color:E.ink}}),e.jsx("div",{className:"ptr",style:{fontSize:12,lineHeight:1.6},children:n(L,ae)})]}),u=(L,ae)=>e.jsx("input",{value:n(L,ae),onChange:pe=>a(L,pe.target.value),style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:4,padding:"7px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:E.bg,color:E.ink}}),b=L=>e.jsx("p",{className:"no-print",style:{fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,margin:"0 0 5px"},children:L}),j=L=>e.jsx("p",{style:{fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:1,margin:"0 0 5px"},children:L}),[w,S]=F.useState(t.ent_nivelDetalle||"capitulos"),m=L=>{S(L),i("ent_nivelDetalle",L)},[x,p]=F.useState(t.ent_inclCrono??!1),[c,g]=F.useState(t.ent_inclOrganigrama??!1),l=(L,ae,pe)=>{pe(ae),i("ent_"+L,ae)},f=t.borradorLineas||[],h=f.filter(L=>L.esCapitulo).map(L=>{const ae=f.indexOf(L),pe=f.findIndex((q,I)=>I>ae&&q.esCapitulo),he=f.slice(ae+1,pe===-1?f.length:pe).filter(q=>!q.esCapitulo),ze=he.reduce((q,I)=>{const $=I.precioCD?Ht(I.precioCD,I.cantidad||1,t):null;return q+($?$.totalVenta:0)},0);return{...L,total:ze,items:he}}),v=t.firmaRepresentante||"David Parra Galera",A=v==="Ana Mara Daz Buitrago"?"Directora Creativa y de Diseo":"Director Ejecutivo y de Produccin",z=n("titulo",r?"PRESUPUESTO DE EJECUCIN":"PROPUESTA DE DISEO"),k=n("ref",t.codigoOferta||""),T=n("cliente",t.cliente||""),C=n("fecha",t.fechaOferta||Dt()),D=t.revision||1,K=()=>{const ae=[k,t.proyecto||"Habitaris",`Rev${D}`].filter(Boolean).join("_").replace(/[^a-zA-Z0-9_\-]/g,"_");document.title=ae,window.print(),setTimeout(()=>{document.title="Habitaris Suite"},1500)},oe=L=>{const pe={obra_integral:{titulo:"PRESUPUESTO DE EJECUCIN",alcance:`El presente alcance comprende la ejecucin integral del proyecto ${t.proyecto||""}, incluyendo:

1. OBRA CIVIL: Demoliciones selectivas, mampostera, paetes, nivelacin de pisos y cielos.
2. INSTALACIONES: Red hidrosanitaria, red elctrica y puntos de datos segn planos tcnicos aprobados.
3. ACABADOS: Suministro e instalacin de pisos, enchapes, pintura, carpintera en madera y metlica.
4. MOBILIARIO FIJO: Cocina integral, closets, muebles de bao y dems mobiliario fijo segn diseo.
5. SUPERVISIN: Direccin de obra, control de calidad, coordinacin de subcontratistas y proveedores.

El proyecto se ejecutar en la direccin ${t.ubicacion||"___"} conforme a los diseos previamente aprobados por el cliente.`,fases:`1. Firma de contrato y pago de anticipo
2. Acta de inicio de obra
3. Demoliciones y obra negra
4. Instalaciones tcnicas (hidrosanitaria, elctrica, gas)
5. Obra gris (paetes, nivelacin, impermeabilizacin)
6. Acabados (pisos, enchapes, pintura)
7. Carpintera y mobiliario fijo
8. Aseo final y entrega
9. Acta de recepcin y cierre`,exclusiones:`Esta propuesta NO incluye, salvo acuerdo escrito:

- Licencias y permisos de construccin
- Obra de estructura o cimentacin no contemplada en diseos
- Suministro e instalacin de electrodomsticos
- Mudanzas y trasteos
- Diseo o rediseo (ya aprobado previamente)
- Adecuaciones en zonas comunes del edificio
- Amoblamiento libre (sofs, camas, mesas, sillas)

Todos los entregables se comparten exclusivamente en formato digital.`,condPago:`Forma de pago:

1. ${((t.condPct1||.5)*100).toFixed(0)}% Anticipo contra firma de contrato
2. ${((t.condPct2||.3)*100).toFixed(0)}% Contra avance del 50% de obra
3. ${((t.condPct3||.1)*100).toFixed(0)}% Contra finalizacin de obra
4. ${(s*100).toFixed(0)}% Retencin de garanta (a 3 meses)`,plazo:`El plazo de ejecucin estimado es de ${t.plazoSemanas||12} semanas calendario contadas a partir del acta de inicio de obra.`,garantias:`Habitaris garantiza los trabajos ejecutados por un perodo de 12 meses contados a partir del acta de entrega final:

- Estabilidad y solidez de obra civil: 10 aos segn Ley 1796 de 2016
- Impermeabilizacin: 5 aos
- Acabados y revestimientos: 1 ao
- Instalaciones hidrosanitarias y elctricas: 1 ao
- Carpintera y mobiliario fijo: 1 ao

La garanta no cubre daos por uso inadecuado, modificaciones del cliente o fuerza mayor.`},obra_parcial:{titulo:"PRESUPUESTO DE EJECUCIN PARCIAL",alcance:`El presente alcance comprende la ejecucin parcial de obras en el proyecto ${t.proyecto||""}, limitado a las partidas descritas en el presupuesto adjunto.

Los trabajos se realizarn conforme a los planos y especificaciones tcnicas proporcionados por el cliente o su equipo de diseo.

Habitaris actuar como ejecutor de las obras descritas, sin responsabilidad sobre el diseo ni sobre partidas no incluidas en esta propuesta.`,fases:`1. Firma de contrato y pago de anticipo
2. Programacin y alistamiento de obra
3. Ejecucin de partidas contratadas
4. Control de calidad y verificacin
5. Entrega y acta de recepcin`,exclusiones:`Esta propuesta NO incluye:

- Diseo arquitectnico o de interiores
- Partidas no listadas explcitamente en el presupuesto
- Licencias, permisos o trmites ante entidades
- Interventora externa
- Suministro de electrodomsticos o amoblamiento

Cualquier trabajo adicional ser cotizado por separado.`,condPago:`Forma de pago:

1. ${((t.condPct1||.5)*100).toFixed(0)}% Anticipo contra firma de contrato
2. ${((t.condPct2||.3)*100).toFixed(0)}% Contra avance del 50%
3. ${((t.condPct3||.1)*100).toFixed(0)}% Contra finalizacin
4. ${(s*100).toFixed(0)}% Retencin de garanta`,plazo:`El plazo de ejecucin estimado es de ${t.plazoSemanas||8} semanas calendario.`,garantias:"Garanta de 12 meses sobre los trabajos ejecutados, contados desde el acta de entrega."},diseno_int:{titulo:"PROPUESTA DE DISEO INTERIOR",alcance:`Diseo interior integral del proyecto ${t.proyecto||""} ubicado en ${t.ubicacion||"___"}.

El servicio incluye:

1. LEVANTAMIENTO: Visita tcnica, toma de medidas y registro fotogrfico del estado actual.
2. CONCEPTUALIZACIN: Desarrollo de concepto de diseo, moodboards, paleta de materiales y colores.
3. DISEO BSICO: Plantas de distribucin, propuesta de mobiliario, iluminacin general.
4. DISEO DETALLADO: Planos tcnicos de construccin (plantas, cortes, detalles), especificaciones de acabados, cuadros de cantidades.
5. RENDERS: Visualizaciones 3D de los espacios principales.
6. ACOMPAAMIENTO: Seguimiento durante la ejecucin de obra.`,fases:`1. Firma de contrato y anticipo
2. Levantamiento y mediciones
3. Concepto de diseo y moodboard
4. Presentacin de diseo bsico
5. Aprobacin del cliente
6. Desarrollo de planos tcnicos
7. Entrega de planos y especificaciones
8. Acompaamiento en obra (si aplica)`,exclusiones:`Esta propuesta NO incluye:

- Ejecucin de obra civil o instalaciones
- Suministro o compra de materiales, mobiliario o equipos
- Diseo estructural o de ingeniera especializada
- Renders adicionales a los incluidos
- Trmites de licencias urbansticas
- Interventora de obra

Todos los entregables se comparten en formato digital.`,condPago:`Forma de pago:

1. 50% Anticipo contra firma de contrato
2. 30% Contra entrega de diseo bsico aprobado
3. 20% Contra entrega de planos tcnicos finales`,plazo:`El plazo de desarrollo es de ${t.plazoSemanas||6} semanas a partir de la aprobacin del concepto.`,garantias:"Los entregables de diseo se entregan en formato digital editable. Se incluyen hasta 2 rondas de ajustes por etapa. Modificaciones adicionales se cotizarn por separado."},diseno_arq:{titulo:"PROPUESTA DE DISEO ARQUITECTNICO",alcance:`Diseo arquitectnico del proyecto ${t.proyecto||""} ubicado en ${t.ubicacion||"___"}.

1. ESQUEMA BSICO: Anlisis del programa, zonificacin, volumetra.
2. ANTEPROYECTO: Plantas, fachadas, cortes y perspectivas.
3. PROYECTO: Planos definitivos, detalles constructivos, memorias.
4. COORDINACIN: Integracin con ingenieras.`,fases:`1. Visita al sitio y levantamiento
2. Programa arquitectnico
3. Esquema bsico
4. Anteproyecto
5. Proyecto definitivo
6. Coordinacin tcnica
7. Entrega final`,exclusiones:"NO incluye estudios de suelos, topografa, diseo estructural, hidrosanitario, elctrico, licencias de construccin ni ejecucin de obra.",condPago:`1. 40% Anticipo
2. 30% Contra entrega de anteproyecto
3. 30% Contra entrega de proyecto definitivo`,plazo:`Plazo estimado: ${t.plazoSemanas||8} semanas.`,garantias:"Entregables en formato digital. 2 rondas de ajustes incluidas por etapa."},consultoria:{titulo:"PROPUESTA DE CONSULTORA",alcance:`Consultora especializada para el proyecto ${t.proyecto||""}.

1. Diagnstico y anlisis del estado actual
2. Propuesta de intervencin con alternativas
3. Estimacin presupuestal
4. Informe tcnico con recomendaciones
5. Acompaamiento en la toma de decisiones`,fases:`1. Reunin de inicio
2. Visita tcnica
3. Anlisis y diagnstico
4. Presentacin de alternativas
5. Informe final`,exclusiones:"NO incluye desarrollo de planos tcnicos, ejecucin de obras ni compra de materiales.",condPago:`1. 50% Anticipo
2. 50% Contra entrega de informe final`,plazo:`Plazo estimado: ${t.plazoSemanas||4} semanas.`,garantias:"Informe entregado en formato digital."},custom:{titulo:"",alcance:"",fases:"",exclusiones:"",condPago:"",plazo:"",garantias:""}}[L];pe&&(pe.titulo&&a("titulo",pe.titulo),a("alcance",pe.alcance),a("fases",pe.fases),a("exclusiones",pe.exclusiones),pe.condPago&&a("condPago",pe.condPago),pe.plazo&&a("plazo",pe.plazo),pe.garantias&&a("garantias",pe.garantias))},te=()=>{const L=window.open("","_blank"),ae=`@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    @page{size:A4 portrait;margin:15mm 18mm}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'DM Sans',sans-serif;color:#1A1A1A;font-size:10px;line-height:1.6}
    .cover{min-height:100vh;display:flex;flex-direction:column;justify-content:space-between;padding:40px 50px;page-break-after:always}
    .cover-brand{border-bottom:3px solid #111;padding-bottom:16px}
    .cover-brand h1{font-size:36px;font-weight:800;letter-spacing:10px;text-transform:uppercase}
    .cover-brand p{font-size:8px;letter-spacing:3px;color:#888;text-transform:uppercase;margin-top:4px}
    .cover-title{margin:80px 0}
    .cover-title h2{font-size:26px;font-weight:700;letter-spacing:3px;text-transform:uppercase;line-height:1.3;color:#111}
    .cover-title .ref{font-size:13px;color:#666;margin-top:10px}
    .cover-info{font-size:12px;color:#444;line-height:2}
    .cover-info strong{color:#111}
    .cover-footer{border-top:1px solid #DDD;padding-top:16px;text-align:center}
    .cover-footer p{font-size:8px;color:#999;letter-spacing:1px}
    .toc{padding:40px 50px;page-break-after:always}
    .toc h2{font-size:18px;font-weight:700;letter-spacing:3px;text-transform:uppercase;border-bottom:3px solid #111;padding-bottom:8px;margin-bottom:24px}
    .toc-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dotted #CCC;font-size:12px}
    .toc-item span:first-child{font-weight:600}
    .toc-item span:last-child{font-family:'DM Mono',monospace;color:#888;font-size:10px}
    .page{padding:30px 50px;page-break-after:always;min-height:90vh}
    .page-header{display:flex;justify-content:space-between;align-items:flex-end;padding-bottom:8px;border-bottom:2px solid #111;margin-bottom:20px}
    .page-header .brand{font-weight:700;font-size:12px;letter-spacing:4px}
    .page-header .meta{text-align:right;font-size:8px;color:#666}
    .section-title{font-size:16px;font-weight:700;letter-spacing:1px;color:#111;margin:20px 0 10px;padding-bottom:4px;border-bottom:1px solid #E0E0E0}
    .section-num{color:#888;font-weight:400;margin-right:8px}
    .content{font-size:11px;line-height:1.8;color:#333;white-space:pre-wrap}
    table{width:100%;border-collapse:collapse;margin:10px 0}
    th{background:#F5F4F1;padding:8px 12px;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;letter-spacing:.5px;text-align:left;border-bottom:2px solid #DDD}
    td{padding:7px 12px;font-size:10px;border-bottom:1px solid #F5F5F5}
    .mono{font-family:'DM Mono',monospace}
    .r{text-align:right}
    .bold{font-weight:700}
    .total-row{background:#111;color:#fff}
    .total-row td{color:#fff;font-weight:700;font-size:12px;padding:10px 12px}
    .iva-row{background:#F5F4F1}
    .sign-block{margin-top:40px;display:grid;grid-template-columns:1fr 1fr;gap:40px}
    .sign-box{text-align:center;padding-top:40px;border-top:1px solid #111}
    .sign-box .name{font-size:11px;font-weight:700}
    .sign-box .role{font-size:9px;color:#666}
    .doc-footer{position:fixed;bottom:10mm;left:18mm;right:18mm;display:flex;justify-content:space-between;font-size:7px;color:#AAA;border-top:1px solid #E0E0E0;padding-top:4px}`,pe=`<div class="page-header"><div class="brand">HABITARIS</div><div class="meta"><div>${z}</div><div>${k}  Rev.${D}  ${C}</div></div></div>`;let he=`<html><head><title>${k} - ${t.proyecto||"Habitaris"}</title><style>${ae}</style></head><body>`;he+='<div class="cover">',he+='<div class="cover-brand"><h1>HABITARIS</h1><p>Arquitectura  Interiorismo  Construccin</p></div>',he+=`<div class="cover-title"><h2>${z}</h2>`,he+=`<div class="ref">${k}  Revisin ${D}</div></div>`,he+='<div class="cover-info">',T&&(he+=`<div><strong>Cliente:</strong> ${T}</div>`),t.proyecto&&(he+=`<div><strong>Proyecto:</strong> ${t.proyecto}</div>`),t.ubicacion&&(he+=`<div><strong>Ubicacin:</strong> ${t.ubicacion}</div>`),he+=`<div><strong>Fecha:</strong> ${C}</div>`,he+="<div><strong>Vigencia:</strong> 30 das calendario</div></div>",he+='<div class="cover-footer"><p>Habitaris S.A.S  NIT 901.922.136-8  Bogot D.C.</p><p>Documento confidencial  Uso exclusivo del destinatario</p></div>',he+="</div>";let ze=0;const q=[];q.push("Alcance del servicio"),r&&q.push("Fases del proyecto"),q.push("Exclusiones"),q.push("Presupuesto"),t.ent_inclCondPago!==!1&&q.push("Condiciones de pago"),t.ent_inclGarantias!==!1&&q.push("Plazo y garantas"),q.push("Trminos y condiciones"),q.push("Firma de aceptacin"),he+='<div class="toc"><h2>Contenido</h2>',q.forEach((I,$)=>{he+=`<div class="toc-item"><span>${$+1}. ${I}</span><span>${$+2}</span></div>`}),he+="</div>",he+=`<div class="page">${pe}`,ze++,he+=`<div class="section-title"><span class="section-num">${ze}.</span>Alcance del servicio</div>`,he+=`<div class="content">${n("alcance","")}</div>`,r&&(ze++,he+=`<div class="section-title"><span class="section-num">${ze}.</span>Fases del proyecto</div>`,he+=`<div class="content">${n("fases","")}</div>`),ze++,he+=`<div class="section-title"><span class="section-num">${ze}.</span>Exclusiones</div>`,he+=`<div class="content">${n("exclusiones","")}</div>`,he+="</div>",he+=`<div class="page">${pe}`,ze++,he+=`<div class="section-title"><span class="section-num">${ze}.</span>Presupuesto</div>`,w==="total"?(he+='<table><thead><tr><th>Item</th><th>Descripcin</th><th class="r">Valor</th></tr></thead><tbody>',he+=`<tr><td>1</td><td>${n("descTotal",t.proyecto||"Proyecto")}</td><td class="mono r bold">${Je(o.PVP)}</td></tr>`,he+=`<tr class="iva-row"><td colspan="2">${r?"IVA sobre la utilidad":`IVA ${et(t.tarifaIVA)}`}</td><td class="mono r">${Je(o.IVA)}</td></tr>`,he+=`<tr class="total-row"><td colspan="2">VALOR TOTAL</td><td class="mono r">${Je(o.PVP_IVA)}</td></tr>`,he+="</tbody></table>"):w==="capitulos"?(he+='<table><thead><tr><th>Item</th><th>Descripcin</th><th class="r">Total</th></tr></thead><tbody>',h.forEach((I,$)=>{he+=`<tr><td class="bold">${$+1}</td><td class="bold">${I.nombre||"Captulo "+($+1)}</td><td class="mono r bold">${Je(I.total)}</td></tr>`}),he+=`<tr style="border-top:2px solid #111;background:#FFFFFF"><td colspan="2" class="bold">Subtotal</td><td class="mono r bold">${Je(o.PVP)}</td></tr>`,he+=`<tr class="iva-row"><td colspan="2">${r?"IVA sobre la utilidad":`IVA ${et(t.tarifaIVA)}`}</td><td class="mono r">${Je(o.IVA)}</td></tr>`,he+=`<tr class="total-row"><td colspan="2">VALOR TOTAL</td><td class="mono r">${Je(o.PVP_IVA)}</td></tr>`,he+="</tbody></table>"):(he+='<table><thead><tr><th>#</th><th>Descripcin</th><th class="r">Und</th><th class="r">Cant</th><th class="r">P.U.</th><th class="r">Total</th></tr></thead><tbody>',h.forEach((I,$)=>{he+=`<tr style="background:#F5F4F1"><td class="bold" colspan="5">${$+1}. ${I.nombre||""}</td><td class="mono r bold">${Je(I.total)}</td></tr>`,(I.items||[]).forEach((H,U)=>{const _=H.precioCD?Ht(H.precioCD,H.cantidad||1,t):null;he+=`<tr><td>${$+1}.${U+1}</td><td>${H.descripcion||""}</td><td class="r">${H.und||"ud"}</td>`,he+=`<td class="mono r">${H.cantidad||1}</td><td class="mono r">${_?Je(_.puVenta):""}</td><td class="mono r">${_?Je(_.totalVenta):""}</td></tr>`})}),he+=`<tr style="border-top:2px solid #111;background:#FFFFFF"><td colspan="5" class="bold">Subtotal</td><td class="mono r bold">${Je(o.PVP)}</td></tr>`,he+=`<tr class="iva-row"><td colspan="5">${r?"IVA sobre la utilidad":`IVA ${et(t.tarifaIVA)}`}</td><td class="mono r">${Je(o.IVA)}</td></tr>`,he+=`<tr class="total-row"><td colspan="5">VALOR TOTAL</td><td class="mono r">${Je(o.PVP_IVA)}</td></tr>`,he+="</tbody></table>"),he+='<div style="margin-top:16px;padding:10px 14px;background:#F5F4F1;border-radius:4px;font-size:9px;color:#666">',he+=`Valores expresados en ${t.divisa||"COP"}. ${r?"IVA calculado sobre la utilidad segn normativa colombiana.":"IVA incluido segn tarifa vigente."} Propuesta vlida por 30 das calendario.</div>`,he+="</div>",t.ent_inclCondPago!==!1&&(he+=`<div class="page">${pe}`,ze++,he+=`<div class="section-title"><span class="section-num">${ze}.</span>Condiciones de pago</div>`,he+=`<div class="content">${n("condPago","")}</div>`),t.ent_inclGarantias!==!1&&(t.ent_inclCondPago===!1&&(he+=`<div class="page">${pe}`),ze++,he+=`<div class="section-title"><span class="section-num">${ze}.</span>Plazo y garantas</div>`,he+=`<div class="content">${n("plazo","")}</div>`,he+=`<div style="margin-top:10px" class="content">${n("garantias","")}</div>`),ze++,he+=`<div class="section-title"><span class="section-num">${ze}.</span>Trminos y condiciones</div>`,he+=`<div class="content">${n("terminos",`Los precios incluyen materiales, mano de obra, herramienta y administracin segn lo descrito en el alcance.

Cualquier trabajo no contemplado en esta propuesta se cotizar como adicional previo a su ejecucin y deber ser aprobado por escrito.

El cronograma propuesto podr ajustarse por causas de fuerza mayor, cambios solicitados por el cliente o condiciones no previstas del inmueble.`)}</div>`,(t.ent_inclCondPago!==!1||t.ent_inclGarantias!==!1)&&(he+="</div>"),he+=`<div class="page">${pe}`,ze++,he+=`<div class="section-title"><span class="section-num">${ze}.</span>Firma de aceptacin</div>`,he+='<div style="font-size:11px;line-height:1.8;color:#333;margin:16px 0 30px">',he+="Con la firma del presente documento, el Cliente acepta los trminos y condiciones descritos en esta propuesta, ",he+="y autoriza a Habitaris S.A.S. a proceder con la ejecucin del servicio de acuerdo al alcance, presupuesto y plazos aqu establecidos.</div>",he+='<div class="sign-block">',he+=`<div class="sign-box"><div class="name">${v}</div><div class="role">${A}</div><div style="font-size:8px;color:#888;margin-top:2px">Habitaris S.A.S.  NIT 901.922.136-8</div></div>`,he+=`<div class="sign-box"><div class="name">${T||"________________________"}</div><div class="role">Cliente</div><div style="font-size:8px;color:#888;margin-top:2px">Firma y fecha de aceptacin</div></div>`,he+="</div>",he+='<div style="margin-top:40px;padding:14px;background:#F5F4F1;border-radius:4px;font-size:9px;color:#666;text-align:center">',he+="Habitaris S.A.S.  NIT 901.922.136-8  Bogot D.C., Colombia<br/>",he+="info@habitaris.co  +57 318 381 8736  www.habitaris.co</div>",he+="</div>",he+="</body></html>",L.document.write(he),L.document.close(),setTimeout(()=>L.print(),500)},[P,ie]=F.useState([]),[me,Q]=F.useState([]),[je,re]=F.useState(!0),[J,M]=F.useState(""),[B,V]=F.useState(t.wf_usuario||"david");F.useEffect(()=>{(async()=>{if(!t.id){re(!1);return}const[L,ae]=await Promise.all([Pl.getByOferta(t.id),Uu.getByOferta(t.id)]);ie(L),Q(ae),re(!1)})()},[t.id]);const X=F.useMemo(()=>{if(P.length===0)return"borrador";const L=P[P.length-1];return L.accion==="solicitar"?"pendiente_aprobacion":L.accion==="aprobar_interno"?"aprobada_internamente":L.accion==="devolver_interno"?"devuelta_internamente":L.accion==="enviar"?"enviada":L.accion==="aprobar_cliente"?"aprobada_cliente":L.accion==="rechazar_cliente"?"rechazada_cliente":L.accion==="devolver_cliente"?"devuelta_cliente":L.accion==="reenviar"?"enviada":"borrador"},[P]),R=Qo.find(L=>L.id===B),W=(()=>{if(B==="david")return Qo.find(ae=>ae.id==="ana");if(B==="ana")return Qo.find(ae=>ae.id==="david");const L=t.firmaRepresentante||"David Parra Galera";return Qo.find(ae=>ae.nombre===L)||Qo[0]})(),se=async(L,ae={})=>{const pe=await Pl.add({ofertaId:t.id,tipo:L.includes("cliente")?"cliente":"interna",revision:D,accion:L,por:{id:B,nombre:(R==null?void 0:R.nombre)||B,cargo:(R==null?void 0:R.cargo)||""},comentarios:J,...ae});ie(he=>[...he,pe]),M(""),L==="aprobar_cliente"&&i("estado","Ganada"),L==="rechazar_cliente"&&i("estado","Perdida"),(L==="enviar"||L==="reenviar")&&i("estado","Presentada"),L==="solicitar"&&i("estado","En revisin"),L==="solicitar"&&await Vu.add({tipo:"aprobacion",ofertaId:t.id,mensaje:`${R==null?void 0:R.nombre} solicita aprobacin de ${k}`,para:W==null?void 0:W.id})},le=async()=>{const L={ref:k,titulo:z,cliente:T,proyecto:t.proyecto||"",ubicacion:t.ubicacion||"",fecha:C,revision:D,pvp:o.PVP,pvpIva:o.PVP_IVA,iva:o.IVA,divisa:t.divisa||"COP",alcance:n("alcance",""),fases:n("fases",""),exclusiones:n("exclusiones",""),condPago:n("condPago",""),plazo:n("plazo",""),garantias:n("garantias",""),terminos:n("terminos",""),notaLegal:n("notaLegal",""),firmante:v,clienteEmail:t.emailCliente||"",telHabitaris:"573183818736"},ae=t.wf_lastPortalToken||null,pe=await Ku(t.id,L,D,ae);return Q(he=>[...he,pe]),await se("enviar",{portalToken:pe.token}),i("wf_lastPortalUrl",pe.portalUrl),i("wf_lastPortalToken",pe.token),pe},de={borrador:{label:"Borrador",color:"#888",icon:"",desc:"En elaboracin"},pendiente_aprobacion:{label:"Pendiente aprobacin",color:"#D4840A",icon:"",desc:`Esperando aprobacin de ${(W==null?void 0:W.nombre)||""}`},devuelta_internamente:{label:"Devuelta con cambios",color:"#B91C1C",icon:"",desc:"Requiere correcciones antes de aprobar"},aprobada_internamente:{label:"Aprobada internamente",color:"#111111",icon:"",desc:"Lista para enviar al cliente"},enviada:{label:"Enviada al cliente",color:"#3B3B3B",icon:"",desc:"Esperando respuesta del cliente"},aprobada_cliente:{label:"Aprobada por cliente",color:"#111111",icon:"",desc:"Oferta ganada!"},rechazada_cliente:{label:"Rechazada por cliente",color:"#B91C1C",icon:"",desc:"Cliente rechaz la propuesta"},devuelta_cliente:{label:"Devuelta por cliente",color:"#D4840A",icon:"",desc:"Cliente solicita cambios"}},Z=de[X]||de.borrador;return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{className:"p-cover",children:[e.jsxs("div",{style:{borderBottom:"2pt solid #111",paddingBottom:16,marginBottom:40,width:"100%"},children:[e.jsx("div",{style:{fontFamily:"'DM Sans',sans-serif",fontWeight:800,fontSize:32,letterSpacing:8,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:9,letterSpacing:3,color:"#999",textTransform:"uppercase",marginTop:4},children:"Arquitectura  Interiorismo  Construccin"})]}),e.jsxs("div",{style:{marginTop:60,marginBottom:60},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700,letterSpacing:2,textTransform:"uppercase",lineHeight:1.3},children:z}),k&&e.jsxs("div",{style:{fontSize:13,color:"#666",marginTop:8},children:[k,"  Revisin ",D]})]}),e.jsxs("div",{style:{marginTop:40,fontSize:12,color:"#555",lineHeight:1.8},children:[T&&e.jsxs("div",{children:[e.jsx("strong",{children:"Cliente:"})," ",T]}),t.proyecto&&e.jsxs("div",{children:[e.jsx("strong",{children:"Proyecto:"})," ",t.proyecto]}),t.ubicacion&&e.jsxs("div",{children:[e.jsx("strong",{children:"Ubicacin:"})," ",t.ubicacion]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",C]})]}),e.jsxs("div",{style:{marginTop:"auto",paddingTop:60,borderTop:"1pt solid #DDD",width:"100%",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:9,color:"#999",letterSpacing:1},children:"Habitaris S.A.S  NIT 901.922.136-8  Bogot D.C."}),e.jsx("div",{style:{fontSize:8,color:"#BBB",marginTop:4},children:"Documento confidencial  Uso exclusivo del destinatario"})]})]}),e.jsxs("div",{className:"print-only print-page-break",style:{paddingTop:20},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700,letterSpacing:2,textTransform:"uppercase",borderBottom:"2pt solid #111",paddingBottom:6,marginBottom:20},children:"Contenido"}),e.jsxs("div",{style:{fontSize:11,lineHeight:2.2},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsx("span",{style:{fontWeight:600},children:"1. Alcance del servicio"})}),r&&e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsx("span",{style:{fontWeight:600},children:"2. Fases del proyecto"})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"3":"2",". Exclusiones"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"4":"3",". Presupuesto"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"5":"4",". Formas de pago"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"6":"5",". Plazo y garantas"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"7":"6",". Trminos y condiciones"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"8":"7",". Firma de aceptacin"]})})]})]}),e.jsxs(Ke,{className:"no-print",style:{padding:0,marginBottom:16,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"14px 20px",background:"#F5F4F1",borderBottom:`1px solid ${E.border}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:10},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Plantilla del servicio"}),e.jsx("div",{style:{display:"flex",gap:0},children:[{id:"obra_integral",lbl:" Obra integral",tipo:"OBRA"},{id:"obra_parcial",lbl:" Obra parcial",tipo:"OBRA"},{id:"diseno_int",lbl:" Diseo interior",tipo:"DISEO"},{id:"diseno_arq",lbl:" Diseo arquitectnico",tipo:"DISEO"},{id:"consultoria",lbl:" Consultora"},{id:"custom",lbl:" En blanco"}].map((L,ae,pe)=>{const he=t.ent_plantilla===L.id;return e.jsx("button",{onClick:()=>{i("ent_plantilla",L.id),oe(L.id)},style:{padding:"7px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${he?"#111111":E.border}`,borderLeft:ae>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:ae===0?"5px 0 0 5px":ae===pe.length-1?"0 5px 5px 0":"0",background:he?"#111111":"#fff",color:he?"#fff":E.ink},children:L.lbl},L.id)})})]}),e.jsxs("button",{onClick:te,style:{padding:"8px 18px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:6},children:[e.jsx(At,{size:12})," Vista previa PDF"]})]})}),e.jsxs("div",{style:{padding:"12px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:600,color:"#999",textTransform:"uppercase",letterSpacing:1,display:"block",marginBottom:4},children:"Nivel de detalle presupuesto"}),e.jsx("div",{style:{display:"flex",gap:0},children:[["detallado","Detallado"],["capitulos","Por captulos"],["total","Total nico"]].map(([L,ae],pe)=>e.jsx("button",{onClick:()=>m(L),style:{padding:"6px 14px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${E.border}`,fontFamily:"'DM Sans',sans-serif",borderRadius:L==="detallado"?"5px 0 0 5px":L==="total"?"0 5px 5px 0":"0",borderLeft:pe>0?"none":void 0,background:w===L?"#111":"#fff",color:w===L?"#fff":"#555"},children:ae},L))})]}),e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",alignItems:"center"},children:[[["inclCrono",x,p," Incluir cronograma"],["inclOrganigrama",c,g," Incluir organigrama"]].map(([L,ae,pe,he])=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:11,padding:"5px 10px",borderRadius:4,background:ae?"#E8F4EE":"#F5F4F1",border:`1px solid ${ae?"#111111":"transparent"}`},children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:ze=>l(L,ze.target.checked,pe),style:{accentColor:"#111111"}}),e.jsx("span",{style:{fontWeight:ae?600:400,color:ae?"#111111":E.inkMid},children:he})]},L)),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:11,padding:"5px 10px",borderRadius:4,background:t.ent_inclCondPago?"#E8F4EE":"#F5F4F1",border:`1px solid ${t.ent_inclCondPago?"#111111":"transparent"}`},children:[e.jsx("input",{type:"checkbox",checked:t.ent_inclCondPago??!0,onChange:L=>i("ent_inclCondPago",L.target.checked),style:{accentColor:"#111111"}}),e.jsx("span",{style:{fontWeight:t.ent_inclCondPago?600:400,color:t.ent_inclCondPago?"#111111":E.inkMid},children:" Condiciones de pago"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:11,padding:"5px 10px",borderRadius:4,background:t.ent_inclGarantias?"#E8F4EE":"#F5F4F1",border:`1px solid ${t.ent_inclGarantias?"#111111":"transparent"}`},children:[e.jsx("input",{type:"checkbox",checked:t.ent_inclGarantias??!0,onChange:L=>i("ent_inclGarantias",L.target.checked),style:{accentColor:"#111111"}}),e.jsx("span",{style:{fontWeight:t.ent_inclGarantias?600:400,color:t.ent_inclGarantias?"#111111":E.inkMid},children:" Garantas"})]})]})]})]}),e.jsxs(Ke,{className:"no-print",style:{padding:0,marginBottom:16,overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"14px 20px",background:Z.color+"12",borderBottom:`2px solid ${Z.color}33`},children:[e.jsx("span",{style:{fontSize:22},children:Z.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:Z.color},children:Z.label}),e.jsx("div",{style:{fontSize:10,color:E.inkMid},children:Z.desc})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:9,color:E.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Revisin"}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:E.ink},children:D})]})]}),e.jsx("div",{style:{display:"flex",padding:"12px 20px",gap:0,overflowX:"auto"},children:[{key:"borrador",lbl:"Borrador",icon:""},{key:"pendiente_aprobacion",lbl:"Revisin interna",icon:""},{key:"aprobada_internamente",lbl:"Aprobada",icon:""},{key:"enviada",lbl:"Enviada",icon:""},{key:"aprobada_cliente",lbl:"Aceptada",icon:""}].map((L,ae,pe)=>{const he=["borrador","pendiente_aprobacion","aprobada_internamente","enviada","aprobada_cliente"],ze=he.indexOf(X),q=he.indexOf(L.key),I=q<=ze,$=L.key===X||X==="devuelta_internamente"&&L.key==="pendiente_aprobacion"||X==="devuelta_cliente"&&L.key==="enviada";return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:70},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:I?"#111111":$?"#D4840A":"#E0E0E0",fontSize:13,transition:"all .2s"},children:I?e.jsx("span",{style:{color:"#fff",fontSize:11},children:""}):e.jsx("span",{children:L.icon})}),e.jsx("span",{style:{fontSize:8,fontWeight:600,color:I?"#111111":$?"#D4840A":"#999",marginTop:3,textAlign:"center",lineHeight:1.2},children:L.lbl})]}),ae<pe.length-1&&e.jsx("div",{style:{width:30,height:2,background:q<ze?"#111111":"#E0E0E0",margin:"0 2px",marginBottom:14}})]},L.key)})}),e.jsxs("div",{style:{padding:"12px 20px 16px",borderTop:`1px solid ${E.border}`},children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Trabajando como:"}),Qo.map(L=>e.jsxs("button",{onClick:()=>{V(L.id),i("wf_usuario",L.id)},style:{padding:"4px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${B===L.id?"#111111":E.border}`,borderRadius:4,background:B===L.id?"#E8F4EE":"#fff",color:B===L.id?"#111111":E.inkMid,fontFamily:"'DM Sans',sans-serif"},children:[L.id==="david"?"":""," ",L.nombre.split(" ")[0]]},L.id))]}),["pendiente_aprobacion","devuelta_internamente","devuelta_cliente"].includes(X)&&e.jsx("div",{style:{marginBottom:10},children:e.jsx("input",{value:J,onChange:L=>M(L.target.value),placeholder:X==="pendiente_aprobacion"?"Observaciones de aprobacin (opcional)...":"Comentarios sobre los cambios realizados...",style:{width:"100%",padding:"8px 12px",border:`1px solid ${E.border}`,borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:"#fff"}})}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[X==="borrador"&&e.jsxs("button",{onClick:()=>se("solicitar"),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#D4840A",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(bn,{size:13})," Solicitar aprobacin a ",(ue=W==null?void 0:W.nombre)==null?void 0:ue.split(" ")[0]]}),X==="pendiente_aprobacion"&&B===(W==null?void 0:W.id)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>se("aprobar_interno"),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#111111",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(ft,{size:13})," Aprobar"]}),e.jsxs("button",{onClick:()=>{if(!J){alert("Escribe las observaciones");return}se("devolver_interno")},style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#FFF8E7",color:"#D4840A",border:"1px solid #D4840A33",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(ca,{size:13})," Devolver con observaciones"]})]}),X==="pendiente_aprobacion"&&B!==(W==null?void 0:W.id)&&e.jsxs("div",{style:{fontSize:11,color:"#D4840A",padding:"8px 0"},children:[" Esperando que ",e.jsx("strong",{children:W==null?void 0:W.nombre})," apruebe. Cambia a su usuario para simular la aprobacin."]}),X==="devuelta_internamente"&&e.jsxs("button",{onClick:()=>se("solicitar"),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#D4840A",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(bn,{size:13})," Re-solicitar aprobacin"]}),X==="aprobada_internamente"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:async()=>{var ae;const L=await le();(ae=navigator.clipboard)==null||ae.writeText(L.portalUrl),alert(` Portal creado y URL copiada.

Enva este link al cliente:
${L.portalUrl}`)},style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(bn,{size:13})," Enviar al cliente (crear portal)"]}),e.jsxs("button",{onClick:K,style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#111",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(wo,{size:13})," Descargar PDF"]})]}),X==="enviada"&&e.jsxs("div",{style:{fontSize:11,color:"#3B3B3B",padding:"8px 0"},children:[" Esperando respuesta del cliente. Portal activo.",t.wf_lastPortalUrl&&e.jsx("button",{onClick:()=>{var L;return(L=navigator.clipboard)==null?void 0:L.writeText(t.wf_lastPortalUrl).then(()=>alert(" URL copiada"))},style:{marginLeft:8,background:"#F0F0F0",border:"1px solid #3B3B3B33",borderRadius:3,padding:"3px 8px",fontSize:10,cursor:"pointer",color:"#3B3B3B",fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:" Copiar URL portal"})]}),X==="devuelta_cliente"&&e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:()=>{i("revision",D+1),se("solicitar")},style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#D4840A",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(ca,{size:13})," Crear Rev.",D+1," y solicitar aprobacin"]})}),X==="aprobada_cliente"&&e.jsx("div",{style:{fontSize:12,color:"#111111",padding:"8px 0",fontWeight:600},children:" Oferta ganada! El cliente acept la propuesta."}),X==="rechazada_cliente"&&e.jsxs("div",{style:{fontSize:12,color:"#B91C1C",padding:"8px 0"},children:[" El cliente rechaz la propuesta. ",((N=P.filter(L=>L.accion==="rechazar_cliente").slice(-1)[0])==null?void 0:N.comentarios)&&e.jsxs("span",{style:{fontStyle:"italic"},children:['Motivo: "',(G=P.filter(L=>L.accion==="rechazar_cliente").slice(-1)[0])==null?void 0:G.comentarios,'"']})]}),!["aprobada_internamente"].includes(X)&&e.jsxs("button",{onClick:K,style:{display:"flex",alignItems:"center",gap:6,padding:"8px 14px",background:"transparent",color:E.inkMid,border:`1px solid ${E.border}`,borderRadius:5,cursor:"pointer",fontSize:11,fontWeight:500,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(wo,{size:12})," PDF"]})]})]}),P.length>0&&e.jsx("div",{style:{padding:"0 20px 14px",borderTop:`1px solid ${E.border}`,marginTop:0},children:e.jsxs("details",{children:[e.jsxs("summary",{style:{fontSize:10,fontWeight:600,color:E.inkLight,cursor:"pointer",padding:"10px 0 4px",textTransform:"uppercase",letterSpacing:1},children:["Historial (",P.length," acciones)"]}),e.jsx("div",{style:{maxHeight:200,overflowY:"auto"},children:P.slice().reverse().map((L,ae)=>{var he,ze;const pe={solicitar:"Solicit aprobacin",aprobar_interno:"Aprob internamente",devolver_interno:"Devolvi con observaciones",enviar:"Envi al cliente",reenviar:"Re-envi al cliente",aprobar_cliente:"Cliente aprob",rechazar_cliente:"Cliente rechaz",devolver_cliente:"Cliente devolvi"};return e.jsxs("div",{style:{display:"flex",gap:8,padding:"5px 0",borderBottom:"1px solid #F5F5F5",fontSize:10},children:[e.jsx("div",{style:{minWidth:100,color:E.inkLight},children:new Date(L.fecha).toLocaleString("es-CO",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:600},children:((ze=(he=L.por)==null?void 0:he.nombre)==null?void 0:ze.split(" ")[0])||""}),e.jsxs("span",{style:{color:E.inkMid},children:["  ",pe[L.accion]||L.accion]}),L.comentarios&&e.jsxs("div",{style:{color:"#D4840A",fontStyle:"italic",marginTop:2},children:[" ",L.comentarios]})]}),e.jsxs("div",{style:{fontSize:9,color:E.inkLight},children:["Rev.",L.revision]})]},L.id||ae)})})]})}),me.length>0&&e.jsx("div",{style:{padding:"0 20px 14px",borderTop:`1px solid ${E.border}`},children:e.jsxs("details",{children:[e.jsxs("summary",{style:{fontSize:10,fontWeight:600,color:E.inkLight,cursor:"pointer",padding:"10px 0 4px",textTransform:"uppercase",letterSpacing:1},children:["Portales cliente (",me.length,")"]}),me.map((L,ae)=>e.jsxs("div",{style:{display:"flex",gap:8,padding:"5px 0",borderBottom:"1px solid #F5F5F5",fontSize:10,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:14},children:L.estado==="aprobada"?"":L.estado==="rechazada"?"":L.estado==="devuelta"?"":""}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:600},children:["Rev.",L.revision,"  ",new Date(L.fechaCreacion).toLocaleDateString("es-CO")]}),e.jsx("div",{style:{color:E.inkLight},children:L.clienteEmail||L.clienteNombre})]}),e.jsx("span",{style:{fontSize:9,fontWeight:600,padding:"2px 6px",borderRadius:3,color:L.estado==="pendiente"?"#3B3B3B":L.estado==="aprobada"?"#111111":"#B91C1C",background:L.estado==="pendiente"?"#F0F0F0":L.estado==="aprobada"?"#E8F4EE":"#FAE8E8"},children:L.estado})]},L.token||ae))]})})]}),e.jsxs("div",{className:"p-hdr print-page-break",children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:13,letterSpacing:4},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:7,letterSpacing:2,color:"#999",textTransform:"uppercase"},children:"Arquitectura  Interiorismo  Construccin"})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700},children:z}),e.jsxs("div",{style:{fontSize:8,color:"#666"},children:[k,"  ",C]})]})]}),e.jsxs("div",{className:"no-print",style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:16,marginBottom:16},children:[e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Portada",s:"Datos visibles en la portada del documento"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{children:[b("Tipo de documento"),u("titulo",r?"PRESUPUESTO DE EJECUCIN":"PROPUESTA DE DISEO")]}),e.jsxs("div",{children:[b("N Oferta"),u("ref",t.codigoOferta||"")]}),e.jsxs("div",{children:[b("Cliente"),u("cliente",t.cliente||"")]}),e.jsxs("div",{children:[b("Fecha"),u("fecha",t.fechaOferta||Dt())]})]})]}),e.jsxs(Ke,{style:{padding:22,background:E.ink,color:"#fff",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:8,right:10,background:"rgba(255,255,255,0.15)",padding:"2px 8px",borderRadius:3,fontSize:8,fontWeight:600,color:"rgba(255,255,255,0.5)",textTransform:"uppercase",letterSpacing:.8},children:"Solo uso interno"}),e.jsx("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:"rgba(255,255,255,0.4)",margin:"0 0 6px"},children:"PVP Total"}),e.jsx("p",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:32,fontWeight:700,color:"#fff",margin:"0 0 4px",letterSpacing:-1},children:Je(o.PVP_IVA)}),e.jsxs("p",{style:{fontSize:10,color:"rgba(255,255,255,0.4)",margin:"0 0 16px"},children:[r?"IVA sobre utilidad":"IVA incluido","  ",t.divisa||"COP"]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.15)",paddingTop:12},children:[["PVP sin IVA",Je(o.PVP)],[r?`IVA (${et(t.tarifaIVA)}  U ${et(o.U)})`:`IVA ${et(t.tarifaIVA)}`,Je(o.IVA)],...o.ret>0?[["Retenciones (flujo)","-"+Je(o.ret)]]:[]].map(([L,ae])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,marginBottom:4},children:[e.jsx("span",{style:{color:"rgba(255,255,255,0.5)"},children:L}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",color:"rgba(255,255,255,0.8)"},children:ae})]},L))})]})]}),e.jsx("div",{className:"print-section",style:{marginBottom:16},children:e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Alcance del servicio",s:""}),t.alcanceTexto&&e.jsxs("div",{className:"no-print",style:{background:"#E8F4EE",borderRadius:4,padding:"8px 12px",fontSize:10,color:"#111111",marginTop:6,marginBottom:6,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:" Hay un alcance configurado en la pestaa General"}),e.jsx("button",{onClick:()=>i("ent_alcance",t.alcanceTexto),style:{background:"#111111",color:"#fff",border:"none",borderRadius:3,padding:"3px 10px",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Usar plantilla"})]}),e.jsxs("div",{style:{marginTop:10},children:[j("Descripcin del alcance"),d("alcance",t.alcanceTexto||(r?"El presente alcance comprende la ejecucin integral del proyecto de diseo previamente aprobado, incluyendo construccin, suministro de materiales, acabados e interventora, garantizando coherencia entre diseo, presupuesto y resultado final.":`Diseo y desarrollo integral del proyecto ${t.proyecto||""} ubicado en ${t.ubicacion||""}. Incluye levantamiento, conceptualizacin, desarrollo de planos tcnicos y acompaamiento en la ejecucin.`),5)]}),r&&e.jsxs("div",{style:{marginTop:14},children:[j("Fases del proyecto"),d("fases",`- Firma de contrato
- Recepcin de anticipo
- Aprobacin de planos tcnicos
- Aprobacin de acabados
- Validacin formal de materiales y especificaciones
- Firma de acta de inicio de obra
- Inicio de obra
- Recepcin de obra
- Firma de acta final`,6)]}),e.jsxs("div",{style:{marginTop:14},children:[j("Exclusiones"),d("exclusiones",r?`Esta propuesta no incluye, salvo que se acuerde por escrito, ejecuciones adicionales a las contempladas en los diseos aprobados.

- Licencias y permisos de construccin
- Obra civil de estructura y cimentacin no contemplada en diseos
- Suministro e instalacin de electrodomsticos
- Gestin de condominio o administracin
- Mudanzas y trasteos
- Diseo o rediseo arquitectnico (ya aprobado previamente)

Todos los entregables se comparten exclusivamente en formato digital.`:`Esta propuesta no incluye, salvo que se acuerde por escrito:

- Licencias y permisos de construccin
- Obra civil de estructura y cimentacin
- Suministro e instalacin de electrodomsticos
- Gestin de condominio o administracin
- Ejecucin de obra o interventora
- Renders 3D fotorrealistas (se cotizan aparte)

Todos los entregables se comparten exclusivamente en formato digital.`,6)]})]})}),e.jsxs("div",{className:"print-page-break print-section",children:[e.jsxs("div",{className:"p-hdr",children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:700,fontSize:13,letterSpacing:4},children:"HABITARIS"})}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700},children:z}),e.jsxs("div",{style:{fontSize:8,color:"#666"},children:[k,"  ",C]})]})]}),e.jsxs(Ke,{style:{padding:0,overflow:"hidden",marginBottom:16},children:[e.jsx("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${E.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(vt,{t:"Presupuesto",s:`Vista: ${w==="detallado"?"Detallado":w==="capitulos"?"Por captulos":"Total nico"}`})}),w==="total"?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Item","Descripcin","Total"].map(L=>e.jsx("th",{style:{padding:"9px 14px",textAlign:L==="Total"?"right":"left",fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:.8},children:L},L))})}),e.jsxs("tbody",{children:[e.jsxs("tr",{style:{borderTop:`1px solid ${E.border}`},children:[e.jsx("td",{style:{padding:"10px 14px"},children:"1"}),e.jsx("td",{style:{padding:"10px 14px"},children:n("descTotal",r?"Reforma integral de espacios segn diseo, incluye obras civiles, carpinteras y acabados segn diseo aprobado.":`Diseo integral  ${t.proyecto||"proyecto"}`)}),e.jsx("td",{style:{padding:"10px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:Je(o.PVP)})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:2,style:{padding:"8px 14px",fontSize:11,color:E.inkMid},children:r?"IVA sobre la utilidad":`IVA ${et(t.tarifaIVA)}`}),e.jsx("td",{style:{padding:"8px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Je(o.IVA)})]}),e.jsxs("tr",{style:{background:E.ink},children:[e.jsx("td",{colSpan:2,style:{padding:"12px 14px",fontWeight:700,color:"#fff",fontSize:14},children:"Valor total"}),e.jsx("td",{style:{padding:"12px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:16,color:"#fff"},children:Je(o.PVP_IVA)})]})]})]}):w==="capitulos"?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Item","Descripcin","Total"].map(L=>e.jsx("th",{style:{padding:"9px 14px",textAlign:L==="Total"?"right":"left",fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:.8},children:L},L))})}),e.jsxs("tbody",{children:[h.map((L,ae)=>e.jsxs("tr",{style:{borderTop:`1px solid ${E.border}`},children:[e.jsx("td",{style:{padding:"10px 14px"},children:ae+1}),e.jsx("td",{style:{padding:"10px 14px",fontWeight:600},children:L.nombre||"Captulo "+(ae+1)}),e.jsx("td",{style:{padding:"10px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:Je(L.total)})]},L.id)),e.jsxs("tr",{style:{borderTop:`2px solid ${E.ink}`,background:"#F5F4F1"},children:[e.jsx("td",{colSpan:2,style:{padding:"10px 14px",fontWeight:700},children:"Subtotal"}),e.jsx("td",{style:{padding:"10px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:Je(o.PVP)})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:2,style:{padding:"6px 14px",fontSize:11,color:E.inkMid},children:r?"IVA sobre la utilidad":`IVA ${et(t.tarifaIVA)}`}),e.jsx("td",{style:{padding:"6px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Je(o.IVA)})]}),e.jsxs("tr",{style:{background:E.ink},children:[e.jsx("td",{colSpan:2,style:{padding:"12px 14px",fontWeight:700,color:"#fff",fontSize:14},children:"Valor total"}),e.jsx("td",{style:{padding:"12px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:16,color:"#fff"},children:Je(o.PVP_IVA)})]})]})]}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Ref.","Descripcin","Und","Cant.","PU","Total"].map(L=>e.jsx("th",{style:{padding:"9px 14px",textAlign:L==="Total"||L==="PU"?"right":"left",fontSize:9,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:.8},children:L},L))})}),e.jsxs("tbody",{children:[f.map((L,ae)=>{if(L.esCapitulo)return e.jsx("tr",{style:{background:E.accentBg,borderTop:`2px solid ${E.border}`},children:e.jsx("td",{colSpan:6,style:{padding:"8px 14px",fontWeight:700,fontSize:12,color:E.ink,textTransform:"uppercase"},children:L.nombre||L.tipo})},L.id);const pe=L.precioCD?Ht(L.precioCD,L.cantidad||1,t):null;return e.jsxs("tr",{style:{borderTop:`1px solid ${E.border}`},children:[e.jsx("td",{style:{padding:"8px 14px",color:E.inkLight,fontSize:11},children:L.codigo||String(ae+1).padStart(2,"0")}),e.jsx("td",{style:{padding:"8px 14px"},children:L.descripcion||""}),e.jsx("td",{style:{padding:"8px 14px",color:E.inkMid},children:L.unidad||"Gl"}),e.jsx("td",{style:{padding:"8px 14px",color:E.inkMid,textAlign:"right"},children:L.cantidad||1}),e.jsx("td",{style:{padding:"8px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:pe?Je(pe.puVenta):""}),e.jsx("td",{style:{padding:"8px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:pe?Je(pe.totalVenta):""})]},L.id)}),e.jsxs("tr",{style:{borderTop:`2px solid ${E.ink}`,background:"#F5F4F1"},children:[e.jsx("td",{colSpan:5,style:{padding:"10px 14px",fontWeight:700},children:"Subtotal"}),e.jsx("td",{style:{padding:"10px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:Je(o.PVP)})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:5,style:{padding:"6px 14px",fontSize:11,color:E.inkMid},children:r?"IVA sobre la utilidad":`IVA ${et(t.tarifaIVA)}`}),e.jsx("td",{style:{padding:"6px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Je(o.IVA)})]}),e.jsxs("tr",{style:{background:E.ink},children:[e.jsx("td",{colSpan:5,style:{padding:"12px 14px",fontWeight:700,color:"#fff",fontSize:14},children:"Valor total"}),e.jsx("td",{style:{padding:"12px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:16,color:"#fff"},children:Je(o.PVP_IVA)})]})]})]})]})]}),e.jsxs("div",{className:"print-page-break print-section",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Formas de pago",s:""}),e.jsx("div",{style:{marginTop:10},children:d("condPago",[`${Math.round((t.condPct1??.3)*100)}% de anticipo`,`${Math.round((t.condPct2??.3)*100)}% a la mitad de ejecucin del proyecto`,...s>0?[`${Math.round((t.condPct3??.3)*100)}% a la entrega / acta de recepcin`,`${Math.round(s*100)}% retencin a 30 das`]:[`${Math.round((t.condPct3??.3)*100)}% al acta de recepcin`]].join(`
`),5)}),e.jsxs("div",{style:{marginTop:10},children:[j("Medios de pago"),u("medioPago",t.medioPago==="PSE"?"Link PSE":t.medioPago==="Tarjeta"?"Pago con tarjeta (pasarela online)":"Transferencia bancaria")]})]}),e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Plazo y garantas",s:""}),e.jsxs("div",{style:{marginTop:10},children:[j("Plazo de ejecucin"),u("plazo",n("duracion","__ semanas desde la firma de acta de inicio")),e.jsxs("div",{style:{marginTop:10},children:[j("Garantas"),d("garantias",`- Garanta de obra: 1 ao sobre defectos de ejecucin
- Garanta de materiales: segn fabricante
- Pliza todo riesgo durante la ejecucin`,4)]})]})]})]}),e.jsx("div",{className:"print-section",style:{marginBottom:16},children:e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Trminos y condiciones",s:""}),e.jsx("div",{style:{marginTop:10},children:d("terminos",`- Vigencia: La propuesta tiene una validez de 20 das calendario desde la fecha de envo.
- Moneda: Pesos colombianos (COP).
- Aprobacin: Se considera aceptada al recibir confirmacin escrita y el pago del anticipo.
- Formalizacin: La relacin contractual se considerar establecida mediante la firma de un contrato u orden de servicio que incorpore esta propuesta.
- Pago inicial: El inicio de los trabajos estar condicionado al cumplimiento de todas las condiciones de inicio.
- Reajustes: Los plazos y valores podrn ser modificados en funcin de nuevos requerimientos o cambios en el alcance original.`,8)}),e.jsxs("div",{style:{marginTop:14},children:[j("Nota legal"),d("notaLegal",`Esta propuesta tiene carcter informativo y comercial. No constituye, por s sola, un contrato. La relacin contractual entre las partes solo se considerar establecida mediante la firma de un contrato, orden de servicio u otro documento que incorpore esta propuesta como anexo o referencia.

La informacin contenida en esta propuesta es confidencial y de uso exclusivo del cliente. No podr ser reproducida, compartida ni utilizada con fines comerciales o de ejecucin por terceros sin autorizacin previa y por escrito de Habitaris S.A.S.`,5)]})]})}),e.jsxs("div",{className:"print-page-break print-section",style:{marginBottom:16},children:[e.jsxs("div",{className:"p-hdr",children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:700,fontSize:13,letterSpacing:4},children:"HABITARIS"})}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700},children:z}),e.jsxs("div",{style:{fontSize:8,color:"#666"},children:[k,"  ",C]})]})]}),e.jsxs(Ke,{style:{padding:22},children:[e.jsx(vt,{t:"Firma de aceptacin",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginTop:14},children:[e.jsxs("div",{children:[j("Representante Habitaris"),e.jsxs("div",{style:{border:`1px solid ${E.border}`,borderRadius:4,padding:"10px 12px",background:"#F5F4F1"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:13},children:v}),e.jsx("div",{style:{fontSize:11,color:E.inkMid},children:A}),e.jsx("div",{style:{fontSize:10,color:E.inkLight,marginTop:4},children:"Habitaris S.A.S  NIT 901.922.136-8"})]}),n("elaboradoPor","")&&e.jsxs("div",{style:{marginTop:8},children:[j("Elaborado por"),e.jsx("div",{style:{fontSize:12},children:n("elaboradoPor","")}),n("elaboradoPorCargo","")&&e.jsx("div",{style:{fontSize:11,color:E.inkMid},children:n("elaboradoPorCargo","")})]}),e.jsxs("div",{className:"no-print",style:{marginTop:8},children:[b("Elaborado por (opcional)"),u("elaboradoPor",""),n("elaboradoPor","")&&e.jsxs(e.Fragment,{children:[b("Cargo"),u("elaboradoPorCargo","")]})]})]}),e.jsxs("div",{children:[j("Firma del cliente"),e.jsx("div",{className:"no-print",children:u("firmaC",t.cliente||"")}),e.jsx("div",{className:"print-only",style:{fontSize:12,marginTop:4},children:n("firmaC",t.cliente||"")}),e.jsx("div",{style:{borderBottom:"1px solid #999",marginTop:60,width:"80%"}}),e.jsx("div",{style:{fontSize:9,color:E.inkLight,marginTop:4},children:"Firma y sello de aceptacin"}),e.jsx("div",{style:{borderBottom:"1px solid #999",marginTop:30,width:"80%"}}),e.jsx("div",{style:{fontSize:9,color:E.inkLight,marginTop:4},children:"Fecha"})]})]})]})]}),e.jsx(Ke,{className:"no-print",style:{padding:16,background:"#F5F5F5"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("span",{style:{fontSize:10,fontWeight:600,color:E.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Compartir manualmente"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("button",{onClick:()=>{const L=t.emailCliente||prompt("Email del cliente:");if(L){const ae=encodeURIComponent(`${z}  ${t.proyecto||"Habitaris"}`),pe=encodeURIComponent(`Estimado/a ${T},

Adjuntamos la propuesta para ${t.proyecto||"el proyecto"} por un valor de ${Je(o.PVP_IVA)} (IVA incluido).

Quedamos atentos a sus comentarios.

Cordialmente,
${v}
${A}
Habitaris S.A.S`);window.open(`mailto:${L}?subject=${ae}&body=${pe}`)}},style:{display:"flex",alignItems:"center",gap:4,padding:"6px 12px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:10,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(En,{size:11})," Email"]}),e.jsxs("button",{onClick:()=>{const L=t.telCliente||prompt("Telfono (con cdigo de pas):");if(L){const ae=L.replace(/[^0-9]/g,"");window.open(`https://wa.me/${ae}?text=${encodeURIComponent(`Hola ${T}, le envo la propuesta de ${t.proyecto||"Habitaris"} por ${Je(o.PVP_IVA)} (IVA incluido).  ${v}, Habitaris`)}`)}},style:{display:"flex",alignItems:"center",gap:4,padding:"6px 12px",background:"#25D366",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:10,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(xr,{size:11})," WhatsApp"]}),e.jsxs("button",{onClick:()=>{var L;(L=navigator.clipboard)==null||L.writeText(`${z}  ${k}  ${T}  PVP: ${Je(o.PVP_IVA)}`),alert(" Copiado")},style:{display:"flex",alignItems:"center",gap:4,padding:"6px 12px",background:"transparent",color:"#555",border:`1px solid ${E.border}`,borderRadius:4,cursor:"pointer",fontSize:10,fontWeight:500,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(da,{size:11})," Copiar"]})]})]})})]})}const Gh=[{id:"q1",texto:"Cmo califica la calidad del diseo entregado?",tipo:"estrellas"},{id:"q2",texto:"Se cumplieron los plazos pactados?",tipo:"estrellas"},{id:"q3",texto:"La comunicacin con el equipo fue adecuada?",tipo:"estrellas"},{id:"q4",texto:"El presupuesto final se ajust al acordado?",tipo:"estrellas"},{id:"q5",texto:"Recomendara nuestros servicios? (NPS)",tipo:"nps"},{id:"q6",texto:"Qu podramos mejorar?",tipo:"texto"},{id:"q7",texto:"Comentarios adicionales",tipo:"texto"}],Kh=[{id:"p1",texto:"Calidad del material / servicio entregado",tipo:"estrellas"},{id:"p2",texto:"Cumplimiento de plazos de entrega",tipo:"estrellas"},{id:"p3",texto:"Relacin calidad/precio",tipo:"estrellas"},{id:"p4",texto:"Facilidad de comunicacin",tipo:"estrellas"},{id:"p5",texto:"Volvera a contratar este proveedor?",tipo:"sino"},{id:"p6",texto:"Observaciones",tipo:"texto"}];function Jh({offers:t}){const i="hab:crm:encuestas:satisfaccion",o="hab:crm:encuestas:proveedores",[n,a]=F.useState([]),[r,s]=F.useState([]),[d,u]=F.useState("satisfaccion"),[b,j]=F.useState(null),[w,S]=F.useState(null);F.useEffect(()=>{(async()=>{var z,k,T,C;try{const D=await((k=(z=window.storage)==null?void 0:z.get)==null?void 0:k.call(z,i));D&&a(JSON.parse(D.value)||[])}catch{}try{const D=await((C=(T=window.storage)==null?void 0:T.get)==null?void 0:C.call(T,o));D&&s(JSON.parse(D.value)||[])}catch{}})()},[]);const m=z=>{var k,T;a(z);try{(T=(k=window.storage)==null?void 0:k.set)==null||T.call(k,i,JSON.stringify(z))}catch{}},x=z=>{var k,T;s(z);try{(T=(k=window.storage)==null?void 0:k.set)==null||T.call(k,o,JSON.stringify(z))}catch{}},p=t.filter(z=>z.estado==="Ganada"),c=()=>Math.random().toString(36).slice(2,9),g=z=>({id:c(),ofertaId:(z==null?void 0:z.id)||"",proyecto:(z==null?void 0:z.proyecto)||"",cliente:(z==null?void 0:z.cliente)||"",fecha:new Date().toISOString().slice(0,10),respuestas:{},estado:"pendiente"}),l=()=>({id:c(),proveedor:"",proyecto:"",fecha:new Date().toISOString().slice(0,10),respuestas:{},estado:"pendiente"}),f=({value:z,onChange:k})=>e.jsxs("div",{style:{display:"flex",gap:2},children:[[1,2,3,4,5].map(T=>e.jsx("button",{onClick:()=>k(T),style:{fontSize:22,background:"none",border:"none",cursor:"pointer",color:T<=(z||0)?"#F5A623":"#DDD",transition:"color .1s"},children:""},T)),z>0&&e.jsxs("span",{style:{fontSize:11,color:E.inkLight,marginLeft:6,alignSelf:"center"},children:[z,"/5"]})]}),y=({value:z,onChange:k})=>e.jsxs("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:[Array.from({length:11},(T,C)=>C).map(T=>e.jsx("button",{onClick:()=>k(T),style:{width:32,height:32,borderRadius:6,border:"1px solid "+(T===z?"#111":"#E0E0E0"),background:T===z?T>=9?"#111111":T>=7?"#F5A623":"#B91C1C":"#fff",color:T===z?"#fff":"#555",fontWeight:T===z?700:400,fontSize:12,cursor:"pointer",transition:"all .1s"},children:T},T)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",fontSize:9,color:E.inkLight,marginTop:2},children:[e.jsx("span",{children:"Nada probable"}),e.jsx("span",{children:"Muy probable"})]})]}),h=z=>{const k=z.flatMap(T=>Object.values(T.respuestas||{}).filter(C=>typeof C=="number"&&C>=1&&C<=5));return k.length>0?(k.reduce((T,C)=>T+C,0)/k.length).toFixed(1):""},v=z=>{const k=z.map(D=>{var K;return(K=D.respuestas)==null?void 0:K.q5}).filter(D=>typeof D=="number");if(k.length===0)return"";const T=k.filter(D=>D>=9).length,C=k.filter(D=>D<=6).length;return((T-C)/k.length*100).toFixed(0)},A=(z,k,T)=>e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:16},children:z.map(C=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:E.ink,marginBottom:6},children:C.texto}),C.tipo==="estrellas"&&e.jsx(f,{value:k[C.id]||0,onChange:D=>T({...k,[C.id]:D})}),C.tipo==="nps"&&e.jsx(y,{value:k[C.id],onChange:D=>T({...k,[C.id]:D})}),C.tipo==="sino"&&e.jsx("div",{style:{display:"flex",gap:8},children:["S","No","Con reservas"].map(D=>e.jsx("button",{onClick:()=>T({...k,[C.id]:D}),style:{padding:"6px 16px",borderRadius:6,border:`1px solid ${k[C.id]===D?"#111":"#E0E0E0"}`,background:k[C.id]===D?"#111":"#fff",color:k[C.id]===D?"#fff":"#555",fontSize:12,cursor:"pointer",fontWeight:k[C.id]===D?600:400},children:D},D))}),C.tipo==="texto"&&e.jsx("textarea",{value:k[C.id]||"",onChange:D=>T({...k,[C.id]:D.target.value}),rows:2,placeholder:"Escribe aqu...",style:{width:"100%",border:`1px solid ${E.border}`,borderRadius:6,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical"}})]},C.id))});return e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Encuestas ISO 9001"}),e.jsx("p",{style:{fontSize:12,color:E.inkLight,margin:"3px 0 0"},children:"Satisfaccin del cliente y evaluacin de proveedores"})]})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(160px,1fr))",gap:10,marginBottom:16},children:[["Enc. satisfaccin",n.length,"#111111"],["Promedio general",h(n)+"","#F5A623"],["NPS Score",v(n),"#3B3B3B"],["Eval. proveedores",r.length,"#8C6A00"],["Promedio proveed.",h(r)+"","#F5A623"]].map(([z,k,T])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"10px 12px",borderLeft:"3px solid "+T},children:[e.jsx("div",{style:{fontSize:9,color:"#888",marginBottom:2},children:z}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:T,fontFamily:"'DM Mono',monospace"},children:k})]},z))}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:16},children:[["satisfaccion","Satisfaccin cliente"],["proveedores","Evaluacin proveedores"]].map(([z,k])=>e.jsx("button",{onClick:()=>u(z),style:{padding:"8px 18px",border:`1px solid ${E.border}`,borderRadius:z==="satisfaccion"?"6px 0 0 6px":"0 6px 6px 0",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:d===z?"#111":"#fff",color:d===z?"#fff":"#555"},children:k},z))}),d==="satisfaccion"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsxs("select",{onChange:z=>{if(z.target.value){const k=p.find(T=>T.id===z.target.value);j(g(k)),z.target.value=""}},style:{border:`1px solid ${E.border}`,borderRadius:6,padding:"7px 12px",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"",children:"+ Nueva encuesta desde oferta ganada..."}),p.map(z=>e.jsx("option",{value:z.id,children:z.proyecto||z.cliente||z.id},z.id))]}),e.jsxs("button",{onClick:()=>j(g({})),style:{padding:"7px 14px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Pe,{size:12})," Nueva en blanco"]})]}),b&&e.jsxs(Ke,{style:{padding:22,marginBottom:16,borderLeft:"3px solid #111111"},children:[e.jsx(vt,{t:"Encuesta de satisfaccin",s:b.proyecto||"Proyecto sin nombre"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsx(st,{lbl:"Cliente",val:b.cliente,on:z=>j(k=>({...k,cliente:z.target.value}))}),e.jsx(st,{lbl:"Proyecto",val:b.proyecto,on:z=>j(k=>({...k,proyecto:z.target.value}))})]}),A(Gh,b.respuestas,z=>j(k=>({...k,respuestas:z}))),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[e.jsx(ht,{icon:ft,on:()=>{const z={...b,estado:"completada"},k=n.find(T=>T.id===b.id);m(k?n.map(T=>T.id===b.id?z:T):[...n,z]),j(null)},children:"Guardar"}),e.jsx(ht,{v:"out",on:()=>j(null),children:"Cancelar"})]})]}),n.length>0&&e.jsx("div",{style:{border:`1px solid ${E.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Cliente","Proyecto","Promedio","NPS","Estado",""].map(z=>e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,borderBottom:"2px solid #E0E0E0"},children:z},z))})}),e.jsx("tbody",{children:n.map((z,k)=>{var D;const T=Object.entries(z.respuestas||{}).filter(([K,oe])=>typeof oe=="number"&&oe>=1&&oe<=5),C=T.length>0?(T.reduce((K,[,oe])=>K+oe,0)/T.length).toFixed(1):"";return e.jsxs("tr",{style:{borderBottom:`1px solid ${E.border}`,background:k%2?"#F9F8F5":"#fff"},children:[e.jsx("td",{style:{padding:"8px 12px"},children:z.fecha}),e.jsx("td",{style:{padding:"8px 12px",fontWeight:600},children:z.cliente||""}),e.jsx("td",{style:{padding:"8px 12px"},children:z.proyecto||""}),e.jsxs("td",{style:{padding:"8px 12px",color:"#F5A623",fontWeight:700},children:[C,""]}),e.jsx("td",{style:{padding:"8px 12px",fontFamily:"'DM Mono',monospace"},children:((D=z.respuestas)==null?void 0:D.q5)??"-"}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("span",{style:{background:z.estado==="completada"?"#E6F4EC":"#FFF3E0",color:z.estado==="completada"?"#111111":"#F5A623",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:600},children:z.estado})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>j({...z}),style:{background:"none",border:"none",cursor:"pointer",color:E.ink},children:e.jsx(Wo,{size:12})}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar?")&&m(n.filter(K=>K.id!==z.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:12})})]})})]},z.id)})})]})})]}),d==="proveedores"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:14},children:e.jsxs("button",{onClick:()=>S(l()),style:{padding:"7px 14px",border:"none",borderRadius:6,background:"#8C6A00",color:"#fff",cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Pe,{size:12})," Evaluar proveedor"]})}),w&&e.jsxs(Ke,{style:{padding:22,marginBottom:16,borderLeft:"3px solid #8C6A00"},children:[e.jsx(vt,{t:"Evaluacin de proveedor",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsx(st,{lbl:"Proveedor",val:w.proveedor,on:z=>S(k=>({...k,proveedor:z.target.value}))}),e.jsx(st,{lbl:"Proyecto / Referencia",val:w.proyecto,on:z=>S(k=>({...k,proyecto:z.target.value}))})]}),A(Kh,w.respuestas,z=>S(k=>({...k,respuestas:z}))),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[e.jsx(ht,{icon:ft,on:()=>{const z={...w,estado:"completada"},k=r.find(T=>T.id===w.id);x(k?r.map(T=>T.id===w.id?z:T):[...r,z]),S(null)},children:"Guardar"}),e.jsx(ht,{v:"out",on:()=>S(null),children:"Cancelar"})]})]}),r.length>0&&e.jsx("div",{style:{border:`1px solid ${E.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Proveedor","Proyecto","Promedio","Repetir?","Estado",""].map(z=>e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,borderBottom:"2px solid #E0E0E0"},children:z},z))})}),e.jsx("tbody",{children:r.map((z,k)=>{var D;const T=Object.entries(z.respuestas||{}).filter(([K,oe])=>typeof oe=="number"&&oe>=1&&oe<=5),C=T.length>0?(T.reduce((K,[,oe])=>K+oe,0)/T.length).toFixed(1):"";return e.jsxs("tr",{style:{borderBottom:`1px solid ${E.border}`,background:k%2?"#F9F8F5":"#fff"},children:[e.jsx("td",{style:{padding:"8px 12px"},children:z.fecha}),e.jsx("td",{style:{padding:"8px 12px",fontWeight:600},children:z.proveedor||""}),e.jsx("td",{style:{padding:"8px 12px"},children:z.proyecto||""}),e.jsxs("td",{style:{padding:"8px 12px",color:"#F5A623",fontWeight:700},children:[C,""]}),e.jsx("td",{style:{padding:"8px 12px"},children:((D=z.respuestas)==null?void 0:D.p5)||""}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("span",{style:{background:z.estado==="completada"?"#E6F4EC":"#FFF3E0",color:z.estado==="completada"?"#111111":"#F5A623",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:600},children:z.estado})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>S({...z}),style:{background:"none",border:"none",cursor:"pointer",color:E.ink},children:e.jsx(Wo,{size:12})}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar?")&&x(r.filter(K=>K.id!==z.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(qe,{size:12})})]})})]},z.id)})})]})})]})]})}function Yh(){return e.jsxs("div",{className:"fade",children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:E.inkLight,margin:"0 0 6px"},children:"Sistema"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:E.ink,margin:"0 0 28px",letterSpacing:-.5},children:"Configuracin"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(Ke,{style:{padding:24},children:[e.jsx(vt,{t:"Marca",s:"Identidad visual aplicada"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:20},children:[e.jsx("div",{style:{background:E.ink,borderRadius:3,padding:"16px"},children:e.jsx(nl,{size:44,color:"#fff"})}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 2px",fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:E.ink},children:"Habitaris"}),e.jsx("p",{style:{margin:"0 0 2px",fontSize:11,color:E.inkLight},children:"Tipografa: DM Sans (sans-serif)"}),e.jsx("p",{style:{margin:0,fontSize:11,color:E.inkLight},children:"Paleta: B&W + off-white. Manual 2025 "})]})]}),e.jsx("div",{style:{background:E.accentBg,borderRadius:2,padding:"12px 16px",border:`1px dashed ${E.borderMid}`},children:e.jsx("p",{style:{margin:0,fontSize:11,color:E.inkMid},children:"Una sola familia tipogrfica sans-serif segn manual. Sin serif."})})]}),e.jsxs(Ke,{style:{padding:24},children:[e.jsx(vt,{t:"Datos",s:"Almacenamiento local persistente"}),e.jsx("p",{style:{fontSize:12,color:E.inkMid,margin:"0 0 16px",lineHeight:1.6},children:"Los datos se guardan en tu navegador. No requieren servidor ni cuenta externa."}),e.jsx(ht,{v:"danger",icon:qe,on:async()=>{window.confirm("Eliminar TODOS los datos? Irreversible.")&&(await window.storage.delete("hab:v4"),window.location.reload())},children:"Borrar todos los datos"})]})]})]})}function Xh({lang:t}){const[i,o]=F.useState(t||"es");F.useEffect(()=>{t&&o(t)},[t]);const[n,a]=F.useState("dashboard"),[r,s]=F.useState(!1),[d,u]=F.useState([]),[b,j]=F.useState(null),[w,S]=F.useState(!0);F.useEffect(()=>{ph().then(y=>{u(y),S(!1)})},[]);const m=F.useCallback(async y=>{const h=d.some(v=>v.id===y.id)?d.map(v=>v.id===y.id?y:v):[...d,y];u(h),await Ha(h)},[d]),x=F.useCallback(async y=>{if(!window.confirm("Eliminar esta oferta?"))return;const h=d.filter(v=>v.id!==y);u(h),await Ha(h)},[d]),p=F.useCallback(async y=>{const h=d.find(z=>z.id===y);if(!h)return;const v={...h,id:Ct(),createdAt:Dt(),updatedAt:Dt(),estado:"Borrador",proyecto:(h.proyecto||"")+" (copia)",relacionadaCon:y},A=[...d,v];u(A),await Ha(A)},[d]),[c,g]=F.useState(null),l=F.useCallback((y,h)=>{g(Ns(y)),h("offer-new")},[]),f=F.useCallback(async y=>{var v,A,z,k;const h=rc(y);try{const T=await((A=(v=window.storage)==null?void 0:v.get)==null?void 0:A.call(v,"hab:crm:clientes2")),C=T?JSON.parse(T.value)||[]:[],D=C.find(K=>K.email&&K.email===h.email);if(D){alert(` Ya existe un cliente con email ${h.email}: "${D.nombre}"`),a("clientes");return}C.push(h),await((k=(z=window.storage)==null?void 0:z.set)==null?void 0:k.call(z,"hab:crm:clientes2",JSON.stringify(C))),alert(` Cliente "${h.nombre}" creado desde briefing`)}catch{alert("Error guardando cliente")}a("clientes")},[]);return w?e.jsxs(e.Fragment,{children:[e.jsx(Vl,{}),e.jsx("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:E.bg},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(nl,{size:52,color:E.ink}),e.jsx("div",{style:{width:28,height:28,border:`2px solid ${E.border}`,borderTopColor:E.ink,borderRadius:"50%",animation:"spin .7s linear infinite",margin:"18px auto 0"}})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Vl,{}),e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:E.bg,minWidth:0},children:[e.jsx(wh,{view:n,sv:a,lang:i,setLang:o,open:r,toggle:()=>s(!r)}),e.jsxs("main",{style:{marginLeft:r?200:0,flex:1,padding:"32px 36px",maxWidth:r?"calc(100vw - 200px)":"100vw",overflowX:"auto",transition:"margin-left .2s ease, max-width .2s ease"},children:[n==="dashboard"&&e.jsx(zh,{offers:d,sv:a,sei:j,lang:i}),n==="offers"&&e.jsx(Eh,{offers:d,sv:a,sei:j,onDel:x,onDup:p}),(n==="offer-new"||n==="offer-edit")&&e.jsx(Dh,{lang:i,offers:d,editId:n==="offer-edit"?b:null,prefillData:n==="offer-new"?c:null,onSave:async y=>{g(null),await m(y)},onBack:()=>{g(null),a("offers")}}),n==="formularios"&&e.jsx(jh,{sv:a,onCreateOfferFromBriefing:l,onCreateClientFromBriefing:f}),n==="clientes"&&e.jsx(Sh,{}),n==="proveedores"&&e.jsx(Ch,{}),n==="encuestas"&&e.jsx(Jh,{offers:d}),n==="settings"&&e.jsx(Yh,{})]})]})]})}const Qh=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input, select, textarea { font-family: 'DM Sans', sans-serif; outline: none; }
    button { font-family: 'DM Sans', sans-serif; cursor: pointer; }
    @keyframes fadeUp   { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    @keyframes fadeIn   { from { opacity:0; } to { opacity:1; } }
    @keyframes slideIn  { from { transform:translateX(-6px); opacity:0; } to { transform:translateX(0); opacity:1; } }
    @keyframes popIn    { from { transform:scale(.95); opacity:0; } to { transform:scale(1); opacity:1; } }
    .fade-up  { animation: fadeUp .22s ease both; }
    .fade-in  { animation: fadeIn .18s ease both; }
    .pop-in   { animation: popIn .18s ease both; }
    .mono     { font-family: 'DM Mono', monospace; }
  `}),O={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",sidebar:"#0D0D0D",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",borderMid:"#C8C5BE",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",greenLight:"#D0EBDA",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.05)",shadowMd:"0 8px 32px rgba(0,0,0,.12)",card:"#FFFFFF",greenL:"#D0EBDA",redL:"#FAE8E8",blueL:"#F0F0F0",amberL:"#FAF0E0",teal:"#0D7377",tealL:"#E0F4F4"},ye=O,Ki=()=>Math.random().toString(36).slice(2,9),ui=()=>new Date().toISOString().slice(0,10),sc=()=>new Date().toISOString(),qs=t=>{if(!t)return"";try{return new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"})}catch{return t}},Zh=["Trmino indefinido","Trmino fijo","Obra o labor","Prestacin de servicios","Aprendizaje"],ef=["Indefinido","Temporal","Formacin","Prcticas","Obra o servicio","Autnomo"],wt=(t,i=0)=>t==null||t===""?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:i,maximumFractionDigits:i}).format(Number(t)),xi=(t,i=0)=>new Intl.NumberFormat("es-CO",{minimumFractionDigits:i,maximumFractionDigits:i}).format(Number(t)||0),Ka=t=>`${(Number(t)||0).toFixed(1)}%`,hi={cargos:"hab:rrhh:cargos",asistencia:"hab:rrhh:asistencia",jornada:"hab:rrhh:jornada",activos:"hab:rrhh:activos",licencias:"hab:rrhh:licencias",gastos:"hab:rrhh:gastos",partes:"hab:rrhh:partes",empleados:"hab:rrhh:empleados",novedades:"hab:rrhh:novedades",fichas:"hab:rrhh:fichas",docs:"hab:rrhh:docs",equipos:"hab:rrhh:equipos"},Kl={get:async t=>{try{const i=await window.storage.get(t);return i?JSON.parse(i.value):null}catch{return null}},set:async(t,i)=>{try{await window.storage.set(t,JSON.stringify(i))}catch{}}},fi=(t,i)=>{const[o,n]=F.useState(i),[a,r]=F.useState(!1);F.useEffect(()=>{Kl.get(t).then(d=>{d!=null&&n(d),r(!0)})},[t]);const s=F.useCallback(async d=>{const u=typeof d=="function"?d(o):d;n(u),await Kl.set(t,u)},[t,o]);return[o,s,a]},tf={hDia:8,diasSemana:5,semanasAnio:50,pctProductivas:75,diasVacaciones:15,diasFestivos:18,diasAusencias:5},of=()=>({id:Ki(),nombre:"",salarioBruto:0,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0,fechaIngreso:ui()}),Ja=(t="")=>({nombre:t,apellidos:"",email:"",telefono:"",fechaNacimiento:"",tipoDocumento:"CC",numeroDocumento:"",cargo:"",tipoContrato:"",fechaIngreso:"",salarioBruto:0,eps:"",afp:"",arl:"",cajaCompensacion:"",entidadBancaria:"",tipoCuenta:"",cuentaBancaria:""}),Ya=[{cat:"Equipos de Cmputo",vida:3,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"PCs, porttiles, tablets, servidores",icono:"",usoRef:1760},{cat:"Impresoras y Plotters",vida:3,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Impresoras, escneres, plotters",icono:"",usoRef:1200},{cat:"Equipos de Medicin",vida:5,metodo:"Lnea recta",base:"NIIF S.17",nota:"Distancimetros, niveles lser, estaciones totales",icono:"",usoRef:800},{cat:"Mobiliario y Enseres",vida:10,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Mesas, sillas, archivadores, muebles oficina",icono:"",usoRef:1760},{cat:"Equipos de Oficina",vida:5,metodo:"Lnea recta",base:"NIIF S.17",nota:"Telfonos, proyectores, pantallas externas",icono:"",usoRef:1200},{cat:"Vehculos",vida:5,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Automviles, camionetas, motocicletas",icono:"",usoRef:1500},{cat:"Maquinaria y Equipo",vida:10,metodo:"Lnea recta",base:"NIIF S.17",nota:"Maquinaria de obra, herramientas especializadas",icono:"",usoRef:1200},{cat:"Mejoras Locativas",vida:10,metodo:"Lnea recta",base:"NIIF S.17 / NIC 16",nota:"Adecuaciones a espacios arrendados",icono:"",usoRef:1760},{cat:"Software licencia perpetua",vida:3,metodo:"Lnea recta",base:"NIIF S.18 Intangibles",nota:"CAD, BIM, render (licencias de compra nica)",icono:"",usoRef:1760},{cat:"Otro / Personalizado",vida:5,metodo:"Lnea recta",base:"Manual",nota:"Define la vida til manualmente",icono:"",usoRef:1760}],_i=new Date().getFullYear(),nf=()=>({id:Ki(),nombre:"",categoria:"",valorCompra:0,anioCompra:_i,vidaUtilAnios:5,metodo:"Lnea recta",usoAnual:1760,baseNiif:"",activo:!0,vidaUtilEditada:!1}),rf=()=>({id:Ki(),nombre:"",plan:"",costoAnual:0,usuarios:1,activo:!0}),af=()=>({id:Ki(),concepto:"",montoMensual:0,categoria:"Oficina"}),Sn=[{id:"vacaciones",lbl:"Vacaciones",icono:"",color:"#111111",bg:"#E8F4EE",requiereDoc:!1,requiereFechas:!0,requiereHoras:!1},{id:"baja",lbl:"Baja Mdica",icono:"",color:"#B91C1C",bg:"#FAE8E8",requiereDoc:!0,requiereFechas:!0,requiereHoras:!1},{id:"permiso",lbl:"Permiso / Ausencia",icono:"",color:"#8C6A00",bg:"#FAF0E0",requiereDoc:!1,requiereFechas:!1,requiereHoras:!0},{id:"horasExtra",lbl:"Horas Extra",icono:"",color:"#3B3B3B",bg:"#F0F0F0",requiereDoc:!1,requiereFechas:!1,requiereHoras:!0},{id:"licEspecial",lbl:"Licencia Especial",icono:"",color:"#5B3A8C",bg:"#EDE8F4",requiereDoc:!0,requiereFechas:!0,requiereHoras:!1},{id:"otro",lbl:"Otro",icono:"",color:"#555555",bg:"#EDEBE7",requiereDoc:!1,requiereFechas:!1,requiereHoras:!1}],sf=["Cita mdica personal","Cita mdica familiar","Trmite personal","Asuntos acadmicos / formacin","Duelo familiar","Matrimonio","Mudanza","Asuntos legales","Otro"],lf=["Licencia de maternidad","Licencia de paternidad","Licencia por luto","Licencia por matrimonio","Licencia por fuerza mayor","Otra licencia especial"],df=(t="")=>({id:Ki(),empleadoNombre:t,tipo:"",estado:"Pendiente",fechaSolicitud:ui(),fechaInicio:ui(),fechaFin:"",dias:0,horas:0,motivo:"",descripcion:"",docNombre:"",docBase64:"",comentarioAdmin:"",fechaResolucion:""}),Jl=()=>({id:Ki(),empleadoId:"",empleadoNombre:"",fecha:ui(),otCodigo:"",actividad:"",horasNormales:0,horasExtra:0,horasNoProd:0,descripcion:"",estado:"Borrador"}),cf=["encargado","supervisor","jefe_obra","residente","admin","superadmin"],Ut=({children:t})=>e.jsx("span",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",fontWeight:700,color:O.inkLight},children:t}),Wt=({children:t,color:i=O.inkLight,bg:o=O.accent})=>e.jsx("span",{style:{display:"inline-flex",alignItems:"center",fontSize:9,fontWeight:700,letterSpacing:1.2,textTransform:"uppercase",padding:"2px 8px",borderRadius:2,background:o,color:i,flexShrink:0},children:t}),ri=({children:t,gap:i=12,align:o="flex-start",wrap:n=!1,style:a={}})=>e.jsx("div",{style:{display:"flex",gap:i,alignItems:o,flexWrap:n?"wrap":"nowrap",...a},children:t}),Ci=({children:t,flex:i=1,style:o={}})=>e.jsx("div",{style:{flex:i,minWidth:0,...o},children:t}),Zi=({label:t,value:i,onChange:o,type:n="text",placeholder:a="",readOnly:r=!1,note:s="",...d})=>e.jsxs("div",{children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:O.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),e.jsx("input",{type:n,value:i??"",onChange:o,placeholder:a,readOnly:r,style:{width:"100%",padding:"7px 10px",border:`1px solid ${O.border}`,borderRadius:3,fontSize:12,color:O.ink,background:r?O.accent:O.surface,fontFamily:"'DM Sans',sans-serif"},...d}),s&&e.jsx("p",{style:{fontSize:10,color:O.inkLight,marginTop:3},children:s})]}),Ze=({children:t,onClick:i,variant:o="ghost",small:n,disabled:a,icon:r,style:s={}})=>{const d={primary:{background:O.ink,color:"#fff",border:"none"},ghost:{background:O.accent,color:O.inkMid,border:`1px solid ${O.border}`},danger:{background:O.redBg,color:O.red,border:`1px solid ${O.red}33`},success:{background:O.greenBg,color:O.green,border:`1px solid ${O.green}33`},outline:{background:"transparent",color:O.inkMid,border:`1px solid ${O.border}`}};return e.jsxs("button",{onClick:i,disabled:a,style:{display:"inline-flex",alignItems:"center",gap:5,padding:n?"5px 10px":"7px 14px",borderRadius:3,fontSize:n?10:11,fontWeight:600,letterSpacing:.5,transition:"opacity .12s",opacity:a?.45:1,...d[o],...s},children:[r&&e.jsx(r,{size:n?10:12}),t]})},mt=({value:t,onChange:i,placeholder:o,type:n="text",small:a,style:r={},readOnly:s})=>e.jsx("input",{type:n,value:t??"",onChange:d=>i==null?void 0:i(d.target.value),placeholder:o,readOnly:s,style:{width:"100%",padding:a?"5px 8px":"7px 10px",background:s?O.accent:O.surface,border:`1px solid ${O.border}`,borderRadius:3,fontSize:12,color:O.ink,transition:"border-color .12s",...r},onFocus:d=>!s&&(d.target.style.borderColor=O.borderMid),onBlur:d=>d.target.style.borderColor=O.border}),mi=({value:t,onChange:i,options:o,small:n,style:a={}})=>e.jsx("select",{value:t??"",onChange:r=>i(r.target.value),style:{width:"100%",padding:n?"5px 8px":"7px 10px",background:O.surface,border:`1px solid ${O.border}`,borderRadius:3,fontSize:12,color:O.ink,appearance:"none",...a},children:o.map(r=>e.jsx("option",{value:r.value??r,children:r.label??r},r.value??r))}),Yl=({label:t,value:i,onChange:o,options:n,...a})=>e.jsxs("div",{children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:O.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),e.jsx("select",{value:i??"",onChange:o,style:{width:"100%",padding:"7px 10px",background:O.surface,border:`1px solid ${O.border}`,borderRadius:3,fontSize:12,color:O.ink,appearance:"none"},children:(n||[]).map(r=>e.jsx("option",{value:r.value??r,children:r.label??r},r.value??r))})]}),gn=({children:t})=>e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:O.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),lc=({icon:t,children:i,color:o})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12},children:[t&&e.jsx(t,{size:15,style:{color:o||O.ink,flexShrink:0}}),e.jsx("span",{style:{fontSize:14,fontWeight:700,color:o||O.ink},children:i})]}),bt=({label:t,children:i,note:o})=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr",gap:12,alignItems:"center",marginBottom:10},children:[e.jsxs("div",{children:[e.jsx(Ut,{children:t}),o&&e.jsx("div",{style:{fontSize:9,color:O.inkLight,marginTop:2},children:o})]}),i]}),Qt=({children:t,style:i={}})=>e.jsx("div",{style:{background:O.surface,border:`1px solid ${O.border}`,borderRadius:4,padding:"18px 20px",boxShadow:O.shadow,...i},children:t}),oo=({children:t,action:i})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,letterSpacing:.3,color:O.ink},children:t}),i]}),ei=({label:t,value:i,sub:o,color:n=O.ink,icon:a})=>e.jsxs("div",{style:{background:O.surface,border:`1px solid ${O.border}`,borderRadius:4,padding:"14px 16px",flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx(Ut,{children:t}),a&&e.jsx(a,{size:13,color:O.inkXLight})]}),e.jsx("div",{style:{marginTop:8,fontSize:22,fontWeight:700,color:n,lineHeight:1},className:"mono",children:i}),o&&e.jsx("div",{style:{marginTop:4,fontSize:10,color:O.inkLight},children:o})]});function pf({cargos:t,saveCargos:i,jornada:o}){const[n,a]=F.useState(null),[r,s]=F.useState(!1),d=F.useMemo(()=>{const c=o;return(c.diasSemana*c.semanasAnio-c.diasFestivos-c.diasAusencias)*c.hDia*(c.pctProductivas/100)},[o]),u=c=>{const g=Number(c.salarioBruto)||0,l=1+(Number(c.prestaciones)+Number(c.segSocial)+Number(c.parafiscales))/100;return g*l},b=c=>d>0?u(c)/d:0,j=()=>{a(of()),s(!0)},w=c=>{a({...c}),s(!1)},S=()=>a(null),m=()=>{n.nombre&&(i(c=>r?[...c,n]:c.map(g=>g.id===n.id?n:g)),S())},x=c=>i(g=>g.filter(l=>l.id!==c)),p=(c,g)=>a(l=>({...l,[c]:g}));return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ei,{label:"Cargos activos",value:t.filter(c=>c.activo).length,icon:Fi}),e.jsx(ei,{label:"Masa salarial/mes",value:wt(t.filter(c=>c.activo).reduce((c,g)=>c+u(g)/12,0)),icon:mr}),e.jsx(ei,{label:"Horas productivas/ao",value:xi(d),sub:"por empleado (config. en Jornada)",icon:Ea,color:O.blue}),e.jsx(ei,{label:"Rango coste/hora",value:t.length?`${wt(Math.min(...t.map(b)))}  ${wt(Math.max(...t.map(b)))}`:"",sub:"sin estructura",icon:Hi,color:O.green})]}),e.jsxs(Qt,{children:[e.jsx(oo,{action:e.jsxs(Ze,{variant:"primary",small:!0,onClick:j,children:[e.jsx(Pe,{size:12}),"Nuevo cargo"]}),children:"Cargos y Salarios"}),t.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:O.inkLight},children:[e.jsx(Fi,{size:32,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{fontSize:12},children:"Sin cargos registrados. Aade el primero."})]}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`2px solid ${O.border}`},children:["Cargo","Salario bruto/ao","Prestac.","Seg. Social","Parafiscal","Costo total/ao","Costo/hora",""].map(c=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:O.inkLight,fontWeight:700},children:c},c))})}),e.jsx("tbody",{children:t.map(c=>e.jsxs("tr",{style:{borderBottom:`1px solid ${O.border}`,transition:"background .1s"},onMouseEnter:g=>g.currentTarget.style.background=O.surfaceAlt,onMouseLeave:g=>g.currentTarget.style.background="",children:[e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("span",{style:{fontWeight:600,color:O.ink},children:c.nombre||""}),!c.activo&&e.jsx(Wt,{color:O.amber,bg:O.amberBg,style:{marginLeft:6},children:"Inactivo"})]}),e.jsx("td",{style:{padding:"10px 10px"},className:"mono",children:wt(c.salarioBruto)}),e.jsx("td",{style:{padding:"10px 10px",color:O.inkMid},className:"mono",children:Ka(c.prestaciones)}),e.jsx("td",{style:{padding:"10px 10px",color:O.inkMid},className:"mono",children:Ka(c.segSocial)}),e.jsx("td",{style:{padding:"10px 10px",color:O.inkMid},className:"mono",children:Ka(c.parafiscales)}),e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},className:"mono",children:wt(u(c))}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Wt,{color:O.green,bg:O.greenBg,children:[wt(b(c)),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(Ze,{small:!0,variant:"ghost",onClick:()=>w(c),children:e.jsx(io,{size:11})}),e.jsx(Ze,{small:!0,variant:"danger",onClick:()=>x(c.id),children:e.jsx(qe,{size:11})})]})})]},c.id))})]})})]}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:S,children:e.jsxs("div",{className:"pop-in",style:{background:O.surface,borderRadius:6,padding:28,width:480,boxShadow:O.shadowMd},onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:20,fontSize:15,fontWeight:700},children:r?"Nuevo cargo":"Editar cargo"}),e.jsx(bt,{label:"Nombre del cargo",children:e.jsx(mt,{value:n.nombre,onChange:c=>p("nombre",c),placeholder:"Ej. Diseador Senior"})}),e.jsx(bt,{label:"Salario bruto anual",note:"COP  sin prestaciones",children:e.jsx(mt,{type:"number",value:n.salarioBruto,onChange:c=>p("salarioBruto",c)})}),e.jsxs("div",{style:{background:O.accent,borderRadius:3,padding:"12px 14px",marginBottom:12},children:[e.jsx("p",{style:{fontSize:10,color:O.inkLight,marginBottom:8},children:"CARGAS SOCIALES SOBRE SALARIO"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[{k:"prestaciones",lbl:"Prestaciones (%)",note:"~52.18"},{k:"segSocial",lbl:"Seg. Social (%)",note:"~12.5"},{k:"parafiscales",lbl:"Parafiscales (%)",note:"~9.0"}].map(c=>e.jsxs("div",{children:[e.jsx(Ut,{children:c.lbl}),e.jsx(mt,{type:"number",value:n[c.k],onChange:g=>p(c.k,g),small:!0,style:{marginTop:4}})]},c.k))})]}),n.salarioBruto>0&&e.jsxs("div",{style:{background:O.greenBg,borderRadius:3,padding:"10px 14px",marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontSize:11,color:O.green},children:"Costo total empleador/ao"}),e.jsx("strong",{style:{fontSize:13,color:O.green},className:"mono",children:wt(u(n))})]}),e.jsx(bt,{label:"Estado",children:e.jsx(mi,{value:n.activo?"true":"false",onChange:c=>p("activo",c==="true"),options:[{value:"true",label:"Activo"},{value:"false",label:"Inactivo"}]})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:20,paddingTop:16,borderTop:`1px solid ${O.border}`},children:[e.jsx(Ze,{variant:"outline",onClick:S,children:"Cancelar"}),e.jsxs(Ze,{variant:"primary",onClick:m,children:[e.jsx(Co,{size:12}),"Guardar"]})]})]})})]})}function gf({jornada:t,saveJornada:i}){const[o,n]=F.useState({...t}),[a,r]=F.useState(!1),s=(x,p)=>n(c=>({...c,[x]:Number(p)||0})),d=F.useMemo(()=>o.diasSemana*o.semanasAnio-o.diasFestivos-o.diasAusencias,[o]),u=d*o.hDia,b=u*(o.pctProductivas/100),j=o.diasVacaciones*o.hDia,w=Math.max(0,b-j),S=async()=>{await i(o),r(!0),setTimeout(()=>r(!1),2e3)},m=(x,p,c,g="")=>e.jsxs("div",{style:{background:O.surface,border:`1px solid ${O.border}`,borderRadius:3,padding:"12px 14px"},children:[e.jsx(Ut,{children:x}),c&&e.jsx("div",{style:{fontSize:9,color:O.inkLight,marginTop:1,marginBottom:6},children:c}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginTop:c?0:6},children:[e.jsx(mt,{type:"number",value:o[p],onChange:l=>s(p,l),style:{flex:1}}),g&&e.jsx("span",{style:{fontSize:11,color:O.inkLight,whiteSpace:"nowrap"},children:g})]})]},p);return e.jsx("div",{className:"fade-up",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1.2fr",gap:16},children:[e.jsx("div",{children:e.jsxs(Qt,{children:[e.jsx(oo,{children:"Configuracin de jornada"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[m("Horas por da","hDia",null,"h/da"),m("Das a la semana","diasSemana",null,"das"),m("Semanas al ao","semanasAnio",null,"semanas"),m("% Horas productivas","pctProductivas","Reuniones, dessp., admin.","%"),m("Das de vacaciones","diasVacaciones","Segn contrato","das/ao"),m("Festivos nacionales","diasFestivos","Colombia 2025","das"),m("Ausencias estimadas","diasAusencias","Prom. bajas / permisos","das/ao")]}),e.jsx("div",{style:{marginTop:14,display:"flex",justifyContent:"flex-end"},children:e.jsx(Ze,{variant:"primary",onClick:S,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Vo,{size:12}),"Guardado"]}):e.jsxs(e.Fragment,{children:[e.jsx(Co,{size:12}),"Guardar"]})})})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs(Qt,{children:[e.jsx(oo,{children:"Clculo anual por empleado"}),[{lbl:"Das laborales brutos",val:xi(o.diasSemana*o.semanasAnio),unit:"das"},{lbl:"Menos festivos",val:` ${o.diasFestivos}`,unit:"das",color:O.red},{lbl:"Menos ausencias estimadas",val:` ${o.diasAusencias}`,unit:"das",color:O.amber},{lbl:"Das laborales efectivos",val:xi(d),unit:"das",bold:!0},null,{lbl:"Horas brutas totales",val:xi(u),unit:"h"},{lbl:"Horas productivas efectivas",val:xi(b),unit:"h",color:O.inkMid},{lbl:"Menos horas vacaciones",val:` ${j}`,unit:"h",color:O.red}].map((x,p)=>x===null?e.jsx("div",{style:{borderTop:`1px dashed ${O.border}`,margin:"6px 0"}},p):e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0"},children:[e.jsx("span",{style:{fontSize:12,color:O.inkMid},children:x.lbl}),e.jsxs("span",{style:{fontSize:12,fontWeight:x.bold?700:400,color:x.color||O.ink},className:"mono",children:[x.val," ",e.jsx("span",{style:{color:O.inkLight,fontSize:10},children:x.unit})]})]},p)),e.jsxs("div",{style:{marginTop:10,background:O.greenBg,borderRadius:3,padding:"12px 14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(Ut,{children:"Horas productivas netas / ao"}),e.jsx("div",{style:{fontSize:9,color:O.green,marginTop:2},children:"Base para clculo de coste/hora"})]}),e.jsx("span",{style:{fontSize:26,fontWeight:800,color:O.green},className:"mono",children:xi(w)})]})]}),e.jsxs(Qt,{children:[e.jsx(oo,{children:"Cmo se usa este dato?"}),e.jsxs("p",{style:{fontSize:11,color:O.inkMid,lineHeight:1.6},children:["Las ",e.jsxs("strong",{children:[xi(w)," horas productivas"]})," son el denominador del clculo de coste/hora por cargo:"]}),e.jsxs("div",{style:{marginTop:10,background:O.accent,borderRadius:3,padding:"10px 12px",fontFamily:"'DM Mono', monospace",fontSize:11,color:O.inkMid,lineHeight:1.8},children:["Coste/hora = Costo empleador anual  ",xi(w)," h",e.jsx("br",{}),e.jsx("span",{style:{color:O.inkLight,fontSize:10},children:"+ fraccin de estructura (activos + licencias + gastos generales)"})]})]})]})]})})}function uf({activos:t,saveActivos:i,licencias:o,saveLicencias:n,gastos:a,saveGastos:r}){const[s,d]=F.useState("activos"),[u,b]=F.useState(null),[j,w]=F.useState(null),[S,m]=F.useState(null),x=t.reduce((y,h)=>y+(h.valorCompra/h.vidaUtilAnios||0),0),p=o.reduce((y,h)=>y+Number(h.costoAnual||0),0),c=a.reduce((y,h)=>y+Number(h.montoMensual||0),0),g=x+p+c*12,l=(y,h,v,A)=>{h(z=>A?[...z,v]:z.map(k=>k.id===v.id?v:k)),b(null),w(null),m(null)},f=(y,h)=>e.jsx("button",{onClick:()=>d(y),style:{padding:"6px 14px",background:s===y?O.ink:"transparent",color:s===y?"#fff":O.inkMid,border:`1px solid ${s===y?O.ink:O.border}`,borderRadius:3,fontSize:11,fontWeight:600,letterSpacing:.5,cursor:"pointer"},children:h});return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ei,{label:"Depreciacin anual activos",value:wt(x),icon:Fn}),e.jsx(ei,{label:"Licencias / ao",value:wt(p),icon:Dc}),e.jsx(ei,{label:"Gastos generales / ao",value:wt(c*12),icon:zo}),e.jsx(ei,{label:"Total estructura / ao",value:wt(g),icon:Hi,color:O.blue,sub:"se prorratea sobre las horas productivas"})]}),e.jsxs(Qt,{children:[e.jsxs("div",{style:{display:"flex",gap:6,marginBottom:16},children:[f("activos","Activos NIIF"),f("licencias","Licencias Software"),f("gastos","Gastos Generales")]}),s==="activos"&&e.jsxs(e.Fragment,{children:[e.jsx(oo,{action:e.jsxs(Ze,{small:!0,variant:"primary",onClick:()=>b({...nf(),isNew:!0}),children:[e.jsx(Pe,{size:12}),"Nuevo activo"]}),children:"Inventario de Activos"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${O.border}`,background:O.surfaceAlt},children:[["Activo","Categora NIIF","Ao compra","Valor compra","Vida til","Dep./ao","Dep. acumulada","Valor neto","Costo/hora"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:O.inkLight,fontWeight:700,whiteSpace:"nowrap"},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{textAlign:"center",padding:"36px 0",color:O.inkLight,fontSize:12},children:"Sin activos registrados. Pulsa Nuevo activo para aadir el primero."})}),t.map(y=>{const h=y.vidaUtilAnios>0?y.valorCompra/y.vidaUtilAnios:0,v=Math.min(_i-Number(y.anioCompra||_i),Number(y.vidaUtilAnios)),A=h*Math.max(0,v),z=Math.max(0,y.valorCompra-A),k=y.usoAnual>0?h/y.usoAnual:0,T=y.valorCompra>0?A/y.valorCompra*100:0,C=Ya.find(K=>K.cat===y.categoria),D=T>=90?O.red:T>=60?O.amber:O.green;return e.jsxs("tr",{style:{borderBottom:`1px solid ${O.border}`},onMouseEnter:K=>K.currentTarget.style.background=O.surfaceAlt,onMouseLeave:K=>K.currentTarget.style.background="",children:[e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("div",{style:{fontWeight:600,color:O.ink},children:y.nombre||""}),y.baseNiif&&e.jsx("div",{style:{fontSize:9,color:O.inkLight,marginTop:1},children:y.baseNiif})]}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[e.jsx("span",{children:(C==null?void 0:C.icono)||""}),e.jsx("span",{style:{fontSize:11,color:O.inkMid},children:y.categoria||""})]})}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",textAlign:"center",color:O.inkMid},children:y.anioCompra||""}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:wt(y.valorCompra)}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsxs("span",{className:"mono",style:{fontSize:12,fontWeight:600},children:[y.vidaUtilAnios," aos"]}),y.vidaUtilEditada&&e.jsx(Wt,{color:O.amber,bg:O.amberBg,children:"Manual"})]}),e.jsx("div",{style:{fontSize:9,color:O.inkLight},children:y.metodo})]}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:wt(h)}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("div",{className:"mono",style:{fontSize:12},children:wt(A)}),e.jsx("div",{style:{marginTop:3,background:O.accent,borderRadius:2,height:3},children:e.jsx("div",{style:{width:`${Math.min(T,100)}%`,height:"100%",borderRadius:2,background:T>=90?O.red:T>=60?O.amber:O.blue}})}),e.jsxs("div",{style:{fontSize:9,color:O.inkLight,marginTop:1},children:[T.toFixed(0),"% amortizado"]})]}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("span",{className:"mono",style:{fontSize:12,fontWeight:700,color:D},children:wt(z)}),z===0&&e.jsx("div",{style:{fontSize:9,color:O.red},children:"Totalmente amortizado"})]}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Wt,{color:O.blue,bg:O.blueBg,children:[wt(k),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(Ze,{small:!0,variant:"ghost",onClick:()=>b({...y,isNew:!1}),children:e.jsx(io,{size:11})}),e.jsx(Ze,{small:!0,variant:"danger",onClick:()=>i(K=>K.filter(oe=>oe.id!==y.id)),children:e.jsx(qe,{size:11})})]})})]},y.id)})]})]})}),t.length>0&&e.jsx("div",{style:{marginTop:12,display:"flex",gap:12,flexWrap:"wrap"},children:[{lbl:"Total en libros (valor neto)",val:wt(t.reduce((y,h)=>{const A=(h.vidaUtilAnios>0?h.valorCompra/h.vidaUtilAnios:0)*Math.min(_i-Number(h.anioCompra||_i),Number(h.vidaUtilAnios));return y+Math.max(0,h.valorCompra-A)},0)),color:O.ink},{lbl:"Dep. anual total en estructura",val:wt(t.reduce((y,h)=>y+(h.vidaUtilAnios>0?h.valorCompra/h.vidaUtilAnios:0),0)),color:O.blue},{lbl:"Activos totalmente amortizados",val:t.filter(y=>{const h=y.vidaUtilAnios>0?y.valorCompra/y.vidaUtilAnios:0;return y.valorCompra-h*Math.min(_i-Number(y.anioCompra||_i),Number(y.vidaUtilAnios))<=0}).length,color:O.red,isNum:!0}].map(y=>e.jsxs("div",{style:{background:O.surface,border:`1px solid ${O.border}`,borderRadius:3,padding:"10px 14px",flex:1,minWidth:160},children:[e.jsx(Ut,{children:y.lbl}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:y.color,marginTop:5},className:"mono",children:(y.isNum,y.val)})]},y.lbl))})]}),s==="licencias"&&e.jsxs(e.Fragment,{children:[e.jsx(oo,{action:e.jsxs(Ze,{small:!0,variant:"primary",onClick:()=>w({...rf(),isNew:!0}),children:[e.jsx(Pe,{size:12}),"Nueva licencia"]}),children:"Licencias de Software"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${O.border}`},children:[["Software","Plan","Usuarios","Costo/ao","Costo/mes","Costo/hora*"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:O.inkLight,fontWeight:700},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"30px 0",color:O.inkLight,fontSize:12},children:"Sin licencias registradas"})}),o.map(y=>e.jsxs("tr",{style:{borderBottom:`1px solid ${O.border}`},onMouseEnter:h=>h.currentTarget.style.background=O.surfaceAlt,onMouseLeave:h=>h.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},children:y.nombre||""}),e.jsx("td",{style:{padding:"10px 10px",color:O.inkMid},children:y.plan||""}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",textAlign:"center"},children:y.usuarios}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:wt(y.costoAnual)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",color:O.inkMid},children:wt(y.costoAnual/12)}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Wt,{color:O.blue,bg:O.blueBg,children:[wt(y.costoAnual/1760/y.usuarios||1),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(Ze,{small:!0,variant:"ghost",onClick:()=>w({...y,isNew:!1}),children:e.jsx(io,{size:11})}),e.jsx(Ze,{small:!0,variant:"danger",onClick:()=>n(h=>h.filter(v=>v.id!==y.id)),children:e.jsx(qe,{size:11})})]})})]},y.id))]})]}),e.jsx("p",{style:{fontSize:9,color:O.inkLight,marginTop:10},children:"* Basado en 1.760 h/ao. Se recalcula con la jornada configurada en la pestaa de Jornada."})]}),s==="gastos"&&e.jsxs(e.Fragment,{children:[e.jsx(oo,{action:e.jsxs(Ze,{small:!0,variant:"primary",onClick:()=>m({...af(),isNew:!0}),children:[e.jsx(Pe,{size:12}),"Nuevo gasto"]}),children:"Gastos Generales de Empresa"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${O.border}`},children:[["Concepto","Categora","Mensual","Anual"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:O.inkLight,fontWeight:700},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"30px 0",color:O.inkLight,fontSize:12},children:"Sin gastos registrados"})}),a.map(y=>e.jsxs("tr",{style:{borderBottom:`1px solid ${O.border}`},onMouseEnter:h=>h.currentTarget.style.background=O.surfaceAlt,onMouseLeave:h=>h.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},children:y.concepto||""}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsx(Wt,{children:y.categoria})}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:wt(y.montoMensual)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:wt(y.montoMensual*12)}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(Ze,{small:!0,variant:"ghost",onClick:()=>m({...y,isNew:!1}),children:e.jsx(io,{size:11})}),e.jsx(Ze,{small:!0,variant:"danger",onClick:()=>r(h=>h.filter(v=>v.id!==y.id)),children:e.jsx(qe,{size:11})})]})})]},y.id)),a.length>0&&e.jsxs("tr",{style:{background:O.accent,fontWeight:700},children:[e.jsx("td",{colSpan:2,style:{padding:"10px 10px",fontSize:11},children:"TOTAL GASTOS GENERALES"}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:wt(c)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:wt(c*12)}),e.jsx("td",{})]})]})]})]})]}),u&&(()=>{const y=Ya.find(k=>k.cat===u.categoria),h=u.vidaUtilAnios>0?u.valorCompra/u.vidaUtilAnios:0,v=Math.min(_i-Number(u.anioCompra||_i),Number(u.vidaUtilAnios)),A=h*Math.max(0,v),z=Math.max(0,u.valorCompra-A);return e.jsxs(ta,{title:u.isNew?"Nuevo activo NIIF":"Editar activo",onClose:()=>b(null),wide:!0,children:[e.jsxs("div",{style:{marginBottom:14},children:[e.jsx(Ut,{children:"Categora NIIF"}),e.jsx("div",{style:{marginTop:6,display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6},children:Ya.map(k=>e.jsxs("button",{onClick:()=>b(T=>({...T,categoria:k.cat,metodo:k.metodo,baseNiif:k.base,vidaUtilAnios:k.vida,usoAnual:k.usoRef,vidaUtilEditada:!1})),style:{padding:"8px 6px",borderRadius:3,border:`1px solid ${u.categoria===k.cat?O.ink:O.border}`,background:u.categoria===k.cat?O.ink:O.surface,color:u.categoria===k.cat?"#fff":O.inkMid,fontSize:10,cursor:"pointer",textAlign:"center",lineHeight:1.3,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("div",{style:{fontSize:18,marginBottom:3},children:k.icono}),e.jsx("div",{style:{fontWeight:u.categoria===k.cat?700:400},children:k.cat})]},k.cat))}),y&&e.jsxs("div",{style:{marginTop:8,background:O.blueBg,borderRadius:3,padding:"8px 12px",display:"flex",gap:12,alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,color:O.blue},children:"Norma aplicable: "}),e.jsx("span",{style:{fontSize:10,color:O.blue},children:y.base})]}),e.jsx("div",{style:{flex:2,fontSize:10,color:O.blue,opacity:.8},children:y.nota})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:8},children:[e.jsx(bt,{label:"Nombre del activo",children:e.jsx(mt,{value:u.nombre,onChange:k=>b(T=>({...T,nombre:k})),placeholder:"Ej. MacBook Pro 14 M3"})}),e.jsx(bt,{label:"Ao de compra",children:e.jsx(mt,{type:"number",value:u.anioCompra,onChange:k=>b(T=>({...T,anioCompra:k})),placeholder:String(_i)})}),e.jsx(bt,{label:"Valor de compra (COP)",children:e.jsx(mt,{type:"number",value:u.valorCompra,onChange:k=>b(T=>({...T,valorCompra:k}))})}),e.jsx(bt,{label:"Horas de uso estimadas/ao",children:e.jsx(mt,{type:"number",value:u.usoAnual,onChange:k=>b(T=>({...T,usoAnual:k}))})})]}),e.jsxs("div",{style:{background:O.accent,borderRadius:3,padding:"12px 14px",marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(Ut,{children:"Vida til (aos)"}),e.jsx("button",{onClick:()=>b(k=>({...k,vidaUtilEditada:!k.vidaUtilEditada})),style:{fontSize:9,color:O.blue,background:"none",border:"none",cursor:"pointer",textDecoration:"underline"},children:u.vidaUtilEditada?" Restaurar valor NIIF":"Editar manualmente"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx(Ut,{children:"Vida til"}),e.jsx(mt,{type:"number",value:u.vidaUtilAnios,readOnly:!u.vidaUtilEditada,onChange:k=>b(T=>({...T,vidaUtilAnios:k,vidaUtilEditada:!0})),style:{marginTop:4,background:u.vidaUtilEditada?O.surface:O.accent}}),y&&!u.vidaUtilEditada&&e.jsxs("div",{style:{fontSize:9,color:O.green,marginTop:2},children:[" Segn ",y.base]})]}),e.jsxs("div",{children:[e.jsx(Ut,{children:"Mtodo"}),e.jsx(mt,{value:u.metodo,readOnly:!0,style:{marginTop:4,background:O.accent}})]}),e.jsxs("div",{children:[e.jsx(Ut,{children:"Norma"}),e.jsx(mt,{value:u.baseNiif,readOnly:!0,style:{marginTop:4,background:O.accent,fontSize:10}})]})]})]}),u.valorCompra>0&&u.vidaUtilAnios>0&&e.jsxs("div",{style:{background:O.greenBg,borderRadius:3,padding:"12px 14px",marginBottom:8},children:[e.jsx(Ut,{children:"Vista previa de depreciacin"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginTop:8},children:[{lbl:"Dep. anual",val:wt(h)},{lbl:"Dep. acumulada",val:wt(A)},{lbl:"Valor neto libros",val:wt(z),bold:!0},{lbl:"Costo/hora uso",val:wt(u.usoAnual>0?h/u.usoAnual:0)+"/h"}].map(k=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:O.green,marginBottom:3},children:k.lbl}),e.jsx("div",{style:{fontSize:13,fontWeight:k.bold?800:600,color:O.green},className:"mono",children:k.val})]},k.lbl))}),A>=u.valorCompra&&e.jsx("div",{style:{marginTop:8,fontSize:10,color:O.red,fontWeight:600},children:" Este activo est totalmente amortizado. Considera darlo de baja o actualizar el ao de compra."})]}),e.jsx(ia,{onCancel:()=>b(null),onSave:()=>l(t,i,u,u.isNew)})]})})(),j&&e.jsxs(ta,{title:j.isNew?"Nueva licencia":"Editar licencia",onClose:()=>w(null),children:[[["nombre","Software","text"],["plan","Plan","text"],["usuarios","N usuarios","number"],["costoAnual","Costo anual (COP)","number"]].map(([y,h,v])=>e.jsx(bt,{label:h,children:e.jsx(mt,{type:v,value:j[y],onChange:A=>w(z=>({...z,[y]:A}))})},y)),e.jsx(ia,{onCancel:()=>w(null),onSave:()=>l(o,n,j,j.isNew)})]}),S&&e.jsxs(ta,{title:S.isNew?"Nuevo gasto":"Editar gasto",onClose:()=>m(null),children:[e.jsx(bt,{label:"Concepto",children:e.jsx(mt,{value:S.concepto,onChange:y=>m(h=>({...h,concepto:y}))})}),e.jsx(bt,{label:"Categora",children:e.jsx(mi,{value:S.categoria,onChange:y=>m(h=>({...h,categoria:y})),options:["Oficina","Comunicaciones","Seguros","Suscripciones","Transporte","Otros"]})}),e.jsx(bt,{label:"Monto mensual (COP)",children:e.jsx(mt,{type:"number",value:S.montoMensual,onChange:y=>m(h=>({...h,montoMensual:y}))})}),e.jsx(ia,{onCancel:()=>m(null),onSave:()=>l(a,r,S,S.isNew)})]})]})}function hf({equipo:t,setEquipo:i,cargos:o,pais:n}){const[a,r]=F.useState(null),[s,d]=F.useState(""),u=n==="CO"?Zh:ef,b=()=>{var w;return{id:Ki(),nombre:"",documento:"",cargo:((w=o[0])==null?void 0:w.id)||"",email:"",telefono:"",tipoContrato:u[0],fechaIngreso:ui(),pin:"",activo:!0,pais:n,foto:null}},j=F.useMemo(()=>t.filter(w=>{var S,m;return!s||w.nombre.toLowerCase().includes(s.toLowerCase())||((S=w.documento)==null?void 0:S.includes(s))||((m=w.email)==null?void 0:m.toLowerCase().includes(s.toLowerCase()))}),[t,s]);return e.jsxs("div",{children:[e.jsxs(ri,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsxs("div",{style:{flex:1,fontSize:16,fontWeight:700,color:ye.ink},children:["Equipo (",t.filter(w=>w.activo).length," activos)"]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(vi,{size:13,style:{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",color:ye.inkLight}}),e.jsx("input",{value:s,onChange:w=>d(w.target.value),placeholder:"Buscar...",style:{padding:"7px 10px 7px 28px",border:`1px solid ${ye.border}`,borderRadius:6,fontSize:13,outline:"none",width:180}})]}),e.jsx(Ze,{icon:Pe,onClick:()=>r(b()),children:"Aadir empleado"})]}),a&&e.jsxs(Qt,{style:{marginBottom:16,border:`1px solid ${ye.green}`},children:[e.jsx(lc,{icon:Fi,children:"Nuevo empleado"}),e.jsxs(ri,{gap:14,wrap:!0,children:[e.jsx(Ci,{children:e.jsx(Zi,{label:"Nombre completo",req:!0,value:a.nombre,onChange:w=>r({...a,nombre:w.target.value})})}),e.jsx(Ci,{children:e.jsx(Zi,{label:n==="CO"?"Cdula / CC":"DNI / NIE",req:!0,value:a.documento,onChange:w=>r({...a,documento:w.target.value})})}),e.jsx(Ci,{children:e.jsx(Yl,{label:"Cargo",value:a.cargo,onChange:w=>r({...a,cargo:w.target.value}),options:[{value:"",label:" Sin cargo "},...o.map(w=>({value:w.id,label:w.nombre}))]})})]}),e.jsxs(ri,{gap:14,wrap:!0,children:[e.jsx(Ci,{children:e.jsx(Zi,{label:"Email",type:"email",value:a.email,onChange:w=>r({...a,email:w.target.value})})}),e.jsx(Ci,{children:e.jsx(Zi,{label:"Telfono",value:a.telefono,onChange:w=>r({...a,telefono:w.target.value})})}),e.jsx(Ci,{children:e.jsx(Zi,{label:"Fecha ingreso",type:"date",value:a.fechaIngreso,onChange:w=>r({...a,fechaIngreso:w.target.value})})})]}),e.jsxs(ri,{gap:14,wrap:!0,children:[e.jsx(Ci,{children:e.jsx(Yl,{label:"Tipo contrato",value:a.tipoContrato,onChange:w=>r({...a,tipoContrato:w.target.value}),options:u})}),e.jsxs(Ci,{children:[e.jsx(Zi,{label:"PIN de 4 dgitos (para fichaje de obra)",type:"password",maxLength:4,value:a.pin,onChange:w=>r({...a,pin:w.target.value.replace(/\D/g,"").slice(0,4)}),placeholder:""}),e.jsx("div",{style:{fontSize:11,color:ye.inkLight,marginTop:-8},children:"El trabajador lo usa para fichar en obra"})]}),e.jsx(Ci,{children:e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(gn,{children:"Estado"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginTop:6},children:[e.jsx("input",{type:"checkbox",checked:a.activo,onChange:w=>r({...a,activo:w.target.checked}),style:{width:16,height:16}}),e.jsx("span",{style:{fontSize:13},children:"Empleado activo"})]})]})})]}),e.jsxs(ri,{gap:8,children:[e.jsx(Ze,{icon:ft,onClick:()=>{i(w=>[...w,a]),r(null)},children:"Guardar"}),e.jsx(Ze,{variant:"secondary",onClick:()=>r(null),children:"Cancelar"})]})]}),e.jsx("div",{style:{overflowX:"auto",border:`1px solid ${ye.border}`,borderRadius:8},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:600},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:ye.bg},children:["Empleado","Cargo","Tipo contrato","Ingreso","Estado","PIN",""].map(w=>e.jsx("th",{style:{padding:"8px 12px",fontSize:11,fontWeight:600,color:ye.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${ye.border}`},children:w},w))})}),e.jsxs("tbody",{children:[j.map((w,S)=>{const m=o.find(x=>x.id===w.cargo);return e.jsxs("tr",{style:{background:S%2===0?ye.card:ye.bg},children:[e.jsxs("td",{style:{padding:"10px 12px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:w.nombre}),e.jsx("div",{style:{fontSize:11,color:ye.inkLight},children:w.documento})]}),e.jsx("td",{style:{padding:"10px 12px",fontSize:13,color:ye.inkMid},children:(m==null?void 0:m.nombre)||""}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:ye.inkMid},children:w.tipoContrato}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:ye.inkMid},children:qs(w.fechaIngreso)}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx(Wt,{color:w.activo?ye.green:ye.inkLight,children:w.activo?"Activo":"Inactivo"})}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:ye.inkLight,fontFamily:"'DM Mono',monospace"},children:w.pin?"":""}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("button",{onClick:()=>i(x=>x.filter(p=>p.id!==w.id)),style:{background:"none",border:"none",cursor:"pointer",color:ye.red,padding:2},children:e.jsx(qe,{size:13})})})]},w.id)}),j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:"32px",textAlign:"center",color:ye.inkLight,fontSize:13},children:"Sin empleados."})})]})]})})]})}function ff({partes:t,setPartes:i,equipo:o,cargos:n,currentUser:a,pais:r}){const[s,d]=F.useState(null),[u,b]=F.useState(null),[j,w]=F.useState("todas"),[S,m]=F.useState({});F.useEffect(()=>{var v,A;const h={};try{if(window.storage){const z=(A=(v=window.storage).list)==null?void 0:A.call(v,"hab:proj:actividades:");z!=null&&z.keys&&z.keys.forEach(k=>{var T,C;try{const D=(C=(T=window.storage).get)==null?void 0:C.call(T,k);if(D!=null&&D.value){const K=JSON.parse(D.value),oe=k.replace("hab:proj:actividades:","");h[oe]=K}}catch{}})}}catch{}m(h)},[]);const x=!a||cf.includes(a.rol),p=[...new Set(t.map(h=>h.otId).filter(Boolean))],c=()=>({id:Ki(),fecha:ui(),encargadoId:(a==null?void 0:a.id)||"",encargadoNombre:(a==null?void 0:a.nombre)||"",otId:"",actividadId:"",actividadNombre:"",trabajadores:[],horasPorTrabajador:{},avance:0,notas:"",fotos:[],estado:"borrador",creadoEn:sc()}),g=F.useMemo(()=>a?o.filter(h=>h.activo):o,[o,a]),l=h=>S[h]||[],f=Object.keys(S),y=F.useMemo(()=>t.filter(h=>j==="todas"||h.otId===j),[t,j]);return e.jsxs("div",{children:[e.jsxs(ri,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsxs("div",{style:{flex:1,fontSize:16,fontWeight:700,color:ye.ink},children:["Partes de Trabajo (",t.length,")"]}),!x&&e.jsx(Wt,{color:ye.amber,children:"Solo encargados y supervisores pueden crear partes"}),x&&e.jsx(Ze,{icon:Pe,onClick:()=>d(c()),children:"Nuevo parte"})]}),e.jsxs("div",{style:{background:ye.blueL,border:`1px solid ${ye.blue}22`,borderRadius:8,padding:"10px 14px",marginBottom:16,fontSize:12,color:ye.blue},children:[e.jsx("strong",{children:"Reglas de partes:"})," Solo el encargado/supervisor/jefe crea partes. Selecciona la OT  la actividad del Gantt (definida en el borrador de costes del CRM)  el equipo que trabaj. El avance del Gantt se actualiza automticamente."]}),s&&e.jsxs(Qt,{style:{marginBottom:16,border:`1px solid ${ye.green}`},children:[e.jsx(lc,{icon:At,color:ye.green,children:"Nuevo parte de trabajo"}),e.jsxs(ri,{gap:14,wrap:!0,children:[e.jsx(Ci,{children:e.jsx(Zi,{label:"Fecha",type:"date",value:s.fecha,onChange:h=>d({...s,fecha:h.target.value})})}),e.jsx(Ci,{children:e.jsx(Zi,{label:"Encargado responsable",value:s.encargadoNombre||(a==null?void 0:a.nombre)||"",disabled:!0})})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(gn,{req:!0,children:"OT / Proyecto"}),f.length===0?e.jsx("div",{style:{padding:"10px 12px",background:ye.amberL,borderRadius:6,fontSize:12,color:ye.amber},children:' No hay OTs con actividades del Gantt. Ve al mdulo CRM, completa el borrador de costes de una oferta ganada y usa "Exportar al Gantt".'}):e.jsxs("select",{value:s.otId,onChange:h=>{d({...s,otId:h.target.value,actividadId:"",actividadNombre:""})},style:{width:"100%",padding:"8px 10px",border:`1px solid ${ye.border}`,borderRadius:6,fontSize:13,background:ye.card},children:[e.jsx("option",{value:"",children:" Seleccionar OT "}),f.map(h=>{var v,A;return e.jsx("option",{value:h,children:((A=(v=S[h])==null?void 0:v[0])==null?void 0:A.otNombre)||h},h)})]})]}),s.otId&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(gn,{req:!0,children:"Actividad del Gantt"}),e.jsxs("select",{value:s.actividadId,onChange:h=>{const v=l(s.otId).find(A=>A.id===h.target.value);d({...s,actividadId:h.target.value,actividadNombre:(v==null?void 0:v.nombre)||""})},style:{width:"100%",padding:"8px 10px",border:`1px solid ${ye.border}`,borderRadius:6,fontSize:13,background:ye.card},children:[e.jsx("option",{value:"",children:" Seleccionar actividad "}),l(s.otId).map(h=>e.jsxs("option",{value:h.id,children:[h.codigo,"  ",h.nombre," (",h.cantidad," ",h.unidad,")"]},h.id))]}),s.actividadId&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(gn,{children:"% Avance de esta actividad al finalizar hoy"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("input",{type:"range",min:0,max:100,step:5,value:s.avance,onChange:h=>d({...s,avance:parseInt(h.target.value)}),style:{flex:1}}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:15,color:ye.green,minWidth:40},children:[s.avance,"%"]})]})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(gn,{children:"Equipo que trabaj hoy en esta actividad"}),e.jsxs("div",{style:{border:`1px solid ${ye.border}`,borderRadius:6,overflow:"hidden"},children:[g.length===0&&e.jsx("div",{style:{padding:"12px",fontSize:12,color:ye.inkLight},children:"Sin empleados en el equipo. Ve a la pestaa Equipo para aadir trabajadores."}),g.map((h,v)=>{var z;const A=s.trabajadores.includes(h.id);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",background:A?ye.greenL:v%2===0?ye.card:ye.bg,borderBottom:`1px solid ${ye.border}`,cursor:"pointer"},onClick:()=>d(k=>{const T=A?k.trabajadores.filter(D=>D!==h.id):[...k.trabajadores,h.id],C={...k.horasPorTrabajador};return A?delete C[h.id]:C[h.id]=8,{...k,trabajadores:T,horasPorTrabajador:C}}),children:[e.jsx("input",{type:"checkbox",readOnly:!0,checked:A,style:{width:15,height:15,accentColor:ye.green}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:A?600:400,color:ye.ink},children:h.nombre}),e.jsx("div",{style:{fontSize:11,color:ye.inkLight},children:((z=n.find(k=>k.id===h.cargo))==null?void 0:z.nombre)||"Sin cargo"})]}),A&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},onClick:k=>k.stopPropagation(),children:[e.jsx("span",{style:{fontSize:11,color:ye.inkMid},children:"Horas:"}),e.jsx("input",{type:"number",min:"0",max:"24",step:"0.5",value:s.horasPorTrabajador[h.id]||8,onChange:k=>d(T=>({...T,horasPorTrabajador:{...T.horasPorTrabajador,[h.id]:parseFloat(k.target.value)||0}})),style:{width:56,border:`1px solid ${ye.green}`,borderRadius:4,padding:"3px 6px",fontSize:13,textAlign:"center",fontFamily:"'DM Mono',monospace"}})]})]},h.id)})]}),s.trabajadores.length>0&&e.jsxs("div",{style:{fontSize:12,color:ye.inkMid,marginTop:6},children:["Total horas parte: ",xi(Object.values(s.horasPorTrabajador).reduce((h,v)=>h+v,0),1)," h  ",s.trabajadores.length," personas"]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(gn,{children:"Observaciones / Notas de obra"}),e.jsx("textarea",{value:s.notas,onChange:h=>d({...s,notas:h.target.value}),rows:2,style:{width:"100%",boxSizing:"border-box",padding:"8px 10px",border:`1px solid ${ye.border}`,borderRadius:6,fontSize:13,resize:"vertical"},placeholder:"Incidencias, materiales consumidos, condiciones de trabajo..."})]}),e.jsxs(ri,{gap:8,children:[e.jsx(Ze,{icon:ft,onClick:()=>{var v,A,z,k;if(!s.otId||!s.actividadId){alert("Selecciona OT y actividad.");return}if(s.trabajadores.length===0){alert("Selecciona al menos un trabajador.");return}const h={...s,estado:"confirmado"};i(T=>[h,...T]);try{const T="hab:proj:actividades:"+s.otId,C=(A=(v=window.storage)==null?void 0:v.get)==null?void 0:A.call(v,T);if(C!=null&&C.value){const K=JSON.parse(C.value).map(oe=>oe.id===s.actividadId?{...oe,avance:s.avance}:oe);(k=(z=window.storage)==null?void 0:z.set)==null||k.call(z,T,JSON.stringify(K))}}catch{}d(null)},children:"Confirmar parte"}),e.jsx(Ze,{variant:"secondary",onClick:()=>d(null),children:"Cancelar"})]})]}),p.length>0&&e.jsx(ri,{gap:6,style:{marginBottom:12},wrap:!0,children:["todas",...p].map(h=>e.jsx("button",{onClick:()=>w(h),style:{padding:"5px 12px",borderRadius:20,border:`1px solid ${j===h?ye.green:ye.border}`,background:j===h?ye.greenL:"transparent",fontSize:12,cursor:"pointer",color:j===h?ye.green:ye.inkMid},children:h==="todas"?"Todas las OTs":h},h))}),e.jsx("div",{style:{border:`1px solid ${ye.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:ye.bg},children:["Fecha","OT / Actividad","Encargado","Equipo","Horas totales","Avance","Estado",""].map(h=>e.jsx("th",{style:{padding:"7px 10px",fontSize:11,fontWeight:600,color:ye.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${ye.border}`},children:h},h))})}),e.jsxs("tbody",{children:[y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:"32px",textAlign:"center",color:ye.inkLight,fontSize:13},children:"Sin partes de trabajo."})}),y.map((h,v)=>{var k;const A=Object.values(h.horasPorTrabajador||{}).reduce((T,C)=>T+C,0),z=h.estado==="confirmado"?ye.green:h.estado==="validado"?ye.blue:ye.amber;return e.jsxs("tr",{style:{background:v%2===0?ye.card:ye.bg,cursor:"pointer"},onClick:()=>b(h),onMouseEnter:T=>T.currentTarget.style.background=ye.blueL,onMouseLeave:T=>T.currentTarget.style.background=v%2===0?ye.card:ye.bg,children:[e.jsx("td",{style:{padding:"9px 10px",fontSize:12},children:qs(h.fecha)}),e.jsxs("td",{style:{padding:"9px 10px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:h.otId||""}),e.jsx("div",{style:{fontSize:11,color:ye.inkMid},children:h.actividadNombre})]}),e.jsx("td",{style:{padding:"9px 10px",fontSize:12,color:ye.inkMid},children:h.encargadoNombre||""}),e.jsxs("td",{style:{padding:"9px 10px",fontSize:12},children:[((k=h.trabajadores)==null?void 0:k.length)||0," personas"]}),e.jsxs("td",{style:{padding:"9px 10px",fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:600},children:[xi(A,1)," h"]}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:ye.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{width:`${h.avance||0}%`,height:"100%",background:h.avance>=80?ye.green:h.avance>=40?ye.amber:ye.blue,borderRadius:3}})}),e.jsxs("span",{style:{fontSize:11,color:ye.inkMid,minWidth:28,fontFamily:"'DM Mono',monospace"},children:[h.avance||0,"%"]})]})}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsx(Wt,{color:z,children:h.estado})}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsx("button",{onClick:T=>{T.stopPropagation(),i(C=>C.filter(D=>D.id!==h.id))},style:{background:"none",border:"none",cursor:"pointer",color:ye.red,padding:2},children:e.jsx(qe,{size:12})})})]},h.id)})]})]})}),u&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:e.jsxs("div",{style:{background:ye.card,borderRadius:12,width:"100%",maxWidth:540,maxHeight:"85vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${ye.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:15},children:["Parte  ",qs(u.fecha)]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:ye.inkLight},children:e.jsx($t,{size:18})})]}),e.jsxs("div",{style:{padding:18},children:[[["OT",u.otId],["Actividad",u.actividadNombre],["Encargado",u.encargadoNombre],["% Avance",u.avance+"%"],["Notas",u.notas||""]].map(([h,v])=>e.jsxs("div",{style:{display:"flex",gap:12,padding:"7px 0",borderBottom:`1px solid ${ye.border}`,fontSize:13},children:[e.jsx("span",{style:{fontWeight:600,color:ye.inkMid,minWidth:90},children:h}),e.jsx("span",{style:{color:ye.ink},children:v})]},h)),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{style:{fontWeight:600,fontSize:12,color:ye.inkMid,textTransform:"uppercase",letterSpacing:.5,marginBottom:8},children:"Equipo y horas"}),(u.trabajadores||[]).map(h=>{var z;const v=o.find(k=>k.id===h),A=((z=u.horasPorTrabajador)==null?void 0:z[h])||0;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0",fontSize:13,borderBottom:`1px solid ${ye.border}`},children:[e.jsx("span",{children:(v==null?void 0:v.nombre)||h}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:[xi(A,1)," h"]})]},h)})]})]})]})})]})}function xf({equipo:t,asistencia:i,setAsistencia:o,pais:n}){var ie,me;const[a,r]=F.useState("encargado"),[s,d]=F.useState(ui());F.useState(!1);const[u,b]=F.useState(1),[j,w]=F.useState(null),[S,m]=F.useState(""),[x,p]=F.useState(!1),[c,g]=F.useState(null),[l,f]=F.useState(null),[y,h]=F.useState(null),[v,A]=F.useState(null),z=F.useRef(null),k=F.useRef(null),T=F.useMemo(()=>i.filter(Q=>Q.fecha===s).sort((Q,je)=>Q.timestamp<je.timestamp?-1:1),[i,s]),C=F.useMemo(()=>{const Q={};return T.forEach(je=>{Q[je.empleadoId]||(Q[je.empleadoId]=[]),Q[je.empleadoId].push(je)}),Q},[T]),D=async()=>{try{A(null);const Q=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}},audio:!1});k.current=Q,z.current&&(z.current.srcObject=Q)}catch(Q){A("No se pudo acceder a la cmara: "+Q.message+". Asegrate de dar permiso.")}},K=()=>{k.current&&(k.current.getTracks().forEach(Q=>Q.stop()),k.current=null)},oe=()=>{if(!z.current)return;const Q=document.createElement("canvas");Q.width=z.current.videoWidth||640,Q.height=z.current.videoHeight||480,Q.getContext("2d").drawImage(z.current,0,0,Q.width,Q.height);const je=Q.toDataURL("image/jpeg",.7);g(je),K(),navigator.geolocation?navigator.geolocation.getCurrentPosition(re=>f({lat:re.coords.latitude,lng:re.coords.longitude,precision:Math.round(re.coords.accuracy)}),re=>h("GPS no disponible: "+re.message),{timeout:8e3,maximumAge:0}):h("Geolocalizacin no disponible en este dispositivo."),b(4)},te=()=>{var re;if(!c){alert("La foto es obligatoria.");return}const Q=((re=C[j.id])==null?void 0:re.length)%2===0?"entrada":"salida",je={id:Ki(),empleadoId:j.id,empleadoNombre:j.nombre,fecha:s,timestamp:sc(),tipo:Q,foto:c,lat:(l==null?void 0:l.lat)||null,lng:(l==null?void 0:l.lng)||null,precision:(l==null?void 0:l.precision)||null,gpsError:y||null};o(J=>[...J,je]),b(5),K()},P=()=>{b(1),w(null),m(""),p(!1),g(null),f(null),h(null),A(null),K()};return F.useEffect(()=>()=>K(),[]),e.jsxs("div",{children:[e.jsxs(ri,{gap:8,style:{marginBottom:16},wrap:!0,children:[e.jsx("button",{onClick:()=>r("encargado"),style:{flex:1,padding:"10px 16px",borderRadius:8,border:`2px solid ${a==="encargado"?ye.green:ye.border}`,background:a==="encargado"?ye.greenL:ye.card,cursor:"pointer",fontFamily:"DM Sans,sans-serif",fontSize:13,fontWeight:a==="encargado"?600:400,color:a==="encargado"?ye.green:ye.inkMid},children:" Vista encargado  Panel del da"}),e.jsx("button",{onClick:()=>{r("fichaje"),P()},style:{flex:1,padding:"10px 16px",borderRadius:8,border:`2px solid ${a==="fichaje"?ye.teal:ye.border}`,background:a==="fichaje"?ye.tealL:ye.card,cursor:"pointer",fontFamily:"DM Sans,sans-serif",fontSize:13,fontWeight:a==="fichaje"?600:400,color:a==="fichaje"?ye.teal:ye.inkMid},children:" Fichaje del trabajador  Foto + GPS"})]}),a==="encargado"&&e.jsxs("div",{children:[e.jsxs(ri,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsx("div",{style:{fontSize:16,fontWeight:700,color:ye.ink,flex:1},children:"Asistencia de obra"}),e.jsx(Zi,{label:"",type:"date",value:s,onChange:Q=>d(Q.target.value),style:{marginBottom:0,width:160}})]}),e.jsx(ri,{gap:12,style:{marginBottom:16},wrap:!0,children:[["Presentes",Object.keys(C).filter(Q=>C[Q].some(je=>je.tipo==="entrada"&&!C[Q].some(re=>re.tipo==="salida"&&re.timestamp>je.timestamp))).length.toString(),ye.green],["Fichajes hoy",T.length.toString(),ye.blue],["Sin fichar",t.filter(Q=>Q.activo&&!C[Q.id]).length.toString(),ye.amber]].map(([Q,je,re])=>e.jsxs("div",{style:{flex:1,minWidth:100,background:ye.card,border:`1px solid ${ye.border}`,borderRadius:8,padding:"10px 14px",borderLeft:`3px solid ${re}`},children:[e.jsx("div",{style:{fontSize:11,color:ye.inkLight},children:Q}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:re,fontFamily:"'DM Mono',monospace"},children:je})]},Q))}),e.jsx(Qt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:ye.bg},children:["Empleado","Entrada","Salida","Horas","Foto","GPS","Estado"].map(Q=>e.jsx("th",{style:{padding:"8px 12px",fontSize:11,fontWeight:600,color:ye.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${ye.border}`},children:Q},Q))})}),e.jsxs("tbody",{children:[t.filter(Q=>Q.activo).map((Q,je)=>{const re=C[Q.id]||[],J=re.find(X=>X.tipo==="entrada"),M=re.find(X=>X.tipo==="salida"),B=diffHours(J==null?void 0:J.timestamp,M==null?void 0:M.timestamp),V=J&&!M;return e.jsxs("tr",{style:{background:je%2===0?ye.card:ye.bg},children:[e.jsxs("td",{style:{padding:"9px 12px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:Q.nombre}),e.jsx("div",{style:{fontSize:11,color:ye.inkLight},children:Q.documento})]}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontSize:13,color:J?ye.green:ye.inkLight},children:J?fmtTime(J.timestamp):""}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontSize:13,color:M?ye.red:ye.inkLight},children:M?fmtTime(M.timestamp):""}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontWeight:600,fontSize:13},children:B?xi(B,1)+" h":""}),e.jsx("td",{style:{padding:"9px 12px"},children:J!=null&&J.foto?e.jsx("img",{src:J.foto,alt:"foto",style:{width:36,height:36,borderRadius:4,objectFit:"cover",cursor:"pointer",border:`1px solid ${ye.border}`},onClick:()=>{window.open().document.write(`<img src="${J.foto}" style="max-width:100%"/>`)}}):e.jsx("span",{style:{fontSize:11,color:ye.inkLight},children:""})}),e.jsx("td",{style:{padding:"9px 12px",fontSize:12},children:J!=null&&J.lat?e.jsxs("a",{href:`https://www.openstreetmap.org/?mlat=${J.lat}&mlon=${J.lng}&zoom=17`,target:"_blank",rel:"noreferrer",style:{color:ye.blue,fontSize:11},children:[" ",J.precision,"m"]}):e.jsx("span",{style:{fontSize:11,color:ye.inkLight},children:J!=null&&J.gpsError?"Sin GPS":""})}),e.jsx("td",{style:{padding:"9px 12px"},children:J?V?e.jsx(Wt,{color:ye.green,children:"En obra"}):e.jsx(Wt,{color:ye.inkLight,children:"Salida"}):e.jsx(Wt,{color:ye.amber,children:"Sin fichar"})})]},Q.id)}),t.filter(Q=>Q.activo).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:"24px",textAlign:"center",color:ye.inkLight,fontSize:13},children:"Sin empleados activos."})})]})]})})]}),a==="fichaje"&&e.jsx("div",{style:{maxWidth:400,margin:"0 auto"},children:u===5?e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:ye.green,marginBottom:8},children:"Fichaje registrado"}),e.jsxs("div",{style:{fontSize:14,color:ye.inkMid,marginBottom:24},children:[j==null?void 0:j.nombre,"  ",((ie=C[j==null?void 0:j.id])==null?void 0:ie.length)%2===0?"SALIDA":"ENTRADA","  ",new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]}),c&&e.jsx("img",{src:c,style:{width:"100%",borderRadius:8,marginBottom:16}}),l&&e.jsxs("div",{style:{fontSize:12,color:ye.inkMid},children:[" GPS: ",l.lat.toFixed(5),", ",l.lng.toFixed(5)," (",l.precision,"m)"]}),y&&e.jsxs("div",{style:{fontSize:12,color:ye.amber},children:[" ",y]}),e.jsx(Ze,{onClick:P,style:{marginTop:20,width:"100%",justifyContent:"center"},children:"Nuevo fichaje"})]}):u===1?e.jsxs(Qt,{children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:20},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:ye.ink},children:"Control de acceso"}),e.jsx("div",{style:{fontSize:13,color:ye.inkMid},children:"Selecciona tu nombre"})]}),e.jsxs("div",{style:{maxHeight:300,overflowY:"auto",border:`1px solid ${ye.border}`,borderRadius:8},children:[t.filter(Q=>Q.activo).map((Q,je)=>e.jsx("div",{onClick:()=>{w(Q),b(2)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:`1px solid ${ye.border}`,background:je%2===0?ye.card:ye.bg,fontSize:14,fontWeight:500,color:ye.ink},onMouseEnter:re=>re.currentTarget.style.background=ye.greenL,onMouseLeave:re=>re.currentTarget.style.background=je%2===0?ye.card:ye.bg,children:Q.nombre},Q.id)),t.filter(Q=>Q.activo).length===0&&e.jsx("div",{style:{padding:20,fontSize:13,color:ye.inkLight,textAlign:"center"},children:"Sin empleados. El encargado debe registrarlos primero."})]})]}):u===2?e.jsxs(Qt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsxs("div",{style:{fontSize:18,fontWeight:700,color:ye.ink,marginBottom:4},children:["Hola, ",j==null?void 0:j.nombre]}),e.jsx("div",{style:{fontSize:13,color:ye.inkMid,marginBottom:20},children:"Introduce tu PIN de 4 dgitos"}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:12,marginBottom:16},children:[0,1,2,3].map(Q=>e.jsx("div",{style:{width:14,height:14,borderRadius:"50%",background:Q<S.length?ye.green:ye.border}},Q))}),x&&e.jsx("div",{style:{color:ye.red,fontSize:12,marginBottom:12},children:"PIN incorrecto. Intntalo de nuevo."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,maxWidth:200,margin:"0 auto"},children:[1,2,3,4,5,6,7,8,9,"",0,""].map(Q=>e.jsx("button",{onClick:()=>{if(Q===""){m(re=>re.slice(0,-1));return}if(Q==="")return;const je=S+Q;m(je),je.length===4&&(je===(j==null?void 0:j.pin)?(p(!1),m(""),b(3),D()):(p(!0),m("")))},style:{padding:"14px 0",fontSize:18,fontWeight:600,border:`1px solid ${ye.border}`,borderRadius:8,background:Q===""?ye.redL:ye.bg,cursor:Q===""?"default":"pointer",color:ye.ink},children:Q},Q))}),e.jsx(Ze,{variant:"ghost",small:!0,onClick:P,style:{marginTop:16},children:"Volver"})]}):u===3?e.jsxs(Qt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:ye.ink,marginBottom:12},children:" Tmate una selfie"}),e.jsx("div",{style:{fontSize:13,color:ye.inkMid,marginBottom:12},children:"La foto es obligatoria para registrar tu asistencia."}),v?e.jsx("div",{style:{background:ye.redL,border:`1px solid ${ye.red}`,borderRadius:8,padding:12,fontSize:12,color:ye.red,marginBottom:12},children:v}):e.jsx("video",{ref:z,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",borderRadius:8,background:"#000",aspectRatio:"4/3",objectFit:"cover",marginBottom:12}}),e.jsxs(ri,{gap:8,style:{justifyContent:"center"},wrap:!0,children:[!v&&e.jsx(Ze,{icon:zd,onClick:oe,style:{width:"100%",justifyContent:"center",fontSize:15,padding:"12px"},children:"Capturar y registrar"}),v&&e.jsx(Ze,{onClick:D,style:{width:"100%",justifyContent:"center"},children:"Reintentar cmara"}),e.jsx(Ze,{variant:"ghost",small:!0,onClick:P,children:"Cancelar"})]})]}):u===4?e.jsxs(Qt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:ye.ink,marginBottom:12},children:"Confirmar registro"}),c&&e.jsx("img",{src:c,style:{width:"100%",borderRadius:8,marginBottom:12,border:`1px solid ${ye.border}`}}),e.jsxs("div",{style:{background:ye.bg,borderRadius:8,padding:"10px 14px",marginBottom:16,fontSize:13,textAlign:"left"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nombre:"})," ",j==null?void 0:j.nombre]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tipo:"})," ",((me=C[j==null?void 0:j.id])==null?void 0:me.length)%2===0?"ENTRADA":"SALIDA"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Hora:"})," ",new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"GPS:"})," ",l?`${l.lat.toFixed(4)}, ${l.lng.toFixed(4)} (${l.precision}m)`:y?"No disponible":"Obteniendo..."]})]}),e.jsxs(ri,{gap:8,style:{justifyContent:"center"},wrap:!0,children:[e.jsx(Ze,{icon:ft,onClick:te,style:{flex:1,justifyContent:"center"},children:"Confirmar fichaje"}),e.jsx(Ze,{variant:"secondary",onClick:()=>{g(null),f(null),h(null),b(3),D()},children:"Repetir foto"})]}),e.jsx(Ze,{variant:"ghost",small:!0,onClick:P,style:{marginTop:8},children:"Cancelar"})]}):null})]})}function mf({novedades:t,saveNovedades:i}){const[o,n]=F.useState({tipo:"",estado:"",texto:""}),[a,r]=F.useState(null),[s,d]=F.useState(""),u=F.useMemo(()=>t.filter(m=>!(o.tipo&&m.tipo!==o.tipo||o.estado&&m.estado!==o.estado||o.texto&&!m.empleadoNombre.toLowerCase().includes(o.texto.toLowerCase()))),[t,o]),b=t.filter(m=>m.estado==="Pendiente").length,j=(m,x)=>{i(p=>p.map(c=>c.id===m?{...c,estado:x,comentarioAdmin:s,fechaResolucion:ui()}:c)),r(null),d("")},w=m=>Sn.find(x=>x.id===m)||Sn[5],S=m=>({Pendiente:{color:"#8C6A00",bg:"#FAF0E0"},"En revisin":{color:"#3B3B3B",bg:"#F0F0F0"},Aprobada:{color:"#111111",bg:"#E8F4EE"},Rechazada:{color:"#B91C1C",bg:"#FAE8E8"}})[m]||{color:"#555",bg:"#EDEBE7"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ei,{label:"Solicitudes pendientes",value:b,color:b>0?O.amber:O.ink,icon:za}),e.jsx(ei,{label:"Aprobadas este mes",value:t.filter(m=>m.estado==="Aprobada").length,color:O.green,icon:Vo}),e.jsx(ei,{label:"Rechazadas",value:t.filter(m=>m.estado==="Rechazada").length,color:O.red,icon:$t}),e.jsx(ei,{label:"Total novedades",value:t.length,icon:Uo})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:14,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:180},children:[e.jsx(vi,{size:13,style:{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",color:O.inkLight}}),e.jsx("input",{value:o.texto,onChange:m=>n(x=>({...x,texto:m.target.value})),placeholder:"Buscar empleado",style:{width:"100%",paddingLeft:30,padding:"7px 10px 7px 30px",border:`1px solid ${O.border}`,borderRadius:3,fontSize:12,color:O.ink,background:O.surface}})]}),e.jsx(mi,{value:o.tipo,onChange:m=>n(x=>({...x,tipo:m})),style:{width:180},options:[{value:"",label:"Todos los tipos"},...Sn.map(m=>({value:m.id,label:`${m.icono} ${m.lbl}`}))]}),e.jsx(mi,{value:o.estado,onChange:m=>n(x=>({...x,estado:m})),style:{width:150},options:[{value:"",label:"Todos los estados"},"Pendiente","En revisin","Aprobada","Rechazada"]})]}),e.jsx(Qt,{children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`2px solid ${O.border}`,background:O.surfaceAlt},children:["Empleado","Tipo","Fecha solicitud","Perodo / Horas","Documento","Estado",""].map(m=>e.jsx("th",{style:{padding:"9px 10px",textAlign:"left",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:O.inkLight,fontWeight:700},children:m},m))})}),e.jsxs("tbody",{children:[u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"40px 0",color:O.inkLight,fontSize:12},children:t.length===0?"Sin novedades. Los empleados las crean desde su portal.":"Sin resultados."})}),u.map(m=>{const x=w(m.tipo),p=S(m.estado);return e.jsxs("tr",{style:{borderBottom:`1px solid ${O.border}`,cursor:"pointer"},onMouseEnter:c=>c.currentTarget.style.background=O.surfaceAlt,onMouseLeave:c=>c.currentTarget.style.background="",onClick:()=>{r(m),d(m.comentarioAdmin||"")},children:[e.jsx("td",{style:{padding:"11px 10px",fontWeight:600},children:m.empleadoNombre}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[e.jsx("span",{children:x.icono}),e.jsx("span",{style:{color:x.color,fontWeight:600,fontSize:11},children:x.lbl})]})}),e.jsx("td",{className:"mono",style:{padding:"11px 10px",color:O.inkLight,fontSize:11},children:m.fechaSolicitud}),e.jsxs("td",{style:{padding:"11px 10px",fontSize:11},children:[m.fechaInicio&&e.jsx("span",{className:"mono",children:m.fechaInicio}),m.fechaFin&&e.jsxs("span",{className:"mono",style:{color:O.inkLight},children:["  ",m.fechaFin]}),m.horas>0&&e.jsxs("span",{className:"mono",children:[" ",m.horas," h"]}),m.dias>0&&e.jsxs("span",{style:{color:O.inkMid},children:[" (",m.dias," das)"]})]}),e.jsx("td",{style:{padding:"11px 10px"},children:m.docNombre?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,color:O.green,fontSize:11},children:[e.jsx(Es,{size:11}),m.docNombre]}):e.jsx("span",{style:{color:O.inkXLight,fontSize:10},children:"Sin doc."})}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsx(Wt,{color:p.color,bg:p.bg,children:m.estado})}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsx(Gi,{size:14,color:O.inkXLight})})]},m.id)})]})]})}),a&&(()=>{const m=w(a.tipo),x=S(a.estado);return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(null),children:e.jsxs("div",{className:"pop-in",style:{background:O.surface,borderRadius:6,width:560,maxWidth:"95vw",maxHeight:"90vh",overflowY:"auto",boxShadow:O.shadowMd},onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{style:{padding:"18px 22px",borderBottom:`1px solid ${O.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",background:m.bg},children:[e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:26},children:m.icono}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:m.color},children:m.lbl}),e.jsxs("div",{style:{fontSize:11,color:m.color,opacity:.7},children:[a.empleadoNombre,"  Solicitud ",a.fechaSolicitud]})]})]}),e.jsx(Wt,{color:x.color,bg:"rgba(255,255,255,.7)",children:a.estado})]}),e.jsxs("div",{style:{padding:"20px 22px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[{lbl:"Tipo",val:m.lbl},{lbl:"Estado",val:a.estado},a.fechaInicio&&{lbl:"Fecha inicio",val:a.fechaInicio},a.fechaFin&&{lbl:"Fecha fin",val:a.fechaFin},a.dias>0&&{lbl:"Das solicitados",val:`${a.dias} das`},a.horas>0&&{lbl:"Horas",val:`${a.horas} h`},a.motivo&&{lbl:"Motivo",val:a.motivo}].filter(Boolean).map(p=>e.jsxs("div",{style:{background:O.accent,borderRadius:3,padding:"10px 12px"},children:[e.jsx(Ut,{children:p.lbl}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:O.ink,marginTop:3},children:p.val})]},p.lbl))}),a.descripcion&&e.jsxs("div",{style:{background:O.accent,borderRadius:3,padding:"10px 12px",marginBottom:12},children:[e.jsx(Ut,{children:"Descripcin del empleado"}),e.jsx("p",{style:{fontSize:12,color:O.inkMid,marginTop:4,lineHeight:1.5},children:a.descripcion})]}),a.docNombre&&e.jsxs("div",{style:{background:O.blueBg,border:`1px solid ${O.blue}33`,borderRadius:3,padding:"10px 12px",marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[e.jsx(Es,{size:14,color:O.blue}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:O.blue},children:"Documento adjunto"}),e.jsx("div",{style:{fontSize:11,color:O.blue,opacity:.8},children:a.docNombre})]}),a.docBase64&&e.jsx("a",{href:a.docBase64,download:a.docNombre,style:{marginLeft:"auto",fontSize:10,color:O.blue,textDecoration:"underline"},children:"Descargar"})]}),a.fechaResolucion&&a.comentarioAdmin&&e.jsxs("div",{style:{background:a.estado==="Aprobada"?O.greenBg:O.redBg,borderRadius:3,padding:"10px 12px",marginBottom:12},children:[e.jsxs(Ut,{children:["Resolucin  ",a.fechaResolucion]}),e.jsx("p",{style:{fontSize:12,color:O.inkMid,marginTop:4},children:a.comentarioAdmin})]}),a.estado==="Pendiente"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:10},children:[e.jsx(Ut,{children:"Comentario para el empleado (opcional)"}),e.jsx("textarea",{value:s,onChange:p=>d(p.target.value),placeholder:"Motivo de aprobacin o rechazo",style:{width:"100%",marginTop:5,padding:"8px 10px",border:`1px solid ${O.border}`,borderRadius:3,fontSize:12,minHeight:70,resize:"vertical",fontFamily:"'DM Sans',sans-serif"}})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx(Ze,{variant:"outline",onClick:()=>r(null),children:"Cancelar"}),e.jsxs(Ze,{variant:"danger",onClick:()=>j(a.id,"Rechazada"),children:[e.jsx($t,{size:12}),"Rechazar"]}),e.jsxs(Ze,{variant:"success",onClick:()=>j(a.id,"Aprobada"),children:[e.jsx(ft,{size:12}),"Aprobar"]})]})]}),a.estado!=="Pendiente"&&e.jsx("div",{style:{textAlign:"right"},children:e.jsx(Ze,{variant:"outline",onClick:()=>r(null),children:"Cerrar"})})]})]})})})()]})}const ea=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],fn=[{value:"nomina",label:"Nmina",color:O.blue},{value:"contrato",label:"Contrato",color:O.green},{value:"certificado",label:"Certificado laboral",color:O.amber},{value:"retencion",label:"Retencin fuente",color:O.red},{value:"otro_laboral",label:"Otro documento",color:O.inkMid},{value:"otro",label:"Otro",color:O.inkLight}],bf=(t="")=>({id:Ki(),empleadoNombre:t,tipo:"nomina",nombre:"",docNombre:"",docBase64:null,anio:new Date().getFullYear(),mes:"",fechaSubida:ui()});function yf({docs:t,saveDocs:i,fichas:o,cargos:n}){const[a,r]=F.useState(null),[s,d]=F.useState(""),[u,b]=F.useState(""),[j,w]=F.useState(!1),S=F.useMemo(()=>{const l=new Set;return o.forEach(f=>l.add(f.nombre)),t.forEach(f=>l.add(f.empleadoNombre)),[...l].sort()},[o,t]),m=t.filter(l=>!(s&&l.empleadoNombre!==s||u&&l.tipo!==u)),x=l=>fn.find(f=>f.value===l)||fn[5],p=l=>{const f=l.target.files[0];if(!f)return;const y=new FileReader;y.onload=h=>r(v=>({...v,docNombre:f.name,docBase64:h.target.result})),y.readAsDataURL(f)},c=()=>{if(!a.empleadoNombre||!a.docNombre)return;const l={...a,fechaSubida:ui()};i(f=>j?[...f,l]:f.map(y=>y.id===l.id?l:y)),r(null)},g=(l="")=>{r({...bf(l)}),w(!0)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ei,{label:"Total documentos",value:t.length,icon:At}),e.jsx(ei,{label:"Empleados con docs",value:new Set(t.map(l=>l.empleadoNombre)).size,icon:Fi}),e.jsx(ei,{label:"Nminas subidas",value:t.filter(l=>l.tipo==="nomina").length,icon:zo,color:O.blue}),e.jsx(ei,{label:"Contratos",value:t.filter(l=>l.tipo==="contrato").length,icon:Tn,color:O.green})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:14,alignItems:"center"},children:[e.jsx(mi,{value:s,onChange:d,style:{width:200},options:[{value:"",label:"Todos los empleados"},...S.map(l=>({value:l,label:l}))]}),e.jsx(mi,{value:u,onChange:b,style:{width:200},options:[{value:"",label:"Todos los tipos"},...fn]}),e.jsx("div",{style:{flex:1}}),e.jsxs(Ze,{variant:"primary",small:!0,onClick:()=>g(s),children:[e.jsx(Pe,{size:12}),"Subir documento"]})]}),s===""?S.length===0?e.jsx(Qt,{children:e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:O.inkLight},children:[e.jsx(At,{size:32,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{fontSize:12},children:"Sin documentos an. Los empleados se crean desde sus fichas en el Portal."})]})}):S.map(l=>{var y;const f=t.filter(h=>h.empleadoNombre===l&&(!u||h.tipo===u));return f.length===0&&u?null:e.jsxs(Qt,{style:{marginBottom:12},children:[e.jsx(oo,{action:e.jsxs(Ze,{small:!0,variant:"ghost",onClick:()=>g(l),children:[e.jsx(Pe,{size:11}),"Aadir"]}),children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:3,background:O.ink,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:800},children:(y=l[0])==null?void 0:y.toUpperCase()}),l,e.jsxs(Wt,{children:[f.length," docs"]})]})}),f.length===0?e.jsx("p",{style:{fontSize:11,color:O.inkLight},children:"Sin documentos para este empleado."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:8},children:f.map(h=>{const v=x(h.tipo);return e.jsxs("div",{style:{border:`1px solid ${O.border}`,borderRadius:4,padding:"12px 14px",background:O.surfaceAlt},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,color:v.color},children:v.label}),e.jsxs("div",{style:{display:"flex",gap:4},children:[h.docBase64&&e.jsx("a",{href:h.docBase64,download:h.docNombre,style:{fontSize:9,color:O.blue,textDecoration:"none",padding:"2px 6px",border:`1px solid ${O.blue}33`,borderRadius:2},children:""}),e.jsx("button",{onClick:()=>i(A=>A.filter(z=>z.id!==h.id)),style:{background:"none",border:"none",cursor:"pointer",color:O.red,fontSize:11,padding:"1px 4px"},children:""})]})]}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:O.ink,marginBottom:2},children:h.docNombre||h.nombre||""}),(h.anio||h.mes)&&e.jsxs("div",{style:{fontSize:10,color:O.inkLight},children:[h.mes?ea[Number(h.mes)-1]:""," ",h.anio]}),e.jsxs("div",{style:{fontSize:9,color:O.inkXLight,marginTop:3},children:["Subido ",h.fechaSubida]})]},h.id)})})]},l)}):e.jsxs(Qt,{children:[e.jsxs(oo,{action:e.jsxs(Ze,{small:!0,variant:"primary",onClick:()=>g(s),children:[e.jsx(Pe,{size:12}),"Subir"]}),children:["Documentos de ",s]}),m.length===0?e.jsx("p",{style:{textAlign:"center",color:O.inkLight,padding:"30px 0",fontSize:12},children:"Sin documentos."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:8},children:m.map(l=>{const f=x(l.tipo);return e.jsxs("div",{style:{border:`1px solid ${O.border}`,borderRadius:4,padding:"12px 14px",background:O.surfaceAlt},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:f.color,marginBottom:4},children:f.label}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:O.ink},children:l.docNombre||l.nombre||""}),(l.anio||l.mes)&&e.jsxs("div",{style:{fontSize:10,color:O.inkLight},children:[l.mes?ea[Number(l.mes)-1]:""," ",l.anio]}),l.docBase64&&e.jsx("a",{href:l.docBase64,download:l.docNombre,style:{fontSize:10,color:O.blue,display:"block",marginTop:4},children:"Descargar "})]},l.id)})})]}),a&&e.jsxs(ta,{title:j?"Subir documento":"Editar documento",onClose:()=>r(null),wide:!0,children:[e.jsx(bt,{label:"Empleado",children:S.length>0?e.jsx(mi,{value:a.empleadoNombre,onChange:l=>r(f=>({...f,empleadoNombre:l})),options:[{value:"",label:"Seleccionar empleado"},...S.map(l=>({value:l,label:l}))]}):e.jsx(mt,{value:a.empleadoNombre,onChange:l=>r(f=>({...f,empleadoNombre:l})),placeholder:"Nombre del empleado"})}),e.jsx(bt,{label:"Tipo de documento",children:e.jsx(mi,{value:a.tipo,onChange:l=>r(f=>({...f,tipo:l})),options:fn})}),(a.tipo==="nomina"||a.tipo==="certificado"||a.tipo==="retencion")&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:10},children:[e.jsxs("div",{children:[e.jsx(Ut,{children:"Ao"}),e.jsx(mt,{type:"number",value:a.anio,onChange:l=>r(f=>({...f,anio:l})),style:{marginTop:4}})]}),e.jsxs("div",{children:[e.jsxs(Ut,{children:["Mes ",a.tipo==="certificado"||a.tipo==="retencion"?"(opcional)":""]}),e.jsx(mi,{value:a.mes,onChange:l=>r(f=>({...f,mes:l})),style:{marginTop:4},options:[{value:"",label:""},...ea.map((l,f)=>({value:f+1,label:l}))]})]})]}),e.jsx(bt,{label:"Descripcin (opcional)",children:e.jsx(mt,{value:a.nombre,onChange:l=>r(f=>({...f,nombre:l})),placeholder:"Ej. Nmina mayo 2025"})}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx(Ut,{children:"Archivo"}),e.jsxs("div",{style:{marginTop:6,display:"flex",alignItems:"center",gap:10},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"7px 14px",background:O.accent,border:`1px solid ${O.border}`,borderRadius:3,cursor:"pointer",fontSize:11,color:O.inkMid,fontWeight:600},children:[e.jsx(Es,{size:12}),"Seleccionar archivo",e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.xlsx",onChange:p,style:{display:"none"}})]}),a.docNombre&&e.jsxs("span",{style:{fontSize:11,color:O.green,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Vo,{size:12}),a.docNombre]})]}),e.jsx("p",{style:{fontSize:9,color:O.inkLight,marginTop:5},children:"PDF, imagen o Word. Se almacena como base64 en el navegador."})]}),e.jsx(ia,{onCancel:()=>r(null),onSave:c,saveLabel:"Subir documento"})]})]})}function ta({title:t,children:i,onClose:o,wide:n}){return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:o,children:e.jsxs("div",{className:"pop-in",style:{background:O.surface,borderRadius:6,padding:28,width:n?600:480,maxWidth:"95vw",boxShadow:O.shadowMd,maxHeight:"90vh",overflowY:"auto"},onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:20,fontSize:15,fontWeight:700},children:t}),i]})})}function vf({partes:t,savePartes:i,novedades:o,saveNovedades:n,fichas:a,saveFichas:r,docs:s,saveDocs:d,cargos:u,empleados:b,saveEmpleados:j}){const[w,S]=F.useState(""),[m,x]=F.useState(!1),[p,c]=F.useState("calendario"),[g,l]=F.useState(new Date().getFullYear()),[f,y]=F.useState(new Date().getMonth()),[h,v]=F.useState(null),[A,z]=F.useState(null),[k,T]=F.useState(null),[C,D]=F.useState(!1),[K,oe]=F.useState(null),te=["Lu","Ma","Mi","Ju","Vi","Sa","Do"],P=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],ie=["OT-DIN_250101_01","OT-INT_250115_02","OT-INT_250201_03"],me=t.filter(Y=>Y.empleadoNombre===w),Q=o.filter(Y=>Y.empleadoNombre===w),je=s.filter(Y=>Y.empleadoNombre===w),re=a.find(Y=>Y.nombre===w)||Ja(w),J=Y=>Sn.find(Fe=>Fe.id===Y)||Sn[5],M=(Y,Fe)=>!Y||!Fe?0:Math.max(0,Math.round((new Date(Fe)-new Date(Y))/864e5)+1),B=(Y,Fe,$e)=>`${Y}-${String(Fe+1).padStart(2,"0")}-${String($e).padStart(2,"0")}`,V=F.useMemo(()=>{const Y=(new Date(g,f,1).getDay()+6)%7,Fe=new Date(g,f+1,0).getDate();return[...Array(Y).fill(null),...Array.from({length:Fe},($e,Qe)=>Qe+1)]},[g,f]),X=F.useMemo(()=>{const Y={};return me.forEach(Fe=>{var $e;(Y[$e=Fe.fecha]??(Y[$e]=[])).push({kind:"parte",obj:Fe})}),Q.forEach(Fe=>{if(!Fe.fechaInicio)return;const $e=new Date(Fe.fechaInicio),Qe=Fe.fechaFin?new Date(Fe.fechaFin):$e;for(let pt=new Date($e);pt<=Qe;pt.setDate(pt.getDate()+1)){const yt=pt.toISOString().slice(0,10);(Y[yt]??(Y[yt]=[])).push({kind:"novedad",obj:Fe})}}),Y},[me,Q]),R=Q.filter(Y=>Y.estado==="Pendiente").length,W=me.filter(Y=>Y.estado==="Aprobado").reduce((Y,Fe)=>Y+Number(Fe.horasNormales||0)+Number(Fe.horasExtra||0),0),se=Q.filter(Y=>Y.tipo==="vacaciones"&&Y.estado==="Aprobada").reduce((Y,Fe)=>Y+Number(Fe.dias||0),0),le=Q.find(Y=>Y.tipo==="baja"&&Y.estado==="Aprobada"&&!Y.fechaFin),de=(Y,Fe,$e)=>Y(Qe=>({...Qe,[Fe]:$e})),Z=Y=>({Borrador:{c:O.inkLight,bg:O.accent},Enviado:{c:O.blue,bg:O.blueBg},Aprobado:{c:O.green,bg:O.greenBg},Rechazado:{c:O.red,bg:O.redBg},Pendiente:{c:"#8C6A00",bg:"#FAF0E0"},Aprobada:{c:O.green,bg:O.greenBg},Rechazada:{c:O.red,bg:O.redBg}})[Y]||{c:O.inkLight,bg:O.accent},ue=()=>{if(!(A!=null&&A.otCodigo)||!(A!=null&&A.actividad))return;const Y=!t.find(Fe=>Fe.id===A.id);i(Fe=>Y?[...Fe,A]:Fe.map($e=>$e.id===A.id?A:$e)),z(null)},N=Y=>i(Fe=>Fe.map($e=>$e.id===Y?{...$e,estado:"Enviado"}:$e)),G=()=>{if(!(k!=null&&k.tipo))return;const Y=M(k.fechaInicio,k.fechaFin),Fe={...k,dias:Y,empleadoNombre:w,estado:"Pendiente"},$e=!o.find(Qe=>Qe.id===Fe.id);n(Qe=>$e?[...Qe,Fe]:Qe.map(pt=>pt.id===Fe.id?Fe:pt)),T(null)},L=()=>{if(!K)return;const Y={...K,nombre:w},Fe=a.find($e=>$e.nombre===w);r($e=>Fe?$e.map(Qe=>Qe.nombre===w?Y:Qe):[...$e,Y]),D(!1)},ae={page:{minHeight:"100vh",background:O.bg,fontFamily:"'DM Sans',sans-serif"},card:{background:O.surface,border:`1px solid ${O.border}`,borderRadius:6,padding:"16px 18px",marginBottom:12},row:{display:"flex",gap:8,alignItems:"center"},col:{display:"flex",flexDirection:"column",gap:4},th:{padding:"7px 10px",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:O.inkLight,fontWeight:700,textAlign:"left",borderBottom:`2px solid ${O.border}`},td:{padding:"9px 10px",borderBottom:`1px solid ${O.border}`,fontSize:12},overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:300,display:"flex",alignItems:"center",justifyContent:"center"},modal:{background:O.surface,borderRadius:6,padding:24,width:460,maxWidth:"95vw",boxShadow:O.shadowMd,maxHeight:"90vh",overflowY:"auto"},navBtn:Y=>({padding:"11px 14px",border:"none",background:"transparent",borderBottom:Y?`2px solid ${O.ink}`:"2px solid transparent",color:Y?O.ink:O.inkLight,fontSize:10,fontWeight:Y?700:400,letterSpacing:.3,textTransform:"uppercase",cursor:"pointer",whiteSpace:"nowrap",flexShrink:0,display:"flex",alignItems:"center",gap:5}),calDay:(Y,Fe,$e)=>({borderRadius:4,aspectRatio:"1",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:11,fontWeight:Y.c?700:400,color:$e?"#fff":Y.c||O.ink,background:$e?O.ink:Y.bg||"transparent",border:Fe?`1px solid ${O.ink}`:"1px solid transparent"}),kpiMini:Y=>({flex:1,background:O.surface,border:`1px solid ${O.border}`,borderRadius:5,padding:"10px 12px",minWidth:0})};if(!m)return e.jsx("div",{style:{...ae.page,display:"flex",alignItems:"center",justifyContent:"center",padding:20},children:e.jsxs("div",{style:{...ae.card,width:360,overflow:"hidden",padding:0},children:[e.jsxs("div",{style:{background:O.ink,padding:"28px 24px",textAlign:"center"},children:[e.jsxs("svg",{width:34,height:34,viewBox:"0 0 34 34",fill:"none",style:{margin:"0 auto 12px",display:"block"},children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:"rgba(255,255,255,.25)",strokeWidth:"0.8"}),e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:"#fff",strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:"#fff"}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:"#fff"}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:"#fff"})]}),e.jsx("div",{style:{fontSize:14,fontWeight:800,letterSpacing:3,textTransform:"uppercase",color:"#fff"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:11,color:"rgba(255,255,255,.4)",marginTop:3},children:"Portal del Empleado"})]}),e.jsxs("div",{style:{padding:"20px 20px 16px"},children:[e.jsx("p",{style:{fontSize:11,color:O.inkLight,marginBottom:10,textAlign:"center"},children:"Introduce tu nombre completo para acceder"}),e.jsx(mt,{value:w,onChange:S,placeholder:"Ej. Mara Garca Lpez",style:{marginBottom:8},onKeyDown:Y=>Y.key==="Enter"&&w.trim()&&x(!0)}),e.jsx("button",{onClick:()=>w.trim()&&x(!0),style:{width:"100%",padding:"9px",background:O.ink,color:"#fff",border:"none",borderRadius:3,fontSize:12,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Entrar al portal"}),e.jsx("p",{style:{fontSize:9,color:O.inkXLight,marginTop:10,textAlign:"center",lineHeight:1.4},children:"Fase 1  En produccin se usar email + contrasea"})]})]})});const pe=[{id:"calendario",lbl:" Calendario",badge:0},{id:"partes",lbl:" Mis Partes",badge:me.filter(Y=>Y.estado==="Borrador").length},{id:"solicitudes",lbl:" Solicitudes",badge:R},{id:"viajes",lbl:" Viajes",badge:0},{id:"ficha",lbl:" Mi Ficha",badge:0},{id:"documentos",lbl:" Mis Docs",badge:0}],he=new Date().toISOString().slice(0,10),ze=()=>{let Y=f-1,Fe=g;Y<0&&(Y=11,Fe--),y(Y),l(Fe)},q=()=>{let Y=f+1,Fe=g;Y>11&&(Y=0,Fe++),y(Y),l(Fe)},I=()=>e.jsxs("div",{className:"fade-up",children:[le&&e.jsxs("div",{style:{background:O.redBg,border:`1px solid ${O.red}33`,borderRadius:4,padding:"10px 14px",marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:18},children:""}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:O.red},children:["Baja mdica activa desde ",le.fechaInicio]}),e.jsx("div",{style:{fontSize:10,color:O.red,opacity:.7},children:le.motivo})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginBottom:14},children:[["Horas aprobadas",`${W}h`,O.blue],["Das vacaciones",`${se}d`,O.green],["Partes borrador",me.filter(Y=>Y.estado==="Borrador").length,O.amber],["Sol. pendientes",R,R>0?O.amber:O.ink]].map(([Y,Fe,$e])=>e.jsxs("div",{style:ae.kpiMini(),children:[e.jsx("div",{style:{fontSize:9,letterSpacing:1,textTransform:"uppercase",color:O.inkLight,marginBottom:4},children:Y}),e.jsx("div",{style:{fontSize:20,fontWeight:800,color:$e,fontFamily:"'DM Mono',monospace"},children:Fe})]},Y))}),e.jsxs("div",{style:ae.card,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("button",{onClick:ze,style:{background:O.accent,border:`1px solid ${O.border}`,borderRadius:3,padding:"5px 12px",cursor:"pointer",fontSize:16},children:""}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:15,fontWeight:800,color:O.ink},children:[P[f]," ",g]}),e.jsx("div",{style:{fontSize:10,color:O.inkLight,marginTop:1},children:"Pulsa un da para ver / imputar"})]}),e.jsx("button",{onClick:q,style:{background:O.accent,border:`1px solid ${O.border}`,borderRadius:3,padding:"5px 12px",cursor:"pointer",fontSize:16},children:""})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,marginBottom:4},children:te.map(Y=>e.jsx("div",{style:{textAlign:"center",fontSize:9,fontWeight:700,color:O.inkLight,padding:"4px 0",letterSpacing:.5},children:Y},Y))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2},children:V.map((Y,Fe)=>{if(!Y)return e.jsx("div",{},`e${Fe}`);const $e=B(g,f,Y),Qe=X[$e]||[],pt=$e===he,yt=$e===h,Et=new Date(g,f,Y).getDay()%6===0;let Bi=null;return Qe.some(di=>di.kind==="novedad"&&di.obj.estado==="Rechazada")?Bi=O.red:Qe.some(di=>di.kind==="novedad"&&di.obj.estado==="Aprobada")?Bi=O.green:Qe.some(di=>di.kind==="novedad"&&di.obj.estado==="Pendiente")?Bi="#8C6A00":Qe.some(di=>di.kind==="parte"&&di.obj.estado==="Aprobado")?Bi=O.blue:Qe.length&&(Bi="#555"),e.jsxs("div",{onClick:()=>{v($e===h?null:$e)},style:{borderRadius:4,padding:"5px 2px",display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",background:yt?O.ink:Et?"#F8F7F4":"transparent",border:pt?`1px solid ${O.ink}`:"1px solid transparent",transition:"background .1s"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:yt||pt?700:400,color:yt?"#fff":Et?O.inkLight:O.ink},children:Y}),Bi&&e.jsx("div",{style:{width:4,height:4,borderRadius:"50%",background:yt?"rgba(255,255,255,.7)":Bi,marginTop:2}})]},$e)})})]}),h&&(()=>{const Y=X[h]||[],Fe=new Date(h+"T12:00:00").toLocaleDateString("es-CO",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{style:ae.card,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:O.ink,textTransform:"capitalize"},children:Fe}),e.jsxs(Ze,{small:!0,variant:"primary",onClick:()=>z({...Jl(),fecha:h}),children:[e.jsx(Pe,{size:11}),"Imputar horas"]})]}),Y.length===0&&e.jsx("p",{style:{fontSize:11,color:O.inkLight,textAlign:"center",padding:"12px 0"},children:"Sin registros para este da."}),Y.map(($e,Qe)=>{const pt=Z($e.obj.estado);if($e.kind==="parte"){const Et=$e.obj;return e.jsxs("div",{style:{background:O.surfaceAlt,borderRadius:4,padding:"10px 12px",marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{fontWeight:600,fontSize:12},children:[Et.otCodigo,"  ",Et.actividad]}),e.jsx(Wt,{color:pt.c,bg:pt.bg,children:Et.estado})]}),e.jsxs("div",{style:{fontSize:11,color:O.inkMid,marginTop:4},children:[Et.horasNormales,"h normales  ",Et.horasExtra,"h extra"]}),Et.estado==="Borrador"&&e.jsx("div",{style:{marginTop:6},children:e.jsx(Ze,{small:!0,variant:"primary",onClick:()=>N(Et.id),children:"Enviar"})})]},Qe)}const yt=J($e.obj.tipo);return e.jsxs("div",{style:{background:yt.bg,borderRadius:4,padding:"10px 12px",marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{fontWeight:600,fontSize:12,color:yt.color},children:[yt.icono," ",yt.lbl]}),e.jsx(Wt,{color:pt.c,bg:pt.bg,children:$e.obj.estado})]}),$e.obj.motivo&&e.jsx("div",{style:{fontSize:11,color:yt.color,opacity:.8,marginTop:3},children:$e.obj.motivo})]},Qe)})]})})()]}),$=()=>e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:e.jsxs(Ze,{variant:"primary",small:!0,onClick:()=>z({...Jl(),fecha:he}),children:[e.jsx(Pe,{size:11}),"Nuevo parte"]})}),me.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:O.inkLight},children:[e.jsx(Uo,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin partes registrados."})]}):e.jsx("div",{style:{padding:0},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Fecha","OT","Actividad","H.Norm","H.Extra","Estado",""].map(Y=>e.jsx("th",{style:ae.th,children:Y},Y))})}),e.jsx("tbody",{children:me.sort((Y,Fe)=>{var $e;return(($e=Fe.fecha)==null?void 0:$e.localeCompare(Y.fecha))||0}).map(Y=>{const Fe=Z(Y.estado);return e.jsxs("tr",{onMouseEnter:$e=>$e.currentTarget.style.background=O.surfaceAlt,onMouseLeave:$e=>$e.currentTarget.style.background="",children:[e.jsx("td",{style:ae.td,className:"mono",children:Y.fecha}),e.jsx("td",{style:ae.td,children:Y.otCodigo}),e.jsx("td",{style:ae.td,children:Y.actividad}),e.jsx("td",{style:{...ae.td,textAlign:"center"},children:Y.horasNormales}),e.jsx("td",{style:{...ae.td,textAlign:"center"},children:Y.horasExtra||0}),e.jsx("td",{style:ae.td,children:e.jsx(Wt,{color:Fe.c,bg:Fe.bg,children:Y.estado})}),e.jsxs("td",{style:ae.td,children:[Y.estado==="Borrador"&&e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(Ze,{small:!0,variant:"primary",onClick:()=>N(Y.id),children:"Enviar"}),e.jsx(Ze,{small:!0,variant:"ghost",onClick:()=>z({...Y}),children:e.jsx(io,{size:11})}),e.jsx(Ze,{small:!0,variant:"danger",onClick:()=>i($e=>$e.filter(Qe=>Qe.id!==Y.id)),children:e.jsx(qe,{size:11})})]}),Y.estado==="Rechazado"&&Y.comentarioAdmin&&e.jsxs("span",{style:{fontSize:10,color:O.red},children:["Motivo: ",Y.comentarioAdmin]})]})]},Y.id)})})]})})]}),H=()=>e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:e.jsxs(Ze,{variant:"primary",small:!0,onClick:()=>T({...df(w)}),children:[e.jsx(Pe,{size:11}),"Nueva solicitud"]})}),Q.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:O.inkLight},children:[e.jsx(za,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin solicitudes."})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Q.sort((Y,Fe)=>{var $e;return(($e=Fe.fechaSolicitud)==null?void 0:$e.localeCompare(Y.fechaSolicitud))||0}).map(Y=>{const Fe=J(Y.tipo),$e=Z(Y.estado);return e.jsx("div",{style:{...ae.card,borderLeft:`3px solid ${Fe.color}`,marginBottom:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:16},children:Fe.icono}),e.jsx("span",{style:{fontWeight:700,fontSize:13,color:Fe.color},children:Fe.lbl}),e.jsx(Wt,{color:$e.c,bg:$e.bg,children:Y.estado})]}),Y.fechaInicio&&e.jsxs("div",{style:{fontSize:11,color:O.inkMid},children:[Y.fechaInicio,Y.fechaFin&&`  ${Y.fechaFin}`," ",Y.dias>0&&` ${Y.dias} das`]}),Y.horas>0&&e.jsxs("div",{style:{fontSize:11,color:O.inkMid},children:[Y.horas,"h"]}),Y.motivo&&e.jsx("div",{style:{fontSize:11,color:O.inkMid,marginTop:2},children:Y.motivo}),Y.comentarioAdmin&&e.jsxs("div",{style:{fontSize:11,color:$e.c,marginTop:4,fontStyle:"italic"},children:["Admin: ",Y.comentarioAdmin]})]}),e.jsx("div",{style:{fontSize:10,color:O.inkLight},children:Y.fechaSolicitud})]})},Y.id)})})]}),U=()=>{const Y=C?K:re;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700,color:O.ink},children:"Mi Ficha Personal"}),C?e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(Ze,{small:!0,variant:"outline",onClick:()=>D(!1),children:"Cancelar"}),e.jsxs(Ze,{small:!0,variant:"primary",onClick:L,children:[e.jsx(Co,{size:11}),"Guardar"]})]}):e.jsxs(Ze,{small:!0,variant:"outline",onClick:()=>{oe({...re}),D(!0)},children:[e.jsx(io,{size:11}),"Editar"]})]}),[{sec:"Datos Personales",fields:[["Nombre",Y.nombre],["Apellidos",Y.apellidos],["Email",Y.email],["Telfono",Y.telefono],["Fecha nacimiento",Y.fechaNacimiento],["Documento",`${Y.tipoDocumento} ${Y.numeroDocumento}`]]},{sec:"Contrato",fields:[["Cargo",Y.cargo],["Tipo contrato",Y.tipoContrato],["Fecha ingreso",Y.fechaIngreso],["Salario bruto",Y.salarioBruto?`$ ${Number(Y.salarioBruto).toLocaleString()}`:""]]},{sec:"Seguridad Social",fields:[["EPS",Y.eps],["AFP",Y.afp],["ARL",Y.arl],["Caja compensacin",Y.cajaCompensacion]]},{sec:"Datos Bancarios",fields:[["Entidad",Y.entidadBancaria],["Tipo cuenta",Y.tipoCuenta],["N cuenta",Y.cuentaBancaria]]}].map(({sec:Fe,fields:$e})=>e.jsxs("div",{style:ae.card,children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1.2,textTransform:"uppercase",color:O.inkLight,fontWeight:700,marginBottom:10},children:Fe}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:$e.map(([Qe,pt])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:O.inkLight,letterSpacing:.5,textTransform:"uppercase",marginBottom:2},children:Qe}),C?e.jsx(mt,{value:K[Object.keys(Ja()).find(yt=>Ja()[yt]===pt||Qe.toLowerCase().includes(yt.toLowerCase()))||Qe]||"",onChange:yt=>oe(Et=>({...Et,[Qe.toLowerCase().replace(/\s/g,"")]:yt})),small:!0}):e.jsx("div",{style:{fontSize:12,color:O.ink,fontWeight:pt?400:300},children:pt||e.jsx("span",{style:{color:O.inkXLight},children:""})})]},Qe))})]},Fe))]})},_=()=>e.jsx("div",{className:"fade-up",children:je.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:O.inkLight},children:[e.jsx(zo,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin documentos compartidos todava."}),e.jsx("p",{style:{fontSize:11,color:O.inkXLight,marginTop:4},children:"Cuando RRHH suba tus documentos aparecern aqu."})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:je.map(Y=>{const Fe=fn.find($e=>$e.value===Y.tipo)||fn[5];return e.jsxs("div",{style:{...ae.card,display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:0},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:2},children:[e.jsx("span",{children:Fe.label}),e.jsxs(Wt,{color:Fe.color,bg:Fe.color+"22",children:[ea[Y.mes-1]||""," ",Y.anio]})]}),e.jsx("div",{style:{fontSize:11,color:O.inkMid},children:Y.nombre||Y.docNombre})]}),Y.docBase64&&e.jsx("a",{href:Y.docBase64,download:Y.docNombre||"documento.pdf",children:e.jsxs(Ze,{small:!0,variant:"outline",children:[e.jsx(wo,{size:11}),"Descargar"]})})]},Y.id)})})}),ce="habitaris_admin",ve=()=>{try{return JSON.parse(localStorage.getItem(ce))||{}}catch{return{}}},Ie=(Y,Fe)=>{const $e=ve();$e[Y]=Fe,localStorage.setItem(ce,JSON.stringify($e))},[Te,Oe]=F.useState(()=>(ve().adm_viaticos||[]).filter(Y=>Y.solicitante===w)),[ct,at]=F.useState(!1),[xt,Ft]=F.useState(null),[zt,Vt]=F.useState({destino:"",dias:1,concepto:"",fecha:ui(),fechaRegreso:""}),Ti=[{id:"vuelo_ida",lbl:"Vuelo ida",icon:""},{id:"vuelo_vuelta",lbl:"Vuelo vuelta",icon:""},{id:"hotel",lbl:"Hotel",icon:""},{id:"transporte",lbl:"Transporte",icon:""},{id:"alimentacion",lbl:"Alimentacin",icon:""},{id:"otros",lbl:"Otros",icon:""}],lo=()=>{const Y={};Ti.forEach(Qe=>{Y[Qe.id]={estimado:0,real:0,detalle:""}});const Fe={id:Math.random().toString(36).slice(2,10),solicitante:w,...zt,dias:parseInt(zt.dias)||1,estado:"solicitado",gastos:[],anticipoEntregado:0,itemsViaje:Y,creadoDesde:"portal"},$e=[...ve().adm_viaticos||[],Fe];Ie("adm_viaticos",$e),Oe($e.filter(Qe=>Qe.solicitante===w)),Ft(Fe.id),Vt({destino:"",dias:1,concepto:"",fecha:ui(),fechaRegreso:""}),at(!1)},ji=(Y,Fe,$e,Qe)=>{const pt=(ve().adm_viaticos||[]).map(yt=>{if(yt.id!==Y)return yt;const Et={...yt.itemsViaje||{}};return Et[Fe]={...Et[Fe]||{estimado:0,real:0,detalle:""},[$e]:Qe},{...yt,itemsViaje:Et}});Ie("adm_viaticos",pt),Oe(pt.filter(yt=>yt.solicitante===w))},jr=(Y,Fe)=>{const $e=(ve().adm_viaticos||[]).map(Qe=>Qe.id===Y?{...Qe,gastos:[...Qe.gastos||[],{id:Math.random().toString(36).slice(2,10),...Fe}]}:Qe);Ie("adm_viaticos",$e),Oe($e.filter(Qe=>Qe.solicitante===w))},Ji=Y=>Ti.reduce((Fe,$e)=>{var Qe;return Fe+(parseFloat((Qe=(Y.itemsViaje||{})[$e.id])==null?void 0:Qe.estimado)||0)},0),Sr=Y=>Ti.reduce((Fe,$e)=>{var Qe;return Fe+(parseFloat((Qe=(Y.itemsViaje||{})[$e.id])==null?void 0:Qe.real)||0)},0)+(Y.gastos||[]).reduce((Fe,$e)=>Fe+$e.monto,0),Cr={solicitado:{lbl:"Solicitado",c:O.amber},aprobado:{lbl:"Aprobado",c:O.blue},entregado:{lbl:"Anticipo entregado",c:"#5B3A8C"},legalizado:{lbl:"Legalizado",c:O.green},rechazado:{lbl:"Rechazado",c:O.red}};Te.find(Y=>Y.id===xt);const[qt,li]=F.useState(null),ll=()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:" Mis Viajes y Viticos"}),e.jsx("p",{style:{margin:0,fontSize:10,color:O.inkLight},children:"Solicita viticos, registra gastos y legaliza"})]}),e.jsxs("button",{onClick:()=>at(!0),style:{padding:"8px 16px",background:O.ink,color:"#fff",border:"none",borderRadius:5,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:5},children:[e.jsx(Pe,{size:11})," Solicitar viaje"]})]}),Te.length===0?e.jsxs("div",{style:{...ae.card,textAlign:"center",padding:40,color:O.inkLight},children:[e.jsx(zo,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"No tienes solicitudes de viaje."}),e.jsx("p",{style:{fontSize:10,color:O.inkXLight},children:'Pulsa "Solicitar viaje" para crear una.'})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Te.map(Y=>{const Fe=Ji(Y),$e=Sr(Y),Qe=Cr[Y.estado]||Cr.solicitado;return e.jsxs("div",{onClick:()=>Ft(Y.id===xt?null:Y.id),style:{...ae.card,cursor:"pointer",marginBottom:0,border:xt===Y.id?`2px solid ${O.ink}`:`1px solid ${O.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[Y.destino," ",e.jsxs("span",{style:{fontSize:10,fontWeight:400,color:O.inkMid},children:[" ",Y.dias," das  ",Y.fecha,Y.fechaRegreso?`  ${Y.fechaRegreso}`:""]})]}),e.jsx("div",{style:{fontSize:10,color:O.inkMid,marginTop:2},children:Y.concepto})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:Qe.c+"22",color:Qe.c},children:Qe.lbl}),e.jsxs("div",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,marginTop:4},children:["Est: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Fe),$e>0&&e.jsxs("span",{style:{color:"#5B3A8C",marginLeft:8},children:["Real: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format($e)]})]})]})]}),xt===Y.id&&e.jsxs("div",{style:{marginTop:12,borderTop:`1px solid ${O.border}`,paddingTop:12},onClick:pt=>pt.stopPropagation(),children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Desglose estimado"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",marginBottom:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${O.border}`},children:"tem"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${O.border}`},children:"Detalle"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:O.blue,textAlign:"right",borderBottom:`1px solid ${O.border}`},children:"Estimado"}),(Y.estado==="entregado"||Y.estado==="legalizado")&&e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#5B3A8C",textAlign:"right",borderBottom:`1px solid ${O.border}`},children:"Real"})]})}),e.jsxs("tbody",{children:[Ti.map((pt,yt)=>{const Et=(Y.itemsViaje||{})[pt.id]||{estimado:0,real:0,detalle:""},Bi=Y.estado==="solicitado"||Y.estado==="aprobado",di=Y.estado==="entregado"||Y.estado==="legalizado";return e.jsxs("tr",{style:{borderBottom:`1px solid ${O.border}`,background:yt%2?"#FFFFFF":"#fff"},children:[e.jsxs("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:600},children:[pt.icon," ",pt.lbl]}),e.jsx("td",{style:{padding:"3px 4px"},children:Bi?e.jsx("input",{type:"text",value:Et.detalle||"",placeholder:"Detalle...",onChange:Mn=>ji(Y.id,pt.id,"detalle",Mn.target.value),style:{width:"100%",border:`1px solid ${O.border}`,borderRadius:3,padding:"3px 6px",fontSize:9,background:"#fff",fontFamily:"'DM Sans',sans-serif"}}):e.jsx("span",{style:{fontSize:9,color:O.inkMid},children:Et.detalle||""})}),e.jsx("td",{style:{padding:"3px 4px"},children:Bi?e.jsx("input",{type:"number",value:Et.estimado||"",placeholder:"0",onChange:Mn=>ji(Y.id,pt.id,"estimado",Mn.target.value),style:{width:"100%",textAlign:"right",border:`1px solid ${O.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:O.blue,background:"#fff"}}):e.jsxs("div",{style:{textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:O.blue,padding:"3px 6px"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(parseFloat(Et.estimado)||0)]})}),(Y.estado==="entregado"||Y.estado==="legalizado")&&e.jsx("td",{style:{padding:"3px 4px"},children:di?e.jsx("input",{type:"number",value:Et.real||"",placeholder:"0",onChange:Mn=>ji(Y.id,pt.id,"real",Mn.target.value),style:{width:"100%",textAlign:"right",border:`1px solid ${O.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",background:"#fff"}}):e.jsxs("div",{style:{textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",padding:"3px 6px"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(parseFloat(Et.real)||0)]})})]},pt.id)}),e.jsxs("tr",{style:{borderTop:`2px solid ${O.ink}`,background:"#EDEBE7"},children:[e.jsx("td",{colSpan:2,style:{padding:"4px 8px",fontSize:10,fontWeight:800},children:"TOTAL"}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:O.blue},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Fe)]}),(Y.estado==="entregado"||Y.estado==="legalizado")&&e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:"#5B3A8C"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Sr(Y))]})]})]})]}),Y.estado==="solicitado"&&e.jsx("div",{style:{background:O.amberBg,border:`1px solid ${O.amber}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:O.amber,fontWeight:600},children:" Pendiente de aprobacin por Administracin. Completa el desglose estimado arriba."}),Y.estado==="aprobado"&&e.jsx("div",{style:{background:O.blueBg,border:`1px solid ${O.blue}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:O.blue,fontWeight:600},children:" Aprobado. Administracin gestionar la compra de tiquetes y hotel."}),Y.estado==="entregado"&&e.jsxs("div",{style:{background:"#F0ECF6",border:"1px solid #5B3A8C33",borderRadius:4,padding:"8px 12px",fontSize:10,color:"#5B3A8C",fontWeight:600},children:[" Anticipo entregado: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Y.anticipoEntregado||0),'. Registra los gastos reales en la columna "Real" y aade gastos extra abajo.',e.jsx("button",{onClick:()=>li({fecha:ui(),concepto:"",monto:0,soporte:""}),style:{display:"block",marginTop:6,padding:"4px 12px",background:"#5B3A8C",color:"#fff",border:"none",borderRadius:3,fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir gasto extra"})]}),Y.estado==="legalizado"&&e.jsx("div",{style:{background:O.greenBg,border:`1px solid ${O.green}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:O.green,fontWeight:600},children:" Legalizado y cerrado."}),Y.estado==="rechazado"&&e.jsx("div",{style:{background:O.redBg,border:`1px solid ${O.red}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:O.red,fontWeight:600},children:" Rechazado por Administracin."}),(Y.gastos||[]).length>0&&e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Gastos extra"}),Y.gastos.map(pt=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 8px",borderBottom:`1px solid ${O.border}`,fontSize:10},children:[e.jsxs("span",{children:[pt.fecha,"  ",pt.concepto]}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:O.red},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(pt.monto)]})]},pt.id))]})]})]},Y.id)})}),ct&&e.jsx("div",{style:ae.overlay,onClick:()=>at(!1),children:e.jsxs("div",{style:ae.modal,onClick:Y=>Y.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:4,fontSize:14,fontWeight:700},children:" Solicitar viaje"}),e.jsx("p",{style:{fontSize:10,color:O.inkLight,marginBottom:14},children:"Despus de crear podrs completar el desglose (vuelos, hotel, etc.)"}),e.jsx(bt,{label:"Destino",children:e.jsx(mt,{value:zt.destino,onChange:Y=>Vt({...zt,destino:Y}),placeholder:"Ciudad / lugar"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 80px",gap:10},children:[e.jsx(bt,{label:"Concepto / motivo",children:e.jsx(mt,{value:zt.concepto,onChange:Y=>Vt({...zt,concepto:Y}),placeholder:"Visita obra, capacitacin..."})}),e.jsx(bt,{label:"Das",children:e.jsx(mt,{type:"number",value:zt.dias,onChange:Y=>Vt({...zt,dias:Y})})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(bt,{label:"Fecha ida",children:e.jsx(mt,{type:"date",value:zt.fecha,onChange:Y=>Vt({...zt,fecha:Y})})}),e.jsx(bt,{label:"Fecha regreso",children:e.jsx(mt,{type:"date",value:zt.fechaRegreso,onChange:Y=>Vt({...zt,fechaRegreso:Y})})})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${O.border}`},children:[e.jsx(Ze,{variant:"outline",onClick:()=>at(!1),children:"Cancelar"}),e.jsxs(Ze,{variant:"primary",onClick:lo,disabled:!zt.destino,children:[e.jsx(bn,{size:12}),"Enviar solicitud"]})]})]})}),qt&&e.jsx("div",{style:ae.overlay,onClick:()=>li(null),children:e.jsxs("div",{style:ae.modal,onClick:Y=>Y.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:12,fontSize:14,fontWeight:700},children:"Gasto extra"}),e.jsx(bt,{label:"Fecha",children:e.jsx(mt,{type:"date",value:qt.fecha,onChange:Y=>li({...qt,fecha:Y})})}),e.jsx(bt,{label:"Concepto",children:e.jsx(mt,{value:qt.concepto,onChange:Y=>li({...qt,concepto:Y}),placeholder:"Taxi, imprevisto..."})}),e.jsx(bt,{label:"Monto",children:e.jsx(mt,{type:"number",value:qt.monto,onChange:Y=>li({...qt,monto:Y})})}),e.jsx(bt,{label:"Soporte",children:e.jsx(mt,{value:qt.soporte,onChange:Y=>li({...qt,soporte:Y}),placeholder:"Ref. factura"})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${O.border}`},children:[e.jsx(Ze,{variant:"outline",onClick:()=>li(null),children:"Cancelar"}),e.jsxs(Ze,{variant:"primary",onClick:()=>{jr(xt,{...qt,monto:parseFloat(qt.monto)||0}),li(null)},children:[e.jsx(Co,{size:12}),"Guardar"]})]})]})})]}),Yi=()=>A?e.jsx("div",{style:ae.overlay,onClick:()=>z(null),children:e.jsxs("div",{style:ae.modal,onClick:Y=>Y.stopPropagation(),children:[e.jsxs("h3",{style:{marginBottom:16,fontSize:14,fontWeight:700},children:["Imputar horas  ",A.fecha]}),e.jsx(bt,{label:"Fecha",children:e.jsx(mt,{type:"date",value:A.fecha,onChange:Y=>de(z,"fecha",Y)})}),e.jsx(bt,{label:"Orden de trabajo (OT)",children:e.jsx(mi,{value:A.otCodigo,onChange:Y=>de(z,"otCodigo",Y),options:[{value:"",label:"Seleccionar OT..."},...ie.map(Y=>({value:Y,label:Y}))]})}),e.jsx(bt,{label:"Actividad",children:e.jsx(mt,{value:A.actividad,onChange:Y=>de(z,"actividad",Y),placeholder:"Ej. Diseo conceptual"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(bt,{label:"Horas normales",children:e.jsx(mt,{type:"number",value:A.horasNormales,onChange:Y=>de(z,"horasNormales",Number(Y))})}),e.jsx(bt,{label:"Horas extra",children:e.jsx(mt,{type:"number",value:A.horasExtra||0,onChange:Y=>de(z,"horasExtra",Number(Y))})})]}),e.jsx(bt,{label:"Descripcin (opcional)",children:e.jsx(mt,{value:A.descripcion||"",onChange:Y=>de(z,"descripcion",Y),placeholder:"Notas sobre el trabajo realizado"})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${O.border}`},children:[e.jsx(Ze,{variant:"outline",onClick:()=>z(null),children:"Cancelar"}),e.jsxs(Ze,{variant:"primary",onClick:ue,children:[e.jsx(Co,{size:12}),"Guardar borrador"]})]})]})}):null,kr=()=>k?e.jsx("div",{style:ae.overlay,onClick:()=>T(null),children:e.jsxs("div",{style:ae.modal,onClick:Y=>Y.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:16,fontSize:14,fontWeight:700},children:"Nueva solicitud"}),e.jsx(bt,{label:"Tipo de solicitud",children:e.jsx(mi,{value:k.tipo,onChange:Y=>de(T,"tipo",Y),options:[{value:"",label:"Seleccionar..."},...Sn.map(Y=>({value:Y.id,label:`${Y.icono} ${Y.lbl}`}))]})}),k.tipo&&(()=>{const Y=J(k.tipo);return e.jsxs(e.Fragment,{children:[Y.requiereFechas&&e.jsxs(e.Fragment,{children:[e.jsx(bt,{label:"Fecha inicio",children:e.jsx(mt,{type:"date",value:k.fechaInicio,onChange:Fe=>de(T,"fechaInicio",Fe)})}),e.jsx(bt,{label:"Fecha fin",children:e.jsx(mt,{type:"date",value:k.fechaFin,onChange:Fe=>de(T,"fechaFin",Fe)})})]}),Y.requiereHoras&&e.jsx(bt,{label:"Horas",children:e.jsx(mt,{type:"number",value:k.horas||0,onChange:Fe=>de(T,"horas",Number(Fe))})}),e.jsx(bt,{label:"Motivo / Descripcin",children:e.jsx(mi,{value:k.motivo,onChange:Fe=>de(T,"motivo",Fe),options:[{value:"",label:"Seleccionar motivo..."},...(k.tipo==="licEspecial"?lf:sf).map(Fe=>({value:Fe,label:Fe}))]})}),e.jsx(bt,{label:"Descripcin adicional (opcional)",children:e.jsx(mt,{value:k.descripcion||"",onChange:Fe=>de(T,"descripcion",Fe),placeholder:"Aade detalle si lo deseas..."})}),Y.requiereDoc&&e.jsxs(bt,{label:"Documento adjunto (opcional)",children:[e.jsx("input",{type:"file",accept:"application/pdf,image/*",onChange:Fe=>{const $e=Fe.target.files[0];if(!$e)return;const Qe=new FileReader;Qe.onload=pt=>T(yt=>({...yt,docNombre:$e.name,docBase64:pt.target.result})),Qe.readAsDataURL($e)},style:{fontSize:11}}),k.docNombre&&e.jsxs("div",{style:{fontSize:10,color:O.green,marginTop:3},children:[" ",k.docNombre]})]})]})})(),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${O.border}`},children:[e.jsx(Ze,{variant:"outline",onClick:()=>T(null),children:"Cancelar"}),e.jsxs(Ze,{variant:"primary",onClick:G,disabled:!k.tipo,children:[e.jsx(bn,{size:12}),"Enviar solicitud"]})]})]})}):null;return e.jsxs("div",{style:ae.page,children:[e.jsxs("div",{style:{background:O.surface,borderBottom:`1px solid ${O.border}`,padding:"0 20px",display:"flex",overflowX:"auto"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"10px 12px 10px 0",borderRight:`1px solid ${O.border}`,marginRight:8,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:24,height:24,background:O.ink,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:10,fontWeight:800,color:"#fff",letterSpacing:.5},children:"H"})}),e.jsx("span",{style:{fontSize:11,fontWeight:700,color:O.ink},children:w})]}),pe.map(Y=>{const Fe=p===Y.id;return e.jsxs("button",{onClick:()=>c(Y.id),style:ae.navBtn(Fe),children:[Y.lbl,Y.badge>0&&e.jsx("span",{style:{background:O.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:Y.badge})]},Y.id)}),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>x(!1),style:{...ae.navBtn(!1),color:O.red},children:[e.jsx($c,{size:11}),"Salir"]})]}),e.jsxs("div",{style:{padding:"20px 20px",maxWidth:900,margin:"0 auto",paddingBottom:40},children:[p==="calendario"&&e.jsx(I,{}),p==="partes"&&e.jsx($,{}),p==="solicitudes"&&e.jsx(H,{}),p==="viajes"&&e.jsx(ll,{}),p==="ficha"&&e.jsx(U,{}),p==="documentos"&&e.jsx(_,{})]}),e.jsx(Yi,{}),e.jsx(kr,{})]})}function ia({onCancel:t,onSave:i,saveLabel:o="Guardar"}){return e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:20,paddingTop:16,borderTop:`1px solid ${O.border}`},children:[e.jsx(Ze,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsxs(Ze,{variant:"primary",onClick:i,children:[e.jsx(Co,{size:12}),o]})]})}const Xa=[{id:"dashboard",lbl:"Dashboard",I:Hi,desc:"KPIs y mtricas de RRHH"},{id:"cargos",lbl:"Cargos y Salarios",I:Fi,desc:"Plantilla y cargas sociales"},{id:"jornada",lbl:"Jornada Laboral",I:Ea,desc:"Horas, festivos y productividad"},{id:"activos",lbl:"Activos y Estructura",I:Fn,desc:"NIIF, licencias y gastos"},{id:"equipos",lbl:"Equipos de Trabajo",I:Fi,desc:"Configura equipos para APUs"},{id:"asistencia",lbl:"Asistencia Obra",I:zd,desc:"Control GPS+Foto de entrada/salida"},{id:"partes",lbl:"Partes de Trabajo",I:Uo,desc:"Vista admin  empleados imputan desde Portal"},{id:"novedades",lbl:"Novedades Nmina",I:At,desc:"Vacaciones, bajas, permisos y horas extra"},{id:"docs",lbl:"Documentos",I:zo,desc:"Nminas, contratos y certificados"},{id:"portal",lbl:"Portal Empleado",I:yn,desc:"Vista del trabajador"}];function jf({pais:t="CO"}){var oe,te;const[i,o]=F.useState("dashboard"),n={pais:t},[a,r]=fi(hi.cargos,[]),[s,d]=fi(hi.jornada,tf),[u,b]=fi(hi.activos,[]),[j,w]=fi(hi.licencias,[]),[S,m]=fi(hi.gastos,[]),[x,p]=fi(hi.equipos,[]),[c,g]=fi(hi.partes,[]),[l,f]=fi(hi.asistencia,[]),[y,h]=fi(hi.empleados,[]),[v,A]=fi(hi.novedades,[]),[z,k]=fi(hi.fichas,[]),[T,C]=fi(hi.docs,[]),D=c.filter(P=>P.estado==="Enviado").length,K=v.filter(P=>P.estado==="Pendiente").length;return e.jsxs(e.Fragment,{children:[e.jsx(Qh,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:O.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:O.surface,borderBottom:`1px solid ${O.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:O.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:O.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:O.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:O.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase",color:O.ink},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:O.inkLight,marginLeft:10},children:"/ Recursos Humanos"})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[D>0&&e.jsxs("div",{style:{background:O.amberBg,border:`1px solid ${O.amber}33`,borderRadius:3,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>o("partes"),children:[e.jsx(si,{size:11,color:O.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:O.amber},children:[D," parte",D>1?"s":""," pendiente",D>1?"s":""]})]}),K>0&&e.jsxs("div",{style:{background:"#FAF0E0",border:"1px solid #8C6A0033",borderRadius:3,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>o("novedades"),children:[e.jsx(za,{size:11,color:"#8C6A00"}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:"#8C6A00"},children:[K," nov. pendiente",K>1?"s":""]})]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:O.surface,borderRight:`1px solid ${O.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[Xa.map(P=>{const ie=i===P.id;return e.jsxs("button",{onClick:()=>o(P.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:ie?`3px solid ${O.ink}`:"3px solid transparent",background:ie?O.accent:"transparent",color:ie?O.ink:O.inkLight,fontSize:12,fontWeight:ie?700:400,cursor:"pointer",textAlign:"left",width:"100%",position:"relative",transition:"all .1s"},children:[e.jsx(P.I,{size:13,style:{flexShrink:0}}),e.jsx("span",{style:{lineHeight:1.2},children:P.lbl}),P.id==="partes"&&D>0&&e.jsx("span",{style:{marginLeft:"auto",background:O.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:D}),P.id==="novedades"&&K>0&&e.jsx("span",{style:{marginLeft:"auto",background:"#8C6A00",color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:K})]},P.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:O.inkXLight,letterSpacing:.8,borderTop:`1px solid ${O.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:i==="portal"?e.jsx(vf,{partes:c,savePartes:g,novedades:v,saveNovedades:A,fichas:z,saveFichas:k,docs:T,saveDocs:C,cargos:a,empleados:y,saveEmpleados:h}):e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:O.ink,letterSpacing:-.2},children:(oe=Xa.find(P=>P.id===i))==null?void 0:oe.lbl}),e.jsx("p",{style:{fontSize:11,color:O.inkLight,marginTop:2},children:(te=Xa.find(P=>P.id===i))==null?void 0:te.desc})]}),i==="dashboard"&&e.jsxs("div",{className:"fade-up",style:{padding:"20px 0"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Cargos",a.length,"#111"],[" Empleados",y.length,"#3B3B3B"],[" Partes",c.length,"#111"],[" Novedades pend.",v.filter(P=>P.estado==="Pendiente").length,v.filter(P=>P.estado==="Pendiente").length>0?"#8C6A00":"#111111"]].map(([P,ie,me])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:P}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:me},children:ie})]},P))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Horas aprobadas",c.filter(P=>P.estado==="Aprobado").reduce((P,ie)=>P+Number(ie.horasNormales||0)+Number(ie.horasExtra||0),0)+"h","#111111"],[" Vacaciones aprobadas",v.filter(P=>P.tipo==="vacaciones"&&P.estado==="Aprobada").reduce((P,ie)=>P+Number(ie.dias||0),0)+"d","#3B3B3B"],[" Bajas activas",v.filter(P=>P.tipo==="baja"&&P.estado==="Aprobada").length,"#B91C1C"],[" Viticos pend.",(()=>{try{return(JSON.parse(localStorage.getItem("habitaris_admin"))||{}).adm_viaticos||[]}catch{return[]}})().filter(P=>P.estado==="solicitado").length,"#8C6A00"]].map(([P,ie,me])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:P}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:me},children:ie})]},P))})]}),i==="cargos"&&e.jsx(pf,{cargos:a,saveCargos:r,jornada:s}),i==="jornada"&&e.jsx(gf,{jornada:s,saveJornada:d}),i==="activos"&&e.jsx(uf,{activos:u,saveActivos:b,licencias:j,saveLicencias:w,gastos:S,saveGastos:m}),i==="equipos"&&e.jsx(hf,{equipo:x,setEquipo:p,cargos:a,pais:(n==null?void 0:n.pais)||"CO"}),i==="asistencia"&&e.jsx(xf,{equipo:x,asistencia:l,setAsistencia:f,pais:(n==null?void 0:n.pais)||"CO"}),i==="partes"&&e.jsx(ff,{partes:c,setPartes:g,equipo:x,cargos:a,currentUser:null,pais:(n==null?void 0:n.pais)||"CO"}),i==="novedades"&&e.jsx(mf,{novedades:v,saveNovedades:A}),i==="docs"&&e.jsx(yf,{docs:T,saveDocs:C,fichas:z,cargos:a})]})})]})]})]})}const ee={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C0BDB8",border:"#E0E0E0",accent:"#EDEBE7",shadow:"0 1px 3px rgba(0,0,0,.06)",shadowMd:"0 4px 20px rgba(0,0,0,.09)",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",orange:"#7C3A1E",orangeBg:"#FDF0E8"},Sf=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800;900&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'DM Sans',sans-serif;background:${ee.bg};}
    .mono{font-family:'DM Mono',monospace;}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    .fade-up{animation:fadeUp .18s ease both}
    input,button,select{font-family:'DM Sans',sans-serif;}
    input:focus,select:focus{outline:none;border-color:${ee.ink}!important;}
    ::-webkit-scrollbar{width:4px;height:4px;}
    ::-webkit-scrollbar-thumb{background:${ee.border};border-radius:2px;}
    table{border-collapse:collapse;}
  `});function xn(t,i){const[o,n]=F.useState(()=>{var r,s;try{const d=(s=(r=window.storage)==null?void 0:r.getItem)==null?void 0:s.call(r,t);return d?JSON.parse(d):i}catch{return i}});return[o,r=>{var d,u;const s=typeof r=="function"?r(o):r;n(s);try{(u=(d=window.storage)==null?void 0:d.setItem)==null||u.call(d,t,JSON.stringify(s))}catch{}}]}const qo={CO:{label:"Colombia",flag:"",ref:"NTC 2050 / RETIE",mono_V:120,tri_VLN:120,tri_VLL:208,FS:1.25,curvas:["C","D"],dV_max_rama:3,dV_max_total:5,breakers:[6,10,15,20,25,30,40,50,60,70,80,90,100,110,125,150,175,200]},ES:{label:"Espaa",flag:"",ref:"REBT ITC-BT-19",mono_V:230,tri_VLN:230,tri_VLL:400,FS:1.25,curvas:["B","C","D"],dV_max_rama:3,dV_max_total:5,breakers:[6,10,13,16,20,25,32,40,50,63,80,100,125,160,200,250]}},al=[1.5,2.5,4,6,10,16,25,35,50,70,95,120],dc={Cobre:.01786,Aluminio:.02857},cc={1.5:15,2.5:21,4:27,6:34,10:46,16:61,25:80,35:99,50:119,70:151,95:182,120:210},pc={1.5:null,2.5:null,4:20,6:26,10:35,16:46,25:60,35:75,50:90,70:115,95:138,120:160};function Hs(t,i){const o=qo[i].breakers;return o.find(n=>n>=t)||o[o.length-1]}function gc(t,i){const o=i==="Cobre"?cc:pc;for(const n of al)if(o[n]&&o[n]>=t)return n;return 120}function uc(t,i,o,n,a,r){const s=dc[n],d=qo[r],u=a==="Monofsica"?d.mono_V:d.tri_VLL;return(a==="Monofsica"?2:Math.sqrt(3))*t*i*s/o/u*100}function hc(t,i,o,n,a,r){const s=dc[o],d=qo[a],u=n==="Monofsica"?d.mono_V:d.tri_VLL,b=n==="Monofsica"?2:Math.sqrt(3),j=u/(r*1e3),w=b*t*s/i;return u/(j+w)/1e3}const Yt=t=>isNaN(t)||t==null?"":Number(t).toLocaleString("es-CO",{maximumFractionDigits:2}),Qa=t=>isNaN(t)||t==null?"":"$ "+Number(t).toLocaleString("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0}),Mt=({label:t,value:i,onChange:o,unit:n,type:a="number",placeholder:r="",step:s,min:d})=>e.jsxs("div",{style:{marginBottom:10},children:[t&&e.jsxs("div",{style:{fontSize:9,color:ee.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:[t,n&&e.jsxs("span",{style:{color:ee.inkXLight,marginLeft:4},children:["(",n,")"]})]}),e.jsx("input",{type:a,value:i,onChange:u=>o(u.target.value),placeholder:r,step:s,min:d,style:{width:"100%",padding:"8px 10px",border:`1.5px solid ${ee.border}`,borderRadius:4,fontSize:12,background:ee.surface,color:ee.ink}})]}),Wi=({label:t,value:i,onChange:o,options:n,small:a=!1})=>e.jsxs("div",{style:{marginBottom:a?0:10},children:[t&&e.jsx("div",{style:{fontSize:9,color:ee.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:t}),e.jsx("select",{value:i,onChange:r=>o(r.target.value),style:{width:"100%",padding:a?"6px 8px":"8px 10px",border:`1.5px solid ${ee.border}`,borderRadius:4,fontSize:12,background:ee.surface,color:ee.ink},children:n.map(r=>e.jsx("option",{value:r.v||r,children:r.l||r},r.v||r))})]}),Cf=({ok:t,warn:i,text:o})=>e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:3,background:i?ee.amberBg:t?ee.greenBg:ee.redBg,border:`1px solid ${i?ee.amber:t?ee.green:ee.red}33`},children:[i?e.jsx(si,{size:9,color:ee.amber}):t?e.jsx(Vo,{size:9,color:ee.green}):e.jsx(si,{size:9,color:ee.red}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:i?ee.amber:t?ee.green:ee.red},children:o})]}),_a=({pais:t})=>e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:5,padding:"3px 10px",borderRadius:12,background:ee.accent,border:`1px solid ${ee.border}`,fontSize:10,color:ee.inkMid},children:[e.jsx("span",{children:qo[t].flag}),e.jsx("span",{style:{fontWeight:700},children:t==="CO"?"NTC 2050  RETIE":"REBT  ITC-BT"})]}),Pr=[{id:"dashboard",label:"Dashboard",I:Hi,desc:"Vista general de herramientas"},{id:"cuadro",label:"Cuadro de Cargas",I:cl,desc:"Tabla completa circuito a circuito"},{id:"circuito",label:"Circuito Rpido",I:cl,desc:"Clculo unitario de un circuito"},{id:"iluminacion",label:"Iluminacin",I:Ed,desc:"Diseo luminotcnico  RETILAP / CTE DB-HE3"},{id:"concreto",label:"Concreto",I:Pc,desc:"Volmenes y mezclas ACI 211"},{id:"cubicacion",label:"Cubicacin",I:Ad,desc:"reas, volmenes y permetros"},{id:"materiales",label:"Materiales",I:Fn,desc:"Presupuesto rpido de obra"},{id:"unidades",label:"Unidades",I:Oc,desc:"Conversin entre sistemas"}],Xl=()=>({id:Date.now()+Math.random(),desc:"",tipo:"General",cant:1,wUnit:"",fp:.9,simult:1,material:"Cobre",longitud:"",seccionManual:"",curva:"C",fase:"L1"});function kf({pais:t}){const i=qo[t],[o,n]=xn("hab:herr:cuadro:red","Monofsica"),[a,r]=xn("hab:herr:cuadro:iccb","6"),[s,d]=xn("hab:herr:cuadro:filas",[Xl()]),[u,b]=xn("hab:herr:cuadro:nombre","Tablero General"),j=o==="Monofsica"?i.mono_V:i.tri_VLL,w=o==="Monofsica"?i.mono_V:i.tri_VLN,S=(z,k,T)=>d(C=>C.map(D=>D.id===z?{...D,[k]:T}:D)),m=()=>d(z=>[...z,Xl()]),x=z=>d(k=>k.filter(T=>T.id!==z)),p=F.useMemo(()=>s.map(z=>{const k=Number(z.cant)||0,T=Number(z.wUnit)||0,C=Number(z.fp)||1,D=Number(z.simult)||1,K=Number(z.longitud)||0,oe=k*T*D,te=C>0?oe/C:oe,P=j>0&&te>0?te/w:0,ie=P*i.FS,me=ie>0?Hs(ie,t):null,Q=ie>0?gc(ie,z.material):null,je=Number(z.seccionManual)||Q||0,re=K>0&&P>0&&je>0?uc(K,P,je,z.material,o,t):null,J=K>0&&je>0&&Number(a)>0?hc(K,je,z.material,o,t,Number(a)):null,M=z.material==="Cobre"?cc[je]:pc[je],B=re!==null?re<=i.dV_max_rama:null,V=J!==null?J>.001:null;return{totalW:oe,totalVA:te,I:P,Id:ie,breaker:me,seccion:je,secAuto:Q,dV:re,iccFin:J,dVok:B,iccOk:V,iMaxCond:M}}),[s,o,t,a,j,w,i]),c=p.reduce((z,k)=>z+k.totalW,0),g=p.reduce((z,k)=>z+k.totalVA,0),l=j>0?g/w:0,f=Hs(l*i.FS,t),y=["General","Iluminacin","Tomacorriente","Motor","Aire Acondicionado","Calefaccin","Bomba","UPS","Carga EV","Otro"],h=o==="Monofsica"?["L1"]:["L1","L2","L3"],v={padding:"7px 8px",fontSize:8,letterSpacing:.8,textTransform:"uppercase",color:ee.inkLight,fontWeight:700,textAlign:"left",background:ee.bg,borderBottom:`2px solid ${ee.border}`,whiteSpace:"nowrap"},A={padding:"5px 6px",fontSize:11,borderBottom:`1px solid ${ee.border}`,verticalAlign:"middle"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:10,marginBottom:12,background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"14px 16px"},children:[e.jsx(Mt,{label:"Nombre del tablero",value:u,onChange:b,type:"text"}),e.jsx(Wi,{label:"Tipo de red",value:o,onChange:n,options:[{v:"Monofsica",l:"Monofsica"},{v:"Trifsica",l:"Trifsica"}]}),e.jsx(Mt,{label:"Icc barra (kA)",value:a,onChange:r,step:"0.5",min:"1"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:ee.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Normativa"}),e.jsx("div",{style:{padding:"8px 0"},children:e.jsx(_a,{pais:t})})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:ee.inkMid},children:[e.jsxs("span",{style:{fontWeight:700,color:ee.ink},className:"mono",children:[Yt(c)," W"]})," totales ",e.jsxs("span",{style:{fontWeight:700,color:ee.blue,marginLeft:6},className:"mono",children:[Yt(g)," VA"]})," ",e.jsxs("span",{style:{fontWeight:700,color:ee.red,marginLeft:6},className:"mono",children:["I=",Yt(l)," A"]})," ",e.jsxs("span",{style:{fontWeight:700,color:ee.amber,marginLeft:6},children:["Breaker principal: ",f," A"]})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:6},children:e.jsxs("button",{onClick:m,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 12px",background:ee.ink,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:11,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(Pe,{size:12}),"Circuito"]})})]}),e.jsx("div",{style:{overflowX:"auto",background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8},children:e.jsxs("table",{style:{width:"100%",minWidth:1200},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:v,children:"#"}),e.jsx("th",{style:{...v,minWidth:130},children:"Descripcin"}),e.jsx("th",{style:v,children:"Tipo"}),e.jsx("th",{style:{...v,width:50},children:"Cant"}),e.jsx("th",{style:{...v,width:70},children:"W unit"}),e.jsx("th",{style:{...v,width:50},children:"FP"}),e.jsx("th",{style:{...v,width:60},children:"Simult."}),e.jsx("th",{style:v,children:"Total W"}),e.jsx("th",{style:v,children:"Total VA"}),e.jsx("th",{style:v,children:"I (A)"}),e.jsx("th",{style:v,children:"IFS (A)"}),e.jsx("th",{style:v,children:"Breaker"}),e.jsx("th",{style:v,children:"Curva"}),e.jsx("th",{style:v,children:"Material"}),e.jsx("th",{style:{...v,width:60},children:"Long (m)"}),e.jsx("th",{style:v,children:"Secc mm"}),e.jsx("th",{style:v,children:"V %"}),e.jsx("th",{style:v,children:"Icc fin"}),o==="Trifsica"&&e.jsx("th",{style:v,children:"Fase"}),e.jsx("th",{style:v})]})}),e.jsx("tbody",{children:s.map((z,k)=>{const T=p[k];return e.jsxs("tr",{style:{background:k%2===0?ee.surface:ee.bg+"80"},children:[e.jsx("td",{style:{...A,color:ee.inkLight,fontWeight:700},children:k+1}),e.jsx("td",{style:A,children:e.jsx("input",{value:z.desc,onChange:C=>S(z.id,"desc",C.target.value),placeholder:"Ej: Iluminacin sala",style:{width:"100%",padding:"4px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("select",{value:z.tipo,onChange:C=>S(z.id,"tipo",C.target.value),style:{width:"100%",padding:"4px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:10,background:"transparent"},children:y.map(C=>e.jsx("option",{children:C},C))})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:z.cant,onChange:C=>S(z.id,"cant",C.target.value),min:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:z.wUnit,onChange:C=>S(z.id,"wUnit",C.target.value),placeholder:"0",style:{width:"100%",padding:"4px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:z.fp,onChange:C=>S(z.id,"fp",C.target.value),step:"0.01",min:"0.1",max:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:z.simult,onChange:C=>S(z.id,"simult",C.target.value),step:"0.1",min:"0.1",max:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:{...A,fontWeight:T.totalW>0?600:400},className:"mono",children:T.totalW>0?Yt(T.totalW):""}),e.jsx("td",{style:{...A},className:"mono",children:T.totalVA>0?Yt(T.totalVA):""}),e.jsx("td",{style:{...A,color:ee.blue,fontWeight:600},className:"mono",children:T.I>0?Yt(T.I):""}),e.jsx("td",{style:{...A},className:"mono",children:T.Id>0?Yt(T.Id):""}),e.jsx("td",{style:{...A},children:T.breaker?e.jsxs("span",{style:{background:ee.ink,color:"#fff",borderRadius:3,padding:"2px 7px",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace"},children:[T.breaker,"A"]}):""}),e.jsx("td",{style:A,children:e.jsx("select",{value:z.curva,onChange:C=>S(z.id,"curva",C.target.value),style:{padding:"3px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent"},children:i.curvas.map(C=>e.jsx("option",{children:C},C))})}),e.jsx("td",{style:A,children:e.jsxs("select",{value:z.material,onChange:C=>S(z.id,"material",C.target.value),style:{padding:"3px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent",minWidth:70},children:[e.jsx("option",{children:"Cobre"}),e.jsx("option",{children:"Aluminio"})]})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:z.longitud,onChange:C=>S(z.id,"longitud",C.target.value),placeholder:"0",style:{width:"100%",padding:"4px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsxs("td",{style:A,children:[e.jsxs("select",{value:z.seccionManual||T.secAuto||"",onChange:C=>S(z.id,"seccionManual",C.target.value),style:{padding:"3px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:z.seccionManual?"transparent":ee.greenBg,minWidth:55},children:[e.jsx("option",{value:"",children:"Auto"}),al.map(C=>e.jsx("option",{value:C,children:C},C))]}),T.seccion>0&&e.jsxs("div",{style:{fontSize:8,color:ee.green,marginTop:1},className:"mono",children:[T.seccion,"mm"]})]}),e.jsx("td",{style:A,children:T.dV!==null?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:T.dVok?ee.green:ee.red},children:[Yt(T.dV),"%"]}),e.jsx("div",{style:{marginTop:2},children:e.jsx(Cf,{ok:T.dVok,text:T.dVok?`${i.dV_max_rama}% `:`>${i.dV_max_rama}% `})})]}):e.jsx("span",{style:{color:ee.inkXLight},children:""})}),e.jsx("td",{style:A,children:T.iccFin!==null?e.jsxs("span",{className:"mono",style:{fontSize:11,color:ee.inkMid},children:[T.iccFin.toFixed(2)," kA"]}):e.jsx("span",{style:{color:ee.inkXLight},children:""})}),o==="Trifsica"&&e.jsx("td",{style:A,children:e.jsx("select",{value:z.fase,onChange:C=>S(z.id,"fase",C.target.value),style:{padding:"3px 6px",border:`1px solid ${ee.border}`,borderRadius:3,fontSize:11,background:"transparent"},children:h.map(C=>e.jsx("option",{children:C},C))})}),e.jsx("td",{style:A,children:e.jsx("button",{onClick:()=>x(z.id),style:{background:"none",border:"none",cursor:"pointer",color:ee.red,fontSize:16,lineHeight:1,padding:2},children:""})})]},z.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:ee.ink},children:[e.jsxs("td",{colSpan:7,style:{padding:"10px 12px",fontSize:10,fontWeight:700,color:"rgba(255,255,255,.5)",textTransform:"uppercase",letterSpacing:1},children:["TOTALES  ",s.length," circuitos  FS=",i.FS,"  ",j,"V"]}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#fff"},children:[Yt(c)," W"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#adf"},children:[Yt(g)," VA"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#faa"},children:[Yt(l)," A"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:11,color:"rgba(255,255,255,.5)"},children:[Yt(l*i.FS)," A"]})}),e.jsx("td",{style:{padding:"10px 8px"},children:e.jsxs("span",{style:{background:"#fff",color:ee.ink,borderRadius:3,padding:"3px 8px",fontSize:12,fontWeight:800,fontFamily:"'DM Mono',monospace"},children:[f,"A"]})}),e.jsx("td",{colSpan:o==="Trifsica"?7:6}),e.jsx("td",{})]})})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10,flexWrap:"wrap"},children:[e.jsxs("div",{style:{fontSize:9,color:ee.inkLight},children:[e.jsx("span",{style:{background:ee.greenBg,padding:"1px 5px",borderRadius:2,fontSize:8},children:"Auto"})," Seccin calculada automticamente por corriente"]}),e.jsxs("div",{style:{fontSize:9,color:ee.inkLight},children:[" V max permitido: ",e.jsxs("strong",{children:[i.dV_max_rama,"%"]})," por circuito (",i.ref,")"]}),e.jsx("div",{style:{fontSize:9,color:ee.inkLight},children:" Resistividad Cu: 0.01786 mm/m  Al: 0.02857 mm/m  T=20C"})]})]})}function wf({pais:t}){const i=qo[t],[o,n]=F.useState("Monofsica"),[a,r]=F.useState(""),[s,d]=F.useState("0.9"),[u,b]=F.useState("1.0"),[j,w]=F.useState(""),[S,m]=F.useState("Cobre"),[x,p]=F.useState("6"),[c,g]=F.useState(""),l=o==="Monofsica"?i.mono_V:i.tri_VLN;o==="Monofsica"?i.mono_V:i.tri_VLL;const f=Number(a)*Number(u)||0,y=s>0?f/Number(s):f,h=l>0&&y>0?y/l:0,v=h*i.FS,A=v>0?Hs(v,t):null,z=v>0?gc(v,S):null,k=Number(c)||z||0,T=Number(j)>0&&h>0&&k>0?uc(Number(j),h,k,S,o,t):null,C=Number(j)>0&&k>0&&Number(x)>0?hc(Number(j),k,S,o,t,Number(x)):null,D=T!==null?T<=i.dV_max_rama:null,K=({label:oe,val:te,unit:P,hi:ie,warn:me})=>e.jsxs("div",{style:{background:ie?ee.ink:me?ee.amberBg:ee.bg,border:`1px solid ${ie?ee.ink:me?ee.amber+"44":ee.border}`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:ie?"rgba(255,255,255,.4)":ee.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:4},children:oe}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:ie?"#fff":me?ee.amber:ee.ink},children:te||""}),P&&e.jsx("div",{style:{fontSize:9,color:ie?"rgba(255,255,255,.4)":ee.inkLight,marginTop:2},children:P})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:ee.inkLight,fontWeight:700},children:"Datos del circuito"}),e.jsx(_a,{pais:t})]}),e.jsx(Wi,{label:"Tipo de red",value:o,onChange:n,options:[{v:"Monofsica",l:`Monofsica (${i.mono_V}V)`},{v:"Trifsica",l:`Trifsica (${i.tri_VLL||""}V)`}]}),e.jsx(Mt,{label:"Potencia total instalada",value:a,onChange:r,unit:"W"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Mt,{label:"Factor de potencia",value:s,onChange:d,step:"0.01",min:"0.5",max:"1"}),e.jsx(Mt,{label:"Factor simultaneidad",value:u,onChange:b,step:"0.1",min:"0.1",max:"1"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Mt,{label:"Longitud circuito",value:j,onChange:w,unit:"m"}),e.jsx(Mt,{label:"Icc en barra (kA)",value:x,onChange:p,step:"0.5"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Wi,{label:"Material conductor",value:S,onChange:m,options:["Cobre","Aluminio"]}),e.jsx(Wi,{label:"Seccin (vaco=auto)",value:c,onChange:g,options:[{v:"",l:"Auto"},...al.map(oe=>({v:oe,l:`${oe} mm`}))]})]})]}),e.jsxs("div",{style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:ee.inkLight,fontWeight:700,marginBottom:14},children:"Resultados"}),h>0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(K,{label:`Potencia activa (${Number(u)})`,val:`${Yt(f)} W`}),e.jsx(K,{label:"Potencia aparente",val:`${Yt(y)} VA`})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(K,{label:`Corriente nominal (${l}V)`,val:`${Yt(h)} A`}),e.jsx(K,{label:`Corriente diseo (${i.FS})`,val:`${Yt(v)} A`})]}),e.jsx(K,{label:"Breaker recomendado",val:`${A} A  Curva ${i.curvas[0]}`,hi:!0}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(K,{label:`Seccin ${c?"manual":"auto (${material})"}`,val:`${k} mm`,warn:c&&Number(c)<(z||0)}),T!==null&&e.jsxs("div",{style:{background:D?ee.greenBg:ee.redBg,border:`1px solid ${D?ee.green:ee.red}33`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:D?ee.green:ee.red,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Cada de tensin"}),e.jsxs("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:D?ee.green:ee.red},children:[Yt(T),"%"]}),e.jsx("div",{style:{fontSize:9,color:D?ee.green:ee.red,marginTop:2},children:D?`  ${i.dV_max_rama}% (${i.ref})`:` Supera ${i.dV_max_rama}% mx`})]})]}),C!==null&&e.jsx(K,{label:"Corriente cortocircuito fin de lnea",val:`${C.toFixed(3)} kA`}),e.jsxs("div",{style:{background:ee.accent,borderRadius:4,padding:"8px 10px",fontSize:10,color:ee.inkMid,lineHeight:1.7,marginTop:4},children:[e.jsxs("strong",{children:["Normativa ",i.flag," ",t,":"]})," ",i.ref,"  FS=",i.FS,"  V_max=",i.dV_max_rama,"% por rama / ",i.dV_max_total,"% total"]})]}):e.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:ee.inkXLight,fontSize:12},children:"Completa los datos para ver resultados"})]})]})}function zf(){const[t,i]=F.useState(""),[o,n]=F.useState("21"),[a,r]=F.useState("normal"),s={14:{ce:280,ag:205,ar:810,gr:960},"17.5":{ce:310,ag:200,ar:790,gr:940},21:{ce:350,ag:195,ar:760,gr:920},28:{ce:400,ag:190,ar:720,gr:880},35:{ce:450,ag:185,ar:680,gr:850}},d=s[o]||s[21],u=Number(t)||0,b=({l:j,val:w,u:S,hi:m})=>e.jsxs("div",{style:{background:m?ee.ink:ee.bg,border:`1px solid ${m?ee.ink:ee.border}`,borderRadius:6,padding:"12px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:9,color:m?"rgba(255,255,255,.4)":ee.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:6},children:j}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:m?"#fff":ee.ink},children:w}),S&&e.jsx("div",{style:{fontSize:9,color:m?"rgba(255,255,255,.4)":ee.inkLight,marginTop:2},children:S})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:ee.inkLight,fontWeight:700,marginBottom:14},children:"Datos ACI 211"}),e.jsx(Mt,{label:"Volumen requerido",value:t,onChange:i,unit:"m"}),e.jsx(Wi,{label:"Resistencia f'c",value:o,onChange:n,options:[{v:"14",l:"14 MPa (2000 PSI)  Ciclpeo"},{v:"17.5",l:"17.5 MPa (2500 PSI)  Cimientos"},{v:"21",l:"21 MPa (3000 PSI)  Estructural"},{v:"28",l:"28 MPa (4000 PSI)  Alta resist."},{v:"35",l:"35 MPa (5000 PSI)  Especial"}]}),e.jsx(Wi,{label:"Tipo de agregado",value:a,onChange:r,options:[{v:"normal",l:"Normal (grava triturada)"},{v:"liviano",l:"Liviano (+8% agua)"}]}),e.jsxs("div",{style:{background:ee.blueBg,border:`1px solid ${ee.blue}22`,borderRadius:5,padding:"10px 12px",marginTop:8},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:ee.blue,marginBottom:4,letterSpacing:1,textTransform:"uppercase"},children:"Dosificacin por m"}),e.jsxs("div",{style:{fontSize:11,color:ee.blue},children:["Ce: ",d.ce," kg  Ag: ",d.ag," L  Ar: ",d.ar," kg  Gr: ",d.gr," kg"]})]})]}),e.jsxs("div",{style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"20px"},children:[e.jsxs("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:ee.inkLight,fontWeight:700,marginBottom:14},children:["Cantidades para ",u||"?"," m"]}),u>0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(b,{l:"Cemento",val:`${(d.ce*u).toFixed(0)} kg`,hi:!0}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(b,{l:"Sacos 50 kg",val:Math.ceil(d.ce*u/50),u:"sacos"}),e.jsx(b,{l:"Agua",val:`${(d.ag*u*(a==="liviano"?1.08:1)).toFixed(0)} L`})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(b,{l:"Arena",val:`${(d.ar*u).toFixed(0)} kg`}),e.jsx(b,{l:"Grava",val:`${(d.gr*u).toFixed(0)} kg`})]})]}):e.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:ee.inkXLight,fontSize:12},children:"Ingresa el volumen"})]})]})}function Ef(){const[t,i]=F.useState("losa"),[o,n]=F.useState(""),[a,r]=F.useState(""),[s,d]=F.useState(""),[u,b]=F.useState(""),[j,w]=F.useState("0.12"),S=F.useMemo(()=>{const x=Number(o)||0,p=Number(a)||0,c=Number(s)||0,g=Number(u)||0,l=Number(j)||0;return t==="losa"?{area:x*p,volumen:x*p*l,perimetro:2*(x+p)}:t==="columna"?{area:x*p,volumen:x*p*c,perimetro:2*(x+p)}:t==="viga"?{area:x*p,volumen:x*p*c,perimetro:2*(x+p)}:t==="cilindro"?{area:Math.PI*g*g,volumen:Math.PI*g*g*c,perimetro:2*Math.PI*g}:t==="muro"?{area:x*c,volumen:x*c*l,perimetro:2*(x+c)}:{area:0,volumen:0,perimetro:0}},[t,o,a,s,u,j]),m=({l:x,val:p,u:c,hi:g})=>e.jsxs("div",{style:{background:g?ee.ink:ee.bg,border:`1px solid ${g?ee.ink:ee.border}`,borderRadius:6,padding:"12px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:9,color:g?"rgba(255,255,255,.4)":ee.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:6},children:x}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:g?"#fff":ee.ink},children:p||""}),c&&e.jsx("div",{style:{fontSize:9,color:g?"rgba(255,255,255,.4)":ee.inkLight,marginTop:2},children:c})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:ee.inkLight,fontWeight:700,marginBottom:14},children:"Elemento estructural"}),e.jsx(Wi,{label:"Tipo",value:t,onChange:i,options:[{v:"losa",l:"Losa / Placa"},{v:"columna",l:"Columna"},{v:"viga",l:"Viga"},{v:"cilindro",l:"Pilote / Cilindro"},{v:"muro",l:"Muro / Pared"}]}),t!=="cilindro"&&e.jsx(Mt,{label:t==="muro"?"Longitud":"Ancho (a)",value:o,onChange:n,unit:"m"}),t==="losa"&&e.jsx(Mt,{label:"Largo (b)",value:a,onChange:r,unit:"m"}),(t==="columna"||t==="viga")&&e.jsx(Mt,{label:"Ancho (b)",value:a,onChange:r,unit:"m"}),t==="cilindro"&&e.jsx(Mt,{label:"Radio",value:u,onChange:b,unit:"m"}),t!=="losa"&&e.jsx(Mt,{label:"Altura / Longitud",value:s,onChange:d,unit:"m"}),(t==="losa"||t==="muro")&&e.jsx(Mt,{label:t==="losa"?"Espesor":"Ancho muro",value:j,onChange:w,unit:"m"})]}),e.jsxs("div",{style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:ee.inkLight,fontWeight:700,marginBottom:14},children:"Resultados"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(m,{l:"rea",val:S.area>0?`${S.area.toFixed(3)}`:"",u:"m",hi:!0}),e.jsx(m,{l:"Volumen",val:S.volumen>0?`${S.volumen.toFixed(4)}`:"",u:"m"}),e.jsx(m,{l:"Permetro",val:S.perimetro>0?`${S.perimetro.toFixed(2)}`:"",u:"m"}),S.volumen>0&&e.jsxs("div",{style:{background:ee.greenBg,border:`1px solid ${ee.green}22`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:ee.green,fontWeight:700,letterSpacing:1,textTransform:"uppercase",marginBottom:4},children:"Concreto estimado (f'c=21MPa +10%)"}),e.jsxs("div",{className:"mono",style:{fontSize:13,fontWeight:700,color:ee.green},children:[(S.volumen*1.1*350).toFixed(0)," kg cemento  ",Math.ceil(S.volumen*1.1*350/50)," sacos"]})]})]})]})]})}function Af(){const[t,i]=xn("hab:herr:materiales",[]),[o,n]=F.useState({nombre:"",unidad:"m",cantidad:"",precioUnit:""}),a=(u,b)=>n(j=>({...j,[u]:b})),r=()=>{!o.nombre||!o.cantidad||!o.precioUnit||(i(u=>[...u,{...o,id:Date.now(),sub:Number(o.cantidad)*Number(o.precioUnit)}]),n({nombre:"",unidad:"m",cantidad:"",precioUnit:""}))},s=u=>i(b=>b.filter(j=>j.id!==u)),d=t.reduce((u,b)=>u+b.sub,0);return e.jsxs("div",{className:"fade-up",style:{maxWidth:900},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr auto",gap:8,marginBottom:12,background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"14px 16px",alignItems:"end"},children:[e.jsx(Mt,{label:"Material / tem",value:o.nombre,onChange:u=>a("nombre",u),type:"text",placeholder:"Ej. Concreto f'c=21MPa"}),e.jsx(Wi,{label:"Unidad",value:o.unidad,onChange:u=>a("unidad",u),options:["m","m","ml","kg","und","gl","m"]}),e.jsx(Mt,{label:"Cantidad",value:o.cantidad,onChange:u=>a("cantidad",u)}),e.jsx(Mt,{label:"Precio unitario",value:o.precioUnit,onChange:u=>a("precioUnit",u)}),e.jsx("div",{style:{paddingBottom:0},children:e.jsx("button",{onClick:r,style:{padding:"9px 16px",background:ee.ink,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:12,fontWeight:700,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",height:36},children:"+ Aadir"})})]}),t.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:ee.inkXLight,fontSize:12,background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8},children:"Aade materiales para calcular"}):e.jsx("div",{style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:ee.bg,borderBottom:`2px solid ${ee.border}`},children:["Material","Unidad","Cantidad","Precio Unit.","Subtotal",""].map(u=>e.jsx("th",{style:{padding:"9px 12px",textAlign:"left",fontSize:9,letterSpacing:1,textTransform:"uppercase",color:ee.inkLight,fontWeight:700},children:u},u))})}),e.jsx("tbody",{children:t.map(u=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ee.border}`},children:[e.jsx("td",{style:{padding:"10px 12px",fontWeight:500},children:u.nombre}),e.jsx("td",{style:{padding:"10px 12px",color:ee.inkMid},children:u.unidad}),e.jsx("td",{style:{padding:"10px 12px"},className:"mono",children:Number(u.cantidad).toLocaleString()}),e.jsx("td",{style:{padding:"10px 12px"},className:"mono",children:Qa(Number(u.precioUnit))}),e.jsx("td",{style:{padding:"10px 12px",fontWeight:700},className:"mono",children:Qa(u.sub)}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("button",{onClick:()=>s(u.id),style:{background:"none",border:"none",cursor:"pointer",color:ee.red,fontSize:16},children:""})})]},u.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:ee.ink},children:[e.jsx("td",{colSpan:4,style:{padding:"12px",fontSize:11,fontWeight:700,color:"rgba(255,255,255,.5)",textTransform:"uppercase",letterSpacing:1},children:"Total presupuesto de materiales"}),e.jsx("td",{style:{padding:"12px"},className:"mono",children:e.jsx("span",{style:{fontSize:16,fontWeight:800,color:"#fff"},children:Qa(d)})}),e.jsx("td",{})]})})]})})]})}const Za=[{id:"oficina_gral",lbl:"Oficina general",luxCO:500,luxES:500,veei:3,ugr:19,ra:80,cat:"Oficinas"},{id:"oficina_tec",lbl:"Oficina tcnica / Dibujo",luxCO:750,luxES:750,veei:3,ugr:16,ra:80,cat:"Oficinas"},{id:"sala_reuniones",lbl:"Sala de reuniones",luxCO:300,luxES:500,veei:3,ugr:19,ra:80,cat:"Oficinas"},{id:"recepcion",lbl:"Recepcin / Lobby",luxCO:300,luxES:300,veei:3.5,ugr:22,ra:80,cat:"Oficinas"},{id:"archivo",lbl:"Archivo / Bodega oficina",luxCO:200,luxES:200,veei:4,ugr:25,ra:60,cat:"Oficinas"},{id:"sala_estar",lbl:"Sala de estar",luxCO:150,luxES:200,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"dormitorio",lbl:"Dormitorio",luxCO:100,luxES:150,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"cocina_res",lbl:"Cocina residencial",luxCO:300,luxES:300,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"bano",lbl:"Bao",luxCO:200,luxES:200,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"circulacion",lbl:"Circulacin / Pasillo",luxCO:100,luxES:100,veei:7.5,ugr:25,ra:80,cat:"Residencial"},{id:"escalera",lbl:"Escaleras",luxCO:150,luxES:150,veei:4,ugr:25,ra:80,cat:"Residencial"},{id:"garaje",lbl:"Garaje / Parqueadero",luxCO:75,luxES:75,veei:5,ugr:25,ra:40,cat:"Residencial"},{id:"aula",lbl:"Aula de clase",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"laboratorio",lbl:"Laboratorio",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"biblioteca",lbl:"Biblioteca / Lectura",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"comercio",lbl:"Comercio general",luxCO:300,luxES:300,veei:5,ugr:22,ra:80,cat:"Comercio"},{id:"supermercado",lbl:"Supermercado",luxCO:500,luxES:500,veei:5,ugr:22,ra:80,cat:"Comercio"},{id:"restaurante",lbl:"Restaurante",luxCO:200,luxES:200,veei:8,ugr:22,ra:80,cat:"Comercio"},{id:"hospital",lbl:"Hospital  general",luxCO:300,luxES:300,veei:4,ugr:19,ra:80,cat:"Salud"},{id:"consultorio",lbl:"Consultorio mdico",luxCO:500,luxES:500,veei:4,ugr:19,ra:90,cat:"Salud"},{id:"quirofano",lbl:"Quirfano",luxCO:1e3,luxES:1e3,veei:4,ugr:19,ra:90,cat:"Salud"},{id:"nave_ind",lbl:"Nave industrial general",luxCO:300,luxES:300,veei:4,ugr:25,ra:60,cat:"Industrial"},{id:"ind_fina",lbl:"Industria  trabajo fino",luxCO:500,luxES:500,veei:4,ugr:22,ra:80,cat:"Industrial"},{id:"almacen",lbl:"Almacn / Depsito",luxCO:150,luxES:100,veei:5,ugr:25,ra:60,cat:"Industrial"},{id:"ext_acera",lbl:"Acera / Andn exterior",luxCO:20,luxES:20,veei:null,ugr:null,ra:20,cat:"Exterior"},{id:"ext_parqueo",lbl:"Parqueadero exterior",luxCO:50,luxES:50,veei:null,ugr:null,ra:20,cat:"Exterior"}],es=[{id:"panel_40w",lbl:"Panel LED 6060  40W",w:40,lm:4e3,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"panel_36w",lbl:"Panel LED 6060  36W",w:36,lm:3600,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"panel_24w",lbl:"Panel LED 3030  24W",w:24,lm:2400,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"down_18w",lbl:"Downlight LED 20  18W",w:18,lm:1800,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"down_12w",lbl:"Downlight LED 15  12W",w:12,lm:1200,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"down_9w",lbl:"Downlight LED 12  9W",w:9,lm:900,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"tubo_18w",lbl:"Tubo LED T8 120cm  18W",w:18,lm:2e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"tubo_9w",lbl:"Tubo LED T8 60cm  9W",w:9,lm:1e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"regleta_36w",lbl:"Regleta 2T8 LED  36W",w:36,lm:4e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"campana_100w",lbl:"Campana LED industrial  100W",w:100,lm:13e3,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"campana_150w",lbl:"Campana LED industrial  150W",w:150,lm:2e4,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"campana_200w",lbl:"Campana LED industrial  200W",w:200,lm:26e3,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"aplique_12w",lbl:"Aplique de pared  12W",w:12,lm:1e3,tipo:"Aplique",temp:"3000K",vida:3e4,irc:80},{id:"plafon_24w",lbl:"Plafn LED 30  24W",w:24,lm:2200,tipo:"Adosado",temp:"4000K",vida:4e4,irc:80},{id:"plafon_18w",lbl:"Plafn LED 25  18W",w:18,lm:1600,tipo:"Adosado",temp:"4000K",vida:4e4,irc:80},{id:"spot_9w",lbl:"Spot LED GU10  9W",w:9,lm:800,tipo:"Spot",temp:"3000K",vida:25e3,irc:80},{id:"lineal_20w",lbl:"Perfil lineal LED  20W/m",w:20,lm:2200,tipo:"Lineal",temp:"4000K",vida:5e4,irc:90}];function Ql(t,i,o){const n=Math.min(.95,.25+.35*Math.log10(1+t)),a=1+(i-.5)*.15+(o-.3)*.1;return Math.min(.9,Math.max(.2,n*a))}function Ff({pais:t}){const[i,o]=F.useState(!1),[n,a]=F.useState("oficina_gral"),[r,s]=F.useState("5"),[d,u]=F.useState("4"),[b,j]=F.useState("2.8"),[w,S]=F.useState("0.85"),[m,x]=F.useState("0"),[p,c]=F.useState("0.7"),[g,l]=F.useState("0.5"),[f,y]=F.useState("0.2"),[h,v]=F.useState("panel_40w"),[A,z]=F.useState("0.8"),k=Za.find(te=>te.id===n),T=es.find(te=>te.id===h),C=F.useMemo(()=>{if(!k||!T)return null;const te=+r,P=+d,ie=+b,me=+w,Q=+m,je=+A;if(te<=0||P<=0||ie<=0)return null;const re=t==="CO"?k.luxCO:k.luxES,J=te*P,M=ie-me-Q;if(M<=0)return null;const B=te*P/(M*(te+P)),V=Ql(B,+p,+g),X=re*J/(V*je),R=Math.ceil(X/T.lm),W=Math.max(1,R),se=te/P;let le=Math.round(Math.sqrt(W/se)),de=Math.ceil(W/Math.max(1,le));le<1&&(le=1),de*le<W&&de++;const Z=de*le,ue=Z*T.lm*V*je/J,N=te/de,G=P/le,L=Z*T.w,ae=L/J,pe=ue>0?L*100/(J*ue):0,he=Math.min(.95,.4+.3*V+.1*(B>2?1:B/2)),ze=ue>=re,q=k.veei?pe<=k.veei:!0,I=T.irc>=k.ra,$=he>=.6,H=Math.max(N,G)<=1.5*M;return{luxReq:re,S:J,h:M,K:B,CU:V,flujoTotal:X,nCalc:W,nReal:Z,rows:de,cols:le,luxReal:ue,distL:N,distA:G,potTotal:L,dpea:ae,veei:pe,unifEst:he,luxOk:ze,veeiOk:q,ircOk:I,unifOk:$,distMaxOk:H,allOk:ze&&q&&I&&$&&H}},[n,r,d,b,w,m,p,g,A,h,t,k,T]),D=F.useMemo(()=>{if(!k)return[];const te=+r,P=+d,ie=+b,me=+w,Q=+m,je=+A;if(te<=0||P<=0||ie<=0)return[];const re=t==="CO"?k.luxCO:k.luxES,J=te*P,M=ie-me-Q;if(M<=0)return[];const B=te*P/(M*(te+P)),V=Ql(B,+p,+g),X=[];return es.forEach(R=>{if(R.irc<k.ra)return;const W=re*J/(V*je),se=Math.ceil(W/R.lm),le=Math.max(1,se),de=te/P;let Z=Math.round(Math.sqrt(le/de)),ue=Math.ceil(le/Math.max(1,Z));Z<1&&(Z=1),ue*Z<le&&ue++;const N=ue*Z,G=N*R.lm*V*je/J,L=te/ue,ae=P/Z,pe=N*R.w,he=G>0?pe*100/(J*G):0,ze=Math.min(.95,.4+.3*V+.1*(B>2?1:B/2)),q=G>=re,I=k.veei?he<=k.veei:!0,$=ze>=.6,H=Math.max(L,ae)<=1.5*M;if(!(q&&I&&$&&H))return;const _=R.lm/R.w,ce=pe/J;X.push({lumOp:R,nReal:N,rows:ue,cols:Z,luxReal:Math.round(G),potTotal:pe,dpea:ce.toFixed(1),veei:he.toFixed(2),eficacia:_.toFixed(0),distL:L.toFixed(2),distA:ae.toFixed(2)})}),X.sort((R,W)=>R.potTotal-W.potTotal),X.slice(0,5)},[n,r,d,b,w,m,p,g,A,t,k]),K=te=>{v(te.lumOp.id)},oe={background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:16,marginBottom:12,boxShadow:ee.shadow};return e.jsxs("div",{className:"fade-up",style:{maxWidth:1100},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsxs("button",{onClick:()=>o(!i),style:{padding:"6px 14px",border:`1px solid ${ee.border}`,borderRadius:4,background:i?ee.blueBg:"#fff",color:i?ee.blue:ee.inkLight,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" ",i?"Ocultar":"Ver"," tabla normativa  ",t==="CO"?"RETILAP":"UNE 12464-1"]}),e.jsx(_a,{pais:t})]}),i&&e.jsx("div",{style:{...oe,background:ee.blueBg,maxHeight:220,overflowY:"auto",marginBottom:16},children:e.jsxs("table",{style:{width:"100%",fontSize:9},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"rgba(30,79,140,.06)"},children:["Cat.","Espacio","Lux mn (CO)","Lux mn (ES)","UGR mx","Ra mn","VEEI lm"].map(te=>e.jsx("th",{style:{padding:"4px 8px",textAlign:"left",fontWeight:700,color:ee.blue,borderBottom:`1px solid ${ee.blue}33`},children:te},te))})}),e.jsx("tbody",{children:Za.map(te=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ee.border}`,background:te.id===n?"rgba(30,79,140,.08)":"transparent"},children:[e.jsx("td",{style:{padding:"3px 8px",color:ee.inkLight},children:te.cat}),e.jsx("td",{style:{padding:"3px 8px",fontWeight:te.id===n?700:400},children:te.lbl}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:te.luxCO}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:te.luxES}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:te.ugr??""}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:te.ra}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:te.veei??"N/A"})]},te.id))})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:oe,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Tipo de espacio"}),e.jsx(Wi,{value:n,onChange:a,options:Object.entries(Za.reduce((te,P)=>((te[P.cat]=te[P.cat]||[]).push(P),te),{})).flatMap(([te,P])=>[{v:"__"+te,l:` ${te} `},...P.map(ie=>({v:ie.id,l:`${ie.lbl}  ${t==="CO"?ie.luxCO:ie.luxES} lux`}))])}),k&&e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,fontSize:9},children:[e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:ee.amberBg,color:ee.amber,fontWeight:700},children:["Req: ",t==="CO"?k.luxCO:k.luxES," lux"]}),e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:ee.accent,color:ee.inkMid},children:["UGR  ",k.ugr??""]}),e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:ee.accent,color:ee.inkMid},children:["Ra  ",k.ra]}),k.veei&&e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:ee.accent,color:ee.inkMid},children:["VEEI  ",k.veei]})]})]}),e.jsxs("div",{style:oe,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Dimensiones (m)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[e.jsx(Mt,{label:"Largo",value:r,onChange:s,step:"0.1",min:"0.1"}),e.jsx(Mt,{label:"Ancho",value:d,onChange:u,step:"0.1",min:"0.1"}),e.jsx(Mt,{label:"Alto total",value:b,onChange:j,step:"0.1",min:"0.5"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Mt,{label:"Plano de trabajo",value:w,onChange:S,step:"0.05",unit:"m"}),e.jsx(Mt,{label:"Suspensin luminaria",value:m,onChange:x,step:"0.05",unit:"m"})]})]}),e.jsxs("div",{style:oe,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Reflectancias"}),[["Techo",p,c],["Paredes",g,l],["Suelo",f,y]].map(([te,P,ie])=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx("span",{style:{fontSize:10,width:55,fontWeight:500},children:te}),e.jsx("input",{type:"range",min:.1,max:.9,step:.05,value:P,onChange:me=>ie(me.target.value),style:{flex:1,accentColor:ee.blue}}),e.jsxs("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:ee.blue,minWidth:30},children:[(P*100).toFixed(0),"%"]})]},te)),e.jsx("div",{style:{fontSize:8,color:ee.inkLight},children:"Techo blanco  70%  Pared clara  50%  Suelo oscuro  20%"})]}),e.jsxs("div",{style:oe,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Luminaria"}),e.jsx(Wi,{value:h,onChange:v,options:Object.entries(es.reduce((te,P)=>((te[P.tipo]=te[P.tipo]||[]).push(P),te),{})).flatMap(([te,P])=>[{v:"__"+te,l:` ${te} `},...P.map(ie=>({v:ie.id,l:`${ie.lbl}  ${ie.lm}lm`}))])}),T&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6,marginTop:8,fontSize:9},children:[{l:"Flujo",v:`${T.lm} lm`},{l:"Potencia",v:`${T.w} W`},{l:"Eficacia",v:`${Math.round(T.lm/T.w)} lm/W`},{l:"IRC",v:`${T.irc}`}].map(te=>e.jsxs("div",{style:{background:ee.bg,padding:"5px 8px",borderRadius:4,textAlign:"center"},children:[e.jsx("div",{className:"mono",style:{fontWeight:700,color:ee.blue},children:te.v}),e.jsx("div",{style:{color:ee.inkLight,fontSize:8},children:te.l})]},te.l))}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:9,color:ee.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Factor de mantenimiento (Cm)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"range",min:.5,max:1,step:.05,value:A,onChange:te=>z(te.target.value),style:{flex:1,accentColor:ee.blue}}),e.jsx("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:ee.blue,minWidth:24},children:A})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:8,color:ee.inkXLight},children:[e.jsx("span",{children:"Sucio 0.5"}),e.jsx("span",{children:"Limpio 1.0"})]})]})]})]}),e.jsx("div",{children:C?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{...oe,background:C.allOk?ee.greenBg:ee.redBg,border:`1px solid ${C.allOk?ee.green:ee.red}33`,textAlign:"center",padding:20},children:[e.jsx("div",{style:{fontSize:28,fontWeight:800,color:C.allOk?ee.green:ee.red},children:C.allOk?" CUMPLE":" NO CUMPLE"}),e.jsx("div",{style:{fontSize:10,color:ee.inkMid,marginTop:2},children:t==="CO"?"RETILAP  Res. 181331/2009":"CTE DB-HE3 / UNE-EN 12464-1"})]}),!C.allOk&&D.length>0&&e.jsxs("div",{style:{...oe,background:"#FFFBE6",border:"1px solid #E6D44D55",padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#8C6A00",marginBottom:8},children:" Soluciones que S cumplen normativa"}),e.jsx("div",{style:{fontSize:9,color:ee.inkMid,marginBottom:8},children:'Haz clic en "Aplicar" para usar esa opcin automticamente'}),D.slice(0,3).map((te,P)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 10px",background:P===0?"#E8F4EE":"#fff",border:`1px solid ${P===0?ee.green+"44":ee.border}`,borderRadius:6,marginBottom:4},children:[P===0&&e.jsx("span",{style:{fontSize:14},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:P===0?ee.green:ee.ink},children:te.lumOp.lbl}),e.jsxs("div",{style:{fontSize:8,color:ee.inkMid},children:[te.nReal," uds (",te.rows,"",te.cols,")  ",te.luxReal," lux  ",te.potTotal,"W total  VEEI ",te.veei,"  ",te.eficacia," lm/W"]})]}),e.jsx("button",{onClick:()=>K(te),style:{padding:"4px 12px",background:P===0?ee.green:"#fff",color:P===0?"#fff":ee.blue,border:P===0?"none":`1px solid ${ee.blue}`,borderRadius:4,fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap"},children:"Aplicar"})]},te.lumOp.id))]}),C.allOk&&D.length>1&&e.jsxs("div",{style:{...oe,background:ee.blueBg,border:`1px solid ${ee.blue}22`,padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:ee.blue,marginBottom:6},children:" Se puede optimizar?"}),D.filter(te=>te.lumOp.id!==h).slice(0,2).map(te=>{const P=C.potTotal-te.potTotal;return P>0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",background:"#fff",border:`1px solid ${ee.border}`,borderRadius:5,marginBottom:3},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600},children:te.lumOp.lbl}),e.jsxs("div",{style:{fontSize:8,color:ee.inkMid},children:[te.nReal," uds  ",te.luxReal," lux  ",te.potTotal,"W",e.jsxs("span",{style:{color:ee.green,fontWeight:700,marginLeft:4},children:[" Ahorra ",P,"W"]})]})]}),e.jsx("button",{onClick:()=>K(te),style:{padding:"3px 10px",background:"#fff",color:ee.blue,border:`1px solid ${ee.blue}`,borderRadius:3,fontSize:8,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cambiar"})]},te.lumOp.id):null})]}),!C.allOk&&D.length===0&&e.jsxs("div",{style:{...oe,background:ee.redBg,border:`1px solid ${ee.red}33`,padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:ee.red,marginBottom:4},children:" Ninguna luminaria del catlogo cumple"}),e.jsx("div",{style:{fontSize:9,color:ee.inkMid},children:"Prueba a: aumentar reflectancias, reducir altura de suspensin, o el espacio requiere una luminaria de mayor flujo no incluida en el catlogo."})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:12},children:[{l:"Luminarias",v:C.nReal,u:`${C.rows}${C.cols}`,ok:!0},{l:"Iluminacin",v:Math.round(C.luxReal),u:`lux (req: ${C.luxReq})`,ok:C.luxOk},{l:"Potencia total",v:C.potTotal,u:"W",ok:!0},{l:"DPEA",v:C.dpea.toFixed(1),u:"W/m",ok:!0},{l:"VEEI",v:C.veei.toFixed(2),u:`W/m100lx${k!=null&&k.veei?` (lm: ${k.veei})`:""}`,ok:C.veeiOk},{l:"Superficie",v:C.S.toFixed(1),u:"m",ok:!0}].map(te=>e.jsxs("div",{style:{background:ee.surface,border:`1px solid ${te.ok?ee.border:ee.red}`,borderRadius:6,padding:"10px 12px",boxShadow:ee.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:te.ok?ee.inkLight:ee.red,textTransform:"uppercase",letterSpacing:.5},children:te.l}),e.jsx("div",{className:"mono",style:{fontSize:20,fontWeight:800,color:te.ok?ee.ink:ee.red,marginTop:2},children:te.v}),e.jsx("div",{style:{fontSize:8,color:ee.inkLight},children:te.u})]},te.l))}),e.jsxs("div",{style:oe,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Verificaciones normativas"}),[{l:`Iluminacin  ${C.luxReq} lux`,v:`${Math.round(C.luxReal)} lux`,ok:C.luxOk},{l:`VEEI  ${(k==null?void 0:k.veei)??"N/A"}`,v:k!=null&&k.veei?C.veei.toFixed(2):"N/A",ok:C.veeiOk},{l:`IRC  ${k==null?void 0:k.ra}`,v:`${T==null?void 0:T.irc}`,ok:C.ircOk},{l:"Uniformidad  0.6",v:C.unifEst.toFixed(2),ok:C.unifOk},{l:`Dist. luminarias  ${(1.5*C.h).toFixed(2)}m`,v:`${Math.max(C.distL,C.distA).toFixed(2)}m`,ok:C.distMaxOk}].map(te=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"5px 0",borderBottom:`1px solid ${ee.accent}`},children:[e.jsx("span",{style:{fontSize:13},children:te.ok?"":""}),e.jsx("span",{style:{flex:1,fontSize:10,fontWeight:500},children:te.l}),e.jsx("span",{className:"mono",style:{fontSize:10,fontWeight:700,color:te.ok?ee.green:ee.red},children:te.v})]},te.l))]}),e.jsxs("div",{style:oe,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Memoria de clculo"}),e.jsx("div",{style:{fontSize:9,lineHeight:2,color:ee.inkMid},children:[["Superficie (S)",`${r}  ${d} = ${C.S.toFixed(1)} m`],["Altura til (h)",`${b}  ${w}  ${m} = ${C.h.toFixed(2)} m`],["ndice local (K)",`(${r}${d}) / (${C.h.toFixed(2)}(${r}+${d})) = ${C.K.toFixed(2)}`],["Coef. utilizacin",`CU = ${C.CU.toFixed(3)} (t=${(p*100).toFixed(0)}%, p=${(g*100).toFixed(0)}%)`],["Flujo necesario",`(${C.luxReq}${C.S.toFixed(1)})/(${C.CU.toFixed(3)}${A}) = ${Math.round(C.flujoTotal).toLocaleString()} lm`],["N luminarias",`${Math.round(C.flujoTotal).toLocaleString()} / ${T.lm.toLocaleString()}  ${C.nCalc}  ${C.nReal} ud (${C.rows}${C.cols})`],["Separacin",`Largo: ${C.distL.toFixed(2)}m  Ancho: ${C.distA.toFixed(2)}m`]].map(([te,P])=>e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("span",{style:{fontWeight:700,color:ee.ink,minWidth:130},children:[te,":"]}),e.jsx("span",{className:"mono",style:{fontWeight:500},children:P})]},te))})]}),e.jsxs("div",{style:oe,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Disposicin en planta"}),e.jsxs("div",{style:{position:"relative",background:ee.bg,border:`2px solid ${ee.border}`,borderRadius:4,width:"100%",aspectRatio:`${r}/${d}`,maxHeight:200,overflow:"hidden"},children:[e.jsxs("div",{style:{position:"absolute",top:2,left:"50%",transform:"translateX(-50%)",fontSize:8,color:ee.inkLight},className:"mono",children:[r,"m"]}),e.jsxs("div",{style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%) rotate(90deg)",fontSize:8,color:ee.inkLight},className:"mono",children:[d,"m"]}),Array.from({length:C.rows},(te,P)=>Array.from({length:C.cols},(ie,me)=>{const Q=(me+.5)/C.cols*100,je=(P+.5)/C.rows*100;return e.jsx("div",{style:{position:"absolute",left:`${Q}%`,top:`${je}%`,transform:"translate(-50%,-50%)",width:12,height:12,borderRadius:"50%",background:"radial-gradient(circle,#FFD600 30%,#FFD60044 100%)",border:"2px solid #FFC107",boxShadow:"0 0 6px #FFD60055"}},`${P}-${me}`)}))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:16,marginTop:6,fontSize:8,color:ee.inkLight},children:[e.jsxs("span",{children:[C.rows,"",C.cols," = ",C.nReal," luminarias"]}),e.jsxs("span",{children:["Sep: ",C.distL.toFixed(2),"m  ",C.distA.toFixed(2),"m"]})]})]})]}):e.jsxs("div",{style:{...oe,textAlign:"center",padding:40,color:ee.inkLight},children:[e.jsx(Ed,{size:32,style:{opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600},children:"Completa los datos para ver el clculo"})]})})]})]})}function Tf(){const[t,i]=F.useState("longitud"),[o,n]=F.useState("m"),[a,r]=F.useState("ft"),[s,d]=F.useState(""),u={longitud:{l:"Longitud",u:{m:1,cm:.01,mm:.001,km:1e3,ft:.3048,in:.0254,yd:.9144}},area:{l:"rea",u:{"m":1,"cm":1e-4,"km":1e6,"ft":.092903,"in":64516e-8,ha:1e4,ac:4046.86}},volumen:{l:"Volumen",u:{"m":1,"cm":1e-6,l:.001,ml:1e-6,gal:.00378541,"ft":.0283168}},peso:{l:"Masa",u:{kg:1,g:.001,t:1e3,lb:.453592,oz:.0283495}},temperatura:{l:"Temperatura",special:!0},presion:{l:"Presin",u:{Pa:1,kPa:1e3,MPa:1e6,"kgf/cm":98066.5,PSI:6894.76,bar:1e5}}},b=u[t],j=b!=null&&b.u?Object.keys(b.u):["C","F","K"],w=(x,p,c)=>{let g;return p==="C"?g=x:p==="F"?g=(x-32)*5/9:g=x-273.15,c==="C"?g:c==="F"?g*9/5+32:g+273.15},S=F.useMemo(()=>{const x=Number(s);if(isNaN(x)||!s)return null;if(t==="temperatura")return w(x,o,a).toFixed(4);const p=(b==null?void 0:b.u)||{};return!p[o]||!p[a]?null:(x*p[o]/p[a]).toFixed(8).replace(/\.?0+$/,"")},[s,o,a,t]),m=x=>{var c;i(x);const p=(c=u[x])!=null&&c.u?Object.keys(u[x].u):["C","F","K"];n(p[0]||""),r(p[1]||""),d("")};return e.jsxs("div",{className:"fade-up",style:{maxWidth:620},children:[e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:16},children:Object.entries(u).map(([x,p])=>e.jsx("button",{onClick:()=>m(x),style:{padding:"6px 14px",border:`1px solid ${t===x?ee.ink:ee.border}`,borderRadius:20,background:t===x?ee.ink:"transparent",color:t===x?"#fff":ee.inkMid,fontSize:11,fontWeight:t===x?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:p.l},x))}),e.jsxs("div",{style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"24px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 50px 1fr",gap:10,alignItems:"end",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:ee.inkLight,textTransform:"uppercase",letterSpacing:.8,fontWeight:700,marginBottom:5},children:"De"}),e.jsx("select",{value:o,onChange:x=>n(x.target.value),style:{width:"100%",padding:"9px 10px",border:`1.5px solid ${ee.border}`,borderRadius:4,fontSize:12,background:ee.surface},children:j.map(x=>e.jsx("option",{children:x},x))})]}),e.jsx("div",{style:{textAlign:"center",fontSize:18,color:ee.inkXLight,paddingBottom:4},children:""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:ee.inkLight,textTransform:"uppercase",letterSpacing:.8,fontWeight:700,marginBottom:5},children:"A"}),e.jsx("select",{value:a,onChange:x=>r(x.target.value),style:{width:"100%",padding:"9px 10px",border:`1.5px solid ${ee.border}`,borderRadius:4,fontSize:12,background:ee.surface},children:j.map(x=>e.jsx("option",{children:x},x))})]})]}),e.jsx(Mt,{label:"Valor",value:s,onChange:d,placeholder:"Ingresa el valor..."}),S!==null?e.jsxs("div",{style:{background:ee.ink,borderRadius:6,padding:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:"rgba(255,255,255,.4)",marginBottom:6},children:[s," ",o," ="]}),e.jsx("div",{className:"mono",style:{fontSize:28,fontWeight:800,color:"#fff"},children:S}),e.jsx("div",{style:{fontSize:14,color:"rgba(255,255,255,.4)",marginTop:4},children:a})]}):e.jsx("div",{style:{textAlign:"center",padding:"20px 0",color:ee.inkXLight,fontSize:12},children:"Ingresa un valor"})]})]})}function Bf(){var r,s;const[t,i]=F.useState("dashboard"),[o,n]=xn("hab:config:pais","CO"),a=qo[o];return e.jsxs(e.Fragment,{children:[e.jsx(Sf,{}),e.jsxs("div",{style:{minHeight:"100vh",background:ee.bg,fontFamily:"'DM Sans',sans-serif"},children:[e.jsxs("div",{style:{background:ee.ink,padding:"14px 28px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:800,letterSpacing:2,textTransform:"uppercase",color:"#fff"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,.3)",letterSpacing:1},children:"Herramientas Tcnicas"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.4)"},children:"Normativa:"}),e.jsx("div",{style:{display:"flex",background:"rgba(255,255,255,.08)",borderRadius:4,overflow:"hidden",border:"1px solid rgba(255,255,255,.12)"},children:["CO","ES"].map(d=>e.jsxs("button",{onClick:()=>n(d),style:{padding:"6px 14px",border:"none",background:o===d?"#fff":"transparent",color:o===d?ee.ink:"rgba(255,255,255,.5)",fontSize:11,fontWeight:o===d?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:5,transition:"all .12s"},children:[e.jsx("span",{style:{fontSize:13},children:d==="CO"?"":""}),d==="CO"?"Colombia":"Espaa"]},d))}),e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.35)"},children:a.ref})]})]}),e.jsx("div",{style:{background:ee.surface,borderBottom:`1px solid ${ee.border}`,display:"flex",overflowX:"auto",scrollbarWidth:"none",paddingLeft:16},children:Pr.map(d=>{const u=t===d.id;return e.jsxs("button",{onClick:()=>i(d.id),style:{display:"flex",alignItems:"center",gap:6,padding:"12px 16px",border:"none",background:"transparent",flexShrink:0,borderBottom:u?`2px solid ${ee.ink}`:"2px solid transparent",color:u?ee.ink:ee.inkLight,fontSize:11,fontWeight:u?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",letterSpacing:.2,transition:"color .1s"},children:[e.jsx(d.I,{size:12}),d.label]},d.id)})}),e.jsxs("div",{style:{padding:"24px 28px 60px"},children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:18,fontWeight:800,color:ee.ink,letterSpacing:-.2},children:(r=Pr.find(d=>d.id===t))==null?void 0:r.label}),e.jsx("p",{style:{fontSize:11,color:ee.inkLight,marginTop:2},children:(s=Pr.find(d=>d.id===t))==null?void 0:s.desc})]}),e.jsx(_a,{pais:o})]}),t==="dashboard"&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:14},children:Pr.filter(d=>d.id!=="dashboard").map(d=>e.jsxs("div",{onClick:()=>i(d.id),style:{background:ee.surface,border:`1px solid ${ee.border}`,borderRadius:8,padding:"20px 18px",cursor:"pointer",boxShadow:ee.shadow,transition:"all .15s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx(d.I,{size:18,color:ee.ink}),e.jsx("div",{style:{fontSize:14,fontWeight:700},children:d.label})]}),e.jsx("div",{style:{fontSize:10,color:ee.inkLight,lineHeight:1.5},children:d.desc})]},d.id))}),t==="cuadro"&&e.jsx(kf,{pais:o}),t==="circuito"&&e.jsx(wf,{pais:o}),t==="iluminacion"&&e.jsx(Ff,{pais:o}),t==="concreto"&&e.jsx(zf,{}),t==="cubicacion"&&e.jsx(Ef,{}),t==="materiales"&&e.jsx(Af,{}),t==="unidades"&&e.jsx(Tf,{})]})]})]})}const Me={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",border:"#E0E0E0",borderMid:"#D5D2CC",accent:"#EDEBE7",accentBg:"#FFFFFF",success:"#111111",successBg:"#E8F4EE",warning:"#8C6A00",warningBg:"#FFF8E7",danger:"#B91C1C",dangerBg:"#FAE8E8",info:"#3B3B3B",infoBg:"#F0F0F0",sidebar:"#111",sidebarHover:"#222"},Zl=()=>Math.random().toString(36).slice(2,11)+Date.now().toString(36),ts=()=>new Date().toISOString().split("T")[0],en={get:async t=>{try{const i=await window.storage.get(t);return i?JSON.parse(i.value):null}catch{return null}},set:async(t,i)=>{try{await window.storage.set(t,JSON.stringify(i))}catch{}}},tn={items:"hab:logistica:items",proveedores:"hab:logistica:proveedores",cotizaciones:"hab:logistica:cotizaciones"},co=[{id:"epp",label:"EPPs",icon:"",color:"#B91C1C",desc:"Elementos de proteccin personal"},{id:"dotacion",label:"Dotaciones",icon:"",color:"#5B3A8C",desc:"Uniformes, chalecos, calzado de dotacin"},{id:"herr_menor",label:"Herramienta menor",icon:"",color:"#8C6A00",desc:"Martillos, niveles, flexmetros, paletas, llanas"},{id:"herr_mayor",label:"Herramienta mayor",icon:"",color:"#3B3B3B",desc:"Taladros, pulidoras, cortadoras, mezcladoras"},{id:"equipo_obra",label:"Equipos de obra",icon:"",color:"#0D5E6E",desc:"Andamios, escaleras, formaletas, compresores"},{id:"equipo_medic",label:"Equipos de medicin",icon:"",color:"#111111",desc:"Niveles lser, distancimetros, estaciones"},{id:"equipo_computo",label:"Equipos de cmputo",icon:"",color:"#555",desc:"PCs, porttiles, tablets, monitores"},{id:"consumible",label:"Consumibles",icon:"",color:"#7C3A1E",desc:"Discos de corte, brocas, lijas, cintas"},{id:"seguridad",label:"Sealizacin / Seguridad",icon:"",color:"#B91C1C",desc:"Conos, cintas, seales, extintores, botiquines"},{id:"transporte",label:"Transporte / Vehculos",icon:"",color:"#555",desc:"Vehculos, carretillas, montacargas"}],If=["Cabeza","Ojos y cara","Odos","Respiratorio","Manos","Pies","Cuerpo","Trabajo en alturas","Otro"],Rf=["ud","par","juego","m","m","kg","l","rollo","caja","gl"],To=({children:t,style:i})=>e.jsx("div",{style:{background:Me.surface,borderRadius:8,border:`1px solid ${Me.border}`,boxShadow:"0 1px 3px rgba(0,0,0,.04)",...i},children:t}),Bo=({children:t,on:i,sm:o,v:n,style:a,...r})=>{const s={display:"inline-flex",alignItems:"center",gap:5,border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",fontWeight:600,transition:"filter .15s",...a},d={pri:{background:Me.ink,color:"#fff",padding:o?"5px 12px":"8px 18px",fontSize:o?10:12},sec:{background:Me.accent,color:Me.ink,padding:o?"5px 12px":"8px 18px",fontSize:o?10:12,border:`1px solid ${Me.border}`},ghost:{background:"transparent",color:Me.inkMid,padding:o?"4px 8px":"6px 12px",fontSize:o?10:11},danger:{background:Me.dangerBg,color:Me.danger,padding:o?"5px 12px":"8px 18px",fontSize:o?10:12,border:`1px solid ${Me.danger}33`}};return e.jsx("button",{onClick:i,style:{...s,...d[n]||d.pri},onMouseEnter:u=>u.currentTarget.style.filter="brightness(1.1)",onMouseLeave:u=>u.currentTarget.style.filter="none",...r,children:t})},$n=({t,s:i})=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700,color:Me.ink,margin:"0 0 2px"},children:t}),i&&e.jsx("p",{style:{fontSize:10,color:Me.inkLight,margin:"0 0 10px"},children:i})]}),Xt=({lbl:t,val:i,on:o,type:n="text",ph:a,style:r})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Me.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:t}),e.jsx("input",{type:n,value:i||"",onChange:o,placeholder:a,style:{width:"100%",padding:"6px 10px",border:`1px solid ${Me.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Me.bg,color:Me.ink}})]});function Mf(){var J;const[t,i]=F.useState([]),[o,n]=F.useState([]),[a,r]=F.useState({}),[s,d]=F.useState(!1);F.useEffect(()=>{(async()=>{const[M,B,V]=await Promise.all([en.get(tn.items),en.get(tn.proveedores),en.get(tn.cotizaciones)]);M&&i(M),B&&n(B),V&&r(V),d(!0)})()},[]);const u=F.useCallback(M=>{const B=typeof M=="function"?M(t):M;i(B),en.set(tn.items,B)},[t]),b=F.useCallback(M=>{const B=typeof M=="function"?M(o):M;n(B),en.set(tn.proveedores,B)},[o]),j=F.useCallback(M=>{const B=typeof M=="function"?M(a):M;r(B),en.set(tn.cotizaciones,B)},[a]),[w,S]=F.useState("dashboard"),[m,x]=F.useState("todos"),[p,c]=F.useState(""),[g,l]=F.useState(null),[f,y]=F.useState(null),[h,v]=F.useState(!1);F.useState(!1);const A=M=>M?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(M):"",z=F.useMemo(()=>{let M=t;if(m!=="todos"&&(M=M.filter(B=>B.familia===m)),p){const B=p.toLowerCase();M=M.filter(V=>(V.nombre||"").toLowerCase().includes(B)||(V.referencia||"").toLowerCase().includes(B))}return M},[t,m,p]),k=F.useMemo(()=>{const M={};return co.forEach(B=>M[B.id]={count:0,valor:0}),t.forEach(B=>{M[B.familia]&&(M[B.familia].count++,M[B.familia].valor+=(B.precio||0)*(B.stockActual||0))}),{total:t.length,byFam:M,provs:o.length,valorTotal:t.reduce((B,V)=>B+(V.precio||0)*(V.stockActual||0),0)}},[t,o]),T=(M="epp")=>({id:Zl(),nombre:"",familia:M,subfamilia:"",referencia:"",marca:"",unidad:"ud",precio:0,proveedorId:"",vidaUtil:12,reposicionMeses:12,stockMinimo:0,stockActual:0,asociadoACargo:!1,cargosAsociados:[],notas:"",activo:!0,fechaCreacion:ts()}),C=()=>({id:Zl(),nombre:"",nit:"",contacto:"",telefono:"",email:"",ciudad:"",especialidad:"",notas:"",activo:!0}),D=M=>{u(B=>B.find(X=>X.id===M.id)?B.map(X=>X.id===M.id?M:X):[...B,M]),l(null),v(!1)},K=M=>u(B=>B.filter(V=>V.id!==M)),oe=M=>{b(B=>B.find(X=>X.id===M.id)?B.map(X=>X.id===M.id?M:X):[...B,M]),y(null)},te=M=>b(B=>B.filter(V=>V.id!==M)),P=(M,B,V)=>{j(X=>{const R={...X};return R[M]||(R[M]={}),R[M][B]={precio:+V,fecha:ts()},R})},ie=(M,B)=>{var V;return((V=a[M])==null?void 0:V[B])||{}},me=M=>{const B=a[M]||{};let V=null,X=1/0;return Object.entries(B).forEach(([R,W])=>{W.precio>0&&W.precio<X&&(X=W.precio,V=R)}),V},[Q,je]=F.useState([]);F.useEffect(()=>{(async()=>{try{const M=await window.storage.get("hab:rrhh:cargos");M&&je(JSON.parse(M.value)||[])}catch{}})()},[]);const re=()=>{const M=["Familia","Nombre","Referencia","Marca","Unidad","Precio","Stock","Vida til (meses)","Proveedor"],B=t.map(se=>{var de;const le=o.find(Z=>Z.id===se.proveedorId);return[((de=co.find(Z=>Z.id===se.familia))==null?void 0:de.label)||se.familia,se.nombre,se.referencia,se.marca,se.unidad,se.precio,se.stockActual,se.vidaUtil,(le==null?void 0:le.nombre)||""]}),V="\uFEFF"+[M,...B].map(se=>se.map(le=>`"${le}"`).join(",")).join(`
`),X=new Blob([V],{type:"text/csv;charset=utf-8;"}),R=URL.createObjectURL(X),W=document.createElement("a");W.href=R,W.download="logistica_inventario.csv",W.click(),URL.revokeObjectURL(R)};return s?e.jsxs("div",{style:{minHeight:"100vh",background:Me.bg},children:[e.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
        *, *::before, *::after { box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: ${Me.ink} !important; }
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-thumb { background: ${Me.border}; border-radius: 2px; }
        @keyframes fadeUp { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:none; } }
        .fade { animation: fadeUp .15s ease both; }
      `}),e.jsxs("div",{style:{maxWidth:1400,margin:"0 auto",padding:"20px 24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",color:Me.inkLight,margin:"0 0 3px"},children:"Logstica y recursos"}),e.jsx("h1",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:24,fontWeight:800,color:Me.ink,margin:0},children:"Almacn  EPPs  Herramientas  Equipos"})]}),e.jsx("div",{style:{display:"flex",gap:8},children:e.jsxs(Bo,{sm:!0,v:"sec",on:re,children:[e.jsx(wo,{size:12})," Exportar CSV"]})})]}),e.jsx("div",{style:{display:"flex",borderBottom:`1px solid ${Me.border}`,marginBottom:20},children:[{id:"dashboard",lbl:"Dashboard"},{id:"inventario",lbl:"Inventario"},{id:"proveedores",lbl:"Proveedores"},{id:"comparativo",lbl:"Comparativo precios"},{id:"compras",lbl:"Lista de compra"}].map(M=>e.jsx("button",{onClick:()=>S(M.id),style:{padding:"10px 16px",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:600,letterSpacing:1,textTransform:"uppercase",background:"transparent",color:w===M.id?Me.ink:Me.inkLight,borderBottom:w===M.id?`2px solid ${Me.ink}`:"2px solid transparent",transition:"all .15s",marginBottom:-1},children:M.lbl},M.id))}),w==="dashboard"&&e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" tems inventario",t.length,"#111"],[" Proveedores",o.length,"#3B3B3B"],[" Stock bajo",t.filter(M=>M.stockActual<=M.stockMinimo).length,t.filter(M=>M.stockActual<=M.stockMinimo).length>0?"#B91C1C":"#111111"],[" Valor inventario","$"+A(t.reduce((M,B)=>M+(B.stockActual||0)*(B.precioRef||0),0)),"#111"]].map(([M,B,V])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Me.border}`,borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:M}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:V},children:B})]},M))}),t.filter(M=>M.stockActual<=M.stockMinimo).length>0&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" Stock bajo: ",t.filter(M=>M.stockActual<=M.stockMinimo).map(M=>M.nombre).join(", ")]})]}),w==="inventario"&&e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"flex",gap:8,marginBottom:14,flexWrap:"wrap"},children:co.map(M=>{var B;return e.jsxs("button",{onClick:()=>x(m===M.id?"todos":M.id),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 12px",border:`1px solid ${m===M.id?M.color:Me.border}`,borderRadius:6,background:m===M.id?M.color+"15":"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",transition:"all .1s"},children:[e.jsx("span",{style:{fontSize:16},children:M.icon}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:m===M.id?M.color:Me.inkMid},children:M.label}),e.jsx("div",{style:{fontSize:13,fontWeight:700,color:Me.ink},children:((B=k.byFam[M.id])==null?void 0:B.count)||0})]})]},M.id)})}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(vi,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:Me.inkLight}}),e.jsx("input",{value:p,onChange:M=>c(M.target.value),placeholder:"Buscar por nombre o referencia...",style:{width:"100%",padding:"8px 8px 8px 32px",border:`1px solid ${Me.border}`,borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:"#fff"}})]}),e.jsxs(Bo,{on:()=>{l(T(m==="todos"?"epp":m)),v(!0)},children:[e.jsx(Pe,{size:12})," Nuevo tem"]})]}),e.jsx(To,{style:{padding:0,overflow:"hidden"},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:900},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["","Nombre","Ref/Marca","Familia","Unid","Precio","Stock","Vida til","Proveedor",""].map((M,B)=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:`2px solid ${Me.border}`,textAlign:B>=4?"center":"left"},children:M},B))})}),e.jsxs("tbody",{children:[z.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:10,style:{padding:32,textAlign:"center",color:Me.inkLight,fontSize:13},children:["Sin tems",m!=="todos"?` en ${(J=co.find(M=>M.id===m))==null?void 0:J.label}`:"","."]})}),z.map((M,B)=>{const V=co.find(R=>R.id===M.familia),X=o.find(R=>R.id===M.proveedorId);return e.jsxs("tr",{style:{background:B%2===0?"#fff":"#FFFFFF",borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"5px 6px",fontSize:16,textAlign:"center"},children:(V==null?void 0:V.icon)||""}),e.jsxs("td",{style:{padding:"5px 8px"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,color:Me.ink},children:M.nombre||"Sin nombre"}),M.notas&&e.jsx("div",{style:{fontSize:9,color:Me.inkLight,marginTop:1},children:M.notas})]}),e.jsxs("td",{style:{padding:"5px 8px"},children:[e.jsx("div",{style:{fontSize:10,color:Me.inkMid},children:M.referencia||""}),e.jsx("div",{style:{fontSize:9,color:Me.inkLight},children:M.marca||""})]}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("span",{style:{fontSize:9,fontWeight:600,color:(V==null?void 0:V.color)||Me.inkMid,background:(V==null?void 0:V.color)+"15",padding:"2px 6px",borderRadius:3},children:(V==null?void 0:V.label)||M.familia})}),e.jsx("td",{style:{padding:"5px 6px",textAlign:"center",fontSize:10},children:M.unidad}),e.jsx("td",{style:{padding:"5px 6px",textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:600},children:A(M.precio)}),e.jsxs("td",{style:{padding:"5px 6px",textAlign:"center"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:600,color:M.stockActual<=M.stockMinimo?Me.danger:Me.ink},children:M.stockActual||0}),M.stockMinimo>0&&M.stockActual<=M.stockMinimo&&e.jsx("span",{style:{fontSize:8,color:Me.danger,display:"block"},children:" bajo"})]}),e.jsxs("td",{style:{padding:"5px 6px",textAlign:"center",fontSize:10,color:Me.inkMid},children:[M.vidaUtil||""," meses"]}),e.jsx("td",{style:{padding:"5px 8px",fontSize:10},children:(X==null?void 0:X.nombre)||""}),e.jsxs("td",{style:{padding:"5px 4px",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>{l({...M}),v(!0)},style:{background:"none",border:"none",cursor:"pointer",color:Me.inkLight,padding:3},children:e.jsx(io,{size:12})}),e.jsx("button",{onClick:()=>K(M.id),style:{background:"none",border:"none",cursor:"pointer",color:Me.danger,padding:3},children:e.jsx(qe,{size:12})})]})]},M.id)})]})]})})})]}),w==="proveedores"&&e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx($n,{t:`${o.length} proveedores registrados`,s:"Gestin de proveedores para cotizaciones"}),e.jsxs(Bo,{on:()=>y(C()),children:[e.jsx(Pe,{size:12})," Nuevo proveedor"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:12},children:[o.map(M=>e.jsxs(To,{style:{padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Me.ink},children:M.nombre}),e.jsxs("div",{style:{fontSize:10,color:Me.inkMid,marginTop:2},children:[M.nit&&`NIT: ${M.nit}  `,M.ciudad||""]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>y({...M}),style:{background:"none",border:"none",cursor:"pointer",color:Me.inkLight,padding:3},children:e.jsx(io,{size:12})}),e.jsx("button",{onClick:()=>te(M.id),style:{background:"none",border:"none",cursor:"pointer",color:Me.danger,padding:3},children:e.jsx(qe,{size:12})})]})]}),M.contacto&&e.jsxs("div",{style:{fontSize:11,marginTop:6},children:[" ",M.contacto]}),M.telefono&&e.jsxs("div",{style:{fontSize:11,color:Me.inkMid},children:[" ",M.telefono]}),M.email&&e.jsxs("div",{style:{fontSize:11,color:Me.inkMid},children:[" ",M.email]}),M.especialidad&&e.jsx("div",{style:{fontSize:10,color:Me.info,marginTop:4,fontWeight:600},children:M.especialidad})]},M.id)),o.length===0&&e.jsxs(To,{style:{padding:32,textAlign:"center",gridColumn:"1/-1"},children:[e.jsx(Lc,{size:28,style:{color:Me.inkLight,opacity:.3,marginBottom:8}}),e.jsx("p",{style:{color:Me.inkLight,fontSize:13},children:"Sin proveedores. Aade el primero."})]})]})]}),w==="comparativo"&&e.jsxs("div",{className:"fade",children:[e.jsx($n,{t:"Comparativo de precios por proveedor",s:"Ingresa precios de cada proveedor para comparar"}),o.length===0?e.jsx(To,{style:{padding:32,textAlign:"center"},children:e.jsx("p",{style:{color:Me.inkLight},children:"Primero aade proveedores en la pestaa Proveedores."})}):e.jsx(To,{style:{padding:0,overflow:"hidden",marginTop:12},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:500+o.length*120},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Me.border}`,textAlign:"left",position:"sticky",left:0,background:"#EDEBE7",zIndex:2,minWidth:50},children:"#"}),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Me.border}`,textAlign:"left",position:"sticky",left:50,background:"#EDEBE7",zIndex:2,minWidth:180},children:"TEM"}),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Me.border}`,textAlign:"center",width:50},children:"UND"}),o.map(M=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,textTransform:"uppercase",borderBottom:`2px solid ${Me.border}`,textAlign:"center",minWidth:110,color:Me.info,background:Me.infoBg},children:M.nombre},M.id)),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:Me.success,textTransform:"uppercase",borderBottom:`2px solid ${Me.border}`,textAlign:"center",width:100,background:Me.successBg},children:"MEJOR"})]})}),e.jsx("tbody",{children:t.map((M,B)=>{const V=me(M.id),X=V?ie(M.id,V):{},R=co.find(W=>W.id===M.familia);return e.jsxs("tr",{style:{background:B%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${Me.border}`},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,color:"#999",position:"sticky",left:0,background:B%2===0?"#fff":"#FFFFFF",zIndex:1},children:B+1}),e.jsx("td",{style:{padding:"4px 8px",position:"sticky",left:50,background:B%2===0?"#fff":"#FFFFFF",zIndex:1},children:e.jsxs("span",{style:{fontSize:11,fontWeight:500},children:[R==null?void 0:R.icon," ",M.nombre]})}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontSize:10,color:Me.inkMid},children:M.unidad}),o.map(W=>{const se=ie(M.id,W.id),le=V===W.id&&se.precio>0;return e.jsx("td",{style:{padding:"3px 4px",textAlign:"center",background:le?Me.successBg:"transparent",borderLeft:`1px solid ${Me.border}`},children:e.jsx("input",{type:"number",value:se.precio||"",placeholder:"",onChange:de=>P(M.id,W.id,de.target.value),style:{border:`1px solid ${le?Me.success:Me.border}`,borderRadius:3,padding:"3px 5px",fontSize:10,fontFamily:"'DM Mono',monospace",width:85,textAlign:"right",background:le?"#D4EDDA":"#fff",fontWeight:le?700:400}})},W.id)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700,color:Me.success,background:Me.successBg},children:X.precio>0?A(X.precio):""})]},M.id)})})]})})})]}),w==="compras"&&e.jsxs("div",{className:"fade",children:[e.jsx($n,{t:"Lista de compra",s:"tems con stock bajo o sin stock, agrupados por proveedor"}),(()=>{const M=t.filter(V=>V.stockActual<=(V.stockMinimo||0));if(M.length===0)return e.jsxs(To,{style:{padding:32,textAlign:"center",marginTop:12},children:[e.jsx(Fn,{size:28,style:{color:Me.inkLight,opacity:.3,marginBottom:8}}),e.jsx("p",{style:{color:Me.inkLight},children:"No hay tems con stock bajo. Define stock mnimo en cada tem para activar alertas."})]});const B={};return M.forEach(V=>{const X=me(V.id)||V.proveedorId||"sin_prov";B[X]||(B[X]=[]),B[X].push(V)}),e.jsx("div",{style:{display:"grid",gap:12,marginTop:12},children:Object.entries(B).map(([V,X])=>{const R=o.find(W=>W.id===V);return e.jsxs(To,{style:{padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[" ",(R==null?void 0:R.nombre)||"Sin proveedor asignado"]}),(R==null?void 0:R.telefono)&&e.jsxs("div",{style:{fontSize:10,color:Me.inkMid},children:[R.telefono,"  ",R.email||""]})]}),e.jsxs("span",{style:{fontSize:11,fontWeight:600,color:Me.danger},children:[X.length," tem",X.length!==1?"s":""]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${Me.border}`},children:[e.jsx("th",{style:{padding:"4px 6px",textAlign:"left",fontSize:9,color:"#888",fontWeight:700},children:"TEM"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:50},children:"UND"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:60},children:"STOCK"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:60},children:"MN"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:Me.danger,fontWeight:700,width:60},children:"PEDIR"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"right",fontSize:9,color:"#888",fontWeight:700,width:80},children:"P.U."}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"right",fontSize:9,color:"#888",fontWeight:700,width:90},children:"SUBTOTAL"})]})}),e.jsx("tbody",{children:X.map(W=>{var ue;const se=Math.max(0,(W.stockMinimo||1)-(W.stockActual||0)),le=me(W.id),Z=(le?ie(W.id,le):{}).precio||W.precio||0;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsxs("td",{style:{padding:"4px 6px",fontWeight:500},children:[(ue=co.find(N=>N.id===W.familia))==null?void 0:ue.icon," ",W.nombre]}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",color:Me.inkMid},children:W.unidad}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",color:Me.danger,fontWeight:600},children:W.stockActual||0}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center"},children:W.stockMinimo||0}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontWeight:700,color:Me.danger,background:Me.dangerBg},children:se}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10},children:A(Z)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600},children:A(Z*se)})]},W.id)})})]})]},V)})})})()]}),h&&g&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{v(!1),l(null)},children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:520,maxHeight:"85vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx($n,{t:g.fechaCreacion===ts()?"Nuevo tem":"Editar tem",s:"Registro de recurso / material"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"Nombre",val:g.nombre,on:M=>l({...g,nombre:M.target.value}),ph:"Ej: Casco de seguridad"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Me.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Familia"}),e.jsx("select",{value:g.familia,onChange:M=>l({...g,familia:M.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${Me.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Me.bg},children:co.map(M=>e.jsxs("option",{value:M.id,children:[M.icon," ",M.label]},M.id))})]})]}),g.familia==="epp"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Me.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Subfamilia EPP"}),e.jsxs("select",{value:g.subfamilia||"",onChange:M=>l({...g,subfamilia:M.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${Me.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Me.bg},children:[e.jsx("option",{value:"",children:" Seleccionar "}),If.map(M=>e.jsx("option",{value:M,children:M},M))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"Referencia",val:g.referencia,on:M=>l({...g,referencia:M.target.value}),ph:"Ref."}),e.jsx(Xt,{lbl:"Marca",val:g.marca,on:M=>l({...g,marca:M.target.value}),ph:"Marca"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Me.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Unidad"}),e.jsx("select",{value:g.unidad,onChange:M=>l({...g,unidad:M.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${Me.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Me.bg},children:Rf.map(M=>e.jsx("option",{value:M,children:M},M))})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"Precio unitario",type:"number",val:g.precio,on:M=>l({...g,precio:+M.target.value})}),e.jsx(Xt,{lbl:"Stock actual",type:"number",val:g.stockActual,on:M=>l({...g,stockActual:+M.target.value})}),e.jsx(Xt,{lbl:"Stock mnimo",type:"number",val:g.stockMinimo,on:M=>l({...g,stockMinimo:+M.target.value})}),e.jsx(Xt,{lbl:"Vida til (meses)",type:"number",val:g.vidaUtil,on:M=>l({...g,vidaUtil:+M.target.value})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Me.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Proveedor principal"}),e.jsxs("select",{value:g.proveedorId||"",onChange:M=>l({...g,proveedorId:M.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${Me.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Me.bg},children:[e.jsx("option",{value:"",children:" Sin asignar "}),o.map(M=>e.jsx("option",{value:M.id,children:M.nombre},M.id))]})]}),(g.familia==="epp"||g.familia==="dotacion")&&e.jsxs("div",{style:{marginBottom:8,background:Me.warningBg,borderRadius:4,padding:"8px 10px"},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Me.warning,marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:"Asociar a cargos (para clculo en APU)"}),e.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:[Q.filter(M=>M.activo!==!1).map(M=>{const B=(g.cargosAsociados||[]).includes(M.id);return e.jsxs("button",{onClick:()=>{const V=g.cargosAsociados||[];l({...g,cargosAsociados:B?V.filter(X=>X!==M.id):[...V,M.id],asociadoACargo:!0})},style:{padding:"3px 8px",fontSize:10,cursor:"pointer",border:`1px solid ${B?Me.warning:Me.border}`,borderRadius:3,background:B?Me.warning+"25":"#fff",color:B?Me.warning:Me.inkMid,fontFamily:"'DM Sans',sans-serif",fontWeight:B?600:400},children:[B?" ":"",M.nombre]},M.id)}),Q.filter(M=>M.activo!==!1).length===0&&e.jsx("span",{style:{fontSize:10,color:Me.inkLight},children:"Sin cargos en RRHH."})]})]}),e.jsx(Xt,{lbl:"Notas",val:g.notas,on:M=>l({...g,notas:M.target.value}),ph:"Observaciones..."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(Bo,{on:()=>D(g),style:{flex:1},children:[e.jsx(ft,{size:12})," Guardar"]}),e.jsx(Bo,{v:"sec",on:()=>{v(!1),l(null)},style:{flex:1},children:"Cancelar"})]})]})}),f&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>y(null),children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx($n,{t:"Proveedor",s:"Datos del proveedor"}),e.jsx(Xt,{lbl:"Nombre / Empresa",val:f.nombre,on:M=>y({...f,nombre:M.target.value}),ph:"Nombre"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"NIT / CIF",val:f.nit,on:M=>y({...f,nit:M.target.value}),ph:"NIT"}),e.jsx(Xt,{lbl:"Ciudad",val:f.ciudad,on:M=>y({...f,ciudad:M.target.value}),ph:"Ciudad"})]}),e.jsx(Xt,{lbl:"Contacto",val:f.contacto,on:M=>y({...f,contacto:M.target.value}),ph:"Persona de contacto"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"Telfono",val:f.telefono,on:M=>y({...f,telefono:M.target.value}),ph:"+57..."}),e.jsx(Xt,{lbl:"Email",val:f.email,on:M=>y({...f,email:M.target.value}),ph:"email@..."})]}),e.jsx(Xt,{lbl:"Especialidad",val:f.especialidad,on:M=>y({...f,especialidad:M.target.value}),ph:"Ej: EPPs, ferretera, elctricos"}),e.jsx(Xt,{lbl:"Notas",val:f.notas,on:M=>y({...f,notas:M.target.value}),ph:"Observaciones"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(Bo,{on:()=>oe(f),style:{flex:1},children:[e.jsx(ft,{size:12})," Guardar"]}),e.jsx(Bo,{v:"sec",on:()=>y(null),style:{flex:1},children:"Cancelar"})]})]})})]})]}):e.jsx("div",{style:{padding:40,textAlign:"center",color:Me.inkLight},children:"Cargando..."})}const _f=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input, select, textarea { font-family: 'DM Sans', sans-serif; outline: none; }
    button { font-family: 'DM Sans', sans-serif; cursor: pointer; }
    @keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    .fade-up { animation: fadeUp .22s ease both; }
  `}),Se={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.05)"},sl=()=>Math.random().toString(36).slice(2,9),ur=()=>new Date().toISOString(),Df=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",$f=t=>t?new Date(t).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"}):"",va=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"",fc=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/6e4);if(o<60)return`hace ${o}m`;const n=Math.floor(o/60);return n<24?`hace ${n}h`:`hace ${Math.floor(n/24)}d`};function ed(t,i){const[o,n]=F.useState(i),[a,r]=F.useState(!1);F.useEffect(()=>{(async()=>{var d,u;try{const b=await((u=(d=window.storage)==null?void 0:d.get)==null?void 0:u.call(d,t));b!=null&&b.value&&n(JSON.parse(b.value))}catch{}r(!0)})()},[t]);const s=F.useCallback(async d=>{var b,j;const u=typeof d=="function"?d(o):d;n(u);try{await((j=(b=window.storage)==null?void 0:b.set)==null?void 0:j.call(b,t,JSON.stringify(u)))}catch{}},[t,o]);return[o,s,a]}const wn=[{id:"ofertas",label:"Ofertas / CRM",icon:Uo,color:"#111111",desc:"Presupuestos y propuestas comerciales"},{id:"compras",label:"Compras / Insumos",icon:Fn,color:"#0D5E6E",desc:"rdenes de compra y contratos proveedores"},{id:"rrhh",label:"RRHH",icon:Fi,color:"#3B3B3B",desc:"Contrataciones, vacaciones y novedades"},{id:"pagos",label:"Pagos / Tesorera",icon:mr,color:"#8C6A00",desc:"Pagos a proveedores, anticipos y facturas"},{id:"subcontratos",label:"Subcontratos",icon:zo,color:"#5B3A8C",desc:"Contratos con subcontratistas"},{id:"calidad",label:"Calidad / SST",icon:Tn,color:"#B91C1C",desc:"No conformidades, inspecciones y permisos"}],td={pendiente:{label:"Pendiente",color:Se.amber,bg:Se.amberBg,icon:Ea},aprobado:{label:"Aprobado",color:Se.green,bg:Se.greenBg,icon:Vo},rechazado:{label:"Rechazado",color:Se.red,bg:Se.redBg,icon:Nc},devuelto:{label:"Devuelto",color:"#D4840A",bg:"#FFF3E0",icon:ca}},is=[{id:"dashboard",lbl:"Dashboard",I:Aa,desc:"Resumen general de aprobaciones"},{id:"ofertas",lbl:"Ofertas",I:Uo,desc:"Aprobaciones de presupuestos y propuestas"},{id:"compras",lbl:"Compras",I:Fn,desc:"rdenes de compra y contratos"},{id:"rrhh",lbl:"RRHH",I:Fi,desc:"Contrataciones y novedades"},{id:"pagos",lbl:"Pagos",I:mr,desc:"Pagos y tesorera"},{id:"subcontratos",lbl:"Subcontratos",I:zo,desc:"Contratos subcontratistas"},{id:"calidad",lbl:"Calidad / SST",I:Tn,desc:"No conformidades e inspecciones"},{id:"config",lbl:"Configuracin",I:el,desc:"Cadenas de aprobacin y umbrales"}],Pi=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Se.surface,border:`1px solid ${Se.border}`,borderRadius:8,boxShadow:Se.shadow,...i},...o,children:t}),xc=({estado:t})=>{const i=td[t]||td.pendiente,o=i.icon;return e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:4,background:i.bg,color:i.color,fontSize:10,fontWeight:700},children:[e.jsx(o,{size:11})," ",i.label]})},Ni=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Se.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?Se.redBg:Se.ink,color:i==="sec"?Se.inkMid:i==="danger"?Se.red:"#fff",...a},...r,children:t});function Pf({pais:t="CO"}){var l,f;const[i,o]=F.useState("dashboard"),[n,a,r]=ed("hab:aprobaciones:items",[]),[s,d,u]=ed("hab:aprobaciones:config",{usuarios:[{id:"david",nombre:"David Parra Galera",cargo:"Director Ejecutivo",email:"david@habitaris.co",nivel:1,avatar:""},{id:"ana",nombre:"Ana Mara Daz Buitrago",cargo:"Directora Creativa",email:"ana@habitaris.co",nivel:1,avatar:""},{id:"residente",nombre:"Residente de obra",cargo:"Residente",email:"residente@habitaris.co",nivel:2,avatar:""},{id:"admin",nombre:"Coordinador Administrativo",cargo:"Admin",email:"admin@habitaris.co",nivel:3,avatar:""}],cadenas:{ofertas:{aprobadores:["david","ana"],umbral:0,umbralAlto:5e7,aprobadorAlto:"david"},compras:{aprobadores:["residente"],umbral:5e6,aprobadorAlto:"david",umbralAlto:2e7},rrhh:{aprobadores:["david","ana"],umbral:0},pagos:{aprobadores:["david"],umbral:0,umbralAlto:1e7,aprobadorAlto:"david"},subcontratos:{aprobadores:["david"],umbral:1e7,aprobadorAlto:"david"},calidad:{aprobadores:["residente","david"],umbral:0}},notificaciones:!0}),[b,j]=F.useState("david"),[w,S]=F.useState([]);F.useEffect(()=>{(async()=>{var y,h;try{const v=await((h=(y=window.storage)==null?void 0:y.get)==null?void 0:h.call(y,"hab:crm:ofertas"));v!=null&&v.value&&S(JSON.parse(v.value)||[])}catch{}})()},[]);const m=y=>{const h={id:sl(),fecha:ur(),estado:"pendiente",historial:[],...y};return a(v=>[...v,h]),h},x=(y,h,v="")=>{a(A=>A.map(z=>{var T;return z.id!==y?z:{...z,estado:h==="aprobar"?"aprobado":h==="rechazar"?"rechazado":"devuelto",historial:[...z.historial||[],{accion:h,fecha:ur(),por:b,porNombre:((T=s.usuarios.find(C=>C.id===b))==null?void 0:T.nombre)||b,comentario:v}]}}))},p=F.useMemo(()=>{const y=n.filter(T=>T.estado==="pendiente"),h=y.filter(T=>{var D;const C=s.cadenas[T.modulo];return(D=C==null?void 0:C.aprobadores)==null?void 0:D.includes(b)}),v=n.filter(T=>T.estado==="aprobado"),A=n.filter(T=>T.estado==="rechazado"),z=n.filter(T=>T.estado==="devuelto"),k={};return wn.forEach(T=>{k[T.id]={total:n.filter(C=>C.modulo===T.id).length,pendientes:n.filter(C=>C.modulo===T.id&&C.estado==="pendiente").length}}),{pendientes:y.length,misPendientes:h.length,aprobados:v.length,rechazados:A.length,devueltos:z.length,byModule:k,total:n.length}},[n,b,s]),c=y=>n.filter(h=>h.modulo===y),g={border:`1px solid ${Se.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx(_f,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Se.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Se.surface,borderBottom:`1px solid ${Se.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Se.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Se.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Se.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Se.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase",color:Se.ink},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Se.inkLight,marginLeft:10},children:"/ Aprobaciones"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p.misPendientes>0&&e.jsxs("div",{style:{background:Se.amberBg,border:`1px solid ${Se.amber}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(za,{size:12,color:Se.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:Se.amber},children:[p.misPendientes," pendiente",p.misPendientes!==1?"s":""]})]}),e.jsx("select",{value:b,onChange:y=>j(y.target.value),style:{...g,fontSize:11,fontWeight:600,padding:"5px 8px",minWidth:160},children:s.usuarios.map(y=>e.jsxs("option",{value:y.id,children:[y.avatar," ",y.nombre]},y.id))})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:Se.surface,borderRight:`1px solid ${Se.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[is.map(y=>{const h=i===y.id,v=p.byModule[y.id],A=(v==null?void 0:v.pendientes)||0;return e.jsxs("button",{onClick:()=>o(y.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:h?`3px solid ${Se.ink}`:"3px solid transparent",background:h?Se.accent:"transparent",color:h?Se.ink:Se.inkLight,fontSize:12,fontWeight:h?700:400,cursor:"pointer",textAlign:"left",width:"100%",transition:"all .1s"},children:[e.jsx(y.I,{size:13,style:{flexShrink:0}}),e.jsx("span",{style:{flex:1,lineHeight:1.2},children:y.lbl}),A>0&&y.id!=="dashboard"&&y.id!=="config"&&e.jsx("span",{style:{background:Se.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:A})]},y.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:Se.inkXLight,letterSpacing:.8,borderTop:`1px solid ${Se.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:Se.ink,letterSpacing:-.2},children:(l=is.find(y=>y.id===i))==null?void 0:l.lbl}),e.jsx("p",{style:{fontSize:11,color:Se.inkLight,marginTop:2},children:(f=is.find(y=>y.id===i))==null?void 0:f.desc})]}),i==="dashboard"&&e.jsx(Of,{stats:p,aprobaciones:n,config:s,usuarioActivo:b,actuar:x,setTab:o,ofertas:w}),i==="config"&&e.jsx(Wf,{config:s,saveConfig:d}),["ofertas","compras","rrhh","pagos","subcontratos","calidad"].includes(i)&&e.jsx(Lf,{modulo:i,items:c(i),config:s,usuarioActivo:b,actuar:x,addAprobacion:m,ofertas:w})]})})]})]})]})}function Of({stats:t,aprobaciones:i,config:o,usuarioActivo:n,actuar:a,setTab:r,ofertas:s}){const d=i.filter(j=>{var S;if(j.estado!=="pendiente")return!1;const w=o.cadenas[j.modulo];return(S=w==null?void 0:w.aprobadores)==null?void 0:S.includes(n)}).sort((j,w)=>w.fecha>j.fecha?1:-1),u=[...i].sort((j,w)=>w.fecha>j.fecha?1:-1).slice(0,10),b=o.usuarios.find(j=>j.id===n);return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{label:"Mis pendientes",val:t.misPendientes,color:Se.amber,bg:Se.amberBg},{label:"Total pendientes",val:t.pendientes,color:"#D4840A",bg:"#FFF3E0"},{label:"Aprobadas",val:t.aprobados,color:Se.green,bg:Se.greenBg},{label:"Rechazadas",val:t.rechazados,color:Se.red,bg:Se.redBg},{label:"Devueltas",val:t.devueltos,color:Se.blue,bg:Se.blueBg}].map(j=>e.jsxs(Pi,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",letterSpacing:1},children:j.label}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:j.color,marginTop:4},children:j.val})]},j.label))}),e.jsx(Pi,{style:{padding:"16px 20px",marginBottom:16,background:Se.greenBg,border:`1px solid ${Se.green}33`},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("span",{style:{fontSize:28},children:(b==null?void 0:b.avatar)||""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Se.green},children:(b==null?void 0:b.nombre)||"Usuario"}),e.jsxs("div",{style:{fontSize:11,color:Se.inkMid},children:[b==null?void 0:b.cargo,"  ",Object.entries(o.cadenas).filter(([,j])=>{var w;return(w=j.aprobadores)==null?void 0:w.includes(n)}).map(([j])=>j).join(", ")||"Sin mdulos asignados"]})]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs(Pi,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",background:Se.amberBg,borderBottom:`1px solid ${Se.border}`},children:e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:Se.amber,display:"flex",alignItems:"center",gap:6},children:[e.jsx(Ea,{size:13})," Mis pendientes (",d.length,")"]})}),e.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:d.length===0?e.jsxs("div",{style:{padding:24,textAlign:"center",color:Se.inkLight,fontSize:12},children:[e.jsx(Vo,{size:24,style:{marginBottom:8,opacity:.3}}),e.jsx("div",{children:"Sin aprobaciones pendientes "})]}):d.map(j=>e.jsx(mc,{item:j,actuar:a,config:o,usuarioActivo:n,compact:!0,ofertas:s},j.id))})]}),e.jsxs(Pi,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",background:Se.blueBg,borderBottom:`1px solid ${Se.border}`},children:e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:Se.blue,display:"flex",alignItems:"center",gap:6},children:[e.jsx(zn,{size:13})," Por mdulo"]})}),wn.map(j=>{const w=t.byModule[j.id]||{},S=j.icon;return e.jsxs("div",{onClick:()=>r(j.id),style:{padding:"10px 16px",borderBottom:`1px solid ${Se.border}`,cursor:"pointer",display:"flex",alignItems:"center",gap:10,transition:"background .1s"},onMouseEnter:m=>m.currentTarget.style.background=Se.surfaceAlt,onMouseLeave:m=>m.currentTarget.style.background="transparent",children:[e.jsx("div",{style:{width:28,height:28,borderRadius:6,background:j.color+"15",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(S,{size:14,color:j.color})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600},children:j.label}),e.jsxs("div",{style:{fontSize:9,color:Se.inkLight},children:[w.total||0," total"]})]}),w.pendientes>0&&e.jsx("span",{style:{background:Se.amber,color:"#fff",fontSize:9,fontWeight:800,padding:"2px 7px",borderRadius:10},children:w.pendientes}),e.jsx(Gi,{size:12,color:Se.inkLight})]},j.id)})]})]}),u.length>0&&e.jsxs(Pi,{style:{marginTop:16,padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${Se.border}`},children:e.jsx("div",{style:{fontSize:12,fontWeight:700,color:Se.ink},children:"Actividad reciente"})}),u.map(j=>{const w=(j.historial||[]).slice(-1)[0],S=wn.find(m=>m.id===j.modulo);return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11},children:[e.jsx(xc,{estado:j.estado}),e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:600},children:j.titulo||j.referencia||"Sin ttulo"}),e.jsx("span",{style:{color:Se.inkLight,marginLeft:6,fontSize:9},children:S==null?void 0:S.label})]}),j.monto>0&&e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,color:Se.inkMid},children:["$",va(j.monto)]}),e.jsx("span",{style:{fontSize:9,color:Se.inkLight},children:fc((w==null?void 0:w.fecha)||j.fecha)})]},j.id)})]}),i.length===0&&e.jsxs(Pi,{style:{padding:30,textAlign:"center",marginTop:16},children:[e.jsx(Tn,{size:36,style:{color:Se.inkLight,opacity:.3,marginBottom:12}}),e.jsx("div",{style:{fontSize:14,fontWeight:600,color:Se.inkMid,marginBottom:6},children:"Sin aprobaciones registradas"}),e.jsx("div",{style:{fontSize:11,color:Se.inkLight,marginBottom:16},children:"Las aprobaciones se generan desde cada mdulo (Ofertas, Compras, etc.) o puedes crear una demo."}),e.jsxs(Ni,{on:()=>{[{modulo:"ofertas",titulo:"OF-2026-001  Apto 301 Torre Norte",referencia:"OF-2026-001",monto:85e6,solicitante:"ana",tipo:"Presupuesto de ejecucin"},{modulo:"ofertas",titulo:"OF-2026-002  Diseo interior Oficinas",referencia:"OF-2026-002",monto:25e6,solicitante:"david",tipo:"Propuesta de diseo"},{modulo:"compras",titulo:"OC-001  Cemento y acero",referencia:"OC-001",monto:125e5,solicitante:"residente",tipo:"Orden de compra"},{modulo:"compras",titulo:"OC-002  Pisos porcelanato 60x60",referencia:"OC-002",monto:82e5,solicitante:"residente",tipo:"Orden de compra"},{modulo:"pagos",titulo:"PAG-001  Anticipo Ferretera El Tornillo",referencia:"PAG-001",monto:6e6,solicitante:"admin",tipo:"Pago a proveedor"},{modulo:"subcontratos",titulo:"SC-001  Instalaciones elctricas",referencia:"SC-001",monto:18e6,solicitante:"residente",tipo:"Subcontrato"},{modulo:"rrhh",titulo:"Contratacin auxiliar de obra",referencia:"RRHH-001",monto:28e5,solicitante:"residente",tipo:"Nueva contratacin"},{modulo:"calidad",titulo:"NC-001  Fisura en paete fachada",referencia:"NC-001",monto:0,solicitante:"residente",tipo:"No conformidad"}].forEach(w=>{const S=o.usuarios.find(m=>m.id===w.solicitante);saveAprobaciones(m=>[...m,{id:sl(),fecha:ur(),estado:"pendiente",historial:[{accion:"solicitar",fecha:ur(),por:w.solicitante,porNombre:(S==null?void 0:S.nombre)||w.solicitante,comentario:""}],...w}])})},children:[e.jsx(Pe,{size:12})," Crear datos de ejemplo"]})]})]})}function mc({item:t,actuar:i,config:o,usuarioActivo:n,compact:a,ofertas:r}){var m,x,p,c;const[s,d]=F.useState(!1),[u,b]=F.useState(""),j=t.estado==="pendiente"&&((x=(m=o.cadenas[t.modulo])==null?void 0:m.aprobadores)==null?void 0:x.includes(n)),w=wn.find(g=>g.id===t.modulo),S=g=>{if(g!=="aprobar"&&!u.trim()){alert("Escribe un comentario");return}i(t.id,g,u),b(""),d(!1)};return e.jsxs("div",{style:{borderBottom:`1px solid ${Se.border}`},children:[e.jsxs("div",{onClick:()=>d(!s),style:{padding:a?"8px 16px":"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,transition:"background .1s",background:s?Se.surfaceAlt:"transparent"},onMouseEnter:g=>{s||(g.currentTarget.style.background="#FFFFFF")},onMouseLeave:g=>{s||(g.currentTarget.style.background="transparent")},children:[!a&&w&&e.jsx("div",{style:{width:24,height:24,borderRadius:4,background:w.color+"15",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(w.icon,{size:12,color:w.color})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.titulo||t.referencia||"Sin ttulo"}),e.jsxs("div",{style:{fontSize:9,color:Se.inkLight,marginTop:1},children:[t.tipo||""," ",t.solicitante&&` por ${((c=(p=o.usuarios.find(g=>g.id===t.solicitante))==null?void 0:p.nombre)==null?void 0:c.split(" ")[0])||t.solicitante}`]})]}),t.monto>0&&e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600,color:Se.inkMid,flexShrink:0},children:["$",va(t.monto)]}),e.jsx(xc,{estado:t.estado}),e.jsx("span",{style:{fontSize:9,color:Se.inkLight,flexShrink:0},children:fc(t.fecha)}),s?e.jsx(An,{size:12,color:Se.inkLight}):e.jsx(Gi,{size:12,color:Se.inkLight})]}),s&&e.jsxs("div",{style:{padding:"0 16px 14px",background:Se.surfaceAlt},children:[(t.historial||[]).length>0&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Historial"}),(t.historial||[]).map((g,l)=>e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${Se.border}`,paddingLeft:10,marginLeft:4},children:[e.jsxs("span",{style:{color:Se.inkLight,minWidth:60},children:[Df(g.fecha)," ",$f(g.fecha)]}),e.jsx("span",{style:{fontWeight:600},children:g.porNombre||g.por}),e.jsx("span",{style:{color:Se.inkMid},children:g.accion==="solicitar"?"solicit aprobacin":g.accion==="aprobar"?" aprob":g.accion==="rechazar"?" rechaz":g.accion==="devolver"?" devolvi":g.accion}),g.comentario&&e.jsxs("span",{style:{color:Se.amber,fontStyle:"italic"},children:[" ",g.comentario]})]},l))]}),j&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("input",{value:u,onChange:g=>b(g.target.value),placeholder:"Comentario (obligatorio para rechazar/devolver)...",style:{width:"100%",padding:"6px 10px",border:`1px solid ${Se.border}`,borderRadius:4,fontSize:11,marginBottom:8,background:"#fff"}}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(Ni,{sm:!0,on:()=>S("aprobar"),children:[e.jsx(ft,{size:11})," Aprobar"]}),e.jsxs(Ni,{sm:!0,v:"sec",on:()=>S("devolver"),style:{color:Se.amber,borderColor:Se.amber+"44"},children:[e.jsx(ca,{size:11})," Devolver"]}),e.jsxs(Ni,{sm:!0,v:"danger",on:()=>S("rechazar"),children:[e.jsx($t,{size:11})," Rechazar"]})]})]})]})]})}function Lf({modulo:t,items:i,config:o,usuarioActivo:n,actuar:a,addAprobacion:r,ofertas:s}){const[d,u]=F.useState("todos"),[b,j]=F.useState(""),[w,S]=F.useState(!1),[m,x]=F.useState({titulo:"",referencia:"",monto:0,tipo:""}),p=wn.find(h=>h.id===t),c=i.filter(h=>!(d!=="todos"&&h.estado!==d||b&&!(h.titulo||"").toLowerCase().includes(b.toLowerCase())&&!(h.referencia||"").toLowerCase().includes(b.toLowerCase()))).sort((h,v)=>v.fecha>h.fecha?1:-1),g=i.filter(h=>h.estado==="pendiente").length,l=()=>{var h;m.titulo.trim()&&(r({modulo:t,titulo:m.titulo,referencia:m.referencia,monto:parseFloat(m.monto)||0,tipo:m.tipo,solicitante:n,historial:[{accion:"solicitar",fecha:ur(),por:n,porNombre:((h=o.usuarios.find(v=>v.id===n))==null?void 0:h.nombre)||n,comentario:""}]}),x({titulo:"",referencia:"",monto:0,tipo:""}),S(!1))},f=o.cadenas[t]||{},y=(f.aprobadores||[]).map(h=>o.usuarios.find(v=>v.id===h)).filter(Boolean);return e.jsxs("div",{className:"fade-up",children:[e.jsx(Pi,{style:{padding:"14px 18px",marginBottom:14,background:(p==null?void 0:p.color)+"08",border:`1px solid ${p==null?void 0:p.color}22`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p&&e.jsx(p.icon,{size:18,color:p.color}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:Se.ink},children:p==null?void 0:p.label}),e.jsxs("div",{style:{fontSize:10,color:Se.inkMid},children:[i.length," total  ",g," pendientes  Aprobadores: ",y.map(h=>h.nombre.split(" ")[0]).join(", ")||"Sin configurar",f.umbral>0&&`  Umbral: $${va(f.umbral)}`]})]})]}),e.jsxs(Ni,{sm:!0,on:()=>S(!0),children:[e.jsx(Pe,{size:11})," Nueva solicitud"]})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["todos","Todos"],["pendiente","Pendientes"],["aprobado","Aprobados"],["rechazado","Rechazados"],["devuelto","Devueltos"]].map(([h,v],A,z)=>e.jsxs("button",{onClick:()=>u(h),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${Se.border}`,borderLeft:A>0?"none":void 0,borderRadius:A===0?"4px 0 0 4px":A===z.length-1?"0 4px 4px 0":"0",background:d===h?Se.ink:"#fff",color:d===h?"#fff":Se.inkMid},children:[v," ",h==="pendiente"&&g>0?`(${g})`:""]},h))}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(vi,{size:12,style:{position:"absolute",left:8,top:8,color:Se.inkLight}}),e.jsx("input",{value:b,onChange:h=>j(h.target.value),placeholder:"Buscar...",style:{border:`1px solid ${Se.border}`,borderRadius:4,padding:"6px 10px",fontSize:11,background:"#fff",paddingLeft:26,width:200}})]})]}),e.jsx(Pi,{style:{padding:0,overflow:"hidden"},children:c.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:Se.inkLight,fontSize:12},children:["Sin aprobaciones ",d!=="todos"?`con estado "${d}"`:""," en ",p==null?void 0:p.label]}):c.map(h=>e.jsx(mc,{item:h,actuar:a,config:o,usuarioActivo:n,ofertas:s},h.id))}),w&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>S(!1),children:e.jsxs("div",{onClick:h=>h.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,marginBottom:4},children:"Nueva solicitud de aprobacin"}),e.jsxs("div",{style:{fontSize:11,color:Se.inkLight,marginBottom:16},children:["Mdulo: ",p==null?void 0:p.label]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",marginBottom:3},children:"Ttulo / Descripcin"}),e.jsx("input",{value:m.titulo,onChange:h=>x({...m,titulo:h.target.value}),placeholder:"Ej: Orden de compra acero corrugado",style:{border:`1px solid ${Se.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",marginBottom:3},children:"Referencia"}),e.jsx("input",{value:m.referencia,onChange:h=>x({...m,referencia:h.target.value}),placeholder:"OC-001",style:{border:`1px solid ${Se.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",marginBottom:3},children:"Monto"}),e.jsx("input",{type:"number",value:m.monto||"",onChange:h=>x({...m,monto:h.target.value}),placeholder:"0",style:{border:`1px solid ${Se.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%",fontFamily:"'DM Mono',monospace"}})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",marginBottom:3},children:"Tipo de solicitud"}),e.jsx("input",{value:m.tipo,onChange:h=>x({...m,tipo:h.target.value}),placeholder:"Ej: Orden de compra, Pago, Contrato...",style:{border:`1px solid ${Se.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{style:{background:Se.surfaceAlt,borderRadius:4,padding:"8px 12px",fontSize:10,color:Se.inkMid,marginBottom:12},children:[" Aprobadores configurados: ",e.jsx("strong",{children:y.map(h=>h.nombre.split(" ")[0]).join(", ")||"Ninguno"}),f.umbral>0&&e.jsxs("span",{children:["  Umbral auto: ",e.jsxs("strong",{children:["$",va(f.umbral)]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs(Ni,{on:l,style:{flex:1},children:[e.jsx(bn,{size:11})," Solicitar aprobacin"]}),e.jsx(Ni,{v:"sec",on:()=>S(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function Wf({config:t,saveConfig:i}){F.useState(null);const[o,n]=F.useState({nombre:"",cargo:"",email:"",nivel:3,avatar:""}),[a,r]=F.useState(!1),s=(w,S,m)=>{i(x=>({...x,cadenas:{...x.cadenas,[w]:{...x.cadenas[w],[S]:m}}}))},d=(w,S)=>{const x=(t.cadenas[w]||{}).aprobadores||[],p=x.includes(S)?x.filter(c=>c!==S):[...x,S];s(w,"aprobadores",p)},u=()=>{o.nombre.trim()&&(i(w=>({...w,usuarios:[...w.usuarios,{...o,id:sl()}]})),n({nombre:"",cargo:"",email:"",nivel:3,avatar:""}),r(!1))},b=w=>{i(S=>({...S,usuarios:S.usuarios.filter(m=>m.id!==w),cadenas:Object.fromEntries(Object.entries(S.cadenas).map(([m,x])=>[m,{...x,aprobadores:(x.aprobadores||[]).filter(p=>p!==w)}]))}))},j={border:`1px solid ${Se.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs(Pi,{style:{padding:18,marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Se.ink},children:"Usuarios aprobadores"}),e.jsx("div",{style:{fontSize:10,color:Se.inkLight},children:"Personas que participan en cadenas de aprobacin"})]}),e.jsxs(Ni,{sm:!0,on:()=>r(!0),children:[e.jsx(Pe,{size:11})," Aadir usuario"]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:10},children:t.usuarios.map(w=>e.jsxs("div",{style:{border:`1px solid ${Se.border}`,borderRadius:6,padding:"10px 14px",background:Se.surfaceAlt},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:20},children:w.avatar}),e.jsx("button",{onClick:()=>b(w.id),style:{background:"none",border:"none",cursor:"pointer",color:Se.red,padding:2},children:e.jsx(qe,{size:11})})]}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:w.nombre}),e.jsx("div",{style:{fontSize:10,color:Se.inkMid},children:w.cargo}),e.jsx("div",{style:{fontSize:9,color:Se.inkLight,marginTop:2},children:w.email}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,color:Se.inkLight,textTransform:"uppercase"},children:"Nivel:"}),[1,2,3].map(S=>e.jsx("button",{onClick:()=>i(m=>({...m,usuarios:m.usuarios.map(x=>x.id===w.id?{...x,nivel:S}:x)})),style:{width:20,height:20,borderRadius:"50%",border:`1px solid ${w.nivel===S?Se.green:Se.border}`,background:w.nivel===S?Se.greenBg:"#fff",color:w.nivel===S?Se.green:Se.inkLight,fontSize:9,fontWeight:700,cursor:"pointer"},children:S},S))]})]},w.id))})]}),e.jsxs(Pi,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Se.ink,marginBottom:4},children:"Cadenas de aprobacin por mdulo"}),e.jsx("div",{style:{fontSize:10,color:Se.inkLight,marginBottom:14},children:"Define quin aprueba en cada mdulo y los umbrales de monto. Si el monto supera el umbral alto, se requiere el aprobador de nivel superior."}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:Se.surfaceAlt},children:[e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",letterSpacing:.5,borderBottom:`2px solid ${Se.border}`},children:"Mdulo"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Se.border}`},children:"Aprobadores"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"right",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Se.border}`,width:120},children:"Umbral estndar"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"right",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Se.border}`,width:120},children:"Umbral alto"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Se.border}`,width:140},children:"Aprobador nivel alto"})]})}),e.jsx("tbody",{children:wn.map(w=>{const S=t.cadenas[w.id]||{},m=w.icon;return e.jsxs("tr",{style:{borderBottom:`1px solid ${Se.border}`},children:[e.jsx("td",{style:{padding:"10px 12px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(m,{size:14,color:w.color}),e.jsx("span",{style:{fontSize:12,fontWeight:600},children:w.label})]})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:t.usuarios.map(x=>{const p=(S.aprobadores||[]).includes(x.id);return e.jsxs("button",{onClick:()=>d(w.id,x.id),style:{padding:"3px 8px",fontSize:9,fontWeight:600,borderRadius:4,cursor:"pointer",border:`1px solid ${p?Se.green:Se.border}`,background:p?Se.greenBg:"#fff",color:p?Se.green:Se.inkLight},children:[p?e.jsx(Fd,{size:8,style:{marginRight:3}}):e.jsx(Wc,{size:8,style:{marginRight:3}}),x.nombre.split(" ")[0]]},x.id)})})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("input",{type:"number",value:S.umbral||"",placeholder:"0",onChange:x=>s(w.id,"umbral",parseFloat(x.target.value)||0),style:{...j,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10}})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("input",{type:"number",value:S.umbralAlto||"",placeholder:"0",onChange:x=>s(w.id,"umbralAlto",parseFloat(x.target.value)||0),style:{...j,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10}})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsxs("select",{value:S.aprobadorAlto||"",onChange:x=>s(w.id,"aprobadorAlto",x.target.value),style:{...j,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Sin definir "}),t.usuarios.filter(x=>x.nivel<=1).map(x=>e.jsx("option",{value:x.id,children:x.nombre},x.id))]})})]},w.id)})})]})]}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:w=>w.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:400,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,marginBottom:12},children:"Nuevo usuario aprobador"}),[["nombre","Nombre completo","Ej: Carlos Rodrguez"],["cargo","Cargo","Ej: Residente de obra"],["email","Email","carlos@habitaris.co"]].map(([w,S,m])=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",marginBottom:3},children:S}),e.jsx("input",{value:o[w],onChange:x=>n({...o,[w]:x.target.value}),placeholder:m,style:{...j,width:"100%"}})]},w)),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",marginBottom:3},children:"Avatar"}),e.jsx("div",{style:{display:"flex",gap:4},children:["","","","","","","",""].map(w=>e.jsx("button",{onClick:()=>n({...o,avatar:w}),style:{width:28,height:28,borderRadius:4,cursor:"pointer",fontSize:16,border:`2px solid ${o.avatar===w?Se.green:Se.border}`,background:o.avatar===w?Se.greenBg:"#fff"},children:w},w))})]}),e.jsxs("div",{style:{width:80},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Se.inkLight,textTransform:"uppercase",marginBottom:3},children:"Nivel"}),e.jsxs("select",{value:o.nivel,onChange:w=>n({...o,nivel:+w.target.value}),style:{...j,width:"100%"},children:[e.jsx("option",{value:1,children:"1 (Director)"}),e.jsx("option",{value:2,children:"2 (Coordinador)"}),e.jsx("option",{value:3,children:"3 (Operativo)"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsxs(Ni,{on:u,style:{flex:1},children:[e.jsx(ft,{size:11})," Guardar"]}),e.jsx(Ni,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}const Nf=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'DM Sans',sans-serif;background:#F5F4F1;-webkit-font-smoothing:antialiased}
    ::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}
    input,select,textarea{font-family:'DM Sans',sans-serif;outline:none}
    button{font-family:'DM Sans',sans-serif;cursor:pointer}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .22s ease both}
  `}),Re={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",purpleBg:"#F0ECF6",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},os=()=>Math.random().toString(36).slice(2,9),Or=()=>new Date().toISOString().split("T")[0],Lr=(t,i)=>{const o=new Date(t);return o.setDate(o.getDate()+i),o.toISOString().split("T")[0]},id=(t,i)=>Math.round((new Date(i)-new Date(t))/864e5),on=t=>Math.min(100,Math.max(0,Math.round(t))),ns=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short"}):"";function rs(t,i){const o="habitaris_proy",[n,a]=F.useState(()=>{try{const s=JSON.parse(localStorage.getItem(o))||{};return s[t]!=null?s[t]:i}catch{return i}}),r=F.useCallback(s=>{var u,b;const d=typeof s=="function"?s(n):s;a(d);try{const j=JSON.parse(localStorage.getItem(o))||{};j[t]=d,localStorage.setItem(o,JSON.stringify(j));try{(b=(u=window.storage)==null?void 0:u.set)==null||b.call(u,o,JSON.stringify(j))}catch{}}catch{}},[t,n]);return[n,r]}const po=({children:t,style:i})=>e.jsx("div",{style:{background:Re.surface,border:`1px solid ${Re.border}`,borderRadius:8,boxShadow:Re.shadow,...i},children:t}),as=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Re.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?Re.redBg:Re.ink,color:i==="sec"?Re.inkMid:i==="danger"?Re.red:"#fff",...a},...r,children:t}),Uf=[{id:"dashboard",lbl:"Dashboard",I:Hi,desc:"KPIs y estado general"},{id:"gantt",lbl:"Cronograma",I:Zs,desc:"Diagrama de Gantt y programacin"},{id:"avances",lbl:"Avances",I:Hi,desc:"Registro de avance por actividad"},{id:"hitos",lbl:"Hitos",I:Td,desc:"Hitos y entregables del proyecto"},{id:"tablero",lbl:"Tablero",I:zn,desc:"Vista Kanban de tareas"},{id:"equipo",lbl:"Equipo",I:Fi,desc:"Asignacin de recursos"}];function Vf(){const[t,i]=F.useState("dashboard"),[o,n]=rs("hab:proyectos:lista",[]),[a,r]=F.useState(null),[s,d]=rs("hab:proyectos:actividades",[]),[u,b]=rs("hab:proyectos:hitos",[]),j=o.find(h=>h.id===a),w=()=>{const h={id:os(),nombre:"Nuevo proyecto",inicio:Or(),fin:Lr(Or(),90),estado:"activo",descripcion:"",color:Re.purple};n(v=>[...v,h]),r(h.id)},S=(h,v)=>n(A=>A.map(z=>z.id===a?{...z,[h]:v}:z)),m=s.filter(h=>h.proyectoId===a),x=m.length>0?m.reduce((h,v)=>h+(v.avance||0),0)/m.length:0,p=()=>{const h={id:os(),proyectoId:a,nombre:"Nueva actividad",inicio:Or(),duracion:7,avance:0,responsable:"",predecessors:[],capitulo:""};d(v=>[...v,h])},c=(h,v,A)=>d(z=>z.map(k=>k.id===h?{...k,[v]:A}:k)),g=h=>d(v=>v.filter(A=>A.id!==h)),l=()=>{const h={id:os(),proyectoId:a,nombre:"Nuevo hito",fecha:Or(),completado:!1,descripcion:""};b(v=>[...v,h])},f=u.filter(h=>h.proyectoId===a),y={border:`1px solid ${Re.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff",width:"100%"};return e.jsxs(e.Fragment,{children:[e.jsx(Nf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Re.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Re.surface,borderBottom:`1px solid ${Re.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Re.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Re.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Re.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Re.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Re.inkLight,marginLeft:10},children:"/ Proyectos"})]})]}),j&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600},children:j.nombre}),e.jsxs("span",{style:{fontSize:10,padding:"2px 8px",borderRadius:10,background:Re.purpleBg,color:Re.purple,fontWeight:700},children:[on(x),"%"]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:Re.surface,borderRight:`1px solid ${Re.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[e.jsxs("div",{style:{padding:"6px 12px 10px",borderBottom:`1px solid ${Re.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Re.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Proyectos"}),o.map(h=>e.jsxs("button",{onClick:()=>r(h.id),style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",fontSize:11,fontWeight:a===h.id?700:400,border:"none",borderRadius:4,cursor:"pointer",marginBottom:2,background:a===h.id?Re.purpleBg:"transparent",color:a===h.id?Re.purple:Re.inkMid},children:[" ",h.nombre]},h.id)),e.jsxs("button",{onClick:w,style:{display:"flex",alignItems:"center",gap:4,width:"100%",padding:"5px 10px",fontSize:10,border:`1px dashed ${Re.border}`,borderRadius:4,background:"transparent",color:Re.inkLight,marginTop:4},children:[e.jsx(Pe,{size:10})," Nuevo proyecto"]})]}),a&&Uf.map(h=>{const v=t===h.id;return e.jsxs("button",{onClick:()=>i(h.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:v?`3px solid ${Re.ink}`:"3px solid transparent",background:v?Re.accent:"transparent",color:v?Re.ink:Re.inkLight,fontSize:12,fontWeight:v?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(h.I,{size:13})," ",h.lbl]},h.id)})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1200},children:a?e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs("div",{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Proyectos",o.length,"#111",`${o.filter(h=>h.estado==="activo").length} activos`],[" Avance global",`${on(x)}%`,x>=70?"#111111":x>=40?"#8C6A00":"#B91C1C",`${m.length} actividades`],[" Hitos",`${f.filter(h=>h.completado).length}/${f.length}`,"#3B3B3B",`${f.filter(h=>!h.completado).length} pendientes`],[" Actividades",m.length,"#111",j?`en ${j.nombre}`:""]].map(([h,v,A,z])=>e.jsxs(po,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:h}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:A},children:v}),z&&e.jsx("div",{style:{fontSize:9,color:"#909090",marginTop:2},children:z})]},h))}),j&&e.jsxs(po,{style:{marginBottom:12},children:[e.jsxs("div",{style:{fontSize:10,fontWeight:700,marginBottom:8},children:[" Avance  ",j.nombre]}),e.jsx("div",{style:{height:12,background:"#E0E0E0",borderRadius:6,overflow:"hidden",marginBottom:6},children:e.jsx("div",{style:{width:`${on(x)}%`,height:"100%",borderRadius:6,background:x>=70?"#111111":x>=40?"#8C6A00":"#B91C1C"}})}),e.jsxs("div",{style:{fontSize:9,color:"#909090"},children:["Inicio: ",j.inicio,"  Fin: ",j.fin,"  ",m.length," actividades"]})]})]}),t==="gantt"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:10,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:Re.inkLight,textTransform:"uppercase"},children:"Nombre del proyecto"}),e.jsx("input",{value:j.nombre,onChange:h=>S("nombre",h.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:Re.inkLight,textTransform:"uppercase"},children:"Inicio"}),e.jsx("input",{type:"date",value:j.inicio,onChange:h=>S("inicio",h.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:Re.inkLight,textTransform:"uppercase"},children:"Fin estimado"}),e.jsx("input",{type:"date",value:j.fin,onChange:h=>S("fin",h.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:Re.inkLight,textTransform:"uppercase"},children:"Estado"}),e.jsxs("select",{value:j.estado,onChange:h=>S("estado",h.target.value),style:y,children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"finalizado",children:"Finalizado"})]})]})]}),e.jsxs(po,{style:{padding:0,overflow:"hidden",marginBottom:16},children:[e.jsxs("div",{style:{padding:"10px 16px",borderBottom:`1px solid ${Re.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Cronograma"}),e.jsxs(as,{sm:!0,on:p,children:[e.jsx(Pe,{size:10})," Actividad"]})]}),m.length===0?e.jsx("div",{style:{padding:30,textAlign:"center",color:Re.inkLight,fontSize:12},children:"Sin actividades. Agrega la primera."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:800},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Re.surfaceAlt},children:["#","Actividad","Inicio","Dur.(das)","Fin","Avance %","Responsable",""].map(h=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Re.inkLight,textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:`2px solid ${Re.border}`,whiteSpace:"nowrap"},children:h},h))})}),e.jsx("tbody",{children:m.map((h,v)=>{const A=Lr(h.inicio,h.duracion);return e.jsxs("tr",{style:{borderBottom:`1px solid ${Re.border}`},children:[e.jsx("td",{style:{padding:"6px 10px",fontSize:10,color:Re.inkLight},children:v+1}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:h.nombre,onChange:z=>c(h.id,"nombre",z.target.value),style:{border:"none",background:"transparent",fontSize:12,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:h.inicio,onChange:z=>c(h.id,"inicio",z.target.value),style:{border:`1px solid ${Re.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"number",value:h.duracion,onChange:z=>c(h.id,"duracion",+z.target.value),style:{border:`1px solid ${Re.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,width:50,textAlign:"center",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px",fontSize:10,color:Re.inkMid,fontFamily:"'DM Mono',monospace"},children:ns(A)}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:Re.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${h.avance||0}%`,background:h.avance>=100?Re.green:Re.purple,borderRadius:3,transition:"width .2s"}})}),e.jsx("input",{type:"number",value:h.avance||0,min:0,max:100,onChange:z=>c(h.id,"avance",on(+z.target.value)),style:{width:36,border:`1px solid ${Re.border}`,borderRadius:3,padding:"2px 4px",fontSize:9,textAlign:"center",fontFamily:"'DM Mono',monospace",background:"#fff"}})]})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:h.responsable||"",onChange:z=>c(h.id,"responsable",z.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:11,width:100}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>g(h.id),style:{background:"none",border:"none",color:Re.red,cursor:"pointer"},children:e.jsx(qe,{size:12})})})]},h.id)})})]})})]}),m.length>0&&e.jsxs(po,{style:{padding:16,marginBottom:16},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:10},children:"Vista Gantt"}),(()=>{const h=m.reduce((z,k)=>k.inicio<z?k.inicio:z,m[0].inicio),v=m.reduce((z,k)=>{const T=Lr(k.inicio,k.duracion);return T>z?T:z},h),A=Math.max(id(h,v),1);return m.map(z=>{const T=id(h,z.inicio)/A*100,C=Math.max(z.duracion/A*100,2);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("div",{style:{width:120,fontSize:10,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:z.nombre}),e.jsx("div",{style:{flex:1,height:14,background:Re.surfaceAlt,borderRadius:3,position:"relative",border:`1px solid ${Re.border}`},children:e.jsx("div",{style:{position:"absolute",left:`${T}%`,width:`${C}%`,height:"100%",background:z.avance>=100?Re.green:Re.purple+"88",borderRadius:3},children:e.jsx("div",{style:{height:"100%",width:`${z.avance||0}%`,background:z.avance>=100?Re.green:Re.purple,borderRadius:3}})})}),e.jsxs("span",{style:{fontSize:9,fontFamily:"'DM Mono',monospace",color:Re.inkLight,minWidth:30,textAlign:"right"},children:[z.avance||0,"%"]})]},z.id)})})()]}),e.jsxs(po,{style:{padding:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Avance global del proyecto"}),e.jsxs("div",{style:{fontSize:10,color:Re.inkLight},children:[m.length," actividades  ",m.filter(h=>h.avance>=100).length," completadas"]})]}),e.jsxs("div",{style:{fontSize:28,fontWeight:800,color:x>=100?Re.green:Re.purple},children:[on(x),"%"]})]}),e.jsx("div",{style:{height:8,background:Re.border,borderRadius:4,marginTop:8,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${x}%`,background:x>=100?Re.green:Re.purple,borderRadius:4,transition:"width .3s"}})})]})]}),t==="avances"&&e.jsxs(po,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Registro de avances"}),m.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:Re.inkLight},children:"Agrega actividades primero en el Cronograma"}):m.map(h=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${Re.border}`},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600},children:h.nombre}),e.jsxs("div",{style:{fontSize:9,color:Re.inkLight},children:[h.responsable||"Sin asignar","  ",ns(h.inicio),"  ",ns(Lr(h.inicio,h.duracion))]})]}),e.jsxs("div",{style:{width:160,display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"range",min:0,max:100,value:h.avance||0,onChange:v=>c(h.id,"avance",+v.target.value),style:{flex:1,accentColor:Re.purple}}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,fontFamily:"'DM Mono',monospace",color:h.avance>=100?Re.green:Re.purple,minWidth:30},children:[h.avance||0,"%"]})]})]},h.id))]}),t==="hitos"&&e.jsxs(po,{style:{padding:18},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"Hitos del proyecto"}),e.jsxs(as,{sm:!0,on:l,children:[e.jsx(Pe,{size:10})," Nuevo hito"]})]}),f.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:Re.inkLight},children:"Sin hitos definidos"}):f.sort((h,v)=>h.fecha>v.fecha?1:-1).map(h=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${Re.border}`},children:[e.jsx("button",{onClick:()=>b(v=>v.map(A=>A.id===h.id?{...A,completado:!A.completado}:A)),style:{width:24,height:24,borderRadius:"50%",border:`2px solid ${h.completado?Re.green:Re.border}`,background:h.completado?Re.greenBg:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:h.completado&&e.jsx(ft,{size:12,color:Re.green})}),e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:h.nombre,onChange:v=>b(A=>A.map(z=>z.id===h.id?{...z,nombre:v.target.value}:z)),style:{border:"none",background:"transparent",fontSize:13,fontWeight:600,width:"100%",textDecoration:h.completado?"line-through":"none",color:h.completado?Re.inkLight:Re.ink}})}),e.jsx("input",{type:"date",value:h.fecha,onChange:v=>b(A=>A.map(z=>z.id===h.id?{...z,fecha:v.target.value}:z)),style:{border:`1px solid ${Re.border}`,borderRadius:3,padding:"3px 8px",fontSize:10,background:"#fff"}}),e.jsx(Td,{size:12,color:h.completado?Re.green:new Date(h.fecha)<new Date?Re.red:Re.amber}),e.jsx("button",{onClick:()=>b(v=>v.filter(A=>A.id!==h.id)),style:{background:"none",border:"none",color:Re.red,cursor:"pointer"},children:e.jsx(qe,{size:12})})]},h.id))]}),t==="tablero"&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12},children:[{id:"pendiente",label:"Pendiente",color:Re.inkLight,bg:Re.surfaceAlt},{id:"en_curso",label:"En curso",color:Re.blue,bg:Re.blueBg},{id:"revision",label:"En revisin",color:Re.amber,bg:Re.amberBg},{id:"completado",label:"Completado",color:Re.green,bg:Re.greenBg}].map(h=>{const v=m.filter(A=>h.id==="completado"?A.avance>=100:h.id==="revision"?A.avance>=80&&A.avance<100:h.id==="en_curso"?A.avance>0&&A.avance<80:!A.avance||A.avance===0);return e.jsxs("div",{children:[e.jsxs("div",{style:{padding:"8px 12px",background:h.bg,borderRadius:"6px 6px 0 0",border:`1px solid ${Re.border}`,borderBottom:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:700,color:h.color},children:h.label}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:h.color,background:h.color+"22",padding:"1px 6px",borderRadius:8},children:v.length})]}),e.jsx("div",{style:{border:`1px solid ${Re.border}`,borderRadius:"0 0 6px 6px",minHeight:120,background:"#fff",padding:6},children:v.map(A=>e.jsxs("div",{style:{padding:"8px 10px",marginBottom:4,background:Re.surfaceAlt,borderRadius:4,border:`1px solid ${Re.border}`,fontSize:11},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:2},children:A.nombre}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:Re.inkLight},children:[e.jsx("span",{children:A.responsable||""}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[A.avance||0,"%"]})]})]},A.id))})]},h.id)})}),t==="equipo"&&e.jsxs(po,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Asignacin de recursos"}),(()=>{const h=[...new Set(m.map(v=>v.responsable).filter(Boolean))];return h.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:Re.inkLight},children:"Asigna responsables en las actividades del Cronograma"}):h.map(v=>{const A=m.filter(k=>k.responsable===v),z=A.reduce((k,T)=>k+(T.avance||0),0)/A.length;return e.jsxs("div",{style:{marginBottom:14,padding:"12px 16px",background:Re.surfaceAlt,borderRadius:6,border:`1px solid ${Re.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[" ",v]}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:Re.purple},children:[A.length," tareas  ",on(z),"% avance"]})]}),A.map(k=>e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",fontSize:10,padding:"3px 0"},children:[e.jsx("span",{style:{flex:1},children:k.nombre}),e.jsx("div",{style:{width:60,height:4,background:Re.border,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${k.avance||0}%`,background:Re.purple,borderRadius:2}})}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,minWidth:24,textAlign:"right"},children:[k.avance||0,"%"]})]},k.id))]},v)})})()]})]}):e.jsxs("div",{style:{textAlign:"center",padding:60,color:Re.inkLight},children:[e.jsx(Zs,{size:40,style:{opacity:.3,marginBottom:12}}),e.jsx("div",{style:{fontSize:16,fontWeight:600,marginBottom:4},children:"Selecciona o crea un proyecto"}),e.jsx("div",{style:{fontSize:12,marginBottom:16},children:"Gestiona cronogramas, avances, hitos y equipo"}),e.jsxs(as,{on:w,children:[e.jsx(Pe,{size:12})," Crear proyecto"]})]})})]})]})]})}const qf=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),He={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",teal:"#0D5E6E",tealBg:"#E0F4F4",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Ei=()=>Math.random().toString(36).slice(2,9),ss=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"";function ls(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(async()=>{var r,s;try{const d=await((s=(r=window.storage)==null?void 0:r.get)==null?void 0:s.call(r,t));d!=null&&d.value&&n(JSON.parse(d.value))}catch{}})()},[t]);const a=F.useCallback(async r=>{var d,u;const s=typeof r=="function"?r(o):r;n(s);try{await((u=(d=window.storage)==null?void 0:d.set)==null?void 0:u.call(d,t,JSON.stringify(s)))}catch{}},[t,o]);return[o,a]}const Pn=({children:t,style:i})=>e.jsx("div",{style:{background:He.surface,border:`1px solid ${He.border}`,borderRadius:8,boxShadow:He.shadow,...i},children:t}),go=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${He.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":He.ink,color:i==="sec"?He.inkMid:"#fff",...a},...r,children:t}),Wr=[{id:"dashboard",lbl:"Dashboard",I:nr,desc:"Resumen de la biblioteca"},{id:"apus",lbl:"APUs",I:nr,desc:"Anlisis de precios unitarios normalizados"},{id:"materiales",lbl:"Materiales",I:zn,desc:"Catlogo maestro de materiales y precios"},{id:"textos",lbl:"Textos tipo",I:At,desc:"Plantillas de alcance, exclusiones y clusulas"},{id:"categorias",lbl:"Categoras",I:Bd,desc:"Organizacin por captulos y familias"}],Hf=[{id:Ei(),codigo:"APU-001",nombre:"Paete liso sobre muro e=1.5cm",unidad:"m",costo:28500,categoria:"Paetes",insumos:[{nombre:"Mortero 1:4",unidad:"m",cantidad:.018,precio:38e4},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.45,precio:22e3},{nombre:"Mano de obra ayudante",unidad:"h",cantidad:.35,precio:14e3},{nombre:"Herramienta menor",unidad:"gl",cantidad:.03,precio:5e4}]},{id:Ei(),codigo:"APU-002",nombre:"Mampostera en bloque No.5 e=12cm",unidad:"m",costo:62e3,categoria:"Mampostera",insumos:[{nombre:"Bloque No.5 (12x20x40)",unidad:"ud",cantidad:12.5,precio:2200},{nombre:"Mortero de pega 1:4",unidad:"m",cantidad:.015,precio:38e4},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.65,precio:22e3},{nombre:"Mano de obra ayudante",unidad:"h",cantidad:.5,precio:14e3}]},{id:Ei(),codigo:"APU-003",nombre:"Estuco sobre muro",unidad:"m",costo:18500,categoria:"Acabados",insumos:[{nombre:"Estuco plstico",unidad:"kg",cantidad:1.5,precio:3200},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.35,precio:22e3},{nombre:"Lija y herramienta",unidad:"gl",cantidad:.02,precio:3e4}]},{id:Ei(),codigo:"APU-004",nombre:"Pintura vinilo 2 manos tipo 1",unidad:"m",costo:14200,categoria:"Acabados",insumos:[{nombre:"Pintura vinilo tipo 1",unidad:"gl",cantidad:.065,precio:72e3},{nombre:"Rodillo y bandeja",unidad:"gl",cantidad:.01,precio:25e3},{nombre:"Mano de obra pintor",unidad:"h",cantidad:.3,precio:22e3}]},{id:Ei(),codigo:"APU-005",nombre:"Piso porcelanato 60x60",unidad:"m",costo:95e3,categoria:"Pisos",insumos:[{nombre:"Porcelanato 60x60",unidad:"m",cantidad:1.05,precio:55e3},{nombre:"Pegante para porcelanato",unidad:"kg",cantidad:5,precio:2800},{nombre:"Boquilla",unidad:"kg",cantidad:.5,precio:8500},{nombre:"Mano de obra enchapador",unidad:"h",cantidad:.8,precio:25e3}]}],Gf=[{id:Ei(),titulo:"Exclusiones estndar  Obra",categoria:"Exclusiones",texto:`Esta propuesta NO incluye, salvo acuerdo escrito:
- Licencias y permisos de construccin
- Obra de estructura o cimentacin no contemplada
- Suministro e instalacin de electrodomsticos
- Mudanzas y trasteos
- Diseo o rediseo arquitectnico
- Adecuaciones en zonas comunes
- Amoblamiento libre`},{id:Ei(),titulo:"Garantas estndar  Obra",categoria:"Garantas",texto:`Habitaris garantiza los trabajos ejecutados por un perodo de 12 meses:
- Estabilidad y solidez: 10 aos (Ley 1796)
- Impermeabilizacin: 5 aos
- Acabados y revestimientos: 1 ao
- Instalaciones: 1 ao
- Carpintera: 1 ao`},{id:Ei(),titulo:"Condiciones de pago  Obra integral",categoria:"Pagos",texto:`Forma de pago:
1. 50% Anticipo contra firma de contrato
2. 30% Contra avance del 50% de obra
3. 10% Contra finalizacin de obra
4. 10% Retencin de garanta (3 meses)`},{id:Ei(),titulo:"Trminos generales",categoria:"Trminos",texto:`Los precios incluyen materiales, mano de obra, herramienta y administracin.
Cualquier trabajo no contemplado se cotizar como adicional.
El cronograma podr ajustarse por fuerza mayor o cambios del cliente.`}];function Kf(){var m,x;const[t,i]=F.useState("dashboard"),[o,n]=ls("hab:biblioteca:apus",[]),[a,r]=ls("hab:biblioteca:textos",[]),[s,d]=ls("hab:biblioteca:categorias",["Paetes","Mampostera","Acabados","Pisos","Instalaciones","Carpintera","Demoliciones","Impermeabilizacin"]),[u,b]=F.useState(""),[j,w]=F.useState(null),S={border:`1px solid ${He.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx(qf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:He.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:He.surface,borderBottom:`1px solid ${He.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:He.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:He.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:He.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:He.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:He.inkLight},children:"/ Biblioteca"})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:He.surface,borderRight:`1px solid ${He.border}`,paddingTop:8,overflowY:"auto"},children:Wr.map(p=>e.jsxs("button",{onClick:()=>i(p.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===p.id?`3px solid ${He.ink}`:"3px solid transparent",background:t===p.id?He.accent:"transparent",color:t===p.id?He.ink:He.inkLight,fontSize:12,fontWeight:t===p.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(p.I,{size:13})," ",p.lbl]},p.id))}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700},children:(m=Wr.find(p=>p.id===t))==null?void 0:m.lbl}),e.jsx("p",{style:{fontSize:11,color:He.inkLight,marginTop:2},children:(x=Wr.find(p=>p.id===t))==null?void 0:x.desc})]}),t==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" APUs",o.length,"#111"],[" Materiales",materiales.length,"#3B3B3B"],[" Textos tipo",a.length,"#5B3A8C"],[" Categoras",s.length,"#8C6A00"]].map(([p,c,g])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${He.border}`,borderRadius:8,padding:"14px 16px",boxShadow:He.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:g},children:c})]},p))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12},children:Wr.filter(p=>p.id!=="dashboard").map(p=>e.jsxs("div",{onClick:()=>i(p.id),style:{background:He.surface,border:`1px solid ${He.border}`,borderRadius:8,padding:"18px 16px",cursor:"pointer",boxShadow:He.shadow},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx(p.I,{size:16,color:He.ink}),e.jsx("div",{style:{fontSize:13,fontWeight:700},children:p.lbl})]}),e.jsx("div",{style:{fontSize:10,color:He.inkLight},children:p.desc})]},p.id))})]}),t==="apus"&&e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsxs("div",{style:{position:"relative",flex:1},children:[e.jsx(vi,{size:12,style:{position:"absolute",left:8,top:9,color:He.inkLight}}),e.jsx("input",{value:u,onChange:p=>b(p.target.value),placeholder:"Buscar APU...",style:{...S,width:"100%",paddingLeft:26}})]}),e.jsxs(go,{sm:!0,on:()=>{const p={id:Ei(),codigo:`APU-${String(o.length+1).padStart(3,"0")}`,nombre:"Nuevo APU",unidad:"m",costo:0,categoria:"",insumos:[]};n(c=>[...c,p]),w(p.id)},children:[e.jsx(Pe,{size:10})," Nuevo APU"]}),o.length===0&&e.jsx(go,{sm:!0,v:"sec",on:()=>n(Hf),children:" Cargar ejemplos"})]}),e.jsxs(Pn,{style:{padding:0,overflow:"hidden"},children:[o.filter(p=>!u||p.nombre.toLowerCase().includes(u.toLowerCase())||p.codigo.toLowerCase().includes(u.toLowerCase())).map(p=>e.jsxs("div",{style:{borderBottom:`1px solid ${He.border}`},children:[e.jsxs("div",{onClick:()=>w(j===p.id?null:p.id),style:{padding:"10px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:j===p.id?He.surfaceAlt:"transparent"},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:He.teal,background:He.tealBg,padding:"2px 6px",borderRadius:3},children:p.codigo}),e.jsx("span",{style:{flex:1,fontSize:12,fontWeight:600},children:p.nombre}),e.jsx("span",{style:{fontSize:9,color:He.inkLight,background:He.surfaceAlt,padding:"2px 6px",borderRadius:3},children:p.categoria||""}),e.jsx("span",{style:{fontSize:10,color:He.inkMid},children:p.unidad}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700,color:He.green},children:["$",ss(p.costo)]}),j===p.id?e.jsx(Gi,{size:12,style:{transform:"rotate(90deg)"}}):e.jsx(Gi,{size:12})]}),j===p.id&&e.jsxs("div",{style:{padding:"0 16px 14px",background:He.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:He.inkLight,textTransform:"uppercase"},children:"Nombre"}),e.jsx("input",{value:p.nombre,onChange:c=>n(g=>g.map(l=>l.id===p.id?{...l,nombre:c.target.value}:l)),style:{...S,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:He.inkLight,textTransform:"uppercase"},children:"Cdigo"}),e.jsx("input",{value:p.codigo,onChange:c=>n(g=>g.map(l=>l.id===p.id?{...l,codigo:c.target.value}:l)),style:{...S,width:"100%",fontFamily:"'DM Mono',monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:He.inkLight,textTransform:"uppercase"},children:"Unidad"}),e.jsx("select",{value:p.unidad,onChange:c=>n(g=>g.map(l=>l.id===p.id?{...l,unidad:c.target.value}:l)),style:{...S,width:"100%"},children:["ud","m","m","m","ml","kg","gl","l","h","da"].map(c=>e.jsx("option",{children:c},c))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:He.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsxs("select",{value:p.categoria||"",onChange:c=>n(g=>g.map(l=>l.id===p.id?{...l,categoria:c.target.value}:l)),style:{...S,width:"100%"},children:[e.jsx("option",{value:"",children:""}),s.map(c=>e.jsx("option",{children:c},c))]})]})]}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:He.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Composicin"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:10},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:He.accent},children:["Insumo","Und","Cantidad","P.Unit","Subtotal",""].map(c=>e.jsx("th",{style:{padding:"4px 8px",textAlign:c==="Subtotal"||c==="P.Unit"||c==="Cantidad"?"right":"left",fontSize:8,fontWeight:700,color:He.inkLight},children:c},c))})}),e.jsxs("tbody",{children:[(p.insumos||[]).map((c,g)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${He.border}`},children:[e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{value:c.nombre,onChange:l=>{const f=[...p.insumos||[]];f[g]={...f[g],nombre:l.target.value},n(y=>y.map(h=>h.id===p.id?{...h,insumos:f}:h))},style:{border:"none",background:"transparent",width:"100%",fontSize:10}})}),e.jsx("td",{style:{padding:"4px 8px",width:40},children:e.jsx("input",{value:c.unidad,onChange:l=>{const f=[...p.insumos||[]];f[g]={...f[g],unidad:l.target.value},n(y=>y.map(h=>h.id===p.id?{...h,insumos:f}:h))},style:{border:"none",background:"transparent",width:30,fontSize:10,textAlign:"center"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:e.jsx("input",{type:"number",value:c.cantidad,onChange:l=>{const f=[...p.insumos||[]];f[g]={...f[g],cantidad:+l.target.value};const y=f.reduce((h,v)=>h+v.cantidad*v.precio,0);n(h=>h.map(v=>v.id===p.id?{...v,insumos:f,costo:Math.round(y)}:v))},style:{border:"none",background:"transparent",width:50,fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:e.jsx("input",{type:"number",value:c.precio,onChange:l=>{const f=[...p.insumos||[]];f[g]={...f[g],precio:+l.target.value};const y=f.reduce((h,v)=>h+v.cantidad*v.precio,0);n(h=>h.map(v=>v.id===p.id?{...v,insumos:f,costo:Math.round(y)}:v))},style:{border:"none",background:"transparent",width:70,fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",ss(Math.round(c.cantidad*c.precio))]}),e.jsx("td",{style:{padding:"4px 8px",width:24},children:e.jsx("button",{onClick:()=>{const l=(p.insumos||[]).filter((y,h)=>h!==g),f=l.reduce((y,h)=>y+h.cantidad*h.precio,0);n(y=>y.map(h=>h.id===p.id?{...h,insumos:l,costo:Math.round(f)}:h))},style:{background:"none",border:"none",color:He.red,cursor:"pointer"},children:e.jsx(qe,{size:10})})})]},g)),e.jsxs("tr",{style:{background:He.greenBg},children:[e.jsx("td",{colSpan:4,style:{padding:"6px 8px",fontWeight:700,fontSize:11},children:"COSTO DIRECTO"}),e.jsxs("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:He.green},children:["$",ss(p.costo)]}),e.jsx("td",{})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs(go,{sm:!0,v:"sec",on:()=>{const c=[...p.insumos||[],{nombre:"",unidad:"ud",cantidad:1,precio:0}];n(g=>g.map(l=>l.id===p.id?{...l,insumos:c}:l))},children:[e.jsx(Pe,{size:9})," Insumo"]}),e.jsxs(go,{sm:!0,v:"sec",on:()=>{var c;return(c=navigator.clipboard)==null?void 0:c.writeText(JSON.stringify(p,null,2))},children:[e.jsx(da,{size:9})," Copiar JSON"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{onClick:()=>n(c=>c.filter(g=>g.id!==p.id)),style:{background:"none",border:"none",color:He.red,fontSize:10,cursor:"pointer"},children:" Eliminar APU"})]})]})]},p.id)),o.length===0&&e.jsx("div",{style:{padding:30,textAlign:"center",color:He.inkLight},children:"Sin APUs. Carga los ejemplos o crea uno nuevo."})]})]}),t==="materiales"&&e.jsx("div",{className:"fade-up",children:e.jsxs(Pn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,marginBottom:4},children:"Catlogo maestro de materiales"}),e.jsx("div",{style:{fontSize:11,color:He.inkLight,marginBottom:14},children:"Los materiales del catlogo se sincronizan con el mdulo de Insumos del CRM."}),e.jsxs("div",{style:{padding:20,textAlign:"center",background:He.surfaceAlt,borderRadius:6,border:`1px solid ${He.border}`},children:[e.jsx(nr,{size:24,style:{color:He.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:He.inkMid},children:"El catlogo maestro se gestiona desde el tab de Insumos en cada oferta del CRM"}),e.jsx("div",{style:{fontSize:10,color:He.inkLight,marginTop:4},children:"Los precios de proveedores se centralizan all con cotizaciones comparativas"})]})]})}),t==="textos"&&e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsx("div",{style:{flex:1}}),e.jsxs(go,{sm:!0,on:()=>r(p=>[...p,{id:Ei(),titulo:"Nuevo texto",categoria:"",texto:""}]),children:[e.jsx(Pe,{size:10})," Nuevo texto"]}),a.length===0&&e.jsx(go,{sm:!0,v:"sec",on:()=>r(Gf),children:" Cargar ejemplos"})]}),a.map(p=>e.jsxs(Pn,{style:{padding:16,marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6,alignItems:"center"},children:[e.jsx("input",{value:p.titulo,onChange:c=>r(g=>g.map(l=>l.id===p.id?{...l,titulo:c.target.value}:l)),style:{flex:1,border:"none",background:"transparent",fontSize:14,fontWeight:700}}),e.jsxs("select",{value:p.categoria||"",onChange:c=>r(g=>g.map(l=>l.id===p.id?{...l,categoria:c.target.value}:l)),style:{...S,width:120,fontSize:10},children:[e.jsx("option",{value:"",children:"Sin categora"}),["Alcance","Exclusiones","Garantas","Pagos","Trminos","Legal","Otro"].map(c=>e.jsx("option",{children:c},c))]}),e.jsxs(go,{sm:!0,v:"sec",on:()=>{var c;return(c=navigator.clipboard)==null?void 0:c.writeText(p.texto)},children:[e.jsx(da,{size:9})," Copiar"]}),e.jsx("button",{onClick:()=>r(c=>c.filter(g=>g.id!==p.id)),style:{background:"none",border:"none",color:He.red,cursor:"pointer"},children:e.jsx(qe,{size:12})})]}),e.jsx("textarea",{value:p.texto,onChange:c=>r(g=>g.map(l=>l.id===p.id?{...l,texto:c.target.value}:l)),rows:5,style:{width:"100%",border:`1px solid ${He.border}`,borderRadius:4,padding:"8px 10px",fontSize:11,resize:"vertical",lineHeight:1.6,background:He.surfaceAlt}})]},p.id)),a.length===0&&e.jsx(Pn,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:He.inkLight},children:"Sin textos tipo. Carga los ejemplos o crea uno nuevo."})})]}),t==="categorias"&&e.jsx("div",{className:"fade-up",children:e.jsxs(Pn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Categoras de APUs"}),s.map((p,c)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 0",borderBottom:`1px solid ${He.border}`},children:[e.jsx(Bd,{size:12,color:He.teal}),e.jsx("input",{value:p,onChange:g=>{const l=[...s];l[c]=g.target.value,d(l)},style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:500}}),e.jsxs("span",{style:{fontSize:9,color:He.inkLight},children:[o.filter(g=>g.categoria===p).length," APUs"]}),e.jsx("button",{onClick:()=>d(g=>g.filter((l,f)=>f!==c)),style:{background:"none",border:"none",color:He.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})]},c)),e.jsxs(go,{sm:!0,v:"sec",on:()=>d(p=>[...p,"Nueva categora"]),style:{marginTop:10},children:[e.jsx(Pe,{size:10})," Aadir categora"]})]})})]})]})]})]})}const Jf=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),We={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},od=()=>Math.random().toString(36).slice(2,9),nd=()=>new Date().toISOString().split("T")[0],Io=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"$0",Yf=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function rd(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(async()=>{var r,s;try{const d=await((s=(r=window.storage)==null?void 0:r.get)==null?void 0:s.call(r,t));d!=null&&d.value&&n(JSON.parse(d.value))}catch{}})()},[t]);const a=F.useCallback(async r=>{var d,u;const s=typeof r=="function"?r(o):r;n(s);try{await((u=(d=window.storage)==null?void 0:d.set)==null?void 0:u.call(d,t,JSON.stringify(s)))}catch{}},[t,o]);return[o,a]}const nn=({children:t,style:i})=>e.jsx("div",{style:{background:We.surface,border:`1px solid ${We.border}`,borderRadius:8,boxShadow:We.shadow,...i},children:t}),Nr=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${We.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":We.ink,color:i==="sec"?We.inkMid:"#fff",cursor:"pointer",...a},...r,children:t}),Xf=[{id:"dashboard",lbl:"Dashboard",I:Aa,desc:"Resumen financiero del perodo"},{id:"ingresos",lbl:"Ingresos",I:Id,desc:"Facturacin, cobros y anticipos"},{id:"egresos",lbl:"Egresos",I:Rd,desc:"Pagos, compras y nmina"},{id:"facturas",lbl:"Facturas",I:Md,desc:"Emisin y seguimiento de facturas"},{id:"costos",lbl:"Costos reales",I:_d,desc:"Comparacin presupuesto vs ejecucin"},{id:"informes",lbl:"Informes",I:At,desc:"Reportes financieros y tributarios"}];function Qf(){const[t,i]=F.useState("dashboard"),[o,n]=rd("hab:conta:movimientos",[]),[a,r]=rd("hab:conta:facturas",[]),s=o.filter(c=>c.tipo==="ingreso"),d=o.filter(c=>c.tipo==="egreso"),u=s.reduce((c,g)=>c+(g.monto||0),0),b=d.reduce((c,g)=>c+(g.monto||0),0),j=u-b,w=c=>{const g={id:od(),tipo:c,fecha:nd(),concepto:"",monto:0,categoria:"",proyecto:"",estado:"registrado"};n(l=>[...l,g])},S=(c,g,l)=>n(f=>f.map(y=>y.id===c?{...y,[g]:l}:y)),m=c=>n(g=>g.filter(l=>l.id!==c)),x=()=>{const c={id:od(),numero:`FV-${String(a.length+1).padStart(4,"0")}`,fecha:nd(),cliente:"",concepto:"",subtotal:0,iva:0,total:0,estado:"borrador"};r(g=>[...g,c])},p={border:`1px solid ${We.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx(Jf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:We.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:We.surface,borderBottom:`1px solid ${We.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:We.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:We.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:We.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:We.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:We.inkLight},children:"/ Contabilidad"})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:We.surface,borderRight:`1px solid ${We.border}`,paddingTop:8},children:Xf.map(c=>e.jsxs("button",{onClick:()=>i(c.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===c.id?`3px solid ${We.ink}`:"3px solid transparent",background:t===c.id?We.accent:"transparent",color:t===c.id?We.ink:We.inkLight,fontSize:12,fontWeight:t===c.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(c.I,{size:13})," ",c.lbl]},c.id))}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Ingresos",val:Io(u),color:We.green,bg:We.greenBg,icon:Id},{lbl:"Egresos",val:Io(b),color:We.red,bg:We.redBg,icon:Rd},{lbl:"Balance",val:Io(j),color:j>=0?We.green:We.red,bg:j>=0?We.greenBg:We.redBg,icon:mr},{lbl:"Facturas",val:a.length,color:We.blue,bg:We.blueBg,icon:Md}].map(c=>e.jsx(nn,{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:We.inkLight,textTransform:"uppercase",letterSpacing:1},children:c.lbl}),e.jsx("div",{style:{fontSize:22,fontWeight:800,color:c.color,marginTop:4,fontFamily:"'DM Mono',monospace"},children:c.val})]}),e.jsx("div",{style:{width:32,height:32,borderRadius:8,background:c.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(c.icon,{size:16,color:c.color})})]})},c.lbl))}),e.jsxs(nn,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${We.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"ltimos movimientos"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(Nr,{sm:!0,on:()=>w("ingreso"),style:{background:We.green},children:[e.jsx(Pe,{size:10})," Ingreso"]}),e.jsxs(Nr,{sm:!0,on:()=>w("egreso"),style:{background:We.red},children:[e.jsx(Pe,{size:10})," Egreso"]})]})]}),o.length===0?e.jsx("div",{style:{padding:30,textAlign:"center",color:We.inkLight},children:"Sin movimientos registrados"}):[...o].sort((c,g)=>g.fecha>c.fecha?1:-1).slice(0,15).map(c=>e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11},children:[e.jsx("span",{style:{fontSize:14},children:c.tipo==="ingreso"?"":""}),e.jsx("span",{style:{fontSize:10,color:We.inkLight},children:Yf(c.fecha)}),e.jsx("span",{style:{flex:1,fontWeight:500},children:c.concepto||"Sin concepto"}),c.proyecto&&e.jsx("span",{style:{fontSize:9,padding:"2px 6px",background:We.blueBg,color:We.blue,borderRadius:3},children:c.proyecto}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:c.tipo==="ingreso"?We.green:We.red},children:[c.tipo==="ingreso"?"+":"","$",Io(c.monto)]})]},c.id))]})]}),(t==="ingresos"||t==="egresos")&&(()=>{const c=t==="ingresos"?"ingreso":"egreso",g=o.filter(l=>l.tipo===c);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:t==="ingresos"?"Registro de ingresos":"Registro de egresos"}),e.jsxs(Nr,{sm:!0,on:()=>w(c),style:{background:c==="ingreso"?We.green:We.red},children:[e.jsx(Pe,{size:10})," Nuevo ",c]})]}),e.jsx(nn,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:We.surfaceAlt},children:["Fecha","Concepto","Categora","Proyecto","Monto","Estado",""].map(l=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:We.inkLight,textTransform:"uppercase",textAlign:l==="Monto"?"right":"left",borderBottom:`2px solid ${We.border}`},children:l},l))})}),e.jsxs("tbody",{children:[g.sort((l,f)=>f.fecha>l.fecha?1:-1).map(l=>e.jsxs("tr",{style:{borderBottom:`1px solid ${We.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.fecha,onChange:f=>S(l.id,"fecha",f.target.value),style:{...p,padding:"3px 6px",fontSize:10,border:"none",background:"transparent"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.concepto,onChange:f=>S(l.id,"concepto",f.target.value),placeholder:"Concepto...",style:{border:"none",background:"transparent",fontSize:12,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsxs("select",{value:l.categoria||"",onChange:f=>S(l.id,"categoria",f.target.value),style:{...p,fontSize:10,padding:"3px 6px",border:"none",background:"transparent"},children:[e.jsx("option",{value:"",children:""}),(c==="ingreso"?["Anticipo","Corte de obra","Diseo","Consultora","Otro"]:["Materiales","Mano de obra","Subcontrato","Equipos","Transporte","Servicios","Otro"]).map(f=>e.jsx("option",{children:f},f))]})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.proyecto||"",onChange:f=>S(l.id,"proyecto",f.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right"},children:e.jsx("input",{type:"number",value:l.monto||"",onChange:f=>S(l.id,"monto",+f.target.value),style:{border:`1px solid ${We.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,width:100,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:l.estado,onChange:f=>S(l.id,"estado",f.target.value),style:{...p,fontSize:9,padding:"2px 6px"},children:["registrado","pendiente","pagado","anulado"].map(f=>e.jsx("option",{children:f},f))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>m(l.id),style:{background:"none",border:"none",color:We.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})})]},l.id)),g.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:7,style:{padding:20,textAlign:"center",color:We.inkLight},children:["Sin ",c,"s registrados"]})}),g.length>0&&e.jsxs("tr",{style:{background:c==="ingreso"?We.greenBg:We.redBg},children:[e.jsx("td",{colSpan:4,style:{padding:"8px 10px",fontWeight:700},children:"TOTAL"}),e.jsxs("td",{style:{padding:"8px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:c==="ingreso"?We.green:We.red},children:["$",Io(g.reduce((l,f)=>l+(f.monto||0),0))]}),e.jsx("td",{colSpan:2})]})]})]})})]})})(),t==="facturas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Facturacin"}),e.jsxs(Nr,{sm:!0,on:x,children:[e.jsx(Pe,{size:10})," Nueva factura"]})]}),e.jsx(nn,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:We.surfaceAlt},children:["N","Fecha","Cliente","Concepto","Subtotal","IVA","Total","Estado",""].map(c=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:We.inkLight,textTransform:"uppercase",textAlign:["Subtotal","IVA","Total"].includes(c)?"right":"left",borderBottom:`2px solid ${We.border}`},children:c},c))})}),e.jsxs("tbody",{children:[a.map(c=>e.jsxs("tr",{style:{borderBottom:`1px solid ${We.border}`},children:[e.jsx("td",{style:{padding:"6px 10px",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:700},children:c.numero}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:c.fecha,onChange:g=>r(l=>l.map(f=>f.id===c.id?{...f,fecha:g.target.value}:f)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:c.cliente,onChange:g=>r(l=>l.map(f=>f.id===c.id?{...f,cliente:g.target.value}:f)),placeholder:"Cliente",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:c.concepto,onChange:g=>r(l=>l.map(f=>f.id===c.id?{...f,concepto:g.target.value}:f)),placeholder:"Concepto",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right"},children:e.jsx("input",{type:"number",value:c.subtotal||"",onChange:g=>{const l=+g.target.value,f=Math.round(l*.19);r(y=>y.map(h=>h.id===c.id?{...h,subtotal:l,iva:f,total:l+f}:h))},style:{border:`1px solid ${We.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,width:80,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:We.inkLight},children:Io(c.iva)}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700},children:Io(c.total)}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:c.estado,onChange:g=>r(l=>l.map(f=>f.id===c.id?{...f,estado:g.target.value}:f)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${We.border}`,borderRadius:3,background:c.estado==="pagada"?We.greenBg:c.estado==="enviada"?We.blueBg:"#fff"},children:["borrador","enviada","pagada","anulada"].map(g=>e.jsx("option",{children:g},g))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>r(g=>g.filter(l=>l.id!==c.id)),style:{background:"none",border:"none",color:We.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})})]},c.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:30,textAlign:"center",color:We.inkLight},children:"Sin facturas"})})]})]})})]}),t==="costos"&&e.jsxs(nn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:4},children:"Control de costos reales"}),e.jsx("div",{style:{fontSize:11,color:We.inkLight,marginBottom:14},children:"Comparacin entre presupuesto aprobado y ejecucin real"}),e.jsxs("div",{style:{padding:30,textAlign:"center",background:We.surfaceAlt,borderRadius:6,border:`1px solid ${We.border}`},children:[e.jsx(_d,{size:32,style:{color:We.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:We.inkMid},children:"Se alimenta automticamente de los egresos registrados por proyecto"}),e.jsx("div",{style:{fontSize:10,color:We.inkLight,marginTop:4},children:"Registra egresos asociados a un proyecto para ver el comparativo"})]})]}),t==="informes"&&e.jsxs(nn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Informes financieros"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[{lbl:"Estado de resultados",desc:"P&L por perodo con ingresos y gastos",icon:""},{lbl:"Flujo de caja real",desc:"Entradas y salidas por mes",icon:""},{lbl:"Cuentas por cobrar",desc:"Facturas pendientes de cobro",icon:""},{lbl:"Cuentas por pagar",desc:"Obligaciones pendientes con proveedores",icon:""},{lbl:"Retenciones",desc:"Retencin en la fuente, ICA, IVA",icon:""},{lbl:"Reporte DIAN",desc:"Informacin exgena y declaraciones",icon:""}].map(c=>e.jsxs("div",{style:{padding:"14px 16px",background:We.surfaceAlt,borderRadius:6,border:`1px solid ${We.border}`,cursor:"pointer"},onMouseEnter:g=>g.currentTarget.style.borderColor=We.blue,onMouseLeave:g=>g.currentTarget.style.borderColor=We.border,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:18},children:c.icon}),e.jsx("span",{style:{fontSize:12,fontWeight:700},children:c.lbl})]}),e.jsx("div",{style:{fontSize:10,color:We.inkLight},children:c.desc})]},c.lbl))})]})]})})]})]})]})}const Zf=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Be={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},On=()=>Math.random().toString(36).slice(2,9),Ln=()=>new Date().toISOString().split("T")[0];function Wn(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(async()=>{var r,s;try{const d=await((s=(r=window.storage)==null?void 0:r.get)==null?void 0:s.call(r,t));d!=null&&d.value&&n(JSON.parse(d.value))}catch{}})()},[t]);const a=F.useCallback(async r=>{var d,u;const s=typeof r=="function"?r(o):r;n(s);try{await((u=(d=window.storage)==null?void 0:d.set)==null?void 0:u.call(d,t,JSON.stringify(s)))}catch{}},[t,o]);return[o,a]}const Ii=({children:t,style:i})=>e.jsx("div",{style:{background:Be.surface,border:`1px solid ${Be.border}`,borderRadius:8,boxShadow:Be.shadow,...i},children:t}),Nn=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Be.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":Be.ink,color:i==="sec"?Be.inkMid:"#fff",cursor:"pointer",...a},...r,children:t}),ex=[{id:"dashboard",lbl:"Dashboard",I:Uc,desc:"Indicadores de seguridad"},{id:"inspecciones",lbl:"Inspecciones",I:Vc,desc:"Inspecciones programadas y realizadas"},{id:"incidentes",lbl:"Incidentes",I:si,desc:"Registro de accidentes e incidentes"},{id:"riesgos",lbl:"Matriz de riesgos",I:Tn,desc:"Identificacin y valoracin de riesgos"},{id:"capacitaciones",lbl:"Capacitaciones",I:Fi,desc:"Programa de formacin SST"},{id:"permisos",lbl:"Permisos trabajo",I:At,desc:"Permisos de trabajo en alturas, caliente, confinado"},{id:"epps",lbl:"EPPs",I:kn,desc:"Control de entrega de EPPs y dotacin"}],tx=["Cada de alturas","Elctrico","Mecnico","Qumico","Biolgico","Ergonmico","Psicosocial","Trabajo en caliente","Espacio confinado","Excavaciones"],ds=[{id:1,lbl:"Bajo",color:Be.green,bg:Be.greenBg},{id:2,lbl:"Medio",color:Be.amber,bg:Be.amberBg},{id:3,lbl:"Alto",color:"#D4840A",bg:"#FFF3E0"},{id:4,lbl:"Crtico",color:Be.red,bg:Be.redBg}];function ix(){const[t,i]=F.useState("dashboard"),[o,n]=Wn("hab:sst:inspecciones",[]),[a,r]=Wn("hab:sst:incidentes",[]),[s,d]=Wn("hab:sst:riesgos",[]),[u,b]=Wn("hab:sst:capacitaciones",[]),[j,w]=Wn("hab:sst:permisos",[]),S={border:`1px solid ${Be.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},m=(()=>{if(a.length===0)return"";const x=[...a].sort((p,c)=>c.fecha>p.fecha?1:-1)[0];return Math.floor((Date.now()-new Date(x.fecha).getTime())/864e5)})();return e.jsxs(e.Fragment,{children:[e.jsx(Zf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Be.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Be.surface,borderBottom:`1px solid ${Be.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Be.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Be.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Be.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Be.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Be.inkLight},children:"/ SST"}),e.jsx("div",{style:{flex:1}}),a.filter(x=>x.estado==="abierto").length>0&&e.jsxs("div",{style:{background:Be.redBg,border:`1px solid ${Be.red}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(si,{size:12,color:Be.red}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:Be.red},children:[a.filter(x=>x.estado==="abierto").length," incidente",a.filter(x=>x.estado==="abierto").length!==1?"s":""," abierto",a.filter(x=>x.estado==="abierto").length!==1?"s":""]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:210,flexShrink:0,background:Be.surface,borderRight:`1px solid ${Be.border}`,paddingTop:8,overflowY:"auto"},children:ex.map(x=>{const p=t===x.id,c=x.id==="incidentes"?a.filter(g=>g.estado==="abierto").length:x.id==="inspecciones"?o.filter(g=>g.estado==="pendiente").length:0;return e.jsxs("button",{onClick:()=>i(x.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:p?`3px solid ${Be.ink}`:"3px solid transparent",background:p?Be.accent:"transparent",color:p?Be.ink:Be.inkLight,fontSize:12,fontWeight:p?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(x.I,{size:13})," ",e.jsx("span",{style:{flex:1},children:x.lbl}),c>0&&e.jsx("span",{style:{background:Be.red,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:c})]},x.id)})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Das sin incidentes",val:m,color:Be.green,bg:Be.greenBg},{lbl:"Inspecciones mes",val:o.filter(x=>{const p=new Date(x.fecha),c=new Date;return p.getMonth()===c.getMonth()&&p.getFullYear()===c.getFullYear()}).length,color:Be.blue,bg:Be.blueBg},{lbl:"Incidentes abiertos",val:a.filter(x=>x.estado==="abierto").length,color:Be.red,bg:Be.redBg},{lbl:"Riesgos altos",val:s.filter(x=>x.severidad>=3).length,color:Be.amber,bg:Be.amberBg},{lbl:"Capacitaciones",val:u.length,color:"#5B3A8C",bg:"#F0ECF6"}].map(x=>e.jsxs(Ii,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Be.inkLight,textTransform:"uppercase",letterSpacing:1},children:x.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:x.color,marginTop:4},children:x.val})]},x.lbl))}),e.jsxs(Ii,{style:{padding:24,marginBottom:16,background:m===""||m>30?Be.greenBg:m>7?Be.amberBg:Be.redBg,border:`1px solid ${m===""||m>30?Be.green:m>7?Be.amber:Be.red}33`,textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:48,fontWeight:800,color:m===""||m>30?Be.green:m>7?Be.amber:Be.red},children:[" ",m]}),e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Be.ink,marginTop:4},children:"Das sin incidentes"}),e.jsx("div",{style:{fontSize:11,color:Be.inkMid},children:"Seguridad es responsabilidad de todos"})]})]}),t==="inspecciones"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Inspecciones de seguridad"}),e.jsxs(Nn,{sm:!0,on:()=>n(x=>[...x,{id:On(),fecha:Ln(),tipo:"General",ubicacion:"",inspector:"",estado:"pendiente",hallazgos:"",calificacion:0}]),children:[e.jsx(Pe,{size:10})," Nueva inspeccin"]})]}),e.jsx(Ii,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Be.surfaceAlt},children:["Fecha","Tipo","Ubicacin","Inspector","Estado","Hallazgos","Calif.",""].map(x=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Be.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${Be.border}`},children:x},x))})}),e.jsxs("tbody",{children:[o.sort((x,p)=>p.fecha>x.fecha?1:-1).map(x=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Be.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:x.fecha,onChange:p=>n(c=>c.map(g=>g.id===x.id?{...g,fecha:p.target.value}:g)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:x.tipo,onChange:p=>n(c=>c.map(g=>g.id===x.id?{...g,tipo:p.target.value}:g)),style:{border:"none",background:"transparent",fontSize:11},children:["General","Alturas","Elctrica","Orden y aseo","EPPs","Herramientas","Sealizacin","Excavaciones"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.ubicacion,onChange:p=>n(c=>c.map(g=>g.id===x.id?{...g,ubicacion:p.target.value}:g)),placeholder:"Zona...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.inspector,onChange:p=>n(c=>c.map(g=>g.id===x.id?{...g,inspector:p.target.value}:g)),placeholder:"Nombre",style:{border:"none",background:"transparent",fontSize:11,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:x.estado,onChange:p=>n(c=>c.map(g=>g.id===x.id?{...g,estado:p.target.value}:g)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3,background:x.estado==="realizada"?Be.greenBg:x.estado==="pendiente"?Be.amberBg:"#fff"},children:["pendiente","realizada","cancelada"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.hallazgos||"",onChange:p=>n(c=>c.map(g=>g.id===x.id?{...g,hallazgos:p.target.value}:g)),placeholder:"Observaciones...",style:{border:"none",background:"transparent",fontSize:10,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"number",min:0,max:100,value:x.calificacion||"",onChange:p=>n(c=>c.map(g=>g.id===x.id?{...g,calificacion:+p.target.value}:g)),style:{width:36,border:`1px solid ${Be.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>n(p=>p.filter(c=>c.id!==x.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})})]},x.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:Be.inkLight},children:"Sin inspecciones"})})]})]})})]}),t==="incidentes"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Registro de incidentes"}),e.jsxs(Nn,{sm:!0,on:()=>r(x=>[...x,{id:On(),fecha:Ln(),tipo:"Incidente",descripcion:"",ubicacion:"",personas:"",severidad:1,estado:"abierto",accionCorrectiva:""}]),style:{background:Be.red},children:[e.jsx(Pe,{size:10})," Reportar incidente"]})]}),a.sort((x,p)=>p.fecha>x.fecha?1:-1).map(x=>{const p=ds.find(c=>c.id===x.severidad)||ds[0];return e.jsx(Ii,{style:{padding:14,marginBottom:8,borderLeft:`4px solid ${p.color}`},children:e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"2px 6px",borderRadius:3,background:p.bg,color:p.color},children:p.lbl}),e.jsx("select",{value:x.tipo,onChange:c=>r(g=>g.map(l=>l.id===x.id?{...l,tipo:c.target.value}:l)),style:{border:"none",background:"transparent",fontSize:10,fontWeight:600},children:["Incidente","Accidente","Casi-accidente","Condicin insegura","Acto inseguro"].map(c=>e.jsx("option",{children:c},c))}),e.jsx("input",{type:"date",value:x.fecha,onChange:c=>r(g=>g.map(l=>l.id===x.id?{...l,fecha:c.target.value}:l)),style:{border:"none",background:"transparent",fontSize:10,color:Be.inkLight}}),e.jsx("div",{style:{flex:1}}),e.jsx("select",{value:x.estado,onChange:c=>r(g=>g.map(l=>l.id===x.id?{...l,estado:c.target.value}:l)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3,background:x.estado==="cerrado"?Be.greenBg:Be.redBg},children:["abierto","en investigacin","cerrado"].map(c=>e.jsx("option",{children:c},c))}),e.jsx("select",{value:x.severidad,onChange:c=>r(g=>g.map(l=>l.id===x.id?{...l,severidad:+c.target.value}:l)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3},children:ds.map(c=>e.jsx("option",{value:c.id,children:c.lbl},c.id))})]}),e.jsx("textarea",{value:x.descripcion,onChange:c=>r(g=>g.map(l=>l.id===x.id?{...l,descripcion:c.target.value}:l)),placeholder:"Descripcin del incidente...",rows:2,style:{width:"100%",border:`1px solid ${Be.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,resize:"vertical",background:Be.surfaceAlt}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:6},children:[e.jsx("input",{value:x.ubicacion||"",onChange:c=>r(g=>g.map(l=>l.id===x.id?{...l,ubicacion:c.target.value}:l)),placeholder:" Ubicacin",style:{...S,fontSize:10}}),e.jsx("input",{value:x.personas||"",onChange:c=>r(g=>g.map(l=>l.id===x.id?{...l,personas:c.target.value}:l)),placeholder:" Personas involucradas",style:{...S,fontSize:10}})]}),e.jsx("input",{value:x.accionCorrectiva||"",onChange:c=>r(g=>g.map(l=>l.id===x.id?{...l,accionCorrectiva:c.target.value}:l)),placeholder:" Accin correctiva...",style:{...S,width:"100%",fontSize:10,marginTop:6}})]}),e.jsx("button",{onClick:()=>r(c=>c.filter(g=>g.id!==x.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(qe,{size:12})})]})},x.id)}),a.length===0&&e.jsx(Ii,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Be.inkLight},children:"Sin incidentes registrados "})})]}),t==="riesgos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Matriz de riesgos"}),e.jsxs(Nn,{sm:!0,on:()=>d(x=>[...x,{id:On(),tipo:"Cada de alturas",actividad:"",control:"",severidad:2,probabilidad:2,responsable:""}]),children:[e.jsx(Pe,{size:10})," Nuevo riesgo"]})]}),e.jsx(Ii,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Be.surfaceAlt},children:["Tipo de riesgo","Actividad","Control existente","Sev.","Prob.","Nivel","Responsable",""].map(x=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Be.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${Be.border}`},children:x},x))})}),e.jsxs("tbody",{children:[s.map(x=>{const p=(x.severidad||1)*(x.probabilidad||1),c=p>=9?Be.red:p>=4?Be.amber:Be.green;return e.jsxs("tr",{style:{borderBottom:`1px solid ${Be.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:x.tipo,onChange:g=>d(l=>l.map(f=>f.id===x.id?{...f,tipo:g.target.value}:f)),style:{border:"none",background:"transparent",fontSize:11,fontWeight:600},children:tx.map(g=>e.jsx("option",{children:g},g))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.actividad||"",onChange:g=>d(l=>l.map(f=>f.id===x.id?{...f,actividad:g.target.value}:f)),placeholder:"Actividad...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.control||"",onChange:g=>d(l=>l.map(f=>f.id===x.id?{...f,control:g.target.value}:f)),placeholder:"Medida de control...",style:{border:"none",background:"transparent",fontSize:10,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:x.severidad,onChange:g=>d(l=>l.map(f=>f.id===x.id?{...f,severidad:+g.target.value}:f)),style:{width:42,fontSize:10,border:`1px solid ${Be.border}`,borderRadius:3,textAlign:"center"},children:[1,2,3,4].map(g=>e.jsx("option",{value:g,children:g},g))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:x.probabilidad,onChange:g=>d(l=>l.map(f=>f.id===x.id?{...f,probabilidad:+g.target.value}:f)),style:{width:42,fontSize:10,border:`1px solid ${Be.border}`,borderRadius:3,textAlign:"center"},children:[1,2,3,4].map(g=>e.jsx("option",{value:g,children:g},g))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("span",{style:{fontSize:10,fontWeight:700,padding:"2px 8px",borderRadius:3,background:c+"18",color:c},children:p})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.responsable||"",onChange:g=>d(l=>l.map(f=>f.id===x.id?{...f,responsable:g.target.value}:f)),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>d(g=>g.filter(l=>l.id!==x.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})})]},x.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:Be.inkLight},children:"Sin riesgos identificados"})})]})]})})]}),t==="capacitaciones"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Programa de capacitaciones"}),e.jsxs(Nn,{sm:!0,on:()=>b(x=>[...x,{id:On(),fecha:Ln(),tema:"",duracion:1,instructor:"",asistentes:0,estado:"programada"}]),children:[e.jsx(Pe,{size:10})," Nueva capacitacin"]})]}),u.sort((x,p)=>p.fecha>x.fecha?1:-1).map(x=>e.jsx(Ii,{style:{padding:14,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("input",{type:"date",value:x.fecha,onChange:p=>b(c=>c.map(g=>g.id===x.id?{...g,fecha:p.target.value}:g)),style:{border:`1px solid ${Be.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:x.tema,onChange:p=>b(c=>c.map(g=>g.id===x.id?{...g,tema:p.target.value}:g)),placeholder:"Tema de la capacitacin",style:{flex:1,border:"none",background:"transparent",fontSize:13,fontWeight:600}}),e.jsx("span",{style:{fontSize:9,color:Be.inkLight},children:"Duracin:"}),e.jsx("input",{type:"number",value:x.duracion,onChange:p=>b(c=>c.map(g=>g.id===x.id?{...g,duracion:+p.target.value}:g)),style:{width:36,border:`1px solid ${Be.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center"}}),e.jsx("span",{style:{fontSize:9,color:Be.inkLight},children:"h"}),e.jsx("input",{value:x.instructor||"",onChange:p=>b(c=>c.map(g=>g.id===x.id?{...g,instructor:p.target.value}:g)),placeholder:"Instructor",style:{width:100,border:`1px solid ${Be.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("span",{style:{fontSize:9,color:Be.inkLight},children:"Asist:"}),e.jsx("input",{type:"number",value:x.asistentes||"",onChange:p=>b(c=>c.map(g=>g.id===x.id?{...g,asistentes:+p.target.value}:g)),style:{width:36,border:`1px solid ${Be.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center"}}),e.jsx("select",{value:x.estado,onChange:p=>b(c=>c.map(g=>g.id===x.id?{...g,estado:p.target.value}:g)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3,background:x.estado==="realizada"?Be.greenBg:"#fff"},children:["programada","realizada","cancelada"].map(p=>e.jsx("option",{children:p},p))}),e.jsx("button",{onClick:()=>b(p=>p.filter(c=>c.id!==x.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})]})},x.id)),u.length===0&&e.jsx(Ii,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Be.inkLight},children:"Sin capacitaciones programadas"})})]}),t==="permisos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Permisos de trabajo"}),e.jsxs(Nn,{sm:!0,on:()=>w(x=>[...x,{id:On(),fecha:Ln(),tipo:"Alturas",actividad:"",ubicacion:"",responsable:"",vigencia:Ln(),estado:"activo"}]),children:[e.jsx(Pe,{size:10})," Nuevo permiso"]})]}),e.jsx(Ii,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Be.surfaceAlt},children:["Fecha","Tipo","Actividad","Ubicacin","Responsable","Vigencia","Estado",""].map(x=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Be.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${Be.border}`},children:x},x))})}),e.jsxs("tbody",{children:[j.sort((x,p)=>p.fecha>x.fecha?1:-1).map(x=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Be.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:x.fecha,onChange:p=>w(c=>c.map(g=>g.id===x.id?{...g,fecha:p.target.value}:g)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:x.tipo,onChange:p=>w(c=>c.map(g=>g.id===x.id?{...g,tipo:p.target.value}:g)),style:{border:"none",background:"transparent",fontSize:11,fontWeight:600},children:["Alturas","Trabajo en caliente","Espacio confinado","Excavaciones","Elctrico","Izaje de cargas"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.actividad||"",onChange:p=>w(c=>c.map(g=>g.id===x.id?{...g,actividad:p.target.value}:g)),placeholder:"Actividad...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.ubicacion||"",onChange:p=>w(c=>c.map(g=>g.id===x.id?{...g,ubicacion:p.target.value}:g)),placeholder:"Zona",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:x.responsable||"",onChange:p=>w(c=>c.map(g=>g.id===x.id?{...g,responsable:p.target.value}:g)),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:x.vigencia,onChange:p=>w(c=>c.map(g=>g.id===x.id?{...g,vigencia:p.target.value}:g)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:x.estado,onChange:p=>w(c=>c.map(g=>g.id===x.id?{...g,estado:p.target.value}:g)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3,background:x.estado==="activo"?Be.greenBg:Be.redBg},children:["activo","cerrado","cancelado"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>w(p=>p.filter(c=>c.id!==x.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})})]},x.id)),j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:Be.inkLight},children:"Sin permisos"})})]})]})})]}),t==="epps"&&e.jsxs(Ii,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:4},children:"Control de EPPs y dotacin"}),e.jsx("div",{style:{fontSize:11,color:Be.inkLight,marginBottom:14},children:"El inventario de EPPs se gestiona desde el mdulo de Logstica"}),e.jsxs("div",{style:{padding:20,textAlign:"center",background:Be.surfaceAlt,borderRadius:6,border:`1px solid ${Be.border}`},children:[e.jsx(kn,{size:32,style:{color:Be.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:Be.inkMid},children:"El control de entrega y reposicin se sincroniza con Logstica  EPPs"})]})]})]})})]})]})]})}const ne={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",success:"#111111",successBg:"#EBEBEB",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},Ee={fontFamily:"'DM Sans',sans-serif"},Gs="hab:formacion:",Ur=t=>{try{return JSON.parse(localStorage.getItem(Gs+t))||null}catch{return null}},Vr=(t,i)=>{var o,n;localStorage.setItem(Gs+t,JSON.stringify(i));try{(n=(o=window.storage)==null?void 0:o.set)==null||n.call(o,Gs+t,JSON.stringify(i))}catch{}},oa=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),Un=[{id:"legal_sst",label:"Legal / SST",icon:"",color:"#B91C1C"},{id:"legal_corp",label:"Legal Corporativo",icon:"",color:"#3B3B3B"},{id:"operativo",label:"Operativo / Diseo",icon:"",color:"#5B3A8C"},{id:"admin",label:"Administrativo",icon:"",color:"#8C6A00"},{id:"tech",label:"Tecnologa / Herramientas",icon:"",color:"#0D5E6E"},{id:"cliente",label:"Atencin al Cliente",icon:"",color:"#111111"}],ox=[{id:"co_sst_induccion",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Induccin SG-SST",duracionMin:60,desc:"Induccin obligatoria al Sistema de Gestin de Seguridad y Salud en el Trabajo. Decreto 1072/2015, Art. 2.2.4.6.11.",contenido:"Poltica SST de la empresa, peligros y riesgos del cargo, plan de emergencias, reporte de incidentes, derechos y deberes del trabajador.",normativa:"Decreto 1072/2015  Resolucin 0312/2019",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_alturas",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Trabajo Seguro en Alturas",duracionMin:480,desc:"Curso obligatorio para todo trabajador que realice labores a 1.5m o ms sobre nivel inferior. Resolucin 4272/2021.",contenido:"Marco normativo, sistemas de proteccin contra cadas, permisos de trabajo, procedimientos de rescate, prcticas en campo.",normativa:"Resolucin 4272/2021  Resolucin 1409/2012",vigenciaMeses:12,renovable:!0,aplica:["obra","supervisores","instaladores"]},{id:"co_sst_primeros_auxilios",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Primeros Auxilios",duracionMin:120,desc:"Formacin bsica en primeros auxilios para brigadistas y personal designado. Decreto 1072/2015.",contenido:"Evaluacin de la escena, RCP bsico, control de hemorragias, inmovilizacin, quemaduras, traslado de heridos.",normativa:"Decreto 1072/2015  Resolucin 0312/2019",vigenciaMeses:24,renovable:!0,aplica:["brigadistas","obra"]},{id:"co_sst_emergencias",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Plan de Emergencias y Evacuacin",duracionMin:60,desc:"Capacitacin sobre el plan de emergencias de la empresa: rutas de evacuacin, puntos de encuentro, roles.",contenido:"Tipos de emergencia, alarmas, roles del brigadista, evacuacin, uso de extintores, simulacros.",normativa:"Decreto 1072/2015 Art. 2.2.4.6.25",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_ergonomia",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Biomecnico / Ergonoma",duracionMin:60,desc:"Prevencin de lesiones osteomusculares por posturas prolongadas, movimientos repetitivos y manejo de cargas.",contenido:"Higiene postural en oficina, pausas activas, levantamiento seguro de cargas, diseo del puesto de trabajo.",normativa:"Decreto 1072/2015  GTC 45",vigenciaMeses:12,renovable:!0,aplica:["oficina","todos"]},{id:"co_sst_quimicos",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Manejo Seguro de Productos Qumicos",duracionMin:60,desc:"Identificacin y manejo de pinturas, solventes, adhesivos y materiales peligrosos usados en remodelacin.",contenido:"SGA (Sistema Globalmente Armonizado), hojas de seguridad, almacenamiento, EPP, derrames, disposicin.",normativa:"Decreto 1496/2018  GTC 45",vigenciaMeses:12,renovable:!0,aplica:["obra","instaladores"]},{id:"co_sst_psicosocial",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Psicosocial y Salud Mental",duracionMin:60,desc:"Identificacin y prevencin de factores de riesgo psicosocial: estrs, acoso laboral, burnout.",contenido:"Resolucin 2646/2008, batera de riesgo psicosocial, estrategias de afrontamiento, canales de apoyo.",normativa:"Resolucin 2646/2008  Ley 1616/2013",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_electrico",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Elctrico (RETIE)",duracionMin:120,desc:"Seguridad en instalaciones elctricas durante remodelacin. Obligatorio si hay intervencin elctrica.",contenido:"RETIE, 5 reglas de oro, bloqueo/etiquetado, EPP dielctricos, permisos de trabajo.",normativa:"RETIE  Resolucin 90708/2013",vigenciaMeses:24,renovable:!0,aplica:["instaladores","obra"]},{id:"co_sst_espacios",pais:"CO",cat:"legal_sst",obligatorio:!1,nombre:"Espacios Confinados",duracionMin:120,desc:"Procedimientos para trabajos en espacios confinados (stanos, tanques, ductos).",contenido:"Identificacin de espacios confinados, monitoreo atmosfrico, permisos, rescate.",normativa:"Resolucin 0491/2020",vigenciaMeses:12,renovable:!0,aplica:["obra"]},{id:"co_datos",pais:"CO",cat:"legal_corp",obligatorio:!0,nombre:"Proteccin de Datos Personales (Habeas Data)",duracionMin:60,desc:"Ley 1581/2012 de proteccin de datos personales. Obligatorio para todo empleado que maneje datos de clientes.",contenido:"Principios de tratamiento de datos, autorizacin, derechos ARCO, incidentes de seguridad, responsabilidad.",normativa:"Ley 1581/2012  Decreto 1377/2013",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_acoso",pais:"CO",cat:"legal_corp",obligatorio:!0,nombre:"Prevencin del Acoso Laboral",duracionMin:60,desc:"Ley 1010/2006 de acoso laboral. Todo trabajador debe conocer conductas, mecanismos de denuncia y comit de convivencia.",contenido:"Tipos de acoso, comit de convivencia laboral, procedimiento de queja, medidas preventivas y correctivas.",normativa:"Ley 1010/2006  Resolucin 2646/2008",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_laft",pais:"CO",cat:"legal_corp",obligatorio:!1,nombre:"Prevencin LAFT (Lavado de Activos)",duracionMin:60,desc:"Prevencin de lavado de activos y financiacin del terrorismo. Recomendado para empresas con contratos de alto valor.",contenido:"Seales de alerta, debida diligencia, reporte de operaciones sospechosas, SAGRILAFT.",normativa:"Circular Externa SFC 055/2016",vigenciaMeses:12,renovable:!0,aplica:["directivos","comercial"]},{id:"co_nsr10",pais:"CO",cat:"operativo",obligatorio:!1,nombre:"Norma Sismo Resistente NSR-10",duracionMin:120,desc:"Conocimiento de la NSR-10 aplicable a diseo y remodelacin de estructuras.",contenido:"Ttulos A (requisitos generales), J (proteccin contra incendio), K (requisitos complementarios para diseo arquitectnico).",normativa:"NSR-10  Ley 400/1997",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"co_pot",pais:"CO",cat:"operativo",obligatorio:!1,nombre:"Normativa Urbanstica y POT",duracionMin:90,desc:"Plan de Ordenamiento Territorial, licencias urbansticas y norma aplicable a proyectos de remodelacin.",contenido:"Tipos de licencia, normas urbansticas, usos del suelo, ndices, retrocesos, alturas, trmites ante curaduras.",normativa:"Decreto 1077/2015  Decreto 1203/2017",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","directivos"]},{id:"co_proc_diseno",pais:"CO",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Diseo Habitaris",duracionMin:90,desc:"Protocolo interno de diseo: flujo del proyecto, entregables por fase, revisiones, aprobaciones del cliente.",contenido:"Brief  Concepto  Anteproyecto  Proyecto  Detalles tcnicos  Planos de obra. Checklist por fase, nomenclatura de archivos.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"co_proc_obra",pais:"CO",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Obra",duracionMin:90,desc:"Protocolo interno de ejecucin de obra: acta de inicio, control diario, bitcora, recepcin de materiales.",contenido:"Acta de vecindad, acta de inicio, bitcora diaria, control de avance, gestin de cambios, entrega parcial/final.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"co_admin_proc",pais:"CO",cat:"admin",obligatorio:!0,nombre:"Procedimientos Administrativos Internos",duracionMin:60,desc:"Protocolo interno: compras, caja chica, viticos, aprobaciones, archivo documental.",contenido:"Flujo de compras, aprobaciones por monto, rendicin de viticos, gestin documental, archivo digital.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["administrativos","todos"]},{id:"co_admin_factura",pais:"CO",cat:"admin",obligatorio:!1,nombre:"Facturacin Electrnica",duracionMin:60,desc:"Normativa y operacin de facturacin electrnica ante la DIAN.",contenido:"Resolucin de habilitacin, notas crdito/dbito, documento soporte, tiempos de envo, contingencia.",normativa:"Resolucin DIAN 000042/2020",vigenciaMeses:0,renovable:!1,aplica:["administrativos","contabilidad"]},{id:"co_bim",pais:"CO",cat:"tech",obligatorio:!1,nombre:"Metodologa BIM",duracionMin:240,desc:"Building Information Modeling aplicado a diseo interior y remodelacin.",contenido:"Conceptos BIM, modelado en Revit, familias, coordinacin de disciplinas, LOD, entregables BIM.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"co_soft_diseno",pais:"CO",cat:"tech",obligatorio:!1,nombre:"Software de Diseo (AutoCAD / SketchUp / Revit)",duracionMin:480,desc:"Capacitacin en herramientas de diseo utilizadas en la empresa.",contenido:"Segn software: interfaz, dibujo 2D/3D, renderizado, ploteo, exportacin de planos.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"co_suite_hab",pais:"CO",cat:"tech",obligatorio:!0,nombre:"Uso de la Suite Habitaris",duracionMin:60,desc:"Capacitacin en el uso de la plataforma de gestin: CRM, formularios, proyectos, RRHH.",contenido:"Mdulos de la suite, flujo de ofertas, formularios, gestin de proyectos, reportes.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"co_atencion",pais:"CO",cat:"cliente",obligatorio:!0,nombre:"Protocolo de Atencin al Cliente",duracionMin:60,desc:"Estndares de servicio, comunicacin con el cliente, manejo de quejas y expectativas.",contenido:"Primera impresin, escucha activa, gestin de expectativas, manejo de conflictos, seguimiento post-servicio.",normativa:"Procedimiento interno",vigenciaMeses:12,renovable:!0,aplica:["comercial","diseadores","todos"]},{id:"es_prl_general",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Prevencin de Riesgos Laborales  General",duracionMin:480,desc:"Formacin PRL adaptada al puesto de trabajo. Art. 19 LPRL. Obligatoria para todo trabajador.",contenido:"Conceptos bsicos PRL, riesgos generales y especficos del puesto, medidas preventivas, EPIs, sealizacin.",normativa:"Ley 31/1995 (LPRL) Art. 19  RD 39/1997",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"es_prl_oficina",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"PRL  Pantallas de Visualizacin de Datos",duracionMin:120,desc:"Riesgos ergonmicos en trabajo con ordenadores. Obligatorio para personal de oficina.",contenido:"Ergonoma del puesto, fatiga visual, pausas, configuracin de pantalla, mobiliario, ejercicios.",normativa:"RD 488/1997",vigenciaMeses:0,renovable:!1,aplica:["oficina","diseadores","administrativos"]},{id:"es_prl_construccion",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"PRL  Construccin (20h Convenio)",duracionMin:1200,desc:"Formacin obligatoria del Convenio General de Construccin para personal que visita/trabaja en obra.",contenido:"Parte troncal (14h): riesgos generales en obra, medidas preventivas. Parte especfica (6h): segn oficio.",normativa:"VI CGSC  RD 1627/1997",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores","arquitectos"]},{id:"es_prl_primeros_auxilios",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Primeros Auxilios",duracionMin:120,desc:"Formacin en primeros auxilios para personal designado. Art. 20 LPRL.",contenido:"Conducta PAS, RCP, DESA, hemorragias, fracturas, quemaduras, intoxicaciones.",normativa:"Ley 31/1995 Art. 20",vigenciaMeses:24,renovable:!0,aplica:["brigadistas","designados"]},{id:"es_prl_emergencias",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Plan de Emergencia y Evacuacin",duracionMin:60,desc:"Actuacin ante emergencias: incendio, evacuacin, confinamiento.",contenido:"Plan de autoproteccin, roles, uso de extintores y BIE, rutas de evacuacin, simulacros.",normativa:"Ley 31/1995 Art. 20  RD 393/2007",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_prl_coord",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Coordinacin de Actividades Empresariales (CAE)",duracionMin:60,desc:"Obligaciones cuando concurren varias empresas en un mismo centro de trabajo (obra).",contenido:"RD 171/2004, intercambio de informacin, instrucciones, vigilancia, recurso preventivo.",normativa:"RD 171/2004",vigenciaMeses:0,renovable:!1,aplica:["supervisores","directivos"]},{id:"es_rgpd",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Proteccin de Datos (RGPD + LOPDGDD)",duracionMin:120,desc:"Reglamento General de Proteccin de Datos y LOPDGDD. Obligatorio para todo personal que maneje datos.",contenido:"Principios, bases de legitimacin, derechos del interesado, brechas de seguridad, DPD, sanciones.",normativa:"Reglamento UE 2016/679  LO 3/2018",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_acoso",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Prevencin Acoso Sexual y por Razn de Sexo",duracionMin:60,desc:"LO 10/2022 obliga a TODAS las empresas a formar a su plantilla. Protocolo de actuacin.",contenido:"Definiciones legales, identificacin de conductas, procedimiento de denuncia, medidas cautelares, confidencialidad.",normativa:"LO 3/2007 Art. 48  LO 10/2022 Art. 12",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_igualdad",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Igualdad y Plan de Igualdad",duracionMin:60,desc:"Sensibilizacin en igualdad de oportunidades. Plan de igualdad obligatorio si 50 empleados.",contenido:"Marco normativo, brecha salarial, lenguaje inclusivo, corresponsabilidad, medidas del plan.",normativa:"LO 3/2007  RD 901/2020",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_lgtbi",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Igualdad LGTBI y Diversidad",duracionMin:60,desc:"Ley 4/2023 y RD 1026/2024. Obligatorio para empresas 50 empleados desde abril 2025.",contenido:"Diversidad sexual e identidad de gnero, protocolo frente a LGTBIfobia, entornos inclusivos.",normativa:"Ley 4/2023  RD 1026/2024",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_desconexion",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Desconexin Digital",duracionMin:30,desc:"Derecho a la desconexin digital fuera del horario laboral. LOPDGDD Art. 88.",contenido:"Poltica de desconexin, gestin del tiempo digital, prevencin de fatiga informtica, buenas prcticas.",normativa:"LO 3/2018 Art. 88",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_canal_denuncias",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Canal Interno de Denuncias",duracionMin:30,desc:"Ley 2/2023 (Whistleblowing). Obligatorio 50 empleados. Formacin sobre uso y proteccin del informante.",contenido:"Qu se puede denunciar, cmo funciona el canal, proteccin del informante, confidencialidad, plazos.",normativa:"Ley 2/2023",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_blanqueo",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Prevencin de Blanqueo de Capitales",duracionMin:60,desc:"Ley 10/2010. Obligatorio para promotores inmobiliarios y operaciones >15.000 en efectivo.",contenido:"Debida diligencia, identificacin del cliente, operaciones sospechosas, conservacin documental.",normativa:"Ley 10/2010 Art. 29",vigenciaMeses:12,renovable:!0,aplica:["directivos","comercial"]},{id:"es_cte",pais:"ES",cat:"operativo",obligatorio:!1,nombre:"Cdigo Tcnico de Edificacin (CTE)",duracionMin:120,desc:"Conocimiento del CTE aplicable a reformas y rehabilitacin.",contenido:"DB-HE (ahorro energtico), DB-SI (incendios), DB-SUA (seguridad de utilizacin), DB-HS (salubridad).",normativa:"RD 314/2006",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"es_proc_diseno",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Diseo Habitaris",duracionMin:90,desc:"Protocolo interno de diseo: flujo del proyecto, entregables, revisiones, aprobaciones.",contenido:"Brief  Concepto  Anteproyecto  Proyecto ejecutivo  Detalles. Checklist por fase.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"es_proc_obra",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Obra / Reforma",duracionMin:90,desc:"Protocolo interno de ejecucin: acta de replanteo, libro de rdenes, certificaciones.",contenido:"Licencia de obra, acta de replanteo, libro de rdenes, certificaciones parciales, acta de recepcin.",normativa:"Procedimiento interno  LOE",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"es_residuos",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Gestin de Residuos de Construccin (RCD)",duracionMin:60,desc:"Plan de gestin de residuos obligatorio en obra. Separacin, transporte y gestin autorizada.",contenido:"RD 105/2008, tipos de residuos, plan de gestin, documentos de control, gestores autorizados.",normativa:"RD 105/2008  Ley 7/2022",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"es_bim",pais:"ES",cat:"tech",obligatorio:!1,nombre:"Metodologa BIM",duracionMin:240,desc:"Building Information Modeling. Licitacin pblica ya lo exige en muchos proyectos.",contenido:"Conceptos BIM, modelado Revit, IFC, coordinacin, LOD, entregables.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"es_suite_hab",pais:"ES",cat:"tech",obligatorio:!0,nombre:"Uso de la Suite Habitaris",duracionMin:60,desc:"Capacitacin en el uso de la plataforma de gestin.",contenido:"CRM, formularios, proyectos, RRHH, reportes.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"es_atencion",pais:"ES",cat:"cliente",obligatorio:!0,nombre:"Protocolo de Atencin al Cliente",duracionMin:60,desc:"Estndares de servicio, comunicacin, gestin de expectativas y reclamaciones.",contenido:"Primera impresin, escucha activa, gestin de quejas, libro de reclamaciones, seguimiento.",normativa:"Procedimiento interno",vigenciaMeses:12,renovable:!0,aplica:["comercial","diseadores","todos"]}],nx=[{id:"todos",label:"Todos los empleados"},{id:"directivos",label:"Directivos / Gerencia"},{id:"arquitectos",label:"Arquitectos"},{id:"diseadores",label:"Diseadores de interiores"},{id:"ingenieros",label:"Ingenieros"},{id:"obra",label:"Personal de obra"},{id:"supervisores",label:"Supervisores / Residentes"},{id:"instaladores",label:"Instaladores / Tcnicos"},{id:"administrativos",label:"Administrativos"},{id:"comercial",label:"Comercial / Ventas"},{id:"contabilidad",label:"Contabilidad / Finanzas"},{id:"oficina",label:"Personal de oficina"},{id:"brigadistas",label:"Brigadistas"},{id:"designados",label:"Designados especiales"}];function na(t){if(!t)return"";if(t<60)return`${t} min`;const i=Math.floor(t/60),o=t%60;return o?`${i}h ${o}min`:`${i}h`}function ra(t){return t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):""}function rx(t,i){const o=new Date(t);return o.setMonth(o.getMonth()+i),o.toISOString()}function Ri(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}function ax({tabs:t,active:i,onChange:o,style:n}){return e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${ne.border}`,...n},children:t.map(a=>e.jsxs("button",{onClick:()=>o(a.id),style:{...Ee,padding:"10px 18px",fontSize:12,fontWeight:i===a.id?700:500,color:i===a.id?ne.accent:ne.inkLight,background:"none",border:"none",borderBottom:i===a.id?`2px solid ${ne.accent}`:"2px solid transparent",cursor:"pointer",transition:"all .15s"},children:[a.icon&&e.jsx("span",{style:{marginRight:6},children:a.icon}),a.label,a.badge!=null&&e.jsx("span",{style:{marginLeft:6,background:i===a.id?ne.accent:ne.border,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:a.badge})]},a.id))})}function ti({children:t,color:i,bg:o,style:n}){return e.jsx("span",{style:{...Ee,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o,...n},children:t})}function ad({children:t,style:i,onClick:o}){return e.jsx("div",{onClick:o,style:{background:"#fff",border:`1px solid ${ne.border}`,borderRadius:10,padding:20,boxShadow:ne.shadow,transition:"all .15s",cursor:o?"pointer":void 0,...i},onMouseEnter:n=>{o&&(n.currentTarget.style.boxShadow=ne.shadowMd)},onMouseLeave:n=>{o&&(n.currentTarget.style.boxShadow=ne.shadow)},children:t})}function sx({value:t,onChange:i,placeholder:o}){return e.jsxs("div",{style:{position:"relative"},children:[e.jsx("span",{style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",fontSize:14,opacity:.4},children:""}),e.jsx("input",{value:t,onChange:n=>i(n.target.value),placeholder:o||"Buscar",style:{...Ee,width:"100%",padding:"8px 12px 8px 34px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:6,outline:"none",boxSizing:"border-box"},onFocus:n=>n.target.style.borderColor=ne.accent,onBlur:n=>n.target.style.borderColor=ne.border})]})}function lx({preguntas:t,onChange:i}){const o=()=>i([...t,{id:oa(),texto:"",opciones:["","","",""],correcta:0}]),n=(s,d,u)=>{const b=[...t];b[s]={...b[s],[d]:u},i(b)},a=(s,d,u)=>{const b=[...t],j=[...b[s].opciones];j[d]=u,b[s]={...b[s],opciones:j},i(b)},r=s=>i(t.filter((d,u)=>u!==s));return e.jsxs("div",{children:[e.jsxs("div",{style:{...Ee,fontSize:12,fontWeight:600,color:ne.ink,marginBottom:10},children:["Cuestionario de evaluacin (",t.length," preguntas)"]}),t.map((s,d)=>e.jsxs("div",{style:{border:`1px solid ${ne.border}`,borderRadius:8,padding:14,marginBottom:10,background:ne.surface},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("span",{style:{...Ee,fontSize:11,fontWeight:600,color:ne.inkMid},children:["Pregunta ",d+1]}),e.jsx("button",{onClick:()=>r(d),style:{...Ee,fontSize:10,color:ne.danger,background:"none",border:"none",cursor:"pointer"},children:" Eliminar"})]}),e.jsx("input",{value:s.texto,onChange:u=>n(d,"texto",u.target.value),placeholder:"Escribe la pregunta",style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,marginBottom:8,boxSizing:"border-box"}}),s.opciones.map((u,b)=>e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:4},children:[e.jsx("input",{type:"radio",name:`q_${s.id}`,checked:s.correcta===b,onChange:()=>n(d,"correcta",b),style:{accentColor:ne.accent}}),e.jsx("input",{value:u,onChange:j=>a(d,b,j.target.value),placeholder:`Opcin ${b+1}`,style:{...Ee,flex:1,padding:"5px 8px",fontSize:11,border:`1px solid ${ne.border}`,borderRadius:4}})]},b)),e.jsx("p",{style:{...Ee,fontSize:10,color:ne.inkLight,marginTop:4},children:" Marca el radio de la respuesta correcta"})]},s.id)),e.jsx("button",{onClick:o,style:{...Ee,padding:"7px 16px",fontSize:11,fontWeight:600,color:ne.accent,background:ne.accentBg,border:`1px solid ${ne.accent}33`,borderRadius:6,cursor:"pointer"},children:"+ Aadir pregunta"})]})}function dx({preguntas:t,onComplete:i}){const[o,n]=F.useState({}),[a,r]=F.useState(!1),[s,d]=F.useState(null),u=(m,x)=>{a||n(p=>({...p,[m]:x}))},b=()=>{let m=0;t.forEach(p=>{o[p.id]===p.correcta&&m++});const x=Math.round(m/t.length*100);d(x),r(!0),i(x)},j=Object.keys(o).length,w=t.length,S=s!=null&&s>=70;return e.jsxs("div",{children:[!a&&e.jsxs("div",{style:{...Ee,fontSize:12,color:ne.inkMid,marginBottom:16},children:["Responde todas las preguntas. Necesitas ",e.jsx("b",{children:"70%"})," para aprobar. (",j,"/",w," respondidas)"]}),a&&e.jsxs("div",{style:{padding:20,borderRadius:10,marginBottom:20,textAlign:"center",background:S?ne.successBg:ne.dangerBg,border:`1px solid ${S?ne.success:ne.danger}33`},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:S?"":""}),e.jsxs("div",{style:{...Ee,fontSize:22,fontWeight:700,color:S?ne.success:ne.danger},children:[s,"%"]}),e.jsx("div",{style:{...Ee,fontSize:13,color:S?ne.success:ne.danger,marginTop:4},children:S?"Aprobado! Formacin completada.":"No aprobado. Puedes volver a intentarlo."})]}),t.map((m,x)=>{const p=o[m.id],c=a&&p===m.correcta,g=a&&p!==void 0&&p!==m.correcta;return e.jsxs("div",{style:{border:`1px solid ${a?c?ne.success+"55":g?ne.danger+"55":ne.border:ne.border}`,borderRadius:8,padding:14,marginBottom:10,background:"#fff"},children:[e.jsxs("div",{style:{...Ee,fontSize:12,fontWeight:600,color:ne.ink,marginBottom:10},children:[x+1,". ",m.texto]}),m.opciones.map((l,f)=>{if(!l)return null;const y=p===f,h=a&&f===m.correcta;let v=y?ne.accentBg:"transparent",A=y?ne.accent:ne.border;return a&&(h?(v=ne.successBg,A=ne.success):y&&!h&&(v=ne.dangerBg,A=ne.danger)),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",padding:"6px 10px",borderRadius:6,marginBottom:4,cursor:a?"default":"pointer",border:`1px solid ${A}`,background:v,transition:"all .15s"},onClick:()=>u(m.id,f),children:[e.jsx("input",{type:"radio",name:`take_${m.id}`,checked:y,readOnly:!0,style:{accentColor:a?h?ne.success:ne.danger:ne.accent}}),e.jsx("span",{style:{...Ee,fontSize:12,color:ne.ink},children:l}),a&&h&&e.jsx("span",{style:{marginLeft:"auto",fontSize:12},children:""})]},f)})]},m.id)}),!a&&e.jsx("button",{onClick:b,disabled:j<w,style:{...Ee,padding:"10px 28px",fontSize:13,fontWeight:700,color:"#fff",background:j<w?ne.inkLight:ne.accent,border:"none",borderRadius:8,cursor:j<w?"not-allowed":"pointer",marginTop:10},children:"Enviar respuestas"})]})}function cx({curso:t,trabajador:i,fecha:o,score:n}){return e.jsxs("div",{style:{border:`2px solid ${ne.accent}`,borderRadius:12,padding:40,textAlign:"center",background:"linear-gradient(135deg, #FFFFFF 0%, #EBEBEB 100%)",maxWidth:600,margin:"0 auto"},children:[e.jsx("div",{style:{fontSize:12,letterSpacing:3,color:ne.inkLight,textTransform:"uppercase",marginBottom:8},children:"Certificado de formacin"}),e.jsx("div",{style:{width:60,height:2,background:ne.accent,margin:"0 auto 20px"}}),e.jsx("div",{style:{...Ee,fontSize:10,color:ne.inkLight,marginBottom:4},children:"Se certifica que"}),e.jsx("div",{style:{...Ee,fontSize:22,fontWeight:700,color:ne.ink,marginBottom:16},children:i}),e.jsx("div",{style:{...Ee,fontSize:10,color:ne.inkLight,marginBottom:4},children:"ha completado satisfactoriamente la formacin"}),e.jsx("div",{style:{...Ee,fontSize:16,fontWeight:600,color:ne.accent,marginBottom:8},children:t.nombre}),e.jsxs("div",{style:{...Ee,fontSize:11,color:ne.inkMid,marginBottom:4},children:["Duracin: ",na(t.duracionMin)]}),n!=null&&e.jsxs("div",{style:{...Ee,fontSize:11,color:ne.inkMid,marginBottom:4},children:["Calificacin: ",n,"%"]}),t.normativa&&t.normativa!==""&&t.normativa!=="Procedimiento interno"&&e.jsxs("div",{style:{...Ee,fontSize:10,color:ne.inkLight,marginBottom:16},children:["Normativa: ",t.normativa]}),e.jsx("div",{style:{...Ee,fontSize:12,color:ne.ink,marginTop:20},children:ra(o)}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:30,paddingTop:20,borderTop:`1px solid ${ne.border}`},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:120,borderBottom:`1px solid ${ne.ink}`,marginBottom:4}}),e.jsx("div",{style:{...Ee,fontSize:9,color:ne.inkLight},children:"Responsable de Formacin"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:120,borderBottom:`1px solid ${ne.ink}`,marginBottom:4}}),e.jsx("div",{style:{...Ee,fontSize:9,color:ne.inkLight},children:"Gerencia"})]})]})]})}function px(){const[t,i]=F.useState("catalogo"),[o,n]=F.useState(()=>Ur("cursos")||ox),[a,r]=F.useState(()=>Ur("asignaciones")||[]),[s,d]=F.useState(()=>Ur("completados")||[]),[u,b]=F.useState(()=>Ur("trabajadores")||[{id:"t1",nombre:"Ana Garca",cargo:"Diseadora de interiores",roles:["diseadores","oficina","todos"],pais:"CO"},{id:"t2",nombre:"Carlos Lpez",cargo:"Arquitecto",roles:["arquitectos","oficina","todos"],pais:"CO"},{id:"t3",nombre:"Mara Rodrguez",cargo:"Supervisora de obra",roles:["supervisores","obra","todos","brigadistas"],pais:"CO"},{id:"t4",nombre:"Pedro Martnez",cargo:"Instalador",roles:["instaladores","obra","todos"],pais:"CO"},{id:"t5",nombre:"Laura Snchez",cargo:"Administrativa",roles:["administrativos","oficina","todos"],pais:"CO"},{id:"t6",nombre:"David Torres",cargo:"Comercial",roles:["comercial","oficina","todos"],pais:"CO"}]),[j,w]=F.useState("CO"),[S,m]=F.useState("all"),[x,p]=F.useState(""),[c,g]=F.useState(null),[l,f]=F.useState(null),[y,h]=F.useState(null),[v,A]=F.useState(null),[z,k]=F.useState(null);F.useEffect(()=>Vr("cursos",o),[o]),F.useEffect(()=>Vr("asignaciones",a),[a]),F.useEffect(()=>Vr("completados",s),[s]),F.useEffect(()=>Vr("trabajadores",u),[u]);const T=F.useMemo(()=>o.filter(R=>{if(R.pais!==j||S!=="all"&&R.cat!==S)return!1;if(x){const W=x.toLowerCase();return R.nombre.toLowerCase().includes(W)||R.desc.toLowerCase().includes(W)||(R.normativa||"").toLowerCase().includes(W)}return!0}),[o,j,S,x]),C=F.useMemo(()=>{const R=u.filter(N=>N.pais===j),W=o.filter(N=>N.pais===j),se=W.filter(N=>N.obligatorio);let le=0,de=0,Z=0,ue=0;return R.forEach(N=>{const G=a.filter(L=>L.trabajadorId===N.id);le+=G.length,G.forEach(L=>{const ae=s.find(pe=>pe.asignacionId===L.id);if(ae&&(de++,ae.vencimiento)){const pe=Ri(ae.vencimiento);pe<0?ue++:pe<=60&&Z++}})}),{trabajadores:R.length,cursos:W.length,obligatorios:se.length,asignados:le,completados:de,porVencer:Z,vencidos:ue,pctComp:le?Math.round(de/le*100):0}},[u,o,a,s,j]),D=(R,W)=>{a.find(le=>le.cursoId===R&&le.trabajadorId===W)||r(le=>[...le,{id:oa(),cursoId:R,trabajadorId:W,fechaAsignacion:new Date().toISOString()}])},K=()=>{const R=o.filter(le=>le.pais===j&&le.obligatorio),W=u.filter(le=>le.pais===j);let se=0;R.forEach(le=>{W.forEach(de=>{le.aplica.some(ue=>ue==="todos"||de.roles.includes(ue))&&(a.find(N=>N.cursoId===le.id&&N.trabajadorId===de.id)||(D(le.id,de.id),se++))})}),alert(se?` Se asignaron ${se} formaciones automticamente`:" Todas las formaciones obligatorias ya estn asignadas")},oe=(R,W)=>{const se=a.find(ue=>ue.id===R);if(!se)return;const le=o.find(ue=>ue.id===se.cursoId),de=le!=null&&le.vigenciaMeses?rx(new Date,le.vigenciaMeses):null,Z={id:oa(),asignacionId:R,cursoId:se.cursoId,trabajadorId:se.trabajadorId,fecha:new Date().toISOString(),score:W,vencimiento:de};d(ue=>[...ue.filter(N=>N.asignacionId!==R),Z])},te=()=>{var le;const R=c?o.find(de=>de.id===c):null;if(!R)return null;const W=a.filter(de=>de.cursoId===R.id),se=Un.find(de=>de.id===R.cat);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>g(null),children:e.jsxs("div",{onClick:de=>de.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:6},children:[e.jsxs(ti,{color:se==null?void 0:se.color,bg:(se==null?void 0:se.color)+"18",children:[se==null?void 0:se.icon," ",se==null?void 0:se.label]}),R.obligatorio&&e.jsx(ti,{color:ne.danger,bg:ne.dangerBg,children:"Obligatorio"}),e.jsx(ti,{color:ne.inkLight,bg:ne.bg,children:R.pais==="CO"?" Colombia":" Espaa"})]}),e.jsx("h2",{style:{...Ee,fontSize:20,fontWeight:700,color:ne.ink,margin:0},children:R.nombre})]}),e.jsx("button",{onClick:()=>g(null),style:{...Ee,fontSize:18,color:ne.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...Ee,fontSize:13,color:ne.inkMid,lineHeight:1.6,marginBottom:12},children:R.desc}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsxs("div",{style:{padding:12,background:ne.surface,borderRadius:8},children:[e.jsx("div",{style:{...Ee,fontSize:10,color:ne.inkLight,marginBottom:2},children:"Duracin"}),e.jsx("div",{style:{...Ee,fontSize:14,fontWeight:600,color:ne.ink},children:na(R.duracionMin)})]}),e.jsxs("div",{style:{padding:12,background:ne.surface,borderRadius:8},children:[e.jsx("div",{style:{...Ee,fontSize:10,color:ne.inkLight,marginBottom:2},children:"Vigencia"}),e.jsx("div",{style:{...Ee,fontSize:14,fontWeight:600,color:ne.ink},children:R.vigenciaMeses?`${R.vigenciaMeses} meses`:"Sin vencimiento"})]})]}),R.normativa&&R.normativa!==""&&e.jsxs("div",{style:{padding:10,background:ne.infoBg,borderRadius:8,marginBottom:12},children:[e.jsx("span",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.info},children:" Normativa: "}),e.jsx("span",{style:{...Ee,fontSize:11,color:ne.info},children:R.normativa})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{...Ee,fontSize:11,fontWeight:600,color:ne.inkMid,marginBottom:4},children:"Contenido temtico:"}),e.jsx("p",{style:{...Ee,fontSize:12,color:ne.inkMid,lineHeight:1.6,margin:0},children:R.contenido})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{...Ee,fontSize:11,fontWeight:600,color:ne.inkMid,marginBottom:4},children:"Aplica a:"}),e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:R.aplica.map(de=>{const Z=nx.find(ue=>ue.id===de);return e.jsx(ti,{color:ne.inkMid,bg:ne.bg,children:(Z==null?void 0:Z.label)||de},de)})})]}),e.jsxs("div",{style:{border:`1px dashed ${ne.border}`,borderRadius:8,padding:16,textAlign:"center",marginBottom:16},children:[e.jsx("div",{style:{fontSize:28,marginBottom:6},children:""}),e.jsx("div",{style:{...Ee,fontSize:12,color:ne.inkLight},children:"Material del curso (vdeos, PDFs, presentaciones)"}),e.jsx("div",{style:{...Ee,fontSize:10,color:ne.inkLight,marginTop:4},children:"Sube contenido desde la pestaa de edicin del curso"})]}),((le=R.preguntas)==null?void 0:le.length)>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{...Ee,fontSize:12,fontWeight:600,color:ne.ink,marginBottom:8},children:[" Cuestionario (",R.preguntas.length," preguntas)"]}),e.jsx("p",{style:{...Ee,fontSize:11,color:ne.inkLight},children:"Los trabajadores deben aprobar con mnimo 70% para completar la formacin."})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs("div",{style:{...Ee,fontSize:12,fontWeight:600,color:ne.ink,marginBottom:10},children:[" Trabajadores asignados (",W.length,")"]}),W.length===0&&e.jsx("p",{style:{...Ee,fontSize:11,color:ne.inkLight},children:"Ningn trabajador asignado an."}),W.map(de=>{const Z=u.find(L=>L.id===de.trabajadorId),ue=s.find(L=>L.asignacionId===de.id),N=(ue==null?void 0:ue.vencimiento)&&Ri(ue.vencimiento)<0,G=(ue==null?void 0:ue.vencimiento)&&Ri(ue.vencimiento)>=0&&Ri(ue.vencimiento)<=60;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 0",borderBottom:`1px solid ${ne.border}`},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:ne.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:600,color:ne.accent},children:((Z==null?void 0:Z.nombre)||"?")[0]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ee,fontSize:12,fontWeight:600,color:ne.ink},children:Z==null?void 0:Z.nombre}),e.jsx("div",{style:{...Ee,fontSize:10,color:ne.inkLight},children:Z==null?void 0:Z.cargo})]}),ue?e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(ti,{color:N?ne.danger:G?ne.warning:ne.success,bg:N?ne.dangerBg:G?ne.warningBg:ne.successBg,children:N?" Vencido":G?" Por vencer":` ${ue.score||100}%`}),e.jsxs("div",{style:{...Ee,fontSize:9,color:ne.inkLight,marginTop:2},children:[ra(ue.fecha),ue.vencimiento&&`  ${ra(ue.vencimiento)}`]})]}):e.jsx(ti,{color:ne.warning,bg:ne.warningBg,children:" Pendiente"})]},de.id)})]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:20},children:e.jsx("button",{onClick:()=>{h({...R}),g(null)},style:{...Ee,padding:"8px 20px",fontSize:12,fontWeight:600,color:ne.accent,background:ne.accentBg,border:`1px solid ${ne.accent}33`,borderRadius:6,cursor:"pointer"},children:" Editar curso"})})]})})},P=()=>{if(!y)return null;const R=!o.find(le=>le.id===y.id),W=(le,de)=>h(Z=>({...Z,[le]:de})),se=()=>{n(R?le=>[...le,y]:le=>le.map(de=>de.id===y.id?y:de)),h(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>h(null),children:e.jsxs("div",{onClick:le=>le.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:680,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Ee,fontSize:18,fontWeight:700,color:ne.ink,marginBottom:16},children:R?" Nuevo curso":" Editar curso"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Pas"}),e.jsxs("select",{value:y.pais,onChange:le=>W("pais",le.target.value),style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5},children:[e.jsx("option",{value:"CO",children:" Colombia"}),e.jsx("option",{value:"ES",children:" Espaa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Categora"}),e.jsx("select",{value:y.cat,onChange:le=>W("cat",le.target.value),style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5},children:Un.map(le=>e.jsxs("option",{value:le.id,children:[le.icon," ",le.label]},le.id))})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Nombre del curso"}),e.jsx("input",{value:y.nombre||"",onChange:le=>W("nombre",le.target.value),style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:y.desc||"",onChange:le=>W("desc",le.target.value),rows:3,style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Contenido temtico"}),e.jsx("textarea",{value:y.contenido||"",onChange:le=>W("contenido",le.target.value),rows:3,style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Duracin (min)"}),e.jsx("input",{type:"number",value:y.duracionMin||"",onChange:le=>W("duracionMin",parseInt(le.target.value)||0),style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Vigencia (meses, 0=sin venc.)"}),e.jsx("input",{type:"number",value:y.vigenciaMeses||0,onChange:le=>W("vigenciaMeses",parseInt(le.target.value)||0),style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Normativa"}),e.jsx("input",{value:y.normativa||"",onChange:le=>W("normativa",le.target.value),style:{...Ee,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginBottom:12},children:[e.jsxs("label",{style:{...Ee,display:"flex",gap:6,alignItems:"center",fontSize:12,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:y.obligatorio||!1,onChange:le=>W("obligatorio",le.target.checked),style:{accentColor:ne.accent}}),"Formacin obligatoria"]}),e.jsxs("label",{style:{...Ee,display:"flex",gap:6,alignItems:"center",fontSize:12,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:y.renovable||!1,onChange:le=>W("renovable",le.target.checked),style:{accentColor:ne.accent}}),"Renovable peridicamente"]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{...Ee,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Material (URLs de vdeo/documentos, uno por lnea)"}),e.jsx("textarea",{value:(y.material||[]).join(`
`),rows:3,onChange:le=>W("material",le.target.value.split(`
`).filter(de=>de.trim())),placeholder:`https://youtube.com/watch?v=...
https://drive.google.com/file/...`,style:{...Ee,width:"100%",padding:"7px 10px",fontSize:11,border:`1px solid ${ne.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsx(lx,{preguntas:y.preguntas||[],onChange:le=>W("preguntas",le)}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>h(null),style:{...Ee,padding:"8px 20px",fontSize:12,color:ne.inkMid,background:ne.bg,border:`1px solid ${ne.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:se,style:{...Ee,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ne.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},ie=()=>{const R=l?u.find(le=>le.id===l):null;if(!R)return null;const W=a.filter(le=>le.trabajadorId===R.id),se=s.filter(le=>le.trabajadorId===R.id);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>f(null),children:e.jsxs("div",{onClick:le=>le.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",gap:14,alignItems:"center"},children:[e.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:ne.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,color:ne.accent},children:R.nombre[0]}),e.jsxs("div",{children:[e.jsx("h2",{style:{...Ee,fontSize:18,fontWeight:700,color:ne.ink,margin:0},children:R.nombre}),e.jsx("div",{style:{...Ee,fontSize:12,color:ne.inkLight},children:R.cargo}),e.jsx("div",{style:{display:"flex",gap:4,marginTop:4},children:R.roles.map(le=>e.jsx(ti,{color:ne.inkMid,bg:ne.bg,children:le},le))})]})]}),e.jsx("button",{onClick:()=>f(null),style:{...Ee,fontSize:18,color:ne.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{...Ee,fontSize:11,fontWeight:600,color:ne.inkMid},children:"Progreso formativo"}),e.jsxs("span",{style:{...Ee,fontSize:11,fontWeight:600,color:ne.accent},children:[se.length,"/",W.length," completadas"]})]}),e.jsx("div",{style:{height:8,background:ne.bg,borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${W.length?se.length/W.length*100:0}%`,background:ne.accent,borderRadius:4,transition:"width .3s"}})})]}),W.map(le=>{var L;const de=o.find(ae=>ae.id===le.cursoId),Z=s.find(ae=>ae.asignacionId===le.id),ue=Un.find(ae=>ae.id===(de==null?void 0:de.cat)),N=(Z==null?void 0:Z.vencimiento)&&Ri(Z.vencimiento)<0,G=(Z==null?void 0:Z.vencimiento)&&Ri(Z.vencimiento)>=0&&Ri(Z.vencimiento)<=60;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${ne.border}`},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:8,background:(ue==null?void 0:ue.color)+"18",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:ue==null?void 0:ue.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ee,fontSize:12,fontWeight:600,color:ne.ink},children:de==null?void 0:de.nombre}),e.jsxs("div",{style:{...Ee,fontSize:10,color:ne.inkLight},children:[na(de==null?void 0:de.duracionMin),"  ",de==null?void 0:de.normativa]})]}),e.jsx("div",{style:{display:"flex",gap:6,alignItems:"center"},children:Z?e.jsxs(e.Fragment,{children:[e.jsx(ti,{color:N?ne.danger:G?ne.warning:ne.success,bg:N?ne.dangerBg:G?ne.warningBg:ne.successBg,children:N?"Vencido":G?`Vence ${ra(Z.vencimiento)}`:` ${Z.score||100}%`}),e.jsx("button",{onClick:()=>k(Z),title:"Ver certificado",style:{...Ee,padding:"4px 8px",fontSize:10,color:ne.accent,background:ne.accentBg,border:`1px solid ${ne.accent}33`,borderRadius:4,cursor:"pointer"},children:""})]}):e.jsxs(e.Fragment,{children:[e.jsx(ti,{color:ne.warning,bg:ne.warningBg,children:"Pendiente"}),((L=de==null?void 0:de.preguntas)==null?void 0:L.length)>0?e.jsx("button",{onClick:()=>{A({cursoId:de.id,trabajadorId:R.id,asignacionId:le.id}),f(null)},style:{...Ee,padding:"4px 10px",fontSize:10,fontWeight:600,color:"#fff",background:ne.accent,border:"none",borderRadius:4,cursor:"pointer"},children:" Evaluar"}):e.jsx("button",{onClick:()=>oe(le.id,100),style:{...Ee,padding:"4px 10px",fontSize:10,fontWeight:600,color:"#fff",background:ne.accent,border:"none",borderRadius:4,cursor:"pointer"},children:" Completar"})]})})]},le.id)}),W.length===0&&e.jsx("p",{style:{...Ee,fontSize:12,color:ne.inkLight,textAlign:"center",padding:20},children:"No tiene formaciones asignadas"})]})})},me=()=>{var se;if(!v)return null;const R=o.find(le=>le.id===v.cursoId),W=u.find(le=>le.id===v.trabajadorId);return(se=R==null?void 0:R.preguntas)!=null&&se.length?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>A(null),children:e.jsxs("div",{onClick:le=>le.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("h2",{style:{...Ee,fontSize:16,fontWeight:700,color:ne.ink,marginBottom:4},children:[" Evaluacin: ",R.nombre]}),e.jsxs("p",{style:{...Ee,fontSize:12,color:ne.inkLight,marginBottom:20},children:["Trabajador: ",W==null?void 0:W.nombre]}),e.jsx(dx,{preguntas:R.preguntas,onComplete:le=>{le>=70&&oe(v.asignacionId,le)}}),e.jsx("button",{onClick:()=>A(null),style:{...Ee,marginTop:16,padding:"8px 20px",fontSize:12,color:ne.inkMid,background:ne.bg,border:`1px solid ${ne.border}`,borderRadius:6,cursor:"pointer"},children:"Cerrar"})]})}):null},Q=()=>{if(!z)return null;const R=o.find(se=>se.id===z.cursoId),W=u.find(se=>se.id===z.trabajadorId);return!R||!W?null:e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>k(null),children:e.jsxs("div",{onClick:se=>se.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:680,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx(cx,{curso:R,trabajador:W.nombre,fecha:z.fecha,score:z.score}),e.jsx("div",{style:{textAlign:"center",marginTop:20},children:e.jsx("button",{onClick:()=>k(null),style:{...Ee,padding:"8px 24px",fontSize:12,color:ne.inkMid,background:ne.bg,border:`1px solid ${ne.border}`,borderRadius:6,cursor:"pointer"},children:"Cerrar"})})]})})},je=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:16},children:[e.jsx("div",{style:{display:"flex",gap:2},children:[["CO"," Colombia"],["ES"," Espaa"]].map(([R,W])=>e.jsx("button",{onClick:()=>w(R),style:{...Ee,padding:"6px 14px",fontSize:11,fontWeight:j===R?700:500,color:j===R?"#fff":ne.inkMid,background:j===R?ne.accent:ne.surface,border:`1px solid ${j===R?ne.accent:ne.border}`,borderRadius:6,cursor:"pointer"},children:W},R))}),e.jsxs("select",{value:S,onChange:R=>m(R.target.value),style:{...Ee,padding:"6px 12px",fontSize:11,border:`1px solid ${ne.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todas las categoras"}),Un.map(R=>e.jsxs("option",{value:R.id,children:[R.icon," ",R.label]},R.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx(sx,{value:x,onChange:p,placeholder:"Buscar por nombre, normativa"})}),e.jsx("button",{onClick:()=>h({id:oa(),pais:j,cat:"operativo",nombre:"",desc:"",contenido:"",normativa:"",duracionMin:60,vigenciaMeses:0,obligatorio:!1,renovable:!1,aplica:["todos"],preguntas:[],material:[]}),style:{...Ee,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:ne.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo curso"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"},children:[{label:"Total cursos",val:C.cursos,icon:""},{label:"Obligatorios",val:C.obligatorios,icon:""},{label:"Completados",val:`${C.pctComp}%`,icon:""},{label:"Vencidos",val:C.vencidos,icon:"",danger:C.vencidos>0},{label:"Por vencer",val:C.porVencer,icon:"",warning:C.porVencer>0}].map((R,W)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"12px 16px",background:R.danger?ne.dangerBg:R.warning?ne.warningBg:"#fff",border:`1px solid ${R.danger?ne.danger+"33":R.warning?ne.warning+"33":ne.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...Ee,fontSize:10,color:ne.inkLight},children:[R.icon," ",R.label]}),e.jsx("div",{style:{...Ee,fontSize:20,fontWeight:700,color:R.danger?ne.danger:R.warning?ne.warning:ne.ink},children:R.val})]},W))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px,1fr))",gap:12},children:T.map(R=>{var de;const W=Un.find(Z=>Z.id===R.cat),se=a.filter(Z=>Z.cursoId===R.id).length,le=s.filter(Z=>Z.cursoId===R.id).length;return e.jsxs(ad,{onClick:()=>g(R.id),style:{borderLeft:`3px solid ${(W==null?void 0:W.color)||ne.accent}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(ti,{color:W==null?void 0:W.color,bg:(W==null?void 0:W.color)+"18",children:[W==null?void 0:W.icon," ",W==null?void 0:W.label]}),R.obligatorio&&e.jsx(ti,{color:ne.danger,bg:ne.dangerBg,children:"Obligatorio"})]}),e.jsx("div",{style:{...Ee,fontSize:14,fontWeight:700,color:ne.ink,marginBottom:4},children:R.nombre}),e.jsx("div",{style:{...Ee,fontSize:11,color:ne.inkLight,lineHeight:1.5,marginBottom:10,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:R.desc}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{...Ee,fontSize:10,color:ne.inkLight},children:[" ",na(R.duracionMin),"  ",R.vigenciaMeses?` ${R.vigenciaMeses}m`:""]}),e.jsxs("div",{style:{...Ee,fontSize:10,color:ne.inkMid},children:[" ",se,"   ",le]})]}),((de=R.preguntas)==null?void 0:de.length)>0&&e.jsxs("div",{style:{...Ee,fontSize:9,color:ne.accent,marginTop:6},children:[" ",R.preguntas.length," preguntas"]})]},R.id)})}),T.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:ne.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Ee,fontSize:13},children:"No se encontraron cursos con los filtros seleccionados"})]})]}),re=()=>{const R=u.filter(W=>W.pais===j);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:16},children:[e.jsx("div",{style:{display:"flex",gap:2},children:[["CO",""],["ES",""]].map(([W,se])=>e.jsx("button",{onClick:()=>w(W),style:{...Ee,padding:"6px 14px",fontSize:11,fontWeight:j===W?700:500,color:j===W?"#fff":ne.inkMid,background:j===W?ne.accent:ne.surface,border:`1px solid ${j===W?ne.accent:ne.border}`,borderRadius:6,cursor:"pointer"},children:se},W))}),e.jsx("button",{onClick:K,style:{...Ee,padding:"7px 16px",fontSize:11,fontWeight:600,color:ne.info,background:ne.infoBg,border:`1px solid ${ne.info}33`,borderRadius:6,cursor:"pointer"},children:" Auto-asignar obligatorias"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px,1fr))",gap:12},children:R.map(W=>{const se=a.filter(ue=>ue.trabajadorId===W.id),le=s.filter(ue=>ue.trabajadorId===W.id),de=le.filter(ue=>ue.vencimiento&&Ri(ue.vencimiento)<0).length,Z=se.length?Math.round(le.length/se.length*100):0;return e.jsxs(ad,{onClick:()=>f(W.id),children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginBottom:12},children:[e.jsx("div",{style:{width:44,height:44,borderRadius:"50%",background:ne.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,color:ne.accent},children:W.nombre[0]}),e.jsxs("div",{children:[e.jsx("div",{style:{...Ee,fontSize:14,fontWeight:700,color:ne.ink},children:W.nombre}),e.jsx("div",{style:{...Ee,fontSize:11,color:ne.inkLight},children:W.cargo})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[e.jsxs("span",{style:{...Ee,fontSize:10,color:ne.inkLight},children:[le.length,"/",se.length," completadas"]}),e.jsxs("span",{style:{...Ee,fontSize:10,fontWeight:600,color:Z===100?ne.success:Z>50?ne.warning:ne.danger},children:[Z,"%"]})]}),e.jsx("div",{style:{height:6,background:ne.bg,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${Z}%`,background:Z===100?ne.success:Z>50?"#D4840A":ne.danger,borderRadius:3,transition:"width .3s"}})})]}),de>0&&e.jsxs(ti,{color:ne.danger,bg:ne.dangerBg,children:[" ",de," vencida(s)"]})]},W.id)})}),R.length===0&&e.jsx("div",{style:{textAlign:"center",padding:40,color:ne.inkLight},children:e.jsx("p",{style:{...Ee,fontSize:13},children:"No hay trabajadores registrados para este pas. Vinclalos desde RRHH."})})]})},J=()=>{const R=[];return a.forEach(W=>{const se=s.find(Z=>Z.asignacionId===W.id),le=o.find(Z=>Z.id===W.cursoId),de=u.find(Z=>Z.id===W.trabajadorId);if(!(!le||!de||le.pais!==j)){if(!se)R.push({tipo:"pendiente",curso:le,trab:de,asig:W,prioridad:le.obligatorio?1:3});else if(se.vencimiento){const Z=Ri(se.vencimiento);Z<0?R.push({tipo:"vencido",curso:le,trab:de,comp:se,dias:Math.abs(Z),prioridad:0}):Z<=60&&R.push({tipo:"por_vencer",curso:le,trab:de,comp:se,dias:Z,prioridad:2})}}}),R.sort((W,se)=>W.prioridad-se.prioridad),e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:2,marginBottom:16},children:[["CO",""],["ES",""]].map(([W,se])=>e.jsx("button",{onClick:()=>w(W),style:{...Ee,padding:"6px 14px",fontSize:11,fontWeight:j===W?700:500,color:j===W?"#fff":ne.inkMid,background:j===W?ne.accent:ne.surface,border:`1px solid ${j===W?ne.accent:ne.border}`,borderRadius:6,cursor:"pointer"},children:se},W))}),R.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:""}),e.jsx("p",{style:{...Ee,fontSize:14,color:ne.success,fontWeight:600},children:"Todo al da"}),e.jsx("p",{style:{...Ee,fontSize:12,color:ne.inkLight},children:"No hay formaciones pendientes, vencidas ni por vencer."})]}):e.jsx("div",{children:R.map((W,se)=>{const le={vencido:ne.dangerBg,por_vencer:ne.warningBg,pendiente:ne.infoBg},de={vencido:ne.danger,por_vencer:ne.warning,pendiente:ne.info},Z={vencido:"",por_vencer:"",pendiente:""},ue={vencido:`Vencido hace ${W.dias} das`,por_vencer:`Vence en ${W.dias} das`,pendiente:"Pendiente de completar"};return e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:le[W.tipo],border:`1px solid ${de[W.tipo]}22`,borderRadius:8,marginBottom:8},children:[e.jsx("span",{style:{fontSize:20},children:Z[W.tipo]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ee,fontSize:12,fontWeight:600,color:ne.ink},children:W.curso.nombre}),e.jsxs("div",{style:{...Ee,fontSize:11,color:ne.inkMid},children:[W.trab.nombre,"  ",W.trab.cargo]})]}),e.jsx(ti,{color:de[W.tipo],bg:"rgba(255,255,255,.7)",children:ue[W.tipo]}),W.curso.obligatorio&&e.jsx(ti,{color:ne.danger,bg:"rgba(255,255,255,.7)",children:"Obligatorio"})]},se)})})]})},M=()=>{const R=j==="CO"?[{ley:"Decreto 1072/2015",desc:"Decreto nico Reglamentario del Sector Trabajo. Establece la obligatoriedad del SG-SST.",aplica:"Toda empresa"},{ley:"Resolucin 0312/2019",desc:"Estndares Mnimos del SG-SST ajustados por tamao de empresa y nivel de riesgo.",aplica:"Toda empresa"},{ley:"Resolucin 4272/2021",desc:"Requisitos mnimos de seguridad para trabajo en alturas (1.5m).",aplica:"Personal en obra"},{ley:"Resolucin 2646/2008",desc:"Factores de riesgo psicosocial en el trabajo y determinacin del origen de las patologas.",aplica:"Toda empresa"},{ley:"Ley 1616/2013",desc:"Ley de Salud Mental. Promocin de la salud mental en ambientes laborales.",aplica:"Toda empresa"},{ley:"Ley 1581/2012",desc:"Rgimen general de proteccin de datos personales (Habeas Data).",aplica:"Toda empresa que maneje datos"},{ley:"Ley 1010/2006",desc:"Medidas para prevenir, corregir y sancionar el acoso laboral.",aplica:"Toda empresa"},{ley:"Decreto 1496/2018",desc:"Sistema Globalmente Armonizado (SGA) para clasificacin y etiquetado de productos qumicos.",aplica:"Empresas con qumicos"},{ley:"Resolucin 0491/2020",desc:"Requisitos mnimos de seguridad para trabajo en espacios confinados.",aplica:"Personal en obra (si aplica)"},{ley:"RETIE",desc:"Reglamento Tcnico de Instalaciones Elctricas. Resolucin 90708/2013.",aplica:"Instaladores elctricos"},{ley:"NSR-10",desc:"Norma Sismo Resistente de Colombia. Ley 400/1997 y Decreto 926/2010.",aplica:"Arquitectos e ingenieros"}]:[{ley:"Ley 31/1995 (LPRL)",desc:"Ley de Prevencin de Riesgos Laborales. Art. 19: formacin obligatoria adaptada al puesto.",aplica:"Toda empresa"},{ley:"RD 39/1997 (RSP)",desc:"Reglamento de los Servicios de Prevencin. Niveles de formacin (bsico, intermedio, superior).",aplica:"Toda empresa"},{ley:"VI CGSC",desc:"VI Convenio General del Sector de la Construccin. Formacin por oficios (8h a 20h).",aplica:"Personal en obra"},{ley:"RD 1627/1997",desc:"Disposiciones mnimas de seguridad y salud en obras de construccin.",aplica:"Obras de construccin"},{ley:"RD 488/1997",desc:"Disposiciones sobre trabajo con pantallas de visualizacin de datos.",aplica:"Personal de oficina"},{ley:"RD 171/2004",desc:"Coordinacin de Actividades Empresariales (CAE).",aplica:"Concurrencia empresarial"},{ley:"RGPD (UE 2016/679)",desc:"Reglamento General de Proteccin de Datos de la Unin Europea.",aplica:"Toda empresa con datos"},{ley:"LO 3/2018 (LOPDGDD)",desc:"Ley Orgnica de Proteccin de Datos y Garanta de Derechos Digitales. Art. 88: desconexin digital.",aplica:"Toda empresa"},{ley:"LO 3/2007",desc:"Ley de Igualdad. Plan de igualdad obligatorio 50 empleados. Protocolo acoso sexual.",aplica:"Toda empresa"},{ley:"LO 10/2022",desc:"Ley de garanta integral de la libertad sexual. Formacin obligatoria para toda empresa.",aplica:"Toda empresa"},{ley:"Ley 4/2023",desc:"Igualdad real de personas trans y derechos LGTBI. RD 1026/2024 para 50 empleados.",aplica:"Empresas 50"},{ley:"Ley 2/2023",desc:"Proteccin del informante (Whistleblowing). Canal de denuncias obligatorio 50 empleados.",aplica:"Empresas 50"},{ley:"Ley 10/2010",desc:"Prevencin del blanqueo de capitales. Obligatorio para promotores inmobiliarios.",aplica:"Sector inmobiliario"},{ley:"RD 314/2006 (CTE)",desc:"Cdigo Tcnico de la Edificacin. Documentos bsicos aplicables a reformas.",aplica:"Arquitectos e ingenieros"},{ley:"RD 105/2008",desc:"Regulacin de residuos de construccin y demolicin (RCD).",aplica:"Obras de construccin"}];return e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:2,marginBottom:16},children:[["CO"," Colombia"],["ES"," Espaa"]].map(([W,se])=>e.jsx("button",{onClick:()=>w(W),style:{...Ee,padding:"6px 14px",fontSize:11,fontWeight:j===W?700:500,color:j===W?"#fff":ne.inkMid,background:j===W?ne.accent:ne.surface,border:`1px solid ${j===W?ne.accent:ne.border}`,borderRadius:6,cursor:"pointer"},children:se},W))}),e.jsx("div",{style:{background:ne.infoBg,border:`1px solid ${ne.info}22`,borderRadius:8,padding:14,marginBottom:16},children:e.jsxs("p",{style:{...Ee,fontSize:12,color:ne.info,margin:0},children:[" Referencia normativa para empresas de ",e.jsx("b",{children:"diseo, arquitectura y remodelacin"})," en ",j==="CO"?"Colombia":"Espaa",". Verifica siempre la vigencia con tu asesor legal/SST."]})}),R.map((W,se)=>e.jsxs("div",{style:{display:"flex",gap:14,padding:"14px 0",borderBottom:`1px solid ${ne.border}`},children:[e.jsx("div",{style:{minWidth:160},children:e.jsx("div",{style:{...Ee,fontSize:12,fontWeight:700,color:ne.ink},children:W.ley})}),e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{...Ee,fontSize:12,color:ne.inkMid,lineHeight:1.5},children:W.desc})}),e.jsx("div",{style:{minWidth:130,textAlign:"right"},children:e.jsx(ti,{color:ne.inkMid,bg:ne.bg,children:W.aplica})})]},se))]})},B=a.filter(R=>!s.find(W=>W.asignacionId===R.id)).length,V=s.filter(R=>R.vencimiento&&Ri(R.vencimiento)<0).length,X=B+V;return e.jsxs("div",{style:{...Ee,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...Ee,fontSize:22,fontWeight:700,color:ne.ink,margin:"0 0 4px"},children:" Formacin"}),e.jsx("p",{style:{...Ee,fontSize:12,color:ne.inkLight,margin:0},children:"Gestin de formaciones obligatorias, operativas y corporativas"})]}),e.jsx(ax,{active:t,onChange:i,tabs:[{id:"catalogo",icon:"",label:"Catlogo de Cursos",badge:C.cursos},{id:"trabajadores",icon:"",label:"Trabajadores"},{id:"alertas",icon:"",label:"Alertas",badge:X||null},{id:"normativa",icon:"",label:"Normativa"}]}),e.jsxs("div",{style:{paddingTop:20},children:[t==="catalogo"&&je(),t==="trabajadores"&&re(),t==="alertas"&&J(),t==="normativa"&&M()]}),te(),P(),ie(),me(),Q()]})}const be={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},ot={fontFamily:"'DM Sans',sans-serif"},Ks="hab:carnets:",gx=t=>{try{return JSON.parse(localStorage.getItem(Ks+t))||null}catch{return null}},ux=(t,i)=>{var o,n;localStorage.setItem(Ks+t,JSON.stringify(i));try{(n=(o=window.storage)==null?void 0:o.set)==null||n.call(o,Ks+t,JSON.stringify(i))}catch{}},hx=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7);function yr(t,i=120,o="#111",n="transparent"){const r=i/21,s=(j,w)=>{let S=0;for(let m=0;m<j.length;m++)S=(S<<5)-S+j.charCodeAt(m)*(w+1)|0;return S};let d=[];const u=(j,w)=>{for(let S=0;S<7;S++)for(let m=0;m<7;m++){const x=m===0||m===6||S===0||S===6,p=m>=2&&m<=4&&S>=2&&S<=4;(x||p)&&d.push({x:j+m,y:w+S})}};u(0,0),u(14,0),u(0,14);for(let j=0;j<21;j++)for(let w=0;w<21;w++)!(w<8&&j<8||w>12&&j<8||w<8&&j>12)&&Math.abs(s(t,w*21+j))%3!==0&&d.push({x:w,y:j});const b=d.map(j=>`<rect x="${j.x*r}" y="${j.y*r}" width="${r}" height="${r}" fill="${o}" rx="0.5"/>`).join("");return`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${i}" viewBox="0 0 ${i} ${i}">${b}</svg>`}function fx(){var t,i,o,n,a,r,s,d,u,b,j;try{const w=JSON.parse(localStorage.getItem("hab:config"))||{};return{nombre:((t=w.empresa)==null?void 0:t.nombre)||"Habitaris",nit:((i=w.empresa)==null?void 0:i.nit)||"901.922.136-8",direccion:((o=w.empresa)==null?void 0:o.direccion)||"Bogot D.C., Colombia",telefono:((n=w.empresa)==null?void 0:n.telefono)||"+57 350 566 1545",email:((a=w.empresa)==null?void 0:a.email)||"info@habitaris.co",web:((r=w.empresa)==null?void 0:r.web)||"www.habitaris.co",logo:((s=w.apariencia)==null?void 0:s.logo)||null,colorPrimario:((d=w.apariencia)==null?void 0:d.colorPrimario)||"#111111",colorAcento:((u=w.apariencia)==null?void 0:u.colorAcento)||"#111111",tipografia:((b=w.apariencia)==null?void 0:b.tipografia)||"DM Sans",slogan:((j=w.apariencia)==null?void 0:j.slogan)||"Diseo  Arquitectura  Remodelacin"}}catch{return{nombre:"Habitaris",colorPrimario:"#111",colorAcento:"#111111",tipografia:"DM Sans",slogan:"Diseo  Arquitectura  Remodelacin"}}}const xx=[{id:"e1",nombre:"Ana Garca Ruiz",cargo:"Diseadora de Interiores",departamento:"Diseo",email:"ana@habitaris.co",telefono:"+57 310 555 1234",foto:null,fechaIngreso:"2023-03-15",tipoDoc:"CC",documento:"1.020.456.789",rh:"O+",eps:"Sura",arl:"Sura"},{id:"e2",nombre:"Carlos Lpez Meja",cargo:"Arquitecto Senior",departamento:"Arquitectura",email:"carlos@habitaris.co",telefono:"+57 311 555 5678",foto:null,fechaIngreso:"2022-08-01",tipoDoc:"CC",documento:"80.456.123",rh:"A+",eps:"Compensar",arl:"Sura"},{id:"e3",nombre:"Mara Rodrguez Pea",cargo:"Directora de Obra",departamento:"Obra",email:"maria@habitaris.co",telefono:"+57 320 555 9012",foto:null,fechaIngreso:"2023-01-10",tipoDoc:"CC",documento:"52.789.456",rh:"B+",eps:"Sanitas",arl:"Positiva"},{id:"e4",nombre:"Pedro Martnez Torres",cargo:"Instalador Tcnico",departamento:"Obra",email:"pedro@habitaris.co",telefono:"+57 300 555 3456",foto:null,fechaIngreso:"2024-02-20",tipoDoc:"CC",documento:"1.098.765.432",rh:"O-",eps:"Nueva EPS",arl:"Positiva"},{id:"e5",nombre:"Laura Snchez Daz",cargo:"Gerente General",departamento:"Direccin",email:"laura@habitaris.co",telefono:"+57 315 555 7890",foto:null,fechaIngreso:"2022-01-01",tipoDoc:"CC",documento:"35.123.789",rh:"AB+",eps:"Sura",arl:"Sura"},{id:"e6",nombre:"David Torres Vargas",cargo:"Asesor Comercial",departamento:"Comercial",email:"david@habitaris.co",telefono:"+57 318 555 2345",foto:null,fechaIngreso:"2024-06-01",tipoDoc:"CC",documento:"1.015.432.876",rh:"A-",eps:"Compensar",arl:"Sura"}],sd=[{id:"classic",label:"Clsico",desc:"Diseo limpio con franja superior de color"},{id:"modern",label:"Moderno",desc:"Degradado diagonal con tipografa bold"},{id:"minimal",label:"Minimalista",desc:"Blanco y negro con detalles de acento"},{id:"obra",label:"Obra / SST",desc:"Datos de emergencia, EPS, ARL, RH y contacto"}],ld=[{id:"corporate",label:"Corporativa",desc:"Elegante con logo centrado y datos al reverso"},{id:"creative",label:"Creativa",desc:"Color de acento con layout asimtrico"},{id:"minimal_biz",label:"Minimalista",desc:"Tipografa limpia, mxima legibilidad"}];function mx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const a=yr(`https://${i.web}/team/${t.id}`,80,i.colorPrimario);return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${be.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:8,background:i.colorPrimario}}),e.jsxs("div",{style:{padding:"20px 24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100% - 8px)"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:be.inkLight,textAlign:"center",lineHeight:1.5},children:[t.tipoDoc,": ",t.documento,e.jsx("br",{}),"RH: ",t.rh,"  EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),"Ingreso: ",new Date(t.fechaIngreso).toLocaleDateString("es-CO")]}),e.jsxs("div",{style:{fontSize:7,color:be.inkLight,marginTop:8},children:["En caso de emergencia contactar al ",i.telefono]})]})]})}return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${be.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:56,background:i.colorPrimario,display:"flex",alignItems:"center",padding:"0 20px",gap:10},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:24,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:14,fontWeight:700,color:"#fff",letterSpacing:1.5},children:i.nombre.toUpperCase()})}),e.jsxs("div",{style:{padding:"14px 20px",display:"flex",gap:14},children:[e.jsx("div",{style:{width:64,height:76,borderRadius:8,background:be.bg,border:`2px solid ${i.colorAcento}`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:28,fontWeight:700,color:i.colorAcento},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:be.ink,marginBottom:2,lineHeight:1.2},children:t.nombre}),e.jsx("div",{style:{fontSize:10,fontWeight:600,color:i.colorAcento,marginBottom:6},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:be.inkLight,lineHeight:1.5},children:[t.departamento,e.jsx("br",{}),t.email,e.jsx("br",{}),t.telefono]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:3,background:i.colorAcento}})]})}function bx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const a=yr(`https://${i.web}/team/${t.id}`,80,"#fff");return e.jsx("div",{style:{width:320,height:200,borderRadius:10,overflow:"hidden",background:`linear-gradient(135deg, ${i.colorPrimario} 0%, ${i.colorAcento} 100%)`,position:"relative",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:20},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,.7)",textAlign:"center",lineHeight:1.6},children:[t.tipoDoc,": ",t.documento,"  RH: ",t.rh,e.jsx("br",{}),"EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),"Emergencias: ",i.telefono]})]})})}return e.jsxs("div",{style:{width:320,height:200,borderRadius:10,overflow:"hidden",background:`linear-gradient(135deg, ${i.colorPrimario} 0%, ${i.colorAcento} 100%)`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{padding:"20px 24px",display:"flex",gap:16,height:"100%",boxSizing:"border-box"},children:[e.jsx("div",{style:{width:68,height:82,borderRadius:10,background:"rgba(255,255,255,.15)",border:"2px solid rgba(255,255,255,.3)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}):e.jsx("span",{style:{fontSize:30,fontWeight:800,color:"rgba(255,255,255,.6)"},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:800,color:"#fff",marginBottom:2,lineHeight:1.2,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:10,fontWeight:500,color:"rgba(255,255,255,.65)",marginBottom:10},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,.5)",lineHeight:1.6},children:[t.departamento,"  ",t.email,e.jsx("br",{}),t.telefono]})]})]}),e.jsx("div",{style:{position:"absolute",top:14,right:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:18,objectFit:"contain",opacity:.8}}):e.jsx("span",{style:{fontSize:10,fontWeight:700,color:"rgba(255,255,255,.4)",letterSpacing:1.5,textTransform:"uppercase"},children:i.nombre})})]})}function yx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const a=yr(`https://${i.web}/team/${t.id}`,80,be.ink);return e.jsx("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${be.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:20},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:be.inkLight,textAlign:"center",lineHeight:1.6},children:[t.tipoDoc," ",t.documento,"  RH: ",t.rh,e.jsx("br",{}),"EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),i.telefono]})]})})}return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${be.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{display:"flex",height:"100%"},children:[e.jsx("div",{style:{width:4,background:i.colorAcento}}),e.jsxs("div",{style:{flex:1,padding:"20px 22px",display:"flex",gap:14},children:[e.jsx("div",{style:{width:60,height:72,borderRadius:6,background:be.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:26,fontWeight:700,color:be.inkLight},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:be.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,marginBottom:8,textTransform:"uppercase",letterSpacing:.5},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:be.inkLight,lineHeight:1.6},children:[t.departamento,e.jsx("br",{}),t.email,"  ",t.telefono]})]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:10,right:16,fontSize:8,fontWeight:600,color:be.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:i.nombre})]})}function vx({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${be.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:32,background:"#B91C1C",display:"flex",alignItems:"center",padding:"0 16px"},children:e.jsx("span",{style:{fontSize:10,fontWeight:700,color:"#fff",letterSpacing:1},children:" DATOS DE EMERGENCIA"})}),e.jsxs("div",{style:{padding:"10px 16px",fontSize:9,color:be.ink,lineHeight:1.8},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"2px 10px"},children:[e.jsx("b",{children:"RH:"}),e.jsx("span",{style:{fontSize:14,fontWeight:800,color:"#B91C1C"},children:t.rh}),e.jsx("b",{children:"EPS:"}),e.jsx("span",{children:t.eps}),e.jsx("b",{children:"ARL:"}),e.jsx("span",{children:t.arl}),e.jsx("b",{children:"Doc:"}),e.jsxs("span",{children:[t.tipoDoc," ",t.documento]}),e.jsx("b",{children:"Ingreso:"}),e.jsx("span",{children:new Date(t.fechaIngreso).toLocaleDateString("es-CO")})]}),e.jsxs("div",{style:{marginTop:8,padding:"6px 10px",background:"#FFF3F3",borderRadius:4,border:"1px solid #B91C1C33"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#B91C1C"},children:"Contacto de emergencia empresa:"}),e.jsxs("div",{style:{fontSize:9,color:be.ink},children:[i.telefono,"  ",i.email]})]})]}),e.jsxs("div",{style:{position:"absolute",bottom:6,right:10,fontSize:7,color:be.inkLight},children:["Si encuentra esta tarjeta, devulvala a ",i.nombre]})]}):e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${be.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{height:44,background:i.colorPrimario,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:20,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:12,fontWeight:700,color:"#fff",letterSpacing:1},children:i.nombre.toUpperCase()}),e.jsx("span",{style:{fontSize:8,fontWeight:600,color:"rgba(255,255,255,.5)",background:"rgba(255,255,255,.1)",padding:"2px 8px",borderRadius:3},children:"PERSONAL DE OBRA"})]}),e.jsxs("div",{style:{padding:"10px 16px",display:"flex",gap:12},children:[e.jsx("div",{style:{width:58,height:70,borderRadius:6,background:be.bg,border:`2px solid ${i.colorAcento}`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4}}):e.jsx("span",{style:{fontSize:24,fontWeight:700,color:i.colorAcento},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:be.ink,marginBottom:1},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,marginBottom:4},children:t.cargo}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("span",{style:{fontSize:18,fontWeight:800,color:"#B91C1C",padding:"2px 8px",background:"#FFF3F3",borderRadius:4},children:t.rh}),e.jsxs("div",{style:{fontSize:8,color:be.inkLight,lineHeight:1.5},children:["EPS: ",t.eps,e.jsx("br",{}),"ARL: ",t.arl]})]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:3,background:"#B91C1C"}})]})}const bc={classic:mx,modern:bx,minimal:yx,obra:vx};function jx({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsx("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",background:i.colorPrimario,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{textAlign:"center"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:32,objectFit:"contain",marginBottom:10}}):e.jsx("div",{style:{fontSize:18,fontWeight:800,color:"#fff",letterSpacing:2,marginBottom:6},children:i.nombre.toUpperCase()}),e.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,.45)",letterSpacing:2,textTransform:"uppercase"},children:i.slogan})]})}):e.jsxs("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${be.border}`,fontFamily:`'${n}',sans-serif`,position:"relative"},children:[e.jsx("div",{style:{height:4,background:i.colorAcento}}),e.jsxs("div",{style:{padding:"22px 24px"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,color:be.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,textTransform:"uppercase",letterSpacing:.8,marginBottom:14},children:t.cargo}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"3px 8px",fontSize:8,color:be.inkMid},children:[e.jsx("span",{style:{color:be.inkLight},children:""}),e.jsx("span",{children:t.email}),e.jsx("span",{style:{color:be.inkLight},children:""}),e.jsx("span",{children:t.telefono}),e.jsx("span",{style:{color:be.inkLight},children:""}),e.jsx("span",{children:i.direccion}),e.jsx("span",{style:{color:be.inkLight},children:""}),e.jsx("span",{children:i.web})]})]}),e.jsx("div",{style:{position:"absolute",bottom:12,right:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:16,objectFit:"contain",opacity:.3}}):e.jsx("span",{style:{fontSize:8,fontWeight:700,color:be.inkLight,letterSpacing:1.5,textTransform:"uppercase",opacity:.3},children:i.nombre})})]})}function Sx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const a=yr(`https://${i.web}/team/${t.id}`,70,"#fff");return e.jsxs("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",background:`linear-gradient(145deg, ${i.colorAcento} 0%, ${i.colorPrimario} 100%)`,fontFamily:`'${n}',sans-serif`,display:"flex",alignItems:"center",justifyContent:"center",gap:24,padding:"0 30px"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a}}),e.jsxs("div",{style:{textAlign:"left"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:22,objectFit:"contain",marginBottom:8}}):e.jsx("div",{style:{fontSize:14,fontWeight:800,color:"#fff",letterSpacing:1.5,marginBottom:6},children:i.nombre}),e.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.5)",letterSpacing:1.5,textTransform:"uppercase",lineHeight:1.6},children:[i.slogan,e.jsx("br",{}),i.web]})]})]})}return e.jsxs("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",position:"relative",background:"#fff",border:`1px solid ${be.border}`,fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:100,height:"100%",background:`linear-gradient(180deg, ${i.colorAcento} 0%, ${i.colorPrimario} 100%)`},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("div",{style:{width:44,height:52,borderRadius:8,background:"rgba(255,255,255,.15)",border:"1.5px solid rgba(255,255,255,.25)",display:"flex",alignItems:"center",justifyContent:"center"},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:22,fontWeight:800,color:"rgba(255,255,255,.6)"},children:t.nombre[0]})})})}),e.jsxs("div",{style:{marginLeft:112,padding:"22px 20px"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,color:be.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,textTransform:"uppercase",letterSpacing:.8,marginBottom:14},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:be.inkMid,lineHeight:1.8},children:[t.email,e.jsx("br",{}),t.telefono,e.jsx("br",{}),i.web]})]})]})}function Cx({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsx("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${be.border}`,fontFamily:`'${n}',sans-serif`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:28,objectFit:"contain",opacity:.2}}):e.jsx("div",{style:{fontSize:16,fontWeight:800,color:be.ink,letterSpacing:3,opacity:.12},children:i.nombre.toUpperCase()}),e.jsx("div",{style:{fontSize:7,color:be.inkLight,letterSpacing:2,textTransform:"uppercase",marginTop:8},children:i.slogan})]})}):e.jsxs("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${be.border}`,fontFamily:`'${n}',sans-serif`,position:"relative",padding:24,boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:[e.jsx("div",{style:{position:"absolute",top:20,right:20},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:14,objectFit:"contain",opacity:.25}}):e.jsx("span",{style:{fontSize:8,fontWeight:700,color:be.inkLight,letterSpacing:1.5,textTransform:"uppercase",opacity:.3},children:i.nombre})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:16,fontWeight:700,color:be.ink,marginBottom:1,letterSpacing:-.5},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:500,color:i.colorAcento,marginBottom:12},children:t.cargo}),e.jsxs("div",{style:{display:"flex",gap:16,fontSize:8,color:be.inkLight},children:[e.jsx("span",{children:t.email}),e.jsx("span",{children:t.telefono}),e.jsx("span",{children:i.web})]})]})]})}const yc={corporate:jx,creative:Sx,minimal_biz:Cx};function kx({emp:t,brand:i}){const o=i.tipografia,n=yr(`https://${i.web}/team/${t.id}`,100,i.colorAcento);return e.jsxs("div",{style:{width:320,borderRadius:16,overflow:"hidden",background:"#fff",boxShadow:"0 8px 32px rgba(0,0,0,.12)",fontFamily:`'${o}',sans-serif`},children:[e.jsxs("div",{style:{height:80,background:`linear-gradient(135deg, ${i.colorPrimario}, ${i.colorAcento})`,position:"relative",display:"flex",alignItems:"flex-end",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:12,left:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:16,objectFit:"contain",opacity:.6}}):e.jsx("span",{style:{fontSize:9,fontWeight:700,color:"rgba(255,255,255,.5)",letterSpacing:1.5},children:i.nombre.toUpperCase()})}),e.jsx("div",{style:{width:72,height:72,borderRadius:"50%",background:"#fff",border:"3px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",transform:"translateY(36px)",boxShadow:"0 4px 12px rgba(0,0,0,.1)"},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%"}}):e.jsx("span",{style:{fontSize:28,fontWeight:800,color:i.colorAcento},children:t.nombre[0]})})]}),e.jsxs("div",{style:{padding:"44px 24px 20px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:be.ink,marginBottom:2},children:t.nombre}),e.jsx("div",{style:{fontSize:11,fontWeight:500,color:i.colorAcento,marginBottom:4},children:t.cargo}),e.jsxs("div",{style:{fontSize:10,color:be.inkLight,marginBottom:16},children:[t.departamento,"  ",i.nombre]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"center",marginBottom:16},children:[{icon:"",label:"Email",val:t.email},{icon:"",label:"Llamar",val:t.telefono},{icon:"",label:"Web",val:i.web}].map((a,r)=>e.jsxs("div",{style:{flex:1,padding:"10px 6px",background:be.surface,borderRadius:10,border:`1px solid ${be.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:16,marginBottom:2},children:a.icon}),e.jsx("div",{style:{fontSize:8,fontWeight:600,color:be.inkMid},children:a.label})]},r))}),e.jsxs("div",{style:{textAlign:"left",fontSize:10,color:be.inkMid,lineHeight:1.8,padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:be.inkLight},children:"Email"}),e.jsx("span",{children:t.email})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:be.inkLight},children:"Telfono"}),e.jsx("span",{children:t.telefono})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:be.inkLight},children:"Direccin"}),e.jsx("span",{children:i.direccion})]})]}),e.jsxs("div",{style:{marginTop:16,padding:16,background:be.surface,borderRadius:12,display:"inline-block"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:n}}),e.jsx("div",{style:{fontSize:8,color:be.inkLight,marginTop:4},children:"Escanea para guardar contacto"})]})]})]})}function wx({empleados:t,brand:i,tipo:o,template:n}){const a=o==="carnet"?bc[n]:yc[n];return a?e.jsxs("div",{style:{background:"#fff",padding:20},children:[e.jsxs("div",{style:{...ot,fontSize:11,color:be.inkLight,marginBottom:16,textAlign:"center"},children:["Vista previa de impresin  ",t.length," ",o==="carnet"?"carnets":"tarjetas"," (frente y reverso)"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:t.map(r=>e.jsxs(ka.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{...ot,fontSize:9,color:be.inkLight,marginBottom:4},children:["Frente  ",r.nombre]}),e.jsx(a,{emp:r,brand:i,side:"front"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{...ot,fontSize:9,color:be.inkLight,marginBottom:4},children:"Reverso"}),e.jsx(a,{emp:r,brand:i,side:"back"})]})]},r.id))})]}):null}function zx(){const t=F.useMemo(()=>fx(),[]),[i,o]=F.useState("carnets"),[n,a]=F.useState(()=>gx("empleados")||xx),[r,s]=F.useState(null),[d,u]=F.useState("classic"),[b,j]=F.useState("corporate"),[w,S]=F.useState("front"),[m,x]=F.useState(!1),[p,c]=F.useState([]),[g,l]=F.useState(null),[f,y]=F.useState("");F.useEffect(()=>ux("empleados",n),[n]);const h=F.useMemo(()=>{if(!f)return n;const oe=f.toLowerCase();return n.filter(te=>te.nombre.toLowerCase().includes(oe)||te.cargo.toLowerCase().includes(oe)||te.departamento.toLowerCase().includes(oe))},[n,f]),v=r?n.find(oe=>oe.id===r):h[0],A=oe=>{c(te=>te.includes(oe)?te.filter(P=>P!==oe):[...te,oe])},z=[{id:"carnets",icon:"",label:"Carnets Corporativos"},{id:"tarjetas",icon:"",label:"Tarjetas de Visita"},{id:"virtual",icon:"",label:"Tarjeta Virtual"},{id:"empleados",icon:"",label:"Empleados"}],k=()=>{if(!g)return null;const oe=!n.find(me=>me.id===g.id),te=(me,Q)=>l(je=>({...je,[me]:Q})),P=()=>{a(oe?me=>[...me,g]:me=>me.map(Q=>Q.id===g.id?g:Q)),l(null)},ie=[["nombre","Nombre completo","text"],["cargo","Cargo","text"],["departamento","Departamento","text"],["email","Email corporativo","email"],["telefono","Telfono","tel"],["tipoDoc","Tipo documento","text"],["documento","N documento","text"],["rh","Grupo sanguneo","text"],["eps","EPS","text"],["arl","ARL","text"],["fechaIngreso","Fecha ingreso","date"]];return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>l(null),children:e.jsxs("div",{onClick:me=>me.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:520,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...ot,fontSize:16,fontWeight:700,color:be.ink,marginBottom:16},children:oe?" Nuevo empleado":" Editar empleado"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:ie.map(([me,Q,je])=>e.jsxs("div",{style:{gridColumn:me==="nombre"?"1 / -1":void 0},children:[e.jsx("label",{style:{...ot,fontSize:10,fontWeight:600,color:be.inkLight},children:Q}),e.jsx("input",{type:je,value:g[me]||"",onChange:re=>te(me,re.target.value),style:{...ot,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${be.border}`,borderRadius:5,boxSizing:"border-box"}})]},me))}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("label",{style:{...ot,fontSize:10,fontWeight:600,color:be.inkLight},children:"Foto (URL)"}),e.jsx("input",{value:g.foto||"",onChange:me=>te("foto",me.target.value),placeholder:"https://ejemplo.com/foto.jpg",style:{...ot,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${be.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>l(null),style:{...ot,padding:"8px 20px",fontSize:12,color:be.inkMid,background:be.bg,border:`1px solid ${be.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:P,style:{...ot,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:be.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},T=()=>{var te;const oe=bc[d];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[sd.map(P=>e.jsx("button",{onClick:()=>u(P.id),style:{...ot,padding:"8px 16px",fontSize:11,fontWeight:d===P.id?700:500,color:d===P.id?"#fff":be.inkMid,background:d===P.id?be.accent:be.surface,border:`1px solid ${d===P.id?be.accent:be.border}`,borderRadius:6,cursor:"pointer"},children:P.label},P.id)),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>S(P=>P==="front"?"back":"front"),style:{...ot,padding:"8px 14px",fontSize:11,color:be.info,background:be.infoBg,border:`1px solid ${be.info}33`,borderRadius:6,cursor:"pointer"},children:[" ",w==="front"?"Ver reverso":"Ver frente"]}),e.jsx("button",{onClick:()=>x(!m),style:{...ot,padding:"8px 14px",fontSize:11,fontWeight:600,color:m?be.danger:be.inkMid,background:m?be.dangerBg:be.surface,border:`1px solid ${m?be.danger+"33":be.border}`,borderRadius:6,cursor:"pointer"},children:m?" Cancelar lote":" Imprimir lote"})]}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:f,onChange:P=>y(P.target.value),placeholder:"Buscar",style:{...ot,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${be.border}`,borderRadius:5,boxSizing:"border-box"}})}),h.map(P=>e.jsxs("div",{onClick:()=>{s(P.id),m&&A(P.id)},style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,transition:"all .1s",background:r===P.id?be.accentBg:p.includes(P.id)?be.infoBg:"transparent",border:`1px solid ${r===P.id?be.accent+"33":"transparent"}`},children:[m&&e.jsx("input",{type:"checkbox",checked:p.includes(P.id),readOnly:!0,style:{accentColor:be.accent}}),e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:be.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:be.accent,flexShrink:0},children:P.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...ot,fontSize:11,fontWeight:600,color:be.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:P.nombre}),e.jsx("div",{style:{...ot,fontSize:9,color:be.inkLight},children:P.cargo})]})]},P.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:m&&p.length>0?e.jsx(wx,{empleados:n.filter(P=>p.includes(P.id)),brand:t,tipo:"carnet",template:d}):v?e.jsxs("div",{children:[e.jsxs("div",{style:{...ot,fontSize:10,color:be.inkLight,textAlign:"center",marginBottom:8},children:[w==="front"?"FRENTE":"REVERSO","  Plantilla: ",(te=sd.find(P=>P.id===d))==null?void 0:te.label]}),e.jsx("div",{style:{transform:"scale(1.2)",transformOrigin:"top center",marginBottom:40},children:e.jsx(oe,{emp:v,brand:t,side:w})}),e.jsx("div",{style:{...ot,fontSize:10,color:be.inkLight,textAlign:"center",marginTop:60},children:"Tamao: 85.6mm  54mm (estndar ISO/IEC 7810 CR80)"})]}):e.jsxs("div",{style:{...ot,textAlign:"center",padding:40,color:be.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado para ver su carnet"})]})})]})]})},C=()=>{var te;const oe=yc[b];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[ld.map(P=>e.jsx("button",{onClick:()=>j(P.id),style:{...ot,padding:"8px 16px",fontSize:11,fontWeight:b===P.id?700:500,color:b===P.id?"#fff":be.inkMid,background:b===P.id?be.accent:be.surface,border:`1px solid ${b===P.id?be.accent:be.border}`,borderRadius:6,cursor:"pointer"},children:P.label},P.id)),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>S(P=>P==="front"?"back":"front"),style:{...ot,padding:"8px 14px",fontSize:11,color:be.info,background:be.infoBg,border:`1px solid ${be.info}33`,borderRadius:6,cursor:"pointer"},children:[" ",w==="front"?"Ver reverso":"Ver frente"]})]}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:f,onChange:P=>y(P.target.value),placeholder:"Buscar",style:{...ot,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${be.border}`,borderRadius:5,boxSizing:"border-box"}})}),h.map(P=>e.jsxs("div",{onClick:()=>s(P.id),style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,background:r===P.id?be.accentBg:"transparent",border:`1px solid ${r===P.id?be.accent+"33":"transparent"}`},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:be.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:be.accent,flexShrink:0},children:P.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...ot,fontSize:11,fontWeight:600,color:be.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:P.nombre}),e.jsx("div",{style:{...ot,fontSize:9,color:be.inkLight},children:P.cargo})]})]},P.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:v?e.jsxs("div",{children:[e.jsxs("div",{style:{...ot,fontSize:10,color:be.inkLight,textAlign:"center",marginBottom:8},children:[w==="front"?"FRENTE":"REVERSO","  Plantilla: ",(te=ld.find(P=>P.id===b))==null?void 0:te.label]}),e.jsx("div",{style:{transform:"scale(1.15)",transformOrigin:"top center",marginBottom:30},children:e.jsx(oe,{emp:v,brand:t,side:w})}),e.jsx("div",{style:{...ot,fontSize:10,color:be.inkLight,textAlign:"center",marginTop:50},children:"Tamao: 90mm  50mm (estndar europeo)"})]}):e.jsxs("div",{style:{...ot,textAlign:"center",padding:40,color:be.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado"})]})})]})]})},D=()=>e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:f,onChange:oe=>y(oe.target.value),placeholder:"Buscar",style:{...ot,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${be.border}`,borderRadius:5,boxSizing:"border-box"}})}),h.map(oe=>e.jsxs("div",{onClick:()=>s(oe.id),style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,background:r===oe.id?be.accentBg:"transparent",border:`1px solid ${r===oe.id?be.accent+"33":"transparent"}`},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:be.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:be.accent,flexShrink:0},children:oe.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...ot,fontSize:11,fontWeight:600,color:be.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:oe.nombre}),e.jsx("div",{style:{...ot,fontSize:9,color:be.inkLight},children:oe.cargo})]})]},oe.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:v?e.jsxs("div",{children:[e.jsx("div",{style:{...ot,fontSize:10,color:be.inkLight,textAlign:"center",marginBottom:12},children:"TARJETA VIRTUAL  vista previa mvil"}),e.jsx(kx,{emp:v,brand:t}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:20},children:[e.jsx("button",{style:{...ot,padding:"8px 18px",fontSize:11,fontWeight:600,color:be.accent,background:be.accentBg,border:`1px solid ${be.accent}33`,borderRadius:6,cursor:"pointer"},children:" Copiar enlace"}),e.jsx("button",{style:{...ot,padding:"8px 18px",fontSize:11,fontWeight:600,color:be.info,background:be.infoBg,border:`1px solid ${be.info}33`,borderRadius:6,cursor:"pointer"},children:" Compartir WhatsApp"}),e.jsx("button",{style:{...ot,padding:"8px 18px",fontSize:11,fontWeight:600,color:be.inkMid,background:be.surface,border:`1px solid ${be.border}`,borderRadius:6,cursor:"pointer"},children:" Descargar vCard"})]}),e.jsx("div",{style:{...ot,fontSize:10,color:be.inkLight,textAlign:"center",marginTop:12},children:"El destinatario puede guardar el contacto directamente escaneando el QR"})]}):e.jsxs("div",{style:{...ot,textAlign:"center",padding:40,color:be.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado"})]})})]})}),K=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:f,onChange:oe=>y(oe.target.value),placeholder:"Buscar por nombre, cargo, departamento",style:{...ot,width:"100%",padding:"8px 12px",fontSize:12,border:`1px solid ${be.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>l({id:hx(),nombre:"",cargo:"",departamento:"",email:"",telefono:"",tipoDoc:"CC",documento:"",rh:"O+",eps:"",arl:"",fechaIngreso:new Date().toISOString().slice(0,10),foto:null}),style:{...ot,padding:"8px 18px",fontSize:11,fontWeight:700,color:"#fff",background:be.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo empleado"})]}),e.jsx("div",{style:{background:"#fff",borderRadius:10,border:`1px solid ${be.border}`,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:be.surface},children:["","Nombre","Cargo","Departamento","Email","Doc","RH",""].map((oe,te)=>e.jsx("th",{style:{...ot,padding:"10px 12px",textAlign:"left",fontSize:10,fontWeight:600,color:be.inkLight,borderBottom:`1px solid ${be.border}`},children:oe},te))})}),e.jsx("tbody",{children:h.map(oe=>e.jsxs("tr",{style:{borderBottom:`1px solid ${be.border}`},onMouseEnter:te=>te.currentTarget.style.background=be.surface,onMouseLeave:te=>te.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:be.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:be.accent},children:oe.nombre[0]})}),e.jsx("td",{style:{...ot,padding:"8px 12px",fontWeight:600,color:be.ink},children:oe.nombre}),e.jsx("td",{style:{...ot,padding:"8px 12px",color:be.inkMid},children:oe.cargo}),e.jsx("td",{style:{...ot,padding:"8px 12px",color:be.inkMid},children:oe.departamento}),e.jsx("td",{style:{...ot,padding:"8px 12px",color:be.inkLight,fontSize:11},children:oe.email}),e.jsxs("td",{style:{...ot,padding:"8px 12px",color:be.inkLight,fontSize:11},children:[oe.tipoDoc," ",oe.documento]}),e.jsx("td",{style:{...ot,padding:"8px 12px"},children:e.jsx("span",{style:{fontWeight:700,color:"#B91C1C",fontSize:13},children:oe.rh})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("button",{onClick:()=>l({...oe}),style:{...ot,padding:"4px 10px",fontSize:10,color:be.accent,background:be.accentBg,border:`1px solid ${be.accent}33`,borderRadius:4,cursor:"pointer"},children:""})})]},oe.id))})]})}),e.jsx("p",{style:{...ot,fontSize:10,color:be.inkLight,marginTop:12},children:" Tip: En produccin, los empleados se vincularn automticamente desde el mdulo de RRHH."})]});return e.jsxs("div",{style:{...ot,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...ot,fontSize:22,fontWeight:700,color:be.ink,margin:"0 0 4px"},children:" Identidad Corporativa"}),e.jsxs("p",{style:{...ot,fontSize:12,color:be.inkLight,margin:0},children:["Carnets corporativos, tarjetas de visita fsicas y virtuales con la identidad de ",t.nombre]})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${be.border}`,marginBottom:20},children:z.map(oe=>e.jsxs("button",{onClick:()=>o(oe.id),style:{...ot,padding:"10px 18px",fontSize:12,fontWeight:i===oe.id?700:500,color:i===oe.id?be.accent:be.inkLight,background:"none",border:"none",borderBottom:i===oe.id?`2px solid ${be.accent}`:"2px solid transparent",cursor:"pointer",transition:"all .15s"},children:[oe.icon," ",oe.label]},oe.id))}),i==="carnets"&&T(),i==="tarjetas"&&C(),i==="virtual"&&D(),i==="empleados"&&K(),k()]})}const Ce={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},Le={fontFamily:"'DM Sans',sans-serif"},Js="hab:firmas:",dd=t=>{try{return JSON.parse(localStorage.getItem(Js+t))||null}catch{return null}},cd=(t,i)=>{var o,n;localStorage.setItem(Js+t,JSON.stringify(i));try{(n=(o=window.storage)==null?void 0:o.set)==null||n.call(o,Js+t,JSON.stringify(i))}catch{}},qr=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),cs=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",ps=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function pd({onSave:t,onCancel:i,signer:o,width:n=480,height:a=200}){const r=F.useRef(null),[s,d]=F.useState(!1),[u,b]=F.useState(!1),j=F.useRef(null);F.useEffect(()=>{const g=r.current;if(!g)return;const l=g.getContext("2d");l.fillStyle="#fff",l.fillRect(0,0,n,a),l.strokeStyle="#E0E0E0",l.lineWidth=1,l.setLineDash([4,4]),l.beginPath(),l.moveTo(30,a-40),l.lineTo(n-30,a-40),l.stroke(),l.setLineDash([]),l.fillStyle="#AAA",l.font="10px 'DM Sans', sans-serif",l.fillText("Firma aqu",30,a-20)},[n,a]);const w=g=>{const f=r.current.getBoundingClientRect(),y=g.touches?g.touches[0].clientX:g.clientX,h=g.touches?g.touches[0].clientY:g.clientY;return{x:(y-f.left)*(n/f.width),y:(h-f.top)*(a/f.height)}},S=g=>{g.preventDefault(),d(!0),j.current=w(g)},m=g=>{if(!s)return;g.preventDefault();const f=r.current.getContext("2d"),y=w(g);f.strokeStyle="#111",f.lineWidth=2.5,f.lineCap="round",f.lineJoin="round",f.beginPath(),f.moveTo(j.current.x,j.current.y),f.lineTo(y.x,y.y),f.stroke(),j.current=y,b(!0)},x=()=>{d(!1),j.current=null},p=()=>{const l=r.current.getContext("2d");l.fillStyle="#fff",l.fillRect(0,0,n,a),l.strokeStyle="#E0E0E0",l.lineWidth=1,l.setLineDash([4,4]),l.beginPath(),l.moveTo(30,a-40),l.lineTo(n-30,a-40),l.stroke(),l.setLineDash([]),l.fillStyle="#AAA",l.font="10px 'DM Sans', sans-serif",l.fillText("Firma aqu",30,a-20),b(!1)},c=()=>{if(!u)return;const g=r.current.toDataURL("image/png");t(g)};return e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:20,border:`1px solid ${Ce.border}`},children:[o&&e.jsxs("div",{style:{...Le,fontSize:12,color:Ce.inkMid,marginBottom:12},children:["Firmante: ",e.jsx("b",{children:o})]}),e.jsx("div",{style:{border:`2px solid ${Ce.border}`,borderRadius:8,overflow:"hidden",marginBottom:12,touchAction:"none",cursor:"crosshair"},children:e.jsx("canvas",{ref:r,width:n,height:a,style:{width:"100%",height:"auto",display:"block"},onMouseDown:S,onMouseMove:m,onMouseUp:x,onMouseLeave:x,onTouchStart:S,onTouchMove:m,onTouchEnd:x})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"space-between"},children:[e.jsx("button",{onClick:p,style:{...Le,padding:"7px 16px",fontSize:11,color:Ce.inkMid,background:Ce.bg,border:`1px solid ${Ce.border}`,borderRadius:6,cursor:"pointer"},children:" Limpiar"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[i&&e.jsx("button",{onClick:i,style:{...Le,padding:"7px 16px",fontSize:11,color:Ce.inkMid,background:Ce.bg,border:`1px solid ${Ce.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:c,disabled:!u,style:{...Le,padding:"7px 20px",fontSize:11,fontWeight:700,color:"#fff",background:u?Ce.accent:Ce.inkLight,border:"none",borderRadius:6,cursor:u?"pointer":"not-allowed"},children:" Firmar"})]})]})]})}function Ex(t){let i=0;for(let o=0;o<t.length;o++)i=(i<<5)-i+t.charCodeAt(o)|0;return Math.abs(i).toString(16).toUpperCase().padStart(8,"0")}const Hr=[{id:"contrato",label:"Contrato",icon:"",color:"#3B3B3B"},{id:"acta",label:"Acta",icon:"",color:"#111111"},{id:"otros",label:"Otros / Anexo",icon:"",color:"#5B3A8C"},{id:"carta",label:"Carta / Comunicacin",icon:"",color:"#8C6A00"},{id:"poder",label:"Poder / Autorizacin",icon:"",color:"#0D5E6E"},{id:"poliza",label:"Pliza / Seguro",icon:"",color:"#B91C1C"},{id:"recibo",label:"Recibo / Paz y Salvo",icon:"",color:"#111111"},{id:"conformidad",label:"Acta de Conformidad",icon:"",color:"#0D7377"},{id:"otro",label:"Otro documento",icon:"",color:"#555"}],gs=[{id:"borrador",label:"Borrador",color:"#888",bg:"#F5F5F5"},{id:"pendiente",label:"Pendiente",color:"#8C6A00",bg:"#FFF8EE"},{id:"parcial",label:"Firma parcial",color:"#3B3B3B",bg:"#F0F0F0"},{id:"completado",label:"Firmado",color:"#111111",bg:"#EBEBEB"},{id:"rechazado",label:"Rechazado",color:"#B91C1C",bg:"#FDF0F0"},{id:"vencido",label:"Vencido",color:"#B91C1C",bg:"#FDF0F0"}],Ax=[{id:"d1",tipo:"contrato",titulo:"Contrato de Diseo Interior  Apto 502 Rosales",descripcion:"Contrato de prestacin de servicios de diseo interior para apartamento en Rosales, Bogot.",cliente:"Mara Fernanda Gmez",proyecto:"Apto 502 Rosales",valor:"$45.000.000 COP",firmantes:[{id:"f1",nombre:"Laura Snchez Daz",rol:"Representante Legal",email:"laura@habitaris.co",estado:"pendiente",firma:null,fechaFirma:null},{id:"f2",nombre:"Mara Fernanda Gmez",rol:"Cliente",email:"mfgomez@email.com",estado:"pendiente",firma:null,fechaFirma:null}],estado:"pendiente",fechaCreacion:"2026-02-20T10:00:00Z",fechaLimite:"2026-03-05",auditoria:[{fecha:"2026-02-20T10:00:00Z",accion:"Documento creado",usuario:"Sistema"}]},{id:"d2",tipo:"acta",titulo:"Acta de Inicio  Remodelacin Casa Chic",descripcion:"Acta de inicio de obras de remodelacin integral.",cliente:"Andrs Meja Ruiz",proyecto:"Casa Chic Norte",valor:"$120.000.000 COP",firmantes:[{id:"f3",nombre:"Carlos Lpez Meja",rol:"Director de Proyecto",email:"carlos@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo1",fecha:"2026-02-18T14:30:00Z"},fechaFirma:"2026-02-18T14:30:00Z"},{id:"f4",nombre:"Andrs Meja Ruiz",rol:"Propietario",email:"amejia@email.com",estado:"pendiente",firma:null,fechaFirma:null},{id:"f5",nombre:"Mara Rodrguez Pea",rol:"Directora de Obra",email:"maria@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo2",fecha:"2026-02-18T15:00:00Z"},fechaFirma:"2026-02-18T15:00:00Z"}],estado:"parcial",fechaCreacion:"2026-02-18T09:00:00Z",fechaLimite:"2026-02-28",auditoria:[{fecha:"2026-02-18T09:00:00Z",accion:"Documento creado",usuario:"Sistema"},{fecha:"2026-02-18T14:30:00Z",accion:"Firmado por Carlos Lpez Meja",usuario:"Carlos Lpez"},{fecha:"2026-02-18T15:00:00Z",accion:"Firmado por Mara Rodrguez Pea",usuario:"Mara Rodrguez"}]},{id:"d3",tipo:"conformidad",titulo:"Acta de Conformidad  Entrega Oficina 301",descripcion:"Acta de conformidad y recepcin final de obra de adecuacin de oficina.",cliente:"TechStar S.A.S",proyecto:"Oficina 301 WTC",valor:"$85.000.000 COP",firmantes:[{id:"f6",nombre:"Laura Snchez Daz",rol:"Gerente General",email:"laura@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo3",fecha:"2026-02-10T11:00:00Z"},fechaFirma:"2026-02-10T11:00:00Z"},{id:"f7",nombre:"Roberto Acosta",rol:"Rep. Legal TechStar",email:"racosta@techstar.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo4",fecha:"2026-02-10T16:00:00Z"},fechaFirma:"2026-02-10T16:00:00Z"}],estado:"completado",fechaCreacion:"2026-02-10T08:00:00Z",fechaLimite:"2026-02-15",auditoria:[{fecha:"2026-02-10T08:00:00Z",accion:"Documento creado",usuario:"Sistema"},{fecha:"2026-02-10T11:00:00Z",accion:"Firmado por Laura Snchez Daz",usuario:"Laura Snchez"},{fecha:"2026-02-10T16:00:00Z",accion:"Firmado por Roberto Acosta",usuario:"Roberto Acosta"},{fecha:"2026-02-10T16:00:00Z",accion:"Documento completado  todas las firmas recogidas",usuario:"Sistema"}]}];function Vn({children:t,color:i,bg:o}){return e.jsx("span",{style:{...Le,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o},children:t})}function Fx(){const[t,i]=F.useState("documentos"),[o,n]=F.useState(()=>dd("docs")||Ax),[a,r]=F.useState(()=>dd("firmas_guardadas")||[]),[s,d]=F.useState(""),[u,b]=F.useState("all"),[j,w]=F.useState("all"),[S,m]=F.useState(null),[x,p]=F.useState(null),[c,g]=F.useState(null);F.useState(null),F.useEffect(()=>cd("docs",o),[o]),F.useEffect(()=>cd("firmas_guardadas",a),[a]);const l=F.useMemo(()=>o.filter(C=>{var D,K;if(u!=="all"&&C.estado!==u||j!=="all"&&C.tipo!==j)return!1;if(s){const oe=s.toLowerCase();return C.titulo.toLowerCase().includes(oe)||((D=C.cliente)==null?void 0:D.toLowerCase().includes(oe))||((K=C.proyecto)==null?void 0:K.toLowerCase().includes(oe))}return!0}),[o,u,j,s]),f=F.useMemo(()=>{const C=o.length,D=o.filter(ie=>ie.estado==="pendiente"||ie.estado==="parcial").length,K=o.filter(ie=>ie.estado==="completado").length,oe=o.filter(ie=>ie.estado==="rechazado").length,te=o.filter(ie=>ie.estado!=="completado"&&ie.fechaLimite&&new Date(ie.fechaLimite)<new Date).length,P=o.reduce((ie,me)=>ie+me.firmantes.filter(Q=>Q.estado==="pendiente").length,0);return{total:C,pendientes:D,completados:K,rechazados:oe,vencidos:te,firmasPendientes:P}},[o]),y=(C,D,K)=>{n(oe=>oe.map(te=>{if(te.id!==C)return te;const P=te.firmantes.map(J=>J.id!==D?J:{...J,estado:"firmado",firma:{imagen:K,fecha:new Date().toISOString()},fechaFirma:new Date().toISOString()}),ie=P.every(J=>J.estado==="firmado"),me=P.some(J=>J.estado==="firmado"),Q=ie?"completado":me?"parcial":te.estado,je=P.find(J=>J.id===D),re=[...te.auditoria,{fecha:new Date().toISOString(),accion:`Firmado por ${je==null?void 0:je.nombre}`,usuario:je==null?void 0:je.nombre}];return ie&&re.push({fecha:new Date().toISOString(),accion:"Documento completado  todas las firmas recogidas",usuario:"Sistema"}),{...te,firmantes:P,estado:Q,auditoria:re}})),g(null)},h=()=>{var P;const C=S?o.find(ie=>ie.id===S):null;if(!C)return null;const D=Hr.find(ie=>ie.id===C.tipo),K=gs.find(ie=>ie.id===C.estado),oe=Ex(C.id+C.titulo+C.fechaCreacion),te=C.fechaLimite&&new Date(C.fechaLimite)<new Date&&C.estado!=="completado";return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>m(null),children:e.jsxs("div",{onClick:ie=>ie.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:720,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:6},children:[e.jsxs(Vn,{color:D==null?void 0:D.color,bg:(D==null?void 0:D.color)+"18",children:[D==null?void 0:D.icon," ",D==null?void 0:D.label]}),e.jsx(Vn,{color:K==null?void 0:K.color,bg:K==null?void 0:K.bg,children:K==null?void 0:K.label}),te&&e.jsx(Vn,{color:Ce.danger,bg:Ce.dangerBg,children:" Vencido"})]}),e.jsx("h2",{style:{...Le,fontSize:18,fontWeight:700,color:Ce.ink,margin:0},children:C.titulo})]}),e.jsx("button",{onClick:()=>m(null),style:{...Le,fontSize:18,color:Ce.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...Le,fontSize:12,color:Ce.inkMid,lineHeight:1.6,marginBottom:16},children:C.descripcion}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:20},children:[{label:"Cliente",val:C.cliente},{label:"Proyecto",val:C.proyecto},{label:"Valor",val:C.valor},{label:"Creado",val:ps(C.fechaCreacion)},{label:"Fecha lmite",val:ps(C.fechaLimite)},{label:"Hash",val:`#${oe}`}].map((ie,me)=>e.jsxs("div",{style:{padding:10,background:Ce.surface,borderRadius:6},children:[e.jsx("div",{style:{...Le,fontSize:9,color:Ce.inkLight,marginBottom:2},children:ie.label}),e.jsx("div",{style:{...Le,fontSize:12,fontWeight:600,color:Ce.ink},children:ie.val||""})]},me))}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:700,color:Ce.ink,marginBottom:12},children:" Firmantes"}),C.firmantes.map((ie,me)=>{var re;const Q=ie.estado==="firmado",je=ie.estado==="rechazado";return e.jsxs("div",{style:{display:"flex",gap:14,alignItems:"center",padding:"12px 16px",background:Q?Ce.accentBg:je?Ce.dangerBg:Ce.surface,border:`1px solid ${Q?Ce.accent+"33":je?Ce.danger+"33":Ce.border}`,borderRadius:8,marginBottom:8},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:Q?Ce.accent+"22":je?Ce.danger+"22":Ce.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:700,color:Q?Ce.accent:je?Ce.danger:Ce.inkLight},children:Q?"":je?"":me+1}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:600,color:Ce.ink},children:ie.nombre}),e.jsxs("div",{style:{...Le,fontSize:10,color:Ce.inkLight},children:[ie.rol,"  ",ie.email]}),Q&&ie.fechaFirma&&e.jsxs("div",{style:{...Le,fontSize:9,color:Ce.accent,marginTop:2},children:["Firmado: ",cs(ie.fechaFirma)]}),je&&ie.motivoRechazo&&e.jsxs("div",{style:{...Le,fontSize:9,color:Ce.danger,marginTop:2},children:["Motivo: ",ie.motivoRechazo]})]}),Q&&((re=ie.firma)==null?void 0:re.imagen)&&ie.firma.imagen.startsWith("data:image")&&e.jsx("div",{style:{border:`1px solid ${Ce.border}`,borderRadius:6,overflow:"hidden",background:"#fff"},children:e.jsx("img",{src:ie.firma.imagen,alt:"Firma",style:{height:50,objectFit:"contain"}})}),ie.estado==="pendiente"&&C.estado!=="rechazado"&&e.jsx("div",{style:{display:"flex",gap:6},children:e.jsx("button",{onClick:()=>{g({docId:C.id,firmanteId:ie.id,nombre:ie.nombre}),m(null)},style:{...Le,padding:"6px 14px",fontSize:10,fontWeight:700,color:"#fff",background:Ce.accent,border:"none",borderRadius:5,cursor:"pointer"},children:" Firmar"})})]},ie.id)})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{...Le,fontSize:10,color:Ce.inkLight},children:"Progreso de firmas"}),e.jsxs("span",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.accent},children:[C.firmantes.filter(ie=>ie.estado==="firmado").length,"/",C.firmantes.length]})]}),e.jsx("div",{style:{height:6,background:Ce.bg,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:3,transition:"width .3s",width:`${C.firmantes.filter(ie=>ie.estado==="firmado").length/C.firmantes.length*100}%`,background:C.estado==="completado"?Ce.accent:C.estado==="rechazado"?Ce.danger:Ce.warning}})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:700,color:Ce.ink,marginBottom:10},children:" Trazabilidad / Auditora"}),e.jsx("div",{style:{borderLeft:`2px solid ${Ce.border}`,paddingLeft:16,marginLeft:8},children:C.auditoria.map((ie,me)=>e.jsxs("div",{style:{marginBottom:12,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-22,top:2,width:12,height:12,borderRadius:"50%",background:me===C.auditoria.length-1?Ce.accent:Ce.bg,border:`2px solid ${me===C.auditoria.length-1?Ce.accent:Ce.border}`}}),e.jsx("div",{style:{...Le,fontSize:10,color:Ce.inkLight},children:cs(ie.fecha)}),e.jsx("div",{style:{...Le,fontSize:12,color:Ce.ink},children:ie.accion}),e.jsxs("div",{style:{...Le,fontSize:10,color:Ce.inkLight},children:["por ",ie.usuario]})]},me))})]}),C.estado==="completado"&&e.jsxs("div",{style:{marginTop:20,padding:20,borderRadius:10,background:"linear-gradient(135deg, #EBEBEB 0%, #F0F0F0 100%)",border:`1px solid ${Ce.accent}33`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:28,marginBottom:8},children:""}),e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:Ce.accent},children:"Documento firmado digitalmente"}),e.jsxs("div",{style:{...Le,fontSize:11,color:Ce.inkMid,marginTop:4},children:["Hash de integridad: ",e.jsxs("code",{style:{background:"#fff",padding:"2px 8px",borderRadius:4,fontSize:10},children:["SHA-",oe,"-",C.firmantes.length,"F"]})]}),e.jsxs("div",{style:{...Le,fontSize:10,color:Ce.inkLight,marginTop:4},children:[C.firmantes.length," firmante(s)  Completado: ",cs((P=C.auditoria[C.auditoria.length-1])==null?void 0:P.fecha)]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20},children:[e.jsx("button",{onClick:()=>{p({...C,firmantes:C.firmantes.map(ie=>({...ie}))}),m(null)},style:{...Le,padding:"8px 18px",fontSize:11,color:Ce.accent,background:Ce.accentBg,border:`1px solid ${Ce.accent}33`,borderRadius:6,cursor:"pointer"},children:" Editar"}),e.jsx("button",{style:{...Le,padding:"8px 18px",fontSize:11,color:Ce.info,background:Ce.infoBg,border:`1px solid ${Ce.info}33`,borderRadius:6,cursor:"pointer"},children:" Enviar por email"}),e.jsx("button",{style:{...Le,padding:"8px 18px",fontSize:11,color:Ce.inkMid,background:Ce.surface,border:`1px solid ${Ce.border}`,borderRadius:6,cursor:"pointer"},children:" Descargar PDF"})]})]})})},v=()=>c?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1001,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>g(null),children:e.jsxs("div",{onClick:C=>C.stopPropagation(),style:{maxWidth:560,width:"100%"},children:[e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:"#fff",marginBottom:12,textAlign:"center"},children:" Firma Digital"}),e.jsx(pd,{signer:c.nombre,onSave:C=>y(c.docId,c.firmanteId,C),onCancel:()=>g(null)}),a.length>0&&e.jsxs("div",{style:{background:"#fff",borderRadius:10,padding:14,marginTop:12,border:`1px solid ${Ce.border}`},children:[e.jsx("div",{style:{...Le,fontSize:11,fontWeight:600,color:Ce.inkMid,marginBottom:8},children:"O usar firma guardada:"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:a.map(C=>e.jsxs("div",{onClick:()=>y(c.docId,c.firmanteId,C.imagen),style:{border:`1px solid ${Ce.border}`,borderRadius:6,padding:4,cursor:"pointer",background:"#fff",transition:"all .15s"},onMouseEnter:D=>D.currentTarget.style.borderColor=Ce.accent,onMouseLeave:D=>D.currentTarget.style.borderColor=Ce.border,children:[e.jsx("img",{src:C.imagen,alt:C.nombre,style:{height:40,objectFit:"contain"}}),e.jsx("div",{style:{...Le,fontSize:8,color:Ce.inkLight,textAlign:"center"},children:C.nombre})]},C.id))})]})]})}):null,A=()=>{if(!x)return null;const C=!o.find(ie=>ie.id===x.id),D=(ie,me)=>p(Q=>({...Q,[ie]:me})),K=()=>D("firmantes",[...x.firmantes,{id:qr(),nombre:"",rol:"",email:"",estado:"pendiente",firma:null,fechaFirma:null}]),oe=(ie,me,Q)=>{const je=[...x.firmantes];je[ie]={...je[ie],[me]:Q},D("firmantes",je)},te=ie=>D("firmantes",x.firmantes.filter((me,Q)=>Q!==ie)),P=()=>{const ie={...x};C?(ie.fechaCreacion=new Date().toISOString(),ie.auditoria=[{fecha:new Date().toISOString(),accion:"Documento creado",usuario:"Sistema"}],ie.estado="pendiente",n(me=>[...me,ie])):(ie.auditoria=[...ie.auditoria,{fecha:new Date().toISOString(),accion:"Documento editado",usuario:"Sistema"}],n(me=>me.map(Q=>Q.id===ie.id?ie:Q))),p(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>p(null),children:e.jsxs("div",{onClick:ie=>ie.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Le,fontSize:16,fontWeight:700,color:Ce.ink,marginBottom:16},children:C?" Nuevo documento para firma":" Editar documento"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.inkLight},children:"Tipo de documento"}),e.jsx("select",{value:x.tipo,onChange:ie=>D("tipo",ie.target.value),style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ce.border}`,borderRadius:5},children:Hr.map(ie=>e.jsxs("option",{value:ie.id,children:[ie.icon," ",ie.label]},ie.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.inkLight},children:"Fecha lmite de firma"}),e.jsx("input",{type:"date",value:x.fechaLimite||"",onChange:ie=>D("fechaLimite",ie.target.value),style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ce.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.inkLight},children:"Ttulo del documento"}),e.jsx("input",{value:x.titulo||"",onChange:ie=>D("titulo",ie.target.value),style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ce.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:x.descripcion||"",onChange:ie=>D("descripcion",ie.target.value),rows:2,style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ce.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.inkLight},children:"Cliente"}),e.jsx("input",{value:x.cliente||"",onChange:ie=>D("cliente",ie.target.value),style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ce.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.inkLight},children:"Proyecto"}),e.jsx("input",{value:x.proyecto||"",onChange:ie=>D("proyecto",ie.target.value),style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ce.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.inkLight},children:"Valor"}),e.jsx("input",{value:x.valor||"",onChange:ie=>D("valor",ie.target.value),style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ce.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{...Le,fontSize:12,fontWeight:600,color:Ce.ink,marginBottom:8},children:[" Firmantes (",x.firmantes.length,")"]}),x.firmantes.map((ie,me)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8,marginBottom:6,alignItems:"end"},children:[e.jsxs("div",{children:[me===0&&e.jsx("label",{style:{...Le,fontSize:9,color:Ce.inkLight},children:"Nombre"}),e.jsx("input",{value:ie.nombre,onChange:Q=>oe(me,"nombre",Q.target.value),placeholder:"Nombre completo",style:{...Le,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${Ce.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[me===0&&e.jsx("label",{style:{...Le,fontSize:9,color:Ce.inkLight},children:"Rol"}),e.jsx("input",{value:ie.rol,onChange:Q=>oe(me,"rol",Q.target.value),placeholder:"Ej: Rep. Legal",style:{...Le,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${Ce.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[me===0&&e.jsx("label",{style:{...Le,fontSize:9,color:Ce.inkLight},children:"Email"}),e.jsx("input",{value:ie.email,onChange:Q=>oe(me,"email",Q.target.value),placeholder:"email@...",style:{...Le,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${Ce.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsx("button",{onClick:()=>te(me),style:{...Le,padding:"6px 8px",fontSize:10,color:Ce.danger,background:"none",border:"none",cursor:"pointer"},children:""})]},ie.id||me)),e.jsx("button",{onClick:K,style:{...Le,padding:"5px 14px",fontSize:10,color:Ce.accent,background:Ce.accentBg,border:`1px solid ${Ce.accent}33`,borderRadius:5,cursor:"pointer",marginTop:4},children:"+ Aadir firmante"})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>p(null),style:{...Le,padding:"8px 20px",fontSize:12,color:Ce.inkMid,background:Ce.bg,border:`1px solid ${Ce.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:P,style:{...Le,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:Ce.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},z=()=>e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:700,color:Ce.ink,marginBottom:12},children:"Mis firmas guardadas"}),e.jsx("p",{style:{...Le,fontSize:12,color:Ce.inkLight,marginBottom:16},children:"Guarda tus firmas frecuentes para reutilizarlas rpidamente al firmar documentos."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px,1fr))",gap:12,marginBottom:20},children:a.map(C=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Ce.border}`,borderRadius:10,padding:16,textAlign:"center"},children:[e.jsx("div",{style:{border:`1px solid ${Ce.border}`,borderRadius:6,overflow:"hidden",marginBottom:8,background:"#fff"},children:e.jsx("img",{src:C.imagen,alt:C.nombre,style:{height:70,objectFit:"contain",display:"block",margin:"0 auto"}})}),e.jsx("div",{style:{...Le,fontSize:12,fontWeight:600,color:Ce.ink},children:C.nombre}),e.jsx("div",{style:{...Le,fontSize:10,color:Ce.inkLight},children:ps(C.fecha)}),e.jsx("button",{onClick:()=>r(D=>D.filter(K=>K.id!==C.id)),style:{...Le,marginTop:8,padding:"4px 12px",fontSize:10,color:Ce.danger,background:Ce.dangerBg,border:`1px solid ${Ce.danger}33`,borderRadius:4,cursor:"pointer"},children:" Eliminar"})]},C.id))}),e.jsxs("div",{style:{maxWidth:520},children:[e.jsx("div",{style:{...Le,fontSize:12,fontWeight:600,color:Ce.inkMid,marginBottom:8},children:"Crear nueva firma guardada"}),e.jsx(pd,{onSave:C=>{const D=prompt("Nombre para esta firma (ej: 'Mi firma formal'):");D&&r(K=>[...K,{id:qr(),nombre:D,imagen:C,fecha:new Date().toISOString()}])}})]})]}),k=()=>e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Total",val:f.total,icon:""},{label:"Pendientes",val:f.pendientes,icon:"",warn:f.pendientes>0},{label:"Firmados",val:f.completados,icon:""},{label:"Firmas pendientes",val:f.firmasPendientes,icon:"",warn:f.firmasPendientes>0},{label:"Vencidos",val:f.vencidos,icon:"",danger:f.vencidos>0}].map((C,D)=>e.jsxs("div",{style:{flex:1,minWidth:110,padding:"10px 14px",background:C.danger?Ce.dangerBg:C.warn?Ce.warningBg:"#fff",border:`1px solid ${C.danger?Ce.danger+"33":C.warn?Ce.warning+"33":Ce.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...Le,fontSize:9,color:Ce.inkLight},children:[C.icon," ",C.label]}),e.jsx("div",{style:{...Le,fontSize:18,fontWeight:700,color:C.danger?Ce.danger:C.warn?Ce.warning:Ce.ink},children:C.val})]},D))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("select",{value:u,onChange:C=>b(C.target.value),style:{...Le,padding:"6px 12px",fontSize:11,border:`1px solid ${Ce.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todos los estados"}),gs.map(C=>e.jsx("option",{value:C.id,children:C.label},C.id))]}),e.jsxs("select",{value:j,onChange:C=>w(C.target.value),style:{...Le,padding:"6px 12px",fontSize:11,border:`1px solid ${Ce.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),Hr.map(C=>e.jsxs("option",{value:C.id,children:[C.icon," ",C.label]},C.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx("input",{value:s,onChange:C=>d(C.target.value),placeholder:"Buscar por ttulo, cliente, proyecto",style:{...Le,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${Ce.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>p({id:qr(),tipo:"contrato",titulo:"",descripcion:"",cliente:"",proyecto:"",valor:"",firmantes:[{id:qr(),nombre:"",rol:"",email:"",estado:"pendiente",firma:null,fechaFirma:null}],estado:"borrador",fechaCreacion:null,fechaLimite:"",auditoria:[]}),style:{...Le,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:Ce.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo documento"})]}),l.map(C=>{const D=Hr.find(ie=>ie.id===C.tipo),K=gs.find(ie=>ie.id===C.estado),oe=C.firmantes.filter(ie=>ie.estado==="firmado").length,te=C.firmantes.length,P=C.fechaLimite&&new Date(C.fechaLimite)<new Date&&C.estado!=="completado";return e.jsxs("div",{onClick:()=>m(C.id),style:{display:"flex",gap:14,alignItems:"center",padding:"14px 18px",background:"#fff",border:`1px solid ${Ce.border}`,borderRadius:10,marginBottom:8,cursor:"pointer",transition:"all .15s",boxShadow:Ce.shadow},onMouseEnter:ie=>ie.currentTarget.style.boxShadow=Ce.shadowMd,onMouseLeave:ie=>ie.currentTarget.style.boxShadow=Ce.shadow,children:[e.jsx("div",{style:{width:42,height:42,borderRadius:10,background:(D==null?void 0:D.color)+"15",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0},children:D==null?void 0:D.icon}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:700,color:Ce.ink,marginBottom:2},children:C.titulo}),e.jsxs("div",{style:{...Le,fontSize:11,color:Ce.inkLight},children:[C.cliente,"  ",C.proyecto," ",C.valor&&` ${C.valor}`]})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexShrink:0},children:[e.jsxs("div",{style:{textAlign:"center",marginRight:8},children:[e.jsxs("div",{style:{...Le,fontSize:10,fontWeight:600,color:Ce.inkMid},children:[oe,"/",te]}),e.jsx("div",{style:{width:40,height:4,background:Ce.bg,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${oe/te*100}%`,borderRadius:2,background:C.estado==="completado"?Ce.accent:Ce.warning}})})]}),e.jsx(Vn,{color:K==null?void 0:K.color,bg:K==null?void 0:K.bg,children:K==null?void 0:K.label}),P&&e.jsx(Vn,{color:Ce.danger,bg:Ce.dangerBg,children:""})]})]},C.id)}),l.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:Ce.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Le,fontSize:13},children:"No se encontraron documentos"})]})]}),T=[{id:"documentos",icon:"",label:"Documentos",badge:f.pendientes||null},{id:"firmas",icon:"",label:"Mis Firmas"}];return e.jsxs("div",{style:{...Le,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...Le,fontSize:22,fontWeight:700,color:Ce.ink,margin:"0 0 4px"},children:" Firma Digital"}),e.jsx("p",{style:{...Le,fontSize:12,color:Ce.inkLight,margin:0},children:"Firma y gestin de documentos digitales con trazabilidad completa"})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${Ce.border}`,marginBottom:20},children:T.map(C=>e.jsxs("button",{onClick:()=>i(C.id),style:{...Le,padding:"10px 18px",fontSize:12,fontWeight:t===C.id?700:500,color:t===C.id?Ce.accent:Ce.inkLight,background:"none",border:"none",borderBottom:t===C.id?`2px solid ${Ce.accent}`:"2px solid transparent",cursor:"pointer"},children:[C.icon," ",C.label,C.badge&&e.jsx("span",{style:{marginLeft:6,background:Ce.warning,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:C.badge})]},C.id))}),t==="documentos"&&k(),t==="firmas"&&z(),h(),v(),A()]})}const we={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},Ne={fontFamily:"'DM Sans',sans-serif"},Ys="hab:legal:",Gr=t=>{try{return JSON.parse(localStorage.getItem(Ys+t))||null}catch{return null}},Kr=(t,i)=>{var o,n;localStorage.setItem(Ys+t,JSON.stringify(i));try{(n=(o=window.storage)==null?void 0:o.set)==null||n.call(o,Ys+t,JSON.stringify(i))}catch{}},us=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),rn=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function Ro({children:t,color:i,bg:o}){return e.jsx("span",{style:{...Ne,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o},children:t})}function gd(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}const Jr=[{id:"contratos",label:"Contratos",icon:"",color:"#3B3B3B"},{id:"otrosies",label:"Otroses / Modificaciones",icon:"",color:"#5B3A8C"},{id:"actas",label:"Actas",icon:"",color:"#111111"},{id:"cartas",label:"Cartas / Comunicaciones",icon:"",color:"#8C6A00"},{id:"poderes",label:"Poderes / Autorizaciones",icon:"",color:"#0D5E6E"},{id:"formatos",label:"Formatos Internos",icon:"",color:"#555"}],Tx=[{id:"tpl_contrato_diseno",cat:"contratos",nombre:"Contrato de Diseo Interior",desc:"Contrato de prestacin de servicios de diseo interior. Incluye alcance, fases, entregables, honorarios y forma de pago.",variables:["nombre_cliente","documento_cliente","direccion_inmueble","descripcion_alcance","valor_honorarios","forma_pago","plazo_dias","fecha"],contenido:`CONTRATO DE PRESTACIN DE SERVICIOS DE DISEO INTERIOR

Entre {{empresa_nombre}}, con NIT {{empresa_nit}}, representada por {{rep_legal}}, en adelante EL CONTRATISTA, y {{nombre_cliente}}, identificado con {{documento_cliente}}, en adelante EL CLIENTE.

OBJETO: El CONTRATISTA se compromete a prestar servicios profesionales de diseo interior para el inmueble ubicado en {{direccion_inmueble}}.

ALCANCE: {{descripcion_alcance}}

VALOR Y FORMA DE PAGO: El valor total de los honorarios es de {{valor_honorarios}}, pagaderos as: {{forma_pago}}.

PLAZO: {{plazo_dias}} das calendario a partir de la firma del presente contrato.

OBLIGACIONES DEL CONTRATISTA:
1. Elaborar propuesta de diseo segn briefing aprobado
2. Presentar renders y planos tcnicos
3. Entregar memoria descriptiva y presupuesto de obra
4. Realizar seguimiento durante la ejecucin (si aplica)

OBLIGACIONES DEL CLIENTE:
1. Suministrar informacin veraz del inmueble
2. Realizar los pagos en los plazos acordados
3. Aprobar o solicitar ajustes en los plazos establecidos

Se firma en {{ciudad}} a los {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_obra",cat:"contratos",nombre:"Contrato de Obra / Remodelacin",desc:"Contrato de ejecucin de obra de remodelacin. Incluye presupuesto, cronograma, garantas y penalizaciones.",variables:["nombre_cliente","documento_cliente","direccion_inmueble","descripcion_obra","valor_obra","anticipo_pct","plazo_dias","fecha"],contenido:`CONTRATO DE OBRA PARA REMODELACIN

Entre {{empresa_nombre}}, NIT {{empresa_nit}}, en adelante EL CONTRATISTA, y {{nombre_cliente}}, identificado con {{documento_cliente}}, en adelante EL PROPIETARIO.

OBJETO: Ejecucin de obras de remodelacin en {{direccion_inmueble}} segn diseo aprobado.

DESCRIPCIN: {{descripcion_obra}}

VALOR: {{valor_obra}} (IVA incluido). ANTICIPO: {{anticipo_pct}}% contra firma. El saldo se pagar segn avance de obra certificado.

PLAZO: {{plazo_dias}} das calendario.

GARANTAS:
- Estabilidad de obra: 5 aos
- Acabados: 1 ao
- Instalaciones: 2 aos

Se firma en {{ciudad}} a los {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_laboral",cat:"contratos",nombre:"Contrato Laboral a Trmino Fijo",desc:"Contrato laboral para personal vinculado a proyectos con trmino definido.",variables:["nombre_empleado","documento_empleado","cargo","salario","fecha_inicio","fecha_fin","funciones"],contenido:`CONTRATO INDIVIDUAL DE TRABAJO A TRMINO FIJO

EMPLEADOR: {{empresa_nombre}}, NIT {{empresa_nit}}
TRABAJADOR: {{nombre_empleado}}, C.C. {{documento_empleado}}
CARGO: {{cargo}}

El EMPLEADOR contrata los servicios del TRABAJADOR para desempear el cargo de {{cargo}} con las siguientes funciones: {{funciones}}

REMUNERACIN: {{salario}} mensuales, pagaderos quincenalmente.
VIGENCIA: Del {{fecha_inicio}} al {{fecha_fin}}.

JORNADA: 48 horas semanales.

El presente contrato se rige por el Cdigo Sustantivo del Trabajo.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_prest_serv",cat:"contratos",nombre:"Contrato de Prestacin de Servicios",desc:"Para contratistas independientes, proveedores y consultores.",variables:["nombre_contratista","documento_contratista","objeto","valor","plazo","entregables"],contenido:`CONTRATO DE PRESTACIN DE SERVICIOS PROFESIONALES

CONTRATANTE: {{empresa_nombre}}
CONTRATISTA: {{nombre_contratista}}, {{documento_contratista}}

OBJETO: {{objeto}}
VALOR: {{valor}}
PLAZO: {{plazo}}
ENTREGABLES: {{entregables}}

El CONTRATISTA acta como independiente, sin subordinacin laboral. Es responsable de sus propias obligaciones tributarias y de seguridad social.`,pais:"CO",obligatorio:!1},{id:"tpl_otrosi",cat:"otrosies",nombre:"Otros Modificatorio",desc:"Modificacin de clusulas de un contrato vigente.",variables:["numero_contrato","fecha_contrato","clausulas_modificadas","nuevo_texto"],contenido:`OTROS MODIFICATORIO AL CONTRATO {{numero_contrato}}

Las partes acuerdan modificar las siguientes clusulas del contrato de fecha {{fecha_contrato}}:

CLUSULAS MODIFICADAS: {{clausulas_modificadas}}

NUEVO TEXTO: {{nuevo_texto}}

Las dems clusulas permanecen vigentes e inalteradas.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_inicio",cat:"actas",nombre:"Acta de Inicio de Obra",desc:"Acta de inicio de ejecucin de obra con datos del proyecto, participantes y compromisos.",variables:["proyecto","direccion","contrato_ref","participantes","observaciones","fecha"],contenido:`ACTA DE INICIO DE OBRA

PROYECTO: {{proyecto}}
DIRECCIN: {{direccion}}
CONTRATO REF: {{contrato_ref}}
FECHA: {{fecha}}

PARTICIPANTES:
{{participantes}}

Se da inicio formal a las obras de acuerdo con el contrato referenciado, el diseo aprobado y el cronograma pactado.

OBSERVACIONES: {{observaciones}}

Se firma por las partes como constancia.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_vecindad",cat:"actas",nombre:"Acta de Vecindad",desc:"Registro del estado de inmuebles vecinos antes de iniciar obra.",variables:["proyecto","direccion_obra","inmuebles_vecinos","estado_actual","registro_fotografico","fecha"],contenido:`ACTA DE VECINDAD

PROYECTO: {{proyecto}}
DIRECCIN OBRA: {{direccion_obra}}
FECHA: {{fecha}}

INMUEBLES INSPECCIONADOS:
{{inmuebles_vecinos}}

ESTADO ACTUAL REGISTRADO:
{{estado_actual}}

Se adjunta registro fotogrfico de {{registro_fotografico}} fotografas como soporte.

Esta acta tiene carcter probatorio del estado previo de los inmuebles vecinos.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_entrega",cat:"actas",nombre:"Acta de Entrega / Recepcin Final",desc:"Acta de recepcin final de obra con checklist de verificacin.",variables:["proyecto","cliente","items_verificados","observaciones","pendientes","garantias","fecha"],contenido:`ACTA DE ENTREGA Y RECEPCIN FINAL

PROYECTO: {{proyecto}}
CLIENTE: {{cliente}}
FECHA: {{fecha}}

Se procede a la entrega formal del proyecto con los siguientes tems verificados:
{{items_verificados}}

OBSERVACIONES: {{observaciones}}
PENDIENTES (si aplica): {{pendientes}}

GARANTAS:
{{garantias}}

El CLIENTE declara recibir a satisfaccin.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_comite",cat:"actas",nombre:"Acta de Comit de Obra",desc:"Registro de reuniones de seguimiento de obra.",variables:["numero","proyecto","asistentes","temas","compromisos","proxima_reunion","fecha"],contenido:`ACTA DE COMIT DE OBRA N {{numero}}

PROYECTO: {{proyecto}}
FECHA: {{fecha}}
ASISTENTES: {{asistentes}}

TEMAS TRATADOS:
{{temas}}

COMPROMISOS:
{{compromisos}}

PRXIMA REUNIN: {{proxima_reunion}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_cobro",cat:"cartas",nombre:"Carta de Cobro / Recordatorio de Pago",desc:"Comunicacin formal recordando saldos pendientes.",variables:["destinatario","concepto","valor_adeudado","fecha_vencimiento","plazo_respuesta","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Recordatorio de pago  {{concepto}}

Cordial saludo.

Permtanos recordarle que a la fecha se encuentra pendiente el pago de {{valor_adeudado}} correspondiente a {{concepto}}, con fecha de vencimiento {{fecha_vencimiento}}.

Agradecemos realizar el pago en un plazo de {{plazo_respuesta}} das.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_terminacion",cat:"cartas",nombre:"Carta de Terminacin de Contrato",desc:"Comunicacin formal de terminacin de relacin contractual.",variables:["destinatario","contrato_ref","motivo","fecha_efectiva","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Terminacin contrato {{contrato_ref}}

Por medio de la presente le comunicamos la terminacin del contrato referenciado por el siguiente motivo: {{motivo}}

La terminacin ser efectiva a partir del {{fecha_efectiva}}.

Quedan vigentes las obligaciones pendientes y las garantas pactadas.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_garantia",cat:"cartas",nombre:"Carta de Reclamacin de Garanta",desc:"Comunicacin de activacin de garanta por defectos post-entrega.",variables:["destinatario","proyecto","items_garantia","plazo_respuesta","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Reclamacin de garanta  {{proyecto}}

Nos permitimos reportar los siguientes tems que requieren atencin bajo la garanta del proyecto:

{{items_garantia}}

Solicitamos atencin en un plazo de {{plazo_respuesta}} das hbiles.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_poder",cat:"poderes",nombre:"Poder Especial",desc:"Autorizacin para actuar en nombre de la empresa ante trmites especficos.",variables:["apoderado","documento_apoderado","facultades","vigencia","fecha"],contenido:`PODER ESPECIAL

{{rep_legal}}, en calidad de representante legal de {{empresa_nombre}}, NIT {{empresa_nit}}, confiere poder especial a {{apoderado}}, identificado con {{documento_apoderado}}, para:

{{facultades}}

VIGENCIA: {{vigencia}}

Otorgado en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_paz_salvo",cat:"formatos",nombre:"Paz y Salvo",desc:"Certificacin de cumplimiento de obligaciones contractuales.",variables:["beneficiario","contrato_ref","concepto","fecha"],contenido:`PAZ Y SALVO

{{empresa_nombre}} certifica que {{beneficiario}} se encuentra a paz y salvo por concepto de {{concepto}} del contrato {{contrato_ref}}.

Se expide en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_cert_laboral",cat:"formatos",nombre:"Certificacin Laboral",desc:"Certificado de vinculacin laboral con cargo y salario.",variables:["nombre_empleado","documento_empleado","cargo","fecha_ingreso","salario","fecha"],contenido:`CERTIFICACIN LABORAL

{{empresa_nombre}}, NIT {{empresa_nit}}, certifica que {{nombre_empleado}}, identificado con C.C. {{documento_empleado}}, labora en esta empresa desde el {{fecha_ingreso}} desempeando el cargo de {{cargo}}, con un salario mensual de {{salario}}.

Se expide a solicitud del interesado en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1}],ud=[{id:"rcextra",label:"RC Extracontractual",icon:"",color:"#B91C1C"},{id:"todo_riesgo",label:"Todo Riesgo Construccin",icon:"",color:"#3B3B3B"},{id:"cumplimiento",label:"Cumplimiento",icon:"",color:"#111111"},{id:"calidad",label:"Calidad / Estabilidad",icon:"",color:"#5B3A8C"},{id:"prestaciones",label:"Prestaciones Sociales",icon:"",color:"#8C6A00"},{id:"vehicular",label:"Vehicular / SOAT",icon:"",color:"#0D5E6E"},{id:"otro",label:"Otro seguro",icon:"",color:"#555"}],Bx=[{id:"s1",tipo:"todo_riesgo",aseguradora:"Seguros Bolvar",poliza:"POL-2026-001245",proyecto:"Casa Chic Norte",valor_asegurado:"$120.000.000",prima:"$3.600.000",vigencia_inicio:"2026-01-15",vigencia_fin:"2026-07-15",beneficiario:"Andrs Meja Ruiz",estado:"vigente",notas:"Cubre daos durante ejecucin de obra"},{id:"s2",tipo:"rcextra",aseguradora:"Sura",poliza:"RC-2026-778899",proyecto:"General empresa",valor_asegurado:"$500.000.000",prima:"$8.500.000",vigencia_inicio:"2026-01-01",vigencia_fin:"2026-12-31",beneficiario:"Habitaris S.A.S",estado:"vigente",notas:"Responsabilidad civil por daos a terceros"},{id:"s3",tipo:"cumplimiento",aseguradora:"Liberty Seguros",poliza:"CUM-2025-556677",proyecto:"Oficina 301 WTC",valor_asegurado:"$85.000.000",prima:"$2.125.000",vigencia_inicio:"2025-06-01",vigencia_fin:"2026-06-01",beneficiario:"TechStar S.A.S",estado:"por_vencer",notas:"Garanta de cumplimiento del contrato"},{id:"s4",tipo:"calidad",aseguradora:"Seguros Bolvar",poliza:"CAL-2025-112233",proyecto:"Apto 502 Rosales",valor_asegurado:"$45.000.000",prima:"$675.000",vigencia_inicio:"2025-03-01",vigencia_fin:"2030-03-01",beneficiario:"Mara Fernanda Gmez",estado:"vigente",notas:"Garanta de estabilidad de obra  5 aos"}],hs=[{id:"abierto",label:"Abierto",color:"#3B3B3B",bg:"#F0F0F0"},{id:"en_curso",label:"En curso",color:"#8C6A00",bg:"#FFF8EE"},{id:"favorable",label:"Favorable",color:"#111111",bg:"#EBEBEB"},{id:"cerrado",label:"Cerrado",color:"#555",bg:"#F5F5F5"},{id:"perdido",label:"Desfavorable",color:"#B91C1C",bg:"#FDF0F0"}],Ix=[{id:"p1",tipo:"Reclamacin de garanta",contraparte:"Proveedor XYZ Pisos",proyecto:"Oficina 301 WTC",descripcion:"Reclamacin por defectos en piso laminado instalado. Present levantamiento a los 3 meses.",estado:"en_curso",fecha_inicio:"2026-01-20",abogado:"Dr. Martn Velsquez",valor_pretension:"$8.500.000",seguimiento:[{fecha:"2026-01-20",nota:"Se enva carta de reclamacin al proveedor"},{fecha:"2026-01-30",nota:"Proveedor responde negando responsabilidad"},{fecha:"2026-02-10",nota:"Se enva informe pericial con registro fotogrfico"},{fecha:"2026-02-20",nota:"Reunin de conciliacin programada para marzo 5"}]},{id:"p2",tipo:"Incumplimiento contractual",contraparte:"Cliente: Roberto Pineda",proyecto:"Remodelacin Apto 801 Virrey",descripcion:"Cliente se rehsa a pagar saldo final ($18M) alegando inconformidad no sustentada.",estado:"abierto",fecha_inicio:"2026-02-01",abogado:"Dra. Carolina Mendoza",valor_pretension:"$18.000.000",seguimiento:[{fecha:"2026-02-01",nota:"Se enva carta de cobro prejudicial"},{fecha:"2026-02-15",nota:"Sin respuesta del cliente. Se prepara demanda ejecutiva."}]}];function Rx(){const[t,i]=F.useState("plantillas"),[o,n]=F.useState(()=>Gr("plantillas")||Tx),[a,r]=F.useState(()=>Gr("documentos_gen")||[]),[s,d]=F.useState(()=>Gr("seguros")||Bx),[u,b]=F.useState(()=>Gr("procesos")||Ix),[j,w]=F.useState(""),[S,m]=F.useState("all"),[x,p]=F.useState(null),[c,g]=F.useState(null),[l,f]=F.useState(null),[y,h]=F.useState(null),[v,A]=F.useState(null),[z,k]=F.useState(null);F.useEffect(()=>Kr("plantillas",o),[o]),F.useEffect(()=>Kr("documentos_gen",a),[a]),F.useEffect(()=>Kr("seguros",s),[s]),F.useEffect(()=>Kr("procesos",u),[u]);const T=F.useMemo(()=>{const re=s.filter(B=>new Date(B.vigencia_fin)>=new Date),J=s.filter(B=>{const V=gd(B.vigencia_fin);return V>=0&&V<=60}),M=s.filter(B=>new Date(B.vigencia_fin)<new Date);return{total:s.length,vigentes:re.length,porVencer:J.length,vencidos:M.length}},[s]),C=()=>{const re=o.filter(J=>S!=="all"&&J.cat!==S?!1:j?J.nombre.toLowerCase().includes(j.toLowerCase())||J.desc.toLowerCase().includes(j.toLowerCase()):!0);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16,alignItems:"center"},children:[e.jsxs("select",{value:S,onChange:J=>m(J.target.value),style:{...Ne,padding:"6px 12px",fontSize:11,border:`1px solid ${we.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todas las categoras"}),Jr.map(J=>e.jsxs("option",{value:J.id,children:[J.icon," ",J.label]},J.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx("input",{value:j,onChange:J=>w(J.target.value),placeholder:"Buscar plantilla",style:{...Ne,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${we.border}`,borderRadius:6,boxSizing:"border-box"}})})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px,1fr))",gap:12},children:re.map(J=>{const M=Jr.find(B=>B.id===J.cat);return e.jsxs("div",{onClick:()=>p(J.id),style:{background:"#fff",border:`1px solid ${we.border}`,borderLeft:`3px solid ${M==null?void 0:M.color}`,borderRadius:10,padding:18,cursor:"pointer",boxShadow:we.shadow,transition:"all .15s"},onMouseEnter:B=>B.currentTarget.style.boxShadow=we.shadowMd,onMouseLeave:B=>B.currentTarget.style.boxShadow=we.shadow,children:[e.jsx("div",{style:{display:"flex",gap:6,marginBottom:8},children:e.jsxs(Ro,{color:M==null?void 0:M.color,bg:(M==null?void 0:M.color)+"18",children:[M==null?void 0:M.icon," ",M==null?void 0:M.label]})}),e.jsx("div",{style:{...Ne,fontSize:14,fontWeight:700,color:we.ink,marginBottom:4},children:J.nombre}),e.jsx("div",{style:{...Ne,fontSize:11,color:we.inkLight,lineHeight:1.5,marginBottom:8,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:J.desc}),e.jsxs("div",{style:{...Ne,fontSize:10,color:we.inkLight},children:[" ",J.variables.length," campos  ",J.pais==="CO"?"":""]})]},J.id)})})]})},D=()=>{const re=x?o.find(M=>M.id===x):null;if(!re)return null;const J=Jr.find(M=>M.id===re.cat);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>p(null),children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:720,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[e.jsxs("div",{children:[e.jsxs(Ro,{color:J==null?void 0:J.color,bg:(J==null?void 0:J.color)+"18",children:[J==null?void 0:J.icon," ",J==null?void 0:J.label]}),e.jsx("h2",{style:{...Ne,fontSize:18,fontWeight:700,color:we.ink,margin:"8px 0 4px"},children:re.nombre}),e.jsx("p",{style:{...Ne,fontSize:12,color:we.inkLight,margin:0},children:re.desc})]}),e.jsx("button",{onClick:()=>p(null),style:{...Ne,fontSize:18,color:we.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...Ne,fontSize:11,fontWeight:600,color:we.inkMid,marginBottom:6},children:"Campos variables:"}),e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:re.variables.map(M=>e.jsx(Ro,{color:we.info,bg:we.infoBg,children:`{{${M}}}`},M))})]}),e.jsx("div",{style:{background:we.surface,border:`1px solid ${we.border}`,borderRadius:8,padding:20,marginBottom:16,maxHeight:300,overflow:"auto"},children:e.jsx("pre",{style:{...Ne,fontSize:11,color:we.inkMid,lineHeight:1.7,whiteSpace:"pre-wrap",margin:0},children:re.contenido})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>{k({plantilla:re,variables:{}}),p(null)},style:{...Ne,padding:"8px 20px",fontSize:12,fontWeight:700,color:"#fff",background:we.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Generar documento"}),e.jsx("button",{style:{...Ne,padding:"8px 18px",fontSize:12,color:we.inkMid,background:we.bg,border:`1px solid ${we.border}`,borderRadius:6,cursor:"pointer"},children:" Editar plantilla"})]})]})})},K=()=>{if(!z)return null;const{plantilla:re,variables:J}=z,M=(R,W)=>k(se=>({...se,variables:{...se.variables,[R]:W}})),B={empresa_nombre:"Habitaris S.A.S",empresa_nit:"901.922.136-8",rep_legal:"Laura Snchez Daz",ciudad:"Bogot D.C.",fecha:new Date().toLocaleDateString("es-CO",{day:"numeric",month:"long",year:"numeric"})},V=re.contenido.replace(/\{\{(\w+)\}\}/g,(R,W)=>J[W]||B[W]||`[${W}]`),X=()=>{const R={id:us(),plantillaId:re.id,titulo:`${re.nombre}  ${J[re.variables[0]]||"Sin datos"}`,contenido:V,variables:{...B,...J},fecha:new Date().toISOString()};r(W=>[...W,R]),k(null),alert(" Documento generado y guardado")};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>k(null),children:e.jsxs("div",{onClick:R=>R.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:800,width:"100%",maxHeight:"90vh",overflow:"auto",padding:28},children:[e.jsxs("h2",{style:{...Ne,fontSize:16,fontWeight:700,color:we.ink,marginBottom:4},children:[" Generar: ",re.nombre]}),e.jsx("p",{style:{...Ne,fontSize:11,color:we.inkLight,marginBottom:16},children:"Completa los campos y genera el documento."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:16},children:re.variables.map(R=>e.jsxs("div",{children:[e.jsx("label",{style:{...Ne,fontSize:10,fontWeight:600,color:we.inkLight},children:R.replace(/_/g," ")}),e.jsx("input",{value:J[R]||"",onChange:W=>M(R,W.target.value),style:{...Ne,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${we.border}`,borderRadius:5,boxSizing:"border-box"}})]},R))}),e.jsx("div",{style:{...Ne,fontSize:11,fontWeight:600,color:we.inkMid,marginBottom:6},children:"Vista previa:"}),e.jsx("div",{style:{background:we.surface,border:`1px solid ${we.border}`,borderRadius:8,padding:20,marginBottom:16,maxHeight:300,overflow:"auto"},children:e.jsx("pre",{style:{...Ne,fontSize:11,color:we.ink,lineHeight:1.7,whiteSpace:"pre-wrap",margin:0},children:V})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>k(null),style:{...Ne,padding:"8px 20px",fontSize:12,color:we.inkMid,background:we.bg,border:`1px solid ${we.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{style:{...Ne,padding:"8px 18px",fontSize:12,color:we.info,background:we.infoBg,border:`1px solid ${we.info}33`,borderRadius:6,cursor:"pointer"},children:" Enviar a Firma Digital"}),e.jsx("button",{onClick:X,style:{...Ne,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:we.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar documento"})]})]})})},oe=()=>e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Total plizas",val:T.total,icon:""},{label:"Vigentes",val:T.vigentes,icon:""},{label:"Por vencer (60d)",val:T.porVencer,icon:"",warn:T.porVencer>0},{label:"Vencidas",val:T.vencidos,icon:"",danger:T.vencidos>0}].map((re,J)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"10px 14px",background:re.danger?we.dangerBg:re.warn?we.warningBg:"#fff",border:`1px solid ${re.danger?we.danger+"33":re.warn?we.warning+"33":we.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...Ne,fontSize:9,color:we.inkLight},children:[re.icon," ",re.label]}),e.jsx("div",{style:{...Ne,fontSize:18,fontWeight:700,color:re.danger?we.danger:re.warn?we.warning:we.ink},children:re.val})]},J))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:j,onChange:re=>w(re.target.value),placeholder:"Buscar pliza, proyecto, aseguradora",style:{...Ne,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${we.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>h({id:us(),tipo:"todo_riesgo",aseguradora:"",poliza:"",proyecto:"",valor_asegurado:"",prima:"",vigencia_inicio:"",vigencia_fin:"",beneficiario:"",estado:"vigente",notas:""}),style:{...Ne,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:we.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nueva pliza"})]}),s.map(re=>{const J=ud.find(X=>X.id===re.tipo),M=gd(re.vigencia_fin),B=M<0,V=M>=0&&M<=60;return e.jsxs("div",{onClick:()=>g(re.id),style:{display:"flex",gap:14,alignItems:"center",padding:"14px 18px",background:"#fff",border:`1px solid ${B?we.danger+"44":V?we.warning+"44":we.border}`,borderRadius:10,marginBottom:8,cursor:"pointer",boxShadow:we.shadow,transition:"all .15s"},onMouseEnter:X=>X.currentTarget.style.boxShadow=we.shadowMd,onMouseLeave:X=>X.currentTarget.style.boxShadow=we.shadow,children:[e.jsx("div",{style:{width:42,height:42,borderRadius:10,background:(J==null?void 0:J.color)+"15",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0},children:J==null?void 0:J.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ne,fontSize:13,fontWeight:700,color:we.ink},children:J==null?void 0:J.label}),e.jsxs("div",{style:{...Ne,fontSize:11,color:we.inkLight},children:[re.aseguradora,"  Pliza: ",re.poliza]}),e.jsxs("div",{style:{...Ne,fontSize:10,color:we.inkLight},children:[re.proyecto,"  Beneficiario: ",re.beneficiario]})]}),e.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[e.jsx("div",{style:{...Ne,fontSize:12,fontWeight:600,color:we.ink},children:re.valor_asegurado}),e.jsxs("div",{style:{...Ne,fontSize:10,color:we.inkLight},children:[rn(re.vigencia_inicio),"  ",rn(re.vigencia_fin)]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(Ro,{color:B?we.danger:V?we.warning:we.accent,bg:B?we.dangerBg:V?we.warningBg:we.accentBg,children:B?`Vencida hace ${Math.abs(M)}d`:V?`Vence en ${M}d`:"Vigente"})})]})]},re.id)})]}),te=()=>{if(!y)return null;const re=!s.find(B=>B.id===y.id),J=(B,V)=>h(X=>({...X,[B]:V})),M=()=>{d(re?B=>[...B,y]:B=>B.map(V=>V.id===y.id?y:V)),h(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>h(null),children:e.jsxs("div",{onClick:B=>B.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:580,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Ne,fontSize:16,fontWeight:700,color:we.ink,marginBottom:16},children:re?" Nueva pliza":" Editar pliza"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[["tipo","Tipo",!0],["aseguradora","Aseguradora"],["poliza","N Pliza"],["proyecto","Proyecto"],["valor_asegurado","Valor asegurado"],["prima","Prima"],["vigencia_inicio","Inicio vigencia","date"],["vigencia_fin","Fin vigencia","date"],["beneficiario","Beneficiario"],["notas","Notas"]].map(([B,V,X])=>e.jsxs("div",{style:{gridColumn:B==="notas"?"1/-1":void 0},children:[e.jsx("label",{style:{...Ne,fontSize:10,fontWeight:600,color:we.inkLight},children:V}),X===!0?e.jsx("select",{value:y[B],onChange:R=>J(B,R.target.value),style:{...Ne,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${we.border}`,borderRadius:5},children:ud.map(R=>e.jsxs("option",{value:R.id,children:[R.icon," ",R.label]},R.id))}):e.jsx("input",{type:X||"text",value:y[B]||"",onChange:R=>J(B,R.target.value),style:{...Ne,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${we.border}`,borderRadius:5,boxSizing:"border-box"}})]},B))}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>h(null),style:{...Ne,padding:"8px 20px",fontSize:12,color:we.inkMid,background:we.bg,border:`1px solid ${we.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:M,style:{...Ne,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:we.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},P=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:j,onChange:re=>w(re.target.value),placeholder:"Buscar proceso",style:{...Ne,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${we.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>A({id:us(),tipo:"",contraparte:"",proyecto:"",descripcion:"",estado:"abierto",fecha_inicio:new Date().toISOString().slice(0,10),abogado:"",valor_pretension:"",seguimiento:[]}),style:{...Ne,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:we.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo proceso"})]}),u.map(re=>{const J=hs.find(M=>M.id===re.estado);return e.jsxs("div",{onClick:()=>f(re.id),style:{background:"#fff",border:`1px solid ${we.border}`,borderRadius:10,padding:18,marginBottom:10,cursor:"pointer",boxShadow:we.shadow,transition:"all .15s"},onMouseEnter:M=>M.currentTarget.style.boxShadow=we.shadowMd,onMouseLeave:M=>M.currentTarget.style.boxShadow=we.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:6},children:[e.jsxs("div",{children:[e.jsx("div",{style:{...Ne,fontSize:14,fontWeight:700,color:we.ink},children:re.tipo}),e.jsxs("div",{style:{...Ne,fontSize:11,color:we.inkLight},children:["vs. ",re.contraparte,"  ",re.proyecto]})]}),e.jsx(Ro,{color:J==null?void 0:J.color,bg:J==null?void 0:J.bg,children:J==null?void 0:J.label})]}),e.jsx("div",{style:{...Ne,fontSize:11,color:we.inkMid,marginBottom:6,lineHeight:1.5},children:re.descripcion}),e.jsxs("div",{style:{display:"flex",gap:16,...Ne,fontSize:10,color:we.inkLight},children:[e.jsxs("span",{children:[" ",re.abogado]}),e.jsxs("span",{children:[" ",re.valor_pretension]}),e.jsxs("span",{children:[" ",rn(re.fecha_inicio)]}),e.jsxs("span",{children:[" ",re.seguimiento.length," notas"]})]})]},re.id)}),u.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:we.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Ne,fontSize:13},children:"No hay procesos legales registrados"})]})]}),ie=()=>{const re=l?u.find(X=>X.id===l):null;if(!re)return null;const J=hs.find(X=>X.id===re.estado),[M,B]=F.useState(""),V=()=>{M.trim()&&(b(X=>X.map(R=>R.id===re.id?{...R,seguimiento:[...R.seguimiento,{fecha:new Date().toISOString().slice(0,10),nota:M}]}:R)),B(""))};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>f(null),children:e.jsxs("div",{onClick:X=>X.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx(Ro,{color:J==null?void 0:J.color,bg:J==null?void 0:J.bg,children:J==null?void 0:J.label}),e.jsx("h2",{style:{...Ne,fontSize:18,fontWeight:700,color:we.ink,margin:"8px 0 2px"},children:re.tipo}),e.jsxs("div",{style:{...Ne,fontSize:12,color:we.inkLight},children:["vs. ",re.contraparte,"  ",re.proyecto]})]}),e.jsx("button",{onClick:()=>f(null),style:{...Ne,fontSize:18,color:we.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...Ne,fontSize:12,color:we.inkMid,lineHeight:1.6,marginBottom:16},children:re.descripcion}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:20},children:[{label:"Abogado",val:re.abogado},{label:"Valor pretensin",val:re.valor_pretension},{label:"Fecha inicio",val:rn(re.fecha_inicio)}].map((X,R)=>e.jsxs("div",{style:{padding:10,background:we.surface,borderRadius:6},children:[e.jsx("div",{style:{...Ne,fontSize:9,color:we.inkLight},children:X.label}),e.jsx("div",{style:{...Ne,fontSize:12,fontWeight:600,color:we.ink},children:X.val})]},R))}),e.jsx("div",{style:{...Ne,fontSize:13,fontWeight:700,color:we.ink,marginBottom:10},children:" Seguimiento"}),e.jsx("div",{style:{borderLeft:`2px solid ${we.border}`,paddingLeft:16,marginLeft:8,marginBottom:16},children:re.seguimiento.map((X,R)=>e.jsxs("div",{style:{marginBottom:12,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-22,top:2,width:10,height:10,borderRadius:"50%",background:R===re.seguimiento.length-1?we.accent:we.bg,border:`2px solid ${R===re.seguimiento.length-1?we.accent:we.border}`}}),e.jsx("div",{style:{...Ne,fontSize:10,color:we.inkLight},children:rn(X.fecha)}),e.jsx("div",{style:{...Ne,fontSize:12,color:we.ink},children:X.nota})]},R))}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("input",{value:M,onChange:X=>B(X.target.value),placeholder:"Aadir nota de seguimiento",onKeyDown:X=>X.key==="Enter"&&V(),style:{...Ne,flex:1,padding:"7px 12px",fontSize:12,border:`1px solid ${we.border}`,borderRadius:6}}),e.jsx("button",{onClick:V,style:{...Ne,padding:"7px 16px",fontSize:11,fontWeight:600,color:"#fff",background:we.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nota"})]})]})})},me=()=>{if(!v)return null;const re=!u.find(B=>B.id===v.id),J=(B,V)=>A(X=>({...X,[B]:V})),M=()=>{b(re?B=>[...B,v]:B=>B.map(V=>V.id===v.id?v:V)),A(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>A(null),children:e.jsxs("div",{onClick:B=>B.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:540,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Ne,fontSize:16,fontWeight:700,color:we.ink,marginBottom:16},children:re?" Nuevo proceso":" Editar"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[[["tipo","Tipo de proceso"],["contraparte","Contraparte"],["proyecto","Proyecto vinculado"],["abogado","Abogado responsable"],["valor_pretension","Valor pretensin"],["fecha_inicio","Fecha inicio","date"]].map(([B,V,X])=>e.jsxs("div",{children:[e.jsx("label",{style:{...Ne,fontSize:10,fontWeight:600,color:we.inkLight},children:V}),e.jsx("input",{type:X||"text",value:v[B]||"",onChange:R=>J(B,R.target.value),style:{...Ne,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${we.border}`,borderRadius:5,boxSizing:"border-box"}})]},B)),e.jsxs("div",{style:{gridColumn:"1/-1"},children:[e.jsx("label",{style:{...Ne,fontSize:10,fontWeight:600,color:we.inkLight},children:"Estado"}),e.jsx("select",{value:v.estado,onChange:B=>J("estado",B.target.value),style:{...Ne,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${we.border}`,borderRadius:5},children:hs.map(B=>e.jsx("option",{value:B.id,children:B.label},B.id))})]}),e.jsxs("div",{style:{gridColumn:"1/-1"},children:[e.jsx("label",{style:{...Ne,fontSize:10,fontWeight:600,color:we.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:v.descripcion||"",onChange:B=>J("descripcion",B.target.value),rows:3,style:{...Ne,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${we.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>A(null),style:{...Ne,padding:"8px 20px",fontSize:12,color:we.inkMid,background:we.bg,border:`1px solid ${we.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:M,style:{...Ne,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:we.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},Q=()=>e.jsx("div",{children:a.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40,color:we.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Ne,fontSize:13},children:"No hay documentos generados an. Ve a Plantillas y genera uno."})]}):a.map(re=>{const J=o.find(B=>B.id===re.plantillaId),M=Jr.find(B=>B.id===(J==null?void 0:J.cat));return e.jsxs("div",{style:{background:"#fff",border:`1px solid ${we.border}`,borderRadius:10,padding:16,marginBottom:8,boxShadow:we.shadow},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsxs("div",{children:[e.jsxs(Ro,{color:M==null?void 0:M.color,bg:(M==null?void 0:M.color)+"18",children:[M==null?void 0:M.icon," ",M==null?void 0:M.label]}),e.jsx("div",{style:{...Ne,fontSize:13,fontWeight:700,color:we.ink,marginTop:4},children:re.titulo})]}),e.jsx("div",{style:{...Ne,fontSize:10,color:we.inkLight},children:rn(re.fecha)})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{style:{...Ne,padding:"5px 12px",fontSize:10,color:we.info,background:we.infoBg,border:`1px solid ${we.info}33`,borderRadius:4,cursor:"pointer"},children:" Ver"}),e.jsx("button",{style:{...Ne,padding:"5px 12px",fontSize:10,color:we.accent,background:we.accentBg,border:`1px solid ${we.accent}33`,borderRadius:4,cursor:"pointer"},children:" Enviar a firma"}),e.jsx("button",{style:{...Ne,padding:"5px 12px",fontSize:10,color:we.inkMid,background:we.surface,border:`1px solid ${we.border}`,borderRadius:4,cursor:"pointer"},children:" PDF"})]})]},re.id)})}),je=[{id:"plantillas",icon:"",label:"Plantillas",badge:o.length},{id:"generados",icon:"",label:"Docs Generados",badge:a.length||null},{id:"seguros",icon:"",label:"Seguros / Plizas",badge:T.porVencer+T.vencidos||null},{id:"procesos",icon:"",label:"Procesos Legales",badge:u.filter(re=>re.estado==="abierto"||re.estado==="en_curso").length||null}];return e.jsxs("div",{style:{...Ne,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...Ne,fontSize:22,fontWeight:700,color:we.ink,margin:"0 0 4px"},children:" Legal"}),e.jsx("p",{style:{...Ne,fontSize:12,color:we.inkLight,margin:0},children:"Plantillas contractuales, gestin de plizas, seguimiento de procesos legales"})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${we.border}`,marginBottom:20},children:je.map(re=>e.jsxs("button",{onClick:()=>i(re.id),style:{...Ne,padding:"10px 16px",fontSize:12,fontWeight:t===re.id?700:500,color:t===re.id?we.accent:we.inkLight,background:"none",border:"none",borderBottom:t===re.id?`2px solid ${we.accent}`:"2px solid transparent",cursor:"pointer"},children:[re.icon," ",re.label,re.badge&&e.jsx("span",{style:{marginLeft:6,background:t===re.id?we.accent:we.border,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:re.badge})]},re.id))}),t==="plantillas"&&C(),t==="generados"&&Q(),t==="seguros"&&oe(),t==="procesos"&&P(),D(),K(),te(),ie(),me()]})}const Mx=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'DM Sans',sans-serif;background:#F5F4F1;-webkit-font-smoothing:antialiased}
    ::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}
    input,select,textarea{font-family:'DM Sans',sans-serif;outline:none}
    button{font-family:'DM Sans',sans-serif;cursor:pointer}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .22s ease both}
  `}),ge={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",purpleBg:"#F0ECF6",teal:"#0D5E6E",tealBg:"#E0F4F4",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Rt=()=>Math.random().toString(36).slice(2,9),Lo=()=>new Date().toISOString().split("T")[0],Qi=()=>new Date().toISOString(),vc=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",_x=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/36e5);return o<1?"hace momentos":o<24?`hace ${o}h`:`hace ${Math.floor(o/24)}d`};function an(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(async()=>{var r,s;try{const d=await((s=(r=window.storage)==null?void 0:r.get)==null?void 0:s.call(r,t));d!=null&&d.value&&n(JSON.parse(d.value))}catch{}})()},[t]);const a=F.useCallback(async r=>{var d,u;const s=typeof r=="function"?r(o):r;n(s);try{await((u=(d=window.storage)==null?void 0:d.set)==null?void 0:u.call(d,t,JSON.stringify(s)))}catch{}},[t,o]);return[o,a]}const ai=({children:t,style:i})=>e.jsx("div",{style:{background:ge.surface,border:`1px solid ${ge.border}`,borderRadius:8,boxShadow:ge.shadow,...i},children:t}),ao=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${ge.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?ge.redBg:ge.ink,color:i==="sec"?ge.inkMid:i==="danger"?ge.red:"#fff",...a},...r,children:t}),Zn=({label:t,color:i,bg:o})=>e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:3,padding:"2px 7px",borderRadius:3,background:o,color:i,fontSize:9,fontWeight:700},children:t}),fs=[{id:"dashboard",lbl:"Dashboard",I:Aa,desc:"Indicadores generales de calidad"},{id:"nc",lbl:"No conformidades",I:si,desc:"Registro y gestin de no conformidades"},{id:"auditorias",lbl:"Auditoras",I:wa,desc:"Auditoras internas y externas programadas"},{id:"protocolos",lbl:"Protocolos",I:At,desc:"Protocolos de ensayo, pruebas y recepcin"},{id:"checklists",lbl:"Listas de chequeo",I:ft,desc:"Listas de verificacin por actividad"},{id:"entregas",lbl:"Actas de entrega",I:zn,desc:"Actas parciales y finales de obra"},{id:"indicadores",lbl:"Indicadores KPI",I:qc,desc:"Mtricas y metas de calidad"}],er=[{id:"menor",lbl:"Menor",color:ge.amber,bg:ge.amberBg},{id:"mayor",lbl:"Mayor",color:"#D4840A",bg:"#FFF3E0"},{id:"critica",lbl:"Crtica",color:ge.red,bg:ge.redBg}],Dx=["Materiales fuera de especificacin","Dimensiones fuera de tolerancia","Acabado defectuoso","Instalacin incorrecta","Falta de planeidad","Fisuras o grietas","Humedad o filtracin","Incumplimiento de planos","Incumplimiento de norma","Falta de documentacin","Otro"],$x=["Interna","Externa","Seguimiento","Pre-entrega","Recepcin materiales"],Px=["Ensayo de resistencia (concreto)","Prueba hidrosttica","Prueba de estanqueidad","Verificacin de niveles","Prueba de aislamiento elctrico","Ensayo de compactacin","Verificacin de planeidad","Prueba de carga","Inspeccin visual de soldadura","Prueba de adherencia (pintura)","Otro"];function Ox(){var f,y;const[t,i]=F.useState("dashboard"),[o,n]=an("hab:calidad:nc",[]),[a,r]=an("hab:calidad:auditorias",[]),[s,d]=an("hab:calidad:protocolos",[]),[u,b]=an("hab:calidad:checklists",[]),[j,w]=an("hab:calidad:entregas",[]),[S,m]=an("hab:calidad:indicadores",[{id:Rt(),nombre:"Tasa de NC por actividad",meta:5,actual:3.2,unidad:"%",periodo:"mensual"},{id:Rt(),nombre:"NC cerradas en plazo",meta:90,actual:78,unidad:"%",periodo:"mensual"},{id:Rt(),nombre:"Auditoras realizadas",meta:4,actual:2,unidad:"ud",periodo:"trimestral"},{id:Rt(),nombre:"Satisfaccin cliente",meta:4.5,actual:4.2,unidad:"/5",periodo:"por proyecto"},{id:Rt(),nombre:"Reprocesos",meta:2,actual:1,unidad:"%",periodo:"mensual"}]),x={border:`1px solid ${ge.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},p=o.filter(h=>h.estado==="abierta"||h.estado==="en_proceso").length,c=o.filter(h=>h.estado==="cerrada").length,g=a.filter(h=>h.estado==="programada").length,l=o.filter(h=>h.severidad==="critica"&&h.estado!=="cerrada").length;return e.jsxs(e.Fragment,{children:[e.jsx(Mx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:ge.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:ge.surface,borderBottom:`1px solid ${ge.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:ge.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:ge.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:ge.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:ge.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:ge.inkLight,marginLeft:10},children:"/ Calidad y Auditora"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[l>0&&e.jsxs("div",{style:{background:ge.redBg,border:`1px solid ${ge.red}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>i("nc"),children:[e.jsx(si,{size:12,color:ge.red}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:ge.red},children:[l," NC crtica",l!==1?"s":""]})]}),g>0&&e.jsxs("div",{style:{background:ge.blueBg,border:`1px solid ${ge.blue}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>i("auditorias"),children:[e.jsx(wa,{size:12,color:ge.blue}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:ge.blue},children:[g," auditora",g!==1?"s":""," pendiente",g!==1?"s":""]})]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:ge.surface,borderRight:`1px solid ${ge.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[fs.map(h=>{const v=t===h.id,A=h.id==="nc"?p:h.id==="auditorias"?g:0;return e.jsxs("button",{onClick:()=>i(h.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:v?`3px solid ${ge.ink}`:"3px solid transparent",background:v?ge.accent:"transparent",color:v?ge.ink:ge.inkLight,fontSize:12,fontWeight:v?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(h.I,{size:13})," ",e.jsx("span",{style:{flex:1,lineHeight:1.2},children:h.lbl}),A>0&&e.jsx("span",{style:{background:h.id==="nc"?ge.red:ge.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:A})]},h.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:ge.inkXLight,letterSpacing:.8,borderTop:`1px solid ${ge.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:ge.ink,letterSpacing:-.2},children:(f=fs.find(h=>h.id===t))==null?void 0:f.lbl}),e.jsx("p",{style:{fontSize:11,color:ge.inkLight,marginTop:2},children:(y=fs.find(h=>h.id===t))==null?void 0:y.desc})]}),t==="dashboard"&&e.jsx(Lx,{ncs:o,auditorias:a,indicadores:S,ncAbiertas:p,ncCerradas:c,audPendientes:g,ncCriticas:l,setTab:i}),t==="nc"&&e.jsx(Wx,{ncs:o,saveNcs:n,inp:x}),t==="auditorias"&&e.jsx(Nx,{auditorias:a,saveAud:r,inp:x}),t==="protocolos"&&e.jsx(Ux,{protocolos:s,saveProt:d,inp:x}),t==="checklists"&&e.jsx(Vx,{checklists:u,saveCheck:b,inp:x}),t==="entregas"&&e.jsx(qx,{entregas:j,saveEntregas:w,inp:x}),t==="indicadores"&&e.jsx(Hx,{indicadores:S,saveKpi:m,inp:x})]})})]})]})]})}function Lx({ncs:t,auditorias:i,indicadores:o,ncAbiertas:n,ncCerradas:a,audPendientes:r,ncCriticas:s,setTab:d}){const u=t.length,b=u>0?Math.round(a/u*100):100;return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"NC abiertas",val:n,color:ge.red,bg:ge.redBg},{lbl:"NC crticas",val:s,color:s>0?ge.red:ge.green,bg:s>0?ge.redBg:ge.greenBg},{lbl:"Tasa de cierre",val:`${b}%`,color:b>=80?ge.green:ge.amber,bg:b>=80?ge.greenBg:ge.amberBg},{lbl:"Auditoras pend.",val:r,color:ge.blue,bg:ge.blueBg},{lbl:"Total NC",val:u,color:ge.inkMid,bg:ge.surfaceAlt}].map(j=>e.jsxs(ai,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase",letterSpacing:1},children:j.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:j.color,marginTop:4},children:j.val})]},j.lbl))}),e.jsxs(ai,{style:{padding:20,marginBottom:16,textAlign:"center",background:b>=80&&s===0?ge.greenBg:s>0?ge.redBg:ge.amberBg,border:`1px solid ${b>=80&&s===0?ge.green:s>0?ge.red:ge.amber}33`},children:[e.jsxs("div",{style:{fontSize:40,fontWeight:800,color:b>=80&&s===0?ge.green:s>0?ge.red:ge.amber},children:[b>=80&&s===0?"":s>0?"":""," ",b,"%"]}),e.jsx("div",{style:{fontSize:14,fontWeight:700,color:ge.ink,marginTop:4},children:"ndice de conformidad"}),e.jsx("div",{style:{fontSize:11,color:ge.inkMid},children:s>0?`${s} no conformidad(es) crtica(s) requieren atencin inmediata`:n>0?`${n} NC abiertas pendientes de resolucin`:"Sistema de calidad sin hallazgos abiertos"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs(ai,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:ge.redBg,borderBottom:`1px solid ${ge.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,fontWeight:700,color:ge.red},children:"NC recientes"}),e.jsx("button",{onClick:()=>d("nc"),style:{background:"none",border:"none",fontSize:9,color:ge.red,fontWeight:600,cursor:"pointer"},children:"Ver todas "})]}),t.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:ge.inkLight,fontSize:11},children:"Sin no conformidades "}):[...t].sort((j,w)=>w.fecha>j.fecha?1:-1).slice(0,5).map(j=>{var S;const w=er.find(m=>m.id===j.severidad)||er[0];return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:8,fontSize:10},children:[e.jsx(Zn,{label:w.lbl,color:w.color,bg:w.bg}),e.jsx("span",{style:{flex:1,fontWeight:500},children:((S=j.descripcion)==null?void 0:S.slice(0,50))||"Sin descripcin"}),e.jsx(Zn,{label:j.estado,color:j.estado==="cerrada"?ge.green:ge.amber,bg:j.estado==="cerrada"?ge.greenBg:ge.amberBg})]},j.id)})]}),e.jsxs(ai,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:ge.blueBg,borderBottom:`1px solid ${ge.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,fontWeight:700,color:ge.blue},children:"Indicadores clave"}),e.jsx("button",{onClick:()=>d("indicadores"),style:{background:"none",border:"none",fontSize:9,color:ge.blue,fontWeight:600,cursor:"pointer"},children:"Configurar "})]}),o.slice(0,5).map(j=>{const w=j.unidad==="%"?j.actual<=j.meta:j.actual>=j.meta,S=j.meta>0?Math.min(j.actual/j.meta*100,100):0;return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:3},children:[e.jsx("span",{style:{fontWeight:600},children:j.nombre}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:w?ge.green:ge.amber},children:[j.actual,j.unidad," / ",j.meta,j.unidad]})]}),e.jsx("div",{style:{height:4,background:ge.border,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${S}%`,background:w?ge.green:ge.amber,borderRadius:2,transition:"width .3s"}})})]},j.id)})]})]}),t.length===0&&i.length===0&&e.jsxs(ai,{style:{padding:24,textAlign:"center",marginTop:16},children:[e.jsx(wa,{size:32,style:{color:ge.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:13,fontWeight:600,color:ge.inkMid,marginBottom:12},children:"Sin datos de calidad an"}),e.jsxs(ao,{on:()=>{const j=[{id:Rt(),fecha:Qi(),numero:"NC-001",proyecto:"Torre Norte Apto 301",ubicacion:"Bao principal",categoria:"Fisuras o grietas",severidad:"mayor",descripcion:"Fisura longitudinal en paete de muro, longitud aprox 1.2m. Zona hmeda del bao principal.",estado:"abierta",responsable:"Residente",accionCorrectiva:"",fechaLimite:(()=>{const S=new Date;return S.setDate(S.getDate()+7),S.toISOString().split("T")[0]})(),evidencias:"Foto tomada",seguimiento:[]},{id:Rt(),fecha:Qi(),numero:"NC-002",proyecto:"Torre Norte Apto 301",ubicacion:"Cocina",categoria:"Dimensiones fuera de tolerancia",severidad:"menor",descripcion:"Mesn de cocina 2cm ms corto de lo especificado en plano. No afecta funcionalidad.",estado:"en_proceso",responsable:"Contratista carpintera",accionCorrectiva:"Se ajustar la pieza en la prxima visita",fechaLimite:(()=>{const S=new Date;return S.setDate(S.getDate()+5),S.toISOString().split("T")[0]})(),evidencias:"",seguimiento:[{fecha:Qi(),nota:"Se contact al proveedor para rehacer pieza",por:"Residente"}]},{id:Rt(),fecha:Qi(),numero:"NC-003",proyecto:"Oficinas Chic",ubicacion:"Piso 4 - Zona abierta",categoria:"Acabado defectuoso",severidad:"critica",descripcion:"Porcelanato presenta manchas de xido en 15m de la zona abierta. Material de lote defectuoso.",estado:"abierta",responsable:"Proveedor Cermicas",accionCorrectiva:"",fechaLimite:Lo(),evidencias:"Fotos y video",seguimiento:[]},{id:Rt(),fecha:Qi(),numero:"NC-004",proyecto:"Casa Campestre Cha",ubicacion:"Cubierta",categoria:"Humedad o filtracin",severidad:"mayor",descripcion:"Filtracin en unin de cubierta con muro fachada norte. Se evidencia humedad en cielo raso.",estado:"cerrada",responsable:"Impermeabilizador",accionCorrectiva:"Se resell junta con membrana asfltica y se verific estanqueidad",fechaLimite:Lo(),evidencias:"Antes/despus",seguimiento:[{fecha:Qi(),nota:"Reparacin ejecutada",por:"Residente"},{fecha:Qi(),nota:"Prueba de estanqueidad OK, se cierra NC",por:"Director"}]}];saveNcs(j);const w=[{id:Rt(),fecha:Lo(),tipo:"Interna",proyecto:"Torre Norte",auditor:"David Parra",alcance:"Revisin acabados pisos 1-3",estado:"programada",hallazgos:"",calificacion:0},{id:Rt(),fecha:(()=>{const S=new Date;return S.setDate(S.getDate()-7),S.toISOString().split("T")[0]})(),tipo:"Pre-entrega",proyecto:"Casa Campestre Cha",auditor:"Ana Mara Daz",alcance:"Verificacin general pre-entrega al cliente",estado:"realizada",hallazgos:"3 hallazgos menores en acabados de pintura",calificacion:85}];saveAud(w)},children:[e.jsx(Pe,{size:12})," Crear datos de ejemplo"]})]})]})}function Wx({ncs:t,saveNcs:i,inp:o}){const[n,a]=F.useState("todos"),[r,s]=F.useState(""),[d,u]=F.useState(null),b=()=>{const m={id:Rt(),fecha:Qi(),numero:`NC-${String(t.length+1).padStart(3,"0")}`,proyecto:"",ubicacion:"",categoria:"Otro",severidad:"menor",descripcion:"",estado:"abierta",responsable:"",accionCorrectiva:"",fechaLimite:"",evidencias:"",seguimiento:[]};i(x=>[...x,m]),u(m.id)},j=(m,x,p)=>i(c=>c.map(g=>g.id===m?{...g,[x]:p}:g)),w=(m,x)=>{i(p=>p.map(c=>c.id===m?{...c,seguimiento:[...c.seguimiento||[],{fecha:Qi(),nota:x,por:"Usuario"}]}:c))},S=t.filter(m=>!(n!=="todos"&&m.estado!==n||r&&!(m.descripcion||"").toLowerCase().includes(r.toLowerCase())&&!(m.numero||"").toLowerCase().includes(r.toLowerCase())&&!(m.proyecto||"").toLowerCase().includes(r.toLowerCase()))).sort((m,x)=>x.fecha>m.fecha?1:-1);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["todos","Todas"],["abierta","Abiertas"],["en_proceso","En proceso"],["cerrada","Cerradas"]].map(([m,x],p,c)=>e.jsxs("button",{onClick:()=>a(m),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${ge.border}`,borderLeft:p>0?"none":void 0,borderRadius:p===0?"4px 0 0 4px":p===c.length-1?"0 4px 4px 0":"0",background:n===m?ge.ink:"#fff",color:n===m?"#fff":ge.inkMid},children:[x," ",m==="abierta"?`(${t.filter(g=>g.estado==="abierta").length})`:""]},m))}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(vi,{size:12,style:{position:"absolute",left:8,top:9,color:ge.inkLight}}),e.jsx("input",{value:r,onChange:m=>s(m.target.value),placeholder:"Buscar NC...",style:{...o,paddingLeft:26,width:200}})]}),e.jsxs(ao,{sm:!0,on:b,style:{background:ge.red},children:[e.jsx(Pe,{size:10})," Nueva NC"]})]}),e.jsx(ai,{style:{padding:0,overflow:"hidden"},children:S.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:ge.inkLight,fontSize:12},children:["Sin no conformidades ",n!=="todos"?`con estado "${n}"`:""]}):S.map(m=>{const x=er.find(g=>g.id===m.severidad)||er[0],p=d===m.id,c=m.fechaLimite&&new Date(m.fechaLimite)<new Date&&m.estado!=="cerrada";return e.jsxs("div",{style:{borderBottom:`1px solid ${ge.border}`},children:[e.jsxs("div",{onClick:()=>u(p?null:m.id),style:{padding:"10px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:p?ge.surfaceAlt:"transparent",borderLeft:`4px solid ${x.color}`},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:ge.blue,background:ge.blueBg,padding:"2px 6px",borderRadius:3},children:m.numero}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.descripcion||"Sin descripcin"}),e.jsxs("div",{style:{fontSize:9,color:ge.inkLight,marginTop:1},children:[m.proyecto||"Sin proyecto","  ",m.ubicacion||"Sin ubicacin","  ",m.categoria]})]}),e.jsx(Zn,{label:x.lbl,color:x.color,bg:x.bg}),c&&e.jsx(Zn,{label:"VENCIDA",color:ge.red,bg:ge.redBg}),e.jsx(Zn,{label:m.estado,color:m.estado==="cerrada"?ge.green:m.estado==="en_proceso"?ge.blue:ge.amber,bg:m.estado==="cerrada"?ge.greenBg:m.estado==="en_proceso"?ge.blueBg:ge.amberBg}),e.jsx("span",{style:{fontSize:9,color:ge.inkLight},children:_x(m.fecha)}),p?e.jsx(An,{size:12}):e.jsx(Gi,{size:12})]}),p&&e.jsxs("div",{style:{padding:"0 16px 14px 20px",background:ge.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:8,marginTop:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:m.proyecto||"",onChange:g=>j(m.id,"proyecto",g.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Ubicacin"}),e.jsx("input",{value:m.ubicacion||"",onChange:g=>j(m.id,"ubicacion",g.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Responsable"}),e.jsx("input",{value:m.responsable||"",onChange:g=>j(m.id,"responsable",g.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Fecha lmite"}),e.jsx("input",{type:"date",value:m.fechaLimite||"",onChange:g=>j(m.id,"fechaLimite",g.target.value),style:{...o,width:"100%"}})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsx("select",{value:m.categoria,onChange:g=>j(m.id,"categoria",g.target.value),style:{...o,width:"100%"},children:Dx.map(g=>e.jsx("option",{children:g},g))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Severidad"}),e.jsx("select",{value:m.severidad,onChange:g=>j(m.id,"severidad",g.target.value),style:{...o,width:"100%"},children:er.map(g=>e.jsx("option",{value:g.id,children:g.lbl},g.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Estado"}),e.jsx("select",{value:m.estado,onChange:g=>j(m.id,"estado",g.target.value),style:{...o,width:"100%",background:m.estado==="cerrada"?ge.greenBg:m.estado==="en_proceso"?ge.blueBg:"#fff"},children:["abierta","en_proceso","cerrada"].map(g=>e.jsx("option",{value:g,children:g},g))})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Descripcin del hallazgo"}),e.jsx("textarea",{value:m.descripcion||"",onChange:g=>j(m.id,"descripcion",g.target.value),rows:2,style:{...o,width:"100%",resize:"vertical",lineHeight:1.5}})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Accin correctiva"}),e.jsx("textarea",{value:m.accionCorrectiva||"",onChange:g=>j(m.id,"accionCorrectiva",g.target.value),rows:2,placeholder:"Describir la accin correctiva aplicada o propuesta...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5,background:m.estado==="cerrada"?ge.greenBg:"#fff"}})]}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:ge.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Seguimiento"}),(m.seguimiento||[]).map((g,l)=>{var f;return e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${ge.border}`,paddingLeft:10,marginLeft:4,marginBottom:2},children:[e.jsx("span",{style:{color:ge.inkLight,minWidth:60,fontSize:9},children:vc((f=g.fecha)==null?void 0:f.split("T")[0])}),e.jsx("span",{style:{fontWeight:600,fontSize:9},children:g.por}),e.jsx("span",{style:{color:ge.inkMid},children:g.nota})]},l)}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:4},children:[e.jsx("input",{id:`seg-nc-${m.id}`,placeholder:"Aadir nota de seguimiento...",style:{...o,flex:1,fontSize:10}}),e.jsxs(ao,{sm:!0,v:"sec",on:()=>{const g=document.getElementById(`seg-nc-${m.id}`);g!=null&&g.value.trim()&&(w(m.id,g.value),g.value="")},children:[e.jsx(Pe,{size:9})," Aadir"]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:e.jsx("button",{onClick:()=>i(g=>g.filter(l=>l.id!==m.id)),style:{background:"none",border:"none",color:ge.red,fontSize:10,cursor:"pointer"},children:" Eliminar NC"})})]})]},m.id)})})]})}function Nx({auditorias:t,saveAud:i,inp:o}){const n=()=>{i(r=>[...r,{id:Rt(),fecha:Lo(),tipo:"Interna",proyecto:"",auditor:"",alcance:"",estado:"programada",hallazgos:"",calificacion:0,items:[]}])},a=(r,s,d)=>i(u=>u.map(b=>b.id===r?{...b,[s]:d}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(ao,{sm:!0,on:n,children:[e.jsx(Pe,{size:10})," Nueva auditora"]})}),t.sort((r,s)=>s.fecha>r.fecha?1:-1).map(r=>e.jsxs(ai,{style:{padding:16,marginBottom:10,borderLeft:`4px solid ${r.estado==="realizada"?ge.green:r.estado==="programada"?ge.blue:ge.inkLight}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{type:"date",value:r.fecha,onChange:s=>a(r.id,"fecha",s.target.value),style:{border:`1px solid ${ge.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("select",{value:r.tipo,onChange:s=>a(r.id,"tipo",s.target.value),style:{...o,width:140,fontSize:11,fontWeight:600},children:$x.map(s=>e.jsx("option",{children:s},s))}),e.jsx("input",{value:r.proyecto||"",onChange:s=>a(r.id,"proyecto",s.target.value),placeholder:"Proyecto",style:{flex:1,...o,fontWeight:600}}),e.jsx("input",{value:r.auditor||"",onChange:s=>a(r.id,"auditor",s.target.value),placeholder:"Auditor",style:{width:140,...o,fontSize:10}}),e.jsx("select",{value:r.estado,onChange:s=>a(r.id,"estado",s.target.value),style:{fontSize:9,padding:"3px 8px",border:`1px solid ${ge.border}`,borderRadius:3,background:r.estado==="realizada"?ge.greenBg:r.estado==="programada"?ge.blueBg:"#fff"},children:["programada","en_curso","realizada","cancelada"].map(s=>e.jsx("option",{children:s},s))}),e.jsx("button",{onClick:()=>i(s=>s.filter(d=>d.id!==r.id)),style:{background:"none",border:"none",color:ge.red,cursor:"pointer"},children:e.jsx(qe,{size:12})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Alcance"}),e.jsx("input",{value:r.alcance||"",onChange:s=>a(r.id,"alcance",s.target.value),placeholder:"reas y actividades a auditar",style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Calificacin (%)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"range",min:0,max:100,value:r.calificacion||0,onChange:s=>a(r.id,"calificacion",+s.target.value),style:{flex:1,accentColor:r.calificacion>=80?ge.green:ge.amber}}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:r.calificacion>=80?ge.green:r.calificacion>=50?ge.amber:ge.red},children:[r.calificacion||0,"%"]})]})]})]}),r.estado==="realizada"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Hallazgos"}),e.jsx("textarea",{value:r.hallazgos||"",onChange:s=>a(r.id,"hallazgos",s.target.value),rows:2,placeholder:"Resumen de hallazgos...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5}})]})]},r.id)),t.length===0&&e.jsx(ai,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:ge.inkLight},children:"Sin auditoras programadas"})})]})}function Ux({protocolos:t,saveProt:i,inp:o}){const n=()=>{i(r=>[...r,{id:Rt(),fecha:Lo(),tipo:"Otro",proyecto:"",ubicacion:"",responsable:"",resultado:"pendiente",valor:"",valorRef:"",observaciones:""}])},a=(r,s,d)=>i(u=>u.map(b=>b.id===r?{...b,[s]:d}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(ao,{sm:!0,on:n,children:[e.jsx(Pe,{size:10})," Nuevo protocolo"]})}),e.jsx(ai,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:ge.surfaceAlt},children:["Fecha","Tipo de ensayo/prueba","Proyecto","Ubicacin","Valor","Ref.","Resultado","Responsable",""].map(r=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${ge.border}`},children:r},r))})}),e.jsxs("tbody",{children:[t.sort((r,s)=>s.fecha>r.fecha?1:-1).map(r=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ge.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:r.fecha,onChange:s=>a(r.id,"fecha",s.target.value),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:r.tipo,onChange:s=>a(r.id,"tipo",s.target.value),style:{border:"none",background:"transparent",fontSize:10,fontWeight:600},children:Px.map(s=>e.jsx("option",{children:s},s))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.proyecto||"",onChange:s=>a(r.id,"proyecto",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.ubicacion||"",onChange:s=>a(r.id,"ubicacion",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.valor||"",onChange:s=>a(r.id,"valor",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:60,fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.valorRef||"",onChange:s=>a(r.id,"valorRef",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:60,fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:r.resultado,onChange:s=>a(r.id,"resultado",s.target.value),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${ge.border}`,borderRadius:3,background:r.resultado==="conforme"?ge.greenBg:r.resultado==="no_conforme"?ge.redBg:"#fff"},children:[["pendiente","Pendiente"],["conforme","Conforme"],["no_conforme","No conforme"]].map(([s,d])=>e.jsx("option",{value:s,children:d},s))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.responsable||"",onChange:s=>a(r.id,"responsable",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:70}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>i(s=>s.filter(d=>d.id!==r.id)),style:{background:"none",border:"none",color:ge.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})})]},r.id)),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:30,textAlign:"center",color:ge.inkLight},children:"Sin protocolos registrados"})})]})]})})]})}function Vx({checklists:t,saveCheck:i,inp:o}){const[n,a]=F.useState(null),r=()=>{const b={id:Rt(),nombre:"Nueva lista de chequeo",proyecto:"",fecha:Lo(),responsable:"",items:[{id:Rt(),texto:"Verificar niveles y plomos",ok:!1},{id:Rt(),texto:"Verificar dimensiones segn plano",ok:!1},{id:Rt(),texto:"Verificar acabado superficial",ok:!1},{id:Rt(),texto:"Verificar juntas y sellantes",ok:!1},{id:Rt(),texto:"Verificar limpieza del rea",ok:!1}]};i(j=>[...j,b]),a(b.id)},s=(b,j,w)=>i(S=>S.map(m=>m.id===b?{...m,[j]:w}:m)),d=(b,j)=>{i(w=>w.map(S=>S.id===b?{...S,items:S.items.map(m=>m.id===j?{...m,ok:!m.ok}:m)}:S))},u=b=>{i(j=>j.map(w=>w.id===b?{...w,items:[...w.items,{id:Rt(),texto:"",ok:!1}]}:w))};return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(ao,{sm:!0,on:r,children:[e.jsx(Pe,{size:10})," Nueva lista"]})}),t.map(b=>{const j=b.items.filter(x=>x.ok).length,w=b.items.length,S=w>0?Math.round(j/w*100):0,m=n===b.id;return e.jsxs(ai,{style:{marginBottom:10,padding:0,overflow:"hidden"},children:[e.jsxs("div",{onClick:()=>a(m?null:b.id),style:{padding:"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:m?ge.surfaceAlt:"transparent"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",border:`3px solid ${S>=100?ge.green:ge.border}`,display:"flex",alignItems:"center",justifyContent:"center",background:S>=100?ge.greenBg:"transparent",flexShrink:0},children:S>=100?e.jsx(Vo,{size:16,color:ge.green}):e.jsxs("span",{style:{fontSize:9,fontWeight:800,fontFamily:"'DM Mono',monospace",color:ge.inkMid},children:[S,"%"]})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:b.nombre}),e.jsxs("div",{style:{fontSize:9,color:ge.inkLight},children:[b.proyecto||"Sin proyecto","  ",j,"/",w," items  ",vc(b.fecha)]})]}),e.jsx("div",{style:{width:80,height:6,background:ge.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${S}%`,background:S>=100?ge.green:ge.blue,borderRadius:3}})}),m?e.jsx(An,{size:12}):e.jsx(Gi,{size:12})]}),m&&e.jsxs("div",{style:{padding:"0 16px 14px",background:ge.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",gap:8,marginBottom:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Nombre"}),e.jsx("input",{value:b.nombre,onChange:x=>s(b.id,"nombre",x.target.value),style:{...o,width:"100%",fontWeight:700}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:b.proyecto||"",onChange:x=>s(b.id,"proyecto",x.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase"},children:"Responsable"}),e.jsx("input",{value:b.responsable||"",onChange:x=>s(b.id,"responsable",x.target.value),style:{...o,width:"100%"}})]})]}),b.items.map((x,p)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"5px 0",borderBottom:`1px solid ${ge.border}`},children:[e.jsx("button",{onClick:()=>d(b.id,x.id),style:{width:22,height:22,borderRadius:4,border:`2px solid ${x.ok?ge.green:ge.border}`,background:x.ok?ge.greenBg:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:x.ok&&e.jsx(ft,{size:12,color:ge.green})}),e.jsx("input",{value:x.texto,onChange:c=>{i(g=>g.map(l=>l.id===b.id?{...l,items:l.items.map(f=>f.id===x.id?{...f,texto:c.target.value}:f)}:l))},placeholder:"Descripcin del item...",style:{flex:1,border:"none",background:"transparent",fontSize:11,textDecoration:x.ok?"line-through":"none",color:x.ok?ge.inkLight:ge.ink}}),e.jsx("button",{onClick:()=>i(c=>c.map(g=>g.id===b.id?{...g,items:g.items.filter(l=>l.id!==x.id)}:g)),style:{background:"none",border:"none",color:ge.red,cursor:"pointer"},children:e.jsx(qe,{size:10})})]},x.id)),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs(ao,{sm:!0,v:"sec",on:()=>u(b.id),children:[e.jsx(Pe,{size:9})," Aadir item"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{onClick:()=>i(x=>x.filter(p=>p.id!==b.id)),style:{background:"none",border:"none",color:ge.red,fontSize:10,cursor:"pointer"},children:" Eliminar lista"})]})]})]},b.id)}),t.length===0&&e.jsx(ai,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:ge.inkLight},children:"Sin listas de chequeo. Crea la primera."})})]})}function qx({entregas:t,saveEntregas:i,inp:o}){const n=()=>{i(r=>[...r,{id:Rt(),fecha:Lo(),tipo:"parcial",proyecto:"",cliente:"",descripcion:"",items:[],estado:"borrador",observaciones:"",firmaCliente:!1,firmaHabitaris:!1}])},a=(r,s,d)=>i(u=>u.map(b=>b.id===r?{...b,[s]:d}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(ao,{sm:!0,on:n,children:[e.jsx(Pe,{size:10})," Nueva acta"]})}),t.sort((r,s)=>s.fecha>r.fecha?1:-1).map(r=>e.jsxs(ai,{style:{padding:16,marginBottom:10,borderLeft:`4px solid ${r.estado==="firmada"?ge.green:r.estado==="enviada"?ge.blue:ge.inkLight}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{type:"date",value:r.fecha,onChange:s=>a(r.id,"fecha",s.target.value),style:{border:`1px solid ${ge.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsxs("select",{value:r.tipo,onChange:s=>a(r.id,"tipo",s.target.value),style:{...o,width:100,fontSize:11,fontWeight:600},children:[e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"final",children:"Final"}),e.jsx("option",{value:"provisional",children:"Provisional"})]}),e.jsx("input",{value:r.proyecto||"",onChange:s=>a(r.id,"proyecto",s.target.value),placeholder:"Proyecto",style:{flex:1,...o,fontWeight:600}}),e.jsx("input",{value:r.cliente||"",onChange:s=>a(r.id,"cliente",s.target.value),placeholder:"Cliente",style:{width:140,...o,fontSize:10}}),e.jsx("select",{value:r.estado,onChange:s=>a(r.id,"estado",s.target.value),style:{fontSize:9,padding:"3px 8px",border:`1px solid ${ge.border}`,borderRadius:3,background:r.estado==="firmada"?ge.greenBg:r.estado==="enviada"?ge.blueBg:"#fff"},children:["borrador","enviada","firmada"].map(s=>e.jsx("option",{children:s},s))}),e.jsx("button",{onClick:()=>i(s=>s.filter(d=>d.id!==r.id)),style:{background:"none",border:"none",color:ge.red,cursor:"pointer"},children:e.jsx(qe,{size:12})})]}),e.jsx("textarea",{value:r.descripcion||"",onChange:s=>a(r.id,"descripcion",s.target.value),rows:2,placeholder:"Descripcin de los trabajos entregados...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5,marginBottom:6}}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",fontSize:10},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.firmaHabitaris||!1,onChange:s=>a(r.id,"firmaHabitaris",s.target.checked)}),e.jsx("span",{style:{fontWeight:600},children:"Firma Habitaris"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.firmaCliente||!1,onChange:s=>a(r.id,"firmaCliente",s.target.checked)}),e.jsx("span",{style:{fontWeight:600},children:"Firma Cliente"})]}),e.jsx("input",{value:r.observaciones||"",onChange:s=>a(r.id,"observaciones",s.target.value),placeholder:"Observaciones...",style:{flex:1,...o,fontSize:10}})]})]},r.id)),t.length===0&&e.jsx(ai,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:ge.inkLight},children:"Sin actas de entrega"})})]})}function Hx({indicadores:t,saveKpi:i,inp:o}){const n=()=>{i(r=>[...r,{id:Rt(),nombre:"Nuevo indicador",meta:0,actual:0,unidad:"%",periodo:"mensual"}])},a=(r,s,d)=>i(u=>u.map(b=>b.id===r?{...b,[s]:d}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(ao,{sm:!0,on:n,children:[e.jsx(Pe,{size:10})," Nuevo indicador"]})}),e.jsx(ai,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:ge.surfaceAlt},children:["Indicador","Meta","Actual","Unidad","Perodo","Cumplimiento",""].map(r=>e.jsx("th",{style:{padding:"8px 12px",fontSize:8,fontWeight:700,color:ge.inkLight,textTransform:"uppercase",textAlign:["Meta","Actual"].includes(r)?"right":"left",borderBottom:`2px solid ${ge.border}`},children:r},r))})}),e.jsx("tbody",{children:t.map(r=>{const s=r.meta>0?Math.min(r.actual/r.meta*100,150):0,d=r.unidad==="%"&&(r.nombre.toLowerCase().includes("reproceso")||r.nombre.toLowerCase().includes("nc por"))?r.actual<=r.meta:r.actual>=r.meta;return e.jsxs("tr",{style:{borderBottom:`1px solid ${ge.border}`},children:[e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("input",{value:r.nombre,onChange:u=>a(r.id,"nombre",u.target.value),style:{border:"none",background:"transparent",fontSize:12,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"8px 12px",textAlign:"right"},children:e.jsx("input",{type:"number",value:r.meta||"",onChange:u=>a(r.id,"meta",+u.target.value),style:{width:50,border:`1px solid ${ge.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"8px 12px",textAlign:"right"},children:e.jsx("input",{type:"number",value:r.actual||"",onChange:u=>a(r.id,"actual",+u.target.value),style:{width:50,border:`1px solid ${ge.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,background:d?ge.greenBg:ge.amberBg,color:d?ge.green:ge.amber}})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("select",{value:r.unidad,onChange:u=>a(r.id,"unidad",u.target.value),style:{border:"none",background:"transparent",fontSize:10},children:["%","ud","/5","das","h"].map(u=>e.jsx("option",{children:u},u))})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("select",{value:r.periodo,onChange:u=>a(r.id,"periodo",u.target.value),style:{border:"none",background:"transparent",fontSize:10},children:["mensual","trimestral","semestral","anual","por proyecto"].map(u=>e.jsx("option",{children:u},u))})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:ge.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${Math.min(s,100)}%`,background:d?ge.green:ge.amber,borderRadius:3,transition:"width .3s"}})}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:d?ge.green:ge.amber},children:d?"":""})]})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("button",{onClick:()=>i(u=>u.filter(b=>b.id!==r.id)),style:{background:"none",border:"none",color:ge.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})})]},r.id)})})]})})]})}const Gx=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),_e={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},qn=()=>Math.random().toString(36).slice(2,9),xs=()=>new Date().toISOString().split("T")[0],hd=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",Kx=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/36e5);return o<24?`hace ${o}h`:`hace ${Math.floor(o/24)}d`};function Yr(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(async()=>{var r,s;try{const d=await((s=(r=window.storage)==null?void 0:r.get)==null?void 0:s.call(r,t));d!=null&&d.value&&n(JSON.parse(d.value))}catch{}})()},[t]);const a=F.useCallback(async r=>{var d,u;const s=typeof r=="function"?r(o):r;n(s);try{await((u=(d=window.storage)==null?void 0:d.set)==null?void 0:u.call(d,t,JSON.stringify(s)))}catch{}},[t,o]);return[o,a]}const Mi=({children:t,style:i})=>e.jsx("div",{style:{background:_e.surface,border:`1px solid ${_e.border}`,borderRadius:8,boxShadow:_e.shadow,...i},children:t}),sn=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${_e.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":_e.ink,color:i==="sec"?_e.inkMid:"#fff",cursor:"pointer",...a},...r,children:t}),Jx=[{id:"dashboard",lbl:"Dashboard",I:Aa,desc:"Resumen de postventa y satisfaccin"},{id:"tickets",lbl:"Tickets",I:xr,desc:"Solicitudes y reclamos de clientes"},{id:"garantias",lbl:"Garantas",I:At,desc:"Control de garantas vigentes"},{id:"visitas",lbl:"Visitas",I:Dd,desc:"Visitas de inspeccin y correccin"},{id:"encuestas",lbl:"Satisfaccin",I:Hc,desc:"Encuestas y calificaciones"}],Hn=[{id:"baja",lbl:"Baja",color:_e.green,bg:_e.greenBg},{id:"media",lbl:"Media",color:_e.amber,bg:_e.amberBg},{id:"alta",lbl:"Alta",color:"#D4840A",bg:"#FFF3E0"},{id:"urgente",lbl:"Urgente",color:_e.red,bg:_e.redBg}],Yx=["Impermeabilizacin","Pintura","Grietas/fisuras","Instalaciones hidrulicas","Instalaciones elctricas","Carpintera","Pisos","Cielos","Cerraduras/chapas","Otro"];function Xx(){const[t,i]=F.useState("dashboard"),[o,n]=Yr("hab:postventa:tickets",[]),[a,r]=Yr("hab:postventa:garantias",[]),[s,d]=Yr("hab:postventa:visitas",[]),[u,b]=Yr("hab:postventa:encuestas",[]),[j,w]=F.useState(null),S={border:`1px solid ${_e.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},m=()=>{const l={id:qn(),fecha:new Date().toISOString(),numero:`TK-${String(o.length+1).padStart(4,"0")}`,cliente:"",proyecto:"",categoria:"Otro",prioridad:"media",descripcion:"",estado:"abierto",contacto:"",telefono:"",email:"",seguimiento:[],resolucion:""};n(f=>[...f,l]),w(l.id)},x=(l,f,y)=>n(h=>h.map(v=>v.id===l?{...v,[f]:y}:v)),p=(l,f)=>{n(y=>y.map(h=>h.id===l?{...h,seguimiento:[...h.seguimiento||[],{id:qn(),fecha:new Date().toISOString(),nota:f,por:"Habitaris"}]}:h))},c=o.filter(l=>l.estado==="abierto"||l.estado==="en_proceso"),g=u.length>0?(u.reduce((l,f)=>l+(f.calificacion||0),0)/u.length).toFixed(1):"";return e.jsxs(e.Fragment,{children:[e.jsx(Gx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:_e.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:_e.surface,borderBottom:`1px solid ${_e.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:_e.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:_e.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:_e.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:_e.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:_e.inkLight},children:"/ Postventa"}),e.jsx("div",{style:{flex:1}}),c.length>0&&e.jsxs("div",{style:{background:_e.amberBg,border:`1px solid ${_e.amber}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(si,{size:12,color:_e.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:_e.amber},children:[c.length," ticket",c.length!==1?"s":""," abierto",c.length!==1?"s":""]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:_e.surface,borderRight:`1px solid ${_e.border}`,paddingTop:8},children:Jx.map(l=>{const f=l.id==="tickets"?c.length:0;return e.jsxs("button",{onClick:()=>i(l.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===l.id?`3px solid ${_e.ink}`:"3px solid transparent",background:t===l.id?_e.accent:"transparent",color:t===l.id?_e.ink:_e.inkLight,fontSize:12,fontWeight:t===l.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(l.I,{size:13})," ",e.jsx("span",{style:{flex:1},children:l.lbl}),f>0&&e.jsx("span",{style:{background:_e.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:f})]},l.id)})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Tickets abiertos",val:c.length,color:_e.amber,bg:_e.amberBg},{lbl:"Total tickets",val:o.length,color:_e.blue,bg:_e.blueBg},{lbl:"Resueltos",val:o.filter(l=>l.estado==="cerrado").length,color:_e.green,bg:_e.greenBg},{lbl:"Garantas activas",val:a.filter(l=>new Date(l.vencimiento)>new Date).length,color:"#5B3A8C",bg:"#F0ECF6"},{lbl:"Satisfaccin",val:g,color:parseFloat(g)>=4?_e.green:_e.amber,bg:parseFloat(g)>=4?_e.greenBg:_e.amberBg}].map(l=>e.jsxs(Mi,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase",letterSpacing:1},children:l.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:l.color,marginTop:4},children:l.val})]},l.lbl))}),e.jsxs(Mi,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${_e.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Tickets recientes"}),e.jsxs(sn,{sm:!0,on:m,children:[e.jsx(Pe,{size:10})," Nuevo ticket"]})]}),o.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:_e.inkLight},children:[e.jsx(Dd,{size:28,style:{opacity:.3,marginBottom:8}}),e.jsx("div",{children:"Sin tickets de postventa"})]}):[...o].sort((l,f)=>f.fecha>l.fecha?1:-1).slice(0,8).map(l=>{var y,h;const f=Hn.find(v=>v.id===l.prioridad)||Hn[1];return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11,cursor:"pointer"},onClick:()=>{i("tickets"),w(l.id)},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:_e.blue},children:l.numero}),e.jsxs("span",{style:{flex:1,fontWeight:500},children:[((y=l.descripcion)==null?void 0:y.slice(0,60))||"Sin descripcin",((h=l.descripcion)==null?void 0:h.length)>60?"...":""]}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:f.bg,color:f.color,fontWeight:700},children:f.lbl}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:l.estado==="cerrado"?_e.greenBg:l.estado==="en_proceso"?_e.blueBg:_e.amberBg,color:l.estado==="cerrado"?_e.green:l.estado==="en_proceso"?_e.blue:_e.amber,fontWeight:700},children:l.estado}),e.jsx("span",{style:{fontSize:9,color:_e.inkLight},children:Kx(l.fecha)})]},l.id)})]})]}),t==="tickets"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Tickets de postventa"}),e.jsxs(sn,{sm:!0,on:m,children:[e.jsx(Pe,{size:10})," Nuevo ticket"]})]}),o.sort((l,f)=>f.fecha>l.fecha?1:-1).map(l=>{var h;const f=Hn.find(v=>v.id===l.prioridad)||Hn[1],y=j===l.id;return e.jsxs(Mi,{style:{marginBottom:8,padding:0,overflow:"hidden",borderLeft:`4px solid ${f.color}`},children:[e.jsxs("div",{onClick:()=>w(y?null:l.id),style:{padding:"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:y?_e.surfaceAlt:"transparent"},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:700,color:_e.blue},children:l.numero}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:600},children:[l.cliente||"Cliente","  ",l.proyecto||"Proyecto"]}),e.jsxs("div",{style:{fontSize:10,color:_e.inkLight},children:[l.categoria,"  ",hd((h=l.fecha)==null?void 0:h.split("T")[0])]})]}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:f.bg,color:f.color,fontWeight:700},children:f.lbl}),e.jsx("select",{value:l.estado,onChange:v=>{v.stopPropagation(),x(l.id,"estado",v.target.value)},style:{fontSize:9,padding:"2px 6px",border:`1px solid ${_e.border}`,borderRadius:3,background:l.estado==="cerrado"?_e.greenBg:l.estado==="en_proceso"?_e.blueBg:_e.amberBg},children:["abierto","en_proceso","cerrado"].map(v=>e.jsx("option",{value:v,children:v},v))}),y?e.jsx(Gi,{size:12,style:{transform:"rotate(90deg)"}}):e.jsx(Gi,{size:12})]}),y&&e.jsxs("div",{style:{padding:"0 16px 14px",background:_e.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase"},children:"Cliente"}),e.jsx("input",{value:l.cliente||"",onChange:v=>x(l.id,"cliente",v.target.value),style:{...S,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:l.proyecto||"",onChange:v=>x(l.id,"proyecto",v.target.value),style:{...S,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsx("select",{value:l.categoria,onChange:v=>x(l.id,"categoria",v.target.value),style:{...S,width:"100%"},children:Yx.map(v=>e.jsx("option",{children:v},v))})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsx("input",{value:l.contacto||"",onChange:v=>x(l.id,"contacto",v.target.value),placeholder:" Contacto",style:S}),e.jsx("input",{value:l.telefono||"",onChange:v=>x(l.id,"telefono",v.target.value),placeholder:" Telfono",style:S}),e.jsx("input",{value:l.email||"",onChange:v=>x(l.id,"email",v.target.value),placeholder:" Email",style:S})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase"},children:"Descripcin del problema"}),e.jsx("textarea",{value:l.descripcion||"",onChange:v=>x(l.id,"descripcion",v.target.value),rows:3,style:{...S,width:"100%",resize:"vertical",lineHeight:1.5}})]}),e.jsx("div",{style:{display:"flex",gap:8,marginBottom:8},children:e.jsx("select",{value:l.prioridad,onChange:v=>x(l.id,"prioridad",v.target.value),style:{...S,width:100},children:Hn.map(v=>e.jsx("option",{value:v.id,children:v.lbl},v.id))})}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:_e.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Seguimiento"}),(l.seguimiento||[]).map(v=>{var A;return e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${_e.border}`,paddingLeft:10,marginLeft:4,marginBottom:2},children:[e.jsx("span",{style:{color:_e.inkLight,minWidth:60},children:hd((A=v.fecha)==null?void 0:A.split("T")[0])}),e.jsx("span",{style:{fontWeight:600},children:v.por}),e.jsx("span",{style:{color:_e.inkMid},children:v.nota})]},v.id)}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:4},children:[e.jsx("input",{id:`seg-${l.id}`,placeholder:"Aadir nota de seguimiento...",style:{...S,flex:1,fontSize:10}}),e.jsxs(sn,{sm:!0,v:"sec",on:()=>{const v=document.getElementById(`seg-${l.id}`);v!=null&&v.value.trim()&&(p(l.id,v.value),v.value="")},children:[e.jsx(Pe,{size:9})," Aadir"]})]}),l.estado==="cerrado"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase"},children:"Resolucin"}),e.jsx("textarea",{value:l.resolucion||"",onChange:v=>x(l.id,"resolucion",v.target.value),rows:2,placeholder:"Descripcin de la solucin aplicada...",style:{...S,width:"100%",resize:"vertical",background:_e.greenBg}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:e.jsx("button",{onClick:()=>n(v=>v.filter(A=>A.id!==l.id)),style:{background:"none",border:"none",color:_e.red,fontSize:10,cursor:"pointer"},children:" Eliminar ticket"})})]})]},l.id)}),o.length===0&&e.jsx(Mi,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:_e.inkLight},children:"Sin tickets. Crea el primero."})})]}),t==="garantias"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Control de garantas"}),e.jsxs(sn,{sm:!0,on:()=>r(l=>[...l,{id:qn(),proyecto:"",cliente:"",concepto:"",inicio:xs(),vencimiento:(()=>{const f=new Date;return f.setFullYear(f.getFullYear()+1),f.toISOString().split("T")[0]})(),estado:"vigente"}]),children:[e.jsx(Pe,{size:10})," Nueva garanta"]})]}),e.jsx(Mi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:_e.surfaceAlt},children:["Proyecto","Cliente","Concepto","Inicio","Vencimiento","Estado",""].map(l=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${_e.border}`},children:l},l))})}),e.jsxs("tbody",{children:[a.map(l=>{const f=new Date(l.vencimiento)>new Date;return e.jsxs("tr",{style:{borderBottom:`1px solid ${_e.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.proyecto||"",onChange:y=>r(h=>h.map(v=>v.id===l.id?{...v,proyecto:y.target.value}:v)),placeholder:"Proyecto",style:{border:"none",background:"transparent",fontSize:11,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.cliente||"",onChange:y=>r(h=>h.map(v=>v.id===l.id?{...v,cliente:y.target.value}:v)),placeholder:"Cliente",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.concepto||"",onChange:y=>r(h=>h.map(v=>v.id===l.id?{...v,concepto:y.target.value}:v)),placeholder:"Concepto",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.inicio,onChange:y=>r(h=>h.map(v=>v.id===l.id?{...v,inicio:y.target.value}:v)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.vencimiento,onChange:y=>r(h=>h.map(v=>v.id===l.id?{...v,vencimiento:y.target.value}:v)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"2px 6px",borderRadius:3,background:f?_e.greenBg:_e.redBg,color:f?_e.green:_e.red},children:f?"Vigente":"Vencida"})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>r(y=>y.filter(h=>h.id!==l.id)),style:{background:"none",border:"none",color:_e.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})})]},l.id)}),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:30,textAlign:"center",color:_e.inkLight},children:"Sin garantas registradas"})})]})]})})]}),t==="visitas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Visitas de postventa"}),e.jsxs(sn,{sm:!0,on:()=>d(l=>[...l,{id:qn(),fecha:xs(),proyecto:"",cliente:"",motivo:"",responsable:"",estado:"programada",observaciones:""}]),children:[e.jsx(Pe,{size:10})," Nueva visita"]})]}),s.sort((l,f)=>f.fecha>l.fecha?1:-1).map(l=>e.jsxs(Mi,{style:{padding:14,marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{type:"date",value:l.fecha,onChange:f=>d(y=>y.map(h=>h.id===l.id?{...h,fecha:f.target.value}:h)),style:{border:`1px solid ${_e.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:l.proyecto||"",onChange:f=>d(y=>y.map(h=>h.id===l.id?{...h,proyecto:f.target.value}:h)),placeholder:"Proyecto",style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:600}}),e.jsx("input",{value:l.cliente||"",onChange:f=>d(y=>y.map(h=>h.id===l.id?{...h,cliente:f.target.value}:h)),placeholder:"Cliente",style:{width:120,...S,fontSize:10}}),e.jsx("input",{value:l.responsable||"",onChange:f=>d(y=>y.map(h=>h.id===l.id?{...h,responsable:f.target.value}:h)),placeholder:"Responsable",style:{width:100,...S,fontSize:10}}),e.jsx("select",{value:l.estado,onChange:f=>d(y=>y.map(h=>h.id===l.id?{...h,estado:f.target.value}:h)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${_e.border}`,borderRadius:3,background:l.estado==="realizada"?_e.greenBg:"#fff"},children:["programada","realizada","cancelada"].map(f=>e.jsx("option",{children:f},f))}),e.jsx("button",{onClick:()=>d(f=>f.filter(y=>y.id!==l.id)),style:{background:"none",border:"none",color:_e.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:6},children:[e.jsx("input",{value:l.motivo||"",onChange:f=>d(y=>y.map(h=>h.id===l.id?{...h,motivo:f.target.value}:h)),placeholder:"Motivo de la visita",style:{...S,fontSize:10}}),e.jsx("input",{value:l.observaciones||"",onChange:f=>d(y=>y.map(h=>h.id===l.id?{...h,observaciones:f.target.value}:h)),placeholder:"Observaciones",style:{...S,fontSize:10}})]})]},l.id)),s.length===0&&e.jsx(Mi,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:_e.inkLight},children:"Sin visitas programadas"})})]}),t==="encuestas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Encuestas de satisfaccin"}),e.jsxs(sn,{sm:!0,on:()=>b(l=>[...l,{id:qn(),fecha:xs(),proyecto:"",cliente:"",calificacion:5,comentario:""}]),children:[e.jsx(Pe,{size:10})," Nueva encuesta"]})]}),u.length>0&&e.jsxs(Mi,{style:{padding:16,marginBottom:14,textAlign:"center",background:parseFloat(g)>=4?_e.greenBg:_e.amberBg},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:_e.inkLight,textTransform:"uppercase"},children:"Satisfaccin promedio"}),e.jsxs("div",{style:{fontSize:36,fontWeight:800,color:parseFloat(g)>=4?_e.green:_e.amber},children:["".repeat(Math.round(parseFloat(g)||0))," ",g,"/5"]}),e.jsxs("div",{style:{fontSize:11,color:_e.inkMid},children:[u.length," encuestas realizadas"]})]}),u.sort((l,f)=>f.fecha>l.fecha?1:-1).map(l=>e.jsxs(Mi,{style:{padding:14,marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"date",value:l.fecha,onChange:f=>b(y=>y.map(h=>h.id===l.id?{...h,fecha:f.target.value}:h)),style:{border:`1px solid ${_e.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:l.proyecto||"",onChange:f=>b(y=>y.map(h=>h.id===l.id?{...h,proyecto:f.target.value}:h)),placeholder:"Proyecto",style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:600}}),e.jsx("input",{value:l.cliente||"",onChange:f=>b(y=>y.map(h=>h.id===l.id?{...h,cliente:f.target.value}:h)),placeholder:"Cliente",style:{width:120,...S,fontSize:10}}),e.jsx("div",{style:{display:"flex",gap:2},children:[1,2,3,4,5].map(f=>e.jsx("button",{onClick:()=>b(y=>y.map(h=>h.id===l.id?{...h,calificacion:f}:h)),style:{background:"none",border:"none",fontSize:18,cursor:"pointer",opacity:f<=l.calificacion?1:.2},children:""},f))}),e.jsx("button",{onClick:()=>b(f=>f.filter(y=>y.id!==l.id)),style:{background:"none",border:"none",color:_e.red,cursor:"pointer"},children:e.jsx(qe,{size:11})})]}),e.jsx("input",{value:l.comentario||"",onChange:f=>b(y=>y.map(h=>h.id===l.id?{...h,comentario:f.target.value}:h)),placeholder:"Comentarios del cliente...",style:{...S,width:"100%",marginTop:6,fontSize:10}})]},l.id)),u.length===0&&e.jsx(Mi,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:_e.inkLight},children:"Sin encuestas. Crea la primera."})})]})]})})]})]})]})}const Qx=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),ke={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},ko=()=>Math.random().toString(36).slice(2,10),Zt=()=>new Date().toISOString().split("T")[0],St=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),bi=({children:t,style:i,...o})=>e.jsx("div",{style:{background:ke.surface,border:`1px solid ${ke.border}`,borderRadius:8,padding:16,boxShadow:ke.shadow,...i},...o,children:t}),It=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${ke.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?ke.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),ut=({lbl:t,val:i,on:o,ph:n,type:a,style:r,...s})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),e.jsx("input",{type:a||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${ke.border}`,borderRadius:4,fontSize:11,background:"#fff"},...s})]}),No=({t,s:i})=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700},children:t}),i&&e.jsx("p",{style:{margin:0,fontSize:10,color:ke.inkMid},children:i})]}),Cn=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),Li={border:`1px solid ${ke.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},fd=[{id:"dashboard",lbl:" Dashboard",icon:Hi},{id:"caja",lbl:" Caja Chica",icon:mr},{id:"tarjeta",lbl:" Legalizaciones",icon:Gc},{id:"viaticos",lbl:" Viticos",icon:zo},{id:"flujo",lbl:" Flujo Empresa",icon:Hi},{id:"cxc",lbl:" CxC / CxP",icon:At}];function Zx({data:t,save:i}){var v;const o=t.adm_cajas||[],n=A=>i("adm_cajas",typeof A=="function"?A(o):A),[a,r]=F.useState(((v=o[0])==null?void 0:v.id)||null),[s,d]=F.useState(!1),[u,b]=F.useState(!1),[j,w]=F.useState({nombre:"",fondoInicial:0,responsable:""}),[S,m]=F.useState({fecha:Zt(),tipo:"salida",concepto:"",monto:0,responsable:"",soporte:"",proyecto:""}),x=o.find(A=>A.id===a),p=(x==null?void 0:x.movimientos)||[],c=((x==null?void 0:x.fondoInicial)||0)+p.reduce((A,z)=>A+(z.tipo==="entrada"?z.monto:-z.monto),0),g=()=>{const A={id:ko(),...j,fondoInicial:parseFloat(j.fondoInicial)||0,movimientos:[],estado:"abierta",fechaCreacion:Zt()};n([...o,A]),r(A.id),w({nombre:"",fondoInicial:0,responsable:""}),d(!1)},l=()=>{const A={id:ko(),...S,monto:parseFloat(S.monto)||0};n(o.map(z=>z.id===a?{...z,movimientos:[...z.movimientos,A]}:z)),m({fecha:Zt(),tipo:"salida",concepto:"",monto:0,responsable:"",soporte:"",proyecto:""}),b(!1)},f=A=>n(o.map(z=>z.id===a?{...z,movimientos:z.movimientos.filter(k=>k.id!==A)}:z)),y=()=>n(o.map(A=>A.id===a?{...A,estado:"cerrada",fechaCierre:Zt()}:A)),h=()=>{const A=p.filter(k=>k.tipo==="salida").reduce((k,T)=>k+T.monto,0)-p.filter(k=>k.tipo==="entrada").reduce((k,T)=>k+T.monto,0);if(A<=0)return;const z={id:ko(),fecha:Zt(),tipo:"entrada",concepto:"Reposicin de caja chica",monto:A,responsable:"Admin",soporte:"",proyecto:""};n(o.map(k=>k.id===a?{...k,movimientos:[...k.movimientos,z]}:k))};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:ke.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Caja chica"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Control de fondos menores"})]}),e.jsxs(It,{on:()=>d(!0),children:[e.jsx(Pe,{size:11})," Nueva caja"]})]}),o.length===0?e.jsx(bi,{style:{textAlign:"center",padding:40,color:ke.inkLight},children:'Sin cajas creadas. Pulsa "+ Nueva caja" para empezar.'}):e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx("div",{style:{width:200,flexShrink:0},children:o.map(A=>{const z=(A.fondoInicial||0)+(A.movimientos||[]).reduce((k,T)=>k+(T.tipo==="entrada"?T.monto:-T.monto),0);return e.jsxs(bi,{onClick:()=>r(A.id),style:{padding:"10px 12px",marginBottom:6,cursor:"pointer",border:a===A.id?`2px solid ${ke.green}`:`1px solid ${ke.border}`},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:A.nombre}),e.jsx("div",{style:{fontSize:9,color:ke.inkMid},children:A.responsable}),e.jsxs("div",{style:{fontSize:14,fontWeight:800,fontFamily:"'DM Mono',monospace",color:z>=0?ke.green:ke.red,marginTop:4},children:["$",St(z)]}),e.jsx(Cn,{color:A.estado==="abierta"?ke.green:ke.red,children:A.estado==="abierta"?"Abierta":"Cerrada"})]},A.id)})}),x&&e.jsxs(bi,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#EDEBE7",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:x.nombre}),e.jsxs("div",{style:{fontSize:9,color:ke.inkMid},children:["Fondo: $",St(x.fondoInicial),"  Responsable: ",x.responsable]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Saldo actual"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:c>=0?ke.green:ke.red},children:["$",St(c)]})]})]}),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${ke.border}`,display:"flex",gap:6},children:[x.estado==="abierta"&&e.jsxs(e.Fragment,{children:[e.jsxs(It,{on:()=>b(!0),children:[e.jsx(Pe,{size:10})," Movimiento"]}),e.jsx(It,{v:"sec",on:h,children:" Reponer"}),e.jsx(It,{v:"sec",on:y,children:" Cerrar caja"})]}),x.estado==="cerrada"&&e.jsxs(Cn,{color:ke.red,children:["Caja cerrada el ",x.fechaCierre]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Tipo","Concepto","Proyecto","Responsable","Soporte","Monto",""].map(A=>e.jsx("th",{style:{padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`1px solid ${ke.border}`,textAlign:A==="Monto"?"right":"left"},children:A},A))})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:20,textAlign:"center",color:ke.inkLight,fontSize:11},children:"Sin movimientos"})}):p.map((A,z)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ke.border}`,background:z%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"5px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:A.fecha}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx(Cn,{color:A.tipo==="entrada"?ke.green:ke.red,children:A.tipo==="entrada"?" Entrada":" Salida"})}),e.jsx("td",{style:{padding:"5px 8px",fontSize:10,fontWeight:500},children:A.concepto}),e.jsx("td",{style:{padding:"5px 8px",fontSize:9,color:ke.inkMid},children:A.proyecto||""}),e.jsx("td",{style:{padding:"5px 8px",fontSize:9,color:ke.inkMid},children:A.responsable}),e.jsx("td",{style:{padding:"5px 8px",fontSize:8,color:ke.blue},children:A.soporte||""}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:A.tipo==="entrada"?ke.green:ke.red},children:[A.tipo==="entrada"?"+":"","$",St(A.monto)]}),e.jsx("td",{style:{padding:"3px 4px"},children:x.estado==="abierta"&&e.jsx("button",{onClick:()=>f(A.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},A.id))})]})})]})]}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>d(!1),children:e.jsxs("div",{onClick:A=>A.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:400,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(No,{t:"Nueva caja chica",s:"Fondo rotatorio para gastos menores"}),e.jsx(ut,{lbl:"Nombre",val:j.nombre,on:A=>w({...j,nombre:A.target.value}),ph:"Caja obra Chic"}),e.jsx(ut,{lbl:"Fondo inicial",val:j.fondoInicial,on:A=>w({...j,fondoInicial:A.target.value}),type:"number",ph:"500000"}),e.jsx(ut,{lbl:"Responsable",val:j.responsable,on:A=>w({...j,responsable:A.target.value}),ph:"Almacenista"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(It,{on:g,style:{flex:1},children:[e.jsx(ft,{size:11})," Crear"]}),e.jsx(It,{v:"sec",on:()=>d(!1),style:{flex:1},children:"Cancelar"})]})]})}),u&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:A=>A.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(No,{t:"Nuevo movimiento",s:x==null?void 0:x.nombre}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsx(ut,{lbl:"Fecha",val:S.fecha,on:A=>m({...S,fecha:A.target.value}),type:"date",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Tipo"}),e.jsxs("select",{value:S.tipo,onChange:A=>m({...S,tipo:A.target.value}),style:{...Li,width:"100%"},children:[e.jsx("option",{value:"salida",children:" Salida"}),e.jsx("option",{value:"entrada",children:" Entrada"})]})]})]}),e.jsx(ut,{lbl:"Concepto",val:S.concepto,on:A=>m({...S,concepto:A.target.value}),ph:"Taxi obra, material menor..."}),e.jsx(ut,{lbl:"Monto",val:S.monto,on:A=>m({...S,monto:A.target.value}),type:"number",ph:"25000"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Proyecto",val:S.proyecto,on:A=>m({...S,proyecto:A.target.value}),ph:"Chic 94",style:{flex:1}}),e.jsx(ut,{lbl:"Responsable",val:S.responsable,on:A=>m({...S,responsable:A.target.value}),ph:"Quien gasta",style:{flex:1}})]}),e.jsx(ut,{lbl:"Soporte / factura",val:S.soporte,on:A=>m({...S,soporte:A.target.value}),ph:"Ref. factura o soporte"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(It,{on:l,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar"]}),e.jsx(It,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function em({data:t,save:i}){const o=t.adm_tarjeta||[],n=g=>i("adm_tarjeta",typeof g=="function"?g(o):g),[a,r]=F.useState(!1),[s,d]=F.useState("todos"),[u,b]=F.useState({fecha:Zt(),concepto:"",monto:0,tarjeta:"Corp. Visa",proyecto:"",centroCosto:"",factura:"",correoRef:"",estado:"pendiente"}),j=()=>{n([...o,{id:ko(),...u,monto:parseFloat(u.monto)||0}]),b({fecha:Zt(),concepto:"",monto:0,tarjeta:"Corp. Visa",proyecto:"",centroCosto:"",factura:"",correoRef:"",estado:"pendiente"}),r(!1)},w=(g,l,f)=>n(o.map(y=>y.id===g?{...y,[l]:f}:y)),S=g=>n(o.filter(l=>l.id!==g)),m=s==="todos"?o:o.filter(g=>g.estado===s),x=o.filter(g=>g.estado==="pendiente"),p=x.reduce((g,l)=>g+l.monto,0),c={pendiente:{lbl:"Pendiente",color:ke.amber},legalizado:{lbl:"Legalizado",color:ke.blue},aprobado:{lbl:"Aprobado",color:ke.green},rechazado:{lbl:"Rechazado",color:ke.red}};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:ke.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Tarjeta corporativa"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Legalizaciones  ",x.length," pendientes  $",St(p)]})]}),e.jsxs(It,{on:()=>r(!0),children:[e.jsx(Pe,{size:11})," Nuevo movimiento"]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:[["todos","Todos"],["pendiente","Pendientes"],["legalizado","Legalizados"],["aprobado","Aprobados"],["rechazado","Rechazados"]].map(([g,l],f,y)=>e.jsxs("button",{onClick:()=>d(g),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${ke.border}`,borderLeft:f>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:f===0?"5px 0 0 5px":f===y.length-1?"0 5px 5px 0":"0",background:s===g?"#111":"#fff",color:s===g?"#fff":ke.inkMid},children:[l," ",g!=="todos"&&e.jsxs("span",{style:{marginLeft:3,fontSize:8},children:["(",o.filter(h=>g==="todos"||h.estado===g).length,")"]})]},g))}),e.jsx(bi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Tarjeta","Concepto","Proyecto","Centro costo","Factura","Correo ref.","Monto","Estado",""].map(g=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${ke.border}`,textAlign:g==="Monto"?"right":"left"},children:g},g))})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:24,textAlign:"center",color:ke.inkLight,fontSize:11},children:"Sin movimientos"})}):m.map((g,l)=>{var f,y;return e.jsxs("tr",{style:{borderBottom:`1px solid ${ke.border}`,background:l%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:g.fecha}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9},children:g.tarjeta}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:500},children:g.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ke.inkMid},children:g.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ke.inkMid},children:g.centroCosto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:ke.blue},children:g.factura||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:ke.inkMid},children:g.correoRef||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11},children:["$",St(g.monto)]}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("select",{value:g.estado,onChange:h=>w(g.id,"estado",h.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:((f=c[g.estado])==null?void 0:f.color)+"22",color:(y=c[g.estado])==null?void 0:y.color},children:Object.entries(c).map(([h,v])=>e.jsx("option",{value:h,children:v.lbl},h))})}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>S(g.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},g.id)})})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:g=>g.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(No,{t:"Nuevo movimiento tarjeta",s:"Registrar gasto para legalizar"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Fecha",val:u.fecha,on:g=>b({...u,fecha:g.target.value}),type:"date",style:{flex:1}}),e.jsx(ut,{lbl:"Tarjeta",val:u.tarjeta,on:g=>b({...u,tarjeta:g.target.value}),ph:"Corp. Visa",style:{flex:1}})]}),e.jsx(ut,{lbl:"Concepto",val:u.concepto,on:g=>b({...u,concepto:g.target.value}),ph:"Almuerzo equipo, materiales..."}),e.jsx(ut,{lbl:"Monto",val:u.monto,on:g=>b({...u,monto:g.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Proyecto",val:u.proyecto,on:g=>b({...u,proyecto:g.target.value}),ph:"Opcional",style:{flex:1}}),e.jsx(ut,{lbl:"Centro de costo",val:u.centroCosto,on:g=>b({...u,centroCosto:g.target.value}),ph:"Admin, Obra...",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Ref. factura",val:u.factura,on:g=>b({...u,factura:g.target.value}),ph:"FV-001234",style:{flex:1}}),e.jsx(ut,{lbl:"Correo referencia",val:u.correoRef,on:g=>b({...u,correoRef:g.target.value}),ph:"Asunto email",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(It,{on:j,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar"]}),e.jsx(It,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function tm({data:t,save:i}){const o=t.adm_viaticos||[],n=z=>i("adm_viaticos",typeof z=="function"?z(o):z),[a,r]=F.useState(!1),[s,d]=F.useState(null),[u,b]=F.useState(!1),[j,w]=F.useState({solicitante:"",destino:"",dias:1,concepto:"",fecha:Zt(),fechaRegreso:""}),[S,m]=F.useState({fecha:Zt(),concepto:"",monto:0,soporte:""}),x=[{id:"vuelo_ida",lbl:" Vuelo ida",icon:""},{id:"vuelo_vuelta",lbl:" Vuelo vuelta",icon:""},{id:"hotel",lbl:" Hotel",icon:""},{id:"transporte",lbl:" Transporte terrestre",icon:""},{id:"alimentacion",lbl:" Alimentacin",icon:""},{id:"otros",lbl:" Otros",icon:""}],p=o.find(z=>z.id===s),c={solicitado:{lbl:"Solicitado",color:ke.amber},aprobado:{lbl:"Aprobado",color:ke.blue},entregado:{lbl:"Anticipo entregado",color:"#5B3A8C"},legalizado:{lbl:"Legalizado",color:ke.green},rechazado:{lbl:"Rechazado",color:ke.red}},g=z=>{const k=z.itemsViaje||{},T=x.reduce((K,oe)=>{var te;return K+(parseFloat((te=k[oe.id])==null?void 0:te.estimado)||0)},0),C=x.reduce((K,oe)=>{var te;return K+(parseFloat((te=k[oe.id])==null?void 0:te.real)||0)},0),D=(z.gastos||[]).reduce((K,oe)=>K+oe.monto,0);return{estimado:T,real:C,gastosExtra:D,totalReal:C+D}},l=()=>{const z={};x.forEach(T=>{z[T.id]={estimado:0,real:0,detalle:""}});const k={id:ko(),...j,dias:parseInt(j.dias)||1,estado:"solicitado",gastos:[],anticipoEntregado:0,itemsViaje:z};n([...o,k]),d(k.id),w({solicitante:"",destino:"",dias:1,concepto:"",fecha:Zt(),fechaRegreso:""}),r(!1)},f=(z,k,T)=>n(o.map(C=>C.id===z?{...C,[k]:T}:C)),y=(z,k,T,C)=>{n(o.map(D=>{if(D.id!==z)return D;const K={...D.itemsViaje||{}};return K[k]={...K[k]||{estimado:0,real:0,detalle:""},[T]:C},{...D,itemsViaje:K}}))},h=()=>{const z={id:ko(),...S,monto:parseFloat(S.monto)||0};n(o.map(k=>k.id===s?{...k,gastos:[...k.gastos,z]}:k)),m({fecha:Zt(),concepto:"",monto:0,soporte:""}),b(!1)},v=z=>n(o.map(k=>k.id===s?{...k,gastos:k.gastos.filter(T=>T.id!==z)}:k)),A=z=>{n(o.filter(k=>k.id!==z)),s===z&&d(null)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:ke.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Viticos"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Solicitudes, anticipos y legalizaciones"})]}),e.jsxs(It,{on:()=>r(!0),children:[e.jsx(Pe,{size:11})," Nueva solicitud"]})]}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx("div",{style:{width:280,flexShrink:0},children:o.length===0?e.jsx(bi,{style:{textAlign:"center",padding:20,color:ke.inkLight,fontSize:11},children:"Sin solicitudes"}):o.map(z=>{var C,D;const k=g(z),T=(z.anticipoEntregado||0)-k.totalReal;return e.jsxs(bi,{onClick:()=>d(z.id),style:{padding:"10px 12px",marginBottom:6,cursor:"pointer",border:s===z.id?`2px solid ${ke.green}`:`1px solid ${ke.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:z.solicitante}),e.jsx(Cn,{color:((C=c[z.estado])==null?void 0:C.color)||ke.amber,children:((D=c[z.estado])==null?void 0:D.lbl)||z.estado})]}),e.jsxs("div",{style:{fontSize:9,color:ke.inkMid},children:[z.destino,"  ",z.dias," das  ",z.fecha]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:4,fontSize:8},children:[e.jsxs("span",{children:["Est: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",St(k.estimado)]})]}),e.jsxs("span",{children:["Real: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",St(k.totalReal)]})]}),e.jsxs("span",{style:{color:T>=0?ke.green:ke.red},children:[T>=0?"Sobra":"Debe",": ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",St(Math.abs(T))]})]})]})]},z.id)})}),p?e.jsxs(bi,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#EDEBE7",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700},children:[p.solicitante,"  ",p.destino]}),e.jsxs("div",{style:{fontSize:9,color:ke.inkMid},children:[p.concepto,"  ",p.dias," das  ",p.fecha,p.fechaRegreso?`  ${p.fechaRegreso}`:""]})]}),e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[e.jsx("select",{value:p.estado,onChange:z=>f(p.id,"estado",z.target.value),style:{...Li,fontSize:9,fontWeight:600},children:Object.entries(c).map(([z,k])=>e.jsx("option",{value:z,children:k.lbl},z))}),e.jsx("button",{onClick:()=>A(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},title:"Eliminar",children:e.jsx(qe,{size:12})})]})]}),(()=>{const z=g(p),k=(p.anticipoEntregado||0)-z.totalReal;return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6,padding:"10px 16px",borderBottom:`1px solid ${ke.border}`},children:[["Estimado",St(z.estimado),ke.ink],["Anticipo",St(p.anticipoEntregado||0),ke.blue],["Real tems",St(z.real),"#5B3A8C"],["Otros gastos",St(z.gastosExtra),ke.red],[k>=0?"Saldo a favor":"Saldo a deber",St(Math.abs(k)),k>=0?ke.green:ke.red]].map(([T,C,D])=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:T}),e.jsxs("div",{style:{fontSize:13,fontWeight:800,fontFamily:"'DM Mono',monospace",color:D},children:["$",C]})]},T))})})(),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${ke.border}`,display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:9,fontWeight:600,color:ke.inkMid},children:"Anticipo entregado:"}),e.jsx("input",{type:"number",value:p.anticipoEntregado||"",placeholder:"0",onChange:z=>f(p.id,"anticipoEntregado",parseFloat(z.target.value)||0),style:{...Li,width:130,fontFamily:"'DM Mono',monospace",fontWeight:700}})]}),e.jsxs("div",{style:{padding:"10px 16px",borderBottom:`1px solid ${ke.border}`},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:8},children:"Desglose del viaje  Estimado vs Real"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${ke.border}`,width:"30%"},children:"TEM"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${ke.border}`,width:"25%"},children:"DETALLE"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:ke.blue,textAlign:"right",borderBottom:`1px solid ${ke.border}`,width:"18%"},children:"ESTIMADO"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#5B3A8C",textAlign:"right",borderBottom:`1px solid ${ke.border}`,width:"18%"},children:"REAL"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right",borderBottom:`1px solid ${ke.border}`,width:"9%"},children:"DIF."})]})}),e.jsxs("tbody",{children:[x.map((z,k)=>{const T=(p.itemsViaje||{})[z.id]||{estimado:0,real:0,detalle:""},C=parseFloat(T.estimado)||0,K=(parseFloat(T.real)||0)-C;return e.jsxs("tr",{style:{borderBottom:`1px solid ${ke.border}`,background:k%2?"#FFFFFF":"#fff"},children:[e.jsxs("td",{style:{padding:"5px 8px",fontSize:10,fontWeight:600},children:[z.icon," ",z.lbl.replace(/^[^\s]+ /,"")]}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"text",value:T.detalle||"",placeholder:"Aerolnea, hotel...",onChange:oe=>y(p.id,z.id,"detalle",oe.target.value),style:{...Li,width:"100%",fontSize:9,padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"number",value:T.estimado||"",placeholder:"0",onChange:oe=>y(p.id,z.id,"estimado",oe.target.value),style:{...Li,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:ke.blue,padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"number",value:T.real||"",placeholder:"0",onChange:oe=>y(p.id,z.id,"real",oe.target.value),style:{...Li,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:700,color:K===0?ke.inkLight:K>0?ke.red:ke.green},children:K===0?"":K>0?`+${St(K)}`:`${St(Math.abs(K))}`})]},z.id)}),(()=>{const z=g(p),k=z.real-z.estimado;return e.jsxs("tr",{style:{borderTop:`2px solid ${ke.ink}`,background:"#EDEBE7"},children:[e.jsx("td",{colSpan:2,style:{padding:"5px 8px",fontSize:10,fontWeight:800},children:"TOTAL TEMS"}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:ke.blue},children:["$",St(z.estimado)]}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:"#5B3A8C"},children:["$",St(z.real)]}),e.jsx("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:700,color:k===0?ke.inkLight:k>0?ke.red:ke.green},children:k===0?"":k>0?`+${St(k)}`:`${St(Math.abs(k))}`})]})})()]})]})]}),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${ke.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Otros gastos (no previstos)"}),e.jsxs(It,{on:()=>b(!0),style:{padding:"4px 10px",fontSize:9},children:[e.jsx(Pe,{size:9})," Gasto"]})]}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Concepto","Soporte","Monto",""].map(z=>e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`1px solid ${ke.border}`,textAlign:z==="Monto"?"right":"left"},children:z},z))})}),e.jsx("tbody",{children:(p.gastos||[]).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{padding:12,textAlign:"center",color:ke.inkLight,fontSize:9},children:"Sin gastos adicionales"})}):(p.gastos||[]).map((z,k)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ke.border}`,background:k%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:z.fecha}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10},children:z.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:ke.blue},children:z.soporte||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:ke.red},children:["$",St(z.monto)]}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>v(z.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},z.id))})]})]}):e.jsx(bi,{style:{flex:1,textAlign:"center",padding:40,color:ke.inkLight},children:"Selecciona una solicitud"})]}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:z=>z.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:440,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(No,{t:"Nueva solicitud de viticos",s:"Se crear con desglose de tems para estimar costos"}),e.jsx(ut,{lbl:"Solicitante",val:j.solicitante,on:z=>w({...j,solicitante:z.target.value}),ph:"Nombre completo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Destino",val:j.destino,on:z=>w({...j,destino:z.target.value}),ph:"Ciudad / lugar",style:{flex:1}}),e.jsx(ut,{lbl:"Das",val:j.dias,on:z=>w({...j,dias:z.target.value}),type:"number",style:{flex:"0 0 65px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Fecha ida",val:j.fecha,on:z=>w({...j,fecha:z.target.value}),type:"date",style:{flex:1}}),e.jsx(ut,{lbl:"Fecha regreso",val:j.fechaRegreso,on:z=>w({...j,fechaRegreso:z.target.value}),type:"date",style:{flex:1}})]}),e.jsx(ut,{lbl:"Concepto / motivo",val:j.concepto,on:z=>w({...j,concepto:z.target.value}),ph:"Visita obra, capacitacin, reunin cliente..."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(It,{on:l,style:{flex:1},children:[e.jsx(ft,{size:11})," Crear solicitud"]}),e.jsx(It,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})}),u&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:z=>z.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:380,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(No,{t:"Gasto adicional",s:(p==null?void 0:p.solicitante)+"  "+(p==null?void 0:p.destino)}),e.jsx(ut,{lbl:"Fecha",val:S.fecha,on:z=>m({...S,fecha:z.target.value}),type:"date"}),e.jsx(ut,{lbl:"Concepto",val:S.concepto,on:z=>m({...S,concepto:z.target.value}),ph:"Imprevisto, taxi extra..."}),e.jsx(ut,{lbl:"Monto",val:S.monto,on:z=>m({...S,monto:z.target.value}),type:"number"}),e.jsx(ut,{lbl:"Soporte",val:S.soporte,on:z=>m({...S,soporte:z.target.value}),ph:"Ref. factura"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(It,{on:h,style:{flex:1},children:[e.jsx(ft,{size:11})," Aadir"]}),e.jsx(It,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function im({data:t,save:i}){const o=t.adm_flujo||[],n=h=>i("adm_flujo",typeof h=="function"?h(o):h),[a,r]=F.useState(!1),[s,d]=F.useState(()=>{const h=new Date;return`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}`}),[u,b]=F.useState({fecha:Zt(),tipo:"ingreso",categoria:"",concepto:"",monto:0,proyecto:"",factura:"",estado:"realizado"}),j=["Cobro proyecto","Anticipo cliente","Reembolso","Otro ingreso"],w=["Nmina","Proveedores","Arriendo","Servicios","Impuestos","Seguros","Transporte","Materiales","Otro egreso"],S=()=>{n([...o,{id:ko(),...u,monto:parseFloat(u.monto)||0}]),b({fecha:Zt(),tipo:"ingreso",categoria:"",concepto:"",monto:0,proyecto:"",factura:"",estado:"realizado"}),r(!1)},m=h=>n(o.filter(v=>v.id!==h)),x=o.filter(h=>{var v;return(v=h.fecha)==null?void 0:v.startsWith(s)}),p=x.filter(h=>h.tipo==="ingreso").reduce((h,v)=>h+v.monto,0),c=x.filter(h=>h.tipo==="egreso").reduce((h,v)=>h+v.monto,0),l=o.filter(h=>h.fecha<=s+"-31"&&h.estado==="realizado").reduce((h,v)=>h+(v.tipo==="ingreso"?v.monto:-v.monto),0),f=x.filter(h=>h.estado==="proyectado");f.filter(h=>h.tipo==="ingreso").reduce((h,v)=>h+v.monto,0),f.filter(h=>h.tipo==="egreso").reduce((h,v)=>h+v.monto,0);const y=[...new Set(o.map(h=>{var v;return(v=h.fecha)==null?void 0:v.slice(0,7)}).filter(Boolean))].sort();return y.includes(s)||y.push(s),y.sort(),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:ke.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Flujo de caja empresa"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Ingresos, egresos y proyeccin"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:s,onChange:h=>d(h.target.value),style:{...Li,fontWeight:600},children:y.map(h=>e.jsx("option",{value:h,children:h},h))}),e.jsxs(It,{on:()=>r(!0),children:[e.jsx(Pe,{size:11})," Movimiento"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[["Ingresos mes",St(p),ke.green,""],["Egresos mes",St(c),ke.red,""],["Neto mes",St(p-c),p-c>=0?ke.green:ke.red,""],["Saldo acumulado",St(l),l>=0?ke.green:ke.red,""]].map(([h,v,A,z])=>e.jsxs(bi,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:[z," ",h]}),e.jsxs("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:A,marginTop:2},children:["$",v]})]},h))}),l<0&&e.jsxs("div",{style:{background:ke.redBg,border:`1px solid ${ke.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(si,{size:14,color:ke.red}),e.jsx("div",{style:{fontSize:10,color:ke.red,fontWeight:600},children:" Saldo acumulado negativo. Revisa cobros pendientes o reduce egresos."})]}),e.jsx(bi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Tipo","Categora","Concepto","Proyecto","Factura","Estado","Monto",""].map(h=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${ke.border}`,textAlign:h==="Monto"?"right":"left"},children:h},h))})}),e.jsx("tbody",{children:x.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:ke.inkLight,fontSize:11},children:["Sin movimientos en ",s]})}):x.sort((h,v)=>h.fecha.localeCompare(v.fecha)).map((h,v)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ke.border}`,background:v%2?"#FFFFFF":"#fff",opacity:h.estado==="proyectado"?.6:1},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:h.fecha}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx(Cn,{color:h.tipo==="ingreso"?ke.green:ke.red,children:h.tipo==="ingreso"?" Ingreso":" Egreso"})}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ke.inkMid},children:h.categoria||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:500},children:h.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ke.inkMid},children:h.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:ke.blue},children:h.factura||""}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx(Cn,{color:h.estado==="realizado"?ke.green:ke.amber,children:h.estado==="realizado"?"Realizado":"Proyectado"})}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:h.tipo==="ingreso"?ke.green:ke.red},children:[h.tipo==="ingreso"?"+":"","$",St(h.monto)]}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>m(h.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},h.id))})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:h=>h.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(No,{t:"Nuevo movimiento",s:"Ingreso o egreso de la empresa"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Fecha",val:u.fecha,on:h=>b({...u,fecha:h.target.value}),type:"date",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Tipo"}),e.jsxs("select",{value:u.tipo,onChange:h=>b({...u,tipo:h.target.value,categoria:""}),style:{...Li,width:"100%"},children:[e.jsx("option",{value:"ingreso",children:" Ingreso"}),e.jsx("option",{value:"egreso",children:" Egreso"})]})]}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Estado"}),e.jsxs("select",{value:u.estado,onChange:h=>b({...u,estado:h.target.value}),style:{...Li,width:"100%"},children:[e.jsx("option",{value:"realizado",children:"Realizado"}),e.jsx("option",{value:"proyectado",children:"Proyectado"})]})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Categora"}),e.jsxs("select",{value:u.categoria,onChange:h=>b({...u,categoria:h.target.value}),style:{...Li,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),(u.tipo==="ingreso"?j:w).map(h=>e.jsx("option",{children:h},h))]})]}),e.jsx(ut,{lbl:"Concepto",val:u.concepto,on:h=>b({...u,concepto:h.target.value}),ph:"Descripcin"}),e.jsx(ut,{lbl:"Monto",val:u.monto,on:h=>b({...u,monto:h.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Proyecto",val:u.proyecto,on:h=>b({...u,proyecto:h.target.value}),ph:"Opcional",style:{flex:1}}),e.jsx(ut,{lbl:"Factura",val:u.factura,on:h=>b({...u,factura:h.target.value}),ph:"FV-001234",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(It,{on:S,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar"]}),e.jsx(It,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function om({data:t,save:i}){const o=t.adm_cuentas||[],n=l=>i("adm_cuentas",typeof l=="function"?l(o):l),[a,r]=F.useState("cobrar"),[s,d]=F.useState(!1),[u,b]=F.useState({tipo:"cobrar",tercero:"",concepto:"",monto:0,fechaEmision:Zt(),fechaVence:"",factura:"",proyecto:"",estado:"vigente"}),j=o.filter(l=>l.tipo===a),w=j.filter(l=>l.estado==="vigente").reduce((l,f)=>l+f.monto,0),S=j.filter(l=>l.estado==="vencida").reduce((l,f)=>l+f.monto,0),m=j.filter(l=>l.estado==="pagada").reduce((l,f)=>l+f.monto,0),x=()=>{n([...o,{id:ko(),...u,tipo:a,monto:parseFloat(u.monto)||0}]),b({tipo:a,tercero:"",concepto:"",monto:0,fechaEmision:Zt(),fechaVence:"",factura:"",proyecto:"",estado:"vigente"}),d(!1)},p=(l,f,y)=>n(o.map(h=>h.id===l?{...h,[f]:y}:h)),c=l=>n(o.filter(f=>f.id!==l));F.useEffect(()=>{const l=Zt(),f=o.map(y=>y.estado==="vigente"&&y.fechaVence&&y.fechaVence<l?{...y,estado:"vencida"}:y);JSON.stringify(f)!==JSON.stringify(o)&&n(f)},[]);const g={vigente:{lbl:"Vigente",color:ke.blue},vencida:{lbl:"Vencida",color:ke.red},pagada:{lbl:a==="cobrar"?"Cobrada":"Pagada",color:ke.green},parcial:{lbl:"Parcial",color:ke.amber}};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{margin:0,fontSize:10,color:ke.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:["Cuentas por ",a==="cobrar"?"cobrar":"pagar"]}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:a==="cobrar"?"Lo que nos deben":"Lo que debemos"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["cobrar"," Por cobrar"],["pagar"," Por pagar"]].map(([l,f],y)=>e.jsx("button",{onClick:()=>r(l),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${ke.border}`,borderLeft:y>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:y===0?"5px 0 0 5px":"0 5px 5px 0",background:a===l?"#111":"#fff",color:a===l?"#fff":ke.inkMid},children:f},l))}),e.jsxs(It,{on:()=>d(!0),children:[e.jsx(Pe,{size:11})," Nueva cuenta"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12,marginBottom:16},children:[["Vigentes",St(w),ke.blue],["Vencidas",St(S),ke.red],[a==="cobrar"?"Cobradas":"Pagadas",St(m),ke.green]].map(([l,f,y])=>e.jsxs(bi,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:l}),e.jsxs("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y,marginTop:2},children:["$",f]})]},l))}),S>0&&e.jsxs("div",{style:{background:ke.redBg,border:`1px solid ${ke.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(si,{size:14,color:ke.red}),e.jsxs("div",{style:{fontSize:10,color:ke.red,fontWeight:600},children:[j.filter(l=>l.estado==="vencida").length," ",a==="cobrar"?"facturas por cobrar":"facturas por pagar"," vencidas por $",St(S)]})]}),e.jsx(bi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Factura","Tercero","Concepto","Proyecto","Emitida","Vence","Monto","Estado",""].map(l=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${ke.border}`,textAlign:l==="Monto"?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:ke.inkLight,fontSize:11},children:"Sin cuentas registradas"})}):j.sort((l,f)=>(l.fechaVence||"").localeCompare(f.fechaVence||"")).map((l,f)=>{var y,h;return e.jsxs("tr",{style:{borderBottom:`1px solid ${ke.border}`,background:l.estado==="vencida"?"#FAE8E844":f%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l.factura||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:600},children:l.tercero}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10},children:l.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ke.inkMid},children:l.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,fontFamily:"'DM Mono',monospace"},children:l.fechaEmision}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,fontFamily:"'DM Mono',monospace",color:l.estado==="vencida"?ke.red:ke.ink,fontWeight:l.estado==="vencida"?700:400},children:l.fechaVence||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11},children:["$",St(l.monto)]}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("select",{value:l.estado,onChange:v=>p(l.id,"estado",v.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:((y=g[l.estado])==null?void 0:y.color)+"22",color:(h=g[l.estado])==null?void 0:h.color},children:Object.entries(g).map(([v,A])=>e.jsx("option",{value:v,children:A.lbl},v))})}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>c(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},l.id)})})]})}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>d(!1),children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(No,{t:`Nueva cuenta por ${a}`,s:a==="cobrar"?"Factura emitida a cliente":"Factura recibida de proveedor"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Tercero",val:u.tercero,on:l=>b({...u,tercero:l.target.value}),ph:a==="cobrar"?"Cliente":"Proveedor",style:{flex:1}}),e.jsx(ut,{lbl:"Nro. factura",val:u.factura,on:l=>b({...u,factura:l.target.value}),ph:"FV-001234",style:{flex:1}})]}),e.jsx(ut,{lbl:"Concepto",val:u.concepto,on:l=>b({...u,concepto:l.target.value}),ph:"Anticipo 30%, Acta parcial..."}),e.jsx(ut,{lbl:"Monto",val:u.monto,on:l=>b({...u,monto:l.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{lbl:"Fecha emisin",val:u.fechaEmision,on:l=>b({...u,fechaEmision:l.target.value}),type:"date",style:{flex:1}}),e.jsx(ut,{lbl:"Fecha vencimiento",val:u.fechaVence,on:l=>b({...u,fechaVence:l.target.value}),type:"date",style:{flex:1}})]}),e.jsx(ut,{lbl:"Proyecto",val:u.proyecto,on:l=>b({...u,proyecto:l.target.value}),ph:"Opcional"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(It,{on:x,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar"]}),e.jsx(It,{v:"sec",on:()=>d(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function nm(){const t="habitaris_admin",[i,o]=F.useState(()=>{try{return JSON.parse(localStorage.getItem(t))||{}}catch{return{}}}),n=(v,A)=>o(z=>{var T,C;const k={...z,[v]:A};localStorage.setItem(t,JSON.stringify(k));try{(C=(T=window.storage)==null?void 0:T.set)==null||C.call(T,t,JSON.stringify(k))}catch{}return k}),[a,r]=F.useState("dashboard"),s=i.adm_cajas||[],d=i.adm_tarjeta||[],u=i.adm_viaticos||[],b=i.adm_flujo||[],j=i.adm_cuentas||[],w=s.reduce((v,A)=>{const z=A.movimientos||[];return v+(A.fondoInicial||0)+z.reduce((k,T)=>k+(T.tipo==="entrada"?T.monto:-T.monto),0)},0),S=d.filter(v=>v.estado==="pendiente"),m=u.filter(v=>v.estado==="solicitado"||v.estado==="aprobado"),p=new Date().toISOString().split("T")[0].slice(0,7),c=b.filter(v=>{var A;return(A=v.fecha)==null?void 0:A.startsWith(p)}),g=c.filter(v=>v.tipo==="ingreso").reduce((v,A)=>v+A.monto,0),l=c.filter(v=>v.tipo==="egreso").reduce((v,A)=>v+A.monto,0),f=j.filter(v=>v.tipo==="cobrar"&&v.estado==="vencida").reduce((v,A)=>v+A.monto,0),y=j.filter(v=>v.tipo==="pagar"&&v.estado==="vencida").reduce((v,A)=>v+A.monto,0),h=v=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(v||0);return e.jsxs(e.Fragment,{children:[e.jsx(Qx,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Administracin"}),e.jsx("div",{style:{fontSize:10,color:ke.inkMid},children:"Caja chica  Tarjeta  Viticos  Flujo empresa  CxC / CxP"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:fd.map((v,A)=>e.jsx("button",{onClick:()=>r(v.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${ke.border}`,borderLeft:A>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:A===0?"6px 0 0 6px":A===fd.length-1?"0 6px 6px 0":"0",background:a===v.id?"#111":"#fff",color:a===v.id?"#fff":ke.inkMid,borderBottom:a===v.id?"2px solid #fff":`1px solid ${ke.border}`},children:v.lbl},v.id))}),a==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Saldo cajas","$"+h(w),w>=0?"#111111":"#B91C1C"],[" Legaliz. pend.",S.length,S.length>0?"#8C6A00":"#111111"],[" Viticos pend.",m.length,m.length>0?"#8C6A00":"#111111"],[" Flujo neto mes","$"+h(g-l),g-l>=0?"#111111":"#B91C1C"]].map(([v,A,z])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${ke.border}`,borderRadius:8,padding:"14px 16px",boxShadow:ke.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:v}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:z},children:A})]},v))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Ingresos mes","$"+h(g),"#111111"],[" Egresos mes","$"+h(l),"#B91C1C"],[" CxC vencidas","$"+h(f),f>0?"#B91C1C":"#111111"],[" CxP vencidas","$"+h(y),y>0?"#B91C1C":"#111111"]].map(([v,A,z])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${ke.border}`,borderRadius:8,padding:"14px 16px",boxShadow:ke.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:v}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:z},children:A})]},v))}),(f>0||y>0||S.length>0)&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" ",[f>0&&`CxC vencidas $${h(f)}`,y>0&&`CxP vencidas $${h(y)}`,S.length>0&&`${S.length} legalizaciones pendientes`].filter(Boolean).join("  ")]})]}),a==="caja"&&e.jsx(Zx,{data:i,save:n}),a==="tarjeta"&&e.jsx(em,{data:i,save:n}),a==="viaticos"&&e.jsx(tm,{data:i,save:n}),a==="flujo"&&e.jsx(im,{data:i,save:n}),a==="cxc"&&e.jsx(om,{data:i,save:n})]})]})}const rm=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Ve={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},vr=()=>Math.random().toString(36).slice(2,10),Ui=()=>new Date().toISOString().split("T")[0],Ot=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),aa=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:1}).format(t||0),Vi=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Ve.surface,border:`1px solid ${Ve.border}`,borderRadius:8,padding:16,boxShadow:Ve.shadow,...i},...o,children:t}),ii=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${Ve.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?Ve.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),lt=({lbl:t,val:i,on:o,ph:n,type:a,style:r,children:s,...d})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),s||e.jsx("input",{type:a||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${Ve.border}`,borderRadius:4,fontSize:11,background:"#fff"},...d})]}),sa=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),yi={border:`1px solid ${Ve.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},Oi={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Ve.border}`,textAlign:"left"},tt={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${Ve.border}`},ms="habitaris_flotas",xd=[{id:"dashboard",lbl:" Dashboard"},{id:"vehiculos",lbl:" Vehculos"},{id:"km",lbl:" Partes KM"},{id:"combustible",lbl:" Combustible"},{id:"docs",lbl:" Documentacin"},{id:"manto",lbl:" Mantenimiento"}],am=["Camioneta","Camin","Volqueta","Furgn","Automvil","Motocicleta","Maquinaria","Otro"],bs={activo:{lbl:"Activo",c:Ve.green},taller:{lbl:"En taller",c:Ve.amber},inactivo:{lbl:"Inactivo",c:Ve.red}};function sm({vehs:t,setVehs:i}){const[o,n]=F.useState(!1),[a,r]=F.useState(null),[s,d]=F.useState(""),[u,b]=F.useState({placa:"",marca:"",modelo:"",anio:new Date().getFullYear(),tipo:"Camioneta",conductor:"",proyecto:"",kmActual:0,estado:"activo",color:"",vin:"",observaciones:""}),j=()=>b({placa:"",marca:"",modelo:"",anio:new Date().getFullYear(),tipo:"Camioneta",conductor:"",proyecto:"",kmActual:0,estado:"activo",color:"",vin:"",observaciones:""}),w=l=>{b({...l}),r(l.id),n(!0)},S=()=>{j(),r(null),n(!0)},m=()=>{u.placa&&(i(a?t.map(l=>l.id===a?{...u,id:a}:l):[...t,{...u,id:vr(),fechaRegistro:Ui()}]),n(!1),j(),r(null))},x=l=>i(t.filter(f=>f.id!==l)),p=t.filter(l=>{var y,h,v,A;const f=s.toLowerCase();return!f||((y=l.placa)==null?void 0:y.toLowerCase().includes(f))||((h=l.marca)==null?void 0:h.toLowerCase().includes(f))||((v=l.conductor)==null?void 0:v.toLowerCase().includes(f))||((A=l.proyecto)==null?void 0:A.toLowerCase().includes(f))}),c=t.filter(l=>l.estado==="activo").length,g=t.filter(l=>l.estado==="taller").length;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Flota vehicular  ",t.length," vehculos"]}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ve.inkMid},children:[c," activos  ",g," en taller"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(vi,{size:12,style:{position:"absolute",left:8,top:8,color:Ve.inkLight}}),e.jsx("input",{value:s,onChange:l=>d(l.target.value),placeholder:"Buscar placa, marca, conductor...",style:{...yi,paddingLeft:26,width:220}})]}),e.jsxs(ii,{on:S,children:[e.jsx(Pe,{size:11})," Nuevo vehculo"]})]})]}),e.jsx(Vi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Tipo","Marca / Modelo","Ao","Conductor","Proyecto","KM actual","Estado",""].map(l=>e.jsx("th",{style:{...Oi,textAlign:l==="KM actual"?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ve.inkLight,fontSize:11},children:"Sin vehculos registrados"})}):p.map((l,f)=>{const y=bs[l.estado]||bs.activo;return e.jsxs("tr",{style:{background:f%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:12},children:l.placa}),e.jsx("td",{style:{...tt,fontSize:9},children:l.tipo}),e.jsxs("td",{style:{...tt,fontWeight:600},children:[l.marca," ",l.modelo]}),e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace"},children:l.anio}),e.jsx("td",{style:{...tt,fontSize:9,color:Ve.inkMid},children:l.conductor||""}),e.jsx("td",{style:{...tt,fontSize:9,color:Ve.inkMid},children:l.proyecto||""}),e.jsx("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:Ot(l.kmActual)}),e.jsx("td",{style:tt,children:e.jsx(sa,{color:y.c,children:y.lbl})}),e.jsxs("td",{style:{...tt,whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>w(l),style:{background:"none",border:"none",cursor:"pointer",color:Ve.blue,marginRight:4},children:e.jsx(io,{size:11})}),e.jsx("button",{onClick:()=>x(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})]})]},l.id)})})]})}),o&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{n(!1),r(null)},children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:500,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:a?"Editar vehculo":"Nuevo vehculo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Placa",val:u.placa,on:l=>b({...u,placa:l.target.value.toUpperCase()}),ph:"ABC-123",style:{flex:"0 0 120px"}}),e.jsx(lt,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:u.tipo,onChange:l=>b({...u,tipo:l.target.value}),style:{...yi,width:"100%"},children:am.map(l=>e.jsx("option",{children:l},l))})}),e.jsx(lt,{lbl:"Estado",style:{flex:1},children:e.jsx("select",{value:u.estado,onChange:l=>b({...u,estado:l.target.value}),style:{...yi,width:"100%"},children:Object.entries(bs).map(([l,f])=>e.jsx("option",{value:l,children:f.lbl},l))})})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Marca",val:u.marca,on:l=>b({...u,marca:l.target.value}),ph:"Toyota",style:{flex:1}}),e.jsx(lt,{lbl:"Modelo",val:u.modelo,on:l=>b({...u,modelo:l.target.value}),ph:"Hilux",style:{flex:1}}),e.jsx(lt,{lbl:"Ao",val:u.anio,on:l=>b({...u,anio:l.target.value}),type:"number",style:{flex:"0 0 80px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Color",val:u.color,on:l=>b({...u,color:l.target.value}),ph:"Blanco",style:{flex:1}}),e.jsx(lt,{lbl:"VIN / Chasis",val:u.vin,on:l=>b({...u,vin:l.target.value}),ph:"Opcional",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Conductor asignado",val:u.conductor,on:l=>b({...u,conductor:l.target.value}),ph:"Nombre",style:{flex:1}}),e.jsx(lt,{lbl:"Proyecto",val:u.proyecto,on:l=>b({...u,proyecto:l.target.value}),ph:"Obra asignada",style:{flex:1}})]}),e.jsx(lt,{lbl:"KM actual",val:u.kmActual,on:l=>b({...u,kmActual:l.target.value}),type:"number"}),e.jsx(lt,{lbl:"Observaciones",val:u.observaciones,on:l=>b({...u,observaciones:l.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:m,style:{flex:1},children:[e.jsx(ft,{size:11})," ",a?"Guardar":"Crear"]}),e.jsx(ii,{v:"sec",on:()=>{n(!1),r(null)},style:{flex:1},children:"Cancelar"})]})]})})]})}function lm({vehs:t,setVehs:i,partes:o,setPartes:n}){const[a,r]=F.useState(!1),[s,d]=F.useState(()=>{const p=new Date;return`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}`}),[u,b]=F.useState({vehId:"",fecha:Ui(),kmInicio:0,kmFin:0,conductor:"",proyecto:"",ruta:"",observaciones:""}),j=()=>{const p=t.find(g=>g.id===u.vehId);if(!p)return;const c={id:vr(),...u,kmInicio:parseFloat(u.kmInicio)||0,kmFin:parseFloat(u.kmFin)||0,placa:p.placa};n([...o,c]),c.kmFin>(parseFloat(p.kmActual)||0)&&i(t.map(g=>g.id===u.vehId?{...g,kmActual:c.kmFin}:g)),b({vehId:"",fecha:Ui(),kmInicio:0,kmFin:0,conductor:"",proyecto:"",ruta:"",observaciones:""}),r(!1)},w=p=>n(o.filter(c=>c.id!==p)),S=o.filter(p=>{var c;return(c=p.fecha)==null?void 0:c.startsWith(s)}).sort((p,c)=>p.fecha.localeCompare(c.fecha)),m=S.reduce((p,c)=>p+Math.max(0,(c.kmFin||0)-(c.kmInicio||0)),0),x=[...new Set(o.map(p=>{var c;return(c=p.fecha)==null?void 0:c.slice(0,7)}).filter(Boolean))];return x.includes(s)||x.push(s),x.sort(),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Partes de kilmetros"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ve.inkMid},children:[s,"  ",S.length," registros  ",Ot(m)," km total"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:s,onChange:p=>d(p.target.value),style:{...yi,fontWeight:600},children:x.map(p=>e.jsx("option",{value:p,children:p},p))}),e.jsxs(ii,{on:()=>r(!0),children:[e.jsx(Pe,{size:11})," Registro"]})]})]}),e.jsx(Vi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Placa","Conductor","Proyecto","Ruta","KM inicio","KM fin","Recorrido",""].map(p=>e.jsx("th",{style:{...Oi,textAlign:["KM inicio","KM fin","Recorrido"].includes(p)?"right":"left"},children:p},p))})}),e.jsxs("tbody",{children:[S.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ve.inkLight,fontSize:11},children:["Sin registros en ",s]})}):S.map((p,c)=>{const g=Math.max(0,(p.kmFin||0)-(p.kmInicio||0));return e.jsxs("tr",{style:{background:c%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace"},children:p.fecha}),e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:p.placa}),e.jsx("td",{style:{...tt,fontSize:9},children:p.conductor||""}),e.jsx("td",{style:{...tt,fontSize:9,color:Ve.inkMid},children:p.proyecto||""}),e.jsx("td",{style:{...tt,fontSize:9},children:p.ruta||""}),e.jsx("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ot(p.kmInicio)}),e.jsx("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ot(p.kmFin)}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:Ve.green},children:[Ot(g)," km"]}),e.jsx("td",{style:tt,children:e.jsx("button",{onClick:()=>w(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},p.id)}),S.length>0&&e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("td",{colSpan:7,style:{...tt,fontWeight:800,borderTop:`2px solid ${Ve.ink}`},children:"TOTAL MES"}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:800,color:Ve.green,fontSize:12,borderTop:`2px solid ${Ve.ink}`},children:[Ot(m)," km"]}),e.jsx("td",{style:{...tt,borderTop:`2px solid ${Ve.ink}`}})]})]})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nuevo registro KM"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:u.vehId,onChange:p=>{const c=t.find(g=>g.id===p.target.value);b({...u,vehId:p.target.value,kmInicio:(c==null?void 0:c.kmActual)||0,conductor:(c==null?void 0:c.conductor)||u.conductor})},style:{...yi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.filter(p=>p.estado==="activo").map(p=>e.jsxs("option",{value:p.id,children:[p.placa,"  ",p.marca," ",p.modelo]},p.id))]})}),e.jsx(lt,{lbl:"Fecha",val:u.fecha,on:p=>b({...u,fecha:p.target.value}),type:"date",style:{flex:"0 0 140px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"KM inicio",val:u.kmInicio,on:p=>b({...u,kmInicio:p.target.value}),type:"number",style:{flex:1}}),e.jsx(lt,{lbl:"KM fin",val:u.kmFin,on:p=>b({...u,kmFin:p.target.value}),type:"number",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Recorrido"}),e.jsxs("div",{style:{padding:"6px 8px",fontSize:14,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Ve.green},children:[Ot(Math.max(0,(parseFloat(u.kmFin)||0)-(parseFloat(u.kmInicio)||0)))," km"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Conductor",val:u.conductor,on:p=>b({...u,conductor:p.target.value}),ph:"Nombre",style:{flex:1}}),e.jsx(lt,{lbl:"Proyecto",val:u.proyecto,on:p=>b({...u,proyecto:p.target.value}),ph:"Obra",style:{flex:1}})]}),e.jsx(lt,{lbl:"Ruta / destino",val:u.ruta,on:p=>b({...u,ruta:p.target.value}),ph:"Bogot  Obra Chic  Bogot"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:j,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar"]}),e.jsx(ii,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function dm({vehs:t,tanqueos:i,setTanqueos:o}){const[n,a]=F.useState(!1),[r,s]=F.useState(()=>{const l=new Date;return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`}),[d,u]=F.useState({vehId:"",fecha:Ui(),litros:0,valorTotal:0,km:0,estacion:"",tipoCombus:"Diesel",factura:""}),b=["Diesel","Gasolina corriente","Gasolina extra","Gas natural","Elctrico"],j=()=>{const l=t.find(f=>f.id===d.vehId);l&&(o([...i,{id:vr(),...d,litros:parseFloat(d.litros)||0,valorTotal:parseFloat(d.valorTotal)||0,km:parseFloat(d.km)||0,placa:l.placa}]),u({vehId:"",fecha:Ui(),litros:0,valorTotal:0,km:0,estacion:"",tipoCombus:"Diesel",factura:""}),a(!1))},w=l=>o(i.filter(f=>f.id!==l)),S=i.filter(l=>{var f;return(f=l.fecha)==null?void 0:f.startsWith(r)}),m=S.reduce((l,f)=>l+f.litros,0),x=S.reduce((l,f)=>l+f.valorTotal,0),p=m>0?x/m:0,c=[...new Set(i.map(l=>{var f;return(f=l.fecha)==null?void 0:f.slice(0,7)}).filter(Boolean))];c.includes(r)||c.push(r),c.sort();const g={};return S.forEach(l=>{g[l.placa]||(g[l.placa]={litros:0,gasto:0,tanqueos:0}),g[l.placa].litros+=l.litros,g[l.placa].gasto+=l.valorTotal,g[l.placa].tanqueos++}),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Consumo de combustible"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ve.inkMid},children:[r,"  ",S.length," tanqueos"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:r,onChange:l=>s(l.target.value),style:{...yi,fontWeight:600},children:c.map(l=>e.jsx("option",{value:l,children:l},l))}),e.jsxs(ii,{on:()=>a(!0),children:[e.jsx(Pe,{size:11})," Tanqueo"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Litros total",aa(m)+" L",Ve.blue],[" Gasto total","$"+Ot(x),Ve.red],[" $/Litro prom.","$"+Ot(p),Ve.ink],[" Vehculos",Object.keys(g).length+"",Ve.ink]].map(([l,f,y])=>e.jsxs(Vi,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:l}),e.jsx("div",{style:{fontSize:16,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y,marginTop:2},children:f})]},l))}),Object.keys(g).length>0&&e.jsxs(Vi,{style:{padding:0,overflow:"hidden",marginBottom:14},children:[e.jsx("div",{style:{padding:"8px 12px",background:"#EDEBE7",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Resumen por vehculo"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Oi,children:"Placa"}),e.jsx("th",{style:{...Oi,textAlign:"right"},children:"Tanqueos"}),e.jsx("th",{style:{...Oi,textAlign:"right"},children:"Litros"}),e.jsx("th",{style:{...Oi,textAlign:"right"},children:"Gasto"}),e.jsx("th",{style:{...Oi,textAlign:"right"},children:"$/Litro"})]})}),e.jsx("tbody",{children:Object.entries(g).sort((l,f)=>f[1].gasto-l[1].gasto).map(([l,f],y)=>e.jsxs("tr",{style:{background:y%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l}),e.jsx("td",{style:{...tt,textAlign:"right"},children:f.tanqueos}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[aa(f.litros)," L"]}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:Ve.red},children:["$",Ot(f.gasto)]}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:["$",Ot(f.litros>0?f.gasto/f.litros:0)]})]},l))})]})]}),e.jsx(Vi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Placa","Tipo","Estacin","Litros","Valor","KM","Factura",""].map(l=>e.jsx("th",{style:{...Oi,textAlign:["Litros","Valor","KM"].includes(l)?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:S.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ve.inkLight,fontSize:11},children:["Sin tanqueos en ",r]})}):S.sort((l,f)=>l.fecha.localeCompare(f.fecha)).map((l,f)=>e.jsxs("tr",{style:{background:f%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace"},children:l.fecha}),e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l.placa}),e.jsx("td",{style:{...tt,fontSize:9},children:l.tipoCombus}),e.jsx("td",{style:{...tt,fontSize:9},children:l.estacion||""}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[aa(l.litros)," L"]}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",Ot(l.valorTotal)]}),e.jsx("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ot(l.km)}),e.jsx("td",{style:{...tt,fontSize:8,color:Ve.blue},children:l.factura||""}),e.jsx("td",{style:tt,children:e.jsx("button",{onClick:()=>w(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},l.id))})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>a(!1),children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Registrar tanqueo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:d.vehId,onChange:l=>u({...d,vehId:l.target.value}),style:{...yi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(l=>e.jsxs("option",{value:l.id,children:[l.placa,"  ",l.marca," ",l.modelo]},l.id))]})}),e.jsx(lt,{lbl:"Fecha",val:d.fecha,on:l=>u({...d,fecha:l.target.value}),type:"date",style:{flex:"0 0 140px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Tipo combustible",style:{flex:1},children:e.jsx("select",{value:d.tipoCombus,onChange:l=>u({...d,tipoCombus:l.target.value}),style:{...yi,width:"100%"},children:b.map(l=>e.jsx("option",{children:l},l))})}),e.jsx(lt,{lbl:"Estacin",val:d.estacion,on:l=>u({...d,estacion:l.target.value}),ph:"Terpel Cra 7",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Litros",val:d.litros,on:l=>u({...d,litros:l.target.value}),type:"number",style:{flex:1}}),e.jsx(lt,{lbl:"Valor total",val:d.valorTotal,on:l=>u({...d,valorTotal:l.target.value}),type:"number",style:{flex:1}}),e.jsx(lt,{lbl:"KM odmetro",val:d.km,on:l=>u({...d,km:l.target.value}),type:"number",style:{flex:1}})]}),e.jsx(lt,{lbl:"Ref. factura",val:d.factura,on:l=>u({...d,factura:l.target.value}),ph:"FV-00123"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:j,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar"]}),e.jsx(ii,{v:"sec",on:()=>a(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function cm({vehs:t,docVehs:i,setDocVehs:o}){const[n,a]=F.useState(!1),[r,s]=F.useState({vehId:"",tipo:"soat",fechaExpedicion:Ui(),fechaVence:"",entidad:"",poliza:"",costo:0,observaciones:""}),d=[{id:"soat",lbl:"SOAT",icon:""},{id:"tecno",lbl:"Tecnomecnica",icon:""},{id:"seguro",lbl:"Seguro todo riesgo",icon:""},{id:"tarjeta_prop",lbl:"Tarjeta de propiedad",icon:""},{id:"licencia_trans",lbl:"Licencia de trnsito",icon:""},{id:"revision_gas",lbl:"Revisin de gases",icon:""},{id:"poliza_rce",lbl:"Pliza RCE",icon:""},{id:"otro",lbl:"Otro",icon:""}],u=()=>{const p=t.find(c=>c.id===r.vehId);p&&(o([...i,{id:vr(),...r,costo:parseFloat(r.costo)||0,placa:p.placa}]),s({vehId:"",tipo:"soat",fechaExpedicion:Ui(),fechaVence:"",entidad:"",poliza:"",costo:0,observaciones:""}),a(!1))},b=p=>o(i.filter(c=>c.id!==p)),j=Ui(),w=new Date;w.setDate(w.getDate()+30);const S=w.toISOString().split("T")[0],m=i.filter(p=>p.fechaVence&&p.fechaVence<j),x=i.filter(p=>p.fechaVence&&p.fechaVence>=j&&p.fechaVence<=S);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Documentacin vehicular"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ve.inkMid},children:[i.length," documentos  ",m.length," vencidos  ",x.length," por vencer"]})]}),e.jsxs(ii,{on:()=>a(!0),children:[e.jsx(Pe,{size:11})," Documento"]})]}),(m.length>0||x.length>0)&&e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[m.length>0&&e.jsxs("div",{style:{flex:1,background:Ve.redBg,border:`1px solid ${Ve.red}33`,borderRadius:6,padding:"8px 12px",display:"flex",alignItems:"center",gap:6},children:[e.jsx(si,{size:14,color:Ve.red}),e.jsxs("div",{style:{fontSize:10,color:Ve.red,fontWeight:600},children:[" ",m.length," documento",m.length>1?"s":""," vencido",m.length>1?"s":"",": ",m.map(p=>{var c;return p.placa+" "+((c=d.find(g=>g.id===p.tipo))==null?void 0:c.lbl)}).join(", ")]})]}),x.length>0&&e.jsxs("div",{style:{flex:1,background:Ve.amberBg,border:`1px solid ${Ve.amber}33`,borderRadius:6,padding:"8px 12px",display:"flex",alignItems:"center",gap:6},children:[e.jsx(si,{size:14,color:Ve.amber}),e.jsxs("div",{style:{fontSize:10,color:Ve.amber,fontWeight:600},children:[" ",x.length," por vencer en 30 das"]})]})]}),e.jsx(Vi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Documento","Entidad","Pliza/Nro","Expedicin","Vencimiento","Costo","Estado",""].map(p=>e.jsx("th",{style:{...Oi,textAlign:p==="Costo"?"right":"left"},children:p},p))})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ve.inkLight,fontSize:11},children:"Sin documentos"})}):i.sort((p,c)=>(p.fechaVence||"z").localeCompare(c.fechaVence||"z")).map((p,c)=>{const g=d.find(y=>y.id===p.tipo)||d[7],l=p.fechaVence&&p.fechaVence<j,f=p.fechaVence&&!l&&p.fechaVence<=S;return e.jsxs("tr",{style:{background:l?"#FAE8E844":f?"#FAF0E044":c%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:p.placa}),e.jsxs("td",{style:{...tt,fontWeight:600},children:[g.icon," ",g.lbl]}),e.jsx("td",{style:{...tt,fontSize:9},children:p.entidad||""}),e.jsx("td",{style:{...tt,fontSize:9,fontFamily:"'DM Mono',monospace"},children:p.poliza||""}),e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontSize:9},children:p.fechaExpedicion}),e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:l||f?700:400,color:l?Ve.red:f?Ve.amber:Ve.ink},children:p.fechaVence||"N/A"}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:["$",Ot(p.costo)]}),e.jsx("td",{style:tt,children:l?e.jsx(sa,{color:Ve.red,children:"Vencido"}):f?e.jsx(sa,{color:Ve.amber,children:"Por vencer"}):e.jsx(sa,{color:Ve.green,children:"Vigente"})}),e.jsx("td",{style:tt,children:e.jsx("button",{onClick:()=>b(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},p.id)})})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>a(!1),children:e.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nuevo documento"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:r.vehId,onChange:p=>s({...r,vehId:p.target.value}),style:{...yi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(p=>e.jsxs("option",{value:p.id,children:[p.placa,"  ",p.marca," ",p.modelo]},p.id))]})}),e.jsx(lt,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:r.tipo,onChange:p=>s({...r,tipo:p.target.value}),style:{...yi,width:"100%"},children:d.map(p=>e.jsxs("option",{value:p.id,children:[p.icon," ",p.lbl]},p.id))})})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Entidad / aseguradora",val:r.entidad,on:p=>s({...r,entidad:p.target.value}),ph:"Sura, Colpatria...",style:{flex:1}}),e.jsx(lt,{lbl:"Nro. pliza / doc",val:r.poliza,on:p=>s({...r,poliza:p.target.value}),ph:"POL-123",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Fecha expedicin",val:r.fechaExpedicion,on:p=>s({...r,fechaExpedicion:p.target.value}),type:"date",style:{flex:1}}),e.jsx(lt,{lbl:"Fecha vencimiento",val:r.fechaVence,on:p=>s({...r,fechaVence:p.target.value}),type:"date",style:{flex:1}})]}),e.jsx(lt,{lbl:"Costo",val:r.costo,on:p=>s({...r,costo:p.target.value}),type:"number"}),e.jsx(lt,{lbl:"Observaciones",val:r.observaciones,on:p=>s({...r,observaciones:p.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:u,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar"]}),e.jsx(ii,{v:"sec",on:()=>a(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function pm({vehs:t,mantos:i,setMantos:o}){const[n,a]=F.useState(!1),[r,s]=F.useState("todos"),[d,u]=F.useState({vehId:"",tipo:"preventivo",descripcion:"",fechaProg:"",fechaReal:"",kmProg:0,kmReal:0,taller:"",costo:0,estado:"programado",factura:"",observaciones:""}),b=[{id:"preventivo",lbl:" Preventivo",desc:"Cambio aceite, filtros, revisin general"},{id:"correctivo",lbl:" Correctivo",desc:"Reparacin de falla o avera"},{id:"llantas",lbl:" Llantas",desc:"Cambio, rotacin o alineacin"},{id:"frenos",lbl:" Frenos",desc:"Pastillas, discos, lquido"},{id:"electrico",lbl:" Elctrico",desc:"Batera, alternador, luces"},{id:"carroceria",lbl:" Carrocera",desc:"Pintura, latonera, vidrios"},{id:"otro",lbl:" Otro",desc:"Otro tipo de mantenimiento"}],j={programado:{lbl:"Programado",c:Ve.blue},en_curso:{lbl:"En curso",c:Ve.amber},completado:{lbl:"Completado",c:Ve.green},cancelado:{lbl:"Cancelado",c:Ve.red}},w=()=>{const f=t.find(y=>y.id===d.vehId);f&&(o([...i,{id:vr(),...d,kmProg:parseFloat(d.kmProg)||0,kmReal:parseFloat(d.kmReal)||0,costo:parseFloat(d.costo)||0,placa:f.placa}]),u({vehId:"",tipo:"preventivo",descripcion:"",fechaProg:"",fechaReal:"",kmProg:0,kmReal:0,taller:"",costo:0,estado:"programado",factura:"",observaciones:""}),a(!1))},S=(f,y,h)=>o(i.map(v=>v.id===f?{...v,[y]:h}:v)),m=f=>o(i.filter(y=>y.id!==f)),x=r==="todos"?i:i.filter(f=>f.estado===r),p=i.filter(f=>f.estado==="completado").reduce((f,y)=>f+y.costo,0),c=i.filter(f=>f.estado==="programado"),g=Ui(),l=c.filter(f=>f.fechaProg&&f.fechaProg<g);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Plan de mantenimiento"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ve.inkMid},children:[i.length," registros  ",c.length," programados  $",Ot(p)," invertido"]})]}),e.jsxs(ii,{on:()=>a(!0),children:[e.jsx(Pe,{size:11})," Mantenimiento"]})]}),l.length>0&&e.jsxs("div",{style:{background:Ve.redBg,border:`1px solid ${Ve.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(si,{size:14,color:Ve.red}),e.jsxs("div",{style:{fontSize:10,color:Ve.red,fontWeight:600},children:[" ",l.length," mantenimiento",l.length>1?"s":""," vencido",l.length>1?"s":"",": ",l.map(f=>f.placa).join(", ")]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:[["todos","Todos"],["programado","Programados"],["en_curso","En curso"],["completado","Completados"]].map(([f,y],h,v)=>e.jsx("button",{onClick:()=>s(f),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${Ve.border}`,borderLeft:h>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:h===0?"5px 0 0 5px":h===v.length-1?"0 5px 5px 0":"0",background:r===f?"#111":"#fff",color:r===f?"#fff":Ve.inkMid},children:y},f))}),e.jsx(Vi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Tipo","Descripcin","Taller","F. programada","F. real","Costo","Estado",""].map(f=>e.jsx("th",{style:{...Oi,textAlign:f==="Costo"?"right":"left"},children:f},f))})}),e.jsx("tbody",{children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ve.inkLight,fontSize:11},children:"Sin mantenimientos"})}):x.sort((f,y)=>(f.fechaProg||"z").localeCompare(y.fechaProg||"z")).map((f,y)=>{const h=b.find(z=>z.id===f.tipo)||b[6],v=j[f.estado]||j.programado,A=f.estado==="programado"&&f.fechaProg&&f.fechaProg<g;return e.jsxs("tr",{style:{background:A?"#FAE8E844":y%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:f.placa}),e.jsx("td",{style:{...tt,fontSize:9},children:h.lbl}),e.jsx("td",{style:{...tt,fontSize:10,maxWidth:200},children:f.descripcion||""}),e.jsx("td",{style:{...tt,fontSize:9},children:f.taller||""}),e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontSize:9,color:A?Ve.red:Ve.ink,fontWeight:A?700:400},children:f.fechaProg||""}),e.jsx("td",{style:{...tt,fontFamily:"'DM Mono',monospace",fontSize:9},children:f.fechaReal||""}),e.jsxs("td",{style:{...tt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",Ot(f.costo)]}),e.jsx("td",{style:tt,children:e.jsx("select",{value:f.estado,onChange:z=>S(f.id,"estado",z.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:v.c+"22",color:v.c},children:Object.entries(j).map(([z,k])=>e.jsx("option",{value:z,children:k.lbl},z))})}),e.jsx("td",{style:tt,children:e.jsx("button",{onClick:()=>m(f.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},f.id)})})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>a(!1),children:e.jsxs("div",{onClick:f=>f.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:500,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Programar mantenimiento"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:d.vehId,onChange:f=>u({...d,vehId:f.target.value}),style:{...yi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(f=>e.jsxs("option",{value:f.id,children:[f.placa,"  ",f.marca," ",f.modelo]},f.id))]})}),e.jsx(lt,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:d.tipo,onChange:f=>u({...d,tipo:f.target.value}),style:{...yi,width:"100%"},children:b.map(f=>e.jsx("option",{value:f.id,children:f.lbl},f.id))})})]}),e.jsx(lt,{lbl:"Descripcin",val:d.descripcion,on:f=>u({...d,descripcion:f.target.value}),ph:"Cambio aceite 10W-40, filtro aceite, filtro aire..."}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Fecha programada",val:d.fechaProg,on:f=>u({...d,fechaProg:f.target.value}),type:"date",style:{flex:1}}),e.jsx(lt,{lbl:"Fecha real",val:d.fechaReal,on:f=>u({...d,fechaReal:f.target.value}),type:"date",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"KM programado",val:d.kmProg,on:f=>u({...d,kmProg:f.target.value}),type:"number",style:{flex:1}}),e.jsx(lt,{lbl:"KM real",val:d.kmReal,on:f=>u({...d,kmReal:f.target.value}),type:"number",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(lt,{lbl:"Taller",val:d.taller,on:f=>u({...d,taller:f.target.value}),ph:"Nombre taller",style:{flex:1}}),e.jsx(lt,{lbl:"Costo",val:d.costo,on:f=>u({...d,costo:f.target.value}),type:"number",style:{flex:1}})]}),e.jsx(lt,{lbl:"Ref. factura",val:d.factura,on:f=>u({...d,factura:f.target.value}),ph:"FV-00123"}),e.jsx(lt,{lbl:"Observaciones",val:d.observaciones,on:f=>u({...d,observaciones:f.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:w,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar"]}),e.jsx(ii,{v:"sec",on:()=>a(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function gm(){const[t,i]=F.useState(()=>{try{return JSON.parse(localStorage.getItem(ms))||{}}catch{return{}}}),o=(D,K)=>i(oe=>{var P,ie;const te={...oe,[D]:typeof K=="function"?K(oe[D]):K};localStorage.setItem(ms,JSON.stringify(te));try{(ie=(P=window.storage)==null?void 0:P.set)==null||ie.call(P,ms,JSON.stringify(te))}catch{}return te}),n=t.vehiculos||[],a=D=>o("vehiculos",typeof D=="function"?D(n):D),r=t.partesKm||[],s=D=>o("partesKm",typeof D=="function"?D(r):D),d=t.tanqueos||[],u=D=>o("tanqueos",typeof D=="function"?D(d):D),b=t.docVehs||[],j=D=>o("docVehs",typeof D=="function"?D(b):D),w=t.mantos||[],S=D=>o("mantos",typeof D=="function"?D(w):D),[m,x]=F.useState("dashboard"),p=Ui(),c=p.slice(0,7),g=new Date;g.setDate(g.getDate()+30);const l=g.toISOString().split("T")[0],f=n.filter(D=>D.estado==="activo").length,y=n.filter(D=>D.estado==="taller").length,h=b.filter(D=>D.fechaVence&&D.fechaVence<p).length,v=b.filter(D=>D.fechaVence&&D.fechaVence>=p&&D.fechaVence<=l).length,A=w.filter(D=>D.estado==="programado"&&D.fechaProg&&D.fechaProg<p).length,z=r.filter(D=>{var K;return(K=D.fecha)==null?void 0:K.startsWith(c)}).reduce((D,K)=>D+Math.max(0,(K.kmFin||0)-(K.kmInicio||0)),0),k=d.filter(D=>{var K;return(K=D.fecha)==null?void 0:K.startsWith(c)}).reduce((D,K)=>D+K.valorTotal,0),T=d.filter(D=>{var K;return(K=D.fecha)==null?void 0:K.startsWith(c)}).reduce((D,K)=>D+K.litros,0),C=w.filter(D=>D.estado==="completado").reduce((D,K)=>D+K.costo,0);return e.jsxs(e.Fragment,{children:[e.jsx(rm,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Control de Flotas"}),e.jsx("div",{style:{fontSize:10,color:Ve.inkMid},children:"Vehculos  Kilmetros  Combustible  Documentos  Mantenimiento"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:xd.map((D,K)=>e.jsx("button",{onClick:()=>x(D.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${Ve.border}`,borderLeft:K>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:K===0?"6px 0 0 6px":K===xd.length-1?"0 6px 6px 0":"0",background:m===D.id?"#111":"#fff",color:m===D.id?"#fff":Ve.inkMid},children:D.lbl},D.id))}),m==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Vehculos activos",`${f}/${n.length}`,Ve.ink],[" En taller",y,y>0?"#8C6A00":"#111111"],[" KM mes",`${Ot(z)} km`,"#3B3B3B"],[" Combustible mes",`$${Ot(k)}`,"#B91C1C"]].map(([D,K,oe])=>e.jsxs(Vi,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:D}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:oe},children:K})]},D))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Docs vencidos",h,h>0?"#B91C1C":"#111111"],[" Docs por vencer",v,v>0?"#8C6A00":"#111111"],[" Mantos vencidos",A,A>0?"#B91C1C":"#111111"],[" Costo mantos total",`$${Ot(C)}`,Ve.ink]].map(([D,K,oe])=>e.jsxs(Vi,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:D}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:oe},children:K})]},D))}),T>0&&e.jsx(Vi,{style:{marginBottom:12,padding:"10px 14px"},children:e.jsxs("div",{style:{fontSize:9,fontWeight:600,color:Ve.inkMid},children:[" Precio promedio/litro: ",e.jsxs("strong",{style:{color:Ve.ink},children:["$",Ot(k/T)]}),"  Litros mes: ",e.jsxs("strong",{children:[aa(T)," L"]})]})}),(h>0||A>0)&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" ",[h>0&&`${h} documentos vencidos`,A>0&&`${A} mantenimientos vencidos`].filter(Boolean).join("  ")]})]}),m==="vehiculos"&&e.jsx(sm,{vehs:n,setVehs:a}),m==="km"&&e.jsx(lm,{vehs:n,setVehs:a,partes:r,setPartes:s}),m==="combustible"&&e.jsx(dm,{vehs:n,tanqueos:d,setTanqueos:u}),m==="docs"&&e.jsx(cm,{vehs:n,docVehs:b,setDocVehs:j}),m==="manto"&&e.jsx(pm,{vehs:n,mantos:w,setMantos:S})]})]})}const um=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Xe={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},mn=()=>Math.random().toString(36).slice(2,10),So=()=>new Date().toISOString().split("T")[0],mo=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),hr=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Xe.surface,border:`1px solid ${Xe.border}`,borderRadius:8,padding:16,boxShadow:Xe.shadow,...i},...o,children:t}),no=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${Xe.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?Xe.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),pi=({lbl:t,val:i,on:o,ph:n,type:a,style:r,children:s,...d})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),s||e.jsx("input",{type:a||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${Xe.border}`,borderRadius:4,fontSize:11,background:"#fff"},...d})]}),Xs=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),zi={border:`1px solid ${Xe.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},ja={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Xe.border}`,textAlign:"left"},Bt={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${Xe.border}`},ys="habitaris_compras",md=[{id:"dashboard",lbl:" Dashboard"},{id:"oc",lbl:" rdenes de Compra"},{id:"recep",lbl:" Recepcin"},{id:"eval",lbl:" Evaluacin Proveedores"}];function hm({ocs:t,setOCs:i}){var A,z;const[o,n]=F.useState(!1),[a,r]=F.useState(null),[s,d]=F.useState(""),[u,b]=F.useState("todos"),[j,w]=F.useState({proveedor:"",proyecto:"",solicitante:"",fechaEntrega:"",condicionPago:"Contado",observaciones:"",items:[{id:mn(),desc:"",und:"",cant:0,valorUnit:0}]}),S={borrador:{lbl:"Borrador",c:Xe.inkLight},pendiente:{lbl:"Pendiente",c:Xe.amber},aprobada:{lbl:"Aprobada",c:Xe.blue},enviada:{lbl:"Enviada prov.",c:"#5B3A8C"},parcial:{lbl:"Recibida parcial",c:Xe.amber},completa:{lbl:"Completa",c:Xe.green},cancelada:{lbl:"Cancelada",c:Xe.red}},m=["Contado","Crdito 30 das","Crdito 60 das","Anticipo 50%","Contra entrega"],x=()=>{const k=j.items.filter(K=>K.desc.trim()).map(K=>({...K,cant:parseFloat(K.cant)||0,valorUnit:parseFloat(K.valorUnit)||0}));if(!j.proveedor||k.length===0)return;const T=k.reduce((K,oe)=>K+oe.cant*oe.valorUnit,0),C=`OC-${String(t.length+1).padStart(4,"0")}`,D={id:mn(),num:C,...j,items:k,total:T,estado:"borrador",fecha:So(),historial:[{fecha:So(),accion:"Creada",usuario:"Admin"}]};i([...t,D]),r(D.id),w({proveedor:"",proyecto:"",solicitante:"",fechaEntrega:"",condicionPago:"Contado",observaciones:"",items:[{id:mn(),desc:"",und:"",cant:0,valorUnit:0}]}),n(!1)},p=(k,T)=>{i(t.map(C=>{var D;return C.id!==k?C:{...C,estado:T,historial:[...C.historial||[],{fecha:So(),accion:`Estado  ${(D=S[T])==null?void 0:D.lbl}`,usuario:"Admin"}]}}))},c=k=>{i(t.filter(T=>T.id!==k)),a===k&&r(null)},g=()=>w({...j,items:[...j.items,{id:mn(),desc:"",und:"",cant:0,valorUnit:0}]}),l=(k,T,C)=>w({...j,items:j.items.map((D,K)=>K===k?{...D,[T]:C}:D)}),f=k=>w({...j,items:j.items.filter((T,C)=>C!==k)}),y=t.filter(k=>{var C,D,K;if(u!=="todos"&&k.estado!==u)return!1;const T=s.toLowerCase();return!T||((C=k.num)==null?void 0:C.toLowerCase().includes(T))||((D=k.proveedor)==null?void 0:D.toLowerCase().includes(T))||((K=k.proyecto)==null?void 0:K.toLowerCase().includes(T))}),h=t.find(k=>k.id===a),v=t.filter(k=>k.estado==="pendiente").reduce((k,T)=>k+T.total,0);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["rdenes de Compra  ",t.length," OCs"]}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Xe.inkMid},children:[t.filter(k=>k.estado==="pendiente").length," pendientes  $",mo(v)," por aprobar"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(vi,{size:12,style:{position:"absolute",left:8,top:8,color:Xe.inkLight}}),e.jsx("input",{value:s,onChange:k=>d(k.target.value),placeholder:"Buscar OC, proveedor...",style:{...zi,paddingLeft:26,width:200}})]}),e.jsxs(no,{on:()=>n(!0),children:[e.jsx(Pe,{size:11})," Nueva OC"]})]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14,flexWrap:"wrap"},children:[["todos","Todos"],...Object.entries(S).map(([k,T])=>[k,T.lbl])].map(([k,T],C,D)=>e.jsxs("button",{onClick:()=>b(k),style:{padding:"5px 12px",fontSize:9,fontWeight:600,cursor:"pointer",border:`1px solid ${Xe.border}`,borderLeft:C>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:C===0?"5px 0 0 5px":C===D.length-1?"0 5px 5px 0":"0",background:u===k?"#111":"#fff",color:u===k?"#fff":Xe.inkMid},children:[T," ",e.jsxs("span",{style:{fontSize:7,marginLeft:2},children:["(",t.filter(K=>k==="todos"||K.estado===k).length,")"]})]},k))}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx(hr,{style:{flex:1,padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Nro.","Fecha","Proveedor","Proyecto","tems","Total","Entrega","Estado"].map(k=>e.jsx("th",{style:{...ja,textAlign:k==="Total"?"right":"left"},children:k},k))})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:24,textAlign:"center",color:Xe.inkLight,fontSize:11},children:"Sin rdenes"})}):y.sort((k,T)=>T.fecha.localeCompare(k.fecha)).map((k,T)=>{var D;const C=S[k.estado]||S.borrador;return e.jsxs("tr",{onClick:()=>r(k.id===a?null:k.id),style:{cursor:"pointer",background:a===k.id?"#F0F0F022":T%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Bt,fontFamily:"'DM Mono',monospace",fontWeight:700,color:Xe.blue},children:k.num}),e.jsx("td",{style:{...Bt,fontFamily:"'DM Mono',monospace",fontSize:9},children:k.fecha}),e.jsx("td",{style:{...Bt,fontWeight:600},children:k.proveedor}),e.jsx("td",{style:{...Bt,fontSize:9,color:Xe.inkMid},children:k.proyecto||""}),e.jsx("td",{style:{...Bt,fontSize:9},children:((D=k.items)==null?void 0:D.length)||0}),e.jsxs("td",{style:{...Bt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:["$",mo(k.total)]}),e.jsx("td",{style:{...Bt,fontFamily:"'DM Mono',monospace",fontSize:9},children:k.fechaEntrega||""}),e.jsx("td",{style:Bt,children:e.jsx(Xs,{color:C.c,children:C.lbl})})]},k.id)})})]})}),h&&e.jsxs(hr,{style:{width:360,flexShrink:0,padding:0,overflow:"hidden",alignSelf:"flex-start"},children:[e.jsxs("div",{style:{padding:"12px 14px",background:"#EDEBE7"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:h.num}),e.jsx("button",{onClick:()=>c(h.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:12})})]}),e.jsxs("div",{style:{fontSize:9,color:Xe.inkMid,marginTop:2},children:[h.proveedor,"  ",h.proyecto||"Sin proyecto","  ",h.fecha]})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:`1px solid ${Xe.border}`,display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:9,fontWeight:600,color:Xe.inkMid},children:"Estado:"}),e.jsx("select",{value:h.estado,onChange:k=>p(h.id,k.target.value),style:{fontSize:9,fontWeight:700,padding:"3px 8px",borderRadius:10,border:"none",cursor:"pointer",background:(((A=S[h.estado])==null?void 0:A.c)||Xe.inkLight)+"22",color:((z=S[h.estado])==null?void 0:z.c)||Xe.inkLight},children:Object.entries(S).map(([k,T])=>e.jsx("option",{value:k,children:T.lbl},k))})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:`1px solid ${Xe.border}`,fontSize:9},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Solicitante:"})," ",h.solicitante||""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Condicin pago:"})," ",h.condicionPago]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Entrega esperada:"})," ",h.fechaEntrega||""]}),h.observaciones&&e.jsx("div",{style:{marginTop:4,color:Xe.inkMid},children:h.observaciones})]}),e.jsxs("div",{style:{padding:"6px 0"},children:[e.jsx("div",{style:{padding:"0 14px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"tems"}),(h.items||[]).map((k,T)=>e.jsxs("div",{style:{padding:"4px 14px",borderBottom:`1px solid ${Xe.border}`,display:"flex",justifyContent:"space-between",fontSize:9},children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[k.cant," ",k.und]}),"  ",k.desc]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700},children:["$",mo(k.cant*k.valorUnit)]})]},k.id||T)),e.jsxs("div",{style:{padding:"6px 14px",display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:11,borderTop:`2px solid ${Xe.ink}`},children:[e.jsx("span",{children:"TOTAL"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:["$",mo(h.total)]})]})]}),(h.historial||[]).length>0&&e.jsxs("div",{style:{padding:"8px 14px",borderTop:`1px solid ${Xe.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"Historial"}),h.historial.map((k,T)=>e.jsxs("div",{style:{fontSize:8,color:Xe.inkMid,marginBottom:2},children:[k.fecha,"  ",k.accion]},T))]})]})]}),o&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>n(!1),children:e.jsxs("div",{onClick:k=>k.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:600,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nueva Orden de Compra"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(pi,{lbl:"Proveedor",val:j.proveedor,on:k=>w({...j,proveedor:k.target.value}),ph:"Nombre proveedor",style:{flex:1}}),e.jsx(pi,{lbl:"Proyecto",val:j.proyecto,on:k=>w({...j,proyecto:k.target.value}),ph:"Obra / proyecto",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(pi,{lbl:"Solicitante",val:j.solicitante,on:k=>w({...j,solicitante:k.target.value}),ph:"Quien solicita",style:{flex:1}}),e.jsx(pi,{lbl:"Fecha entrega",val:j.fechaEntrega,on:k=>w({...j,fechaEntrega:k.target.value}),type:"date",style:{flex:1}}),e.jsx(pi,{lbl:"Condicin pago",style:{flex:1},children:e.jsx("select",{value:j.condicionPago,onChange:k=>w({...j,condicionPago:k.target.value}),style:{...zi,width:"100%"},children:m.map(k=>e.jsx("option",{children:k},k))})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"tems"}),e.jsx("button",{onClick:g,style:{fontSize:9,color:Xe.blue,background:"none",border:"none",cursor:"pointer",fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir lnea"})]}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Descripcin","Und","Cant","Valor unit.","Subtotal",""].map(k=>e.jsx("th",{style:{padding:"3px 4px",fontSize:7,fontWeight:700,color:"#888",textAlign:["Cant","Valor unit.","Subtotal"].includes(k)?"right":"left",borderBottom:`1px solid ${Xe.border}`},children:k},k))})}),e.jsx("tbody",{children:j.items.map((k,T)=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"2px 2px"},children:e.jsx("input",{value:k.desc,onChange:C=>l(T,"desc",C.target.value),placeholder:"Material o servicio",style:{...zi,width:"100%",fontSize:10}})}),e.jsx("td",{style:{padding:"2px 2px",width:50},children:e.jsx("input",{value:k.und,onChange:C=>l(T,"und",C.target.value),placeholder:"m",style:{...zi,width:"100%",fontSize:10,textAlign:"center"}})}),e.jsx("td",{style:{padding:"2px 2px",width:65},children:e.jsx("input",{type:"number",value:k.cant,onChange:C=>l(T,"cant",C.target.value),style:{...zi,width:"100%",fontSize:10,textAlign:"right"}})}),e.jsx("td",{style:{padding:"2px 2px",width:90},children:e.jsx("input",{type:"number",value:k.valorUnit,onChange:C=>l(T,"valorUnit",C.target.value),style:{...zi,width:"100%",fontSize:10,textAlign:"right"}})}),e.jsxs("td",{style:{padding:"2px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,width:90},children:["$",mo((parseFloat(k.cant)||0)*(parseFloat(k.valorUnit)||0))]}),e.jsx("td",{style:{padding:"2px",width:20},children:j.items.length>1&&e.jsx("button",{onClick:()=>f(T),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:9})})})]},k.id))})]}),e.jsxs("div",{style:{textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:12,marginTop:6},children:["Total: $",mo(j.items.reduce((k,T)=>k+(parseFloat(T.cant)||0)*(parseFloat(T.valorUnit)||0),0))]})]}),e.jsx(pi,{lbl:"Observaciones",val:j.observaciones,on:k=>w({...j,observaciones:k.target.value}),ph:"Notas adicionales"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(no,{on:x,style:{flex:1},children:[e.jsx(ft,{size:11})," Crear OC"]}),e.jsx(no,{v:"sec",on:()=>n(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function fm({ocs:t,setOCs:i,recepciones:o,setRecepciones:n}){const[a,r]=F.useState(!1),[s,d]=F.useState(""),[u,b]=F.useState({ocId:"",fecha:So(),recibidoPor:"",observaciones:"",items:[]}),j=t.filter(m=>["aprobada","enviada","parcial"].includes(m.estado)),w=m=>{const x=t.find(g=>g.id===m);if(!x)return;const p={};o.filter(g=>g.ocId===m).forEach(g=>{(g.items||[]).forEach(l=>{p[l.itemId]=(p[l.itemId]||0)+(l.cantRecibida||0)})});const c=(x.items||[]).map(g=>({itemId:g.id,desc:g.desc,und:g.und,cantOC:g.cant,cantYaRecibida:p[g.id]||0,cantRecibida:0,conforme:!0,observacion:""}));b({ocId:m,fecha:So(),recibidoPor:"",observaciones:"",items:c}),d(m)},S=()=>{if(!u.ocId||u.items.every(p=>(parseFloat(p.cantRecibida)||0)===0))return;const m={id:mn(),...u,items:u.items.map(p=>({...p,cantRecibida:parseFloat(p.cantRecibida)||0}))};n([...o,m]);const x=t.find(p=>p.id===u.ocId);if(x){const p={};[...o.filter(g=>g.ocId===u.ocId),m].forEach(g=>{(g.items||[]).forEach(l=>{p[l.itemId]=(p[l.itemId]||0)+l.cantRecibida})});const c=(x.items||[]).every(g=>(p[g.id]||0)>=g.cant);i(t.map(g=>g.id===u.ocId?{...g,estado:c?"completa":"parcial",historial:[...g.historial||[],{fecha:So(),accion:c?"Recepcin completa":"Recepcin parcial",usuario:u.recibidoPor||"Admin"}]}:g))}b({ocId:"",fecha:So(),recibidoPor:"",observaciones:"",items:[]}),r(!1)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Recepcin de mercanca"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Xe.inkMid},children:[o.length," recepciones  ",j.length," OCs pendientes"]})]}),e.jsxs(no,{on:()=>r(!0),children:[e.jsx(Pe,{size:11})," Nueva recepcin"]})]}),e.jsx(hr,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","OC","Proveedor","Recibido por","tems","Conformes","Observaciones"].map(m=>e.jsx("th",{style:ja,children:m},m))})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:24,textAlign:"center",color:Xe.inkLight,fontSize:11},children:"Sin recepciones"})}):o.sort((m,x)=>x.fecha.localeCompare(m.fecha)).map((m,x)=>{const p=t.find(l=>l.id===m.ocId),c=(m.items||[]).filter(l=>l.cantRecibida>0).length,g=(m.items||[]).filter(l=>l.cantRecibida>0&&l.conforme).length;return e.jsxs("tr",{style:{background:x%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Bt,fontFamily:"'DM Mono',monospace"},children:m.fecha}),e.jsx("td",{style:{...Bt,fontFamily:"'DM Mono',monospace",fontWeight:700,color:Xe.blue},children:(p==null?void 0:p.num)||""}),e.jsx("td",{style:{...Bt,fontWeight:600},children:(p==null?void 0:p.proveedor)||""}),e.jsx("td",{style:{...Bt,fontSize:9},children:m.recibidoPor||""}),e.jsx("td",{style:{...Bt,fontSize:9},children:c}),e.jsx("td",{style:Bt,children:g===c?e.jsx(Xs,{color:Xe.green,children:" Todo conforme"}):e.jsxs(Xs,{color:Xe.red,children:[g,"/",c," conformes"]})}),e.jsx("td",{style:{...Bt,fontSize:8,color:Xe.inkMid,maxWidth:150,overflow:"hidden",textOverflow:"ellipsis"},children:m.observaciones||""})]},m.id)})})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:m=>m.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:650,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Recepcin de mercanca"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(pi,{lbl:"Orden de compra",style:{flex:1},children:e.jsxs("select",{value:u.ocId,onChange:m=>w(m.target.value),style:{...zi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar OC "}),j.map(m=>e.jsxs("option",{value:m.id,children:[m.num,"  ",m.proveedor," ($",mo(m.total),")"]},m.id))]})}),e.jsx(pi,{lbl:"Fecha",val:u.fecha,on:m=>b({...u,fecha:m.target.value}),type:"date",style:{flex:"0 0 140px"}}),e.jsx(pi,{lbl:"Recibido por",val:u.recibidoPor,on:m=>b({...u,recibidoPor:m.target.value}),ph:"Almacenista",style:{flex:1}})]}),u.items.length>0&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:6},children:"tems de la OC"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Descripcin","Und","Pedido","Ya recibido","Recibir ahora","Conforme?","Obs."].map(m=>e.jsx("th",{style:{padding:"3px 6px",fontSize:7,fontWeight:700,color:"#888",textAlign:["Pedido","Ya recibido","Recibir ahora"].includes(m)?"right":"left",borderBottom:`1px solid ${Xe.border}`},children:m},m))})}),e.jsx("tbody",{children:u.items.map((m,x)=>{const p=m.cantOC-m.cantYaRecibida;return e.jsxs("tr",{style:{borderBottom:`1px solid ${Xe.border}`,background:x%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 6px",fontSize:10},children:m.desc}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9,textAlign:"center"},children:m.und}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10},children:m.cantOC}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:Xe.inkMid},children:m.cantYaRecibida}),e.jsx("td",{style:{padding:"2px 4px",width:80},children:e.jsx("input",{type:"number",value:m.cantRecibida,max:p,onChange:c=>b({...u,items:u.items.map((g,l)=>l===x?{...g,cantRecibida:c.target.value}:g)}),style:{...zi,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:Xe.green}})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:m.conforme,onChange:c=>b({...u,items:u.items.map((g,l)=>l===x?{...g,conforme:c.target.checked}:g)})})}),e.jsx("td",{style:{padding:"2px 4px",width:100},children:e.jsx("input",{value:m.observacion||"",placeholder:"Nota",onChange:c=>b({...u,items:u.items.map((g,l)=>l===x?{...g,observacion:c.target.value}:g)}),style:{...zi,width:"100%",fontSize:8}})})]},m.itemId)})})]})]}),e.jsx(pi,{lbl:"Observaciones generales",val:u.observaciones,on:m=>b({...u,observaciones:m.target.value}),ph:"Notas sobre la recepcin"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(no,{on:S,style:{flex:1},children:[e.jsx(ft,{size:11})," Registrar recepcin"]}),e.jsx(no,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function xm({ocs:t,recepciones:i,evaluaciones:o,setEvaluaciones:n}){const[a,r]=F.useState(!1),[s,d]=F.useState({proveedor:"",periodo:"",calidad:5,puntualidad:5,precio:5,comunicacion:5,documentacion:5,observaciones:""}),u=[{id:"calidad",lbl:"Calidad del material/servicio",icon:""},{id:"puntualidad",lbl:"Puntualidad en entregas",icon:""},{id:"precio",lbl:"Competitividad de precios",icon:""},{id:"comunicacion",lbl:"Comunicacin y respuesta",icon:""},{id:"documentacion",lbl:"Documentacin y facturacin",icon:""}],b=()=>{if(!s.proveedor)return;const c=(s.calidad+s.puntualidad+s.precio+s.comunicacion+s.documentacion)/5;n([...o,{id:mn(),...s,promedio:Math.round(c*10)/10,fecha:So()}]),d({proveedor:"",periodo:"",calidad:5,puntualidad:5,precio:5,comunicacion:5,documentacion:5,observaciones:""}),r(!1)},j=c=>n(o.filter(g=>g.id!==c)),w=[...new Set(t.map(c=>c.proveedor).filter(Boolean))],S={};o.forEach(c=>{S[c.proveedor]||(S[c.proveedor]={evals:[],sum:0}),S[c.proveedor].evals.push(c),S[c.proveedor].sum+=c.promedio});const m=Object.entries(S).map(([c,g])=>({prov:c,count:g.evals.length,promedio:Math.round(g.sum/g.evals.length*10)/10,last:g.evals.sort((l,f)=>f.fecha.localeCompare(l.fecha))[0]})).sort((c,g)=>g.promedio-c.promedio),x=c=>c>=8?Xe.green:c>=5?Xe.amber:Xe.red,p=({val:c,max:g=10})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{width:80,height:6,background:"#E0E0E0",borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{width:`${c/g*100}%`,height:"100%",background:x(c),borderRadius:3}})}),e.jsx("span",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:x(c)},children:c})]});return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Evaluacin de proveedores"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Xe.inkMid},children:[o.length," evaluaciones  ",m.length," proveedores calificados"]})]}),e.jsxs(no,{on:()=>r(!0),children:[e.jsx(Pe,{size:11})," Evaluar"]})]}),m.length>0&&e.jsxs(hr,{style:{padding:0,overflow:"hidden",marginBottom:16},children:[e.jsx("div",{style:{padding:"8px 14px",background:"#EDEBE7",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:" Ranking general"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["#","Proveedor","Evaluaciones","Promedio","Tendencia"].map(c=>e.jsx("th",{style:{...ja,textAlign:c==="#"?"center":"left"},children:c},c))})}),e.jsx("tbody",{children:m.map((c,g)=>{var l;return e.jsxs("tr",{style:{background:g%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Bt,textAlign:"center",fontWeight:800,fontSize:12,color:g===0?"#D4A700":g===1?"#888":g===2?"#A0522D":Xe.ink},children:g===0?"":g===1?"":g===2?"":g+1}),e.jsx("td",{style:{...Bt,fontWeight:700},children:c.prov}),e.jsxs("td",{style:{...Bt,fontSize:9},children:[c.count," eval",c.count>1?"s":""]}),e.jsx("td",{style:Bt,children:e.jsx(p,{val:c.promedio})}),e.jsxs("td",{style:{...Bt,fontSize:9,color:Xe.inkMid},children:["ltima: ",(l=c.last)==null?void 0:l.fecha]})]},c.prov)})})]})]}),e.jsxs(hr,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"8px 14px",background:"#F5F4F1",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Historial de evaluaciones"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Fecha","Proveedor","Perodo","Calidad","Puntualidad","Precio","Comun.","Doc.","Promedio",""].map(c=>e.jsx("th",{style:{...ja,textAlign:["Calidad","Puntualidad","Precio","Comun.","Doc.","Promedio"].includes(c)?"center":"left"},children:c},c))})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:24,textAlign:"center",color:Xe.inkLight,fontSize:11},children:"Sin evaluaciones"})}):o.sort((c,g)=>g.fecha.localeCompare(c.fecha)).map((c,g)=>e.jsxs("tr",{style:{background:g%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Bt,fontFamily:"'DM Mono',monospace",fontSize:9},children:c.fecha}),e.jsx("td",{style:{...Bt,fontWeight:600},children:c.proveedor}),e.jsx("td",{style:{...Bt,fontSize:9},children:c.periodo||""}),["calidad","puntualidad","precio","comunicacion","documentacion"].map(l=>e.jsx("td",{style:{...Bt,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:x(c[l])},children:c[l]},l)),e.jsx("td",{style:{...Bt,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:12,color:x(c.promedio)},children:c.promedio}),e.jsx("td",{style:Bt,children:e.jsx("button",{onClick:()=>j(c.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:10})})})]},c.id))})]})]}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:c=>c.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:480,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Evaluar proveedor"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs(pi,{lbl:"Proveedor",style:{flex:1},children:[e.jsxs("select",{value:s.proveedor,onChange:c=>d({...s,proveedor:c.target.value}),style:{...zi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),w.map(c=>e.jsx("option",{children:c},c)),e.jsx("option",{value:"__otro",children:"+ Otro..."})]}),s.proveedor==="__otro"&&e.jsx("input",{value:"",onChange:c=>d({...s,proveedor:c.target.value}),placeholder:"Nombre proveedor",style:{...zi,width:"100%",marginTop:4}})]}),e.jsx(pi,{lbl:"Perodo",val:s.periodo,on:c=>d({...s,periodo:c.target.value}),ph:"Ene-Mar 2026",style:{flex:1}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:8},children:"Calificacin (1-10)"}),u.map(c=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[e.jsxs("div",{style:{width:180,fontSize:10},children:[c.icon," ",c.lbl]}),e.jsx("input",{type:"range",min:"1",max:"10",value:s[c.id],onChange:g=>d({...s,[c.id]:parseInt(g.target.value)}),style:{flex:1,accentColor:x(s[c.id])}}),e.jsx("div",{style:{width:28,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:14,color:x(s[c.id])},children:s[c.id]})]},c.id)),e.jsxs("div",{style:{textAlign:"right",fontSize:12,fontWeight:800,fontFamily:"'DM Mono',monospace",color:x((s.calidad+s.puntualidad+s.precio+s.comunicacion+s.documentacion)/5),marginTop:4},children:["Promedio: ",((s.calidad+s.puntualidad+s.precio+s.comunicacion+s.documentacion)/5).toFixed(1)]})]}),e.jsx(pi,{lbl:"Observaciones",val:s.observaciones,on:c=>d({...s,observaciones:c.target.value}),ph:"Notas sobre desempeo"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(no,{on:b,style:{flex:1},children:[e.jsx(ft,{size:11})," Guardar evaluacin"]}),e.jsx(no,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function mm(){const[t,i]=F.useState(()=>{try{return JSON.parse(localStorage.getItem(ys))||{}}catch{return{}}}),o=(p,c)=>i(g=>{var f,y;const l={...g,[p]:typeof c=="function"?c(g[p]):c};localStorage.setItem(ys,JSON.stringify(l));try{(y=(f=window.storage)==null?void 0:f.set)==null||y.call(f,ys,JSON.stringify(l))}catch{}return l}),n=t.ocs||[],a=p=>o("ocs",typeof p=="function"?p(n):p),r=t.recepciones||[],s=p=>o("recepciones",typeof p=="function"?p(r):p),d=t.evaluaciones||[],u=p=>o("evaluaciones",typeof p=="function"?p(d):p),[b,j]=F.useState("dashboard"),w=n.filter(p=>p.estado==="pendiente"),S=n.filter(p=>p.estado==="completa"),m=n.filter(p=>p.estado!=="cancelada").reduce((p,c)=>p+c.total,0),x=d.length>0?d.reduce((p,c)=>p+c.promedio,0)/d.length:0;return e.jsxs(e.Fragment,{children:[e.jsx(um,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Compras"}),e.jsx("div",{style:{fontSize:10,color:Xe.inkMid},children:"rdenes de compra  Recepcin  Evaluacin proveedores"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:md.map((p,c)=>e.jsx("button",{onClick:()=>j(p.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${Xe.border}`,borderLeft:c>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:c===0?"6px 0 0 6px":c===md.length-1?"0 6px 6px 0":"0",background:b===p.id?"#111":"#fff",color:b===p.id?"#fff":Xe.inkMid},children:p.lbl},p.id))}),b==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Total OCs",n.length,"#111"],[" Pendientes",w.length,w.length>0?"#8C6A00":"#111111"],[" Completas",S.length,"#111111"],[" Valor total",`$${mo(m)}`,"#111"]].map(([p,c,g])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Xe.border}`,borderRadius:8,padding:"14px 16px",boxShadow:Xe.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:g},children:c})]},p))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12,marginBottom:16},children:[[" Recepciones",r.length,"#3B3B3B"],[" Evaluaciones",d.length,"#111"],[" Nota media proveedores",x>0?x.toFixed(1):"",x>=8?"#111111":x>=5?"#8C6A00":"#B91C1C"]].map(([p,c,g])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Xe.border}`,borderRadius:8,padding:"14px 16px",boxShadow:Xe.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:g},children:c})]},p))})]}),b==="oc"&&e.jsx(hm,{ocs:n,setOCs:a}),b==="recep"&&e.jsx(fm,{ocs:n,setOCs:a,recepciones:r,setRecepciones:s}),b==="eval"&&e.jsx(xm,{ocs:n,recepciones:r,evaluaciones:d,setEvaluaciones:u})]})]})}const bm=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Ae={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},kt=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),ym=()=>new Date().toISOString().split("T")[0],uo=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Ae.surface,border:`1px solid ${Ae.border}`,borderRadius:8,padding:16,boxShadow:Ae.shadow,...i},...o,children:t}),vs=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),js=[{id:"general",lbl:" General",color:Ae.ink},{id:"proyectos",lbl:" Proyectos",color:"#5B3A8C"},{id:"admin",lbl:" Administracin",color:"#6B5B8C"},{id:"compras",lbl:" Compras",color:"#0D5E6E"},{id:"flotas",lbl:" Flotas",color:"#2E5E4E"},{id:"rrhh",lbl:" RRHH",color:"#3B3B3B"},{id:"crm",lbl:" CRM / Ofertas",color:"#111111"},{id:"formularios",lbl:" Formularios",color:"#5B3A8C"}],ln=t=>{try{return JSON.parse(localStorage.getItem(t))||{}}catch{return{}}};function vm(){return F.useMemo(()=>{const t=ln("habitaris_crm"),i=ln("habitaris_admin"),o=ln("habitaris_flotas"),n=ln("habitaris_compras"),a=ym(),r=i.adm_cajas||[],s=i.adm_tarjeta||[],d=i.adm_viaticos||[],u=i.adm_flujo||[],b=i.adm_cuentas||[],j=r.reduce((U,_)=>{const ce=_.movimientos||[];return U+(_.fondoInicial||0)+ce.reduce((ve,Ie)=>ve+(Ie.tipo==="entrada"?Ie.monto:-Ie.monto),0)},0),w=s.filter(U=>U.estado==="pendiente"),S=d.filter(U=>U.estado==="solicitado"||U.estado==="aprobado"),m=(()=>{const U=new Date,_=`${U.getFullYear()}-${String(U.getMonth()+1).padStart(2,"0")}`,ce=u.filter(Te=>{var Oe;return(Oe=Te.fecha)==null?void 0:Oe.startsWith(_)}),ve=ce.filter(Te=>Te.tipo==="ingreso").reduce((Te,Oe)=>Te+Oe.monto,0),Ie=ce.filter(Te=>Te.tipo==="egreso").reduce((Te,Oe)=>Te+Oe.monto,0);return{ing:ve,egr:Ie,neto:ve-Ie}})(),x=b.filter(U=>U.tipo==="cobrar"),p=b.filter(U=>U.tipo==="pagar"),c=x.filter(U=>U.estado==="vigente").reduce((U,_)=>U+_.monto,0),g=x.filter(U=>U.estado==="vencida").reduce((U,_)=>U+_.monto,0),l=p.filter(U=>U.estado==="vigente").reduce((U,_)=>U+_.monto,0),f=p.filter(U=>U.estado==="vencida").reduce((U,_)=>U+_.monto,0),y=n.ocs||[],h=n.recepciones||[],v=n.evaluaciones||[],A=y.filter(U=>U.estado==="pendiente"),z=y.filter(U=>U.estado==="enviada"||U.estado==="parcial"),k=y.filter(U=>U.estado!=="cancelada").reduce((U,_)=>U+_.total,0),T=o.vehiculos||[];o.partesKm;const C=o.tanqueos||[],D=o.docVehs||[],K=o.mantos||[],oe=T.filter(U=>U.estado==="activo").length,te=T.filter(U=>U.estado==="taller").length,P=D.filter(U=>U.fechaVence&&U.fechaVence<a),ie=K.filter(U=>U.estado==="programado"&&U.fechaProg&&U.fechaProg<a),me=new Date;me.setDate(me.getDate()+30);const Q=me.toISOString().split("T")[0],je=D.filter(U=>U.fechaVence&&U.fechaVence>=a&&U.fechaVence<=Q),re=(()=>{const U=new Date,_=`${U.getFullYear()}-${String(U.getMonth()+1).padStart(2,"0")}`;return C.filter(ce=>{var ve;return(ve=ce.fecha)==null?void 0:ve.startsWith(_)}).reduce((ce,ve)=>ce+ve.valorTotal,0)})(),J=t.deals||[],M=J.filter(U=>U.estado==="Ganada"),B=M.reduce((U,_)=>U+(_.presupuestoFinal||_.presupuesto||0),0),V=J.filter(U=>["Contacto","Visita","Propuesta","Negociacin"].includes(U.estado)),X=V.reduce((U,_)=>U+(_.presupuesto||0),0),R=ln("habitaris_proy"),W=R["hab:proyectos:lista"]||[],se=R["hab:proyectos:actividades"]||[],le=R["hab:proyectos:hitos"]||[],de=W.filter(U=>U.estado==="activo"),Z=W.filter(U=>U.estado==="completado"),ue=de.map(U=>{const _=se.filter(ve=>ve.proyectoId===U.id),ce=_.length>0?_.reduce((ve,Ie)=>ve+(Ie.avance||0),0)/_.length:0;return{id:U.id,nombre:U.nombre,avance:Math.round(ce),acts:_.length,fin:U.fin}}),N=ue.length>0?Math.round(ue.reduce((U,_)=>U+_.avance,0)/ue.length):0,G=le.filter(U=>U.completado).length,L=le.filter(U=>!U.completado).length,ae=ue.filter(U=>{if(!U.fin)return!1;const _=Math.round((new Date(U.fin)-new Date)/864e5);return _<0||_<30&&U.avance<70}),he=ln("habitaris_formularios").forms||[],ze=[];for(let U=0;U<localStorage.length;U++){const _=localStorage.key(U);if(_&&_.startsWith("shared:hab:briefing:"))try{ze.push(JSON.parse(localStorage.getItem(_)))}catch{}}const q=(()=>{try{return JSON.parse(localStorage.getItem("hab:form:procesados")||"[]")}catch{return[]}})(),I=ze.filter(U=>!q.includes(U.id)),$={};I.forEach(U=>{const _=he.find(ve=>ve.id===U.formularioId),ce=(_==null?void 0:_.modulo)||"general";$[ce]||($[ce]=[]),$[ce].push({...U,_formNombre:(_==null?void 0:_.nombre)||U.formularioNombre||"Formulario"})});const H=[];return Object.entries($).forEach(([U,_])=>{const ce=U==="crm"?"CRM":U==="sst"?"SST":U.charAt(0).toUpperCase()+U.slice(1);H.push({mod:U,sev:"alta",icon:"",msg:`${_.length} formulario${_.length>1?"s":""} sin asignar en ${ce}`,color:Ae.purple,isForm:!0,count:_.length})}),g>0&&H.push({mod:"admin",sev:"alta",icon:"",msg:`${x.filter(U=>U.estado==="vencida").length} CxC vencidas por $${kt(g)}`,color:Ae.red}),f>0&&H.push({mod:"admin",sev:"alta",icon:"",msg:`${p.filter(U=>U.estado==="vencida").length} CxP vencidas por $${kt(f)}`,color:Ae.red}),w.length>0&&H.push({mod:"admin",sev:"media",icon:"",msg:`${w.length} legalizaciones tarjeta pendientes ($${kt(w.reduce((U,_)=>U+_.monto,0))})`,color:Ae.amber}),S.length>0&&H.push({mod:"admin",sev:"media",icon:"",msg:`${S.length} solicitudes viticos pendientes`,color:Ae.amber}),m.neto<0&&H.push({mod:"admin",sev:"alta",icon:"",msg:`Flujo caja negativo este mes: $${kt(m.neto)}`,color:Ae.red}),P.length>0&&H.push({mod:"flotas",sev:"alta",icon:"",msg:`${P.length} documentos vehiculares vencidos`,color:Ae.red}),je.length>0&&H.push({mod:"flotas",sev:"media",icon:"",msg:`${je.length} documentos por vencer en 30 das`,color:Ae.amber}),ie.length>0&&H.push({mod:"flotas",sev:"alta",icon:"",msg:`${ie.length} mantenimientos vencidos`,color:Ae.red}),te>0&&H.push({mod:"flotas",sev:"baja",icon:"",msg:`${te} vehculos en taller`,color:Ae.blue}),A.length>0&&H.push({mod:"compras",sev:"media",icon:"",msg:`${A.length} OCs pendientes de aprobacin ($${kt(A.reduce((U,_)=>U+_.total,0))})`,color:Ae.amber}),z.length>0&&H.push({mod:"compras",sev:"baja",icon:"",msg:`${z.length} OCs esperando recepcin`,color:Ae.blue}),ae.length>0&&H.push({mod:"proyectos",sev:"alta",icon:"",msg:`${ae.length} proyecto${ae.length>1?"s":""} con retraso: ${ae.map(U=>U.nombre).join(", ")}`,color:Ae.red}),L>0&&H.push({mod:"proyectos",sev:"baja",icon:"",msg:`${L} hito${L>1?"s":""} pendiente${L>1?"s":""}`,color:Ae.blue}),{admin:{saldoCajas:j,tarjetaPend:w.length,viaticosPend:S.length,flujoMes:m,cxcVigente:c,cxcVencida:g,cxpVigente:l,cxpVencida:f},compras:{total:y.length,pendientes:A.length,totalCompras:k,recepciones:h.length,evals:v.length},flotas:{total:T.length,activos:oe,taller:te,docsVencidos:P.length,docsPorVencer:je.length,mantosVencidos:ie.length,gastoCombustible:re},crm:{deals:J.length,ganados:M.length,totalVentas:B,pipeline:X,enCurso:V.length},proyectos:{total:W.length,activos:de.length,completados:Z.length,avancePromedio:N,actividades:se.length,hitosCompletos:G,hitosPendientes:L,retrasados:ae.length,avancesProy:ue},formularios:{total:ze.length,sinProcesar:I.length,sinProcesarPorModulo:$},alertas:H}},[])}function jm(){var p;const[t,i]=F.useState("general"),o=vm(),n=t==="general"?o.alertas:o.alertas.filter(c=>c.mod===t),a=n.filter(c=>c.sev==="alta"),r=({icon:c,label:g,value:l,sub:f,color:y,trend:h})=>e.jsx(uo,{style:{padding:"14px 16px",minWidth:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:[c," ",g]}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y||Ae.ink},children:l}),f&&e.jsx("div",{style:{fontSize:9,color:Ae.inkMid,marginTop:2},children:f})]}),h&&e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:h>=0?Ae.green:Ae.red,display:"flex",alignItems:"center",gap:2},children:[h>=0?e.jsx(Hi,{size:10}):e.jsx(Kc,{size:10})," ",h>=0?"+":"",h,"%"]})]})}),s=()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Ventas (ganadas)",value:`$${kt(o.crm.totalVentas)}`,sub:`${o.crm.ganados} proyectos ganados`,color:Ae.green}),e.jsx(r,{icon:"",label:"Pipeline activo",value:`$${kt(o.crm.pipeline)}`,sub:`${o.crm.enCurso} oportunidades`,color:Ae.blue}),e.jsx(r,{icon:"",label:"Flujo caja mes",value:`$${kt(o.admin.flujoMes.neto)}`,sub:`Ing: $${kt(o.admin.flujoMes.ing)}  Egr: $${kt(o.admin.flujoMes.egr)}`,color:o.admin.flujoMes.neto>=0?Ae.green:Ae.red}),e.jsx(r,{icon:"",label:"Compras activas",value:`$${kt(o.compras.totalCompras)}`,sub:`${o.compras.total} OCs  ${o.compras.pendientes} pendientes`,color:Ae.ink})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"CxC vigentes",value:`$${kt(o.admin.cxcVigente)}`,sub:o.admin.cxcVencida>0?` $${kt(o.admin.cxcVencida)} vencidas`:"",color:Ae.blue}),e.jsx(r,{icon:"",label:"CxP vigentes",value:`$${kt(o.admin.cxpVigente)}`,sub:o.admin.cxpVencida>0?` $${kt(o.admin.cxpVencida)} vencidas`:"",color:Ae.red}),e.jsx(r,{icon:"",label:"Flota",value:`${o.flotas.activos}/${o.flotas.total}`,sub:`${o.flotas.taller} en taller  $${kt(o.flotas.gastoCombustible)} combustible/mes`,color:Ae.ink}),e.jsx(r,{icon:"",label:"Saldo cajas chicas",value:`$${kt(o.admin.saldoCajas)}`,sub:`${o.admin.tarjetaPend} legaliz. pend.`,color:o.admin.saldoCajas>=0?Ae.green:Ae.red})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Proyectos activos",value:o.proyectos.activos,sub:`${o.proyectos.total} total  ${o.proyectos.completados} completados`,color:Ae.ink}),e.jsx(r,{icon:"",label:"Avance promedio",value:`${o.proyectos.avancePromedio}%`,color:o.proyectos.avancePromedio>=70?Ae.green:o.proyectos.avancePromedio>=40?Ae.amber:Ae.red}),e.jsx(r,{icon:"",label:"Retrasados",value:o.proyectos.retrasados,color:o.proyectos.retrasados>0?Ae.red:Ae.green}),e.jsx(r,{icon:"",label:"Formularios sin asignar",value:o.formularios.sinProcesar,color:o.formularios.sinProcesar>0?Ae.purple:Ae.green,sub:o.formularios.sinProcesar>0?Object.entries(o.formularios.sinProcesarPorModulo).map(([c,g])=>`${c}: ${g.length}`).join("  "):"Todo al da"})]}),o.formularios.sinProcesar>0&&e.jsx(uo,{style:{padding:"14px 18px",marginBottom:20,background:"#F3EEFF",border:"1px solid #5B3A8C33"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"#5B3A8C",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,flexShrink:0},children:o.formularios.sinProcesar}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#5B3A8C"},children:" Formularios sin asignar"}),e.jsxs("div",{style:{fontSize:10,color:"#7A5AAA",marginTop:2},children:[Object.entries(o.formularios.sinProcesarPorModulo).map(([c,g])=>{const l=c==="crm"?"CRM/Ofertas":c==="sst"?"SST":c.charAt(0).toUpperCase()+c.slice(1);return`${g.length} en ${l}`}).join("  "),"  ","Ve a ",e.jsx("strong",{children:"Formularios  Respuestas"})," para procesar"]})]})]})})]}),x={general:s,admin:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Saldo cajas chicas",value:`$${kt(o.admin.saldoCajas)}`,color:o.admin.saldoCajas>=0?Ae.green:Ae.red}),e.jsx(r,{icon:"",label:"Legaliz. pendientes",value:o.admin.tarjetaPend,color:o.admin.tarjetaPend>0?Ae.amber:Ae.green}),e.jsx(r,{icon:"",label:"Viticos pendientes",value:o.admin.viaticosPend,color:o.admin.viaticosPend>0?Ae.amber:Ae.green}),e.jsx(r,{icon:"",label:"Flujo neto mes",value:`$${kt(o.admin.flujoMes.neto)}`,color:o.admin.flujoMes.neto>=0?Ae.green:Ae.red})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"CxC vigentes",value:`$${kt(o.admin.cxcVigente)}`,color:Ae.blue}),e.jsx(r,{icon:"",label:"CxC vencidas",value:`$${kt(o.admin.cxcVencida)}`,color:o.admin.cxcVencida>0?Ae.red:Ae.green}),e.jsx(r,{icon:"",label:"CxP vigentes",value:`$${kt(o.admin.cxpVigente)}`,color:Ae.amber}),e.jsx(r,{icon:"",label:"CxP vencidas",value:`$${kt(o.admin.cxpVencida)}`,color:o.admin.cxpVencida>0?Ae.red:Ae.green})]})]}),compras:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total OCs",value:o.compras.total,color:Ae.ink}),e.jsx(r,{icon:"",label:"OCs pendientes",value:o.compras.pendientes,color:o.compras.pendientes>0?Ae.amber:Ae.green}),e.jsx(r,{icon:"",label:"Valor compras",value:`$${kt(o.compras.totalCompras)}`,color:Ae.ink}),e.jsx(r,{icon:"",label:"Recepciones",value:o.compras.recepciones,color:Ae.blue})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Evaluaciones proveedores",value:o.compras.evals,color:Ae.ink}),e.jsxs(uo,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:" Tasa de recepcin"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Ae.green},children:[o.compras.total>0?Math.round(o.compras.recepciones/o.compras.total*100):0,"%"]})]})]})]}),flotas:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total vehculos",value:o.flotas.total,sub:`${o.flotas.activos} activos`,color:Ae.ink}),e.jsx(r,{icon:"",label:"En taller",value:o.flotas.taller,color:o.flotas.taller>0?Ae.amber:Ae.green}),e.jsx(r,{icon:"",label:"Combustible mes",value:`$${kt(o.flotas.gastoCombustible)}`,color:Ae.red}),e.jsx(r,{icon:"",label:"Docs vencidos",value:o.flotas.docsVencidos,sub:`${o.flotas.docsPorVencer} por vencer`,color:o.flotas.docsVencidos>0?Ae.red:Ae.green})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Mantenimientos vencidos",value:o.flotas.mantosVencidos,color:o.flotas.mantosVencidos>0?Ae.red:Ae.green}),e.jsx(r,{icon:"",label:"Docs por vencer (30d)",value:o.flotas.docsPorVencer,color:o.flotas.docsPorVencer>0?Ae.amber:Ae.green})]})]}),rrhh:()=>e.jsx("div",{className:"fade-up",children:e.jsxs(uo,{style:{padding:20,textAlign:"center",color:Ae.inkMid},children:[e.jsx(Fi,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Los KPIs de RRHH se alimentan del mdulo de RRHH."}),e.jsxs("p",{style:{fontSize:10,color:Ae.inkXLight},children:["Viticos pendientes: ",o.admin.viaticosPend]})]})}),crm:()=>e.jsx("div",{className:"fade-up",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total ofertas",value:o.crm.deals,color:Ae.ink}),e.jsx(r,{icon:"",label:"Ganadas",value:o.crm.ganados,color:Ae.green}),e.jsx(r,{icon:"",label:"Ventas totales",value:`$${kt(o.crm.totalVentas)}`,color:Ae.green}),e.jsx(r,{icon:"",label:"Pipeline",value:`$${kt(o.crm.pipeline)}`,sub:`${o.crm.enCurso} activas`,color:Ae.blue})]})}),proyectos:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total proyectos",value:o.proyectos.total,sub:`${o.proyectos.activos} activos  ${o.proyectos.completados} completados`,color:Ae.ink}),e.jsx(r,{icon:"",label:"Avance promedio",value:`${o.proyectos.avancePromedio}%`,color:o.proyectos.avancePromedio>=70?Ae.green:o.proyectos.avancePromedio>=40?Ae.amber:Ae.red}),e.jsx(r,{icon:"",label:"Retrasados",value:o.proyectos.retrasados,color:o.proyectos.retrasados>0?Ae.red:Ae.green}),e.jsx(r,{icon:"",label:"Hitos",value:`${o.proyectos.hitosCompletos}/${o.proyectos.hitosCompletos+o.proyectos.hitosPendientes}`,sub:`${o.proyectos.hitosPendientes} pendientes`,color:Ae.blue})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Actividades totales",value:o.proyectos.actividades,color:Ae.ink}),e.jsxs(uo,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:" Tasa de completitud"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Ae.green},children:[o.proyectos.total>0?Math.round(o.proyectos.completados/o.proyectos.total*100):0,"%"]})]})]}),(o.proyectos.avancesProy||[]).length>0&&e.jsxs(uo,{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,marginBottom:10},children:" Avance por proyecto activo"}),o.proyectos.avancesProy.map(c=>e.jsxs("div",{style:{marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3},children:[e.jsx("span",{style:{fontSize:10,fontWeight:600},children:c.nombre}),e.jsxs("span",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:c.avance>=70?Ae.green:c.avance>=40?Ae.amber:Ae.red},children:[c.avance,"%"]})]}),e.jsx("div",{style:{height:8,background:Ae.accent,borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{width:`${c.avance}%`,height:"100%",borderRadius:4,background:c.avance>=70?Ae.green:c.avance>=40?Ae.amber:Ae.red,transition:"width .3s"}})}),e.jsxs("div",{style:{fontSize:8,color:Ae.inkLight,marginTop:2},children:[c.acts," actividades  Fin: ",c.fin||""]})]},c.id))]})]})}[t]||s;return e.jsxs(e.Fragment,{children:[e.jsx(bm,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Dashboard"}),e.jsxs("div",{style:{fontSize:10,color:Ae.inkMid},children:["Vista consolidada de la empresa  ",new Date().toLocaleDateString("es-CO",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:js.map((c,g)=>e.jsx("button",{onClick:()=>i(c.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${Ae.border}`,borderLeft:g>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:g===0?"6px 0 0 6px":g===js.length-1?"0 6px 6px 0":"0",background:t===c.id?c.color:"#fff",color:t===c.id?"#fff":Ae.inkMid},children:c.lbl},c.id))}),e.jsx(x,{}),n.length>0&&e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,marginBottom:10,display:"flex",alignItems:"center",gap:6},children:[e.jsx(si,{size:14,color:a.length>0?Ae.red:Ae.amber}),"Alertas ",t!=="general"&&` ${((p=js.find(c=>c.id===t))==null?void 0:p.lbl)||""}`,e.jsx(vs,{color:a.length>0?Ae.red:Ae.amber,children:n.length})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:n.sort((c,g)=>{const l={alta:0,media:1,baja:2};return(l[c.sev]||2)-(l[g.sev]||2)}).map((c,g)=>e.jsxs("div",{style:{background:c.sev==="alta"?Ae.redBg:c.sev==="media"?Ae.amberBg:Ae.blueBg,border:`1px solid ${c.color}33`,borderRadius:6,padding:"8px 14px",display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:16},children:c.icon}),e.jsx("div",{style:{flex:1,fontSize:10,fontWeight:600,color:c.color},children:c.msg}),e.jsx(vs,{color:c.color,children:c.sev}),t==="general"&&e.jsx(vs,{color:Ae.inkLight,children:c.mod})]},g))})]}),n.length===0&&e.jsxs(uo,{style:{textAlign:"center",padding:20,color:Ae.green,marginBottom:20},children:[e.jsx("div",{style:{fontSize:16,marginBottom:4},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Sin alertas activas"}),e.jsx("div",{style:{fontSize:10,color:Ae.inkMid},children:"Todo en orden"})]}),(t==="general"||t==="admin")&&e.jsxs(uo,{style:{marginBottom:20},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:12},children:" Flujo de caja empresa  Mes actual"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:16},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Ingresos"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Ae.green},children:["$",kt(o.admin.flujoMes.ing)]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Egresos"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Ae.red},children:["$",kt(o.admin.flujoMes.egr)]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Neto"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:o.admin.flujoMes.neto>=0?Ae.green:Ae.red},children:["$",kt(o.admin.flujoMes.neto)]})]})]}),e.jsxs("div",{style:{marginTop:12,height:16,background:Ae.accent,borderRadius:8,overflow:"hidden",display:"flex"},children:[o.admin.flujoMes.ing>0&&e.jsx("div",{style:{width:`${o.admin.flujoMes.ing/(o.admin.flujoMes.ing+o.admin.flujoMes.egr)*100}%`,background:Ae.green,borderRadius:"8px 0 0 8px",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:7,color:"#fff",fontWeight:700},children:"Ingresos"})}),o.admin.flujoMes.egr>0&&e.jsx("div",{style:{width:`${o.admin.flujoMes.egr/(o.admin.flujoMes.ing+o.admin.flujoMes.egr)*100}%`,background:Ae.red,borderRadius:"0 8px 8px 0",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:7,color:"#fff",fontWeight:700},children:"Egresos"})})]})]}),e.jsx("div",{style:{textAlign:"center",padding:"10px 0",fontSize:9,color:Ae.inkXLight},children:"Habitaris Suite  Dashboard actualizado en tiempo real desde localStorage"})]})]})}const eo="habitaris_config",fo={empresa:{nombre:"Habitaris",razonSocial:"Habitaris S.A.S.",nit:"901.922.136-8",eslogan:"Diseo  Interiorismo  Arquitectura",domicilio:"Bogot D.C.",telefono:"+57 350 5661545",web:"habitaris.co"},correo:{emailPrincipal:"comercial@habitaris.co",emailjs_serviceId:"service_6x3478l",emailjs_templateId:"template_lzgrxc6",emailjs_publicKey:"64nk2FHknwpLqc1p4"},app:{url:"https://habitaris-suite.vercel.app"},whatsapp:{numero:"573505661545",mensajePlantilla:`Hola {{nombre}},

 *{{formulario}}*

Te adjunto el formulario para que lo completes. brelo en tu navegador.

Gracias.

 {{empresa}}`},legal:{avisoPrivacidad:"En {{razonSocial}} (NIT {{nit}}, domicilio {{domicilio}}, email: {{email}}, tel: {{telefono}}), tratamos tus datos personales para procesar tu solicitud de briefing, enviar cotizaciones y gestionar proyectos. Cumplimos con la Ley 1581/2012 y Rgimen de Proteccin de Datos. Derechos (acceso, rectificacin, supresin, revocacin): va {{email}}.",habeasData:"Al enviar este formulario autorizo a {{razonSocial}}, para el uso de mis datos personales con el fin de elaborar propuestas de diseo, coordinar servicios relacionados y, en caso de ser necesario, compartirlos con proveedores o contratistas de confianza exclusivamente para la correcta ejecucin del proyecto. En todo momento se garantizar la confidencialidad y proteccin de mi informacin, conforme a la normativa de Habeas Data en Colombia (Ley 1581 de 2012).",confirmacion:"La informacin entregada es verdica y ser utilizada nicamente para la elaboracin de la propuesta de diseo. {{razonSocial}} garantiza la confidencialidad de los datos y no los compartir con terceros, salvo con proveedores o contratistas de confianza cuando sea necesario para la correcta ejecucin del proyecto, previa autorizacin del cliente."},formularios:{mensajeExitoDefault:"Gracias por completar el formulario. Nos pondremos en contacto pronto.",firmaEmail:`{{razonSocial}}
{{eslogan}}`},apariencia:{logo:"",colorPrimario:"#111111",colorSecundario:"#3B3B3B",colorAcento:"#C9A84C",tipografia:"DM Sans",slogan:"Diseo  Interiorismo  Arquitectura"},supabase:{url:"https://xlzkasdskatnikuavefh.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM"}};function Ai(){var t,i,o,n,a,r;try{const s=localStorage.getItem(eo);if(!s){localStorage.setItem(eo,JSON.stringify(fo));try{(i=(t=window.storage)==null?void 0:t.set)==null||i.call(t,eo,JSON.stringify(fo))}catch{}return fo}const d=JSON.parse(s),u=jc(fo,d);(o=u.supabase)!=null&&o.url||(u.supabase={...u.supabase,url:fo.supabase.url}),(n=u.supabase)!=null&&n.anonKey||(u.supabase={...u.supabase,anonKey:fo.supabase.anonKey}),localStorage.setItem(eo,JSON.stringify(u));try{(r=(a=window.storage)==null?void 0:a.set)==null||r.call(a,eo,JSON.stringify(u))}catch{}return u}catch{return fo}}function Sm(t,i){if(!t)return t;const o=i||Ai();return t.replace(/\{\{razonSocial\}\}/g,o.empresa.razonSocial).replace(/\{\{nit\}\}/g,o.empresa.nit).replace(/\{\{domicilio\}\}/g,o.empresa.domicilio).replace(/\{\{email\}\}/g,o.correo.emailPrincipal).replace(/\{\{telefono\}\}/g,o.empresa.telefono).replace(/\{\{empresa\}\}/g,o.empresa.nombre).replace(/\{\{eslogan\}\}/g,o.empresa.eslogan).replace(/\{\{web\}\}/g,o.empresa.web)}function jc(t,i){const o={...t};for(const n of Object.keys(i))i[n]&&typeof i[n]=="object"&&!Array.isArray(i[n])&&t[n]?o[n]=jc(t[n],i[n]):o[n]=i[n];return o}const Ue={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",green:"#111111",greenBg:"#E8F4EE",blue:"#3B3B3B",blueBg:"#F0F0F0",amber:"#8C6A00",amberBg:"#FFF4E0",red:"#B91C1C",redBg:"#FAE8E8",purple:"#5B3A8C",gold:"#C9A84C",shadow:"0 1px 4px rgba(0,0,0,.06)"},Cm={fontFamily:"'DM Sans',sans-serif"},Ss=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Ue.surface,border:`1px solid ${Ue.border}`,borderRadius:8,padding:16,boxShadow:Ue.shadow,...i},...o,children:t}),fr=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${Ue.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?Ue.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),la={border:`1px solid ${Ue.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff",width:"100%"},bd=[{id:"empresa",label:"Empresa",icon:Ad,color:Ue.ink},{id:"correo",label:"Correo / EmailJS",icon:En,color:Ue.blue},{id:"app",label:"App / Deploy",icon:Yc,color:Ue.green},{id:"whatsapp",label:"WhatsApp",icon:xr,color:"#25D366"},{id:"legal",label:"Textos legales",icon:Tn,color:Ue.red},{id:"formularios",label:"Formularios",icon:At,color:Ue.purple},{id:"apariencia",label:"Marca / Apariencia",icon:Xc,color:Ue.gold},{id:"supabase",label:"Base de datos",icon:nr,color:"#3ECF8E"}],km={empresa:[{key:"nombre",label:"Nombre comercial",placeholder:"Habitaris"},{key:"razonSocial",label:"Razn social",placeholder:"Habitaris S.A.S."},{key:"nit",label:"NIT",placeholder:"901.922.136-8"},{key:"eslogan",label:"Eslogan / Subttulo",placeholder:"Diseo  Interiorismo  Arquitectura"},{key:"domicilio",label:"Domicilio",placeholder:"Bogot D.C."},{key:"telefono",label:"Telfono principal",placeholder:"+57 350 5661545"},{key:"web",label:"Sitio web / dominio",placeholder:"habitaris.co"}],correo:[{key:"emailPrincipal",label:"Email principal (remitente)",placeholder:"comercial@habitaris.co"},{key:"emailjs_serviceId",label:"EmailJS Service ID",placeholder:"service_xxxxxxx"},{key:"emailjs_templateId",label:"EmailJS Template ID",placeholder:"template_xxxxxxx"},{key:"emailjs_publicKey",label:"EmailJS Public Key",placeholder:"xxxxxxxxxxxxxxxxx"}],app:[{key:"url",label:"URL de la app (Vercel)",placeholder:"https://habitaris-suite.vercel.app"}],whatsapp:[{key:"numero",label:"Nmero WhatsApp (con cdigo pas)",placeholder:"573505661545"},{key:"mensajePlantilla",label:"Mensaje plantilla",placeholder:`Hola {{nombre}},
 *{{formulario}}*...`,area:!0}],legal:[{key:"avisoPrivacidad",label:"Aviso de privacidad",placeholder:"En {{razonSocial}} (NIT {{nit}}...",area:!0},{key:"habeasData",label:"Autorizacin habeas data (Ley 1581)",placeholder:"Al enviar este formulario autorizo a {{razonSocial}}...",area:!0},{key:"confirmacion",label:"Texto de confirmacin",placeholder:"La informacin entregada es verdica...",area:!0}],formularios:[{key:"mensajeExitoDefault",label:"Mensaje de xito por defecto",placeholder:"Gracias por completar el formulario."},{key:"firmaEmail",label:"Firma en emails",placeholder:`{{razonSocial}}
{{eslogan}}`,area:!0}],apariencia:[{key:"colorPrimario",label:"Color primario (header, botones)",placeholder:"#111111",color:!0},{key:"colorSecundario",label:"Color secundario (enlaces, badges)",placeholder:"#3B3B3B",color:!0},{key:"colorAcento",label:"Color acento (destacados, progreso)",placeholder:"#C9A84C",color:!0},{key:"slogan",label:"Slogan / Tagline",placeholder:"Diseo  Interiorismo  Arquitectura"}],supabase:[{key:"url",label:"Project URL",placeholder:"https://xxxxx.supabase.co"},{key:"anonKey",label:"Anon Public Key",placeholder:"eyJhbGciOiJIUzI1NiIs..."}]};function wm(){var m,x;const[t,i]=F.useState(()=>Ai()),[o,n]=F.useState("empresa"),[a,r]=F.useState(!1),[s,d]=F.useState(!1),u=(p,c,g)=>{i(l=>({...l,[p]:{...l[p],[c]:g}})),d(!0),r(!1)},b=()=>{var p,c;localStorage.setItem(eo,JSON.stringify(t));try{(c=(p=window.storage)==null?void 0:p.set)==null||c.call(p,eo,JSON.stringify(t))}catch{}d(!1),r(!0),setTimeout(()=>r(!1),3e3)},j=()=>{var p,c;if(confirm("Restablecer toda la configuracin a los valores por defecto? Se perdern los cambios.")){localStorage.removeItem(eo);try{(c=(p=window.storage)==null?void 0:p.delete)==null||c.call(p,eo)}catch{}i(fo),d(!1)}},w=bd.find(p=>p.id===o),S=km[o]||[];return e.jsxs("div",{style:{...Cm,maxWidth:1100,margin:"0 auto",padding:"20px 16px 80px"},children:[e.jsx("style",{children:`
        .fade-up{animation:fadeUp .3s ease}
        @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .cfg-inp:focus{outline:none;border-color:${Ue.green}!important;box-shadow:0 0 0 2px ${Ue.green}22}
      `}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:22,fontWeight:700},children:" Configuracin"}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:11,color:Ue.inkMid},children:"Ajustes generales de la aplicacin  Todos los mdulos leen de aqu"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s&&e.jsx("span",{style:{fontSize:9,color:Ue.amber,fontWeight:600},children:" Sin guardar"}),a&&e.jsx("span",{style:{fontSize:9,color:Ue.green,fontWeight:600},children:" Guardado"}),e.jsxs(fr,{v:"sec",on:j,children:[e.jsx(Jc,{size:10})," Restablecer"]}),e.jsxs(fr,{on:b,children:[e.jsx(Co,{size:10})," Guardar configuracin"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx(Ss,{style:{padding:8},children:bd.map(p=>{const c=p.icon,g=o===p.id;return e.jsxs("button",{onClick:()=>n(p.id),style:{display:"flex",alignItems:"center",gap:8,width:"100%",padding:"8px 10px",border:"none",borderRadius:6,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:g?"#111":"transparent",color:g?"#fff":Ue.inkMid,fontSize:11,fontWeight:g?700:500,textAlign:"left",transition:"all .15s",marginBottom:2},children:[e.jsx(c,{size:13,color:g?"#fff":p.color}),p.label]},p.id)})}),e.jsxs(Ss,{style:{marginTop:12,padding:"12px 14px",background:Ue.blueBg,border:`1px solid ${Ue.blue}22`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ue.blue,textTransform:"uppercase",marginBottom:4},children:" Variables dinmicas"}),e.jsxs("div",{style:{fontSize:9,color:Ue.blue,lineHeight:1.6},children:["En textos legales puedes usar:",e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{razonSocial}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{nit}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{email}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{telefono}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{domicilio}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{empresa}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{eslogan}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{web}}"}),e.jsx("br",{}),"Se reemplazan automticamente."]})]})]}),e.jsx("div",{style:{flex:1},className:"fade-up",children:e.jsxs(Ss,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[w&&e.jsx(w.icon,{size:16,color:w.color}),e.jsx("h2",{style:{margin:0,fontSize:16,fontWeight:700},children:w==null?void 0:w.label})]}),o==="apariencia"&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:20,borderBottom:`1px solid ${Ue.border}`,paddingBottom:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:8},children:" Logo de la empresa"}),e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:[e.jsx("div",{style:{width:120,height:60,border:`2px dashed ${Ue.border}`,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",background:"#fff",flexShrink:0},children:(m=t.apariencia)!=null&&m.logo?e.jsx("img",{src:t.apariencia.logo,alt:"Logo",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}):e.jsx("span",{style:{fontSize:9,color:Ue.inkLight},children:"Sin logo"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("input",{type:"file",accept:"image/png,image/svg+xml,image/jpeg",onChange:p=>{var l;const c=(l=p.target.files)==null?void 0:l[0];if(!c)return;if(c.size>5e5){alert("El logo debe pesar menos de 500KB");return}const g=new FileReader;g.onload=f=>u("apariencia","logo",f.target.result),g.readAsDataURL(c)},style:{fontSize:10,marginBottom:6}}),e.jsx("div",{style:{fontSize:8,color:Ue.inkLight},children:"PNG, SVG o JPG  mx 500KB  Se usa en header, formularios, PDFs y emails"}),((x=t.apariencia)==null?void 0:x.logo)&&e.jsx("button",{onClick:()=>u("apariencia","logo",""),style:{marginTop:4,fontSize:9,color:Ue.red,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar logo"})]})]})]})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:14},children:S.map(p=>{var c,g,l,f;return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:4,letterSpacing:.5},children:p.label}),p.color?e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"color",value:((c=t[o])==null?void 0:c[p.key])||p.placeholder,onChange:y=>u(o,p.key,y.target.value),style:{width:40,height:32,border:"none",borderRadius:4,cursor:"pointer"}}),e.jsx("input",{className:"cfg-inp",value:((g=t[o])==null?void 0:g[p.key])||"",onChange:y=>u(o,p.key,y.target.value),placeholder:p.placeholder,style:{...la,width:140,fontFamily:"'DM Mono',monospace",fontSize:10}})]}):p.area?e.jsx("textarea",{className:"cfg-inp",rows:4,value:((l=t[o])==null?void 0:l[p.key])||"",onChange:y=>u(o,p.key,y.target.value),placeholder:p.placeholder,style:{...la,resize:"vertical",lineHeight:1.6}}):e.jsx("input",{className:"cfg-inp",value:((f=t[o])==null?void 0:f[p.key])||"",onChange:y=>u(o,p.key,y.target.value),placeholder:p.placeholder,style:la})]},p.key)})}),o==="legal"&&e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ue.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:8},children:" Vista previa (variables reemplazadas)"}),S.map(p=>{var c;return e.jsxs("div",{style:{marginBottom:10,padding:"8px 12px",background:Ue.bg,borderRadius:4,border:`1px solid ${Ue.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ue.inkLight,marginBottom:3},children:p.label}),e.jsx("div",{style:{fontSize:10,color:Ue.ink,lineHeight:1.5,whiteSpace:"pre-wrap"},children:Sm(((c=t.legal)==null?void 0:c[p.key])||"",t)})]},p.key)})]}),o==="apariencia"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ue.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:8},children:" Tipografa"}),e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=DM Sans:wght@400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap');"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:["DM Sans","Inter","Poppins","DM Sans","Playfair Display"].map(p=>{var g,l;const c=(((g=t.apariencia)==null?void 0:g.tipografia)||"DM Sans")===p;return e.jsxs("button",{onClick:()=>u("apariencia","tipografia",p),style:{padding:"10px 16px",borderRadius:8,cursor:"pointer",fontFamily:`'${p}',sans-serif`,border:c?`2px solid ${((l=t.apariencia)==null?void 0:l.colorPrimario)||"#111"}`:`1px solid ${Ue.border}`,background:c?"#111":"#fff",color:c?"#fff":Ue.ink,fontSize:13,fontWeight:600,transition:"all .15s",minWidth:100,textAlign:"center"},children:[e.jsx("div",{children:p}),e.jsx("div",{style:{fontSize:9,fontWeight:400,marginTop:2,opacity:.6},children:"Aa Bb Cc 123"})]},p)})})]}),e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ue.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:8},children:" Paletas predefinidas"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[{name:"Elegante oscuro",p:"#111111",s:"#3B3B3B",a:"#C9A84C"},{name:"Profesional azul",p:"#1E3A5F",s:"#2E7D96",a:"#E8B931"},{name:"Natural verde",p:"#1B4332",s:"#52796F",a:"#D4A373"},{name:"Moderno violeta",p:"#2D1B69",s:"#5B3A8C",a:"#F4A261"},{name:"Clido terracota",p:"#6B3A2A",s:"#A0522D",a:"#DEB887"},{name:"Minimalista",p:"#333333",s:"#666666",a:"#999999"}].map(p=>e.jsxs("button",{onClick:()=>{u("apariencia","colorPrimario",p.p),u("apariencia","colorSecundario",p.s),u("apariencia","colorAcento",p.a)},style:{padding:"8px 12px",borderRadius:6,cursor:"pointer",border:`1px solid ${Ue.border}`,background:"#fff",fontFamily:"'DM Sans',sans-serif",textAlign:"center",transition:"all .15s"},children:[e.jsxs("div",{style:{display:"flex",gap:4,marginBottom:4,justifyContent:"center"},children:[e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.p}}),e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.s}}),e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.a}})]}),e.jsx("div",{style:{fontSize:8,color:Ue.inkMid,fontWeight:600},children:p.name})]},p.name))})]}),e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ue.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:8},children:" Vista previa en vivo"}),(()=>{var v,A,z,k;const p=t.apariencia||{},c=p.colorPrimario||"#111",g=p.colorSecundario||"#3B3B3B",l=p.colorAcento||"#C9A84C",f=p.tipografia||"DM Sans",y=p.slogan||((v=t.empresa)==null?void 0:v.eslogan)||"Diseo  Interiorismo  Arquitectura",h=((A=t.empresa)==null?void 0:A.nombre)||"Habitaris";return e.jsxs("div",{style:{borderRadius:10,overflow:"hidden",border:`1px solid ${Ue.border}`,boxShadow:"0 2px 12px rgba(0,0,0,.08)"},children:[e.jsxs("div",{style:{background:c,padding:"14px 20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p.logo?e.jsx("img",{src:p.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("div",{style:{fontFamily:`'${f}',sans-serif`,fontWeight:700,fontSize:14,letterSpacing:3,color:"#fff",textTransform:"uppercase"},children:h}),e.jsx("div",{style:{fontSize:7,letterSpacing:2,color:"rgba(255,255,255,.4)",textTransform:"uppercase",fontFamily:`'${f}',sans-serif`},children:y})]}),e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,.5)",fontFamily:`'${f}',sans-serif`},children:"Paso 1 de 5"})]}),e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${l},${l}88,${l})`}}),e.jsxs("div",{style:{padding:"20px 24px",background:"#fff"},children:[e.jsx("h3",{style:{fontFamily:`'${f}',sans-serif`,fontSize:16,fontWeight:700,margin:"0 0 4px",color:c},children:"Briefing Inicial"}),e.jsx("p",{style:{fontFamily:`'${f}',sans-serif`,fontSize:11,color:"#888",margin:"0 0 14px"},children:"Cuntanos sobre tu proyecto"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsx("div",{style:{padding:"6px 14px",borderRadius:16,background:c,color:"#fff",fontSize:10,fontWeight:600,fontFamily:`'${f}',sans-serif`},children:"Diseo interior"}),e.jsx("div",{style:{padding:"6px 14px",borderRadius:16,border:`1px solid ${Ue.border}`,color:Ue.inkMid,fontSize:10,fontWeight:400,fontFamily:`'${f}',sans-serif`},children:"Obra nueva"})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{style:{padding:"8px 20px",background:c,color:"#fff",border:"none",borderRadius:6,fontSize:11,fontWeight:700,fontFamily:`'${f}',sans-serif`,cursor:"default"},children:"Siguiente "}),e.jsx("button",{style:{padding:"8px 20px",background:"#fff",color:g,border:`1px solid ${g}44`,borderRadius:6,fontSize:11,fontWeight:600,fontFamily:`'${f}',sans-serif`,cursor:"default"},children:" Atrs"})]})]}),e.jsxs("div",{style:{padding:"10px 24px",background:Ue.bg,borderTop:`1px solid ${Ue.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontFamily:`'${f}',sans-serif`,fontSize:9,color:Ue.inkLight},children:[((z=t.empresa)==null?void 0:z.razonSocial)||"Empresa S.A.S.","  ",((k=t.empresa)==null?void 0:k.domicilio)||"Bogot"]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:c}}),e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:g}}),e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:l}})]})]})]})})()]})]}),o==="correo"&&e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ue.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:8},children:" Probar conexin"}),e.jsx(zm,{config:t})]}),o==="supabase"&&e.jsx("div",{style:{marginTop:20,borderTop:`1px solid ${Ue.border}`,paddingTop:14},children:e.jsx(Em,{config:t})})]})},o)]})]})}function zm({config:t}){const[i,o]=F.useState(""),[n,a]=F.useState(""),[r,s]=F.useState(!1),d=async()=>{if(i){s(!0),a("Enviando...");try{const u=await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:t.correo.emailjs_serviceId,template_id:t.correo.emailjs_templateId,user_id:t.correo.emailjs_publicKey,template_params:{client_name:"Test",client_email:i,form_name:"Email de prueba",from_name:t.empresa.nombre,form_link:"Este es un email de prueba desde Habitaris."}})});a(u.ok?" Email enviado correctamente":" Error: "+u.status)}catch(u){a(" Error: "+u.message)}s(!1)}};return e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase"},children:"Email de prueba"}),e.jsx("input",{value:i,onChange:u=>o(u.target.value),placeholder:"tu@email.com",style:la})]}),e.jsxs(fr,{on:d,disabled:r,style:{whiteSpace:"nowrap"},children:[e.jsx(En,{size:10})," ",r?"Enviando...":"Enviar test"]}),n&&e.jsx("span",{style:{fontSize:9,color:n.startsWith("")?Ue.green:n.startsWith("")?Ue.red:Ue.amber,fontWeight:600},children:n})]})}function Em({config:t}){var x,p,c,g;const[i,o]=F.useState(!1),[n,a]=F.useState(""),[r,s]=F.useState(!1),[d,u]=F.useState(null),[b,j]=F.useState(!1),w=async()=>{o(!0),a("Probando...");const l=await Zu();a(l.ok?" Conexin exitosa":" "+l.error),o(!1)},S=async()=>{s(!0),u(null);const l=await eh();u(l),s(!1)},m=((x=t.supabase)==null?void 0:x.url)&&((p=t.supabase)==null?void 0:p.anonKey);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#E8F8EE",border:"1px solid #3ECF8E33",borderRadius:6},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#1B7A4B",marginBottom:4},children:" Cmo configurar Supabase?"}),e.jsxs("div",{style:{fontSize:10,color:"#2D6A4F",lineHeight:1.6},children:["1. Ve a ",e.jsx("strong",{children:"supabase.com"}),"  Crea cuenta gratis",e.jsx("br",{}),"2. Nuevo proyecto  Nombre: ",e.jsx("code",{style:{fontSize:9},children:"habitaris-suite"}),"  Regin: So Paulo",e.jsx("br",{}),"3. Settings  API  Copia ",e.jsx("strong",{children:"Project URL"})," y ",e.jsx("strong",{children:"anon public"})," key",e.jsx("br",{}),"4. Pgalos arriba y guarda configuracin",e.jsx("br",{}),'5. Haz clic en "Crear tablas" abajo']})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:8},children:" Probar conexin"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs(fr,{on:w,v:m?"":"sec",disabled:i||!m,children:[e.jsx(nr,{size:10})," ",i?"Probando...":"Probar conexin"]}),n&&e.jsx("span",{style:{fontSize:9,fontWeight:600,color:n.startsWith("")?Ue.green:n.startsWith("")?Ue.red:Ue.amber},children:n}),!m&&e.jsx("span",{style:{fontSize:9,color:Ue.amber},children:" Primero configura URL y Key arriba"})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:8},children:" Crear tablas"}),e.jsxs("p",{style:{fontSize:10,color:Ue.inkMid,marginBottom:8},children:["Se crearn 3 tablas: ",e.jsx("code",{style:{fontSize:9},children:"form_events"})," (estadsticas), ",e.jsx("code",{style:{fontSize:9},children:"form_responses"})," (respuestas), ",e.jsx("code",{style:{fontSize:9},children:"form_links"})," (enlaces)."]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(fr,{on:S,v:"sec",disabled:r||!m,children:r?"Creando...":" Verificar / Crear tablas"}),e.jsxs("button",{onClick:()=>j(!b),style:{fontSize:9,color:Ue.blue,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textDecoration:"underline"},children:[b?"Ocultar":"Ver"," SQL manual"]})]}),d&&e.jsx("div",{style:{marginTop:10,padding:"10px 14px",borderRadius:6,background:d.ok?"#E8F8EE":"#FFF4E0",border:`1px solid ${d.ok?"#3ECF8E":"#F59E0B"}33`},children:d.ok?e.jsxs("span",{style:{fontSize:10,color:"#1B7A4B",fontWeight:600},children:[" ",d.msg||"Tablas listas"]}):d.error==="manual_sql"?e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:10,color:Ue.amber,fontWeight:600},children:[" Tablas faltantes: ",d.missing.join(", ")]}),e.jsx("p",{style:{fontSize:9,color:Ue.inkMid,marginTop:4},children:'Necesitas ejecutar el SQL manualmente en Supabase  SQL Editor. Haz clic en "Ver SQL manual" y copia el cdigo.'})]}):e.jsxs("span",{style:{fontSize:10,color:Ue.red,fontWeight:600},children:[" ",d.error]})}),b&&e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase"},children:"SQL para copiar en Supabase  SQL Editor"}),e.jsx("button",{onClick:()=>{var l;(l=navigator.clipboard)==null||l.writeText(Os()),alert(" SQL copiado")},style:{fontSize:9,color:Ue.blue,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Copiar"})]}),e.jsx("pre",{style:{fontSize:9,background:"#1a1a2e",color:"#e0e0e0",padding:14,borderRadius:6,overflow:"auto",maxHeight:300,lineHeight:1.5,fontFamily:"'DM Mono',monospace"},children:Os()})]})]}),m&&e.jsxs("div",{style:{padding:"10px 14px",background:Ue.bg,borderRadius:6,border:`1px solid ${Ue.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ue.inkMid,textTransform:"uppercase",marginBottom:6},children:"Estado de conexin"}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{fontSize:10},children:[e.jsx("span",{style:{color:"#3ECF8E",fontWeight:700},children:""})," URL: ",e.jsxs("code",{style:{fontSize:9},children:[(c=t.supabase.url)==null?void 0:c.replace("https://","").slice(0,20),"..."]})]}),e.jsxs("div",{style:{fontSize:10},children:[e.jsx("span",{style:{color:"#3ECF8E",fontWeight:700},children:""})," Key: ",e.jsxs("code",{style:{fontSize:9},children:[(g=t.supabase.anonKey)==null?void 0:g.slice(0,20),"..."]})]})]})]})]})}const Am=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),fe={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},gt=()=>Math.random().toString(36).slice(2,10),qi=()=>new Date().toISOString().split("T")[0],Fm={fontFamily:"'DM Sans',sans-serif"};function Cs(t,i){if(!(i!=null&&i.campos))return null;const o=i.campos.filter(m=>{var x;return(x=m.scoring)==null?void 0:x.enabled});if(o.length===0)return null;let n=0,a=0,r=0,s=0,d=0;const u=[];o.forEach(m=>{const x=m.scoring.weight||1,p=m.mapKey||m.id;let c=t[p];if(c===void 0)return;a+=x;const g=m.scoring.rules||{};let l="neutral";if(Array.isArray(c)){const y=c.map(h=>g[h]||"neutral");y.includes("red")?l="red":y.every(h=>h==="green")?l="green":l="neutral"}else l=g[String(c)]||"neutral";let f=0;l==="green"?(f=x,r++):l==="neutral"?(f=x*.5,d++):(f=0,s++),n+=f,u.push({label:m.label,value:Array.isArray(c)?c.join(", "):String(c),flag:l,points:f,maxPoints:x})});const b=a>0?Math.round(n/a*100)/10:0,j=b>=7?"green":b>=4?"yellow":"red";return{score:b,level:j,levelLabel:j==="green"?" Cliente potencial":j==="yellow"?" Revisar":" No califica",conclusion:j==="green"?"Perfil alineado con los servicios. Recomendacin: contactar en las prximas 24h.":j==="yellow"?"Algunos puntos requieren validacin. Recomendacin: agendar llamada exploratoria.":"Expectativas no alineadas con los servicios. Recomendacin: responder cortsmente y archivar.",greens:r,reds:s,yellows:d,totalPoints:n,maxPoints:a,details:u}}const Tm=async t=>{try{const i=Ai();return(await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:i.correo.emailjs_serviceId,template_id:i.correo.emailjs_templateId,user_id:i.correo.emailjs_publicKey,template_params:t})})).ok}catch{return!1}},Lt=({children:t,style:i,...o})=>e.jsx("div",{style:{background:fe.surface,border:`1px solid ${fe.border}`,borderRadius:8,padding:16,boxShadow:fe.shadow,...i},...o,children:t}),vo=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${fe.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?fe.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),tr=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),jt={border:`1px solid ${fe.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},Sa={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${fe.border}`,textAlign:"left"},Gt={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${fe.border}`},Gn="habitaris_formularios",yd=[{id:"dashboard",lbl:" Dashboard"},{id:"mis_forms",lbl:" Mis formularios"},{id:"constructor",lbl:" Constructor"},{id:"enviados",lbl:" Enviados"},{id:"respuestas",lbl:" Respuestas"},{id:"estadisticas",lbl:" Estadsticas"},{id:"plantillas",lbl:" Plantillas"}],Xr=[{tipo:"text",lbl:"Texto corto",icon:"",desc:"Una lnea de texto"},{tipo:"textarea",lbl:"Texto largo",icon:"",desc:"Prrafo multilnea"},{tipo:"number",lbl:"Nmero",icon:"",desc:"Valor numrico"},{tipo:"email",lbl:"Email",icon:"",desc:"Correo electrnico"},{tipo:"tel",lbl:"Telfono",icon:"",desc:"Nmero telefnico"},{tipo:"date",lbl:"Fecha",icon:"",desc:"Selector de fecha"},{tipo:"select",lbl:"Desplegable",icon:"",desc:"Lista de opciones"},{tipo:"radio",lbl:"Opcin nica",icon:"",desc:"Elegir una opcin"},{tipo:"chips",lbl:"Seleccin mltiple",icon:"",desc:"Elegir varias opciones"},{tipo:"rango",lbl:"Rango/Escala",icon:"",desc:"Rango numrico"},{tipo:"rating",lbl:"Valoracin",icon:"",desc:"Estrellas 1-5"},{tipo:"yesno",lbl:"S / No",icon:"",desc:"Pregunta de s o no"},{tipo:"seccion",lbl:"Seccin",icon:"",desc:"Encabezado de seccin"},{tipo:"info",lbl:"Texto informativo",icon:"",desc:"Prrafo informativo (sin respuesta)"}],Da=[{id:"general",lbl:"General"},{id:"crm",lbl:"CRM / Ofertas"},{id:"rrhh",lbl:"RRHH"},{id:"sst",lbl:"SST"},{id:"calidad",lbl:"Calidad"},{id:"postventa",lbl:"Postventa"},{id:"proyectos",lbl:"Proyectos"},{id:"logistica",lbl:"Logstica"},{id:"compras",lbl:"Compras"},{id:"flotas",lbl:"Flotas"},{id:"admin",lbl:"Administracin"}],Bm={Amazonas:["Leticia","Otra"],Antioquia:["Medelln","Bello","Envigado","Itag","Rionegro","Sabaneta","Apartad","Otra"],Arauca:["Arauca","Saravena","Otra"],Atlntico:["Barranquilla","Soledad","Malambo","Otra"],"Bogot D.C.":["Bogot"],Bolvar:["Cartagena","Magangu","Turbaco","Otra"],Boyac:["Tunja","Duitama","Sogamoso","Otra"],Caldas:["Manizales","Villamara","La Dorada","Otra"],Caquet:["Florencia","Otra"],Casanare:["Yopal","Aguazul","Otra"],Cauca:["Popayn","Santander de Quilichao","Otra"],Cesar:["Valledupar","Aguachica","Otra"],Choc:["Quibd","Otra"],Crdoba:["Montera","Ceret","Lorica","Otra"],Cundinamarca:["Soacha","Cha","Zipaquir","Facatativ","Girardot","Fusagasug","Mosquera","Madrid","Cajic","Otra"],Guaina:["Inrida","Otra"],Guaviare:["San Jos del Guaviare","Otra"],Huila:["Neiva","Pitalito","Garzn","Otra"],"La Guajira":["Riohacha","Maicao","Otra"],Magdalena:["Santa Marta","Cinaga","Otra"],Meta:["Villavicencio","Acacas","Granada","Otra"],Nario:["Pasto","Ipiales","Tumaco","Otra"],"Norte de Santander":["Ccuta","Ocaa","Pamplona","Otra"],Putumayo:["Mocoa","Puerto Ass","Otra"],Quindo:["Armenia","Calarc","Otra"],Risaralda:["Pereira","Dosquebradas","Santa Rosa de Cabal","Otra"],"San Andrs y Providencia":["San Andrs","Providencia","Otra"],Santander:["Bucaramanga","Floridablanca","Girn","Piedecuesta","Barrancabermeja","Otra"],Sucre:["Sincelejo","Corozal","Otra"],Tolima:["Ibagu","Espinal","Melgar","Otra"],"Valle del Cauca":["Cali","Palmira","Buenaventura","Tulu","Buga","Jamund","Yumbo","Otra"],Vaups:["Mit","Otra"],Vichada:["Puerto Carreo","Otra"]},Sc=[{id:"briefing_inicial",version:6,nombre:"Briefing Inicial Habitaris",modulo:"crm",desc:"Formulario completo de briefing para nuevos proyectos",campos:[{id:"f_privacidad",tipo:"info",label:"Aviso de Privacidad: En Habitaris SAS (NIT 901.922.136-8, domicilio Bogot D.C., email: comercial.co, tel: +57 350 5661545), tratamos tus datos personales para procesar tu solicitud de briefing, enviar cotizaciones y gestionar proyectos. Cumplimos con la Ley 1581/2012 y Rgimen de Proteccin de Datos. Derechos (acceso, rectificacin, supresin, revocacin): va comercial.co.",desc:"",required:!1,opciones:[],logica:null},{id:"f_acepta_priv",tipo:"yesno",label:"Aceptas el aviso de privacidad?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"aceptaPrivacidad"},{id:"s1",tipo:"seccion",label:"Datos del cliente",desc:"Informacin personal y de contacto",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_nombre",tipo:"text",label:"Nombre y apellidos",placeholder:"Escribe tu nombre completo",required:!0,opciones:[],logica:null,mapKey:"nombre"},{id:"f_tipo_doc_co",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["Cdula de ciudadana (CC)","Cdula de extranjera (CE)","NIT","Pasaporte"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_es",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["DNI","NIE","CIF","Pasaporte"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_mx",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["CURP","RFC","INE","Pasaporte"],logica:{fieldId:"f_pais",value:"Mxico"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_otro",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["Documento de identidad","Pasaporte","Otro"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa","Mxico"]},mapKey:"tipoDocumento"},{id:"f_num_doc",tipo:"text",label:"Nmero de documento",placeholder:"Ej: 1.234.567.890",required:!0,opciones:[],logica:null,mapKey:"numDocumento"},{id:"f_email",tipo:"email",label:"Correo electrnico",placeholder:"name@example.com",required:!0,opciones:[],logica:null,mapKey:"email"},{id:"f_pais",tipo:"select",label:"Pas del proyecto",placeholder:"",required:!0,opciones:["Colombia","Espaa","Mxico","Chile","Per","Ecuador","Argentina","Panam","Estados Unidos","Otro"],logica:null,mapKey:"pais"},{id:"f_tel",tipo:"tel_combo",label:"Telfono de contacto",placeholder:"Ej: 3505661545",required:!0,opciones:["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"],logica:null,mapKey:"telefono",codMapKey:"codigoTel",paisRef:"f_pais"},{id:"f_propietario",tipo:"select",label:"Cul es tu relacin con el inmueble?",placeholder:"",required:!0,opciones:["Soy el propietario","Estoy en arriendo","Acto en nombre del propietario","Acto en nombre de un tercero"],logica:null,mapKey:"propietario",scoring:{enabled:!0,weight:2,rules:{"Soy el propietario":"green","Estoy en arriendo":"neutral","Acto en nombre del propietario":"red","Acto en nombre de un tercero":"red"}}},{id:"s3",tipo:"seccion",label:"Ubicacin del proyecto",desc:"Dnde est el inmueble?",required:!1,opciones:[],logica:null},{id:"f_depto_co",tipo:"select",label:"Departamento",placeholder:"",required:!0,opciones:["Amazonas","Antioquia","Arauca","Atlntico","Bogot D.C.","Bolvar","Boyac","Caldas","Caquet","Casanare","Cauca","Cesar","Choc","Crdoba","Cundinamarca","Guaina","Guaviare","Huila","La Guajira","Magdalena","Meta","Nario","Norte de Santander","Putumayo","Quindo","Risaralda","San Andrs y Providencia","Santander","Sucre","Tolima","Valle del Cauca","Vaups","Vichada"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"departamento"},{id:"f_depto_es",tipo:"select",label:"Comunidad autnoma",placeholder:"",required:!0,opciones:["Andaluca","Aragn","Asturias","Baleares","Canarias","Cantabria","Castilla-La Mancha","Castilla y Len","Catalua","Ceuta","Comunidad Valenciana","Extremadura","Galicia","La Rioja","Madrid","Melilla","Murcia","Navarra","Pas Vasco"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"departamento"},{id:"f_depto_mx",tipo:"select",label:"Estado",placeholder:"",required:!0,opciones:["Aguascalientes","Baja California","Baja California Sur","Campeche","Chiapas","Chihuahua","Ciudad de Mxico","Coahuila","Colima","Durango","Estado de Mxico","Guanajuato","Guerrero","Hidalgo","Jalisco","Michoacn","Morelos","Nayarit","Nuevo Len","Oaxaca","Puebla","Quertaro","Quintana Roo","San Luis Potos","Sinaloa","Sonora","Tabasco","Tamaulipas","Tlaxcala","Veracruz","Yucatn","Zacatecas"],logica:{fieldId:"f_pais",value:"Mxico"},mapKey:"departamento"},{id:"f_depto_otro",tipo:"text",label:"Regin / Estado / Provincia",placeholder:"Escribe tu regin",required:!0,opciones:[],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa","Mxico"]},mapKey:"departamento"},{id:"f_ciudad_co",tipo:"select",label:"Ciudad o poblacin",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"ciudad",dynamicOpciones:{dependsOn:"f_depto_co",map:Bm}},{id:"f_ciudad_otro",tipo:"text",label:"Ciudad o poblacin",placeholder:"Escribe la ciudad",required:!0,opciones:[],logica:{fieldId:"f_pais",notValue:"Colombia"},mapKey:"ciudad"},{id:"f_direccion",tipo:"text",label:"Direccin del proyecto",placeholder:"Ej: Calle 100 #15-20 / Av. de la Constitucin 5",required:!0,opciones:[],logica:null,mapKey:"direccion"},{id:"f_tipo_vivienda",tipo:"select",label:"Tipo de inmueble",placeholder:"",required:!0,opciones:["Apartamento","Casa","Local comercial","Oficina","Finca / Rural","Otro"],logica:null,mapKey:"tipoVivienda"},{id:"f_num_apto",tipo:"text",label:"Nmero de apartamento / piso",placeholder:"Ej: Apto 501, Piso 3",required:!0,opciones:[],logica:{fieldId:"f_tipo_vivienda",value:"Apartamento"},mapKey:"numApto"},{id:"f_edificio",tipo:"text",label:"Nombre del edificio, conjunto o urbanizacin",placeholder:"Ej: Edificio Torres del Parque",required:!1,opciones:[],logica:null,mapKey:"edificio"},{id:"f_cod_postal",tipo:"text",label:"Cdigo postal",placeholder:"Ej: 110111",required:!1,opciones:[],logica:null,mapKey:"codigoPostal"},{id:"s3b",tipo:"seccion",label:"Datos del inmueble",desc:"Caractersticas del espacio",required:!1,opciones:[],logica:null},{id:"f_area",tipo:"text",label:"rea aproximada en m",placeholder:"Ej: 85",required:!0,opciones:[],logica:null,mapKey:"area"},{id:"f_habitaciones",tipo:"text",label:"Nmero de habitaciones/reas a intervenir",placeholder:"Ej: 3",required:!0,opciones:[],logica:null,mapKey:"habitaciones"},{id:"f_espacios",tipo:"chips",label:"Qu espacios incluye el proyecto?",placeholder:"",required:!0,opciones:["Sala","Comedor","Cocina","Habitaciones","Baos","Terraza / Balcn","Estudio / Oficina","Local comercial","Jardn / Patio","Fachada"],logica:null,mapKey:"espacios"},{id:"s2",tipo:"seccion",label:"Sobre el servicio",desc:"Qu necesitas?",required:!1,opciones:[],logica:null},{id:"f_servicio",tipo:"chips",label:"Qu servicio te interesa?",placeholder:"",required:!0,opciones:["Diseo arquitectnico / Obra nueva","Diseo arquitectnico / Reforma","Interiorismo / Diseo de interiores","Biointeriorismo","Supervisin de obra (Presencial)","Supervisin de obra (Online)","Asesora de Compras"],logica:null,mapKey:"servicios"},{id:"f_tipo_proy",tipo:"select",label:"El proyecto es residencial, comercial o rural?",placeholder:"",required:!0,opciones:["Residencial","Comercial","Rural"],logica:null,mapKey:"tipoProyecto"},{id:"s4",tipo:"seccion",label:"Estilo y diseo",desc:"Tus preferencias estticas",required:!1,opciones:[],logica:null},{id:"f_estilo",tipo:"chips",label:"Estilo preferido",placeholder:"",required:!0,opciones:["Bio-natural / Orgnico","Bohemio","Clsico","Escandinavo","Industrial","Minimalista","Moderno","Rstico","Otro"],logica:null,mapKey:"estilo"},{id:"f_colores",tipo:"textarea",label:"Colores, materiales y elementos clave",placeholder:"Describe los colores y materiales que te gustan...",required:!0,opciones:[],logica:null,mapKey:"colores"},{id:"f_links_ref",tipo:"textarea",label:"Pega aqu los links de tus ideas o referentes (Pinterest, Instagram, etc.)",placeholder:"https://...",required:!1,opciones:[],logica:null,mapKey:"linksReferentes"},{id:"s5",tipo:"seccion",label:"Expectativas del proyecto",desc:"Qu esperas lograr?",required:!1,opciones:[],logica:null},{id:"f_lograr",tipo:"chips",label:"Qu esperas lograr con este proyecto?",placeholder:"",required:!0,opciones:["Inspiracin o ideas generales","Planos base y distribucin funcional","Diseo integral con renders, acabados y mobiliario","Supervisin y acompaamiento durante la ejecucin"],logica:null,mapKey:"expectativas",scoring:{enabled:!0,weight:3,rules:{"Inspiracin o ideas generales":"red","Planos base y distribucin funcional":"neutral","Diseo integral con renders, acabados y mobiliario":"green","Supervisin y acompaamiento durante la ejecucin":"green"}}},{id:"f_importante",tipo:"chips",label:"Lo ms importante para ti en el proyecto",placeholder:"",required:!0,opciones:["Esttica / Diseo","Funcionalidad","Presupuesto ajustado","Tiempo de entrega","Exclusividad / Personalizacin"],logica:null,mapKey:"prioridades",scoring:{enabled:!0,weight:2,rules:{"Esttica / Diseo":"green",Funcionalidad:"green","Presupuesto ajustado":"red","Tiempo de entrega":"neutral","Exclusividad / Personalizacin":"green"}}},{id:"s6",tipo:"seccion",label:"Presupuesto y financiacin",desc:"Informacin econmica del proyecto",required:!1,opciones:[],logica:null},{id:"f_presupuesto_co",tipo:"select",label:"Presupuesto estimado (COP)",placeholder:"",required:!0,opciones:["Menos de $10.000.000","$10.000.000 - $30.000.000","$30.000.000 - $60.000.000","$60.000.000 - $100.000.000","Ms de $100.000.000"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de $10.000.000":"red","$10.000.000 - $30.000.000":"neutral","$30.000.000 - $60.000.000":"green","$60.000.000 - $100.000.000":"green","Ms de $100.000.000":"green"}}},{id:"f_presupuesto_es",tipo:"select",label:"Presupuesto estimado (EUR)",placeholder:"",required:!0,opciones:["Menos de 10.000","10.000 - 30.000","30.000 - 60.000","60.000 - 100.000","Ms de 100.000"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de 10.000":"red","10.000 - 30.000":"neutral","30.000 - 60.000":"green","60.000 - 100.000":"green","Ms de 100.000":"green"}}},{id:"f_presupuesto_otro",tipo:"select",label:"Presupuesto estimado (USD)",placeholder:"",required:!0,opciones:["Menos de $5.000","$5.000 - $15.000","$15.000 - $30.000","$30.000 - $50.000","Ms de $50.000"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa"]},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de $5.000":"red","$5.000 - $15.000":"neutral","$15.000 - $30.000":"green","$30.000 - $50.000":"green","Ms de $50.000":"green"}}},{id:"f_honorarios",tipo:"select",label:"Tu presupuesto incluye los honorarios de diseo?",placeholder:"",required:!0,opciones:["S, incluye diseo y ejecucin","Solo ejecucin/materiales, el diseo aparte","No, espero que el diseo est incluido sin costo","No estoy seguro"],logica:null,mapKey:"honorariosDiseo",scoring:{enabled:!0,weight:5,rules:{"S, incluye diseo y ejecucin":"green","Solo ejecucin/materiales, el diseo aparte":"green","No, espero que el diseo est incluido sin costo":"red","No estoy seguro":"neutral"}}},{id:"f_financiar",tipo:"select",label:"Cmo planeas financiar el proyecto?",placeholder:"",required:!0,opciones:["Con recursos propios","Crdito bancario o leasing habitacional","Con apoyo de un tercero","An no lo tengo definido"],logica:null,mapKey:"financiacion",scoring:{enabled:!0,weight:3,rules:{"Con recursos propios":"green","Crdito bancario o leasing habitacional":"neutral","Con apoyo de un tercero":"neutral","An no lo tengo definido":"red"}}},{id:"f_invertido",tipo:"select",label:"Has invertido antes en diseo profesional?",placeholder:"",required:!0,opciones:["S","No, pero estoy dispuesto","No, nunca lo hara"],logica:null,mapKey:"inversionPrevia",scoring:{enabled:!0,weight:3,rules:{S:"green","No, pero estoy dispuesto":"neutral","No, nunca lo hara":"red"}}},{id:"f_gratuito",tipo:"select",label:"Esperas que el diseo sea gratuito o solo de referencia?",placeholder:"",required:!0,opciones:["S, solo busco ideas generales","No, estoy dispuesto a pagar por un diseo profesional"],logica:null,mapKey:"expectativaPago",scoring:{enabled:!0,weight:4,rules:{"S, solo busco ideas generales":"red","No, estoy dispuesto a pagar por un diseo profesional":"green"}}},{id:"f_exceder",tipo:"select",label:"Aceptaras una propuesta que supere tu presupuesto, si garantiza calidad y durabilidad?",placeholder:"",required:!0,opciones:["S, puedo ajustarme","No, solo lo hago si es ms barato"],logica:null,mapKey:"flexibilidad",scoring:{enabled:!0,weight:4,rules:{"S, puedo ajustarme":"green","No, solo lo hago si es ms barato":"red"}}},{id:"f_anticipo",tipo:"yesno",label:"Dispuesto a pagar anticipo 30-50%?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"anticipo",scoring:{enabled:!0,weight:5,rules:{S:"green",No:"red"}}},{id:"f_contratistas",tipo:"select",label:"Quieres que te recomendemos contratistas de confianza para la obra?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"contratistas"},{id:"s7",tipo:"seccion",label:"Plazos",desc:"Tiempos del proyecto",required:!1,opciones:[],logica:null},{id:"f_plazo",tipo:"select",label:"Plazo esperado para finalizacin",placeholder:"",required:!0,opciones:["1 - 3 meses","3 - 6 meses","> 6 Meses"],logica:null,mapKey:"plazo",scoring:{enabled:!0,weight:2,rules:{"1 - 3 meses":"red","3 - 6 meses":"neutral","> 6 Meses":"green"}}},{id:"f_inicio",tipo:"date",label:"Fecha tentativa de inicio",placeholder:"",required:!0,opciones:[],logica:null,mapKey:"fechaInicio"},{id:"s8",tipo:"seccion",label:"Informacin de facturacin",desc:"Datos para facturacin electrnica",required:!1,opciones:[],logica:null},{id:"f_mismos_datos",tipo:"yesno",label:"Los datos de facturacin son los mismos del cliente?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"mismosDatosFactura"},{id:"f_fact_info_si",tipo:"info",label:" Se usarn los datos ingresados en la seccin 'Datos del cliente' para la facturacin. Podrs revisarlos antes de confirmar.",desc:"",required:!1,opciones:[],logica:{fieldId:"f_mismos_datos",value:"S"}},{id:"f_razon_social",tipo:"text",label:"Nombre o razn social para facturacin",placeholder:"Escribe tu respuesta aqu...",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"razonSocial"},{id:"f_tipo_doc_fact_co",tipo:"select",label:"Tipo de documento (facturacin)",placeholder:"",required:!0,opciones:["Cdula de ciudadana (CC)","Cdula de extranjera (CE)","NIT","Pasaporte"],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"tipoDocFactura"},{id:"f_num_doc_fact",tipo:"text",label:"Nmero de documento (facturacin)",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"numDocFactura"},{id:"f_email_fact",tipo:"email",label:"Email para envo de factura",placeholder:"name@example.com",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"emailFactura"},{id:"f_dir_fact",tipo:"text",label:"Direccin de facturacin",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"dirFacturacion"},{id:"f_forma_pago_co",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Enlace PSE","Tarjeta de Crdito/Dbito","Transferencia bancaria","Nequi / Daviplata"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"formaPago"},{id:"f_forma_pago_es",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Bizum","Tarjeta de Crdito/Dbito","Transferencia bancaria","PayPal"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"formaPago"},{id:"f_forma_pago_otro",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Tarjeta de Crdito/Dbito","Transferencia bancaria","PayPal"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa"]},mapKey:"formaPago"},{id:"f_retenciones",tipo:"yesno",label:"Aplican retenciones especiales?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"retenciones"},{id:"f_det_ret",tipo:"textarea",label:"Detalle de retenciones",placeholder:"Escribe tu respuesta aqu...",required:!0,opciones:[],logica:{fieldId:"f_retenciones",value:"S"},mapKey:"detalleRetenciones"},{id:"s9",tipo:"seccion",label:"Autorizaciones legales",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_confirmacion",tipo:"info",label:" Confirmacin: La informacin entregada es verdica y ser utilizada nicamente para la elaboracin de la propuesta de diseo. Habitaris S.A.S. garantiza la confidencialidad de los datos y no los compartir con terceros, salvo con proveedores o contratistas de confianza cuando sea necesario para la correcta ejecucin del proyecto, previa autorizacin del cliente.",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_acepta_conf",tipo:"yesno",label:"Confirmas que la informacin es verdica?",placeholder:"",required:!0,opciones:["S","No"],logica:{fieldId:"f_acepta_priv",value:"S"},mapKey:"confirmacion"},{id:"f_habeas",tipo:"info",label:" Autorizacin de tratamiento de datos personales: Al enviar este formulario autorizo a Habitaris S.A.S., para el uso de mis datos personales con el fin de elaborar propuestas de diseo, coordinar servicios relacionados y, en caso de ser necesario, compartirlos con proveedores o contratistas de confianza exclusivamente para la correcta ejecucin del proyecto. En todo momento se garantizar la confidencialidad y proteccin de mi informacin, conforme a la normativa de Habeas Data en Colombia (Ley 1581 de 2012).",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_acepta_habeas",tipo:"yesno",label:"Autorizas el tratamiento de datos personales?",placeholder:"",required:!0,opciones:["S","No"],logica:{fieldId:"f_acepta_priv",value:"S"},mapKey:"habeasData"}],config:{titulo:"BRIEFING INICIAL",subtitulo:"Cuntanos sobre tu proyecto para preparar la mejor propuesta",mensajeExito:"Gracias por diligenciar el Briefing de tu proyecto. Nos pondremos en contacto contigo pronto.",telRespuesta:"573505661545"}},{id:"encuesta_satisfaccion",nombre:"Encuesta de satisfaccin",modulo:"postventa",desc:"Evaluar experiencia del cliente post-entrega",campos:[{id:gt(),tipo:"seccion",label:"Tu experiencia",desc:"Aydanos a mejorar",required:!1,opciones:[],logica:null},{id:gt(),tipo:"text",label:"Nombre",placeholder:"Tu nombre",required:!0,opciones:[],logica:null},{id:gt(),tipo:"text",label:"Proyecto/Inmueble",placeholder:"Nombre del proyecto o direccin",required:!0,opciones:[],logica:null},{id:gt(),tipo:"rating",label:"Calidad de la construccin",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"rating",label:"Cumplimiento de plazos",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"rating",label:"Atencin al cliente",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"rating",label:"Relacin calidad/precio",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"yesno",label:"Recomendaras nuestros servicios?",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"textarea",label:"Comentarios adicionales",placeholder:"Tu opinin nos importa...",required:!1,opciones:[],logica:null}],config:{titulo:"Encuesta de satisfaccin",subtitulo:"Tu opinin nos ayuda a mejorar",mensajeExito:"Gracias por tu tiempo! Tu opinin es muy valiosa para nosotros."}},{id:"inspeccion_sst",nombre:"Inspeccin SST",modulo:"sst",desc:"Checklist de seguridad en obra",campos:[{id:gt(),tipo:"seccion",label:"Informacin general",desc:"",required:!1,opciones:[],logica:null},{id:gt(),tipo:"text",label:"Proyecto/Obra",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"text",label:"Inspector",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"date",label:"Fecha de inspeccin",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"seccion",label:"Checklist de seguridad",desc:"Evale cada aspecto",required:!1,opciones:[],logica:null},{id:gt(),tipo:"radio",label:"EPPs: Personal usa casco?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:gt(),tipo:"radio",label:"EPPs: Personal usa arns en alturas?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:gt(),tipo:"radio",label:"EPPs: Personal usa botas de seguridad?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:gt(),tipo:"radio",label:"Sealizacin: reas demarcadas?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:gt(),tipo:"radio",label:"Orden y aseo: rea de trabajo limpia?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:gt(),tipo:"radio",label:"Herramientas: En buen estado?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:gt(),tipo:"textarea",label:"Hallazgos y observaciones",placeholder:"Detalle los hallazgos...",required:!1,opciones:[],logica:null},{id:gt(),tipo:"radio",label:"Resultado general",placeholder:"",required:!0,opciones:["Aprobado","Aprobado con observaciones","No aprobado"],logica:null}],config:{titulo:"Inspeccin de Seguridad y Salud",subtitulo:"Checklist de verificacin en obra",mensajeExito:"Inspeccin registrada correctamente."}},{id:"recepcion_material",nombre:"Recepcin de material",modulo:"logistica",desc:"Registrar recepcin en almacn",campos:[{id:gt(),tipo:"text",label:"Orden de compra / Referencia",placeholder:"OC-0001",required:!0,opciones:[],logica:null},{id:gt(),tipo:"text",label:"Proveedor",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"date",label:"Fecha recepcin",placeholder:"",required:!0,opciones:[],logica:null},{id:gt(),tipo:"text",label:"Recibido por",placeholder:"Nombre almacenista",required:!0,opciones:[],logica:null},{id:gt(),tipo:"textarea",label:"Materiales recibidos",placeholder:"Detalle tems, cantidades...",required:!0,opciones:[],logica:null},{id:gt(),tipo:"radio",label:"Estado del material conforme?",placeholder:"",required:!0,opciones:["Conforme","No conforme","Parcialmente conforme"],logica:null},{id:gt(),tipo:"textarea",label:"Observaciones",placeholder:"Notas sobre estado, faltantes...",required:!1,opciones:[],logica:null}],config:{titulo:"Recepcin de material",subtitulo:"Registro de entrada al almacn",mensajeExito:"Recepcin registrada."}}];function Im({forms:t,setForms:i,editId:o,setEditId:n,onSaved:a,envios:r,addEnvio:s}){var L,ae,pe,he,ze,q;const d=o?t.find(I=>I.id===o):null,[u,b]=F.useState((d==null?void 0:d.nombre)||""),[j,w]=F.useState((d==null?void 0:d.modulo)||"general"),[S,m]=F.useState((d==null?void 0:d.campos)||[]),[x,p]=F.useState((d==null?void 0:d.config)||{titulo:"",subtitulo:"",mensajeExito:"Gracias por tu respuesta!",telRespuesta:"",vista:"pasos",colorAccent:"#111111",botonTexto:""}),[c,g]=F.useState(null),[l,f]=F.useState(!1),[y,h]=F.useState(!1),[v,A]=F.useState({nombre:"",email:"",tel:""}),[z,k]=F.useState("Colombia"),[T,C]=F.useState(""),[D,K]=F.useState(""),[oe,te]=F.useState(0),[P,ie]=F.useState("");F.useState(null);const me=I=>{const $=Xr.find(U=>U.tipo===I),H={id:gt(),tipo:I,label:($==null?void 0:$.lbl)||I,placeholder:"",required:!1,opciones:I==="rating"?[]:I==="yesno"?["S","No"]:[],logica:null,desc:""};["select","radio","chips","rango"].includes(I)&&(H.opciones=["Opcin 1","Opcin 2"]),m([...S,H]),g(S.length)},Q=(I,$,H)=>m(S.map((U,_)=>_===I?{...U,[$]:H}:U)),je=I=>{m(S.filter(($,H)=>H!==I)),c===I?g(null):c>I&&g(c-1)},re=(I,$)=>{const H=I+$;if(H<0||H>=S.length)return;const U=[...S];[U[I],U[H]]=[U[H],U[I]],m(U),g(H)},J=()=>{if(!u.trim())return;const I={id:(d==null?void 0:d.id)||gt(),nombre:u,modulo:j,campos:S,config:{...x,titulo:x.titulo||u},createdAt:(d==null?void 0:d.createdAt)||qi(),updatedAt:qi(),activo:!0};i(d?t.map($=>$.id===I.id?I:$):[...t,I]),a(I)},M=(I,$)=>{const H=Ai(),U={id:(d==null?void 0:d.id)||"form",nombre:u,campos:S,config:{...x,titulo:x.titulo||u,paisProyecto:$||"Colombia"},cliente:I||null},_=JSON.stringify(U),ce=(x.telRespuesta||H.whatsapp.numero||"").replace(/[^0-9]/g,"");return H.empresa.nombre.toUpperCase(),H.empresa.eslogan,`<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>${x.titulo||u||"Formulario"}</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:#F5F4F1;color:#111}
.hdr{background:#111;padding:14px 24px}.hdr-in{max-width:640px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
.logo{font-weight:700;font-size:14px;letter-spacing:3px;color:#fff}.logo-sub{font-size:7px;letter-spacing:2px;color:rgba(255,255,255,.4);text-transform:uppercase;margin-top:2px}
.prog{max-width:640px;margin:8px auto 0;height:3px;background:rgba(255,255,255,.1);border-radius:2px}.prog-bar{height:100%;background:#111111;border-radius:2px;transition:width .3s;width:0%}
.wrap{max-width:640px;margin:0 auto;padding:28px 20px 120px}
.client-b{background:#F0F0F0;border:1px solid rgba(30,79,140,.2);border-radius:8px;padding:12px 16px;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.client-av{width:36px;height:36px;border-radius:50%;background:#3B3B3B;color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700}
.client-n{font-size:13px;font-weight:700;color:#3B3B3B}.client-e{font-size:10px;color:#5A8BC2;margin-top:2px}
.title{text-align:center;margin-bottom:28px}.title h1{font-size:22px;font-weight:700;margin:0 0 6px}.title p{font-size:13px;color:#555}
.card{background:#fff;border-radius:10px;padding:24px 28px;border:1px solid #E0E0E0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
.fld{margin-bottom:16px}.lbl{font-size:11px;font-weight:600;display:block;margin-bottom:5px}.req{color:#B91C1C}
.inp{width:100%;padding:10px 14px;border:1px solid #E0E0E0;border-radius:6px;font-size:14px;font-family:'DM Sans',sans-serif;color:#111;background:#fff;box-sizing:border-box}
.inp:disabled{background:#F0F0F0;border-color:rgba(30,79,140,.27);color:#3B3B3B;font-weight:600}
textarea.inp{resize:vertical}select.inp{appearance:auto}
.sec{margin-top:24px;margin-bottom:12px;padding-top:16px;border-top:2px solid #111}.sec h3{font-size:14px;font-weight:700}.sec p{font-size:11px;color:#909090;margin-top:4px}
.info-b{margin-bottom:16px;padding:12px 16px;background:#F0F0F0;border-radius:8px;border:1px solid rgba(30,79,140,.2);font-size:13px;color:#3B3B3B}
.radio-g{display:flex;flex-direction:column;gap:6px;margin-top:4px}.radio-g label{display:flex;align-items:center;gap:8px;font-size:13px;padding:6px 10px;border-radius:6px;cursor:pointer}
.radio-g label.sel{background:#F0F0F0;border:1px solid rgba(30,79,140,.2)}.radio-g input{accent-color:#111}
.chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}.chip{padding:6px 14px;font-size:12px;border-radius:20px;border:1px solid #E0E0E0;background:#fff;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.chip.sel{background:#111;color:#fff;border-color:#111;font-weight:700}
.stars{display:flex;gap:6px;margin-top:4px}.star{font-size:28px;cursor:pointer;background:none;border:none;transition:all .15s}
.yn{display:flex;gap:8px;margin-top:6px}.yn-btn{padding:10px 24px;font-size:14px;border-radius:24px;border:1px solid #E0E0E0;background:#fff;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.yn-btn.sel{background:#111;color:#fff;border-color:#111;font-weight:700}
.sticky{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:2px solid #111;padding:12px 20px;z-index:200;box-shadow:0 -4px 20px rgba(0,0,0,.08)}
.sticky-in{max-width:640px;margin:0 auto;display:flex;justify-content:center}
.submit{padding:14px 40px;background:#111;color:#fff;border:none;border-radius:6px;font-size:15px;font-weight:700;cursor:pointer;letter-spacing:.5px;font-family:'DM Sans',sans-serif}
.err{font-size:12px;color:#B91C1C;text-align:center;margin:12px 0}
.ok{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#F5F4F1}
.ok-card{background:#fff;border-radius:12px;padding:40px;max-width:480px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,.08)}
.lock{font-size:8px;color:#3B3B3B;font-weight:400}
</style></head><body>
<div id="app"></div>
<script>
const DEF=${_};
const cfg=DEF.config||{};const campos=DEF.campos||[];const cliente=DEF.cliente||null;
const empresaNombre="${H.empresa.nombre.toUpperCase().replace(/"/g,'\\"')}";
const empresaEslogan="${H.empresa.eslogan.replace(/"/g,'\\"')}";
const vals={};let submitted=false;
// One-time use check
const privField=campos.find(c=>c.mapKey==='aceptaPrivacidad');
const privId=privField?privField.id:'f_acepta_priv';
const formKey='hab_used_'+(DEF.id||'')+'_'+(cliente?cliente.email||cliente.nombre:'');
if(localStorage.getItem(formKey)){submitted=true;}
// Prefill client fields
if(cliente){campos.forEach(c=>{
  if(cliente.email&&(c.mapKey==="email"||c.tipo==="email"))vals[c.id]=cliente.email;
  if(cliente.nombre&&(c.mapKey==="nombre"||(c.tipo==="text"&&c.label.toLowerCase().includes("nombre"))))vals[c.id]=cliente.nombre;
  if(cliente.tel&&(c.mapKey==="telefono"||c.tipo==="tel"))vals[c.id]=cliente.tel;
});}
// Prefill country from config
const paisProy=cfg.paisProyecto||"Colombia";
const paisCodeMap={"Colombia":"+57","Espaa":"+34","Mxico":"+52","Chile":"+56","Per":"+51","Ecuador":"+593","Argentina":"+54","Panam":"+507","Estados Unidos":"+1","Otro":"+"};
campos.forEach(c=>{
  if(c.mapKey==="pais")vals[c.id]=paisProy;
});
function isLocked(c){if(!cliente)return false;
  if(cliente.email&&(c.mapKey==="email"||c.tipo==="email"))return true;
  if(cliente.nombre&&(c.mapKey==="nombre"||(c.tipo==="text"&&c.label.toLowerCase().includes("nombre"))))return true;
  if(cliente.tel&&cliente.tel.trim()&&(c.mapKey==="telefono"||c.tipo==="tel"||c.tipo==="tel_combo"))return true;
  if(c.mapKey==="pais")return true;
  return false;}
function isVisible(c){if(!c.logica||!c.logica.fieldId)return true;
  if(!c.logica.value&&!c.logica.notValues&&!c.logica.notValue)return true;
  const dv=vals[c.logica.fieldId];
  if(c.logica.notValues){return !c.logica.notValues.includes(String(dv||""));}
  if(c.logica.notValue){return String(dv||"")!==c.logica.notValue;}
  const ex=c.logica.value;
  if(Array.isArray(dv))return dv.includes(ex);return String(dv||"")===ex;}
function render(){
  const app=document.getElementById("app");
  if(submitted){app.innerHTML=\`<div class="ok"><div class="ok-card"><div style="font-size:48px;margin-bottom:12px"></div><h2 style="font-size:20px;font-weight:700;color:#111111;margin:0 0 8px">Enviado!</h2><p style="font-size:13px;color:#555;line-height:1.6">\${cfg.mensajeExito||"Gracias por completar el formulario."}</p></div></div>\`;return;}
  // Privacy gate: if user declined, show goodbye
  if(vals[privId]==='No'){app.innerHTML=\`<div class="ok"><div class="ok-card"><div style="font-size:48px;margin-bottom:12px"></div><h2 style="font-size:20px;font-weight:700;color:#111;margin:0 0 8px">Gracias por tu tiempo</h2><p style="font-size:13px;color:#555;line-height:1.6">Para poder continuar con el briefing, necesitamos tu autorizacin para el tratamiento de datos personales. Si cambias de opinin, vuelve a abrir este formulario.</p></div></div>\`;return;}
  const privAccepted=vals[privId]==='S';
  const privInfoField=campos.find(c=>c.tipo==='info'&&c.label&&c.label.includes('Aviso de Privacidad'));
  const visibleCampos=privAccepted?campos:campos.filter(c=>c.id===privId||(privInfoField&&c.id===privInfoField.id));
  const totalReq=visibleCampos.filter(c=>c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)).length;
  const filledReq=visibleCampos.filter(c=>c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)&&vals[c.id]&&(Array.isArray(vals[c.id])?vals[c.id].length>0:true)).length;
  const pct=totalReq>0?Math.round((filledReq/totalReq)*100):0;
  let h=\`<div class="hdr"><div class="hdr-in"><div><div class="logo">\${empresaNombre}</div><div class="logo-sub">\${empresaEslogan}</div></div><div style="font-size:10px;color:rgba(255,255,255,.4)">\${pct}% completo</div></div><div class="prog"><div class="prog-bar" style="width:\${pct}%"></div></div></div>\`;
  h+=\`<div class="wrap">\`;
  if(cliente){h+=\`<div class="client-b"><div class="client-av">\${(cliente.nombre||cliente.email||"?")[0].toUpperCase()}</div><div><div class="client-n">Formulario para: \${cliente.nombre||cliente.email}</div>\${cliente.email?\`<div class="client-e">\${cliente.email}</div>\`:""}</div></div>\`;}
  h+=\`<div class="title"><h1>\${cfg.titulo||DEF.nombre||"Formulario"}</h1>\${cfg.subtitulo?\`<p>\${cfg.subtitulo}</p>\`:""}</div>\`;
  h+=\`<div class="card">\`;
  visibleCampos.forEach((c,i)=>{
    if(!isVisible(c))return;
    if(c.tipo==="seccion"){h+=\`<div class="sec"><h3>\${c.label}</h3>\${c.desc?\`<p>\${c.desc}</p>\`:""}</div>\`;return;}
    if(c.tipo==="info"){h+=\`<div class="info-b">\${c.label}</div>\`;return;}
    const locked=isLocked(c);const v=vals[c.id]||"";const req=c.required?\`<span class="req"> *</span>\`:"";
    h+=\`<div class="fld">\`;
    if(locked){
      h+=\`<label class="lbl">\${c.label} <span class="lock"> prellenado</span></label>\`;
      if(c.tipo==="tel_combo"){
        const codVal=vals["_cod_"+c.id]||"+57";
        h+=\`<div style="display:flex;gap:0"><div class="inp" style="width:90px;flex-shrink:0;border-radius:6px 0 0 6px;border-right:none;font-weight:700;font-size:13px;color:#3B3B3B;background:#F0F0F0;display:flex;align-items:center;justify-content:center;border-color:rgba(30,79,140,.27)">\${codVal}</div><input class="inp" value="\${v}" disabled style="flex:1;border-radius:0 6px 6px 0"/></div>\`;
      }else if(c.tipo==="select"){h+=\`<select class="inp" disabled><option>\${v}</option></select>\`;}
      else{h+=\`<input class="inp" value="\${v}" disabled/>\`;}
    }else if(c.tipo==="tel_combo"){
      const paisVal=c.paisRef?vals[c.paisRef]:paisProy;
      const defCode=paisCodeMap[paisVal]||"+57";
      if(!vals["_cod_"+c.id])vals["_cod_"+c.id]=defCode;
      const codVal=vals["_cod_"+c.id];
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<div style="display:flex;gap:0"><select class="inp" style="width:90px;flex-shrink:0;border-radius:6px 0 0 6px;border-right:none;font-weight:700;font-size:13px;color:#3B3B3B;background:#F5F4F1" onchange="vals['_cod_'+'\${c.id}']=this.value;render()">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<option value="\${o}" \${codVal===o?"selected":""}>\${o}</option>\`;});
      h+=\`</select><input class="inp" type="tel" value="\${v}" placeholder="\${c.placeholder||""}" style="flex:1;border-radius:0 6px 6px 0" onchange="vals['\${c.id}']=this.value;render()"/></div>\`;
    }else if(["text","email","tel","number","date"].includes(c.tipo)){
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<input class="inp" type="\${c.tipo}" value="\${v}" placeholder="\${c.placeholder||""}" onchange="vals['\${c.id}']=this.value;render()"/>\`;
    }else if(c.tipo==="textarea"){
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<textarea class="inp" rows="3" placeholder="\${c.placeholder||""}" onchange="vals['\${c.id}']=this.value;render()">\${v}</textarea>\`;
    }else if(c.tipo==="select"||c.tipo==="rango"){
      let opts=c.opciones||[];
      if(c.dynamicOpciones){const dv=vals[c.dynamicOpciones.dependsOn]||"";opts=(c.dynamicOpciones.map&&c.dynamicOpciones.map[dv])||c.dynamicOpciones.fallback||[];}
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<select class="inp" onchange="vals['\${c.id}']=this.value;render()"><option value="">Seleccionar...</option>\`;
      opts.forEach(o=>{h+=\`<option value="\${o}" \${v===o?"selected":""}>\${o}</option>\`;});
      h+=\`</select>\`;
    }else if(c.tipo==="radio"){
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="radio-g">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<label class="\${v===o?"sel":""}"><input type="radio" name="r\${c.id}" \${v===o?"checked":""} onchange="vals['\${c.id}']='\${o}';render()"/> \${o}</label>\`;});
      h+=\`</div>\`;
    }else if(c.tipo==="chips"){
      const sel=Array.isArray(vals[c.id])?vals[c.id]:[];
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="chips">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<span class="chip \${sel.includes(o)?"sel":""}" onclick="var s=Array.isArray(vals['\${c.id}'])?vals['\${c.id}']:[];if(s.includes('\${o}'))s=s.filter(x=>x!=='\${o}');else s.push('\${o}');vals['\${c.id}']=s;render()">\${o}</span>\`;});
      h+=\`</div>\`;
    }else if(c.tipo==="rating"){
      const stars=parseInt(v)||0;
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="stars">\`;
      for(let n=1;n<=5;n++){h+=\`<button class="star" style="opacity:\${n<=stars?1:.3};filter:\${n<=stars?"none":"grayscale(1)"}" onclick="vals['\${c.id}']=\${n};render()"></button>\`;}
      h+=\`</div>\${stars>0?\`<div style="font-size:11px;color:#555;margin-top:4px">\${stars} de 5</div>\`:""}\`;
    }else if(c.tipo==="yesno"){
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="yn">\`;
      ["S","No"].forEach(o=>{h+=\`<button class="yn-btn \${v===o?"sel":""}" onclick="vals['\${c.id}']='\${o}';render()">\${o}</button>\`;});
      h+=\`</div>\`;
    }
    h+=\`</div>\`;
  });
  h+=\`</div><div id="err" class="err"></div></div>\`;
  h+=\`<div class="sticky"><div class="sticky-in"><button class="submit" onclick="doSubmit()">Enviar formulario</button></div></div>\`;
  app.innerHTML=h;
}
function doSubmit(){
  document.getElementById("err").textContent="";
  for(const c of campos){
    if(c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)&&!isLocked(c)){
      const v=vals[c.id];if(!v||(Array.isArray(v)&&v.length===0)){document.getElementById("err").textContent='El campo "'+c.label+'" es obligatorio.';return;}
    }
  }
  const lines=campos.filter(c=>c.tipo!=="seccion"&&c.tipo!=="info"&&vals[c.id]).map(c=>{
    let v=Array.isArray(vals[c.id])?vals[c.id].join(", "):vals[c.id];
    if(c.tipo==="tel_combo"){const code=vals["_cod_"+c.id]||"";v=code+" "+v;}
    return" "+c.label+": "+v;});
  const cl=cliente?" Cliente: "+(cliente.nombre||"")+" ("+(cliente.email||"")+")\\n":"";
  const msg=" RESPUESTA: "+(DEF.nombre||"Formulario")+"\\n\\n"+cl+lines.join("\\n")+"\\n\\nFecha: "+new Date().toISOString().split("T")[0];
  const tel="${ce}";
  submitted=true;localStorage.setItem(formKey,'1');render();
  setTimeout(()=>{window.open("https://wa.me/"+(tel?tel:"")+"?text="+encodeURIComponent(msg),"_blank");},600);
}
render();
<\/script></body></html>`},[B,V]=F.useState(""),X=()=>{var Ie,Te,Oe,ct,at,xt,Ft,zt,Vt,Ti,lo;if(!v.email&&!v.nombre)return;const I={nombre:v.nombre,email:v.email,tel:((v.codTel||"+57").replace(/[^0-9+]/g,"")+" "+v.tel).trim()},$=M(I,z),H=new Blob([$],{type:"text/html"}),U=URL.createObjectURL(H);C(U),K(`formulario-${(u||"form").replace(/\s+/g,"-").toLowerCase()}-${(v.nombre||"cliente").replace(/\s+/g,"-").toLowerCase()}.html`);const _=gt()+Date.now().toString(36),ce=Ai(),ve=(((Ie=ce.app)==null?void 0:Ie.url)||"").replace(/\/$/,"");if(ve){const ji={linkId:_,maxUsos:oe||0,fechaCaducidad:P||""},jr={id:(d==null?void 0:d.id)||"form",nombre:u,campos:S,config:{...x,titulo:x.titulo||u,paisProyecto:z},cliente:I||null,linkConfig:ji,modulo:j,marca:{logo:((Te=ce.apariencia)==null?void 0:Te.logo)||"",colorPrimario:((Oe=ce.apariencia)==null?void 0:Oe.colorPrimario)||"#111",colorSecundario:((ct=ce.apariencia)==null?void 0:ct.colorSecundario)||"#3B3B3B",colorAcento:((at=ce.apariencia)==null?void 0:at.colorAcento)||"#C9A84C",tipografia:((xt=ce.apariencia)==null?void 0:xt.tipografia)||"DM Sans",slogan:((Ft=ce.apariencia)==null?void 0:Ft.slogan)||((zt=ce.empresa)==null?void 0:zt.eslogan)||"",empresa:((Vt=ce.empresa)==null?void 0:Vt.nombre)||"Habitaris",razonSocial:((Ti=ce.empresa)==null?void 0:Ti.razonSocial)||"",domicilio:((lo=ce.empresa)==null?void 0:lo.domicilio)||""}},Ji=oc(jr);V(`${ve}/form#${Ji}`),jo()}s({id:gt(),formId:(d==null?void 0:d.id)||"nuevo",formNombre:u||"(sin nombre)",cliente:I,fecha:qi(),hora:new Date().toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}),linkId:_,maxUsos:oe||0,expiry:P||""})},[R,W]=F.useState(!1),[se,le]=F.useState(!1),de=()=>{if(!T)return;const I=document.createElement("a");I.href=T,I.download=D||"formulario.html",I.click()},Z=()=>{const I=Ai(),$=v.nombre||"cliente",H=B?`

 ${B}`:"",U=I.whatsapp.mensajePlantilla.replace(/\{\{nombre\}\}/g,$).replace(/\{\{formulario\}\}/g,u||"Formulario").replace(/\{\{empresa\}\}/g,I.empresa.nombre)+H,_=v.tel?(v.codTel||"+57").replace(/[^0-9]/g,"")+v.tel.replace(/[^0-9]/g,""):"";window.open(`https://wa.me/${_}?text=${encodeURIComponent(U)}`,"_blank")},ue=async()=>{if(!v.email){alert("Ingresa el email del cliente");return}const I=Ai();W(!0);const $=await Tm({client_name:v.nombre||"Cliente",client_email:v.email,form_name:u||"Formulario",from_name:I.empresa.nombre,form_link:B||"En breve recibirs el formulario por WhatsApp."});W(!1),$?(le(!0),setTimeout(()=>le(!1),5e3)):alert("Error al enviar. Revisa Configuracin  Correo / EmailJS.")},N=()=>{A({nombre:"",email:"",tel:"",codTel:""}),C(""),K(""),V(""),k("Colombia"),h(!0)},G=c!==null?S[c]:null;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:[e.jsx("input",{value:u,onChange:I=>b(I.target.value),placeholder:"Nombre del formulario",style:{...jt,fontSize:16,fontWeight:700,padding:"8px 12px",flex:1,maxWidth:400}}),e.jsx("select",{value:j,onChange:I=>w(I.target.value),style:{...jt,width:160},children:Da.map(I=>e.jsx("option",{value:I.id,children:I.lbl},I.id))})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(vo,{v:"sec",on:()=>f(!l),children:[e.jsx(yn,{size:11})," ",l?"Editor":"Vista previa"]}),e.jsxs(vo,{v:"sec",on:N,children:[e.jsx(Qc,{size:11})," Compartir"]}),e.jsxs(vo,{on:J,children:[e.jsx(ft,{size:11})," ",d?"Actualizar":"Guardar"]})]})]}),e.jsxs(Lt,{style:{padding:"8px 14px",marginBottom:14,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Ttulo pblico"}),e.jsx("input",{value:x.titulo,onChange:I=>p({...x,titulo:I.target.value}),placeholder:u,style:{...jt,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Subttulo"}),e.jsx("input",{value:x.subtitulo||"",onChange:I=>p({...x,subtitulo:I.target.value}),placeholder:"Descripcin breve",style:{...jt,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Mensaje de xito"}),e.jsx("input",{value:x.mensajeExito||"",onChange:I=>p({...x,mensajeExito:I.target.value}),placeholder:"Gracias!",style:{...jt,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{width:130},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Tel WhatsApp"}),e.jsx("input",{value:x.telRespuesta||"",onChange:I=>p({...x,telRespuesta:I.target.value}),placeholder:"573001234567",style:{...jt,width:"100%",fontSize:10}})]})]}),e.jsxs(Lt,{style:{padding:"8px 14px",marginBottom:14,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{minWidth:120},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Vista del formulario"}),e.jsx("div",{style:{display:"flex",gap:4,marginTop:3},children:[{v:"pasos",l:" Paso a paso"},{v:"scroll",l:" Completo"}].map(I=>e.jsx("button",{type:"button",onClick:()=>p({...x,vista:I.v}),style:{...Fm,padding:"4px 10px",fontSize:9,fontWeight:(x.vista||"pasos")===I.v?700:400,borderRadius:4,border:(x.vista||"pasos")===I.v?`2px solid ${fe.ink}`:`1px solid ${fe.border}`,background:(x.vista||"pasos")===I.v?fe.ink:"#fff",color:(x.vista||"pasos")===I.v?"#fff":fe.inkMid,cursor:"pointer"},children:I.l},I.v))})]}),e.jsxs("div",{style:{minWidth:100},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Color del botn"}),e.jsxs("div",{style:{display:"flex",gap:4,marginTop:3,alignItems:"center"},children:[["#111111","#3B3B3B","#C9A84C","#111111","#8B2252"].map(I=>e.jsx("button",{type:"button",onClick:()=>p({...x,colorAccent:I}),style:{width:20,height:20,borderRadius:"50%",background:I,border:(x.colorAccent||"#111111")===I?"3px solid #C9A84C":"2px solid #ddd",cursor:"pointer",padding:0}},I)),e.jsx("input",{type:"color",value:x.colorAccent||"#111111",onChange:I=>p({...x,colorAccent:I.target.value}),style:{width:20,height:20,border:"none",padding:0,cursor:"pointer",borderRadius:4}})]})]}),e.jsxs("div",{style:{flex:1,minWidth:120},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Texto del botn enviar"}),e.jsx("input",{value:x.botonTexto||"",onChange:I=>p({...x,botonTexto:I.target.value}),placeholder:"Enviar formulario",style:{...jt,width:"100%",fontSize:10}})]})]}),l?e.jsxs(Lt,{style:{maxWidth:640,margin:"0 auto",padding:"32px 28px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[e.jsx("h2",{style:{fontSize:20,fontWeight:700,margin:"0 0 4px"},children:x.titulo||u||"Formulario"}),x.subtitulo&&e.jsx("p",{style:{fontSize:12,color:fe.inkMid},children:x.subtitulo})]}),S.map(I=>(Xr.find($=>$.tipo===I.tipo),I.tipo==="seccion"?e.jsxs("div",{style:{marginTop:20,marginBottom:8,paddingTop:14,borderTop:`2px solid ${fe.ink}`},children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700},children:I.label}),I.desc&&e.jsx("p",{style:{fontSize:10,color:fe.inkMid,marginTop:2},children:I.desc})]},I.id):I.tipo==="info"?e.jsx("div",{style:{marginBottom:12,padding:"10px 14px",background:fe.blueBg,borderRadius:6,fontSize:11,color:fe.blue},children:I.label},I.id):e.jsxs("div",{style:{marginBottom:14},children:[e.jsxs("label",{style:{display:"block",fontSize:11,fontWeight:600,marginBottom:4},children:[I.label,I.required&&e.jsx("span",{style:{color:fe.red},children:" *"})]}),(I.tipo==="text"||I.tipo==="email"||I.tipo==="tel"||I.tipo==="number"||I.tipo==="date")&&e.jsx("input",{type:I.tipo,placeholder:I.placeholder,disabled:!0,style:{...jt,width:"100%",background:"#FFFFFF"}}),I.tipo==="textarea"&&e.jsx("textarea",{rows:2,placeholder:I.placeholder,disabled:!0,style:{...jt,width:"100%",resize:"vertical",background:"#FFFFFF"}}),I.tipo==="select"&&e.jsxs("select",{disabled:!0,style:{...jt,width:"100%",background:"#FFFFFF"},children:[e.jsx("option",{children:"Seleccionar..."}),(I.opciones||[]).map($=>e.jsx("option",{children:$},$))]}),I.tipo==="radio"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:4},children:(I.opciones||[]).map($=>e.jsxs("label",{style:{fontSize:11,display:"flex",alignItems:"center",gap:6,padding:"4px 8px",borderRadius:4,background:"#FFFFFF"},children:[e.jsx("input",{type:"radio",name:I.id,disabled:!0}),$]},$))}),I.tipo==="chips"&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:4},children:(I.opciones||[]).map($=>e.jsx("span",{style:{fontSize:10,padding:"4px 12px",borderRadius:14,border:`1px solid ${fe.border}`,background:"#fff"},children:$},$))}),I.tipo==="rango"&&e.jsxs("select",{disabled:!0,style:{...jt,width:"100%",background:"#FFFFFF"},children:[e.jsx("option",{children:"Seleccionar..."}),(I.opciones||[]).map($=>e.jsx("option",{children:$},$))]}),I.tipo==="rating"&&e.jsx("div",{style:{display:"flex",gap:4,marginTop:4},children:[1,2,3,4,5].map($=>e.jsx("span",{style:{fontSize:20,opacity:.3},children:""},$))}),I.tipo==="yesno"&&e.jsx("div",{style:{display:"flex",gap:8,marginTop:4},children:["S","No"].map($=>e.jsx("span",{style:{fontSize:10,padding:"6px 16px",borderRadius:14,border:`1px solid ${fe.border}`,background:"#fff",fontWeight:600},children:$},$))})]},I.id)))]}):e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsxs(Lt,{style:{width:180,flexShrink:0,padding:8,alignSelf:"flex-start",position:"sticky",top:20},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",padding:"4px 8px",marginBottom:4},children:"Bloques"}),Xr.map(I=>e.jsxs("button",{onClick:()=>me(I.tipo),style:{display:"flex",alignItems:"center",gap:6,width:"100%",padding:"6px 8px",border:"none",background:"transparent",borderRadius:4,cursor:"pointer",fontSize:10,color:fe.ink,fontFamily:"'DM Sans',sans-serif",textAlign:"left"},onMouseEnter:$=>$.currentTarget.style.background=fe.accent,onMouseLeave:$=>$.currentTarget.style.background="transparent",children:[e.jsx("span",{children:I.icon})," ",I.lbl]},I.tipo))]}),e.jsxs("div",{style:{flex:1},children:[S.length===0&&e.jsxs(Lt,{style:{textAlign:"center",padding:40,color:fe.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("div",{style:{fontSize:14,fontWeight:600},children:"Aade bloques desde el panel izquierdo"}),e.jsx("div",{style:{fontSize:10,marginTop:4},children:"Arrastra y configura los campos de tu formulario"})]}),S.map((I,$)=>{var _,ce,ve;const H=Xr.find(Ie=>Ie.tipo===I.tipo),U=c===$;return e.jsxs("div",{onClick:()=>g($),style:{background:"#fff",border:`1px solid ${U?fe.blue:fe.border}`,borderRadius:6,padding:"10px 12px",marginBottom:6,cursor:"pointer",boxShadow:U?"0 0 0 2px #3B3B3B22":"none",transition:"all .15s",display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),re($,-1)},style:{background:"none",border:"none",cursor:"pointer",padding:0,color:$===0?fe.inkXLight:fe.inkMid},children:e.jsx(tl,{size:10})}),e.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),re($,1)},style:{background:"none",border:"none",cursor:"pointer",padding:0,color:$===S.length-1?fe.inkXLight:fe.inkMid},children:e.jsx(An,{size:10})})]}),e.jsx("span",{style:{fontSize:14},children:(H==null?void 0:H.icon)||""}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600},children:[I.label,I.required&&e.jsx("span",{style:{color:fe.red,fontSize:9,marginLeft:4},children:"obligatorio"}),((_=I.scoring)==null?void 0:_.enabled)&&e.jsx("span",{style:{fontSize:9,marginLeft:4},children:""})]}),e.jsxs("div",{style:{fontSize:8,color:fe.inkLight},children:[H==null?void 0:H.lbl," ",I.logica?` Condicional: si "${((ce=S.find(Ie=>{var Te;return Ie.id===((Te=I.logica)==null?void 0:Te.fieldId)}))==null?void 0:ce.label)||"?"}" = "${((ve=I.logica)==null?void 0:ve.value)||"?"}"`:""]})]}),e.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),Q($,"required",!I.required)},title:I.required?"Obligatorio":"Opcional",style:{background:"none",border:"none",cursor:"pointer",color:I.required?fe.red:fe.inkXLight},children:I.required?e.jsx(Zc,{size:16}):e.jsx(ep,{size:16})}),e.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),je($)},style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(qe,{size:12})})]},I.id)})]}),G&&e.jsxs(Lt,{style:{width:260,flexShrink:0,padding:12,alignSelf:"flex-start",position:"sticky",top:20},children:[e.jsxs("div",{style:{fontSize:10,fontWeight:700,marginBottom:10,display:"flex",alignItems:"center",gap:6},children:[e.jsx(el,{size:12})," Configurar campo"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Etiqueta / Pregunta"}),e.jsx("input",{value:G.label,onChange:I=>Q(c,"label",I.target.value),style:{...jt,width:"100%"}})]}),G.tipo!=="seccion"&&G.tipo!=="info"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Placeholder"}),e.jsx("input",{value:G.placeholder||"",onChange:I=>Q(c,"placeholder",I.target.value),style:{...jt,width:"100%"}})]}),(G.tipo==="seccion"||G.tipo==="info")&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Descripcin"}),e.jsx("textarea",{value:G.desc||"",onChange:I=>Q(c,"desc",I.target.value),rows:2,style:{...jt,width:"100%",resize:"vertical"}})]}),["select","radio","chips","rango"].includes(G.tipo)&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Opciones (una por lnea)"}),e.jsx("textarea",{value:(G.opciones||[]).join(`
`),onChange:I=>Q(c,"opciones",I.target.value.split(`
`).filter(Boolean)),rows:4,style:{...jt,width:"100%",resize:"vertical",fontFamily:"'DM Mono',monospace",fontSize:10}})]}),G.tipo!=="seccion"&&G.tipo!=="info"&&e.jsx("div",{style:{marginBottom:8},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:10,fontWeight:600},children:[e.jsx("input",{type:"checkbox",checked:G.required,onChange:I=>Q(c,"required",I.target.checked),style:{accentColor:fe.red}}),"Obligatorio"]})}),G.tipo!=="seccion"&&G.tipo!=="info"&&S.filter(I=>I.id!==G.id&&I.tipo!=="seccion"&&I.tipo!=="info").length>0&&e.jsxs("div",{style:{marginBottom:8,borderTop:`1px solid ${fe.border}`,paddingTop:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Lgica condicional"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:9},children:"Mostrar si"}),e.jsxs("select",{value:((L=G.logica)==null?void 0:L.fieldId)||"",onChange:I=>{var H;const $=I.target.value;Q(c,"logica",$?{fieldId:$,value:((H=G.logica)==null?void 0:H.value)||""}:null)},style:{...jt,fontSize:9,flex:1},children:[e.jsx("option",{value:"",children:"Sin condicin"}),S.filter(I=>I.id!==G.id&&I.tipo!=="seccion"&&I.tipo!=="info").map(I=>e.jsx("option",{value:I.id,children:I.label},I.id))]})]}),((ae=G.logica)==null?void 0:ae.fieldId)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:9},children:"= "}),e.jsx("input",{value:((pe=G.logica)==null?void 0:pe.value)||"",onChange:I=>Q(c,"logica",{...G.logica,value:I.target.value}),placeholder:"valor",style:{...jt,fontSize:9,flex:1}})]})]}),e.jsxs("div",{style:{borderTop:`1px solid ${fe.border}`,paddingTop:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Clave de mapeo (integracin)"}),e.jsx("input",{value:G.mapKey||"",onChange:I=>Q(c,"mapKey",I.target.value),placeholder:"ej: nombre, email",style:{...jt,width:"100%",fontSize:9}})]}),["select","radio","chips","yesno","rango"].includes(G.tipo)&&e.jsxs("div",{style:{borderTop:`1px solid ${fe.border}`,paddingTop:8,marginTop:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:10,fontWeight:700,marginBottom:6},children:[e.jsx("input",{type:"checkbox",checked:!!((he=G.scoring)!=null&&he.enabled),onChange:I=>{const $=G.scoring?{...G.scoring,enabled:I.target.checked}:{enabled:I.target.checked,weight:1,rules:{}};Q(c,"scoring",$)},style:{accentColor:"#C9A84C"}})," Regla de scoring"]}),((ze=G.scoring)==null?void 0:ze.enabled)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:6},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Peso"}),e.jsx("select",{value:((q=G.scoring)==null?void 0:q.weight)||1,onChange:I=>Q(c,"scoring",{...G.scoring,weight:parseInt(I.target.value)}),style:{...jt,width:60,fontSize:9},children:[1,2,3,4,5].map(I=>e.jsxs("option",{value:I,children:[I," pts"]},I))})]}),e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"Clasificar opciones"}),(G.opciones||["S","No"]).map(I=>{var H,U;const $=((U=(H=G.scoring)==null?void 0:H.rules)==null?void 0:U[I])||"neutral";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:3},children:[e.jsx("div",{style:{flex:1,fontSize:9,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:I}),[{v:"green",l:""},{v:"neutral",l:""},{v:"red",l:""}].map(_=>e.jsx("button",{type:"button",onClick:()=>{var ve;const ce={...((ve=G.scoring)==null?void 0:ve.rules)||{},[I]:_.v};Q(c,"scoring",{...G.scoring,rules:ce})},style:{width:22,height:22,border:$===_.v?"2px solid #111":"1px solid #ddd",borderRadius:4,background:$===_.v?"#F5F4F1":"#fff",cursor:"pointer",fontSize:12,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:_.l},_.v))]},I)})]})]})]})]}),y&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"flex-start",justifyContent:"center",paddingTop:40,overflowY:"auto"},onClick:()=>h(!1),children:e.jsxs("div",{onClick:I=>I.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:460,maxHeight:"85vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)",marginBottom:40},children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700,marginBottom:4},children:" Enviar formulario a cliente"}),e.jsxs("p",{style:{margin:"0 0 16px",fontSize:10,color:fe.inkMid},children:[u||"Sin nombre","  Se genera un archivo HTML que el cliente abre en su navegador"]}),e.jsxs("div",{style:{background:fe.accent,borderRadius:6,padding:"12px 14px",marginBottom:14},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:8},children:" Datos del cliente"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Nombre *"}),e.jsx("input",{value:v.nombre,onChange:I=>{A({...v,nombre:I.target.value}),C("")},placeholder:"Juan Prez",style:{...jt,width:"100%",fontSize:11}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Email"}),e.jsx("input",{value:v.email,onChange:I=>{A({...v,email:I.target.value}),C("")},placeholder:"juan@empresa.com",type:"email",style:{...jt,width:"100%",fontSize:11}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"WhatsApp"}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("select",{value:v.codTel||{Colombia:"+57",Espaa:"+34",Mxico:"+52",Chile:"+56",Per:"+51",Ecuador:"+593",Argentina:"+54",Panam:"+507","Estados Unidos":"+1"}[z]||"+57",onChange:I=>{A({...v,codTel:I.target.value}),C("")},style:{...jt,width:80,flexShrink:0,borderRadius:"6px 0 0 6px",borderRight:"none",fontWeight:700,fontSize:11,color:"#3B3B3B",background:"#F5F4F1"},children:["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"].map(I=>e.jsx("option",{value:I,children:I},I))}),e.jsx("input",{value:v.tel,onChange:I=>{A({...v,tel:I.target.value}),C("")},placeholder:"3001234567",style:{...jt,flex:1,fontSize:11,borderRadius:"0 6px 6px 0"}})]})]})]}),e.jsxs("div",{style:{background:"#F5F0FF",borderRadius:6,padding:"12px 14px",marginBottom:14,border:"1px solid #5B3A8C22"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#5B3A8C",textTransform:"uppercase",marginBottom:8},children:" Pas del proyecto"}),e.jsx("select",{value:z,onChange:I=>{k(I.target.value),C("")},style:{...jt,width:"100%",fontSize:11,marginBottom:8},children:["Colombia","Espaa","Mxico","Chile","Per","Ecuador","Argentina","Panam","Estados Unidos","Otro"].map(I=>e.jsx("option",{value:I,children:I},I))}),e.jsx("div",{style:{fontSize:8,color:"#5B3A8C",lineHeight:1.4},children:" Define la divisa, departamentos/comunidades, tipo de documento y cdigo telefnico del formulario"})]}),e.jsxs("div",{style:{background:"#F5F0FF",borderRadius:6,padding:"12px 14px",marginBottom:14,border:"1px solid #5B3A8C22"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#5B3A8C",textTransform:"uppercase",marginBottom:8},children:" Control del enlace"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Mximo de envos"}),e.jsxs("select",{value:oe,onChange:I=>{te(parseInt(I.target.value)),C("")},style:{...jt,width:"100%",fontSize:11},children:[e.jsx("option",{value:0,children:" Ilimitado"}),e.jsx("option",{value:1,children:"1 vez"}),e.jsx("option",{value:2,children:"2 veces"}),e.jsx("option",{value:3,children:"3 veces"}),e.jsx("option",{value:5,children:"5 veces"}),e.jsx("option",{value:10,children:"10 veces"})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Fecha de caducidad"}),e.jsx("input",{type:"date",value:P,onChange:I=>{ie(I.target.value),C("")},min:new Date().toISOString().split("T")[0],style:{...jt,width:"100%",fontSize:11}})]})]}),e.jsxs("div",{style:{fontSize:8,color:"#5B3A8C",marginTop:6,lineHeight:1.4},children:[oe>0?` El cliente podr enviar mximo ${oe} ${oe===1?"vez":"veces"}`:" Sin lmite de envos",P?`   Caduca el ${new Date(P+"T23:59:59").toLocaleDateString("es-CO",{day:"numeric",month:"short",year:"numeric"})}`:"  Sin caducidad"]})]}),T?e.jsxs("div",{style:{marginBottom:10,padding:"8px 10px",background:fe.greenBg,borderRadius:4,border:`1px solid ${fe.green}33`,fontSize:9,color:fe.green,fontWeight:600},children:[" Formulario listo para ",v.nombre||v.email,"  ",e.jsx("strong",{children:D}),B&&e.jsx("div",{style:{marginTop:4,fontSize:8,color:fe.inkMid,fontWeight:400},children:" Link pblico generado  se enviar por email y WhatsApp automticamente"})]}):e.jsx(vo,{on:X,style:{width:"100%",justifyContent:"center",marginBottom:14,padding:"10px 0"},disabled:!v.nombre,children:" Generar formulario personalizado"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,opacity:T?1:.4,pointerEvents:T?"auto":"none"},children:[e.jsxs("button",{onClick:de,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${fe.border}`,borderRadius:6,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:fe.greenBg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(At,{size:14,color:fe.green})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:" Descargar formulario (.html)"}),e.jsx("div",{style:{fontSize:8,color:fe.inkMid},children:"Archivo que puedes adjuntar por WhatsApp o email"})]})]}),e.jsxs("button",{onClick:Z,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${fe.border}`,borderRadius:6,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:"#E8F8E8",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xr,{size:14,color:"#25D366"})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:"Abrir WhatsApp"}),e.jsx("div",{style:{fontSize:8,color:fe.inkMid},children:v.tel?`Mensaje al ${v.codTel||"+57"} ${v.tel}`:"Adjunta el archivo descargado"})]})]}),e.jsxs("button",{onClick:ue,disabled:R,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${se?fe.green:fe.border}`,borderRadius:6,background:se?fe.greenBg:"#fff",cursor:R?"wait":"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left",opacity:R?.6:1},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:se?fe.greenBg:fe.amberBg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(En,{size:14,color:se?fe.green:fe.amber})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:R?"Enviando...":se?" Email enviado con link":` Enviar email con link (${Ai().correo.emailPrincipal})`}),e.jsx("div",{style:{fontSize:8,color:fe.inkMid},children:se?`Enviado a ${v.email} con link directo`:v.email?"El cliente recibe email con link al formulario":"Ingresa email del cliente"})]})]})]}),e.jsxs("div",{style:{marginTop:12,padding:"8px 10px",background:fe.accent,borderRadius:4,fontSize:8,color:fe.inkMid,lineHeight:1.5},children:[" ",e.jsx("strong",{children:"Flujo recomendado:"}),e.jsx("br",{}),"1 ",e.jsx("strong",{children:"Email"}),"  el cliente recibe un link directo al formulario",e.jsx("br",{}),"2 ",e.jsx("strong",{children:"WhatsApp"}),"  tambin incluye el link al formulario",e.jsx("br",{}),"3 ",e.jsx("strong",{children:"Descargar"}),"  archivo .html de respaldo (funciona sin internet)"]}),e.jsx(vo,{v:"sec",on:()=>h(!1),style:{width:"100%",marginTop:10,justifyContent:"center"},children:"Cerrar"})]})})]})}function Rm({forms:t,setForms:i,onEdit:o,onNew:n}){const[a,r]=F.useState(""),s=t.filter(b=>{var w,S;const j=a.toLowerCase();return!j||((w=b.nombre)==null?void 0:w.toLowerCase().includes(j))||((S=b.modulo)==null?void 0:S.toLowerCase().includes(j))}),d=b=>{confirm("Eliminar formulario?")&&i(t.filter(j=>j.id!==b))},u=b=>i([...t,{...b,id:gt(),nombre:b.nombre+" (copia)",createdAt:qi(),updatedAt:qi()}]);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Mis formularios  ",t.length]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(vi,{size:12,style:{position:"absolute",left:8,top:8,color:fe.inkLight}}),e.jsx("input",{value:a,onChange:b=>r(b.target.value),placeholder:"Buscar...",style:{...jt,paddingLeft:26,width:180}})]}),e.jsxs(vo,{on:n,children:[e.jsx(Pe,{size:11})," Nuevo formulario"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280,1fr))",gap:12},children:s.map(b=>{const j=(b.campos||[]).filter(m=>m.tipo!=="seccion"&&m.tipo!=="info").length,w=(b.campos||[]).filter(m=>m.required).length,S=Da.find(m=>m.id===b.modulo);return e.jsxs(Lt,{style:{padding:0,overflow:"hidden",cursor:"pointer"},onClick:()=>o(b.id),children:[e.jsxs("div",{style:{padding:"14px 16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:b.nombre}),e.jsxs("div",{style:{fontSize:9,color:fe.inkMid,marginTop:2},children:[j," campos  ",w," obligatorios"]})]}),e.jsx(tr,{color:fe.blue,children:(S==null?void 0:S.lbl)||"General"})]}),e.jsxs("div",{style:{fontSize:8,color:fe.inkLight,marginTop:6},children:["Creado: ",b.createdAt,"  Editado: ",b.updatedAt]})]}),e.jsxs("div",{style:{borderTop:`1px solid ${fe.border}`,display:"flex",padding:"0"},children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),o(b.id)},style:{flex:1,padding:"6px 0",border:"none",background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:fe.blue,fontFamily:"'DM Sans',sans-serif"},children:" Editar"}),e.jsx("button",{onClick:m=>{m.stopPropagation(),u(b)},style:{flex:1,padding:"6px 0",border:"none",borderLeft:`1px solid ${fe.border}`,background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:fe.inkMid,fontFamily:"'DM Sans',sans-serif"},children:" Duplicar"}),e.jsx("button",{onClick:m=>{m.stopPropagation(),d(b.id)},style:{flex:1,padding:"6px 0",border:"none",borderLeft:`1px solid ${fe.border}`,background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:fe.red,fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]},b.id)})})]})}function Mm({forms:t,respuestas:i,onReload:o,loading:n,onDelete:a,onClearAll:r}){const[s,d]=F.useState(""),[u,b]=F.useState(null),[j,w]=F.useState(new Set),[S,m]=F.useState(!1),[x,p]=F.useState(""),[c,g]=F.useState(null),[l,f]=F.useState(!1),[y,h]=F.useState(!1),[v,A]=F.useState(()=>{try{return JSON.parse(localStorage.getItem("hab:form:procesados")||"[]")}catch{return[]}}),[z,k]=F.useState("todos");F.useEffect(()=>{Promise.resolve(!1).then(f)},[]);const T=B=>w(V=>{const X=new Set(V);return X.has(B)?X.delete(B):X.add(B),X}),C=B=>w(V=>V.size===B.length?new Set:new Set(B)),D=localStorage.getItem("hab:form:deletePass")||"",K=D||y,oe=async B=>{if(!K){te(B);return}if(y){if(D){g(B),p(""),m(!0);return}return}D&&(g(B),p(""),m(!0))},te=B=>{B.type==="single"&&a?a(B.target):B.type==="selected"&&a?(j.forEach(V=>{const X=i.find(R=>R.id===V);X&&a(X)}),w(new Set)):B.type==="all"&&r&&(r(),w(new Set)),m(!1),g(null)},P=()=>{x===D?te(c):alert("Contrasea incorrecta")},ie=(B,V)=>{var R,W;const X=[...v,B];A(X),localStorage.setItem("hab:form:procesados",JSON.stringify(X));try{(W=(R=window.storage)==null?void 0:R.set)==null||W.call(R,"hab:form:procesados",JSON.stringify(X))}catch{}},me=(B,V)=>{var R,W;const X=v.filter(se=>se!==B);A(X),localStorage.setItem("hab:form:procesados",JSON.stringify(X));try{(W=(R=window.storage)==null?void 0:R.set)==null||W.call(R,"hab:form:procesados",JSON.stringify(X))}catch{}},Q=B=>B.processed||v.includes(B.id),je=B=>{var de,Z,ue,N,G,L,ae;const V=JSON.parse(localStorage.getItem("habitaris_crm")||"{}"),X=(()=>{try{const pe=localStorage.getItem("hab:crm:clientes2:local");return pe?JSON.parse(pe):[]}catch{return[]}})(),R=X.find(pe=>pe.email&&pe.email===B.clienteEmail);let W;if(R)W=R.id;else{const pe={id:Math.random().toString(36).slice(2,9),nombre:B.razonSocial||B.clienteNombre||"",tipo:B.razonSocial?"Empresa":"Persona natural",nit:B.documento||"",email:B.clienteEmail||"",telMovil:B.clienteTel||B.telefono||"",prefijoMovil:"+57",ciudad:B.ciudad||"",pais:"CO",notas:[B.edificio?`Proyecto: ${B.edificio}`:"",B.tipoProyecto?`Tipo: ${B.tipoProyecto}`:"",B.area?`rea: ${B.area} m`:"",B.presupuesto?`Presupuesto: $${Number(B.presupuesto).toLocaleString("es-CO")}`:""].filter(Boolean).join(" | "),emailFactura:B.emailFactura||B.clienteEmail||"",dirFacturacion:B.dirFacturacion||"",briefingId:B.id,fechaAlta:new Date().toISOString().split("T")[0]};X.push(pe),W=pe.id,localStorage.setItem("hab:crm:clientes2:local",JSON.stringify(X));try{(Z=(de=window.storage)==null?void 0:de.set)==null||Z.call(de,"hab:crm:clientes2",JSON.stringify(X))}catch{}}const se=V.deals||[],le={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),cliente:B.clienteNombre||B.razonSocial||"",email:B.clienteEmail||"",telefono:B.clienteTel||B.telefono||"",ubicacion:[B.ciudad,B.edificio].filter(Boolean).join("  "),proyecto:[B.edificio,(ue=B.clienteNombre)==null?void 0:ue.split(" ").slice(-1)[0]].filter(Boolean).join("  ")||"Nuevo proyecto",estado:"Prospecto",notas:[(N=B.servicios)!=null&&N.length?`Servicios: ${Array.isArray(B.servicios)?B.servicios.join(", "):B.servicios}`:"",(G=B.estilo)!=null&&G.length?`Estilo: ${Array.isArray(B.estilo)?B.estilo.join(", "):B.estilo}`:"",(L=B.espacios)!=null&&L.length?`Espacios: ${Array.isArray(B.espacios)?B.espacios.join(", "):B.espacios}`:"",B.colores?`Materiales: ${B.colores}`:"",(ae=B.expectativas)!=null&&ae.length?`Expectativas: ${Array.isArray(B.expectativas)?B.expectativas.join("; "):B.expectativas}`:"",B.linksReferentes?`Referencias: ${B.linksReferentes}`:""].filter(Boolean).join(`
`),razonSocial:B.razonSocial||"",documento:B.documento||"",emailFactura:B.emailFactura||B.clienteEmail||"",dirFacturacion:B.dirFacturacion||"",retencion:B.retenciones==="S",detalleRet:B.detalleRetenciones||"",anticipoAcept:B.anticipo||"",formaPago:B.formaPago||"",presupuesto:B.presupuesto?Number(String(B.presupuesto).replace(/[^0-9]/g,"")):0,fecha:new Date().toISOString().split("T")[0],briefingId:B.id,clienteId:W};se.push(le),V.deals=se,localStorage.setItem("habitaris_crm",JSON.stringify(V)),ie(B.id,B._sbId),alert(` Procesado:

 Cliente: ${R?"ya exista":"creado"}  ${B.clienteNombre||B.clienteEmail}
 Oferta borrador creada en CRM

Ve a CRM  Ofertas para continuar.`)};let re=s?i.filter(B=>B.formularioId===s):i;z==="pendiente"&&(re=re.filter(B=>!Q(B))),z==="procesado"&&(re=re.filter(B=>Q(B)));const J=i.filter(B=>!Q(B)),M=B=>{var N,G;const V=Ai(),X=t.find(L=>L.id===B.formularioId)||t.find(L=>L.nombre===B.formularioNombre),R=(X==null?void 0:X.campos)||[],W=["id","fecha","formularioId","formularioNombre","clienteNombre","clienteEmail","clienteTel"],se=[];let le={title:"Informacin general",fields:[]};R.forEach(L=>{if(L.tipo==="seccion")le.fields.length>0&&se.push(le),le={title:L.label,desc:L.desc||"",fields:[]};else if(L.tipo!=="info"){const ae=L.mapKey||L.id;let pe=B[ae];pe===void 0&&Object.entries(B).filter(([he])=>!W.includes(he)).forEach(([he,ze])=>{(he===L.label||he===L.mapKey)&&(pe=ze)}),pe!==void 0&&le.fields.push({label:L.label,value:Array.isArray(pe)?pe.join(", "):String(pe),tipo:L.tipo})}}),le.fields.length>0&&se.push(le),(se.length===0||se.every(L=>L.fields.length===0))&&(se.length=0,se.push({title:"Respuestas",desc:"",fields:Object.entries(B).filter(([L])=>!W.includes(L)).map(([L,ae])=>({label:L,value:Array.isArray(ae)?ae.join(", "):String(ae),tipo:"text"}))}));const de=new Date().toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}),Z=`<!DOCTYPE html><html><head><meta charset="utf-8">
<style>
@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;color:#111;background:#fff}
@page{size:A4;margin:0}
.page{width:210mm;min-height:297mm;margin:0 auto;padding:0;position:relative}

/* Header */
.header{background:#111;color:#fff;padding:28px 36px;display:flex;justify-content:space-between;align-items:center}
.logo{font-size:18px;font-weight:800;letter-spacing:5px;text-transform:uppercase}
.logo-sub{font-size:7px;letter-spacing:3px;color:rgba(255,255,255,.4);text-transform:uppercase;margin-top:2px}
.header-right{text-align:right}
.header-right div{font-size:8px;color:rgba(255,255,255,.5);letter-spacing:1px}

/* Gold bar */
.gold-bar{height:3px;background:linear-gradient(90deg,#C9A84C,#E8D48B,#C9A84C)}

/* Title block */
.title-block{padding:28px 36px 20px;border-bottom:1px solid #E0E0E0}
.doc-type{font-size:8px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#909090;margin-bottom:4px}
.doc-title{font-size:22px;font-weight:700;line-height:1.2;margin-bottom:6px}
.doc-meta{display:flex;gap:24px;margin-top:10px}
.meta-item{font-size:9px;color:#555}
.meta-item strong{color:#111;font-weight:700}

/* Client card */
.client-card{margin:20px 36px;background:#F5F4F1;border:1px solid #E0E0E0;border-radius:6px;padding:16px 20px;display:flex;align-items:center;gap:14px}
.client-avatar{width:42px;height:42px;border-radius:50%;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;flex-shrink:0}
.client-info{flex:1}
.client-name{font-size:14px;font-weight:700}
.client-email{font-size:10px;color:#3B3B3B;margin-top:2px}
.client-tel{font-size:9px;color:#909090;margin-top:1px}

/* Sections */
.section{margin:20px 36px}
.section-title{font-size:12px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:#111;padding-bottom:6px;border-bottom:2px solid #111;margin-bottom:12px;display:flex;align-items:center;gap:6px}
.section-desc{font-size:9px;color:#909090;margin:-8px 0 12px;font-weight:400}

/* Fields */
.field{margin-bottom:10px;display:flex;border-bottom:1px solid #F0EEEA;padding-bottom:8px}
.field-label{width:180px;flex-shrink:0;font-size:9px;font-weight:700;color:#555;text-transform:uppercase;letter-spacing:.5px;padding-top:2px}
.field-value{flex:1;font-size:12px;font-weight:500;color:#111}
.field-rating{color:#C9A84C;font-size:14px;letter-spacing:2px}

/* Footer */
.footer{position:fixed;bottom:0;left:0;right:0;background:#111;color:#fff;padding:12px 36px;display:flex;justify-content:space-between;align-items:center;font-size:7px;letter-spacing:2px}
.footer-gold{height:2px;background:linear-gradient(90deg,#C9A84C,#E8D48B,#C9A84C)}

/* Print */
@media print{
  body{-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .page{width:100%;min-height:auto}
  .no-print{display:none!important}
}
</style></head><body>
<div class="page">
  <!-- Header -->
  <div class="header">
    <div>
      <div class="logo">${V.empresa.nombre.toUpperCase()}</div>
      <div class="logo-sub">${V.empresa.eslogan}</div>
    </div>
    <div class="header-right">
      <div>INFORME DE FORMULARIO</div>
      <div style="margin-top:4px;font-size:9px;color:rgba(255,255,255,.7)">${de}</div>
    </div>
  </div>
  <div class="gold-bar"></div>

  <!-- Title -->
  <div class="title-block">
    <div class="doc-type">Formulario</div>
    <div class="doc-title">${B.formularioNombre||(X==null?void 0:X.nombre)||"Respuesta"}</div>
    <div class="doc-meta">
      <div class="meta-item"><strong>Fecha respuesta:</strong> ${B.fecha}</div>
      <div class="meta-item"><strong>ID:</strong> ${((N=B.id)==null?void 0:N.slice(0,8))||""}</div>
      ${X?`<div class="meta-item"><strong>Mdulo:</strong> ${((G=Da.find(L=>L.id===X.modulo))==null?void 0:G.lbl)||"General"}</div>`:""}
      <div class="meta-item"><strong>Campos:</strong> ${se.reduce((L,ae)=>L+ae.fields.length,0)}</div>
    </div>
  </div>

  <!-- Client card -->
  ${B.clienteNombre||B.clienteEmail?`
  <div class="client-card">
    <div class="client-avatar">${(B.clienteNombre||B.clienteEmail||"?")[0].toUpperCase()}</div>
    <div class="client-info">
      ${B.clienteNombre?`<div class="client-name">${B.clienteNombre}</div>`:""}
      ${B.clienteEmail?`<div class="client-email">${B.clienteEmail}</div>`:""}
      ${B.clienteTel?`<div class="client-tel"> ${B.clienteTel}</div>`:""}
    </div>
  </div>`:""}

  <!-- Scoring -->
  ${function(){var L=Cs(B,X);if(!L)return"";var ae={green:{bg:"#E8F4EE",border:"#111111",text:"#111111"},yellow:{bg:"#FAF0E0",border:"#8C6A00",text:"#8C6A00"},red:{bg:"#FAE8E8",border:"#B91C1C",text:"#B91C1C"}},pe=ae[L.level],he=L.details.map(function(ze){var q=ze.flag==="green"?"#111111":ze.flag==="red"?"#B91C1C":"#8C6A00",I=ze.flag==="green"?"":ze.flag==="red"?"":"";return'<tr style="border-bottom:1px solid #F0EEEA"><td style="padding:6px 12px;font-weight:600">'+ze.label+'</td><td style="padding:6px 12px">'+ze.value+'</td><td style="padding:6px 12px;text-align:center;font-weight:700;color:'+q+';font-family:DM Mono,monospace">'+ze.points+"/"+ze.maxPoints+'</td><td style="padding:6px 12px;text-align:center">'+I+"</td></tr>"}).join("");return'<div style="margin:20px 36px;border:1px solid '+pe.border+'44;border-radius:8px;overflow:hidden"><div style="display:flex;align-items:center;gap:16px;padding:16px 20px;background:'+pe.bg+'"><div style="font-size:28px;font-weight:800;font-family:DM Mono,monospace;color:'+pe.text+'">'+L.score.toFixed(1)+'<span style="font-size:12px">/10</span></div><div style="flex:1"><div style="font-size:14px;font-weight:700;color:'+pe.text+'">'+L.levelLabel+'</div><div style="font-size:9px;color:'+pe.text+';opacity:.8;margin-top:2px">'+L.conclusion+'</div></div><div style="display:flex;gap:10px"><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#111111">'+L.greens+'</div><div style="font-size:8px;color:#888"></div></div><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#8C6A00">'+L.yellows+'</div><div style="font-size:8px;color:#888"></div></div><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#B91C1C">'+L.reds+'</div><div style="font-size:8px;color:#888"></div></div></div></div><table style="width:100%;border-collapse:collapse;font-size:10px"><thead><tr style="background:#F5F4F1"><th style="padding:6px 12px;text-align:left;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Criterio</th><th style="padding:6px 12px;text-align:left;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Respuesta</th><th style="padding:6px 12px;text-align:center;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Puntos</th><th style="padding:6px 12px;text-align:center;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0"></th></tr></thead><tbody>'+he+"</tbody></table></div>"}()}

  <!-- Sections -->
  ${se.map((L,ae)=>`
  <div class="section">
    <div class="section-title"><span style="color:#C9A84C"></span> ${L.title}</div>
    ${L.desc?`<div class="section-desc">${L.desc}</div>`:""}
    ${L.fields.map(pe=>`
    <div class="field">
      <div class="field-label">${pe.label}</div>
      <div class="field-value">${pe.tipo==="rating"?`<span class="field-rating">${"".repeat(parseInt(pe.value)||0)}${"".repeat(5-(parseInt(pe.value)||0))}</span> <span style="font-size:10px;color:#909090">(${pe.value}/5)</span>`:pe.tipo==="yesno"?`<span style="display:inline-block;padding:2px 12px;border-radius:10px;font-size:10px;font-weight:700;background:${pe.value==="S"?"#E8F4EE":"#FAE8E8"};color:${pe.value==="S"?"#111111":"#B91C1C"}">${pe.value}</span>`:pe.value}</div>
    </div>`).join("")}
  </div>`).join("")}

  <!-- Confidentiality -->
  <div style="margin:30px 36px;padding:12px 16px;background:#F5F4F1;border-radius:4px;border-left:3px solid #C9A84C">
    <div style="font-size:7px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#909090;margin-bottom:4px">CONFIDENCIALIDAD</div>
    <div style="font-size:8px;color:#555;line-height:1.6">Este documento contiene informacin confidencial de ${V.empresa.nombre} y su cliente. Queda prohibida su reproduccin o distribucin sin autorizacin expresa.</div>
  </div>

  <!-- Footer -->
  <div class="footer-gold" style="position:fixed;bottom:28px;left:0;right:0"></div>
  <div class="footer">
    <span>${V.empresa.nombre.toUpperCase()}  ${B.formularioNombre||""}  ${B.clienteNombre||""}</span>
    <span>${de}</span>
  </div>
</div>

<!-- Print button -->
<div class="no-print" style="position:fixed;top:12px;right:12px;display:flex;gap:8px;z-index:100">
  <button onclick="window.print()" style="padding:10px 24px;background:#111;color:#fff;border:none;border-radius:6px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;letter-spacing:1px"> Imprimir / PDF</button>
  <button onclick="window.close()" style="padding:10px 16px;background:#fff;color:#111;border:1px solid #E0E0E0;border-radius:6px;font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer"> Cerrar</button>
</div>
</body></html>`,ue=window.open("","_blank");ue.document.write(Z),ue.document.close()};return e.jsxs("div",{className:"fade-up",children:[J.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",background:"#F3EEFF",border:"1px solid #5B3A8C33",borderRadius:8,marginBottom:14},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:"#5B3A8C",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:700,flexShrink:0},children:J.length}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#5B3A8C"},children:[" Tienes ",J.length," formulario",J.length>1?"s":""," sin asignar"]}),e.jsx("div",{style:{fontSize:9,color:"#7A5AAA",marginTop:2},children:'Haz clic en "Procesar" para crear cliente y borrador de oferta en CRM automticamente'})]}),e.jsx("button",{onClick:()=>k("pendiente"),style:{padding:"6px 14px",fontSize:10,fontWeight:700,background:"#5B3A8C",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Ver pendientes"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Respuestas  ",i.length]}),o&&e.jsxs("button",{onClick:o,disabled:n,style:{padding:"4px 10px",fontSize:9,fontWeight:600,cursor:n?"wait":"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${fe.border}`,borderRadius:4,background:"#fff",color:fe.inkMid,opacity:n?.5:1},children:[" ",n?"Cargando...":"Recargar"]}),j.size>0&&e.jsxs("button",{onClick:()=>oe({type:"selected"}),style:{padding:"4px 14px",fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:"none",borderRadius:4,background:fe.red,color:"#fff"},children:[" Eliminar seleccionados (",j.size,")"]}),j.size===0&&r&&i.length>0&&e.jsx("button",{onClick:()=>oe({type:"all"}),style:{padding:"4px 10px",fontSize:9,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${fe.red}44`,borderRadius:4,background:"#fff",color:fe.red},children:" Limpiar todo"}),e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[l&&e.jsx("button",{onClick:async()=>{y?confirm("Desactivar Touch ID / biometra?")&&h(!1):alert("No se pudo registrar. Intenta de nuevo.")},style:{background:"none",border:`1px solid ${y?"#111111":"#ddd"}`,borderRadius:4,cursor:"pointer",fontSize:10,padding:"3px 8px",color:y?"#111111":"#888"},title:y?"Touch ID activo  clic para desactivar":"Activar Touch ID",children:y?" Touch ID":" Activar Touch ID"}),e.jsx("button",{onClick:()=>{const B=localStorage.getItem("hab:form:deletePass")||"",V=prompt("Contrasea para eliminar (dejar vaco para desactivar):",B);V!==null&&(V?localStorage.setItem("hab:form:deletePass",V):localStorage.removeItem("hab:form:deletePass"))},style:{background:"none",border:"none",cursor:"pointer",fontSize:12,opacity:.4},title:D?" Contrasea activa  clic para cambiar":" Sin contrasea  clic para configurar",children:D?"":""})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[{v:"todos",l:"Todos"},{v:"pendiente",l:" Pendientes"},{v:"procesado",l:" Procesados"}].map((B,V)=>e.jsx("button",{onClick:()=>k(B.v),style:{padding:"5px 12px",fontSize:9,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${fe.border}`,borderLeft:V>0?"none":void 0,borderRadius:V===0?"4px 0 0 4px":V===2?"0 4px 4px 0":"0",background:z===B.v?"#111":"#fff",color:z===B.v?"#fff":fe.inkMid},children:B.l},B.v))}),e.jsxs("select",{value:s,onChange:B=>d(B.target.value),style:{...jt,width:200},children:[e.jsx("option",{value:"",children:"Todos los formularios"}),t.map(B=>e.jsx("option",{value:B.id,children:B.nombre},B.id))]})]})]}),e.jsx(Lt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{...Sa,width:30},children:e.jsx("input",{type:"checkbox",checked:re.length>0&&j.size===re.length,onChange:()=>C(re.map(B=>B.id)),style:{cursor:"pointer"}})}),["Fecha","Hora","Formulario","Cliente","Email","Score","Estado","Acciones"].map(B=>e.jsx("th",{style:Sa,children:B},B))]})}),e.jsx("tbody",{children:re.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:fe.inkLight,fontSize:11},children:["Sin respuestas",z!=="todos"?" con este filtro":""]})}):re.sort((B,V)=>(V.fecha||"").localeCompare(B.fecha||"")).map(B=>{var le;const V=Q(B),X=B.created_at?new Date(B.created_at):null,R=X?X.toISOString().split("T")[0]:B.fecha||"",W=X?X.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}):"",se=(u==null?void 0:u.id)===B.id;return e.jsxs(ka.Fragment,{children:[e.jsxs("tr",{style:{cursor:"pointer",background:j.has(B.id)?"#FDF5F5":se?"#F0EEFF":V?"":"#FDFBFF",transition:"background .15s"},onClick:()=>b(se?null:B),children:[e.jsx("td",{style:{...Gt,width:30},onClick:de=>de.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:j.has(B.id),onChange:()=>T(B.id),style:{cursor:"pointer"}})}),e.jsx("td",{style:{...Gt,fontFamily:"'DM Mono',monospace",fontSize:9},children:R}),e.jsx("td",{style:{...Gt,fontSize:9},children:W}),e.jsx("td",{style:{...Gt,fontWeight:600,fontSize:10},children:B.formularioNombre||((le=t.find(de=>de.id===B.formularioId))==null?void 0:le.nombre)||""}),e.jsx("td",{style:{...Gt,fontWeight:600,fontSize:10},children:B.clienteNombre||""}),e.jsx("td",{style:{...Gt,fontSize:9,color:fe.blue},children:B.clienteEmail||""}),e.jsx("td",{style:{...Gt,textAlign:"center"},children:(()=>{const de=t.find(L=>L.id===B.formularioId)||t.find(L=>L.nombre===B.formularioNombre),Z=Cs(B,de);if(!Z)return e.jsx("span",{style:{fontSize:8,color:fe.inkLight},children:""});const ue=Z.level==="green"?fe.green:Z.level==="red"?fe.red:fe.amber,N=Z.level==="green"?fe.greenBg:Z.level==="red"?fe.redBg:fe.amberBg,G=Z.level==="green"?"":Z.level==="red"?"":"";return e.jsxs("span",{style:{fontSize:9,fontWeight:700,padding:"2px 8px",borderRadius:10,background:N,color:ue},children:[G," ",Z.score.toFixed(1)]})})()}),e.jsx("td",{style:Gt,children:V?e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:fe.greenBg,color:fe.green},children:" Procesado"}):e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:"#F3EEFF",color:"#5B3A8C"},children:" Pendiente"})}),e.jsxs("td",{style:{...Gt,whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:de=>{de.stopPropagation(),b(se?null:B)},style:{background:"none",border:"none",cursor:"pointer",marginRight:4},title:"Ver detalle",children:se?e.jsx(tl,{size:11,color:fe.blue}):e.jsx(An,{size:11,color:fe.blue})}),e.jsx("button",{onClick:de=>{de.stopPropagation(),M(B)},style:{background:"none",border:"none",cursor:"pointer",marginRight:4},title:"Generar informe",children:e.jsx(At,{size:11,color:fe.ink})}),!V&&e.jsx("button",{onClick:de=>{de.stopPropagation(),je(B)},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:"#5B3A8C",color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},title:"Crear cliente + oferta en CRM",children:" Procesar"}),V&&e.jsx("button",{onClick:de=>{de.stopPropagation(),me(B.id,B._sbId)},style:{padding:"3px 8px",fontSize:8,fontWeight:600,background:"#fff",color:fe.inkMid,border:`1px solid ${fe.border}`,borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},title:"Marcar como pendiente",children:""}),a&&e.jsx("button",{onClick:de=>{de.stopPropagation(),oe({type:"single",target:B})},style:{background:"none",border:"none",cursor:"pointer",marginLeft:4,opacity:.5},title:"Eliminar respuesta",children:e.jsx(qe,{size:11,color:fe.red})})]})]}),se&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:0,borderBottom:`2px solid ${fe.blue}33`},children:e.jsxs("div",{style:{padding:"14px 16px",background:"#F8F7FF"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[e.jsxs("h3",{style:{fontSize:12,fontWeight:700,margin:0},children:[" Detalle  ",B.clienteNombre||B.fecha]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[!V&&e.jsx(vo,{v:"pri",on:()=>je(B),children:" Procesar  CRM"}),V&&e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"4px 12px",borderRadius:10,background:fe.greenBg,color:fe.green},children:" Procesado"}),e.jsxs(vo,{v:"sec",on:()=>M(B),children:[e.jsx(At,{size:10})," Informe"]})]})]}),(()=>{const de=t.find(G=>G.id===B.formularioId)||t.find(G=>G.nombre===B.formularioNombre),Z=Cs(B,de);if(!Z)return null;const N={green:{bg:"#E8F4EE",border:"#111111",text:"#111111"},yellow:{bg:"#FAF0E0",border:"#8C6A00",text:"#8C6A00"},red:{bg:"#FAE8E8",border:"#B91C1C",text:"#B91C1C"}}[Z.level];return e.jsxs("div",{style:{marginBottom:12,border:`1px solid ${N.border}33`,borderRadius:6,overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 14px",background:N.bg},children:[e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:N.text},children:[Z.score.toFixed(1),e.jsx("span",{style:{fontSize:10},children:"/10"})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:N.text},children:Z.levelLabel}),e.jsx("div",{style:{fontSize:8,color:N.text,opacity:.8},children:Z.conclusion})]}),e.jsx("div",{style:{display:"flex",gap:6},children:[["",Z.greens,fe.green],["",Z.yellows,fe.amber],["",Z.reds,fe.red]].map(([G,L,ae])=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:800,color:ae},children:L}),e.jsx("div",{style:{fontSize:7},children:G})]},G))})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:4,padding:"8px 14px",background:"#fff"},children:Z.details.map((G,L)=>{const ae=G.flag==="green"?fe.green:G.flag==="red"?fe.red:fe.amber,pe=G.flag==="green"?"":G.flag==="red"?"":"";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 8px",background:fe.bg,borderRadius:4,fontSize:9},children:[e.jsx("span",{children:pe}),e.jsx("span",{style:{fontWeight:600,flex:1},children:G.label}),e.jsx("span",{style:{color:fe.inkMid},children:G.value}),e.jsxs("span",{style:{fontWeight:700,color:ae,fontFamily:"'DM Mono',monospace"},children:[G.points,"/",G.maxPoints]})]},L)})})]})})(),(()=>{const de=N=>B[N]!==void 0?Array.isArray(B[N])?B[N].join(", "):String(B[N]):null,Z=(N,G)=>G?e.jsxs("div",{style:{padding:"4px 8px",background:"#fff",borderRadius:4,border:`1px solid ${fe.border}`},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:N}),e.jsx("div",{style:{fontSize:10,fontWeight:600,marginTop:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:G})]}):null,ue=(N,G)=>e.jsxs("div",{style:{gridColumn:"1/-1",fontSize:9,fontWeight:700,color:fe.inkMid,marginTop:6,paddingBottom:2,borderBottom:`1px solid ${fe.border}`},children:[N," ",G]});return e.jsxs("div",{children:[(B.clienteNombre||B.clienteEmail)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",background:fe.blueBg,borderRadius:6,border:`1px solid ${fe.blue}22`,marginBottom:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:fe.blue,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700},children:(B.clienteNombre||B.clienteEmail||"?")[0].toUpperCase()}),e.jsxs("div",{style:{flex:1},children:[B.clienteNombre&&e.jsx("div",{style:{fontSize:12,fontWeight:700,color:fe.blue},children:B.clienteNombre}),e.jsxs("div",{style:{display:"flex",gap:12,fontSize:9,color:fe.inkMid,marginTop:2},children:[B.clienteEmail&&e.jsxs("span",{children:[" ",B.clienteEmail]}),B.clienteTel&&e.jsxs("span",{children:[" ",B.clienteTel]}),de("tipoDocumento")&&e.jsxs("span",{children:[" ",de("tipoDocumento")," ",de("numDocumento")||""]})]})]}),de("propietario")&&e.jsx("div",{style:{padding:"3px 10px",borderRadius:12,fontSize:8,fontWeight:700,background:de("propietario")==="Soy el propietario"?fe.greenBg:fe.amberBg,color:de("propietario")==="Soy el propietario"?fe.green:fe.amber},children:de("propietario")})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6},children:[ue("","Ubicacin"),Z("Pas",de("pais")),Z("Departamento/Regin",de("departamento")),Z("Ciudad",de("ciudad")),Z("Direccin",de("direccion")),Z("Inmueble",de("tipoVivienda")),Z("rea m",de("area")),ue("","Proyecto y Diseo"),Z("Servicios",de("servicios")),Z("Tipo proyecto",de("tipoProyecto")),Z("Estilo",de("estilo")),Z("Espacios",de("espacios")),Z("Expectativas",de("expectativas")),Z("Prioridades",de("prioridades")),ue("","Presupuesto"),Z("Presupuesto",de("presupuesto")),Z("Honorarios diseo",de("honorariosDiseo")),Z("Financiacin",de("financiacion")),Z("Anticipo 30-50%",de("anticipo")),Z("Forma de pago",de("formaPago")),Z("Flexibilidad",de("flexibilidad")),ue("","Plazos"),Z("Plazo",de("plazo")),Z("Fecha inicio",de("fechaInicio"))]})]})})()]})})})]},B.id)})})]})}),S&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>m(!1),children:e.jsxs("div",{onClick:B=>B.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:340,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:32,textAlign:"center",marginBottom:8},children:""}),e.jsx("h3",{style:{margin:"0 0 4px",fontSize:14,fontWeight:700,textAlign:"center"},children:"Confirmar eliminacin"}),e.jsx("p",{style:{margin:"0 0 16px",fontSize:10,color:fe.inkMid,textAlign:"center"},children:(c==null?void 0:c.type)==="all"?"Eliminar TODAS las respuestas":(c==null?void 0:c.type)==="selected"?`Eliminar ${j.size} respuesta${j.size>1?"s":""}`:"Eliminar respuesta"}),e.jsx("input",{type:"password",value:x,onChange:B=>p(B.target.value),onKeyDown:B=>{B.key==="Enter"&&P()},placeholder:"Ingresa la contrasea",autoFocus:!0,style:{...jt,width:"100%",fontSize:12,marginBottom:12,textAlign:"center"}}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>m(!1),style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:600,border:`1px solid ${fe.border}`,borderRadius:4,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"}),e.jsx("button",{onClick:P,style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:700,border:"none",borderRadius:4,background:fe.red,color:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]})})]})}function _m({forms:t,setForms:i,onEdit:o}){const n=a=>{var r,s;try{const d=t.find(w=>w.sourceTemplate===a.id||w.nombre===a.nombre);if(d){d.sourceTemplate||i(t.map(w=>w.id===d.id?{...w,sourceTemplate:a.id}:w)),o(d.id);return}const u={};a.campos.forEach(w=>{u[w.id]=gt()});const b=a.campos.map(w=>{const S={...w,id:u[w.id]};return S.logica&&S.logica.fieldId&&u[S.logica.fieldId]&&(S.logica={...S.logica,fieldId:u[S.logica.fieldId]}),S.paisRef&&u[S.paisRef]&&(S.paisRef=u[S.paisRef]),S.dynamicOpciones&&S.dynamicOpciones.dependsOn&&u[S.dynamicOpciones.dependsOn]&&(S.dynamicOpciones={...S.dynamicOpciones,dependsOn:u[S.dynamicOpciones.dependsOn]}),S}),j={id:gt(),nombre:a.nombre,modulo:a.modulo||"general",campos:b,config:{...a.config||{},titulo:((r=a.config)==null?void 0:r.titulo)||a.nombre,vista:((s=a.config)==null?void 0:s.vista)||"pasos"},createdAt:qi(),updatedAt:qi(),activo:!0,sourceTemplate:a.id};i([...t,j]),o(j.id)}catch(d){console.error("Error al usar plantilla:",d),alert("Error al crear formulario desde plantilla")}};return e.jsxs("div",{className:"fade-up",children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700,marginBottom:14},children:"Plantillas prediseadas"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280,1fr))",gap:12},children:Sc.map(a=>{const r=Da.find(d=>d.id===a.modulo),s=t.find(d=>d.sourceTemplate===a.id||d.nombre===a.nombre);return e.jsxs(Lt,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"14px 16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:a.nombre}),e.jsx(tr,{color:fe.purple,children:(r==null?void 0:r.lbl)||"General"})]}),e.jsx("div",{style:{fontSize:10,color:fe.inkMid,marginTop:4},children:a.desc}),e.jsxs("div",{style:{fontSize:8,color:fe.inkLight,marginTop:4},children:[a.campos.filter(d=>d.tipo!=="seccion").length," campos  ",a.campos.filter(d=>d.required).length," obligatorios"]})]}),e.jsx("div",{style:{borderTop:`1px solid ${fe.border}`,padding:0},children:e.jsx("button",{onClick:()=>n(a),style:{width:"100%",padding:"8px 0",border:"none",background:"transparent",cursor:"pointer",fontSize:10,fontWeight:700,color:s?fe.blue:fe.green,fontFamily:"'DM Sans',sans-serif"},children:s?" Editar formulario existente":" Usar esta plantilla"})})]},a.id)})})]})}function Dm({forms:t}){const[i,o]=F.useState(!0),[n,a]=F.useState(null),[r,s]=F.useState("all"),[d,u]=F.useState(null);if(F.useEffect(()=>{if(jo()){o(!1);return}Promise.resolve({}).then(v=>{a(v),o(!1)}).catch(()=>o(!1))},[]),F.useEffect(()=>{u(null)},[r]),i)return e.jsx(Lt,{style:{padding:28,textAlign:"center"},children:e.jsx("div",{style:{fontSize:11,color:fe.inkMid},children:"Cargando estadsticas..."})});const b=(n==null?void 0:n.events)||[],j=(n==null?void 0:n.responses)||[],w=b.filter(v=>v.event_type==="open"),S=b.filter(v=>v.event_type==="submit"),m=b.filter(v=>v.event_type==="close"&&v.duration_seconds>0),x=m.length>0?Math.round(m.reduce((v,A)=>v+A.duration_seconds,0)/m.length):0,p=w.length>0?Math.round(S.length/w.length*100):0,c=v=>v<60?`${v}s`:v<3600?`${Math.floor(v/60)}m ${v%60}s`:`${Math.floor(v/3600)}h ${Math.floor(v%3600/60)}m`,g={};b.forEach(v=>{const A=(v.form_id||"")+"_"+(v.client_email||v.client_name||"anon");g[A]||(g[A]={form_id:v.form_id,form_name:v.form_name||v.form_id,client_name:v.client_name||"",client_email:v.client_email||"",opens:0,submits:0,lastDate:null,duration:0,durationCount:0}),v.event_type==="open"&&g[A].opens++,v.event_type==="submit"&&g[A].submits++,v.event_type==="close"&&v.duration_seconds>0&&(g[A].duration+=v.duration_seconds,g[A].durationCount++);const z=v.created_at?new Date(v.created_at):null;z&&(!g[A].lastDate||z>g[A].lastDate)&&(g[A].lastDate=z)});let l=Object.values(g);r!=="all"&&(l=l.filter(v=>v.form_id===r)),l.sort((v,A)=>(A.lastDate||0)-(v.lastDate||0));const f=[...new Set(b.map(v=>v.form_id).concat(j.map(v=>v.form_id)))],y={padding:"8px 10px",textAlign:"left",fontWeight:700,fontSize:8,textTransform:"uppercase",color:fe.inkMid,borderBottom:`1px solid ${fe.border}`},h={padding:"8px 10px",fontSize:11,borderBottom:`1px solid ${fe.border}`,verticalAlign:"middle"};return e.jsxs("div",{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginBottom:16},children:[[" Aperturas",w.length,"#3B3B3B"],[" Envos",S.length,"#111111"],[" Conversin",`${p}%`,"#5B3A8C"],[" Tiempo promedio",c(x),"#8C6A00"]].map(([v,A,z])=>e.jsxs(Lt,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:v}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:z},children:A})]},v))}),e.jsx(Lt,{style:{padding:"14px 16px",marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:fe.inkMid,textTransform:"uppercase"},children:"Filtrar por formulario:"}),e.jsxs("select",{value:r,onChange:v=>s(v.target.value),style:{...jt,width:260,fontSize:11},children:[e.jsx("option",{value:"all",children:" Todos los formularios"}),t.map(v=>e.jsx("option",{value:v.id,children:v.nombre},v.id)),f.filter(v=>!t.find(A=>A.id===v)).map(v=>e.jsxs("option",{value:v,children:["ID: ",v]},v))]})]})}),d&&e.jsxs(Lt,{style:{padding:"16px",marginBottom:16},children:[e.jsx("h3",{style:{margin:"0 0 12px",fontSize:14,fontWeight:700},children:" Detalle del formulario"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:14},children:[["Aperturas",d.totalOpens,"#3B3B3B"],["Envos",d.totalSubmits,"#111111"],["Conversin",d.conversionRate+"%","#5B3A8C"],["Tiempo prom.",c(d.avgDurationSec),"#8C6A00"]].map(([v,A,z])=>e.jsxs("div",{style:{padding:"10px 12px",background:fe.bg,borderRadius:6,border:`1px solid ${fe.border}`},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:v}),e.jsx("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:z},children:A})]},v))})]}),e.jsxs(Lt,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"14px 16px",borderBottom:`1px solid ${fe.border}`},children:e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700},children:" Formularios recibidos"})}),l.length===0?e.jsx("div",{style:{fontSize:11,color:fe.inkMid,textAlign:"center",padding:28},children:"No hay actividad registrada an."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:fe.bg},children:["Estado","Fecha","Hora","Formulario","Cliente","Aperturas","Envos","Tiempo","Conversin"].map(v=>e.jsx("th",{style:y,children:v},v))})}),e.jsx("tbody",{children:l.map((v,A)=>{const z=v.submits>0,k=v.opens>0?Math.round(v.submits/v.opens*100):0,T=v.durationCount>0?Math.round(v.duration/v.durationCount):0,C=v.lastDate?v.lastDate.toISOString().split("T")[0]:"",D=v.lastDate?v.lastDate.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}):"";return e.jsxs("tr",{style:{background:A%2===0?"#fff":"#FFFFFF"},children:[e.jsx("td",{style:h,children:e.jsx("span",{style:{fontSize:9,padding:"3px 10px",borderRadius:10,fontWeight:700,color:z?fe.green:fe.amber,background:z?fe.greenBg:fe.amberBg},children:z?" Recibido":" Pendiente"})}),e.jsx("td",{style:{...h,fontFamily:"'DM Mono',monospace",fontSize:9},children:C}),e.jsx("td",{style:{...h,fontSize:9},children:D}),e.jsx("td",{style:{...h,fontWeight:600},children:v.form_name}),e.jsxs("td",{style:h,children:[e.jsx("div",{style:{fontWeight:600,fontSize:11},children:v.client_name||""}),v.client_email&&e.jsx("div",{style:{fontSize:9,color:fe.blue},children:v.client_email})]}),e.jsx("td",{style:{...h,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#3B3B3B"},children:v.opens}),e.jsx("td",{style:{...h,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111"},children:v.submits}),e.jsx("td",{style:{...h,textAlign:"center",fontSize:10,color:fe.inkMid},children:T>0?c(T):""}),e.jsx("td",{style:{...h,textAlign:"center"},children:e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,color:k>=50?fe.green:k>0?fe.amber:fe.inkLight},children:[k,"%"]})})]},A)})})]})})]})]})}function $m({envios:t,save:i,respuestas:o}){const[n,a]=F.useState(new Set),[r,s]=F.useState(!1),[d,u]=F.useState(""),[b,j]=F.useState(null),w=f=>a(y=>{const h=new Set(y);return h.has(f)?h.delete(f):h.add(f),h}),S=()=>a(f=>f.size===t.length?new Set:new Set(t.map(y=>y.id))),m=localStorage.getItem("hab:form:deletePass")||"",p=m||!1,c=async f=>{if(!p){g(f);return}m&&(j(f),u(""),s(!0))},g=f=>{f.type==="single"?i("envios",t.filter(y=>y.id!==f.target.id)):f.type==="selected"?(i("envios",t.filter(y=>!n.has(y.id))),a(new Set)):f.type==="all"&&(i("envios",[]),a(new Set)),s(!1),j(null)},l=()=>{d===m?g(b):alert("Contrasea incorrecta")};return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Formularios enviados  ",t.length]}),n.size>0&&e.jsxs("button",{onClick:()=>c({type:"selected"}),style:{padding:"5px 14px",fontSize:9,fontWeight:700,background:fe.red,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" Eliminar seleccionados (",n.size,")"]}),n.size===0&&t.length>0&&e.jsx("button",{onClick:()=>c({type:"all"}),style:{padding:"5px 14px",fontSize:9,fontWeight:600,background:"#fff",color:fe.red,border:`1px solid ${fe.red}44`,borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Limpiar todo"})]})}),e.jsx(Lt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{...Sa,width:30},children:e.jsx("input",{type:"checkbox",checked:t.length>0&&n.size===t.length,onChange:S,style:{cursor:"pointer"}})}),["Fecha","Hora","Formulario","Cliente","Email","Telfono","Estado","Acciones"].map(f=>e.jsx("th",{style:Sa,children:f},f))]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:fe.inkLight,fontSize:11},children:"No has enviado formularios an"})}):[...t].reverse().map(f=>{var v,A,z;const y=o.some(k=>{var T;return k.clienteEmail===((T=f.cliente)==null?void 0:T.email)&&k.formularioId===f.formId}),h=f.blocked;return e.jsxs("tr",{style:{background:n.has(f.id)||h?"#FDF5F5":""},children:[e.jsx("td",{style:{...Gt,width:30},children:e.jsx("input",{type:"checkbox",checked:n.has(f.id),onChange:()=>w(f.id),style:{cursor:"pointer"}})}),e.jsx("td",{style:{...Gt,fontFamily:"'DM Mono',monospace",fontSize:9},children:f.fecha}),e.jsx("td",{style:{...Gt,fontSize:9},children:f.hora}),e.jsx("td",{style:{...Gt,fontWeight:600},children:f.formNombre}),e.jsx("td",{style:{...Gt,fontWeight:600},children:((v=f.cliente)==null?void 0:v.nombre)||""}),e.jsx("td",{style:{...Gt,fontSize:9,color:fe.blue},children:((A=f.cliente)==null?void 0:A.email)||""}),e.jsx("td",{style:{...Gt,fontSize:9},children:((z=f.cliente)==null?void 0:z.tel)||""}),e.jsx("td",{style:Gt,children:h?e.jsx(tr,{color:fe.red,children:" Bloqueado"}):y?e.jsx(tr,{color:fe.green,children:" Respondido"}):e.jsx(tr,{color:fe.amber,children:" Pendiente"})}),e.jsxs("td",{style:{...Gt,whiteSpace:"nowrap"},children:[h?e.jsx("button",{onClick:()=>{i("envios",t.map(k=>k.id===f.id?{...k,blocked:!1}:k))},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:fe.green,color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Desbloquear"}):e.jsx("button",{onClick:()=>{confirm("Bloquear este enlace?")&&i("envios",t.map(k=>k.id===f.id?{...k,blocked:!0}:k))},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:fe.red,color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Bloquear"}),e.jsx("button",{onClick:()=>c({type:"single",target:f}),style:{background:"none",border:"none",cursor:"pointer",marginLeft:4,opacity:.5},children:e.jsx(qe,{size:11,color:fe.red})})]})]},f.id)})})]})}),r&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>s(!1),children:e.jsxs("div",{onClick:f=>f.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:340,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:32,textAlign:"center",marginBottom:8},children:""}),e.jsx("h3",{style:{margin:"0 0 4px",fontSize:14,fontWeight:700,textAlign:"center"},children:"Confirmar eliminacin"}),e.jsx("p",{style:{margin:"0 0 16px",fontSize:10,color:fe.inkMid,textAlign:"center"},children:(b==null?void 0:b.type)==="all"?"Eliminar TODOS los envos":(b==null?void 0:b.type)==="selected"?`Eliminar ${n.size} envo${n.size>1?"s":""}`:"Eliminar envo"}),e.jsx("input",{type:"password",value:d,onChange:f=>u(f.target.value),onKeyDown:f=>{f.key==="Enter"&&l()},placeholder:"Ingresa la contrasea",autoFocus:!0,style:{...jt,width:"100%",fontSize:12,marginBottom:12,textAlign:"center"}}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>s(!1),style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:600,border:`1px solid ${fe.border}`,borderRadius:4,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"}),e.jsx("button",{onClick:l,style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:700,border:"none",borderRadius:4,background:fe.red,color:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]})})]})}function Pm(){const[t,i]=F.useState(()=>{try{const v=JSON.parse(localStorage.getItem(Gn))||{};return v.forms||(v.forms=[]),v}catch{return{forms:[]}}});F.useEffect(()=>{(async()=>{var v,A,z;try{const k=await((A=(v=window.storage)==null?void 0:v.get)==null?void 0:A.call(v,Gn));if(k!=null&&k.value){const T=JSON.parse(k.value);(z=T==null?void 0:T.forms)!=null&&z.length&&i(C=>{const D=new Set((C.forms||[]).map(te=>te.id)),K=(T.forms||[]).filter(te=>!D.has(te.id)),oe={...T,forms:[...C.forms||[],...K]};return localStorage.setItem(Gn,JSON.stringify(oe)),oe})}}catch(k){console.warn("Cloud load forms:",k)}})()},[]);const o=(v,A)=>i(z=>{var T,C;const k={...z,[v]:typeof A=="function"?A(z[v]):A};localStorage.setItem(Gn,JSON.stringify(k));try{(C=(T=window.storage)==null?void 0:T.set)==null||C.call(T,Gn,JSON.stringify(k))}catch{}return k}),n=t.forms||[],a=v=>o("forms",typeof v=="function"?v(n):v);F.useEffect(()=>{(async()=>{var v,A;try{const z=await((A=(v=window.storage)==null?void 0:v.get)==null?void 0:A.call(v,"hab:form:procesados"));if(z!=null&&z.value){const k=JSON.parse(z.value),T=JSON.parse(localStorage.getItem("hab:form:procesados")||"[]"),C=[...new Set([...T,...k])];localStorage.setItem("hab:form:procesados",JSON.stringify(C))}}catch{}})()},[]),F.useEffect(()=>{const v=t.forms||[];let A=[...v],z=!1;Sc.forEach(k=>{var C,D;const T=v.find(K=>K.sourceTemplate===k.id||K.nombre===k.nombre);if(T){if(k.version&&(!T.templateVersion||T.templateVersion<k.version)){const K={};k.campos.forEach(te=>{K[te.id]=gt()});const oe=k.campos.map(te=>{const P={...te,id:K[te.id]};return P.logica&&P.logica.fieldId&&K[P.logica.fieldId]&&(P.logica={...P.logica,fieldId:K[P.logica.fieldId]}),P.paisRef&&K[P.paisRef]&&(P.paisRef=K[P.paisRef]),P.dynamicOpciones&&P.dynamicOpciones.dependsOn&&K[P.dynamicOpciones.dependsOn]&&(P.dynamicOpciones={...P.dynamicOpciones,dependsOn:K[P.dynamicOpciones.dependsOn]}),P});A=A.map(te=>{var P,ie;return te.id===T.id?{...te,campos:oe,config:{...k.config||{},titulo:((P=k.config)==null?void 0:P.titulo)||k.nombre,vista:((ie=k.config)==null?void 0:ie.vista)||"pasos"},updatedAt:qi(),templateVersion:k.version,sourceTemplate:k.id}:te}),z=!0}}else{const K={};k.campos.forEach(te=>{K[te.id]=gt()});const oe=k.campos.map(te=>{const P={...te,id:K[te.id]};return P.logica&&P.logica.fieldId&&K[P.logica.fieldId]&&(P.logica={...P.logica,fieldId:K[P.logica.fieldId]}),P.paisRef&&K[P.paisRef]&&(P.paisRef=K[P.paisRef]),P.dynamicOpciones&&P.dynamicOpciones.dependsOn&&K[P.dynamicOpciones.dependsOn]&&(P.dynamicOpciones={...P.dynamicOpciones,dependsOn:K[P.dynamicOpciones.dependsOn]}),P});A.push({id:gt(),nombre:k.nombre,modulo:k.modulo||"general",campos:oe,config:{...k.config||{},titulo:((C=k.config)==null?void 0:C.titulo)||k.nombre,vista:((D=k.config)==null?void 0:D.vista)||"pasos"},createdAt:qi(),updatedAt:qi(),activo:!0,sourceTemplate:k.id,templateVersion:k.version||1}),z=!0}}),z&&o("forms",A)},[]);const r=t.envios||[],s=v=>o("envios",[...r,v]),[d,u]=F.useState([]),[b,j]=F.useState(!1),w=async()=>{j(!0);const v=[],A=new Set;if(jo())try{const z=await nh();z&&z.length>0&&z.forEach(k=>{const T=k.data||{},C={...T,_sbId:k.id,id:T.id||k.id,formularioId:k.form_id||T.formularioId,formularioNombre:k.form_name||T.formularioNombre,clienteNombre:k.client_name||T.clienteNombre,clienteEmail:k.client_email||T.clienteEmail,clienteTel:k.client_tel||T.clienteTel,fecha:T.fecha||(k.created_at?k.created_at.split("T")[0]:""),created_at:k.created_at||null,processed:k.processed||!1};A.has(C.id)||(A.add(C.id),v.push(C))})}catch(z){console.warn("Error loading Supabase responses:",z)}for(let z=0;z<localStorage.length;z++){const k=localStorage.key(z);if(k!=null&&k.startsWith("shared:hab:briefing:"))try{const T=JSON.parse(localStorage.getItem(k));T&&T.id&&!A.has(T.id)&&(A.add(T.id),v.push(T))}catch{}}u(v),j(!1)};F.useEffect(()=>{w()},[]);const S=async v=>{v._sbId;for(let A=0;A<localStorage.length;A++){const z=localStorage.key(A);if(z!=null&&z.startsWith("shared:hab:briefing:"))try{const k=JSON.parse(localStorage.getItem(z));if((k==null?void 0:k.id)===v.id){localStorage.removeItem(z);break}}catch{}}u(A=>A.filter(z=>z.id!==v.id))},m=async()=>{jo();const v=[];for(let A=0;A<localStorage.length;A++){const z=localStorage.key(A);z!=null&&z.startsWith("shared:hab:briefing:")&&v.push(z)}v.forEach(A=>localStorage.removeItem(A)),u([])},[x,p]=F.useState(()=>localStorage.getItem("hab:form:tab")||"dashboard"),c=v=>{var A,z;p(v),localStorage.setItem("hab:form:tab",v);try{(z=(A=window.storage)==null?void 0:A.set)==null||z.call(A,"hab:form:tab",v)}catch{}},[g,l]=F.useState(null),f=v=>{l(v||null),c("constructor")},y=()=>{l(null),c("constructor")},h=v=>{l(v.id),c("mis_forms")};return e.jsxs(e.Fragment,{children:[e.jsx(Am,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Formularios"}),e.jsx("div",{style:{fontSize:10,color:fe.inkMid},children:"Constructor  Plantillas  Respuestas  Compartir"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:yd.map((v,A)=>e.jsx("button",{onClick:()=>{c(v.id),v.id!=="constructor"&&l(null)},style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${fe.border}`,borderLeft:A>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:A===0?"6px 0 0 6px":A===yd.length-1?"0 6px 6px 0":"0",background:x===v.id?"#111":"#fff",color:x===v.id?"#fff":fe.inkMid},children:v.lbl},v.id))}),x==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:(()=>{const v=(()=>{try{return JSON.parse(localStorage.getItem("hab:form:procesados")||"[]")}catch{return[]}})(),A=d.filter(z=>!v.includes(z.id)).length;return[[" Formularios",n.length,"#111"],[" Enviados",r.length,"#3B3B3B"],[" Respuestas",d.length,"#111111"],[" Sin asignar",A,A>0?"#5B3A8C":"#111111"]]})().map(([v,A,z])=>e.jsxs(Lt,{style:{padding:"14px 16px",cursor:v.includes("Sin asignar")&&A>0?"pointer":void 0},onClick:v.includes("Sin asignar")&&A>0?()=>c("respuestas"):void 0,children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:v}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:z},children:A})]},v))}),(()=>{const v=(()=>{try{return JSON.parse(localStorage.getItem("hab:form:procesados")||"[]")}catch{return[]}})(),A=d.filter(z=>!v.includes(z.id)).length;return A===0?null:e.jsx(Lt,{style:{padding:"12px 16px",marginBottom:16,background:"#F3EEFF",border:"1px solid #5B3A8C33",cursor:"pointer"},onClick:()=>c("respuestas"),children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"#5B3A8C",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700},children:A}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#5B3A8C"},children:[" Tienes ",A," formulario",A>1?"s":""," sin asignar"]}),e.jsx("div",{style:{fontSize:9,color:"#7A5AAA",marginTop:1},children:"Haz clic para ir a Respuestas y procesarlos  crear cliente + borrador oferta"})]})]})})})(),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12},children:[e.jsxs(Lt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:y,children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Crear formulario"}),e.jsx("div",{style:{fontSize:9,color:fe.inkMid,marginTop:2},children:"Desde cero con el constructor"})]}),e.jsxs(Lt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:()=>c("plantillas"),children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Usar plantilla"}),e.jsx("div",{style:{fontSize:9,color:fe.inkMid,marginTop:2},children:"Briefing, SST, encuestas..."})]}),e.jsxs(Lt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:()=>c("respuestas"),children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Ver respuestas"}),e.jsxs("div",{style:{fontSize:9,color:fe.inkMid,marginTop:2},children:[d.length," respuestas recibidas"]})]})]})]}),x==="mis_forms"&&e.jsx(Rm,{forms:n,setForms:a,onEdit:f,onNew:y}),x==="constructor"&&e.jsx(Im,{forms:n,setForms:a,editId:g,setEditId:l,onSaved:h,envios:r,addEnvio:s}),x==="enviados"&&e.jsx($m,{envios:r,save:o,respuestas:d}),x==="respuestas"&&e.jsx(Mm,{forms:n,respuestas:d,onReload:w,loading:b,onDelete:S,onClearAll:m}),x==="estadisticas"&&e.jsx(Dm,{forms:n}),x==="plantillas"&&e.jsx(_m,{forms:n,setForms:a,onEdit:f})]})]})}const Ge={ink:"#111",inkMid:"#444",inkLight:"#888",inkXLight:"#C8C5BE",bg:"#F5F4F1",surface:"#FFFFFF",border:"#E0E0E0",green:"#111111",greenBg:"#E8F4EE",greenLight:"#D4EDDF",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FFF8EE",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 4px rgba(0,0,0,.06), 0 8px 32px rgba(0,0,0,.08)"},$i={fontFamily:"'DM Sans',sans-serif"},vd=(t,i="COP")=>!t&&t!==0?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:i,minimumFractionDigits:0,maximumFractionDigits:0}).format(t),jd=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric"}):"";function ho({title:t,icon:i,children:o}){return e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("h3",{style:{...$i,fontSize:13,fontWeight:700,color:Ge.ink,margin:"0 0 12px",display:"flex",alignItems:"center",gap:8,textTransform:"uppercase",letterSpacing:.5},children:[e.jsx("span",{children:i})," ",t]}),e.jsx("div",{style:{background:Ge.surface,borderRadius:12,padding:20,border:"1px solid "+Ge.border},children:o})]})}function ks({label:t,value:i,highlight:o}){return e.jsxs("div",{style:{flex:1,minWidth:140,background:o?Ge.greenBg:"#FFFFFF",borderRadius:10,padding:"14px 16px",border:"1px solid "+(o?Ge.greenLight:Ge.border)},children:[e.jsx("p",{style:{...$i,margin:"0 0 4px",fontSize:9,fontWeight:600,textTransform:"uppercase",letterSpacing:1,color:Ge.inkLight},children:t}),e.jsx("p",{style:{...$i,margin:0,fontSize:18,fontWeight:700,color:o?Ge.green:Ge.ink},children:i})]})}function Om({token:t}){const[i,o]=F.useState(null),[n,a]=F.useState(!0),[r,s]=F.useState(null),[d,u]=F.useState(null),[b,j]=F.useState(""),[w,S]=F.useState(!1),[m,x]=F.useState(!1);if(F.useEffect(()=>{if(!t){s("no_token"),a(!1);return}Ju(t).then(f=>{f?o(f):s("not_found"),a(!1)}).catch(()=>{s("error"),a(!1)})},[t]),n)return e.jsx("div",{style:{...$i,minHeight:"100vh",background:Ge.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16,animation:"pulse 1.5s ease infinite"},children:""}),e.jsx("p",{style:{fontSize:14,color:Ge.inkMid},children:"Cargando oferta..."}),e.jsx("style",{children:"@keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}"})]})});if(r||!i)return e.jsx("div",{style:{...$i,minHeight:"100vh",background:Ge.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:Ge.surface,borderRadius:16,padding:48,textAlign:"center",boxShadow:Ge.shadow,maxWidth:420},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("h2",{style:{margin:"0 0 8px",fontSize:18,color:Ge.ink},children:"Enlace no vlido"}),e.jsx("p",{style:{margin:0,fontSize:13,color:Ge.inkMid,lineHeight:1.6},children:"Este enlace de oferta no existe o ha expirado."})]})});if(i.status!=="pendiente"||m){const f={aprobada:{icon:"",label:"Oferta Aprobada",color:Ge.green,bg:Ge.greenBg},rechazada:{icon:"",label:"Oferta Rechazada",color:Ge.red,bg:Ge.redBg},devuelta:{icon:"",label:"Oferta Devuelta",color:Ge.amber,bg:Ge.amberBg}},y=f[i.status]||f.aprobada,h=i.offer_data||{};return e.jsx("div",{style:{...$i,minHeight:"100vh",background:Ge.bg,display:"flex",alignItems:"center",justifyContent:"center",padding:20},children:e.jsxs("div",{style:{background:Ge.surface,borderRadius:16,padding:48,textAlign:"center",boxShadow:Ge.shadow,maxWidth:480},children:[e.jsx("div",{style:{fontSize:56,marginBottom:16},children:y.icon}),e.jsx("h2",{style:{margin:"0 0 8px",fontSize:22,color:y.color,fontWeight:700},children:y.label}),e.jsxs("p",{style:{margin:"0 0 6px",fontSize:14,color:Ge.inkMid},children:[h.ref||"Oferta","  ",h.cliente||""]}),e.jsxs("p",{style:{margin:"0 0 20px",fontSize:12,color:Ge.inkLight},children:["Respondida el ",jd(i.client_responded_at)]}),i.client_comments&&e.jsxs("div",{style:{background:y.bg,borderRadius:8,padding:16,textAlign:"left"},children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:y.color},children:"Sus comentarios"}),e.jsx("p",{style:{margin:0,fontSize:13,color:Ge.ink,lineHeight:1.6,whiteSpace:"pre-wrap"},children:i.client_comments})]}),e.jsx("p",{style:{margin:"24px 0 0",fontSize:11,color:Ge.inkLight},children:"Si necesita hacer cambios, contacte con su representante."})]})})}const p=i.offer_data||{},c=p.divisa||"COP",g=f=>f?e.jsx("div",{style:{fontSize:13,color:Ge.ink,lineHeight:1.7,whiteSpace:"pre-wrap"},children:f}):e.jsx("p",{style:{margin:0,fontSize:13,color:Ge.inkLight,fontStyle:"italic"},children:"No especificado"}),l=async()=>{if(d){if(d==="devolver"&&!b.trim()){alert("Por favor, indique los cambios que necesita.");return}S(!0);try{const y=await Yu(t,{aprobar:"aprobada",rechazar:"rechazada",devolver:"devuelta"}[d],b);o(y),x(!0)}catch(f){alert("Error al enviar. Intente de nuevo."),console.error(f)}S(!1)}};return e.jsxs("div",{style:{...$i,minHeight:"100vh",background:Ge.bg},children:[e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif}"}),e.jsx("div",{style:{background:"#111",color:"#fff",padding:"28px 0"},children:e.jsx("div",{style:{maxWidth:760,margin:"0 auto",padding:"0 24px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:10,letterSpacing:2,textTransform:"uppercase",color:"rgba(255,255,255,.5)",marginBottom:4},children:["Propuesta Comercial  ",i.revision||"Rev.01"]}),e.jsx("h1",{style:{fontSize:24,fontWeight:700,margin:0},children:p.ref||"Oferta"})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("p",{style:{fontSize:12,color:"rgba(255,255,255,.7)",margin:0},children:p.firmante||"Habitaris"}),e.jsx("p",{style:{fontSize:11,color:"rgba(255,255,255,.4)",margin:0},children:jd(p.fecha)})]})]})})}),e.jsxs("div",{style:{maxWidth:760,margin:"0 auto",padding:"32px 24px 120px"},children:[e.jsxs("div",{style:{background:Ge.blueBg,border:"1px solid "+Ge.blue+"33",borderRadius:12,padding:"16px 20px",marginBottom:28,display:"flex",alignItems:"center",gap:12},children:[e.jsx("span",{style:{fontSize:24},children:""}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,fontWeight:600,color:Ge.blue,margin:"0 0 2px"},children:"Pendiente de su respuesta"}),e.jsx("p",{style:{fontSize:11,color:Ge.inkMid,margin:0},children:"Revise los detalles y apruebe, rechace o solicite cambios al final."})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:28,flexWrap:"wrap"},children:[e.jsx(ks,{label:"Proyecto",value:p.proyecto||p.titulo||""}),e.jsx(ks,{label:"PVP sin IVA ("+c+")",value:vd(p.pvp,c)}),e.jsx(ks,{label:"PVP con IVA ("+c+")",value:vd(p.pvpIva,c),highlight:!0})]}),e.jsx(ho,{title:"Datos del proyecto",icon:"",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,fontSize:13},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:Ge.inkLight,fontSize:11},children:"Cliente"}),e.jsx("br",{}),e.jsx("strong",{children:p.cliente||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Ge.inkLight,fontSize:11},children:"Proyecto"}),e.jsx("br",{}),e.jsx("strong",{children:p.proyecto||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Ge.inkLight,fontSize:11},children:"Ubicacin"}),e.jsx("br",{}),e.jsx("strong",{children:p.ubicacion||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Ge.inkLight,fontSize:11},children:"Revisin"}),e.jsx("br",{}),e.jsx("strong",{children:i.revision})]})]})}),p.alcance&&e.jsx(ho,{title:"Alcance del servicio",icon:"",children:g(p.alcance)}),p.fases&&e.jsx(ho,{title:"Fases del proyecto",icon:"",children:g(p.fases)}),p.exclusiones&&e.jsx(ho,{title:"Exclusiones",icon:"",children:g(p.exclusiones)}),p.condPago&&e.jsx(ho,{title:"Condiciones de pago",icon:"",children:g(p.condPago)}),p.plazo&&e.jsx(ho,{title:"Plazo de ejecucin",icon:"",children:g(p.plazo)}),p.garantias&&e.jsx(ho,{title:"Garantas",icon:"",children:g(p.garantias)}),p.terminos&&e.jsx(ho,{title:"Trminos y condiciones",icon:"",children:g(p.terminos)}),p.notaLegal&&e.jsxs("div",{style:{background:"#FFFFFF",borderRadius:10,padding:16,marginBottom:28,border:"1px solid "+Ge.border},children:[e.jsx("p",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:1,color:Ge.inkLight,margin:"0 0 6px"},children:"Nota legal"}),e.jsx("p",{style:{fontSize:11,color:Ge.inkMid,lineHeight:1.6,margin:0},children:p.notaLegal})]}),e.jsxs("div",{style:{background:Ge.surface,borderRadius:16,padding:28,boxShadow:Ge.shadow,border:"2px solid "+Ge.border},children:[e.jsx("h3",{style:{fontSize:16,fontWeight:700,color:Ge.ink,margin:"0 0 6px"},children:"Su decisin"}),e.jsx("p",{style:{fontSize:12,color:Ge.inkMid,margin:"0 0 20px",lineHeight:1.5},children:"Seleccione una opcin y aada comentarios si lo desea."}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"},children:[{id:"aprobar",icon:"",label:"Aprobar oferta",color:Ge.green,bg:Ge.greenBg,desc:"Acepto las condiciones"},{id:"devolver",icon:"",label:"Solicitar cambios",color:Ge.amber,bg:Ge.amberBg,desc:"Necesito modificaciones"},{id:"rechazar",icon:"",label:"Rechazar oferta",color:Ge.red,bg:Ge.redBg,desc:"No me interesa"}].map(f=>e.jsxs("button",{onClick:()=>u(f.id),style:{...$i,flex:1,minWidth:160,padding:"16px 14px",borderRadius:12,cursor:"pointer",textAlign:"left",background:d===f.id?f.bg:Ge.surface,border:"2px solid "+(d===f.id?f.color:Ge.border),transition:"all .15s"},children:[e.jsx("div",{style:{fontSize:22,marginBottom:6},children:f.icon}),e.jsx("div",{style:{fontSize:12,fontWeight:700,color:d===f.id?f.color:Ge.ink,marginBottom:2},children:f.label}),e.jsx("div",{style:{fontSize:10,color:Ge.inkLight,lineHeight:1.4},children:f.desc})]},f.id))}),d&&e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:Ge.ink,marginBottom:6},children:d==="devolver"?"Describa los cambios que necesita *":"Comentarios (opcional)"}),e.jsx("textarea",{value:b,onChange:f=>j(f.target.value),placeholder:d==="devolver"?"Indique qu ajustes necesita...":"Puede aadir notas...",rows:4,style:{...$i,width:"100%",padding:12,borderRadius:8,border:"1px solid "+Ge.border,fontSize:13,resize:"vertical",background:"#FFFFFF"}})]}),d&&e.jsx("button",{onClick:l,disabled:w,style:{...$i,width:"100%",padding:"14px 24px",borderRadius:10,fontSize:14,fontWeight:700,border:"none",cursor:w?"wait":"pointer",color:"#fff",background:d==="aprobar"?Ge.green:d==="rechazar"?Ge.red:Ge.amber,opacity:w?.6:1},children:w?"Enviando...":d==="aprobar"?" Confirmar aprobacin":d==="rechazar"?" Confirmar rechazo":" Enviar solicitud de cambios"})]}),e.jsx("div",{style:{textAlign:"center",marginTop:40,padding:"20px 0",borderTop:"1px solid "+Ge.border},children:e.jsxs("p",{style:{fontSize:11,color:Ge.inkLight,margin:0},children:["Propuesta enviada por ",e.jsx("strong",{style:{color:Ge.ink},children:p.firmante||"Habitaris"})]})})]})]})}const xe={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},De={fontFamily:"'DM Sans',sans-serif"},Cc="hab:portal:",kc=t=>{try{return JSON.parse(localStorage.getItem(Cc+t))||null}catch{return null}},Lm=(t,i)=>localStorage.setItem(Cc+t,JSON.stringify(i)),oi=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function Wm(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}function ir({children:t,color:i,bg:o,style:n}){return e.jsx("span",{style:{...De,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o,...n},children:t})}function wc(){var t,i,o,n,a,r,s,d;try{const u=JSON.parse(localStorage.getItem("hab:config"))||{};return{nombre:((t=u.empresa)==null?void 0:t.nombre)||"Habitaris",logo:((i=u.apariencia)==null?void 0:i.logo)||null,colorPrimario:((o=u.apariencia)==null?void 0:o.colorPrimario)||"#111111",colorAcento:((n=u.apariencia)==null?void 0:n.colorAcento)||"#111111",tipografia:((a=u.apariencia)==null?void 0:a.tipografia)||"DM Sans",telefono:((r=u.empresa)==null?void 0:r.telefono)||"+57 350 566 1545",email:((s=u.empresa)==null?void 0:s.email)||"info@habitaris.co",web:((d=u.empresa)==null?void 0:d.web)||"www.habitaris.co"}}catch{return{nombre:"Habitaris",colorPrimario:"#111",colorAcento:"#111111",tipografia:"DM Sans"}}}const zc=[{id:"resumen",label:"Resumen del proyecto",icon:"",desc:"Estado general, progreso, datos clave"},{id:"documentos",label:"Documentos",icon:"",desc:"Contratos, planos, presupuestos, actas"},{id:"firmas",label:"Firmas pendientes",icon:"",desc:"Documentos que requieren firma del cliente"},{id:"avance",label:"Avance de obra",icon:"",desc:"Progreso por fase, fotos, bitcora"},{id:"pagos",label:"Pagos y facturas",icon:"",desc:"Estado de cuenta, facturas, recibos"},{id:"cronograma",label:"Cronograma",icon:"",desc:"Fases del proyecto con fechas"},{id:"comunicaciones",label:"Comunicaciones",icon:"",desc:"Mensajes y notificaciones del equipo"},{id:"garantias",label:"Garantas",icon:"",desc:"Plizas, garantas post-entrega"}],or=[{id:"briefing",label:"Briefing",color:"#888",bg:"#F5F5F5",pct:5},{id:"diseno",label:"Diseo",color:"#5B3A8C",bg:"#F3EEF9",pct:20},{id:"aprobacion",label:"Aprobacin",color:"#8C6A00",bg:"#FFF8EE",pct:30},{id:"licencias",label:"Licencias",color:"#3B3B3B",bg:"#F0F0F0",pct:35},{id:"obra",label:"En obra",color:"#D4840A",bg:"#FFF3E0",pct:60},{id:"acabados",label:"Acabados",color:"#0D7377",bg:"#E6F5F5",pct:85},{id:"entrega",label:"Entrega",color:"#111111",bg:"#EBEBEB",pct:95},{id:"postventa",label:"Postventa",color:"#111111",bg:"#EBEBEB",pct:100}],Ec=[{id:"portal_1",clienteId:"c1",clienteNombre:"Mara Fernanda Gmez",clienteEmail:"mfgomez@email.com",proyecto:"Diseo Interior  Apto 502 Rosales",estado:"diseno",progreso:25,ofertaRef:"OFR-2026-001",valorContrato:"$45.000.000 COP",equipoAsignado:[{nombre:"Ana Garca",cargo:"Diseadora lder"},{nombre:"Carlos Lpez",cargo:"Arquitecto"}],fechaInicio:"2026-02-15",fechaEstimadaFin:"2026-06-15",seccionesActivas:["resumen","documentos","firmas","pagos","cronograma","comunicaciones"],accessToken:"mfg502ros",documentos:[{id:"doc1",nombre:"Contrato de Diseo Interior",tipo:"contrato",fecha:"2026-02-15",estado:"firmado",descargable:!0},{id:"doc2",nombre:"Brief de Diseo Aprobado",tipo:"brief",fecha:"2026-02-18",estado:"aprobado",descargable:!0},{id:"doc3",nombre:"Propuesta de Concepto v1",tipo:"diseo",fecha:"2026-02-25",estado:"en_revision",descargable:!0},{id:"doc4",nombre:"Presupuesto Estimado de Obra",tipo:"presupuesto",fecha:"2026-02-20",estado:"pendiente",descargable:!1}],firmasPendientes:[{id:"fp1",documento:"Aprobacin de Concepto de Diseo",fechaLimite:"2026-03-10",estado:"pendiente"}],pagos:[{id:"pago1",concepto:"Anticipo  Diseo (50%)",valor:"$22.500.000",fecha:"2026-02-15",estado:"pagado"},{id:"pago2",concepto:"Segundo pago  Diseo (30%)",valor:"$13.500.000",fecha:"2026-04-01",estado:"pendiente"},{id:"pago3",concepto:"Pago final  Diseo (20%)",valor:"$9.000.000",fecha:"2026-06-15",estado:"pendiente"}],cronograma:[{fase:"Briefing y levantamiento",inicio:"2026-02-15",fin:"2026-02-22",completado:100},{fase:"Concepto de diseo",inicio:"2026-02-23",fin:"2026-03-10",completado:60},{fase:"Anteproyecto",inicio:"2026-03-11",fin:"2026-04-05",completado:0},{fase:"Proyecto ejecutivo",inicio:"2026-04-06",fin:"2026-05-15",completado:0},{fase:"Detalles tcnicos y planos de obra",inicio:"2026-05-16",fin:"2026-06-10",completado:0},{fase:"Entrega final",inicio:"2026-06-11",fin:"2026-06-15",completado:0}],comunicaciones:[{id:"com1",fecha:"2026-02-25",de:"Ana Garca",mensaje:"Hola Mara Fernanda, ya tenemos lista la primera propuesta de concepto. La subimos al portal para tu revisin. Esperamos tus comentarios!"},{id:"com2",fecha:"2026-02-20",de:"Sistema",mensaje:"Se ha generado tu portal de cliente. Aqu podrs seguir el avance de tu proyecto."},{id:"com3",fecha:"2026-02-15",de:"Laura Snchez",mensaje:"Bienvenida! Estamos encantados de iniciar este proyecto contigo. Tu diseadora lder ser Ana Garca."}],garantias:[]},{id:"portal_2",clienteId:"c2",clienteNombre:"Andrs Meja Ruiz",clienteEmail:"amejia@email.com",proyecto:"Remodelacin Integral  Casa Chic Norte",estado:"obra",progreso:55,ofertaRef:"OFR-2025-089",valorContrato:"$120.000.000 COP",equipoAsignado:[{nombre:"Carlos Lpez",cargo:"Director de proyecto"},{nombre:"Mara Rodrguez",cargo:"Directora de obra"},{nombre:"Pedro Martnez",cargo:"Instalador tcnico"}],fechaInicio:"2025-10-01",fechaEstimadaFin:"2026-04-30",seccionesActivas:["resumen","documentos","firmas","avance","pagos","cronograma","comunicaciones","garantias"],accessToken:"amr_chico",documentos:[{id:"doc5",nombre:"Contrato de Obra",tipo:"contrato",fecha:"2025-10-01",estado:"firmado",descargable:!0},{id:"doc6",nombre:"Acta de Inicio",tipo:"acta",fecha:"2025-10-05",estado:"firmado",descargable:!0},{id:"doc7",nombre:"Acta de Vecindad",tipo:"acta",fecha:"2025-10-05",estado:"firmado",descargable:!0},{id:"doc8",nombre:"Planos Aprobados",tipo:"planos",fecha:"2025-09-20",estado:"aprobado",descargable:!0},{id:"doc9",nombre:"Acta Comit #8",tipo:"acta",fecha:"2026-02-20",estado:"aprobado",descargable:!0},{id:"doc10",nombre:"Otros  Cambio de acabados bao",tipo:"otrosi",fecha:"2026-02-10",estado:"firmado",descargable:!0}],firmasPendientes:[{id:"fp2",documento:"Acta de Comit #9  Febrero",fechaLimite:"2026-03-01",estado:"pendiente"},{id:"fp3",documento:"Aprobacin cambio cocina integral",fechaLimite:"2026-03-05",estado:"pendiente"}],pagos:[{id:"pago4",concepto:"Anticipo (30%)",valor:"$36.000.000",fecha:"2025-10-01",estado:"pagado"},{id:"pago5",concepto:"Avance 1  Demolicin y estructura (20%)",valor:"$24.000.000",fecha:"2025-11-15",estado:"pagado"},{id:"pago6",concepto:"Avance 2  Instalaciones (20%)",valor:"$24.000.000",fecha:"2026-01-15",estado:"pagado"},{id:"pago7",concepto:"Avance 3  Acabados (20%)",valor:"$24.000.000",fecha:"2026-03-15",estado:"pendiente"},{id:"pago8",concepto:"Pago final (10%)",valor:"$12.000.000",fecha:"2026-04-30",estado:"pendiente"}],cronograma:[{fase:"Demolicin y preparacin",inicio:"2025-10-05",fin:"2025-10-30",completado:100},{fase:"Estructura y mampostera",inicio:"2025-11-01",fin:"2025-12-15",completado:100},{fase:"Instalaciones (elctrica, hidrulica)",inicio:"2025-12-16",fin:"2026-01-31",completado:100},{fase:"Paetes y pisos",inicio:"2026-02-01",fin:"2026-02-28",completado:70},{fase:"Carpintera y acabados",inicio:"2026-03-01",fin:"2026-04-10",completado:0},{fase:"Limpieza y entrega",inicio:"2026-04-11",fin:"2026-04-30",completado:0}],avanceObra:[{fecha:"2026-02-24",nota:"Avance de pisos en sala y comedor al 80%. Pendiente habitaciones.",fotos:3},{fecha:"2026-02-17",nota:"Inicio de instalacin de piso en sala principal. Material lleg completo.",fotos:5},{fecha:"2026-02-10",nota:"Paetes terminados en toda la casa. Se inicia alistamiento de pisos.",fotos:4},{fecha:"2026-01-30",nota:"Pruebas de presin hidrulica OK. Instalacin elctrica completada.",fotos:6}],comunicaciones:[{id:"com4",fecha:"2026-02-24",de:"Mara Rodrguez",mensaje:"Andrs, el avance de pisos va al 80% en sala. Esta semana arrancamos habitaciones. Te sub las fotos al portal."},{id:"com5",fecha:"2026-02-10",de:"Carlos Lpez",mensaje:"Otros del cambio de acabados del bao ya est firmado por ambas partes. Queda en el portal."},{id:"com6",fecha:"2026-02-01",de:"Sistema",mensaje:"Nuevo documento pendiente de firma: Acta de Comit #9"}],garantias:[{tipo:"Todo Riesgo Construccin",aseguradora:"Seguros Bolvar",vigencia:"2026-07-15",poliza:"POL-2026-001245"},{tipo:"RC Extracontractual",aseguradora:"Sura",vigencia:"2026-12-31",poliza:"RC-2026-778899"}]},{id:"portal_3",clienteId:"c3",clienteNombre:"TechStar S.A.S",clienteEmail:"admin@techstar.co",proyecto:"Adecuacin Oficina 301  WTC Bogot",estado:"postventa",progreso:100,ofertaRef:"OFR-2025-045",valorContrato:"$85.000.000 COP",equipoAsignado:[{nombre:"Ana Garca",cargo:"Diseadora"},{nombre:"Mara Rodrguez",cargo:"Directora de obra"}],fechaInicio:"2025-06-01",fechaEstimadaFin:"2025-12-15",seccionesActivas:["resumen","documentos","pagos","garantias"],accessToken:"ts_301wtc",documentos:[{id:"doc11",nombre:"Contrato de Obra",tipo:"contrato",fecha:"2025-06-01",estado:"firmado",descargable:!0},{id:"doc12",nombre:"Acta de Entrega Final",tipo:"acta",fecha:"2025-12-10",estado:"firmado",descargable:!0},{id:"doc13",nombre:"Acta de Conformidad",tipo:"acta",fecha:"2025-12-10",estado:"firmado",descargable:!0},{id:"doc14",nombre:"Planos As-Built",tipo:"planos",fecha:"2025-12-12",estado:"entregado",descargable:!0}],firmasPendientes:[],pagos:[{id:"pago9",concepto:"Anticipo (30%)",valor:"$25.500.000",fecha:"2025-06-01",estado:"pagado"},{id:"pago10",concepto:"Avance 1 (30%)",valor:"$25.500.000",fecha:"2025-08-15",estado:"pagado"},{id:"pago11",concepto:"Avance 2 (30%)",valor:"$25.500.000",fecha:"2025-11-01",estado:"pagado"},{id:"pago12",concepto:"Retencin final (10%)",valor:"$8.500.000",fecha:"2025-12-15",estado:"pagado"}],cronograma:[],comunicaciones:[],garantias:[{tipo:"Estabilidad de obra",aseguradora:"Seguros Bolvar",vigencia:"2030-12-10",poliza:"CAL-2025-112233"},{tipo:"Cumplimiento",aseguradora:"Liberty Seguros",vigencia:"2026-06-01",poliza:"CUM-2025-556677"}]}];function Nm(){try{const t=new URLSearchParams(window.location.search);return t.get("token")||t.get("t")||null}catch{return null}}function Ac({portal:t,brand:i}){const[o,n]=F.useState("resumen"),a=i.tipografia||"DM Sans",r=i.colorPrimario,s=i.colorAcento,d=or.find(l=>l.id===t.estado),u=zc.filter(l=>t.seccionesActivas.includes(l.id)),g={resumen:()=>{var l,f,y;return e.jsxs("div",{children:[e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:24,marginBottom:16,border:`1px solid ${xe.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:10,color:xe.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Estado actual"}),e.jsx("div",{style:{...De,fontSize:18,fontWeight:700,color:d==null?void 0:d.color},children:d==null?void 0:d.label})]}),e.jsxs("div",{style:{...De,fontSize:32,fontWeight:800,color:s},children:[t.progreso,"%"]})]}),e.jsx("div",{style:{height:10,background:xe.bg,borderRadius:5,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${t.progreso}%`,background:s,borderRadius:5,transition:"width .5s"}})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12},children:or.slice(0,7).map(h=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",margin:"0 auto 4px",background:t.progreso>=h.pct?s:xe.border}}),e.jsx("div",{style:{...De,fontSize:8,color:t.progreso>=h.pct?xe.ink:xe.inkLight},children:h.label})]},h.id))})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px,1fr))",gap:12,marginBottom:16},children:[{label:"Valor contrato",val:t.valorContrato,icon:""},{label:"Inicio",val:oi(t.fechaInicio),icon:""},{label:"Entrega estimada",val:oi(t.fechaEstimadaFin),icon:""},{label:"Oferta ref.",val:t.ofertaRef,icon:""}].map((h,v)=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${xe.border}`,borderRadius:10,padding:16},children:[e.jsxs("div",{style:{...De,fontSize:10,color:xe.inkLight},children:[h.icon," ",h.label]}),e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.ink,marginTop:2},children:h.val})]},v))}),e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:20,border:`1px solid ${xe.border}`,marginBottom:16},children:[e.jsx("div",{style:{...De,fontSize:13,fontWeight:700,color:xe.ink,marginBottom:12},children:" Tu equipo"}),e.jsx("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:t.equipoAsignado.map((h,v)=>e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"8px 14px",background:xe.surface,borderRadius:8},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:s+"22",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:s},children:h.nombre[0]}),e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:12,fontWeight:600,color:xe.ink},children:h.nombre}),e.jsx("div",{style:{...De,fontSize:10,color:xe.inkLight},children:h.cargo})]})]},v))})]}),t.firmasPendientes.length>0&&e.jsxs("div",{style:{background:xe.warningBg,border:`1px solid ${xe.warning}33`,borderRadius:10,padding:16,marginBottom:12},children:[e.jsxs("div",{style:{...De,fontSize:12,fontWeight:700,color:xe.warning},children:[" Tienes ",t.firmasPendientes.length," documento(s) pendiente(s) de firma"]}),e.jsx("div",{style:{...De,fontSize:11,color:xe.warning,marginTop:4},children:'Ve a la seccin "Firmas pendientes" para revisarlos y firmar.'})]}),t.pagos.filter(h=>h.estado==="pendiente").length>0&&e.jsxs("div",{style:{background:xe.infoBg,border:`1px solid ${xe.info}33`,borderRadius:10,padding:16},children:[e.jsxs("div",{style:{...De,fontSize:12,fontWeight:700,color:xe.info},children:[" Prximo pago: ",(l=t.pagos.find(h=>h.estado==="pendiente"))==null?void 0:l.concepto]}),e.jsxs("div",{style:{...De,fontSize:11,color:xe.info,marginTop:4},children:[(f=t.pagos.find(h=>h.estado==="pendiente"))==null?void 0:f.valor,"  ",oi((y=t.pagos.find(h=>h.estado==="pendiente"))==null?void 0:y.fecha)]})]})]})},documentos:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Documentos del proyecto"}),t.documentos.map(l=>{const y={firmado:{c:xe.accent,bg:xe.accentBg},aprobado:{c:xe.accent,bg:xe.accentBg},en_revision:{c:xe.warning,bg:xe.warningBg},pendiente:{c:xe.info,bg:xe.infoBg},entregado:{c:xe.accent,bg:xe.accentBg}}[l.estado]||{c:xe.inkLight,bg:xe.bg};return e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"14px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{fontSize:24},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...De,fontSize:13,fontWeight:600,color:xe.ink},children:l.nombre}),e.jsxs("div",{style:{...De,fontSize:10,color:xe.inkLight},children:[l.tipo,"  ",oi(l.fecha)]})]}),e.jsx(ir,{color:y.c,bg:y.bg,children:l.estado}),l.descargable&&e.jsx("button",{style:{...De,padding:"6px 12px",fontSize:10,fontWeight:600,color:s,background:s+"15",border:`1px solid ${s}33`,borderRadius:5,cursor:"pointer"},children:" Descargar"})]},l.id)})]}),firmas:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Documentos pendientes de firma"}),t.firmasPendientes.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...De,fontSize:13,color:xe.accent},children:"No tienes documentos pendientes de firma"})]}):t.firmasPendientes.map(l=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"16px 18px",background:"#fff",border:`1px solid ${xe.warning}44`,borderRadius:10,marginBottom:10},children:[e.jsx("div",{style:{fontSize:28},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...De,fontSize:13,fontWeight:700,color:xe.ink},children:l.documento}),e.jsxs("div",{style:{...De,fontSize:11,color:xe.inkLight},children:["Fecha lmite: ",oi(l.fechaLimite)]})]}),e.jsx("button",{style:{...De,padding:"8px 20px",fontSize:12,fontWeight:700,color:"#fff",background:s,border:"none",borderRadius:6,cursor:"pointer"},children:" Firmar ahora"})]},l.id))]}),avance:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Avance de obra"}),(t.avanceObra||[]).length===0?e.jsx("p",{style:{...De,fontSize:12,color:xe.inkLight},children:"An no hay registros de avance."}):e.jsx("div",{style:{borderLeft:`2px solid ${xe.border}`,paddingLeft:20,marginLeft:10},children:t.avanceObra.map((l,f)=>e.jsxs("div",{style:{marginBottom:20,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-27,top:2,width:12,height:12,borderRadius:"50%",background:f===0?s:xe.bg,border:`2px solid ${f===0?s:xe.border}`}}),e.jsx("div",{style:{...De,fontSize:10,fontWeight:600,color:s},children:oi(l.fecha)}),e.jsx("div",{style:{...De,fontSize:13,color:xe.ink,marginTop:4,lineHeight:1.6},children:l.nota}),l.fotos>0&&e.jsxs("div",{style:{...De,fontSize:10,color:xe.inkLight,marginTop:4},children:[" ",l.fotos," foto(s) adjuntas"]})]},f))})]}),pagos:()=>{const l=t.pagos.filter(v=>v.estado==="pagado"),f=t.pagos.filter(v=>v.estado==="pendiente"),y=l.length,h=t.pagos.length;return e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:12},children:" Estado de pagos"}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16},children:[e.jsxs("div",{style:{flex:1,padding:16,background:xe.accentBg,borderRadius:10,border:`1px solid ${xe.accent}33`},children:[e.jsx("div",{style:{...De,fontSize:10,color:xe.accent},children:"Pagado"}),e.jsxs("div",{style:{...De,fontSize:20,fontWeight:700,color:xe.accent},children:[y,"/",h]})]}),f.length>0&&e.jsxs("div",{style:{flex:1,padding:16,background:xe.warningBg,borderRadius:10,border:`1px solid ${xe.warning}33`},children:[e.jsx("div",{style:{...De,fontSize:10,color:xe.warning},children:"Prximo pago"}),e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.warning},children:f[0].valor}),e.jsx("div",{style:{...De,fontSize:10,color:xe.warning},children:oi(f[0].fecha)})]})]}),t.pagos.map(v=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:8,marginBottom:6},children:[e.jsx("div",{style:{fontSize:18},children:v.estado==="pagado"?"":""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...De,fontSize:12,fontWeight:600,color:xe.ink},children:v.concepto}),e.jsx("div",{style:{...De,fontSize:10,color:xe.inkLight},children:oi(v.fecha)})]}),e.jsx("div",{style:{...De,fontSize:13,fontWeight:700,color:v.estado==="pagado"?xe.accent:xe.ink},children:v.valor}),e.jsx(ir,{color:v.estado==="pagado"?xe.accent:xe.warning,bg:v.estado==="pagado"?xe.accentBg:xe.warningBg,children:v.estado==="pagado"?"Pagado":"Pendiente"})]},v.id))]})},cronograma:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Cronograma del proyecto"}),t.cronograma.map((l,f)=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:8,marginBottom:6},children:[e.jsx("div",{style:{width:40,textAlign:"center"},children:e.jsx("div",{style:{...De,fontSize:18,fontWeight:800,color:l.completado===100?xe.accent:l.completado>0?xe.warning:xe.inkLight},children:l.completado===100?"":`${l.completado}%`})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...De,fontSize:12,fontWeight:600,color:xe.ink},children:l.fase}),e.jsxs("div",{style:{...De,fontSize:10,color:xe.inkLight},children:[oi(l.inicio),"  ",oi(l.fin)]}),e.jsx("div",{style:{height:4,background:xe.bg,borderRadius:2,marginTop:4,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${l.completado}%`,borderRadius:2,background:l.completado===100?xe.accent:s}})})]})]},f))]}),comunicaciones:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Comunicaciones"}),t.comunicaciones.map(l=>e.jsxs("div",{style:{display:"flex",gap:12,padding:"14px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:s+"22",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:s,flexShrink:0},children:l.de[0]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{...De,fontSize:12,fontWeight:600,color:xe.ink},children:l.de}),e.jsx("span",{style:{...De,fontSize:10,color:xe.inkLight},children:oi(l.fecha)})]}),e.jsx("div",{style:{...De,fontSize:12,color:xe.inkMid,lineHeight:1.6},children:l.mensaje})]})]},l.id))]}),garantias:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...De,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Garantas y plizas"}),(t.garantias||[]).length===0?e.jsx("p",{style:{...De,fontSize:12,color:xe.inkLight},children:"Las garantas se activarn al finalizar el proyecto."}):t.garantias.map((l,f)=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"14px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{fontSize:24},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...De,fontSize:13,fontWeight:600,color:xe.ink},children:l.tipo}),e.jsxs("div",{style:{...De,fontSize:10,color:xe.inkLight},children:[l.aseguradora,"  Pliza: ",l.poliza]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{...De,fontSize:11,color:xe.inkMid},children:"Vigente hasta"}),e.jsx("div",{style:{...De,fontSize:12,fontWeight:600,color:Wm(l.vigencia)<60?xe.warning:xe.accent},children:oi(l.vigencia)})]})]},f))]})};return e.jsxs("div",{style:{minHeight:"100vh",background:xe.bg,fontFamily:`'${a}',sans-serif`},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${a.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:r,padding:"0 24px",height:56,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:26,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:15,fontWeight:700,color:"#fff",letterSpacing:1.5},children:i.nombre.toUpperCase()}),e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.4)",letterSpacing:1},children:"PORTAL CLIENTE"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"rgba(255,255,255,.12)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:"rgba(255,255,255,.6)"},children:t.clienteNombre[0]}),e.jsx("span",{style:{fontSize:11,color:"rgba(255,255,255,.6)"},children:t.clienteNombre})]})]}),i.colorAcento&&e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${s},${s}88)`}}),e.jsxs("div",{style:{padding:"24px 24px 0",maxWidth:960,margin:"0 auto"},children:[e.jsx("div",{style:{...De,fontSize:10,color:xe.inkLight,textTransform:"uppercase",letterSpacing:1.5,marginBottom:4},children:"Proyecto"}),e.jsx("h1",{style:{...De,fontSize:22,fontWeight:700,color:xe.ink,margin:"0 0 20px"},children:t.proyecto})]}),e.jsxs("div",{style:{display:"flex",maxWidth:960,margin:"0 auto",padding:"0 24px 40px",gap:20},children:[e.jsx("div",{style:{width:200,flexShrink:0},children:u.map(l=>e.jsxs("button",{onClick:()=>n(l.id),style:{...De,display:"flex",gap:8,alignItems:"center",width:"100%",padding:"10px 14px",fontSize:12,fontWeight:o===l.id?700:500,textAlign:"left",color:o===l.id?s:xe.inkMid,background:o===l.id?s+"12":"transparent",border:"none",borderRadius:8,cursor:"pointer",marginBottom:2,transition:"all .15s"},children:[e.jsx("span",{children:l.icon})," ",l.label,l.id==="firmas"&&t.firmasPendientes.length>0&&e.jsx("span",{style:{marginLeft:"auto",background:xe.warning,color:"#fff",padding:"1px 6px",borderRadius:8,fontSize:9},children:t.firmasPendientes.length})]},l.id))}),e.jsx("div",{style:{flex:1,minWidth:0},children:g[o]?g[o]():e.jsx("p",{children:"Seccin no disponible"})})]}),e.jsx("div",{style:{textAlign:"center",padding:"20px 24px 30px",borderTop:`1px solid ${xe.border}`},children:e.jsxs("p",{style:{...De,fontSize:10,color:xe.inkLight},children:[i.nombre,"  ",i.telefono,"  ",i.email]})})]})}function Um(){const t=F.useMemo(()=>wc(),[]),[i,o]=F.useState(()=>kc("portales")||Ec),[n,a]=F.useState(null);F.useState(null);const[r,s]=F.useState(null),[d,u]=F.useState("");F.useEffect(()=>Lm("portales",i),[i]);const b=F.useMemo(()=>{if(!d)return i;const S=d.toLowerCase();return i.filter(m=>m.clienteNombre.toLowerCase().includes(S)||m.proyecto.toLowerCase().includes(S))},[i,d]),j=()=>{const S=n?i.find(c=>c.id===n):null;if(!S)return null;const m=or.find(c=>c.id===S.estado),x=c=>{o(g=>g.map(l=>{if(l.id!==S.id)return l;const f=l.seccionesActivas.includes(c)?l.seccionesActivas.filter(y=>y!==c):[...l.seccionesActivas,c];return{...l,seccionesActivas:f}}))},p=(c,g)=>{o(l=>l.map(f=>f.id===S.id?{...f,[c]:g}:f))};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>a(null),children:e.jsxs("div",{onClick:c=>c.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx(ir,{color:m==null?void 0:m.color,bg:m==null?void 0:m.bg,children:m==null?void 0:m.label}),e.jsx("h2",{style:{...De,fontSize:18,fontWeight:700,color:xe.ink,margin:"8px 0 2px"},children:S.proyecto}),e.jsxs("div",{style:{...De,fontSize:12,color:xe.inkLight},children:["Cliente: ",S.clienteNombre,"  ",S.clienteEmail]})]}),e.jsx("button",{onClick:()=>a(null),style:{...De,fontSize:18,color:xe.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{background:xe.infoBg,border:`1px solid ${xe.info}22`,borderRadius:8,padding:14,marginBottom:16},children:[e.jsx("div",{style:{...De,fontSize:10,fontWeight:600,color:xe.info,marginBottom:4},children:" Enlace del cliente"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("code",{style:{...De,flex:1,fontSize:11,background:"#fff",padding:"6px 10px",borderRadius:4,border:`1px solid ${xe.border}`,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:`${window.location.origin}/portal?token=${S.accessToken}`}),e.jsx("button",{onClick:()=>{var c;(c=navigator.clipboard)==null||c.writeText(`${window.location.origin}/portal?token=${S.accessToken}`),alert(" Enlace copiado")},style:{...De,padding:"6px 12px",fontSize:10,fontWeight:600,color:xe.info,background:"#fff",border:`1px solid ${xe.info}33`,borderRadius:5,cursor:"pointer"},children:" Copiar"}),e.jsx("button",{style:{...De,padding:"6px 12px",fontSize:10,fontWeight:600,color:"#fff",background:"#25D366",border:"none",borderRadius:5,cursor:"pointer"},children:" WhatsApp"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...De,fontSize:10,fontWeight:600,color:xe.inkLight},children:"Estado del proyecto"}),e.jsx("select",{value:S.estado,onChange:c=>p("estado",c.target.value),style:{...De,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${xe.border}`,borderRadius:5},children:or.map(c=>e.jsx("option",{value:c.id,children:c.label},c.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...De,fontSize:10,fontWeight:600,color:xe.inkLight},children:"Progreso (%)"}),e.jsx("input",{type:"number",min:0,max:100,value:S.progreso,onChange:c=>p("progreso",parseInt(c.target.value)||0),style:{...De,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${xe.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...De,fontSize:12,fontWeight:700,color:xe.ink,marginBottom:8},children:" Secciones visibles para el cliente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:zc.map(c=>e.jsxs("label",{style:{...De,display:"flex",gap:8,alignItems:"center",padding:"8px 12px",background:S.seccionesActivas.includes(c.id)?xe.accentBg:xe.surface,border:`1px solid ${S.seccionesActivas.includes(c.id)?xe.accent+"33":xe.border}`,borderRadius:6,cursor:"pointer",fontSize:12},children:[e.jsx("input",{type:"checkbox",checked:S.seccionesActivas.includes(c.id),onChange:()=>x(c.id),style:{accentColor:xe.accent}}),e.jsx("span",{children:c.icon}),e.jsx("span",{style:{fontWeight:S.seccionesActivas.includes(c.id)?600:400},children:c.label})]},c.id))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:16},children:[e.jsxs("div",{style:{padding:10,background:xe.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...De,fontSize:16,fontWeight:700,color:xe.ink},children:S.documentos.length}),e.jsx("div",{style:{...De,fontSize:9,color:xe.inkLight},children:"Documentos"})]}),e.jsxs("div",{style:{padding:10,background:xe.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...De,fontSize:16,fontWeight:700,color:xe.warning},children:S.firmasPendientes.length}),e.jsx("div",{style:{...De,fontSize:9,color:xe.inkLight},children:"Firmas pend."})]}),e.jsxs("div",{style:{padding:10,background:xe.surface,borderRadius:6,textAlign:"center"},children:[e.jsxs("div",{style:{...De,fontSize:16,fontWeight:700,color:xe.accent},children:[S.pagos.filter(c=>c.estado==="pagado").length,"/",S.pagos.length]}),e.jsx("div",{style:{...De,fontSize:9,color:xe.inkLight},children:"Pagos"})]}),e.jsxs("div",{style:{padding:10,background:xe.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...De,fontSize:16,fontWeight:700,color:xe.ink},children:S.comunicaciones.length}),e.jsx("div",{style:{...De,fontSize:9,color:xe.inkLight},children:"Mensajes"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>{s(S),a(null)},style:{...De,padding:"8px 18px",fontSize:11,fontWeight:600,color:xe.info,background:xe.infoBg,border:`1px solid ${xe.info}33`,borderRadius:6,cursor:"pointer"},children:" Vista previa cliente"}),e.jsx("button",{style:{...De,padding:"8px 18px",fontSize:11,fontWeight:600,color:xe.accent,background:xe.accentBg,border:`1px solid ${xe.accent}33`,borderRadius:6,cursor:"pointer"},children:" Aadir documento"}),e.jsx("button",{style:{...De,padding:"8px 18px",fontSize:11,fontWeight:600,color:xe.warning,background:xe.warningBg,border:`1px solid ${xe.warning}33`,borderRadius:6,cursor:"pointer"},children:" Enviar mensaje"})]})]})})},w=()=>r?e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1001,background:"rgba(0,0,0,.6)"},onClick:()=>s(null),children:[e.jsx("div",{style:{position:"absolute",top:10,right:20,zIndex:2},children:e.jsx("button",{onClick:()=>s(null),style:{...De,padding:"8px 18px",fontSize:12,fontWeight:700,color:"#fff",background:"rgba(0,0,0,.6)",border:"none",borderRadius:8,cursor:"pointer"},children:" Cerrar vista previa"})}),e.jsx("div",{onClick:S=>S.stopPropagation(),style:{height:"100%",overflow:"auto"},children:e.jsx(Ac,{portal:r,brand:t})})]}):null;return e.jsxs("div",{style:{...De,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...De,fontSize:22,fontWeight:700,color:xe.ink,margin:"0 0 4px"},children:" Portal de Clientes"}),e.jsx("p",{style:{...De,fontSize:12,color:xe.inkLight,margin:0},children:"Gestiona los entornos de acceso de tus clientes: documentos, firmas, avances y pagos"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Portales activos",val:i.length,icon:""},{label:"En diseo",val:i.filter(S=>S.estado==="diseno").length,icon:""},{label:"En obra",val:i.filter(S=>["obra","acabados"].includes(S.estado)).length,icon:""},{label:"Firmas pendientes",val:i.reduce((S,m)=>S+m.firmasPendientes.length,0),icon:"",warn:!0},{label:"Completados",val:i.filter(S=>S.estado==="postventa").length,icon:""}].map((S,m)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"10px 14px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...De,fontSize:9,color:xe.inkLight},children:[S.icon," ",S.label]}),e.jsx("div",{style:{...De,fontSize:18,fontWeight:700,color:xe.ink},children:S.val})]},m))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:d,onChange:S=>u(S.target.value),placeholder:"Buscar por cliente o proyecto",style:{...De,width:"100%",padding:"8px 12px",fontSize:12,border:`1px solid ${xe.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{style:{...De,padding:"8px 18px",fontSize:11,fontWeight:700,color:"#fff",background:xe.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo portal"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px,1fr))",gap:12},children:b.map(S=>{const m=or.find(c=>c.id===S.estado),x=S.firmasPendientes.length,p=S.pagos.filter(c=>c.estado==="pendiente").length;return e.jsxs("div",{onClick:()=>a(S.id),style:{background:"#fff",border:`1px solid ${xe.border}`,borderRadius:12,padding:20,cursor:"pointer",boxShadow:xe.shadow,transition:"all .15s"},onMouseEnter:c=>c.currentTarget.style.boxShadow=xe.shadowMd,onMouseLeave:c=>c.currentTarget.style.boxShadow=xe.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:10},children:[e.jsx(ir,{color:m==null?void 0:m.color,bg:m==null?void 0:m.bg,children:m==null?void 0:m.label}),e.jsxs("span",{style:{...De,fontSize:18,fontWeight:800,color:xe.accent},children:[S.progreso,"%"]})]}),e.jsx("div",{style:{...De,fontSize:15,fontWeight:700,color:xe.ink,marginBottom:2},children:S.proyecto}),e.jsx("div",{style:{...De,fontSize:12,color:xe.inkLight,marginBottom:10},children:S.clienteNombre}),e.jsx("div",{style:{height:6,background:xe.bg,borderRadius:3,overflow:"hidden",marginBottom:12},children:e.jsx("div",{style:{height:"100%",width:`${S.progreso}%`,background:xe.accent,borderRadius:3}})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("span",{style:{...De,fontSize:10,color:xe.inkLight},children:[" ",S.documentos.length," docs"]}),x>0&&e.jsxs(ir,{color:xe.warning,bg:xe.warningBg,children:[" ",x," firmas"]}),p>0&&e.jsxs("span",{style:{...De,fontSize:10,color:xe.inkLight},children:[" ",p," pagos pend."]})]}),e.jsxs("div",{style:{...De,fontSize:10,color:xe.inkLight,marginTop:8},children:[oi(S.fechaInicio),"  ",oi(S.fechaEstimadaFin),"  ",S.seccionesActivas.length," secciones activas"]})]},S.id)})}),j(),w()]})}function Vm(){const t=window.location.hash.slice(1);if(t&&t.length>=20&&t.length<=30&&/^[A-Za-z0-9]+$/.test(t))return e.jsx(Om,{token:t});const i=F.useMemo(()=>wc(),[]),o=Nm(),n=kc("portales")||Ec;if(o){const a=n.find(r=>r.accessToken===o);return a?e.jsx(Ac,{portal:a,brand:i}):e.jsx("div",{style:{minHeight:"100vh",background:xe.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("h2",{style:{...De,fontSize:20,fontWeight:700,color:xe.ink},children:"Portal no encontrado"}),e.jsxs("p",{style:{...De,fontSize:13,color:xe.inkLight},children:["El enlace no es vlido o ha expirado. Contacta a ",i.nombre,"."]}),e.jsxs("p",{style:{...De,fontSize:12,color:xe.inkLight,marginTop:8},children:[i.telefono,"  ",i.email]})]})})}return e.jsx(Um,{})}const Qr="https://xlzkasdskatnikuavefh.supabase.co",Sd="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM",Ca="hab:session",Mo={h:{apikey:Sd,Authorization:`Bearer ${Sd}`,"Content-Type":"application/json",Prefer:"return=representation"},async q(t,i=""){try{const o=await fetch(`${Qr}/rest/v1/${t}?${i}`,{headers:this.h});return o.ok?await o.json():null}catch{return null}},async i(t,i){try{const o=await fetch(`${Qr}/rest/v1/${t}`,{method:"POST",headers:this.h,body:JSON.stringify(i)});return o.ok?await o.json():null}catch{return null}},async u(t,i,o){try{const n=await fetch(`${Qr}/rest/v1/${t}?${i}`,{method:"PATCH",headers:this.h,body:JSON.stringify(o)});return n.ok?await n.json():null}catch{return null}},async d(t,i){try{return(await fetch(`${Qr}/rest/v1/${t}?${i}`,{method:"DELETE",headers:this.h})).ok}catch{return!1}}},dt={ink:"#111",inkMid:"#555",inkLight:"#999",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",green:"#2D6A2E",greenBg:"#EAFAEA",blue:"#3B3B3B",blueBg:"#F0F0F0",amber:"#8C6A00",amberBg:"#FFF8E0",red:"#B91C1C",redBg:"#FAE8E8",gold:"#111",shadow:"0 1px 4px rgba(0,0,0,.06)"};async function ws(t){const i=new TextEncoder().encode(t+"_hab_2026"),o=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(o)).map(n=>n.toString(16).padStart(2,"0")).join("")}const qm={superadmin:{label:"Super Admin",color:dt.gold},admin:{label:"Administrador",color:dt.blue},gerente:{label:"Gerente",color:dt.green},disenador:{label:"Diseador",color:"#5B3A8C"},ingeniero:{label:"Ingeniero",color:"#0D5E6E"},comercial:{label:"Comercial",color:dt.amber},contable:{label:"Contable",color:dt.red},auxiliar:{label:"Auxiliar",color:dt.inkLight}};function Hm(){try{const t=sessionStorage.getItem(Ca);if(!t)return null;const i=JSON.parse(t);return Date.now()-i.ts>24*60*60*1e3?(sessionStorage.removeItem(Ca),null):i}catch{return null}}function zs(t){sessionStorage.setItem(Ca,JSON.stringify({id:t.id,email:t.email,nombre:t.nombre,rol:t.rol,ts:Date.now()}))}function Gm(){return!!Hm()}function Km(){sessionStorage.removeItem(Ca)}function Jm({onSuccess:t}){var T;const[i,o]=F.useState("login"),[n,a]=F.useState(""),[r,s]=F.useState(""),[d,u]=F.useState(""),[b,j]=F.useState(!1),[w,S]=F.useState(""),[m,x]=F.useState(!0),[p,c]=F.useState(null),[g,l]=F.useState(null);F.useEffect(()=>{f()},[]);async function f(){x(!0);const D=new URLSearchParams(window.location.search).get("invite");if(D){const oe=await Mo.q("users",`invite_token=eq.${D}&estado=eq.pendiente&limit=1`);if(oe&&oe.length>0){c(oe[0]),l(D),a(oe[0].email),o("invite"),x(!1);return}}const K=await Mo.q("users","email=eq.dparra@habitaris.co&limit=1");if(K&&K.length>0&&!K[0].password_hash){o("setup"),a("dparra@habitaris.co"),x(!1);return}o("login"),x(!1)}async function y(){if(S(""),!n||!r){S("Ingresa email y contrasea");return}x(!0);const C=await Mo.q("users",`email=eq.${n.toLowerCase().trim()}&limit=1`);if(!C||C.length===0){S("Usuario no encontrado"),x(!1);return}const D=C[0];if(D.estado==="inactivo"){S("Cuenta desactivada. Contacta al administrador."),x(!1);return}if(!D.password_hash){S("Configura tu contrasea desde el enlace de invitacin."),x(!1);return}if(await ws(r)!==D.password_hash){S("Contrasea incorrecta"),x(!1);return}await Mo.u("users",`id=eq.${D.id}`,{ultimo_login:new Date().toISOString()}),zs(D),x(!1),t()}async function h(){if(S(""),!r||r.length<6){S("Mnimo 6 caracteres");return}if(r!==d){S("No coinciden");return}x(!0);const C=await ws(r),D=await Mo.q("users","email=eq.dparra@habitaris.co&limit=1");D&&D.length>0?(await Mo.u("users",`id=eq.${D[0].id}`,{password_hash:C,estado:"activo",ultimo_login:new Date().toISOString()}),zs({...D[0],estado:"activo"}),window.history.replaceState({},"",window.location.pathname),x(!1),t()):(S("Error"),x(!1))}async function v(){if(S(""),!r||r.length<6){S("Mnimo 6 caracteres");return}if(r!==d){S("No coinciden");return}x(!0);const C=await ws(r);await Mo.u("users",`id=eq.${p.id}`,{password_hash:C,estado:"activo",invite_token:null,ultimo_login:new Date().toISOString()}),zs({...p,estado:"activo"}),window.history.replaceState({},"",window.location.pathname),x(!1),t()}const A=(()=>{var C;try{return((C=JSON.parse(localStorage.getItem("habitaris_config")||"{}").empresa)==null?void 0:C.nombre)||"Habitaris"}catch{return"Habitaris"}})(),z={width:"100%",padding:"10px 12px 10px 34px",border:`1px solid ${dt.border}`,borderRadius:8,fontSize:13,fontFamily:"'DM Sans',sans-serif",background:"#FFFFFF"},k={...z,paddingLeft:12};return m&&i==="login"?e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg,#F8F7F4,#EDEBE7)",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("style",{children:"*{box-sizing:border-box}@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');"}),e.jsx("div",{style:{color:dt.inkLight,fontSize:14},children:"Cargando..."})]}):e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg,#F8F7F4,#EDEBE7)",fontFamily:"'DM Sans',sans-serif",padding:20},children:[e.jsx("style",{children:`*{box-sizing:border-box}@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');.li:focus{outline:none;border-color:${dt.green}!important;box-shadow:0 0 0 3px ${dt.green}18}`}),e.jsxs("div",{style:{width:"100%",maxWidth:400,background:"#fff",borderRadius:16,boxShadow:"0 4px 24px rgba(0,0,0,.08)",padding:"36px 32px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("div",{style:{width:52,height:52,borderRadius:0,background:"transparent",display:"inline-flex",alignItems:"center",justifyContent:"center",marginBottom:14},children:e.jsxs("svg",{width:"52",height:"52",viewBox:"0 0 52 52",fill:"none",children:[e.jsx("rect",{x:"6",y:"8",width:"36",height:"36",stroke:"#111",strokeWidth:"1.8",fill:"none"}),e.jsx("line",{x1:"3",y1:"6",x2:"15",y2:"6",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"3",y1:"6",x2:"3",y2:"18",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"45",y1:"46",x2:"33",y2:"46",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"45",y1:"46",x2:"45",y2:"34",stroke:"#111",strokeWidth:"1.5"}),e.jsx("rect",{x:"15",y:"16",width:"6.5",height:"18",fill:"#111"}),e.jsx("rect",{x:"15",y:"23",width:"18",height:"5.5",fill:"#111"}),e.jsx("rect",{x:"26.5",y:"16",width:"6.5",height:"18",fill:"#111"})]})}),e.jsxs("h1",{style:{margin:0,fontSize:20,fontWeight:700,color:dt.ink},children:[A," ",e.jsx("span",{style:{fontWeight:300,color:dt.inkLight},children:"Suite"})]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:11,color:dt.inkLight},children:i==="setup"?"Configura tu acceso de administrador":i==="invite"?`Bienvenid@, ${p==null?void 0:p.nombre}. Configura tu contrasea`:"Acceso exclusivo para usuarios autorizados"})]}),w&&e.jsxs("div",{style:{background:dt.redBg,border:`1px solid ${dt.red}33`,borderRadius:8,padding:"8px 12px",marginBottom:14,fontSize:11,color:dt.red,display:"flex",alignItems:"center",gap:6},children:[e.jsx($t,{size:13}),w]}),i==="login"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:dt.inkMid,textTransform:"uppercase",letterSpacing:.5,display:"block",marginBottom:4},children:"Email"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(En,{size:14,color:dt.inkLight,style:{position:"absolute",left:10,top:11}}),e.jsx("input",{className:"li",value:n,onChange:C=>a(C.target.value),placeholder:"tu@email.com",type:"email",onKeyDown:C=>C.key==="Enter"&&y(),style:z})]})]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:dt.inkMid,textTransform:"uppercase",letterSpacing:.5,display:"block",marginBottom:4},children:"Contrasea"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Fd,{size:14,color:dt.inkLight,style:{position:"absolute",left:10,top:11}}),e.jsx("input",{className:"li",value:r,onChange:C=>s(C.target.value),placeholder:"",type:b?"text":"password",onKeyDown:C=>C.key==="Enter"&&y(),style:z}),e.jsx("button",{onClick:()=>j(!b),style:{position:"absolute",right:8,top:8,border:"none",background:"none",cursor:"pointer"},children:b?e.jsx(tp,{size:15,color:dt.inkLight}):e.jsx(yn,{size:15,color:dt.inkLight})})]})]}),e.jsx("button",{onClick:y,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:dt.ink,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Verificando...":"Iniciar sesin"}),e.jsx("p",{style:{textAlign:"center",marginTop:18,fontSize:10,color:dt.inkLight},children:"No tienes cuenta? Solicita acceso al administrador"})]}),i==="setup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{background:dt.amberBg,border:`1px solid ${dt.amber}33`,borderRadius:8,padding:"10px 12px",marginBottom:14,fontSize:10,color:dt.amber},children:[e.jsx("strong",{children:" Primera vez:"})," Contrasea para Super Admin (dparra@habitaris.co)"]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:dt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Email"}),e.jsx("input",{value:"dparra@habitaris.co",disabled:!0,style:{...k,background:"#f0f0f0",color:dt.inkMid}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:dt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Nueva contrasea"}),e.jsx("input",{className:"li",value:r,onChange:C=>s(C.target.value),placeholder:"Mnimo 6 caracteres",type:b?"text":"password",style:k})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:dt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Confirmar"}),e.jsx("input",{className:"li",value:d,onChange:C=>u(C.target.value),placeholder:"Repite la contrasea",type:b?"text":"password",onKeyDown:C=>C.key==="Enter"&&h(),style:k})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:14,fontSize:10,color:dt.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:b,onChange:()=>j(!b)})," Mostrar"]}),e.jsx("button",{onClick:h,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:dt.green,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Configurando...":" Crear mi cuenta"})]}),i==="invite"&&p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{background:dt.blueBg,border:`1px solid ${dt.blue}33`,borderRadius:8,padding:"10px 12px",marginBottom:14,fontSize:10,color:dt.blue},children:[e.jsx("strong",{children:""})," Invitad@ como ",e.jsx("strong",{children:(T=qm[p.rol])==null?void 0:T.label}),". Configura tu contrasea."]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:dt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Email"}),e.jsx("input",{value:p.email,disabled:!0,style:{...k,background:"#f0f0f0",color:dt.inkMid}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:dt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Nueva contrasea"}),e.jsx("input",{className:"li",value:r,onChange:C=>s(C.target.value),placeholder:"Mnimo 6 caracteres",type:b?"text":"password",style:k})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:dt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Confirmar"}),e.jsx("input",{className:"li",value:d,onChange:C=>u(C.target.value),placeholder:"Repite",type:b?"text":"password",onKeyDown:C=>C.key==="Enter"&&v(),style:k})]}),e.jsx("button",{onClick:v,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:dt.blue,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Configurando...":" Activar mi cuenta"})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:20,fontSize:9,color:dt.inkLight},children:[A," Suite  Acceso protegido"]})]})]})}const Qs=[{id:"dashboard",label:"Dashboard",icon:"",desc:"KPIs financieros, alertas, flujo caja, vista consolidada empresa",color:"#111111",component:jm,ready:!0},{id:"formularios",label:"Formularios",icon:"",desc:"Constructor, plantillas, lgica condicional, compartir WhatsApp/email",color:"#5B3A8C",component:Pm,ready:!0},{id:"crm",label:"CRM / Ofertas",icon:"",desc:"Ofertas, clientes, proveedores, APU, borrador y presupuesto",color:"#1E6B42",component:Xh,ready:!0},{id:"rrhh",label:"RRHH",icon:"",desc:"Equipo, cargos, partes de trabajo, asistencia y nmina",color:"#1E4F8C",component:jf,ready:!0},{id:"herramientas",label:"Herramientas Tcnicas",icon:"",desc:"Cuadro de cargas, concreto, cubicacin, materiales, unidades",color:"#7A5218",component:Bf,ready:!0},{id:"logistica",label:"Logstica",icon:"",desc:"Almacn, EPPs, dotaciones, herramientas, equipos, compras y proveedores",color:"#0D5E6E",component:Mf,ready:!0},{id:"compras",label:"Compras",icon:"",desc:"rdenes de compra, recepcin mercanca, evaluacin proveedores",color:"#0D5E6E",component:mm,ready:!0},{id:"aprobaciones",label:"Aprobaciones",icon:"",desc:"Flujos de aprobacin, cadenas, umbrales y permisos por mdulo",color:"#D4840A",component:Pf,ready:!0},{id:"proyectos",label:"Proyectos",icon:"",desc:"Gantt, avances, seguimiento de obra y control de calidad",color:"#5B3A8C",component:Vf,ready:!0},{id:"biblioteca",label:"Biblioteca",icon:"",desc:"APUs normalizados, materiales, precios unitarios y textos tipo",color:"#0D5E6E",component:Kf,ready:!0},{id:"contabilidad",label:"Contabilidad",icon:"",desc:"Facturacin, costos reales, ingresos, egresos e informes",color:"#555555",component:Qf,ready:!0},{id:"sst",label:"SST",icon:"",desc:"Seguridad y salud en el trabajo, inspecciones y riesgos",color:"#AE2C2C",component:ix,ready:!0},{id:"formacion",label:"Formacin",icon:"",desc:"Cursos obligatorios y operativos, evaluaciones, certificados, control de vencimientos",color:"#5B3A8C",component:px,ready:!0},{id:"carnets",label:"Identidad Corporativa",icon:"",desc:"Carnets, tarjetas de visita fsicas y virtuales, QR de contacto, branding del equipo",color:"#0D5E6E",component:zx,ready:!0},{id:"firmas",label:"Firma Digital",icon:"",desc:"Firma de documentos con pad digital, trazabilidad, firmas guardadas y certificados",color:"#5B3A8C",component:Fx,ready:!0},{id:"legal",label:"Legal",icon:"",desc:"Plantillas contractuales, plizas/seguros, procesos legales, comunicaciones",color:"#1E4F8C",component:Rx,ready:!0},{id:"calidad",label:"Calidad y Auditora",icon:"",desc:"No conformidades, auditoras, protocolos, checklists e indicadores",color:"#0D7377",component:Ox,ready:!0},{id:"postventa",label:"Postventa",icon:"",desc:"Garantas, incidencias y atencin al cliente post-entrega",color:"#1E4F8C",component:Xx,ready:!0},{id:"admin",label:"Administracin",icon:"",desc:"Caja chica, tarjeta corporativa, viticos, flujo empresa, CxC/CxP",color:"#6B5B8C",component:nm,ready:!0},{id:"flotas",label:"Control de Flotas",icon:"",desc:"Vehculos, kilmetros, combustible, documentacin, mantenimiento",color:"#2E5E4E",component:gm,ready:!0},{id:"config",label:"Configuracin",icon:"",desc:"Empresa, correo, WhatsApp, legal, apariencia  ajustes globales",color:"#555555",component:wm,ready:!0}],bo={fontFamily:"'DM Sans',sans-serif"};function Ym(){return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",flexDirection:"column",gap:16},children:[e.jsx("div",{style:{width:40,height:40,border:"3px solid #E4E1DB",borderTopColor:"#1E6B42",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),e.jsx("style",{children:"@keyframes spin{to{transform:rotate(360deg)}}"}),e.jsx("p",{style:{...bo,fontSize:13,color:"#888"},children:"Cargando mdulo"})]})}function Fc({lang:t,setLang:i}){return e.jsx("div",{style:{display:"flex",gap:4},children:[["es"," Espaol"],["en"," English"]].map(([o,n])=>e.jsx("button",{onClick:()=>i(o),style:{...bo,padding:"4px 10px",borderRadius:4,border:"none",cursor:"pointer",fontSize:10,fontWeight:600,background:t===o?"#1E6B42":"rgba(255,255,255,0.12)",color:t===o?"#fff":"rgba(255,255,255,0.55)",transition:"all .15s"},children:n},o))})}function Xm({onSelect:t,lang:i,setLang:o,onLogout:n}){var j,w;const a=Qs.filter(S=>S.ready),r=Qs.filter(S=>!S.ready),s=F.useMemo(()=>Ai(),[]),d=s.apariencia||{},u=d.colorPrimario||"#111",b=d.tipografia||"DM Sans";return e.jsxs("div",{style:{minHeight:"100vh",background:"#F0EEE9"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${b.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:u,padding:"0 28px",height:52,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[d.logo?e.jsx("img",{src:d.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("span",{style:{fontFamily:`'${b}',sans-serif`,fontSize:17,fontWeight:700,color:"#fff",letterSpacing:2,textTransform:"uppercase"},children:((j=s.empresa)==null?void 0:j.nombre)||"HABITARIS"}),d.slogan&&e.jsx("span",{style:{fontFamily:`'${b}',sans-serif`,fontSize:8,letterSpacing:1.5,color:"rgba(255,255,255,.35)",textTransform:"uppercase"},children:d.slogan})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(Fc,{lang:i,setLang:o}),n&&e.jsx("button",{onClick:n,style:{...bo,padding:"4px 12px",borderRadius:4,border:"1px solid rgba(255,255,255,0.15)",cursor:"pointer",fontSize:10,fontWeight:600,background:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.55)",transition:"all .15s"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:S=>S.currentTarget.style.background="rgba(255,255,255,0.08)",children:" Salir"})]})]}),d.colorAcento&&e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${d.colorAcento},${d.colorAcento}88,${d.colorAcento})`}}),e.jsxs("div",{style:{maxWidth:920,margin:"0 auto",padding:"48px 28px 40px"},children:[e.jsx("p",{style:{fontFamily:`'${b}',sans-serif`,fontSize:10,color:"#888",letterSpacing:1.5,textTransform:"uppercase",marginBottom:6},children:"Suite de gestin"}),e.jsx("h1",{style:{fontFamily:`'${b}',sans-serif`,fontSize:30,fontWeight:700,color:"#111",marginBottom:4,letterSpacing:-.5},children:"Selecciona un mdulo"}),e.jsxs("p",{style:{fontFamily:`'${b}',sans-serif`,fontSize:13,color:"#888",marginBottom:40},children:[((w=s.empresa)==null?void 0:w.nombre)||"Habitaris","  ",i==="es"?"Espaol":"English"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(240px,1fr))",gap:14,marginBottom:36},children:a.map(S=>e.jsxs("button",{onClick:()=>t(S.id),style:{background:"#fff",border:"1px solid #E4E1DB",borderRadius:10,padding:22,textAlign:"left",cursor:"pointer",transition:"all .15s",boxShadow:"0 1px 4px rgba(0,0,0,.06)",fontFamily:"'DM Sans',sans-serif"},onMouseEnter:m=>{m.currentTarget.style.boxShadow="0 4px 16px rgba(0,0,0,.10)",m.currentTarget.style.borderColor=S.color},onMouseLeave:m=>{m.currentTarget.style.boxShadow="0 1px 4px rgba(0,0,0,.06)",m.currentTarget.style.borderColor="#E4E1DB"},children:[e.jsx("div",{style:{fontSize:26,marginBottom:10},children:S.icon}),e.jsx("div",{style:{...bo,fontSize:14,fontWeight:700,color:"#111",marginBottom:4},children:S.label}),e.jsx("div",{style:{...bo,fontSize:11,color:"#888",lineHeight:1.5,marginBottom:12},children:S.desc}),e.jsx("div",{style:{...bo,fontSize:10,fontWeight:700,color:S.color,textTransform:"uppercase",letterSpacing:.8},children:"Abrir "})]},S.id))}),e.jsx("p",{style:{...bo,fontSize:10,color:"#AAA",letterSpacing:1.5,textTransform:"uppercase",marginBottom:10},children:"Prximamente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(190px,1fr))",gap:10},children:r.map(S=>e.jsxs("div",{style:{background:"#FAFAF8",border:"1px solid #E4E1DB",borderRadius:8,padding:"13px 15px",opacity:.6,fontFamily:"'DM Sans',sans-serif"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7,marginBottom:4},children:[e.jsx("span",{style:{fontSize:17},children:S.icon}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#555"},children:S.label})]}),e.jsx("div",{style:{fontSize:10,color:"#999",lineHeight:1.5,marginBottom:7},children:S.desc}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#AAA",textTransform:"uppercase",letterSpacing:.8},children:"En desarrollo"})]},S.id))}),e.jsx("p",{style:{...bo,marginTop:40,fontSize:11,color:"#AAA",textAlign:"center"},children:"v1.0  Habitaris S.A.S  NIT 901.922.136-8  Bogot D.C."})]})]})}function Qm({mod:t,onBack:i,lang:o,setLang:n,onLogout:a}){var b;const r=F.useMemo(()=>Ai(),[]),s=r.apariencia||{},d=s.colorPrimario||"#111",u=s.tipografia||"DM Sans";return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,height:48,background:d,zIndex:1e3,display:"flex",alignItems:"center",padding:"0 18px",gap:14,fontFamily:`'${u}',sans-serif`},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${u.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsx("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:5,padding:"5px 12px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:5,cursor:"pointer",color:"rgba(255,255,255,0.65)",fontSize:12,fontWeight:500,transition:"all .15s",fontFamily:`'${u}',sans-serif`},onMouseEnter:j=>j.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:j=>j.currentTarget.style.background="rgba(255,255,255,0.1)",children:" Mdulos"}),e.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.15)"}}),e.jsx("span",{style:{fontSize:13,color:"rgba(255,255,255,0.35)"},children:t.icon}),s.logo?e.jsx("img",{src:s.logo,alt:"Logo",style:{height:22,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:13,fontWeight:700,color:"#fff",letterSpacing:.3,textTransform:"uppercase"},children:((b=r.empresa)==null?void 0:b.nombre)||"HABITARIS"}),e.jsxs("span",{style:{fontSize:13,color:"rgba(255,255,255,0.4)"},children:["/ ",t.label]}),e.jsx("div",{style:{flex:1}}),e.jsx(Fc,{lang:o,setLang:n}),a&&e.jsx("button",{onClick:a,style:{marginLeft:8,padding:"4px 10px",borderRadius:4,border:"1px solid rgba(255,255,255,0.15)",cursor:"pointer",fontSize:10,fontWeight:600,background:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.55)",fontFamily:`'${u}',sans-serif`,transition:"all .15s"},onMouseEnter:j=>j.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:j=>j.currentTarget.style.background="rgba(255,255,255,0.08)",children:" Salir"}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:2,background:`linear-gradient(90deg, ${t.color}, ${t.color}44)`}})]})}function Zm(){const[t,i]=F.useState(()=>sessionStorage.getItem("hab:active_module")||null),[o,n]=F.useState("es"),[a,r]=F.useState(Gm()),s=Qs.find(S=>S.id===t),d=S=>{sessionStorage.setItem("hab:active_module",S),i(S)},u=()=>{sessionStorage.removeItem("hab:active_module"),i(null)},b=()=>{Km(),r(!1)},j=window.location.pathname;if(j.startsWith("/portal"))return e.jsx(Vm,{});if(j.startsWith("/form"))return e.jsx(sh,{});if(!a)return e.jsx(Jm,{onSuccess:()=>r(!0)});if(!t||!(s!=null&&s.component))return e.jsx(Xm,{onSelect:d,lang:o,setLang:n,onLogout:b});const w=s.component;return e.jsxs("div",{style:{minHeight:"100vh",background:"#F0EEE9",paddingTop:48},children:[e.jsx(Qm,{mod:s,onBack:u,lang:o,setLang:n,onLogout:b}),e.jsx(F.Suspense,{fallback:e.jsx(Ym,{}),children:e.jsx(w,{lang:o})})]})}Ps.createRoot(document.getElementById("root")).render(e.jsx(ka.StrictMode,{children:e.jsx(Zm,{})}));
