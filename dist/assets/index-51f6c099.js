import{r as F,a as Mc,R as vr}from"./vendor-b1791c80.js";import{createClient as Dc}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";import{L as zn,I as al,P as Vo,C as xt,T as He,a as Oe,X as $t,S as Ci,F as Et,b as Ji,c as Sd,B as $c,d as Yi,e as fa,A as Cd,D as Eo,f as wo,g as En,H as sr,h as Ks,U as kd,i as yn,R as xa,M as An,j as jr,k as Pc,E as vn,l as Oc,m as Lc,n as Js,o as Fn,p as li,q as Fa,r as Bi,s as Sr,t as Ta,u as ro,v as Ho,w as Tn,x as Wc,y as Ao,z as wd,G as zs,J as Bn,K as Nc,Z as sl,N as zd,O as Uc,Q as Ed,V as Vc,W as qc,Y as Ba,_ as Ad,$ as Fd,a0 as Hc,a1 as Gc,a2 as Td,a3 as lr,a4 as Bd,a5 as Id,a6 as Rd,a7 as _d,a8 as Md,a9 as Kc,aa as Jc,ab as Ys,ac as Yc,ad as Dd,ae as Xc,af as Qc,ag as Zc,ah as ep,ai as tp,aj as ip,ak as op,al as np,am as rp,an as ap}from"./icons-cbaf3daf.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=o(a);fetch(a.href,r)}})();var $d={exports:{}},Ia={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sp=F,lp=Symbol.for("react.element"),dp=Symbol.for("react.fragment"),cp=Object.prototype.hasOwnProperty,pp=sp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gp={key:!0,ref:!0,__self:!0,__source:!0};function Pd(t,i,o){var n,a={},r=null,s=null;o!==void 0&&(r=""+o),i.key!==void 0&&(r=""+i.key),i.ref!==void 0&&(s=i.ref);for(n in i)cp.call(i,n)&&!gp.hasOwnProperty(n)&&(a[n]=i[n]);if(t&&t.defaultProps)for(n in i=t.defaultProps,i)a[n]===void 0&&(a[n]=i[n]);return{$$typeof:lp,type:t,key:r,ref:s,props:a,_owner:pp.current}}Ia.Fragment=dp;Ia.jsx=Pd;Ia.jsxs=Pd;$d.exports=Ia;var e=$d.exports,Es={},ll=Mc;Es.createRoot=ll.createRoot,Es.hydrateRoot=ll.hydrateRoot;function Ra(t,i){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(o[n[a]]=t[n[a]]);return o}function up(t,i,o,n){function a(r){return r instanceof o?r:new o(function(s){s(r)})}return new(o||(o=Promise))(function(r,s){function g(j){try{b(n.next(j))}catch(k){s(k)}}function h(j){try{b(n.throw(j))}catch(k){s(k)}}function b(j){j.done?r(j.value):a(j.value).then(g,h)}b((n=n.apply(t,i||[])).next())})}const hp=t=>t?(...i)=>t(...i):(...i)=>fetch(...i);class Xs extends Error{constructor(i,o="FunctionsError",n){super(i),this.name=o,this.context=n}}class fp extends Xs{constructor(i){super("Failed to send a request to the Edge Function","FunctionsFetchError",i)}}class dl extends Xs{constructor(i){super("Relay Error invoking the Edge Function","FunctionsRelayError",i)}}class cl extends Xs{constructor(i){super("Edge Function returned a non-2xx status code","FunctionsHttpError",i)}}var As;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(As||(As={}));class xp{constructor(i,{headers:o={},customFetch:n,region:a=As.Any}={}){this.url=i,this.headers=o,this.region=a,this.fetch=hp(n)}setAuth(i){this.headers.Authorization=`Bearer ${i}`}invoke(i){return up(this,arguments,void 0,function*(o,n={}){var a;let r,s;try{const{headers:g,method:h,body:b,signal:j,timeout:k}=n;let v={},{region:m}=n;m||(m=this.region);const f=new URL(`${this.url}/${o}`);m&&m!=="any"&&(v["x-region"]=m,f.searchParams.set("forceFunctionRegion",m));let p;b&&(g&&!Object.prototype.hasOwnProperty.call(g,"Content-Type")||!g)?typeof Blob<"u"&&b instanceof Blob||b instanceof ArrayBuffer?(v["Content-Type"]="application/octet-stream",p=b):typeof b=="string"?(v["Content-Type"]="text/plain",p=b):typeof FormData<"u"&&b instanceof FormData?p=b:(v["Content-Type"]="application/json",p=JSON.stringify(b)):b&&typeof b!="string"&&!(typeof Blob<"u"&&b instanceof Blob)&&!(b instanceof ArrayBuffer)&&!(typeof FormData<"u"&&b instanceof FormData)?p=JSON.stringify(b):p=b;let d=j;k&&(s=new AbortController,r=setTimeout(()=>s.abort(),k),j?(d=s.signal,j.addEventListener("abort",()=>s.abort())):d=s.signal);const c=yield this.fetch(f.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},v),this.headers),g),body:p,signal:d}).catch(u=>{throw new fp(u)}),l=c.headers.get("x-relay-error");if(l&&l==="true")throw new dl(c);if(!c.ok)throw new cl(c);let x=((a=c.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),y;return x==="application/json"?y=yield c.json():x==="application/octet-stream"||x==="application/pdf"?y=yield c.blob():x==="text/event-stream"?y=c:x==="multipart/form-data"?y=yield c.formData():y=yield c.text(),{data:y,error:null,response:c}}catch(g){return{data:null,error:g,response:g instanceof cl||g instanceof dl?g.context:void 0}}finally{r&&clearTimeout(r)}})}}var mp=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},bp=class{constructor(t){var i,o,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(i=t.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=t.signal,this.isMaybeSingle=(o=t.isMaybeSingle)!==null&&o!==void 0?o:!1,this.urlLengthLimit=(n=t.urlLengthLimit)!==null&&n!==void 0?n:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,i){return this.headers=new Headers(this.headers),this.headers.set(t,i),this}then(t,i){var o=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let a=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let s=null,g=null,h=null,b=r.status,j=r.statusText;if(r.ok){var k,v;if(o.method!=="HEAD"){var m;const c=await r.text();c===""||(o.headers.get("Accept")==="text/csv"||o.headers.get("Accept")&&(!((m=o.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?g=c:g=JSON.parse(c))}const p=(k=o.headers.get("Prefer"))===null||k===void 0?void 0:k.match(/count=(exact|planned|estimated)/),d=(v=r.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");p&&d&&d.length>1&&(h=parseInt(d[1])),o.isMaybeSingle&&o.method==="GET"&&Array.isArray(g)&&(g.length>1?(s={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,h=null,b=406,j="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{var f;const p=await r.text();try{s=JSON.parse(p),Array.isArray(s)&&r.status===404&&(g=[],s=null,b=200,j="OK")}catch{r.status===404&&p===""?(b=204,j="No Content"):s={message:p}}if(s&&o.isMaybeSingle&&(!(s==null||(f=s.details)===null||f===void 0)&&f.includes("0 rows"))&&(s=null,b=200,j="OK"),s&&o.shouldThrowOnError)throw new mp(s)}return{error:s,data:g,count:h,status:b,statusText:j}});return this.shouldThrowOnError||(a=a.catch(r=>{var s;let g="",h="",b="";const j=r==null?void 0:r.cause;if(j){var k,v,m,f;const c=(k=j==null?void 0:j.message)!==null&&k!==void 0?k:"",l=(v=j==null?void 0:j.code)!==null&&v!==void 0?v:"";g=`${(m=r==null?void 0:r.name)!==null&&m!==void 0?m:"FetchError"}: ${r==null?void 0:r.message}`,g+=`

Caused by: ${(f=j==null?void 0:j.name)!==null&&f!==void 0?f:"Error"}: ${c}`,l&&(g+=` (${l})`),j!=null&&j.stack&&(g+=`
${j.stack}`)}else{var p;g=(p=r==null?void 0:r.stack)!==null&&p!==void 0?p:""}const d=this.url.toString().length;return(r==null?void 0:r.name)==="AbortError"||(r==null?void 0:r.code)==="ABORT_ERR"?(b="",h="Request was aborted (timeout or manual cancellation)",d>this.urlLengthLimit&&(h+=`. Note: Your request URL is ${d} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((j==null?void 0:j.name)==="HeadersOverflowError"||(j==null?void 0:j.code)==="UND_ERR_HEADERS_OVERFLOW")&&(b="",h="HTTP headers exceeded server limits (typically 16KB)",d>this.urlLengthLimit&&(h+=`. Your request URL is ${d} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(s=r==null?void 0:r.name)!==null&&s!==void 0?s:"FetchError"}: ${r==null?void 0:r.message}`,details:g,hint:h,code:b},data:null,count:null,status:0,statusText:""}})),a.then(t,i)}returns(){return this}overrideTypes(){return this}},yp=class extends bp{select(t){let i=!1;const o=(t??"*").split("").map(n=>/\s/.test(n)&&!i?"":(n==='"'&&(i=!i),n)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:i=!0,nullsFirst:o,foreignTable:n,referencedTable:a=n}={}){const r=a?`${a}.order`:"order",s=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${s?`${s},`:""}${t}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:i,referencedTable:o=i}={}){const n=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(n,`${t}`),this}range(t,i,{foreignTable:o,referencedTable:n=o}={}){const a=typeof n>"u"?"offset":`${n}.offset`,r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(a,`${t}`),this.url.searchParams.set(r,`${i-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:i=!1,settings:o=!1,buffers:n=!1,wal:a=!1,format:r="text"}={}){var s;const g=[t?"analyze":null,i?"verbose":null,o?"settings":null,n?"buffers":null,a?"wal":null].filter(Boolean).join("|"),h=(s=this.headers.get("Accept"))!==null&&s!==void 0?s:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${h}"; options=${g};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const pl=new RegExp("[,()]");var cn=class extends yp{eq(t,i){return this.url.searchParams.append(t,`eq.${i}`),this}neq(t,i){return this.url.searchParams.append(t,`neq.${i}`),this}gt(t,i){return this.url.searchParams.append(t,`gt.${i}`),this}gte(t,i){return this.url.searchParams.append(t,`gte.${i}`),this}lt(t,i){return this.url.searchParams.append(t,`lt.${i}`),this}lte(t,i){return this.url.searchParams.append(t,`lte.${i}`),this}like(t,i){return this.url.searchParams.append(t,`like.${i}`),this}likeAllOf(t,i){return this.url.searchParams.append(t,`like(all).{${i.join(",")}}`),this}likeAnyOf(t,i){return this.url.searchParams.append(t,`like(any).{${i.join(",")}}`),this}ilike(t,i){return this.url.searchParams.append(t,`ilike.${i}`),this}ilikeAllOf(t,i){return this.url.searchParams.append(t,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(t,i){return this.url.searchParams.append(t,`ilike(any).{${i.join(",")}}`),this}regexMatch(t,i){return this.url.searchParams.append(t,`match.${i}`),this}regexIMatch(t,i){return this.url.searchParams.append(t,`imatch.${i}`),this}is(t,i){return this.url.searchParams.append(t,`is.${i}`),this}isDistinct(t,i){return this.url.searchParams.append(t,`isdistinct.${i}`),this}in(t,i){const o=Array.from(new Set(i)).map(n=>typeof n=="string"&&pl.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`in.(${o})`),this}notIn(t,i){const o=Array.from(new Set(i)).map(n=>typeof n=="string"&&pl.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`not.in.(${o})`),this}contains(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cs.{${i.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(i)}`),this}containedBy(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cd.{${i.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(i)}`),this}rangeGt(t,i){return this.url.searchParams.append(t,`sr.${i}`),this}rangeGte(t,i){return this.url.searchParams.append(t,`nxl.${i}`),this}rangeLt(t,i){return this.url.searchParams.append(t,`sl.${i}`),this}rangeLte(t,i){return this.url.searchParams.append(t,`nxr.${i}`),this}rangeAdjacent(t,i){return this.url.searchParams.append(t,`adj.${i}`),this}overlaps(t,i){return typeof i=="string"?this.url.searchParams.append(t,`ov.${i}`):this.url.searchParams.append(t,`ov.{${i.join(",")}}`),this}textSearch(t,i,{config:o,type:n}={}){let a="";n==="plain"?a="pl":n==="phrase"?a="ph":n==="websearch"&&(a="w");const r=o===void 0?"":`(${o})`;return this.url.searchParams.append(t,`${a}fts${r}.${i}`),this}match(t){return Object.entries(t).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(t,i,o){return this.url.searchParams.append(t,`not.${i}.${o}`),this}or(t,{foreignTable:i,referencedTable:o=i}={}){const n=o?`${o}.or`:"or";return this.url.searchParams.append(n,`(${t})`),this}filter(t,i,o){return this.url.searchParams.append(t,`${i}.${o}`),this}},vp=class{constructor(t,{headers:i={},schema:o,fetch:n,urlLengthLimit:a=8e3}){this.url=t,this.headers=new Headers(i),this.schema=o,this.fetch=n,this.urlLengthLimit=a}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,i){const{head:o=!1,count:n}=i??{},a=o?"HEAD":"GET";let r=!1;const s=(t??"*").split("").map(b=>/\s/.test(b)&&!r?"":(b==='"'&&(r=!r),b)).join(""),{url:g,headers:h}=this.cloneRequestState();return g.searchParams.set("select",s),n&&h.append("Prefer",`count=${n}`),new cn({method:a,url:g,headers:h,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:i,defaultToNull:o=!0}={}){var n;const a="POST",{url:r,headers:s}=this.cloneRequestState();if(i&&s.append("Prefer",`count=${i}`),o||s.append("Prefer","missing=default"),Array.isArray(t)){const g=t.reduce((h,b)=>h.concat(Object.keys(b)),[]);if(g.length>0){const h=[...new Set(g)].map(b=>`"${b}"`);r.searchParams.set("columns",h.join(","))}}return new cn({method:a,url:r,headers:s,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:i,ignoreDuplicates:o=!1,count:n,defaultToNull:a=!0}={}){var r;const s="POST",{url:g,headers:h}=this.cloneRequestState();if(h.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&g.searchParams.set("on_conflict",i),n&&h.append("Prefer",`count=${n}`),a||h.append("Prefer","missing=default"),Array.isArray(t)){const b=t.reduce((j,k)=>j.concat(Object.keys(k)),[]);if(b.length>0){const j=[...new Set(b)].map(k=>`"${k}"`);g.searchParams.set("columns",j.join(","))}}return new cn({method:s,url:g,headers:h,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:i}={}){var o;const n="PATCH",{url:a,headers:r}=this.cloneRequestState();return i&&r.append("Prefer",`count=${i}`),new cn({method:n,url:a,headers:r,schema:this.schema,body:t,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var i;const o="DELETE",{url:n,headers:a}=this.cloneRequestState();return t&&a.append("Prefer",`count=${t}`),new cn({method:o,url:n,headers:a,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}};function dr(t){"@babel/helpers - typeof";return dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},dr(t)}function jp(t,i){if(dr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(dr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function Sp(t){var i=jp(t,"string");return dr(i)=="symbol"?i:i+""}function Cp(t,i,o){return(i=Sp(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function gl(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),o.push.apply(o,n)}return o}function Br(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?gl(Object(o),!0).forEach(function(n){Cp(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):gl(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}var kp=class Od{constructor(i,{headers:o={},schema:n,fetch:a,timeout:r,urlLengthLimit:s=8e3}={}){this.url=i,this.headers=new Headers(o),this.schemaName=n,this.urlLengthLimit=s;const g=a??globalThis.fetch;r!==void 0&&r>0?this.fetch=(h,b)=>{const j=new AbortController,k=setTimeout(()=>j.abort(),r),v=b==null?void 0:b.signal;if(v){if(v.aborted)return clearTimeout(k),g(h,b);const m=()=>{clearTimeout(k),j.abort()};return v.addEventListener("abort",m,{once:!0}),g(h,Br(Br({},b),{},{signal:j.signal})).finally(()=>{clearTimeout(k),v.removeEventListener("abort",m)})}return g(h,Br(Br({},b),{},{signal:j.signal})).finally(()=>clearTimeout(k))}:this.fetch=g}from(i){if(!i||typeof i!="string"||i.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new vp(new URL(`${this.url}/${i}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(i){return new Od(this.url,{headers:this.headers,schema:i,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(i,o={},{head:n=!1,get:a=!1,count:r}={}){var s;let g;const h=new URL(`${this.url}/rpc/${i}`);let b;const j=m=>m!==null&&typeof m=="object"&&(!Array.isArray(m)||m.some(j)),k=n&&Object.values(o).some(j);k?(g="POST",b=o):n||a?(g=n?"HEAD":"GET",Object.entries(o).filter(([m,f])=>f!==void 0).map(([m,f])=>[m,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([m,f])=>{h.searchParams.append(m,f)})):(g="POST",b=o);const v=new Headers(this.headers);return k?v.set("Prefer",r?`count=${r},return=minimal`:"return=minimal"):r&&v.set("Prefer",`count=${r}`),new cn({method:g,url:h,headers:v,schema:this.schemaName,body:b,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}};class wp{constructor(){}static detectEnvironment(){var i;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((i=navigator.userAgent)===null||i===void 0)&&i.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const o=globalThis.process;if(o){const n=o.versions;if(n&&n.node){const a=n.node,r=parseInt(a.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const i=this.detectEnvironment();if(i.constructor)return i.constructor;let o=i.error||"WebSocket not supported in this environment.";throw i.workaround&&(o+=`

Suggested solution: ${i.workaround}`),new Error(o)}static createWebSocket(i,o){const n=this.getWebSocketConstructor();return new n(i,o)}static isWebSocketSupported(){try{const i=this.detectEnvironment();return i.type==="native"||i.type==="ws"}catch{return!1}}}const zp="2.97.0",Ep=`realtime-js/${zp}`,Ap="1.0.0",Ld="2.0.0",ul=Ld,Fs=1e4,Fp=1e3,Tp=100;var yo;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(yo||(yo={}));var Nt;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Nt||(Nt={}));var Ai;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Ai||(Ai={}));var Ts;(function(t){t.websocket="websocket"})(Ts||(Ts={}));var Oo;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Oo||(Oo={}));class Bp{constructor(i){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=i??[]}encode(i,o){if(i.event===this.BROADCAST_EVENT&&!(i.payload instanceof ArrayBuffer)&&typeof i.payload.event=="string")return o(this._binaryEncodeUserBroadcastPush(i));let n=[i.join_ref,i.ref,i.topic,i.event,i.payload];return o(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(i){var o;return this._isArrayBuffer((o=i.payload)===null||o===void 0?void 0:o.payload)?this._encodeBinaryUserBroadcastPush(i):this._encodeJsonUserBroadcastPush(i)}_encodeBinaryUserBroadcastPush(i){var o,n;const a=(n=(o=i.payload)===null||o===void 0?void 0:o.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(i,this.BINARY_ENCODING,a)}_encodeJsonUserBroadcastPush(i){var o,n;const a=(n=(o=i.payload)===null||o===void 0?void 0:o.payload)!==null&&n!==void 0?n:{},s=new TextEncoder().encode(JSON.stringify(a)).buffer;return this._encodeUserBroadcastPush(i,this.JSON_ENCODING,s)}_encodeUserBroadcastPush(i,o,n){var a,r;const s=i.topic,g=(a=i.ref)!==null&&a!==void 0?a:"",h=(r=i.join_ref)!==null&&r!==void 0?r:"",b=i.payload.event,j=this.allowedMetadataKeys?this._pick(i.payload,this.allowedMetadataKeys):{},k=Object.keys(j).length===0?"":JSON.stringify(j);if(h.length>255)throw new Error(`joinRef length ${h.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`ref length ${g.length} exceeds maximum of 255`);if(s.length>255)throw new Error(`topic length ${s.length} exceeds maximum of 255`);if(b.length>255)throw new Error(`userEvent length ${b.length} exceeds maximum of 255`);if(k.length>255)throw new Error(`metadata length ${k.length} exceeds maximum of 255`);const v=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+g.length+s.length+b.length+k.length,m=new ArrayBuffer(this.HEADER_LENGTH+v);let f=new DataView(m),p=0;f.setUint8(p++,this.KINDS.userBroadcastPush),f.setUint8(p++,h.length),f.setUint8(p++,g.length),f.setUint8(p++,s.length),f.setUint8(p++,b.length),f.setUint8(p++,k.length),f.setUint8(p++,o),Array.from(h,c=>f.setUint8(p++,c.charCodeAt(0))),Array.from(g,c=>f.setUint8(p++,c.charCodeAt(0))),Array.from(s,c=>f.setUint8(p++,c.charCodeAt(0))),Array.from(b,c=>f.setUint8(p++,c.charCodeAt(0))),Array.from(k,c=>f.setUint8(p++,c.charCodeAt(0)));var d=new Uint8Array(m.byteLength+n.byteLength);return d.set(new Uint8Array(m),0),d.set(new Uint8Array(n),m.byteLength),d.buffer}decode(i,o){if(this._isArrayBuffer(i)){let n=this._binaryDecode(i);return o(n)}if(typeof i=="string"){const n=JSON.parse(i),[a,r,s,g,h]=n;return o({join_ref:a,ref:r,topic:s,event:g,payload:h})}return o({})}_binaryDecode(i){const o=new DataView(i),n=o.getUint8(0),a=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(i,o,a)}}_decodeUserBroadcast(i,o,n){const a=o.getUint8(1),r=o.getUint8(2),s=o.getUint8(3),g=o.getUint8(4);let h=this.HEADER_LENGTH+4;const b=n.decode(i.slice(h,h+a));h=h+a;const j=n.decode(i.slice(h,h+r));h=h+r;const k=n.decode(i.slice(h,h+s));h=h+s;const v=i.slice(h,i.byteLength),m=g===this.JSON_ENCODING?JSON.parse(n.decode(v)):v,f={type:this.BROADCAST_EVENT,event:j,payload:m};return s>0&&(f.meta=JSON.parse(k)),{join_ref:null,ref:null,topic:b,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(i){var o;return i instanceof ArrayBuffer||((o=i==null?void 0:i.constructor)===null||o===void 0?void 0:o.name)==="ArrayBuffer"}_pick(i,o){return!i||typeof i!="object"?{}:Object.fromEntries(Object.entries(i).filter(([n])=>o.includes(n)))}}class Wd{constructor(i,o){this.callback=i,this.timerCalc=o,this.timer=void 0,this.tries=0,this.callback=i,this.timerCalc=o}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ft;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ft||(Ft={}));const hl=(t,i,o={})=>{var n;const a=(n=o.skipTypes)!==null&&n!==void 0?n:[];return i?Object.keys(i).reduce((r,s)=>(r[s]=Ip(s,t,i,a),r),{}):{}},Ip=(t,i,o,n)=>{const a=i.find(g=>g.name===t),r=a==null?void 0:a.type,s=o[t];return r&&!n.includes(r)?Nd(r,s):Bs(s)},Nd=(t,i)=>{if(t.charAt(0)==="_"){const o=t.slice(1,t.length);return Dp(i,o)}switch(t){case Ft.bool:return Rp(i);case Ft.float4:case Ft.float8:case Ft.int2:case Ft.int4:case Ft.int8:case Ft.numeric:case Ft.oid:return _p(i);case Ft.json:case Ft.jsonb:return Mp(i);case Ft.timestamp:return $p(i);case Ft.abstime:case Ft.date:case Ft.daterange:case Ft.int4range:case Ft.int8range:case Ft.money:case Ft.reltime:case Ft.text:case Ft.time:case Ft.timestamptz:case Ft.timetz:case Ft.tsrange:case Ft.tstzrange:return Bs(i);default:return Bs(i)}},Bs=t=>t,Rp=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},_p=t=>{if(typeof t=="string"){const i=parseFloat(t);if(!Number.isNaN(i))return i}return t},Mp=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},Dp=(t,i)=>{if(typeof t!="string")return t;const o=t.length-1,n=t[o];if(t[0]==="{"&&n==="}"){let r;const s=t.slice(1,o);try{r=JSON.parse("["+s+"]")}catch{r=s?s.split(","):[]}return r.map(g=>Nd(i,g))}return t},$p=t=>typeof t=="string"?t.replace(" ","T"):t,Ud=t=>{const i=new URL(t);return i.protocol=i.protocol.replace(/^ws/i,"http"),i.pathname=i.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),i.pathname===""||i.pathname==="/"?i.pathname="/api/broadcast":i.pathname=i.pathname+"/api/broadcast",i.href};class Oa{constructor(i,o,n={},a=Fs){this.channel=i,this.event=o,this.payload=n,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(i){this.timeout=i,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(i){this.payload=Object.assign(Object.assign({},this.payload),i)}receive(i,o){var n;return this._hasReceived(i)&&o((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:i,callback:o}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const i=o=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=o,this._matchReceive(o)};this.channel._on(this.refEvent,{},i),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(i,o){this.refEvent&&this.channel._trigger(this.refEvent,{status:i,response:o})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:i,response:o}){this.recHooks.filter(n=>n.status===i).forEach(n=>n.callback(o))}_hasReceived(i){return this.receivedResp&&this.receivedResp.status===i}}var fl;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(fl||(fl={}));class Qn{constructor(i,o){this.channel=i,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(o==null?void 0:o.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},a=>{const{onJoin:r,onLeave:s,onSync:g}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qn.syncState(this.state,a,r,s),this.pendingDiffs.forEach(h=>{this.state=Qn.syncDiff(this.state,h,r,s)}),this.pendingDiffs=[],g()}),this.channel._on(n.diff,{},a=>{const{onJoin:r,onLeave:s,onSync:g}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Qn.syncDiff(this.state,a,r,s),g())}),this.onJoin((a,r,s)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:r,newPresences:s})}),this.onLeave((a,r,s)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:r,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(i,o,n,a){const r=this.cloneDeep(i),s=this.transformState(o),g={},h={};return this.map(r,(b,j)=>{s[b]||(h[b]=j)}),this.map(s,(b,j)=>{const k=r[b];if(k){const v=j.map(d=>d.presence_ref),m=k.map(d=>d.presence_ref),f=j.filter(d=>m.indexOf(d.presence_ref)<0),p=k.filter(d=>v.indexOf(d.presence_ref)<0);f.length>0&&(g[b]=f),p.length>0&&(h[b]=p)}else g[b]=j}),this.syncDiff(r,{joins:g,leaves:h},n,a)}static syncDiff(i,o,n,a){const{joins:r,leaves:s}={joins:this.transformState(o.joins),leaves:this.transformState(o.leaves)};return n||(n=()=>{}),a||(a=()=>{}),this.map(r,(g,h)=>{var b;const j=(b=i[g])!==null&&b!==void 0?b:[];if(i[g]=this.cloneDeep(h),j.length>0){const k=i[g].map(m=>m.presence_ref),v=j.filter(m=>k.indexOf(m.presence_ref)<0);i[g].unshift(...v)}n(g,j,h)}),this.map(s,(g,h)=>{let b=i[g];if(!b)return;const j=h.map(k=>k.presence_ref);b=b.filter(k=>j.indexOf(k.presence_ref)<0),i[g]=b,a(g,b,h),b.length===0&&delete i[g]}),i}static map(i,o){return Object.getOwnPropertyNames(i).map(n=>o(n,i[n]))}static transformState(i){return i=this.cloneDeep(i),Object.getOwnPropertyNames(i).reduce((o,n)=>{const a=i[n];return"metas"in a?o[n]=a.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):o[n]=a,o},{})}static cloneDeep(i){return JSON.parse(JSON.stringify(i))}onJoin(i){this.caller.onJoin=i}onLeave(i){this.caller.onLeave=i}onSync(i){this.caller.onSync=i}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var xl;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(xl||(xl={}));var Zn;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Zn||(Zn={}));var eo;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(eo||(eo={}));class hn{constructor(i,o={config:{}},n){var a,r;if(this.topic=i,this.params=o,this.socket=n,this.bindings={},this.state=Nt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=i.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},o.config),this.timeout=this.socket.timeout,this.joinPush=new Oa(this,Ai.join,this.params,this.timeout),this.rejoinTimer=new Wd(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Nt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Nt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ai.reply,{},(s,g)=>{this._trigger(this._replyEventName(g),s)}),this.presence=new Qn(this),this.broadcastEndpointURL=Ud(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((r=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||r===void 0)&&r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(i,o=this.timeout){var n,a,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Nt.closed){const{config:{broadcast:s,presence:g,private:h}}=this.params,b=(a=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(m=>m.filter))!==null&&a!==void 0?a:[],j=!!this.bindings[Zn.PRESENCE]&&this.bindings[Zn.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,k={},v={broadcast:s,presence:Object.assign(Object.assign({},g),{enabled:j}),postgres_changes:b,private:h};this.socket.accessTokenValue&&(k.access_token=this.socket.accessTokenValue),this._onError(m=>i==null?void 0:i(eo.CHANNEL_ERROR,m)),this._onClose(()=>i==null?void 0:i(eo.CLOSED)),this.updateJoinPayload(Object.assign({config:v},k)),this.joinedOnce=!0,this._rejoin(o),this.joinPush.receive("ok",async({postgres_changes:m})=>{var f;if(this.socket._isManualToken()||this.socket.setAuth(),m===void 0){i==null||i(eo.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,d=(f=p==null?void 0:p.length)!==null&&f!==void 0?f:0,c=[];for(let l=0;l<d;l++){const x=p[l],{filter:{event:y,schema:u,table:S,filter:A}}=x,E=m&&m[l];if(E&&E.event===y&&hn.isFilterValueEqual(E.schema,u)&&hn.isFilterValueEqual(E.table,S)&&hn.isFilterValueEqual(E.filter,A))c.push(Object.assign(Object.assign({},x),{id:E.id}));else{this.unsubscribe(),this.state=Nt.errored,i==null||i(eo.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=c,i&&i(eo.SUBSCRIBED);return}}).receive("error",m=>{this.state=Nt.errored,i==null||i(eo.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{i==null||i(eo.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(i,o={}){return await this.send({type:"presence",event:"track",payload:i},o.timeout||this.timeout)}async untrack(i={}){return await this.send({type:"presence",event:"untrack"},i)}on(i,o,n){return this.state===Nt.joined&&i===Zn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(i,o,n)}async httpSend(i,o,n={}){var a;if(o==null)return Promise.reject("Payload is required for httpSend()");const r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const s={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})},g=await this._fetchWithTimeout(this.broadcastEndpointURL,s,(a=n.timeout)!==null&&a!==void 0?a:this.timeout);if(g.status===202)return{success:!0};let h=g.statusText;try{const b=await g.json();h=b.error||b.message||h}catch{}return Promise.reject(new Error(h))}async send(i,o={}){var n,a;if(!this._canPush()&&i.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:r,payload:s}=i,g={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(g.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:g,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:s,private:this.private}]})};try{const b=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(n=o.timeout)!==null&&n!==void 0?n:this.timeout);return await((a=b.body)===null||a===void 0?void 0:a.cancel()),b.ok?"ok":"error"}catch(b){return b.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var s,g,h;const b=this._push(i.type,i,o.timeout||this.timeout);i.type==="broadcast"&&!(!((h=(g=(s=this.params)===null||s===void 0?void 0:s.config)===null||g===void 0?void 0:g.broadcast)===null||h===void 0)&&h.ack)&&r("ok"),b.receive("ok",()=>r("ok")),b.receive("error",()=>r("error")),b.receive("timeout",()=>r("timed out"))})}updateJoinPayload(i){this.joinPush.updatePayload(i)}unsubscribe(i=this.timeout){this.state=Nt.leaving;const o=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ai.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(a=>{n=new Oa(this,Ai.leave,{},i),n.receive("ok",()=>{o(),a("ok")}).receive("timeout",()=>{o(),a("timed out")}).receive("error",()=>{a("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(i=>i.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Nt.closed,this.bindings={}}async _fetchWithTimeout(i,o,n){const a=new AbortController,r=setTimeout(()=>a.abort(),n),s=await this.socket.fetch(i,Object.assign(Object.assign({},o),{signal:a.signal}));return clearTimeout(r),s}_push(i,o,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${i}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Oa(this,i,o,n);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(i){if(i.startTimeout(),this.pushBuffer.push(i),this.pushBuffer.length>Tp){const o=this.pushBuffer.shift();o&&(o.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${o.event}`,o.payload))}}_onMessage(i,o,n){return o}_isMember(i){return this.topic===i}_joinRef(){return this.joinPush.ref}_trigger(i,o,n){var a,r;const s=i.toLocaleLowerCase(),{close:g,error:h,leave:b,join:j}=Ai;if(n&&[g,h,b,j].indexOf(s)>=0&&n!==this._joinRef())return;let v=this._onMessage(s,o,n);if(o&&!v)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(m=>{var f,p,d;return((f=m.filter)===null||f===void 0?void 0:f.event)==="*"||((d=(p=m.filter)===null||p===void 0?void 0:p.event)===null||d===void 0?void 0:d.toLocaleLowerCase())===s}).map(m=>m.callback(v,n)):(r=this.bindings[s])===null||r===void 0||r.filter(m=>{var f,p,d,c,l,x;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in m){const y=m.id,u=(f=m.filter)===null||f===void 0?void 0:f.event;return y&&((p=o.ids)===null||p===void 0?void 0:p.includes(y))&&(u==="*"||(u==null?void 0:u.toLocaleLowerCase())===((d=o.data)===null||d===void 0?void 0:d.type.toLocaleLowerCase()))}else{const y=(l=(c=m==null?void 0:m.filter)===null||c===void 0?void 0:c.event)===null||l===void 0?void 0:l.toLocaleLowerCase();return y==="*"||y===((x=o==null?void 0:o.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===s}).map(m=>{if(typeof v=="object"&&"ids"in v){const f=v.data,{schema:p,table:d,commit_timestamp:c,type:l,errors:x}=f;v=Object.assign(Object.assign({},{schema:p,table:d,commit_timestamp:c,eventType:l,new:{},old:{},errors:x}),this._getPayloadRecords(f))}m.callback(v,n)})}_isClosed(){return this.state===Nt.closed}_isJoined(){return this.state===Nt.joined}_isJoining(){return this.state===Nt.joining}_isLeaving(){return this.state===Nt.leaving}_replyEventName(i){return`chan_reply_${i}`}_on(i,o,n){const a=i.toLocaleLowerCase(),r={type:a,filter:o,callback:n};return this.bindings[a]?this.bindings[a].push(r):this.bindings[a]=[r],this}_off(i,o){const n=i.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(a=>{var r;return!(((r=a.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&hn.isEqual(a.filter,o))})),this}static isEqual(i,o){if(Object.keys(i).length!==Object.keys(o).length)return!1;for(const n in i)if(i[n]!==o[n])return!1;return!0}static isFilterValueEqual(i,o){return(i??void 0)===(o??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(i){this._on(Ai.close,{},i)}_onError(i){this._on(Ai.error,{},o=>i(o))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(i=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Nt.joining,this.joinPush.resend(i))}_getPayloadRecords(i){const o={new:{},old:{}};return(i.type==="INSERT"||i.type==="UPDATE")&&(o.new=hl(i.columns,i.record)),(i.type==="UPDATE"||i.type==="DELETE")&&(o.old=hl(i.columns,i.old_record)),o}}const La=()=>{},Ir={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Pp=[1e3,2e3,5e3,1e4],Op=1e4,Lp=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Wp{constructor(i,o){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Fs,this.transport=null,this.heartbeatIntervalMs=Ir.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=La,this.ref=0,this.reconnectTimer=null,this.vsn=ul,this.logger=La,this.conn=null,this.sendBuffer=[],this.serializer=new Bp,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=a=>a?(...r)=>a(...r):(...r)=>fetch(...r),!(!((n=o==null?void 0:o.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=o.params.apikey,this.endPoint=`${i}/${Ts.websocket}`,this.httpEndpoint=Ud(i),this._initializeOptions(o),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(o==null?void 0:o.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=wp.createWebSocket(this.endpointURL())}catch(i){this._setConnectionState("disconnected");const o=i.message;throw o.includes("Node.js")?new Error(`${o}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${o}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(i,o){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(i?this.conn.close(i,o??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(i){const o=await i.unsubscribe();return this.channels.length===0&&this.disconnect(),o}async removeAllChannels(){const i=await Promise.all(this.channels.map(o=>o.unsubscribe()));return this.channels=[],this.disconnect(),i}log(i,o,n){this.logger(i,o,n)}connectionState(){switch(this.conn&&this.conn.readyState){case yo.connecting:return Oo.Connecting;case yo.open:return Oo.Open;case yo.closing:return Oo.Closing;default:return Oo.Closed}}isConnected(){return this.connectionState()===Oo.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(i,o={config:{}}){const n=`realtime:${i}`,a=this.getChannels().find(r=>r.topic===n);if(a)return a;{const r=new hn(`realtime:${i}`,o,this);return this.channels.push(r),r}}push(i){const{topic:o,event:n,payload:a,ref:r}=i,s=()=>{this.encode(i,g=>{var h;(h=this.conn)===null||h===void 0||h.send(g)})};this.log("push",`${o} ${n} (${r})`,a),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(i=null){this._authPromise=this._performAuth(i);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var i;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(o){this.log("error","error in heartbeat callback",o)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(o){this.log("error","error in heartbeat callback",o)}this._wasManualDisconnect=!1,(i=this.conn)===null||i===void 0||i.close(Fp,"heartbeat timeout"),setTimeout(()=>{var o;this.isConnected()||(o=this.reconnectTimer)===null||o===void 0||o.scheduleTimeout()},Ir.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(o){this.log("error","error in heartbeat callback",o)}this._setAuthSafely("heartbeat")}onHeartbeat(i){this.heartbeatCallback=i}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(i=>i()),this.sendBuffer=[])}_makeRef(){let i=this.ref+1;return i===this.ref?this.ref=0:this.ref=i,this.ref.toString()}_leaveOpenTopic(i){let o=this.channels.find(n=>n.topic===i&&(n._isJoined()||n._isJoining()));o&&(this.log("transport",`leaving duplicate topic "${i}"`),o.unsubscribe())}_remove(i){this.channels=this.channels.filter(o=>o.topic!==i.topic)}_onConnMessage(i){this.decode(i.data,o=>{if(o.topic==="phoenix"&&o.event==="phx_reply"&&o.ref&&o.ref===this.pendingHeartbeatRef){const b=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(o.payload.status==="ok"?"ok":"error",b)}catch(j){this.log("error","error in heartbeat callback",j)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:a,payload:r,ref:s}=o,g=s?`(${s})`:"",h=r.status||"";this.log("receive",`${h} ${n} ${a} ${g}`.trim(),r),this.channels.filter(b=>b._isMember(n)).forEach(b=>b._trigger(a,r,s)),this._triggerStateCallbacks("message",o)})}_clearTimer(i){var o;i==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):i==="reconnect"&&((o=this.reconnectTimer)===null||o===void 0||o.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=i=>this._onConnError(i),this.conn.onmessage=i=>this._onConnMessage(i),this.conn.onclose=i=>this._onConnClose(i),this.conn.readyState===yo.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===yo.open||this.conn.readyState===yo.connecting)try{this.conn.close()}catch(i){this.log("error","Error closing connection",i)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(i=>i.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(o=>{this.log("error","error waiting for auth on connect",o),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const i=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(i),this.workerRef.onerror=o=>{this.log("worker","worker error",o.message),this._terminateWorker()},this.workerRef.onmessage=o=>{o.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(i){var o;this._setConnectionState("disconnected"),this.log("transport","close",i),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(o=this.reconnectTimer)===null||o===void 0||o.scheduleTimeout(),this._triggerStateCallbacks("close",i)}_onConnError(i){this._setConnectionState("disconnected"),this.log("transport",`${i}`),this._triggerChanError(),this._triggerStateCallbacks("error",i);try{this.heartbeatCallback("error")}catch(o){this.log("error","error in heartbeat callback",o)}}_triggerChanError(){this.channels.forEach(i=>i._trigger(Ai.error))}_appendParams(i,o){if(Object.keys(o).length===0)return i;const n=i.match(/\?/)?"&":"?",a=new URLSearchParams(o);return`${i}${n}${a}`}_workerObjectUrl(i){let o;if(i)o=i;else{const n=new Blob([Lp],{type:"application/javascript"});o=URL.createObjectURL(n)}return o}_setConnectionState(i,o=!1){this._connectionState=i,i==="connecting"?this._wasManualDisconnect=!1:i==="disconnecting"&&(this._wasManualDisconnect=o)}async _performAuth(i=null){let o,n=!1;if(i)o=i,n=!0;else if(this.accessToken)try{o=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),o=this.accessTokenValue}else o=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=o&&(this.accessTokenValue=o,this.channels.forEach(a=>{const r={access_token:o,version:Ep};o&&a.updateJoinPayload(r),a.joinedOnce&&a._isJoined()&&a._push(Ai.access_token,{access_token:o})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(i="general"){this._isManualToken()||this.setAuth().catch(o=>{this.log("error",`Error setting auth in ${i}`,o)})}_triggerStateCallbacks(i,o){try{this.stateChangeCallbacks[i].forEach(n=>{try{n(o)}catch(a){this.log("error",`error in ${i} callback`,a)}})}catch(n){this.log("error",`error triggering ${i} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Wd(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ir.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(i){var o,n,a,r,s,g,h,b,j,k,v,m;switch(this.transport=(o=i==null?void 0:i.transport)!==null&&o!==void 0?o:null,this.timeout=(n=i==null?void 0:i.timeout)!==null&&n!==void 0?n:Fs,this.heartbeatIntervalMs=(a=i==null?void 0:i.heartbeatIntervalMs)!==null&&a!==void 0?a:Ir.HEARTBEAT_INTERVAL,this.worker=(r=i==null?void 0:i.worker)!==null&&r!==void 0?r:!1,this.accessToken=(s=i==null?void 0:i.accessToken)!==null&&s!==void 0?s:null,this.heartbeatCallback=(g=i==null?void 0:i.heartbeatCallback)!==null&&g!==void 0?g:La,this.vsn=(h=i==null?void 0:i.vsn)!==null&&h!==void 0?h:ul,i!=null&&i.params&&(this.params=i.params),i!=null&&i.logger&&(this.logger=i.logger),(i!=null&&i.logLevel||i!=null&&i.log_level)&&(this.logLevel=i.logLevel||i.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(b=i==null?void 0:i.reconnectAfterMs)!==null&&b!==void 0?b:f=>Pp[f-1]||Op,this.vsn){case Ap:this.encode=(j=i==null?void 0:i.encode)!==null&&j!==void 0?j:(f,p)=>p(JSON.stringify(f)),this.decode=(k=i==null?void 0:i.decode)!==null&&k!==void 0?k:(f,p)=>p(JSON.parse(f));break;case Ld:this.encode=(v=i==null?void 0:i.encode)!==null&&v!==void 0?v:this.serializer.encode.bind(this.serializer),this.decode=(m=i==null?void 0:i.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=i==null?void 0:i.workerUrl}}}var cr=class extends Error{constructor(t,i){var o;super(t),this.name="IcebergError",this.status=i.status,this.icebergType=i.icebergType,this.icebergCode=i.icebergCode,this.details=i.details,this.isCommitStateUnknown=i.icebergType==="CommitStateUnknownException"||[500,502,504].includes(i.status)&&((o=i.icebergType)==null?void 0:o.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Np(t,i,o){const n=new URL(i,t);if(o)for(const[a,r]of Object.entries(o))r!==void 0&&n.searchParams.set(a,r);return n.toString()}async function Up(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function Vp(t){const i=t.fetchImpl??globalThis.fetch;return{async request({method:o,path:n,query:a,body:r,headers:s}){const g=Np(t.baseUrl,n,a),h=await Up(t.auth),b=await i(g,{method:o,headers:{...r?{"Content-Type":"application/json"}:{},...h,...s},body:r?JSON.stringify(r):void 0}),j=await b.text(),k=(b.headers.get("content-type")||"").includes("application/json"),v=k&&j?JSON.parse(j):j;if(!b.ok){const m=k?v:void 0,f=m==null?void 0:m.error;throw new cr((f==null?void 0:f.message)??`Request failed with status ${b.status}`,{status:b.status,icebergType:f==null?void 0:f.type,icebergCode:f==null?void 0:f.code,details:m})}return{status:b.status,headers:b.headers,data:v}}}}function Rr(t){return t.join("")}var qp=class{constructor(t,i=""){this.client=t,this.prefix=i}async listNamespaces(t){const i=t?{parent:Rr(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:i})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(t,i){const o={namespace:t.namespace,properties:i==null?void 0:i.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:o})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Rr(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Rr(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Rr(t.namespace)}`}),!0}catch(i){if(i instanceof cr&&i.status===404)return!1;throw i}}async createNamespaceIfNotExists(t,i){try{return await this.createNamespace(t,i)}catch(o){if(o instanceof cr&&o.status===409)return;throw o}}};function Ko(t){return t.join("")}var Hp=class{constructor(t,i="",o){this.client=t,this.prefix=i,this.accessDelegation=o}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ko(t.namespace)}/tables`})).data.identifiers}async createTable(t,i){const o={};return this.accessDelegation&&(o["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ko(t.namespace)}/tables`,body:i,headers:o})).data.metadata}async updateTable(t,i){const o=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ko(t.namespace)}/tables/${t.name}`,body:i});return{"metadata-location":o.data["metadata-location"],metadata:o.data.metadata}}async dropTable(t,i){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ko(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((i==null?void 0:i.purge)??!1)}})}async loadTable(t){const i={};return this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ko(t.namespace)}/tables/${t.name}`,headers:i})).data.metadata}async tableExists(t){const i={};this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ko(t.namespace)}/tables/${t.name}`,headers:i}),!0}catch(o){if(o instanceof cr&&o.status===404)return!1;throw o}}async createTableIfNotExists(t,i){try{return await this.createTable(t,i)}catch(o){if(o instanceof cr&&o.status===409)return await this.loadTable({namespace:t.namespace,name:i.name});throw o}}},Gp=class{constructor(t){var n;let i="v1";t.catalogName&&(i+=`/${t.catalogName}`);const o=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=Vp({baseUrl:o,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(n=t.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new qp(this.client,i),this.tableOps=new Hp(this.client,i,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,i){return this.namespaceOps.createNamespace(t,i)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,i){return this.tableOps.createTable(t,i)}async updateTable(t,i){return this.tableOps.updateTable(t,i)}async dropTable(t,i){await this.tableOps.dropTable(t,i)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,i){return this.namespaceOps.createNamespaceIfNotExists(t,i)}async createTableIfNotExists(t,i){return this.tableOps.createTableIfNotExists(t,i)}},_a=class extends Error{constructor(t,i="storage",o,n){super(t),this.__isStorageError=!0,this.namespace=i,this.name=i==="vectors"?"StorageVectorsError":"StorageError",this.status=o,this.statusCode=n}};function Ma(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var _r=class extends _a{constructor(t,i,o,n="storage"){super(t,n,i,o),this.name=n==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=i,this.statusCode=o}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Vd=class extends _a{constructor(t,i,o="storage"){super(t,o),this.name=o==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=i}};const Kp=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),Jp=t=>{if(typeof t!="object"||t===null)return!1;const i=Object.getPrototypeOf(t);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Is=t=>{if(Array.isArray(t))return t.map(o=>Is(o));if(typeof t=="function"||t!==Object(t))return t;const i={};return Object.entries(t).forEach(([o,n])=>{const a=o.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));i[a]=Is(n)}),i},Yp=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function pr(t){"@babel/helpers - typeof";return pr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},pr(t)}function Xp(t,i){if(pr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(pr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function Qp(t){var i=Xp(t,"string");return pr(i)=="symbol"?i:i+""}function Zp(t,i,o){return(i=Qp(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function ml(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),o.push.apply(o,n)}return o}function st(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?ml(Object(o),!0).forEach(function(n){Zp(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ml(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}const bl=t=>{var i;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(i=t.error)===null||i===void 0?void 0:i.message)||JSON.stringify(t)},eg=async(t,i,o,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(o!=null&&o.noResolveJson)){const a=t,r=a.status||500;if(typeof a.json=="function")a.json().then(s=>{const g=(s==null?void 0:s.statusCode)||(s==null?void 0:s.code)||r+"";i(new _r(bl(s),r,g,n))}).catch(()=>{if(n==="vectors"){const s=r+"";i(new _r(a.statusText||`HTTP ${r} error`,r,s,n))}else{const s=r+"";i(new _r(a.statusText||`HTTP ${r} error`,r,s,n))}});else{const s=r+"";i(new _r(a.statusText||`HTTP ${r} error`,r,s,n))}}else i(new Vd(bl(t),t,n))},tg=(t,i,o,n)=>{const a={method:t,headers:(i==null?void 0:i.headers)||{}};return t==="GET"||t==="HEAD"||!n?st(st({},a),o):(Jp(n)?(a.headers=st({"Content-Type":"application/json"},i==null?void 0:i.headers),a.body=JSON.stringify(n)):a.body=n,i!=null&&i.duplex&&(a.duplex=i.duplex),st(st({},a),o))};async function Dn(t,i,o,n,a,r,s){return new Promise((g,h)=>{t(o,tg(i,n,a,r)).then(b=>{if(!b.ok)throw b;if(n!=null&&n.noResolveJson)return b;if(s==="vectors"){const j=b.headers.get("content-type");if(b.headers.get("content-length")==="0"||b.status===204)return{};if(!j||!j.includes("application/json"))return{}}return b.json()}).then(b=>g(b)).catch(b=>eg(b,h,n,s))})}function qd(t="storage"){return{get:async(i,o,n,a)=>Dn(i,"GET",o,n,a,void 0,t),post:async(i,o,n,a,r)=>Dn(i,"POST",o,a,r,n,t),put:async(i,o,n,a,r)=>Dn(i,"PUT",o,a,r,n,t),head:async(i,o,n,a)=>Dn(i,"HEAD",o,st(st({},n),{},{noResolveJson:!0}),a,void 0,t),remove:async(i,o,n,a,r)=>Dn(i,"DELETE",o,a,r,n,t)}}const ig=qd("storage"),{get:gr,post:Ei,put:Rs,head:og,remove:Qs}=ig,hi=qd("vectors");var In=class{constructor(t,i={},o,n="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=i,this.fetch=Kp(o),this.namespace=n}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,i){return this.headers=st(st({},this.headers),{},{[t]:i}),this}async handleOperation(t){var i=this;try{return{data:await t(),error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(Ma(o))return{data:null,error:o};throw o}}},ng=class{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i}then(t,i){return this.execute().then(t,i)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Ma(i))return{data:null,error:i};throw i}}};let Hd;Hd=Symbol.toStringTag;var rg=class{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i,this[Hd]="BlobDownloadBuilder",this.promise=null}asStream(){return new ng(this.downloadFn,this.shouldThrowOnError)}then(t,i){return this.getPromise().then(t,i)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Ma(i))return{data:null,error:i};throw i}}};const ag={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},yl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var sg=class extends In{constructor(t,i={},o,n){super(t,i,n,"storage"),this.bucketId=o}async uploadOrUpdate(t,i,o,n){var a=this;return a.handleOperation(async()=>{let r;const s=st(st({},yl),n);let g=st(st({},a.headers),t==="POST"&&{"x-upsert":String(s.upsert)});const h=s.metadata;typeof Blob<"u"&&o instanceof Blob?(r=new FormData,r.append("cacheControl",s.cacheControl),h&&r.append("metadata",a.encodeMetadata(h)),r.append("",o)):typeof FormData<"u"&&o instanceof FormData?(r=o,r.has("cacheControl")||r.append("cacheControl",s.cacheControl),h&&!r.has("metadata")&&r.append("metadata",a.encodeMetadata(h))):(r=o,g["cache-control"]=`max-age=${s.cacheControl}`,g["content-type"]=s.contentType,h&&(g["x-metadata"]=a.toBase64(a.encodeMetadata(h))),(typeof ReadableStream<"u"&&r instanceof ReadableStream||r&&typeof r=="object"&&"pipe"in r&&typeof r.pipe=="function")&&!s.duplex&&(s.duplex="half")),n!=null&&n.headers&&(g=st(st({},g),n.headers));const b=a._removeEmptyFolders(i),j=a._getFinalPath(b),k=await(t=="PUT"?Rs:Ei)(a.fetch,`${a.url}/object/${j}`,r,st({headers:g},s!=null&&s.duplex?{duplex:s.duplex}:{}));return{path:b,id:k.Id,fullPath:k.Key}})}async upload(t,i,o){return this.uploadOrUpdate("POST",t,i,o)}async uploadToSignedUrl(t,i,o,n){var a=this;const r=a._removeEmptyFolders(t),s=a._getFinalPath(r),g=new URL(a.url+`/object/upload/sign/${s}`);return g.searchParams.set("token",i),a.handleOperation(async()=>{let h;const b=st({upsert:yl.upsert},n),j=st(st({},a.headers),{"x-upsert":String(b.upsert)});return typeof Blob<"u"&&o instanceof Blob?(h=new FormData,h.append("cacheControl",b.cacheControl),h.append("",o)):typeof FormData<"u"&&o instanceof FormData?(h=o,h.append("cacheControl",b.cacheControl)):(h=o,j["cache-control"]=`max-age=${b.cacheControl}`,j["content-type"]=b.contentType),{path:r,fullPath:(await Rs(a.fetch,g.toString(),h,{headers:j})).Key}})}async createSignedUploadUrl(t,i){var o=this;return o.handleOperation(async()=>{let n=o._getFinalPath(t);const a=st({},o.headers);i!=null&&i.upsert&&(a["x-upsert"]="true");const r=await Ei(o.fetch,`${o.url}/object/upload/sign/${n}`,{},{headers:a}),s=new URL(o.url+r.url),g=s.searchParams.get("token");if(!g)throw new _a("No token returned by API");return{signedUrl:s.toString(),path:t,token:g}})}async update(t,i,o){return this.uploadOrUpdate("PUT",t,i,o)}async move(t,i,o){var n=this;return n.handleOperation(async()=>await Ei(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:t,destinationKey:i,destinationBucket:o==null?void 0:o.destinationBucket},{headers:n.headers}))}async copy(t,i,o){var n=this;return n.handleOperation(async()=>({path:(await Ei(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:t,destinationKey:i,destinationBucket:o==null?void 0:o.destinationBucket},{headers:n.headers})).Key}))}async createSignedUrl(t,i,o){var n=this;return n.handleOperation(async()=>{let a=n._getFinalPath(t),r=await Ei(n.fetch,`${n.url}/object/sign/${a}`,st({expiresIn:i},o!=null&&o.transform?{transform:o.transform}:{}),{headers:n.headers});const s=o!=null&&o.download?`&download=${o.download===!0?"":o.download}`:"";return{signedUrl:encodeURI(`${n.url}${r.signedURL}${s}`)}})}async createSignedUrls(t,i,o){var n=this;return n.handleOperation(async()=>{const a=await Ei(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:i,paths:t},{headers:n.headers}),r=o!=null&&o.download?`&download=${o.download===!0?"":o.download}`:"";return a.map(s=>st(st({},s),{},{signedUrl:s.signedURL?encodeURI(`${n.url}${s.signedURL}${r}`):null}))})}download(t,i,o){const n=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),r=a?`?${a}`:"",s=this._getFinalPath(t),g=()=>gr(this.fetch,`${this.url}/${n}/${s}${r}`,{headers:this.headers,noResolveJson:!0},o);return new rg(g,this.shouldThrowOnError)}async info(t){var i=this;const o=i._getFinalPath(t);return i.handleOperation(async()=>Is(await gr(i.fetch,`${i.url}/object/info/${o}`,{headers:i.headers})))}async exists(t){var i=this;const o=i._getFinalPath(t);try{return await og(i.fetch,`${i.url}/object/${o}`,{headers:i.headers}),{data:!0,error:null}}catch(n){if(i.shouldThrowOnError)throw n;if(Ma(n)&&n instanceof Vd){const a=n.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:n}}throw n}}getPublicUrl(t,i){const o=this._getFinalPath(t),n=[],a=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";a!==""&&n.push(a);const r=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",s=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});s!==""&&n.push(s);let g=n.join("&");return g!==""&&(g=`?${g}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${o}${g}`)}}}async remove(t){var i=this;return i.handleOperation(async()=>await Qs(i.fetch,`${i.url}/object/${i.bucketId}`,{prefixes:t},{headers:i.headers}))}async list(t,i,o){var n=this;return n.handleOperation(async()=>{const a=st(st(st({},ag),i),{},{prefix:t||""});return await Ei(n.fetch,`${n.url}/object/list/${n.bucketId}`,a,{headers:n.headers},o)})}async listV2(t,i){var o=this;return o.handleOperation(async()=>{const n=st({},t);return await Ei(o.fetch,`${o.url}/object/list-v2/${o.bucketId}`,n,{headers:o.headers},i)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const i=[];return t.width&&i.push(`width=${t.width}`),t.height&&i.push(`height=${t.height}`),t.resize&&i.push(`resize=${t.resize}`),t.format&&i.push(`format=${t.format}`),t.quality&&i.push(`quality=${t.quality}`),i.join("&")}};const lg="2.97.0",Cr={"X-Client-Info":`storage-js/${lg}`};var dg=class extends In{constructor(t,i={},o,n){const a=new URL(t);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase."));const r=a.href.replace(/\/$/,""),s=st(st({},Cr),i);super(r,s,o,"storage")}async listBuckets(t){var i=this;return i.handleOperation(async()=>{const o=i.listBucketOptionsToQueryString(t);return await gr(i.fetch,`${i.url}/bucket${o}`,{headers:i.headers})})}async getBucket(t){var i=this;return i.handleOperation(async()=>await gr(i.fetch,`${i.url}/bucket/${t}`,{headers:i.headers}))}async createBucket(t,i={public:!1}){var o=this;return o.handleOperation(async()=>await Ei(o.fetch,`${o.url}/bucket`,{id:t,name:t,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:o.headers}))}async updateBucket(t,i){var o=this;return o.handleOperation(async()=>await Rs(o.fetch,`${o.url}/bucket/${t}`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:o.headers}))}async emptyBucket(t){var i=this;return i.handleOperation(async()=>await Ei(i.fetch,`${i.url}/bucket/${t}/empty`,{},{headers:i.headers}))}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await Qs(i.fetch,`${i.url}/bucket/${t}`,{},{headers:i.headers}))}listBucketOptionsToQueryString(t){const i={};return t&&("limit"in t&&(i.limit=String(t.limit)),"offset"in t&&(i.offset=String(t.offset)),t.search&&(i.search=t.search),t.sortColumn&&(i.sortColumn=t.sortColumn),t.sortOrder&&(i.sortOrder=t.sortOrder)),Object.keys(i).length>0?"?"+new URLSearchParams(i).toString():""}},cg=class extends In{constructor(t,i={},o){const n=t.replace(/\/$/,""),a=st(st({},Cr),i);super(n,a,o,"storage")}async createBucket(t){var i=this;return i.handleOperation(async()=>await Ei(i.fetch,`${i.url}/bucket`,{name:t},{headers:i.headers}))}async listBuckets(t){var i=this;return i.handleOperation(async()=>{const o=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&o.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&o.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&o.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&o.set("sortOrder",t.sortOrder),t!=null&&t.search&&o.set("search",t.search);const n=o.toString(),a=n?`${i.url}/bucket?${n}`:`${i.url}/bucket`;return await gr(i.fetch,a,{headers:i.headers})})}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await Qs(i.fetch,`${i.url}/bucket/${t}`,{},{headers:i.headers}))}from(t){var i=this;if(!Yp(t))throw new _a("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const o=new Gp({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>i.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(o,{get(a,r){const s=a[r];return typeof s!="function"?s:async(...g)=>{try{return{data:await s.apply(a,g),error:null}}catch(h){if(n)throw h;return{data:null,error:h}}}}})}},pg=class extends In{constructor(t,i={},o){const n=t.replace(/\/$/,""),a=st(st({},Cr),{},{"Content-Type":"application/json"},i);super(n,a,o,"vectors")}async createIndex(t){var i=this;return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/CreateIndex`,t,{headers:i.headers})||{})}async getIndex(t,i){var o=this;return o.handleOperation(async()=>await hi.post(o.fetch,`${o.url}/GetIndex`,{vectorBucketName:t,indexName:i},{headers:o.headers}))}async listIndexes(t){var i=this;return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/ListIndexes`,t,{headers:i.headers}))}async deleteIndex(t,i){var o=this;return o.handleOperation(async()=>await hi.post(o.fetch,`${o.url}/DeleteIndex`,{vectorBucketName:t,indexName:i},{headers:o.headers})||{})}},gg=class extends In{constructor(t,i={},o){const n=t.replace(/\/$/,""),a=st(st({},Cr),{},{"Content-Type":"application/json"},i);super(n,a,o,"vectors")}async putVectors(t){var i=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/PutVectors`,t,{headers:i.headers})||{})}async getVectors(t){var i=this;return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/GetVectors`,t,{headers:i.headers}))}async listVectors(t){var i=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/ListVectors`,t,{headers:i.headers}))}async queryVectors(t){var i=this;return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/QueryVectors`,t,{headers:i.headers}))}async deleteVectors(t){var i=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/DeleteVectors`,t,{headers:i.headers})||{})}},ug=class extends In{constructor(t,i={},o){const n=t.replace(/\/$/,""),a=st(st({},Cr),{},{"Content-Type":"application/json"},i);super(n,a,o,"vectors")}async createBucket(t){var i=this;return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:i.headers})||{})}async getBucket(t){var i=this;return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/GetVectorBucket`,{vectorBucketName:t},{headers:i.headers}))}async listBuckets(t={}){var i=this;return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/ListVectorBuckets`,t,{headers:i.headers}))}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await hi.post(i.fetch,`${i.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:i.headers})||{})}},hg=class extends ug{constructor(t,i={}){super(t,i.headers||{},i.fetch)}from(t){return new fg(this.url,this.headers,t,this.fetch)}async createBucket(t){var i=()=>super.createBucket,o=this;return i().call(o,t)}async getBucket(t){var i=()=>super.getBucket,o=this;return i().call(o,t)}async listBuckets(t={}){var i=()=>super.listBuckets,o=this;return i().call(o,t)}async deleteBucket(t){var i=()=>super.deleteBucket,o=this;return i().call(o,t)}},fg=class extends pg{constructor(t,i,o,n){super(t,i,n),this.vectorBucketName=o}async createIndex(t){var i=()=>super.createIndex,o=this;return i().call(o,st(st({},t),{},{vectorBucketName:o.vectorBucketName}))}async listIndexes(t={}){var i=()=>super.listIndexes,o=this;return i().call(o,st(st({},t),{},{vectorBucketName:o.vectorBucketName}))}async getIndex(t){var i=()=>super.getIndex,o=this;return i().call(o,o.vectorBucketName,t)}async deleteIndex(t){var i=()=>super.deleteIndex,o=this;return i().call(o,o.vectorBucketName,t)}index(t){return new xg(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},xg=class extends gg{constructor(t,i,o,n,a){super(t,i,a),this.vectorBucketName=o,this.indexName=n}async putVectors(t){var i=()=>super.putVectors,o=this;return i().call(o,st(st({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async getVectors(t){var i=()=>super.getVectors,o=this;return i().call(o,st(st({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async listVectors(t={}){var i=()=>super.listVectors,o=this;return i().call(o,st(st({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async queryVectors(t){var i=()=>super.queryVectors,o=this;return i().call(o,st(st({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async deleteVectors(t){var i=()=>super.deleteVectors,o=this;return i().call(o,st(st({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}},mg=class extends dg{constructor(t,i={},o,n){super(t,i,o,n)}from(t){return new sg(this.url,this.headers,t,this.fetch)}get vectors(){return new hg(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new cg(this.url+"/iceberg",this.headers,this.fetch)}};const Gd="2.97.0",pn=30*1e3,_s=3,Wa=_s*pn,bg="http://localhost:9999",yg="supabase.auth.token",vg={"X-Client-Info":`gotrue-js/${Gd}`},Ms="X-Supabase-Api-Version",Kd={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},jg=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Sg=10*60*1e3;class ur extends Error{constructor(i,o,n){super(i),this.__isAuthError=!0,this.name="AuthError",this.status=o,this.code=n}}function Xe(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Cg extends ur{constructor(i,o,n){super(i,o,n),this.name="AuthApiError",this.status=o,this.code=n}}function kg(t){return Xe(t)&&t.name==="AuthApiError"}class Lo extends ur{constructor(i,o){super(i),this.name="AuthUnknownError",this.originalError=o}}class po extends ur{constructor(i,o,n,a){super(i,n,a),this.name=o,this.status=n}}class gi extends po{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Na(t){return Xe(t)&&t.name==="AuthSessionMissingError"}class Jo extends po{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mr extends po{constructor(i){super(i,"AuthInvalidCredentialsError",400,void 0)}}class Dr extends po{constructor(i,o=null){super(i,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function wg(t){return Xe(t)&&t.name==="AuthImplicitGrantRedirectError"}class vl extends po{constructor(i,o=null){super(i,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class zg extends po{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Ds extends po{constructor(i,o){super(i,"AuthRetryableFetchError",o,void 0)}}function Ua(t){return Xe(t)&&t.name==="AuthRetryableFetchError"}class jl extends po{constructor(i,o,n){super(i,"AuthWeakPasswordError",o,"weak_password"),this.reasons=n}}class $s extends po{constructor(i){super(i,"AuthInvalidJwtError",400,"invalid_jwt")}}const ma="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Sl=` 	
\r=`.split(""),Eg=(()=>{const t=new Array(128);for(let i=0;i<t.length;i+=1)t[i]=-1;for(let i=0;i<Sl.length;i+=1)t[Sl[i].charCodeAt(0)]=-2;for(let i=0;i<ma.length;i+=1)t[ma[i].charCodeAt(0)]=i;return t})();function Cl(t,i,o){if(t!==null)for(i.queue=i.queue<<8|t,i.queuedBits+=8;i.queuedBits>=6;){const n=i.queue>>i.queuedBits-6&63;o(ma[n]),i.queuedBits-=6}else if(i.queuedBits>0)for(i.queue=i.queue<<6-i.queuedBits,i.queuedBits=6;i.queuedBits>=6;){const n=i.queue>>i.queuedBits-6&63;o(ma[n]),i.queuedBits-=6}}function Jd(t,i,o){const n=Eg[t];if(n>-1)for(i.queue=i.queue<<6|n,i.queuedBits+=6;i.queuedBits>=8;)o(i.queue>>i.queuedBits-8&255),i.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function kl(t){const i=[],o=s=>{i.push(String.fromCodePoint(s))},n={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},r=s=>{Tg(s,n,o)};for(let s=0;s<t.length;s+=1)Jd(t.charCodeAt(s),a,r);return i.join("")}function Ag(t,i){if(t<=127){i(t);return}else if(t<=2047){i(192|t>>6),i(128|t&63);return}else if(t<=65535){i(224|t>>12),i(128|t>>6&63),i(128|t&63);return}else if(t<=1114111){i(240|t>>18),i(128|t>>12&63),i(128|t>>6&63),i(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Fg(t,i){for(let o=0;o<t.length;o+=1){let n=t.charCodeAt(o);if(n>55295&&n<=56319){const a=(n-55296)*1024&65535;n=(t.charCodeAt(o+1)-56320&65535|a)+65536,o+=1}Ag(n,i)}}function Tg(t,i,o){if(i.utf8seq===0){if(t<=127){o(t);return}for(let n=1;n<6;n+=1)if(!(t>>7-n&1)){i.utf8seq=n;break}if(i.utf8seq===2)i.codepoint=t&31;else if(i.utf8seq===3)i.codepoint=t&15;else if(i.utf8seq===4)i.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");i.utf8seq-=1}else if(i.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");i.codepoint=i.codepoint<<6|t&63,i.utf8seq-=1,i.utf8seq===0&&o(i.codepoint)}}function jn(t){const i=[],o={queue:0,queuedBits:0},n=a=>{i.push(a)};for(let a=0;a<t.length;a+=1)Jd(t.charCodeAt(a),o,n);return new Uint8Array(i)}function Bg(t){const i=[];return Fg(t,o=>i.push(o)),new Uint8Array(i)}function Wo(t){const i=[],o={queue:0,queuedBits:0},n=a=>{i.push(a)};return t.forEach(a=>Cl(a,o,n)),Cl(null,o,n),i.join("")}function Ig(t){return Math.round(Date.now()/1e3)+t}function Rg(){return Symbol("auth-callback")}const Kt=()=>typeof window<"u"&&typeof document<"u",To={tested:!1,writable:!1},Yd=()=>{if(!Kt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(To.tested)return To.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),To.tested=!0,To.writable=!0}catch{To.tested=!0,To.writable=!1}return To.writable};function _g(t){const i={},o=new URL(t);if(o.hash&&o.hash[0]==="#")try{new URLSearchParams(o.hash.substring(1)).forEach((a,r)=>{i[r]=a})}catch{}return o.searchParams.forEach((n,a)=>{i[a]=n}),i}const Xd=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),Mg=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",gn=async(t,i,o)=>{await t.setItem(i,JSON.stringify(o))},Bo=async(t,i)=>{const o=await t.getItem(i);if(!o)return null;try{return JSON.parse(o)}catch{return o}},Gt=async(t,i)=>{await t.removeItem(i)};class Da{constructor(){this.promise=new Da.promiseConstructor((i,o)=>{this.resolve=i,this.reject=o})}}Da.promiseConstructor=Promise;function $r(t){const i=t.split(".");if(i.length!==3)throw new $s("Invalid JWT structure");for(let n=0;n<i.length;n++)if(!jg.test(i[n]))throw new $s("JWT not in base64url format");return{header:JSON.parse(kl(i[0])),payload:JSON.parse(kl(i[1])),signature:jn(i[2]),raw:{header:i[0],payload:i[1]}}}async function Dg(t){return await new Promise(i=>{setTimeout(()=>i(null),t)})}function $g(t,i){return new Promise((n,a)=>{(async()=>{for(let r=0;r<1/0;r++)try{const s=await t(r);if(!i(r,null,s)){n(s);return}}catch(s){if(!i(r,s)){a(s);return}}})()})}function Pg(t){return("0"+t.toString(16)).substr(-2)}function Og(){const i=new Uint32Array(56);if(typeof crypto>"u"){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=o.length;let a="";for(let r=0;r<56;r++)a+=o.charAt(Math.floor(Math.random()*n));return a}return crypto.getRandomValues(i),Array.from(i,Pg).join("")}async function Lg(t){const o=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",o),a=new Uint8Array(n);return Array.from(a).map(r=>String.fromCharCode(r)).join("")}async function Wg(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const o=await Lg(t);return btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Yo(t,i,o=!1){const n=Og();let a=n;o&&(a+="/PASSWORD_RECOVERY"),await gn(t,`${i}-code-verifier`,a);const r=await Wg(n);return[r,n===r?"plain":"s256"]}const Ng=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ug(t){const i=t.headers.get(Ms);if(!i||!i.match(Ng))return null;try{return new Date(`${i}T00:00:00.0Z`)}catch{return null}}function Vg(t){if(!t)throw new Error("Missing exp claim");const i=Math.floor(Date.now()/1e3);if(t<=i)throw new Error("JWT has expired")}function qg(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Hg=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Xo(t){if(!Hg.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Va(){const t={};return new Proxy(t,{get:(i,o)=>{if(o==="__isUserNotAvailableProxy")return!0;if(typeof o=="symbol"){const n=o.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${o}" property of the session object is not supported. Please use getUser() instead.`)},set:(i,o)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${o}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(i,o)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${o}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Gg(t,i){return new Proxy(t,{get:(o,n,a)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)"||r==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(o,n,a)}return!i.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i.value=!0),Reflect.get(o,n,a)}})}function wl(t){return JSON.parse(JSON.stringify(t))}const $o=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Kg=[502,503,504];async function zl(t){var i;if(!Mg(t))throw new Ds($o(t),0);if(Kg.includes(t.status))throw new Ds($o(t),t.status);let o;try{o=await t.json()}catch(r){throw new Lo($o(r),r)}let n;const a=Ug(t);if(a&&a.getTime()>=Kd["2024-01-01"].timestamp&&typeof o=="object"&&o&&typeof o.code=="string"?n=o.code:typeof o=="object"&&o&&typeof o.error_code=="string"&&(n=o.error_code),n){if(n==="weak_password")throw new jl($o(o),t.status,((i=o.weak_password)===null||i===void 0?void 0:i.reasons)||[]);if(n==="session_not_found")throw new gi}else if(typeof o=="object"&&o&&typeof o.weak_password=="object"&&o.weak_password&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.reasons.reduce((r,s)=>r&&typeof s=="string",!0))throw new jl($o(o),t.status,o.weak_password.reasons);throw new Cg($o(o),t.status||500,n)}const Jg=(t,i,o,n)=>{const a={method:t,headers:(i==null?void 0:i.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},i==null?void 0:i.headers),a.body=JSON.stringify(n),Object.assign(Object.assign({},a),o))};async function lt(t,i,o,n){var a;const r=Object.assign({},n==null?void 0:n.headers);r[Ms]||(r[Ms]=Kd["2024-01-01"].name),n!=null&&n.jwt&&(r.Authorization=`Bearer ${n.jwt}`);const s=(a=n==null?void 0:n.query)!==null&&a!==void 0?a:{};n!=null&&n.redirectTo&&(s.redirect_to=n.redirectTo);const g=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",h=await Yg(t,i,o+g,{headers:r,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(h):{data:Object.assign({},h),error:null}}async function Yg(t,i,o,n,a,r){const s=Jg(i,n,a,r);let g;try{g=await t(o,Object.assign({},s))}catch(h){throw console.error(h),new Ds($o(h),0)}if(g.ok||await zl(g),n!=null&&n.noResolveJson)return g;try{return await g.json()}catch(h){await zl(h)}}function wi(t){var i;let o=null;Zg(t)&&(o=Object.assign({},t),t.expires_at||(o.expires_at=Ig(t.expires_in)));const n=(i=t.user)!==null&&i!==void 0?i:t;return{data:{session:o,user:n},error:null}}function El(t){const i=wi(t);return!i.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((o,n)=>o&&typeof n=="string",!0)&&(i.data.weak_password=t.weak_password),i}function So(t){var i;return{data:{user:(i=t.user)!==null&&i!==void 0?i:t},error:null}}function Xg(t){return{data:t,error:null}}function Qg(t){const{action_link:i,email_otp:o,hashed_token:n,redirect_to:a,verification_type:r}=t,s=Ra(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),g={action_link:i,email_otp:o,hashed_token:n,redirect_to:a,verification_type:r},h=Object.assign({},s);return{data:{properties:g,user:h},error:null}}function Al(t){return t}function Zg(t){return t.access_token&&t.refresh_token&&t.expires_in}const qa=["global","local","others"];class eu{constructor({url:i="",headers:o={},fetch:n}){this.url=i,this.headers=o,this.fetch=Xd(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(i,o=qa[0]){if(qa.indexOf(o)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${qa.join(", ")}`);try{return await lt(this.fetch,"POST",`${this.url}/logout?scope=${o}`,{headers:this.headers,jwt:i,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Xe(n))return{data:null,error:n};throw n}}async inviteUserByEmail(i,o={}){try{return await lt(this.fetch,"POST",`${this.url}/invite`,{body:{email:i,data:o.data},headers:this.headers,redirectTo:o.redirectTo,xform:So})}catch(n){if(Xe(n))return{data:{user:null},error:n};throw n}}async generateLink(i){try{const{options:o}=i,n=Ra(i,["options"]),a=Object.assign(Object.assign({},n),o);return"newEmail"in n&&(a.new_email=n==null?void 0:n.newEmail,delete a.newEmail),await lt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:Qg,redirectTo:o==null?void 0:o.redirectTo})}catch(o){if(Xe(o))return{data:{properties:null,user:null},error:o};throw o}}async createUser(i){try{return await lt(this.fetch,"POST",`${this.url}/admin/users`,{body:i,headers:this.headers,xform:So})}catch(o){if(Xe(o))return{data:{user:null},error:o};throw o}}async listUsers(i){var o,n,a,r,s,g,h;try{const b={nextPage:null,lastPage:0,total:0},j=await lt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(o=i==null?void 0:i.page)===null||o===void 0?void 0:o.toString())!==null&&n!==void 0?n:"",per_page:(r=(a=i==null?void 0:i.perPage)===null||a===void 0?void 0:a.toString())!==null&&r!==void 0?r:""},xform:Al});if(j.error)throw j.error;const k=await j.json(),v=(s=j.headers.get("x-total-count"))!==null&&s!==void 0?s:0,m=(h=(g=j.headers.get("link"))===null||g===void 0?void 0:g.split(","))!==null&&h!==void 0?h:[];return m.length>0&&(m.forEach(f=>{const p=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),d=JSON.parse(f.split(";")[1].split("=")[1]);b[`${d}Page`]=p}),b.total=parseInt(v)),{data:Object.assign(Object.assign({},k),b),error:null}}catch(b){if(Xe(b))return{data:{users:[]},error:b};throw b}}async getUserById(i){Xo(i);try{return await lt(this.fetch,"GET",`${this.url}/admin/users/${i}`,{headers:this.headers,xform:So})}catch(o){if(Xe(o))return{data:{user:null},error:o};throw o}}async updateUserById(i,o){Xo(i);try{return await lt(this.fetch,"PUT",`${this.url}/admin/users/${i}`,{body:o,headers:this.headers,xform:So})}catch(n){if(Xe(n))return{data:{user:null},error:n};throw n}}async deleteUser(i,o=!1){Xo(i);try{return await lt(this.fetch,"DELETE",`${this.url}/admin/users/${i}`,{headers:this.headers,body:{should_soft_delete:o},xform:So})}catch(n){if(Xe(n))return{data:{user:null},error:n};throw n}}async _listFactors(i){Xo(i.userId);try{const{data:o,error:n}=await lt(this.fetch,"GET",`${this.url}/admin/users/${i.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:o,error:n}}catch(o){if(Xe(o))return{data:null,error:o};throw o}}async _deleteFactor(i){Xo(i.userId),Xo(i.id);try{return{data:await lt(this.fetch,"DELETE",`${this.url}/admin/users/${i.userId}/factors/${i.id}`,{headers:this.headers}),error:null}}catch(o){if(Xe(o))return{data:null,error:o};throw o}}async _listOAuthClients(i){var o,n,a,r,s,g,h;try{const b={nextPage:null,lastPage:0,total:0},j=await lt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(o=i==null?void 0:i.page)===null||o===void 0?void 0:o.toString())!==null&&n!==void 0?n:"",per_page:(r=(a=i==null?void 0:i.perPage)===null||a===void 0?void 0:a.toString())!==null&&r!==void 0?r:""},xform:Al});if(j.error)throw j.error;const k=await j.json(),v=(s=j.headers.get("x-total-count"))!==null&&s!==void 0?s:0,m=(h=(g=j.headers.get("link"))===null||g===void 0?void 0:g.split(","))!==null&&h!==void 0?h:[];return m.length>0&&(m.forEach(f=>{const p=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),d=JSON.parse(f.split(";")[1].split("=")[1]);b[`${d}Page`]=p}),b.total=parseInt(v)),{data:Object.assign(Object.assign({},k),b),error:null}}catch(b){if(Xe(b))return{data:{clients:[]},error:b};throw b}}async _createOAuthClient(i){try{return await lt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:i,headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Xe(o))return{data:null,error:o};throw o}}async _getOAuthClient(i){try{return await lt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Xe(o))return{data:null,error:o};throw o}}async _updateOAuthClient(i,o){try{return await lt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${i}`,{body:o,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Xe(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(i){try{return await lt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(o){if(Xe(o))return{data:null,error:o};throw o}}async _regenerateOAuthClientSecret(i){try{return await lt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${i}/regenerate_secret`,{headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Xe(o))return{data:null,error:o};throw o}}}function Fl(t={}){return{getItem:i=>t[i]||null,setItem:(i,o)=>{t[i]=o},removeItem:i=>{delete t[i]}}}const Qo={debug:!!(globalThis&&Yd()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Qd extends Error{constructor(i){super(i),this.isAcquireTimeout=!0}}class Tl extends Qd{}async function tu(t,i,o){Qo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,i);const n=new globalThis.AbortController;i>0&&setTimeout(()=>{n.abort(),Qo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},i),await Promise.resolve();try{return await globalThis.navigator.locks.request(t,i===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async a=>{if(a){Qo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await o()}finally{Qo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(i===0)throw Qo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Tl(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Qo.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await o()}})}catch(a){throw(a==null?void 0:a.name)==="AbortError"?new Tl(`Acquiring an exclusive Navigator LockManager lock "${t}" timed out waiting ${i}ms`):a}}function iu(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Zd(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function ou(t){return parseInt(t,16)}function nu(t){const i=new TextEncoder().encode(t);return"0x"+Array.from(i,n=>n.toString(16).padStart(2,"0")).join("")}function ru(t){var i;const{chainId:o,domain:n,expirationTime:a,issuedAt:r=new Date,nonce:s,notBefore:g,requestId:h,resources:b,scheme:j,uri:k,version:v}=t;{if(!Number.isInteger(o))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${o}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(s&&s.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${s}`);if(!k)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(v!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${v}`);if(!((i=t.statement)===null||i===void 0)&&i.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const m=Zd(t.address),f=j?`${j}://${n}`:n,p=t.statement?`${t.statement}
`:"",d=`${f} wants you to sign in with your Ethereum account:
${m}

${p}`;let c=`URI: ${k}
Version: ${v}
Chain ID: ${o}${s?`
Nonce: ${s}`:""}
Issued At: ${r.toISOString()}`;if(a&&(c+=`
Expiration Time: ${a.toISOString()}`),g&&(c+=`
Not Before: ${g.toISOString()}`),h&&(c+=`
Request ID: ${h}`),b){let l=`
Resources:`;for(const x of b){if(!x||typeof x!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${x}`);l+=`
- ${x}`}c+=l}return`${d}
${c}`}class Pt extends Error{constructor({message:i,code:o,cause:n,name:a}){var r;super(i,{cause:n}),this.__isWebAuthnError=!0,this.name=(r=a??(n instanceof Error?n.name:void 0))!==null&&r!==void 0?r:"Unknown Error",this.code=o}}class ba extends Pt{constructor(i,o){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o,message:i}),this.name="WebAuthnUnknownError",this.originalError=o}}function au({error:t,options:i}){var o,n,a;const{publicKey:r}=i;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Pt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((o=r.authenticatorSelection)===null||o===void 0?void 0:o.requireResidentKey)===!0)return new Pt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(i.mediation==="conditional"&&((n=r.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Pt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=r.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new Pt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Pt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Pt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return r.pubKeyCredParams.filter(g=>g.type==="public-key").length===0?new Pt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Pt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(ec(s)){if(r.rp.id!==s)return new Pt({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Pt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new Pt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Pt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Pt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function su({error:t,options:i}){const{publicKey:o}=i;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Pt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Pt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const n=window.location.hostname;if(ec(n)){if(o.rpId!==n)return new Pt({message:`The RP ID "${o.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Pt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Pt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Pt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class lu{createNewAbortSignal(){if(this.controller){const o=new Error("Cancelling existing WebAuthn API call for new one");o.name="AbortError",this.controller.abort(o)}const i=new AbortController;return this.controller=i,i.signal}cancelCeremony(){if(this.controller){const i=new Error("Manually cancelling existing WebAuthn API call");i.name="AbortError",this.controller.abort(i),this.controller=void 0}}}const du=new lu;function cu(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:i,user:o,excludeCredentials:n}=t,a=Ra(t,["challenge","user","excludeCredentials"]),r=jn(i).buffer,s=Object.assign(Object.assign({},o),{id:jn(o.id).buffer}),g=Object.assign(Object.assign({},a),{challenge:r,user:s});if(n&&n.length>0){g.excludeCredentials=new Array(n.length);for(let h=0;h<n.length;h++){const b=n[h];g.excludeCredentials[h]=Object.assign(Object.assign({},b),{id:jn(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return g}function pu(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:i,allowCredentials:o}=t,n=Ra(t,["challenge","allowCredentials"]),a=jn(i).buffer,r=Object.assign(Object.assign({},n),{challenge:a});if(o&&o.length>0){r.allowCredentials=new Array(o.length);for(let s=0;s<o.length;s++){const g=o[s];r.allowCredentials[s]=Object.assign(Object.assign({},g),{id:jn(g.id).buffer,type:g.type||"public-key",transports:g.transports})}}return r}function gu(t){var i;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const o=t;return{id:t.id,rawId:t.id,response:{attestationObject:Wo(new Uint8Array(t.response.attestationObject)),clientDataJSON:Wo(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(i=o.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function uu(t){var i;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const o=t,n=t.getClientExtensionResults(),a=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Wo(new Uint8Array(a.authenticatorData)),clientDataJSON:Wo(new Uint8Array(a.clientDataJSON)),signature:Wo(new Uint8Array(a.signature)),userHandle:a.userHandle?Wo(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(i=o.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function ec(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Bl(){var t,i;return!!(Kt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((i=navigator==null?void 0:navigator.credentials)===null||i===void 0?void 0:i.get)=="function")}async function hu(t){try{const i=await navigator.credentials.create(t);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new ba("Browser returned unexpected credential type",i)}:{data:null,error:new ba("Empty credential response",i)}}catch(i){return{data:null,error:au({error:i,options:t})}}}async function fu(t){try{const i=await navigator.credentials.get(t);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new ba("Browser returned unexpected credential type",i)}:{data:null,error:new ba("Empty credential response",i)}}catch(i){return{data:null,error:su({error:i,options:t})}}}const xu={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},mu={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ya(...t){const i=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),o=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),n={};for(const a of t)if(a)for(const r in a){const s=a[r];if(s!==void 0)if(Array.isArray(s))n[r]=s;else if(o(s))n[r]=s;else if(i(s)){const g=n[r];i(g)?n[r]=ya(g,s):n[r]=ya(s)}else n[r]=s}return n}function bu(t,i){return ya(xu,t,i||{})}function yu(t,i){return ya(mu,t,i||{})}class vu{constructor(i){this.client=i,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(i){return this.client.mfa.enroll(Object.assign(Object.assign({},i),{factorType:"webauthn"}))}async _challenge({factorId:i,webauthn:o,friendlyName:n,signal:a},r){var s;try{const{data:g,error:h}=await this.client.mfa.challenge({factorId:i,webauthn:o});if(!g)return{data:null,error:h};const b=a??du.createNewAbortSignal();if(g.webauthn.type==="create"){const{user:j}=g.webauthn.credential_options.publicKey;if(!j.name){const k=n;if(k)j.name=`${j.id}:${k}`;else{const m=(await this.client.getUser()).data.user,f=((s=m==null?void 0:m.user_metadata)===null||s===void 0?void 0:s.name)||(m==null?void 0:m.email)||(m==null?void 0:m.id)||"User";j.name=`${j.id}:${f}`}}j.displayName||(j.displayName=j.name)}switch(g.webauthn.type){case"create":{const j=bu(g.webauthn.credential_options.publicKey,r==null?void 0:r.create),{data:k,error:v}=await hu({publicKey:j,signal:b});return k?{data:{factorId:i,challengeId:g.id,webauthn:{type:g.webauthn.type,credential_response:k}},error:null}:{data:null,error:v}}case"request":{const j=yu(g.webauthn.credential_options.publicKey,r==null?void 0:r.request),{data:k,error:v}=await fu(Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:j,signal:b}));return k?{data:{factorId:i,challengeId:g.id,webauthn:{type:g.webauthn.type,credential_response:k}},error:null}:{data:null,error:v}}}}catch(g){return Xe(g)?{data:null,error:g}:{data:null,error:new Lo("Unexpected error in challenge",g)}}}async _verify({challengeId:i,factorId:o,webauthn:n}){return this.client.mfa.verify({factorId:o,challengeId:i,webauthn:n})}async _authenticate({factorId:i,webauthn:{rpId:o=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},r){if(!o)return{data:null,error:new ur("rpId is required for WebAuthn authentication")};try{if(!Bl())return{data:null,error:new Lo("Browser does not support WebAuthn",null)};const{data:s,error:g}=await this.challenge({factorId:i,webauthn:{rpId:o,rpOrigins:n},signal:a},{request:r});if(!s)return{data:null,error:g};const{webauthn:h}=s;return this._verify({factorId:i,challengeId:s.challengeId,webauthn:{type:h.type,rpId:o,rpOrigins:n,credential_response:h.credential_response}})}catch(s){return Xe(s)?{data:null,error:s}:{data:null,error:new Lo("Unexpected error in authenticate",s)}}}async _register({friendlyName:i,webauthn:{rpId:o=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},r){if(!o)return{data:null,error:new ur("rpId is required for WebAuthn registration")};try{if(!Bl())return{data:null,error:new Lo("Browser does not support WebAuthn",null)};const{data:s,error:g}=await this._enroll({friendlyName:i});if(!s)return await this.client.mfa.listFactors().then(j=>{var k;return(k=j.data)===null||k===void 0?void 0:k.all.find(v=>v.factor_type==="webauthn"&&v.friendly_name===i&&v.status!=="unverified")}).then(j=>j?this.client.mfa.unenroll({factorId:j==null?void 0:j.id}):void 0),{data:null,error:g};const{data:h,error:b}=await this._challenge({factorId:s.id,friendlyName:s.friendly_name,webauthn:{rpId:o,rpOrigins:n},signal:a},{create:r});return h?this._verify({factorId:s.id,challengeId:h.challengeId,webauthn:{rpId:o,rpOrigins:n,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:b}}catch(s){return Xe(s)?{data:null,error:s}:{data:null,error:new Lo("Unexpected error in register",s)}}}}iu();const ju={url:bg,storageKey:yg,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:vg,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function Il(t,i,o){return await o()}const Zo={};class hr{get jwks(){var i,o;return(o=(i=Zo[this.storageKey])===null||i===void 0?void 0:i.jwks)!==null&&o!==void 0?o:{keys:[]}}set jwks(i){Zo[this.storageKey]=Object.assign(Object.assign({},Zo[this.storageKey]),{jwks:i})}get jwks_cached_at(){var i,o;return(o=(i=Zo[this.storageKey])===null||i===void 0?void 0:i.cachedAt)!==null&&o!==void 0?o:Number.MIN_SAFE_INTEGER}set jwks_cached_at(i){Zo[this.storageKey]=Object.assign(Object.assign({},Zo[this.storageKey]),{cachedAt:i})}constructor(i){var o,n,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const r=Object.assign(Object.assign({},ju),i);if(this.storageKey=r.storageKey,this.instanceID=(o=hr.nextInstanceID[this.storageKey])!==null&&o!==void 0?o:0,hr.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.instanceID>0&&Kt()){const s=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(s),this.logDebugMessages&&console.trace(s)}if(this.persistSession=r.persistSession,this.autoRefreshToken=r.autoRefreshToken,this.admin=new eu({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Xd(r.fetch),this.lock=r.lock||Il,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,this.throwOnError=r.throwOnError,this.lockAcquireTimeout=r.lockAcquireTimeout,r.lock?this.lock=r.lock:this.persistSession&&Kt()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=tu:this.lock=Il,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new vu(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:Yd()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Fl(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Fl(this.memoryStorage)),Kt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s);try{await this._notifyAllSubscribers(s.data.event,s.data.session,!1)}catch(g){this._debug("#broadcastChannel","error",g)}})}r.skipAutoInitialize||this.initialize().catch(s=>{this._debug("#initialize()","error",s)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(i){if(this.throwOnError&&i&&i.error)throw i.error;return i}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Gd}) ${new Date().toISOString()}`}_debug(...i){return this.logDebugMessages&&this.logger(this._logPrefix(),...i),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var i;try{let o={},n="none";if(Kt()&&(o=_g(window.location.href),this._isImplicitGrantCallback(o)?n="implicit":await this._isPKCECallback(o)&&(n="pkce")),Kt()&&this.detectSessionInUrl&&n!=="none"){const{data:a,error:r}=await this._getSessionFromURL(o,n);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),wg(r)){const h=(i=r.details)===null||i===void 0?void 0:i.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:r}}return{error:r}}const{session:s,redirectType:g}=a;return this._debug("#_initialize()","detected session in URL",s,"redirect type",g),await this._saveSession(s),setTimeout(async()=>{g==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(o){return Xe(o)?this._returnResult({error:o}):this._returnResult({error:new Lo("Unexpected error during initialization",o)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(i){var o,n,a;try{const r=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(o=i==null?void 0:i.options)===null||o===void 0?void 0:o.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(a=i==null?void 0:i.options)===null||a===void 0?void 0:a.captchaToken}},xform:wi}),{data:s,error:g}=r;if(g||!s)return this._returnResult({data:{user:null,session:null},error:g});const h=s.session,b=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:b,session:h},error:null})}catch(r){if(Xe(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signUp(i){var o,n,a;try{let r;if("email"in i){const{email:j,password:k,options:v}=i;let m=null,f=null;this.flowType==="pkce"&&([m,f]=await Yo(this.storage,this.storageKey)),r=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v==null?void 0:v.emailRedirectTo,body:{email:j,password:k,data:(o=v==null?void 0:v.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:m,code_challenge_method:f},xform:wi})}else if("phone"in i){const{phone:j,password:k,options:v}=i;r=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:j,password:k,data:(n=v==null?void 0:v.data)!==null&&n!==void 0?n:{},channel:(a=v==null?void 0:v.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:wi})}else throw new Mr("You must provide either an email or phone number and a password");const{data:s,error:g}=r;if(g||!s)return await Gt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:g});const h=s.session,b=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:b,session:h},error:null})}catch(r){if(await Gt(this.storage,`${this.storageKey}-code-verifier`),Xe(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithPassword(i){try{let o;if("email"in i){const{email:r,password:s,options:g}=i;o=await lt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:El})}else if("phone"in i){const{phone:r,password:s,options:g}=i;o=await lt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:El})}else throw new Mr("You must provide either an email or phone number and a password");const{data:n,error:a}=o;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!n||!n.session||!n.user){const r=new Jo;return this._returnResult({data:{user:null,session:null},error:r})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:a})}catch(o){if(Xe(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithOAuth(i){var o,n,a,r;return await this._handleProviderSignIn(i.provider,{redirectTo:(o=i.options)===null||o===void 0?void 0:o.redirectTo,scopes:(n=i.options)===null||n===void 0?void 0:n.scopes,queryParams:(a=i.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(r=i.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(i){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(i))}async signInWithWeb3(i){const{chain:o}=i;switch(o){case"ethereum":return await this.signInWithEthereum(i);case"solana":return await this.signInWithSolana(i);default:throw new Error(`@supabase/auth-js: Unsupported chain "${o}"`)}}async signInWithEthereum(i){var o,n,a,r,s,g,h,b,j,k,v;let m,f;if("message"in i)m=i.message,f=i.signature;else{const{chain:p,wallet:d,statement:c,options:l}=i;let x;if(Kt())if(typeof d=="object")x=d;else{const w=window;if("ethereum"in w&&typeof w.ethereum=="object"&&"request"in w.ethereum&&typeof w.ethereum.request=="function")x=w.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof d!="object"||!(l!=null&&l.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=d}const y=new URL((o=l==null?void 0:l.url)!==null&&o!==void 0?o:window.location.href),u=await x.request({method:"eth_requestAccounts"}).then(w=>w).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!u||u.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const S=Zd(u[0]);let A=(n=l==null?void 0:l.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!A){const w=await x.request({method:"eth_chainId"});A=ou(w)}const E={domain:y.host,address:S,statement:c,uri:y.href,version:"1",chainId:A,nonce:(a=l==null?void 0:l.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(s=(r=l==null?void 0:l.signInWithEthereum)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date,expirationTime:(g=l==null?void 0:l.signInWithEthereum)===null||g===void 0?void 0:g.expirationTime,notBefore:(h=l==null?void 0:l.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(b=l==null?void 0:l.signInWithEthereum)===null||b===void 0?void 0:b.requestId,resources:(j=l==null?void 0:l.signInWithEthereum)===null||j===void 0?void 0:j.resources};m=ru(E),f=await x.request({method:"personal_sign",params:[nu(m),S]})}try{const{data:p,error:d}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:f},!((k=i.options)===null||k===void 0)&&k.captchaToken?{gotrue_meta_security:{captcha_token:(v=i.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:wi});if(d)throw d;if(!p||!p.session||!p.user){const c=new Jo;return this._returnResult({data:{user:null,session:null},error:c})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:d})}catch(p){if(Xe(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(i){var o,n,a,r,s,g,h,b,j,k,v,m;let f,p;if("message"in i)f=i.message,p=i.signature;else{const{chain:d,wallet:c,statement:l,options:x}=i;let y;if(Kt())if(typeof c=="object")y=c;else{const S=window;if("solana"in S&&typeof S.solana=="object"&&("signIn"in S.solana&&typeof S.solana.signIn=="function"||"signMessage"in S.solana&&typeof S.solana.signMessage=="function"))y=S.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof c!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=c}const u=new URL((o=x==null?void 0:x.url)!==null&&o!==void 0?o:window.location.href);if("signIn"in y&&y.signIn){const S=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},x==null?void 0:x.signInWithSolana),{version:"1",domain:u.host,uri:u.href}),l?{statement:l}:null));let A;if(Array.isArray(S)&&S[0]&&typeof S[0]=="object")A=S[0];else if(S&&typeof S=="object"&&"signedMessage"in S&&"signature"in S)A=S;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)f=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),p=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in y)||typeof y.signMessage!="function"||!("publicKey"in y)||typeof y!="object"||!y.publicKey||!("toBase58"in y.publicKey)||typeof y.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${u.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...l?["",l,""]:[""],"Version: 1",`URI: ${u.href}`,`Issued At: ${(a=(n=x==null?void 0:x.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((r=x==null?void 0:x.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...!((s=x==null?void 0:x.signInWithSolana)===null||s===void 0)&&s.expirationTime?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...!((g=x==null?void 0:x.signInWithSolana)===null||g===void 0)&&g.chainId?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...!((h=x==null?void 0:x.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...!((b=x==null?void 0:x.signInWithSolana)===null||b===void 0)&&b.requestId?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...!((k=(j=x==null?void 0:x.signInWithSolana)===null||j===void 0?void 0:j.resources)===null||k===void 0)&&k.length?["Resources",...x.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const S=await y.signMessage(new TextEncoder().encode(f),"utf8");if(!S||!(S instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=S}}try{const{data:d,error:c}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Wo(p)},!((v=i.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(m=i.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:wi});if(c)throw c;if(!d||!d.session||!d.user){const l=new Jo;return this._returnResult({data:{user:null,session:null},error:l})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:Object.assign({},d),error:c})}catch(d){if(Xe(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async _exchangeCodeForSession(i){const o=await Bo(this.storage,`${this.storageKey}-code-verifier`),[n,a]=(o??"").split("/");try{if(!n&&this.flowType==="pkce")throw new zg;const{data:r,error:s}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:i,code_verifier:n},xform:wi});if(await Gt(this.storage,`${this.storageKey}-code-verifier`),s)throw s;if(!r||!r.session||!r.user){const g=new Jo;return this._returnResult({data:{user:null,session:null,redirectType:null},error:g})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign(Object.assign({},r),{redirectType:a??null}),error:s})}catch(r){if(await Gt(this.storage,`${this.storageKey}-code-verifier`),Xe(r))return this._returnResult({data:{user:null,session:null,redirectType:null},error:r});throw r}}async signInWithIdToken(i){try{const{options:o,provider:n,token:a,access_token:r,nonce:s}=i,g=await lt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:a,access_token:r,nonce:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:wi}),{data:h,error:b}=g;if(b)return this._returnResult({data:{user:null,session:null},error:b});if(!h||!h.session||!h.user){const j=new Jo;return this._returnResult({data:{user:null,session:null},error:j})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:b})}catch(o){if(Xe(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithOtp(i){var o,n,a,r,s;try{if("email"in i){const{email:g,options:h}=i;let b=null,j=null;this.flowType==="pkce"&&([b,j]=await Yo(this.storage,this.storageKey));const{error:k}=await lt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:g,data:(o=h==null?void 0:h.data)!==null&&o!==void 0?o:{},create_user:(n=h==null?void 0:h.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:b,code_challenge_method:j},redirectTo:h==null?void 0:h.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:k})}if("phone"in i){const{phone:g,options:h}=i,{data:b,error:j}=await lt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:g,data:(a=h==null?void 0:h.data)!==null&&a!==void 0?a:{},create_user:(r=h==null?void 0:h.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:b==null?void 0:b.message_id},error:j})}throw new Mr("You must provide either an email or phone number.")}catch(g){if(await Gt(this.storage,`${this.storageKey}-code-verifier`),Xe(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async verifyOtp(i){var o,n;try{let a,r;"options"in i&&(a=(o=i.options)===null||o===void 0?void 0:o.redirectTo,r=(n=i.options)===null||n===void 0?void 0:n.captchaToken);const{data:s,error:g}=await lt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},i),{gotrue_meta_security:{captcha_token:r}}),redirectTo:a,xform:wi});if(g)throw g;if(!s)throw new Error("An error occurred on token verification.");const h=s.session,b=s.user;return h!=null&&h.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(i.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:b,session:h},error:null})}catch(a){if(Xe(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(i){var o,n,a,r,s;try{let g=null,h=null;this.flowType==="pkce"&&([g,h]=await Yo(this.storage,this.storageKey));const b=await lt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in i?{provider_id:i.providerId}:null),"domain"in i?{domain:i.domain}:null),{redirect_to:(n=(o=i.options)===null||o===void 0?void 0:o.redirectTo)!==null&&n!==void 0?n:void 0}),!((a=i==null?void 0:i.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:i.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:g,code_challenge_method:h}),headers:this.headers,xform:Xg});return!((r=b.data)===null||r===void 0)&&r.url&&Kt()&&!(!((s=i.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(b.data.url),this._returnResult(b)}catch(g){if(await Gt(this.storage,`${this.storageKey}-code-verifier`),Xe(g))return this._returnResult({data:null,error:g});throw g}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async i=>{const{data:{session:o},error:n}=i;if(n)throw n;if(!o)throw new gi;const{error:a}=await lt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:o.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(i){if(Xe(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async resend(i){try{const o=`${this.url}/resend`;if("email"in i){const{email:n,type:a,options:r}=i,{error:s}=await lt(this.fetch,"POST",o,{headers:this.headers,body:{email:n,type:a,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:s})}else if("phone"in i){const{phone:n,type:a,options:r}=i,{data:s,error:g}=await lt(this.fetch,"POST",o,{headers:this.headers,body:{phone:n,type:a,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:s==null?void 0:s.message_id},error:g})}throw new Mr("You must provide either an email or phone number and a type")}catch(o){if(Xe(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async o=>o))}async _acquireLock(i,o){this._debug("#_acquireLock","begin",i);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await n,await o()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,i,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=o();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(i){this._debug("#_useSession","begin");try{const o=await this.__loadSession();return await i(o)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let i=null;const o=await Bo(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",o),o!==null&&(this._isValidSession(o)?i=o:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!i)return{data:{session:null},error:null};const n=i.expires_at?i.expires_at*1e3-Date.now()<Wa:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",i.expires_at),!n){if(this.userStorage){const s=await Bo(this.userStorage,this.storageKey+"-user");s!=null&&s.user?i.user=s.user:i.user=Va()}if(this.storage.isServer&&i.user&&!i.user.__isUserNotAvailableProxy){const s={value:this.suppressGetSessionWarning};i.user=Gg(i.user,s),s.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:i},error:null}}const{data:a,error:r}=await this._callRefreshToken(i.refresh_token);return r?this._returnResult({data:{session:null},error:r}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(i){if(i)return await this._getUser(i);await this.initializePromise;const o=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return o.data.user&&(this.suppressGetSessionWarning=!0),o}async _getUser(i){try{return i?await lt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:i,xform:So}):await this._useSession(async o=>{var n,a,r;const{data:s,error:g}=o;if(g)throw g;return!(!((n=s.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new gi}:await lt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(a=s.session)===null||a===void 0?void 0:a.access_token)!==null&&r!==void 0?r:void 0,xform:So})})}catch(o){if(Xe(o))return Na(o)&&(await this._removeSession(),await Gt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:o});throw o}}async updateUser(i,o={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(i,o))}async _updateUser(i,o={}){try{return await this._useSession(async n=>{const{data:a,error:r}=n;if(r)throw r;if(!a.session)throw new gi;const s=a.session;let g=null,h=null;this.flowType==="pkce"&&i.email!=null&&([g,h]=await Yo(this.storage,this.storageKey));const{data:b,error:j}=await lt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:o==null?void 0:o.emailRedirectTo,body:Object.assign(Object.assign({},i),{code_challenge:g,code_challenge_method:h}),jwt:s.access_token,xform:So});if(j)throw j;return s.user=b.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),this._returnResult({data:{user:s.user},error:null})})}catch(n){if(await Gt(this.storage,`${this.storageKey}-code-verifier`),Xe(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(i){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(i))}async _setSession(i){try{if(!i.access_token||!i.refresh_token)throw new gi;const o=Date.now()/1e3;let n=o,a=!0,r=null;const{payload:s}=$r(i.access_token);if(s.exp&&(n=s.exp,a=n<=o),a){const{data:g,error:h}=await this._callRefreshToken(i.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!g)return{data:{user:null,session:null},error:null};r=g}else{const{data:g,error:h}=await this._getUser(i.access_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});r={access_token:i.access_token,refresh_token:i.refresh_token,user:g.user,token_type:"bearer",expires_in:n-o,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return this._returnResult({data:{user:r.user,session:r},error:null})}catch(o){if(Xe(o))return this._returnResult({data:{session:null,user:null},error:o});throw o}}async refreshSession(i){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(i))}async _refreshSession(i){try{return await this._useSession(async o=>{var n;if(!i){const{data:s,error:g}=o;if(g)throw g;i=(n=s.session)!==null&&n!==void 0?n:void 0}if(!(i!=null&&i.refresh_token))throw new gi;const{data:a,error:r}=await this._callRefreshToken(i.refresh_token);return r?this._returnResult({data:{user:null,session:null},error:r}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(o){if(Xe(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async _getSessionFromURL(i,o){try{if(!Kt())throw new Dr("No browser detected.");if(i.error||i.error_description||i.error_code)throw new Dr(i.error_description||"Error in URL with unspecified error_description",{error:i.error||"unspecified_error",code:i.error_code||"unspecified_code"});switch(o){case"implicit":if(this.flowType==="pkce")throw new vl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Dr("Not a valid implicit grant flow url.");break;default:}if(o==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!i.code)throw new vl("No code detected.");const{data:l,error:x}=await this._exchangeCodeForSession(i.code);if(x)throw x;const y=new URL(window.location.href);return y.searchParams.delete("code"),window.history.replaceState(window.history.state,"",y.toString()),{data:{session:l.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:a,access_token:r,refresh_token:s,expires_in:g,expires_at:h,token_type:b}=i;if(!r||!g||!s||!b)throw new Dr("No session defined in URL");const j=Math.round(Date.now()/1e3),k=parseInt(g);let v=j+k;h&&(v=parseInt(h));const m=v-j;m*1e3<=pn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${k}s`);const f=v-k;j-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,v,j):j-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,v,j);const{data:p,error:d}=await this._getUser(r);if(d)throw d;const c={provider_token:n,provider_refresh_token:a,access_token:r,expires_in:k,expires_at:v,refresh_token:s,token_type:b,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:c,redirectType:i.type},error:null})}catch(n){if(Xe(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(i){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),i):!!(i.access_token||i.error_description)}async _isPKCECallback(i){const o=await Bo(this.storage,`${this.storageKey}-code-verifier`);return!!(i.code&&o)}async signOut(i={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(i))}async _signOut({scope:i}={scope:"global"}){return await this._useSession(async o=>{var n;const{data:a,error:r}=o;if(r&&!Na(r))return this._returnResult({error:r});const s=(n=a.session)===null||n===void 0?void 0:n.access_token;if(s){const{error:g}=await this.admin.signOut(s,i);if(g&&!(kg(g)&&(g.status===404||g.status===401||g.status===403)||Na(g)))return this._returnResult({error:g})}return i!=="others"&&(await this._removeSession(),await Gt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(i){const o=Rg(),n={id:o,callback:i,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",o),this.stateChangeEmitters.delete(o)}};return this._debug("#onAuthStateChange()","registered callback with id",o),this.stateChangeEmitters.set(o,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(o)})))(),{data:{subscription:n}}}async _emitInitialSession(i){return await this._useSession(async o=>{var n,a;try{const{data:{session:r},error:s}=o;if(s)throw s;await((n=this.stateChangeEmitters.get(i))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",i,"session",r)}catch(r){await((a=this.stateChangeEmitters.get(i))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",i,"error",r),console.error(r)}})}async resetPasswordForEmail(i,o={}){let n=null,a=null;this.flowType==="pkce"&&([n,a]=await Yo(this.storage,this.storageKey,!0));try{return await lt(this.fetch,"POST",`${this.url}/recover`,{body:{email:i,code_challenge:n,code_challenge_method:a,gotrue_meta_security:{captcha_token:o.captchaToken}},headers:this.headers,redirectTo:o.redirectTo})}catch(r){if(await Gt(this.storage,`${this.storageKey}-code-verifier`),Xe(r))return this._returnResult({data:null,error:r});throw r}}async getUserIdentities(){var i;try{const{data:o,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(i=o.user.identities)!==null&&i!==void 0?i:[]},error:null})}catch(o){if(Xe(o))return this._returnResult({data:null,error:o});throw o}}async linkIdentity(i){return"token"in i?this.linkIdentityIdToken(i):this.linkIdentityOAuth(i)}async linkIdentityOAuth(i){var o;try{const{data:n,error:a}=await this._useSession(async r=>{var s,g,h,b,j;const{data:k,error:v}=r;if(v)throw v;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,i.provider,{redirectTo:(s=i.options)===null||s===void 0?void 0:s.redirectTo,scopes:(g=i.options)===null||g===void 0?void 0:g.scopes,queryParams:(h=i.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await lt(this.fetch,"GET",m,{headers:this.headers,jwt:(j=(b=k.session)===null||b===void 0?void 0:b.access_token)!==null&&j!==void 0?j:void 0})});if(a)throw a;return Kt()&&!(!((o=i.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:i.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(Xe(n))return this._returnResult({data:{provider:i.provider,url:null},error:n});throw n}}async linkIdentityIdToken(i){return await this._useSession(async o=>{var n;try{const{error:a,data:{session:r}}=o;if(a)throw a;const{options:s,provider:g,token:h,access_token:b,nonce:j}=i,k=await lt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=r==null?void 0:r.access_token)!==null&&n!==void 0?n:void 0,body:{provider:g,id_token:h,access_token:b,nonce:j,link_identity:!0,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:wi}),{data:v,error:m}=k;return m?this._returnResult({data:{user:null,session:null},error:m}):!v||!v.session||!v.user?this._returnResult({data:{user:null,session:null},error:new Jo}):(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("USER_UPDATED",v.session)),this._returnResult({data:v,error:m}))}catch(a){if(await Gt(this.storage,`${this.storageKey}-code-verifier`),Xe(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(i){try{return await this._useSession(async o=>{var n,a;const{data:r,error:s}=o;if(s)throw s;return await lt(this.fetch,"DELETE",`${this.url}/user/identities/${i.identity_id}`,{headers:this.headers,jwt:(a=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0})})}catch(o){if(Xe(o))return this._returnResult({data:null,error:o});throw o}}async _refreshAccessToken(i){const o=`#_refreshAccessToken(${i.substring(0,5)}...)`;this._debug(o,"begin");try{const n=Date.now();return await $g(async a=>(a>0&&await Dg(200*Math.pow(2,a-1)),this._debug(o,"refreshing attempt",a),await lt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:i},headers:this.headers,xform:wi})),(a,r)=>{const s=200*Math.pow(2,a);return r&&Ua(r)&&Date.now()+s-n<pn})}catch(n){if(this._debug(o,"error",n),Xe(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(o,"end")}}_isValidSession(i){return typeof i=="object"&&i!==null&&"access_token"in i&&"refresh_token"in i&&"expires_at"in i}async _handleProviderSignIn(i,o){const n=await this._getUrlForProvider(`${this.url}/authorize`,i,{redirectTo:o.redirectTo,scopes:o.scopes,queryParams:o.queryParams});return this._debug("#_handleProviderSignIn()","provider",i,"options",o,"url",n),Kt()&&!o.skipBrowserRedirect&&window.location.assign(n),{data:{provider:i,url:n},error:null}}async _recoverAndRefresh(){var i,o;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const a=await Bo(this.storage,this.storageKey);if(a&&this.userStorage){let s=await Bo(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!s&&(s={user:a.user},await gn(this.userStorage,this.storageKey+"-user",s)),a.user=(i=s==null?void 0:s.user)!==null&&i!==void 0?i:Va()}else if(a&&!a.user&&!a.user){const s=await Bo(this.storage,this.storageKey+"-user");s&&(s!=null&&s.user)?(a.user=s.user,await Gt(this.storage,this.storageKey+"-user"),await gn(this.storage,this.storageKey,a)):a.user=Va()}if(this._debug(n,"session from storage",a),!this._isValidSession(a)){this._debug(n,"session is not valid"),a!==null&&await this._removeSession();return}const r=((o=a.expires_at)!==null&&o!==void 0?o:1/0)*1e3-Date.now()<Wa;if(this._debug(n,`session has${r?"":" not"} expired with margin of ${Wa}s`),r){if(this.autoRefreshToken&&a.refresh_token){const{error:s}=await this._callRefreshToken(a.refresh_token);s&&(console.error(s),Ua(s)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",s),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:s,error:g}=await this._getUser(a.access_token);!g&&(s!=null&&s.user)?(a.user=s.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(s){console.error("Error getting user data:",s),this._debug(n,"error getting user data, skipping SIGNED_IN notification",s)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(n,"error",a),console.error(a);return}finally{this._debug(n,"end")}}async _callRefreshToken(i){var o,n;if(!i)throw new gi;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${i.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Da;const{data:r,error:s}=await this._refreshAccessToken(i);if(s)throw s;if(!r.session)throw new gi;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const g={data:r.session,error:null};return this.refreshingDeferred.resolve(g),g}catch(r){if(this._debug(a,"error",r),Xe(r)){const s={data:null,error:r};return Ua(r)||await this._removeSession(),(o=this.refreshingDeferred)===null||o===void 0||o.resolve(s),s}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(i,o,n=!0){const a=`#_notifyAllSubscribers(${i})`;this._debug(a,"begin",o,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:i,session:o});const r=[],s=Array.from(this.stateChangeEmitters.values()).map(async g=>{try{await g.callback(i,o)}catch(h){r.push(h)}});if(await Promise.all(s),r.length>0){for(let g=0;g<r.length;g+=1)console.error(r[g]);throw r[0]}}finally{this._debug(a,"end")}}async _saveSession(i){this._debug("#_saveSession()",i),this.suppressGetSessionWarning=!0,await Gt(this.storage,`${this.storageKey}-code-verifier`);const o=Object.assign({},i),n=o.user&&o.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&o.user&&await gn(this.userStorage,this.storageKey+"-user",{user:o.user});const a=Object.assign({},o);delete a.user;const r=wl(a);await gn(this.storage,this.storageKey,r)}else{const a=wl(o);await gn(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Gt(this.storage,this.storageKey),await Gt(this.storage,this.storageKey+"-code-verifier"),await Gt(this.storage,this.storageKey+"-user"),this.userStorage&&await Gt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const i=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{i&&Kt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",i)}catch(o){console.error("removing visibilitychange callback failed",o)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const i=setInterval(()=>this._autoRefreshTokenTick(),pn);this.autoRefreshTicker=i,i&&typeof i=="object"&&typeof i.unref=="function"?i.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(i);const o=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=o,o&&typeof o=="object"&&typeof o.unref=="function"?o.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(o)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const i=this.autoRefreshTicker;this.autoRefreshTicker=null,i&&clearInterval(i);const o=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,o&&clearTimeout(o)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const i=Date.now();try{return await this._useSession(async o=>{const{data:{session:n}}=o;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((n.expires_at*1e3-i)/pn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${pn}ms, refresh threshold is ${_s} ticks`),a<=_s&&await this._callRefreshToken(n.refresh_token)})}catch(o){console.error("Auto refresh tick failed with error. This is likely a transient error.",o)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(i){if(i.isAcquireTimeout||i instanceof Qd)this._debug("auto refresh token tick lock not available");else throw i}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Kt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(i){this._debug("#visibilityChangedCallback","error",i)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(i){console.error("_handleVisibilityChange",i)}}async _onVisibilityChanged(i){const o=`#_onVisibilityChanged(${i})`;this._debug(o,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),i||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(o,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(i,o,n){const a=[`provider=${encodeURIComponent(o)}`];if(n!=null&&n.redirectTo&&a.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&a.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[r,s]=await Yo(this.storage,this.storageKey),g=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(s)}`});a.push(g.toString())}if(n!=null&&n.queryParams){const r=new URLSearchParams(n.queryParams);a.push(r.toString())}return n!=null&&n.skipBrowserRedirect&&a.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${i}?${a.join("&")}`}async _unenroll(i){try{return await this._useSession(async o=>{var n;const{data:a,error:r}=o;return r?this._returnResult({data:null,error:r}):await lt(this.fetch,"DELETE",`${this.url}/factors/${i.factorId}`,{headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(o){if(Xe(o))return this._returnResult({data:null,error:o});throw o}}async _enroll(i){try{return await this._useSession(async o=>{var n,a;const{data:r,error:s}=o;if(s)return this._returnResult({data:null,error:s});const g=Object.assign({friendly_name:i.friendlyName,factor_type:i.factorType},i.factorType==="phone"?{phone:i.phone}:i.factorType==="totp"?{issuer:i.issuer}:{}),{data:h,error:b}=await lt(this.fetch,"POST",`${this.url}/factors`,{body:g,headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return b?this._returnResult({data:null,error:b}):(i.factorType==="totp"&&h.type==="totp"&&(!((a=h==null?void 0:h.totp)===null||a===void 0)&&a.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(o){if(Xe(o))return this._returnResult({data:null,error:o});throw o}}async _verify(i){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async o=>{var n;const{data:a,error:r}=o;if(r)return this._returnResult({data:null,error:r});const s=Object.assign({challenge_id:i.challengeId},"webauthn"in i?{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_response:i.webauthn.type==="create"?gu(i.webauthn.credential_response):uu(i.webauthn.credential_response)})}:{code:i.code}),{data:g,error:h}=await lt(this.fetch,"POST",`${this.url}/factors/${i.factorId}/verify`,{body:s,headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+g.expires_in},g)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",g),this._returnResult({data:g,error:h}))})}catch(o){if(Xe(o))return this._returnResult({data:null,error:o});throw o}})}async _challenge(i){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async o=>{var n;const{data:a,error:r}=o;if(r)return this._returnResult({data:null,error:r});const s=await lt(this.fetch,"POST",`${this.url}/factors/${i.factorId}/challenge`,{body:i,headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});if(s.error)return s;const{data:g}=s;if(g.type!=="webauthn")return{data:g,error:null};switch(g.webauthn.type){case"create":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:cu(g.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:pu(g.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(o){if(Xe(o))return this._returnResult({data:null,error:o});throw o}})}async _challengeAndVerify(i){const{data:o,error:n}=await this._challenge({factorId:i.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:i.factorId,challengeId:o.id,code:i.code})}async _listFactors(){var i;const{data:{user:o},error:n}=await this.getUser();if(n)return{data:null,error:n};const a={all:[],phone:[],totp:[],webauthn:[]};for(const r of(i=o==null?void 0:o.factors)!==null&&i!==void 0?i:[])a.all.push(r),r.status==="verified"&&a[r.factor_type].push(r);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(i){var o,n,a,r;if(i)try{const{payload:m}=$r(i);let f=null;m.aal&&(f=m.aal);let p=f;const{data:{user:d},error:c}=await this.getUser(i);if(c)return this._returnResult({data:null,error:c});((n=(o=d==null?void 0:d.factors)===null||o===void 0?void 0:o.filter(y=>y.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(p="aal2");const x=m.amr||[];return{data:{currentLevel:f,nextLevel:p,currentAuthenticationMethods:x},error:null}}catch(m){if(Xe(m))return this._returnResult({data:null,error:m});throw m}const{data:{session:s},error:g}=await this.getSession();if(g)return this._returnResult({data:null,error:g});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:h}=$r(s.access_token);let b=null;h.aal&&(b=h.aal);let j=b;((r=(a=s.user.factors)===null||a===void 0?void 0:a.filter(m=>m.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(j="aal2");const v=h.amr||[];return{data:{currentLevel:b,nextLevel:j,currentAuthenticationMethods:v},error:null}}async _getAuthorizationDetails(i){try{return await this._useSession(async o=>{const{data:{session:n},error:a}=o;return a?this._returnResult({data:null,error:a}):n?await lt(this.fetch,"GET",`${this.url}/oauth/authorizations/${i}`,{headers:this.headers,jwt:n.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new gi})})}catch(o){if(Xe(o))return this._returnResult({data:null,error:o});throw o}}async _approveAuthorization(i,o){try{return await this._useSession(async n=>{const{data:{session:a},error:r}=n;if(r)return this._returnResult({data:null,error:r});if(!a)return this._returnResult({data:null,error:new gi});const s=await lt(this.fetch,"POST",`${this.url}/oauth/authorizations/${i}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:g=>({data:g,error:null})});return s.data&&s.data.redirect_url&&Kt()&&!(o!=null&&o.skipBrowserRedirect)&&window.location.assign(s.data.redirect_url),s})}catch(n){if(Xe(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(i,o){try{return await this._useSession(async n=>{const{data:{session:a},error:r}=n;if(r)return this._returnResult({data:null,error:r});if(!a)return this._returnResult({data:null,error:new gi});const s=await lt(this.fetch,"POST",`${this.url}/oauth/authorizations/${i}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:g=>({data:g,error:null})});return s.data&&s.data.redirect_url&&Kt()&&!(o!=null&&o.skipBrowserRedirect)&&window.location.assign(s.data.redirect_url),s})}catch(n){if(Xe(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async i=>{const{data:{session:o},error:n}=i;return n?this._returnResult({data:null,error:n}):o?await lt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:o.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new gi})})}catch(i){if(Xe(i))return this._returnResult({data:null,error:i});throw i}}async _revokeOAuthGrant(i){try{return await this._useSession(async o=>{const{data:{session:n},error:a}=o;return a?this._returnResult({data:null,error:a}):n?(await lt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:i.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new gi})})}catch(o){if(Xe(o))return this._returnResult({data:null,error:o});throw o}}async fetchJwk(i,o={keys:[]}){let n=o.keys.find(g=>g.kid===i);if(n)return n;const a=Date.now();if(n=this.jwks.keys.find(g=>g.kid===i),n&&this.jwks_cached_at+Sg>a)return n;const{data:r,error:s}=await lt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(s)throw s;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=a,n=r.keys.find(g=>g.kid===i),!n)?null:n}async getClaims(i,o={}){try{let n=i;if(!n){const{data:m,error:f}=await this.getSession();if(f||!m.session)return this._returnResult({data:null,error:f});n=m.session.access_token}const{header:a,payload:r,signature:s,raw:{header:g,payload:h}}=$r(n);o!=null&&o.allowExpired||Vg(r.exp);const b=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,o!=null&&o.keys?{keys:o.keys}:o==null?void 0:o.jwks);if(!b){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:r,header:a,signature:s},error:null}}const j=qg(a.alg),k=await crypto.subtle.importKey("jwk",b,j,!0,["verify"]);if(!await crypto.subtle.verify(j,k,s,Bg(`${g}.${h}`)))throw new $s("Invalid JWT signature");return{data:{claims:r,header:a,signature:s},error:null}}catch(n){if(Xe(n))return this._returnResult({data:null,error:n});throw n}}}hr.nextInstanceID={};const Su=hr,Cu="2.97.0";let Yn="";typeof Deno<"u"?Yn="deno":typeof document<"u"?Yn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Yn="react-native":Yn="node";const ku={"X-Client-Info":`supabase-js-${Yn}/${Cu}`},wu={headers:ku},zu={schema:"public"},Eu={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Au={};function fr(t){"@babel/helpers - typeof";return fr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},fr(t)}function Fu(t,i){if(fr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(fr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function Tu(t){var i=Fu(t,"string");return fr(i)=="symbol"?i:i+""}function Bu(t,i,o){return(i=Tu(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function Rl(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),o.push.apply(o,n)}return o}function Mt(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?Rl(Object(o),!0).forEach(function(n){Bu(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):Rl(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}const Iu=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),Ru=()=>Headers,_u=(t,i,o)=>{const n=Iu(o),a=Ru();return async(r,s)=>{var g;const h=(g=await i())!==null&&g!==void 0?g:t;let b=new a(s==null?void 0:s.headers);return b.has("apikey")||b.set("apikey",t),b.has("Authorization")||b.set("Authorization",`Bearer ${h}`),n(r,Mt(Mt({},s),{},{headers:b}))}};function Mu(t){return t.endsWith("/")?t:t+"/"}function Du(t,i){var o,n;const{db:a,auth:r,realtime:s,global:g}=t,{db:h,auth:b,realtime:j,global:k}=i,v={db:Mt(Mt({},h),a),auth:Mt(Mt({},b),r),realtime:Mt(Mt({},j),s),storage:{},global:Mt(Mt(Mt({},k),g),{},{headers:Mt(Mt({},(o=k==null?void 0:k.headers)!==null&&o!==void 0?o:{}),(n=g==null?void 0:g.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return t.accessToken?v.accessToken=t.accessToken:delete v.accessToken,v}function $u(t){const i=t==null?void 0:t.trim();if(!i)throw new Error("supabaseUrl is required.");if(!i.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Mu(i))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Pu=class extends Su{constructor(t){super(t)}},Ou=class{constructor(t,i,o){var n,a;this.supabaseUrl=t,this.supabaseKey=i;const r=$u(t);if(!i)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const s=`sb-${r.hostname.split(".")[0]}-auth-token`,g={db:zu,realtime:Au,auth:Mt(Mt({},Eu),{},{storageKey:s}),global:wu},h=Du(o??{},g);if(this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(a=h.global.headers)!==null&&a!==void 0?a:{},h.accessToken)this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(j,k)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(k)} is not possible`)}});else{var b;this.auth=this._initSupabaseAuthClient((b=h.auth)!==null&&b!==void 0?b:{},this.headers,h.global.fetch)}this.fetch=_u(i,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Mt({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(j=>this.realtime.setAuth(j)).catch(j=>console.warn("Failed to set initial Realtime auth token:",j)),this.rest=new kp(new URL("rest/v1",r).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch,timeout:h.db.timeout,urlLengthLimit:h.db.urlLengthLimit}),this.storage=new mg(this.storageUrl.href,this.headers,this.fetch,o==null?void 0:o.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new xp(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,i={},o={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,i,o)}channel(t,i={config:{}}){return this.realtime.channel(t,i)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,i,o;if(t.accessToken)return await t.accessToken();const{data:n}=await t.auth.getSession();return(i=(o=n.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:o,storage:n,userStorage:a,storageKey:r,flowType:s,lock:g,debug:h,throwOnError:b},j,k){const v={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Pu({url:this.authUrl.href,headers:Mt(Mt({},v),j),storageKey:r,autoRefreshToken:t,persistSession:i,detectSessionInUrl:o,storage:n,userStorage:a,flowType:s,lock:g,debug:h,throwOnError:b,fetch:k,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Wp(this.realtimeUrl.href,Mt(Mt({},t),{},{params:Mt(Mt({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,i)=>{this._handleTokenChanged(t,"CLIENT",i==null?void 0:i.access_token)})}_handleTokenChanged(t,i,o){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==o?(this.changedAccessToken=o,this.realtime.setAuth(o)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Lu=(t,i,o)=>new Ou(t,i,o);function Wu(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const i=t.version;if(i==null)return!1;const o=i.match(/^v(\d+)\./);return o?parseInt(o[1],10)<=18:!1}Wu()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Nu="https://xlzkasdskatnikuavefh.supabase.co",Uu="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM",$n=Lu(Nu,Uu),Pn="kv_store";let uo="habitaris",pi={},_l=!1;const Ee={async init(t="habitaris",i=null){uo=t;try{const{data:o,error:n}=await $n.from(Pn).select("key, value").eq("tenant_id",uo);!n&&o&&(pi={},o.forEach(a=>{pi[a.key]=a.value}),o.forEach(a=>console.log("[store] key:",a.key,"size:",(a.value||"").length)),console.log(`[store] Loaded ${o.length} keys for tenant ${uo}`))}catch(o){console.warn("[store] Preload failed, starting with empty cache:",o.message)}_l=!0},getSync(t){const i=pi[t]??null;return i!==null&&typeof i!="string"?JSON.stringify(i):i},async get(t){if(t in pi)return pi[t];try{const{data:i,error:o}=await $n.from(Pn).select("value").eq("tenant_id",uo).eq("key",t).single();if(!o&&i)return pi[t]=i.value,i.value}catch(i){console.warn(`[store] get(${t}) failed:`,i.message)}return null},set(t,i){pi[t]=i,$n.from(Pn).upsert({tenant_id:uo,key:t,value:i,updated_at:new Date().toISOString()},{onConflict:"tenant_id,key"}).then(({error:o})=>{o&&console.warn(`[store] set(${t}) cloud error:`,o.message)})},async delete(t){delete pi[t];const{error:i}=await $n.from(Pn).delete().eq("tenant_id",uo).eq("key",t);i&&console.warn(`[store] delete(${t}) error:`,i.message)},async list(t=""){const i=Object.keys(pi).filter(o=>o.startsWith(t)).map(o=>({key:o,value:pi[o]}));if(i.length>0)return{keys:i.map(o=>o.key),items:i};try{const{data:o,error:n}=await $n.from(Pn).select("key, value").eq("tenant_id",uo).like("key",`${t}%`);if(!n&&o)return o.forEach(a=>{pi[a.key]=a.value}),{keys:o.map(a=>a.key),items:o}}catch(o){console.warn(`[store] list(${t}) error:`,o.message)}return{keys:[],items:[]}},listSync(t=""){const i=Object.entries(pi).filter(([o])=>o.startsWith(t)).map(([o,n])=>({key:o,value:n}));return{keys:i.map(o=>o.key),items:i}},get ready(){return _l},get tenantId(){return uo},get cacheSize(){return Object.keys(pi).length}},va=()=>Math.random().toString(36).slice(2,11)+Date.now().toString(36),xr=()=>new Date().toISOString(),Vu=()=>xr().split("T")[0],qu={async get(t){try{const i=await window.storage.get(t);return i?JSON.parse(i.value):null}catch{return null}},async set(t,i){try{return await window.storage.set(t,JSON.stringify(i)),!0}catch{return!1}},async del(t){try{return await window.storage.delete(t),!0}catch{return!1}},async list(t){try{const i=await window.storage.list(t);return(i==null?void 0:i.keys)||[]}catch{return[]}},async getShared(t){try{const i=await window.storage.get(t,!0);return i?JSON.parse(i.value):null}catch{return null}},async setShared(t,i){try{return await window.storage.set(t,JSON.stringify(i),!0),!0}catch{return!1}}},ri=qu,en=[{id:"david",nombre:"David Parra Galera",cargo:"Director Ejecutivo y de Produccin",email:"david@habitaris.com",rol:"admin",puedeAprobar:!0,puedeFirmar:!0},{id:"ana",nombre:"Ana Mara Daz Buitrago",cargo:"Directora Creativa y de Diseo",email:"ana@habitaris.com",rol:"admin",puedeAprobar:!0,puedeFirmar:!0}],Ml="hab:crm:aprobaciones",Dl={async getAll(){return await ri.get(Ml)||[]},async getByOferta(t){return(await this.getAll()).filter(o=>o.ofertaId===t).sort((o,n)=>o.fecha>n.fecha?1:-1)},async add(t){const i=await this.getAll(),o={id:va(),fecha:xr(),...t};return i.push(o),await ri.set(Ml,i),o},async getLastByOferta(t){const i=await this.getByOferta(t);return i.length>0?i[i.length-1]:null}},tn="hab:portal",Hu={_tokenKey(t){return`${tn}:${t}`},async crear(t,i,o=0){const n=va()+va(),a={token:n,ofertaId:t,revision:o,clienteEmail:i.emailCliente||"",clienteNombre:i.cliente||"",fechaCreacion:xr(),fechaExpiracion:new Date(Date.now()+20*24*60*60*1e3).toISOString(),estado:"pendiente",respuestas:[],datosOferta:{titulo:i.ent_titulo||(i.tipoProyecto==="OBRA"?"PRESUPUESTO DE EJECUCIN":"PROPUESTA DE DISEO"),ref:i.codigoOferta||"",cliente:i.cliente||"",proyecto:i.proyecto||"",ubicacion:i.ubicacion||"",fecha:i.fechaOferta||Vu(),pvp:i._pvp||0,pvpIva:i._pvpIva||0,iva:i._iva||0,divisa:i.divisa||"COP",alcance:i.ent_alcance||"",fases:i.ent_fases||"",exclusiones:i.ent_exclusiones||"",condPago:i.ent_condPago||"",plazo:i.ent_plazo||"",garantias:i.ent_garantias||"",terminos:i.ent_terminos||"",notaLegal:i.ent_notaLegal||"",presupuesto:i.borradorLineas||[],nivelDetalle:i.ent_nivelDetalle||"capitulos",firmante:i.firmaRepresentante||"David Parra Galera"}};await ri.setShared(this._tokenKey(n),a);const r=await ri.get(`${tn}:index`)||[];return r.push({token:n,ofertaId:t,revision:o,fecha:a.fechaCreacion,estado:"pendiente"}),await ri.set(`${tn}:index`,r),a},async getByToken(t){return await ri.getShared(this._tokenKey(t))},async responder(t,i,o="",n=""){const a=await this.getByToken(t);if(!a)return null;a.respuestas.push({fecha:xr(),accion:i,comentarios:o,por:n||a.clienteNombre}),a.estado=i,await ri.setShared(this._tokenKey(t),a);const r=await ri.get(`${tn}:index`)||[],s=r.find(g=>g.token===t);return s&&(s.estado=i,await ri.set(`${tn}:index`,r)),a},async getIndex(){return await ri.get(`${tn}:index`)||[]},async getByOferta(t){const o=(await this.getIndex()).filter(a=>a.ofertaId===t),n=[];for(const a of o){const r=await this.getByToken(a.token);r&&n.push(r)}return n}},Pr="hab:notificaciones",Gu={async add(t){const i=await ri.get(Pr)||[];i.push({id:va(),fecha:xr(),leida:!1,...t}),await ri.set(Pr,i)},async getAll(){return await ri.get(Pr)||[]},async getNoLeidas(){return(await this.getAll()).filter(i=>!i.leida)},async marcarLeida(t){const i=await this.getAll(),o=i.find(n=>n.id===t);o&&(o.leida=!0,await ri.set(Pr,i))}},Ku="https://xlzkasdskatnikuavefh.supabase.co",Ju="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0MTkxNTMsImV4cCI6MjA1NTk5NTE1M30.kNYsPMsRB0GaxrF1VDqIMeGmxD_K43zQXJIFMn1KlHk",ja=Dc(Ku,Ju);function Yu(){const t="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789";let i="";for(let o=0;o<24;o++)i+=t[Math.floor(Math.random()*t.length)];return i}async function Xu(t,i,o,n=null){const a=Yu();let r=1;if(n){const{data:h}=await ja.from("offer_portals").select("revision_number").eq("token",n).single();h&&(r=(h.revision_number||1)+1)}const{data:s,error:g}=await ja.from("offer_portals").insert({token:a,offer_id:t,revision:o||"Rev."+String(r).padStart(2,"0"),offer_data:i,status:"pendiente",parent_token:n||null,revision_number:r}).select().single();if(g)throw console.error("createPortal:",g),g;return{...s,portalUrl:window.location.origin+"/portal#"+a}}async function Qu(t){const{data:i,error:o}=await ja.from("offer_portals").select("*").eq("token",t).single();return o?null:i}async function Zu(t,i,o=""){const{data:n,error:a}=await ja.from("offer_portals").update({status:i,client_comments:o,client_responded_at:new Date().toISOString()}).eq("token",t).select().single();if(a)throw console.error("respondPortal:",a),a;return n}const eh="habitaris_config",$l="https://xlzkasdskatnikuavefh.supabase.co",Pl="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM";function Rn(){try{const t=(()=>null)(eh);return{url:$l,key:Pl}}catch{return{url:$l,key:Pl}}}function _n(t){return{apikey:t,Authorization:`Bearer ${t}`,"Content-Type":"application/json",Prefer:"return=representation"}}async function Zs(t,i=""){const o=Rn();if(!o)return null;try{const n=await fetch(`${o.url}/rest/v1/${t}?${i}`,{headers:_n(o.key)});return n.ok?await n.json():null}catch{return null}}async function kr(t,i){const o=Rn();if(!o)return null;try{const n=await fetch(`${o.url}/rest/v1/${t}`,{method:"POST",headers:_n(o.key),body:JSON.stringify(i)});return n.ok?await n.json():(console.warn("Supabase insert error:",n.status),null)}catch(n){return console.warn("Supabase insert error:",n),null}}async function el(t,i,o){const n=Rn();if(!n)return null;try{const a=await fetch(`${n.url}/rest/v1/${t}?${i}`,{method:"PATCH",headers:_n(n.key),body:JSON.stringify(o)});return a.ok?await a.json():null}catch{return null}}async function th(){const t=Rn();if(!t)return{ok:!1,error:"URL o clave no configuradas"};try{const i=await fetch(`${t.url}/rest/v1/`,{headers:_n(t.key)});return i.ok?{ok:!0}:{ok:!1,error:`Error HTTP ${i.status}`}}catch(i){return{ok:!1,error:i.message}}}async function ih(){const t=Rn();if(!t)return{ok:!1,error:"Configura Supabase primero"};const i=`
    -- Form events (opens, views, time tracking)
    CREATE TABLE IF NOT EXISTS form_events (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      event_type TEXT NOT NULL DEFAULT 'open',
      link_id TEXT,
      client_name TEXT,
      client_email TEXT,
      duration_seconds INTEGER DEFAULT 0,
      user_agent TEXT,
      ip TEXT,
      metadata JSONB DEFAULT '{}'
    );

    -- Form responses (actual submitted data)
    CREATE TABLE IF NOT EXISTS form_responses (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      link_id TEXT,
      client_name TEXT,
      client_email TEXT,
      client_tel TEXT,
      module TEXT DEFAULT 'general',
      data JSONB DEFAULT '{}',
      processed BOOLEAN DEFAULT false,
      processed_at TIMESTAMPTZ,
      notes TEXT
    );

    -- Form links (track each shared link)
    CREATE TABLE IF NOT EXISTS form_links (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      link_id TEXT UNIQUE NOT NULL,
      client_name TEXT,
      client_email TEXT,
      max_uses INTEGER DEFAULT 0,
      current_uses INTEGER DEFAULT 0,
      expires_at TIMESTAMPTZ,
      active BOOLEAN DEFAULT true
    );

    -- Enable RLS but allow anon access (simple setup)
    ALTER TABLE form_events ENABLE ROW LEVEL SECURITY;
    ALTER TABLE form_responses ENABLE ROW LEVEL SECURITY;
    ALTER TABLE form_links ENABLE ROW LEVEL SECURITY;

    -- Policies: allow all for anon (single-tenant app)
    DO $$ BEGIN
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_events') THEN
        CREATE POLICY anon_all_events ON form_events FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_responses') THEN
        CREATE POLICY anon_all_responses ON form_responses FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_links') THEN
        CREATE POLICY anon_all_links ON form_links FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
    END $$;
  `;try{return(await fetch(`${t.url}/rest/v1/rpc/exec_sql`,{method:"POST",headers:_n(t.key),body:JSON.stringify({query:i})})).ok?{ok:!0}:await Ol(t)}catch{return await Ol(t)}}async function Ol(t){const i=["form_events","form_responses","form_links"],o=[];for(const n of i)try{(await fetch(`${t.url}/rest/v1/${n}?select=id&limit=1`,{headers:_n(t.key)})).ok||o.push(n)}catch{o.push(n)}return o.length===0?{ok:!0,msg:"Tablas ya existen"}:{ok:!1,error:"manual_sql",missing:o,sql:Ps()}}function Ps(){return`-- Ejecuta esto en Supabase  SQL Editor  New Query  Run

CREATE TABLE IF NOT EXISTS form_events (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  event_type TEXT NOT NULL DEFAULT 'open',
  link_id TEXT,
  client_name TEXT,
  client_email TEXT,
  duration_seconds INTEGER DEFAULT 0,
  user_agent TEXT,
  metadata JSONB DEFAULT '{}'
);

CREATE TABLE IF NOT EXISTS form_responses (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  link_id TEXT,
  client_name TEXT,
  client_email TEXT,
  client_tel TEXT,
  module TEXT DEFAULT 'general',
  data JSONB DEFAULT '{}',
  processed BOOLEAN DEFAULT false,
  processed_at TIMESTAMPTZ,
  notes TEXT
);

CREATE TABLE IF NOT EXISTS form_links (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  link_id TEXT UNIQUE NOT NULL,
  client_name TEXT,
  client_email TEXT,
  client_tel TEXT,
  max_uses INTEGER DEFAULT 0,
  current_uses INTEGER DEFAULT 0,
  expires_at TIMESTAMPTZ,
  active BOOLEAN DEFAULT true
);

-- Habilitar RLS
ALTER TABLE form_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE form_responses ENABLE ROW LEVEL SECURITY;
ALTER TABLE form_links ENABLE ROW LEVEL SECURITY;

-- Polticas de acceso
CREATE POLICY anon_all_events ON form_events FOR ALL TO anon USING (true) WITH CHECK (true);
CREATE POLICY anon_all_responses ON form_responses FOR ALL TO anon USING (true) WITH CHECK (true);
CREATE POLICY anon_all_links ON form_links FOR ALL TO anon USING (true) WITH CHECK (true);
`}async function oh(t,i,o,n,a){return kr("form_events",{form_id:t,form_name:i,event_type:"open",link_id:o||null,client_name:n||null,client_email:a||null,user_agent:navigator.userAgent||null})}async function Ll(t,i,o){return kr("form_events",{form_id:t,event_type:"close",link_id:i||null,duration_seconds:Math.round(o)})}async function nh(t,i,o,n,a){return kr("form_events",{form_id:t,form_name:i,event_type:"submit",link_id:o||null,client_name:n||null,client_email:a||null})}async function rh(t){return kr("form_responses",t)}async function ah(){return Zs("form_responses","order=created_at.desc&limit=500")}async function sh(t){return kr("form_links",t)}async function tc(t){const i=await Zs("form_links",`link_id=eq.${t}&limit=1`);return i&&i.length>0?i[0]:null}async function lh(t){const i=await tc(t);return i?el("form_links",`link_id=eq.${t}`,{current_uses:(i.current_uses||0)+1}):null}async function dh(t){return el("form_links",`link_id=eq.${t}`,{active:!1})}async function ch(t){return el("form_links",`link_id=eq.${t}`,{active:!0})}async function ph(){return Zs("form_links","order=created_at.desc")}function Ni(){return Rn()!==null}const rt={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",border:"#E0E0E0",success:"#111111",successBg:"#E8F4EE",accent:"#3B3B3B",accentBg:"#F0F0F0",gold:"#C9A84C"},Pi={fontFamily:"'DM Sans',sans-serif"};function gh(){try{const t=window.location.hash.slice(1);return t?JSON.parse(decodeURIComponent(atob(t))):null}catch{return null}}function ic(t){try{return btoa(encodeURIComponent(JSON.stringify(t)))}catch{return""}}function Wl({campo:t,value:i,onChange:o,accent:n,allVals:a}){const{tipo:r,label:s,placeholder:g,required:h}=t,b=n||rt.ink,j={...Pi,fontSize:12,fontWeight:600,color:rt.ink,display:"block",marginBottom:6},k={...Pi,width:"100%",padding:"12px 16px",border:"1px solid "+rt.border,borderRadius:8,fontSize:14,color:rt.ink,boxSizing:"border-box",background:"#fff",outline:"none"};let v=t.opciones||[],m=s;if(t.dynamicOpciones&&a){const f=a[t.dynamicOpciones.dependsOn]||"",p=t.dynamicOpciones.map[f];p?v=p:t.dynamicOpciones.fallback?v=t.dynamicOpciones.fallback:v=[]}if(t.dynamicLabel&&a){const f=a[t.dynamicLabel.dependsOn]||"",p=t.dynamicLabel.map[f];p&&(m=p)}if(r==="tel_combo"&&a){const f=t.paisRef||"",p=a[f]||"",d={Colombia:"+57",Espaa:"+34",Mxico:"+52",Chile:"+56",Per:"+51",Ecuador:"+593",Argentina:"+54",Panam:"+507","Estados Unidos":"+1",Otro:"+"},c="_cod_"+t.id,l=a[c]||d[p]||"+57",x=t.opciones||["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"];return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("select",{value:l,onChange:y=>o(i,y.target.value),style:{...k,width:90,flexShrink:0,borderRadius:"8px 0 0 8px",borderRight:"none",fontWeight:700,fontSize:13,color:"#3B3B3B",background:"#F5F4F1"},children:x.map(y=>e.jsx("option",{value:y,children:y},y))}),e.jsx("input",{type:"tel",value:i||"",onChange:y=>o(y.target.value),placeholder:g||"",style:{...k,flex:1,borderRadius:"0 8px 8px 0"}})]})]})}if(["text","email","tel","number","date"].includes(r))return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("input",{type:r,value:i||"",onChange:f=>o(f.target.value),placeholder:g||"",style:k})]});if(r==="textarea")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("textarea",{value:i||"",onChange:f=>o(f.target.value),rows:3,placeholder:g||"",style:{...k,resize:"vertical"}})]});if(r==="select"||r==="rango")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsxs("select",{value:i||"",onChange:f=>o(f.target.value),style:k,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),(v||[]).map(f=>e.jsx("option",{value:f,children:f},f))]})]});if(r==="chips"){const f=Array.isArray(i)?i:[];return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:6},children:(v||[]).map(p=>{const d=f.includes(p);return e.jsx("button",{type:"button",onClick:()=>o(d?f.filter(c=>c!==p):[...f,p]),style:{...Pi,padding:"8px 16px",fontSize:12,fontWeight:d?700:400,borderRadius:20,border:d?"2px solid "+b:"1px solid "+rt.border,background:d?b:"#fff",color:d?"#fff":rt.inkMid,cursor:"pointer",transition:"all .15s"},children:p},p)})})]})}if(r==="radio")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginTop:6},children:(v||[]).map(f=>e.jsxs("label",{style:{...Pi,display:"flex",alignItems:"center",gap:10,fontSize:13,cursor:"pointer",padding:"10px 14px",borderRadius:8,background:i===f?b:"#fff",color:i===f?"#fff":rt.ink,border:i===f?"2px solid "+b:"1px solid "+rt.border,transition:"all .15s"},children:[e.jsx("input",{type:"radio",checked:i===f,onChange:()=>o(f),style:{display:"none"}}),f]},f))})]});if(r==="rating"){const f=parseInt(i)||0;return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:6},children:[1,2,3,4,5].map(p=>e.jsx("button",{type:"button",onClick:()=>o(p),style:{background:"none",border:"none",cursor:"pointer",fontSize:32,filter:p<=f?"none":"grayscale(1)",opacity:p<=f?1:.3},children:""},p))})]})}return r==="yesno"?e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginTop:6},children:["S","No"].map(f=>e.jsx("button",{type:"button",onClick:()=>o(f),style:{...Pi,padding:"12px 32px",fontSize:14,fontWeight:i===f?700:400,borderRadius:24,border:i===f?"2px solid "+b:"1px solid "+rt.border,background:i===f?b:"#fff",color:i===f?"#fff":rt.inkMid,cursor:"pointer",transition:"all .15s",flex:1,textAlign:"center"},children:f},f))})]}):r==="info"?e.jsx("div",{style:{marginBottom:20,padding:"14px 18px",background:rt.accentBg,borderRadius:8,border:"1px solid "+rt.accent+"22"},children:e.jsx("p",{style:{...Pi,fontSize:12,color:rt.accent,margin:0,lineHeight:1.6},children:m})}):r==="seccion"?e.jsxs("div",{style:{marginTop:28,marginBottom:14,paddingTop:18,borderTop:"2px solid "+b},children:[e.jsx("h3",{style:{...Pi,fontSize:15,fontWeight:700,color:rt.ink,margin:0},children:m}),t.desc&&e.jsx("p",{style:{...Pi,fontSize:11,color:rt.inkLight,margin:"4px 0 0"},children:t.desc})]}):null}function uh(){var be,I;const[t,i]=F.useState(null),[o,n]=F.useState({}),[a,r]=F.useState(!1),[s,g]=F.useState(""),[h,b]=F.useState(0),[j,k]=F.useState("next"),[v,m]=F.useState(0),[f,p]=F.useState(null),d=F.useRef(null),c=F.useRef(Date.now());if(F.useEffect(()=>{i(gh())},[]),F.useEffect(()=>{var Le;if(!t)return;const N=t.campos||[],q=t.cliente||null;if(q){const Ie={};N.forEach(dt=>{q.email&&dt.mapKey==="email"&&(Ie[dt.id]=q.email),q.nombre&&dt.mapKey==="nombre"&&(Ie[dt.id]=q.nombre),q.tel&&dt.mapKey==="telefono"&&(Ie[dt.id]=q.tel)}),n(dt=>({...Ie,...dt}))}const J=((Le=t.config)==null?void 0:Le.paisProyecto)||"Colombia",R={};N.forEach(Ie=>{Ie.mapKey==="pais"&&(R[Ie.id]=J)}),n(Ie=>({...R,...Ie}));const ie=t.linkConfig||{};if(ie.blocked){p("blocked");return}if(ie.fechaCaducidad&&new Date(ie.fechaCaducidad)<new Date){p("expired");return}if(ie.maxUsos&&ie.maxUsos>0){const Ie="hab_link_uses_"+(ie.linkId||t.id||"");if(parseInt(Ee.getSync(Ie)||"0")>=ie.maxUsos){p("maxuses");return}}const fe=ie.linkId;fe&&Ni()&&tc(fe).then(Ie=>{if(Ie){if(!Ie.active){p("inactive");return}if(Ie.expires_at&&new Date(Ie.expires_at)<new Date){p("expired");return}if(Ie.max_uses>0&&Ie.current_uses>=Ie.max_uses){p("maxuses");return}}}).catch(()=>{}),c.current=Date.now(),Ni()&&oh(t.id,t.nombre,ie.linkId,q==null?void 0:q.nombre,q==null?void 0:q.email).catch(()=>{});const Me=()=>{const Ie=Math.round((Date.now()-c.current)/1e3);Ni()&&Ll(t.id,ie.linkId,Ie).catch(()=>{})};return window.addEventListener("beforeunload",Me),()=>window.removeEventListener("beforeunload",Me)},[t]),!t)return e.jsxs("div",{style:{minHeight:"100vh",background:rt.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');"}),e.jsxs("div",{style:{background:rt.surface,borderRadius:12,padding:40,maxWidth:400,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:40,marginBottom:16},children:""}),e.jsx("h2",{style:{...Pi,fontSize:18,fontWeight:700,color:rt.ink},children:"Formulario no disponible"}),e.jsx("p",{style:{...Pi,fontSize:13,color:rt.inkMid,marginTop:8},children:"Este enlace no es vlido o ha expirado."})]})]});if(f){const N={expired:{icon:"",title:"Formulario expirado",desc:"La fecha de caducidad de este formulario ha pasado. Contacta a quien te lo envi."},maxuses:{icon:"",title:"Lmite de envos alcanzado",desc:"Este formulario ya fue completado el nmero mximo de veces permitido."},inactive:{icon:"",title:"Enlace desactivado",desc:"Este enlace ha sido desactivado. Contacta a quien te lo envi."},blocked:{icon:"",title:"Formulario bloqueado",desc:"Este formulario ha sido bloqueado por el remitente. Si crees que es un error, contacta a quien te lo envi."}},q=N[f]||N.expired,J=((be=t==null?void 0:t.marca)==null?void 0:be.tipografia)||"DM Sans";return e.jsxs("div",{style:{minHeight:"100vh",background:rt.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${J.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:rt.surface,borderRadius:12,padding:40,maxWidth:400,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[((I=t==null?void 0:t.marca)==null?void 0:I.logo)&&e.jsx("img",{src:t.marca.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:q.icon}),e.jsx("h2",{style:{fontFamily:`'${J}',sans-serif`,fontSize:18,fontWeight:700,color:rt.ink},children:q.title}),e.jsx("p",{style:{fontFamily:`'${J}',sans-serif`,fontSize:13,color:rt.inkMid,marginTop:8,lineHeight:1.6},children:q.desc})]})]})}const l=t.campos||[],x=t.config||{},y=t.cliente||null,u=t.marca||{},S=x.colorAccent||u.colorPrimario||"#111111",A=u.colorSecundario||"#3B3B3B",E=u.colorAcento||"#C9A84C",w=u.tipografia||"DM Sans",_={fontFamily:`'${w}',sans-serif`},z=x.vista||"pasos",T=x.botonTexto||"Enviar formulario",L=(N,q)=>{n(J=>({...J,[N]:q})),g("")},Z=N=>K(N)?P(N)?se(N):N.tipo==="tel_combo"?e.jsx(Wl,{campo:N,value:o[N.id],onChange:(q,J)=>{J!==void 0?L("_cod_"+N.id,J):L(N.id,q)},accent:S,allVals:o},N.id):e.jsx(Wl,{campo:N,value:o[N.id],onChange:q=>L(N.id,q),accent:S,allVals:o},N.id):null,K=N=>{if(!N.logica||!N.logica.fieldId||!N.logica.value&&!N.logica.notValues&&!N.logica.notValue)return!0;const q=o[N.logica.fieldId];if(N.logica.notValues)return!N.logica.notValues.includes(String(q||""));if(N.logica.notValue)return String(q||"")!==N.logica.notValue;const J=N.logica.value;return Array.isArray(q)?q.includes(J):String(q||"")===J},P=N=>y?!!(y.email&&N.mapKey==="email"||y.nombre&&N.mapKey==="nombre"||y.tel&&y.tel.trim()&&(N.mapKey==="telefono"||N.tipo==="tel_combo")||N.mapKey==="pais"):N.mapKey==="pais",te=[],he=l.find(N=>N.mapKey==="aceptaPrivacidad"),Q=l.find(N=>N.tipo==="info"&&N.label&&N.label.includes("Aviso de Privacidad"));he&&te.push({title:"Aviso de Privacidad",desc:"Antes de comenzar, necesitamos tu autorizacin",icon:"",fields:[Q,he].filter(Boolean),isPrivacy:!0});let Se={title:x.titulo||t.nombre||"Formulario",desc:x.subtitulo||"",icon:"",fields:[]};l.forEach(N=>{N.id===(he&&he.id)||N.id===(Q&&Q.id)||(N.tipo==="seccion"?(Se.fields.length>0&&te.push(Se),Se={title:N.label,desc:N.desc||"",icon:"",fields:[]}):Se.fields.push(N))}),Se.fields.length>0&&te.push(Se);const ae=te.filter(N=>N.isPrivacy||N.fields.some(q=>K(q)));if(he&&o[he.id]==="No")return e.jsxs("div",{style:{minHeight:"100vh",background:rt.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${w.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:rt.surface,borderRadius:12,padding:40,maxWidth:480,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[u.logo&&e.jsx("img",{src:u.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),e.jsx("h2",{style:{..._,fontSize:20,fontWeight:700,color:rt.ink},children:"Gracias por tu tiempo"}),e.jsx("p",{style:{..._,fontSize:13,color:rt.inkMid,lineHeight:1.6,marginTop:8},children:"Para continuar necesitamos tu autorizacin para el tratamiento de datos personales."})]})]});const M=!he||o[he.id]==="S"?h:0,B=ae.length,H=ae[M]||ae[0],ee=M>=B-1,D=l.filter(N=>N.required&&N.tipo!=="seccion"&&N.tipo!=="info").length,O=l.filter(N=>N.required&&N.tipo!=="seccion"&&N.tipo!=="info"&&o[N.id]&&(Array.isArray(o[N.id])?o[N.id].length>0:!0)).length,le=D>0?Math.round(O/D*100):0,re=B>1?Math.round(M/(B-1)*100):0,de=(N,q)=>{k(q||"next"),m(J=>J+1),b(N),g(""),d.current&&d.current.scrollIntoView({behavior:"smooth"})},G=()=>{if(!H)return!0;for(const N of H.fields)if(K(N)&&N.required&&N.tipo!=="seccion"&&N.tipo!=="info"){const q=o[N.id];if(!q||Array.isArray(q)&&q.length===0)return g('El campo "'+N.label+'" es obligatorio.'),!1}return!0},ce=()=>{for(const N of l)if(K(N)&&N.required&&N.tipo!=="seccion"&&N.tipo!=="info"){const q=o[N.id];if(!q||Array.isArray(q)&&q.length===0)return g('El campo "'+N.label+'" es obligatorio.'),!1}return!0},V=()=>{G()&&(ee?W():de(M+1,"next"))},Y=()=>{M>0&&de(M-1,"prev")},W=async()=>{if(z==="pasos"&&!G()||z==="scroll"&&!ce())return;const N=t.linkConfig||{},q={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36)};q.fecha=new Date().toISOString().split("T")[0],q.formularioId=t.id,q.formularioNombre=t.nombre,y&&(q.clienteNombre=y.nombre,q.clienteEmail=y.email,q.clienteTel=y.tel);const J=l.find(R=>R.tipo==="tel_combo");if(J&&o[J.id]){const R=(o["_cod_"+J.id]||"")+" "+o[J.id];q.clienteTel=q.clienteTel||R,J.mapKey&&(q[J.mapKey]=o[J.id]),J.codMapKey&&(q[J.codMapKey]=o["_cod_"+J.id]||"")}l.forEach(R=>{R.tipo!=="seccion"&&o[R.id]!==void 0&&(q[R.mapKey||R.id]=o[R.id]),R.tipo==="tel_combo"&&R.codMapKey&&(q[R.codMapKey]=o["_cod_"+R.id]||"")});try{const R="hab:briefing:"+q.id;Ee.set(R,JSON.stringify(q))}catch{}try{const R="hab:form:responses";let ie=[];try{const fe=Ee.getSync(R);fe&&(ie=JSON.parse(fe))}catch{}ie.push({id:q.id,formId:t.id,fecha:q.fecha,nombre:q.nombre||q.email||""}),Ee.set(R,JSON.stringify(ie))}catch{}if(Ni())try{await rh({form_id:t.id,form_name:t.nombre,link_id:N.linkId||null,client_name:(y==null?void 0:y.nombre)||q.clienteNombre||null,client_email:(y==null?void 0:y.email)||q.clienteEmail||null,client_tel:(y==null?void 0:y.tel)||q.clienteTel||null,module:t.modulo||x.modulo||"general",data:q}),await nh(t.id,t.nombre,N.linkId,y==null?void 0:y.nombre,y==null?void 0:y.email);const R=Math.round((Date.now()-c.current)/1e3);R>0&&await Ll(t.id,N.linkId,R).catch(()=>{}),N.linkId&&await lh(N.linkId)}catch(R){console.warn("Supabase save error:",R)}if(N.maxUsos&&N.maxUsos>0){const R="hab_link_uses_"+(N.linkId||t.id||""),ie=parseInt(Ee.getSync(R)||"0");Ee.set(R,String(ie+1))}r(!0);try{const R=l.filter(Ze=>{var mt;return(mt=Ze.scoring)==null?void 0:mt.enabled});let ie="";if(R.length>0){let Ze=0,mt=0,Yt=0,_t=0,oi=0;const Ii=[];R.forEach(Vt=>{const di=Vt.scoring.weight||1,rl=Vt.mapKey||Vt.id;let Zi=o[Vt.id];if(Zi===void 0)return;mt+=di;const Tr=Vt.scoring.rules||{};let X="neutral";if(Array.isArray(Zi)){const vt=Zi.map(At=>Tr[At]||"neutral");vt.includes("red")?X="red":vt.every(At=>At==="green")?X="green":X="neutral"}else X=Tr[String(Zi)]||"neutral";let Te=X==="green"?di:X==="neutral"?di*.5:0;Ze+=Te,X==="green"?Yt++:X==="red"?_t++:oi++;const Pe=X==="green"?"":X==="red"?"":"",et=X==="green"?"#111111":X==="red"?"#B91C1C":"#8C6A00",gt=Array.isArray(Zi)?Zi.join(", "):Zi;Ii.push(`<tr><td style="padding:5px 10px;font-size:11px;font-weight:600;">${Vt.label}</td><td style="padding:5px 10px;font-size:11px;">${gt}</td><td style="padding:5px 10px;text-align:center;font-weight:700;color:${et};">${Te}/${di}</td><td style="padding:5px 10px;text-align:center;">${Pe}</td></tr>`)});const go=mt>0?Math.round(Ze/mt*100)/10:0,ki=go>=7?"green":go>=4?"yellow":"red",Qi={green:{bg:"#E8F4EE",text:"#111111"},yellow:{bg:"#FAF0E0",text:"#8C6A00"},red:{bg:"#FAE8E8",text:"#B91C1C"}}[ki],Ar=ki==="green"?" Cliente potencial":ki==="yellow"?" Revisar":" No califica",Fr=ki==="green"?"Contactar en las prximas 24h.":ki==="yellow"?"Agendar llamada exploratoria.":"Responder cortsmente y archivar.";ie=`<div style="margin:16px 0;border:1px solid ${Qi.text}33;border-radius:8px;overflow:hidden;">
          <div style="display:flex;align-items:center;gap:14px;padding:14px 16px;background:${Qi.bg};">
            <div style="font-size:24px;font-weight:800;color:${Qi.text};">${go.toFixed(1)}/10</div>
            <div><div style="font-size:13px;font-weight:700;color:${Qi.text};">${Ar}</div><div style="font-size:9px;color:${Qi.text};">${Fr}</div></div>
            <div style="margin-left:auto;display:flex;gap:8px;"><span>${Yt}</span><span>${oi}</span><span>${_t}</span></div>
          </div>
          <table style="width:100%;border-collapse:collapse;">${Ii.join("")}</table>
        </div>`}let fe=ie,Me="";l.forEach(Ze=>{if(Ze.tipo==="seccion"){Me=Ze.label,fe+=`<div style="margin-top:16px;padding:10px 14px;background:#F5F5F5;border-radius:6px;border-left:3px solid #C9A84C;">
            <p style="margin:0;font-size:12px;font-weight:bold;color:#111;">${Ze.label}</p>
            ${Ze.desc?`<p style="margin:2px 0 0;font-size:10px;color:#888;">${Ze.desc}</p>`:""}
          </div>`;return}if(Ze.tipo==="info")return;const mt=o[Ze.id];if(mt===void 0||mt===""||Array.isArray(mt)&&mt.length===0)return;const Yt=Array.isArray(mt)?mt.join(", "):mt;fe+=`<div style="padding:8px 14px;border-bottom:1px solid #f0f0f0;">
          <p style="margin:0;font-size:10px;color:#888;font-weight:600;">${Ze.label}</p>
          <p style="margin:3px 0 0;font-size:13px;color:#111;">${Yt}</p>
        </div>`});const Le=(y==null?void 0:y.nombre)||q.clienteNombre||q.nombre||"Sin nombre",Ie=(y==null?void 0:y.email)||q.clienteEmail||q.email||"",dt=(y==null?void 0:y.tel)||q.clienteTel||q.telefono||"";await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:"service_6x3478l",template_id:"template_6lla2i8",user_id:"64nk2FHknwpLqc1p4",template_params:{form_name:t.nombre||"Formulario",client_name:Le,client_email:Ie,client_tel:dt,fecha:q.fecha+"  "+new Date().toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}),contenido:fe}})})}catch(R){console.warn("Email notification error:",R)}};if(a)return e.jsxs("div",{style:{minHeight:"100vh",background:rt.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${w.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:rt.surface,borderRadius:12,padding:40,maxWidth:480,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[u.logo&&e.jsx("img",{src:u.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),e.jsx("h2",{style:{..._,fontSize:20,fontWeight:700,color:rt.success,margin:"0 0 8px"},children:"Enviado!"}),e.jsx("p",{style:{..._,fontSize:13,color:rt.inkMid,lineHeight:1.6},children:x.mensajeExito||"Gracias por completar el formulario."}),u.empresa&&e.jsxs("p",{style:{..._,fontSize:10,color:rt.inkLight,marginTop:16},children:[u.empresa,u.slogan?`  ${u.slogan}`:""]})]})]});const se=N=>{if(N.tipo==="tel_combo"){const q=o["_cod_"+N.id]||"+57";return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:{..._,fontSize:12,fontWeight:600,color:rt.ink,display:"block",marginBottom:6},children:[N.label," ",e.jsx("span",{style:{fontSize:9,color:A,fontWeight:400},children:" prellenado"})]}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("div",{style:{..._,width:90,flexShrink:0,padding:"12px 0",border:`1px solid ${A}33`,borderRadius:"8px 0 0 8px",borderRight:"none",fontSize:14,color:A,background:A+"15",fontWeight:700,textAlign:"center"},children:q}),e.jsx("input",{type:"text",value:o[N.id]||"",disabled:!0,style:{..._,flex:1,padding:"12px 16px",border:`1px solid ${A}33`,borderRadius:"0 8px 8px 0",fontSize:14,color:A,boxSizing:"border-box",background:A+"15",fontWeight:600}})]})]},N.id)}return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:{..._,fontSize:12,fontWeight:600,color:rt.ink,display:"block",marginBottom:6},children:[N.label," ",e.jsx("span",{style:{fontSize:9,color:A,fontWeight:400},children:" prellenado"})]}),e.jsx("input",{type:"text",value:o[N.id]||"",disabled:!0,style:{..._,width:"100%",padding:"12px 16px",border:`1px solid ${A}33`,borderRadius:8,fontSize:14,color:A,boxSizing:"border-box",background:A+"15",fontWeight:600}})]},N.id)},ge=()=>e.jsxs("div",{style:{background:S,padding:"14px 24px"},children:[e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[u.logo?e.jsx("img",{src:u.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("div",{style:{..._,fontWeight:700,fontSize:14,letterSpacing:3,color:"#fff",textTransform:"uppercase"},children:u.empresa||"HABITARIS"}),u.slogan&&e.jsx("div",{style:{..._,fontSize:7,letterSpacing:2,color:"rgba(255,255,255,.4)",textTransform:"uppercase"},children:u.slogan})]}),e.jsx("div",{style:{..._,fontSize:10,color:"rgba(255,255,255,.5)"},children:z==="pasos"?"Paso "+(M+1)+" de "+B:le+"% completo"})]}),e.jsx("div",{style:{maxWidth:640,margin:"8px auto 0",height:3,background:"rgba(255,255,255,.15)",borderRadius:2},children:e.jsx("div",{style:{width:(z==="pasos"?re:le)+"%",height:"100%",background:E,borderRadius:2,transition:"width .4s ease"}})})]}),ue=()=>!y||z==="pasos"&&M!==(he?1:0)?null:e.jsxs("div",{style:{background:A+"15",border:`1px solid ${A}22`,borderRadius:10,padding:"14px 18px",marginBottom:20,display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:A,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,flexShrink:0},children:(y.nombre||"?")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{style:{..._,fontSize:13,fontWeight:700,color:A},children:["Formulario para: ",y.nombre||y.email]}),y.email&&e.jsx("div",{style:{..._,fontSize:10,color:A+"99"},children:y.email})]})]}),ye=()=>s?e.jsxs("div",{style:{..._,fontSize:12,color:"#B91C1C",textAlign:"center",margin:"14px 0",padding:"10px 16px",background:"#FAE8E8",borderRadius:6,border:"1px solid #B91C1C22"},children:[" ",s]}):null;return z==="scroll"?e.jsxs("div",{style:{minHeight:"100vh",background:rt.bg},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${w.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0}body{font-family:'${w}',sans-serif}input:focus,textarea:focus,select:focus{border-color:${S}!important;box-shadow:0 0 0 3px ${S}15}`}),e.jsx(ge,{}),e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",padding:"28px 20px 100px"},children:[e.jsx(ue,{}),e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("h1",{style:{..._,fontSize:22,fontWeight:700,margin:"0 0 6px"},children:x.titulo||t.nombre||"Formulario"}),x.subtitulo&&e.jsx("p",{style:{..._,fontSize:13,color:rt.inkMid},children:x.subtitulo})]}),e.jsx("div",{style:{background:rt.surface,borderRadius:12,padding:"28px 28px 12px",border:"1px solid "+rt.border,boxShadow:"0 2px 16px rgba(0,0,0,.04)"},children:l.map(N=>Z(N))}),e.jsx(ye,{})]}),e.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:rt.surface,borderTop:"1px solid "+rt.border,padding:"12px 20px",zIndex:200,boxShadow:"0 -4px 20px rgba(0,0,0,.06)"},children:e.jsx("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"center"},children:e.jsxs("button",{onClick:W,style:{..._,padding:"14px 40px",background:S,color:"#fff",border:"none",borderRadius:8,fontSize:15,fontWeight:700,cursor:"pointer"},children:[T," "]})})})]}):e.jsxs("div",{style:{minHeight:"100vh",background:rt.bg},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${w.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0}body{font-family:'${w}',sans-serif}@keyframes slideNext{from{opacity:0;transform:translateX(40px)}to{opacity:1;transform:translateX(0)}}@keyframes slidePrev{from{opacity:0;transform:translateX(-40px)}to{opacity:1;transform:translateX(0)}}.step-next{animation:slideNext .3s ease both}.step-prev{animation:slidePrev .3s ease both}input:focus,textarea:focus,select:focus{border-color:${S}!important;box-shadow:0 0 0 3px ${S}15}`}),e.jsx("div",{ref:d}),e.jsx(ge,{}),e.jsx("div",{style:{maxWidth:640,margin:"0 auto",padding:"16px 20px 0"},children:e.jsx("div",{style:{display:"flex",gap:4,justifyContent:"center"},children:ae.map((N,q)=>e.jsx("div",{style:{height:4,flex:1,maxWidth:40,borderRadius:2,background:q<M?rt.success:q===M?S:rt.border,transition:"background .3s"}},q))})}),e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",padding:"20px 20px 140px"},children:[e.jsx(ue,{}),e.jsxs("div",{className:j==="next"?"step-next":"step-prev",children:[e.jsxs("div",{style:{marginBottom:20},children:[H&&H.icon&&e.jsx("div",{style:{fontSize:28,marginBottom:4},children:H.icon}),e.jsx("h2",{style:{..._,fontSize:22,fontWeight:700,color:rt.ink,margin:"0 0 4px"},children:H&&H.title}),H&&H.desc&&e.jsx("p",{style:{..._,fontSize:13,color:rt.inkMid},children:H.desc})]}),e.jsx("div",{style:{background:rt.surface,borderRadius:12,padding:"28px 28px 12px",border:"1px solid "+rt.border,boxShadow:"0 2px 16px rgba(0,0,0,.04)"},children:H&&H.fields.map(N=>N.tipo==="seccion"?null:Z(N))}),e.jsx(ye,{})]},v)]}),e.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:rt.surface,borderTop:"1px solid "+rt.border,padding:"14px 20px",zIndex:200,boxShadow:"0 -4px 20px rgba(0,0,0,.06)"},children:e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[M>0?e.jsx("button",{onClick:Y,style:{..._,padding:"12px 24px",background:"#fff",color:rt.ink,border:"1px solid "+rt.border,borderRadius:8,fontSize:13,fontWeight:600,cursor:"pointer"},children:" Atrs"}):e.jsx("div",{}),e.jsxs("div",{style:{..._,fontSize:10,color:rt.inkLight},children:[M+1," / ",B]}),e.jsx("button",{onClick:V,style:{..._,padding:"12px 32px",background:S,color:"#fff",border:"none",borderRadius:8,fontSize:14,fontWeight:700,cursor:"pointer"},children:ee?(T||"Enviar")+" ":"Siguiente "})]})})]})}const Nl=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 14px; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; color: #111; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
    input:focus, select:focus, textarea:focus { outline: none; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    .fade { animation: fadeUp .2s ease; }
    @media print {
      .no-print { display:none!important; visibility:hidden!important; height:0!important; overflow:hidden!important; margin:0!important; padding:0!important; }
      body { background:#fff!important; -webkit-print-color-adjust:exact; print-color-adjust:exact; margin:0; padding:0; font-size:10pt; line-height:1.55; color:#111; }
      * { box-shadow:none!important; animation:none!important; }
      @page { size:A4; margin:12mm 16mm 14mm 16mm; }
      main,[style*="marginLeft"]{ margin-left:0!important; max-width:100%!important; padding:0!important; }
      div[style*="position: fixed"],div[style*="position:fixed"]{ display:none!important; }
      div[style*="width: 200"],div[style*="width:200px"]{ display:none!important; width:0!important; }
      table { page-break-inside:auto; width:100%!important; border-collapse:collapse; font-size:9pt; }
      tr { page-break-inside:avoid; }
      h1,h2,h3 { page-break-after:avoid; }
      img { max-width:100%!important; }
      input,select { border:none!important; background:transparent!important; padding:1px 0!important; font-size:10pt!important; -webkit-appearance:none!important; color:#111!important; font-family:'DM Sans',sans-serif!important; }
      textarea { display:none!important; }
      .ptr { display:block!important; white-space:pre-wrap; font-size:10pt; line-height:1.55; color:#111; }
      button { display:none!important; }
      .print-only { display:block!important; }
      .print-flex { display:flex!important; }
      .print-page-break { page-break-before:always; }
      .print-section { page-break-inside:avoid; margin-bottom:10pt!important; }
      .p-cover { display:flex!important; flex-direction:column; justify-content:center; align-items:center; min-height:92vh; page-break-after:always; text-align:center; }
      .p-hdr { display:flex!important; justify-content:space-between; align-items:center; border-bottom:1.5pt solid #111; padding-bottom:6pt; margin-bottom:12pt; }
    }
    @media (max-width:1200px) {
      [style*="gridTemplateColumns: 1fr 1fr 1fr"]{ grid-template-columns:1fr 1fr!important; }
    }
    @media (max-width:900px) {
      [style*="gridTemplateColumns: 1fr 1fr 1fr"],[style*="gridTemplateColumns: 1fr 1fr"]{ grid-template-columns:1fr!important; }
    }
    .print-only,.print-flex,.p-cover,.p-hdr,.ptr { display:none; }
  `}),C={bg:"#F5F4F1",surface:"#FFFFFF",sidebar:"#111111",sidebarHov:"#1C1C1C",sidebarAct:"#242424",ink:"#111111",inkMid:"#555555",inkLight:"#999999",inkXLight:"#BBBBBB",border:"#E0E0E0",borderMid:"#CCCAC4",accentBg:"#EDEBE7",success:"#2B7A52",successBg:"#E6F4EC",warning:"#8A6020",warningBg:"#FAF2E2",error:"#B91C1C",errorBg:"#FAE8E8",info:"#2A5F8C",infoBg:"#E8F1FA",shadow:"0 1px 2px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04)",shadowMd:"0 4px 20px rgba(0,0,0,0.10)",accent:"#111111",danger:"#B91C1C"},tl=({size:t=34,color:i="#fff"})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"4.5",y:"2.5",width:"25",height:"25",stroke:i,strokeWidth:"0.7",opacity:"0.4"}),e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:i,strokeWidth:"1.1"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:i}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:i}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:i})]}),oo=[{id:"arq_nueva",cod:"DAN",nombre:"Diseo arquitectnico obra nueva",descripcion:"Desarrollamos proyectos desde cero, acompaando al cliente desde la conceptualizacin hasta la documentacin tcnica completa.",alcances:["Reunin inicial","Levantamiento de informacin y anlisis del lote","Desarrollo de anteproyecto (plantas, cortes, fachadas conceptuales)","Modelado 3D y visualizaciones","Ajustes y desarrollo de proyecto arquitectnico definitivo","Planos tcnicos constructivos","Cuadro de reas","Especificaciones de materiales"],entregables:[{nombre:"Proceso creativo",horas:24},{nombre:"Planta arquitectnica propuesta",horas:24},{nombre:"Cortes longitudinal y transversal",horas:8},{nombre:"Fachadas",horas:8},{nombre:"Planta arquitectnica constructiva (cotas y niveles)",horas:8},{nombre:"Plano de instalaciones hidrulicas",horas:8},{nombre:"Planta arquitectnica cielo rasos",horas:8},{nombre:"Planta arquitectnica pisos y enchapes",horas:8},{nombre:"Planta de iluminacin y puntos elctricos",horas:24},{nombre:"Tabla de iluminacin",horas:24},{nombre:"Planos de carpinteras, detalles y despieces",horas:24},{nombre:"Detalles constructivos",horas:36},{nombre:"Plano de puertas y ventanas",horas:24},{nombre:"Tabla de acabados y especificaciones",horas:24},{nombre:"Memoria de calidades",horas:24},{nombre:"Modelado 3D",horas:32},{nombre:"Renderizado",horas:16}]},{id:"arq_reforma",cod:"DAR",nombre:"Diseo arquitectnico reforma",descripcion:"Intervenimos espacios existentes para transformarlos funcional y estticamente, optimizando distribucin, iluminacin y materialidad.",alcances:["Visita tcnica y levantamiento del estado actual","Diagnstico funcional y espacial","Propuesta de redistribucin arquitectnica","Modelado 3D del espacio intervenido","Planos tcnicos de reforma","Especificaciones de acabados","Detalles constructivos clave"],entregables:[{nombre:"Proceso creativo",horas:16},{nombre:"Planta arquitectnica levantamiento",horas:5},{nombre:"Planta arquitectnica propuesta",horas:8},{nombre:"Cortes longitudinal y transversal",horas:3},{nombre:"Planta arquitectnica demoliciones",horas:4},{nombre:"Planta arquitectnica constructiva (cotas y niveles)",horas:3},{nombre:"Plano de instalaciones hidrulicas",horas:2},{nombre:"Planta arquitectnica cielo rasos",horas:4},{nombre:"Planta arquitectnica pisos y enchapes",horas:6},{nombre:"Planta de iluminacin y puntos elctricos",horas:6},{nombre:"Tabla de iluminacin",horas:8},{nombre:"Planos de carpinteras, detalles y despieces",horas:8},{nombre:"Detalles constructivos",horas:8},{nombre:"Plano de puertas y ventanas",horas:8},{nombre:"Tabla de acabados y especificaciones",horas:16},{nombre:"Memoria de calidades",horas:16},{nombre:"Modelado 3D",horas:24},{nombre:"Renderizado",horas:16}]},{id:"interiorismo",cod:"DIN",nombre:"Diseo de interiores",descripcion:"Transforma espacios en experiencias habitables, funcionales y emocionalmente coherentes. Integra funcin, esttica, tcnica y bienestar.",alcances:["Concepto creativo y moodboard","Propuesta de distribucin de mobiliario","Seleccin de materiales, acabados y paleta cromtica","Diseo de iluminacin (ambiental, funcional y decorativa)","Diseo de mobiliario a medida (si aplica)","Modelado 3D","Lista de compras y especificaciones"],entregables:[{nombre:"Proceso creativo",horas:5},{nombre:"Planta arquitectnica levantamiento",horas:3},{nombre:"Cortes longitudinal y transversal",horas:1},{nombre:"Planta de iluminacin y puntos elctricos",horas:1},{nombre:"Tabla de iluminacin",horas:2},{nombre:"Planos de carpinteras, detalles y despieces",horas:3},{nombre:"Plano de amueblamiento",horas:2},{nombre:"Moodboard",horas:1},{nombre:"Biofilia",horas:2},{nombre:"Tabla de mobiliario",horas:6},{nombre:"Lista de compras",horas:5},{nombre:"Modelado 3D",horas:6},{nombre:"Renderizado",horas:6}]},{id:"obra_integral",cod:"OBR",nombre:"Obra integral",descripcion:"Gestionamos y ejecutamos el proyecto completo, garantizando coherencia entre diseo y construccin.",alcances:["Direccin y supervisin de obra","Coordinacin de proveedores y contratistas","Control de calidad y acabados","Cronograma de ejecucin","Control de presupuesto","Seguimiento tcnico permanente","Entrega final con revisin detallada"],entregables:[]},{id:"consultoria",cod:"CON",nombre:"Consultora",descripcion:"Asesoramiento personalizado por horas segn las necesidades especficas del proyecto.",alcances:[],entregables:[]}],Os=["Proyecto Arquitectnico Completo","Proyecto Interiorismo","Proyecto Interiorismo Espacio"],hh=[{nombre:"Planta arquitectnica levantamiento",arq:5,int:3,esp:2},{nombre:"Planta arquitectnica propuesta",arq:8,int:5,esp:2},{nombre:"Cortes longitudinal y transversal",arq:3,int:2,esp:1},{nombre:"Fachadas",arq:3,int:0,esp:0},{nombre:"Planta arquitectnica demoliciones",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica constructiva / cotas",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica cielo rasos",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica pisos y enchapes",arq:2,int:2,esp:1},{nombre:"Planta de iluminacin y puntos elctricos",arq:4,int:3,esp:1},{nombre:"Tabla de iluminacin",arq:5,int:3,esp:2},{nombre:"Planos de carpinteras, detalles y despieces",arq:8,int:6,esp:3},{nombre:"Detalles constructivos",arq:8,int:6,esp:2},{nombre:"Plano de puertas y ventanas",arq:8,int:4,esp:2},{nombre:"Plano de amueblamiento",arq:4,int:4,esp:2},{nombre:"Moodboard",arq:3,int:2,esp:1},{nombre:"Tabla de acabados y especificaciones",arq:16,int:8,esp:6},{nombre:"Lista de compras / FF&E",arq:8,int:8,esp:5},{nombre:"Memoria de calidades",arq:8,int:6,esp:3},{nombre:"Modelado 3D",arq:24,int:16,esp:8},{nombre:"Renderizado",arq:8,int:6,esp:3}],oc=()=>hh.map(t=>({nombre:t.nombre,incluir:!1,cant:1,horasArq:t.arq,horasInt:t.int,horasEsp:t.esp})),Or=[{grupo:"DISEO",cod:"DAN",label:"Diseo arquitectnico  Obra nueva"},{grupo:"DISEO",cod:"DAR",label:"Diseo arquitectnico  Reforma parcial"},{grupo:"DISEO",cod:"DIN",label:"Diseo de interiores"},{grupo:"DISEO",cod:"DBI",label:"Biointeriorismo"},{grupo:"EJECUCIN",cod:"REF",label:"Reforma parcial"},{grupo:"EJECUCIN",cod:"RIN",label:"Reforma integral"},{grupo:"EJECUCIN",cod:"ONV",label:"Obra nueva (ejecucin)"},{grupo:"DIRECCIN / CONTROL",cod:"SUP",label:"Supervisin presencial"},{grupo:"DIRECCIN / CONTROL",cod:"SUO",label:"Supervisin online"},{grupo:"SERVICIOS COMPLEMENTARIOS",cod:"ASC",label:"Asesora de compras"}],Ha=[{val:"apartamento",label:"Apartamento",ph1:"Nombre del edificio",ph2:"Ej: Apto 403"},{val:"casa_conjunto",label:"Casa en conjunto",ph1:"Nombre del conjunto",ph2:"Ej: Casa 12"},{val:"casa_independiente",label:"Casa independiente",ph1:"Nombre del lugar",ph2:"Ej: La Colina"},{val:"local",label:"Local / Oficina",ph1:"Nombre del edificio",ph2:"Ej: Local 201"},{val:"otro",label:"Otro",ph1:"Lugar / Referencia",ph2:"Referencia adicional"}],Ul=(t,i="01",o=0)=>{const n=new Date,a=String(n.getFullYear()).slice(2),r=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0"),g=`R${String(o).padStart(2,"0")}`;return`${t}_${a}${r}${s}_${String(i).padStart(2,"0")}_${g}`},nc=(t,i,o)=>{if(!i&&!o)return"";const n=(i==null?void 0:i.trim())||"",a=(o==null?void 0:o.trim())||"";return!n&&!a?"":a?n?`${n}  ${a}`:a:n},il=["Borrador","Presentada","En revisin","Ganada","Perdida","Cancelada"],Vl={Borrador:{bg:"#EDEBE7",txt:"#777"},Presentada:{bg:C.infoBg,txt:C.info},"En revisin":{bg:C.warningBg,txt:C.warning},Ganada:{bg:C.successBg,txt:C.success},Perdida:{bg:C.errorBg,txt:C.error},Cancelada:{bg:"#EDE8F0",txt:"#826B82"}},fh={actividadCod:"DIN",digitoControl:"01",revision:0,codigoOferta:"",tipoInmueble:"apartamento",lugarNombre:"",lugarReferencia:"",cliente:"",proyecto:"",ubicacion:"",estado:"Borrador",notas:"",relacionadaCon:null,emailCliente:"",telCliente:"",fechaInicio:"",fechaEntrega:"",firmaRepresentante:"David Parra Galera",elaboradoPor:"",tipoProyecto:"OBRA",subtipoDiseno:Os[1],servicioId:"interiorismo",tarifaIVA:.19,margen:.25,uDecl:.1,uDeclMode:"auto",modoCalcObra:"margen",aiuA:.08,aiuI:.03,aiuU:.07,tipoCliente:"PN",medioPago:"PSE",aplicar4x1000:"SI",pctRCE:.007,pctTRC:.007,pctAdm:.002,pctICA:.009,pctReteFuente:0,pctReteICA:0,pctReteIVA:0,costosDirectos:[],entregablesOferta:[],apuSalarioAnual:0,apuPrestaciones:.65,apuHDia:8,apuDiasSem:5,apuSemanas:52,apuPctProductivas:.6,apuLicencias:0,apuEquipos:0,apuAccesorios:0,apuIndirectos:0,apuModoHora:"AUTO",apuCostoHoraManual:0,planos:oc(),pais:"CO",divisa:"COP",borradorLineas:[],pctU:.07,gg:.13,bi:.06,orgNodos:[],matProveedores:[],matCotizaciones:{},ofertaEquipos:[]};function er(t){const{tarifaIVA:i,margen:o,tipoProyecto:n,subtipoDiseno:a,medioPago:r,aplicar4x1000:s,pctRCE:g,pctTRC:h,pctAdm:b,pctICA:j,pctReteFuente:k,pctReteICA:v,pctReteIVA:m,costosDirectos:f=[],apuSalarioAnual:p,apuPrestaciones:d,apuHDia:c,apuDiasSem:l,apuSemanas:x,apuPctProductivas:y,apuLicencias:u,apuEquipos:S,apuAccesorios:A,apuIndirectos:E,apuModoHora:w,apuCostoHoraManual:_,planos:z=[]}=t,T=c*l*x*y,L=p*(1+d)+Number(u)+Number(S)+Number(A)+Number(E),Z=w==="MANUAL"?Number(_):T>0?L/T:0,K=I=>a===Os[0]?I.horasArq:a===Os[1]?I.horasInt:I.horasEsp,P=z.filter(I=>I.incluir).reduce((I,N)=>I+Number(N.cant)*K(N),0),te=P*Z,he=f.filter(I=>I.tipo==="M").reduce((I,N)=>I+(parseFloat(N.valor)||0),0),Q=f.filter(I=>I.tipo==="MO").reduce((I,N)=>I+(parseFloat(N.valor)||0),0),Se=f.filter(I=>I.tipo==="SUB").reduce((I,N)=>I+(parseFloat(N.valor)||0),0),ae=(t.borradorLineas||[]).filter(I=>!I.esCapitulo).reduce((I,N)=>I+(N.precioCD||0),0),M=ae>0?ae:he+Q+Se+(n==="DISEO"?te:0),B=t.ivaComision??.19;let H=0;r==="PSE"?H=(t.pctComPSE??.012)*(1+B):r==="Tarjeta"?H=(t.pctComTarjeta??.036)*(1+B):r==="Transferencia"?H=(t.pctComTransf??0)*(1+B):r==="Manual"&&(H=t.pctComManual??0);const D=H+(s==="SI"?.004:0),O=g+h+b+j,le=t.modoCalcObra||"margen",re=t.ggPct||0;let de,G,ce,V,Y,W;if(n==="OBRA"&&(t.pais||"CO")==="CO"&&le==="aiu"){const I=t.aiuA??.08,N=t.aiuI??.03,q=t.aiuU??.07,J=I+N+q,R=M*(1+J);G=1-O,ce=1-D;const ie=G*ce;de=ie>0?R/ie:0,V=ie>0?(1+J)/ie:0,Y=q,W=J}else{G=1-o-O-re,ce=1-D;const I=G*ce;de=I>0?M/I:0,V=I>0?1/I:0,Y=n==="OBRA"?t.uDecl??o:o,W=o}const se=G*ce,ge=n==="OBRA"?Y*de*i:de*i,ue=de+ge,ye=(k+v+m)*de,be=n==="OBRA"&&le==="aiu"?de-M-O*de-D*de:W*de;return{COSTO:M,costoDis:te,cdM:he,cdMO:Q,cdSB:Se,f:D,g:O,ggPct:re,den:se,den1:G,denGF:ce,coefMult:V,U:Y,margenEfectivo:W,hAnio:T,estr:L,costoH:Z,hDis:P,PVP:de,IVA:ge,PVP_IVA:ue,GC:O*de,GG:re*de,ICA:j*de,fin:D*de,margenCOP:be,ret:ye,neto:ue-ye}}const Ye=(t,i=0)=>t==null||isNaN(t)?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:i,minimumFractionDigits:i}).format(t),it=t=>`${(t*100).toFixed(2)}%`,kt=()=>Math.random().toString(36).substr(2,9),Dt=()=>new Date().toISOString().split("T")[0];async function xh(){try{const t=Ee.getSync("hab:v4");return t?JSON.parse(t):[]}catch{return[]}}async function Ga(t){try{Ee.set("hab:v4",JSON.stringify(t))}catch(i){console.error(i)}}async function Sa(){try{return Ee.listSync("hab:briefing:").items.map(i=>{try{return JSON.parse(i)}catch{return null}}).filter(Boolean).sort((i,o)=>new Date(o.fecha||0)-new Date(i.fecha||0))}catch{return[]}}function Ls(t){try{Ee.set("hab:briefing:"+t.id,JSON.stringify(t))}catch{}}async function mh(t){try{Ee.delete("hab:briefing:"+t)}catch{}}function Ws(t){var i,o,n,a;return{cliente:t.nombre||"",emailCliente:t.email||"",telCliente:(t.telefono||"").replace(/^\+57\s*/,""),ubicacion:[t.ciudad,t.edificio].filter(Boolean).join("  ")||"",proyecto:[t.edificio,(i=t.nombre)==null?void 0:i.split(" ").slice(-1)[0]].filter(Boolean).join("  ")||"",estado:"Prospecto",notas:[(o=t.estilo)!=null&&o.length?`Estilo: ${Array.isArray(t.estilo)?t.estilo.join(", "):t.estilo}`:"",(n=t.espacios)!=null&&n.length?`Espacios: ${Array.isArray(t.espacios)?t.espacios.join(", "):t.espacios}`:"",t.colores_materiales?`Materiales: ${t.colores_materiales}`:"",(a=t.que_esperas)!=null&&a.length?`Expectativas: ${Array.isArray(t.que_esperas)?t.que_esperas.join("; "):t.que_esperas}`:"",t.links_ref?`Referencias: ${t.links_ref}`:""].filter(Boolean).join(`
`),razonSocial:t.razon_social||"",documento:t.documento||"",emailFactura:t.email_factura||t.email||"",dirFacturacion:t.dir_facturacion||"",retencion:t.retenciones==="S",detalleRet:t.detalle_retenciones||"",anticipoAcept:t.anticipo||"",formaPago:t.forma_pago||"",fechaInicio:t.fecha_inicio||"",fechaEntrega:t.plazo||"",lugarNombre:t.edificio||"",briefingId:t.id}}function rc(t){return{id:Math.random().toString(36).slice(2,9),nombre:t.razon_social||t.nombre||"",tipo:t.razon_social?"Empresa":"Persona natural",nit:t.documento||"",email:t.email||"",telMovil:(t.telefono||"").replace(/^\+57\s*/,""),prefijoMovil:"+57",ciudad:t.ciudad||"",pais:"CO",notas:[t.edificio?`Proyecto: ${t.edificio}`:"",t.tipo_proyecto?`Tipo: ${t.tipo_proyecto}`:"",t.area_m2?`rea: ${t.area_m2} m`:"",t.presupuesto?`Presupuesto: $ ${Number(t.presupuesto).toLocaleString("es-CO")}`:"",t.como_conociste?`Canal: ${t.como_conociste}`:""].filter(Boolean).join(" | "),emailFactura:t.email_factura||t.email||"",dirFacturacion:t.dir_facturacion||"",razonSocial:t.razon_social||"",retenciones:t.retenciones||"",detalleRet:t.detalle_retenciones||"",formaPago:t.forma_pago||"",anticipo:t.anticipo||"",direccion:t.direccion_proyecto||"",fechaInicio:t.fecha_inicio||"",fechaEntrega:t.plazo||"",lugarNombre:t.edificio||"",briefingId:t.id,fechaAlta:new Date().toISOString().split("T")[0]}}const Ns=({e:t})=>{const i=Vl[t]||Vl.Borrador;return e.jsx("span",{style:{background:i.bg,color:i.txt,padding:"3px 10px",borderRadius:2,fontSize:10,fontWeight:600,letterSpacing:.8,textTransform:"uppercase",display:"inline-block",whiteSpace:"nowrap",fontFamily:"'DM Sans', sans-serif"},children:t})},Je=({children:t,style:i,...o})=>e.jsx("div",{style:{background:C.surface,borderRadius:3,boxShadow:C.shadow,border:`1px solid ${C.border}`,...i},...o,children:t}),ut=({children:t,v:i="pri",on:o,icon:n,sm:a,style:r,dis:s,...g})=>{const h={display:"inline-flex",alignItems:"center",gap:6,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontWeight:500,cursor:s?"not-allowed":"pointer",transition:"all .15s",border:"none",fontSize:a?11:12,padding:a?"5px 11px":"9px 16px",letterSpacing:.4,opacity:s?.5:1,...r},b={pri:{background:C.ink,color:"#fff"},sec:{background:C.accentBg,color:C.ink},ghost:{background:"transparent",color:C.inkMid},danger:{background:C.errorBg,color:C.error},out:{background:"transparent",color:C.ink,border:`1px solid ${C.borderMid}`}};return e.jsxs("button",{style:{...h,...b[i]},onClick:o,disabled:s,...g,children:[n&&e.jsx(n,{size:a?12:13}),t]})},ot=({lbl:t,val:i,on:o,type:n="text",ph:a,rt:r,note:s,step:g,min:h,style:b})=>{const[j,k]=F.useState(String(i??"")),[v,m]=F.useState(!1);return F.useEffect(()=>{v||k(String(i??""))},[i,v]),e.jsxs("div",{style:{marginBottom:14},children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1,fontFamily:"'DM Sans', sans-serif"},children:t}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:n,value:j,placeholder:a,step:g,min:h,onChange:f=>{k(f.target.value),o(f)},style:{width:"100%",padding:"9px 12px",paddingRight:r?38:12,border:`1px solid ${C.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:C.ink,background:C.bg,transition:"border .15s",...b},onFocus:f=>{m(!0),f.target.style.borderColor=C.ink,f.target.select()},onBlur:f=>{m(!1),f.target.style.borderColor=C.border}}),r&&e.jsx("span",{style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",fontSize:11,color:C.inkLight},children:r})]}),s&&e.jsx("p",{style:{fontSize:10,color:C.inkLight,margin:"3px 0 0"},children:s})]})},Sn=({lbl:t,val:i,on:o,opts:n,note:a})=>e.jsxs("div",{style:{marginBottom:14},children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:t}),e.jsx("select",{value:i,onChange:o,style:{width:"100%",padding:"9px 12px",border:`1px solid ${C.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:C.ink,background:C.bg},onFocus:r=>r.target.style.borderColor=C.ink,onBlur:r=>r.target.style.borderColor=C.border,children:n.map(r=>e.jsx("option",{value:r.v??r,children:r.l??r},r.v??r))}),a&&e.jsx("p",{style:{fontSize:10,color:C.inkLight,margin:"3px 0 0"},children:a})]}),jt=({t,s:i})=>e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h3",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:15,fontWeight:600,color:C.ink,margin:0,letterSpacing:.2,textTransform:"uppercase"},children:t}),i&&e.jsx("p",{style:{fontSize:11,color:C.inkLight,margin:"3px 0 0",fontWeight:400},children:i})]}),Lr=({lbl:t,val:i,icon:o,col:n,sub:a})=>e.jsx(Je,{style:{padding:"18px 20px",flex:1,minWidth:150},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,fontWeight:600,color:C.inkLight,margin:"0 0 8px",textTransform:"uppercase",letterSpacing:1.5},children:t}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:22,fontWeight:700,color:n,margin:0},children:i}),a&&e.jsx("p",{style:{fontSize:10,color:C.inkLight,margin:"4px 0 0"},children:a})]}),e.jsx("div",{style:{background:`${n}15`,borderRadius:2,padding:8},children:e.jsx(o,{size:15,color:n})})]})}),ac=[{key:"nombre",lbl:"Nombre",icon:""},{key:"email",lbl:"Email",icon:""},{key:"telefono",lbl:"Telfono",icon:""},{key:"como_conociste",lbl:"Cmo nos conoci?",icon:""},{key:"ciudad",lbl:"Ciudad",icon:""},{key:"edificio",lbl:"Edificio / Conjunto",icon:""},{key:"direccion_proyecto",lbl:"Direccin proyecto",icon:""},{key:"tipo_proyecto",lbl:"Tipo de proyecto",icon:""},{key:"area_m2",lbl:"rea (m)",icon:""},{key:"num_habitaciones",lbl:"Habitaciones / reas",icon:""},{key:"estilo",lbl:"Estilo preferido",icon:""},{key:"colores_materiales",lbl:"Colores y materiales",icon:""},{key:"espacios",lbl:"Espacios a intervenir",icon:""},{key:"fecha_inicio",lbl:"Fecha tentativa inicio",icon:""},{key:"plazo",lbl:"Plazo de finalizacin",icon:""},{key:"presupuesto",lbl:"Presupuesto (COP)",icon:""},{key:"financiacion",lbl:"Financiacin",icon:""},{key:"lo_mas_importante",lbl:"Prioridad principal",icon:""},{key:"que_esperas",lbl:"Qu espera lograr?",icon:""},{key:"contratistas",lbl:"Recomendar contratistas?",icon:""},{key:"forma_pago",lbl:"Forma de pago",icon:""},{key:"razon_social",lbl:"Razn social",icon:""},{key:"documento",lbl:"Documento",icon:""},{key:"email_factura",lbl:"Email facturacin",icon:""},{key:"dir_facturacion",lbl:"Direccin facturacin",icon:""},{key:"retenciones",lbl:"Retenciones especiales",icon:""},{key:"detalle_retenciones",lbl:"Detalle retenciones",icon:""}];function bh({b:t,onClose:i,onCreateOffer:o,onCreateClient:n}){const a=(s,g)=>!g||g===""?"":Array.isArray(g)?g.join(", "):s==="presupuesto"?`$ ${Number(g).toLocaleString("es-CO")} COP`:String(g),r=ac.filter(s=>t[s.key]&&t[s.key]!=="");return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:s=>s.target===s.currentTarget&&i(),children:e.jsxs("div",{style:{background:C.surface,borderRadius:4,width:"100%",maxWidth:680,maxHeight:"85vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:C.shadowMd},children:[e.jsxs("div",{style:{padding:"18px 22px",borderBottom:`1px solid ${C.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:16,fontWeight:700,margin:0},children:t.nombre||"Sin nombre"}),e.jsxs("p",{style:{fontSize:11,color:C.inkLight,margin:"3px 0 0",letterSpacing:.5},children:["Briefing recibido  ",t.fecha||"","  ",t.ciudad||""]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[n&&e.jsx("button",{onClick:n,style:{padding:"8px 16px",background:C.infoBg,color:C.info,border:`1px solid ${C.info}33`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:700,cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"+ Crear cliente"}),e.jsx("button",{onClick:o,style:{padding:"8px 16px",background:C.ink,color:"#fff",border:"none",borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:700,cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"+ Crear oferta"}),e.jsx("button",{onClick:i,style:{padding:"8px 12px",background:"transparent",border:`1px solid ${C.border}`,borderRadius:3,cursor:"pointer",color:C.inkMid},children:e.jsx($t,{size:14})})]})]}),e.jsxs("div",{style:{overflowY:"auto",padding:"18px 22px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:r.map(s=>e.jsxs("div",{style:{padding:"10px 12px",background:C.bg,borderRadius:3,border:`1px solid ${C.border}`},children:[e.jsxs("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 4px"},children:[s.icon," ",s.lbl]}),e.jsx("p",{style:{fontSize:13,fontWeight:500,color:C.ink,margin:0,lineHeight:1.4},children:a(s.key,t[s.key])})]},s.key))}),t.links_ref&&e.jsxs("div",{style:{marginTop:10,padding:"10px 12px",background:C.infoBg,borderRadius:3,border:`1px solid ${C.info}22`},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:C.info,margin:"0 0 4px"},children:" Links de referencia"}),e.jsx("p",{style:{fontSize:12,color:C.ink,margin:0,wordBreak:"break-all"},children:t.links_ref})]})]})]})})}async function yh(){try{return Ee.listSync("hab:forms:").items.map(i=>{try{return JSON.parse(i)}catch{return null}}).filter(Boolean).sort((i,o)=>(o.updatedAt||"").localeCompare(i.updatedAt||""))}catch{return[]}}function vh(t){try{t.updatedAt=new Date().toISOString(),Ee.set(`hab:forms:${t.id}`,JSON.stringify(t))}catch{}}async function jh(t){try{Ee.delete(`hab:forms:${t}`)}catch{}}const Wr=()=>Math.random().toString(36).slice(2,8),Sh=[{nombre:"Briefing Diseo Interior",desc:"Formulario completo para proyectos de diseo",icon:"",config:{titulo:"Cuntanos sobre tu proyecto",subtitulo:"Solo toma 5-7 minutos. Tus respuestas nos ayudan a preparar una propuesta personalizada.",mensajeExito:"Gracias! Nos pondremos en contacto pronto con tu propuesta.",telRespuesta:"573183818736"},campos:[{tipo:"seccion",label:"Datos personales",icon:"",desc:"Informacin de contacto"},{tipo:"text",label:"Nombre completo",required:!0,mapKey:"nombre"},{tipo:"email",label:"Correo electrnico",required:!0,mapKey:"email"},{tipo:"tel",label:"WhatsApp / Celular",required:!0,mapKey:"telefono"},{tipo:"select",label:"Cmo nos conociste?",mapKey:"como_conociste",opciones:["Instagram","Google","Referido","Pgina web","Evento","Otro"]},{tipo:"seccion",label:"Tu proyecto",icon:""},{tipo:"text",label:"Ciudad",required:!0,mapKey:"ciudad"},{tipo:"text",label:"Edificio / Conjunto",mapKey:"edificio"},{tipo:"text",label:"Direccin del proyecto",mapKey:"direccion_proyecto"},{tipo:"select",label:"Tipo de proyecto",required:!0,mapKey:"tipo_proyecto",opciones:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"]},{tipo:"number",label:"rea aproximada (m)",mapKey:"area_m2"},{tipo:"text",label:"Nmero de habitaciones o reas",mapKey:"num_habitaciones"},{tipo:"seccion",label:"Estilo y preferencias",icon:""},{tipo:"chips",label:"Estilos que te gustan",mapKey:"estilo",opciones:["Moderno","Contemporneo","Minimalista","Industrial","Nrdico","Clsico","Rstico","Eclctico","Japandi","Otro"]},{tipo:"chips",label:"Espacios a intervenir",mapKey:"espacios",opciones:["Sala","Comedor","Cocina","Hab. principal","Hab. secundaria","Bao social","Bao privado","Estudio","Terraza/Balcn","Lavandera"]},{tipo:"textarea",label:"Colores y materiales que te gustan",mapKey:"colores_materiales",placeholder:"Ej: tonos clidos, madera natural, mrmol..."},{tipo:"textarea",label:"Links de referencia (Pinterest, Instagram...)",mapKey:"links_ref",placeholder:"Pega aqu los links de inspiracin"},{tipo:"seccion",label:"Presupuesto y tiempos",icon:""},{tipo:"rango",label:"Presupuesto aproximado",mapKey:"presupuesto",opciones:["Menos de $20M","$20M - $50M","$50M - $100M","$100M - $200M","Ms de $200M","An no definido"]},{tipo:"select",label:"Financiacin",mapKey:"financiacion",opciones:["Recursos propios","Crdito hipotecario","Leasing","Otro"]},{tipo:"date",label:"Fecha tentativa de inicio",mapKey:"fecha_inicio"},{tipo:"text",label:"Plazo deseado de finalizacin",mapKey:"plazo",placeholder:"Ej: 3 meses"},{tipo:"seccion",label:"Expectativas",icon:""},{tipo:"textarea",label:"Qu es lo ms importante para ti en este proyecto?",mapKey:"lo_mas_importante"},{tipo:"textarea",label:"Qu esperas lograr con el diseo?",mapKey:"que_esperas"},{tipo:"radio",label:"Necesitas que recomendemos contratistas?",mapKey:"contratistas",opciones:["S","No","Tal vez"]},{tipo:"seccion",label:"Facturacin (opcional)",icon:"",desc:"Solo si necesita factura"},{tipo:"text",label:"Razn social",mapKey:"razon_social"},{tipo:"text",label:"NIT / Cdula",mapKey:"documento"},{tipo:"email",label:"Email de facturacin",mapKey:"email_factura"},{tipo:"text",label:"Direccin de facturacin",mapKey:"dir_facturacion"},{tipo:"radio",label:"Tiene retenciones especiales?",mapKey:"retenciones",opciones:["No","S"]},{tipo:"radio",label:"Confirmo que la informacin es correcta",mapKey:"confirmacion",required:!0,opciones:["S"]}]},{nombre:"Briefing Obra / Remodelacin",desc:"Enfocado en construccin y remodelacin",icon:"",config:{titulo:"Cuntanos sobre tu obra",subtitulo:"Necesitamos algunos datos para preparar tu presupuesto.",mensajeExito:"Gracias! Te enviaremos el presupuesto pronto.",telRespuesta:"573183818736"},campos:[{tipo:"seccion",label:"Datos de contacto",icon:""},{tipo:"text",label:"Nombre completo",required:!0,mapKey:"nombre"},{tipo:"email",label:"Correo electrnico",required:!0,mapKey:"email"},{tipo:"tel",label:"WhatsApp / Celular",required:!0,mapKey:"telefono"},{tipo:"seccion",label:"La obra",icon:""},{tipo:"text",label:"Ciudad",required:!0,mapKey:"ciudad"},{tipo:"text",label:"Direccin de la obra",mapKey:"direccion_proyecto"},{tipo:"select",label:"Tipo de obra",required:!0,mapKey:"tipo_proyecto",opciones:["Remodelacin total","Remodelacin parcial","Obra nueva","Ampliacin","Adecuacin","Otro"]},{tipo:"number",label:"rea total (m)",mapKey:"area_m2"},{tipo:"chips",label:"reas a intervenir",mapKey:"espacios",opciones:["Estructura","Mampostera","Pisos","Cielos","Cocina","Baos","Instalaciones elctricas","Instalaciones hidrulicas","Pintura","Carpintera","Fachada"]},{tipo:"textarea",label:"Descripcin de lo que necesita",mapKey:"lo_mas_importante",placeholder:"Describe brevemente el alcance de la obra"},{tipo:"seccion",label:"Tiempos y presupuesto",icon:""},{tipo:"rango",label:"Presupuesto aproximado",mapKey:"presupuesto",opciones:["Menos de $30M","$30M - $80M","$80M - $150M","$150M - $300M","Ms de $300M","Sin definir"]},{tipo:"date",label:"Fecha deseada de inicio",mapKey:"fecha_inicio"},{tipo:"text",label:"Plazo esperado",mapKey:"plazo"},{tipo:"radio",label:"Ya tiene planos?",mapKey:"tiene_planos",opciones:["S","No","En proceso"]},{tipo:"radio",label:"Ya tiene permisos/licencias?",mapKey:"tiene_licencias",opciones:["S","No","En trmite","No s si aplica"]},{tipo:"seccion",label:"Facturacin",icon:""},{tipo:"text",label:"Razn social",mapKey:"razon_social"},{tipo:"text",label:"NIT / Cdula",mapKey:"documento"},{tipo:"email",label:"Email de facturacin",mapKey:"email_factura"}]},{nombre:"Encuesta de satisfaccin",desc:"Post-proyecto para feedback del cliente",icon:"",config:{titulo:"Cmo fue tu experiencia?",subtitulo:"Tu opinin nos ayuda a mejorar.",mensajeExito:"Gracias por tu feedback! Lo valoramos mucho.",telRespuesta:"573183818736"},campos:[{tipo:"text",label:"Nombre",required:!0,mapKey:"nombre"},{tipo:"text",label:"Proyecto",mapKey:"edificio"},{tipo:"radio",label:"Satisfaccin general",required:!0,mapKey:"satisfaccion",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Calidad del diseo",mapKey:"calidad_diseno",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Comunicacin del equipo",mapKey:"comunicacion",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Cumplimiento de plazos",mapKey:"cumplimiento",opciones:[" Excelente"," Bueno"," Regular"," Malo"]},{tipo:"radio",label:"Nos recomendara?",required:!0,mapKey:"recomendaria",opciones:["Definitivamente s","Probablemente s","No estoy seguro","Probablemente no"]},{tipo:"textarea",label:"Qu fue lo mejor del proyecto?",mapKey:"lo_mejor"},{tipo:"textarea",label:"Qu podramos mejorar?",mapKey:"mejorar"},{tipo:"textarea",label:"Comentarios adicionales",mapKey:"comentarios"}]}],Ka=[{tipo:"text",label:"Texto corto",icon:"Aa"},{tipo:"email",label:"Email",icon:"@"},{tipo:"tel",label:"Telfono",icon:""},{tipo:"number",label:"Nmero",icon:"#"},{tipo:"date",label:"Fecha",icon:""},{tipo:"textarea",label:"Texto largo",icon:""},{tipo:"select",label:"Desplegable",icon:""},{tipo:"radio",label:"Opcin nica",icon:""},{tipo:"chips",label:"Seleccin mlt.",icon:""},{tipo:"rango",label:"Rango",icon:""},{tipo:"seccion",label:"Separador",icon:""}];function Ch(){var L,Z,K,P,te,he;const[t,i]=F.useState([]),[o,n]=F.useState(!0),[a,r]=F.useState(null),[s,g]=F.useState(!1),[h,b]=F.useState(null),[j,k]=F.useState(""),[v,m]=F.useState(""),[f,p]=F.useState(""),[d,c]=F.useState(!1);F.useEffect(()=>{yh().then(Q=>{i(Q),n(!1)})},[]);const l=Q=>{const Se={id:Wr()+Date.now().toString(36),nombre:Q.nombre,config:{...Q.config},campos:Q.campos.map(ae=>({...ae,id:ae.id||Wr()})),createdAt:new Date().toISOString()};r(Se)},x=()=>{r({id:Wr()+Date.now().toString(36),nombre:"Nuevo formulario",config:{titulo:"",subtitulo:"",mensajeExito:"Gracias por tu respuesta!",telRespuesta:"573183818736"},campos:[],createdAt:new Date().toISOString()})},y=async()=>{a&&(await vh(a),i(Q=>Q.find(ae=>ae.id===a.id)?Q.map(ae=>ae.id===a.id?a:ae):[a,...Q]),r(null))},u=async Q=>{window.confirm("Eliminar este formulario?")&&(await jh(Q),i(Se=>Se.filter(ae=>ae.id!==Q)))},S=Q=>{const Se=ic(Q);return`${window.location.origin}/form#${Se}`},A=Q=>{var Se;try{const ae=S(Q);(Se=navigator.clipboard)==null||Se.writeText(ae),c(!0),setTimeout(()=>c(!1),2e3)}catch{}},E=Q=>{var M;const Se=S(Q),ae=`Hola${f?` ${f}`:""}!  Te invitamos a completar este formulario:

 ${((M=Q.config)==null?void 0:M.titulo)||Q.nombre}
${Se}

Gracias!`,U=j.replace(/\D/g,"");window.open(U?`https://wa.me/57${U}?text=${encodeURIComponent(ae)}`:`https://wa.me/?text=${encodeURIComponent(ae)}`,"_blank")},w=Q=>{var M,B;const Se=S(Q),ae=encodeURIComponent(((M=Q.config)==null?void 0:M.titulo)||Q.nombre),U=encodeURIComponent(`Hola${f?` ${f}`:""},

Te invitamos a completar este formulario:

${((B=Q.config)==null?void 0:B.titulo)||Q.nombre}
${Se}

Gracias!
Equipo Habitaris`);window.open(`mailto:${v}?subject=${ae}&body=${U}`,"_blank")},_={width:"100%",padding:"7px 10px",border:`1px solid ${C.border}`,borderRadius:4,fontFamily:"'DM Sans',sans-serif",fontSize:12,background:C.surface,color:C.ink,boxSizing:"border-box"},z={fontSize:9,fontWeight:600,color:C.inkLight,display:"block",marginBottom:4,textTransform:"uppercase",letterSpacing:1};if(a){const Q=a,Se=H=>r(ee=>({...ee,...H})),ae=(H,ee)=>r(D=>({...D,campos:D.campos.map((O,le)=>le===H?{...O,...ee}:O)})),U=H=>r(ee=>({...ee,campos:ee.campos.filter((D,O)=>O!==H)})),M=(H,ee)=>r(D=>{const O=[...D.campos],le=H+ee;return le<0||le>=O.length?D:([O[H],O[le]]=[O[le],O[H]],{...D,campos:O})}),B=H=>{var D;const ee={id:Wr(),tipo:H,label:((D=Ka.find(O=>O.tipo===H))==null?void 0:D.label)||H,required:!1,mapKey:""};["select","radio","chips","rango"].includes(H)&&(ee.opciones=["Opcin 1","Opcin 2"]),H==="seccion"&&(ee.icon="",ee.desc=""),r(O=>({...O,campos:[...O.campos,ee]}))};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("button",{onClick:()=>{window.confirm("Descartar cambios?")&&r(null)},style:{background:"none",border:"none",cursor:"pointer",color:C.inkMid,padding:4},children:e.jsx(Cd,{size:18})}),e.jsxs("div",{children:[e.jsx("input",{value:Q.nombre,onChange:H=>Se({nombre:H.target.value}),style:{border:"none",fontSize:18,fontWeight:700,fontFamily:"'DM Sans',sans-serif",background:"transparent",width:320},placeholder:"Nombre del formulario"}),e.jsxs("p",{style:{fontSize:10,color:C.inkLight,margin:0},children:[Q.campos.length," campos"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(ut,{v:"out",on:()=>g(!s),children:s?" Editar":" Preview"}),e.jsx(ut,{icon:xt,on:y,children:"Guardar formulario"})]})]}),!s&&e.jsx(Je,{style:{padding:16,marginBottom:16,borderLeft:`3px solid ${C.info}`},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Ttulo visible al cliente"}),e.jsx("input",{value:((L=Q.config)==null?void 0:L.titulo)||"",onChange:H=>Se({config:{...Q.config,titulo:H.target.value}}),style:_,placeholder:"Cuntanos sobre tu proyecto"})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Subttulo"}),e.jsx("input",{value:((Z=Q.config)==null?void 0:Z.subtitulo)||"",onChange:H=>Se({config:{...Q.config,subtitulo:H.target.value}}),style:_,placeholder:"Solo toma 5 minutos"})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Mensaje al enviar"}),e.jsx("input",{value:((K=Q.config)==null?void 0:K.mensajeExito)||"",onChange:H=>Se({config:{...Q.config,mensajeExito:H.target.value}}),style:_})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"WhatsApp de respuestas"}),e.jsx("input",{value:((P=Q.config)==null?void 0:P.telRespuesta)||"",onChange:H=>Se({config:{...Q.config,telRespuesta:H.target.value}}),style:_,placeholder:"573183818736"})]})]})}),s?e.jsxs(Je,{style:{padding:24,maxWidth:640,margin:"0 auto"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:20},children:[e.jsx("h2",{style:{fontSize:18,fontWeight:700,margin:"0 0 4px"},children:((te=Q.config)==null?void 0:te.titulo)||Q.nombre}),((he=Q.config)==null?void 0:he.subtitulo)&&e.jsx("p",{style:{fontSize:12,color:C.inkMid},children:Q.config.subtitulo})]}),Q.campos.map((H,ee)=>H.tipo==="seccion"?e.jsxs("div",{style:{marginTop:20,marginBottom:8,paddingTop:12,borderTop:`2px solid ${C.ink}`},children:[e.jsxs("h3",{style:{fontSize:13,fontWeight:700},children:[H.icon||""," ",H.label]}),H.desc&&e.jsx("p",{style:{fontSize:11,color:C.inkMid},children:H.desc})]},ee):e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("label",{style:{fontSize:11,fontWeight:600,display:"block",marginBottom:4},children:[H.label,H.required&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),["text","email","tel","number","date"].includes(H.tipo)&&e.jsx("input",{disabled:!0,style:{..._,opacity:.6},placeholder:H.placeholder||"",type:H.tipo}),H.tipo==="textarea"&&e.jsx("textarea",{disabled:!0,rows:2,style:{..._,opacity:.6,resize:"none"},placeholder:H.placeholder||""}),(H.tipo==="select"||H.tipo==="rango")&&e.jsx("select",{disabled:!0,style:{..._,opacity:.6},children:e.jsx("option",{children:(H.opciones||[])[0]||"..."})}),H.tipo==="radio"&&e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:2},children:(H.opciones||[]).map(D=>e.jsxs("label",{style:{fontSize:11,display:"flex",gap:4,alignItems:"center"},children:[e.jsx("input",{type:"radio",disabled:!0}),D]},D))}),H.tipo==="chips"&&e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:2},children:(H.opciones||[]).map(D=>e.jsx("span",{style:{padding:"3px 10px",fontSize:10,border:`1px solid ${C.border}`,borderRadius:20},children:D},D))})]},ee))]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[Q.campos.map((H,ee)=>{var D;return e.jsxs(Je,{style:{padding:"10px 14px",borderLeft:H.tipo==="seccion"?`3px solid ${C.ink}`:`3px solid ${C.border}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2,alignItems:"center",paddingTop:2},children:[e.jsx("button",{onClick:()=>M(ee,-1),disabled:ee===0,style:{background:"none",border:"none",cursor:ee>0?"pointer":"default",opacity:ee>0?1:.3,fontSize:10,padding:0},children:""}),e.jsx("span",{style:{fontSize:8,color:C.inkLight,background:C.bg,borderRadius:2,padding:"1px 5px",letterSpacing:.5,textTransform:"uppercase"},children:((D=Ka.find(O=>O.tipo===H.tipo))==null?void 0:D.icon)||"?"}),e.jsx("button",{onClick:()=>M(ee,1),disabled:ee===Q.campos.length-1,style:{background:"none",border:"none",cursor:ee<Q.campos.length-1?"pointer":"default",opacity:ee<Q.campos.length-1?1:.3,fontSize:10,padding:0},children:""})]}),e.jsxs("div",{style:{flex:1,display:"grid",gridTemplateColumns:H.tipo==="seccion"?"1fr auto":"2fr 1fr 1fr auto",gap:6,alignItems:"center"},children:[e.jsx("input",{value:H.label,onChange:O=>ae(ee,{label:O.target.value}),style:{..._,fontWeight:H.tipo==="seccion"?700:400,fontSize:H.tipo==="seccion"?13:12},placeholder:"Etiqueta"}),H.tipo!=="seccion"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{value:H.mapKey||"",onChange:O=>ae(ee,{mapKey:O.target.value}),style:{..._,fontSize:10,fontFamily:"'DM Mono',monospace"},placeholder:"clave",title:"Clave para mapeo a briefing"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:10,color:C.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:!!H.required,onChange:O=>ae(ee,{required:O.target.checked})}),"Obligatorio"]})]}),e.jsx("button",{onClick:()=>U(ee),style:{background:"none",border:"none",cursor:"pointer",color:C.error,padding:2},children:e.jsx(He,{size:12})})]})]}),["select","radio","chips","rango"].includes(H.tipo)&&e.jsxs("div",{style:{marginTop:6,marginLeft:28},children:[e.jsx("label",{style:{...z,marginBottom:3},children:"Opciones (una por lnea)"}),e.jsx("textarea",{value:(H.opciones||[]).join(`
`),onChange:O=>ae(ee,{opciones:O.target.value.split(`
`)}),rows:Math.min((H.opciones||[]).length+1,6),style:{..._,fontSize:11,resize:"vertical"}})]}),["text","email","tel","number","textarea"].includes(H.tipo)&&e.jsx("div",{style:{marginTop:4,marginLeft:28},children:e.jsx("input",{value:H.placeholder||"",onChange:O=>ae(ee,{placeholder:O.target.value}),style:{..._,fontSize:10,color:C.inkLight},placeholder:"Placeholder (opcional)"})}),H.tipo==="seccion"&&e.jsxs("div",{style:{marginTop:4,marginLeft:28,display:"flex",gap:6},children:[e.jsx("input",{value:H.icon||"",onChange:O=>ae(ee,{icon:O.target.value}),style:{..._,width:40,textAlign:"center"},placeholder:""}),e.jsx("input",{value:H.desc||"",onChange:O=>ae(ee,{desc:O.target.value}),style:{..._,flex:1,fontSize:10},placeholder:"Descripcin de la seccin"})]})]},H.id||ee)}),e.jsxs(Je,{style:{padding:"12px 16px",background:C.bg,borderStyle:"dashed"},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 8px"},children:"Agregar campo"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:Ka.map(H=>e.jsxs("button",{onClick:()=>B(H.tipo),style:{padding:"5px 10px",fontSize:10,fontFamily:"'DM Sans',sans-serif",border:`1px solid ${C.border}`,borderRadius:4,background:C.surface,cursor:"pointer",color:C.ink,display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{fontSize:11},children:H.icon})," ",H.label]},H.tipo))})]})]})]})}const T=h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:Q=>Q.target===Q.currentTarget&&b(null),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",padding:24,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("h3",{style:{fontSize:15,fontWeight:700,margin:0},children:[" Compartir: ",h.nombre]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:C.inkMid},children:e.jsx($t,{size:18})})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:z,children:"Link del formulario"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("div",{style:{flex:1,padding:"8px 10px",background:C.bg,border:`1px solid ${C.border}`,borderRadius:4,fontSize:10,color:C.inkMid,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:"'DM Mono',monospace"},children:S(h)}),e.jsx("button",{onClick:()=>A(h),style:{padding:"8px 14px",border:`1px solid ${C.border}`,borderRadius:4,fontSize:11,fontWeight:600,background:d?C.successBg:C.surface,color:d?C.success:C.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap"},children:d?" Copiado":" Copiar"})]})]}),e.jsx("div",{style:{marginBottom:16,textAlign:"center"},children:e.jsx("a",{href:S(h),target:"_blank",rel:"noreferrer",style:{fontSize:11,color:C.info},children:" Ver preview en nueva pestaa"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Nombre (opc.)"}),e.jsx("input",{value:f,onChange:Q=>p(Q.target.value),style:_,placeholder:"Juan"})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"WhatsApp"}),e.jsx("input",{value:j,onChange:Q=>k(Q.target.value),style:_,placeholder:"300 123 4567"})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Email"}),e.jsx("input",{value:v,onChange:Q=>m(Q.target.value),style:_,placeholder:"juan@mail.com"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>E(h),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"12px",background:"#25D366",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:700,color:"#fff",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(jr,{size:16})," WhatsApp"]}),e.jsxs("button",{onClick:()=>w(h),disabled:!v,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"12px",background:v?C.ink:C.bg,border:"none",borderRadius:6,cursor:v?"pointer":"default",fontSize:13,fontWeight:600,color:v?"#fff":C.inkLight,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(An,{size:16})," Email"]})]})]})});return e.jsxs("div",{className:"fade",children:[T,e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("p",{style:{fontSize:10,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 10px"},children:"Crear desde plantilla"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:10},children:[Sh.map((Q,Se)=>e.jsxs("div",{onClick:()=>l(Q),style:{background:C.surface,border:`1px solid ${C.border}`,borderRadius:6,padding:16,cursor:"pointer",transition:"all .15s"},onMouseEnter:ae=>{ae.currentTarget.style.borderColor=C.ink,ae.currentTarget.style.boxShadow=C.shadowSm},onMouseLeave:ae=>{ae.currentTarget.style.borderColor=C.border,ae.currentTarget.style.boxShadow="none"},children:[e.jsx("div",{style:{fontSize:28,marginBottom:8},children:Q.icon}),e.jsx("div",{style:{fontSize:13,fontWeight:700,marginBottom:2},children:Q.nombre}),e.jsx("div",{style:{fontSize:11,color:C.inkLight},children:Q.desc}),e.jsxs("div",{style:{fontSize:9,color:C.inkXLight,marginTop:6},children:[Q.campos.length," campos"]})]},Se)),e.jsxs("div",{onClick:x,style:{background:C.bg,border:`2px dashed ${C.border}`,borderRadius:6,padding:16,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:120,transition:"all .15s"},onMouseEnter:Q=>Q.currentTarget.style.borderColor=C.ink,onMouseLeave:Q=>Q.currentTarget.style.borderColor=C.border,children:[e.jsx(Oe,{size:24,style:{color:C.inkLight,marginBottom:6}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:C.inkMid},children:"En blanco"})]})]})]}),o?e.jsx("div",{style:{textAlign:"center",padding:40,color:C.inkLight},children:"Cargando..."}):t.length>0&&e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:10,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 10px"},children:["Mis formularios (",t.length,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map(Q=>{var Se;return e.jsxs("div",{style:{background:C.surface,border:`1px solid ${C.border}`,borderRadius:4,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:Q.nombre}),e.jsxs("div",{style:{fontSize:10,color:C.inkLight,marginTop:2},children:[((Se=Q.campos)==null?void 0:Se.length)||0," campos  ",Q.updatedAt?new Date(Q.updatedAt).toLocaleDateString("es-CO"):""]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>b(Q),style:{padding:"6px 12px",background:"#25D366",color:"#fff",border:"none",borderRadius:4,fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Compartir"}),e.jsx("button",{onClick:()=>{var ae;return r({...Q,campos:((ae=Q.campos)==null?void 0:ae.map(U=>({...U})))||[]})},style:{padding:"6px 12px",background:C.surface,border:`1px solid ${C.border}`,borderRadius:4,fontSize:10,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Editar"}),e.jsx("button",{onClick:()=>u(Q.id),style:{padding:"6px 8px",background:"transparent",border:`1px solid ${C.border}`,borderRadius:4,cursor:"pointer",color:C.error},children:e.jsx(He,{size:11})})]})]},Q.id)})})]})]})}function kh(){return e.jsx(Ch,{})}function wh({sv:t,onCreateOfferFromBriefing:i,onCreateClientFromBriefing:o}){const[n,a]=F.useState("enviar"),[r,s]=F.useState([]),[g,h]=F.useState(!0),[b,j]=F.useState(null),[k,v]=F.useState(null),[m,f]=F.useState(!1),[p,d]=F.useState(""),[c,l]=F.useState(null);F.useEffect(()=>{Sa().then(z=>{s(z),h(!1)})},[]);const x=()=>{h(!0),Sa().then(z=>{s(z),h(!1)})},y=async z=>{window.confirm("Eliminar este briefing?")&&(v(z),await mh(z),s(T=>T.filter(L=>L.id!==z)),v(null))},u=async z=>{const T={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0],...z};return await Ls(T),s(L=>[T,...L]),T},S=async()=>{try{let z=JSON.parse(p);if(Array.isArray(z)){for(const T of z)await u(T);alert(` ${z.length} briefing(s) importados`)}else await u(z),alert(" Briefing importado");d(""),f(!1)}catch{alert(" JSON invlido. Copia el JSON exacto de Getformly.")}},A=()=>({nombre:"",email:"",telefono:"",como_conociste:"",ciudad:"",edificio:"",direccion_proyecto:"",tipo_proyecto:"Diseo interior",area_m2:"",num_habitaciones:"",estilo:[],colores_materiales:"",espacios:[],fecha_inicio:"",plazo:"",presupuesto:"",financiacion:"",lo_mas_importante:"",que_esperas:[],contratistas:"",forma_pago:"",razon_social:"",documento:"",email_factura:"",dir_facturacion:"",retenciones:"No",detalle_retenciones:"",links_ref:""}),E=[{id:"enviar",lbl:"Mis formularios",I:zn},{id:"recibidos",lbl:`Recibidos (${r.length})`,I:al},{id:"ingresar",lbl:"Ingresar manual",I:Vo}],w={width:"100%",padding:"7px 10px",border:`1px solid ${C.border}`,borderRadius:4,fontFamily:"'DM Sans',sans-serif",fontSize:12,background:C.surface,color:C.ink,boxSizing:"border-box"},_={fontSize:9,fontWeight:600,color:C.inkLight,display:"block",marginBottom:4,textTransform:"uppercase",letterSpacing:1};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,letterSpacing:-.5,margin:"0 0 4px"},children:"Formularios"}),e.jsx("p",{style:{fontSize:12,color:C.inkLight,margin:0},children:"Enva el briefing, ingresa respuestas y crea clientes y ofertas"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>f(!0),style:{padding:"7px 14px",border:`1px solid ${C.border}`,borderRadius:3,background:C.surface,color:C.inkMid,fontFamily:"'DM Sans',sans-serif",fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:" Importar JSON"}),e.jsx("button",{onClick:x,style:{padding:"7px 14px",border:`1px solid ${C.border}`,borderRadius:3,background:C.surface,color:C.inkMid,fontFamily:"'DM Sans',sans-serif",fontSize:11,cursor:"pointer"},children:" Actualizar"})]})]}),m&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:z=>z.target===z.currentTarget&&f(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:560,width:"100%",padding:24,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsx("h3",{style:{fontSize:15,fontWeight:700,margin:"0 0 8px"},children:" Importar JSON de Getformly"}),e.jsx("p",{style:{fontSize:11,color:C.inkMid,margin:"0 0 12px"},children:"Pega el JSON de la respuesta del formulario. Acepta un objeto o un array de objetos."}),e.jsx("textarea",{value:p,onChange:z=>d(z.target.value),placeholder:'{"nombre": "Juan Prez", "email": "juan@mail.com", ...}',rows:10,style:{...w,fontSize:11,fontFamily:"'DM Mono',monospace",resize:"vertical"}}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:S,style:{padding:"8px 18px",background:C.ink,color:"#fff",border:"none",borderRadius:4,fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Importar"}),e.jsx("button",{onClick:()=>{f(!1),d("")},style:{padding:"8px 18px",background:"transparent",color:C.inkMid,border:`1px solid ${C.border}`,borderRadius:4,fontSize:12,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"})]})]})}),e.jsx("div",{style:{display:"flex",gap:2,marginBottom:20,borderBottom:`1px solid ${C.border}`,paddingBottom:0},children:E.map(z=>e.jsxs("button",{onClick:()=>a(z.id),style:{display:"flex",alignItems:"center",gap:7,padding:"10px 18px",border:"none",borderBottom:n===z.id?`2px solid ${C.ink}`:"2px solid transparent",background:"transparent",color:n===z.id?C.ink:C.inkLight,fontFamily:"'DM Sans',sans-serif",fontSize:12,fontWeight:n===z.id?700:400,cursor:"pointer",letterSpacing:.5,marginBottom:-1},children:[e.jsx(z.I,{size:13}),z.lbl]},z.id))}),n==="enviar"&&e.jsx(kh,{}),n==="ingresar"&&(()=>{const z=c||A(),T=(P,te)=>l(he=>({...he||A(),[P]:te}));c||l(A());const L=["Moderno","Contemporneo","Minimalista","Industrial","Nrdico","Clsico","Rstico","Eclctico","Japandi","Otro"],Z=["Sala","Comedor","Cocina","Habitacin principal","Habitacin secundaria","Bao social","Bao privado","Estudio","Terraza/Balcn","Zona de lavandera","Lobby/Hall"],K=async()=>{if(!z.nombre){alert("El nombre es obligatorio");return}const P=await u(z);l(A()),a("recibidos"),alert(` Briefing de "${P.nombre}" guardado`)};return e.jsx("div",{className:"fade",children:e.jsxs(Je,{style:{padding:22,borderLeft:`3px solid ${C.ink}`},children:[e.jsx(jt,{t:"Ingresar respuesta de briefing",s:"Completa los campos segn la informacin proporcionada por el cliente"}),e.jsxs("div",{style:{marginTop:16,marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:C.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${C.border}`},children:" Datos del cliente"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Nombre completo *"}),e.jsx("input",{value:z.nombre,onChange:P=>T("nombre",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Email"}),e.jsx("input",{type:"email",value:z.email,onChange:P=>T("email",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Telfono"}),e.jsx("input",{value:z.telefono,onChange:P=>T("telefono",P.target.value),placeholder:"300 123 4567",style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Cmo nos conoci?"}),e.jsxs("select",{value:z.como_conociste,onChange:P=>T("como_conociste",P.target.value),style:w,children:[e.jsx("option",{value:"",children:""}),["Instagram","Google","Referido","Pgina web","Evento","Otro"].map(P=>e.jsx("option",{children:P},P))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Ciudad"}),e.jsx("input",{value:z.ciudad,onChange:P=>T("ciudad",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Edificio / Conjunto"}),e.jsx("input",{value:z.edificio,onChange:P=>T("edificio",P.target.value),style:w})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:C.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${C.border}`},children:" Datos del proyecto"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Tipo de proyecto"}),e.jsx("select",{value:z.tipo_proyecto,onChange:P=>T("tipo_proyecto",P.target.value),style:w,children:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"].map(P=>e.jsx("option",{children:P},P))})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Direccin del proyecto"}),e.jsx("input",{value:z.direccion_proyecto,onChange:P=>T("direccion_proyecto",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"rea (m)"}),e.jsx("input",{type:"number",value:z.area_m2,onChange:P=>T("area_m2",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"N habitaciones / reas"}),e.jsx("input",{value:z.num_habitaciones,onChange:P=>T("num_habitaciones",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Fecha tentativa inicio"}),e.jsx("input",{type:"date",value:z.fecha_inicio,onChange:P=>T("fecha_inicio",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Plazo deseado"}),e.jsx("input",{value:z.plazo,onChange:P=>T("plazo",P.target.value),placeholder:"Ej: 3 meses",style:w})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:C.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${C.border}`},children:" Estilo y preferencias"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Estilos preferidos (seleccionar varios)"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:2},children:L.map(P=>{const te=(z.estilo||[]).includes(P);return e.jsx("button",{onClick:()=>T("estilo",te?(z.estilo||[]).filter(he=>he!==P):[...z.estilo||[],P]),style:{padding:"4px 10px",fontSize:10,fontWeight:te?700:400,borderRadius:20,border:te?`1px solid ${C.ink}`:`1px solid ${C.border}`,background:te?C.ink:"#fff",color:te?"#fff":C.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:P},P)})})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Espacios a intervenir"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:2},children:Z.map(P=>{const te=(z.espacios||[]).includes(P);return e.jsx("button",{onClick:()=>T("espacios",te?(z.espacios||[]).filter(he=>he!==P):[...z.espacios||[],P]),style:{padding:"4px 10px",fontSize:10,fontWeight:te?700:400,borderRadius:20,border:te?`1px solid ${C.info}`:`1px solid ${C.border}`,background:te?C.infoBg:"#fff",color:te?C.info:C.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:P},P)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Colores y materiales preferidos"}),e.jsx("textarea",{value:z.colores_materiales,onChange:P=>T("colores_materiales",P.target.value),rows:2,style:{...w,resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Links de referencia (Pinterest, etc.)"}),e.jsx("textarea",{value:z.links_ref,onChange:P=>T("links_ref",P.target.value),rows:2,style:{...w,resize:"vertical"}})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:C.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${C.border}`},children:" Presupuesto y expectativas"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Presupuesto aproximado (COP)"}),e.jsx("input",{type:"number",value:z.presupuesto,onChange:P=>T("presupuesto",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Financiacin"}),e.jsxs("select",{value:z.financiacion,onChange:P=>T("financiacion",P.target.value),style:w,children:[e.jsx("option",{value:"",children:""}),["Recursos propios","Crdito hipotecario","Leasing","Otro"].map(P=>e.jsx("option",{children:P},P))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Forma de pago"}),e.jsxs("select",{value:z.forma_pago,onChange:P=>T("forma_pago",P.target.value),style:w,children:[e.jsx("option",{value:"",children:""}),["Transferencia","Tarjeta de crdito","Efectivo","Cheque","Otro"].map(P=>e.jsx("option",{children:P},P))]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Lo ms importante del proyecto"}),e.jsx("textarea",{value:z.lo_mas_importante,onChange:P=>T("lo_mas_importante",P.target.value),rows:2,style:{...w,resize:"vertical"},placeholder:"Qu es lo que ms le importa al cliente?"})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Qu espera lograr?"}),e.jsx("textarea",{value:Array.isArray(z.que_esperas)?z.que_esperas.join(`
`):z.que_esperas||"",onChange:P=>T("que_esperas",P.target.value.split(`
`)),rows:2,style:{...w,resize:"vertical"},placeholder:"Una lnea por expectativa"})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:C.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${C.border}`},children:" Datos de facturacin (si aplica)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Razn social"}),e.jsx("input",{value:z.razon_social,onChange:P=>T("razon_social",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"NIT / Cdula"}),e.jsx("input",{value:z.documento,onChange:P=>T("documento",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Email facturacin"}),e.jsx("input",{value:z.email_factura,onChange:P=>T("email_factura",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Direccin facturacin"}),e.jsx("input",{value:z.dir_facturacion,onChange:P=>T("dir_facturacion",P.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Retenciones especiales"}),e.jsx("select",{value:z.retenciones,onChange:P=>T("retenciones",P.target.value),style:w,children:["No","S"].map(P=>e.jsx("option",{children:P},P))})]}),z.retenciones==="S"&&e.jsxs("div",{children:[e.jsx("label",{style:_,children:"Detalle retenciones"}),e.jsx("input",{value:z.detalle_retenciones,onChange:P=>T("detalle_retenciones",P.target.value),style:w})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16,paddingTop:16,borderTop:`1px solid ${C.border}`},children:[e.jsx(ut,{icon:xt,on:K,children:"Guardar briefing"}),e.jsx(ut,{v:"out",on:async()=>{if(!z.nombre){alert("El nombre es obligatorio");return}const P=await u(z);o&&o(P),l(A()),a("recibidos")},children:" Guardar + Crear cliente"}),e.jsx(ut,{v:"out",on:async()=>{if(!z.nombre){alert("El nombre es obligatorio");return}const P=await u(z);i(P,t),l(A())},children:" Guardar + Crear oferta"}),e.jsx(ut,{v:"out",on:()=>l(A()),children:"Limpiar"})]})]})})})(),n==="recibidos"&&(g?e.jsx("div",{style:{textAlign:"center",padding:"60px 0",color:C.inkLight},children:"Cargando briefings..."}):r.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"80px 0"},children:[e.jsx(al,{size:40,style:{color:C.inkXLight,display:"block",margin:"0 auto 14px"}}),e.jsx("p",{style:{color:C.inkLight,fontSize:14},children:"No hay briefings recibidos an"}),e.jsx("p",{style:{color:C.inkXLight,fontSize:12,marginTop:6},children:"Ingresa uno manualmente o importa un JSON desde Getformly"}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:16},children:[e.jsxs("button",{onClick:()=>a("ingresar"),style:{padding:"8px 18px",background:C.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(Vo,{size:12,style:{marginRight:4}})," Ingresar manualmente"]}),e.jsx("button",{onClick:()=>f(!0),style:{padding:"8px 18px",background:"transparent",color:C.inkMid,border:`1px solid ${C.border}`,borderRadius:6,cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:" Importar JSON"})]})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:r.map(z=>e.jsxs("div",{style:{background:C.surface,border:`1px solid ${C.border}`,borderRadius:3,padding:"14px 18px",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"border-color .15s"},onMouseEnter:T=>T.currentTarget.style.borderColor=C.borderMid,onMouseLeave:T=>T.currentTarget.style.borderColor=C.border,children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("span",{style:{fontWeight:600,fontSize:14,color:C.ink},children:z.nombre||"Sin nombre"}),z.confirmacion==="S"&&e.jsx("span",{style:{fontSize:9,letterSpacing:1,textTransform:"uppercase",background:C.successBg,color:C.success,border:`1px solid ${C.success}33`,padding:"2px 7px",borderRadius:2,fontWeight:700},children:"Completo"})]}),e.jsx("div",{style:{display:"flex",gap:16,marginTop:4,flexWrap:"wrap"},children:[z.email&&{ic:"",v:z.email},z.ciudad&&{ic:"",v:z.ciudad},z.tipo_proyecto&&{ic:"",v:z.tipo_proyecto},z.area_m2&&{ic:"",v:`${z.area_m2} m`},z.presupuesto&&{ic:"",v:`$ ${Number(z.presupuesto).toLocaleString("es-CO")} COP`}].filter(Boolean).map((T,L)=>e.jsxs("span",{style:{fontSize:11,color:C.inkLight},children:[T.ic," ",T.v]},L))})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexShrink:0,marginLeft:16},children:[e.jsx("span",{style:{fontSize:10,color:C.inkXLight,marginRight:4},children:z.fecha||""}),e.jsx("button",{onClick:()=>j(z),style:{padding:"6px 12px",background:C.accentBg,border:`1px solid ${C.border}`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:C.ink,fontWeight:600},children:"Ver detalle"}),e.jsx("button",{onClick:()=>{o&&o(z)},style:{padding:"6px 12px",background:C.infoBg,border:`1px solid ${C.info}33`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:C.info,fontWeight:600},children:"+ Cliente"}),e.jsx("button",{onClick:()=>i(z,t),style:{padding:"6px 12px",background:C.ink,border:"none",borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:"#fff",fontWeight:700,letterSpacing:.5},children:"+ Oferta"}),e.jsx("button",{onClick:()=>y(z.id),disabled:k===z.id,style:{padding:"6px 8px",background:"transparent",border:`1px solid ${C.border}`,borderRadius:3,cursor:"pointer",color:C.error,opacity:k===z.id?.4:1},children:e.jsx(He,{size:11})})]})]},z.id))})),b&&e.jsx(bh,{b,onClose:()=>j(null),onCreateOffer:()=>{j(null),i(b,t)},onCreateClient:()=>{j(null),o&&o(b)}})]})}function zh(){const t="hab:crm:clientes2",[i,o]=F.useState([]),[n,a]=F.useState(null),[r,s]=F.useState(""),[g,h]=F.useState([]),[b,j]=F.useState(!1);F.useEffect(()=>{(()=>{try{const c=Ee.getSync(t);if(c){const l=(JSON.parse(c)||[]).map(x=>({...x,telMovil:(x.telMovil||x.tel||"").replace(/^\+57\s*/,""),notas:(x.notas||"").replace(/Presupuesto: NaN/g,"Presupuesto: ")}));o(l)}}catch{}})(),Sa().then(c=>h(c))},[]);const k=c=>{o(c);try{Ee.set(t,JSON.stringify(c))}catch{}},v=()=>Math.random().toString(36).slice(2,9),m=()=>({id:v(),nombre:"",tipo:"Empresa",nit:"",email:"",tel:"",ciudad:"",pais:"CO",notas:""}),f=i.filter(c=>!r||c.nombre.toLowerCase().includes(r.toLowerCase())||(c.nit||"").includes(r)),p=c=>{const l=rc(c);a(l),j(!1)},d=(c={})=>({border:"1px solid #E0E0E0",borderRadius:6,padding:"7px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",width:"100%",...c});return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Clientes"}),e.jsxs("p",{style:{fontSize:12,color:C.inkLight,margin:"3px 0 0"},children:[i.length," registros"]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[g.length>0&&e.jsxs("button",{onClick:()=>j(!0),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:C.infoBg,color:C.info,border:`1px solid ${C.info}33`,borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600},children:[" Desde briefing (",g.length,")"]}),e.jsxs("button",{onClick:()=>a(m()),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:C.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:600},children:[e.jsx(Oe,{size:14})," Nuevo cliente"]})]})]}),b&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:c=>c.target===c.currentTarget&&j(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",maxHeight:"65vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:"Crear cliente desde briefing"}),e.jsx("div",{style:{fontSize:10,color:"#888",marginTop:2},children:"Los datos se pre-llenarn en el formulario"})]}),e.jsx("button",{onClick:()=>j(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:18})})]}),e.jsxs("div",{style:{overflowY:"auto",padding:14},children:[g.map(c=>e.jsxs("div",{onClick:()=>p(c),style:{padding:"12px 14px",border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,cursor:"pointer"},onMouseEnter:l=>l.currentTarget.style.background="#F5F4F1",onMouseLeave:l=>l.currentTarget.style.background="#fff",children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:c.nombre||"Sin nombre"}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2,display:"flex",gap:12},children:[c.email&&e.jsxs("span",{children:[" ",c.email]}),c.telefono&&e.jsxs("span",{children:[" ",c.telefono]}),c.ciudad&&e.jsxs("span",{children:[" ",c.ciudad]}),c.razon_social&&e.jsxs("span",{children:[" ",c.razon_social]})]})]},c.id)),g.length===0&&e.jsx("div",{style:{textAlign:"center",padding:30,color:"#888",fontSize:12},children:"No hay briefings. Ingresa uno en Formularios  Ingresar manual."})]})]})}),e.jsxs("div",{style:{position:"relative",marginBottom:16},children:[e.jsx(Ci,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:C.inkLight}}),e.jsx("input",{value:r,onChange:c=>s(c.target.value),placeholder:"Buscar por nombre o NIT...",style:{...d(),paddingLeft:32}})]}),n&&e.jsxs(Je,{style:{padding:22,marginBottom:20,borderLeft:`3px solid ${C.ink}`},children:[e.jsx(jt,{t:n.id&&i.find(c=>c.id===n.id)?"Editar cliente":"Nuevo cliente",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(ot,{lbl:"Nombre / Razn social",val:n.nombre,on:c=>a(l=>({...l,nombre:c.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Tipo"}),e.jsx("select",{value:n.tipo,onChange:c=>a(l=>({...l,tipo:c.target.value})),style:{...d()},children:["Empresa","Persona natural","Promotor","Particular"].map(c=>e.jsx("option",{children:c},c))})]}),e.jsx(ot,{lbl:"NIT / CIF / DNI",val:n.nit,on:c=>a(l=>({...l,nit:c.target.value}))}),e.jsx(ot,{lbl:"Email",val:n.email,on:c=>a(l=>({...l,email:c.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mvil"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoMovil||"+57",onChange:c=>a(l=>({...l,prefijoMovil:c.target.value})),style:{...d(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(c=>e.jsx("option",{value:c.split(" ")[0],children:c},c))}),e.jsx("input",{value:n.telMovil||n.tel||"",onChange:c=>a(l=>({...l,telMovil:c.target.value})),placeholder:"300 123 4567",style:{...d()}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Fijo"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoFijo||"+57",onChange:c=>a(l=>({...l,prefijoFijo:c.target.value})),style:{...d(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(c=>e.jsx("option",{value:c.split(" ")[0],children:c},c))}),e.jsx("input",{value:n.telFijo||"",onChange:c=>a(l=>({...l,telFijo:c.target.value})),placeholder:"601 234 5678",style:{...d()}})]})]}),e.jsx(ot,{lbl:"Ciudad",val:n.ciudad,on:c=>a(l=>({...l,ciudad:c.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Pas"}),e.jsx("select",{value:n.pais,onChange:c=>a(l=>({...l,pais:c.target.value})),style:{...d()},children:["CO","ES","MX","US","Otro"].map(c=>e.jsx("option",{children:c},c))})]}),e.jsx(ot,{lbl:"Direccin",val:n.direccion||"",on:c=>a(l=>({...l,direccion:c.target.value}))})]}),e.jsxs("div",{style:{marginTop:16,padding:"16px 0",borderTop:`1px solid ${C.border}`},children:[e.jsx("p",{style:{fontSize:10,fontWeight:700,color:C.inkLight,letterSpacing:1.5,textTransform:"uppercase",margin:"0 0 12px"},children:"Datos de facturacin"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(ot,{lbl:"Razn social",val:n.razonSocial||"",on:c=>a(l=>({...l,razonSocial:c.target.value}))}),e.jsx(ot,{lbl:"Email facturacin",val:n.emailFactura||"",on:c=>a(l=>({...l,emailFactura:c.target.value}))}),e.jsx(ot,{lbl:"Dir. facturacin",val:n.dirFacturacion||"",on:c=>a(l=>({...l,dirFacturacion:c.target.value}))}),e.jsx(ot,{lbl:"Forma de pago",val:n.formaPago||"",on:c=>a(l=>({...l,formaPago:c.target.value}))}),e.jsx(ot,{lbl:"Retenciones",val:n.retenciones||"",on:c=>a(l=>({...l,retenciones:c.target.value}))}),e.jsx(ot,{lbl:"Detalle retenciones",val:n.detalleRet||"",on:c=>a(l=>({...l,detalleRet:c.target.value}))})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginTop:12},children:e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas"}),e.jsx("textarea",{value:n.notas,onChange:c=>a(l=>({...l,notas:c.target.value})),rows:2,style:{...d(),resize:"vertical"}})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:14},children:[e.jsx(ut,{icon:Et,v:"sec",on:()=>{const c=(n.telMovil||"").replace(/^\+57\s*/,""),l=u=>u||'<span style="color:#ccc;font-style:italic"></span>',x=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>${n.nombre} - Habitaris</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
@page{size:A4;margin:20mm 0}
body{font-family:'DM Sans',sans-serif;color:#1a1a1a}
.page{max-width:170mm;margin:0 auto}
/* Logo area */
.logo-row{display:flex;align-items:center;gap:10px;margin-bottom:6px}
.logo-svg{flex-shrink:0}
.brand{font-size:22px;font-weight:300;letter-spacing:1px;color:#1a1a1a}
.brand b{font-weight:800}
/* Divider */
.line{height:1px;background:#1a1a1a;margin:8px 0 20px}
/* Doc title + client */
.title-row{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:24px}
.doc-title{font-size:8px;font-weight:600;letter-spacing:3px;text-transform:uppercase;color:#999}
.client-name{font-size:20px;font-weight:700;letter-spacing:-.3px}
/* Sections */
.sec{margin-bottom:20px}
.sec-t{font-size:7.5px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:#999;margin-bottom:10px;padding-bottom:5px;border-bottom:1px solid #e5e2de}
.g{display:grid;grid-template-columns:1fr 1fr 1fr;gap:2px 20px}
.f{margin-bottom:11px}
.fl{font-size:6.5px;font-weight:600;letter-spacing:1.8px;text-transform:uppercase;color:#aaa;margin-bottom:1px}
.fv{font-size:11px;font-weight:500;color:#1a1a1a;line-height:1.3}
.tag{display:inline-block;padding:1px 7px;background:#f0efec;font-size:9px;font-weight:600;letter-spacing:.5px;color:#666}
.nbox{background:#faf9f7;border-left:2px solid #ddd;padding:10px 14px;font-size:10px;line-height:1.7;color:#666;white-space:pre-wrap}
/* Footer */
.ft{margin-top:30px;padding-top:10px;border-top:1px solid #e5e2de;display:flex;justify-content:space-between}
.ft span{font-size:6px;letter-spacing:1.5px;text-transform:uppercase;color:#bbb}
</style></head><body>
<div class="page">
  <div class="logo-row">
    <svg class="logo-svg" width="38" height="38" viewBox="0 0 34 34" fill="none">
      <rect x="4.5" y="2.5" width="25" height="25" stroke="#1a1a1a" stroke-width=".7" opacity=".35"/>
      <rect x="2.5" y="4.5" width="25" height="25" stroke="#1a1a1a" stroke-width="1.2"/>
      <rect x="7.5" y="10" width="4" height="13" fill="#1a1a1a"/>
      <rect x="7.5" y="15.5" width="13" height="3" fill="#1a1a1a"/>
      <rect x="16.5" y="10" width="4" height="13" fill="#1a1a1a"/>
    </svg>
    <div class="brand"><b>H</b>abitaris</div>
  </div>
  <div class="line"></div>
  <div class="title-row">
    <span class="doc-title">Ficha de cliente</span>
    <span class="client-name">${n.nombre||""}</span>
  </div>

  <div class="sec"><div class="sec-t">Informacin general</div><div class="g">
    <div class="f"><div class="fl">Nombre</div><div class="fv">${l(n.nombre)}</div></div>
    <div class="f"><div class="fl">Tipo</div><div class="fv"><span class="tag">${n.tipo||""}</span></div></div>
    <div class="f"><div class="fl">NIT / CIF / DNI</div><div class="fv">${l(n.nit)}</div></div>
    <div class="f"><div class="fl">Email</div><div class="fv">${l(n.email)}</div></div>
    <div class="f"><div class="fl">Mvil</div><div class="fv">${c?(n.prefijoMovil||"+57")+" "+c:l("")}</div></div>
    <div class="f"><div class="fl">Fijo</div><div class="fv">${l(n.telFijo)}</div></div>
    <div class="f"><div class="fl">Ciudad</div><div class="fv">${l(n.ciudad)}</div></div>
    <div class="f"><div class="fl">Pas</div><div class="fv">${l(n.pais)}</div></div>
    <div class="f"><div class="fl">Direccin</div><div class="fv">${l(n.direccion)}</div></div>
  </div></div>

  <div class="sec"><div class="sec-t">Datos de facturacin</div><div class="g">
    <div class="f"><div class="fl">Razn social</div><div class="fv">${l(n.razonSocial)}</div></div>
    <div class="f"><div class="fl">Email facturacin</div><div class="fv">${l(n.emailFactura)}</div></div>
    <div class="f"><div class="fl">Dir. facturacin</div><div class="fv">${l(n.dirFacturacion)}</div></div>
    <div class="f"><div class="fl">Forma de pago</div><div class="fv">${l(n.formaPago)}</div></div>
    <div class="f"><div class="fl">Retenciones</div><div class="fv">${l(n.retenciones)}</div></div>
    <div class="f"><div class="fl">Detalle retenciones</div><div class="fv">${l(n.detalleRet)}</div></div>
  </div></div>

  ${n.notas?'<div class="sec"><div class="sec-t">Notas</div><div class="nbox">'+n.notas+"</div></div>":""}

  <div class="ft"><span>Habitaris Suite  CRM</span><span>${new Date().toLocaleDateString("es-CO")}</span><span>Confidencial</span></div>
</div></body></html>`,y=window.open("","_blank","width=800,height=1000");y.document.write(x),y.document.close(),y.onafterprint=()=>y.close(),setTimeout(()=>y.print(),500)},children:"PDF / Imprimir"}),n.briefingId&&e.jsx(ut,{v:"sec",on:()=>{try{const c=Ee.getSync("hab:briefing:"+n.briefingId);if(c){const l=JSON.parse(c);a(x=>({...x,email:l.email||x.email,telMovil:(l.telefono||"").replace(/^\+57\s*/,"")||x.telMovil,ciudad:l.ciudad||x.ciudad,direccion:l.direccion_proyecto||x.direccion,razonSocial:l.razon_social||x.razonSocial,emailFactura:l.email_factura||l.email||x.emailFactura,dirFacturacion:l.dir_facturacion||x.dirFacturacion,formaPago:l.forma_pago||x.formaPago,retenciones:l.retenciones||x.retenciones,detalleRet:l.detalle_retenciones||x.detalleRet,nit:l.documento||x.nit})),alert("Datos actualizados desde briefing")}else{const l=Ee.getSync("hab:v4");if(l){const y=(JSON.parse(l)||[]).find(u=>u.briefingId===n.briefingId);y?(a(u=>({...u,email:y.emailCliente||y.email||u.email,telMovil:(y.telCliente||"").replace(/^\+57\s*/,"")||u.telMovil,ciudad:(y.ubicacion||"").split("  ")[0]||u.ciudad,razonSocial:y.razonSocial||u.razonSocial,emailFactura:y.emailFactura||u.emailFactura,dirFacturacion:y.dirFacturacion||u.dirFacturacion,formaPago:y.formaPago||u.formaPago,retenciones:y.retencion?"Si":u.retenciones,detalleRet:y.detalleRet||u.detalleRet,nit:y.documento||u.nit})),alert("Datos actualizados desde la oferta vinculada")):alert("No se encontraron datos del briefing ni oferta vinculada")}else alert("No se encontraron datos del briefing")}}catch(c){alert("Error: "+c.message)}},children:"Actualizar datos"}),e.jsx(ut,{icon:xt,on:()=>{if(!n.nombre){alert("El nombre es obligatorio");return}const c=i.find(l=>l.id===n.id);k(c?i.map(l=>l.id===n.id?n:l):[...i,n]),a(null)},children:"Guardar"}),e.jsx(ut,{v:"out",on:()=>a(null),children:"Cancelar"}),i.find(c=>c.id===n.id)&&e.jsxs(ut,{v:"out",on:()=>{window.confirm("Eliminar?")&&(k(i.filter(c=>c.id!==n.id)),a(null))},children:[e.jsx(He,{size:13})," Eliminar"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280px,1fr))",gap:12},children:[f.map(c=>e.jsxs(Je,{style:{padding:18,cursor:"pointer",transition:"box-shadow .15s"},onClick:()=>a({...c}),onMouseEnter:l=>l.currentTarget.style.boxShadow=C.shadowMd,onMouseLeave:l=>l.currentTarget.style.boxShadow=C.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:C.ink},children:c.nombre}),e.jsxs("div",{style:{fontSize:11,color:C.inkLight,marginTop:2},children:[c.tipo,"  ",c.ciudad||"","  ",c.pais]})]}),e.jsx("div",{style:{background:C.accentBg,borderRadius:4,padding:"2px 7px",fontSize:10,color:C.inkMid},children:c.nit||""})]}),(c.email||c.telMovil||c.tel||c.telFijo)&&e.jsxs("div",{style:{marginTop:8,fontSize:11,color:C.inkMid,display:"flex",gap:12,flexWrap:"wrap"},children:[c.email&&e.jsxs("span",{children:[" ",c.email]}),(c.telMovil||c.tel)&&e.jsxs("span",{children:[" ",c.prefijoMovil||"+57"," ",(c.telMovil||c.tel||"").replace(/^\+57\s*/,"")]}),c.telFijo&&e.jsxs("span",{children:[" ",c.prefijoFijo||"+57"," ",c.telFijo]})]})]},c.id)),f.length===0&&e.jsx("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:40,color:C.inkLight,fontSize:13},children:r?"Sin resultados. Prueba otro trmino.":"Sin clientes. Aade el primero."})]})]})}function Eh(){const t="hab:crm:proveedores",[i,o]=F.useState([]),[n,a]=F.useState(null),[r,s]=F.useState(""),[g,h]=F.useState("Todos"),b=["Todos","Preliminares","Demoliciones","Movimiento de tierras","Cimentaciones","Estructura","Mampostera","Cubierta","Instalaciones elctricas","Instalaciones hidrosanitarias","Instalaciones de gas","Acabados","Pisos y enchapes","Pintura","Carpintera metlica","Carpintera madera / mobiliario","Obras exteriores","Equipamiento especial","Diseo y direccin","Otros"];F.useEffect(()=>{(()=>{try{const p=Ee.getSync(t);p&&o(JSON.parse(p)||[])}catch{}})()},[]);const j=p=>{o(p);try{Ee.set(t,JSON.stringify(p))}catch{}},k=()=>Math.random().toString(36).slice(2,9),v=()=>({id:k(),nombre:"",categoria:"Materiales",nit:"",email:"",tel:"",contacto:"",ciudad:"",web:"",notas:"",calificacion:5,metodoPago:"Transferencia",formaPago:"Contado",prefijoFijo:"+601"}),m=i.filter(p=>(g==="Todos"||p.categoria===g)&&(!r||p.nombre.toLowerCase().includes(r.toLowerCase()))),f=(p={})=>({border:"1px solid #E0E0E0",borderRadius:6,padding:"7px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",width:"100%",...p});return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Proveedores"}),e.jsxs("p",{style:{fontSize:12,color:C.inkLight,margin:"3px 0 0"},children:[i.length," registros"]})]}),e.jsxs("button",{onClick:()=>a(v()),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:C.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:600},children:[e.jsx(Oe,{size:14})," Nuevo proveedor"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(Ci,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:C.inkLight}}),e.jsx("input",{value:r,onChange:p=>s(p.target.value),placeholder:"Buscar proveedor...",style:{...f(),paddingLeft:32}})]}),b.map(p=>e.jsx("button",{onClick:()=>h(p),style:{padding:"6px 12px",border:`1px solid ${g===p?C.ink:C.border}`,borderRadius:20,background:g===p?C.ink:"transparent",color:g===p?"#fff":C.inkMid,cursor:"pointer",fontSize:11,fontFamily:"'DM Sans',sans-serif",fontWeight:g===p?600:400},children:p},p))]}),n&&e.jsxs(Je,{style:{padding:22,marginBottom:20,borderLeft:"3px solid #3B3B3B"},children:[e.jsx(jt,{t:i.find(p=>p.id===n.id)?"Editar proveedor":"Nuevo proveedor",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(ot,{lbl:"Nombre / Razn social",val:n.nombre,on:p=>a(d=>({...d,nombre:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Categora"}),e.jsx("select",{value:n.categoria,onChange:p=>a(d=>({...d,categoria:p.target.value})),style:{...f()},children:b.filter(p=>p!=="Todos").map(p=>e.jsx("option",{children:p},p))})]}),e.jsx(ot,{lbl:"NIT / CIF",val:n.nit,on:p=>a(d=>({...d,nit:p.target.value}))}),e.jsx(ot,{lbl:"Contacto",val:n.contacto,on:p=>a(d=>({...d,contacto:p.target.value}))}),e.jsx(ot,{lbl:"Email",val:n.email,on:p=>a(d=>({...d,email:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mvil"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoMovil||"+57",onChange:p=>a(d=>({...d,prefijoMovil:p.target.value})),style:{...f(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(p=>e.jsx("option",{value:p.split(" ")[0],children:p},p))}),e.jsx("input",{value:n.telMovil||n.tel||"",onChange:p=>a(d=>({...d,telMovil:p.target.value})),placeholder:"300 123 4567",style:{...f()}})]})]}),e.jsx(ot,{lbl:"Ciudad",val:n.ciudad,on:p=>a(d=>({...d,ciudad:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Telfono fijo"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoFijo||"+601",onChange:p=>a(d=>({...d,prefijoFijo:p.target.value})),style:{...f(),width:90,flexShrink:0,fontSize:12},children:["+601  Bog","+602  Cali","+604  Med","+605  B/manga","+91  Mad","+93  Bcn"].map(p=>e.jsx("option",{value:p.split(" ")[0],children:p},p))}),e.jsx("input",{value:n.telFijo||"",onChange:p=>a(d=>({...d,telFijo:p.target.value})),placeholder:"234 5678",style:{...f()}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mtodo de pago"}),e.jsx("select",{value:n.metodoPago||"Transferencia",onChange:p=>a(d=>({...d,metodoPago:p.target.value})),style:{...f()},children:["Transferencia","Cheque","Efectivo","PSE","Consignacin","Otro"].map(p=>e.jsx("option",{children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Forma de pago (plazo)"}),e.jsx("select",{value:n.formaPago||"Contado",onChange:p=>a(d=>({...d,formaPago:p.target.value})),style:{...f()},children:["Contado","Crdito 15d","Crdito 30d","Crdito 45d","Crdito 60d","Crdito 90d","Anticipo + saldo","Otro"].map(p=>e.jsx("option",{children:p},p))})]}),e.jsx(ot,{lbl:"Sitio web",val:n.web,on:p=>a(d=>({...d,web:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Calificacin (1-5)"}),e.jsx("div",{style:{display:"flex",gap:4},children:[1,2,3,4,5].map(p=>e.jsx("button",{onClick:()=>a(d=>({...d,calificacion:p})),style:{fontSize:20,background:"none",border:"none",cursor:"pointer",color:p<=n.calificacion?"#F5A623":"#DDD"},children:""},p))})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas"}),e.jsx("textarea",{value:n.notas,onChange:p=>a(d=>({...d,notas:p.target.value})),rows:2,style:{...f(),resize:"vertical"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:14},children:[e.jsx(ut,{icon:xt,on:()=>{if(!n.nombre){alert("El nombre es obligatorio");return}const p=i.find(d=>d.id===n.id);j(p?i.map(d=>d.id===n.id?n:d):[...i,n]),a(null)},children:"Guardar"}),e.jsx(ut,{v:"out",on:()=>a(null),children:"Cancelar"}),i.find(p=>p.id===n.id)&&e.jsxs(ut,{v:"out",on:()=>{window.confirm("Eliminar?")&&(j(i.filter(p=>p.id!==n.id)),a(null))},children:[e.jsx(He,{size:13})," Eliminar"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(290px,1fr))",gap:12},children:[m.map(p=>e.jsxs(Je,{style:{padding:18,cursor:"pointer",transition:"box-shadow .15s"},onClick:()=>a({...p}),onMouseEnter:d=>d.currentTarget.style.boxShadow=C.shadowMd,onMouseLeave:d=>d.currentTarget.style.boxShadow=C.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:C.ink},children:p.nombre}),e.jsxs("div",{style:{fontSize:11,color:C.inkLight,marginTop:2},children:[p.categoria,"  ",p.ciudad||""]})]}),e.jsx("div",{style:{display:"flex",gap:1},children:[1,2,3,4,5].map(d=>e.jsx("span",{style:{fontSize:12,color:d<=(p.calificacion||0)?"#F5A623":"#DDD"},children:""},d))})]}),(p.contacto||p.email||p.telMovil||p.tel||p.telFijo)&&e.jsxs("div",{style:{marginTop:8,fontSize:11,color:C.inkMid,display:"flex",gap:10,flexWrap:"wrap"},children:[p.contacto&&e.jsxs("span",{children:[" ",p.contacto]}),p.email&&e.jsxs("span",{children:[" ",p.email]}),(p.telMovil||p.tel)&&e.jsxs("span",{children:[" ",p.prefijoMovil||"+57"," ",p.telMovil||p.tel]}),p.telFijo&&e.jsxs("span",{children:[" ",p.prefijoFijo||"+601"," ",p.telFijo]})]}),(p.formaPago||p.metodoPago||p.nit)&&e.jsxs("div",{style:{marginTop:4,fontSize:10,color:C.inkLight,display:"flex",gap:10},children:[p.nit&&e.jsxs("span",{children:["NIT: ",p.nit]}),p.metodoPago&&e.jsxs("span",{children:[" ",p.metodoPago]}),p.formaPago&&e.jsxs("span",{children:[" ",p.formaPago]})]})]},p.id)),m.length===0&&e.jsx("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:40,color:C.inkLight,fontSize:13},children:r||g!=="Todos"?"Sin resultados.":"Sin proveedores. Aade el primero."})]})]})}const Ah=[{id:"dashboard",lbl:"Dashboard",en:"Dashboard",I:Pc},{id:"offers",lbl:"Ofertas",en:"Offers",I:Et},{id:"clientes",lbl:"Clientes",en:"Clients",I:kd}];function Fh({view:t,sv:i,lang:o,setLang:n,open:a,toggle:r}){return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,className:"no-print",style:{position:"fixed",top:10,left:a?208:10,zIndex:1002,width:28,height:28,background:a?"rgba(255,255,255,0.1)":"#111",color:a?"rgba(255,255,255,0.5)":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",transition:"left .2s ease"},children:a?"":""}),e.jsxs("div",{className:"no-print",style:{width:200,background:C.sidebar,height:"100vh",position:"fixed",left:a?0:-200,top:0,display:"flex",flexDirection:"column",transition:"left .2s ease",zIndex:1001},children:[e.jsx("div",{style:{padding:"22px 18px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(tl,{size:32,color:"#fff"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:"'DM Sans', sans-serif",fontWeight:600,fontSize:14,letterSpacing:4,color:"#fff",textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:9,letterSpacing:2,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",fontWeight:400},children:o==="en"?"CRM  Offers":"CRM  Ofertas"})]})]})}),e.jsx("nav",{style:{padding:"12px 8px",flex:1},children:Ah.map(s=>{const g=t===s.id||t.startsWith("offer-")&&s.id==="offers";return e.jsxs("button",{onClick:()=>i(s.id),style:{display:"flex",alignItems:"center",gap:10,width:"100%",padding:"10px 12px",borderRadius:2,border:"none",cursor:"pointer",background:g?C.sidebarAct:"transparent",color:g?"#fff":"rgba(255,255,255,0.35)",fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:g?600:400,letterSpacing:1.2,textTransform:"uppercase",marginBottom:1,transition:"all .15s",borderLeft:g?"2px solid rgba(255,255,255,0.6)":"2px solid transparent"},children:[e.jsx(s.I,{size:13}),o==="en"&&s.en?s.en:s.lbl]},s.id)})}),e.jsxs("div",{style:{padding:"14px 18px",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("div",{style:{display:"flex",gap:0,marginBottom:8},children:[["es"," ES"],["en"," EN"]].map(([s,g])=>e.jsx("button",{onClick:()=>n(s),style:{flex:1,padding:"5px 0",fontSize:10,fontWeight:600,cursor:"pointer",border:"1px solid rgba(255,255,255,0.15)",fontFamily:"'DM Sans',sans-serif",borderRadius:s==="es"?"4px 0 0 4px":"0 4px 4px 0",background:o===s?"#fff":"transparent",color:o===s?"#111":"rgba(255,255,255,0.4)"},children:g},s))}),e.jsx("p",{style:{fontSize:9,color:"rgba(255,255,255,0.15)",margin:0,letterSpacing:1,textTransform:"uppercase"},children:"v3.0  Fase 2  2025"})]})]})]})}function Th({offers:t,sv:i,sei:o,lang:n}){const a=F.useMemo(()=>{const s=t.filter(b=>b.estado==="Ganada"),g=t.filter(b=>b.estado==="Perdida"),h=t.filter(b=>!["Ganada","Perdida","Cancelada"].includes(b.estado));return{gan:s,per:g,act:h,pip:h.reduce((b,j)=>b+(er(j).PVP_IVA||0),0),ganado:s.reduce((b,j)=>b+(er(j).PVP_IVA||0),0),tasa:s.length+g.length>0?(s.length/(s.length+g.length)*100).toFixed(0):0}},[t]),r=[...t].sort((s,g)=>new Date(g.updatedAt)-new Date(s.updatedAt)).slice(0,6);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{marginBottom:28},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 6px"},children:n==="en"?"General panel":"Panel general"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:C.ink,margin:0,letterSpacing:-.5},children:"Dashboard"})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[e.jsx(Lr,{lbl:n==="en"?"Total offers":"Total ofertas",val:t.length,icon:Et,col:C.ink}),e.jsx(Lr,{lbl:n==="en"?"Active pipeline":"Pipeline activo",val:Ye(a.pip),icon:Ji,col:C.info,sub:`${a.act.length} ${n==="en"?"offer(s)":"oferta(s)"}`}),e.jsx(Lr,{lbl:n==="en"?"Total won":"Total ganado",val:Ye(a.ganado),icon:Sd,col:C.success,sub:`${a.gan.length} ${n==="en"?"won":"ganada(s)"}`}),e.jsx(Lr,{lbl:n==="en"?"Win rate":"% Adjudicacin",val:`${a.tasa}%`,icon:$c,col:C.warning,sub:`${a.per.length} ${n==="en"?"lost":"perdida(s)"}`})]}),e.jsx("div",{style:{display:"flex",gap:8,marginBottom:22,flexWrap:"wrap"},children:il.map(s=>{const g=t.filter(h=>h.estado===s).length;return g?e.jsxs("div",{onClick:()=>i("offers"),style:{display:"flex",alignItems:"center",gap:8,background:C.surface,border:`1px solid ${C.border}`,borderRadius:2,padding:"7px 13px",cursor:"pointer"},children:[e.jsx(Ns,{e:s}),e.jsx("span",{style:{fontSize:13,fontWeight:700,color:C.ink},children:g})]},s):null})}),e.jsxs(Je,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${C.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:13,fontWeight:700,color:C.ink,margin:0,textTransform:"uppercase",letterSpacing:.5},children:"Ofertas recientes"}),e.jsx(ut,{v:"ghost",sm:!0,icon:Yi,on:()=>i("offers"),children:"Ver todas"})]}),r.length===0?e.jsxs("div",{style:{padding:48,textAlign:"center",color:C.inkLight},children:[e.jsx(Et,{size:30,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{margin:"0 0 14px",fontSize:13},children:"An no hay ofertas"}),e.jsx(ut,{icon:Oe,on:()=>i("offer-new"),children:"Nueva oferta"})]}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Cliente","Proyecto","Tipo","PVP c/IVA","Estado",""].map(s=>e.jsx("th",{style:{padding:"10px 16px",textAlign:"left",fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:1.2},children:s},s))})}),e.jsx("tbody",{children:r.map(s=>{const g=er(s);return e.jsxs("tr",{style:{borderTop:`1px solid ${C.border}`},onMouseEnter:h=>h.currentTarget.style.background="#FFFFFF",onMouseLeave:h=>h.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"12px 16px",fontSize:13,fontWeight:500,color:C.ink},children:s.cliente||""}),e.jsx("td",{style:{padding:"12px 16px",fontSize:12,color:C.inkMid},children:s.proyecto||""}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("span",{style:{fontSize:9,background:C.accentBg,color:C.ink,padding:"2px 8px",borderRadius:2,fontWeight:700,letterSpacing:1,textTransform:"uppercase"},children:s.tipoProyecto==="DISEO"?(s.subtipoDiseno||"Diseo").split(" ").pop():s.tipoProyecto})}),e.jsx("td",{style:{padding:"12px 16px",fontSize:13,fontWeight:700,color:C.ink},children:Ye(g.PVP_IVA)}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(Ns,{e:s.estado})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(ut,{sm:!0,v:"ghost",icon:Vo,on:()=>{o(s.id),i("offer-edit")}})})]},s.id)})})]})]})]})}function Bh({offers:t,sv:i,sei:o,onDel:n,onDup:a}){const[r,s]=F.useState(""),[g,h]=F.useState("Todos"),[b,j]=F.useState("Todos"),k=F.useMemo(()=>t.filter(v=>(!r||[v.cliente,v.proyecto,v.ubicacion].join(" ").toLowerCase().includes(r.toLowerCase()))&&(g==="Todos"||v.estado===g)&&(b==="Todos"||v.tipoProyecto===b)).sort((v,m)=>new Date(m.updatedAt)-new Date(v.updatedAt)),[t,r,g,b]);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:28},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 6px"},children:"Biblioteca"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:C.ink,margin:0,letterSpacing:-.5},children:"Ofertas"}),e.jsxs("p",{style:{color:C.inkLight,fontSize:11,margin:"4px 0 0"},children:[t.length," oferta(s) registrada(s)"]})]}),e.jsx(ut,{icon:Oe,on:()=>i("offer-new"),children:"Nueva oferta"})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(Ci,{size:13,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:C.inkLight}}),e.jsx("input",{value:r,onChange:v=>s(v.target.value),placeholder:"Buscar cliente, proyecto...",style:{width:"100%",padding:"9px 12px 9px 32px",border:`1px solid ${C.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:C.surface,color:C.ink}})]}),[{val:g,sv:h,opts:["Todos",...il]},{val:b,sv:j,opts:["Todos","OBRA","DISEO"]}].map(({val:v,sv:m,opts:f},p)=>e.jsx("select",{value:v,onChange:d=>m(d.target.value),style:{padding:"9px 12px",border:`1px solid ${C.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:C.surface,color:C.ink},children:f.map(d=>e.jsx("option",{value:d,children:d},d))},p))]}),e.jsx(Je,{style:{padding:0,overflow:"hidden"},children:k.length===0?e.jsx("div",{style:{padding:40,textAlign:"center",color:C.inkLight},children:e.jsx("p",{style:{fontSize:13},children:"No se encontraron ofertas"})}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["#","Cliente / Proyecto","Modalidad","Costo dir.","PVP c/IVA","Margen","Estado","Fecha",""].map(v=>e.jsx("th",{style:{padding:"10px 14px",textAlign:"left",fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,whiteSpace:"nowrap"},children:v},v))})}),e.jsx("tbody",{children:k.map((v,m)=>{const f=er(v);return e.jsxs("tr",{style:{borderTop:`1px solid ${C.border}`},onMouseEnter:p=>p.currentTarget.style.background="#FFFFFF",onMouseLeave:p=>p.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"11px 14px",fontSize:10,color:C.inkLight,fontWeight:600},children:String(m+1).padStart(3,"0")}),e.jsxs("td",{style:{padding:"11px 14px"},children:[e.jsx("p",{style:{margin:0,fontSize:13,fontWeight:600,color:C.ink},children:v.cliente||""}),e.jsx("p",{style:{margin:0,fontSize:11,color:C.inkLight},children:v.proyecto||"Sin nombre"})]}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsx("span",{style:{fontSize:9,background:C.accentBg,color:C.ink,padding:"2px 8px",borderRadius:2,fontWeight:700,letterSpacing:.8,textTransform:"uppercase"},children:v.tipoProyecto==="DISEO"?v.subtipoDiseno||"Diseo":v.tipoProyecto})}),e.jsx("td",{style:{padding:"11px 14px",fontSize:12,color:C.inkMid},children:Ye(f.COSTO)}),e.jsx("td",{style:{padding:"11px 14px",fontSize:13,fontWeight:700,color:C.ink},children:Ye(f.PVP_IVA)}),e.jsx("td",{style:{padding:"11px 14px",fontSize:12,color:f.PVP>0?C.success:C.inkLight},children:f.PVP>0?it(v.margen):""}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsx(Ns,{e:v.estado})}),e.jsx("td",{style:{padding:"11px 14px",fontSize:10,color:C.inkLight,whiteSpace:"nowrap"},children:v.updatedAt?new Date(v.updatedAt).toLocaleDateString("es-CO"):""}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsxs("div",{style:{display:"flex",gap:3},children:[e.jsx(ut,{sm:!0,v:"ghost",icon:Vo,on:()=>{o(v.id),i("offer-edit")}}),e.jsx(ut,{sm:!0,v:"ghost",icon:fa,on:()=>a(v.id)}),e.jsx(ut,{sm:!0,v:"danger",icon:He,on:()=>n(v.id)})]})})]},v.id)})})]})})]})}const ra=[{id:"DIS",label:"Diseo",color:"#5B3A8C",icon:"",modo:"diseno"},{id:"REF",label:"Reforma / construccin",color:"#8C6A00",icon:"",modo:"ejecucion"},{id:"INS",label:"Instalaciones",color:"#3B3B3B",icon:"",modo:"ejecucion"},{id:"MOB",label:"Carpintera y mobiliario",color:"#6B4226",icon:"",modo:"ejecucion"},{id:"DIR",label:"Direccin / supervisin",color:"#0D5E6E",icon:"",modo:"diseno"},{id:"SER",label:"Servicios tcnicos",color:"#555555",icon:"",modo:"diseno"}],On=[{id:"CAP00",label:"00  Preliminares e instalaciones provisionales",color:"#555555"},{id:"CAP01",label:"01  Demoliciones y desmonte",color:"#8C6A00"},{id:"CAP02",label:"02  Movimiento de tierras",color:"#6B4226"},{id:"CAP03",label:"03  Cimentaciones",color:"#5B3A8C"},{id:"CAP04",label:"04  Estructura",color:"#3B3B3B"},{id:"CAP05",label:"05  Mampostera y cerramientos",color:"#0D5E6E"},{id:"CAP06",label:"06  Cubierta e impermeabilizacin",color:"#8C6A00"},{id:"CAP07",label:"07  Instalaciones elctricas",color:"#111111"},{id:"CAP08",label:"08  Instalaciones hidrosanitarias",color:"#3B3B3B"},{id:"CAP09",label:"09  Instalaciones de gas",color:"#B91C1C"},{id:"CAP10",label:"10  Acabados generales",color:"#555555"},{id:"CAP11",label:"11  Pisos y enchapes",color:"#6B4226"},{id:"CAP12",label:"12  Pintura",color:"#5B3A8C"},{id:"CAP13",label:"13  Carpintera metlica y vidriera",color:"#0D5E6E"},{id:"CAP14",label:"14  Carpintera de madera y mobiliario",color:"#6B4226"},{id:"CAP15",label:"15  Obras exteriores y urbanismo",color:"#111111"},{id:"CAP16",label:"16  Equipamiento especial",color:"#555555"},{id:"CAP17",label:"17  Diseo y direccin tcnica",color:"#5B3A8C"},{id:"CAP18",label:"18  Admin, imprevistos y utilidad (AIU)",color:"#3B3B3B"}],ql=[{id:"lev",nombre:"Levantamiento arquitectnico",horas:4,tipo:"plano"},{id:"propArq",nombre:"Propuesta arquitectnica",horas:8,tipo:"plano"},{id:"propInt",nombre:"Propuesta de interiores",horas:6,tipo:"plano"},{id:"cortes",nombre:"Cortes y fachadas",horas:3,tipo:"plano"},{id:"det",nombre:"Detalles constructivos",horas:4,tipo:"plano"},{id:"inst_e",nombre:"Plano instalaciones elctricas",horas:3,tipo:"plano"},{id:"inst_h",nombre:"Plano instalaciones hidrosanitarias",horas:3,tipo:"plano"},{id:"render",nombre:"Renders 3D exteriores (x3)",horas:12,tipo:"render"},{id:"render_i",nombre:"Renders 3D interiores (x5)",horas:10,tipo:"render"},{id:"recorrido",nombre:"Recorrido virtual 360",horas:16,tipo:"render"},{id:"memoria",nombre:"Memoria descriptiva",horas:4,tipo:"doc"},{id:"cuadro",nombre:"Cuadro de reas",horas:2,tipo:"doc"},{id:"presup",nombre:"Presupuesto de obra (tem por tem)",horas:8,tipo:"doc"},{id:"licencia",nombre:"Gestin licencia construccin",horas:20,tipo:"tramite"},{id:"topog",nombre:"Levantamiento topogrfico",horas:0,tipo:"subcontrata"},{id:"estruc",nombre:"Clculo estructural",horas:0,tipo:"subcontrata"},{id:"suelos",nombre:"Estudio de suelos",horas:0,tipo:"subcontrata"}],no=[{codigo:"EPP-001",nombre:"Casco de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:24,precioRef:35e3},{codigo:"EPP-002",nombre:"Botas de seguridad",familia:"epp",unidad:"par",vidaUtilMeses:12,precioRef:12e4},{codigo:"EPP-003",nombre:"Guantes de carnaza",familia:"epp",unidad:"par",vidaUtilMeses:3,precioRef:12e3},{codigo:"EPP-004",nombre:"Gafas de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:12,precioRef:18e3},{codigo:"EPP-005",nombre:"Chaleco reflectivo",familia:"epp",unidad:"ud",vidaUtilMeses:12,precioRef:25e3},{codigo:"EPP-006",nombre:"Proteccin auditiva",familia:"epp",unidad:"ud",vidaUtilMeses:6,precioRef:8e3},{codigo:"EPP-007",nombre:"Mascarilla con filtro",familia:"epp",unidad:"ud",vidaUtilMeses:1,precioRef:15e3},{codigo:"EPP-008",nombre:"Arns de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:36,precioRef:18e4},{codigo:"EPP-009",nombre:"Guantes de nitrilo",familia:"epp",unidad:"caja",vidaUtilMeses:1,precioRef:28e3},{codigo:"EPP-010",nombre:"Careta de soldar",familia:"epp",unidad:"ud",vidaUtilMeses:24,precioRef:85e3},{codigo:"DOT-001",nombre:"Overol de trabajo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:65e3},{codigo:"DOT-002",nombre:"Camiseta con logo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:3e4},{codigo:"DOT-003",nombre:"Pantaln de trabajo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:45e3},{codigo:"HM-001",nombre:"Martillo de ua",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:35e3},{codigo:"HM-002",nombre:"Juego destornilladores",familia:"herr_menor",unidad:"jgo",vidaUtilMeses:24,precioRef:45e3},{codigo:"HM-003",nombre:"Flexmetro 5m",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:22e3},{codigo:"HM-004",nombre:"Nivel de burbuja 60cm",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:38e3},{codigo:"HM-005",nombre:"Llana dentada",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:18e3},{codigo:"HM-006",nombre:"Llana lisa",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:15e3},{codigo:"HM-007",nombre:"Maceta 2lb",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:25e3},{codigo:"HM-008",nombre:"Cincel plano",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:12e3},{codigo:"HM-009",nombre:"Pala redonda",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:3e4},{codigo:"HM-010",nombre:"Pica",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:28e3},{codigo:"HM-011",nombre:"Carretilla",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:95e3},{codigo:"HM-012",nombre:"Pinza pelacables",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:25e3},{codigo:"HM-013",nombre:"Alicate universal",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:28e3},{codigo:"HM-014",nombre:'Llave ajustable 10"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:36,precioRef:32e3},{codigo:"HM-015",nombre:'Esptula 3"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:6,precioRef:8e3},{codigo:"HM-016",nombre:"Rodillo de pintura",familia:"herr_menor",unidad:"ud",vidaUtilMeses:3,precioRef:12e3},{codigo:"HM-017",nombre:'Brocha 4"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:3,precioRef:8e3},{codigo:"HY-001",nombre:"Taladro percutor",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:28e4},{codigo:"HY-002",nombre:'Pulidora 7"',familia:"herr_mayor",unidad:"ud",vidaUtilMeses:36,precioRef:35e4},{codigo:"HY-003",nombre:"Sierra circular",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:42e4},{codigo:"HY-004",nombre:"Rotomartillo SDS",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:65e4},{codigo:"HY-005",nombre:"Cortadora de baldosa",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:36,precioRef:38e4},{codigo:"HY-006",nombre:"Compresor de aire",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:60,precioRef:85e4},{codigo:"HY-007",nombre:"Equipo de soldadura",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:60,precioRef:95e4},{codigo:"EO-001",nombre:"Andamio certificado",familia:"equipo_obra",unidad:"cuerpo",vidaUtilMeses:60,precioRef:18e4},{codigo:"EO-002",nombre:"Escalera tijera 2m",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:18e4},{codigo:"EO-003",nombre:"Escalera extensin 4m",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:35e4},{codigo:"EO-004",nombre:"Mezcladora de concreto",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:60,precioRef:25e5},{codigo:"EO-005",nombre:"Vibrador de concreto",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:12e5},{codigo:"EO-006",nombre:"Pluma gra manual",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:60,precioRef:35e5},{codigo:"EM-001",nombre:"Flexmetro lser",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:25e4},{codigo:"EM-002",nombre:"Nivel lser",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:48e4},{codigo:"EM-003",nombre:"Multmetro digital",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:12e4},{codigo:"CO-001",nombre:"Cinta aislante",familia:"consumible",unidad:"rollo",vidaUtilMeses:1,precioRef:5e3},{codigo:"CO-002",nombre:"Silicona transparente",familia:"consumible",unidad:"tubo",vidaUtilMeses:1,precioRef:12e3},{codigo:"CO-003",nombre:'Disco de corte 7"',familia:"consumible",unidad:"ud",vidaUtilMeses:1,precioRef:8e3},{codigo:"CO-004",nombre:"Broca para concreto set",familia:"consumible",unidad:"jgo",vidaUtilMeses:3,precioRef:35e3},{codigo:"CO-005",nombre:"Lija #80 pliego",familia:"consumible",unidad:"pliego",vidaUtilMeses:1,precioRef:3e3},{codigo:"SC-001",nombre:"Cinta de demarcacin",familia:"seguridad",unidad:"rollo",vidaUtilMeses:1,precioRef:15e3},{codigo:"SC-002",nombre:"Malla de cerramiento",familia:"seguridad",unidad:"rollo",vidaUtilMeses:6,precioRef:45e3},{codigo:"SC-003",nombre:"Sealizacin obra",familia:"seguridad",unidad:"jgo",vidaUtilMeses:12,precioRef:85e3},{codigo:"SC-004",nombre:"Extintor multipropsito",familia:"seguridad",unidad:"ud",vidaUtilMeses:12,precioRef:65e3},{codigo:"SC-005",nombre:"Botiqun tipo A",familia:"seguridad",unidad:"ud",vidaUtilMeses:12,precioRef:12e4}],fn={peon:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],ayudante:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","DOT-001"],oficial2:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],oficial1:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],encargado:["EPP-001","EPP-002","EPP-004","EPP-005","DOT-002","DOT-003"],residente:["EPP-001","EPP-002","EPP-005","DOT-002"],jefe_obra:["EPP-001","EPP-002","EPP-005","DOT-002"],arq:["EPP-001","EPP-005"],ing:["EPP-001","EPP-002","EPP-005","DOT-002"]},Us={eq_elec_basico:["HY-001","HM-002","HM-012","HM-013","EM-003","CO-001","EO-002"],eq_obra_civil:["HM-009","HM-010","HM-011","HM-004","HM-003","HM-007","HM-008","HM-005","EO-003","EO-001"],eq_diseno_int:["EM-001","EM-002","HM-003"]},Xn={epp:"EPP",dotacion:"Dotacin",herr_menor:"Herram. menor",herr_mayor:"Herram. mayor",equipo_obra:"Equipo obra",equipo_medic:"Medicin",consumible:"Consumible",seguridad:"Seguridad"},Ca={epp:"",dotacion:"",herr_menor:"",herr_mayor:"",equipo_obra:"",equipo_medic:"",consumible:"",seguridad:""},No=t=>no.find(i=>i.codigo===t),Fo={CO:{categorias:[{id:"peon",label:"Pen de obra",salario:1423500,factor:1.618,horasMes:192},{id:"oficial2",label:"Oficial 2",salario:175e4,factor:1.618,horasMes:192},{id:"oficial1",label:"Oficial 1",salario:21e5,factor:1.618,horasMes:192},{id:"encargado",label:"Encargado de obra",salario:28e5,factor:1.618,horasMes:192},{id:"residente",label:"Residente / Inspector",salario:42e5,factor:1.618,horasMes:192},{id:"arq",label:"Arquitecto",salario:35e5,factor:1.618,horasMes:192},{id:"ing",label:"Ingeniero",salario:45e5,factor:1.618,horasMes:192}]},ES:{categorias:[{id:"peon",label:"Pen ordinario",salarioAnual:20800,ss:.299,horasAnio:1736},{id:"ayudante",label:"Ayudante",salarioAnual:22400,ss:.299,horasAnio:1736},{id:"oficial2",label:"Oficial 2",salarioAnual:24600,ss:.299,horasAnio:1736},{id:"oficial1",label:"Oficial 1",salarioAnual:27200,ss:.299,horasAnio:1736},{id:"encargado",label:"Encargado",salarioAnual:32e3,ss:.299,horasAnio:1736},{id:"jefe_obra",label:"Jefe de obra",salarioAnual:45e3,ss:.299,horasAnio:1736},{id:"arq",label:"Arquitecto/Aparejador",salarioAnual:4e4,ss:.299,horasAnio:1736}]}},Ih=t=>t.salario*t.factor/t.horasMes,Rh=t=>t.salarioAnual*(1+t.ss)/t.horasAnio,lo=(t,i)=>{var a;const n=(((a=Fo[i])==null?void 0:a.categorias)||[]).find(r=>r.id===t);return n?i==="CO"?Ih(n):Rh(n):0},_h=(t,i)=>{const o=i.pais||"CO",n=o==="CO"?"COP":"EUR",a=t.apu||{},r=t.tipo;if(r==="diseno_arq"||r==="diseno_int"){const p=a.estudios||[],d=a.mo||[],c=a.subcontratas||[],l=p.reduce((E,w)=>E+(w.horas||0),0),x=i.apuModoHora==="MANUAL"?i.apuCostoHoraManual||0:(()=>{const E=(i.apuHDia||8)*(i.apuDiasSem||5)*(i.apuSemanas||52)*(i.apuPctProductivas||.6),w=(i.apuSalarioAnual||0)*(1+(i.apuPrestaciones||.65))+(i.apuLicencias||0)+(i.apuEquipos||0)+(i.apuAccesorios||0);return E>0?w/E:0})(),y=l*x,u=d.reduce((E,w)=>E+(w.horas||0)*lo(w.catId,o),0),S=c.reduce((E,w)=>E+(w.importe||0),0);return{CD:y+u+S,cdDis:y,cdMO:u,cdSub:S,horasTotal:l,costoH:x,moneda:n}}a.cuadrillas;const s=a.materiales||[],g=a.equipos||[],h=a.subcontratas||[],j=(a.equiposUsados||[]).reduce((p,d)=>{var y;let c=null;try{c=(JSON.parse(((y=Ee.get("hab:crm:equipos"))==null?void 0:y.value)||"null")||ka).find(S=>S.id===d.eqId)}catch{}if(!c)return p;const x=(d.rendimientoOverride??c.rendimiento)*(t.cantidad||1);return p+c.cargos.reduce((u,S)=>{const A=lo(S.catId,o);return u+A*x*(S.cantidad||1)},0)+(c.equiposCosto||0)+(c.licenciasCosto||0)},0),k=s.reduce((p,d)=>p+(d.cantidad||0)*(d.precio||0),0),v=g.reduce((p,d)=>p+(d.cantidad||0)*(d.precio||0),0),m=h.reduce((p,d)=>p+(d.importe||0),0);return{CD:j+k+v+m,cdMO:j,cdMat:k,cdEq:v,cdSub:m,moneda:n}},ka=[{id:"eq_elec_basico",nombre:"Equipo elctrico bsico",cargos:[{id:"c1",catId:"oficial1",cantidad:1},{id:"c2",catId:"ayudante",cantidad:1}],equiposCosto:15e3,licenciasCosto:0,rendimiento:.05},{id:"eq_obra_civil",nombre:"Equipo obra civil",cargos:[{id:"c3",catId:"oficial1",cantidad:1},{id:"c4",catId:"peon",cantidad:2}],equiposCosto:25e3,licenciasCosto:0,rendimiento:.08},{id:"eq_diseno_int",nombre:"Equipo diseo",cargos:[{id:"c5",catId:"arq",cantidad:1}],equiposCosto:0,licenciasCosto:8e3,rendimiento:1}];function sc(){const[t,i]=F.useState(()=>{try{const n=Ee.get("hab:crm:equipos"),a=n?JSON.parse(n.value):null;return a!=null&&a.length?a:ka}catch{return ka}});return[t,n=>{i(n);try{Ee.set("hab:crm:equipos",JSON.stringify(n))}catch{}}]}function Mh({pais:t,onClose:i}){var p;const[o,n]=sc(),[a,r]=F.useState(null),[s,g]=F.useState(null),h=((p=Fo[t])==null?void 0:p.categorias)||[],b=()=>Math.random().toString(36).slice(2,9),j=d=>d!=null&&!isNaN(d)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(d):"0",k=t==="CO"?"COP":"EUR",v=()=>{var d;return{id:b(),nombre:"",rendimiento:.1,cargos:[{id:b(),catId:((d=h[0])==null?void 0:d.id)||"",cantidad:1}],equiposCosto:0,licenciasCosto:0}},m=d=>d.cargos.reduce((c,l)=>{const x=lo(l.catId,t);return c+x*d.rendimiento*(l.cantidad||1)},0)+(d.equiposCosto||0)+(d.licenciasCosto||0),f=(d={})=>({border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 7px",fontSize:12,fontFamily:"'DM Sans',sans-serif",...d});return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:1100,display:"flex",alignItems:"flex-start",justifyContent:"center",overflowY:"auto",padding:"20px 16px"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,width:"100%",maxWidth:680,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Biblioteca global"}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:"#111"},children:"Equipos de trabajo"})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>{g(v()),r(null)},style:{padding:"6px 12px",background:"#111111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Oe,{size:12})," Nuevo equipo"]}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:20})})]})]}),e.jsxs("div",{style:{padding:"14px 18px"},children:[s&&e.jsxs("div",{style:{border:"1px solid #111111",borderRadius:8,padding:14,marginBottom:16,background:"#F0FAF5"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#111111",marginBottom:10},children:a?"Editando equipo":"Nuevo equipo"}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[e.jsxs("div",{style:{flex:2},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Nombre del equipo"}),e.jsx("input",{value:s.nombre,onChange:d=>g(c=>({...c,nombre:d.target.value})),placeholder:"Ej: Equipo elctrico bsico",style:{...f(),width:"100%",fontSize:13}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Rendimiento (h/ud)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:s.rendimiento,onChange:d=>g(c=>({...c,rendimiento:parseFloat(d.target.value)||0})),style:{...f(),width:"100%",textAlign:"center"}})]})]}),e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:5},children:"Cargos"}),s.cargos.map((d,c)=>e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6,alignItems:"center"},children:[e.jsx("select",{value:d.catId,onChange:l=>g(x=>({...x,cargos:x.cargos.map((y,u)=>u===c?{...y,catId:l.target.value}:y)})),style:{...f(),flex:2},children:h.map(l=>e.jsx("option",{value:l.id,children:l.label},l.id))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flex:1},children:[e.jsx("span",{style:{fontSize:11,color:"#888"},children:""}),e.jsx("input",{type:"number",min:"1",value:d.cantidad,onChange:l=>g(x=>({...x,cargos:x.cargos.map((y,u)=>u===c?{...y,cantidad:parseInt(l.target.value)||1}:y)})),style:{...f(),width:50,textAlign:"center"}})]}),e.jsxs("span",{style:{fontSize:11,color:"#888",fontFamily:"'DM Mono',monospace",flex:1},children:[j(lo(d.catId,t))," ",k,"/h"]}),e.jsx("button",{onClick:()=>g(l=>({...l,cargos:l.cargos.filter((x,y)=>y!==c)})),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:12})})]},d.id)),e.jsxs("button",{onClick:()=>g(d=>{var c;return{...d,cargos:[...d.cargos,{id:b(),catId:((c=h[0])==null?void 0:c.id)||"",cantidad:1}]}}),style:{fontSize:11,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:3,marginBottom:10},children:[e.jsx(Oe,{size:11})," Aadir cargo"]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Equipos/herramientas"}),e.jsx("input",{type:"number",min:"0",value:s.equiposCosto,onChange:d=>g(c=>({...c,equiposCosto:parseFloat(d.target.value)||0})),style:{...f(),width:"100%"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Licencias/medios"}),e.jsx("input",{type:"number",min:"0",value:s.licenciasCosto,onChange:d=>g(c=>({...c,licenciasCosto:parseFloat(d.target.value)||0})),style:{...f(),width:"100%"}})]})]}),e.jsxs("div",{style:{fontSize:12,color:"#111111",fontWeight:600,marginBottom:10},children:["Costo/ud estimado: ",j(m(s))," ",k]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>{if(!s.nombre){alert("Pon un nombre al equipo");return}n(a?o.map(d=>d.id===a?{...s,id:a}:d):[...o,s]),g(null),r(null)},style:{padding:"6px 14px",background:"#111111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(xt,{size:12})," Guardar"]}),e.jsx("button",{onClick:()=>{g(null),r(null)},style:{padding:"6px 14px",border:"1px solid #E0E0E0",background:"#fff",borderRadius:6,cursor:"pointer",fontSize:12},children:"Cancelar"})]})]}),o.map((d,c)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:"1px solid #E0E0E0"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,color:"#111"},children:d.nombre}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2},children:[d.cargos.map(l=>{var y,u;const x=(u=(y=Fo[t])==null?void 0:y.categorias)==null?void 0:u.find(S=>S.id===l.catId);return`${l.cantidad} ${(x==null?void 0:x.label)||l.catId}`}).join("  "),d.equiposCosto>0?`  +${j(d.equiposCosto)} eq.`:"",d.licenciasCosto>0?`  +${j(d.licenciasCosto)} lic.`:""]})]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:600,color:"#111111",minWidth:100,textAlign:"right"},children:[j(m(d)),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:10,fontWeight:400,color:"#888"},children:[k,"/ud  rend ",d.rendimiento,"h"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>{g({...d}),r(d.id)},style:{background:"none",border:"1px solid #E0E0E0",borderRadius:4,cursor:"pointer",padding:"4px 8px",fontSize:11,color:"#555"},children:"Editar"}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar este equipo?")&&n(o.filter(l=>l.id!==d.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:13})})]})]},d.id)),o.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"24px",color:"#888",fontSize:13},children:"Sin equipos. Crea el primero."})]})]})})}function Dh({pais:t,linea:i,apu:o,setApu:n}){const[a,r]=sc(),[s,g]=F.useState(!1),h=t==="CO"?"COP":"EUR",b=d=>d!=null?new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(d):"0",j=o.equiposUsados||[],k=d=>{j.find(l=>l.eqId===d)||!a.find(l=>l.id===d)||n(l=>({...l,equiposUsados:[...l.equiposUsados||[],{id:Math.random().toString(36).slice(2,8),eqId:d,rendimientoOverride:null}]}))},v=d=>n(c=>({...c,equiposUsados:(c.equiposUsados||[]).filter(l=>l.id!==d)})),m=(d,c,l)=>n(x=>({...x,equiposUsados:(x.equiposUsados||[]).map(y=>y.id===d?{...y,[c]:l}:y)})),f=(d,c)=>{const l=c??d.rendimiento;return d.cargos.reduce((x,y)=>{const u=lo(y.catId,t);return x+u*l*(y.cantidad||1)},0)+(d.equiposCosto||0)+(d.licenciasCosto||0)},p=j.reduce((d,c)=>{const l=a.find(y=>y.id===c.eqId);if(!l)return d;const x=c.rendimientoOverride??l.rendimiento;return d+f(l,x)*(i.cantidad||1)},0);return e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8,paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Equipos de trabajo (MO)"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("select",{defaultValue:"",onChange:d=>{d.target.value&&(k(d.target.value),d.target.value="")},style:{border:"1px solid #3B3B3B",borderRadius:5,padding:"3px 8px",fontSize:12,color:"#3B3B3B",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:"#F0F0F0"},children:[e.jsx("option",{value:"",children:"+ Aadir equipo de biblioteca"}),a.map(d=>e.jsxs("option",{value:d.id,children:[d.nombre,"  ",b(f(d,null)),h,"/ud"]},d.id))]}),e.jsx("button",{onClick:()=>g(!0),style:{border:"1px solid #E0E0E0",borderRadius:5,padding:"3px 8px",fontSize:11,cursor:"pointer",background:"#fff",color:"#555",fontFamily:"'DM Sans',sans-serif"},children:"Gestionar biblioteca"})]})]}),j.length===0&&e.jsx("div",{style:{color:"#BBB",fontSize:12,padding:"8px 0",textAlign:"center"},children:"Selecciona equipos de la biblioteca para calcular MO"}),j.map(d=>{var S;const c=a.find(A=>A.id===d.eqId);if(!c)return null;const l=d.rendimientoOverride??c.rendimiento,x=f(c,l),y=x*(i.cantidad||1),u=((S=Fo[t])==null?void 0:S.categorias)||[];return e.jsxs("div",{style:{border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,overflow:"hidden"},children:[e.jsxs("div",{style:{background:"#F5F4F1",padding:"7px 12px",display:"flex",alignItems:"center",gap:10,borderBottom:"1px solid #E0E0E0"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,color:"#111",flex:1},children:c.nombre}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#555"},children:[e.jsx("span",{children:"Rendimiento:"}),e.jsx("input",{type:"number",min:"0",step:"0.001",value:l,onChange:A=>m(d.id,"rendimientoOverride",parseFloat(A.target.value)||0),style:{width:65,border:"1px solid #E0E0E0",borderRadius:4,padding:"3px 5px",fontSize:12,textAlign:"center",fontFamily:"'DM Sans',sans-serif"}}),e.jsxs("span",{children:["h/",i.unidad||"ud"]}),e.jsxs("span",{style:{fontSize:10,color:"#BBB",marginLeft:2},children:["(bib: ",c.rendimiento,"h)"]})]}),e.jsx("button",{onClick:()=>v(d.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:13})})]}),e.jsxs("div",{style:{padding:"8px 12px",fontSize:12,color:"#555"},children:[c.cargos.map((A,E)=>{const w=u.find(z=>z.id===A.catId),_=lo(A.catId,t);return e.jsxs("span",{style:{marginRight:12},children:[A.cantidad," ",(w==null?void 0:w.label)||A.catId," (",b(_),h,"/h)"]},E)}),c.equiposCosto>0&&e.jsxs("span",{style:{marginRight:12},children:["+",b(c.equiposCosto)," eq."]}),c.licenciasCosto>0&&e.jsxs("span",{children:["+",b(c.licenciasCosto)," lic."]}),e.jsxs("span",{style:{float:"right",fontWeight:700,color:"#111111",fontFamily:"'DM Mono',monospace"},children:[b(x),"/ud  ",b(y)," total"]})]})]},d.id)}),j.length>0&&e.jsxs("div",{style:{textAlign:"right",fontSize:13,fontWeight:600,color:"#111111",fontFamily:"'DM Mono',monospace",marginBottom:8},children:["Total MO: ",b(p)," ",h]}),s&&e.jsx(Mh,{pais:t,onClose:()=>g(!1)})]})}function $h({linea:t,oferta:i,onSave:o,onClose:n}){var x;const a=i.pais||"CO",r=a==="CO"?"COP":"EUR",s=t.tipo,g=ra.find(y=>y.id===s),h=(g==null?void 0:g.modo)==="diseno",[b,j]=F.useState(t.apu||{estudios:[],mo:[],subcontratas:[],equiposUsados:[],materiales:[],equipos:[]}),k=_h({...t,apu:b},i);(x=Fo[a])!=null&&x.categorias;const v=(y,u,S,A)=>j(E=>({...E,[y]:E[y].map(w=>w.id===u?{...w,[S]:A}:w)})),m=(y,u)=>j(S=>({...S,[y]:S[y].filter(A=>A.id!==u)})),f=(y,u)=>j(S=>({...S,[y]:[...S[y]||[],{id:kt(),...u}]})),p=(y,u=0)=>y!=null&&!isNaN(y)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:u,maximumFractionDigits:u}).format(y):"0",d={padding:"5px 8px",fontSize:10,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",textAlign:"left"},c={padding:"5px 6px",borderBottom:"1px solid #E0E0E0",fontSize:13,verticalAlign:"middle"},l=(y={})=>({border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 6px",fontSize:12,fontFamily:"'DM Sans',sans-serif",...y});return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:999,display:"flex",alignItems:"flex-start",justifyContent:"center",overflowY:"auto",padding:"20px 16px"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,width:"100%",maxWidth:820,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:["APU  ",g==null?void 0:g.icon," ",g==null?void 0:g.label]}),e.jsxs("div",{style:{fontSize:15,fontWeight:700,color:"#111",marginTop:2},children:[t.descripcion||"Partida sin nombre","  ",t.cantidad," ",t.unidad]})]}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:20})})]}),e.jsxs("div",{style:{padding:"14px 18px"},children:[h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:8,paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Estudios / Entregables"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:8},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:d,children:"Entregable"}),e.jsx("th",{style:{...d,textAlign:"center",width:80},children:"Horas"}),e.jsx("th",{style:{...d,textAlign:"center",width:60},children:"Incl."}),e.jsx("th",{style:d})]})}),e.jsx("tbody",{children:(b.estudios||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:c,children:e.jsxs("select",{value:y.estudioId,onChange:u=>{const S=ql.find(A=>A.id===u.target.value);v("estudios",y.id,"estudioId",u.target.value),S&&v("estudios",y.id,"nombre",S.nombre),S&&y.tipo!=="subcontrata"&&v("estudios",y.id,"horas",S.horas),v("estudios",y.id,"tipo",(S==null?void 0:S.tipo)||"plano")},style:{...l(),width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),["plano","render","doc","tramite","subcontrata"].map(u=>e.jsx("optgroup",{label:u.toUpperCase(),children:ql.filter(S=>S.tipo===u).map(S=>e.jsx("option",{value:S.id,children:S.nombre},S.id))},u))]})}),e.jsx("td",{style:c,children:y.tipo==="subcontrata"?e.jsx("input",{type:"number",value:y.importe||0,onChange:u=>v("estudios",y.id,"importe",parseFloat(u.target.value)||0),placeholder:"importe",style:{...l(),width:90,textAlign:"right"}}):e.jsx("input",{type:"number",value:y.horas||0,onChange:u=>v("estudios",y.id,"horas",parseFloat(u.target.value)||0),style:{...l(),width:60,textAlign:"center"}})}),e.jsx("td",{style:{...c,textAlign:"center"},children:y.tipo==="subcontrata"?e.jsx("span",{style:{fontSize:11,color:"#888"},children:"sub"}):e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:12},children:p((y.horas||0)*k.costoH,0)})}),e.jsx("td",{style:c,children:e.jsx("button",{onClick:()=>m("estudios",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:12})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>f("estudios",{estudioId:"",nombre:"",horas:0,tipo:"plano",importe:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:12},children:[e.jsx(Oe,{size:12})," Aadir entregable"]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:6,padding:"8px 12px",fontSize:11,color:"#555",marginBottom:8,display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:600},children:"Costo/hora:"}),i.apuModoHora==="MANUAL"?e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:["Manual: ",p(i.apuCostoHoraManual||0,0)," ",r,"/h"]}):e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:[p(k.costoH||0,0)," ",r,"/h",e.jsxs("span",{style:{color:"#888",fontFamily:"'DM Sans',sans-serif"},children:["(salario ",(i.apuSalarioAnual||0).toLocaleString("es-CO")," +",((i.apuPrestaciones||0)*100).toFixed(0),"% SS ",p((i.apuHDia||8)*(i.apuDiasSem||5)*(i.apuSemanas||52)*(i.apuPctProductivas||.6),0),"h prod.)"]})]}),e.jsx("span",{style:{color:"#BBB",marginLeft:"auto",fontSize:10},children:"Configurable en tab APU Diseo (oferta)"})]}),e.jsxs("div",{style:{textAlign:"right",fontSize:13,fontWeight:600,color:"#111",marginBottom:12},children:["Total horas: ",e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[p(k.horasTotal||0,1)," h"]}),"Subtotal MO diseo: ",e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:[p(k.cdDis||0,0)," ",r]})]})]}),!h&&e.jsxs(e.Fragment,{children:[e.jsx(Dh,{pais:a,linea:t,apu:b,setApu:j}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Materiales"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...d,width:90},children:"Cdigo"}),e.jsx("th",{style:{...d,width:"35%"},children:"Descripcin"}),e.jsx("th",{style:d,children:"Unidad"}),e.jsx("th",{style:{...d,textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{...d,textAlign:"right",width:110},children:"Precio unit."}),e.jsx("th",{style:{...d,textAlign:"right",width:100},children:"Subtotal"}),e.jsx("th",{style:d})]})}),e.jsx("tbody",{children:(b.materiales||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:c,children:e.jsxs("select",{value:y.codigoCat||"",onChange:u=>{const S=u.target.value,A=no.find(E=>E.codigo===S);A?(v("materiales",y.id,"codigoCat",S),v("materiales",y.id,"descripcion",A.nombre),v("materiales",y.id,"unidad",A.unidad||"ud"),!y.precio&&A.precioRef&&v("materiales",y.id,"precio",A.precioRef)):v("materiales",y.id,"codigoCat","")},style:{...l(),width:"100%",fontSize:10,fontFamily:"'DM Mono',monospace",padding:"3px 4px"},children:[e.jsx("option",{value:"",children:""}),no.filter(u=>["consumible","seguridad"].includes(u.familia)).map(u=>e.jsx("option",{value:u.codigo,children:u.codigo},u.codigo))]})}),e.jsx("td",{style:c,children:e.jsx("input",{value:y.descripcion||"",onChange:u=>v("materiales",y.id,"descripcion",u.target.value),style:{...l(),width:"100%"},placeholder:"Material..."})}),e.jsx("td",{style:c,children:e.jsx("select",{value:y.unidad||"ud",onChange:u=>v("materiales",y.id,"unidad",u.target.value),style:l(),children:["m","m","ml","kg","ton","ud","gl","l","m","rollo","pliego","jgo","caja","tubo","par"].map(u=>e.jsx("option",{children:u},u))})}),e.jsx("td",{style:c,children:e.jsx("input",{type:"number",min:"0",step:"0.001",value:y.cantidad||0,onChange:u=>v("materiales",y.id,"cantidad",parseFloat(u.target.value)||0),style:{...l(),width:70,textAlign:"center"}})}),e.jsx("td",{style:c,children:e.jsx("input",{type:"number",min:"0",value:y.precio||0,onChange:u=>v("materiales",y.id,"precio",parseFloat(u.target.value)||0),style:{...l(),width:100,textAlign:"right"}})}),e.jsx("td",{style:{...c,textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:600},children:p((y.cantidad||0)*(y.precio||0),0)}),e.jsx("td",{style:c,children:e.jsx("button",{onClick:()=>m("materiales",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>f("materiales",{codigoCat:"",descripcion:"",unidad:"ud",cantidad:0,precio:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[e.jsx(Oe,{size:12})," Aadir material"]}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Equipos / herramientas directos"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...d,width:90},children:"Cdigo"}),e.jsx("th",{style:{...d,width:"35%"},children:"Descripcin"}),e.jsx("th",{style:d,children:"Unidad"}),e.jsx("th",{style:{...d,textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{...d,textAlign:"right",width:110},children:"Precio unit."}),e.jsx("th",{style:{...d,textAlign:"right",width:100},children:"Subtotal"}),e.jsx("th",{style:d})]})}),e.jsx("tbody",{children:(b.equipos||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:c,children:e.jsxs("select",{value:y.codigoCat||"",onChange:u=>{const S=u.target.value,A=no.find(E=>E.codigo===S);A?(v("equipos",y.id,"codigoCat",S),v("equipos",y.id,"descripcion",A.nombre),v("equipos",y.id,"unidad",A.unidad||"ud"),!y.precio&&A.precioRef&&v("equipos",y.id,"precio",A.precioRef)):v("equipos",y.id,"codigoCat","")},style:{...l(),width:"100%",fontSize:10,fontFamily:"'DM Mono',monospace",padding:"3px 4px"},children:[e.jsx("option",{value:"",children:""}),no.filter(u=>["herr_menor","herr_mayor","equipo_obra","equipo_medic"].includes(u.familia)).map(u=>e.jsxs("option",{value:u.codigo,children:[u.codigo," ",u.nombre]},u.codigo))]})}),e.jsx("td",{style:c,children:e.jsx("input",{value:y.descripcion||y.nombre||"",onChange:u=>v("equipos",y.id,"descripcion",u.target.value),style:{...l(),width:"100%"},placeholder:"Equipo..."})}),e.jsx("td",{style:c,children:e.jsx("select",{value:y.unidad||"ud",onChange:u=>v("equipos",y.id,"unidad",u.target.value),style:l(),children:["ud","h","da","mes","gl","cuerpo","jgo"].map(u=>e.jsx("option",{children:u},u))})}),e.jsx("td",{style:c,children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:y.cantidad||0,onChange:u=>v("equipos",y.id,"cantidad",parseFloat(u.target.value)||0),style:{...l(),width:70,textAlign:"center"}})}),e.jsx("td",{style:c,children:e.jsx("input",{type:"number",min:"0",value:y.precio||0,onChange:u=>v("equipos",y.id,"precio",parseFloat(u.target.value)||0),style:{...l(),width:100,textAlign:"right"}})}),e.jsx("td",{style:{...c,textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:600},children:p((y.cantidad||0)*(y.precio||0),0)}),e.jsx("td",{style:c,children:e.jsx("button",{onClick:()=>m("equipos",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>f("equipos",{codigoCat:"",descripcion:"",unidad:"ud",cantidad:0,precio:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[e.jsx(Oe,{size:12})," Aadir equipo/herramienta"]})]}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Subcontratas"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...d,width:"70%"},children:"Descripcin del trabajo subcontratado"}),e.jsx("th",{style:{...d,textAlign:"right"},children:"Importe"}),e.jsx("th",{style:d})]})}),e.jsx("tbody",{children:(b.subcontratas||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:c,children:e.jsx("input",{value:y.descripcion||"",onChange:u=>v("subcontratas",y.id,"descripcion",u.target.value),style:{...l(),width:"100%"}})}),e.jsx("td",{style:c,children:e.jsx("input",{type:"number",min:"0",value:y.importe||0,onChange:u=>v("subcontratas",y.id,"importe",parseFloat(u.target.value)||0),style:{...l(),width:120,textAlign:"right"}})}),e.jsx("td",{style:c,children:e.jsx("button",{onClick:()=>m("subcontratas",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>f("subcontratas",{descripcion:"",importe:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:12},children:[e.jsx(Oe,{size:12})," Aadir subcontrata"]}),e.jsxs("div",{style:{background:"#E8F4EE",border:"1px solid #B8DEC9",borderRadius:8,padding:"12px 14px",marginTop:8},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#111111",marginBottom:8,textTransform:"uppercase",letterSpacing:.5},children:"Resumen costos directos"}),h?[["Diseo/planos",k.cdDis],["MO directa",k.cdMO],["Subcontratas",k.cdSub]].map(([y,u])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,padding:"2px 0",borderBottom:"1px solid #B8DEC9"},children:[e.jsx("span",{style:{color:"#111111"},children:y}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:[p(u||0,0)," ",r]})]},y)):[["Mano de obra (cuadrillas)",k.cdMO],["Materiales",k.cdMat],["Equipos directos",k.cdEq],["Subcontratas",k.cdSub]].map(([y,u])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,padding:"2px 0",borderBottom:"1px solid #B8DEC9"},children:[e.jsx("span",{style:{color:"#111111"},children:y}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:[p(u||0,0)," ",r]})]},y)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:15,padding:"8px 0 0",fontWeight:700,color:"#111111"},children:[e.jsx("span",{children:"CD Total"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[p(k.CD||0,0)," ",r]})]})]})]}),e.jsxs("div",{style:{padding:"12px 18px",borderTop:"1px solid #E0E0E0",display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx("button",{onClick:n,style:{padding:"7px 16px",border:"1px solid #E0E0E0",borderRadius:6,background:"#fff",cursor:"pointer",fontSize:13},children:"Cancelar"}),e.jsxs("button",{onClick:()=>o({apu:b,precioCD:k.CD}),style:{padding:"7px 16px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:13,fontWeight:600,display:"flex",alignItems:"center",gap:5},children:[e.jsx(xt,{size:14})," Guardar APU"]})]})]})})}const qt=(t,i,o)=>{o.pais;const n=o.margen||.25,a=o.ggPct||0,r=(o.pctRCE||0)+(o.pctTRC||0)+(o.pctAdm||0)+(o.pctICA||0),s=o.ivaComision??.19;let g=0;o.medioPago==="PSE"?g=(o.pctComPSE??.012)*(1+s):o.medioPago==="Tarjeta"?g=(o.pctComTarjeta??.036)*(1+s):o.medioPago==="Transferencia"?g=(o.pctComTransf??0)*(1+s):o.medioPago==="Manual"&&(g=o.pctComManual??0);const h=o.aplicar4x1000==="SI"?.004:0,b=g+h,j=o.modoCalcObra||"margen",k=o.tipoProyecto==="OBRA"&&j==="aiu"?1-r:1-n-r-a,v=1-b,m=k*v;let f=t;if(o.tipoProyecto==="OBRA"&&j==="aiu"){const l=(o.aiuA||.08)+(o.aiuI||.03)+(o.aiuU||.07);f=t*(1+l)}const p=m>0?f/m:0,d=i||1,c=j==="aiu"?(o.aiuA||.08)*t:a*p;return{puCoste:d>0?t/d:0,totalCoste:t,puVenta:d>0?p/d:0,totalVenta:p,cd:t,gc:r*p,gg:c,gf:b*p,margenCOP:n*p,pvp:p,coefMult:m>0?(j==="aiu"?f/t:1)/m:0,den:m}};function Ph({d:t,set:i,r:o}){const n=t.pais||"CO",a=n==="CO"?"COP":"EUR",r=(D,O=0)=>D!=null&&!isNaN(D)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:O,maximumFractionDigits:O}).format(D):"0",[s,g]=F.useState(null),[h,b]=F.useState(null),[j,k]=F.useState(!1),[v,m]=F.useState("todos"),[f,p]=F.useState(!1),[d,c]=F.useState("detallado"),[l,x]=F.useState(null),y=t.borradorLineas||[],u=D=>i("borradorLineas",D),S=()=>u([...y,{id:kt(),esCapitulo:!0,nombre:"CAPTULO "+(y.filter(D=>D.esCapitulo).length+1),tipo:On[0].id}]),A=D=>u([...y,{id:kt(),esCapitulo:!1,tipo:D||On[0].id,codigo:"",descripcion:"",unidad:"m",cantidad:1,apu:null,precioCD:0}]),E=(D,O,le)=>u(y.map(re=>re.id===D?{...re,[O]:le}:re)),w=D=>u(y.filter(O=>O.id!==D)),_=(D,O)=>{const le=[...y],re=le.findIndex(de=>de.id===D);re+O<0||re+O>=le.length||([le[re],le[re+O]]=[le[re+O],le[re]],u(le))},z=D=>x(D),T=D=>D.preventDefault(),L=D=>{if(!l||l===D){x(null);return}const O=[...y],le=O.findIndex(G=>G.id===l),re=O.findIndex(G=>G.id===D);if(le<0||re<0){x(null);return}const[de]=O.splice(le,1);O.splice(re,0,de),u(O),x(null)},Z=(D,O)=>{u(y.map(le=>le.id===D?{...le,...O}:le)),g(null)},K=()=>{const D=y.filter(O=>!O.esCapitulo&&O.descripcion).map(O=>({id:O.id,otId:t.id,otNombre:t.proyecto||t.cliente,codigo:O.codigo,nombre:O.descripcion,unidad:O.unidad,cantidad:O.cantidad,presupuesto:O.precioCD||0,avance:0,estado:"pendiente"}));try{Ee.set("hab:proj:actividades:"+t.id,JSON.stringify(D)),alert(` ${D.length} actividades exportadas al mdulo Proyectos.`)}catch(O){alert("Error: "+O.message)}},P=y.filter(D=>!D.esCapitulo).reduce((D,O)=>D+(O.precioCD||0),0),te=t.pctU||.07,he=.08,Q=.03,Se=n==="CO"?P*(he+Q+te):0,ae=n==="ES"?P*(t.gg||.13):0,U=n==="ES"?P*(t.bi||.06):0,M=n==="CO"?t.tarifaIVA||.19:t.tarifaIVA||.1,B=y.find(D=>D.id===s),H=["m","m","ml","m","kg","ton","ud","gl","h","da","sem","mes","l","mxl","vje"],ee=()=>{for(let D=y.length-1;D>=0;D--)if(y[D].esCapitulo)return y[D].tipo;return On[0].id};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("button",{onClick:S,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"1px solid #E0E0E0",borderRadius:6,background:"#F5F4F1",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:500},children:[e.jsx(zn,{size:13})," Aadir captulo"]}),e.jsxs("button",{onClick:()=>A(ee()),style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:600},children:[e.jsx(Oe,{size:13})," Nueva partida"]}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{display:"flex",border:"1px solid #E0E0E0",borderRadius:6,overflow:"hidden"},children:[["coste","Vista interna",!1],["venta","Vista cliente",!0]].map(([D,O,le])=>e.jsx("button",{onClick:()=>p(le),style:{padding:"6px 14px",border:"none",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:f===le?"#111":"#fff",color:f===le?"#fff":"#555",transition:"all .15s"},children:O},D))}),f&&e.jsx("div",{style:{display:"flex",border:"1px solid #E0E0E0",borderRadius:6,overflow:"hidden",marginLeft:8},children:[["detallado","Detallado"],["capitulos","Captulos"],["total","Total"]].map(([D,O])=>e.jsx("button",{onClick:()=>c(D),style:{padding:"6px 10px",border:"none",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:d===D?"#3B3B3B":"#fff",color:d===D?"#fff":"#888",transition:"all .15s"},children:O},D))}),e.jsxs("button",{onClick:()=>k(!0),style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",marginLeft:8,border:"none",borderRadius:6,background:"#3B3B3B",color:"#fff",cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif",fontWeight:700},children:[e.jsx(vn,{size:13})," APUs de Venta"]}),t.estado==="Ganada"&&e.jsxs("button",{onClick:K,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"none",borderRadius:6,background:"#3B3B3B",color:"#fff",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:600},children:[e.jsx(Oc,{size:13})," Exportar al Gantt"]})]}),(()=>{const D=y.filter(G=>!G.esCapitulo&&G.precioCD).reduce((G,ce)=>G+qt(ce.precioCD||0,ce.cantidad||1,t).totalVenta,0),O=D*M,le=D+O,re=D-P,de=D>0?(re/D*100).toFixed(1):0;return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(145px,1fr))",gap:8,marginBottom:14},children:[["Costos directos",r(P,0)+" "+a,"#555"],n==="CO"?["AIU "+((he+Q+te)*100).toFixed(0)+"%",r(Se,0)+" "+a,"#8C6A00"]:["GG+BI "+((t.gg||.13)*100+(t.bi||.06)*100).toFixed(0)+"%",r(ae+U,0)+" "+a,"#3B3B3B"],["Venta s/IVA",r(D,0)+" "+a,"#3B3B3B"],["IVA "+(M*100).toFixed(0)+"%",r(O,0)+" "+a,"#555"],["TOTAL c/IVA",r(le,0)+" "+a,"#111111"],["Margen",de+"%  "+r(re,0),"#2B7A52"]].map(([G,ce,V])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"8px 10px",borderLeft:"3px solid "+V},children:[e.jsx("div",{style:{fontSize:9,color:"#888",marginBottom:2},children:G}),e.jsx("div",{style:{fontSize:12,fontWeight:700,color:V,fontFamily:"'DM Mono',monospace"},children:ce})]},G))})})(),e.jsx("div",{style:{border:"1px solid #E0E0E0",borderRadius:8,overflow:"hidden",marginBottom:14,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:f?700:1100},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:[{l:"Cd",w:52},{l:"Descripcin / Actividad",w:"20%"},{l:"Tipo",w:96},{l:"Unid",w:52},{l:"Cant.",w:68},...f?[]:[{l:"PU coste",w:86},{l:"CD Total ",w:100}],{l:"PU venta",w:96},{l:"Total venta",w:106},...f?[]:[{l:"% Inc.",w:52}],...f?[{l:"APU Vta",w:64}]:[{l:"APU",w:64}],{l:"",w:52}].filter(D=>D.w!==0).map(D=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"2px solid #E0E0E0",textAlign:"left",width:D.w,minWidth:typeof D.w=="number"?D.w:void 0},children:D.l},D.l))})}),e.jsxs("tbody",{children:[y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:f?8:12,style:{padding:"32px",textAlign:"center",color:"#999",fontSize:13},children:"Aade un captulo y partidas para construir el borrador."})}),f&&d==="total"&&y.length>0&&(()=>{const D=y.filter(O=>!O.esCapitulo&&O.precioCD).reduce((O,le)=>O+qt(le.precioCD||0,le.cantidad||1,t).totalVenta,0);return e.jsxs("tr",{style:{background:"#fff"},children:[e.jsxs("td",{colSpan:5,style:{padding:"12px 12px",fontSize:13,fontWeight:600},children:[t.proyecto||"Proyecto","  Precio total"]}),e.jsx("td",{style:{padding:"12px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"12px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700,color:"#111111"},children:r(D,0)}),e.jsx("td",{})]})})(),f&&d==="capitulos"&&y.length>0&&(()=>{const D=[];let O=null,le=[];y.forEach(G=>{G.esCapitulo?(O&&D.push({cap:O,items:le}),O=G,le=[]):le.push(G)}),O&&D.push({cap:O,items:le});const re=[];let de=!1;return y.forEach(G=>{G.esCapitulo&&(de=!0),!de&&!G.esCapitulo&&re.push(G)}),e.jsxs(e.Fragment,{children:[re.length>0&&e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("td",{colSpan:5,style:{padding:"10px 12px",fontSize:12,fontWeight:600,fontStyle:"italic"},children:"Partidas sin captulo"}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:"#111111"},children:r(re.reduce((G,ce)=>G+(ce.precioCD>0?qt(ce.precioCD,ce.cantidad||1,t).totalVenta:0),0),0)}),e.jsx("td",{})]}),D.map(({cap:G,items:ce},V)=>{const Y=ce.reduce((W,se)=>W+(se.precioCD>0?qt(se.precioCD,se.cantidad||1,t).totalVenta:0),0);return e.jsxs("tr",{style:{background:V%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${C.border}`},children:[e.jsxs("td",{colSpan:5,style:{padding:"10px 12px"},children:[e.jsx("span",{style:{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5},children:G.nombre||"Captulo"}),e.jsxs("span",{style:{marginLeft:8,fontSize:10,color:C.inkLight},children:[ce.length," partida",ce.length!==1?"s":""]})]}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:700,color:"#111111"},children:r(Y,0)}),e.jsx("td",{})]},G.id)})]})})(),(!f||d==="detallado")&&y.map((D,O)=>{var de,G,ce,V;if(D.esCapitulo){const Y=On.find(W=>W.id===(D.tipo||"CAP00"));return e.jsxs("tr",{draggable:!0,onDragStart:()=>z(D.id),onDragOver:T,onDrop:()=>L(D.id),style:{background:l===D.id?"#D5D2CC":"#EDEBE7",cursor:"grab",opacity:l===D.id?.5:1},children:[e.jsx("td",{colSpan:2,style:{padding:"8px 12px"},children:e.jsx("input",{value:D.nombre||"",onChange:W=>E(D.id,"nombre",W.target.value),style:{fontWeight:700,fontSize:13,color:"#111",background:"transparent",border:"none",outline:"none",width:"100%",textTransform:"uppercase",letterSpacing:.5}})}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("select",{value:D.tipo||"CAP00",onChange:W=>E(D.id,"tipo",W.target.value),style:{border:"1px solid #CCC",borderRadius:5,padding:"3px 7px",fontSize:11,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:(Y==null?void 0:Y.color)||"#8C6A00",width:"100%"},children:On.map(W=>e.jsx("option",{value:W.id,children:W.label},W.id))})}),e.jsx("td",{colSpan:f?4:7,style:{padding:"6px 8px",color:"#AAA",fontSize:10,fontStyle:"italic"},children:"Captulo agrupador"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right"},children:e.jsx("button",{onClick:()=>w(D.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:12})})})]},D.id)}const le=ra.find(Y=>Y.id===D.tipo),re=D.apu&&(((de=D.apu.estudios)==null?void 0:de.length)||0)+(((G=D.apu.equiposUsados)==null?void 0:G.length)||0)+(((ce=D.apu.materiales)==null?void 0:ce.length)||0)+(((V=D.apu.subcontratas)==null?void 0:V.length)||0)>0;return e.jsxs("tr",{draggable:!0,onDragStart:()=>z(D.id),onDragOver:T,onDrop:()=>L(D.id),style:{background:l===D.id?"#D5E8F9":O%2===0?"#fff":"#F9F8F5",transition:"background .1s",cursor:"grab",opacity:l===D.id?.5:1},onMouseEnter:Y=>{l||(Y.currentTarget.style.background="#F0F0F0")},onMouseLeave:Y=>{l||(Y.currentTarget.style.background=O%2===0?"#fff":"#F9F8F5")},children:[e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{value:D.codigo||"",onChange:Y=>E(D.id,"codigo",Y.target.value),style:{width:52,border:"1px solid #E0E0E0",borderRadius:4,padding:"3px 5px",fontSize:11,fontFamily:"'DM Mono',monospace",textAlign:"center"}})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{value:D.descripcion||"",onChange:Y=>E(D.id,"descripcion",Y.target.value),placeholder:"Descripcin de la actividad...",style:{width:"100%",border:"1px solid #E0E0E0",borderRadius:4,padding:"5px 8px",fontSize:13}})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("select",{value:D.tipo||ra[0].id,onChange:Y=>E(D.id,"tipo",Y.target.value),style:{border:"1px solid #E0E0E0",borderRadius:5,padding:"3px 6px",fontSize:11,background:"transparent",cursor:"pointer",color:(le==null?void 0:le.color)||"#555",fontFamily:"'DM Sans',sans-serif",maxWidth:110},children:ra.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.icon," ",Y.label]},Y.id))})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("select",{value:D.unidad||"m",onChange:Y=>E(D.id,"unidad",Y.target.value),style:{border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 4px",fontSize:12,width:56},children:H.map(Y=>e.jsx("option",{children:Y},Y))})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:D.cantidad||0,onChange:Y=>E(D.id,"cantidad",parseFloat(Y.target.value)||0),style:{width:72,border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 6px",fontSize:13,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),(()=>{const Y=re||D.precioCD>0?qt(D.precioCD||0,D.cantidad||1,t):null,W=y.filter(ue=>!ue.esCapitulo&&ue.precioCD).reduce((ue,ye)=>ue+qt(ye.precioCD||0,ye.cantidad||1,t).totalVenta,0),se=Y&&W>0?Y.totalVenta/W*100:0,ge={padding:"5px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,verticalAlign:"middle"};return e.jsxs(e.Fragment,{children:[!f&&e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...ge,color:re||D.precioCD>0?"#555":"#DDD"},children:(re||D.precioCD>0)&&Y?r(Y.puCoste,0):""}),e.jsx("td",{style:{...ge,fontWeight:re||D.precioCD>0?600:400,color:re||D.precioCD>0?"#111":"#DDD"},children:e.jsx("input",{type:"number",min:"0",step:"100",value:D.precioCD||"",placeholder:"0",onChange:ue=>E(D.id,"precioCD",parseFloat(ue.target.value)||0),style:{width:90,border:`1px solid ${D.precioCD>0?"#111111":"#E0E0E0"}`,borderRadius:4,padding:"3px 6px",fontSize:12,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,background:D.precioCD>0?"#E6F4EC":"#fff",color:D.precioCD>0?"#111":"#999"}})})]}),e.jsx("td",{style:{...ge,color:re||D.precioCD>0?"#3B3B3B":"#DDD",fontWeight:600},children:(re||D.precioCD>0)&&Y?r(Y.puVenta,0):""}),e.jsx("td",{style:{...ge,color:re||D.precioCD>0?"#111111":"#DDD",fontWeight:700},children:(re||D.precioCD>0)&&Y?r(Y.totalVenta,0):""}),!f&&e.jsx("td",{style:{...ge,fontSize:10,color:se>5?"#111111":"#999"},children:re||D.precioCD>0?se.toFixed(1)+"%":""})]})})(),!f&&e.jsx("td",{style:{padding:"5px 8px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:3,justifyContent:"center"},children:[e.jsxs("button",{onClick:()=>g(D.id),style:{background:re?"#111111":"transparent",color:re?"#fff":"#3B3B3B",border:`1px solid ${re?"#111111":"#3B3B3B"}`,borderRadius:5,padding:"3px 8px",fontSize:11,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:3},children:[e.jsx(Lc,{size:10}),re?"APU ":"+ APU"]}),(Number(D.precioCD)>0||re)&&e.jsxs("button",{onClick:()=>b(D.id),style:{background:"#3B3B3B",color:"#fff",border:"none",borderRadius:5,padding:"3px 7px",fontSize:10,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:2},children:[e.jsx(vn,{size:10})," Venta"]})]})}),e.jsx("td",{style:{padding:"5px 4px"},children:e.jsxs("div",{style:{display:"flex",gap:1},children:[f&&(Number(D.precioCD)>0||re)&&e.jsxs("button",{onClick:()=>b(D.id),style:{background:"#3B3B3B",color:"#fff",border:"none",borderRadius:4,padding:"3px 7px",fontSize:10,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:2},children:[e.jsx(vn,{size:10}),"APU Venta"]}),!f&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(D.id,-1),style:{background:"none",border:"none",cursor:"pointer",color:"#BBB",padding:2},children:e.jsx(Js,{size:11})}),e.jsx("button",{onClick:()=>_(D.id,1),style:{background:"none",border:"none",cursor:"pointer",color:"#BBB",padding:2},children:e.jsx(Fn,{size:11})}),e.jsx("button",{onClick:()=>w(D.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C",padding:2},children:e.jsx(He,{size:11})})]})]})})]},D.id)})]}),e.jsx("tfoot",{children:(()=>{const D=y.filter(ce=>!ce.esCapitulo&&ce.precioCD).reduce((ce,V)=>ce+qt(V.precioCD||0,V.cantidad||1,t).totalVenta,0),O=t.tipoProyecto==="OBRA",le=o.U||t.margen,re=O?le*D*(t.tarifaIVA||.19):D*(t.tarifaIVA||.19),de=D+re,G=f?8:12;return f?e.jsxs(e.Fragment,{children:[e.jsxs("tr",{style:{background:"#F5F4F1",borderTop:"2px solid #333"},children:[e.jsx("td",{colSpan:G-1,style:{padding:"10px 12px",fontSize:12,fontWeight:700},children:"Subtotal"}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700},children:[r(D,0)," ",a]})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:G-1,style:{padding:"6px 12px",fontSize:11,color:C.inkMid},children:O?`IVA ${((t.tarifaIVA||.19)*100).toFixed(0)}% sobre utilidad`:`IVA ${((t.tarifaIVA||.19)*100).toFixed(0)}%`}),e.jsxs("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12},children:[r(re,0)," ",a]})]}),e.jsxs("tr",{style:{background:"#111"},children:[e.jsx("td",{colSpan:G-1,style:{padding:"12px 12px",color:"#fff",fontSize:14,fontWeight:700},children:"TOTAL"}),e.jsxs("td",{style:{padding:"12px 8px",textAlign:"right",color:"#fff",fontFamily:"'DM Mono',monospace",fontSize:16,fontWeight:700},children:[r(de,0)," ",a]})]})]}):e.jsxs("tr",{style:{background:"#111"},children:[e.jsx("td",{colSpan:4,style:{padding:"10px 12px",color:"#fff",fontSize:13,fontWeight:600},children:"TOTALES"}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",color:"#ccc",fontFamily:"'DM Mono',monospace",fontSize:11},children:[y.filter(ce=>!ce.esCapitulo).length," partidas"]}),e.jsx("td",{style:{padding:"10px 8px"}}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",color:"#aaa",fontFamily:"'DM Mono',monospace",fontSize:12},children:r(P,0)}),e.jsx("td",{style:{padding:"10px 8px"}}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",color:"#fff",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700},children:[r(D,0)," ",a]}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",color:"#aaa",fontSize:10},children:"100%"}),e.jsx("td",{colSpan:2})]})})()})]})}),s&&B&&e.jsx($h,{linea:B,oferta:t,onSave:D=>Z(B.id,D),onClose:()=>g(null)}),j&&(()=>{var ue;const D=t.tipoProyecto==="OBRA",O=o.U||t.margen;y.filter(ye=>ye.esCapitulo);const le=y.filter(ye=>!ye.esCapitulo&&Number(ye.precioCD)>0),re={};let de=null;y.forEach(ye=>{if(ye.esCapitulo){de=ye;return}if(!ye.esCapitulo&&Number(ye.precioCD)>0){const be=de?de.id:"__sin_cap__",I=de?de.descripcion:"Sin captulo";re[be]||(re[be]={nombre:I,items:[]});const N=qt(Number(ye.precioCD),ye.cantidad||1,t),q=D?O*N.pvp*(t.tarifaIVA||.19):N.pvp*(t.tarifaIVA||.19);re[be].items.push({...ye,v:N,ivaL:q})}});const G=Object.keys(re),ce=v==="todos"?G:G.filter(ye=>ye===v),V=le.reduce((ye,be)=>ye+qt(be.precioCD||0,be.cantidad||1,t).pvp,0),Y=le.reduce((ye,be)=>ye+Number(be.precioCD||0),0),W=()=>{const ye=["Captulo","Cdigo","Descripcin","Und","Cant","PU Coste","CD Total","GC","GF","Margen","PVP s/IVA","PU Venta","IVA","PVP c/IVA","Coef.Mult"],be=[];ce.forEach(J=>{const R=re[J];R.items.forEach(ie=>{be.push([R.nombre,ie.codigo||"",ie.descripcion||"",ie.und||"",ie.cantidad||1,(ie.v.puCoste||0).toFixed(0),(ie.v.cd||0).toFixed(0),(ie.v.gc||0).toFixed(0),(ie.v.gf||0).toFixed(0),(ie.v.margenCOP||0).toFixed(0),(ie.v.pvp||0).toFixed(0),(ie.v.puVenta||0).toFixed(0),(ie.ivaL||0).toFixed(0),(ie.v.pvp+ie.ivaL).toFixed(0),(ie.v.coefMult||0).toFixed(4)])})});const I=[ye.join(";"),...be.map(J=>J.join(";"))].join(`
`),N=new Blob(["\uFEFF"+I],{type:"text/csv;charset=utf-8"}),q=document.createElement("a");q.href=URL.createObjectURL(N),q.download=`APUs_Venta_${t.codigoOferta||"oferta"}.csv`,q.click()},se=()=>{const ye=window.open("","_blank");let be=`<html><head><title>APUs de Venta - ${t.codigoOferta||""}</title>
          <style>@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@400;600;700&family=DM+Mono:wght@400;500&display=swap');
          *{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;padding:28px;color:#111;font-size:11px}
          h1{font-size:18px;margin-bottom:4px}h2{font-size:13px;margin:20px 0 8px;padding:6px 0;border-bottom:2px solid #111}
          .meta{color:#888;font-size:10px;margin-bottom:16px}
          table{width:100%;border-collapse:collapse;margin-bottom:16px}
          th{background:#F5F4F1;padding:5px 6px;font-size:8px;text-transform:uppercase;letter-spacing:0.5px;text-align:right;border-bottom:2px solid #E0E0E0}
          th:nth-child(1),th:nth-child(2){text-align:left}
          td{padding:5px 6px;border-bottom:1px solid #E0E0E0;font-size:10px;text-align:right}
          td:nth-child(1),td:nth-child(2){text-align:left}
          .mono{font-family:'DM Mono',monospace}.bold{font-weight:700}.green{color:#111111}.blue{color:#3B3B3B}
          .totrow td{font-weight:700;border-top:2px solid #111;padding-top:8px}
          .param{background:#F5F4F1;padding:10px 14px;border-radius:4px;font-size:9px;color:#555;margin-bottom:16px}
          @media print{body{padding:12px}}
          </style></head><body>`;be+=`<h1>APUs de Venta  ${t.proyecto||t.codigoOferta||"Oferta"}</h1>`,be+=`<div class="meta">${t.codigoOferta||""}  ${t.cliente||""}  ${a}  ${new Date().toLocaleDateString("es-CO")}</div>`,be+=`<div class="param">Margen: ${(t.margen*100).toFixed(1)}%  GC: ${((o.g||0)*100).toFixed(2)}%  GF: ${((o.f||0)*100).toFixed(2)}%  IVA: ${((t.tarifaIVA||.19)*100).toFixed(0)}%${D?" (sobre utilidad)":""}</div>`,ce.forEach(I=>{const N=re[I];be+=`<h2>${N.nombre}</h2><table><tr><th>Descripcin</th><th>Und</th><th>Cant</th><th>PU Coste</th><th>CD</th><th>GC</th><th>GF</th><th>Margen</th><th>PVP s/IVA</th><th>PU Venta</th><th>IVA</th><th>PVP c/IVA</th></tr>`;let q=0;N.items.forEach(J=>{const R=J.v.pvp+J.ivaL;q+=R,be+=`<tr><td>${J.descripcion||""}</td><td>${J.und||""}</td><td class="mono">${J.cantidad||1}</td>`,be+=`<td class="mono">${r(J.v.puCoste,0)}</td><td class="mono">${r(J.v.cd,0)}</td>`,be+=`<td class="mono">${r(J.v.gc,0)}</td><td class="mono">${r(J.v.gf,0)}</td>`,be+=`<td class="mono">${r(J.v.margenCOP,0)}</td>`,be+=`<td class="mono bold blue">${r(J.v.pvp,0)}</td>`,be+=`<td class="mono">${r(J.v.puVenta,0)}</td>`,be+=`<td class="mono">${r(J.ivaL,0)}</td>`,be+=`<td class="mono bold green">${r(R,0)}</td></tr>`}),be+=`<tr class="totrow"><td colspan="8">Subtotal ${N.nombre}</td><td colspan="4" class="mono green">${r(q,0)} ${a}</td></tr></table>`}),be+=`<table style="margin-top:16px"><tr class="totrow"><td colspan="8" style="font-size:14px">TOTAL VENTA</td><td colspan="4" class="mono green" style="font-size:14px">${r(V+le.reduce((I,N)=>{const q=qt(N.precioCD||0,N.cantidad||1,t);return I+(D?O*q.pvp*(t.tarifaIVA||.19):q.pvp*(t.tarifaIVA||.19))},0),0)} ${a}</td></tr></table>`,be+="</body></html>",ye.document.write(be),ye.document.close(),setTimeout(()=>ye.print(),300)},ge={fontFamily:"'DM Mono',monospace",fontSize:11,textAlign:"right"};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:16},onClick:()=>k(!1),children:e.jsxs("div",{onClick:ye=>ye.stopPropagation(),style:{background:"#fff",borderRadius:10,width:"95%",maxWidth:1100,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.25)"},children:[e.jsxs("div",{style:{padding:"16px 22px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:17,fontWeight:700,margin:0},children:" APUs de Venta"}),e.jsxs("p",{style:{fontSize:10,color:"#888",margin:"3px 0 0"},children:[t.codigoOferta||"","  ",t.cliente||"","  ",le.length," partidas con precio"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsxs("select",{value:v,onChange:ye=>m(ye.target.value),style:{padding:"6px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:11,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"todos",children:"Todos los captulos"}),G.map(ye=>e.jsx("option",{value:ye,children:re[ye].nombre},ye))]}),e.jsxs("button",{onClick:W,style:{padding:"6px 14px",background:"#fff",border:"1px solid #E0E0E0",borderRadius:4,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Eo,{size:12})," CSV"]}),e.jsxs("button",{onClick:se,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:4,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:12})," PDF / Imprimir"]}),e.jsx("button",{onClick:()=>k(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888",padding:4},children:e.jsx($t,{size:18})})]})]}),e.jsxs("div",{style:{padding:"8px 22px",background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",display:"flex",gap:20,flexShrink:0,fontSize:10,color:"#555"},children:[e.jsxs("span",{children:["Margen: ",e.jsxs("strong",{children:[(t.margen*100).toFixed(1),"%"]})]}),e.jsxs("span",{children:["GC: ",e.jsxs("strong",{children:[((o.g||0)*100).toFixed(2),"%"]})]}),e.jsxs("span",{children:["GF: ",e.jsxs("strong",{children:[((o.f||0)*100).toFixed(2),"%"]})]}),e.jsxs("span",{children:["IVA: ",e.jsxs("strong",{children:[((t.tarifaIVA||.19)*100).toFixed(0),"%"]}),D?" (sobre U)":""]}),e.jsxs("span",{children:["Coef. mult: ",e.jsxs("strong",{children:[" ",le.length>0?(ue=qt(1,1,t).coefMult)==null?void 0:ue.toFixed(4):""]})]}),e.jsxs("span",{style:{marginLeft:"auto",fontWeight:700,color:"#111111"},children:["Total coste: ",r(Y,0),"  Total venta: ",r(V,0)," ",a]})]}),e.jsxs("div",{style:{overflowY:"auto",flex:1,padding:"0 22px 22px"},children:[le.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 0",color:"#888"},children:[e.jsx("p",{style:{fontSize:14},children:"No hay partidas con precio para mostrar APUs de venta."}),e.jsx("p",{style:{fontSize:11,marginTop:6},children:"Aade partidas con costo directo en el borrador."})]}):ce.map(ye=>{const be=re[ye],I=be.items.reduce((q,J)=>q+J.v.pvp,0),N=be.items.reduce((q,J)=>q+J.ivaL,0);return e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:12,fontWeight:700,margin:"18px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:be.nombre}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:[r(I+N,0)," ",a]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Descripcin","Und","Cant","PU Coste","CD Total","GC","GF","Margen","PVP s/IVA","PU Venta","IVA","PVP c/IVA"].map(q=>e.jsx("th",{style:{padding:"5px 6px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,textAlign:q==="Descripcin"||q==="Und"?"left":"right",borderBottom:"1px solid #E0E0E0"},children:q},q))})}),e.jsxs("tbody",{children:[be.items.map(q=>{const J=q.v.pvp+q.ivaL;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},onMouseEnter:R=>R.currentTarget.style.background="#FFFFFF",onMouseLeave:R=>R.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"6px",fontSize:11,maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:q.descripcion||""}),e.jsx("td",{style:{padding:"6px",fontSize:10,color:"#888"},children:q.und||""}),e.jsx("td",{style:{...ge,padding:"6px"},children:q.cantidad||1}),e.jsx("td",{style:{...ge,padding:"6px",color:"#888"},children:r(q.v.puCoste,0)}),e.jsx("td",{style:{...ge,padding:"6px"},children:r(q.v.cd,0)}),e.jsx("td",{style:{...ge,padding:"6px",color:"#888"},children:r(q.v.gc,0)}),e.jsx("td",{style:{...ge,padding:"6px",color:"#888"},children:r(q.v.gf,0)}),e.jsx("td",{style:{...ge,padding:"6px",color:"#D4A017"},children:r(q.v.margenCOP,0)}),e.jsx("td",{style:{...ge,padding:"6px",fontWeight:700,color:"#3B3B3B"},children:r(q.v.pvp,0)}),e.jsx("td",{style:{...ge,padding:"6px"},children:r(q.v.puVenta,0)}),e.jsx("td",{style:{...ge,padding:"6px",color:"#888"},children:r(q.ivaL,0)}),e.jsx("td",{style:{...ge,padding:"6px",fontWeight:700,color:"#111111"},children:r(J,0)})]},q.id)}),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsxs("td",{colSpan:8,style:{padding:"8px 6px",fontWeight:700,fontSize:11},children:["Subtotal ",be.nombre]}),e.jsx("td",{style:{...ge,padding:"8px 6px",fontWeight:700,color:"#3B3B3B"},children:r(I,0)}),e.jsx("td",{style:{...ge,padding:"8px 6px"},children:""}),e.jsx("td",{style:{...ge,padding:"8px 6px",color:"#888"},children:r(N,0)}),e.jsx("td",{style:{...ge,padding:"8px 6px",fontWeight:700,color:"#111111"},children:r(I+N,0)})]})]})]})]},ye)}),le.length>0&&e.jsxs("div",{style:{marginTop:20,padding:"14px 0",borderTop:"3px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:16,fontWeight:700},children:"TOTAL VENTA"}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:18,fontWeight:700,color:"#111111"},children:[r(V+le.reduce((ye,be)=>{const I=qt(be.precioCD||0,be.cantidad||1,t);return ye+(D?O*I.pvp*(t.tarifaIVA||.19):I.pvp*(t.tarifaIVA||.19))},0),0)," ",a]}),e.jsxs("div",{style:{fontSize:10,color:"#888",marginTop:2},children:["sin IVA: ",r(V,0)," + IVA: ",r(le.reduce((ye,be)=>{const I=qt(be.precioCD||0,be.cantidad||1,t);return ye+(D?O*I.pvp*(t.tarifaIVA||.19):I.pvp*(t.tarifaIVA||.19))},0),0)]})]})]})]})]})})})(),h&&(()=>{var V,Y;const D=y.find(W=>W.id===h);if(!D||Number(D.precioCD)<=0)return null;const O=qt(Number(D.precioCD),D.cantidad||1,t),le=t.tipoProyecto==="OBRA",re=o.U||t.margen,de=le?re*O.pvp*(t.tarifaIVA||.19):O.pvp*(t.tarifaIVA||.19),G={display:"flex",justifyContent:"space-between",padding:"7px 0",borderBottom:`1px solid ${C.border}`,fontSize:13},ce={fontFamily:"'DM Mono',monospace",fontWeight:600};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(null),children:e.jsxs("div",{onClick:W=>W.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,maxWidth:520,width:"90%",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"APU de Venta"}),e.jsxs("p",{style:{margin:"4px 0 0",fontSize:11,color:C.inkLight},children:[D.descripcion||"Partida","  Cant: ",D.cantidad||1," ",D.und||"und"]})]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:C.inkLight},children:e.jsx($t,{size:18})})]}),e.jsxs("div",{style:G,children:[e.jsx("span",{children:"Costo directo (CD)"}),e.jsx("span",{style:ce,children:Ye(O.cd)})]}),e.jsxs("div",{style:G,children:[e.jsx("span",{style:{color:C.inkMid,paddingLeft:12},children:" PU coste"}),e.jsx("span",{style:{...ce,color:C.inkMid},children:Ye(O.puCoste)})]}),e.jsxs("div",{style:G,children:[e.jsxs("span",{children:["Gastos contratacin (GC) ",it(o.g||0)]}),e.jsx("span",{style:ce,children:Ye(O.gc)})]}),e.jsxs("div",{style:G,children:[e.jsxs("span",{children:["Gastos financieros (GF) ",it(o.f||0)]}),e.jsx("span",{style:ce,children:Ye(O.gf)})]}),e.jsxs("div",{style:G,children:[e.jsxs("span",{children:["Margen ",it(t.margen)]}),e.jsx("span",{style:ce,children:Ye(O.margenCOP)})]}),e.jsxs("div",{style:{...G,fontWeight:700,fontSize:15,borderBottom:"2px solid #111"},children:[e.jsx("span",{children:"PVP sin IVA"}),e.jsx("span",{style:ce,children:Ye(O.pvp)})]}),e.jsxs("div",{style:G,children:[e.jsx("span",{style:{color:C.inkMid,paddingLeft:12},children:" PU venta"}),e.jsx("span",{style:{...ce,color:C.inkMid},children:Ye(O.puVenta)})]}),e.jsxs("div",{style:G,children:[e.jsxs("span",{children:["IVA ",le?`(U ${it(re)}  ${it(t.tarifaIVA)})`:it(t.tarifaIVA)]}),e.jsx("span",{style:ce,children:Ye(de)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px 0",fontSize:16,fontWeight:700},children:[e.jsx("span",{children:"PVP con IVA"}),e.jsx("span",{style:{...ce,color:C.success},children:Ye(O.pvp+de)})]}),e.jsxs("div",{style:{background:C.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:C.inkMid,marginTop:8},children:["Coef. multiplicador: ",e.jsxs("strong",{children:[" ",(V=O.coefMult)==null?void 0:V.toFixed(4)]}),"  Denominador: ",e.jsx("strong",{children:(Y=O.den)==null?void 0:Y.toFixed(4)})]})]})})})()]})}function Oh({d:t,set:i}){const[o,n]=F.useState(""),[a,r]=F.useState(""),s=oo.find(d=>d.id===t.servicioId)||oo[2],g=t.entregablesOferta||[];F.useEffect(()=>{if(t.servicioId&&(!t.entregablesOferta||t.entregablesOferta.length===0)){const d=oo.find(c=>c.id===t.servicioId);d&&d.entregables.length>0&&i("entregablesOferta",d.entregables.map((c,l)=>({id:"ent_"+l,nombre:c.nombre,horasBase:c.horas,horas:c.horas,incluir:!0,custom:!1})))}},[t.servicioId]);const h=d=>{i("servicioId",d);const c=oo.find(l=>l.id===d);c&&(i("actividadCod",c.cod),c.entregables.length>0?i("entregablesOferta",c.entregables.map((l,x)=>({id:"ent_"+x,nombre:l.nombre,horasBase:l.horas,horas:l.horas,incluir:!0,custom:!1}))):i("entregablesOferta",[]))},b=d=>{i("entregablesOferta",g.map(c=>c.id===d?{...c,incluir:!c.incluir}:c))},j=(d,c)=>{i("entregablesOferta",g.map(l=>l.id===d?{...l,horas:Number(c)||0}:l))},k=()=>{if(!o.trim())return;const d={id:"custom_"+Date.now(),nombre:o.trim(),horasBase:Number(a)||0,horas:Number(a)||0,incluir:!0,custom:!0};i("entregablesOferta",[...g,d]),n(""),r("")},v=d=>{i("entregablesOferta",g.filter(c=>c.id!==d))},m=g.filter(d=>d.incluir).reduce((d,c)=>d+(c.horas||0),0),f=g.filter(d=>d.incluir).length,p={card:{background:"#fff",border:`1px solid ${C.border}`,borderRadius:6,padding:"20px 24px",marginBottom:16},sTitle:{fontSize:9,fontWeight:700,letterSpacing:2.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 14px"}};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:p.card,children:[e.jsx("p",{style:p.sTitle,children:"Servicio"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16},children:oo.map(d=>e.jsx("button",{onClick:()=>h(d.id),style:{padding:"8px 16px",border:`1px solid ${t.servicioId===d.id?C.ink:C.border}`,background:t.servicioId===d.id?C.ink:"#fff",color:t.servicioId===d.id?"#fff":C.ink,borderRadius:4,fontSize:11,fontWeight:t.servicioId===d.id?700:500,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",letterSpacing:.3,transition:"all .15s"},children:d.nombre},d.id))}),s.descripcion&&e.jsx("p",{style:{fontSize:12,color:C.inkMid,lineHeight:1.6,margin:0,maxWidth:700},children:s.descripcion})]}),s.alcances.length>0&&e.jsxs("div",{style:p.card,children:[e.jsx("p",{style:p.sTitle,children:"Alcances del servicio"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px 20px"},children:s.alcances.map((d,c)=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8,padding:"6px 0"},children:[e.jsx("span",{style:{color:C.ink,fontSize:11,marginTop:1,flexShrink:0},children:""}),e.jsx("span",{style:{fontSize:12,color:C.ink,lineHeight:1.4},children:d})]},c))})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16},children:[e.jsxs("div",{style:{flex:1,background:"#fff",border:`1px solid ${C.border}`,borderRadius:6,padding:"14px 18px"},children:[e.jsx("p",{style:{fontSize:8,fontWeight:600,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 4px"},children:"Entregables incluidos"}),e.jsx("p",{style:{fontSize:22,fontWeight:700,color:C.ink,margin:0},children:f})]}),e.jsxs("div",{style:{flex:1,background:"#fff",border:`1px solid ${C.border}`,borderRadius:6,padding:"14px 18px"},children:[e.jsx("p",{style:{fontSize:8,fontWeight:600,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 4px"},children:"Horas totales"}),e.jsxs("p",{style:{fontSize:22,fontWeight:700,color:C.ink,margin:0},children:[m,"h"]})]}),e.jsxs("div",{style:{flex:1,background:"#fff",border:`1px solid ${C.border}`,borderRadius:6,padding:"14px 18px"},children:[e.jsx("p",{style:{fontSize:8,fontWeight:600,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 4px"},children:"Das estimados (8h/da)"}),e.jsx("p",{style:{fontSize:22,fontWeight:700,color:C.ink,margin:0},children:Math.ceil(m/8)})]})]}),g.length>0&&e.jsxs("div",{style:p.card,children:[e.jsx("p",{style:p.sTitle,children:"Entregables"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${C.border}`},children:[e.jsx("th",{style:{textAlign:"left",padding:"8px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,width:30}}),e.jsx("th",{style:{textAlign:"left",padding:"8px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight},children:"Entregable"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,width:80},children:"Hrs base"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,width:90},children:"Hrs ajustadas"}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:g.map(d=>e.jsxs("tr",{style:{borderBottom:`1px solid ${C.border}`,opacity:d.incluir?1:.4,transition:"opacity .15s"},children:[e.jsx("td",{style:{padding:"8px 0"},children:e.jsx("input",{type:"checkbox",checked:d.incluir,onChange:()=>b(d.id),style:{width:14,height:14,cursor:"pointer",accentColor:C.ink}})}),e.jsxs("td",{style:{padding:"8px 0",fontSize:12,color:C.ink,fontWeight:d.incluir?500:400},children:[d.nombre,d.custom&&e.jsx("span",{style:{marginLeft:6,fontSize:8,padding:"1px 5px",background:C.infoBg,color:C.info,borderRadius:2,fontWeight:600},children:"CUSTOM"})]}),e.jsxs("td",{style:{textAlign:"center",padding:"8px 0",fontSize:11,color:C.inkLight},children:[d.horasBase,"h"]}),e.jsx("td",{style:{textAlign:"center",padding:"8px 4px"},children:e.jsx("input",{type:"number",value:d.horas,onChange:c=>j(d.id,c.target.value),style:{width:60,textAlign:"center",border:`1px solid ${C.border}`,borderRadius:3,padding:"4px 6px",fontSize:12,fontWeight:600,color:C.ink,fontFamily:"'DM Sans',sans-serif",background:d.horas!==d.horasBase?"#FFF8E1":"#fff"}})}),e.jsx("td",{style:{padding:"8px 0"},children:d.custom&&e.jsx("button",{onClick:()=>v(d.id),style:{background:"none",border:"none",cursor:"pointer",color:C.error,fontSize:12},children:""})})]},d.id))})]})]}),e.jsxs("div",{style:p.card,children:[e.jsx("p",{style:p.sTitle,children:"Aadir entregable personalizado"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:600,color:C.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:"Nombre"}),e.jsx("input",{value:o,onChange:d=>n(d.target.value),placeholder:"Ej: Plano de paisajismo",style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:3,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif"},onKeyDown:d=>d.key==="Enter"&&k()})]}),e.jsxs("div",{style:{width:90},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:600,color:C.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:"Horas"}),e.jsx("input",{type:"number",value:a,onChange:d=>r(d.target.value),placeholder:"0",style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:3,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif",textAlign:"center"},onKeyDown:d=>d.key==="Enter"&&k()})]}),e.jsx("button",{onClick:k,style:{padding:"8px 16px",background:C.ink,color:"#fff",border:"none",borderRadius:3,fontSize:11,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",letterSpacing:.5,whiteSpace:"nowrap"},children:"+ Aadir"})]})]}),s.entregables.length===0&&g.length===0&&e.jsxs("div",{style:{padding:"40px 0",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:13,color:C.inkLight,margin:"0 0 8px"},children:s.id==="consultoria"?"La consultora se personaliza por horas segn necesidades del proyecto.":"Este servicio no tiene entregables predefinidos."}),e.jsx("p",{style:{fontSize:11,color:C.inkLight},children:"Puedes aadir entregables personalizados usando el formulario de arriba."})]})]})}function Lh({d:t,set:i}){const[o,n]=F.useState(null),[a,r]=F.useState(!0);F.useEffect(()=>{if(t.briefingId)try{const b=Ee.getSync("hab:briefing:"+t.briefingId);b&&n(JSON.parse(b))}catch{}r(!1)},[t.briefingId]);const s=ac,g={label:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 4px",fontWeight:600},val:{fontSize:13,color:C.ink,margin:"0 0 12px",lineHeight:1.5},card:{background:"#fff",border:`1px solid ${C.border}`,borderRadius:6,padding:"20px 24px",marginBottom:16},grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0 24px"}};if(a)return e.jsx("div",{style:{padding:40,textAlign:"center",color:C.inkLight},children:"Cargando..."});if(!t.briefingId)return e.jsxs("div",{style:{padding:"60px 0",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:14,color:C.inkLight,margin:"0 0 12px"},children:"Esta oferta no tiene un briefing vinculado."}),e.jsx("p",{style:{fontSize:12,color:C.inkLight},children:'Puedes crear una oferta desde un briefing en Briefings  Recibidos  "Crear oferta"'})]});if(!o)return e.jsx("div",{style:{padding:"60px 0",textAlign:"center"},children:e.jsxs("p",{style:{fontSize:14,color:C.inkLight},children:["Briefing vinculado (ID: ",t.briefingId,") pero los datos no se encontraron en la base de datos."]})});const h=[{title:"Identificacin del proyecto",icon:"",keys:["nombre","email","telefono","como_conociste","ciudad","edificio","direccion_proyecto","tipo_proyecto","area_m2","num_habitaciones"]},{title:"Diseo y estilo",icon:"",keys:["estilo","colores_materiales","espacios","fecha_inicio","plazo"]},{title:"Presupuesto y financiacin",icon:"",keys:["presupuesto","financiacion","lo_mas_importante","que_esperas","links_ref"]},{title:"Datos de facturacin",icon:"",keys:["razon_social","documento","email_factura","dir_facturacion","retenciones","detalle_retenciones","anticipo","forma_pago"]}];return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:18},children:""}),e.jsx("h3",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:18,fontWeight:700,margin:0,color:C.ink},children:"Informe de Briefing"})]}),e.jsxs("p",{style:{fontSize:11,color:C.inkLight,margin:"4px 0 0"},children:["Respuestas del cliente  ",o.fecha||"","  ",o.nombre||"Sin nombre"]})]}),h.map((b,j)=>b.keys.some(v=>{const m=o[v];return m&&(Array.isArray(m)?m.length>0:String(m).trim()!=="")})?e.jsxs("div",{style:g.card,children:[e.jsxs("h4",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:13,fontWeight:700,margin:"0 0 16px",color:C.ink,display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:b.icon})," ",b.title]}),e.jsx("div",{style:g.grid,children:b.keys.map(v=>{const m=o[v];if(!m||Array.isArray(m)&&m.length===0||String(m).trim()==="")return null;const f=s.find(c=>c.key===v),p=(f==null?void 0:f.lbl)||v,d=Array.isArray(m)?m.join(", "):String(m);return e.jsxs("div",{children:[e.jsx("p",{style:g.label,children:p}),e.jsx("p",{style:g.val,children:d})]},v)})})]},j):null)]})}const Wh=[{id:"briefing",lbl:"Briefing",en:"Briefing"},{id:"general",lbl:"General",en:"General"},{id:"alcances",lbl:"Alcances",en:"Scope"},{id:"params",lbl:"Parmetros",en:"Parameters"},{id:"borrador",lbl:"Borrador + APU",en:"Draft + APU"},{id:"cronograma",lbl:"Cronograma",en:"Schedule"},{id:"flujo",lbl:"Flujo de caja",en:"Cash Flow"},{id:"organigrama",lbl:"Organigrama",en:"Org Chart"},{id:"gg",lbl:"Gastos generales",en:"Overhead"},{id:"insumos",lbl:"Insumos",en:"Supplies"},{id:"equipos",lbl:"Equipos trabajo",en:"Work Teams"},{id:"resumen",lbl:"Resumen",en:"Summary"},{id:"entrega",lbl:"Entrega cliente",en:"Client Delivery"}];function Nh({offers:t,editId:i,prefillData:o,onSave:n,onBack:a,lang:r}){const s=i?t.find(c=>c.id===i):null,[g,h]=F.useState(()=>({...fh,...s||{},...!i&&o?o:{},id:(s==null?void 0:s.id)||kt(),createdAt:(s==null?void 0:s.createdAt)||Dt(),updatedAt:Dt(),planos:(s==null?void 0:s.planos)||oc()})),[b,j]=F.useState("general");F.useEffect(()=>{if(!i&&(o!=null&&o.lugarNombre)&&!g.proyecto){const c=nc(g.tipoInmueble,g.lugarNombre,g.lugarReferencia);c&&h(l=>({...l,proyecto:c}))}},[]);const[k,v]=F.useState(!1),m=(c,l)=>h(x=>({...x,[c]:l,updatedAt:Dt()})),f=F.useMemo(()=>er(g),[g]),p=()=>{n(g),v(!0),setTimeout(()=>v(!1),2200)},d=()=>{const c=[["Campo","Valor"],["Cliente",g.cliente],["Proyecto",g.proyecto],["Estado",g.estado],["Tipo",g.tipoProyecto],...g.tipoProyecto==="DISEO"?[["Modalidad",g.subtipoDiseno]]:[],["Costo (COP)",f.COSTO],["PVP sin IVA",f.PVP],["IVA",f.IVA],["PVP c/IVA",f.PVP_IVA],["Margen $",f.margenCOP],["Financieros",f.fin],["Retenciones",f.ret],["Neto",f.neto]],l=new Blob(["\uFEFF"+c.map(u=>u.map(S=>`"${S}"`).join(",")).join(`
`)],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(l),y=document.createElement("a");y.href=x,y.download=`Oferta_${g.cliente||"Habitaris"}_${g.proyecto||"SN"}.csv`,y.click(),URL.revokeObjectURL(x)};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:22,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",color:C.inkMid,padding:4},children:e.jsx(Cd,{size:18})}),e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",color:C.inkLight,margin:"0 0 3px"},children:[i?r==="en"?"Edit offer":"Editar oferta":r==="en"?"New offer":"Nueva oferta",!i&&(o==null?void 0:o.briefingId)&&e.jsxs("span",{style:{marginLeft:8,background:"#E6F4EC",color:"#2B7A52",border:"1px solid #2B7A5233",borderRadius:2,padding:"1px 7px",fontSize:8,fontWeight:700,letterSpacing:.5},children:[" ",r==="en"?"FROM BRIEFING":"DESDE BRIEFING"]})]}),e.jsxs("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:22,fontWeight:700,color:C.ink,margin:0},children:[g.cliente||(r==="en"?"No client":"Sin cliente"),g.proyecto?`  ${g.proyecto}`:""]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ut,{v:"out",icon:Eo,sm:!0,on:d,children:r==="en"?"Export CSV":"Exportar CSV"}),e.jsxs(ut,{v:"out",icon:Et,sm:!0,on:()=>window.print(),children:["PDF / ",r==="en"?"Print":"Imprimir"]}),e.jsx(ut,{icon:wo,on:p,style:k?{background:C.success}:{},children:k?r==="en"?"Saved!":"Guardado!":r==="en"?"Save offer":"Guardar oferta"})]})]}),e.jsx("div",{className:"no-print",style:{display:"flex",borderBottom:`1px solid ${C.border}`,marginBottom:22,overflowX:"auto",whiteSpace:"nowrap"},children:Wh.map(c=>e.jsx("button",{onClick:()=>j(c.id),style:{padding:"10px 16px",border:"none",cursor:"pointer",fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:600,letterSpacing:1,textTransform:"uppercase",background:"transparent",color:b===c.id?C.ink:C.inkLight,borderBottom:b===c.id?`2px solid ${C.ink}`:"2px solid transparent",transition:"all .15s",marginBottom:-1},children:r==="en"&&c.en?c.en:c.lbl},c.id))}),b==="briefing"&&e.jsx(Lh,{d:g,set:m}),b==="general"&&e.jsx(Uh,{d:g,set:m,offers:t}),b==="alcances"&&e.jsx(Oh,{d:g,set:m}),b==="params"&&e.jsx(Vh,{d:g,set:m,r:f}),b==="borrador"&&e.jsx(Ph,{d:g,set:m,r:f}),b==="cronograma"&&e.jsx(qh,{d:g,set:m,r:f}),b==="flujo"&&e.jsx(Gh,{d:g,set:m,r:f}),b==="organigrama"&&e.jsx(Yh,{d:g,set:m}),b==="gg"&&e.jsx(Hh,{d:g,set:m,r:f}),b==="insumos"&&e.jsx(Jh,{d:g,set:m,r:f}),b==="equipos"&&e.jsx(Kh,{d:g,set:m}),b==="resumen"&&e.jsx(Xh,{d:g,r:f}),b==="entrega"&&e.jsx(Qh,{d:g,set:m,r:f})]})}function Uh({d:t,set:i,offers:o}){const n=Ha.find(x=>x.val===t.tipoInmueble)||Ha[0];Or.find(x=>x.cod===t.actividadCod)||Or[0];const a=[...new Set(Or.map(x=>x.grupo))],[r,s]=F.useState([]),[g,h]=F.useState(!1),[b,j]=F.useState(!1);F.useEffect(()=>{Sa().then(x=>s(x))},[]);const k=(x,y,u)=>{const S=Ul(x,y,u);i("codigoOferta",S)},v=(x,y)=>{i("proyecto",nc(t.tipoInmueble,x,y))},m=x=>{i("actividadCod",x),k(x,t.digitoControl,t.revision)},f=x=>{i("digitoControl",x),k(t.actividadCod,x,t.revision)},p=x=>{i("revision",x),k(t.actividadCod,t.digitoControl,x)},d=x=>{i("lugarNombre",x),v(x,t.lugarReferencia)},c=x=>{i("lugarReferencia",x),v(t.lugarNombre,x)},l=t.codigoOferta||Ul(t.actividadCod,t.digitoControl,t.revision);return e.jsxs("div",{className:"fade",children:[t.briefingId?e.jsxs("div",{style:{background:"#E8F4EE",border:"1px solid #B8DEC9",borderRadius:8,padding:"10px 16px",marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(Sd,{size:14,style:{color:"#111111"}}),e.jsx("span",{style:{fontSize:12,color:"#111111",fontWeight:600},children:"Oferta creada desde briefing"})]}):e.jsxs("div",{style:{background:"#F0F0F0",border:"1px solid #B8D4F0",borderRadius:8,padding:"12px 16px",marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(En,{size:16,style:{color:"#3B3B3B"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#3B3B3B"},children:r.length>0?`${r.length} briefing${r.length>1?"s":""} disponible${r.length>1?"s":""}`:"Tienes datos de un briefing?"}),e.jsx("div",{style:{fontSize:10,color:"#3B3B3B99"},children:r.length>0?"Importa los datos del cliente para pre-llenar la oferta":"Ingresa un briefing en Formularios y luego imprtalo aqu"})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[r.length>0&&e.jsx("button",{onClick:()=>h(!0),style:{padding:"6px 14px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:11,fontWeight:700,display:"flex",alignItems:"center",gap:5,fontFamily:"'DM Sans',sans-serif"},children:" Importar briefing"}),e.jsx("button",{onClick:()=>j(!0),style:{padding:"6px 14px",background:r.length>0?"#fff":"#3B3B3B",color:r.length>0?"#3B3B3B":"#fff",border:r.length>0?"1px solid #3B3B3B33":"none",borderRadius:6,cursor:"pointer",fontSize:11,fontWeight:600,display:"flex",alignItems:"center",gap:5,fontFamily:"'DM Sans',sans-serif"},children:" Ingresar rpido"})]})]}),g&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:x=>x.target===x.currentTarget&&h(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",maxHeight:"65vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:"Seleccionar briefing"}),e.jsx("button",{onClick:()=>h(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:18})})]}),e.jsx("div",{style:{overflowY:"auto",padding:14},children:r.map(x=>e.jsxs("div",{onClick:()=>{const y=Ws(x);Object.entries(y).forEach(([u,S])=>i(u,S)),i("briefingId",x.id),h(!1)},style:{padding:"12px 14px",border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,cursor:"pointer"},onMouseEnter:y=>y.currentTarget.style.background="#F5F4F1",onMouseLeave:y=>y.currentTarget.style.background="#fff",children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:x.nombre||"Sin nombre"}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2},children:[x.email||"","  ",new Date(x.creadoEn||Date.now()).toLocaleDateString("es-CO")]})]},x.id))})]})}),b&&(()=>{const x=[{k:"nombre",l:"Nombre completo *",ph:"Juan Prez",required:!0},{k:"email",l:"Email",ph:"juan@mail.com",type:"email"},{k:"telefono",l:"WhatsApp",ph:"300 123 4567",type:"tel"},{k:"ciudad",l:"Ciudad",ph:"Bogot"},{k:"edificio",l:"Edificio / Conjunto",ph:"Torres del Parque"},{k:"tipo_proyecto",l:"Tipo de proyecto",ph:"",sel:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"]},{k:"area_m2",l:"rea (m)",ph:"80",type:"number"},{k:"presupuesto",l:"Presupuesto (COP)",ph:"50000000",type:"number"},{k:"lo_mas_importante",l:"Qu necesita el cliente?",ph:"Descripcin breve del proyecto...",ta:!0},{k:"razon_social",l:"Razn social",ph:"Empresa S.A.S"},{k:"documento",l:"NIT / Cdula",ph:"901.000.000-0"}];return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:y=>y.target===y.currentTarget&&j(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:600,width:"100%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:" Ingreso rpido de briefing"}),e.jsx("div",{style:{fontSize:10,color:"#888",marginTop:2},children:"Los datos se importarn directamente a esta oferta"})]}),e.jsx("button",{onClick:()=>j(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:18})})]}),e.jsx("div",{style:{overflowY:"auto",padding:"16px 20px"},id:"qb-form",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:x.map(y=>e.jsxs("div",{style:y.ta?{gridColumn:"1/-1"}:{},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#888",marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:y.l}),y.sel?e.jsxs("select",{"data-qb":y.k,defaultValue:"",style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),y.sel.map(u=>e.jsx("option",{value:u,children:u},u))]}):y.ta?e.jsx("textarea",{"data-qb":y.k,rows:2,placeholder:y.ph,style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical",boxSizing:"border-box"}}):e.jsx("input",{"data-qb":y.k,type:y.type||"text",placeholder:y.ph,style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",boxSizing:"border-box"}})]},y.k))})}),e.jsxs("div",{style:{padding:"12px 20px",borderTop:"1px solid #E0E0E0",display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:async()=>{const y={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0]};if(document.querySelectorAll("[data-qb]").forEach(S=>{const A=S.getAttribute("data-qb");S.value&&(y[A]=S.value)}),!y.nombre){alert("El nombre es obligatorio");return}await Ls(y),s(S=>[y,...S]);const u=Ws(y);Object.entries(u).forEach(([S,A])=>i(S,A)),i("briefingId",y.id),j(!1)},style:{padding:"8px 20px",background:"#111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:700,fontFamily:"'DM Sans',sans-serif"},children:"Importar a esta oferta"}),e.jsx("button",{onClick:async()=>{const y={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0]};if(document.querySelectorAll("[data-qb]").forEach(u=>{const S=u.getAttribute("data-qb");u.value&&(y[S]=u.value)}),!y.nombre){alert("El nombre es obligatorio");return}await Ls(y),s(u=>[y,...u]),j(!1),alert(" Briefing guardado. Puedes importarlo cuando quieras.")},style:{padding:"8px 20px",background:"transparent",color:"#555",border:"1px solid #E0E0E0",borderRadius:6,cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:"Solo guardar briefing"})]})]})})})(),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Codificacin del proyecto",s:"Cdigo automtico segn formato Habitaris"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Tipo de actividad"}),e.jsx("select",{value:t.actividadCod,onChange:x=>m(x.target.value),style:{width:"100%",padding:"9px 12px",border:`1px solid ${C.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:C.ink,background:C.bg},onFocus:x=>x.target.style.borderColor=C.ink,onBlur:x=>x.target.style.borderColor=C.border,children:a.map(x=>e.jsx("optgroup",{label:x,children:Or.filter(y=>y.grupo===x).map(y=>e.jsxs("option",{value:y.cod,children:[y.cod,"  ",y.label]},y.cod))},x))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(ot,{lbl:"Dgito de control",val:t.digitoControl,on:x=>f(x.target.value),ph:"01",note:"2 dgitos  orden del da"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Revisin"}),e.jsx("select",{value:t.revision,onChange:x=>p(+x.target.value),style:{width:"100%",padding:"9px 12px",border:`1px solid ${C.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:C.ink,background:C.bg},onFocus:x=>x.target.style.borderColor=C.ink,onBlur:x=>x.target.style.borderColor=C.border,children:[0,1,2,3,4,5,6,7,8,9].map(x=>e.jsxs("option",{value:x,children:["R",String(x).padStart(2,"0")]},x))})]})]}),e.jsxs("div",{style:{background:C.ink,borderRadius:2,padding:"14px 16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 3px",fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:1.5},children:"Cdigo de oferta"}),e.jsx("p",{style:{margin:0,fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:"#fff",letterSpacing:1.5},children:l})]}),e.jsx("button",{onClick:()=>{var x;return(x=navigator.clipboard)==null?void 0:x.writeText(l)},style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:2,padding:"6px 12px",color:"#fff",fontFamily:"'DM Sans', sans-serif",fontSize:10,cursor:"pointer",letterSpacing:.8},children:"COPIAR"})]})]}),e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Identificacin del proyecto",s:"Nombre automtico segn tipo de inmueble"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:8,textTransform:"uppercase",letterSpacing:1},children:"Tipo de inmueble"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:Ha.map(x=>e.jsx("button",{onClick:()=>i("tipoInmueble",x.val),style:{padding:"5px 12px",borderRadius:2,border:`1px solid ${t.tipoInmueble===x.val?C.ink:C.border}`,fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:t.tipoInmueble===x.val?700:400,background:t.tipoInmueble===x.val?C.ink:"transparent",color:t.tipoInmueble===x.val?"#fff":C.inkMid,cursor:"pointer",transition:"all .15s"},children:x.label},x.val))})]}),e.jsx(ot,{lbl:n.ph1,val:t.lugarNombre,on:x=>d(x.target.value),ph:`Ej: ${n.ph1}`}),e.jsx(ot,{lbl:n.ph2,val:t.lugarReferencia,on:x=>c(x.target.value),ph:n.ph2}),e.jsxs("div",{style:{background:C.accentBg,borderRadius:2,padding:"12px 16px",border:`1px solid ${C.borderMid}`,marginBottom:14},children:[e.jsx("p",{style:{margin:"0 0 3px",fontSize:9,color:C.inkLight,textTransform:"uppercase",letterSpacing:1.5},children:"Nombre del proyecto"}),e.jsx("p",{style:{margin:0,fontSize:15,fontWeight:700,color:C.ink},children:t.proyecto||e.jsx("span",{style:{color:C.inkLight,fontWeight:400},children:"Se completar automticamente"})})]}),e.jsx(ot,{lbl:"Cliente / Empresa",val:t.cliente,on:x=>i("cliente",x.target.value),ph:"Nombre del cliente"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(ot,{lbl:"Email cliente",val:t.emailCliente||"",on:x=>i("emailCliente",x.target.value),ph:"cliente@email.com"}),e.jsx(ot,{lbl:"Telfono cliente",val:t.telCliente||"",on:x=>i("telCliente",x.target.value),ph:"+57 300 000 0000"})]}),e.jsx(ot,{lbl:"Ciudad / Barrio",val:t.ubicacion,on:x=>i("ubicacion",x.target.value),ph:"Ej: Bogot, Chapinero"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(ot,{lbl:"Fecha inicio estimada",type:"date",val:t.fechaInicio||"",on:x=>i("fechaInicio",x.target.value)}),e.jsx(ot,{lbl:"Fecha entrega estimada",type:"date",val:t.fechaEntrega||"",on:x=>i("fechaEntrega",x.target.value)})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(Sn,{lbl:"Firma / Representante",val:t.firmaRepresentante||"David Parra Galera",on:x=>i("firmaRepresentante",x.target.value),opts:["David Parra Galera","Ana Mara Daz Buitrago"]}),e.jsx(ot,{lbl:"Elaborado por",val:t.elaboradoPor||"",on:x=>i("elaboradoPor",x.target.value),ph:"Nombre de quien elabora"})]}),e.jsx(Sn,{lbl:"Estado",val:t.estado,on:x=>i("estado",x.target.value),opts:il})]}),e.jsx(Je,{style:{padding:22,gridColumn:"1 / -1"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:C.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas internas"}),e.jsx("textarea",{value:t.notas,onChange:x=>i("notas",x.target.value),rows:3,placeholder:"Observaciones, acuerdos, follow-ups...",style:{width:"100%",padding:"9px 12px",border:`1px solid ${C.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:C.bg,resize:"vertical",color:C.ink}})]}),e.jsxs("div",{children:[e.jsx(Sn,{lbl:"Relacionada con oferta",val:t.relacionadaCon||"",on:x=>i("relacionadaCon",x.target.value||null),note:"Vincula a una revisin o variante anterior",opts:[{v:"",l:" Ninguna "},...o.filter(x=>x.id!==t.id).map(x=>({v:x.id,l:`${x.codigoOferta||x.cliente}  ${x.proyecto||"sin nombre"}`}))]}),e.jsxs("div",{style:{background:C.accentBg,borderRadius:2,padding:"10px 14px",fontSize:11,color:C.inkMid},children:["Creada: ",e.jsx("strong",{children:t.createdAt}),"  Actualizada: ",e.jsx("strong",{children:t.updatedAt})]})]})]})}),e.jsxs(Je,{style:{padding:22,marginTop:16},children:[e.jsx(jt,{t:"Alcance del proyecto",s:"Descripcin del servicio para la propuesta"}),e.jsx("div",{style:{display:"flex",gap:6,marginBottom:10},children:(t.tipoProyecto==="OBRA"?[["obra_integral","Obra integral"],["obra_parcial","Obra parcial"],["remodelacion","Remodelacin"],["custom","Personalizado"]]:[["diseno_integral","Diseo integral"],["diseno_espacios","Diseo de espacios"],["consultoria","Consultora"],["custom","Personalizado"]]).map(([x,y])=>e.jsx("button",{onClick:()=>{i("alcanceTipo",x),x!=="custom"&&i("alcanceTexto",{obra_integral:`El presente presupuesto comprende la ejecucin integral de obra civil, acabados e instalaciones del proyecto, incluyendo:

 Obra civil: cimentacin, estructura, mampostera, cubierta
 Instalaciones: hidrosanitarias, elctricas, gas, red de datos
 Acabados: pisos, enchapes, pintura, carpintera metlica y en madera
 Equipamiento fijo: cocina, baos, closets

No incluye: mobiliario suelto, electrodomsticos, decoracin ni paisajismo exterior salvo que se indique expresamente.`,obra_parcial:`El presente presupuesto comprende la ejecucin parcial de las actividades indicadas en el borrador de costes, segn las especificaciones tcnicas acordadas.

El alcance se limita estrictamente a las partidas incluidas en el presupuesto detallado. Cualquier trabajo adicional ser objeto de una adenda o presupuesto complementario.`,remodelacion:`El presente presupuesto comprende los trabajos de remodelacin del espacio indicado, incluyendo:

 Demoliciones y retiro de escombros
 Modificaciones en instalaciones existentes
 Nuevos acabados segn diseo aprobado
 Carpintera y mobiliario fijo indicado

Se asume que la estructura existente se encuentra en buen estado. Cualquier refuerzo estructural requerido ser presupuestado aparte.`,diseno_integral:`El servicio de diseo integral comprende:

 Levantamiento y diagnstico del espacio existente
 Propuesta conceptual y desarrollo de concepto
 Diseo arquitectnico: plantas, cortes, fachadas
 Diseo interior: seleccin de materiales, mobiliario, iluminacin
 Planos tcnicos de detalle para ejecucin
 Especificaciones tcnicas y libro de acabados
 Acompaamiento en la seleccin de proveedores

Incluye hasta 2 rondas de ajustes por etapa de diseo.`,diseno_espacios:`El servicio de diseo de espacios comprende:

 Anlisis funcional del espacio
 Propuesta de distribucin y layout
 Seleccin de paleta de materiales y acabados
 Renders 3D fotorrealistas (3 vistas principales)
 Planos de mobiliario y especificaciones

No incluye planos tcnicos de instalaciones ni direccin de obra.`,consultoria:`El servicio de consultora incluye:

 Visita tcnica al sitio
 Informe de diagnstico y recomendaciones
 Estimacin presupuestaria de referencia
 Cronograma indicativo

No incluye desarrollo de diseo ni planos tcnicos.`}[x]||"")},style:{padding:"6px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${t.alcanceTipo===x?C.ink:C.border}`,borderRadius:4,background:t.alcanceTipo===x?C.ink:"#fff",color:t.alcanceTipo===x?"#fff":C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:y},x))}),e.jsx("textarea",{value:t.alcanceTexto||"",onChange:x=>i("alcanceTexto",x.target.value),rows:10,placeholder:"Describe el alcance del servicio...",style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:4,padding:"10px 12px",fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical",lineHeight:1.6,background:C.bg,color:C.ink}}),e.jsx("p",{style:{fontSize:10,color:C.inkLight,marginTop:6,margin:0},children:'Este texto aparecer en la seccin "Alcance" del documento de entrega al cliente.'})]})]})]})}function Vh({d:t,set:i,r:o}){const n=t.pais||"CO",a=(r,s)=>{s==="CO"?r==="PN"?(i("pctReteFuente",.02),i("pctReteICA",.009),i("pctReteIVA",.15)):(i("pctReteFuente",.035),i("pctReteICA",.009),i("pctReteIVA",.15)):(i("pctReteFuente",.15),i("pctReteICA",0),i("pctReteIVA",0))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fade",style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:20},children:[e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Pas y Tipo Fiscal",s:"Localizacin y mrgenes"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Pas / Mercado"}),e.jsx("div",{style:{display:"flex",gap:6},children:[{id:"CO",flag:"",label:"Colombia"},{id:"ES",flag:"",label:"Espaa"}].map(r=>e.jsxs("button",{onClick:()=>{i("pais",r.id),i("divisa",r.id==="CO"?"COP":"EUR"),i("tarifaIVA",r.id==="CO"?.19:.1)},style:{flex:1,padding:"7px 4px",border:`2px solid ${n===r.id?r.id==="CO"?"#111111":"#3B3B3B":"#E0E0E0"}`,borderRadius:6,background:n===r.id?r.id==="CO"?"#E8F4EE":"#F0F0F0":"transparent",cursor:"pointer",fontSize:12,fontWeight:n===r.id?700:400,color:n===r.id?r.id==="CO"?"#111111":"#3B3B3B":"#555",fontFamily:"'DM Sans',sans-serif"},children:[r.flag," ",r.label]},r.id))})]}),e.jsx(Sn,{lbl:"Tipo fiscal",val:t.tipoProyecto,on:r=>i("tipoProyecto",r.target.value),opts:["OBRA","DISEO"],note:"OBRA  IVA sobre utilidad  DISEO  IVA pleno"}),e.jsx(ot,{lbl:n==="CO"?"Tarifa IVA":"IVA (21%=general, 10%=obra, 4%=superred.)",type:"number",val:(t.tarifaIVA*100).toFixed(0),on:r=>i("tarifaIVA",+r.target.value/100),rt:"%",step:"1"}),t.pais==="CO"&&t.tipoProyecto==="OBRA"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:10,marginTop:6},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Modo de clculo (OBRA)"}),e.jsx("div",{style:{display:"flex",gap:0},children:[{id:"margen",lbl:"Margen"},{id:"aiu",lbl:"AIU"}].map(r=>e.jsx("button",{onClick:()=>i("modoCalcObra",r.id),style:{flex:1,padding:"8px 12px",fontSize:12,cursor:"pointer",fontWeight:600,border:"1px solid #111",fontFamily:"'DM Sans',sans-serif",borderRadius:r.id==="margen"?"6px 0 0 6px":"0 6px 6px 0",background:(t.modoCalcObra||"margen")===r.id?"#111":"#fff",color:(t.modoCalcObra||"margen")===r.id?"#fff":"#555"},children:r.lbl},r.id))})]}),(t.modoCalcObra||"margen")==="margen"?e.jsxs(e.Fragment,{children:[e.jsx(ot,{lbl:"Margen (%)",type:"number",val:(t.margen*100).toFixed(1),on:r=>i("margen",+r.target.value/100),rt:"%",step:"0.1",note:`PVP = CD / ${(1-t.margen).toFixed(2)} (ej: 30%  /0.70, 20%  /0.80)`}),e.jsx(ot,{lbl:"U declarada para IVA (%)",type:"number",val:((t.uDecl||.1)*100).toFixed(1),on:r=>i("uDecl",+r.target.value/100),rt:"%",step:"0.1",note:"Solo para calcular el IVA sobre utilidad. No afecta al PVP."}),e.jsxs("div",{style:{background:C.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:C.inkMid},children:["PVP = CD / ",e.jsx("strong",{children:(1-t.margen).toFixed(2)}),"  IVA = U ",e.jsxs("strong",{children:[((t.uDecl||.1)*100).toFixed(1),"%"]}),"  PVP  ",e.jsxs("strong",{children:[(t.tarifaIVA*100).toFixed(0),"%"]})," = ",Ye(o.IVA)]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{lbl:"A  Administracin (%)",type:"number",val:((t.aiuA||.08)*100).toFixed(1),on:r=>i("aiuA",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(ot,{lbl:"I  Imprevistos (%)",type:"number",val:((t.aiuI||.03)*100).toFixed(1),on:r=>i("aiuI",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(ot,{lbl:"U  Utilidad (%)",type:"number",val:((t.aiuU||.07)*100).toFixed(1),on:r=>i("aiuU",+r.target.value/100),rt:"%",step:"0.1"}),e.jsxs("div",{style:{background:C.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:C.inkMid},children:["AIU = ",e.jsxs("strong",{children:[(((t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))*100).toFixed(1),"%"]})," sobre CD  IVA = U ",e.jsxs("strong",{children:[((t.aiuU||.07)*100).toFixed(1),"%"]}),"  PVP  ",e.jsxs("strong",{children:[(t.tarifaIVA*100).toFixed(0),"%"]})," = ",Ye(o.IVA)]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{lbl:"Margen objetivo",type:"number",val:(t.margen*100).toFixed(1),on:r=>i("margen",+r.target.value/100),rt:"%",step:"0.1",note:"Para clculo del PVP"}),e.jsxs("div",{style:{background:C.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:C.inkMid},children:["IVA ",t.pais==="ES"?"ES":"DISEO"," = IVA pleno sobre ",e.jsx("strong",{children:"PVP completo"})," = ",Ye(o.IVA)]})]}),n==="ES"&&e.jsxs(e.Fragment,{children:[e.jsx(ot,{lbl:"% Gastos Generales (GG)",type:"number",val:((t.gg||.13)*100).toFixed(1),on:r=>i("gg",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(ot,{lbl:"% Beneficio Industrial (BI)",type:"number",val:((t.bi||.06)*100).toFixed(1),on:r=>i("bi",+r.target.value/100),rt:"%",step:"0.1"})]})]}),e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Gastos de Contratacin (GC)",s:"Coste directo  llevan margen"}),e.jsx(ot,{lbl:"% RCE",type:"number",val:(t.pctRCE*100).toFixed(2),on:r=>i("pctRCE",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% TRC",type:"number",val:(t.pctTRC*100).toFixed(2),on:r=>i("pctTRC",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% Adm. contratacin PH",type:"number",val:(t.pctAdm*100).toFixed(2),on:r=>i("pctAdm",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% ICA (Bogot)",type:"number",val:(t.pctICA*100).toFixed(2),on:r=>i("pctICA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsxs("div",{style:{background:C.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:C.inkMid,marginTop:6},children:["Total GC: ",e.jsx("strong",{children:it((t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0)+(t.pctICA||0))}),"  sobre PVP, llevan margen"]})]}),e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Retenciones",s:"Solo impactan flujo de caja"}),e.jsx(Sn,{lbl:"Tipo de cliente",val:t.tipoCliente,on:r=>{i("tipoCliente",r.target.value),a(r.target.value,n)},opts:["PN","EMPRESA"],note:n==="CO"?t.tipoCliente==="PN"?"PN  ReteFuente 2%  ReteICA 0.9%  ReteIVA 15%":"Empresa  ReteFuente 3.5%  ReteICA 0.9%  ReteIVA 15%":"ES  IRPF 15%"}),e.jsx(ot,{lbl:"% ReteFuente",type:"number",val:(t.pctReteFuente*100).toFixed(2),on:r=>i("pctReteFuente",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% ReteICA",type:"number",val:(t.pctReteICA*100).toFixed(2),on:r=>i("pctReteICA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% ReteIVA",type:"number",val:(t.pctReteIVA*100).toFixed(2),on:r=>i("pctReteIVA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsxs("div",{style:{background:C.accentBg,borderRadius:2,padding:"10px 14px",fontSize:11,color:C.inkMid,marginTop:8},children:["Total retenciones: ",e.jsx("strong",{children:it(t.pctReteFuente+t.pctReteICA+t.pctReteIVA)})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginTop:20},children:[e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Condiciones de pago",s:"Para el documento de entrega al cliente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:10},children:[["Anticipo / firma","condPct1",.3],["Avance 50%","condPct2",.3],["Entrega final","condPct3",.3],["Retencin (30 das)","condPct4",.1]].map(([r,s,g])=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:r}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"number",value:((t[s]??g)*100).toFixed(0),min:0,max:100,onChange:h=>i(s,+h.target.value/100),style:{width:60,border:`1px solid ${C.border}`,borderRadius:4,padding:"6px 8px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:C.bg,textAlign:"right"}}),e.jsx("span",{style:{fontSize:11,color:C.inkLight},children:"%"}),e.jsxs("span",{style:{fontSize:11,color:C.inkLight},children:["= ",Ye((t[s]??g)*(o.PVP||0))]})]})]},s))}),e.jsxs("div",{style:{fontSize:11,color:Math.abs((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1)-1)<.001?C.success:C.warning},children:["Total: ",(((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1))*100).toFixed(0),"%",Math.abs((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1)-1)>=.001?"  debe sumar 100%":" "]})]}),e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Gastos Financieros (GF)",s:"NO llevan margen  Editables"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6,marginBottom:10},children:[["PSE","PSE"],["Tarjeta","Tarjeta"],["Transferencia","Transf."],["Manual","Manual"]].map(([r,s])=>e.jsx("button",{onClick:()=>i("medioPago",r),style:{padding:"5px 6px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${t.medioPago===r?C.ink:C.border}`,borderRadius:4,background:t.medioPago===r?C.ink:"#fff",color:t.medioPago===r?"#fff":C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:s},r))}),t.medioPago==="PSE"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#999",marginBottom:3,textTransform:"uppercase",letterSpacing:.8},children:"Banco PSE"}),e.jsx("select",{value:t.bancoPSE||"custom",onChange:r=>{const s=r.target.value;i("bancoPSE",s);const g={bancolombia:.01,davivienda:.009,nequi:.012,bbva:.01};g[s]!==void 0&&i("pctComPSE",g[s])},style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:C.bg},children:[["bancolombia","Bancolombia (1.0%)"],["davivienda","Davivienda (0.9%)"],["nequi","Nequi (1.2%)"],["bbva","BBVA (1.0%)"],["custom","Otro"]].map(([r,s])=>e.jsx("option",{value:r,children:s},r))})]}),t.medioPago==="Tarjeta"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#999",marginBottom:3,textTransform:"uppercase",letterSpacing:.8},children:"Pasarela"}),e.jsx("select",{value:t.pasarelaTarjeta||"custom",onChange:r=>{const s=r.target.value;i("pasarelaTarjeta",s);const g={wompi:.029,getnet:.025,epayco:.032,mercadopago:.0349,redsys:.005};g[s]!==void 0&&i("pctComTarjeta",g[s])},style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:C.bg},children:(n==="CO"?[["wompi","Wompi (2.9%)"],["getnet","Getnet (2.5%)"],["epayco","ePayco (3.2%)"],["mercadopago","M.Pago (3.49%)"],["custom","Otra"]]:[["redsys","Redsys (0.5%)"],["custom","Otra"]]).map(([r,s])=>e.jsx("option",{value:r,children:s},r))})]}),e.jsx(ot,{lbl:t.medioPago==="PSE"?"Tasa PSE (% sin IVA)":t.medioPago==="Tarjeta"?"Tasa tarjeta (% sin IVA)":t.medioPago==="Manual"?"Comisin manual (%)":"Tasa transferencia (%)",type:"number",val:((t.medioPago==="PSE"?t.pctComPSE??.012:t.medioPago==="Tarjeta"?t.pctComTarjeta??.036:t.medioPago==="Manual"?t.pctComManual??0:t.pctComTransf??0)*100).toFixed(2),on:r=>{const s=+r.target.value/100;t.medioPago==="PSE"?i("pctComPSE",s):t.medioPago==="Tarjeta"?i("pctComTarjeta",s):t.medioPago==="Manual"?i("pctComManual",s):i("pctComTransf",s)},rt:"%",step:"0.01"}),t.medioPago!=="Manual"&&e.jsx(ot,{lbl:"IVA sobre comisin",type:"number",val:((t.ivaComision??.19)*100).toFixed(0),on:r=>i("ivaComision",+r.target.value/100),rt:"%",step:"1"}),e.jsx(Sn,{lbl:"Aplicar 41000",val:t.aplicar4x1000,on:r=>i("aplicar4x1000",r.target.value),opts:["SI","NO"]}),e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"8px 12px",fontSize:11,color:"#8C6A00",marginTop:6,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:["Total GF: ",e.jsx("strong",{children:it(o.f||0)})," = ",Ye(o.fin||0)]}),e.jsx("button",{onClick:()=>{i("pctComPSE",.012),i("pctComTarjeta",.036),i("pctComTransf",0),i("pctComManual",0),i("ivaComision",n==="CO"?.19:.21),i("aplicar4x1000","SI")},style:{background:"none",border:"1px solid #C9A254",borderRadius:3,padding:"2px 8px",fontSize:9,fontWeight:600,color:"#8C6A00",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Restablecer"})]})]})]}),e.jsxs(Je,{style:{padding:22,marginTop:20},children:[e.jsx(jt,{t:"Representantes Habitaris",s:"Para documentos de entrega y firma"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Firma del documento"}),e.jsxs("select",{value:t.firmaRepresentante||"David Parra Galera",onChange:r=>i("firmaRepresentante",r.target.value),style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:C.bg},children:[e.jsx("option",{value:"David Parra Galera",children:"David Parra Galera  Dir. Ejecutivo y Produccin"}),e.jsx("option",{value:"Ana Mara Daz Buitrago",children:"Ana Mara Daz Buitrago  Dir. Creativa y Diseo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Elaborado por"}),e.jsx("input",{value:t.elaboradoPor||"",onChange:r=>i("elaboradoPor",r.target.value),placeholder:"Nombre de quien elabor la oferta",style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:C.bg,marginBottom:6}}),e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Cargo elaborador"}),e.jsx("input",{value:t.cargoElaborador||"",onChange:r=>i("cargoElaborador",r.target.value),placeholder:"Cargo",style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:C.bg}})]})]})]}),(()=>{const r=t.pais||"CO";let s=0,g="Sin comisin";const h=t.ivaComision??.19;t.medioPago==="PSE"&&(s=(t.pctComPSE??.012)*(1+h),g=`PSE ${((t.pctComPSE??.012)*100).toFixed(2)}% + IVA ${(h*100).toFixed(0)}%`),t.medioPago==="Tarjeta"&&(s=(t.pctComTarjeta??.036)*(1+h),g=`Tarjeta ${((t.pctComTarjeta??.036)*100).toFixed(2)}% + IVA ${(h*100).toFixed(0)}%`),t.medioPago==="Transferencia"&&(s=(t.pctComTransf??0)*(1+h),g=s>0?`Transf. ${((t.pctComTransf??0)*100).toFixed(2)}% + IVA ${(h*100).toFixed(0)}%`:"Transferencia (sin comisin)"),t.medioPago==="Manual"&&(s=t.pctComManual??0,g=`Manual ${((t.pctComManual??0)*100).toFixed(2)}%`);const b=t.aplicar4x1000==="SI"?.004:0,j=s+b,k=(t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0),v=t.pctICA||0,m=k+v,f=t.modoCalcObra||"margen",p=t.margen||.25,d=f==="aiu"?1-m:1-p-m,c=1-j,l=d*c,x=l>0?f==="aiu"?(1+(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))/l:1/l:0,y={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:"1px solid #E0E0E0",fontSize:12},u={fontFamily:"'DM Mono',monospace",fontWeight:600,fontSize:12},S={fontSize:11,color:C.inkLight,marginLeft:12};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginTop:20},children:[e.jsxs(Je,{style:{padding:18},children:[e.jsx(jt,{t:"Gastos Financieros (GF)",s:"NO llevan margen  se suman al final"}),e.jsxs("div",{style:y,children:[e.jsxs("span",{children:["Comisin cobro ",e.jsx("span",{style:S,children:g})]}),e.jsx("span",{style:u,children:it(s)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Gravamen 41000"}),e.jsx("span",{style:u,children:it(b)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0 0",fontWeight:700,fontSize:13},children:[e.jsx("span",{children:"Total GF"}),e.jsx("span",{style:{...u,color:j>0?C.warning:C.inkLight},children:it(j)})]})]}),e.jsxs(Je,{style:{padding:18},children:[e.jsx(jt,{t:"Gastos de Contratacin (GC)",s:"Coste directo  LLEVA margen"}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Pliza RCE"}),e.jsx("span",{style:u,children:it(t.pctRCE||0)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Pliza TRC"}),e.jsx("span",{style:u,children:it(t.pctTRC||0)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Adm. contratacin"}),e.jsx("span",{style:u,children:it(t.pctAdm||0)})]}),e.jsxs("div",{style:y,children:[e.jsxs("span",{children:["ICA ",r==="CO"?"(Bogot)":"(municipal)"]}),e.jsx("span",{style:u,children:it(t.pctICA||0)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0 0",fontWeight:700,fontSize:13},children:[e.jsx("span",{children:"Total GC"}),e.jsx("span",{style:{...u,color:m>0?C.warning:C.inkLight},children:it(m)})]})]}),e.jsxs(Je,{style:{padding:18,gridColumn:"1 / -1",background:C.ink,borderRadius:6},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:12},children:[[f==="aiu"?"AIU":"Margen",it(f==="aiu"?(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07):p),"#aaa"],["GC (lleva M)",it(m),"#aaa"],["Den (1MGC)",d.toFixed(4),"#fff"],["GF (sin M)",it(j),"#aaa"],["Den (1GF)",c.toFixed(4),"#fff"]].map(([A,E,w])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:A}),e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:16,fontWeight:700,color:w},children:E})]},A))}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:14,paddingTop:12,borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:"Denominador total"}),e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:20,fontWeight:700,color:"#fff"},children:l.toFixed(4)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:"Coeficiente multiplicador"}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:20,fontWeight:700,color:"#fff"},children:[" ",x.toFixed(4)]})]})]}),e.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:"1px solid rgba(255,255,255,0.1)",fontSize:11,color:"rgba(255,255,255,0.5)"},children:[f==="aiu"?"Frmula AIU: PVP = CD  (1+AIU) / (1GC) / (1GF)":"Frmula: PVP = CD / (1MGC) / (1GF)","  un CD de 1.000.000 genera PVP = ",l>0?Ye(f==="aiu"?1e6*(1+(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))/l:1e6/l):""]})]})]})})()]})}function qh({d:t,set:i,r:o}){const n=t.pais||"CO",a=n==="CO"?"COP":"EUR",r=U=>U?new Intl.NumberFormat(n==="CO"?"es-CO":"es-ES",{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:0}).format(U):"",s=t.cronogramaActivos||[],g=U=>i("cronogramaActivos",typeof U=="function"?U(s):U),h=()=>{const U=t.borradorLineas||[],M=[];U.forEach(B=>{if(B.esCapitulo)s.find(H=>H.srcId===B.id)?M.push(s.find(H=>H.srcId===B.id)):M.push({id:kt(),srcId:B.id,nombre:B.nombre||B.descripcion||"Captulo",inicio:t.fechaInicio||Dt(),duracion:30,avance:0,nivel:0,responsable:"",color:"#111111",precioCD:0,esCapitulo:!0});else{const H=B.precioCD>0?qt(B.precioCD,B.cantidad||1,t):null;if(!s.find(ee=>ee.srcId===B.id))M.push({id:kt(),srcId:B.id,nombre:B.descripcion||"Actividad",inicio:t.fechaInicio||Dt(),duracion:15,avance:0,nivel:1,responsable:"",color:"#2A5F8C",pred:"",precioCD:B.precioCD||0,totalVenta:(H==null?void 0:H.totalVenta)||0,esCapitulo:!1});else{const ee=s.find(D=>D.srcId===B.id);M.push({...ee,precioCD:B.precioCD||0,totalVenta:(H==null?void 0:H.totalVenta)||0})}}}),s.filter(B=>!B.srcId).forEach(B=>M.push(B)),g(M)},b=()=>g([...s,{id:kt(),nombre:"Nueva actividad",inicio:t.fechaInicio||Dt(),duracion:7,avance:0,nivel:0,responsable:"",color:"#2A5F8C",pred:"",precioCD:0,esCapitulo:!1}]),j=()=>g([...s,{id:kt(),nombre:"NUEVO CAPTULO",inicio:t.fechaInicio||Dt(),duracion:30,avance:0,nivel:0,responsable:"",color:"#111111",precioCD:0,esCapitulo:!0}]),k=U=>g(s.filter(M=>M.id!==U)),v=(U,M,B)=>g(s.map(H=>H.id===U?{...H,[M]:B}:H)),m=U=>g(s.map(M=>M.id===U?{...M,nivel:Math.min(3,(M.nivel||0)+1)}:M)),f=U=>g(s.map(M=>M.id===U?{...M,nivel:Math.max(0,(M.nivel||0)-1)}:M)),p=(U,M)=>{const B=[...s],H=B.findIndex(ee=>ee.id===U);M===-1&&H>0&&([B[H-1],B[H]]=[B[H],B[H-1]]),M===1&&H<B.length-1&&([B[H],B[H+1]]=[B[H+1],B[H]]),g(B)},d=U=>{var G,ce;const M=[];for(let V=U+1;V<s.length&&!(s[V].esCapitulo||(s[V].nivel||0)===0);V++)M.push(s[V]);if(M.length===0)return{start:(G=s[U])==null?void 0:G.inicio,dur:((ce=s[U])==null?void 0:ce.duracion)||30,cd:0,venta:0,avance:0};const B=M.map(V=>new Date(V.inicio||Dt()).getTime()),H=M.map(V=>{const Y=new Date(V.inicio||Dt());return Y.setDate(Y.getDate()+(V.duracion||1)-1),Y.getTime()}),ee=Math.min(...B),D=Math.max(...H),O=Math.ceil((D-ee)/864e5)+1,le=M.reduce((V,Y)=>V+(Y.precioCD||0),0),re=M.reduce((V,Y)=>V+(Y.totalVenta||0),0),de=M.length>0?Math.round(M.reduce((V,Y)=>V+(Y.avance||0),0)/M.length):0;return{start:new Date(ee).toISOString().split("T")[0],dur:O,cd:le,venta:re,avance:de}},c=U=>{const M=new Date(U.inicio||Dt());return M.setDate(M.getDate()+(U.duracion||1)-1),M.toISOString().split("T")[0]},l=s.flatMap(U=>[new Date(U.inicio||Dt()).getTime(),new Date(c(U)).getTime()]),x=new Date(l.length?Math.min(...l):Date.now()),y=new Date(l.length?Math.max(...l):Date.now()+90*864e5),u=Math.max(30,Math.ceil((y-x)/864e5)+14),S=4,A=U=>Math.max(0,Math.ceil((new Date(U||Dt())-x)/864e5)),E=[];for(let U=0;U<Math.ceil(u/7);U++){const M=new Date(x);M.setDate(M.getDate()+U*7),E.push(M)}const[w,_]=F.useState(!1),[z,T]=F.useState(50),[L,Z]=F.useState(!1),K=s.filter(U=>!U.esCapitulo).reduce((U,M)=>U+(M.precioCD||0),0),P=s.filter(U=>!U.esCapitulo).reduce((U,M)=>U+(M.totalVenta||0),0),te=()=>{const U=window.open("","_blank"),M=t.fechaInicio?new Date(t.fechaInicio).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"",B=t.fechaEntrega?new Date(t.fechaEntrega).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"",H=s.length>0?u:"";let ee=`<html><head><title>Cronograma - ${t.codigoOferta||""}</title>
    <style>@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    @page{size:landscape;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'DM Sans',sans-serif;color:#111;font-size:10px;padding:20px}
    .header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;padding-bottom:12px;border-bottom:3px solid #111}
    .logo{font-size:16px;font-weight:800;letter-spacing:3px}
    .logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}
    .project-info{text-align:right}
    .project-title{font-size:14px;font-weight:700}
    .project-meta{font-size:9px;color:#555;margin-top:2px}
    .kpis{display:flex;gap:16px;margin-bottom:14px;padding:8px 0;border-bottom:1px solid #E0E0E0}
    .kpi{font-size:9px;color:#555}.kpi strong{color:#111;font-size:11px}
    table{width:100%;border-collapse:collapse;margin-bottom:8px}
    th{background:#F5F4F1;padding:4px 6px;font-size:7px;text-transform:uppercase;letter-spacing:0.5px;font-weight:700;color:#888;text-align:left;border-bottom:2px solid #E0E0E0}
    td{padding:4px 6px;border-bottom:1px solid #F5F5F5;font-size:9px}
    .cap td{font-weight:700;background:#F5F4F1;border-bottom:2px solid #E0E0E0;font-size:10px}
    .mono{font-family:'DM Mono',monospace}.green{color:#111111}.blue{color:#3B3B3B}
    .bar-row{height:18px;position:relative;margin:1px 0}
    .bar{height:14px;border-radius:3px;position:absolute;top:2px;min-width:4px}
    .avance{height:14px;border-radius:3px;position:absolute;top:2px;opacity:0.3}
    .gantt-header{font-size:7px;color:#888;border-bottom:1px solid #E0E0E0;padding:2px 0}
    .footer{margin-top:12px;padding-top:8px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:8px;color:#888}
    .totrow td{font-weight:700;border-top:2px solid #111;padding-top:6px}
    @media print{body{padding:0}}
    </style></head><body>`;ee+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',ee+=`<div class="project-info"><div class="project-title">${t.proyecto||t.codigoOferta||"Proyecto"}</div>`,ee+=`<div class="project-meta">${t.codigoOferta||""}  Rev. ${t.revision||"R00"}  ${t.cliente||"Sin cliente"}</div>`,ee+=`<div class="project-meta">${t.ubicacion||""}</div></div></div>`,ee+='<div class="kpis">',ee+=`<div class="kpi">Inicio: <strong>${M}</strong></div>`,ee+=`<div class="kpi">Entrega: <strong>${B}</strong></div>`,ee+=`<div class="kpi">Duracin: <strong>${H} das</strong></div>`,ee+=`<div class="kpi">Actividades: <strong>${s.filter(O=>!O.esCapitulo).length}</strong></div>`,ee+=`<div class="kpi">CD Total: <strong class="mono">${r(K)}</strong></div>`,ee+=`<div class="kpi">Venta Total: <strong class="mono green">${r(P)}</strong></div>`,ee+="</div>",ee+='<table><thead><tr><th>#</th><th>WBS</th><th style="min-width:140px">Actividad</th><th>Das</th><th>Inicio</th><th>Fin</th><th>Avance</th><th>Pred</th><th>CD</th><th>Venta</th><th>Responsable</th></tr></thead><tbody>';let D=[0];s.forEach((O,le)=>{const re=O.esCapitulo,de=O.nivel||0;D=D.slice(0,de+1),D[de]=(D[de]||0)+1;const G=D.filter((be,I)=>I<=de).join("."),ce=de*16,V=re?d(le):null,Y=re&&V?V.dur:O.duracion||0,W=(()=>{const be=new Date(O.inicio||Dt());return be.setDate(be.getDate()+Y-1),be.toLocaleDateString("es-CO")})(),se=new Date(re&&(V!=null&&V.start)?V.start:O.inicio||Dt()).toLocaleDateString("es-CO"),ge=re&&V?V.avance:O.avance||0,ue=re&&V?V.cd:O.precioCD||0,ye=re&&V?V.venta:O.totalVenta||0;ee+=`<tr class="${re?"cap":""}">`,ee+=`<td>${le+1}</td><td>${G}</td>`,ee+=`<td style="padding-left:${6+ce}px">${O.nombre||""}</td>`,ee+=`<td class="mono">${Y}</td><td>${se}</td><td>${W}</td>`,ee+=`<td>${ge}%</td><td>${O.pred||""}</td>`,ee+=`<td class="mono">${ue>0?r(ue):""}</td>`,ee+=`<td class="mono green">${ye>0?r(ye):""}</td>`,ee+=`<td>${O.responsable||""}</td></tr>`}),ee+='<tr class="totrow"><td colspan="8"><strong>TOTAL PROYECTO</strong></td>',ee+=`<td class="mono"><strong>${r(K)}</strong></td>`,ee+=`<td class="mono green"><strong>${r(P)}</strong></td><td></td></tr>`,ee+="</tbody></table>",ee+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Cronograma valorado</span>`,ee+=`<span>Generado: ${new Date().toLocaleDateString("es-CO")}  Pgina 1</span></div>`,ee+="</body></html>",U.document.write(ee),U.document.close(),setTimeout(()=>U.print(),400)},he=()=>{var de;const U=t.borradorLineas||[],M=t.pais||"CO",B=((de=Fo[M])==null?void 0:de.categorias)||[];let H=ka;try{const G=Ee.get("hab:crm:equipos");G!=null&&G.value&&(H=JSON.parse(G.value))}catch{}const ee={},D={},O={},le={},re=(G,ce)=>{var V;return((V=ce==null?void 0:ce.recursosAsignados)==null?void 0:V.length)>0?ce.recursosAsignados:fn[G]||[]};return s.filter(G=>!G.esCapitulo).forEach(G=>{const ce=U.find(ye=>ye.id===G.srcId||ye.descripcion===G.nombre);if(!ce)return;const V=ce.apu||{},Y=G.inicio||t.fechaInicio||Dt(),W=(()=>{const ye=new Date(Y);return ye.setDate(ye.getDate()+(G.duracion||1)-1),ye.toISOString().split("T")[0]})(),se=t.ofertaEquipos||[];(V.equiposUsados||[]).forEach(ye=>{const be=H.find(R=>R.id===ye.eqId);if(!be)return;const N=(ye.rendimientoOverride??be.rendimiento)*(ce.cantidad||1),q=se.find(R=>R.nombre===be.nombre);((q==null?void 0:q.herrAsignadas)||Us[be.id]||[]).forEach(R=>{const ie=No(R);if(!ie)return;const fe=R;D[fe]||(D[fe]={codigo:R,nombre:ie.nombre,familia:ie.familia,unidad:ie.unidad||"ud",cantTotal:0,precioRef:ie.precioRef||0,actividades:[]}),D[fe].cantTotal=Math.max(D[fe].cantTotal,1),D[fe].actividades.push({nombre:G.nombre,inicio:Y,fin:W,cant:1})}),be.cargos.forEach(R=>{var dt;const ie=B.find(Ze=>Ze.id===R.catId);if(!ie)return;const fe=N*(R.cantidad||1),Me=lo(R.catId,M);ee[R.catId]||(ee[R.catId]={label:ie.label,catId:R.catId,horas:0,costo:0,actividades:[],personas:0}),ee[R.catId].horas+=fe,ee[R.catId].costo+=fe*Me,ee[R.catId].actividades.push({nombre:G.nombre,equipo:be.nombre,inicio:Y,fin:W,horas:fe,cant:R.cantidad,dias:G.duracion||0});const Le=(dt=q==null?void 0:q.cargos)==null?void 0:dt.find(Ze=>Ze.cargoId===R.catId);re(R.catId,Le).forEach(Ze=>{const mt=No(Ze);if(mt){le[Ze]||(le[Ze]={codigo:Ze,nombre:mt.nombre,familia:mt.familia,unidad:mt.unidad,precioRef:mt.precioRef||0,personas:new Set,actividades:[],cantTotal:0});for(let Yt=0;Yt<(R.cantidad||1);Yt++)le[Ze].personas.add(`${R.catId}_${G.id}_${Yt}`);le[Ze].actividades.push({nombre:G.nombre,inicio:Y,fin:W,cant:R.cantidad||1})}})})}),(V.mo||[]).forEach(ye=>{const be=B.find(q=>q.id===ye.catId);if(!be)return;const I=lo(ye.catId,M);ee[ye.catId]||(ee[ye.catId]={label:be.label,catId:ye.catId,horas:0,costo:0,actividades:[],personas:0}),ee[ye.catId].horas+=ye.horas||0,ee[ye.catId].costo+=(ye.horas||0)*I,ee[ye.catId].actividades.push({nombre:G.nombre,equipo:"MO directa",inicio:Y,fin:W,horas:ye.horas||0,cant:1,dias:G.duracion||0}),(fn[ye.catId]||[]).forEach(q=>{const J=No(q);J&&(le[q]||(le[q]={codigo:q,nombre:J.nombre,familia:J.familia,unidad:J.unidad,precioRef:J.precioRef||0,personas:new Set,actividades:[],cantTotal:0}),le[q].personas.add(`${ye.catId}_${G.id}_mo`),le[q].actividades.push({nombre:G.nombre,inicio:Y,fin:W,cant:1}))})}),(V.equipos||[]).forEach(ye=>{const be=ye.descripcion||ye.nombre||"Equipo";O[be]||(O[be]={codigo:"",nombre:be,familia:"equipo_obra",unidad:ye.unidad||"ud",cantTotal:0,precioRef:ye.precio||0,actividades:[]}),O[be].cantTotal=Math.max(O[be].cantTotal,ye.cantidad||1),O[be].actividades.push({nombre:G.nombre,inicio:Y,fin:W,cant:ye.cantidad||1})})}),Object.values(ee).forEach(G=>{const ce={};G.actividades.forEach(V=>{const Y=new Date(V.inicio);for(let W=0;W<V.dias;W++){const se=new Date(Y.getTime()+W*864e5).toISOString().split("T")[0];ce[se]=(ce[se]||0)+(V.cant||1)}}),G.personas=Math.max(1,...Object.values(ce)),G.inicioMasTemprano=G.actividades.reduce((V,Y)=>Y.inicio<V?Y.inicio:V,"9999"),G.finMasTardio=G.actividades.reduce((V,Y)=>Y.fin>V?Y.fin:V,"0000")}),Object.values(le).forEach(G=>{G.cantTotal=G.personas.size,G.inicioNecesario=G.actividades.reduce((ce,V)=>V.inicio<ce?V.inicio:ce,"9999"),G.costoTotal=G.cantTotal*(G.precioRef||0)}),Object.values(D).forEach(G=>{G.inicioNecesario=G.actividades.reduce((ce,V)=>V.inicio<ce?V.inicio:ce,"9999")}),Object.values(O).forEach(G=>{G.inicioNecesario=G.actividades.reduce((ce,V)=>V.inicio<ce?V.inicio:ce,"9999")}),{personal:Object.values(ee).sort((G,ce)=>ce.horas-G.horas),herramientas:Object.values(D).sort((G,ce)=>G.inicioNecesario.localeCompare(ce.inicioNecesario)),equiposObra:Object.values(O).sort((G,ce)=>G.inicioNecesario.localeCompare(ce.inicioNecesario)),epps:Object.values(le).sort((G,ce)=>ce.cantTotal-G.cantTotal)}},Q=U=>U&&U!=="9999"?new Date(U).toLocaleDateString("es-CO",{day:"numeric",month:"short",year:"numeric"}):"",Se=U=>{const M=window.open("","_blank"),{personal:B,herramientas:H,equiposObra:ee,epps:D}=U,O=B.reduce((ce,V)=>ce+V.horas,0),le=B.reduce((ce,V)=>ce+V.costo,0),re=B.reduce((ce,V)=>ce+V.personas,0);t.pais;const de="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:10px;border-bottom:3px solid #111}.logo{font-size:16px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:12px;margin:14px 0 6px;padding:5px 0;border-bottom:2px solid #111}h3{font-size:10px;margin:8px 0 4px}.kpis{display:flex;gap:16px;margin-bottom:12px;font-size:9px;color:#555}.kpi strong{color:#111}table{width:100%;border-collapse:collapse;margin-bottom:10px}th{background:#F5F4F1;padding:3px 5px;font-size:7px;text-transform:uppercase;letter-spacing:.4px;font-weight:700;color:#888;text-align:left;border-bottom:2px solid #E0E0E0}td{padding:3px 5px;border-bottom:1px solid #F5F5F5;font-size:8px}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.blue{color:#3B3B3B}.bold{font-weight:700}.totrow td{font-weight:700;border-top:2px solid #111}.badge{background:#F0F0F0;color:#3B3B3B;padding:2px 8px;border-radius:3px;font-weight:700;font-size:10px}.footer{margin-top:12px;padding-top:6px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}@media print{body{padding:8px}}";let G=`<html><head><title>Plan de Recursos - ${t.codigoOferta||""}</title><style>${de}</style></head><body>`;G+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',G+='<div style="text-align:right"><div style="font-size:14px;font-weight:700">Plan de Recursos y Contratacin</div>',G+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,G+=`<div class="kpis"><div class="kpi">Total personas: <strong class="badge">${re}</strong></div>`,G+=`<div class="kpi">Horas MO: <strong class="mono">${O.toFixed(0)} h</strong></div>`,G+=`<div class="kpi">Costo MO: <strong class="mono green">${r(le)}</strong></div>`,G+=`<div class="kpi">EPPs: <strong>${D.length} tems</strong></div>`,G+=`<div class="kpi">Herramientas: <strong>${H.length+ee.length} tems</strong></div></div>`,G+="<h2> 1. Personal  Contratacin</h2>",G+="<table><tr><th>Categora</th><th>Personas</th><th>Horas</th><th>Costo</th><th>Ingreso estimado</th><th>Hasta</th><th>Actividades</th></tr>",B.forEach(ce=>{G+=`<tr><td class="bold">${ce.label}</td><td class="badge mono">${ce.personas}</td>`,G+=`<td class="mono">${ce.horas.toFixed(0)}h</td><td class="mono green">${r(ce.costo)}</td>`,G+=`<td class="mono">${Q(ce.inicioMasTemprano)}</td><td class="mono">${Q(ce.finMasTardio)}</td>`,G+=`<td>${ce.actividades.map(V=>V.nombre).filter((V,Y,W)=>W.indexOf(V)===Y).join(", ")}</td></tr>`}),G+=`<tr class="totrow"><td>TOTAL</td><td class="badge mono">${re}</td><td class="mono">${O.toFixed(0)}h</td><td class="mono green">${r(le)}</td><td colspan="3"></td></tr></table>`,G+="<h2> 2. Elementos de Proteccin Personal (EPP)</h2>",G+="<table><tr><th>Cdigo</th><th>Elemento</th><th>Cant.</th><th>Precio ref.</th><th>Subtotal</th><th>Necesario desde</th></tr>",D.forEach(ce=>{G+=`<tr><td class="mono bold">${ce.codigo||""}</td><td>${ce.nombre}</td><td class="mono">${ce.cantTotal}</td><td class="mono">${r(ce.precioRef||0)}</td><td class="mono green bold">${r(ce.costoTotal||0)}</td><td class="mono">${Q(ce.inicioNecesario)}</td></tr>`}),G+=`<tr class="totrow"><td colspan="2">TOTAL EPPs</td><td class="mono">${D.reduce((ce,V)=>ce+V.cantTotal,0)}</td><td></td><td class="mono green bold">${r(D.reduce((ce,V)=>ce+(V.costoTotal||0),0))}</td><td></td></tr></table>`,G+="<h2> 3. Herramientas y Equipos</h2>",G+="<table><tr><th>Cdigo</th><th>Recurso</th><th>Tipo</th><th>Cant.</th><th>Precio ref.</th><th>Necesario desde</th><th>Actividades</th></tr>",[...H,...ee].forEach(ce=>{G+=`<tr><td class="mono bold">${ce.codigo||""}</td><td>${ce.nombre}</td><td>${Xn[ce.familia]||""}</td><td class="mono">${ce.cantTotal}</td>`,G+=`<td class="mono">${r(ce.precioRef||0)}</td><td class="mono">${Q(ce.inicioNecesario)}</td>`,G+=`<td>${ce.actividades.map(V=>V.nombre).filter((V,Y,W)=>W.indexOf(V)===Y).join(", ")}</td></tr>`}),G+="</table>",G+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Plan de recursos</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,G+="</body></html>",M.document.write(G),M.document.close(),setTimeout(()=>M.print(),400)},ae={border:`1px solid ${C.border}`,borderRadius:3,padding:"3px 5px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:C.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Cronograma valorado"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[s.length," actividades  ",r(K)," CD  ",r(P)," venta"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[e.jsxs(ut,{sm:!0,v:"sec",on:h,children:[e.jsx(Eo,{size:11})," Importar borrador"]}),e.jsxs(ut,{sm:!0,v:"sec",on:j,children:[e.jsx(Oe,{size:11})," Captulo"]}),e.jsxs(ut,{sm:!0,on:b,children:[e.jsx(Oe,{size:11})," Actividad"]}),e.jsx("button",{onClick:()=>_(!w),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${w?C.accent:C.border}`,borderRadius:4,background:w?"#E6F4EC":"#fff",color:w?"#111111":C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:w?" Valorado":" Valorado"}),e.jsxs("button",{onClick:te,style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:"none",borderRadius:4,background:"#111",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:11})," Vista PDF"]}),e.jsxs("button",{onClick:()=>Z(!0),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:"none",borderRadius:4,background:"#3B3B3B",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(sr,{size:11})," Recursos"]})]})]}),s.length===0?e.jsxs(Je,{style:{padding:40,textAlign:"center"},children:[e.jsx(Ks,{size:32,style:{color:C.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:C.inkLight,fontSize:13,margin:0},children:"Sin actividades. Importa desde el borrador o aade manualmente."})]}):e.jsx(Je,{style:{padding:0,overflow:"hidden"},children:e.jsxs("div",{style:{display:"flex",minHeight:200},children:[e.jsx("div",{style:{width:`${z}%`,minWidth:400,flexShrink:0,borderRight:`2px solid ${C.border}`,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{width:30,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"#"}),e.jsx("th",{style:{width:34,padding:"6px 2px",fontSize:8,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"WBS"}),e.jsx("th",{style:{padding:"6px 8px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`,textAlign:"left",minWidth:160},children:"ACTIVIDAD"}),e.jsx("th",{style:{width:50,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"DAS"}),e.jsx("th",{style:{width:95,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"INICIO"}),e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"FIN"}),e.jsx("th",{style:{width:50,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"%"}),e.jsx("th",{style:{width:60,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"PRED"}),w&&e.jsxs(e.Fragment,{children:[e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"CD"}),e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${C.border}`},children:"VENTA"})]}),e.jsx("th",{style:{width:64,padding:"6px 4px",borderBottom:`2px solid ${C.border}`}})]})}),e.jsx("tbody",{children:s.map((U,M)=>{const B=U.nivel||0,H=U.esCapitulo,ee=H?d(M):null,D=H&&ee?ee.dur:U.duracion,O=H&&ee?ee.avance:U.avance||0;return e.jsxs("tr",{style:{background:H?"#F5F4F1":M%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${H?C.border:"#F5F5F5"}`,height:H?32:28},children:[e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",fontSize:9,color:"#BBB"},children:M+1}),e.jsx("td",{style:{padding:"2px 2px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:1,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>f(U.id),title:"Quitar sangra",style:{background:"none",border:"none",cursor:"pointer",color:B>0?"#888":"#DDD",padding:0,fontSize:10,lineHeight:1},children:""}),e.jsx("button",{onClick:()=>m(U.id),title:"Aadir sangra",style:{background:"none",border:"none",cursor:"pointer",color:B<3?"#888":"#DDD",padding:0,fontSize:10,lineHeight:1},children:""})]})}),e.jsx("td",{style:{padding:"2px 6px"},children:e.jsxs("div",{style:{paddingLeft:B*16,display:"flex",alignItems:"center",gap:4},children:[H&&e.jsx("span",{style:{background:"#111111",color:"#fff",padding:"0px 4px",borderRadius:2,fontSize:7,fontWeight:700,lineHeight:"14px"},children:""}),e.jsx("input",{value:U.nombre||"",onChange:le=>v(U.id,"nombre",le.target.value),style:{border:"none",background:"transparent",outline:"none",width:"100%",fontWeight:H?700:400,fontSize:H?11:10.5,color:C.ink,textTransform:H?"uppercase":"none",padding:"1px 0"}})]})}),e.jsx("td",{style:{padding:"2px 3px"},children:H?e.jsx("span",{style:{fontSize:10,color:C.inkMid,textAlign:"center",display:"block"},children:D}):e.jsx("input",{type:"number",value:U.duracion||"",min:1,onChange:le=>v(U.id,"duracion",+le.target.value),style:{...ae,width:40,textAlign:"center",padding:"2px 3px"}})}),e.jsx("td",{style:{padding:"2px 3px"},children:H?e.jsx("span",{style:{fontSize:9,color:C.inkMid},children:(ee==null?void 0:ee.start)||""}):e.jsx("input",{type:"date",value:U.inicio||"",onChange:le=>v(U.id,"inicio",le.target.value),style:{...ae,width:90,fontSize:10,padding:"2px 3px"}})}),e.jsx("td",{style:{padding:"2px 4px",fontSize:9,color:C.inkMid,textAlign:"center"},children:c(U)}),e.jsx("td",{style:{padding:"2px 3px",textAlign:"center"},children:e.jsxs("span",{style:{fontSize:9,fontWeight:O>0?600:400,color:O>=100?"#111111":O>0?"#3B3B3B":"#CCC"},children:[O,"%"]})}),e.jsx("td",{style:{padding:"2px 3px"},children:!H&&e.jsx("input",{value:U.pred||"",placeholder:"",onChange:le=>v(U.id,"pred",le.target.value),title:"Predecesor: n de fila (ej: 3, 5)",style:{...ae,width:36,textAlign:"center",fontSize:9,padding:"2px 2px"}})}),w&&e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{padding:"2px 4px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:H?700:400,color:C.inkMid},children:H?r((ee==null?void 0:ee.cd)||0):U.precioCD>0?r(U.precioCD):""}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:H?700:400,color:H?"#111111":"#3B3B3B"},children:H?r((ee==null?void 0:ee.venta)||0):U.totalVenta>0?r(U.totalVenta):""})]}),e.jsxs("td",{style:{padding:"2px 2px",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>p(U.id,-1),style:{background:"none",border:"none",cursor:"pointer",color:"#CCC",padding:1,fontSize:9},children:""}),e.jsx("button",{onClick:()=>p(U.id,1),style:{background:"none",border:"none",cursor:"pointer",color:"#CCC",padding:1,fontSize:9},children:""}),e.jsx("button",{onClick:()=>k(U.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx(He,{size:10})})]})]},U.id)})}),w&&e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:"#E6F4EC",borderTop:"2px solid #111111"},children:[e.jsx("td",{colSpan:8,style:{padding:"6px 8px",fontSize:10,fontWeight:700,color:"#111111"},children:"TOTAL PROYECTO"}),e.jsx("td",{style:{padding:"6px 4px",textAlign:"right",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace",color:"#111111"},children:r(K)}),e.jsx("td",{style:{padding:"6px 4px",textAlign:"right",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace",color:"#111111"},children:r(P)}),e.jsx("td",{})]})})]})}),e.jsxs("div",{style:{flex:1,overflowX:"auto",overflowY:"hidden",background:"#FFFFFF"},children:[e.jsx("div",{style:{display:"flex",borderBottom:`2px solid ${C.border}`,background:"#EDEBE7",height:28,position:"sticky",top:0},children:E.map((U,M)=>e.jsx("div",{style:{width:7*S,minWidth:7*S,flexShrink:0,fontSize:8,color:"#888",textAlign:"center",borderRight:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},children:U.toLocaleDateString("es",{month:"short",day:"numeric"})},M))}),s.map((U,M)=>{const B=U.esCapitulo,H=B?d(M):null,ee=B&&H?H.start:U.inicio,D=B&&H?H.dur:Math.max(1,U.duracion||1),O=B&&H?H.avance:U.avance||0,le=A(ee),re=O/100,de=le*S,G=Math.max(D*S,4),ce=B?32:28,V=B?8:18,Y=(ce-V)/2,W=U.pred?parseInt(U.pred)-1:-1,se=W>=0&&W<s.length?s[W]:null;return e.jsxs("div",{style:{position:"relative",height:ce,borderBottom:`1px solid ${B?"#E0E0E0":"#F5F5F5"}`},children:[M===0&&(()=>{const ge=A(Dt())*S;return ge>0?e.jsx("div",{style:{position:"absolute",left:ge,top:0,bottom:0,width:1,background:"#E44",zIndex:2,opacity:.5}}):null})(),e.jsx("div",{style:{position:"absolute",left:de,top:Y,width:G,height:V,background:B?"#999":U.color||"#2A5F8C",borderRadius:B?"2px 2px 0 0":3,opacity:.2}}),e.jsx("div",{style:{position:"absolute",left:de,top:Y,width:G*re,height:V,background:B?"#555":U.color||"#2A5F8C",borderRadius:B?"2px 2px 0 0":3}}),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",left:de-3,top:Y+V-2,width:6,height:6,background:"#555",transform:"rotate(45deg)"}}),e.jsx("div",{style:{position:"absolute",left:de+G-3,top:Y+V-2,width:6,height:6,background:"#555",transform:"rotate(45deg)"}})]}),!B&&G>30&&e.jsx("span",{style:{position:"absolute",left:de+4,top:Y+1,fontSize:8,color:"#fff",fontWeight:600,lineHeight:V+"px",textShadow:"0 1px 2px rgba(0,0,0,0.5)",pointerEvents:"none",maxWidth:G-8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:O>0?`${O}%`:""}),se&&(()=>{const ge=(A(se.inicio)+Math.max(1,se.duracion||1))*S;return ge<de?e.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:ce,pointerEvents:"none",overflow:"visible"},children:[e.jsx("line",{x1:ge,y1:ce/2,x2:de,y2:ce/2,stroke:"#E44",strokeWidth:1,strokeDasharray:"3,2",markerEnd:"url(#arrow)"}),e.jsx("defs",{children:e.jsx("marker",{id:"arrow",markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto",children:e.jsx("path",{d:"M0,0 L6,2 L0,4",fill:"#E44"})})})]}):null})(),!B&&e.jsx("input",{type:"range",min:0,max:100,value:O,onChange:ge=>v(U.id,"avance",+ge.target.value),title:`Avance: ${O}%`,style:{position:"absolute",left:de,top:Y,width:G,height:V,opacity:0,cursor:"pointer"}})]},U.id)})]})]})}),L&&(()=>{const U=he(),{personal:M,herramientas:B,equiposObra:H,epps:ee}=U,D=M.reduce((V,Y)=>V+Y.horas,0),O=M.reduce((V,Y)=>V+Y.costo,0),le=M.reduce((V,Y)=>V+Y.personas,0);t.pais;const re=M.length>0||B.length>0||H.length>0,de=()=>{let V=`\uFEFFSeccin;Cdigo;Recurso;Familia;Cantidad;Horas;Costo;Precio ref.;Necesario desde;Hasta;Actividades
`;M.forEach(se=>{V+=`Personal;;${se.label};;${se.personas};${se.horas.toFixed(0)};${se.costo.toFixed(0)};;${se.inicioMasTemprano||""};${se.finMasTardio||""};${se.actividades.map(ge=>ge.nombre).filter((ge,ue,ye)=>ye.indexOf(ge)===ue).join(" | ")}
`}),ee.forEach(se=>{V+=`EPP;${se.codigo||""};${se.nombre};${Xn[se.familia]||""};${se.cantTotal};;${se.costoTotal||0};${se.precioRef||0};${se.inicioNecesario||""};;${se.actividades.map(ge=>ge.nombre).filter((ge,ue,ye)=>ye.indexOf(ge)===ue).join(" | ")}
`}),[...B,...H].forEach(se=>{V+=`Herramienta;${se.codigo||""};${se.nombre};${Xn[se.familia]||""};${se.cantTotal};;;${se.precioRef||0};${se.inicioNecesario||""};;${se.actividades.map(ge=>ge.nombre).filter((ge,ue,ye)=>ye.indexOf(ge)===ue).join(" | ")}
`});const Y=new Blob([V],{type:"text/csv;charset=utf-8"}),W=document.createElement("a");W.href=URL.createObjectURL(Y),W.download=`Recursos_${t.codigoOferta||"proyecto"}.csv`,W.click()},G={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"2px solid #E0E0E0",textAlign:"left"},ce={...G,textAlign:"right"};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:16},onClick:()=>Z(!1),children:e.jsxs("div",{onClick:V=>V.stopPropagation(),style:{background:"#fff",borderRadius:10,width:"95%",maxWidth:1050,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.25)"},children:[e.jsxs("div",{style:{padding:"14px 22px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:0},children:" Plan de Recursos y Contratacin"}),e.jsxs("p",{style:{fontSize:10,color:"#888",margin:"2px 0 0"},children:["Desde APUs + cronograma  ",t.codigoOferta||"","  ",t.cliente||""]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("button",{onClick:de,style:{padding:"5px 12px",background:"#fff",border:"1px solid #E0E0E0",borderRadius:4,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Eo,{size:11})," CSV"]}),e.jsxs("button",{onClick:()=>Se(U),style:{padding:"5px 12px",background:"#111",color:"#fff",border:"none",borderRadius:4,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:11})," PDF"]}),e.jsx("button",{onClick:()=>Z(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx($t,{size:18})})]})]}),e.jsxs("div",{style:{padding:"8px 22px",background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",display:"flex",gap:18,flexWrap:"wrap",flexShrink:0,fontSize:10,color:"#555"},children:[e.jsxs("span",{children:[" Personas: ",e.jsx("strong",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 8px",borderRadius:3,fontFamily:"'DM Mono',monospace"},children:le})]}),e.jsxs("span",{children:[" Horas MO: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:[D.toFixed(0),"h"]})]}),e.jsxs("span",{children:[" Costo MO: ",e.jsx("strong",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:r(O)})]}),e.jsxs("span",{children:[" EPPs: ",e.jsxs("strong",{children:[ee.length," tems"]})]}),e.jsxs("span",{children:[" Herr./Equipos: ",e.jsx("strong",{children:B.length+H.length})]})]}),e.jsx("div",{style:{overflowY:"auto",flex:1,padding:"0 22px 22px"},children:re?e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 1. Personal  Contratacin y fechas de ingreso"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:G,children:"Categora"}),e.jsx("th",{style:ce,children:"Personas"}),e.jsx("th",{style:ce,children:"Horas"}),e.jsx("th",{style:ce,children:"Costo"}),e.jsx("th",{style:G,children:"Ingreso estimado"}),e.jsx("th",{style:G,children:"Hasta"}),e.jsx("th",{style:G,children:"Actividades"})]})}),e.jsxs("tbody",{children:[M.map(V=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"7px 8px",fontWeight:600},children:V.label}),e.jsx("td",{style:{padding:"7px 8px",textAlign:"right"},children:e.jsx("span",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 10px",borderRadius:4,fontWeight:700,fontFamily:"'DM Mono',monospace",fontSize:13},children:V.personas})}),e.jsxs("td",{style:{padding:"7px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[V.horas.toFixed(0),"h"]}),e.jsx("td",{style:{padding:"7px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",color:"#111111",fontWeight:600},children:r(V.costo)}),e.jsx("td",{style:{padding:"7px 8px"},children:e.jsxs("span",{style:{background:"#E8F4EE",color:"#111111",padding:"2px 8px",borderRadius:3,fontWeight:600,fontSize:10},children:[" ",Q(V.inicioMasTemprano)]})}),e.jsx("td",{style:{padding:"7px 8px",fontSize:10,color:"#888"},children:Q(V.finMasTardio)}),e.jsx("td",{style:{padding:"7px 8px",fontSize:9,color:"#888",maxWidth:180},children:V.actividades.map(Y=>Y.nombre).filter((Y,W,se)=>se.indexOf(Y)===W).join(", ")})]},V.catId)),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsx("td",{style:{padding:"8px",fontWeight:700,fontSize:12},children:"TOTAL"}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:e.jsx("span",{style:{background:"#111",color:"#fff",padding:"3px 12px",borderRadius:4,fontWeight:700,fontFamily:"'DM Mono',monospace",fontSize:14},children:le})}),e.jsxs("td",{style:{padding:"8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:[D.toFixed(0),"h"]}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111",fontSize:13},children:r(O)}),e.jsx("td",{colSpan:3})]})]})]}),ee.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6,justifyContent:"space-between"},children:[e.jsx("span",{children:" 2. Elementos de Proteccin Personal (EPP)"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:11,color:"#111111",fontWeight:600},children:["Est. ",r(ee.reduce((V,Y)=>V+(Y.costoTotal||0),0))]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:G,children:"Cdigo"}),e.jsx("th",{style:G,children:"Elemento"}),e.jsx("th",{style:ce,children:"Cant."}),e.jsx("th",{style:ce,children:"Precio ref."}),e.jsx("th",{style:ce,children:"Subtotal"}),e.jsx("th",{style:G,children:"Necesario desde"})]})}),e.jsxs("tbody",{children:[ee.map((V,Y)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#FFF8E7",color:"#8C6A00",padding:"1px 6px",borderRadius:3},children:V.codigo||""})}),e.jsxs("td",{style:{padding:"6px 8px",fontWeight:600},children:[Ca[V.familia]||""," ",V.nombre]}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:V.cantTotal}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"},children:r(V.precioRef||0)}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:r(V.costoTotal||0)}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsxs("span",{style:{background:"#FFF8E7",color:"#8C6A00",padding:"2px 8px",borderRadius:3,fontSize:10,fontWeight:600},children:[" ",Q(V.inicioNecesario)]})})]},Y)),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsx("td",{colSpan:2,style:{padding:"6px 8px",fontWeight:700},children:"TOTAL EPPs"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:ee.reduce((V,Y)=>V+Y.cantTotal,0)}),e.jsx("td",{}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111"},children:r(ee.reduce((V,Y)=>V+(Y.costoTotal||0),0))}),e.jsx("td",{})]})]})]})]}),(B.length>0||H.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 3. Herramientas y Equipos de Obra"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:G,children:"Cdigo"}),e.jsx("th",{style:G,children:"Recurso"}),e.jsx("th",{style:G,children:"Tipo"}),e.jsx("th",{style:ce,children:"Cant."}),e.jsx("th",{style:ce,children:"Precio ref."}),e.jsx("th",{style:G,children:"Necesario desde"}),e.jsx("th",{style:G,children:"Actividades"})]})}),e.jsx("tbody",{children:[...B,...H].map((V,Y)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#F0F0F0",color:"#3B3B3B",padding:"1px 6px",borderRadius:3},children:V.codigo||""})}),e.jsxs("td",{style:{padding:"6px 8px",fontWeight:600},children:[Ca[V.familia]||""," ",V.nombre]}),e.jsx("td",{style:{padding:"6px 8px",fontSize:9,color:"#888"},children:Xn[V.familia]||V.familia}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:V.cantTotal}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"},children:r(V.precioRef||0)}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsxs("span",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 8px",borderRadius:3,fontSize:10,fontWeight:600},children:[" ",Q(V.inicioNecesario)]})}),e.jsx("td",{style:{padding:"6px 8px",fontSize:9,color:"#888"},children:V.actividades.map(W=>W.nombre).filter((W,se,ge)=>ge.indexOf(W)===se).join(", ")})]},Y))})]})]}),e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 4. Detalle de personal por actividad"}),M.map(V=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("h4",{style:{fontSize:11,fontWeight:700,margin:"8px 0 4px",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:V.label}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111",fontWeight:600,fontSize:10},children:[V.personas," pers.  ",V.horas.toFixed(0),"h  ",r(V.costo)]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:10},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Actividad","Equipo","Pers.","Horas","Inicio","Fin","Das"].map(Y=>e.jsx("th",{style:{padding:"3px 6px",fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"1px solid #E0E0E0",textAlign:Y==="Actividad"||Y==="Equipo"||Y==="Inicio"||Y==="Fin"?"left":"right"},children:Y},Y))})}),e.jsx("tbody",{children:V.actividades.map((Y,W)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"4px 6px"},children:Y.nombre}),e.jsx("td",{style:{padding:"4px 6px",color:"#888"},children:Y.equipo}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Y.cant}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Y.horas.toFixed(1)}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9},children:Q(Y.inicio)}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9},children:Q(Y.fin)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Y.dias})]},W))})]})]},V.catId))]}):e.jsxs("div",{style:{textAlign:"center",padding:"50px 0",color:"#888"},children:[e.jsx(sr,{size:32,style:{opacity:.3,marginBottom:10}}),e.jsx("p",{style:{fontSize:13,fontWeight:600},children:"No se encontraron recursos en los APUs."}),e.jsx("p",{style:{fontSize:11,marginTop:8,lineHeight:1.6,maxWidth:400,margin:"8px auto 0"},children:"Para generar el plan necesitas: partidas con APU en el borrador (con cuadrillas/MO asignada)  importar actividades al cronograma."})]})})]})})})()]})}const Nr=[{id:"personal_dir",label:" Personal de direccin y administracin",items:[{desc:"Director de proyecto",unidad:"mes",cant:0,valorUnit:0},{desc:"Residente de obra / Coordinador",unidad:"mes",cant:0,valorUnit:0},{desc:"Profesional HSE / SISO",unidad:"mes",cant:0,valorUnit:0},{desc:"Coordinador administrativo",unidad:"mes",cant:0,valorUnit:0},{desc:"Almacenista",unidad:"mes",cant:0,valorUnit:0}]},{id:"seguridad",label:" Seguridad y salud en el trabajo",items:[{desc:"Ambulancia / servicio mdico",unidad:"mes",cant:0,valorUnit:0},{desc:"Sealizacin y demarcacin",unidad:"gl",cant:0,valorUnit:0},{desc:"Botiqun y elementos de emergencia",unidad:"gl",cant:0,valorUnit:0},{desc:"Capacitaciones SST",unidad:"gl",cant:0,valorUnit:0},{desc:"Exmenes mdicos ocupacionales",unidad:"gl",cant:0,valorUnit:0}]},{id:"instalaciones",label:" Instalaciones provisionales",items:[{desc:"Campamento / oficina temporal",unidad:"mes",cant:0,valorUnit:0},{desc:"Baos porttiles",unidad:"mes",cant:0,valorUnit:0},{desc:"Cerramiento provisional",unidad:"ml",cant:0,valorUnit:0},{desc:"Acometidas temporales (agua, luz)",unidad:"gl",cant:0,valorUnit:0}]},{id:"servicios",label:" Servicios y seguros",items:[{desc:"Pliza todo riesgo construccin",unidad:"gl",cant:0,valorUnit:0},{desc:"Pliza responsabilidad civil",unidad:"gl",cant:0,valorUnit:0},{desc:"Servicios pblicos obra",unidad:"mes",cant:0,valorUnit:0},{desc:"Transporte y logstica",unidad:"mes",cant:0,valorUnit:0},{desc:"Comunicaciones",unidad:"mes",cant:0,valorUnit:0}]},{id:"otros",label:" Otros gastos generales",items:[{desc:"Papelera y consumibles oficina",unidad:"mes",cant:0,valorUnit:0},{desc:"Ensayos y laboratorio",unidad:"gl",cant:0,valorUnit:0},{desc:"Imprevistos",unidad:"gl",cant:0,valorUnit:0}]}];function Hh({d:t,set:i,r:o}){const n=t.pais||"CO",a=n==="CO"?"COP":"EUR",r=z=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(z||0),s=t.ggMeses||6,g=(()=>{const z=(t.cronogramaActivos||[]).filter(Z=>!Z.esCapitulo&&Z.duracion>0);if(z.length===0)return 0;const T=t.fechaInicio?new Date(t.fechaInicio):new Date;let L=T.getTime();return z.forEach(Z=>{const K=new Date(Z.inicio||T).getTime()+(Z.duracion||1)*864e5;K>L&&(L=K)}),Math.max(1,Math.ceil((L-T.getTime())/(30*864e5)))})(),h=s,[b,j]=F.useState(()=>{var T;if(((T=t.ggItems)==null?void 0:T.length)>0)return t.ggItems;const z=[];return Nr.forEach(L=>{L.items.forEach(Z=>{z.push({id:kt(),categoria:L.id,desc:Z.desc,unidad:Z.unidad,cant:Z.cant,valorUnit:Z.valorUnit})})}),z});F.useEffect(()=>{i("ggItems",b)},[b]);const k=(z,T,L)=>j(Z=>Z.map(K=>K.id===z?{...K,[T]:L}:K)),v=z=>j(T=>T.filter(L=>L.id!==z)),m=z=>j(T=>[...T,{id:kt(),categoria:z,desc:"",unidad:"mes",cant:0,valorUnit:0}]),f=z=>(z.cant||0)*(z.valorUnit||0),p=b.reduce((z,T)=>z+f(T),0),d=o.COSTO||0,c=d>0?p/d:0,l=(t.borradorLineas||[]).filter(z=>!z.esCapitulo).length||1,x=()=>{j(z=>z.map(T=>T.unidad==="mes"?{...T,cant:s}:T))},y=z=>{g<=0||(i("ggMeses",g+(z?1:0)),z&&i("ggMesCierre",!0))},u=g>0&&g!==s&&g+1!==s,S=t.ggCriterio||"costo";F.useEffect(()=>{t.modoCalcObra==="aiu"&&i("aiuA",Math.round(c*1e4)/1e4),i("ggPct",Math.round(c*1e4)/1e4)},[p,d]);const A=()=>{const z=[],T=b.filter(U=>U.categoria==="personal_dir"&&U.desc.trim().length>0),L={director:"#111111",residente:"#2A5F8C",hse:"#8C2A2A",siso:"#8C2A2A",coordinador:"#6B5B8C",almacen:"#5B8DB8",admin:"#6B5B8C"},Z={director:"",residente:"",hse:"",siso:"",coordinador:"",almacen:"",admin:""},K=U=>{const M=U.toLowerCase();for(const[B,H]of Object.entries(L))if(M.includes(B))return B;return null},P=T.find(U=>U.desc.toLowerCase().includes("director")),te=kt();P?z.push({id:te,parentId:null,nombre:"",cargo:P.desc,color:"#111111",icon:""}):z.push({id:te,parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""}),T.filter(U=>U!==P).forEach(U=>{const M=K(U.desc);z.push({id:kt(),parentId:te,nombre:"",cargo:U.desc,color:M?L[M]:"#555",icon:M?Z[M]:""})});const he=z.find(U=>U.cargo.toLowerCase().includes("residente"))||z.find(U=>U.parentId===te)||z[0];(t.entregablesOferta||[]).filter(U=>U.incluir).reduce((U,M)=>U+(M.horas||0),0),typeof oo<"u"&&oo.find(U=>U.id===t.servicioId);const Se=t.ofertaEquipos||[],ae=new Set;Se.forEach(U=>{(U.cargos||[]).forEach(M=>{var ee;const B=(((ee=Fo[n])==null?void 0:ee.categorias)||[]).find(D=>D.id===M.cargoId),H=(B==null?void 0:B.label)||M.cargoId;!ae.has(H)&&!z.find(D=>D.cargo.toLowerCase()===H.toLowerCase())&&(ae.add(H),z.push({id:kt(),parentId:(he==null?void 0:he.id)||te,nombre:"",cargo:H,color:"#5B8DB8",icon:""}))})}),i("orgNodos",z)},E=()=>{const z=window.open("","_blank"),T="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:12px;margin:10px 0 4px;padding:6px 0 4px;border-bottom:2px solid #111}.kpis{display:flex;gap:14px;margin-bottom:10px;font-size:9px;color:#555}.kpi strong{color:#111}.kpi .badge{background:#111111;color:#fff;padding:1px 8px;border-radius:3px;font-weight:700;font-family:'DM Mono',monospace}table{width:100%;border-collapse:collapse;margin-bottom:8px}th{background:#F5F4F1;padding:3px 6px;font-size:7px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:left;border-bottom:1px solid #E0E0E0}td{padding:3px 6px;font-size:8px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.bold{font-weight:700}.r{text-align:right}.cat{background:#E8E6E1;font-weight:700;font-size:7px;text-transform:uppercase;letter-spacing:.4px;padding:4px 6px}.totrow td{border-top:2px solid #111;font-weight:700}.footer{margin-top:10px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}";let L=`<html><head><title>Gastos Generales - ${t.codigoOferta||""}</title><style>${T}</style></head><body>`;L+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',L+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Gastos Generales de Obra</div>',L+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,L+=`<div class="kpis"><div class="kpi">Costo directo: <strong class="mono">${r(d)}</strong></div>`,L+=`<div class="kpi">Total GG: <strong class="mono green">${r(p)}</strong></div>`,L+=`<div class="kpi">% GG: <span class="badge">${(c*100).toFixed(2)}%</span></div>`,L+=`<div class="kpi">Duracin: <strong>${h} meses</strong></div></div>`,Nr.forEach(Z=>{const K=b.filter(te=>te.categoria===Z.id&&f(te)>0);if(K.length===0)return;const P=K.reduce((te,he)=>te+f(he),0);L+=`<h2>${Z.label}  ${r(P)}</h2>`,L+='<table><tr><th>Descripcin</th><th>Unidad</th><th class="r">Cant.</th><th class="r">Valor unit.</th><th class="r">Subtotal</th></tr>',K.forEach(te=>{L+=`<tr><td>${te.desc}</td><td>${te.unidad}</td><td class="mono r">${te.cant}</td>`,L+=`<td class="mono r">${r(te.valorUnit)}</td><td class="mono r bold green">${r(f(te))}</td></tr>`}),L+="</table>"}),L+='<table style="margin-top:12px"><tr class="totrow"><td colspan="4" class="bold">TOTAL GASTOS GENERALES</td>',L+=`<td class="mono r bold green" style="font-size:11px">${r(p)} ${a}</td></tr>`,L+=`<tr><td colspan="4">Incidencia sobre costo directo</td><td class="mono r bold" style="font-size:11px">${(c*100).toFixed(2)}%</td></tr></table>`,L+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Gastos generales</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,L+="</body></html>",z.document.write(L),z.document.close(),setTimeout(()=>z.print(),400)},w=()=>{let z=`\uFEFFCategora;Descripcin;Unidad;Cantidad;Valor unitario;Subtotal
`;Nr.forEach(Z=>{b.filter(K=>K.categoria===Z.id).forEach(K=>{z+=`${Z.label};${K.desc};${K.unidad};${K.cant};${K.valorUnit};${f(K)}
`})}),z+=`;;;;;;TOTAL;${p}
;;;;;;% GG;${(c*100).toFixed(2)}%
`;const T=new Blob([z],{type:"text/csv;charset=utf-8"}),L=document.createElement("a");L.href=URL.createObjectURL(T),L.download=`GG_${t.codigoOferta||"proyecto"}.csv`,L.click()},_={border:`1px solid ${C.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:C.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Gastos generales de obra"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Costos indirectos distribuibles"})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[e.jsxs("button",{onClick:x,style:{padding:"6px 12px",border:`1px solid ${C.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:C.inkMid},children:[" Auto ",s," meses"]}),e.jsx("button",{onClick:A,style:{padding:"6px 12px",border:`1px solid ${C.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:C.inkMid},children:"  Organigrama"}),e.jsx("button",{onClick:w,style:{padding:"6px 12px",border:`1px solid ${C.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:C.inkMid},children:" CSV"}),e.jsxs("button",{onClick:E,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:11})," Vista PDF"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:16},children:[[["Costo directo",r(d),C.ink],["Total GG",r(p),"#111111"],["% GG / CD",(c*100).toFixed(2)+"%","#3B3B3B"],["GG por actividad",r(l>0?p/l:0),"#8C6A00"]].map(([z,T,L])=>e.jsxs(Je,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:z}),e.jsx("div",{style:{fontSize:18,fontWeight:800,color:L,fontFamily:"'DM Mono',monospace",marginTop:2},children:T})]},z)),e.jsxs(Je,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Duracin GG"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,marginTop:2},children:[e.jsx("input",{type:"number",min:1,max:120,value:s,onChange:z=>i("ggMeses",Math.max(1,parseInt(z.target.value)||1)),style:{width:50,fontSize:18,fontWeight:800,color:C.ink,fontFamily:"'DM Mono',monospace",textAlign:"center",border:"none",borderBottom:`2px solid ${C.border}`,background:"transparent",outline:"none"}}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#888"},children:"meses"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,marginTop:5,fontSize:8,color:C.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:!!t.ggMesCierre,onChange:z=>{const T=z.target.checked;i("ggMesCierre",T),i("ggMeses",T?s+1:Math.max(1,s-1))},style:{width:12,height:12,accentColor:"#111111"}}),"+1 mes cierre admin."]}),u&&e.jsxs("div",{style:{marginTop:6,background:"#FFF8E6",border:"1px solid #E6D44D55",borderRadius:4,padding:"5px 8px"},children:[e.jsxs("div",{style:{fontSize:8,color:"#8C6A00",fontWeight:600,marginBottom:3},children:[" Cronograma da ",g," meses, tienes ",s]}),e.jsxs("div",{style:{display:"flex",gap:3},children:[e.jsxs("button",{onClick:()=>y(!1),style:{flex:1,padding:"3px 4px",fontSize:7,fontWeight:700,cursor:"pointer",border:"1px solid #3B3B3B44",borderRadius:3,background:"#F0F0F0",color:"#3B3B3B",fontFamily:"'DM Sans',sans-serif"},children:["Usar ",g,"m"]}),e.jsxs("button",{onClick:()=>y(!0),style:{flex:1,padding:"3px 4px",fontSize:7,fontWeight:700,cursor:"pointer",border:"1px solid #11111144",borderRadius:3,background:"#E8F4EE",color:"#111111",fontFamily:"'DM Sans',sans-serif"},children:[g,"m + 1 cierre"]})]})]}),g>0&&!u&&e.jsx("div",{style:{fontSize:7,color:"#111111",marginTop:4},children:" Sincronizado con cronograma"})]})]}),e.jsx(Je,{style:{padding:"12px 16px",marginBottom:14},children:e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"flex-start",flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:"0 0 260px"},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Criterio de distribucin"}),e.jsx("div",{style:{display:"flex",gap:0},children:[{id:"costo",lbl:" Prop. al CD",desc:"Segn costo directo de cada actividad"},{id:"duracion",lbl:" Prop. duracin",desc:"Segn das de duracin"},{id:"mo",lbl:" Prop. a M.O.",desc:"Segn mano de obra"}].map((z,T)=>e.jsx("button",{onClick:()=>i("ggCriterio",z.id),style:{flex:1,padding:"5px 4px",fontSize:9,cursor:"pointer",fontWeight:600,border:`1px solid ${C.border}`,fontFamily:"'DM Sans',sans-serif",borderRadius:T===0?"4px 0 0 4px":T===2?"0 4px 4px 0":"0",borderLeft:T>0?"none":void 0,background:S===z.id?"#F0F0F0":"#fff",color:S===z.id?"#3B3B3B":C.inkMid},children:z.lbl},z.id))}),e.jsx("div",{style:{fontSize:9,color:"#888",marginTop:4},children:S==="costo"?"Cada actividad recibe GG proporcional a su costo directo":S==="duracion"?"Cada actividad recibe GG proporcional a su duracin en das":"Cada actividad recibe GG proporcional a su componente de mano de obra"})]}),e.jsxs("div",{style:{flex:1,background:"#F0F0F0",borderRadius:4,padding:"8px 12px"},children:[e.jsxs("div",{style:{fontSize:11,color:"#3B3B3B"},children:[" Estos gastos se ",e.jsx("strong",{children:"distribuyen en cada actividad"})," como coeficiente indirecto.",t.modoCalcObra==="aiu"?` En AIU  entra como A (Administracin) = ${(c*100).toFixed(2)}%. Se multiplica: CD  (1 + ${(c*100).toFixed(1)}% + I + U).`:` En modo margen  GG = ${(c*100).toFixed(2)}% entra en el denominador: PVP = CD / (1  M  GC  GG)  (1  GF).`]}),e.jsx("div",{style:{fontSize:10,color:"#3B3B3B",marginTop:4,fontWeight:600},children:"No visible en presupuesto de venta salvo que se solicite la estructura de costos."})]})]})}),Nr.map(z=>{const T=b.filter(Z=>Z.categoria===z.id),L=T.reduce((Z,K)=>Z+f(K),0);return e.jsxs(Je,{style:{padding:0,marginBottom:12,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"8px 14px",background:"#F5F4F1",borderBottom:`1px solid ${C.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:C.ink},children:z.label}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:L>0?"#111111":"#CCC"},children:[r(L)," ",a]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"left",width:"40%"},children:"Descripcin"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"center",width:70},children:"Unidad"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"right",width:120},children:"Valor unit."}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"right",width:120},children:"Subtotal"}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:T.map(Z=>e.jsxs("tr",{style:{borderBottom:`1px solid ${C.border}`},children:[e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{value:Z.desc,onChange:K=>k(Z.id,"desc",K.target.value),style:{..._,width:"100%"},placeholder:"Descripcin del gasto"})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:e.jsx("select",{value:Z.unidad,onChange:K=>k(Z.id,"unidad",K.target.value),style:{..._,textAlign:"center"},children:["mes","gl","ud","ml","m","jgo","da"].map(K=>e.jsx("option",{children:K},K))})}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{type:"number",min:"0",step:"0.1",value:Z.cant||0,onChange:K=>k(Z.id,"cant",parseFloat(K.target.value)||0),style:{..._,width:"100%",textAlign:"center",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{type:"number",min:"0",value:Z.valorUnit||0,onChange:K=>k(Z.id,"valorUnit",parseFloat(K.target.value)||0),style:{..._,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:f(Z)>0?"#111111":"#CCC"},children:r(f(Z))}),e.jsx("td",{style:{padding:"4px 4px"},children:e.jsx("button",{onClick:()=>v(Z.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx(He,{size:10})})})]},Z.id))})]}),e.jsx("div",{style:{padding:"4px 8px"},children:e.jsx("button",{onClick:()=>m(z.id),style:{width:"100%",padding:"4px 8px",fontSize:10,cursor:"pointer",border:`1px dashed ${C.border}`,borderRadius:3,background:"#fff",color:C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir tem"})})]},z.id)}),e.jsx(Je,{style:{padding:"14px 18px",background:"#E8F4EE",border:"1px solid #B8DEC9"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#111111",textTransform:"uppercase",letterSpacing:.5},children:"Total gastos generales"}),e.jsxs("div",{style:{fontSize:10,color:"#111111",marginTop:2},children:["Incidencia: ",e.jsxs("strong",{children:[(c*100).toFixed(2),"%"]})," sobre costo directo ",t.modoCalcObra==="aiu"?` AIU  A = ${(c*100).toFixed(2)}%`:` Coeficiente GG = ${(c*100).toFixed(2)}%`]})]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:22,fontWeight:800,color:"#111111"},children:[r(p)," ",e.jsx("span",{style:{fontSize:11,fontWeight:600},children:a})]})]})}),(()=>{const z=(t.borradorLineas||[]).filter(P=>!P.esCapitulo&&(P.precioCD||0)>0);if(z.length===0||p===0)return null;const T=z.reduce((P,te)=>P+(te.precioCD||0),0),L=z.reduce((P,te)=>P+(te.duracion||te.cantidad||1),0),Z=z.reduce((P,te)=>{const he=te.apuData;if(!he)return P;const Q=(he.equiposUsados||[]).reduce((Se,ae)=>Se+(ae.cuadrilla||[]).reduce((U,M)=>U+(M.cant||0)*(M.jornal||0)*(M.rendimiento||1),0),0)+(he.moDirecta||[]).reduce((Se,ae)=>Se+(ae.cant||0)*(ae.jornal||0)*(ae.rendimiento||1),0);return P+Q},0),K=P=>{if(S==="duracion")return L>0?(P.duracion||P.cantidad||1)/L:0;if(S==="mo"){const te=P.apuData;if(!te||Z===0)return T>0?(P.precioCD||0)/T:0;const he=(te.equiposUsados||[]).reduce((Q,Se)=>Q+(Se.cuadrilla||[]).reduce((ae,U)=>ae+(U.cant||0)*(U.jornal||0)*(U.rendimiento||1),0),0)+(te.moDirecta||[]).reduce((Q,Se)=>Q+(Se.cant||0)*(Se.jornal||0)*(Se.rendimiento||1),0);return Z>0?he/Z:0}return T>0?(P.precioCD||0)/T:0};return e.jsxs(Je,{style:{padding:0,marginTop:12,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"8px 14px",background:"#F5F4F1",borderBottom:`1px solid ${C.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:700},children:[" Distribucin por actividad",e.jsxs("span",{style:{fontSize:9,fontWeight:400,color:"#888",marginLeft:8},children:["Criterio: ",S==="costo"?"proporcional al CD":S==="duracion"?"proporcional a duracin":"proporcional a M.O."]})]}),e.jsxs("div",{style:{fontSize:10,color:"#888"},children:[z.length," actividades"]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left"},children:"Actividad"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"CD"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"Peso %"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"GG asignado"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"CD + GG"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"Incid. GG"})]})}),e.jsxs("tbody",{children:[z.slice(0,20).map((P,te)=>{const he=K(P),Q=p*he,Se=(P.precioCD||0)+Q;return e.jsxs("tr",{style:{borderBottom:`1px solid ${C.border}`},children:[e.jsx("td",{style:{padding:"3px 8px",fontSize:10,maxWidth:250,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:P.descripcion||P.partida||"Lnea "+(te+1)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:r(P.precioCD||0)}),e.jsxs("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:[(he*100).toFixed(1),"%"]}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:r(Q)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:r(Se)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right"},children:e.jsx("div",{style:{background:"#F0F0F0",borderRadius:10,height:6,overflow:"hidden"},children:e.jsx("div",{style:{background:"#3B3B3B",height:"100%",width:`${Math.min(he*100*3,100)}%`,borderRadius:10}})})})]},P.id||te)}),z.length>20&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,style:{padding:"4px 8px",fontSize:9,color:"#888",textAlign:"center"},children:["... y ",z.length-20," actividades ms"]})})]})]})})]})})()]})}function Gh({d:t,set:i,r:o}){var O,le,re,de,G,ce;const n=t.pais||"CO",a=n==="CO"?"COP":"EUR",r=V=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(V||0),s=t.modoCobro||"avance_anticipo",g=t.fuenteAvance||"cronograma",h=t.fluPctAnticipo??.3,b=t.fluMesPrimerCobro??1,j=t.condDiasPago||30,k=t.condDiasCobro||30,m=(()=>{const V=(t.cronogramaActivos||[]).filter(Y=>!Y.esCapitulo&&Y.duracion>0);if(V.length>0){const Y=t.fechaInicio?new Date(t.fechaInicio):new Date;let W=Y.getTime();return V.forEach(se=>{const ue=new Date(se.inicio||Y).getTime()+(se.duracion||1)*864e5;ue>W&&(W=ue)}),Math.max(1,Math.ceil((W-Y.getTime())/(30*864e5)))}if(t.fechaInicio&&t.fechaEntrega){const Y=new Date(t.fechaEntrega)-new Date(t.fechaInicio);return Math.max(1,Math.ceil(Y/(30*864e5)))}return t.ggMeses||6})(),f=Math.ceil(k/30),p=Math.ceil(j/30),d=(()=>{if(s==="hitos"){const V=Math.max(0,...(t.flujoCobros||[]).map(Y=>Y.mes||0));return Math.max(12,V+f+2)}return Math.max(12,m+Math.max(f,p)+2)})(),[c,l]=F.useState(()=>t.flujoCobros||[{id:kt(),nombre:"Anticipo / Firma",pct:.3,mes:0},{id:kt(),nombre:"Avance 50%",pct:.3,mes:2},{id:kt(),nombre:"Entrega final",pct:.3,mes:4},{id:kt(),nombre:"Retencin final",pct:.1,mes:5}]);F.useEffect(()=>{i("flujoCobros",c)},[c]);const x=(V,Y,W)=>l(se=>se.map(ge=>ge.id===V?{...ge,[Y]:W}:ge)),y=()=>l(V=>[...V,{id:kt(),nombre:"Nuevo hito",pct:0,mes:0}]),u=V=>l(Y=>Y.filter(W=>W.id!==V)),S=c.reduce((V,Y)=>V+(Y.pct||0),0),[A,E]=F.useState(()=>t.fluAvanceManual||Array.from({length:12},()=>0));F.useEffect(()=>{i("fluAvanceManual",A)},[A]);const w=(V,Y)=>E(W=>W.map((se,ge)=>ge===V?Y:se)),_=A.reduce((V,Y)=>V+Y,0),T=g==="manual"?A:(()=>{const V=(t.cronogramaActivos||[]).filter(ge=>!ge.esCapitulo&&(ge.precioVenta||ge.precioCD)>0),Y=V.reduce((ge,ue)=>ge+(ue.precioVenta||ue.precioCD||0),0);if(Y===0)return Array.from({length:d},()=>0);const W=t.fechaInicio?new Date(t.fechaInicio):new Date,se=Array.from({length:d},()=>0);return V.forEach(ge=>{const ue=new Date(ge.inicio||W),ye=Math.max(0,Math.round((ue-W)/(30*864e5))),be=Math.max(1,Math.ceil((ge.duracion||30)/30)),I=(ge.precioVenta||ge.precioCD||0)/Y;for(let N=ye;N<ye+be&&N<d;N++)se[N]+=I/be}),se})(),L=o.PVP||0,Z=o.IVA||0,K=L+Z,P=o.COSTO||0,te=o.ret||0,he=n==="CO"?{reteFuente:{pct:t.pctReteFuente||0},reteICA:{pct:t.pctReteICA||0},reteIVA:{pct:t.pctReteIVA||0},iva:{pct:t.tarifaIVA||.19}}:{iva:{pct:t.tarifaIVA||.21}},Q=n==="CO"?(((O=he.reteFuente)==null?void 0:O.pct)||0)+(((le=he.reteICA)==null?void 0:le.pct)||0)+(((re=he.reteIVA)==null?void 0:re.pct)||0):0,Se=(t.cronogramaActivos||[]).filter(V=>!V.esCapitulo&&V.precioCD>0),ae=V=>{if(Se.length>0){const Y=t.fechaInicio?new Date(t.fechaInicio):new Date;let W=0;return Se.forEach(se=>{const ge=new Date(se.inicio||Y),ue=Math.max(0,Math.round((ge-Y)/(30*864e5))),ye=Math.max(1,Math.ceil((se.duracion||30)/30));V>=ue&&V<ue+ye&&(W+=(se.precioCD||0)/ye)}),W}return V>=0&&V<m?P/Math.max(1,m):0},U=Array.from({length:d},(V,Y)=>Y);let M=0;const B=U.map(V=>{var N,q;let Y=0,W=0,se=0;if(s==="hitos")Y=c.filter(J=>J.mes===V).reduce((J,R)=>J+(R.pct||0)*L,0);else{const J=s==="avance_anticipo";if(J&&V===0)W=h*L,Y=W;else if(V>=b){const R=T[V-b]||0,ie=R*L;J?(se=R*h*L,Y=ie-se):Y=ie}}const ge=Y>0?t.tipoProyecto==="OBRA"?(o.U||t.margen||0)*Y*(((N=he.iva)==null?void 0:N.pct)||0):Y*(((q=he.iva)==null?void 0:q.pct)||0):0,ue=Y>0&&n==="CO"?Y*Q:0,ye=Y+ge-ue,be=ae(V),I=ye-be;return M+=I,{m:V,cobro:Y,anticipoM:W,amortM:se,ivaM:ge,retM:ue,ingNeto:ye,cos:be,neto:I,acum:M,avPct:s!=="hitos"&&V>=b&&T[V-b]||0}}),H=()=>{const V=window.open("","_blank"),Y=B.reduce((I,N)=>I+N.cobro,0),W=B.reduce((I,N)=>I+N.ivaM,0),se=B.reduce((I,N)=>I+N.retM,0),ge=B.reduce((I,N)=>I+N.cos,0),ue=B.length>0?B[B.length-1].acum:0,ye="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:10mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:8px;padding:16px}.header{display:flex;justify-content:space-between;margin-bottom:10px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:11px;margin:10px 0 4px}.kpis{display:flex;gap:14px;margin-bottom:8px;font-size:8px;color:#555}.kpi strong{color:#111}table{width:100%;border-collapse:collapse}th{background:#F5F4F1;padding:2px 4px;font-size:6px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:right;border-bottom:1px solid #E0E0E0}th:first-child{text-align:left}td{padding:2px 4px;font-size:7px;text-align:right;border-bottom:1px solid #F5F5F5}td:first-child{text-align:left;font-weight:600;background:#FFFFFF}td.section{background:#E8E6E1;font-weight:700;font-size:6px;text-transform:uppercase;letter-spacing:.4px;text-align:left;padding:3px 4px}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.red{color:#B91C1C}.bold{font-weight:700}.footer{margin-top:8px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:6px;color:#888}";let be=`<html><head><title>Flujo de caja - ${t.codigoOferta||""}</title><style>${ye}</style></head><body>`;be+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',be+='<div style="text-align:right"><div style="font-size:12px;font-weight:700">Flujo de Caja Proyectado</div>',be+=`<div style="font-size:7px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,be+=`<div class="kpis"><div class="kpi">PVP: <strong class="mono">${r(L)}</strong></div>`,be+=`<div class="kpi">Costo: <strong class="mono">${r(P)}</strong></div>`,be+=`<div class="kpi">Duracin: <strong>${m} meses</strong></div>`,be+=`<div class="kpi">Modo: <strong>${s==="hitos"?"Hitos":s==="avance"?"Avance s/anticipo":"Avance c/anticipo"}</strong></div>`,be+=`${s!=="hitos"?`<div class="kpi">Anticipo: <strong>${(h*100).toFixed(0)}%</strong></div>`:""}</div>`,be+="<table><thead><tr><th>Concepto</th>",B.forEach(I=>{be+=`<th>${I.m===0?"M0":I.m+""}</th>`}),be+='<th style="background:#E6F4EC;color:#111111">Total</th></tr></thead><tbody>',s!=="hitos"&&(be+=`<tr><td class="section" colspan="${B.length+2}">AVANCE</td></tr>`,be+="<tr><td>% Avance</td>",B.forEach(I=>{be+=`<td class="mono">${I.avPct>0?(I.avPct*100).toFixed(1)+"%":""}</td>`}),be+=`<td class="mono bold">${(B.reduce((I,N)=>I+N.avPct,0)*100).toFixed(1)}%</td></tr>`),be+=`<tr><td class="section" colspan="${B.length+2}">COBROS</td></tr>`,be+="<tr><td>Cobros</td>",B.forEach(I=>{be+=`<td class="mono ${I.cobro>0?"green":""}">${I.cobro?r(I.cobro):""}</td>`}),be+=`<td class="mono green bold">${r(Y)}</td></tr>`,s==="avance_anticipo"&&(be+="<tr><td> Anticipo</td>",B.forEach(I=>{be+=`<td class="mono">${I.anticipoM?r(I.anticipoM):""}</td>`}),be+=`<td class="mono">${r(B.reduce((I,N)=>I+N.anticipoM,0))}</td></tr>`,be+="<tr><td> Amortizacin</td>",B.forEach(I=>{be+=`<td class="mono">${I.amortM?r(I.amortM):""}</td>`}),be+=`<td class="mono">${r(B.reduce((I,N)=>I+N.amortM,0))}</td></tr>`),be+=`<tr><td class="section" colspan="${B.length+2}">IVA</td></tr>`,be+="<tr><td>IVA facturado</td>",B.forEach(I=>{be+=`<td class="mono">${I.ivaM?r(I.ivaM):""}</td>`}),be+=`<td class="mono">${r(W)}</td></tr>`,n==="CO"&&(be+=`<tr><td class="section" colspan="${B.length+2}">RETENCIONES</td></tr>`,be+="<tr><td>Total retenciones</td>",B.forEach(I=>{be+=`<td class="mono red">${I.retM?r(I.retM):""}</td>`}),be+=`<td class="mono red bold">${r(se)}</td></tr>`),be+=`<tr><td class="section" colspan="${B.length+2}">COSTOS</td></tr>`,be+="<tr><td>Costos directos</td>",B.forEach(I=>{be+=`<td class="mono red">${I.cos?r(I.cos):""}</td>`}),be+=`<td class="mono red bold">${r(ge)}</td></tr>`,be+=`<tr><td class="section" colspan="${B.length+2}">RESULTADO</td></tr>`,be+='<tr style="background:#F0F7FF"><td style="background:#F0F7FF" class="bold">Caja mensual</td>',B.forEach(I=>{be+=`<td class="mono bold ${I.neto>=0?"green":"red"}">${r(I.neto)}</td>`}),be+="<td></td></tr>",be+='<tr style="background:#E6F4EC"><td style="background:#E6F4EC" class="bold">Caja acumulada</td>',B.forEach(I=>{be+=`<td class="mono bold ${I.acum>=0?"green":"red"}">${r(I.acum)}</td>`}),be+=`<td class="mono bold ${ue>=0?"green":"red"}">${r(ue)}</td></tr>`,be+="</tbody></table>",be+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Flujo de caja</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,be+="</body></html>",V.document.write(be),V.document.close(),setTimeout(()=>V.print(),400)},ee={border:`1px solid ${C.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:C.bg},D=[{id:"hitos",lbl:"Hitos de pago",desc:"Pagos en fechas especficas"},{id:"avance",lbl:"Avance s/ anticipo",desc:"Certificacin mensual por avance"},{id:"avance_anticipo",lbl:"Avance c/ anticipo",desc:"Anticipo + certificacin - amortizacin"}];return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:C.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Flujo de caja proyectado"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[m," meses  ",r(L)," PVP  ",r(P)," costo"]})]}),e.jsxs("button",{onClick:H,style:{padding:"7px 16px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:6},children:[e.jsx(Et,{size:12})," Vista PDF"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[e.jsxs(Je,{style:{padding:18},children:[e.jsx(jt,{t:"Configuracin de cobros",s:"Selecciona modalidad de facturacin"}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:D.map((V,Y)=>e.jsx("button",{onClick:()=>i("modoCobro",V.id),style:{flex:1,padding:"8px 6px",fontSize:10,cursor:"pointer",fontWeight:600,border:`1px solid ${C.ink}`,fontFamily:"'DM Sans',sans-serif",borderRadius:Y===0?"5px 0 0 5px":Y===2?"0 5px 5px 0":"0",borderLeft:Y>0?"none":void 0,background:s===V.id?C.ink:"#fff",color:s===V.id?"#fff":C.inkMid},children:V.lbl},V.id))}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:12},children:[e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Duracin"}),e.jsxs("div",{style:{fontSize:15,fontWeight:700},children:[m," meses"]}),e.jsxs("div",{style:{fontSize:8,color:"#888"},children:[" ",(t.cronogramaActivos||[]).length>0?"cronograma":"estimado"]})]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Primer mes cobro"}),e.jsx("input",{type:"number",value:b,min:0,max:12,onChange:V=>i("fluMesPrimerCobro",+V.target.value),style:{...ee,width:"100%",fontSize:14,fontWeight:700,textAlign:"center",padding:"2px 6px"}})]}),s==="avance_anticipo"&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#8C6A00",textTransform:"uppercase"},children:"% Anticipo"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"number",value:(h*100).toFixed(0),min:0,max:100,onChange:V=>i("fluPctAnticipo",+V.target.value/100),style:{...ee,width:50,fontSize:14,fontWeight:700,textAlign:"center",padding:"2px 6px"}}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#8C6A00"},children:"%"})]}),e.jsxs("div",{style:{fontSize:8,color:"#8C6A00"},children:[r(h*L)," ",a]})]}),s==="hitos"&&e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Meses mostrados"}),e.jsx("div",{style:{fontSize:15,fontWeight:700},children:d})]})]}),s==="hitos"&&e.jsxs(e.Fragment,{children:[c.map(V=>e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:6},children:[e.jsx("input",{style:{...ee,flex:2,minWidth:0},value:V.nombre,onChange:Y=>x(V.id,"nombre",Y.target.value),placeholder:"Descripcin"}),e.jsxs("div",{style:{position:"relative",flex:"0 0 60px"},children:[e.jsx("input",{type:"number",style:{...ee,width:"100%",paddingRight:16},value:(V.pct*100).toFixed(0),min:0,max:100,onChange:Y=>x(V.id,"pct",+Y.target.value/100)}),e.jsx("span",{style:{position:"absolute",right:6,top:"50%",transform:"translateY(-50%)",fontSize:10,color:C.inkLight},children:"%"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flex:"0 0 65px"},children:[e.jsx("span",{style:{fontSize:10,color:C.inkLight},children:"Mes"}),e.jsx("input",{type:"number",style:{...ee,width:36},value:V.mes,min:0,onChange:Y=>x(V.id,"mes",+Y.target.value)})]}),e.jsx("button",{onClick:()=>u(V.id),style:{background:"none",border:"none",cursor:"pointer",color:C.danger,padding:4},children:e.jsx(He,{size:12})})]},V.id)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:6},children:[e.jsxs(ut,{sm:!0,v:"ghost",on:y,children:[e.jsx(Oe,{size:11})," Aadir hito"]}),e.jsxs("span",{style:{fontSize:11,color:Math.abs(S-1)<.001?C.success:C.warning},children:["Total: ",(S*100).toFixed(0),"% ",Math.abs(S-1)>=.001?"":""]})]})]}),s!=="hitos"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",gap:0,marginBottom:10},children:[{id:"cronograma",lbl:" Desde cronograma"},{id:"manual",lbl:" Manual"}].map((V,Y)=>e.jsx("button",{onClick:()=>i("fuenteAvance",V.id),style:{flex:1,padding:"6px 10px",fontSize:10,cursor:"pointer",fontWeight:600,border:`1px solid ${C.border}`,fontFamily:"'DM Sans',sans-serif",borderRadius:Y===0?"4px 0 0 4px":"0 4px 4px 0",borderLeft:Y>0?"none":void 0,background:g===V.id?"#F0F0F0":"#fff",color:g===V.id?"#3B3B3B":C.inkMid},children:V.lbl},V.id))}),g==="cronograma"?e.jsxs("div",{style:{background:"#E6F4EC",borderRadius:4,padding:"8px 10px",fontSize:11,color:"#111111"},children:[" Avance calculado desde ",e.jsxs("strong",{children:[(t.cronogramaActivos||[]).filter(V=>!V.esCapitulo).length," actividades"]})," del cronograma. El % de avance mensual se distribuye proporcionalmente al valor de cada actividad."]}):e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:C.inkLight,marginBottom:6},children:"Ingresa % de avance por mes (debe sumar 100%). Mes 1 = primer mes de ejecucin."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:4},children:Array.from({length:Math.max(m,6)},(V,Y)=>Y).map(V=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:8,color:"#888",fontWeight:700},children:["Mes ",V+1]}),e.jsx("input",{type:"number",min:0,max:100,value:((A[V]||0)*100).toFixed(0),onChange:Y=>w(V,+Y.target.value/100),style:{...ee,width:"100%",textAlign:"center",fontSize:12,fontWeight:600,padding:"3px 2px"}})]},V))}),e.jsxs("div",{style:{textAlign:"right",fontSize:11,marginTop:4,color:Math.abs(_-1)<.01?C.success:C.warning},children:["Total: ",(_*100).toFixed(0),"% ",Math.abs(_-1)>=.01?"":""]})]}),s==="avance_anticipo"&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"8px 10px",fontSize:10,color:"#8C6A00",marginTop:8},children:[e.jsx("strong",{children:"Anticipo amortizable:"})," Mes 0  prefactura ",(h*100).toFixed(0),"% (",r(h*L),"). Desde mes ",b,"  certificacin por avance  amortizacin proporcional del anticipo."]}),s==="avance"&&e.jsxs("div",{style:{background:"#F0F0F0",borderRadius:4,padding:"8px 10px",fontSize:10,color:"#3B3B3B",marginTop:8},children:[e.jsx("strong",{children:"Sin anticipo:"})," Desde mes ",b,"  certificacin directa por % de avance ejecutado."]})]})]}),e.jsxs(Je,{style:{padding:18},children:[e.jsx(jt,{t:"Resumen proyectado",s:"Flujo neto con IVA y retenciones"}),[["PVP sin IVA",r(L),C.ink],["+ IVA facturado",r(Z),C.info],["PVP con IVA",r(K),C.ink],...n==="CO"?[[" ReteFuente",r(L*(((de=he.reteFuente)==null?void 0:de.pct)||0)),C.warning],[" ReteICA",r(L*(((G=he.reteICA)==null?void 0:G.pct)||0)),C.warning],[" ReteIVA",r(L*(((ce=he.reteIVA)==null?void 0:ce.pct)||0)),C.warning]]:[],["Total retenciones",r(te),C.danger],["Costo total",r(P),C.warning],["Neto a recibir",r(K-te),C.success]].map(([V,Y,W])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:`1px solid ${C.border}`,fontSize:12},children:[e.jsx("span",{style:{color:C.inkMid},children:V}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:W},children:Y})]},V))]})]}),e.jsxs(Je,{style:{padding:0,overflow:"auto"},children:[e.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${C.border}`},children:e.jsx(jt,{t:"Proyeccin mes a mes",s:`${s==="hitos"?"Hitos":s==="avance"?"Avance":"Avance + anticipo"}  ${g==="manual"?"Manual":"Cronograma"}  ${d} meses`})}),e.jsx("div",{style:{overflowX:"auto"},children:(()=>{const V=B,Y={padding:"5px 6px",fontSize:8,fontWeight:700,color:"#666",textTransform:"uppercase",letterSpacing:.3,borderBottom:"2px solid #CCC",textAlign:"right",whiteSpace:"nowrap"},W={padding:"4px 8px",fontSize:10,fontWeight:600,color:"#333",whiteSpace:"nowrap",borderRight:"1px solid #E0E0E0",background:"#F5F4F1",position:"sticky",left:0,zIndex:1,minWidth:160},se=(J,R)=>({padding:"4px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",textAlign:"right",color:J===0||J===void 0?"#CCC":R||"#333",whiteSpace:"nowrap"}),ge=J=>J===0?"":new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(J),ue=(J,R)=>e.jsxs("tr",{style:{background:R||"#E8E6E1"},children:[e.jsx("td",{style:{...W,background:R||"#E8E6E1",fontWeight:700,fontSize:9,textTransform:"uppercase",letterSpacing:.5},children:J}),V.map(ie=>e.jsx("td",{style:{padding:"3px",borderBottom:"1px solid #DDD"}},ie.m)),e.jsx("td",{style:{padding:"3px",borderBottom:"1px solid #DDD"}})]},J),ye=V.reduce((J,R)=>J+R.cobro,0),be=V.reduce((J,R)=>J+R.ivaM,0),I=V.reduce((J,R)=>J+R.retM,0),N=V.reduce((J,R)=>J+R.cos,0),q=V.length>0?V[V.length-1].acum:0;return e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:V.length*72+170},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...Y,textAlign:"left",position:"sticky",left:0,background:"#F5F4F1",zIndex:2,minWidth:160},children:"CONCEPTO"}),V.map(J=>e.jsx("th",{style:Y,children:J.m===0?"MES 0":J.m+""},J.m)),e.jsx("th",{style:{...Y,background:"#E8F4EE",color:"#111111"},children:"TOTAL"})]})}),e.jsxs("tbody",{children:[s!=="hitos"&&e.jsxs(e.Fragment,{children:[ue("% AVANCE","#F0F0F0"),e.jsxs("tr",{children:[e.jsx("td",{style:W,children:"% Avance ejecutado"}),V.map(J=>e.jsx("td",{style:se(J.avPct,"#3B3B3B"),children:J.avPct>0?(J.avPct*100).toFixed(1)+"%":""},J.m)),e.jsx("td",{style:se(1,"#3B3B3B"),children:e.jsxs("strong",{children:[(V.reduce((J,R)=>J+R.avPct,0)*100).toFixed(1),"%"]})})]})]}),ue("COBROS","#D4EDDA"),e.jsxs("tr",{children:[e.jsx("td",{style:W,children:s==="hitos"?"Cobros hitos":"Cobro neto"}),V.map(J=>e.jsx("td",{style:se(J.cobro,"#111111"),children:ge(J.cobro)},J.m)),e.jsx("td",{style:se(ye,"#111111"),children:e.jsx("strong",{children:ge(ye)})})]}),s==="avance_anticipo"&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsxs("td",{style:W,children:[" Anticipo (",(h*100).toFixed(0),"%)"]}),V.map(J=>e.jsx("td",{style:se(J.anticipoM,"#8C6A00"),children:ge(J.anticipoM)},J.m)),e.jsx("td",{style:se(V.reduce((J,R)=>J+R.anticipoM,0),"#8C6A00"),children:e.jsx("strong",{children:ge(V.reduce((J,R)=>J+R.anticipoM,0))})})]}),e.jsxs("tr",{children:[e.jsx("td",{style:W,children:" Amortizacin anticipo"}),V.map(J=>e.jsx("td",{style:se(J.amortM,"#8C6A00"),children:ge(J.amortM)},J.m)),e.jsx("td",{style:se(V.reduce((J,R)=>J+R.amortM,0),"#8C6A00"),children:e.jsx("strong",{children:ge(V.reduce((J,R)=>J+R.amortM,0))})})]})]}),ue("IMPUESTOS","#FFF3CD"),e.jsxs("tr",{children:[e.jsx("td",{style:W,children:"IVA facturado"}),V.map(J=>e.jsx("td",{style:se(J.ivaM,"#8C6A00"),children:ge(J.ivaM)},J.m)),e.jsx("td",{style:se(be,"#8C6A00"),children:e.jsx("strong",{children:ge(be)})})]}),n==="CO"&&e.jsxs(e.Fragment,{children:[ue("RETENCIONES","#FCE4EC"),e.jsxs("tr",{children:[e.jsx("td",{style:W,children:"Total retenciones"}),V.map(J=>e.jsx("td",{style:se(J.retM,"#B91C1C"),children:ge(J.retM)},J.m)),e.jsx("td",{style:se(I,"#B91C1C"),children:e.jsx("strong",{children:ge(I)})})]})]}),ue("COSTOS","#F8D7DA"),e.jsxs("tr",{children:[e.jsx("td",{style:W,children:Se.length>0?"Costos (cronograma)":"Costos (distribucin lineal)"}),V.map(J=>e.jsx("td",{style:se(J.cos,"#B91C1C"),children:ge(J.cos)},J.m)),e.jsx("td",{style:se(N,"#B91C1C"),children:e.jsx("strong",{children:ge(N)})})]}),ue("RESULTADO","#D6E9F8"),e.jsxs("tr",{style:{background:"#F0F7FF"},children:[e.jsx("td",{style:{...W,background:"#F0F7FF",fontWeight:700},children:"Caja mensual"}),V.map(J=>e.jsx("td",{style:{...se(J.neto,J.neto>=0?"#111111":"#B91C1C"),fontWeight:700},children:ge(J.neto)},J.m)),e.jsx("td",{style:{...se(0),fontWeight:700}})]}),e.jsxs("tr",{style:{background:"#E6F4EC"},children:[e.jsx("td",{style:{...W,background:"#E6F4EC",fontWeight:700},children:"Caja acumulada"}),V.map(J=>e.jsx("td",{style:{...se(J.acum,J.acum>=0?"#111111":"#B91C1C"),fontWeight:700,fontSize:11},children:ge(J.acum)},J.m)),e.jsx("td",{style:{...se(q,q>=0?"#111111":"#B91C1C"),fontWeight:700,fontSize:11},children:e.jsx("strong",{children:ge(q)})})]})]})]})})()})]})]})}function Kh({d:t,set:i}){var be;const o=t.pais||"CO",n=o==="CO"?"COP":"EUR",a=I=>I?new Intl.NumberFormat(o==="CO"?"es-CO":"es-ES",{maximumFractionDigits:0}).format(I):"0",[r,s]=F.useState([]),[g,h]=F.useState([]),[b,j]=F.useState([]),[k,v]=F.useState({hDia:8,diasSemana:5,semanasAnio:50,pctProductivas:75,diasFestivos:18,diasAusencias:5}),[m,f]=F.useState([]),[p,d]=F.useState(!1);F.useEffect(()=>{(async()=>{try{const[I,N,q,J,R]=await Promise.all([Ee.get("hab:rrhh:cargos"),Ee.get("hab:rrhh:activos"),Ee.get("hab:rrhh:licencias"),Ee.get("hab:rrhh:jornada"),Ee.get("hab:logistica:items")]);I&&s(JSON.parse(I.value)||[]),N&&h(JSON.parse(N.value)||[]),q&&j(JSON.parse(q.value)||[]),J&&v(JSON.parse(J.value)),R&&f(JSON.parse(R.value)||[])}catch{}d(!0)})()},[]);const c=F.useMemo(()=>{const I=k;return(I.diasSemana*I.semanasAnio-(I.diasFestivos||18)-(I.diasAusencias||5))*I.hDia*((I.pctProductivas||75)/100)},[k]),l=I=>{const N=r.find(R=>R.id===I);if(!N||!N.salarioBruto)return 0;const q=1+((N.prestaciones||52.18)+(N.segSocial||12.5)+(N.parafiscales||9))/100,J=N.salarioBruto*q;return c>0?J/c:0},x=((be=Fo[o])==null?void 0:be.categorias)||[],y=r.filter(I=>I.activo!==!1).length===0,u=y?x.map(I=>({id:I.id,nombre:I.label,_fallback:!0})):r.filter(I=>I.activo!==!1),S=I=>y?lo(I,o):l(I),A=I=>{const N=u.find(q=>q.id===I);return(N==null?void 0:N.nombre)||(N==null?void 0:N.label)||I},E=g.filter(I=>I.activo!==!1&&I.valorCompra>0),w=b.filter(I=>I.activo!==!1&&I.costoAnual>0),_=I=>{const N=g.find(R=>R.id===I);if(!N||!N.valorCompra)return 0;const q=N.valorCompra/(N.vidaUtilAnios||5),J=N.usoAnual||1760;return q/J};(t.entregablesOferta||[]).filter(I=>I.incluir).reduce((I,N)=>I+(N.horas||0),0),typeof oo<"u"&&oo.find(I=>I.id===t.servicioId);const T=t.ofertaEquipos||[],L=I=>i("ofertaEquipos",typeof I=="function"?I(T):I),[Z,K]=F.useState(null),P=I=>{var q;const N={id:kt(),nombre:I?I.nombre:"Nuevo equipo",cargos:((I==null?void 0:I.cargos)||[{cargoId:((q=u[0])==null?void 0:q.id)||"",cantidad:1}]).map(J=>({...J,id:kt()})),activosUsados:(I==null?void 0:I.activosUsados)||[],licenciasUsadas:(I==null?void 0:I.licenciasUsadas)||[],rendimiento:(I==null?void 0:I.rendimiento)||.1,notas:""};L([...T,N]),K(N.id)},te=I=>{L(T.filter(N=>N.id!==I)),Z===I&&K(null)},he=(I,N,q)=>L(T.map(J=>J.id===I?{...J,[N]:q}:J)),Q=I=>L(T.map(N=>{var q;return N.id===I?{...N,cargos:[...N.cargos,{id:kt(),cargoId:((q=u[0])==null?void 0:q.id)||"",cantidad:1}]}:N})),Se=(I,N)=>L(T.map(q=>q.id===I?{...q,cargos:q.cargos.filter(J=>J.id!==N)}:q)),ae=(I,N,q,J)=>L(T.map(R=>R.id===I?{...R,cargos:R.cargos.map(ie=>ie.id===N?{...ie,[q]:J}:ie)}:R)),U=I=>L(T.map(N=>N.id===I?{...N,activosUsados:[...N.activosUsados||[],{id:kt(),activoId:"",cantidad:1}]}:N)),M=(I,N)=>L(T.map(q=>q.id===I?{...q,activosUsados:(q.activosUsados||[]).filter(J=>J.id!==N)}:q)),B=(I,N,q,J)=>L(T.map(R=>R.id===I?{...R,activosUsados:(R.activosUsados||[]).map(ie=>ie.id===N?{...ie,[q]:J}:ie)}:R)),H=I=>L(T.map(N=>N.id===I?{...N,licenciasUsadas:[...N.licenciasUsadas||[],{id:kt(),licId:"",cantidad:1}]}:N)),ee=(I,N)=>L(T.map(q=>q.id===I?{...q,licenciasUsadas:(q.licenciasUsadas||[]).filter(J=>J.id!==N)}:q)),D=(I,N,q,J)=>L(T.map(R=>R.id===I?{...R,licenciasUsadas:(R.licenciasUsadas||[]).map(ie=>ie.id===N?{...ie,[q]:J}:ie)}:R)),O=I=>L(T.map(N=>N.id===I?{...N,logItemsUsados:[...N.logItemsUsados||[],{id:kt(),itemId:"",cantidad:1}]}:N)),le=(I,N)=>L(T.map(q=>q.id===I?{...q,logItemsUsados:(q.logItemsUsados||[]).filter(J=>J.id!==N)}:q)),re=(I,N,q,J)=>L(T.map(R=>R.id===I?{...R,logItemsUsados:(R.logItemsUsados||[]).map(ie=>ie.id===N?{...ie,[q]:J}:ie)}:R)),de=m.filter(I=>I.familia==="epp"||I.familia==="dotacion"),G=m.filter(I=>I.familia==="herr_menor"||I.familia==="herr_mayor"||I.familia==="consumible"),ce=m.filter(I=>I.familia==="equipo_obra"||I.familia==="equipo_medic"||I.familia==="equipo_computo"),V=[...de,...G,...ce],Y={epp:"",dotacion:"",herr_menor:"",herr_mayor:"",equipo_obra:"",equipo_medic:"",equipo_computo:"",consumible:"",seguridad:"",transporte:""},W=I=>{const N=m.find(R=>R.id===I);if(!N||!N.precio)return 0;const J=(N.vidaUtil||12)*(c||1760)/12;return N.precio/J},se=I=>{const N=I.cargos.map(q=>q.cargoId);return m.filter(q=>(q.familia==="epp"||q.familia==="dotacion")&&q.asociadoACargo&&(q.cargosAsociados||[]).some(J=>N.includes(J)))},ge=I=>{const N=I.cargos.reduce((Le,Ie)=>Le+S(Ie.cargoId)*(Ie.cantidad||1),0),q=(I.activosUsados||[]).reduce((Le,Ie)=>Le+_(Ie.activoId)*(Ie.cantidad||1),0),J=(I.licenciasUsadas||[]).reduce((Le,Ie)=>{const dt=b.find(Ze=>Ze.id===Ie.licId);return dt?Le+(dt.costoAnual||0)/(c||1760)*(Ie.cantidad||1):Le},0),R=(I.logItemsUsados||[]).reduce((Le,Ie)=>Le+W(Ie.itemId)*(Ie.cantidad||1),0),fe=se(I).reduce((Le,Ie)=>Le+W(Ie.id),0),Me=R+fe;return{moH:N,eqH:q,licH:J,logH:Me,totalH:N+q+J+Me,totalMes:(N+q+J+Me)*((c||1760)/12)}},ue={border:`1px solid ${C.border}`,borderRadius:3,padding:"4px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"};r.filter(I=>I.activo!==!1).length>0;const ye=()=>{const I=window.open("","_blank"),N="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}.eq-card{border:1.5px solid #3B3B3B;border-radius:6px;margin-bottom:10px;overflow:hidden;page-break-inside:avoid}.eq-header{background:#F0F0F0;padding:6px 12px;border-bottom:1px solid #C4D8EE}.eq-name{font-size:12px;font-weight:700}.eq-sub{font-size:7px;color:#555;margin-top:1px}.eq-body{padding:8px 12px}.section-title{font-size:7px;font-weight:700;color:#888;text-transform:uppercase;letter-spacing:.5px;margin:6px 0 3px;padding-bottom:2px;border-bottom:1px solid #F5F5F5}table{width:100%;border-collapse:collapse}th{font-size:6px;font-weight:700;color:#888;text-transform:uppercase;text-align:left;padding:2px 4px;border-bottom:1px solid #E0E0E0}td{padding:2px 4px;font-size:8px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.bold{font-weight:700}.r{text-align:right}.blue{color:#3B3B3B}.green{color:#111111}.tag{font-size:7px;background:#FFF8E7;color:#8C6A00;padding:1px 5px;border-radius:3px;display:inline-block;margin:1px}.tag-blue{background:#F0F0F0;color:#3B3B3B}.cost-box{background:#F5F4F1;border-radius:4px;padding:6px 10px;margin-top:6px;font-size:9px}.cost-row{display:flex;justify-content:space-between;margin-bottom:2px}.cost-total{border-top:1px solid #DDD;padding-top:3px;margin-top:3px;font-weight:700}.footer{margin-top:14px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}";let q=`<html><head><title>Equipos - ${t.codigoOferta||""}</title><style>${N}</style></head><body>`;q+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',q+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Equipos de Trabajo</div>',q+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div>`,q+=`<div style="font-size:8px;color:#888;margin-top:2px">${T.length} equipos  ${u.length} cargos disponibles</div></div></div>`,T.forEach(J=>{const R=ge(J);q+=`<div class="eq-card"><div class="eq-header"><div class="eq-name">${J.nombre}</div>`,q+=`<div class="eq-sub">${J.cargos.length} cargos  Rendimiento: ${J.rendimiento} h/ud  Total: ${a(R.totalH)} ${n}/h</div></div>`,q+='<div class="eq-body">',q+='<div class="section-title"> Mano de obra</div>',q+=`<table><tr><th>Cargo</th><th class="r">Cant</th><th class="r">${n}/h</th><th class="r">Subtotal/h</th></tr>`,J.cargos.forEach(ie=>{const fe=S(ie.cargoId);q+=`<tr><td>${A(ie.cargoId)}</td><td class="mono r">${ie.cantidad||1}</td>`,q+=`<td class="mono r">${a(fe)}</td><td class="mono r bold">${a(fe*(ie.cantidad||1))}</td></tr>`;const Me=ie.recursosAsignados||fn[ie.cargoId]||[];Me.length>0&&(q+='<tr><td colspan="4" style="padding-left:16px">',Me.forEach(Le=>{const Ie=No(Le);Ie&&(q+=`<span class="tag">${Le} ${Ie.nombre}</span> `)}),q+="</td></tr>")}),q+="</table>",(J.herrAsignadas||[]).length>0&&(q+='<div class="section-title"> Herramientas y equipos</div><div>',(J.herrAsignadas||[]).forEach(ie=>{const fe=No(ie);fe&&(q+=`<span class="tag tag-blue">${ie} ${fe.nombre}</span> `)}),q+="</div>"),q+='<div class="cost-box">',q+=`<div class="cost-row"><span>M.O. / hora</span><span class="mono bold">${a(R.moH)}</span></div>`,R.eqH>0&&(q+=`<div class="cost-row"><span>Equipos / hora</span><span class="mono">${a(R.eqH)}</span></div>`),R.licH>0&&(q+=`<div class="cost-row"><span>Licencias / hora</span><span class="mono">${a(R.licH)}</span></div>`),R.logH>0&&(q+=`<div class="cost-row"><span>EPPs+Herram. / hora</span><span class="mono">${a(R.logH)}</span></div>`),q+=`<div class="cost-row cost-total"><span>Total / hora</span><span class="mono blue" style="font-size:11px">${a(R.totalH)} ${n}</span></div>`,q+="</div></div></div>"}),q+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Equipos de trabajo</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,q+="</body></html>",I.document.write(q),I.document.close(),setTimeout(()=>I.print(),400)};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:C.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Conformacin de equipos de trabajo"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[T.length," equipos / cuadrillas"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(ut,{sm:!0,on:()=>P(null),children:[e.jsx(Oe,{size:11})," Nuevo equipo"]}),T.length>0&&e.jsxs("button",{onClick:ye,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:11})," Vista PDF"]})]})]}),e.jsx(Je,{style:{padding:"10px 14px",marginBottom:14,background:y?"#FFF8E7":"#E6F4EC"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",fontSize:11},children:y?e.jsx(e.Fragment,{children:e.jsxs("span",{style:{color:"#8C6A00"},children:[" ",e.jsx("strong",{children:"Sin cargos en RRHH"}),"  Usando tarifas predeterminadas. Crea cargos en el mdulo ",e.jsx("strong",{children:"RRHH  Cargos"})," para que se reflejen aqu."]})}):e.jsx(e.Fragment,{children:e.jsxs("span",{style:{color:"#111111"},children:[" ",e.jsxs("strong",{children:[r.filter(I=>I.activo!==!1).length," cargos"]})," desde RRHH ",e.jsxs("strong",{children:[E.length," activos"]}),"  ",e.jsxs("strong",{children:[w.length," licencias"]}),"  Horas productivas/ao: ",e.jsx("strong",{children:Math.round(c)}),m.length>0&&e.jsxs(e.Fragment,{children:["  ",e.jsxs("strong",{children:[m.length," tems"]})," desde Logstica"]})]})})})}),T.length===0?e.jsxs(Je,{style:{padding:40,textAlign:"center"},children:[e.jsx(sr,{size:32,style:{color:C.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:C.inkLight,fontSize:13,margin:"0 0 12px"},children:"Sin equipos definidos. Crea el primero."}),e.jsxs(ut,{sm:!0,on:()=>P(null),children:[e.jsx(Oe,{size:11})," Nuevo equipo"]})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(380px, 1fr))",gap:14},children:T.map(I=>{const N=ge(I),q=Z===I.id;return e.jsxs(Je,{style:{padding:0,overflow:"hidden",border:q?"2px solid #3B3B3B":`1px solid ${C.border}`},children:[e.jsxs("div",{style:{padding:"10px 14px",background:q?"#F0F0F0":"#F5F4F1",borderBottom:`1px solid ${C.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[q?e.jsx("input",{value:I.nombre,onChange:J=>he(I.id,"nombre",J.target.value),style:{...ue,fontSize:13,fontWeight:700,width:"100%",background:"#fff"}}):e.jsx("div",{style:{fontSize:13,fontWeight:700,color:C.ink},children:I.nombre}),e.jsxs("div",{style:{fontSize:9,color:C.inkLight,marginTop:2},children:[I.cargos.length," cargo",I.cargos.length!==1?"s":"","  Rend: ",I.rendimiento," h/ud"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>K(q?null:I.id),style:{background:"none",border:"none",cursor:"pointer",color:q?"#3B3B3B":C.inkLight,padding:4},children:e.jsx(Vo,{size:13})}),e.jsx("button",{onClick:()=>te(I.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:4},children:e.jsx(He,{size:13})})]})]}),e.jsxs("div",{style:{padding:"10px 14px"},children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:[" Mano de obra ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH)"})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6,fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${C.border}`},children:[e.jsx("th",{style:{padding:"3px 4px",textAlign:"left",fontSize:8,color:"#888",fontWeight:700},children:"CARGO"}),e.jsx("th",{style:{padding:"3px 4px",textAlign:"center",fontSize:8,color:"#888",fontWeight:700,width:40},children:"CANT"}),e.jsxs("th",{style:{padding:"3px 4px",textAlign:"right",fontSize:8,color:"#888",fontWeight:700,width:70},children:[n,"/H"]}),e.jsx("th",{style:{padding:"3px 4px",textAlign:"right",fontSize:8,color:"#888",fontWeight:700,width:75},children:"SUBTOT/H"}),q&&e.jsx("th",{style:{width:20}})]})}),e.jsx("tbody",{children:I.cargos.map(J=>{const R=S(J.cargoId);return e.jsxs(vr.Fragment,{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"3px 4px"},children:q?e.jsxs("select",{value:J.cargoId,onChange:ie=>ae(I.id,J.id,"cargoId",ie.target.value),style:{...ue,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar "}),u.map(ie=>e.jsx("option",{value:ie.id,children:ie.nombre||ie.label},ie.id))]}):e.jsx("span",{children:A(J.cargoId)})}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"center"},children:q?e.jsx("input",{type:"number",value:J.cantidad||1,min:1,onChange:ie=>ae(I.id,J.id,"cantidad",+ie.target.value),style:{...ue,width:36,textAlign:"center",fontSize:10}}):e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:J.cantidad||1})}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:C.inkMid},children:a(R)}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600},children:a(R*(J.cantidad||1))}),q&&e.jsx("td",{children:e.jsx("button",{onClick:()=>Se(I.id,J.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx($t,{size:10})})})]}),e.jsx("tr",{children:e.jsx("td",{colSpan:q?5:4,style:{padding:"0 4px 4px 20px"},children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:7,color:"#888",fontWeight:700,textTransform:"uppercase"},children:"EPP:"}),(J.recursosAsignados||fn[J.cargoId]||[]).map(ie=>{const fe=No(ie);return fe?e.jsxs("span",{style:{fontSize:8,background:"#FFF8E7",color:"#8C6A00",padding:"1px 5px",borderRadius:3,display:"inline-flex",alignItems:"center",gap:2},children:[Ca[fe.familia]||""," ",e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:ie})," ",fe.nombre,q&&e.jsx("button",{onClick:()=>{const Me=J.recursosAsignados||[...fn[J.cargoId]||[]];ae(I.id,J.id,"recursosAsignados",Me.filter(Le=>Le!==ie))},style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0,marginLeft:2},children:""})]},ie):null}),q&&e.jsxs("select",{value:"",onChange:ie=>{if(!ie.target.value)return;const fe=J.recursosAsignados||[...fn[J.cargoId]||[]];fe.includes(ie.target.value)||ae(I.id,J.id,"recursosAsignados",[...fe,ie.target.value]),ie.target.value=""},style:{fontSize:8,padding:"1px 4px",border:`1px dashed ${C.border}`,borderRadius:3,background:"#fff",cursor:"pointer",maxWidth:130},children:[e.jsx("option",{value:"",children:"+ EPP/Dotacin"}),no.filter(ie=>ie.familia==="epp"||ie.familia==="dotacion").map(ie=>e.jsxs("option",{value:ie.codigo,children:[ie.codigo," ",ie.nombre]},ie.codigo))]})]})})})]},J.id)})})]}),q&&e.jsx("button",{onClick:()=>Q(I.id),style:{background:"none",border:`1px dashed ${C.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:C.inkMid,width:"100%",marginBottom:8},children:"+ Aadir cargo"}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:" Herramientas y equipos asignados"}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginBottom:6},children:[(I.herrAsignadas||[]).map(J=>{const R=No(J);return R?e.jsxs("span",{style:{fontSize:8,background:"#F0F0F0",color:"#3B3B3B",padding:"2px 6px",borderRadius:3,display:"inline-flex",alignItems:"center",gap:2},children:[Ca[R.familia]||""," ",e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:J})," ",R.nombre,q&&e.jsx("button",{onClick:()=>{he(I.id,"herrAsignadas",(I.herrAsignadas||[]).filter(ie=>ie!==J))},style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0,marginLeft:2},children:""})]},J):null}),(I.herrAsignadas||[]).length===0&&!q&&e.jsx("span",{style:{fontSize:9,color:"#999",fontStyle:"italic"},children:"Sin herramientas asignadas"}),q&&e.jsxs("select",{value:"",onChange:J=>{if(!J.target.value)return;const R=I.herrAsignadas||[];R.includes(J.target.value)||he(I.id,"herrAsignadas",[...R,J.target.value]),J.target.value=""},style:{fontSize:8,padding:"2px 6px",border:`1px dashed ${C.border}`,borderRadius:3,background:"#fff",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"+ Herramienta / Equipo"}),no.filter(J=>["herr_menor","herr_mayor","equipo_obra","equipo_medic","consumible","seguridad"].includes(J.familia)).map(J=>e.jsxs("option",{value:J.codigo,children:[J.codigo," ",J.nombre," (",Xn[J.familia],")"]},J.codigo))]}),q&&(I.herrAsignadas||[]).length===0&&(()=>{const J=Object.keys(Us).find(R=>{var ie;return(ie=I.nombre)==null?void 0:ie.toLowerCase().includes(R.replace("eq_","").replace("_"," "))});return J?e.jsx("button",{onClick:()=>he(I.id,"herrAsignadas",[...I.herrAsignadas||[],...Us[J]]),style:{fontSize:8,padding:"2px 8px",background:"#E6F4EC",border:"1px solid #111111",borderRadius:3,color:"#111111",cursor:"pointer",fontWeight:600},children:" Cargar defaults"}):null})()]}),(q||(I.activosUsados||[]).length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" Equipos / herramientas ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH  Activos)"})]}),(I.activosUsados||[]).length===0&&E.length===0?e.jsx("div",{style:{fontSize:10,color:"#999",marginBottom:6},children:"Sin activos en RRHH. Regstralos en RRHH  Activos fijos."}):e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:(I.activosUsados||[]).map(J=>{const R=g.find(fe=>fe.id===J.activoId),ie=_(J.activoId);return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:q?e.jsxs("select",{value:J.activoId,onChange:fe=>B(I.id,J.id,"activoId",fe.target.value),style:{...ue,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar activo "}),E.map(fe=>e.jsxs("option",{value:fe.id,children:[fe.nombre," (",fe.categoria,")"]},fe.id))]}):e.jsx("span",{children:(R==null?void 0:R.nombre)||""})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:q?e.jsx("input",{type:"number",value:J.cantidad||1,min:1,onChange:fe=>B(I.id,J.id,"cantidad",+fe.target.value),style:{...ue,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:J.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:C.inkMid,width:60},children:[a(ie),"/h"]}),q&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>M(I.id,J.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx($t,{size:9})})})]},J.id)})})}),q&&E.length>0&&e.jsx("button",{onClick:()=>U(I.id),style:{background:"none",border:`1px dashed ${C.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:C.inkMid,width:"100%",marginBottom:6},children:"+ Aadir equipo/herramienta"})]}),(q||(I.licenciasUsadas||[]).length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" Licencias software ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH  Licencias)"})]}),(I.licenciasUsadas||[]).length===0&&w.length===0?e.jsx("div",{style:{fontSize:10,color:"#999",marginBottom:6},children:"Sin licencias en RRHH."}):e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:(I.licenciasUsadas||[]).map(J=>{const R=b.find(fe=>fe.id===J.licId),ie=R?(R.costoAnual||0)/(c||1760):0;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:q?e.jsxs("select",{value:J.licId,onChange:fe=>D(I.id,J.id,"licId",fe.target.value),style:{...ue,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar licencia "}),w.map(fe=>e.jsxs("option",{value:fe.id,children:[fe.nombre," (",fe.plan||"",")"]},fe.id))]}):e.jsx("span",{children:(R==null?void 0:R.nombre)||""})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:q?e.jsx("input",{type:"number",value:J.cantidad||1,min:1,onChange:fe=>D(I.id,J.id,"cantidad",+fe.target.value),style:{...ue,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:J.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:C.inkMid,width:60},children:[a(ie),"/h"]}),q&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>ee(I.id,J.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx($t,{size:9})})})]},J.id)})})}),q&&w.length>0&&e.jsx("button",{onClick:()=>H(I.id),style:{background:"none",border:`1px dashed ${C.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:C.inkMid,width:"100%",marginBottom:6},children:"+ Aadir licencia"})]}),(()=>{const J=se(I),R=I.logItemsUsados||[];return J.length>0||R.length>0||q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" EPPs  Dotaciones  Herramientas ",e.jsx("span",{style:{fontWeight:400},children:"(desde Logstica)"})]}),J.length>0&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:3,padding:"4px 8px",marginBottom:4,fontSize:9},children:[e.jsx("span",{style:{fontWeight:600,color:C.warning},children:"Auto por cargo:"}),J.map(fe=>e.jsxs("span",{style:{marginLeft:6,color:C.inkMid},children:[Y[fe.familia]||""," ",fe.nombre," (",a(W(fe.id)),"/h)"]},fe.id))]}),R.length>0&&e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:R.map(fe=>{const Me=m.find(Ie=>Ie.id===fe.itemId),Le=W(fe.itemId);return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:q?e.jsxs("select",{value:fe.itemId,onChange:Ie=>re(I.id,fe.id,"itemId",Ie.target.value),style:{...ue,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar "}),V.map(Ie=>e.jsxs("option",{value:Ie.id,children:[Y[Ie.familia]||""," ",Ie.nombre," (",Ie.familia,")"]},Ie.id))]}):e.jsxs("span",{children:[Y[Me==null?void 0:Me.familia]||""," ",(Me==null?void 0:Me.nombre)||""]})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:q?e.jsx("input",{type:"number",value:fe.cantidad||1,min:1,onChange:Ie=>re(I.id,fe.id,"cantidad",+Ie.target.value),style:{...ue,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:fe.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:C.inkMid,width:60},children:[a(Le),"/h"]}),q&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>le(I.id,fe.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx($t,{size:9})})})]},fe.id)})})}),q&&V.length>0&&e.jsx("button",{onClick:()=>O(I.id),style:{background:"none",border:`1px dashed ${C.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:C.inkMid,width:"100%",marginBottom:6},children:"+ Aadir EPP / herramienta"}),q&&V.length===0&&e.jsx("div",{style:{fontSize:9,color:"#999",marginBottom:6},children:"Sin tems en Logstica. Regstralos en el mdulo Logstica."})]}):null})(),q&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:8,marginBottom:6},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:8,color:C.inkLight,fontWeight:600,textTransform:"uppercase",marginBottom:2},children:"Rendimiento (h/ud)"}),e.jsx("input",{type:"number",value:I.rendimiento||0,step:.01,onChange:J=>he(I.id,"rendimiento",+J.target.value),style:{...ue,width:"100%",textAlign:"right"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:8,color:C.inkLight,fontWeight:600,textTransform:"uppercase",marginBottom:2},children:"Notas"}),e.jsx("input",{value:I.notas||"",onChange:J=>he(I.id,"notas",J.target.value),placeholder:"Observaciones...",style:{...ue,width:"100%"}})]})]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px",fontSize:10,marginTop:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:C.inkLight},children:"M.O. / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:a(N.moH)})]}),N.eqH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:C.inkLight},children:"Equipos / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:a(N.eqH)})]}),N.licH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:C.inkLight},children:"Licencias / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:a(N.licH)})]}),N.logH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:C.inkLight},children:"EPPs+Herram. / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:a(N.logH)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:`1px solid ${C.border}`,paddingTop:3,marginTop:3},children:[e.jsx("span",{style:{fontWeight:600},children:"Total / hora"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#3B3B3B"},children:[a(N.totalH)," ",n]})]})]}),q&&e.jsxs("button",{onClick:()=>K(null),style:{width:"100%",marginTop:10,padding:"7px 12px",fontSize:11,fontWeight:700,cursor:"pointer",border:"none",borderRadius:4,background:"#111111",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",justifyContent:"center",gap:5},children:[e.jsx(xt,{size:12})," Guardar equipo"]})]})]},I.id)})})]})}function Jh({d:t,set:i,r:o}){var J;const n=t.pais||"CO",a=R=>R?new Intl.NumberFormat(n==="CO"?"es-CO":"es-ES",{maximumFractionDigits:0}).format(R):"",r=[{id:"civil",label:" Materiales civiles",icon:""},{id:"electrico",label:" Materiales elctricos",icon:""},{id:"hidro",label:" Hidrulico / sanitario",icon:""},{id:"acabados",label:" Acabados",icon:""},{id:"epp",label:" EPPs y dotacin",icon:""},{id:"herr",label:" Herramientas y equipos",icon:""},{id:"transporte",label:" Transporte",icon:""},{id:"otros",label:" Otros insumos",icon:""}],[s,g]=F.useState("civil"),[h,b]=F.useState(!1),[j,k]=F.useState(!1),[v,m]=F.useState(null),[f,p]=F.useState({codigo:"",descripcion:"",unidad:"ud",familia:"civil"}),[d,c]=F.useState({nombre:"",contacto:"",tel:"",email:"",nit:""}),[l,x]=F.useState(""),[y,u]=F.useState([]),[S,A]=F.useState(!1);F.useState(null);const E=t.insumosLista||[],w=R=>i("insumosLista",typeof R=="function"?R(E):R),_=t.matProveedores||[],z=R=>i("matProveedores",typeof R=="function"?R(_):R),T=t.insCotizaciones2||{},L=R=>i("insCotizaciones2",typeof R=="function"?R(T):R),Z=t.insAdjudicacion||{},K=R=>i("insAdjudicacion",typeof R=="function"?R(Z):R),P=["slot1","slot2","slot3"],te={slot1:"Cotizacin 1",slot2:"Cotizacin 2",slot3:"Cotizacin 3"},he={slot1:"#3B3B3B",slot2:"#8C6A00",slot3:"#5B3A8C"},Q={slot1:"#F0F0F0",slot2:"#FAF0E0",slot3:"#F0ECF6"},Se=R=>{const ie={civil:"MC",electrico:"ME",hidro:"MH",acabados:"MA",epp:"EPP",herr:"HE",transporte:"TR",otros:"OT"}[R]||"XX",Me=E.filter(Le=>Le.familia===R).reduce((Le,Ie)=>{const dt=Ie.codigo.match(/(\d+)$/);return dt?Math.max(Le,parseInt(dt[1])):Le},0);return`${ie}-${String(Me+1).padStart(3,"0")}`},ae=()=>{const R=f.familia||s,ie=f.codigo||Se(R);w([...E,{id:kt(),codigo:ie,descripcion:f.descripcion,unidad:f.unidad,familia:R,precioPrevisto:0,cantidad:1}]),p({codigo:"",descripcion:"",unidad:"ud",familia:R}),b(!1)},U=(R,ie,fe)=>w(E.map(Me=>Me.id===R?{...Me,[ie]:fe}:Me)),M=R=>{w(E.filter(Me=>Me.id!==R));const ie={...T};delete ie[R],L(ie);const fe={...Z};delete fe[R],K(fe),u(y.filter(Me=>Me!==R))},B=()=>{if(!d.nombre.trim())return;const R={...d,id:kt(),fecha:Dt()};z([..._,R]),c({nombre:"",contacto:"",tel:"",email:"",nit:""}),k(!1)},H=R=>{z(_.filter(fe=>fe.id!==R));const ie={...T};Object.keys(ie).forEach(fe=>{P.forEach(Me=>{var Le,Ie;((Ie=(Le=ie[fe])==null?void 0:Le[Me])==null?void 0:Ie.provId)===R&&delete ie[fe][Me]})}),L(ie)},ee=(R,ie)=>{var fe;return((fe=T[R])==null?void 0:fe[ie])||null},D=(R,ie,fe)=>{const Me={...T};Me[R]||(Me[R]={}),Me[R][ie]={...Me[R][ie]||{},...fe},L(Me)},O=(R,ie)=>{const fe={...T};if(fe[R]&&delete fe[R][ie],L(fe),Z[R]===ie){const Me={...Z};delete Me[R],K(Me)}},le=(R,ie)=>{const fe={...T};y.forEach(Me=>{fe[Me]||(fe[Me]={}),fe[Me][ie]={provId:R,precio:0,cotArchivo:"",correoRef:""}}),L(fe),A(!1),u([])},re=(R,ie,fe)=>{var Me,Le,Ie;D(R,ie,{provId:fe,precio:((Me=ee(R,ie))==null?void 0:Me.precio)||0,cotArchivo:((Le=ee(R,ie))==null?void 0:Le.cotArchivo)||"",correoRef:((Ie=ee(R,ie))==null?void 0:Ie.correoRef)||""})},de=(R,ie)=>{K({...Z,[R]:ie})},G=R=>{const ie={...Z};delete ie[R],K(ie)},ce=R=>{const ie=Z[R];if(ie){const fe=ee(R,ie);if((fe==null?void 0:fe.precio)>0){const Me=_.find(Le=>Le.id===fe.provId);return{precio:fe.precio,provNombre:(Me==null?void 0:Me.nombre)||"",slot:ie,adjudicado:!0}}}return{precio:0,provNombre:"",slot:null,adjudicado:!1}},V=()=>{const R=[];(no||[]).filter(ie=>ie.familia==="epp"||ie.familia==="dotacion").forEach(ie=>{E.find(fe=>fe.codigo===ie.codigo)||R.push({id:kt(),codigo:ie.codigo,descripcion:ie.nombre,unidad:ie.unidad,familia:"epp",precioPrevisto:ie.precioRef||0,cantidad:1})}),R.length>0&&w([...E,...R])},Y=()=>{const R=[];(no||[]).filter(ie=>["herr_menor","herr_mayor","equipo_obra","equipo_medic","consumible","seguridad"].includes(ie.familia)).forEach(ie=>{E.find(fe=>fe.codigo===ie.codigo)||R.push({id:kt(),codigo:ie.codigo,descripcion:ie.nombre,unidad:ie.unidad,familia:"herr",precioPrevisto:ie.precioRef||0,cantidad:1})}),R.length>0&&w([...E,...R])},W=E.filter(R=>!(R.familia!==s||l&&!R.descripcion.toLowerCase().includes(l.toLowerCase())&&!R.codigo.toLowerCase().includes(l.toLowerCase()))),se=E.length,ge=Object.keys(Z).length;E.filter(R=>P.some(ie=>{var fe;return((fe=ee(R.id,ie))==null?void 0:fe.precio)>0})).length;const ue=W.length>0&&W.every(R=>y.includes(R.id)),ye=()=>{u(ue?y.filter(R=>!W.find(ie=>ie.id===R)):[...new Set([...y,...W.map(R=>R.id)])])},be=R=>{u(y.includes(R)?y.filter(ie=>ie!==R):[...y,R])},I=()=>{const R=window.open("","_blank"),ie="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:10mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:8px;padding:16px}.header{display:flex;justify-content:space-between;margin-bottom:10px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}h2{font-size:11px;margin:10px 0 4px;border-bottom:2px solid #111;padding-bottom:4px}table{width:100%;border-collapse:collapse;margin-bottom:8px}th{background:#F5F4F1;padding:3px 4px;font-size:6px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:left;border-bottom:1px solid #E0E0E0}td{padding:2px 4px;font-size:7px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.r{text-align:right}.bold{font-weight:700}.adj{background:#D4EDDA;font-weight:700;color:#111111}.footer{margin-top:10px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:6px;color:#888}";let fe=`<html><head><title>Comparativo - ${t.codigoOferta||""}</title><style>${ie}</style></head><body>`;fe+='<div class="header"><div><div class="logo">HABITARIS</div></div>',fe+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Comparativo de Insumos</div>',fe+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}</div></div></div>`,r.forEach(Me=>{const Le=E.filter(Ie=>Ie.familia===Me.id);Le.length!==0&&(fe+=`<h2>${Me.label} (${Le.length})</h2>`,fe+='<table><tr><th>Cdigo</th><th>Descripcin</th><th>Und</th><th>Cant</th><th class="r">P. Previsto</th>',P.forEach(Ie=>fe+=`<th class="r">${te[Ie]}</th>`),fe+='<th class="r" style="background:#E6F4EC">P. Final</th><th>Adjudicado a</th></tr>',Le.forEach(Ie=>{const dt=ce(Ie.id);fe+=`<tr><td class="mono bold">${Ie.codigo}</td><td>${Ie.descripcion}</td><td>${Ie.unidad}</td><td class="mono">${Ie.cantidad||1}</td>`,fe+=`<td class="mono r">${a(Ie.precioPrevisto)}</td>`,P.forEach(Ze=>{const mt=ee(Ie.id,Ze),Yt=Z[Ie.id]===Ze,_t=mt!=null&&mt.provId?_.find(oi=>oi.id===mt.provId):null;fe+=`<td class="mono r ${Yt?"adj":""}">${_t?_t.nombre+": ":""}${(mt==null?void 0:mt.precio)>0?a(mt.precio):""}</td>`}),fe+=`<td class="mono r bold green">${dt.adjudicado?a(dt.precio):""}</td>`,fe+=`<td>${dt.adjudicado?dt.provNombre:"Pendiente"}</td></tr>`}),fe+="</table>")}),fe+=`<div class="footer"><span>HABITARIS  Comparativo  ${t.codigoOferta||""}</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,fe+="</body></html>",R.document.write(fe),R.document.close(),setTimeout(()=>R.print(),400)},N={border:`1px solid ${C.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},q={width:15,height:15,accentColor:"#111111",cursor:"pointer"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:C.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Insumos y comparativo de proveedores"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[se," insumos  ",_.length," proveedores  ",ge," adjudicados"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[y.length>0&&e.jsxs("button",{onClick:()=>A(!0),style:{padding:"6px 14px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" Asignar proveedor a ",y.length," insumos"]}),e.jsx("button",{onClick:()=>{p({...f,familia:s}),b(!0)},style:{padding:"6px 12px",border:`1px solid ${C.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:C.inkMid},children:"+ Insumo"}),e.jsx("button",{onClick:()=>{c({nombre:"",contacto:"",tel:"",email:"",nit:""}),m(null),k(!0)},style:{padding:"6px 12px",border:`1px solid ${C.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:C.inkMid},children:"+ Proveedor"}),e.jsxs("button",{onClick:I,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:11})," Vista PDF"]})]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14,overflowX:"auto"},children:r.map((R,ie)=>{const fe=E.filter(Me=>Me.familia===R.id).length;return e.jsxs("button",{onClick:()=>{g(R.id),u([])},style:{padding:"8px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${C.border}`,borderLeft:ie>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:ie===0?"5px 0 0 5px":ie===r.length-1?"0 5px 5px 0":"0",background:s===R.id?"#111":"#fff",color:s===R.id?"#fff":C.inkMid},children:[R.icon," ",R.label.split(" ").slice(1).join(" ")," ",fe>0&&e.jsx("span",{style:{marginLeft:4,background:s===R.id?"rgba(255,255,255,0.2)":"#F5F5F5",padding:"0 5px",borderRadius:8,fontSize:9},children:fe})]},R.id)})}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsxs("div",{style:{width:240,flexShrink:0},children:[e.jsxs(Je,{style:{padding:"8px 10px",marginBottom:10},children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:["Proveedores (",_.length,")"]}),_.map(R=>e.jsx("div",{style:{padding:"6px 0",borderBottom:`1px solid ${C.border}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:R.nombre}),R.contacto&&e.jsx("div",{style:{fontSize:9,color:"#888"},children:R.contacto}),R.email&&e.jsxs("div",{style:{fontSize:8,color:"#3B3B3B"},children:[" ",R.email]}),R.nit&&e.jsxs("div",{style:{fontSize:8,color:"#888"},children:["NIT: ",R.nit]})]}),e.jsxs("div",{style:{display:"flex",gap:2},children:[e.jsx("button",{onClick:()=>{m(R.id),c({nombre:R.nombre,contacto:R.contacto||"",tel:R.tel||"",email:R.email||"",nit:R.nit||""}),k(!0)},style:{background:"none",border:"none",cursor:"pointer",color:"#3B3B3B",padding:2,fontSize:10},children:""}),e.jsx("button",{onClick:()=>H(R.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx($t,{size:10})})]})]})},R.id)),_.length===0&&e.jsx("div",{style:{fontSize:10,color:"#CCC",padding:"8px 0"},children:"Sin proveedores"}),e.jsx("button",{onClick:()=>{c({nombre:"",contacto:"",tel:"",email:"",nit:""}),m(null),k(!0)},style:{width:"100%",marginTop:6,padding:"5px",fontSize:10,cursor:"pointer",border:`1px dashed ${C.border}`,borderRadius:4,background:"#fff",color:C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir proveedor"})]}),s==="epp"&&e.jsx("button",{onClick:V,style:{width:"100%",padding:"6px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${C.border}`,borderRadius:4,background:"#FFF8E7",color:"#8C6A00",fontFamily:"'DM Sans',sans-serif",marginBottom:8},children:" Cargar EPPs desde catlogo"}),s==="herr"&&e.jsx("button",{onClick:Y,style:{width:"100%",padding:"6px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${C.border}`,borderRadius:4,background:"#FFF8E7",color:"#8C6A00",fontFamily:"'DM Sans',sans-serif",marginBottom:8},children:" Cargar herramientas desde catlogo"}),e.jsx("input",{value:l,onChange:R=>x(R.target.value),placeholder:" Buscar insumo...",style:{...N,width:"100%",marginBottom:8}}),y.length>0&&e.jsxs("div",{style:{background:"#F0F0F0",border:"1px solid #3B3B3B33",borderRadius:6,padding:"8px 10px",fontSize:10},children:[e.jsx("strong",{children:y.length})," insumos seleccionados",e.jsx("button",{onClick:()=>A(!0),style:{display:"block",width:"100%",marginTop:4,padding:"5px",fontSize:10,fontWeight:700,cursor:"pointer",border:"none",borderRadius:4,background:"#3B3B3B",color:"#fff",fontFamily:"'DM Sans',sans-serif"},children:" Asignar proveedor"}),e.jsx("button",{onClick:()=>u([]),style:{display:"block",width:"100%",marginTop:3,padding:"4px",fontSize:9,cursor:"pointer",border:`1px solid ${C.border}`,borderRadius:4,background:"#fff",color:C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"Deseleccionar todo"})]})]}),e.jsxs(Je,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:900},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{padding:"6px 4px",width:30,borderBottom:"2px solid #CCC"},children:e.jsx("input",{type:"checkbox",checked:ue,onChange:ye,style:q})}),e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"left",width:80},children:"Cdigo"}),e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"left",minWidth:150},children:"Descripcin"}),e.jsx("th",{style:{padding:"6px 4px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"center",width:35},children:"Und"}),e.jsx("th",{style:{padding:"6px 4px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"center",width:40},children:"Cant"}),e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"right",width:80},children:"P. Prev."}),P.map(R=>e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,textTransform:"uppercase",borderBottom:`2px solid ${he[R]}`,textAlign:"center",minWidth:140,color:he[R],background:Q[R]},children:te[R]},R)),e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,color:"#111111",textTransform:"uppercase",borderBottom:"2px solid #111111",textAlign:"center",width:120,background:"#E6F4EC"},children:"P. Final / Adjud."}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:W.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:"24px",textAlign:"center",color:"#CCC",fontSize:12},children:'Sin insumos en esta categora. Pulsa "+ Insumo" para aadir.'})}):W.map((R,ie)=>{const fe=ce(R.id),Me=y.includes(R.id);return e.jsxs("tr",{style:{background:Me?"#F0F0F022":ie%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${C.border}`},children:[e.jsx("td",{style:{padding:"4px 4px",textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:Me,onChange:()=>be(R.id),style:q})}),e.jsx("td",{style:{padding:"4px 6px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#F5F5F5",padding:"1px 6px",borderRadius:3},children:R.codigo})}),e.jsx("td",{style:{padding:"4px 6px"},children:e.jsx("input",{value:R.descripcion,onChange:Le=>U(R.id,"descripcion",Le.target.value),style:{...N,width:"100%",border:"none",background:"transparent",fontWeight:500,fontSize:11},placeholder:"Descripcin"})}),e.jsx("td",{style:{padding:"2px 2px",textAlign:"center"},children:e.jsx("select",{value:R.unidad,onChange:Le=>U(R.id,"unidad",Le.target.value),style:{...N,fontSize:9,border:"none",background:"transparent",textAlign:"center",padding:"2px"},children:["ud","m","m","m","ml","kg","gl","l","par","jgo","rollo","bulto","caneca","caja","saco","da","mes","h","viaje"].map(Le=>e.jsx("option",{children:Le},Le))})}),e.jsx("td",{style:{padding:"2px 2px"},children:e.jsx("input",{type:"number",value:R.cantidad||1,min:1,onChange:Le=>U(R.id,"cantidad",parseInt(Le.target.value)||1),style:{...N,width:36,textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:10,border:"none",background:"transparent"}})}),e.jsx("td",{style:{padding:"2px 4px"},children:e.jsx("input",{type:"number",value:R.precioPrevisto||"",placeholder:"0",onChange:Le=>U(R.id,"precioPrevisto",parseFloat(Le.target.value)||0),style:{...N,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"}})}),P.map(Le=>{const Ie=ee(R.id,Le);Ie!=null&&Ie.provId&&_.find(Ze=>Ze.id===Ie.provId);const dt=Z[R.id]===Le;return e.jsx("td",{style:{padding:"3px 4px",borderLeft:`1px solid ${he[Le]}22`,background:dt?"#D4EDDA":Ie?Q[Le]+"44":"transparent",verticalAlign:"top"},children:Ie?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[e.jsxs("select",{value:Ie.provId||"",onChange:Ze=>D(R.id,Le,{provId:Ze.target.value}),style:{fontSize:8,fontWeight:700,color:he[Le],border:"none",background:"transparent",cursor:"pointer",maxWidth:100},children:[e.jsx("option",{value:"",children:" Prov "}),_.map(Ze=>e.jsx("option",{value:Ze.id,children:Ze.nombre},Ze.id))]}),e.jsx("button",{onClick:()=>O(R.id,Le),title:"Quitar",style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0},children:""})]}),e.jsx("input",{type:"number",value:Ie.precio||"",placeholder:"Precio",onChange:Ze=>D(R.id,Le,{precio:parseFloat(Ze.target.value)||0}),style:{...N,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:dt?700:400,border:dt?"2px solid #111111":`1px solid ${C.border}`,background:dt?"#D4EDDA":"#fff"}}),e.jsxs("div",{style:{display:"flex",gap:2,marginTop:2},children:[e.jsx("input",{value:Ie.cotArchivo||"",placeholder:" Cotizacin",onChange:Ze=>D(R.id,Le,{cotArchivo:Ze.target.value}),style:{fontSize:7,padding:"1px 3px",border:`1px solid ${C.border}`,borderRadius:2,width:"50%",background:"#fff"}}),e.jsx("input",{value:Ie.correoRef||"",placeholder:" Correo",onChange:Ze=>D(R.id,Le,{correoRef:Ze.target.value}),style:{fontSize:7,padding:"1px 3px",border:`1px solid ${C.border}`,borderRadius:2,width:"50%",background:"#fff"}})]}),Ie.precio>0&&e.jsx("button",{onClick:()=>dt?G(R.id):de(R.id,Le),style:{width:"100%",marginTop:3,padding:"2px",fontSize:8,fontWeight:700,border:dt?"1px solid #111111":`1px dashed ${C.border}`,borderRadius:3,background:dt?"#111111":"#fff",color:dt?"#fff":"#888",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:dt?" Adjudicado":"Adjudicar"})]}):e.jsx("div",{style:{textAlign:"center",padding:"6px 0"},children:e.jsxs("select",{value:"",onChange:Ze=>{Ze.target.value&&re(R.id,Le,Ze.target.value)},style:{fontSize:8,padding:"2px 4px",border:`1px dashed ${C.border}`,borderRadius:3,background:"#fff",cursor:"pointer",color:C.inkMid,width:"100%"},children:[e.jsx("option",{value:"",children:"+ Proveedor"}),_.map(Ze=>e.jsx("option",{value:Ze.id,children:Ze.nombre},Ze.id))]})})},Le)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",background:"#E6F4EC",verticalAlign:"middle"},children:fe.adjudicado?e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:800,color:"#111111"},children:a(fe.precio)}),e.jsxs("div",{style:{fontSize:7,color:"#111111",fontWeight:600},children:[" ",fe.provNombre]})]}):e.jsx("span",{style:{fontSize:8,color:"#999",fontStyle:"italic"},children:"Pendiente"})}),e.jsx("td",{style:{padding:"2px 4px"},children:e.jsx("button",{onClick:()=>M(R.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx(He,{size:10})})})]},R.id)})})]})}),e.jsx("div",{style:{padding:"6px 8px",borderTop:`1px solid ${C.border}`},children:e.jsxs("button",{onClick:()=>{p({...f,familia:s}),b(!0)},style:{width:"100%",padding:"5px 8px",fontSize:10,cursor:"pointer",border:`1px dashed ${C.border}`,borderRadius:3,background:"#fff",color:C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:["+ Aadir insumo a ",((J=r.find(R=>R.id===s))==null?void 0:J.label)||""]})})]})]}),h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:R=>R.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(jt,{t:"Nuevo insumo",s:"Se agrega a la maestra del proyecto"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:"0 0 100px"},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Cdigo"}),e.jsx("input",{value:f.codigo||Se(f.familia||s),onChange:R=>p({...f,codigo:R.target.value}),style:{...N,width:"100%",fontFamily:"'DM Mono',monospace",fontWeight:700}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Descripcin"}),e.jsx("input",{value:f.descripcion,onChange:R=>p({...f,descripcion:R.target.value}),style:{...N,width:"100%"},placeholder:"Ej: Cemento Portland tipo I"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Familia"}),e.jsx("select",{value:f.familia||s,onChange:R=>p({...f,familia:R.target.value}),style:{...N,width:"100%"},children:r.map(R=>e.jsx("option",{value:R.id,children:R.label},R.id))})]}),e.jsxs("div",{style:{flex:"0 0 80px"},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Unidad"}),e.jsx("select",{value:f.unidad,onChange:R=>p({...f,unidad:R.target.value}),style:{...N,width:"100%"},children:["ud","m","m","m","ml","kg","gl","l","par","jgo","rollo","bulto","caneca","caja","saco","da","mes","h","viaje"].map(R=>e.jsx("option",{children:R},R))})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ut,{on:ae,style:{flex:1},children:[e.jsx(xt,{size:11})," Aadir"]}),e.jsx(ut,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})}),j&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>k(!1),children:e.jsxs("div",{onClick:R=>R.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(jt,{t:v?"Editar proveedor":"Nuevo proveedor",s:"Para comparar cotizaciones"}),e.jsx(ot,{lbl:"Nombre / Empresa",val:d.nombre,on:R=>c({...d,nombre:R.target.value}),ph:"Ej: Ferretera El Tornillo"}),e.jsx(ot,{lbl:"NIT / CIF",val:d.nit||"",on:R=>c({...d,nit:R.target.value}),ph:"900.123.456-7"}),e.jsx(ot,{lbl:"Contacto",val:d.contacto,on:R=>c({...d,contacto:R.target.value}),ph:"Nombre persona"}),e.jsx(ot,{lbl:"Telfono",val:d.tel,on:R=>c({...d,tel:R.target.value}),ph:"+57 300..."}),e.jsx(ot,{lbl:"Email",val:d.email,on:R=>c({...d,email:R.target.value}),ph:"prov@email.com"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(ut,{on:()=>{v?(z(_.map(R=>R.id===v?{...R,...d}:R)),k(!1),m(null)):B()},style:{flex:1},children:[e.jsx(xt,{size:11})," ",v?"Guardar":"Aadir"]}),e.jsx(ut,{v:"sec",on:()=>{k(!1),m(null)},style:{flex:1},children:"Cancelar"})]})]})}),S&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>A(!1),children:e.jsxs("div",{onClick:R=>R.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:480,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(jt,{t:`Asignar proveedor a ${y.length} insumos`,s:"Elige proveedor y columna de cotizacin"}),_.length===0?e.jsx("div",{style:{padding:16,textAlign:"center",color:"#888",fontSize:12},children:"Primero aade proveedores"}):e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,marginBottom:8,color:"#555"},children:"A qu columna asignar?"}),P.map(R=>e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:he[R],textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:te[R]}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:_.map(ie=>e.jsx("button",{onClick:()=>le(ie.id,R),style:{padding:"6px 14px",border:`1px solid ${he[R]}44`,borderRadius:5,background:Q[R],color:he[R],fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:ie.nombre},ie.id))})]},R))]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ut,{v:"sec",on:()=>A(!1),style:{width:"100%"},children:"Cerrar"})})]})})]})}function Yh({d:t,set:i}){const o=t.orgNodos||[],n=A=>i("orgNodos",typeof A=="function"?A(o):A),[a,r]=F.useState(null),[s,g]=F.useState(!0),h={obra:{label:" Obra civil",nodes:[{id:"o1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"o2",parentId:"o1",nombre:"",cargo:"Director de Obra",color:"#2A5F8C",icon:""},{id:"o3",parentId:"o2",nombre:"",cargo:"Residente de Obra",color:"#5B8DB8",icon:""},{id:"o4",parentId:"o2",nombre:"",cargo:"Maestro de Obra",color:"#5B8DB8",icon:""},{id:"o5",parentId:"o2",nombre:"",cargo:"Almacenista",color:"#5B8DB8",icon:""},{id:"o6",parentId:"o1",nombre:"",cargo:"Directora de Diseo",color:"#8C5B2A",icon:""},{id:"o7",parentId:"o6",nombre:"",cargo:"Arquitecto",color:"#B88C5B",icon:""},{id:"o8",parentId:"o1",nombre:"",cargo:"Ing. HSE / SISO",color:"#8C2A2A",icon:""},{id:"o9",parentId:"o1",nombre:"",cargo:"Coord. Administrativo",color:"#6B5B8C",icon:""}]},diseno:{label:" Diseo interior",nodes:[{id:"d1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"d2",parentId:"d1",nombre:"",cargo:"Directora Creativa",color:"#8C5B2A",icon:""},{id:"d3",parentId:"d2",nombre:"",cargo:"Diseador Senior",color:"#B88C5B",icon:""},{id:"d4",parentId:"d2",nombre:"",cargo:"Diseador Junior",color:"#B88C5B",icon:""},{id:"d5",parentId:"d2",nombre:"",cargo:"Visualizador 3D",color:"#B88C5B",icon:""},{id:"d6",parentId:"d1",nombre:"",cargo:"Coord. Tcnico",color:"#2A5F8C",icon:""},{id:"d7",parentId:"d6",nombre:"",cargo:"Dibujante / Planos",color:"#5B8DB8",icon:""}]},mixto:{label:" Obra + Diseo",nodes:[{id:"m1",parentId:null,nombre:"",cargo:"Gerente de Proyecto",color:"#111111",icon:""},{id:"m2",parentId:"m1",nombre:"",cargo:"Director de Obra",color:"#2A5F8C",icon:""},{id:"m3",parentId:"m2",nombre:"",cargo:"Residente de Obra",color:"#5B8DB8",icon:""},{id:"m4",parentId:"m2",nombre:"",cargo:"Maestro de Obra",color:"#5B8DB8",icon:""},{id:"m5",parentId:"m2",nombre:"",cargo:"Almacenista",color:"#5B8DB8",icon:""},{id:"m6",parentId:"m1",nombre:"",cargo:"Directora de Diseo",color:"#8C5B2A",icon:""},{id:"m7",parentId:"m6",nombre:"",cargo:"Arquitecto",color:"#B88C5B",icon:""},{id:"m8",parentId:"m6",nombre:"",cargo:"Diseador Interior",color:"#B88C5B",icon:""},{id:"m9",parentId:"m1",nombre:"",cargo:"Ing. HSE / SISO",color:"#8C2A2A",icon:""},{id:"m10",parentId:"m1",nombre:"",cargo:"Coord. Administrativo",color:"#6B5B8C",icon:""},{id:"m11",parentId:"m1",nombre:"",cargo:"Coord. Compras",color:"#6B5B8C",icon:""}]},pequeno:{label:" Proyecto pequeo",nodes:[{id:"p1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"p2",parentId:"p1",nombre:"",cargo:"Arquitecto / Diseador",color:"#8C5B2A",icon:""},{id:"p3",parentId:"p1",nombre:"",cargo:"Maestro de Obra",color:"#2A5F8C",icon:""}]}},b=A=>{const E=h[A].nodes,w=E.map(z=>({...z,id:kt()})),_=E.map(z=>z.id);w.forEach((z,T)=>{const L=_.indexOf(E[T].parentId);z.parentId=L>=0?w[L].id:null}),n(w),r(null)},j=A=>{const E={id:kt(),parentId:A,nombre:"",cargo:"Nuevo cargo",color:"#555",icon:""};n([...o,E]),r(E.id)},k=A=>{const E=new Set([A]);let w=!0;for(;w;)w=!1,o.forEach(_=>{_.parentId&&E.has(_.parentId)&&!E.has(_.id)&&(E.add(_.id),w=!0)});n(o.filter(_=>!E.has(_.id))),a&&E.has(a)&&r(null)},v=(A,E,w)=>n(o.map(_=>_.id===A?{..._,[E]:w}:_)),m=o.filter(A=>!A.parentId),f=A=>o.filter(E=>E.parentId===A),p=A=>{let E=0,w=o.find(_=>_.id===A);for(;w!=null&&w.parentId;)E++,w=o.find(_=>_.id===w.parentId);return E},d=(()=>{const A=[],E=w=>{o.filter(_=>_.parentId===w).forEach(_=>{A.push(_),E(_.id)})};return m.forEach(w=>{A.push(w),E(w.id)}),A})(),c=["","","","","","","","","","","","","","","","","","","","","","","",""],l=["#111111","#2A5F8C","#8C5B2A","#8C2A2A","#6B5B8C","#5B8DB8","#B88C5B","#555","#2B7A52","#3B3B3B","#C44","#888"],x={border:`1px solid ${C.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},y=({node:A})=>{const E=f(A.id),w=a===A.id;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{background:"#fff",border:`2px solid ${A.color||"#555"}`,borderRadius:8,padding:"8px 12px",minWidth:120,maxWidth:180,textAlign:"center",cursor:"pointer",boxShadow:w?`0 0 0 3px ${A.color||"#555"}44`:"0 1px 6px rgba(0,0,0,0.06)"},onClick:()=>r(A.id),children:[e.jsx("div",{style:{fontSize:18,marginBottom:2},children:A.icon||""}),s&&A.nombre&&e.jsx("div",{style:{fontSize:11,fontWeight:700,color:C.ink,lineHeight:1.2},children:A.nombre}),e.jsx("div",{style:{fontSize:9,color:A.color||"#555",fontWeight:700,textTransform:"uppercase",letterSpacing:.4,lineHeight:1.3,marginTop:1},children:A.cargo})]}),E.length>0&&e.jsx("div",{style:{width:2,height:16,background:"#DDD"}}),E.length>0&&e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start",position:"relative"},children:[E.length>1&&e.jsx("div",{style:{position:"absolute",top:0,height:2,background:"#DDD",left:`${100/(E.length*2)}%`,right:`${100/(E.length*2)}%`}}),E.map(_=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:2,height:16,background:"#DDD"}}),e.jsx(y,{node:_})]},_.id))]})]})},u=()=>{const A=window.open("","_blank"),E="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:16px;padding-bottom:10px;border-bottom:3px solid #111}.logo{font-size:16px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}.org-container{display:flex;justify-content:center;padding:16px 0}.node{background:#fff;border:2px solid var(--c);border-radius:8px;padding:8px 14px;min-width:120px;max-width:180px;text-align:center;display:inline-flex;flex-direction:column;align-items:center}.node .icon{font-size:18px;margin-bottom:2px}.node .name{font-size:10px;font-weight:700;color:#111;line-height:1.2}.node .role{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:.4px;color:var(--c);line-height:1.2;margin-top:1px}.branch{display:flex;flex-direction:column;align-items:center}.children{display:flex;gap:12px;align-items:flex-start;position:relative}.vline{width:2px;height:16px;background:#DDD;margin:0 auto}.hline{position:absolute;top:0;height:2px;background:#DDD}.footer{margin-top:20px;padding-top:6px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}",w=z=>{const T=f(z.id);let L=`<div class="branch"><div class="node" style="--c:${z.color||"#555"}"><div class="icon">${z.icon||""}</div>`;return s&&z.nombre&&(L+=`<div class="name">${z.nombre}</div>`),L+=`<div class="role">${z.cargo}</div></div>`,T.length>0&&(L+='<div class="vline"></div><div class="children">',T.length>1&&(L+=`<div class="hline" style="left:${100/(T.length*2)}%;right:${100/(T.length*2)}%"></div>`),T.forEach(Z=>{L+=`<div class="branch"><div class="vline"></div>${w(Z)}</div>`}),L+="</div>"),L+="</div>",L};let _=`<html><head><title>Organigrama - ${t.codigoOferta||""}</title><style>${E}</style></head><body>`;_+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',_+='<div style="text-align:right"><div style="font-size:14px;font-weight:700">Organigrama del Proyecto</div>',_+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div>`,_+=`<div style="font-size:8px;color:#888;margin-top:2px">${o.length} integrantes</div></div></div>`,_+='<div class="org-container">',m.forEach(z=>{_+=w(z)}),_+="</div>",_+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Organigrama</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,_+="</body></html>",A.document.write(_),A.document.close(),setTimeout(()=>A.print(),400)},S=o.find(A=>A.id===a);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:C.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Organigrama del proyecto"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[o.length," integrantes"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:10,color:C.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:s,onChange:A=>g(A.target.checked)})," Mostrar nombres"]}),e.jsxs("button",{onClick:u,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Et,{size:11})," Vista PDF"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{width:300,flexShrink:0},children:[e.jsxs(Je,{style:{padding:"10px 12px",marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Plantilla"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4},children:Object.entries(h).map(([A,E])=>e.jsx("button",{onClick:()=>b(A),style:{padding:"6px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${C.border}`,borderRadius:4,background:"#fff",fontFamily:"'DM Sans',sans-serif",color:C.inkMid,textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:E.label},A))})]}),e.jsxs(Je,{style:{padding:"6px 0",maxHeight:520,overflowY:"auto"},children:[e.jsx("div",{style:{padding:"4px 12px 6px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,borderBottom:`1px solid ${C.border}`},children:"Cargos del proyecto"}),d.map(A=>{const E=p(A.id),w=a===A.id;return e.jsxs("div",{onClick:()=>r(w?null:A.id),style:{padding:"5px 10px 5px "+(12+E*16)+"px",display:"flex",alignItems:"center",gap:6,cursor:"pointer",background:w?"#F0F0F0":"transparent",borderLeft:w?`3px solid ${A.color||"#555"}`:"3px solid transparent",borderBottom:`1px solid ${C.border}`,transition:"background .1s"},children:[e.jsx("span",{style:{fontSize:14,flexShrink:0},children:A.icon||""}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:A.color||"#555",textTransform:"uppercase",letterSpacing:.3,lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:A.cargo}),e.jsx("div",{style:{fontSize:10,color:C.ink,lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:A.nombre||e.jsx("span",{style:{color:"#CCC",fontStyle:"italic"},children:"Sin asignar"})})]}),e.jsx("button",{onClick:_=>{_.stopPropagation(),j(A.id)},title:"Aadir subordinado",style:{background:"none",border:"none",cursor:"pointer",color:A.color||"#555",padding:2,fontSize:14},children:"+"})]},A.id)}),o.length===0&&e.jsx("div",{style:{padding:"16px 12px",textAlign:"center",color:"#CCC",fontSize:11},children:"Selecciona una plantilla o aade un cargo"}),e.jsx("div",{style:{padding:"6px 12px"},children:e.jsx("button",{onClick:()=>j(null),style:{width:"100%",padding:"5px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px dashed ${C.border}`,borderRadius:4,background:"#fff",color:C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir cargo raz"})})]}),S&&e.jsxs(Je,{style:{padding:14,marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:700,color:S.color||"#555"},children:["Editar: ",S.cargo]}),e.jsx("button",{onClick:()=>r(null),style:{background:"none",border:"none",cursor:"pointer",color:C.inkLight,padding:2},children:e.jsx($t,{size:14})})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Cargo"}),e.jsx("input",{value:S.cargo,onChange:A=>v(S.id,"cargo",A.target.value),style:{...x,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Nombre"}),e.jsx("input",{value:S.nombre||"",onChange:A=>v(S.id,"nombre",A.target.value),placeholder:"Nombre completo",style:{...x,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Contacto"}),e.jsx("input",{value:S.contacto||"",onChange:A=>v(S.id,"contacto",A.target.value),placeholder:"Tel o email",style:{...x,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Reporta a"}),e.jsxs("select",{value:S.parentId||"",onChange:A=>v(S.id,"parentId",A.target.value||null),style:{...x,width:"100%"},children:[e.jsx("option",{value:"",children:" Raz (sin jefe) "}),o.filter(A=>A.id!==S.id).map(A=>e.jsxs("option",{value:A.id,children:[A.cargo," ",A.nombre?`(${A.nombre})`:""]},A.id))]})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Icono"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:c.map(A=>e.jsx("button",{onClick:()=>v(S.id,"icon",A),style:{width:24,height:24,border:`1px solid ${S.icon===A?"#111":"#E0E0E0"}`,borderRadius:3,background:S.icon===A?"#F5F4F1":"#fff",cursor:"pointer",fontSize:12,display:"flex",alignItems:"center",justifyContent:"center"},children:A},A))})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Color"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:l.map(A=>e.jsx("button",{onClick:()=>v(S.id,"color",A),style:{width:20,height:20,borderRadius:3,background:A,cursor:"pointer",border:S.color===A?"2px solid #111":"2px solid #E0E0E0"}},A))})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>j(S.id),style:{flex:1,padding:"5px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${C.border}`,borderRadius:4,background:"#fff",color:C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Subordinado"}),e.jsx("button",{onClick:()=>k(S.id),style:{padding:"5px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:"1px solid #C44",borderRadius:4,background:"#FEE",color:"#C44",fontFamily:"'DM Sans',sans-serif"},children:e.jsx(He,{size:10})})]})]})]}),e.jsx(Je,{style:{flex:1,padding:20,overflowX:"auto",minHeight:300},children:o.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx(kd,{size:32,style:{color:C.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:C.inkLight,fontSize:13,margin:"0 0 12px"},children:"Selecciona una plantilla para comenzar"}),e.jsx("div",{style:{display:"flex",gap:6,justifyContent:"center",flexWrap:"wrap"},children:Object.entries(h).map(([A,E])=>e.jsx(ut,{sm:!0,v:"sec",on:()=>b(A),children:E.label},A))})]}):e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:8,paddingBottom:20},children:m.map(A=>e.jsx(y,{node:A},A.id))})})]})]})}function Xh({d:t,r:i}){const o=t.tipoProyecto==="OBRA",n=t.modoCalcObra||"margen",a=i.U||0,r=[{l:"Costo directo total (CD)",v:i.COSTO,b:!0},{l:" Materiales (M)",v:i.cdM,sub:!0},{l:" Mano de obra (MO)",v:i.cdMO,sub:!0},{l:" Subcontratas (SUB)",v:i.cdSB,sub:!0},...t.tipoProyecto==="DISEO"?[{l:" Diseo APU",v:i.costoDis,sub:!0}]:[],null,{l:"Gastos de contratacin (GC) "+it(i.g),v:i.GC},{l:" Plizas (RCE+TRC+Adm)",v:((t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0))*i.PVP,sub:!0},{l:" ICA",v:i.ICA,sub:!0},{l:"Gastos financieros (GF) "+it(i.f),v:i.fin},null,{l:`Margen objetivo ${it(t.margen)}`,v:i.margenCOP,b:!0,col:C.success},...o?[{l:` Utilidad declarada para IVA (U): ${it(a)}${n==="aiu"?" (AIU)":" (manual)"}`,v:a*i.PVP,sub:!0,col:"#3B3B3B"},{l:n==="aiu"?` AIU: A ${it(t.aiuA||.08)} + I ${it(t.aiuI||.03)} + U ${it(t.aiuU||.07)} = ${it((t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))}`:` Margen ${it(t.margen)} sobre PVP  U para IVA: ${it(a)}`,v:null,sub:!0,note:!0}]:[],null,{l:"PVP sin IVA",v:i.PVP,b:!0},{l:o?`IVA ${it(t.tarifaIVA)} sobre U ${it(a)} del PVP`:t.pais==="ES"?`IVA ${it(t.tarifaIVA)} (Espaa)`:`IVA ${it(t.tarifaIVA)} pleno (DISEO)`,v:i.IVA,sub:!0},{l:"PVP con IVA",v:i.PVP_IVA,b:!0,col:C.ink}];return e.jsxs("div",{className:"fade",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(Je,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${C.border}`},children:e.jsx(jt,{t:"Desglose de costos",s:"Construccin del precio de venta"})}),e.jsx("div",{style:{padding:"6px 0"},children:r.map((s,g)=>s===null?e.jsx("div",{style:{borderTop:`1px solid ${C.border}`,margin:"6px 0"}},g):e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"7px 20px",background:s.b&&!s.sub?C.accentBg:""},children:[e.jsx("span",{style:{fontSize:s.sub?11:12,color:s.col||C.inkMid,paddingLeft:s.sub?12:0,fontWeight:s.b?700:400},children:s.l}),s.v!=null&&e.jsx("span",{style:{fontSize:s.sub?11:12,color:s.col||C.ink,fontWeight:s.b?700:500,fontFamily:"'DM Mono',monospace"},children:Ye(s.v)})]},g))}),e.jsxs("div",{style:{borderTop:`2px solid ${C.border}`,padding:"14px 20px",background:"#F5F4F1"},children:[e.jsx("p",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,margin:"0 0 8px"},children:"Coeficientes aplicados"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8},children:[["Den. (1MGC)",(i.den1||0).toFixed(4)],["Den. (1GF)",(i.denGF||0).toFixed(4)],["Den. total",(i.den||0).toFixed(4)],["Coef. ",(i.coefMult||0).toFixed(4)]].map(([s,g])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"#999",marginBottom:2},children:s}),e.jsx("div",{style:{fontSize:11,fontWeight:600,fontFamily:"'DM Mono',monospace"},children:g})]},s))})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{style:{background:C.ink,borderRadius:3,padding:"28px 28px"},children:[e.jsx("p",{style:{margin:"0 0 6px",fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:"rgba(255,255,255,0.4)"},children:"PVP Total al cliente"}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:40,fontWeight:700,color:"#fff",margin:"0 0 10px",letterSpacing:-1},children:Ye(i.PVP_IVA)}),e.jsxs("p",{style:{fontSize:10,color:"rgba(255,255,255,0.4)",margin:0},children:["IVA ",it(t.tarifaIVA),"  Modo ",t.tipoProyecto,o&&`  U declarada ${it(a)}`,t.tipoProyecto==="DISEO"&&`  ${t.subtipoDiseno}`]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[["PVP sin IVA",Ye(i.PVP),C.ink],["IVA",Ye(i.IVA),C.info],["Margen ("+it(t.margen)+")",Ye(i.margenCOP),C.success],...o?[["Utilidad decl. ("+it(a)+")",Ye(a*i.PVP),"#3B3B3B"]]:[],["Retenciones",Ye(i.ret),C.warning],["Neto a recibir",Ye(i.neto),C.ink]].map(([s,g,h])=>e.jsxs(Je,{style:{padding:"13px 16px"},children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:1},children:s}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:h,margin:0},children:g})]},s))}),e.jsxs(Je,{style:{padding:16},children:[e.jsx("p",{style:{fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,margin:"0 0 10px"},children:"Parmetros aplicados"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:[`Margen ${it(t.margen)}`,...o?[`U decl. ${it(a)}`]:[],`IVA ${it(t.tarifaIVA)}`,t.medioPago,t.aplicar4x1000==="SI"?"41000":"Sin 41000",`GC ${it(i.g||0)}`,`GF ${it(i.f||0)}`,`Coef. ${(i.coefMult||0).toFixed(4)}`].map(s=>e.jsx("span",{style:{background:C.accentBg,color:C.inkMid,fontSize:10,padding:"3px 8px",borderRadius:2,letterSpacing:.4},children:s},s))})]})]})]})}function Qh({d:t,set:i,r:o}){var ce,V,Y;const n=(W,se)=>t["ent_"+W]??se,a=(W,se)=>i("ent_"+W,se),r=t.tipoProyecto==="OBRA",s=t.condPct4??.1,g=(W,se,ge=3)=>e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:n(W,se),rows:ge,onChange:ue=>a(W,ue.target.value),style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical",lineHeight:1.5,background:C.bg,color:C.ink}}),e.jsx("div",{className:"ptr",style:{fontSize:12,lineHeight:1.6},children:n(W,se)})]}),h=(W,se)=>e.jsx("input",{value:n(W,se),onChange:ge=>a(W,ge.target.value),style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:4,padding:"7px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:C.bg,color:C.ink}}),b=W=>e.jsx("p",{className:"no-print",style:{fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,margin:"0 0 5px"},children:W}),j=W=>e.jsx("p",{style:{fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:1,margin:"0 0 5px"},children:W}),[k,v]=F.useState(t.ent_nivelDetalle||"capitulos"),m=W=>{v(W),i("ent_nivelDetalle",W)},[f,p]=F.useState(t.ent_inclCrono??!1),[d,c]=F.useState(t.ent_inclOrganigrama??!1),l=(W,se,ge)=>{ge(se),i("ent_"+W,se)},x=t.borradorLineas||[],u=x.filter(W=>W.esCapitulo).map(W=>{const se=x.indexOf(W),ge=x.findIndex((be,I)=>I>se&&be.esCapitulo),ue=x.slice(se+1,ge===-1?x.length:ge).filter(be=>!be.esCapitulo),ye=ue.reduce((be,I)=>{const N=I.precioCD?qt(I.precioCD,I.cantidad||1,t):null;return be+(N?N.totalVenta:0)},0);return{...W,total:ye,items:ue}}),S=t.firmaRepresentante||"David Parra Galera",A=S==="Ana Mara Daz Buitrago"?"Directora Creativa y de Diseo":"Director Ejecutivo y de Produccin",E=n("titulo",r?"PRESUPUESTO DE EJECUCIN":"PROPUESTA DE DISEO"),w=n("ref",t.codigoOferta||""),_=n("cliente",t.cliente||""),z=n("fecha",t.fechaOferta||Dt()),T=t.revision||1,L=()=>{const se=[w,t.proyecto||"Habitaris",`Rev${T}`].filter(Boolean).join("_").replace(/[^a-zA-Z0-9_\-]/g,"_");document.title=se,window.print(),setTimeout(()=>{document.title="Habitaris Suite"},1500)},Z=W=>{const ge={obra_integral:{titulo:"PRESUPUESTO DE EJECUCIN",alcance:`El presente alcance comprende la ejecucin integral del proyecto ${t.proyecto||""}, incluyendo:

1. OBRA CIVIL: Demoliciones selectivas, mampostera, paetes, nivelacin de pisos y cielos.
2. INSTALACIONES: Red hidrosanitaria, red elctrica y puntos de datos segn planos tcnicos aprobados.
3. ACABADOS: Suministro e instalacin de pisos, enchapes, pintura, carpintera en madera y metlica.
4. MOBILIARIO FIJO: Cocina integral, closets, muebles de bao y dems mobiliario fijo segn diseo.
5. SUPERVISIN: Direccin de obra, control de calidad, coordinacin de subcontratistas y proveedores.

El proyecto se ejecutar en la direccin ${t.ubicacion||"___"} conforme a los diseos previamente aprobados por el cliente.`,fases:`1. Firma de contrato y pago de anticipo
2. Acta de inicio de obra
3. Demoliciones y obra negra
4. Instalaciones tcnicas (hidrosanitaria, elctrica, gas)
5. Obra gris (paetes, nivelacin, impermeabilizacin)
6. Acabados (pisos, enchapes, pintura)
7. Carpintera y mobiliario fijo
8. Aseo final y entrega
9. Acta de recepcin y cierre`,exclusiones:`Esta propuesta NO incluye, salvo acuerdo escrito:

- Licencias y permisos de construccin
- Obra de estructura o cimentacin no contemplada en diseos
- Suministro e instalacin de electrodomsticos
- Mudanzas y trasteos
- Diseo o rediseo (ya aprobado previamente)
- Adecuaciones en zonas comunes del edificio
- Amoblamiento libre (sofs, camas, mesas, sillas)

Todos los entregables se comparten exclusivamente en formato digital.`,condPago:`Forma de pago:

1. ${((t.condPct1||.5)*100).toFixed(0)}% Anticipo contra firma de contrato
2. ${((t.condPct2||.3)*100).toFixed(0)}% Contra avance del 50% de obra
3. ${((t.condPct3||.1)*100).toFixed(0)}% Contra finalizacin de obra
4. ${(s*100).toFixed(0)}% Retencin de garanta (a 3 meses)`,plazo:`El plazo de ejecucin estimado es de ${t.plazoSemanas||12} semanas calendario contadas a partir del acta de inicio de obra.`,garantias:`Habitaris garantiza los trabajos ejecutados por un perodo de 12 meses contados a partir del acta de entrega final:

- Estabilidad y solidez de obra civil: 10 aos segn Ley 1796 de 2016
- Impermeabilizacin: 5 aos
- Acabados y revestimientos: 1 ao
- Instalaciones hidrosanitarias y elctricas: 1 ao
- Carpintera y mobiliario fijo: 1 ao

La garanta no cubre daos por uso inadecuado, modificaciones del cliente o fuerza mayor.`},obra_parcial:{titulo:"PRESUPUESTO DE EJECUCIN PARCIAL",alcance:`El presente alcance comprende la ejecucin parcial de obras en el proyecto ${t.proyecto||""}, limitado a las partidas descritas en el presupuesto adjunto.

Los trabajos se realizarn conforme a los planos y especificaciones tcnicas proporcionados por el cliente o su equipo de diseo.

Habitaris actuar como ejecutor de las obras descritas, sin responsabilidad sobre el diseo ni sobre partidas no incluidas en esta propuesta.`,fases:`1. Firma de contrato y pago de anticipo
2. Programacin y alistamiento de obra
3. Ejecucin de partidas contratadas
4. Control de calidad y verificacin
5. Entrega y acta de recepcin`,exclusiones:`Esta propuesta NO incluye:

- Diseo arquitectnico o de interiores
- Partidas no listadas explcitamente en el presupuesto
- Licencias, permisos o trmites ante entidades
- Interventora externa
- Suministro de electrodomsticos o amoblamiento

Cualquier trabajo adicional ser cotizado por separado.`,condPago:`Forma de pago:

1. ${((t.condPct1||.5)*100).toFixed(0)}% Anticipo contra firma de contrato
2. ${((t.condPct2||.3)*100).toFixed(0)}% Contra avance del 50%
3. ${((t.condPct3||.1)*100).toFixed(0)}% Contra finalizacin
4. ${(s*100).toFixed(0)}% Retencin de garanta`,plazo:`El plazo de ejecucin estimado es de ${t.plazoSemanas||8} semanas calendario.`,garantias:"Garanta de 12 meses sobre los trabajos ejecutados, contados desde el acta de entrega."},diseno_int:{titulo:"PROPUESTA DE DISEO INTERIOR",alcance:`Diseo interior integral del proyecto ${t.proyecto||""} ubicado en ${t.ubicacion||"___"}.

El servicio incluye:

1. LEVANTAMIENTO: Visita tcnica, toma de medidas y registro fotogrfico del estado actual.
2. CONCEPTUALIZACIN: Desarrollo de concepto de diseo, moodboards, paleta de materiales y colores.
3. DISEO BSICO: Plantas de distribucin, propuesta de mobiliario, iluminacin general.
4. DISEO DETALLADO: Planos tcnicos de construccin (plantas, cortes, detalles), especificaciones de acabados, cuadros de cantidades.
5. RENDERS: Visualizaciones 3D de los espacios principales.
6. ACOMPAAMIENTO: Seguimiento durante la ejecucin de obra.`,fases:`1. Firma de contrato y anticipo
2. Levantamiento y mediciones
3. Concepto de diseo y moodboard
4. Presentacin de diseo bsico
5. Aprobacin del cliente
6. Desarrollo de planos tcnicos
7. Entrega de planos y especificaciones
8. Acompaamiento en obra (si aplica)`,exclusiones:`Esta propuesta NO incluye:

- Ejecucin de obra civil o instalaciones
- Suministro o compra de materiales, mobiliario o equipos
- Diseo estructural o de ingeniera especializada
- Renders adicionales a los incluidos
- Trmites de licencias urbansticas
- Interventora de obra

Todos los entregables se comparten en formato digital.`,condPago:`Forma de pago:

1. 50% Anticipo contra firma de contrato
2. 30% Contra entrega de diseo bsico aprobado
3. 20% Contra entrega de planos tcnicos finales`,plazo:`El plazo de desarrollo es de ${t.plazoSemanas||6} semanas a partir de la aprobacin del concepto.`,garantias:"Los entregables de diseo se entregan en formato digital editable. Se incluyen hasta 2 rondas de ajustes por etapa. Modificaciones adicionales se cotizarn por separado."},diseno_arq:{titulo:"PROPUESTA DE DISEO ARQUITECTNICO",alcance:`Diseo arquitectnico del proyecto ${t.proyecto||""} ubicado en ${t.ubicacion||"___"}.

1. ESQUEMA BSICO: Anlisis del programa, zonificacin, volumetra.
2. ANTEPROYECTO: Plantas, fachadas, cortes y perspectivas.
3. PROYECTO: Planos definitivos, detalles constructivos, memorias.
4. COORDINACIN: Integracin con ingenieras.`,fases:`1. Visita al sitio y levantamiento
2. Programa arquitectnico
3. Esquema bsico
4. Anteproyecto
5. Proyecto definitivo
6. Coordinacin tcnica
7. Entrega final`,exclusiones:"NO incluye estudios de suelos, topografa, diseo estructural, hidrosanitario, elctrico, licencias de construccin ni ejecucin de obra.",condPago:`1. 40% Anticipo
2. 30% Contra entrega de anteproyecto
3. 30% Contra entrega de proyecto definitivo`,plazo:`Plazo estimado: ${t.plazoSemanas||8} semanas.`,garantias:"Entregables en formato digital. 2 rondas de ajustes incluidas por etapa."},consultoria:{titulo:"PROPUESTA DE CONSULTORA",alcance:`Consultora especializada para el proyecto ${t.proyecto||""}.

1. Diagnstico y anlisis del estado actual
2. Propuesta de intervencin con alternativas
3. Estimacin presupuestal
4. Informe tcnico con recomendaciones
5. Acompaamiento en la toma de decisiones`,fases:`1. Reunin de inicio
2. Visita tcnica
3. Anlisis y diagnstico
4. Presentacin de alternativas
5. Informe final`,exclusiones:"NO incluye desarrollo de planos tcnicos, ejecucin de obras ni compra de materiales.",condPago:`1. 50% Anticipo
2. 50% Contra entrega de informe final`,plazo:`Plazo estimado: ${t.plazoSemanas||4} semanas.`,garantias:"Informe entregado en formato digital."},custom:{titulo:"",alcance:"",fases:"",exclusiones:"",condPago:"",plazo:"",garantias:""}}[W];ge&&(ge.titulo&&a("titulo",ge.titulo),a("alcance",ge.alcance),a("fases",ge.fases),a("exclusiones",ge.exclusiones),ge.condPago&&a("condPago",ge.condPago),ge.plazo&&a("plazo",ge.plazo),ge.garantias&&a("garantias",ge.garantias))},K=()=>{const W=window.open("","_blank"),se=`@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    @page{size:A4 portrait;margin:15mm 18mm}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'DM Sans',sans-serif;color:#1A1A1A;font-size:10px;line-height:1.6}
    .cover{min-height:100vh;display:flex;flex-direction:column;justify-content:space-between;padding:40px 50px;page-break-after:always}
    .cover-brand{border-bottom:3px solid #111;padding-bottom:16px}
    .cover-brand h1{font-size:36px;font-weight:800;letter-spacing:10px;text-transform:uppercase}
    .cover-brand p{font-size:8px;letter-spacing:3px;color:#888;text-transform:uppercase;margin-top:4px}
    .cover-title{margin:80px 0}
    .cover-title h2{font-size:26px;font-weight:700;letter-spacing:3px;text-transform:uppercase;line-height:1.3;color:#111}
    .cover-title .ref{font-size:13px;color:#666;margin-top:10px}
    .cover-info{font-size:12px;color:#444;line-height:2}
    .cover-info strong{color:#111}
    .cover-footer{border-top:1px solid #DDD;padding-top:16px;text-align:center}
    .cover-footer p{font-size:8px;color:#999;letter-spacing:1px}
    .toc{padding:40px 50px;page-break-after:always}
    .toc h2{font-size:18px;font-weight:700;letter-spacing:3px;text-transform:uppercase;border-bottom:3px solid #111;padding-bottom:8px;margin-bottom:24px}
    .toc-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dotted #CCC;font-size:12px}
    .toc-item span:first-child{font-weight:600}
    .toc-item span:last-child{font-family:'DM Mono',monospace;color:#888;font-size:10px}
    .page{padding:30px 50px;page-break-after:always;min-height:90vh}
    .page-header{display:flex;justify-content:space-between;align-items:flex-end;padding-bottom:8px;border-bottom:2px solid #111;margin-bottom:20px}
    .page-header .brand{font-weight:700;font-size:12px;letter-spacing:4px}
    .page-header .meta{text-align:right;font-size:8px;color:#666}
    .section-title{font-size:16px;font-weight:700;letter-spacing:1px;color:#111;margin:20px 0 10px;padding-bottom:4px;border-bottom:1px solid #E0E0E0}
    .section-num{color:#888;font-weight:400;margin-right:8px}
    .content{font-size:11px;line-height:1.8;color:#333;white-space:pre-wrap}
    table{width:100%;border-collapse:collapse;margin:10px 0}
    th{background:#F5F4F1;padding:8px 12px;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;letter-spacing:.5px;text-align:left;border-bottom:2px solid #DDD}
    td{padding:7px 12px;font-size:10px;border-bottom:1px solid #F5F5F5}
    .mono{font-family:'DM Mono',monospace}
    .r{text-align:right}
    .bold{font-weight:700}
    .total-row{background:#111;color:#fff}
    .total-row td{color:#fff;font-weight:700;font-size:12px;padding:10px 12px}
    .iva-row{background:#F5F4F1}
    .sign-block{margin-top:40px;display:grid;grid-template-columns:1fr 1fr;gap:40px}
    .sign-box{text-align:center;padding-top:40px;border-top:1px solid #111}
    .sign-box .name{font-size:11px;font-weight:700}
    .sign-box .role{font-size:9px;color:#666}
    .doc-footer{position:fixed;bottom:10mm;left:18mm;right:18mm;display:flex;justify-content:space-between;font-size:7px;color:#AAA;border-top:1px solid #E0E0E0;padding-top:4px}`,ge=`<div class="page-header"><div class="brand">HABITARIS</div><div class="meta"><div>${E}</div><div>${w}  Rev.${T}  ${z}</div></div></div>`;let ue=`<html><head><title>${w} - ${t.proyecto||"Habitaris"}</title><style>${se}</style></head><body>`;ue+='<div class="cover">',ue+='<div class="cover-brand"><h1>HABITARIS</h1><p>Arquitectura  Interiorismo  Construccin</p></div>',ue+=`<div class="cover-title"><h2>${E}</h2>`,ue+=`<div class="ref">${w}  Revisin ${T}</div></div>`,ue+='<div class="cover-info">',_&&(ue+=`<div><strong>Cliente:</strong> ${_}</div>`),t.proyecto&&(ue+=`<div><strong>Proyecto:</strong> ${t.proyecto}</div>`),t.ubicacion&&(ue+=`<div><strong>Ubicacin:</strong> ${t.ubicacion}</div>`),ue+=`<div><strong>Fecha:</strong> ${z}</div>`,ue+="<div><strong>Vigencia:</strong> 30 das calendario</div></div>",ue+='<div class="cover-footer"><p>Habitaris S.A.S  NIT 901.922.136-8  Bogot D.C.</p><p>Documento confidencial  Uso exclusivo del destinatario</p></div>',ue+="</div>";let ye=0;const be=[];be.push("Alcance del servicio"),r&&be.push("Fases del proyecto"),be.push("Exclusiones"),be.push("Presupuesto"),t.ent_inclCondPago!==!1&&be.push("Condiciones de pago"),t.ent_inclGarantias!==!1&&be.push("Plazo y garantas"),be.push("Trminos y condiciones"),be.push("Firma de aceptacin"),ue+='<div class="toc"><h2>Contenido</h2>',be.forEach((I,N)=>{ue+=`<div class="toc-item"><span>${N+1}. ${I}</span><span>${N+2}</span></div>`}),ue+="</div>",ue+=`<div class="page">${ge}`,ye++,ue+=`<div class="section-title"><span class="section-num">${ye}.</span>Alcance del servicio</div>`,ue+=`<div class="content">${n("alcance","")}</div>`,r&&(ye++,ue+=`<div class="section-title"><span class="section-num">${ye}.</span>Fases del proyecto</div>`,ue+=`<div class="content">${n("fases","")}</div>`),ye++,ue+=`<div class="section-title"><span class="section-num">${ye}.</span>Exclusiones</div>`,ue+=`<div class="content">${n("exclusiones","")}</div>`,ue+="</div>",ue+=`<div class="page">${ge}`,ye++,ue+=`<div class="section-title"><span class="section-num">${ye}.</span>Presupuesto</div>`,k==="total"?(ue+='<table><thead><tr><th>Item</th><th>Descripcin</th><th class="r">Valor</th></tr></thead><tbody>',ue+=`<tr><td>1</td><td>${n("descTotal",t.proyecto||"Proyecto")}</td><td class="mono r bold">${Ye(o.PVP)}</td></tr>`,ue+=`<tr class="iva-row"><td colspan="2">${r?"IVA sobre la utilidad":`IVA ${it(t.tarifaIVA)}`}</td><td class="mono r">${Ye(o.IVA)}</td></tr>`,ue+=`<tr class="total-row"><td colspan="2">VALOR TOTAL</td><td class="mono r">${Ye(o.PVP_IVA)}</td></tr>`,ue+="</tbody></table>"):k==="capitulos"?(ue+='<table><thead><tr><th>Item</th><th>Descripcin</th><th class="r">Total</th></tr></thead><tbody>',u.forEach((I,N)=>{ue+=`<tr><td class="bold">${N+1}</td><td class="bold">${I.nombre||"Captulo "+(N+1)}</td><td class="mono r bold">${Ye(I.total)}</td></tr>`}),ue+=`<tr style="border-top:2px solid #111;background:#FFFFFF"><td colspan="2" class="bold">Subtotal</td><td class="mono r bold">${Ye(o.PVP)}</td></tr>`,ue+=`<tr class="iva-row"><td colspan="2">${r?"IVA sobre la utilidad":`IVA ${it(t.tarifaIVA)}`}</td><td class="mono r">${Ye(o.IVA)}</td></tr>`,ue+=`<tr class="total-row"><td colspan="2">VALOR TOTAL</td><td class="mono r">${Ye(o.PVP_IVA)}</td></tr>`,ue+="</tbody></table>"):(ue+='<table><thead><tr><th>#</th><th>Descripcin</th><th class="r">Und</th><th class="r">Cant</th><th class="r">P.U.</th><th class="r">Total</th></tr></thead><tbody>',u.forEach((I,N)=>{ue+=`<tr style="background:#F5F4F1"><td class="bold" colspan="5">${N+1}. ${I.nombre||""}</td><td class="mono r bold">${Ye(I.total)}</td></tr>`,(I.items||[]).forEach((q,J)=>{const R=q.precioCD?qt(q.precioCD,q.cantidad||1,t):null;ue+=`<tr><td>${N+1}.${J+1}</td><td>${q.descripcion||""}</td><td class="r">${q.und||"ud"}</td>`,ue+=`<td class="mono r">${q.cantidad||1}</td><td class="mono r">${R?Ye(R.puVenta):""}</td><td class="mono r">${R?Ye(R.totalVenta):""}</td></tr>`})}),ue+=`<tr style="border-top:2px solid #111;background:#FFFFFF"><td colspan="5" class="bold">Subtotal</td><td class="mono r bold">${Ye(o.PVP)}</td></tr>`,ue+=`<tr class="iva-row"><td colspan="5">${r?"IVA sobre la utilidad":`IVA ${it(t.tarifaIVA)}`}</td><td class="mono r">${Ye(o.IVA)}</td></tr>`,ue+=`<tr class="total-row"><td colspan="5">VALOR TOTAL</td><td class="mono r">${Ye(o.PVP_IVA)}</td></tr>`,ue+="</tbody></table>"),ue+='<div style="margin-top:16px;padding:10px 14px;background:#F5F4F1;border-radius:4px;font-size:9px;color:#666">',ue+=`Valores expresados en ${t.divisa||"COP"}. ${r?"IVA calculado sobre la utilidad segn normativa colombiana.":"IVA incluido segn tarifa vigente."} Propuesta vlida por 30 das calendario.</div>`,ue+="</div>",t.ent_inclCondPago!==!1&&(ue+=`<div class="page">${ge}`,ye++,ue+=`<div class="section-title"><span class="section-num">${ye}.</span>Condiciones de pago</div>`,ue+=`<div class="content">${n("condPago","")}</div>`),t.ent_inclGarantias!==!1&&(t.ent_inclCondPago===!1&&(ue+=`<div class="page">${ge}`),ye++,ue+=`<div class="section-title"><span class="section-num">${ye}.</span>Plazo y garantas</div>`,ue+=`<div class="content">${n("plazo","")}</div>`,ue+=`<div style="margin-top:10px" class="content">${n("garantias","")}</div>`),ye++,ue+=`<div class="section-title"><span class="section-num">${ye}.</span>Trminos y condiciones</div>`,ue+=`<div class="content">${n("terminos",`Los precios incluyen materiales, mano de obra, herramienta y administracin segn lo descrito en el alcance.

Cualquier trabajo no contemplado en esta propuesta se cotizar como adicional previo a su ejecucin y deber ser aprobado por escrito.

El cronograma propuesto podr ajustarse por causas de fuerza mayor, cambios solicitados por el cliente o condiciones no previstas del inmueble.`)}</div>`,(t.ent_inclCondPago!==!1||t.ent_inclGarantias!==!1)&&(ue+="</div>"),ue+=`<div class="page">${ge}`,ye++,ue+=`<div class="section-title"><span class="section-num">${ye}.</span>Firma de aceptacin</div>`,ue+='<div style="font-size:11px;line-height:1.8;color:#333;margin:16px 0 30px">',ue+="Con la firma del presente documento, el Cliente acepta los trminos y condiciones descritos en esta propuesta, ",ue+="y autoriza a Habitaris S.A.S. a proceder con la ejecucin del servicio de acuerdo al alcance, presupuesto y plazos aqu establecidos.</div>",ue+='<div class="sign-block">',ue+=`<div class="sign-box"><div class="name">${S}</div><div class="role">${A}</div><div style="font-size:8px;color:#888;margin-top:2px">Habitaris S.A.S.  NIT 901.922.136-8</div></div>`,ue+=`<div class="sign-box"><div class="name">${_||"________________________"}</div><div class="role">Cliente</div><div style="font-size:8px;color:#888;margin-top:2px">Firma y fecha de aceptacin</div></div>`,ue+="</div>",ue+='<div style="margin-top:40px;padding:14px;background:#F5F4F1;border-radius:4px;font-size:9px;color:#666;text-align:center">',ue+="Habitaris S.A.S.  NIT 901.922.136-8  Bogot D.C., Colombia<br/>",ue+="info@habitaris.co  +57 318 381 8736  www.habitaris.co</div>",ue+="</div>",ue+="</body></html>",W.document.write(ue),W.document.close(),setTimeout(()=>W.print(),500)},[P,te]=F.useState([]),[he,Q]=F.useState([]),[Se,ae]=F.useState(!0),[U,M]=F.useState(""),[B,H]=F.useState(t.wf_usuario||"david");F.useEffect(()=>{(async()=>{if(!t.id){ae(!1);return}const[W,se]=await Promise.all([Dl.getByOferta(t.id),Hu.getByOferta(t.id)]);te(W),Q(se),ae(!1)})()},[t.id]);const ee=F.useMemo(()=>{if(P.length===0)return"borrador";const W=P[P.length-1];return W.accion==="solicitar"?"pendiente_aprobacion":W.accion==="aprobar_interno"?"aprobada_internamente":W.accion==="devolver_interno"?"devuelta_internamente":W.accion==="enviar"?"enviada":W.accion==="aprobar_cliente"?"aprobada_cliente":W.accion==="rechazar_cliente"?"rechazada_cliente":W.accion==="devolver_cliente"?"devuelta_cliente":W.accion==="reenviar"?"enviada":"borrador"},[P]),D=en.find(W=>W.id===B),O=(()=>{if(B==="david")return en.find(se=>se.id==="ana");if(B==="ana")return en.find(se=>se.id==="david");const W=t.firmaRepresentante||"David Parra Galera";return en.find(se=>se.nombre===W)||en[0]})(),le=async(W,se={})=>{const ge=await Dl.add({ofertaId:t.id,tipo:W.includes("cliente")?"cliente":"interna",revision:T,accion:W,por:{id:B,nombre:(D==null?void 0:D.nombre)||B,cargo:(D==null?void 0:D.cargo)||""},comentarios:U,...se});te(ue=>[...ue,ge]),M(""),W==="aprobar_cliente"&&i("estado","Ganada"),W==="rechazar_cliente"&&i("estado","Perdida"),(W==="enviar"||W==="reenviar")&&i("estado","Presentada"),W==="solicitar"&&i("estado","En revisin"),W==="solicitar"&&await Gu.add({tipo:"aprobacion",ofertaId:t.id,mensaje:`${D==null?void 0:D.nombre} solicita aprobacin de ${w}`,para:O==null?void 0:O.id})},re=async()=>{const W={ref:w,titulo:E,cliente:_,proyecto:t.proyecto||"",ubicacion:t.ubicacion||"",fecha:z,revision:T,pvp:o.PVP,pvpIva:o.PVP_IVA,iva:o.IVA,divisa:t.divisa||"COP",alcance:n("alcance",""),fases:n("fases",""),exclusiones:n("exclusiones",""),condPago:n("condPago",""),plazo:n("plazo",""),garantias:n("garantias",""),terminos:n("terminos",""),notaLegal:n("notaLegal",""),firmante:S,clienteEmail:t.emailCliente||"",telHabitaris:"573183818736"},se=t.wf_lastPortalToken||null,ge=await Xu(t.id,W,T,se);return Q(ue=>[...ue,ge]),await le("enviar",{portalToken:ge.token}),i("wf_lastPortalUrl",ge.portalUrl),i("wf_lastPortalToken",ge.token),ge},de={borrador:{label:"Borrador",color:"#888",icon:"",desc:"En elaboracin"},pendiente_aprobacion:{label:"Pendiente aprobacin",color:"#D4840A",icon:"",desc:`Esperando aprobacin de ${(O==null?void 0:O.nombre)||""}`},devuelta_internamente:{label:"Devuelta con cambios",color:"#B91C1C",icon:"",desc:"Requiere correcciones antes de aprobar"},aprobada_internamente:{label:"Aprobada internamente",color:"#111111",icon:"",desc:"Lista para enviar al cliente"},enviada:{label:"Enviada al cliente",color:"#3B3B3B",icon:"",desc:"Esperando respuesta del cliente"},aprobada_cliente:{label:"Aprobada por cliente",color:"#111111",icon:"",desc:"Oferta ganada!"},rechazada_cliente:{label:"Rechazada por cliente",color:"#B91C1C",icon:"",desc:"Cliente rechaz la propuesta"},devuelta_cliente:{label:"Devuelta por cliente",color:"#D4840A",icon:"",desc:"Cliente solicita cambios"}},G=de[ee]||de.borrador;return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{className:"p-cover",children:[e.jsxs("div",{style:{borderBottom:"2pt solid #111",paddingBottom:16,marginBottom:40,width:"100%"},children:[e.jsx("div",{style:{fontFamily:"'DM Sans',sans-serif",fontWeight:800,fontSize:32,letterSpacing:8,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:9,letterSpacing:3,color:"#999",textTransform:"uppercase",marginTop:4},children:"Arquitectura  Interiorismo  Construccin"})]}),e.jsxs("div",{style:{marginTop:60,marginBottom:60},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700,letterSpacing:2,textTransform:"uppercase",lineHeight:1.3},children:E}),w&&e.jsxs("div",{style:{fontSize:13,color:"#666",marginTop:8},children:[w,"  Revisin ",T]})]}),e.jsxs("div",{style:{marginTop:40,fontSize:12,color:"#555",lineHeight:1.8},children:[_&&e.jsxs("div",{children:[e.jsx("strong",{children:"Cliente:"})," ",_]}),t.proyecto&&e.jsxs("div",{children:[e.jsx("strong",{children:"Proyecto:"})," ",t.proyecto]}),t.ubicacion&&e.jsxs("div",{children:[e.jsx("strong",{children:"Ubicacin:"})," ",t.ubicacion]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",z]})]}),e.jsxs("div",{style:{marginTop:"auto",paddingTop:60,borderTop:"1pt solid #DDD",width:"100%",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:9,color:"#999",letterSpacing:1},children:"Habitaris S.A.S  NIT 901.922.136-8  Bogot D.C."}),e.jsx("div",{style:{fontSize:8,color:"#BBB",marginTop:4},children:"Documento confidencial  Uso exclusivo del destinatario"})]})]}),e.jsxs("div",{className:"print-only print-page-break",style:{paddingTop:20},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700,letterSpacing:2,textTransform:"uppercase",borderBottom:"2pt solid #111",paddingBottom:6,marginBottom:20},children:"Contenido"}),e.jsxs("div",{style:{fontSize:11,lineHeight:2.2},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsx("span",{style:{fontWeight:600},children:"1. Alcance del servicio"})}),r&&e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsx("span",{style:{fontWeight:600},children:"2. Fases del proyecto"})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"3":"2",". Exclusiones"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"4":"3",". Presupuesto"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"5":"4",". Formas de pago"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"6":"5",". Plazo y garantas"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"7":"6",". Trminos y condiciones"]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"1px dotted #CCC",padding:"2px 0"},children:e.jsxs("span",{style:{fontWeight:600},children:[r?"8":"7",". Firma de aceptacin"]})})]})]}),e.jsxs(Je,{className:"no-print",style:{padding:0,marginBottom:16,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"14px 20px",background:"#F5F4F1",borderBottom:`1px solid ${C.border}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:10},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Plantilla del servicio"}),e.jsx("div",{style:{display:"flex",gap:0},children:[{id:"obra_integral",lbl:" Obra integral",tipo:"OBRA"},{id:"obra_parcial",lbl:" Obra parcial",tipo:"OBRA"},{id:"diseno_int",lbl:" Diseo interior",tipo:"DISEO"},{id:"diseno_arq",lbl:" Diseo arquitectnico",tipo:"DISEO"},{id:"consultoria",lbl:" Consultora"},{id:"custom",lbl:" En blanco"}].map((W,se,ge)=>{const ue=t.ent_plantilla===W.id;return e.jsx("button",{onClick:()=>{i("ent_plantilla",W.id),Z(W.id)},style:{padding:"7px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${ue?"#111111":C.border}`,borderLeft:se>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:se===0?"5px 0 0 5px":se===ge.length-1?"0 5px 5px 0":"0",background:ue?"#111111":"#fff",color:ue?"#fff":C.ink},children:W.lbl},W.id)})})]}),e.jsxs("button",{onClick:K,style:{padding:"8px 18px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:6},children:[e.jsx(Et,{size:12})," Vista previa PDF"]})]})}),e.jsxs("div",{style:{padding:"12px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:600,color:"#999",textTransform:"uppercase",letterSpacing:1,display:"block",marginBottom:4},children:"Nivel de detalle presupuesto"}),e.jsx("div",{style:{display:"flex",gap:0},children:[["detallado","Detallado"],["capitulos","Por captulos"],["total","Total nico"]].map(([W,se],ge)=>e.jsx("button",{onClick:()=>m(W),style:{padding:"6px 14px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${C.border}`,fontFamily:"'DM Sans',sans-serif",borderRadius:W==="detallado"?"5px 0 0 5px":W==="total"?"0 5px 5px 0":"0",borderLeft:ge>0?"none":void 0,background:k===W?"#111":"#fff",color:k===W?"#fff":"#555"},children:se},W))})]}),e.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",alignItems:"center"},children:[[["inclCrono",f,p," Incluir cronograma"],["inclOrganigrama",d,c," Incluir organigrama"]].map(([W,se,ge,ue])=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:11,padding:"5px 10px",borderRadius:4,background:se?"#E8F4EE":"#F5F4F1",border:`1px solid ${se?"#111111":"transparent"}`},children:[e.jsx("input",{type:"checkbox",checked:se,onChange:ye=>l(W,ye.target.checked,ge),style:{accentColor:"#111111"}}),e.jsx("span",{style:{fontWeight:se?600:400,color:se?"#111111":C.inkMid},children:ue})]},W)),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:11,padding:"5px 10px",borderRadius:4,background:t.ent_inclCondPago?"#E8F4EE":"#F5F4F1",border:`1px solid ${t.ent_inclCondPago?"#111111":"transparent"}`},children:[e.jsx("input",{type:"checkbox",checked:t.ent_inclCondPago??!0,onChange:W=>i("ent_inclCondPago",W.target.checked),style:{accentColor:"#111111"}}),e.jsx("span",{style:{fontWeight:t.ent_inclCondPago?600:400,color:t.ent_inclCondPago?"#111111":C.inkMid},children:" Condiciones de pago"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:11,padding:"5px 10px",borderRadius:4,background:t.ent_inclGarantias?"#E8F4EE":"#F5F4F1",border:`1px solid ${t.ent_inclGarantias?"#111111":"transparent"}`},children:[e.jsx("input",{type:"checkbox",checked:t.ent_inclGarantias??!0,onChange:W=>i("ent_inclGarantias",W.target.checked),style:{accentColor:"#111111"}}),e.jsx("span",{style:{fontWeight:t.ent_inclGarantias?600:400,color:t.ent_inclGarantias?"#111111":C.inkMid},children:" Garantas"})]})]})]})]}),e.jsxs(Je,{className:"no-print",style:{padding:0,marginBottom:16,overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"14px 20px",background:G.color+"12",borderBottom:`2px solid ${G.color}33`},children:[e.jsx("span",{style:{fontSize:22},children:G.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:G.color},children:G.label}),e.jsx("div",{style:{fontSize:10,color:C.inkMid},children:G.desc})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:9,color:C.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Revisin"}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:C.ink},children:T})]})]}),e.jsx("div",{style:{display:"flex",padding:"12px 20px",gap:0,overflowX:"auto"},children:[{key:"borrador",lbl:"Borrador",icon:""},{key:"pendiente_aprobacion",lbl:"Revisin interna",icon:""},{key:"aprobada_internamente",lbl:"Aprobada",icon:""},{key:"enviada",lbl:"Enviada",icon:""},{key:"aprobada_cliente",lbl:"Aceptada",icon:""}].map((W,se,ge)=>{const ue=["borrador","pendiente_aprobacion","aprobada_internamente","enviada","aprobada_cliente"],ye=ue.indexOf(ee),be=ue.indexOf(W.key),I=be<=ye,N=W.key===ee||ee==="devuelta_internamente"&&W.key==="pendiente_aprobacion"||ee==="devuelta_cliente"&&W.key==="enviada";return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:70},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:I?"#111111":N?"#D4840A":"#E0E0E0",fontSize:13,transition:"all .2s"},children:I?e.jsx("span",{style:{color:"#fff",fontSize:11},children:""}):e.jsx("span",{children:W.icon})}),e.jsx("span",{style:{fontSize:8,fontWeight:600,color:I?"#111111":N?"#D4840A":"#999",marginTop:3,textAlign:"center",lineHeight:1.2},children:W.lbl})]}),se<ge.length-1&&e.jsx("div",{style:{width:30,height:2,background:be<ye?"#111111":"#E0E0E0",margin:"0 2px",marginBottom:14}})]},W.key)})}),e.jsxs("div",{style:{padding:"12px 20px 16px",borderTop:`1px solid ${C.border}`},children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Trabajando como:"}),en.map(W=>e.jsxs("button",{onClick:()=>{H(W.id),i("wf_usuario",W.id)},style:{padding:"4px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${B===W.id?"#111111":C.border}`,borderRadius:4,background:B===W.id?"#E8F4EE":"#fff",color:B===W.id?"#111111":C.inkMid,fontFamily:"'DM Sans',sans-serif"},children:[W.id==="david"?"":""," ",W.nombre.split(" ")[0]]},W.id))]}),["pendiente_aprobacion","devuelta_internamente","devuelta_cliente"].includes(ee)&&e.jsx("div",{style:{marginBottom:10},children:e.jsx("input",{value:U,onChange:W=>M(W.target.value),placeholder:ee==="pendiente_aprobacion"?"Observaciones de aprobacin (opcional)...":"Comentarios sobre los cambios realizados...",style:{width:"100%",padding:"8px 12px",border:`1px solid ${C.border}`,borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:"#fff"}})}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[ee==="borrador"&&e.jsxs("button",{onClick:()=>le("solicitar"),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#D4840A",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(yn,{size:13})," Solicitar aprobacin a ",(ce=O==null?void 0:O.nombre)==null?void 0:ce.split(" ")[0]]}),ee==="pendiente_aprobacion"&&B===(O==null?void 0:O.id)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>le("aprobar_interno"),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#111111",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(xt,{size:13})," Aprobar"]}),e.jsxs("button",{onClick:()=>{if(!U){alert("Escribe las observaciones");return}le("devolver_interno")},style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#FFF8E7",color:"#D4840A",border:"1px solid #D4840A33",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(xa,{size:13})," Devolver con observaciones"]})]}),ee==="pendiente_aprobacion"&&B!==(O==null?void 0:O.id)&&e.jsxs("div",{style:{fontSize:11,color:"#D4840A",padding:"8px 0"},children:[" Esperando que ",e.jsx("strong",{children:O==null?void 0:O.nombre})," apruebe. Cambia a su usuario para simular la aprobacin."]}),ee==="devuelta_internamente"&&e.jsxs("button",{onClick:()=>le("solicitar"),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#D4840A",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(yn,{size:13})," Re-solicitar aprobacin"]}),ee==="aprobada_internamente"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:async()=>{var se;const W=await re();(se=navigator.clipboard)==null||se.writeText(W.portalUrl),alert(` Portal creado y URL copiada.

Enva este link al cliente:
${W.portalUrl}`)},style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(yn,{size:13})," Enviar al cliente (crear portal)"]}),e.jsxs("button",{onClick:L,style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#111",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(Eo,{size:13})," Descargar PDF"]})]}),ee==="enviada"&&e.jsxs("div",{style:{fontSize:11,color:"#3B3B3B",padding:"8px 0"},children:[" Esperando respuesta del cliente. Portal activo.",t.wf_lastPortalUrl&&e.jsx("button",{onClick:()=>{var W;return(W=navigator.clipboard)==null?void 0:W.writeText(t.wf_lastPortalUrl).then(()=>alert(" URL copiada"))},style:{marginLeft:8,background:"#F0F0F0",border:"1px solid #3B3B3B33",borderRadius:3,padding:"3px 8px",fontSize:10,cursor:"pointer",color:"#3B3B3B",fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:" Copiar URL portal"})]}),ee==="devuelta_cliente"&&e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:()=>{i("revision",T+1),le("solicitar")},style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:"#D4840A",color:"#fff",border:"none",borderRadius:5,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(xa,{size:13})," Crear Rev.",T+1," y solicitar aprobacin"]})}),ee==="aprobada_cliente"&&e.jsx("div",{style:{fontSize:12,color:"#111111",padding:"8px 0",fontWeight:600},children:" Oferta ganada! El cliente acept la propuesta."}),ee==="rechazada_cliente"&&e.jsxs("div",{style:{fontSize:12,color:"#B91C1C",padding:"8px 0"},children:[" El cliente rechaz la propuesta. ",((V=P.filter(W=>W.accion==="rechazar_cliente").slice(-1)[0])==null?void 0:V.comentarios)&&e.jsxs("span",{style:{fontStyle:"italic"},children:['Motivo: "',(Y=P.filter(W=>W.accion==="rechazar_cliente").slice(-1)[0])==null?void 0:Y.comentarios,'"']})]}),!["aprobada_internamente"].includes(ee)&&e.jsxs("button",{onClick:L,style:{display:"flex",alignItems:"center",gap:6,padding:"8px 14px",background:"transparent",color:C.inkMid,border:`1px solid ${C.border}`,borderRadius:5,cursor:"pointer",fontSize:11,fontWeight:500,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(Eo,{size:12})," PDF"]})]})]}),P.length>0&&e.jsx("div",{style:{padding:"0 20px 14px",borderTop:`1px solid ${C.border}`,marginTop:0},children:e.jsxs("details",{children:[e.jsxs("summary",{style:{fontSize:10,fontWeight:600,color:C.inkLight,cursor:"pointer",padding:"10px 0 4px",textTransform:"uppercase",letterSpacing:1},children:["Historial (",P.length," acciones)"]}),e.jsx("div",{style:{maxHeight:200,overflowY:"auto"},children:P.slice().reverse().map((W,se)=>{var ue,ye;const ge={solicitar:"Solicit aprobacin",aprobar_interno:"Aprob internamente",devolver_interno:"Devolvi con observaciones",enviar:"Envi al cliente",reenviar:"Re-envi al cliente",aprobar_cliente:"Cliente aprob",rechazar_cliente:"Cliente rechaz",devolver_cliente:"Cliente devolvi"};return e.jsxs("div",{style:{display:"flex",gap:8,padding:"5px 0",borderBottom:"1px solid #F5F5F5",fontSize:10},children:[e.jsx("div",{style:{minWidth:100,color:C.inkLight},children:new Date(W.fecha).toLocaleString("es-CO",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:600},children:((ye=(ue=W.por)==null?void 0:ue.nombre)==null?void 0:ye.split(" ")[0])||""}),e.jsxs("span",{style:{color:C.inkMid},children:["  ",ge[W.accion]||W.accion]}),W.comentarios&&e.jsxs("div",{style:{color:"#D4840A",fontStyle:"italic",marginTop:2},children:[" ",W.comentarios]})]}),e.jsxs("div",{style:{fontSize:9,color:C.inkLight},children:["Rev.",W.revision]})]},W.id||se)})})]})}),he.length>0&&e.jsx("div",{style:{padding:"0 20px 14px",borderTop:`1px solid ${C.border}`},children:e.jsxs("details",{children:[e.jsxs("summary",{style:{fontSize:10,fontWeight:600,color:C.inkLight,cursor:"pointer",padding:"10px 0 4px",textTransform:"uppercase",letterSpacing:1},children:["Portales cliente (",he.length,")"]}),he.map((W,se)=>e.jsxs("div",{style:{display:"flex",gap:8,padding:"5px 0",borderBottom:"1px solid #F5F5F5",fontSize:10,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:14},children:W.estado==="aprobada"?"":W.estado==="rechazada"?"":W.estado==="devuelta"?"":""}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:600},children:["Rev.",W.revision,"  ",new Date(W.fechaCreacion).toLocaleDateString("es-CO")]}),e.jsx("div",{style:{color:C.inkLight},children:W.clienteEmail||W.clienteNombre})]}),e.jsx("span",{style:{fontSize:9,fontWeight:600,padding:"2px 6px",borderRadius:3,color:W.estado==="pendiente"?"#3B3B3B":W.estado==="aprobada"?"#111111":"#B91C1C",background:W.estado==="pendiente"?"#F0F0F0":W.estado==="aprobada"?"#E8F4EE":"#FAE8E8"},children:W.estado})]},W.token||se))]})})]}),e.jsxs("div",{className:"p-hdr print-page-break",children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:13,letterSpacing:4},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:7,letterSpacing:2,color:"#999",textTransform:"uppercase"},children:"Arquitectura  Interiorismo  Construccin"})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700},children:E}),e.jsxs("div",{style:{fontSize:8,color:"#666"},children:[w,"  ",z]})]})]}),e.jsxs("div",{className:"no-print",style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:16,marginBottom:16},children:[e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Portada",s:"Datos visibles en la portada del documento"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{children:[b("Tipo de documento"),h("titulo",r?"PRESUPUESTO DE EJECUCIN":"PROPUESTA DE DISEO")]}),e.jsxs("div",{children:[b("N Oferta"),h("ref",t.codigoOferta||"")]}),e.jsxs("div",{children:[b("Cliente"),h("cliente",t.cliente||"")]}),e.jsxs("div",{children:[b("Fecha"),h("fecha",t.fechaOferta||Dt())]})]})]}),e.jsxs(Je,{style:{padding:22,background:C.ink,color:"#fff",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:8,right:10,background:"rgba(255,255,255,0.15)",padding:"2px 8px",borderRadius:3,fontSize:8,fontWeight:600,color:"rgba(255,255,255,0.5)",textTransform:"uppercase",letterSpacing:.8},children:"Solo uso interno"}),e.jsx("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:"rgba(255,255,255,0.4)",margin:"0 0 6px"},children:"PVP Total"}),e.jsx("p",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:32,fontWeight:700,color:"#fff",margin:"0 0 4px",letterSpacing:-1},children:Ye(o.PVP_IVA)}),e.jsxs("p",{style:{fontSize:10,color:"rgba(255,255,255,0.4)",margin:"0 0 16px"},children:[r?"IVA sobre utilidad":"IVA incluido","  ",t.divisa||"COP"]}),e.jsx("div",{style:{borderTop:"1px solid rgba(255,255,255,0.15)",paddingTop:12},children:[["PVP sin IVA",Ye(o.PVP)],[r?`IVA (${it(t.tarifaIVA)}  U ${it(o.U)})`:`IVA ${it(t.tarifaIVA)}`,Ye(o.IVA)],...o.ret>0?[["Retenciones (flujo)","-"+Ye(o.ret)]]:[]].map(([W,se])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,marginBottom:4},children:[e.jsx("span",{style:{color:"rgba(255,255,255,0.5)"},children:W}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",color:"rgba(255,255,255,0.8)"},children:se})]},W))})]})]}),e.jsx("div",{className:"print-section",style:{marginBottom:16},children:e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Alcance del servicio",s:""}),t.alcanceTexto&&e.jsxs("div",{className:"no-print",style:{background:"#E8F4EE",borderRadius:4,padding:"8px 12px",fontSize:10,color:"#111111",marginTop:6,marginBottom:6,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:" Hay un alcance configurado en la pestaa General"}),e.jsx("button",{onClick:()=>i("ent_alcance",t.alcanceTexto),style:{background:"#111111",color:"#fff",border:"none",borderRadius:3,padding:"3px 10px",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Usar plantilla"})]}),e.jsxs("div",{style:{marginTop:10},children:[j("Descripcin del alcance"),g("alcance",t.alcanceTexto||(r?"El presente alcance comprende la ejecucin integral del proyecto de diseo previamente aprobado, incluyendo construccin, suministro de materiales, acabados e interventora, garantizando coherencia entre diseo, presupuesto y resultado final.":`Diseo y desarrollo integral del proyecto ${t.proyecto||""} ubicado en ${t.ubicacion||""}. Incluye levantamiento, conceptualizacin, desarrollo de planos tcnicos y acompaamiento en la ejecucin.`),5)]}),r&&e.jsxs("div",{style:{marginTop:14},children:[j("Fases del proyecto"),g("fases",`- Firma de contrato
- Recepcin de anticipo
- Aprobacin de planos tcnicos
- Aprobacin de acabados
- Validacin formal de materiales y especificaciones
- Firma de acta de inicio de obra
- Inicio de obra
- Recepcin de obra
- Firma de acta final`,6)]}),e.jsxs("div",{style:{marginTop:14},children:[j("Exclusiones"),g("exclusiones",r?`Esta propuesta no incluye, salvo que se acuerde por escrito, ejecuciones adicionales a las contempladas en los diseos aprobados.

- Licencias y permisos de construccin
- Obra civil de estructura y cimentacin no contemplada en diseos
- Suministro e instalacin de electrodomsticos
- Gestin de condominio o administracin
- Mudanzas y trasteos
- Diseo o rediseo arquitectnico (ya aprobado previamente)

Todos los entregables se comparten exclusivamente en formato digital.`:`Esta propuesta no incluye, salvo que se acuerde por escrito:

- Licencias y permisos de construccin
- Obra civil de estructura y cimentacin
- Suministro e instalacin de electrodomsticos
- Gestin de condominio o administracin
- Ejecucin de obra o interventora
- Renders 3D fotorrealistas (se cotizan aparte)

Todos los entregables se comparten exclusivamente en formato digital.`,6)]})]})}),e.jsxs("div",{className:"print-page-break print-section",children:[e.jsxs("div",{className:"p-hdr",children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:700,fontSize:13,letterSpacing:4},children:"HABITARIS"})}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700},children:E}),e.jsxs("div",{style:{fontSize:8,color:"#666"},children:[w,"  ",z]})]})]}),e.jsxs(Je,{style:{padding:0,overflow:"hidden",marginBottom:16},children:[e.jsx("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${C.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(jt,{t:"Presupuesto",s:`Vista: ${k==="detallado"?"Detallado":k==="capitulos"?"Por captulos":"Total nico"}`})}),k==="total"?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Item","Descripcin","Total"].map(W=>e.jsx("th",{style:{padding:"9px 14px",textAlign:W==="Total"?"right":"left",fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:.8},children:W},W))})}),e.jsxs("tbody",{children:[e.jsxs("tr",{style:{borderTop:`1px solid ${C.border}`},children:[e.jsx("td",{style:{padding:"10px 14px"},children:"1"}),e.jsx("td",{style:{padding:"10px 14px"},children:n("descTotal",r?"Reforma integral de espacios segn diseo, incluye obras civiles, carpinteras y acabados segn diseo aprobado.":`Diseo integral  ${t.proyecto||"proyecto"}`)}),e.jsx("td",{style:{padding:"10px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:Ye(o.PVP)})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:2,style:{padding:"8px 14px",fontSize:11,color:C.inkMid},children:r?"IVA sobre la utilidad":`IVA ${it(t.tarifaIVA)}`}),e.jsx("td",{style:{padding:"8px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ye(o.IVA)})]}),e.jsxs("tr",{style:{background:C.ink},children:[e.jsx("td",{colSpan:2,style:{padding:"12px 14px",fontWeight:700,color:"#fff",fontSize:14},children:"Valor total"}),e.jsx("td",{style:{padding:"12px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:16,color:"#fff"},children:Ye(o.PVP_IVA)})]})]})]}):k==="capitulos"?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Item","Descripcin","Total"].map(W=>e.jsx("th",{style:{padding:"9px 14px",textAlign:W==="Total"?"right":"left",fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:.8},children:W},W))})}),e.jsxs("tbody",{children:[u.map((W,se)=>e.jsxs("tr",{style:{borderTop:`1px solid ${C.border}`},children:[e.jsx("td",{style:{padding:"10px 14px"},children:se+1}),e.jsx("td",{style:{padding:"10px 14px",fontWeight:600},children:W.nombre||"Captulo "+(se+1)}),e.jsx("td",{style:{padding:"10px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:Ye(W.total)})]},W.id)),e.jsxs("tr",{style:{borderTop:`2px solid ${C.ink}`,background:"#F5F4F1"},children:[e.jsx("td",{colSpan:2,style:{padding:"10px 14px",fontWeight:700},children:"Subtotal"}),e.jsx("td",{style:{padding:"10px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:Ye(o.PVP)})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:2,style:{padding:"6px 14px",fontSize:11,color:C.inkMid},children:r?"IVA sobre la utilidad":`IVA ${it(t.tarifaIVA)}`}),e.jsx("td",{style:{padding:"6px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ye(o.IVA)})]}),e.jsxs("tr",{style:{background:C.ink},children:[e.jsx("td",{colSpan:2,style:{padding:"12px 14px",fontWeight:700,color:"#fff",fontSize:14},children:"Valor total"}),e.jsx("td",{style:{padding:"12px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:16,color:"#fff"},children:Ye(o.PVP_IVA)})]})]})]}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Ref.","Descripcin","Und","Cant.","PU","Total"].map(W=>e.jsx("th",{style:{padding:"9px 14px",textAlign:W==="Total"||W==="PU"?"right":"left",fontSize:9,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:.8},children:W},W))})}),e.jsxs("tbody",{children:[x.map((W,se)=>{if(W.esCapitulo)return e.jsx("tr",{style:{background:C.accentBg,borderTop:`2px solid ${C.border}`},children:e.jsx("td",{colSpan:6,style:{padding:"8px 14px",fontWeight:700,fontSize:12,color:C.ink,textTransform:"uppercase"},children:W.nombre||W.tipo})},W.id);const ge=W.precioCD?qt(W.precioCD,W.cantidad||1,t):null;return e.jsxs("tr",{style:{borderTop:`1px solid ${C.border}`},children:[e.jsx("td",{style:{padding:"8px 14px",color:C.inkLight,fontSize:11},children:W.codigo||String(se+1).padStart(2,"0")}),e.jsx("td",{style:{padding:"8px 14px"},children:W.descripcion||""}),e.jsx("td",{style:{padding:"8px 14px",color:C.inkMid},children:W.unidad||"Gl"}),e.jsx("td",{style:{padding:"8px 14px",color:C.inkMid,textAlign:"right"},children:W.cantidad||1}),e.jsx("td",{style:{padding:"8px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:ge?Ye(ge.puVenta):""}),e.jsx("td",{style:{padding:"8px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:ge?Ye(ge.totalVenta):""})]},W.id)}),e.jsxs("tr",{style:{borderTop:`2px solid ${C.ink}`,background:"#F5F4F1"},children:[e.jsx("td",{colSpan:5,style:{padding:"10px 14px",fontWeight:700},children:"Subtotal"}),e.jsx("td",{style:{padding:"10px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:Ye(o.PVP)})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:5,style:{padding:"6px 14px",fontSize:11,color:C.inkMid},children:r?"IVA sobre la utilidad":`IVA ${it(t.tarifaIVA)}`}),e.jsx("td",{style:{padding:"6px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ye(o.IVA)})]}),e.jsxs("tr",{style:{background:C.ink},children:[e.jsx("td",{colSpan:5,style:{padding:"12px 14px",fontWeight:700,color:"#fff",fontSize:14},children:"Valor total"}),e.jsx("td",{style:{padding:"12px 14px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:16,color:"#fff"},children:Ye(o.PVP_IVA)})]})]})]})]})]}),e.jsxs("div",{className:"print-page-break print-section",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Formas de pago",s:""}),e.jsx("div",{style:{marginTop:10},children:g("condPago",[`${Math.round((t.condPct1??.3)*100)}% de anticipo`,`${Math.round((t.condPct2??.3)*100)}% a la mitad de ejecucin del proyecto`,...s>0?[`${Math.round((t.condPct3??.3)*100)}% a la entrega / acta de recepcin`,`${Math.round(s*100)}% retencin a 30 das`]:[`${Math.round((t.condPct3??.3)*100)}% al acta de recepcin`]].join(`
`),5)}),e.jsxs("div",{style:{marginTop:10},children:[j("Medios de pago"),h("medioPago",t.medioPago==="PSE"?"Link PSE":t.medioPago==="Tarjeta"?"Pago con tarjeta (pasarela online)":"Transferencia bancaria")]})]}),e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Plazo y garantas",s:""}),e.jsxs("div",{style:{marginTop:10},children:[j("Plazo de ejecucin"),h("plazo",n("duracion","__ semanas desde la firma de acta de inicio")),e.jsxs("div",{style:{marginTop:10},children:[j("Garantas"),g("garantias",`- Garanta de obra: 1 ao sobre defectos de ejecucin
- Garanta de materiales: segn fabricante
- Pliza todo riesgo durante la ejecucin`,4)]})]})]})]}),e.jsx("div",{className:"print-section",style:{marginBottom:16},children:e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Trminos y condiciones",s:""}),e.jsx("div",{style:{marginTop:10},children:g("terminos",`- Vigencia: La propuesta tiene una validez de 20 das calendario desde la fecha de envo.
- Moneda: Pesos colombianos (COP).
- Aprobacin: Se considera aceptada al recibir confirmacin escrita y el pago del anticipo.
- Formalizacin: La relacin contractual se considerar establecida mediante la firma de un contrato u orden de servicio que incorpore esta propuesta.
- Pago inicial: El inicio de los trabajos estar condicionado al cumplimiento de todas las condiciones de inicio.
- Reajustes: Los plazos y valores podrn ser modificados en funcin de nuevos requerimientos o cambios en el alcance original.`,8)}),e.jsxs("div",{style:{marginTop:14},children:[j("Nota legal"),g("notaLegal",`Esta propuesta tiene carcter informativo y comercial. No constituye, por s sola, un contrato. La relacin contractual entre las partes solo se considerar establecida mediante la firma de un contrato, orden de servicio u otro documento que incorpore esta propuesta como anexo o referencia.

La informacin contenida en esta propuesta es confidencial y de uso exclusivo del cliente. No podr ser reproducida, compartida ni utilizada con fines comerciales o de ejecucin por terceros sin autorizacin previa y por escrito de Habitaris S.A.S.`,5)]})]})}),e.jsxs("div",{className:"print-page-break print-section",style:{marginBottom:16},children:[e.jsxs("div",{className:"p-hdr",children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:700,fontSize:13,letterSpacing:4},children:"HABITARIS"})}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700},children:E}),e.jsxs("div",{style:{fontSize:8,color:"#666"},children:[w,"  ",z]})]})]}),e.jsxs(Je,{style:{padding:22},children:[e.jsx(jt,{t:"Firma de aceptacin",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginTop:14},children:[e.jsxs("div",{children:[j("Representante Habitaris"),e.jsxs("div",{style:{border:`1px solid ${C.border}`,borderRadius:4,padding:"10px 12px",background:"#F5F4F1"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:13},children:S}),e.jsx("div",{style:{fontSize:11,color:C.inkMid},children:A}),e.jsx("div",{style:{fontSize:10,color:C.inkLight,marginTop:4},children:"Habitaris S.A.S  NIT 901.922.136-8"})]}),n("elaboradoPor","")&&e.jsxs("div",{style:{marginTop:8},children:[j("Elaborado por"),e.jsx("div",{style:{fontSize:12},children:n("elaboradoPor","")}),n("elaboradoPorCargo","")&&e.jsx("div",{style:{fontSize:11,color:C.inkMid},children:n("elaboradoPorCargo","")})]}),e.jsxs("div",{className:"no-print",style:{marginTop:8},children:[b("Elaborado por (opcional)"),h("elaboradoPor",""),n("elaboradoPor","")&&e.jsxs(e.Fragment,{children:[b("Cargo"),h("elaboradoPorCargo","")]})]})]}),e.jsxs("div",{children:[j("Firma del cliente"),e.jsx("div",{className:"no-print",children:h("firmaC",t.cliente||"")}),e.jsx("div",{className:"print-only",style:{fontSize:12,marginTop:4},children:n("firmaC",t.cliente||"")}),e.jsx("div",{style:{borderBottom:"1px solid #999",marginTop:60,width:"80%"}}),e.jsx("div",{style:{fontSize:9,color:C.inkLight,marginTop:4},children:"Firma y sello de aceptacin"}),e.jsx("div",{style:{borderBottom:"1px solid #999",marginTop:30,width:"80%"}}),e.jsx("div",{style:{fontSize:9,color:C.inkLight,marginTop:4},children:"Fecha"})]})]})]})]}),e.jsx(Je,{className:"no-print",style:{padding:16,background:"#F5F5F5"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsx("span",{style:{fontSize:10,fontWeight:600,color:C.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Compartir manualmente"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("button",{onClick:()=>{const W=t.emailCliente||prompt("Email del cliente:");if(W){const se=encodeURIComponent(`${E}  ${t.proyecto||"Habitaris"}`),ge=encodeURIComponent(`Estimado/a ${_},

Adjuntamos la propuesta para ${t.proyecto||"el proyecto"} por un valor de ${Ye(o.PVP_IVA)} (IVA incluido).

Quedamos atentos a sus comentarios.

Cordialmente,
${S}
${A}
Habitaris S.A.S`);window.open(`mailto:${W}?subject=${se}&body=${ge}`)}},style:{display:"flex",alignItems:"center",gap:4,padding:"6px 12px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:10,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(An,{size:11})," Email"]}),e.jsxs("button",{onClick:()=>{const W=t.telCliente||prompt("Telfono (con cdigo de pas):");if(W){const se=W.replace(/[^0-9]/g,"");window.open(`https://wa.me/${se}?text=${encodeURIComponent(`Hola ${_}, le envo la propuesta de ${t.proyecto||"Habitaris"} por ${Ye(o.PVP_IVA)} (IVA incluido).  ${S}, Habitaris`)}`)}},style:{display:"flex",alignItems:"center",gap:4,padding:"6px 12px",background:"#25D366",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:10,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(jr,{size:11})," WhatsApp"]}),e.jsxs("button",{onClick:()=>{var W;(W=navigator.clipboard)==null||W.writeText(`${E}  ${w}  ${_}  PVP: ${Ye(o.PVP_IVA)}`),alert(" Copiado")},style:{display:"flex",alignItems:"center",gap:4,padding:"6px 12px",background:"transparent",color:"#555",border:`1px solid ${C.border}`,borderRadius:4,cursor:"pointer",fontSize:10,fontWeight:500,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(fa,{size:11})," Copiar"]})]})]})})]})}const Zh=[{id:"q1",texto:"Cmo califica la calidad del diseo entregado?",tipo:"estrellas"},{id:"q2",texto:"Se cumplieron los plazos pactados?",tipo:"estrellas"},{id:"q3",texto:"La comunicacin con el equipo fue adecuada?",tipo:"estrellas"},{id:"q4",texto:"El presupuesto final se ajust al acordado?",tipo:"estrellas"},{id:"q5",texto:"Recomendara nuestros servicios? (NPS)",tipo:"nps"},{id:"q6",texto:"Qu podramos mejorar?",tipo:"texto"},{id:"q7",texto:"Comentarios adicionales",tipo:"texto"}],ef=[{id:"p1",texto:"Calidad del material / servicio entregado",tipo:"estrellas"},{id:"p2",texto:"Cumplimiento de plazos de entrega",tipo:"estrellas"},{id:"p3",texto:"Relacin calidad/precio",tipo:"estrellas"},{id:"p4",texto:"Facilidad de comunicacin",tipo:"estrellas"},{id:"p5",texto:"Volvera a contratar este proveedor?",tipo:"sino"},{id:"p6",texto:"Observaciones",tipo:"texto"}];function tf({offers:t}){const i="hab:crm:encuestas:satisfaccion",o="hab:crm:encuestas:proveedores",[n,a]=F.useState([]),[r,s]=F.useState([]),[g,h]=F.useState("satisfaccion"),[b,j]=F.useState(null),[k,v]=F.useState(null);F.useEffect(()=>{(()=>{try{const E=Ee.getSync(i);E&&a(JSON.parse(E)||[])}catch{}try{const E=Ee.getSync(o);E&&s(JSON.parse(E)||[])}catch{}})()},[]);const m=E=>{a(E);try{Ee.set(i,JSON.stringify(E))}catch{}},f=E=>{s(E);try{Ee.set(o,JSON.stringify(E))}catch{}},p=t.filter(E=>E.estado==="Ganada"),d=()=>Math.random().toString(36).slice(2,9),c=E=>({id:d(),ofertaId:(E==null?void 0:E.id)||"",proyecto:(E==null?void 0:E.proyecto)||"",cliente:(E==null?void 0:E.cliente)||"",fecha:new Date().toISOString().slice(0,10),respuestas:{},estado:"pendiente"}),l=()=>({id:d(),proveedor:"",proyecto:"",fecha:new Date().toISOString().slice(0,10),respuestas:{},estado:"pendiente"}),x=({value:E,onChange:w})=>e.jsxs("div",{style:{display:"flex",gap:2},children:[[1,2,3,4,5].map(_=>e.jsx("button",{onClick:()=>w(_),style:{fontSize:22,background:"none",border:"none",cursor:"pointer",color:_<=(E||0)?"#F5A623":"#DDD",transition:"color .1s"},children:""},_)),E>0&&e.jsxs("span",{style:{fontSize:11,color:C.inkLight,marginLeft:6,alignSelf:"center"},children:[E,"/5"]})]}),y=({value:E,onChange:w})=>e.jsxs("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:[Array.from({length:11},(_,z)=>z).map(_=>e.jsx("button",{onClick:()=>w(_),style:{width:32,height:32,borderRadius:6,border:"1px solid "+(_===E?"#111":"#E0E0E0"),background:_===E?_>=9?"#111111":_>=7?"#F5A623":"#B91C1C":"#fff",color:_===E?"#fff":"#555",fontWeight:_===E?700:400,fontSize:12,cursor:"pointer",transition:"all .1s"},children:_},_)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",fontSize:9,color:C.inkLight,marginTop:2},children:[e.jsx("span",{children:"Nada probable"}),e.jsx("span",{children:"Muy probable"})]})]}),u=E=>{const w=E.flatMap(_=>Object.values(_.respuestas||{}).filter(z=>typeof z=="number"&&z>=1&&z<=5));return w.length>0?(w.reduce((_,z)=>_+z,0)/w.length).toFixed(1):""},S=E=>{const w=E.map(T=>{var L;return(L=T.respuestas)==null?void 0:L.q5}).filter(T=>typeof T=="number");if(w.length===0)return"";const _=w.filter(T=>T>=9).length,z=w.filter(T=>T<=6).length;return((_-z)/w.length*100).toFixed(0)},A=(E,w,_)=>e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:16},children:E.map(z=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:C.ink,marginBottom:6},children:z.texto}),z.tipo==="estrellas"&&e.jsx(x,{value:w[z.id]||0,onChange:T=>_({...w,[z.id]:T})}),z.tipo==="nps"&&e.jsx(y,{value:w[z.id],onChange:T=>_({...w,[z.id]:T})}),z.tipo==="sino"&&e.jsx("div",{style:{display:"flex",gap:8},children:["S","No","Con reservas"].map(T=>e.jsx("button",{onClick:()=>_({...w,[z.id]:T}),style:{padding:"6px 16px",borderRadius:6,border:`1px solid ${w[z.id]===T?"#111":"#E0E0E0"}`,background:w[z.id]===T?"#111":"#fff",color:w[z.id]===T?"#fff":"#555",fontSize:12,cursor:"pointer",fontWeight:w[z.id]===T?600:400},children:T},T))}),z.tipo==="texto"&&e.jsx("textarea",{value:w[z.id]||"",onChange:T=>_({...w,[z.id]:T.target.value}),rows:2,placeholder:"Escribe aqu...",style:{width:"100%",border:`1px solid ${C.border}`,borderRadius:6,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical"}})]},z.id))});return e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Encuestas ISO 9001"}),e.jsx("p",{style:{fontSize:12,color:C.inkLight,margin:"3px 0 0"},children:"Satisfaccin del cliente y evaluacin de proveedores"})]})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(160px,1fr))",gap:10,marginBottom:16},children:[["Enc. satisfaccin",n.length,"#111111"],["Promedio general",u(n)+"","#F5A623"],["NPS Score",S(n),"#3B3B3B"],["Eval. proveedores",r.length,"#8C6A00"],["Promedio proveed.",u(r)+"","#F5A623"]].map(([E,w,_])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"10px 12px",borderLeft:"3px solid "+_},children:[e.jsx("div",{style:{fontSize:9,color:"#888",marginBottom:2},children:E}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:_,fontFamily:"'DM Mono',monospace"},children:w})]},E))}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:16},children:[["satisfaccion","Satisfaccin cliente"],["proveedores","Evaluacin proveedores"]].map(([E,w])=>e.jsx("button",{onClick:()=>h(E),style:{padding:"8px 18px",border:`1px solid ${C.border}`,borderRadius:E==="satisfaccion"?"6px 0 0 6px":"0 6px 6px 0",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:g===E?"#111":"#fff",color:g===E?"#fff":"#555"},children:w},E))}),g==="satisfaccion"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsxs("select",{onChange:E=>{if(E.target.value){const w=p.find(_=>_.id===E.target.value);j(c(w)),E.target.value=""}},style:{border:`1px solid ${C.border}`,borderRadius:6,padding:"7px 12px",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"",children:"+ Nueva encuesta desde oferta ganada..."}),p.map(E=>e.jsx("option",{value:E.id,children:E.proyecto||E.cliente||E.id},E.id))]}),e.jsxs("button",{onClick:()=>j(c({})),style:{padding:"7px 14px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Oe,{size:12})," Nueva en blanco"]})]}),b&&e.jsxs(Je,{style:{padding:22,marginBottom:16,borderLeft:"3px solid #111111"},children:[e.jsx(jt,{t:"Encuesta de satisfaccin",s:b.proyecto||"Proyecto sin nombre"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsx(ot,{lbl:"Cliente",val:b.cliente,on:E=>j(w=>({...w,cliente:E.target.value}))}),e.jsx(ot,{lbl:"Proyecto",val:b.proyecto,on:E=>j(w=>({...w,proyecto:E.target.value}))})]}),A(Zh,b.respuestas,E=>j(w=>({...w,respuestas:E}))),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[e.jsx(ut,{icon:xt,on:()=>{const E={...b,estado:"completada"},w=n.find(_=>_.id===b.id);m(w?n.map(_=>_.id===b.id?E:_):[...n,E]),j(null)},children:"Guardar"}),e.jsx(ut,{v:"out",on:()=>j(null),children:"Cancelar"})]})]}),n.length>0&&e.jsx("div",{style:{border:`1px solid ${C.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Cliente","Proyecto","Promedio","NPS","Estado",""].map(E=>e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,borderBottom:"2px solid #E0E0E0"},children:E},E))})}),e.jsx("tbody",{children:n.map((E,w)=>{var T;const _=Object.entries(E.respuestas||{}).filter(([L,Z])=>typeof Z=="number"&&Z>=1&&Z<=5),z=_.length>0?(_.reduce((L,[,Z])=>L+Z,0)/_.length).toFixed(1):"";return e.jsxs("tr",{style:{borderBottom:`1px solid ${C.border}`,background:w%2?"#F9F8F5":"#fff"},children:[e.jsx("td",{style:{padding:"8px 12px"},children:E.fecha}),e.jsx("td",{style:{padding:"8px 12px",fontWeight:600},children:E.cliente||""}),e.jsx("td",{style:{padding:"8px 12px"},children:E.proyecto||""}),e.jsxs("td",{style:{padding:"8px 12px",color:"#F5A623",fontWeight:700},children:[z,""]}),e.jsx("td",{style:{padding:"8px 12px",fontFamily:"'DM Mono',monospace"},children:((T=E.respuestas)==null?void 0:T.q5)??"-"}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("span",{style:{background:E.estado==="completada"?"#E6F4EC":"#FFF3E0",color:E.estado==="completada"?"#111111":"#F5A623",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:600},children:E.estado})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>j({...E}),style:{background:"none",border:"none",cursor:"pointer",color:C.ink},children:e.jsx(Vo,{size:12})}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar?")&&m(n.filter(L=>L.id!==E.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:12})})]})})]},E.id)})})]})})]}),g==="proveedores"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:14},children:e.jsxs("button",{onClick:()=>v(l()),style:{padding:"7px 14px",border:"none",borderRadius:6,background:"#8C6A00",color:"#fff",cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Oe,{size:12})," Evaluar proveedor"]})}),k&&e.jsxs(Je,{style:{padding:22,marginBottom:16,borderLeft:"3px solid #8C6A00"},children:[e.jsx(jt,{t:"Evaluacin de proveedor",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsx(ot,{lbl:"Proveedor",val:k.proveedor,on:E=>v(w=>({...w,proveedor:E.target.value}))}),e.jsx(ot,{lbl:"Proyecto / Referencia",val:k.proyecto,on:E=>v(w=>({...w,proyecto:E.target.value}))})]}),A(ef,k.respuestas,E=>v(w=>({...w,respuestas:E}))),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[e.jsx(ut,{icon:xt,on:()=>{const E={...k,estado:"completada"},w=r.find(_=>_.id===k.id);f(w?r.map(_=>_.id===k.id?E:_):[...r,E]),v(null)},children:"Guardar"}),e.jsx(ut,{v:"out",on:()=>v(null),children:"Cancelar"})]})]}),r.length>0&&e.jsx("div",{style:{border:`1px solid ${C.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Proveedor","Proyecto","Promedio","Repetir?","Estado",""].map(E=>e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,borderBottom:"2px solid #E0E0E0"},children:E},E))})}),e.jsx("tbody",{children:r.map((E,w)=>{var T;const _=Object.entries(E.respuestas||{}).filter(([L,Z])=>typeof Z=="number"&&Z>=1&&Z<=5),z=_.length>0?(_.reduce((L,[,Z])=>L+Z,0)/_.length).toFixed(1):"";return e.jsxs("tr",{style:{borderBottom:`1px solid ${C.border}`,background:w%2?"#F9F8F5":"#fff"},children:[e.jsx("td",{style:{padding:"8px 12px"},children:E.fecha}),e.jsx("td",{style:{padding:"8px 12px",fontWeight:600},children:E.proveedor||""}),e.jsx("td",{style:{padding:"8px 12px"},children:E.proyecto||""}),e.jsxs("td",{style:{padding:"8px 12px",color:"#F5A623",fontWeight:700},children:[z,""]}),e.jsx("td",{style:{padding:"8px 12px"},children:((T=E.respuestas)==null?void 0:T.p5)||""}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("span",{style:{background:E.estado==="completada"?"#E6F4EC":"#FFF3E0",color:E.estado==="completada"?"#111111":"#F5A623",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:600},children:E.estado})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>v({...E}),style:{background:"none",border:"none",cursor:"pointer",color:C.ink},children:e.jsx(Vo,{size:12})}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar?")&&f(r.filter(L=>L.id!==E.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(He,{size:12})})]})})]},E.id)})})]})})]})]})}function of(){return e.jsxs("div",{className:"fade",children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:C.inkLight,margin:"0 0 6px"},children:"Sistema"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:C.ink,margin:"0 0 28px",letterSpacing:-.5},children:"Configuracin"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(Je,{style:{padding:24},children:[e.jsx(jt,{t:"Marca",s:"Identidad visual aplicada"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:20},children:[e.jsx("div",{style:{background:C.ink,borderRadius:3,padding:"16px"},children:e.jsx(tl,{size:44,color:"#fff"})}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 2px",fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:C.ink},children:"Habitaris"}),e.jsx("p",{style:{margin:"0 0 2px",fontSize:11,color:C.inkLight},children:"Tipografa: DM Sans (sans-serif)"}),e.jsx("p",{style:{margin:0,fontSize:11,color:C.inkLight},children:"Paleta: B&W + off-white. Manual 2025 "})]})]}),e.jsx("div",{style:{background:C.accentBg,borderRadius:2,padding:"12px 16px",border:`1px dashed ${C.borderMid}`},children:e.jsx("p",{style:{margin:0,fontSize:11,color:C.inkMid},children:"Una sola familia tipogrfica sans-serif segn manual. Sin serif."})})]}),e.jsxs(Je,{style:{padding:24},children:[e.jsx(jt,{t:"Datos",s:"Almacenamiento local persistente"}),e.jsx("p",{style:{fontSize:12,color:C.inkMid,margin:"0 0 16px",lineHeight:1.6},children:"Los datos se guardan en tu navegador. No requieren servidor ni cuenta externa."}),e.jsx(ut,{v:"danger",icon:He,on:async()=>{window.confirm("Eliminar TODOS los datos? Irreversible.")&&(Ee.delete("hab:v4"),window.location.reload())},children:"Borrar todos los datos"})]})]})]})}function nf({lang:t}){const[i,o]=F.useState(t||"es");F.useEffect(()=>{t&&o(t)},[t]);const[n,a]=F.useState("dashboard"),[r,s]=F.useState(!1),[g,h]=F.useState([]),[b,j]=F.useState(null),[k,v]=F.useState(!0);F.useEffect(()=>{xh().then(y=>{h(y),v(!1)})},[]);const m=F.useCallback(async y=>{const u=g.some(S=>S.id===y.id)?g.map(S=>S.id===y.id?y:S):[...g,y];h(u),await Ga(u)},[g]),f=F.useCallback(async y=>{if(!window.confirm("Eliminar esta oferta?"))return;const u=g.filter(S=>S.id!==y);h(u),await Ga(u)},[g]),p=F.useCallback(async y=>{const u=g.find(E=>E.id===y);if(!u)return;const S={...u,id:kt(),createdAt:Dt(),updatedAt:Dt(),estado:"Borrador",proyecto:(u.proyecto||"")+" (copia)",relacionadaCon:y},A=[...g,S];h(A),await Ga(A)},[g]),[d,c]=F.useState(null),l=F.useCallback((y,u)=>{if(g.some(S=>S.briefingId===y.id)){alert("Ya existe una oferta creada desde este briefing");return}c(Ws(y)),u("offer-new")},[g]),x=F.useCallback(async y=>{const u=rc(y);try{const S=Ee.getSync("hab:crm:clientes2"),A=S?JSON.parse(S)||[]:[],E=A.find(w=>w.email&&w.email===u.email);if(E){alert(` Ya existe un cliente con email ${u.email}: "${E.nombre}"`),a("clientes");return}A.push(u),Ee.set("hab:crm:clientes2",JSON.stringify(A)),alert(` Cliente "${u.nombre}" creado desde briefing`)}catch{alert("Error guardando cliente")}a("clientes")},[]);return k?e.jsxs(e.Fragment,{children:[e.jsx(Nl,{}),e.jsx("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:C.bg},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(tl,{size:52,color:C.ink}),e.jsx("div",{style:{width:28,height:28,border:`2px solid ${C.border}`,borderTopColor:C.ink,borderRadius:"50%",animation:"spin .7s linear infinite",margin:"18px auto 0"}})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Nl,{}),e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:C.bg,minWidth:0},children:[e.jsx(Fh,{view:n,sv:a,lang:i,setLang:o,open:r,toggle:()=>s(!r)}),e.jsxs("main",{style:{marginLeft:r?200:0,flex:1,padding:"32px 36px",maxWidth:r?"calc(100vw - 200px)":"100vw",overflowX:"auto",transition:"margin-left .2s ease, max-width .2s ease"},children:[n==="dashboard"&&e.jsx(Th,{offers:g,sv:a,sei:j,lang:i}),n==="offers"&&e.jsx(Bh,{offers:g,sv:a,sei:j,onDel:f,onDup:p}),(n==="offer-new"||n==="offer-edit")&&e.jsx(Nh,{lang:i,offers:g,editId:n==="offer-edit"?b:null,prefillData:n==="offer-new"?d:null,onSave:async y=>{c(null),await m(y)},onBack:()=>{c(null),a("offers")}}),n==="formularios"&&e.jsx(wh,{sv:a,onCreateOfferFromBriefing:l,onCreateClientFromBriefing:x}),n==="clientes"&&e.jsx(zh,{}),n==="proveedores"&&e.jsx(Eh,{}),n==="encuestas"&&e.jsx(tf,{offers:g}),n==="settings"&&e.jsx(of,{})]})]})]})}const rf=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input, select, textarea { font-family: 'DM Sans', sans-serif; outline: none; }
    button { font-family: 'DM Sans', sans-serif; cursor: pointer; }
    @keyframes fadeUp   { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    @keyframes fadeIn   { from { opacity:0; } to { opacity:1; } }
    @keyframes slideIn  { from { transform:translateX(-6px); opacity:0; } to { transform:translateX(0); opacity:1; } }
    @keyframes popIn    { from { transform:scale(.95); opacity:0; } to { transform:scale(1); opacity:1; } }
    .fade-up  { animation: fadeUp .22s ease both; }
    .fade-in  { animation: fadeIn .18s ease both; }
    .pop-in   { animation: popIn .18s ease both; }
    .mono     { font-family: 'DM Mono', monospace; }
  `}),$={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",sidebar:"#0D0D0D",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",borderMid:"#C8C5BE",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",greenLight:"#D0EBDA",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.05)",shadowMd:"0 8px 32px rgba(0,0,0,.12)",card:"#FFFFFF",greenL:"#D0EBDA",redL:"#FAE8E8",blueL:"#F0F0F0",amberL:"#FAF0E0",teal:"#0D7377",tealL:"#E0F4F4"},je=$,Xi=()=>Math.random().toString(36).slice(2,9),fi=()=>new Date().toISOString().slice(0,10),lc=()=>new Date().toISOString(),Vs=t=>{if(!t)return"";try{return new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"})}catch{return t}},af=["Trmino indefinido","Trmino fijo","Obra o labor","Prestacin de servicios","Aprendizaje"],sf=["Indefinido","Temporal","Formacin","Prcticas","Obra o servicio","Autnomo"],zt=(t,i=0)=>t==null||t===""?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:i,maximumFractionDigits:i}).format(Number(t)),bi=(t,i=0)=>new Intl.NumberFormat("es-CO",{minimumFractionDigits:i,maximumFractionDigits:i}).format(Number(t)||0),Ja=t=>`${(Number(t)||0).toFixed(1)}%`,xi={cargos:"hab:rrhh:cargos",asistencia:"hab:rrhh:asistencia",jornada:"hab:rrhh:jornada",activos:"hab:rrhh:activos",licencias:"hab:rrhh:licencias",gastos:"hab:rrhh:gastos",partes:"hab:rrhh:partes",empleados:"hab:rrhh:empleados",novedades:"hab:rrhh:novedades",fichas:"hab:rrhh:fichas",docs:"hab:rrhh:docs",equipos:"hab:rrhh:equipos"},mi=(t,i)=>{const[o,n]=F.useState(i),[a,r]=F.useState(!1);F.useEffect(()=>{Ee.get(t).then(g=>{g!=null&&n(g),r(!0)})},[t]);const s=F.useCallback(async g=>{const h=typeof g=="function"?g(o):g;n(h),Ee.set(t,h)},[t,o]);return[o,s,a]},lf={hDia:8,diasSemana:5,semanasAnio:50,pctProductivas:75,diasVacaciones:15,diasFestivos:18,diasAusencias:5},df=()=>({id:Xi(),nombre:"",salarioBruto:0,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0,fechaIngreso:fi()}),Ya=(t="")=>({nombre:t,apellidos:"",email:"",telefono:"",fechaNacimiento:"",tipoDocumento:"CC",numeroDocumento:"",cargo:"",tipoContrato:"",fechaIngreso:"",salarioBruto:0,eps:"",afp:"",arl:"",cajaCompensacion:"",entidadBancaria:"",tipoCuenta:"",cuentaBancaria:""}),Xa=[{cat:"Equipos de Cmputo",vida:3,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"PCs, porttiles, tablets, servidores",icono:"",usoRef:1760},{cat:"Impresoras y Plotters",vida:3,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Impresoras, escneres, plotters",icono:"",usoRef:1200},{cat:"Equipos de Medicin",vida:5,metodo:"Lnea recta",base:"NIIF S.17",nota:"Distancimetros, niveles lser, estaciones totales",icono:"",usoRef:800},{cat:"Mobiliario y Enseres",vida:10,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Mesas, sillas, archivadores, muebles oficina",icono:"",usoRef:1760},{cat:"Equipos de Oficina",vida:5,metodo:"Lnea recta",base:"NIIF S.17",nota:"Telfonos, proyectores, pantallas externas",icono:"",usoRef:1200},{cat:"Vehculos",vida:5,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Automviles, camionetas, motocicletas",icono:"",usoRef:1500},{cat:"Maquinaria y Equipo",vida:10,metodo:"Lnea recta",base:"NIIF S.17",nota:"Maquinaria de obra, herramientas especializadas",icono:"",usoRef:1200},{cat:"Mejoras Locativas",vida:10,metodo:"Lnea recta",base:"NIIF S.17 / NIC 16",nota:"Adecuaciones a espacios arrendados",icono:"",usoRef:1760},{cat:"Software licencia perpetua",vida:3,metodo:"Lnea recta",base:"NIIF S.18 Intangibles",nota:"CAD, BIM, render (licencias de compra nica)",icono:"",usoRef:1760},{cat:"Otro / Personalizado",vida:5,metodo:"Lnea recta",base:"Manual",nota:"Define la vida til manualmente",icono:"",usoRef:1760}],$i=new Date().getFullYear(),cf=()=>({id:Xi(),nombre:"",categoria:"",valorCompra:0,anioCompra:$i,vidaUtilAnios:5,metodo:"Lnea recta",usoAnual:1760,baseNiif:"",activo:!0,vidaUtilEditada:!1}),pf=()=>({id:Xi(),nombre:"",plan:"",costoAnual:0,usuarios:1,activo:!0}),gf=()=>({id:Xi(),concepto:"",montoMensual:0,categoria:"Oficina"}),Cn=[{id:"vacaciones",lbl:"Vacaciones",icono:"",color:"#111111",bg:"#E8F4EE",requiereDoc:!1,requiereFechas:!0,requiereHoras:!1},{id:"baja",lbl:"Baja Mdica",icono:"",color:"#B91C1C",bg:"#FAE8E8",requiereDoc:!0,requiereFechas:!0,requiereHoras:!1},{id:"permiso",lbl:"Permiso / Ausencia",icono:"",color:"#8C6A00",bg:"#FAF0E0",requiereDoc:!1,requiereFechas:!1,requiereHoras:!0},{id:"horasExtra",lbl:"Horas Extra",icono:"",color:"#3B3B3B",bg:"#F0F0F0",requiereDoc:!1,requiereFechas:!1,requiereHoras:!0},{id:"licEspecial",lbl:"Licencia Especial",icono:"",color:"#5B3A8C",bg:"#EDE8F4",requiereDoc:!0,requiereFechas:!0,requiereHoras:!1},{id:"otro",lbl:"Otro",icono:"",color:"#555555",bg:"#EDEBE7",requiereDoc:!1,requiereFechas:!1,requiereHoras:!1}],uf=["Cita mdica personal","Cita mdica familiar","Trmite personal","Asuntos acadmicos / formacin","Duelo familiar","Matrimonio","Mudanza","Asuntos legales","Otro"],hf=["Licencia de maternidad","Licencia de paternidad","Licencia por luto","Licencia por matrimonio","Licencia por fuerza mayor","Otra licencia especial"],ff=(t="")=>({id:Xi(),empleadoNombre:t,tipo:"",estado:"Pendiente",fechaSolicitud:fi(),fechaInicio:fi(),fechaFin:"",dias:0,horas:0,motivo:"",descripcion:"",docNombre:"",docBase64:"",comentarioAdmin:"",fechaResolucion:""}),Hl=()=>({id:Xi(),empleadoId:"",empleadoNombre:"",fecha:fi(),otCodigo:"",actividad:"",horasNormales:0,horasExtra:0,horasNoProd:0,descripcion:"",estado:"Borrador"}),xf=["encargado","supervisor","jefe_obra","residente","admin","superadmin"],Ut=({children:t})=>e.jsx("span",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",fontWeight:700,color:$.inkLight},children:t}),Wt=({children:t,color:i=$.inkLight,bg:o=$.accent})=>e.jsx("span",{style:{display:"inline-flex",alignItems:"center",fontSize:9,fontWeight:700,letterSpacing:1.2,textTransform:"uppercase",padding:"2px 8px",borderRadius:2,background:o,color:i,flexShrink:0},children:t}),ai=({children:t,gap:i=12,align:o="flex-start",wrap:n=!1,style:a={}})=>e.jsx("div",{style:{display:"flex",gap:i,alignItems:o,flexWrap:n?"wrap":"nowrap",...a},children:t}),zi=({children:t,flex:i=1,style:o={}})=>e.jsx("div",{style:{flex:i,minWidth:0,...o},children:t}),io=({label:t,value:i,onChange:o,type:n="text",placeholder:a="",readOnly:r=!1,note:s="",...g})=>e.jsxs("div",{children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:$.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),e.jsx("input",{type:n,value:i??"",onChange:o,placeholder:a,readOnly:r,style:{width:"100%",padding:"7px 10px",border:`1px solid ${$.border}`,borderRadius:3,fontSize:12,color:$.ink,background:r?$.accent:$.surface,fontFamily:"'DM Sans',sans-serif"},...g}),s&&e.jsx("p",{style:{fontSize:10,color:$.inkLight,marginTop:3},children:s})]}),tt=({children:t,onClick:i,variant:o="ghost",small:n,disabled:a,icon:r,style:s={}})=>{const g={primary:{background:$.ink,color:"#fff",border:"none"},ghost:{background:$.accent,color:$.inkMid,border:`1px solid ${$.border}`},danger:{background:$.redBg,color:$.red,border:`1px solid ${$.red}33`},success:{background:$.greenBg,color:$.green,border:`1px solid ${$.green}33`},outline:{background:"transparent",color:$.inkMid,border:`1px solid ${$.border}`}};return e.jsxs("button",{onClick:i,disabled:a,style:{display:"inline-flex",alignItems:"center",gap:5,padding:n?"5px 10px":"7px 14px",borderRadius:3,fontSize:n?10:11,fontWeight:600,letterSpacing:.5,transition:"opacity .12s",opacity:a?.45:1,...g[o],...s},children:[r&&e.jsx(r,{size:n?10:12}),t]})},bt=({value:t,onChange:i,placeholder:o,type:n="text",small:a,style:r={},readOnly:s})=>e.jsx("input",{type:n,value:t??"",onChange:g=>i==null?void 0:i(g.target.value),placeholder:o,readOnly:s,style:{width:"100%",padding:a?"5px 8px":"7px 10px",background:s?$.accent:$.surface,border:`1px solid ${$.border}`,borderRadius:3,fontSize:12,color:$.ink,transition:"border-color .12s",...r},onFocus:g=>!s&&(g.target.style.borderColor=$.borderMid),onBlur:g=>g.target.style.borderColor=$.border}),yi=({value:t,onChange:i,options:o,small:n,style:a={}})=>e.jsx("select",{value:t??"",onChange:r=>i(r.target.value),style:{width:"100%",padding:n?"5px 8px":"7px 10px",background:$.surface,border:`1px solid ${$.border}`,borderRadius:3,fontSize:12,color:$.ink,appearance:"none",...a},children:o.map(r=>e.jsx("option",{value:r.value??r,children:r.label??r},r.value??r))}),Gl=({label:t,value:i,onChange:o,options:n,...a})=>e.jsxs("div",{children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:$.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),e.jsx("select",{value:i??"",onChange:o,style:{width:"100%",padding:"7px 10px",background:$.surface,border:`1px solid ${$.border}`,borderRadius:3,fontSize:12,color:$.ink,appearance:"none"},children:(n||[]).map(r=>e.jsx("option",{value:r.value??r,children:r.label??r},r.value??r))})]}),un=({children:t})=>e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:$.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),dc=({icon:t,children:i,color:o})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12},children:[t&&e.jsx(t,{size:15,style:{color:o||$.ink,flexShrink:0}}),e.jsx("span",{style:{fontSize:14,fontWeight:700,color:o||$.ink},children:i})]}),yt=({label:t,children:i,note:o})=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr",gap:12,alignItems:"center",marginBottom:10},children:[e.jsxs("div",{children:[e.jsx(Ut,{children:t}),o&&e.jsx("div",{style:{fontSize:9,color:$.inkLight,marginTop:2},children:o})]}),i]}),Qt=({children:t,style:i={}})=>e.jsx("div",{style:{background:$.surface,border:`1px solid ${$.border}`,borderRadius:4,padding:"18px 20px",boxShadow:$.shadow,...i},children:t}),ao=({children:t,action:i})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,letterSpacing:.3,color:$.ink},children:t}),i]}),ei=({label:t,value:i,sub:o,color:n=$.ink,icon:a})=>e.jsxs("div",{style:{background:$.surface,border:`1px solid ${$.border}`,borderRadius:4,padding:"14px 16px",flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx(Ut,{children:t}),a&&e.jsx(a,{size:13,color:$.inkXLight})]}),e.jsx("div",{style:{marginTop:8,fontSize:22,fontWeight:700,color:n,lineHeight:1},className:"mono",children:i}),o&&e.jsx("div",{style:{marginTop:4,fontSize:10,color:$.inkLight},children:o})]});function mf({cargos:t,saveCargos:i,jornada:o}){const[n,a]=F.useState(null),[r,s]=F.useState(!1),g=F.useMemo(()=>{const d=o;return(d.diasSemana*d.semanasAnio-d.diasFestivos-d.diasAusencias)*d.hDia*(d.pctProductivas/100)},[o]),h=d=>{const c=Number(d.salarioBruto)||0,l=1+(Number(d.prestaciones)+Number(d.segSocial)+Number(d.parafiscales))/100;return c*l},b=d=>g>0?h(d)/g:0,j=()=>{a(df()),s(!0)},k=d=>{a({...d}),s(!1)},v=()=>a(null),m=()=>{n.nombre&&(i(d=>r?[...d,n]:d.map(c=>c.id===n.id?n:c)),v())},f=d=>i(c=>c.filter(l=>l.id!==d)),p=(d,c)=>a(l=>({...l,[d]:c}));return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ei,{label:"Cargos activos",value:t.filter(d=>d.activo).length,icon:Bi}),e.jsx(ei,{label:"Masa salarial/mes",value:zt(t.filter(d=>d.activo).reduce((d,c)=>d+h(c)/12,0)),icon:Sr}),e.jsx(ei,{label:"Horas productivas/ao",value:bi(g),sub:"por empleado (config. en Jornada)",icon:Ta,color:$.blue}),e.jsx(ei,{label:"Rango coste/hora",value:t.length?`${zt(Math.min(...t.map(b)))}  ${zt(Math.max(...t.map(b)))}`:"",sub:"sin estructura",icon:Ji,color:$.green})]}),e.jsxs(Qt,{children:[e.jsx(ao,{action:e.jsxs(tt,{variant:"primary",small:!0,onClick:j,children:[e.jsx(Oe,{size:12}),"Nuevo cargo"]}),children:"Cargos y Salarios"}),t.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:$.inkLight},children:[e.jsx(Bi,{size:32,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{fontSize:12},children:"Sin cargos registrados. Aade el primero."})]}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`2px solid ${$.border}`},children:["Cargo","Salario bruto/ao","Prestac.","Seg. Social","Parafiscal","Costo total/ao","Costo/hora",""].map(d=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:$.inkLight,fontWeight:700},children:d},d))})}),e.jsx("tbody",{children:t.map(d=>e.jsxs("tr",{style:{borderBottom:`1px solid ${$.border}`,transition:"background .1s"},onMouseEnter:c=>c.currentTarget.style.background=$.surfaceAlt,onMouseLeave:c=>c.currentTarget.style.background="",children:[e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("span",{style:{fontWeight:600,color:$.ink},children:d.nombre||""}),!d.activo&&e.jsx(Wt,{color:$.amber,bg:$.amberBg,style:{marginLeft:6},children:"Inactivo"})]}),e.jsx("td",{style:{padding:"10px 10px"},className:"mono",children:zt(d.salarioBruto)}),e.jsx("td",{style:{padding:"10px 10px",color:$.inkMid},className:"mono",children:Ja(d.prestaciones)}),e.jsx("td",{style:{padding:"10px 10px",color:$.inkMid},className:"mono",children:Ja(d.segSocial)}),e.jsx("td",{style:{padding:"10px 10px",color:$.inkMid},className:"mono",children:Ja(d.parafiscales)}),e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},className:"mono",children:zt(h(d))}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Wt,{color:$.green,bg:$.greenBg,children:[zt(b(d)),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(tt,{small:!0,variant:"ghost",onClick:()=>k(d),children:e.jsx(ro,{size:11})}),e.jsx(tt,{small:!0,variant:"danger",onClick:()=>f(d.id),children:e.jsx(He,{size:11})})]})})]},d.id))})]})})]}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:v,children:e.jsxs("div",{className:"pop-in",style:{background:$.surface,borderRadius:6,padding:28,width:480,boxShadow:$.shadowMd},onClick:d=>d.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:20,fontSize:15,fontWeight:700},children:r?"Nuevo cargo":"Editar cargo"}),e.jsx(yt,{label:"Nombre del cargo",children:e.jsx(bt,{value:n.nombre,onChange:d=>p("nombre",d),placeholder:"Ej. Diseador Senior"})}),e.jsx(yt,{label:"Salario bruto anual",note:"COP  sin prestaciones",children:e.jsx(bt,{type:"number",value:n.salarioBruto,onChange:d=>p("salarioBruto",d)})}),e.jsxs("div",{style:{background:$.accent,borderRadius:3,padding:"12px 14px",marginBottom:12},children:[e.jsx("p",{style:{fontSize:10,color:$.inkLight,marginBottom:8},children:"CARGAS SOCIALES SOBRE SALARIO"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[{k:"prestaciones",lbl:"Prestaciones (%)",note:"~52.18"},{k:"segSocial",lbl:"Seg. Social (%)",note:"~12.5"},{k:"parafiscales",lbl:"Parafiscales (%)",note:"~9.0"}].map(d=>e.jsxs("div",{children:[e.jsx(Ut,{children:d.lbl}),e.jsx(bt,{type:"number",value:n[d.k],onChange:c=>p(d.k,c),small:!0,style:{marginTop:4}})]},d.k))})]}),n.salarioBruto>0&&e.jsxs("div",{style:{background:$.greenBg,borderRadius:3,padding:"10px 14px",marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontSize:11,color:$.green},children:"Costo total empleador/ao"}),e.jsx("strong",{style:{fontSize:13,color:$.green},className:"mono",children:zt(h(n))})]}),e.jsx(yt,{label:"Estado",children:e.jsx(yi,{value:n.activo?"true":"false",onChange:d=>p("activo",d==="true"),options:[{value:"true",label:"Activo"},{value:"false",label:"Inactivo"}]})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:20,paddingTop:16,borderTop:`1px solid ${$.border}`},children:[e.jsx(tt,{variant:"outline",onClick:v,children:"Cancelar"}),e.jsxs(tt,{variant:"primary",onClick:m,children:[e.jsx(wo,{size:12}),"Guardar"]})]})]})})]})}function bf({jornada:t,saveJornada:i}){const[o,n]=F.useState({...t}),[a,r]=F.useState(!1),s=(f,p)=>n(d=>({...d,[f]:Number(p)||0})),g=F.useMemo(()=>o.diasSemana*o.semanasAnio-o.diasFestivos-o.diasAusencias,[o]),h=g*o.hDia,b=h*(o.pctProductivas/100),j=o.diasVacaciones*o.hDia,k=Math.max(0,b-j),v=async()=>{await i(o),r(!0),setTimeout(()=>r(!1),2e3)},m=(f,p,d,c="")=>e.jsxs("div",{style:{background:$.surface,border:`1px solid ${$.border}`,borderRadius:3,padding:"12px 14px"},children:[e.jsx(Ut,{children:f}),d&&e.jsx("div",{style:{fontSize:9,color:$.inkLight,marginTop:1,marginBottom:6},children:d}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginTop:d?0:6},children:[e.jsx(bt,{type:"number",value:o[p],onChange:l=>s(p,l),style:{flex:1}}),c&&e.jsx("span",{style:{fontSize:11,color:$.inkLight,whiteSpace:"nowrap"},children:c})]})]},p);return e.jsx("div",{className:"fade-up",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1.2fr",gap:16},children:[e.jsx("div",{children:e.jsxs(Qt,{children:[e.jsx(ao,{children:"Configuracin de jornada"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[m("Horas por da","hDia",null,"h/da"),m("Das a la semana","diasSemana",null,"das"),m("Semanas al ao","semanasAnio",null,"semanas"),m("% Horas productivas","pctProductivas","Reuniones, dessp., admin.","%"),m("Das de vacaciones","diasVacaciones","Segn contrato","das/ao"),m("Festivos nacionales","diasFestivos","Colombia 2025","das"),m("Ausencias estimadas","diasAusencias","Prom. bajas / permisos","das/ao")]}),e.jsx("div",{style:{marginTop:14,display:"flex",justifyContent:"flex-end"},children:e.jsx(tt,{variant:"primary",onClick:v,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Ho,{size:12}),"Guardado"]}):e.jsxs(e.Fragment,{children:[e.jsx(wo,{size:12}),"Guardar"]})})})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs(Qt,{children:[e.jsx(ao,{children:"Clculo anual por empleado"}),[{lbl:"Das laborales brutos",val:bi(o.diasSemana*o.semanasAnio),unit:"das"},{lbl:"Menos festivos",val:` ${o.diasFestivos}`,unit:"das",color:$.red},{lbl:"Menos ausencias estimadas",val:` ${o.diasAusencias}`,unit:"das",color:$.amber},{lbl:"Das laborales efectivos",val:bi(g),unit:"das",bold:!0},null,{lbl:"Horas brutas totales",val:bi(h),unit:"h"},{lbl:"Horas productivas efectivas",val:bi(b),unit:"h",color:$.inkMid},{lbl:"Menos horas vacaciones",val:` ${j}`,unit:"h",color:$.red}].map((f,p)=>f===null?e.jsx("div",{style:{borderTop:`1px dashed ${$.border}`,margin:"6px 0"}},p):e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0"},children:[e.jsx("span",{style:{fontSize:12,color:$.inkMid},children:f.lbl}),e.jsxs("span",{style:{fontSize:12,fontWeight:f.bold?700:400,color:f.color||$.ink},className:"mono",children:[f.val," ",e.jsx("span",{style:{color:$.inkLight,fontSize:10},children:f.unit})]})]},p)),e.jsxs("div",{style:{marginTop:10,background:$.greenBg,borderRadius:3,padding:"12px 14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(Ut,{children:"Horas productivas netas / ao"}),e.jsx("div",{style:{fontSize:9,color:$.green,marginTop:2},children:"Base para clculo de coste/hora"})]}),e.jsx("span",{style:{fontSize:26,fontWeight:800,color:$.green},className:"mono",children:bi(k)})]})]}),e.jsxs(Qt,{children:[e.jsx(ao,{children:"Cmo se usa este dato?"}),e.jsxs("p",{style:{fontSize:11,color:$.inkMid,lineHeight:1.6},children:["Las ",e.jsxs("strong",{children:[bi(k)," horas productivas"]})," son el denominador del clculo de coste/hora por cargo:"]}),e.jsxs("div",{style:{marginTop:10,background:$.accent,borderRadius:3,padding:"10px 12px",fontFamily:"'DM Mono', monospace",fontSize:11,color:$.inkMid,lineHeight:1.8},children:["Coste/hora = Costo empleador anual  ",bi(k)," h",e.jsx("br",{}),e.jsx("span",{style:{color:$.inkLight,fontSize:10},children:"+ fraccin de estructura (activos + licencias + gastos generales)"})]})]})]})]})})}function yf({activos:t,saveActivos:i,licencias:o,saveLicencias:n,gastos:a,saveGastos:r}){const[s,g]=F.useState("activos"),[h,b]=F.useState(null),[j,k]=F.useState(null),[v,m]=F.useState(null),f=t.reduce((y,u)=>y+(u.valorCompra/u.vidaUtilAnios||0),0),p=o.reduce((y,u)=>y+Number(u.costoAnual||0),0),d=a.reduce((y,u)=>y+Number(u.montoMensual||0),0),c=f+p+d*12,l=(y,u,S,A)=>{u(E=>A?[...E,S]:E.map(w=>w.id===S.id?S:w)),b(null),k(null),m(null)},x=(y,u)=>e.jsx("button",{onClick:()=>g(y),style:{padding:"6px 14px",background:s===y?$.ink:"transparent",color:s===y?"#fff":$.inkMid,border:`1px solid ${s===y?$.ink:$.border}`,borderRadius:3,fontSize:11,fontWeight:600,letterSpacing:.5,cursor:"pointer"},children:u});return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ei,{label:"Depreciacin anual activos",value:zt(f),icon:Tn}),e.jsx(ei,{label:"Licencias / ao",value:zt(p),icon:Wc}),e.jsx(ei,{label:"Gastos generales / ao",value:zt(d*12),icon:Ao}),e.jsx(ei,{label:"Total estructura / ao",value:zt(c),icon:Ji,color:$.blue,sub:"se prorratea sobre las horas productivas"})]}),e.jsxs(Qt,{children:[e.jsxs("div",{style:{display:"flex",gap:6,marginBottom:16},children:[x("activos","Activos NIIF"),x("licencias","Licencias Software"),x("gastos","Gastos Generales")]}),s==="activos"&&e.jsxs(e.Fragment,{children:[e.jsx(ao,{action:e.jsxs(tt,{small:!0,variant:"primary",onClick:()=>b({...cf(),isNew:!0}),children:[e.jsx(Oe,{size:12}),"Nuevo activo"]}),children:"Inventario de Activos"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${$.border}`,background:$.surfaceAlt},children:[["Activo","Categora NIIF","Ao compra","Valor compra","Vida til","Dep./ao","Dep. acumulada","Valor neto","Costo/hora"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:$.inkLight,fontWeight:700,whiteSpace:"nowrap"},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{textAlign:"center",padding:"36px 0",color:$.inkLight,fontSize:12},children:"Sin activos registrados. Pulsa Nuevo activo para aadir el primero."})}),t.map(y=>{const u=y.vidaUtilAnios>0?y.valorCompra/y.vidaUtilAnios:0,S=Math.min($i-Number(y.anioCompra||$i),Number(y.vidaUtilAnios)),A=u*Math.max(0,S),E=Math.max(0,y.valorCompra-A),w=y.usoAnual>0?u/y.usoAnual:0,_=y.valorCompra>0?A/y.valorCompra*100:0,z=Xa.find(L=>L.cat===y.categoria),T=_>=90?$.red:_>=60?$.amber:$.green;return e.jsxs("tr",{style:{borderBottom:`1px solid ${$.border}`},onMouseEnter:L=>L.currentTarget.style.background=$.surfaceAlt,onMouseLeave:L=>L.currentTarget.style.background="",children:[e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("div",{style:{fontWeight:600,color:$.ink},children:y.nombre||""}),y.baseNiif&&e.jsx("div",{style:{fontSize:9,color:$.inkLight,marginTop:1},children:y.baseNiif})]}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[e.jsx("span",{children:(z==null?void 0:z.icono)||""}),e.jsx("span",{style:{fontSize:11,color:$.inkMid},children:y.categoria||""})]})}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",textAlign:"center",color:$.inkMid},children:y.anioCompra||""}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:zt(y.valorCompra)}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsxs("span",{className:"mono",style:{fontSize:12,fontWeight:600},children:[y.vidaUtilAnios," aos"]}),y.vidaUtilEditada&&e.jsx(Wt,{color:$.amber,bg:$.amberBg,children:"Manual"})]}),e.jsx("div",{style:{fontSize:9,color:$.inkLight},children:y.metodo})]}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:zt(u)}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("div",{className:"mono",style:{fontSize:12},children:zt(A)}),e.jsx("div",{style:{marginTop:3,background:$.accent,borderRadius:2,height:3},children:e.jsx("div",{style:{width:`${Math.min(_,100)}%`,height:"100%",borderRadius:2,background:_>=90?$.red:_>=60?$.amber:$.blue}})}),e.jsxs("div",{style:{fontSize:9,color:$.inkLight,marginTop:1},children:[_.toFixed(0),"% amortizado"]})]}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("span",{className:"mono",style:{fontSize:12,fontWeight:700,color:T},children:zt(E)}),E===0&&e.jsx("div",{style:{fontSize:9,color:$.red},children:"Totalmente amortizado"})]}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Wt,{color:$.blue,bg:$.blueBg,children:[zt(w),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(tt,{small:!0,variant:"ghost",onClick:()=>b({...y,isNew:!1}),children:e.jsx(ro,{size:11})}),e.jsx(tt,{small:!0,variant:"danger",onClick:()=>i(L=>L.filter(Z=>Z.id!==y.id)),children:e.jsx(He,{size:11})})]})})]},y.id)})]})]})}),t.length>0&&e.jsx("div",{style:{marginTop:12,display:"flex",gap:12,flexWrap:"wrap"},children:[{lbl:"Total en libros (valor neto)",val:zt(t.reduce((y,u)=>{const A=(u.vidaUtilAnios>0?u.valorCompra/u.vidaUtilAnios:0)*Math.min($i-Number(u.anioCompra||$i),Number(u.vidaUtilAnios));return y+Math.max(0,u.valorCompra-A)},0)),color:$.ink},{lbl:"Dep. anual total en estructura",val:zt(t.reduce((y,u)=>y+(u.vidaUtilAnios>0?u.valorCompra/u.vidaUtilAnios:0),0)),color:$.blue},{lbl:"Activos totalmente amortizados",val:t.filter(y=>{const u=y.vidaUtilAnios>0?y.valorCompra/y.vidaUtilAnios:0;return y.valorCompra-u*Math.min($i-Number(y.anioCompra||$i),Number(y.vidaUtilAnios))<=0}).length,color:$.red,isNum:!0}].map(y=>e.jsxs("div",{style:{background:$.surface,border:`1px solid ${$.border}`,borderRadius:3,padding:"10px 14px",flex:1,minWidth:160},children:[e.jsx(Ut,{children:y.lbl}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:y.color,marginTop:5},className:"mono",children:(y.isNum,y.val)})]},y.lbl))})]}),s==="licencias"&&e.jsxs(e.Fragment,{children:[e.jsx(ao,{action:e.jsxs(tt,{small:!0,variant:"primary",onClick:()=>k({...pf(),isNew:!0}),children:[e.jsx(Oe,{size:12}),"Nueva licencia"]}),children:"Licencias de Software"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${$.border}`},children:[["Software","Plan","Usuarios","Costo/ao","Costo/mes","Costo/hora*"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:$.inkLight,fontWeight:700},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"30px 0",color:$.inkLight,fontSize:12},children:"Sin licencias registradas"})}),o.map(y=>e.jsxs("tr",{style:{borderBottom:`1px solid ${$.border}`},onMouseEnter:u=>u.currentTarget.style.background=$.surfaceAlt,onMouseLeave:u=>u.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},children:y.nombre||""}),e.jsx("td",{style:{padding:"10px 10px",color:$.inkMid},children:y.plan||""}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",textAlign:"center"},children:y.usuarios}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:zt(y.costoAnual)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",color:$.inkMid},children:zt(y.costoAnual/12)}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Wt,{color:$.blue,bg:$.blueBg,children:[zt(y.costoAnual/1760/y.usuarios||1),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(tt,{small:!0,variant:"ghost",onClick:()=>k({...y,isNew:!1}),children:e.jsx(ro,{size:11})}),e.jsx(tt,{small:!0,variant:"danger",onClick:()=>n(u=>u.filter(S=>S.id!==y.id)),children:e.jsx(He,{size:11})})]})})]},y.id))]})]}),e.jsx("p",{style:{fontSize:9,color:$.inkLight,marginTop:10},children:"* Basado en 1.760 h/ao. Se recalcula con la jornada configurada en la pestaa de Jornada."})]}),s==="gastos"&&e.jsxs(e.Fragment,{children:[e.jsx(ao,{action:e.jsxs(tt,{small:!0,variant:"primary",onClick:()=>m({...gf(),isNew:!0}),children:[e.jsx(Oe,{size:12}),"Nuevo gasto"]}),children:"Gastos Generales de Empresa"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${$.border}`},children:[["Concepto","Categora","Mensual","Anual"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:$.inkLight,fontWeight:700},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"30px 0",color:$.inkLight,fontSize:12},children:"Sin gastos registrados"})}),a.map(y=>e.jsxs("tr",{style:{borderBottom:`1px solid ${$.border}`},onMouseEnter:u=>u.currentTarget.style.background=$.surfaceAlt,onMouseLeave:u=>u.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},children:y.concepto||""}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsx(Wt,{children:y.categoria})}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:zt(y.montoMensual)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:zt(y.montoMensual*12)}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(tt,{small:!0,variant:"ghost",onClick:()=>m({...y,isNew:!1}),children:e.jsx(ro,{size:11})}),e.jsx(tt,{small:!0,variant:"danger",onClick:()=>r(u=>u.filter(S=>S.id!==y.id)),children:e.jsx(He,{size:11})})]})})]},y.id)),a.length>0&&e.jsxs("tr",{style:{background:$.accent,fontWeight:700},children:[e.jsx("td",{colSpan:2,style:{padding:"10px 10px",fontSize:11},children:"TOTAL GASTOS GENERALES"}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:zt(d)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:zt(d*12)}),e.jsx("td",{})]})]})]})]})]}),h&&(()=>{const y=Xa.find(w=>w.cat===h.categoria),u=h.vidaUtilAnios>0?h.valorCompra/h.vidaUtilAnios:0,S=Math.min($i-Number(h.anioCompra||$i),Number(h.vidaUtilAnios)),A=u*Math.max(0,S),E=Math.max(0,h.valorCompra-A);return e.jsxs(sa,{title:h.isNew?"Nuevo activo NIIF":"Editar activo",onClose:()=>b(null),wide:!0,children:[e.jsxs("div",{style:{marginBottom:14},children:[e.jsx(Ut,{children:"Categora NIIF"}),e.jsx("div",{style:{marginTop:6,display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6},children:Xa.map(w=>e.jsxs("button",{onClick:()=>b(_=>({..._,categoria:w.cat,metodo:w.metodo,baseNiif:w.base,vidaUtilAnios:w.vida,usoAnual:w.usoRef,vidaUtilEditada:!1})),style:{padding:"8px 6px",borderRadius:3,border:`1px solid ${h.categoria===w.cat?$.ink:$.border}`,background:h.categoria===w.cat?$.ink:$.surface,color:h.categoria===w.cat?"#fff":$.inkMid,fontSize:10,cursor:"pointer",textAlign:"center",lineHeight:1.3,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("div",{style:{fontSize:18,marginBottom:3},children:w.icono}),e.jsx("div",{style:{fontWeight:h.categoria===w.cat?700:400},children:w.cat})]},w.cat))}),y&&e.jsxs("div",{style:{marginTop:8,background:$.blueBg,borderRadius:3,padding:"8px 12px",display:"flex",gap:12,alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,color:$.blue},children:"Norma aplicable: "}),e.jsx("span",{style:{fontSize:10,color:$.blue},children:y.base})]}),e.jsx("div",{style:{flex:2,fontSize:10,color:$.blue,opacity:.8},children:y.nota})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:8},children:[e.jsx(yt,{label:"Nombre del activo",children:e.jsx(bt,{value:h.nombre,onChange:w=>b(_=>({..._,nombre:w})),placeholder:"Ej. MacBook Pro 14 M3"})}),e.jsx(yt,{label:"Ao de compra",children:e.jsx(bt,{type:"number",value:h.anioCompra,onChange:w=>b(_=>({..._,anioCompra:w})),placeholder:String($i)})}),e.jsx(yt,{label:"Valor de compra (COP)",children:e.jsx(bt,{type:"number",value:h.valorCompra,onChange:w=>b(_=>({..._,valorCompra:w}))})}),e.jsx(yt,{label:"Horas de uso estimadas/ao",children:e.jsx(bt,{type:"number",value:h.usoAnual,onChange:w=>b(_=>({..._,usoAnual:w}))})})]}),e.jsxs("div",{style:{background:$.accent,borderRadius:3,padding:"12px 14px",marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(Ut,{children:"Vida til (aos)"}),e.jsx("button",{onClick:()=>b(w=>({...w,vidaUtilEditada:!w.vidaUtilEditada})),style:{fontSize:9,color:$.blue,background:"none",border:"none",cursor:"pointer",textDecoration:"underline"},children:h.vidaUtilEditada?" Restaurar valor NIIF":"Editar manualmente"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx(Ut,{children:"Vida til"}),e.jsx(bt,{type:"number",value:h.vidaUtilAnios,readOnly:!h.vidaUtilEditada,onChange:w=>b(_=>({..._,vidaUtilAnios:w,vidaUtilEditada:!0})),style:{marginTop:4,background:h.vidaUtilEditada?$.surface:$.accent}}),y&&!h.vidaUtilEditada&&e.jsxs("div",{style:{fontSize:9,color:$.green,marginTop:2},children:[" Segn ",y.base]})]}),e.jsxs("div",{children:[e.jsx(Ut,{children:"Mtodo"}),e.jsx(bt,{value:h.metodo,readOnly:!0,style:{marginTop:4,background:$.accent}})]}),e.jsxs("div",{children:[e.jsx(Ut,{children:"Norma"}),e.jsx(bt,{value:h.baseNiif,readOnly:!0,style:{marginTop:4,background:$.accent,fontSize:10}})]})]})]}),h.valorCompra>0&&h.vidaUtilAnios>0&&e.jsxs("div",{style:{background:$.greenBg,borderRadius:3,padding:"12px 14px",marginBottom:8},children:[e.jsx(Ut,{children:"Vista previa de depreciacin"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginTop:8},children:[{lbl:"Dep. anual",val:zt(u)},{lbl:"Dep. acumulada",val:zt(A)},{lbl:"Valor neto libros",val:zt(E),bold:!0},{lbl:"Costo/hora uso",val:zt(h.usoAnual>0?u/h.usoAnual:0)+"/h"}].map(w=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:$.green,marginBottom:3},children:w.lbl}),e.jsx("div",{style:{fontSize:13,fontWeight:w.bold?800:600,color:$.green},className:"mono",children:w.val})]},w.lbl))}),A>=h.valorCompra&&e.jsx("div",{style:{marginTop:8,fontSize:10,color:$.red,fontWeight:600},children:" Este activo est totalmente amortizado. Considera darlo de baja o actualizar el ao de compra."})]}),e.jsx(la,{onCancel:()=>b(null),onSave:()=>l(t,i,h,h.isNew)})]})})(),j&&e.jsxs(sa,{title:j.isNew?"Nueva licencia":"Editar licencia",onClose:()=>k(null),children:[[["nombre","Software","text"],["plan","Plan","text"],["usuarios","N usuarios","number"],["costoAnual","Costo anual (COP)","number"]].map(([y,u,S])=>e.jsx(yt,{label:u,children:e.jsx(bt,{type:S,value:j[y],onChange:A=>k(E=>({...E,[y]:A}))})},y)),e.jsx(la,{onCancel:()=>k(null),onSave:()=>l(o,n,j,j.isNew)})]}),v&&e.jsxs(sa,{title:v.isNew?"Nuevo gasto":"Editar gasto",onClose:()=>m(null),children:[e.jsx(yt,{label:"Concepto",children:e.jsx(bt,{value:v.concepto,onChange:y=>m(u=>({...u,concepto:y}))})}),e.jsx(yt,{label:"Categora",children:e.jsx(yi,{value:v.categoria,onChange:y=>m(u=>({...u,categoria:y})),options:["Oficina","Comunicaciones","Seguros","Suscripciones","Transporte","Otros"]})}),e.jsx(yt,{label:"Monto mensual (COP)",children:e.jsx(bt,{type:"number",value:v.montoMensual,onChange:y=>m(u=>({...u,montoMensual:y}))})}),e.jsx(la,{onCancel:()=>m(null),onSave:()=>l(a,r,v,v.isNew)})]})]})}function vf({equipo:t,setEquipo:i,cargos:o,pais:n}){const[a,r]=F.useState(null),[s,g]=F.useState(""),h=n==="CO"?af:sf,b=()=>{var k;return{id:Xi(),nombre:"",documento:"",cargo:((k=o[0])==null?void 0:k.id)||"",email:"",telefono:"",tipoContrato:h[0],fechaIngreso:fi(),pin:"",activo:!0,pais:n,foto:null}},j=F.useMemo(()=>t.filter(k=>{var v,m;return!s||k.nombre.toLowerCase().includes(s.toLowerCase())||((v=k.documento)==null?void 0:v.includes(s))||((m=k.email)==null?void 0:m.toLowerCase().includes(s.toLowerCase()))}),[t,s]);return e.jsxs("div",{children:[e.jsxs(ai,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsxs("div",{style:{flex:1,fontSize:16,fontWeight:700,color:je.ink},children:["Equipo (",t.filter(k=>k.activo).length," activos)"]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ci,{size:13,style:{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",color:je.inkLight}}),e.jsx("input",{value:s,onChange:k=>g(k.target.value),placeholder:"Buscar...",style:{padding:"7px 10px 7px 28px",border:`1px solid ${je.border}`,borderRadius:6,fontSize:13,outline:"none",width:180}})]}),e.jsx(tt,{icon:Oe,onClick:()=>r(b()),children:"Aadir empleado"})]}),a&&e.jsxs(Qt,{style:{marginBottom:16,border:`1px solid ${je.green}`},children:[e.jsx(dc,{icon:Bi,children:"Nuevo empleado"}),e.jsxs(ai,{gap:14,wrap:!0,children:[e.jsx(zi,{children:e.jsx(io,{label:"Nombre completo",req:!0,value:a.nombre,onChange:k=>r({...a,nombre:k.target.value})})}),e.jsx(zi,{children:e.jsx(io,{label:n==="CO"?"Cdula / CC":"DNI / NIE",req:!0,value:a.documento,onChange:k=>r({...a,documento:k.target.value})})}),e.jsx(zi,{children:e.jsx(Gl,{label:"Cargo",value:a.cargo,onChange:k=>r({...a,cargo:k.target.value}),options:[{value:"",label:" Sin cargo "},...o.map(k=>({value:k.id,label:k.nombre}))]})})]}),e.jsxs(ai,{gap:14,wrap:!0,children:[e.jsx(zi,{children:e.jsx(io,{label:"Email",type:"email",value:a.email,onChange:k=>r({...a,email:k.target.value})})}),e.jsx(zi,{children:e.jsx(io,{label:"Telfono",value:a.telefono,onChange:k=>r({...a,telefono:k.target.value})})}),e.jsx(zi,{children:e.jsx(io,{label:"Fecha ingreso",type:"date",value:a.fechaIngreso,onChange:k=>r({...a,fechaIngreso:k.target.value})})})]}),e.jsxs(ai,{gap:14,wrap:!0,children:[e.jsx(zi,{children:e.jsx(Gl,{label:"Tipo contrato",value:a.tipoContrato,onChange:k=>r({...a,tipoContrato:k.target.value}),options:h})}),e.jsxs(zi,{children:[e.jsx(io,{label:"PIN de 4 dgitos (para fichaje de obra)",type:"password",maxLength:4,value:a.pin,onChange:k=>r({...a,pin:k.target.value.replace(/\D/g,"").slice(0,4)}),placeholder:""}),e.jsx("div",{style:{fontSize:11,color:je.inkLight,marginTop:-8},children:"El trabajador lo usa para fichar en obra"})]}),e.jsx(zi,{children:e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(un,{children:"Estado"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginTop:6},children:[e.jsx("input",{type:"checkbox",checked:a.activo,onChange:k=>r({...a,activo:k.target.checked}),style:{width:16,height:16}}),e.jsx("span",{style:{fontSize:13},children:"Empleado activo"})]})]})})]}),e.jsxs(ai,{gap:8,children:[e.jsx(tt,{icon:xt,onClick:()=>{i(k=>[...k,a]),r(null)},children:"Guardar"}),e.jsx(tt,{variant:"secondary",onClick:()=>r(null),children:"Cancelar"})]})]}),e.jsx("div",{style:{overflowX:"auto",border:`1px solid ${je.border}`,borderRadius:8},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:600},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:je.bg},children:["Empleado","Cargo","Tipo contrato","Ingreso","Estado","PIN",""].map(k=>e.jsx("th",{style:{padding:"8px 12px",fontSize:11,fontWeight:600,color:je.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${je.border}`},children:k},k))})}),e.jsxs("tbody",{children:[j.map((k,v)=>{const m=o.find(f=>f.id===k.cargo);return e.jsxs("tr",{style:{background:v%2===0?je.card:je.bg},children:[e.jsxs("td",{style:{padding:"10px 12px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:k.nombre}),e.jsx("div",{style:{fontSize:11,color:je.inkLight},children:k.documento})]}),e.jsx("td",{style:{padding:"10px 12px",fontSize:13,color:je.inkMid},children:(m==null?void 0:m.nombre)||""}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:je.inkMid},children:k.tipoContrato}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:je.inkMid},children:Vs(k.fechaIngreso)}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx(Wt,{color:k.activo?je.green:je.inkLight,children:k.activo?"Activo":"Inactivo"})}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:je.inkLight,fontFamily:"'DM Mono',monospace"},children:k.pin?"":""}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("button",{onClick:()=>i(f=>f.filter(p=>p.id!==k.id)),style:{background:"none",border:"none",cursor:"pointer",color:je.red,padding:2},children:e.jsx(He,{size:13})})})]},k.id)}),j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:"32px",textAlign:"center",color:je.inkLight,fontSize:13},children:"Sin empleados."})})]})]})})]})}function jf({partes:t,setPartes:i,equipo:o,cargos:n,currentUser:a,pais:r}){const[s,g]=F.useState(null),[h,b]=F.useState(null),[j,k]=F.useState("todas"),[v,m]=F.useState({});F.useEffect(()=>{(async()=>{const u={};try{const S=Ee.listSync("hab:proj:actividades:").items;if(S!=null&&S.keys)for(const A of S.keys)try{const E=Ee.getSync(A);if(E){const w=JSON.parse(E),_=A.replace("hab:proj:actividades:","");u[_]=w}}catch{}}catch{}m(u)})()},[]);const f=!a||xf.includes(a.rol),p=[...new Set(t.map(u=>u.otId).filter(Boolean))],d=()=>({id:Xi(),fecha:fi(),encargadoId:(a==null?void 0:a.id)||"",encargadoNombre:(a==null?void 0:a.nombre)||"",otId:"",actividadId:"",actividadNombre:"",trabajadores:[],horasPorTrabajador:{},avance:0,notas:"",fotos:[],estado:"borrador",creadoEn:lc()}),c=F.useMemo(()=>a?o.filter(u=>u.activo):o,[o,a]),l=u=>v[u]||[],x=Object.keys(v),y=F.useMemo(()=>t.filter(u=>j==="todas"||u.otId===j),[t,j]);return e.jsxs("div",{children:[e.jsxs(ai,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsxs("div",{style:{flex:1,fontSize:16,fontWeight:700,color:je.ink},children:["Partes de Trabajo (",t.length,")"]}),!f&&e.jsx(Wt,{color:je.amber,children:"Solo encargados y supervisores pueden crear partes"}),f&&e.jsx(tt,{icon:Oe,onClick:()=>g(d()),children:"Nuevo parte"})]}),e.jsxs("div",{style:{background:je.blueL,border:`1px solid ${je.blue}22`,borderRadius:8,padding:"10px 14px",marginBottom:16,fontSize:12,color:je.blue},children:[e.jsx("strong",{children:"Reglas de partes:"})," Solo el encargado/supervisor/jefe crea partes. Selecciona la OT  la actividad del Gantt (definida en el borrador de costes del CRM)  el equipo que trabaj. El avance del Gantt se actualiza automticamente."]}),s&&e.jsxs(Qt,{style:{marginBottom:16,border:`1px solid ${je.green}`},children:[e.jsx(dc,{icon:Et,color:je.green,children:"Nuevo parte de trabajo"}),e.jsxs(ai,{gap:14,wrap:!0,children:[e.jsx(zi,{children:e.jsx(io,{label:"Fecha",type:"date",value:s.fecha,onChange:u=>g({...s,fecha:u.target.value})})}),e.jsx(zi,{children:e.jsx(io,{label:"Encargado responsable",value:s.encargadoNombre||(a==null?void 0:a.nombre)||"",disabled:!0})})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(un,{req:!0,children:"OT / Proyecto"}),x.length===0?e.jsx("div",{style:{padding:"10px 12px",background:je.amberL,borderRadius:6,fontSize:12,color:je.amber},children:' No hay OTs con actividades del Gantt. Ve al mdulo CRM, completa el borrador de costes de una oferta ganada y usa "Exportar al Gantt".'}):e.jsxs("select",{value:s.otId,onChange:u=>{g({...s,otId:u.target.value,actividadId:"",actividadNombre:""})},style:{width:"100%",padding:"8px 10px",border:`1px solid ${je.border}`,borderRadius:6,fontSize:13,background:je.card},children:[e.jsx("option",{value:"",children:" Seleccionar OT "}),x.map(u=>{var S,A;return e.jsx("option",{value:u,children:((A=(S=v[u])==null?void 0:S[0])==null?void 0:A.otNombre)||u},u)})]})]}),s.otId&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(un,{req:!0,children:"Actividad del Gantt"}),e.jsxs("select",{value:s.actividadId,onChange:u=>{const S=l(s.otId).find(A=>A.id===u.target.value);g({...s,actividadId:u.target.value,actividadNombre:(S==null?void 0:S.nombre)||""})},style:{width:"100%",padding:"8px 10px",border:`1px solid ${je.border}`,borderRadius:6,fontSize:13,background:je.card},children:[e.jsx("option",{value:"",children:" Seleccionar actividad "}),l(s.otId).map(u=>e.jsxs("option",{value:u.id,children:[u.codigo,"  ",u.nombre," (",u.cantidad," ",u.unidad,")"]},u.id))]}),s.actividadId&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(un,{children:"% Avance de esta actividad al finalizar hoy"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("input",{type:"range",min:0,max:100,step:5,value:s.avance,onChange:u=>g({...s,avance:parseInt(u.target.value)}),style:{flex:1}}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:15,color:je.green,minWidth:40},children:[s.avance,"%"]})]})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(un,{children:"Equipo que trabaj hoy en esta actividad"}),e.jsxs("div",{style:{border:`1px solid ${je.border}`,borderRadius:6,overflow:"hidden"},children:[c.length===0&&e.jsx("div",{style:{padding:"12px",fontSize:12,color:je.inkLight},children:"Sin empleados en el equipo. Ve a la pestaa Equipo para aadir trabajadores."}),c.map((u,S)=>{var E;const A=s.trabajadores.includes(u.id);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",background:A?je.greenL:S%2===0?je.card:je.bg,borderBottom:`1px solid ${je.border}`,cursor:"pointer"},onClick:()=>g(w=>{const _=A?w.trabajadores.filter(T=>T!==u.id):[...w.trabajadores,u.id],z={...w.horasPorTrabajador};return A?delete z[u.id]:z[u.id]=8,{...w,trabajadores:_,horasPorTrabajador:z}}),children:[e.jsx("input",{type:"checkbox",readOnly:!0,checked:A,style:{width:15,height:15,accentColor:je.green}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:A?600:400,color:je.ink},children:u.nombre}),e.jsx("div",{style:{fontSize:11,color:je.inkLight},children:((E=n.find(w=>w.id===u.cargo))==null?void 0:E.nombre)||"Sin cargo"})]}),A&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},onClick:w=>w.stopPropagation(),children:[e.jsx("span",{style:{fontSize:11,color:je.inkMid},children:"Horas:"}),e.jsx("input",{type:"number",min:"0",max:"24",step:"0.5",value:s.horasPorTrabajador[u.id]||8,onChange:w=>g(_=>({..._,horasPorTrabajador:{..._.horasPorTrabajador,[u.id]:parseFloat(w.target.value)||0}})),style:{width:56,border:`1px solid ${je.green}`,borderRadius:4,padding:"3px 6px",fontSize:13,textAlign:"center",fontFamily:"'DM Mono',monospace"}})]})]},u.id)})]}),s.trabajadores.length>0&&e.jsxs("div",{style:{fontSize:12,color:je.inkMid,marginTop:6},children:["Total horas parte: ",bi(Object.values(s.horasPorTrabajador).reduce((u,S)=>u+S,0),1)," h  ",s.trabajadores.length," personas"]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(un,{children:"Observaciones / Notas de obra"}),e.jsx("textarea",{value:s.notas,onChange:u=>g({...s,notas:u.target.value}),rows:2,style:{width:"100%",boxSizing:"border-box",padding:"8px 10px",border:`1px solid ${je.border}`,borderRadius:6,fontSize:13,resize:"vertical"},placeholder:"Incidencias, materiales consumidos, condiciones de trabajo..."})]}),e.jsxs(ai,{gap:8,children:[e.jsx(tt,{icon:xt,onClick:()=>{if(!s.otId||!s.actividadId){alert("Selecciona OT y actividad.");return}if(s.trabajadores.length===0){alert("Selecciona al menos un trabajador.");return}const u={...s,estado:"confirmado"};i(S=>[u,...S]);try{const S="hab:proj:actividades:"+s.otId,A=Ee.get(S);if(A!=null&&A.value){const w=JSON.parse(A).map(_=>_.id===s.actividadId?{..._,avance:s.avance}:_);Ee.set(S,JSON.stringify(w))}}catch{}g(null)},children:"Confirmar parte"}),e.jsx(tt,{variant:"secondary",onClick:()=>g(null),children:"Cancelar"})]})]}),p.length>0&&e.jsx(ai,{gap:6,style:{marginBottom:12},wrap:!0,children:["todas",...p].map(u=>e.jsx("button",{onClick:()=>k(u),style:{padding:"5px 12px",borderRadius:20,border:`1px solid ${j===u?je.green:je.border}`,background:j===u?je.greenL:"transparent",fontSize:12,cursor:"pointer",color:j===u?je.green:je.inkMid},children:u==="todas"?"Todas las OTs":u},u))}),e.jsx("div",{style:{border:`1px solid ${je.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:je.bg},children:["Fecha","OT / Actividad","Encargado","Equipo","Horas totales","Avance","Estado",""].map(u=>e.jsx("th",{style:{padding:"7px 10px",fontSize:11,fontWeight:600,color:je.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${je.border}`},children:u},u))})}),e.jsxs("tbody",{children:[y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:"32px",textAlign:"center",color:je.inkLight,fontSize:13},children:"Sin partes de trabajo."})}),y.map((u,S)=>{var w;const A=Object.values(u.horasPorTrabajador||{}).reduce((_,z)=>_+z,0),E=u.estado==="confirmado"?je.green:u.estado==="validado"?je.blue:je.amber;return e.jsxs("tr",{style:{background:S%2===0?je.card:je.bg,cursor:"pointer"},onClick:()=>b(u),onMouseEnter:_=>_.currentTarget.style.background=je.blueL,onMouseLeave:_=>_.currentTarget.style.background=S%2===0?je.card:je.bg,children:[e.jsx("td",{style:{padding:"9px 10px",fontSize:12},children:Vs(u.fecha)}),e.jsxs("td",{style:{padding:"9px 10px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:u.otId||""}),e.jsx("div",{style:{fontSize:11,color:je.inkMid},children:u.actividadNombre})]}),e.jsx("td",{style:{padding:"9px 10px",fontSize:12,color:je.inkMid},children:u.encargadoNombre||""}),e.jsxs("td",{style:{padding:"9px 10px",fontSize:12},children:[((w=u.trabajadores)==null?void 0:w.length)||0," personas"]}),e.jsxs("td",{style:{padding:"9px 10px",fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:600},children:[bi(A,1)," h"]}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:je.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{width:`${u.avance||0}%`,height:"100%",background:u.avance>=80?je.green:u.avance>=40?je.amber:je.blue,borderRadius:3}})}),e.jsxs("span",{style:{fontSize:11,color:je.inkMid,minWidth:28,fontFamily:"'DM Mono',monospace"},children:[u.avance||0,"%"]})]})}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsx(Wt,{color:E,children:u.estado})}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsx("button",{onClick:_=>{_.stopPropagation(),i(z=>z.filter(T=>T.id!==u.id))},style:{background:"none",border:"none",cursor:"pointer",color:je.red,padding:2},children:e.jsx(He,{size:12})})})]},u.id)})]})]})}),h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:e.jsxs("div",{style:{background:je.card,borderRadius:12,width:"100%",maxWidth:540,maxHeight:"85vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${je.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:15},children:["Parte  ",Vs(h.fecha)]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:je.inkLight},children:e.jsx($t,{size:18})})]}),e.jsxs("div",{style:{padding:18},children:[[["OT",h.otId],["Actividad",h.actividadNombre],["Encargado",h.encargadoNombre],["% Avance",h.avance+"%"],["Notas",h.notas||""]].map(([u,S])=>e.jsxs("div",{style:{display:"flex",gap:12,padding:"7px 0",borderBottom:`1px solid ${je.border}`,fontSize:13},children:[e.jsx("span",{style:{fontWeight:600,color:je.inkMid,minWidth:90},children:u}),e.jsx("span",{style:{color:je.ink},children:S})]},u)),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{style:{fontWeight:600,fontSize:12,color:je.inkMid,textTransform:"uppercase",letterSpacing:.5,marginBottom:8},children:"Equipo y horas"}),(h.trabajadores||[]).map(u=>{var E;const S=o.find(w=>w.id===u),A=((E=h.horasPorTrabajador)==null?void 0:E[u])||0;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0",fontSize:13,borderBottom:`1px solid ${je.border}`},children:[e.jsx("span",{children:(S==null?void 0:S.nombre)||u}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:[bi(A,1)," h"]})]},u)})]})]})]})})]})}function Sf({equipo:t,asistencia:i,setAsistencia:o,pais:n}){var te,he;const[a,r]=F.useState("encargado"),[s,g]=F.useState(fi());F.useState(!1);const[h,b]=F.useState(1),[j,k]=F.useState(null),[v,m]=F.useState(""),[f,p]=F.useState(!1),[d,c]=F.useState(null),[l,x]=F.useState(null),[y,u]=F.useState(null),[S,A]=F.useState(null),E=F.useRef(null),w=F.useRef(null),_=F.useMemo(()=>i.filter(Q=>Q.fecha===s).sort((Q,Se)=>Q.timestamp<Se.timestamp?-1:1),[i,s]),z=F.useMemo(()=>{const Q={};return _.forEach(Se=>{Q[Se.empleadoId]||(Q[Se.empleadoId]=[]),Q[Se.empleadoId].push(Se)}),Q},[_]),T=async()=>{try{A(null);const Q=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}},audio:!1});w.current=Q,E.current&&(E.current.srcObject=Q)}catch(Q){A("No se pudo acceder a la cmara: "+Q.message+". Asegrate de dar permiso.")}},L=()=>{w.current&&(w.current.getTracks().forEach(Q=>Q.stop()),w.current=null)},Z=()=>{if(!E.current)return;const Q=document.createElement("canvas");Q.width=E.current.videoWidth||640,Q.height=E.current.videoHeight||480,Q.getContext("2d").drawImage(E.current,0,0,Q.width,Q.height);const Se=Q.toDataURL("image/jpeg",.7);c(Se),L(),navigator.geolocation?navigator.geolocation.getCurrentPosition(ae=>x({lat:ae.coords.latitude,lng:ae.coords.longitude,precision:Math.round(ae.coords.accuracy)}),ae=>u("GPS no disponible: "+ae.message),{timeout:8e3,maximumAge:0}):u("Geolocalizacin no disponible en este dispositivo."),b(4)},K=()=>{var ae;if(!d){alert("La foto es obligatoria.");return}const Q=((ae=z[j.id])==null?void 0:ae.length)%2===0?"entrada":"salida",Se={id:Xi(),empleadoId:j.id,empleadoNombre:j.nombre,fecha:s,timestamp:lc(),tipo:Q,foto:d,lat:(l==null?void 0:l.lat)||null,lng:(l==null?void 0:l.lng)||null,precision:(l==null?void 0:l.precision)||null,gpsError:y||null};o(U=>[...U,Se]),b(5),L()},P=()=>{b(1),k(null),m(""),p(!1),c(null),x(null),u(null),A(null),L()};return F.useEffect(()=>()=>L(),[]),e.jsxs("div",{children:[e.jsxs(ai,{gap:8,style:{marginBottom:16},wrap:!0,children:[e.jsx("button",{onClick:()=>r("encargado"),style:{flex:1,padding:"10px 16px",borderRadius:8,border:`2px solid ${a==="encargado"?je.green:je.border}`,background:a==="encargado"?je.greenL:je.card,cursor:"pointer",fontFamily:"DM Sans,sans-serif",fontSize:13,fontWeight:a==="encargado"?600:400,color:a==="encargado"?je.green:je.inkMid},children:" Vista encargado  Panel del da"}),e.jsx("button",{onClick:()=>{r("fichaje"),P()},style:{flex:1,padding:"10px 16px",borderRadius:8,border:`2px solid ${a==="fichaje"?je.teal:je.border}`,background:a==="fichaje"?je.tealL:je.card,cursor:"pointer",fontFamily:"DM Sans,sans-serif",fontSize:13,fontWeight:a==="fichaje"?600:400,color:a==="fichaje"?je.teal:je.inkMid},children:" Fichaje del trabajador  Foto + GPS"})]}),a==="encargado"&&e.jsxs("div",{children:[e.jsxs(ai,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsx("div",{style:{fontSize:16,fontWeight:700,color:je.ink,flex:1},children:"Asistencia de obra"}),e.jsx(io,{label:"",type:"date",value:s,onChange:Q=>g(Q.target.value),style:{marginBottom:0,width:160}})]}),e.jsx(ai,{gap:12,style:{marginBottom:16},wrap:!0,children:[["Presentes",Object.keys(z).filter(Q=>z[Q].some(Se=>Se.tipo==="entrada"&&!z[Q].some(ae=>ae.tipo==="salida"&&ae.timestamp>Se.timestamp))).length.toString(),je.green],["Fichajes hoy",_.length.toString(),je.blue],["Sin fichar",t.filter(Q=>Q.activo&&!z[Q.id]).length.toString(),je.amber]].map(([Q,Se,ae])=>e.jsxs("div",{style:{flex:1,minWidth:100,background:je.card,border:`1px solid ${je.border}`,borderRadius:8,padding:"10px 14px",borderLeft:`3px solid ${ae}`},children:[e.jsx("div",{style:{fontSize:11,color:je.inkLight},children:Q}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:ae,fontFamily:"'DM Mono',monospace"},children:Se})]},Q))}),e.jsx(Qt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:je.bg},children:["Empleado","Entrada","Salida","Horas","Foto","GPS","Estado"].map(Q=>e.jsx("th",{style:{padding:"8px 12px",fontSize:11,fontWeight:600,color:je.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${je.border}`},children:Q},Q))})}),e.jsxs("tbody",{children:[t.filter(Q=>Q.activo).map((Q,Se)=>{const ae=z[Q.id]||[],U=ae.find(ee=>ee.tipo==="entrada"),M=ae.find(ee=>ee.tipo==="salida"),B=diffHours(U==null?void 0:U.timestamp,M==null?void 0:M.timestamp),H=U&&!M;return e.jsxs("tr",{style:{background:Se%2===0?je.card:je.bg},children:[e.jsxs("td",{style:{padding:"9px 12px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:Q.nombre}),e.jsx("div",{style:{fontSize:11,color:je.inkLight},children:Q.documento})]}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontSize:13,color:U?je.green:je.inkLight},children:U?fmtTime(U.timestamp):""}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontSize:13,color:M?je.red:je.inkLight},children:M?fmtTime(M.timestamp):""}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontWeight:600,fontSize:13},children:B?bi(B,1)+" h":""}),e.jsx("td",{style:{padding:"9px 12px"},children:U!=null&&U.foto?e.jsx("img",{src:U.foto,alt:"foto",style:{width:36,height:36,borderRadius:4,objectFit:"cover",cursor:"pointer",border:`1px solid ${je.border}`},onClick:()=>{window.open().document.write(`<img src="${U.foto}" style="max-width:100%"/>`)}}):e.jsx("span",{style:{fontSize:11,color:je.inkLight},children:""})}),e.jsx("td",{style:{padding:"9px 12px",fontSize:12},children:U!=null&&U.lat?e.jsxs("a",{href:`https://www.openstreetmap.org/?mlat=${U.lat}&mlon=${U.lng}&zoom=17`,target:"_blank",rel:"noreferrer",style:{color:je.blue,fontSize:11},children:[" ",U.precision,"m"]}):e.jsx("span",{style:{fontSize:11,color:je.inkLight},children:U!=null&&U.gpsError?"Sin GPS":""})}),e.jsx("td",{style:{padding:"9px 12px"},children:U?H?e.jsx(Wt,{color:je.green,children:"En obra"}):e.jsx(Wt,{color:je.inkLight,children:"Salida"}):e.jsx(Wt,{color:je.amber,children:"Sin fichar"})})]},Q.id)}),t.filter(Q=>Q.activo).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:"24px",textAlign:"center",color:je.inkLight,fontSize:13},children:"Sin empleados activos."})})]})]})})]}),a==="fichaje"&&e.jsx("div",{style:{maxWidth:400,margin:"0 auto"},children:h===5?e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:je.green,marginBottom:8},children:"Fichaje registrado"}),e.jsxs("div",{style:{fontSize:14,color:je.inkMid,marginBottom:24},children:[j==null?void 0:j.nombre,"  ",((te=z[j==null?void 0:j.id])==null?void 0:te.length)%2===0?"SALIDA":"ENTRADA","  ",new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]}),d&&e.jsx("img",{src:d,style:{width:"100%",borderRadius:8,marginBottom:16}}),l&&e.jsxs("div",{style:{fontSize:12,color:je.inkMid},children:[" GPS: ",l.lat.toFixed(5),", ",l.lng.toFixed(5)," (",l.precision,"m)"]}),y&&e.jsxs("div",{style:{fontSize:12,color:je.amber},children:[" ",y]}),e.jsx(tt,{onClick:P,style:{marginTop:20,width:"100%",justifyContent:"center"},children:"Nuevo fichaje"})]}):h===1?e.jsxs(Qt,{children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:20},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:je.ink},children:"Control de acceso"}),e.jsx("div",{style:{fontSize:13,color:je.inkMid},children:"Selecciona tu nombre"})]}),e.jsxs("div",{style:{maxHeight:300,overflowY:"auto",border:`1px solid ${je.border}`,borderRadius:8},children:[t.filter(Q=>Q.activo).map((Q,Se)=>e.jsx("div",{onClick:()=>{k(Q),b(2)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:`1px solid ${je.border}`,background:Se%2===0?je.card:je.bg,fontSize:14,fontWeight:500,color:je.ink},onMouseEnter:ae=>ae.currentTarget.style.background=je.greenL,onMouseLeave:ae=>ae.currentTarget.style.background=Se%2===0?je.card:je.bg,children:Q.nombre},Q.id)),t.filter(Q=>Q.activo).length===0&&e.jsx("div",{style:{padding:20,fontSize:13,color:je.inkLight,textAlign:"center"},children:"Sin empleados. El encargado debe registrarlos primero."})]})]}):h===2?e.jsxs(Qt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsxs("div",{style:{fontSize:18,fontWeight:700,color:je.ink,marginBottom:4},children:["Hola, ",j==null?void 0:j.nombre]}),e.jsx("div",{style:{fontSize:13,color:je.inkMid,marginBottom:20},children:"Introduce tu PIN de 4 dgitos"}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:12,marginBottom:16},children:[0,1,2,3].map(Q=>e.jsx("div",{style:{width:14,height:14,borderRadius:"50%",background:Q<v.length?je.green:je.border}},Q))}),f&&e.jsx("div",{style:{color:je.red,fontSize:12,marginBottom:12},children:"PIN incorrecto. Intntalo de nuevo."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,maxWidth:200,margin:"0 auto"},children:[1,2,3,4,5,6,7,8,9,"",0,""].map(Q=>e.jsx("button",{onClick:()=>{if(Q===""){m(ae=>ae.slice(0,-1));return}if(Q==="")return;const Se=v+Q;m(Se),Se.length===4&&(Se===(j==null?void 0:j.pin)?(p(!1),m(""),b(3),T()):(p(!0),m("")))},style:{padding:"14px 0",fontSize:18,fontWeight:600,border:`1px solid ${je.border}`,borderRadius:8,background:Q===""?je.redL:je.bg,cursor:Q===""?"default":"pointer",color:je.ink},children:Q},Q))}),e.jsx(tt,{variant:"ghost",small:!0,onClick:P,style:{marginTop:16},children:"Volver"})]}):h===3?e.jsxs(Qt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:je.ink,marginBottom:12},children:" Tmate una selfie"}),e.jsx("div",{style:{fontSize:13,color:je.inkMid,marginBottom:12},children:"La foto es obligatoria para registrar tu asistencia."}),S?e.jsx("div",{style:{background:je.redL,border:`1px solid ${je.red}`,borderRadius:8,padding:12,fontSize:12,color:je.red,marginBottom:12},children:S}):e.jsx("video",{ref:E,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",borderRadius:8,background:"#000",aspectRatio:"4/3",objectFit:"cover",marginBottom:12}}),e.jsxs(ai,{gap:8,style:{justifyContent:"center"},wrap:!0,children:[!S&&e.jsx(tt,{icon:wd,onClick:Z,style:{width:"100%",justifyContent:"center",fontSize:15,padding:"12px"},children:"Capturar y registrar"}),S&&e.jsx(tt,{onClick:T,style:{width:"100%",justifyContent:"center"},children:"Reintentar cmara"}),e.jsx(tt,{variant:"ghost",small:!0,onClick:P,children:"Cancelar"})]})]}):h===4?e.jsxs(Qt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:je.ink,marginBottom:12},children:"Confirmar registro"}),d&&e.jsx("img",{src:d,style:{width:"100%",borderRadius:8,marginBottom:12,border:`1px solid ${je.border}`}}),e.jsxs("div",{style:{background:je.bg,borderRadius:8,padding:"10px 14px",marginBottom:16,fontSize:13,textAlign:"left"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nombre:"})," ",j==null?void 0:j.nombre]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tipo:"})," ",((he=z[j==null?void 0:j.id])==null?void 0:he.length)%2===0?"ENTRADA":"SALIDA"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Hora:"})," ",new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"GPS:"})," ",l?`${l.lat.toFixed(4)}, ${l.lng.toFixed(4)} (${l.precision}m)`:y?"No disponible":"Obteniendo..."]})]}),e.jsxs(ai,{gap:8,style:{justifyContent:"center"},wrap:!0,children:[e.jsx(tt,{icon:xt,onClick:K,style:{flex:1,justifyContent:"center"},children:"Confirmar fichaje"}),e.jsx(tt,{variant:"secondary",onClick:()=>{c(null),x(null),u(null),b(3),T()},children:"Repetir foto"})]}),e.jsx(tt,{variant:"ghost",small:!0,onClick:P,style:{marginTop:8},children:"Cancelar"})]}):null})]})}function Cf({novedades:t,saveNovedades:i}){const[o,n]=F.useState({tipo:"",estado:"",texto:""}),[a,r]=F.useState(null),[s,g]=F.useState(""),h=F.useMemo(()=>t.filter(m=>!(o.tipo&&m.tipo!==o.tipo||o.estado&&m.estado!==o.estado||o.texto&&!m.empleadoNombre.toLowerCase().includes(o.texto.toLowerCase()))),[t,o]),b=t.filter(m=>m.estado==="Pendiente").length,j=(m,f)=>{i(p=>p.map(d=>d.id===m?{...d,estado:f,comentarioAdmin:s,fechaResolucion:fi()}:d)),r(null),g("")},k=m=>Cn.find(f=>f.id===m)||Cn[5],v=m=>({Pendiente:{color:"#8C6A00",bg:"#FAF0E0"},"En revisin":{color:"#3B3B3B",bg:"#F0F0F0"},Aprobada:{color:"#111111",bg:"#E8F4EE"},Rechazada:{color:"#B91C1C",bg:"#FAE8E8"}})[m]||{color:"#555",bg:"#EDEBE7"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ei,{label:"Solicitudes pendientes",value:b,color:b>0?$.amber:$.ink,icon:Fa}),e.jsx(ei,{label:"Aprobadas este mes",value:t.filter(m=>m.estado==="Aprobada").length,color:$.green,icon:Ho}),e.jsx(ei,{label:"Rechazadas",value:t.filter(m=>m.estado==="Rechazada").length,color:$.red,icon:$t}),e.jsx(ei,{label:"Total novedades",value:t.length,icon:En})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:14,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:180},children:[e.jsx(Ci,{size:13,style:{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",color:$.inkLight}}),e.jsx("input",{value:o.texto,onChange:m=>n(f=>({...f,texto:m.target.value})),placeholder:"Buscar empleado",style:{width:"100%",paddingLeft:30,padding:"7px 10px 7px 30px",border:`1px solid ${$.border}`,borderRadius:3,fontSize:12,color:$.ink,background:$.surface}})]}),e.jsx(yi,{value:o.tipo,onChange:m=>n(f=>({...f,tipo:m})),style:{width:180},options:[{value:"",label:"Todos los tipos"},...Cn.map(m=>({value:m.id,label:`${m.icono} ${m.lbl}`}))]}),e.jsx(yi,{value:o.estado,onChange:m=>n(f=>({...f,estado:m})),style:{width:150},options:[{value:"",label:"Todos los estados"},"Pendiente","En revisin","Aprobada","Rechazada"]})]}),e.jsx(Qt,{children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`2px solid ${$.border}`,background:$.surfaceAlt},children:["Empleado","Tipo","Fecha solicitud","Perodo / Horas","Documento","Estado",""].map(m=>e.jsx("th",{style:{padding:"9px 10px",textAlign:"left",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:$.inkLight,fontWeight:700},children:m},m))})}),e.jsxs("tbody",{children:[h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"40px 0",color:$.inkLight,fontSize:12},children:t.length===0?"Sin novedades. Los empleados las crean desde su portal.":"Sin resultados."})}),h.map(m=>{const f=k(m.tipo),p=v(m.estado);return e.jsxs("tr",{style:{borderBottom:`1px solid ${$.border}`,cursor:"pointer"},onMouseEnter:d=>d.currentTarget.style.background=$.surfaceAlt,onMouseLeave:d=>d.currentTarget.style.background="",onClick:()=>{r(m),g(m.comentarioAdmin||"")},children:[e.jsx("td",{style:{padding:"11px 10px",fontWeight:600},children:m.empleadoNombre}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[e.jsx("span",{children:f.icono}),e.jsx("span",{style:{color:f.color,fontWeight:600,fontSize:11},children:f.lbl})]})}),e.jsx("td",{className:"mono",style:{padding:"11px 10px",color:$.inkLight,fontSize:11},children:m.fechaSolicitud}),e.jsxs("td",{style:{padding:"11px 10px",fontSize:11},children:[m.fechaInicio&&e.jsx("span",{className:"mono",children:m.fechaInicio}),m.fechaFin&&e.jsxs("span",{className:"mono",style:{color:$.inkLight},children:["  ",m.fechaFin]}),m.horas>0&&e.jsxs("span",{className:"mono",children:[" ",m.horas," h"]}),m.dias>0&&e.jsxs("span",{style:{color:$.inkMid},children:[" (",m.dias," das)"]})]}),e.jsx("td",{style:{padding:"11px 10px"},children:m.docNombre?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,color:$.green,fontSize:11},children:[e.jsx(zs,{size:11}),m.docNombre]}):e.jsx("span",{style:{color:$.inkXLight,fontSize:10},children:"Sin doc."})}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsx(Wt,{color:p.color,bg:p.bg,children:m.estado})}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsx(Yi,{size:14,color:$.inkXLight})})]},m.id)})]})]})}),a&&(()=>{const m=k(a.tipo),f=v(a.estado);return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(null),children:e.jsxs("div",{className:"pop-in",style:{background:$.surface,borderRadius:6,width:560,maxWidth:"95vw",maxHeight:"90vh",overflowY:"auto",boxShadow:$.shadowMd},onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{style:{padding:"18px 22px",borderBottom:`1px solid ${$.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",background:m.bg},children:[e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:26},children:m.icono}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:m.color},children:m.lbl}),e.jsxs("div",{style:{fontSize:11,color:m.color,opacity:.7},children:[a.empleadoNombre,"  Solicitud ",a.fechaSolicitud]})]})]}),e.jsx(Wt,{color:f.color,bg:"rgba(255,255,255,.7)",children:a.estado})]}),e.jsxs("div",{style:{padding:"20px 22px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[{lbl:"Tipo",val:m.lbl},{lbl:"Estado",val:a.estado},a.fechaInicio&&{lbl:"Fecha inicio",val:a.fechaInicio},a.fechaFin&&{lbl:"Fecha fin",val:a.fechaFin},a.dias>0&&{lbl:"Das solicitados",val:`${a.dias} das`},a.horas>0&&{lbl:"Horas",val:`${a.horas} h`},a.motivo&&{lbl:"Motivo",val:a.motivo}].filter(Boolean).map(p=>e.jsxs("div",{style:{background:$.accent,borderRadius:3,padding:"10px 12px"},children:[e.jsx(Ut,{children:p.lbl}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:$.ink,marginTop:3},children:p.val})]},p.lbl))}),a.descripcion&&e.jsxs("div",{style:{background:$.accent,borderRadius:3,padding:"10px 12px",marginBottom:12},children:[e.jsx(Ut,{children:"Descripcin del empleado"}),e.jsx("p",{style:{fontSize:12,color:$.inkMid,marginTop:4,lineHeight:1.5},children:a.descripcion})]}),a.docNombre&&e.jsxs("div",{style:{background:$.blueBg,border:`1px solid ${$.blue}33`,borderRadius:3,padding:"10px 12px",marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[e.jsx(zs,{size:14,color:$.blue}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:$.blue},children:"Documento adjunto"}),e.jsx("div",{style:{fontSize:11,color:$.blue,opacity:.8},children:a.docNombre})]}),a.docBase64&&e.jsx("a",{href:a.docBase64,download:a.docNombre,style:{marginLeft:"auto",fontSize:10,color:$.blue,textDecoration:"underline"},children:"Descargar"})]}),a.fechaResolucion&&a.comentarioAdmin&&e.jsxs("div",{style:{background:a.estado==="Aprobada"?$.greenBg:$.redBg,borderRadius:3,padding:"10px 12px",marginBottom:12},children:[e.jsxs(Ut,{children:["Resolucin  ",a.fechaResolucion]}),e.jsx("p",{style:{fontSize:12,color:$.inkMid,marginTop:4},children:a.comentarioAdmin})]}),a.estado==="Pendiente"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:10},children:[e.jsx(Ut,{children:"Comentario para el empleado (opcional)"}),e.jsx("textarea",{value:s,onChange:p=>g(p.target.value),placeholder:"Motivo de aprobacin o rechazo",style:{width:"100%",marginTop:5,padding:"8px 10px",border:`1px solid ${$.border}`,borderRadius:3,fontSize:12,minHeight:70,resize:"vertical",fontFamily:"'DM Sans',sans-serif"}})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx(tt,{variant:"outline",onClick:()=>r(null),children:"Cancelar"}),e.jsxs(tt,{variant:"danger",onClick:()=>j(a.id,"Rechazada"),children:[e.jsx($t,{size:12}),"Rechazar"]}),e.jsxs(tt,{variant:"success",onClick:()=>j(a.id,"Aprobada"),children:[e.jsx(xt,{size:12}),"Aprobar"]})]})]}),a.estado!=="Pendiente"&&e.jsx("div",{style:{textAlign:"right"},children:e.jsx(tt,{variant:"outline",onClick:()=>r(null),children:"Cerrar"})})]})]})})})()]})}const aa=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],xn=[{value:"nomina",label:"Nmina",color:$.blue},{value:"contrato",label:"Contrato",color:$.green},{value:"certificado",label:"Certificado laboral",color:$.amber},{value:"retencion",label:"Retencin fuente",color:$.red},{value:"otro_laboral",label:"Otro documento",color:$.inkMid},{value:"otro",label:"Otro",color:$.inkLight}],kf=(t="")=>({id:Xi(),empleadoNombre:t,tipo:"nomina",nombre:"",docNombre:"",docBase64:null,anio:new Date().getFullYear(),mes:"",fechaSubida:fi()});function wf({docs:t,saveDocs:i,fichas:o,cargos:n}){const[a,r]=F.useState(null),[s,g]=F.useState(""),[h,b]=F.useState(""),[j,k]=F.useState(!1),v=F.useMemo(()=>{const l=new Set;return o.forEach(x=>l.add(x.nombre)),t.forEach(x=>l.add(x.empleadoNombre)),[...l].sort()},[o,t]),m=t.filter(l=>!(s&&l.empleadoNombre!==s||h&&l.tipo!==h)),f=l=>xn.find(x=>x.value===l)||xn[5],p=l=>{const x=l.target.files[0];if(!x)return;const y=new FileReader;y.onload=u=>r(S=>({...S,docNombre:x.name,docBase64:u.target.result})),y.readAsDataURL(x)},d=()=>{if(!a.empleadoNombre||!a.docNombre)return;const l={...a,fechaSubida:fi()};i(x=>j?[...x,l]:x.map(y=>y.id===l.id?l:y)),r(null)},c=(l="")=>{r({...kf(l)}),k(!0)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ei,{label:"Total documentos",value:t.length,icon:Et}),e.jsx(ei,{label:"Empleados con docs",value:new Set(t.map(l=>l.empleadoNombre)).size,icon:Bi}),e.jsx(ei,{label:"Nminas subidas",value:t.filter(l=>l.tipo==="nomina").length,icon:Ao,color:$.blue}),e.jsx(ei,{label:"Contratos",value:t.filter(l=>l.tipo==="contrato").length,icon:Bn,color:$.green})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:14,alignItems:"center"},children:[e.jsx(yi,{value:s,onChange:g,style:{width:200},options:[{value:"",label:"Todos los empleados"},...v.map(l=>({value:l,label:l}))]}),e.jsx(yi,{value:h,onChange:b,style:{width:200},options:[{value:"",label:"Todos los tipos"},...xn]}),e.jsx("div",{style:{flex:1}}),e.jsxs(tt,{variant:"primary",small:!0,onClick:()=>c(s),children:[e.jsx(Oe,{size:12}),"Subir documento"]})]}),s===""?v.length===0?e.jsx(Qt,{children:e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:$.inkLight},children:[e.jsx(Et,{size:32,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{fontSize:12},children:"Sin documentos an. Los empleados se crean desde sus fichas en el Portal."})]})}):v.map(l=>{var y;const x=t.filter(u=>u.empleadoNombre===l&&(!h||u.tipo===h));return x.length===0&&h?null:e.jsxs(Qt,{style:{marginBottom:12},children:[e.jsx(ao,{action:e.jsxs(tt,{small:!0,variant:"ghost",onClick:()=>c(l),children:[e.jsx(Oe,{size:11}),"Aadir"]}),children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:3,background:$.ink,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:800},children:(y=l[0])==null?void 0:y.toUpperCase()}),l,e.jsxs(Wt,{children:[x.length," docs"]})]})}),x.length===0?e.jsx("p",{style:{fontSize:11,color:$.inkLight},children:"Sin documentos para este empleado."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:8},children:x.map(u=>{const S=f(u.tipo);return e.jsxs("div",{style:{border:`1px solid ${$.border}`,borderRadius:4,padding:"12px 14px",background:$.surfaceAlt},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,color:S.color},children:S.label}),e.jsxs("div",{style:{display:"flex",gap:4},children:[u.docBase64&&e.jsx("a",{href:u.docBase64,download:u.docNombre,style:{fontSize:9,color:$.blue,textDecoration:"none",padding:"2px 6px",border:`1px solid ${$.blue}33`,borderRadius:2},children:""}),e.jsx("button",{onClick:()=>i(A=>A.filter(E=>E.id!==u.id)),style:{background:"none",border:"none",cursor:"pointer",color:$.red,fontSize:11,padding:"1px 4px"},children:""})]})]}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:$.ink,marginBottom:2},children:u.docNombre||u.nombre||""}),(u.anio||u.mes)&&e.jsxs("div",{style:{fontSize:10,color:$.inkLight},children:[u.mes?aa[Number(u.mes)-1]:""," ",u.anio]}),e.jsxs("div",{style:{fontSize:9,color:$.inkXLight,marginTop:3},children:["Subido ",u.fechaSubida]})]},u.id)})})]},l)}):e.jsxs(Qt,{children:[e.jsxs(ao,{action:e.jsxs(tt,{small:!0,variant:"primary",onClick:()=>c(s),children:[e.jsx(Oe,{size:12}),"Subir"]}),children:["Documentos de ",s]}),m.length===0?e.jsx("p",{style:{textAlign:"center",color:$.inkLight,padding:"30px 0",fontSize:12},children:"Sin documentos."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:8},children:m.map(l=>{const x=f(l.tipo);return e.jsxs("div",{style:{border:`1px solid ${$.border}`,borderRadius:4,padding:"12px 14px",background:$.surfaceAlt},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:x.color,marginBottom:4},children:x.label}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:$.ink},children:l.docNombre||l.nombre||""}),(l.anio||l.mes)&&e.jsxs("div",{style:{fontSize:10,color:$.inkLight},children:[l.mes?aa[Number(l.mes)-1]:""," ",l.anio]}),l.docBase64&&e.jsx("a",{href:l.docBase64,download:l.docNombre,style:{fontSize:10,color:$.blue,display:"block",marginTop:4},children:"Descargar "})]},l.id)})})]}),a&&e.jsxs(sa,{title:j?"Subir documento":"Editar documento",onClose:()=>r(null),wide:!0,children:[e.jsx(yt,{label:"Empleado",children:v.length>0?e.jsx(yi,{value:a.empleadoNombre,onChange:l=>r(x=>({...x,empleadoNombre:l})),options:[{value:"",label:"Seleccionar empleado"},...v.map(l=>({value:l,label:l}))]}):e.jsx(bt,{value:a.empleadoNombre,onChange:l=>r(x=>({...x,empleadoNombre:l})),placeholder:"Nombre del empleado"})}),e.jsx(yt,{label:"Tipo de documento",children:e.jsx(yi,{value:a.tipo,onChange:l=>r(x=>({...x,tipo:l})),options:xn})}),(a.tipo==="nomina"||a.tipo==="certificado"||a.tipo==="retencion")&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:10},children:[e.jsxs("div",{children:[e.jsx(Ut,{children:"Ao"}),e.jsx(bt,{type:"number",value:a.anio,onChange:l=>r(x=>({...x,anio:l})),style:{marginTop:4}})]}),e.jsxs("div",{children:[e.jsxs(Ut,{children:["Mes ",a.tipo==="certificado"||a.tipo==="retencion"?"(opcional)":""]}),e.jsx(yi,{value:a.mes,onChange:l=>r(x=>({...x,mes:l})),style:{marginTop:4},options:[{value:"",label:""},...aa.map((l,x)=>({value:x+1,label:l}))]})]})]}),e.jsx(yt,{label:"Descripcin (opcional)",children:e.jsx(bt,{value:a.nombre,onChange:l=>r(x=>({...x,nombre:l})),placeholder:"Ej. Nmina mayo 2025"})}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx(Ut,{children:"Archivo"}),e.jsxs("div",{style:{marginTop:6,display:"flex",alignItems:"center",gap:10},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"7px 14px",background:$.accent,border:`1px solid ${$.border}`,borderRadius:3,cursor:"pointer",fontSize:11,color:$.inkMid,fontWeight:600},children:[e.jsx(zs,{size:12}),"Seleccionar archivo",e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.xlsx",onChange:p,style:{display:"none"}})]}),a.docNombre&&e.jsxs("span",{style:{fontSize:11,color:$.green,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ho,{size:12}),a.docNombre]})]}),e.jsx("p",{style:{fontSize:9,color:$.inkLight,marginTop:5},children:"PDF, imagen o Word. Se almacena como base64 en el navegador."})]}),e.jsx(la,{onCancel:()=>r(null),onSave:d,saveLabel:"Subir documento"})]})]})}function sa({title:t,children:i,onClose:o,wide:n}){return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:o,children:e.jsxs("div",{className:"pop-in",style:{background:$.surface,borderRadius:6,padding:28,width:n?600:480,maxWidth:"95vw",boxShadow:$.shadowMd,maxHeight:"90vh",overflowY:"auto"},onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:20,fontSize:15,fontWeight:700},children:t}),i]})})}function zf({partes:t,savePartes:i,novedades:o,saveNovedades:n,fichas:a,saveFichas:r,docs:s,saveDocs:g,cargos:h,empleados:b,saveEmpleados:j}){const[k,v]=F.useState(""),[m,f]=F.useState(!1),[p,d]=F.useState("calendario"),[c,l]=F.useState(new Date().getFullYear()),[x,y]=F.useState(new Date().getMonth()),[u,S]=F.useState(null),[A,E]=F.useState(null),[w,_]=F.useState(null),[z,T]=F.useState(!1),[L,Z]=F.useState(null),K=["Lu","Ma","Mi","Ju","Vi","Sa","Do"],P=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],te=["OT-DIN_250101_01","OT-INT_250115_02","OT-INT_250201_03"],he=t.filter(X=>X.empleadoNombre===k),Q=o.filter(X=>X.empleadoNombre===k),Se=s.filter(X=>X.empleadoNombre===k),ae=a.find(X=>X.nombre===k)||Ya(k),U=X=>Cn.find(Te=>Te.id===X)||Cn[5],M=(X,Te)=>!X||!Te?0:Math.max(0,Math.round((new Date(Te)-new Date(X))/864e5)+1),B=(X,Te,Pe)=>`${X}-${String(Te+1).padStart(2,"0")}-${String(Pe).padStart(2,"0")}`,H=F.useMemo(()=>{const X=(new Date(c,x,1).getDay()+6)%7,Te=new Date(c,x+1,0).getDate();return[...Array(X).fill(null),...Array.from({length:Te},(Pe,et)=>et+1)]},[c,x]),ee=F.useMemo(()=>{const X={};return he.forEach(Te=>{var Pe;(X[Pe=Te.fecha]??(X[Pe]=[])).push({kind:"parte",obj:Te})}),Q.forEach(Te=>{if(!Te.fechaInicio)return;const Pe=new Date(Te.fechaInicio),et=Te.fechaFin?new Date(Te.fechaFin):Pe;for(let gt=new Date(Pe);gt<=et;gt.setDate(gt.getDate()+1)){const vt=gt.toISOString().slice(0,10);(X[vt]??(X[vt]=[])).push({kind:"novedad",obj:Te})}}),X},[he,Q]),D=Q.filter(X=>X.estado==="Pendiente").length,O=he.filter(X=>X.estado==="Aprobado").reduce((X,Te)=>X+Number(Te.horasNormales||0)+Number(Te.horasExtra||0),0),le=Q.filter(X=>X.tipo==="vacaciones"&&X.estado==="Aprobada").reduce((X,Te)=>X+Number(Te.dias||0),0),re=Q.find(X=>X.tipo==="baja"&&X.estado==="Aprobada"&&!X.fechaFin),de=(X,Te,Pe)=>X(et=>({...et,[Te]:Pe})),G=X=>({Borrador:{c:$.inkLight,bg:$.accent},Enviado:{c:$.blue,bg:$.blueBg},Aprobado:{c:$.green,bg:$.greenBg},Rechazado:{c:$.red,bg:$.redBg},Pendiente:{c:"#8C6A00",bg:"#FAF0E0"},Aprobada:{c:$.green,bg:$.greenBg},Rechazada:{c:$.red,bg:$.redBg}})[X]||{c:$.inkLight,bg:$.accent},ce=()=>{if(!(A!=null&&A.otCodigo)||!(A!=null&&A.actividad))return;const X=!t.find(Te=>Te.id===A.id);i(Te=>X?[...Te,A]:Te.map(Pe=>Pe.id===A.id?A:Pe)),E(null)},V=X=>i(Te=>Te.map(Pe=>Pe.id===X?{...Pe,estado:"Enviado"}:Pe)),Y=()=>{if(!(w!=null&&w.tipo))return;const X=M(w.fechaInicio,w.fechaFin),Te={...w,dias:X,empleadoNombre:k,estado:"Pendiente"},Pe=!o.find(et=>et.id===Te.id);n(et=>Pe?[...et,Te]:et.map(gt=>gt.id===Te.id?Te:gt)),_(null)},W=()=>{if(!L)return;const X={...L,nombre:k},Te=a.find(Pe=>Pe.nombre===k);r(Pe=>Te?Pe.map(et=>et.nombre===k?X:et):[...Pe,X]),T(!1)},se={page:{minHeight:"100vh",background:$.bg,fontFamily:"'DM Sans',sans-serif"},card:{background:$.surface,border:`1px solid ${$.border}`,borderRadius:6,padding:"16px 18px",marginBottom:12},row:{display:"flex",gap:8,alignItems:"center"},col:{display:"flex",flexDirection:"column",gap:4},th:{padding:"7px 10px",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:$.inkLight,fontWeight:700,textAlign:"left",borderBottom:`2px solid ${$.border}`},td:{padding:"9px 10px",borderBottom:`1px solid ${$.border}`,fontSize:12},overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:300,display:"flex",alignItems:"center",justifyContent:"center"},modal:{background:$.surface,borderRadius:6,padding:24,width:460,maxWidth:"95vw",boxShadow:$.shadowMd,maxHeight:"90vh",overflowY:"auto"},navBtn:X=>({padding:"11px 14px",border:"none",background:"transparent",borderBottom:X?`2px solid ${$.ink}`:"2px solid transparent",color:X?$.ink:$.inkLight,fontSize:10,fontWeight:X?700:400,letterSpacing:.3,textTransform:"uppercase",cursor:"pointer",whiteSpace:"nowrap",flexShrink:0,display:"flex",alignItems:"center",gap:5}),calDay:(X,Te,Pe)=>({borderRadius:4,aspectRatio:"1",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:11,fontWeight:X.c?700:400,color:Pe?"#fff":X.c||$.ink,background:Pe?$.ink:X.bg||"transparent",border:Te?`1px solid ${$.ink}`:"1px solid transparent"}),kpiMini:X=>({flex:1,background:$.surface,border:`1px solid ${$.border}`,borderRadius:5,padding:"10px 12px",minWidth:0})};if(!m)return e.jsx("div",{style:{...se.page,display:"flex",alignItems:"center",justifyContent:"center",padding:20},children:e.jsxs("div",{style:{...se.card,width:360,overflow:"hidden",padding:0},children:[e.jsxs("div",{style:{background:$.ink,padding:"28px 24px",textAlign:"center"},children:[e.jsxs("svg",{width:34,height:34,viewBox:"0 0 34 34",fill:"none",style:{margin:"0 auto 12px",display:"block"},children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:"rgba(255,255,255,.25)",strokeWidth:"0.8"}),e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:"#fff",strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:"#fff"}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:"#fff"}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:"#fff"})]}),e.jsx("div",{style:{fontSize:14,fontWeight:800,letterSpacing:3,textTransform:"uppercase",color:"#fff"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:11,color:"rgba(255,255,255,.4)",marginTop:3},children:"Portal del Empleado"})]}),e.jsxs("div",{style:{padding:"20px 20px 16px"},children:[e.jsx("p",{style:{fontSize:11,color:$.inkLight,marginBottom:10,textAlign:"center"},children:"Introduce tu nombre completo para acceder"}),e.jsx(bt,{value:k,onChange:v,placeholder:"Ej. Mara Garca Lpez",style:{marginBottom:8},onKeyDown:X=>X.key==="Enter"&&k.trim()&&f(!0)}),e.jsx("button",{onClick:()=>k.trim()&&f(!0),style:{width:"100%",padding:"9px",background:$.ink,color:"#fff",border:"none",borderRadius:3,fontSize:12,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Entrar al portal"}),e.jsx("p",{style:{fontSize:9,color:$.inkXLight,marginTop:10,textAlign:"center",lineHeight:1.4},children:"Fase 1  En produccin se usar email + contrasea"})]})]})});const ge=[{id:"calendario",lbl:" Calendario",badge:0},{id:"partes",lbl:" Mis Partes",badge:he.filter(X=>X.estado==="Borrador").length},{id:"solicitudes",lbl:" Solicitudes",badge:D},{id:"viajes",lbl:" Viajes",badge:0},{id:"ficha",lbl:" Mi Ficha",badge:0},{id:"documentos",lbl:" Mis Docs",badge:0}],ue=new Date().toISOString().slice(0,10),ye=()=>{let X=x-1,Te=c;X<0&&(X=11,Te--),y(X),l(Te)},be=()=>{let X=x+1,Te=c;X>11&&(X=0,Te++),y(X),l(Te)},I=()=>e.jsxs("div",{className:"fade-up",children:[re&&e.jsxs("div",{style:{background:$.redBg,border:`1px solid ${$.red}33`,borderRadius:4,padding:"10px 14px",marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:18},children:""}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:$.red},children:["Baja mdica activa desde ",re.fechaInicio]}),e.jsx("div",{style:{fontSize:10,color:$.red,opacity:.7},children:re.motivo})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginBottom:14},children:[["Horas aprobadas",`${O}h`,$.blue],["Das vacaciones",`${le}d`,$.green],["Partes borrador",he.filter(X=>X.estado==="Borrador").length,$.amber],["Sol. pendientes",D,D>0?$.amber:$.ink]].map(([X,Te,Pe])=>e.jsxs("div",{style:se.kpiMini(),children:[e.jsx("div",{style:{fontSize:9,letterSpacing:1,textTransform:"uppercase",color:$.inkLight,marginBottom:4},children:X}),e.jsx("div",{style:{fontSize:20,fontWeight:800,color:Pe,fontFamily:"'DM Mono',monospace"},children:Te})]},X))}),e.jsxs("div",{style:se.card,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("button",{onClick:ye,style:{background:$.accent,border:`1px solid ${$.border}`,borderRadius:3,padding:"5px 12px",cursor:"pointer",fontSize:16},children:""}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:15,fontWeight:800,color:$.ink},children:[P[x]," ",c]}),e.jsx("div",{style:{fontSize:10,color:$.inkLight,marginTop:1},children:"Pulsa un da para ver / imputar"})]}),e.jsx("button",{onClick:be,style:{background:$.accent,border:`1px solid ${$.border}`,borderRadius:3,padding:"5px 12px",cursor:"pointer",fontSize:16},children:""})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,marginBottom:4},children:K.map(X=>e.jsx("div",{style:{textAlign:"center",fontSize:9,fontWeight:700,color:$.inkLight,padding:"4px 0",letterSpacing:.5},children:X},X))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2},children:H.map((X,Te)=>{if(!X)return e.jsx("div",{},`e${Te}`);const Pe=B(c,x,X),et=ee[Pe]||[],gt=Pe===ue,vt=Pe===u,At=new Date(c,x,X).getDay()%6===0;let Ri=null;return et.some(ci=>ci.kind==="novedad"&&ci.obj.estado==="Rechazada")?Ri=$.red:et.some(ci=>ci.kind==="novedad"&&ci.obj.estado==="Aprobada")?Ri=$.green:et.some(ci=>ci.kind==="novedad"&&ci.obj.estado==="Pendiente")?Ri="#8C6A00":et.some(ci=>ci.kind==="parte"&&ci.obj.estado==="Aprobado")?Ri=$.blue:et.length&&(Ri="#555"),e.jsxs("div",{onClick:()=>{S(Pe===u?null:Pe)},style:{borderRadius:4,padding:"5px 2px",display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",background:vt?$.ink:At?"#F8F7F4":"transparent",border:gt?`1px solid ${$.ink}`:"1px solid transparent",transition:"background .1s"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:vt||gt?700:400,color:vt?"#fff":At?$.inkLight:$.ink},children:X}),Ri&&e.jsx("div",{style:{width:4,height:4,borderRadius:"50%",background:vt?"rgba(255,255,255,.7)":Ri,marginTop:2}})]},Pe)})})]}),u&&(()=>{const X=ee[u]||[],Te=new Date(u+"T12:00:00").toLocaleDateString("es-CO",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{style:se.card,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:$.ink,textTransform:"capitalize"},children:Te}),e.jsxs(tt,{small:!0,variant:"primary",onClick:()=>E({...Hl(),fecha:u}),children:[e.jsx(Oe,{size:11}),"Imputar horas"]})]}),X.length===0&&e.jsx("p",{style:{fontSize:11,color:$.inkLight,textAlign:"center",padding:"12px 0"},children:"Sin registros para este da."}),X.map((Pe,et)=>{const gt=G(Pe.obj.estado);if(Pe.kind==="parte"){const At=Pe.obj;return e.jsxs("div",{style:{background:$.surfaceAlt,borderRadius:4,padding:"10px 12px",marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{fontWeight:600,fontSize:12},children:[At.otCodigo,"  ",At.actividad]}),e.jsx(Wt,{color:gt.c,bg:gt.bg,children:At.estado})]}),e.jsxs("div",{style:{fontSize:11,color:$.inkMid,marginTop:4},children:[At.horasNormales,"h normales  ",At.horasExtra,"h extra"]}),At.estado==="Borrador"&&e.jsx("div",{style:{marginTop:6},children:e.jsx(tt,{small:!0,variant:"primary",onClick:()=>V(At.id),children:"Enviar"})})]},et)}const vt=U(Pe.obj.tipo);return e.jsxs("div",{style:{background:vt.bg,borderRadius:4,padding:"10px 12px",marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{fontWeight:600,fontSize:12,color:vt.color},children:[vt.icono," ",vt.lbl]}),e.jsx(Wt,{color:gt.c,bg:gt.bg,children:Pe.obj.estado})]}),Pe.obj.motivo&&e.jsx("div",{style:{fontSize:11,color:vt.color,opacity:.8,marginTop:3},children:Pe.obj.motivo})]},et)})]})})()]}),N=()=>e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:e.jsxs(tt,{variant:"primary",small:!0,onClick:()=>E({...Hl(),fecha:ue}),children:[e.jsx(Oe,{size:11}),"Nuevo parte"]})}),he.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:$.inkLight},children:[e.jsx(En,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin partes registrados."})]}):e.jsx("div",{style:{padding:0},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Fecha","OT","Actividad","H.Norm","H.Extra","Estado",""].map(X=>e.jsx("th",{style:se.th,children:X},X))})}),e.jsx("tbody",{children:he.sort((X,Te)=>{var Pe;return((Pe=Te.fecha)==null?void 0:Pe.localeCompare(X.fecha))||0}).map(X=>{const Te=G(X.estado);return e.jsxs("tr",{onMouseEnter:Pe=>Pe.currentTarget.style.background=$.surfaceAlt,onMouseLeave:Pe=>Pe.currentTarget.style.background="",children:[e.jsx("td",{style:se.td,className:"mono",children:X.fecha}),e.jsx("td",{style:se.td,children:X.otCodigo}),e.jsx("td",{style:se.td,children:X.actividad}),e.jsx("td",{style:{...se.td,textAlign:"center"},children:X.horasNormales}),e.jsx("td",{style:{...se.td,textAlign:"center"},children:X.horasExtra||0}),e.jsx("td",{style:se.td,children:e.jsx(Wt,{color:Te.c,bg:Te.bg,children:X.estado})}),e.jsxs("td",{style:se.td,children:[X.estado==="Borrador"&&e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(tt,{small:!0,variant:"primary",onClick:()=>V(X.id),children:"Enviar"}),e.jsx(tt,{small:!0,variant:"ghost",onClick:()=>E({...X}),children:e.jsx(ro,{size:11})}),e.jsx(tt,{small:!0,variant:"danger",onClick:()=>i(Pe=>Pe.filter(et=>et.id!==X.id)),children:e.jsx(He,{size:11})})]}),X.estado==="Rechazado"&&X.comentarioAdmin&&e.jsxs("span",{style:{fontSize:10,color:$.red},children:["Motivo: ",X.comentarioAdmin]})]})]},X.id)})})]})})]}),q=()=>e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:e.jsxs(tt,{variant:"primary",small:!0,onClick:()=>_({...ff(k)}),children:[e.jsx(Oe,{size:11}),"Nueva solicitud"]})}),Q.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:$.inkLight},children:[e.jsx(Fa,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin solicitudes."})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Q.sort((X,Te)=>{var Pe;return((Pe=Te.fechaSolicitud)==null?void 0:Pe.localeCompare(X.fechaSolicitud))||0}).map(X=>{const Te=U(X.tipo),Pe=G(X.estado);return e.jsx("div",{style:{...se.card,borderLeft:`3px solid ${Te.color}`,marginBottom:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:16},children:Te.icono}),e.jsx("span",{style:{fontWeight:700,fontSize:13,color:Te.color},children:Te.lbl}),e.jsx(Wt,{color:Pe.c,bg:Pe.bg,children:X.estado})]}),X.fechaInicio&&e.jsxs("div",{style:{fontSize:11,color:$.inkMid},children:[X.fechaInicio,X.fechaFin&&`  ${X.fechaFin}`," ",X.dias>0&&` ${X.dias} das`]}),X.horas>0&&e.jsxs("div",{style:{fontSize:11,color:$.inkMid},children:[X.horas,"h"]}),X.motivo&&e.jsx("div",{style:{fontSize:11,color:$.inkMid,marginTop:2},children:X.motivo}),X.comentarioAdmin&&e.jsxs("div",{style:{fontSize:11,color:Pe.c,marginTop:4,fontStyle:"italic"},children:["Admin: ",X.comentarioAdmin]})]}),e.jsx("div",{style:{fontSize:10,color:$.inkLight},children:X.fechaSolicitud})]})},X.id)})})]}),J=()=>{const X=z?L:ae;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700,color:$.ink},children:"Mi Ficha Personal"}),z?e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(tt,{small:!0,variant:"outline",onClick:()=>T(!1),children:"Cancelar"}),e.jsxs(tt,{small:!0,variant:"primary",onClick:W,children:[e.jsx(wo,{size:11}),"Guardar"]})]}):e.jsxs(tt,{small:!0,variant:"outline",onClick:()=>{Z({...ae}),T(!0)},children:[e.jsx(ro,{size:11}),"Editar"]})]}),[{sec:"Datos Personales",fields:[["Nombre",X.nombre],["Apellidos",X.apellidos],["Email",X.email],["Telfono",X.telefono],["Fecha nacimiento",X.fechaNacimiento],["Documento",`${X.tipoDocumento} ${X.numeroDocumento}`]]},{sec:"Contrato",fields:[["Cargo",X.cargo],["Tipo contrato",X.tipoContrato],["Fecha ingreso",X.fechaIngreso],["Salario bruto",X.salarioBruto?`$ ${Number(X.salarioBruto).toLocaleString()}`:""]]},{sec:"Seguridad Social",fields:[["EPS",X.eps],["AFP",X.afp],["ARL",X.arl],["Caja compensacin",X.cajaCompensacion]]},{sec:"Datos Bancarios",fields:[["Entidad",X.entidadBancaria],["Tipo cuenta",X.tipoCuenta],["N cuenta",X.cuentaBancaria]]}].map(({sec:Te,fields:Pe})=>e.jsxs("div",{style:se.card,children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1.2,textTransform:"uppercase",color:$.inkLight,fontWeight:700,marginBottom:10},children:Te}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:Pe.map(([et,gt])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:$.inkLight,letterSpacing:.5,textTransform:"uppercase",marginBottom:2},children:et}),z?e.jsx(bt,{value:L[Object.keys(Ya()).find(vt=>Ya()[vt]===gt||et.toLowerCase().includes(vt.toLowerCase()))||et]||"",onChange:vt=>Z(At=>({...At,[et.toLowerCase().replace(/\s/g,"")]:vt})),small:!0}):e.jsx("div",{style:{fontSize:12,color:$.ink,fontWeight:gt?400:300},children:gt||e.jsx("span",{style:{color:$.inkXLight},children:""})})]},et))})]},Te))]})},R=()=>e.jsx("div",{className:"fade-up",children:Se.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:$.inkLight},children:[e.jsx(Ao,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin documentos compartidos todava."}),e.jsx("p",{style:{fontSize:11,color:$.inkXLight,marginTop:4},children:"Cuando RRHH suba tus documentos aparecern aqu."})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Se.map(X=>{const Te=xn.find(Pe=>Pe.value===X.tipo)||xn[5];return e.jsxs("div",{style:{...se.card,display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:0},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:2},children:[e.jsx("span",{children:Te.label}),e.jsxs(Wt,{color:Te.color,bg:Te.color+"22",children:[aa[X.mes-1]||""," ",X.anio]})]}),e.jsx("div",{style:{fontSize:11,color:$.inkMid},children:X.nombre||X.docNombre})]}),X.docBase64&&e.jsx("a",{href:X.docBase64,download:X.docNombre||"documento.pdf",children:e.jsxs(tt,{small:!0,variant:"outline",children:[e.jsx(Eo,{size:11}),"Descargar"]})})]},X.id)})})}),ie="habitaris_admin",fe=async()=>{try{const X=Ee.getSync(ie);return X?JSON.parse(X):{}}catch{return{}}},Me=async(X,Te)=>{const Pe=await fe();Pe[X]=Te,Ee.set(ie,JSON.stringify(Pe))},[Le,Ie]=F.useState(()=>(fe().adm_viaticos||[]).filter(X=>X.solicitante===k)),[dt,Ze]=F.useState(!1),[mt,Yt]=F.useState(null),[_t,oi]=F.useState({destino:"",dias:1,concepto:"",fecha:fi(),fechaRegreso:""}),Ii=[{id:"vuelo_ida",lbl:"Vuelo ida",icon:""},{id:"vuelo_vuelta",lbl:"Vuelo vuelta",icon:""},{id:"hotel",lbl:"Hotel",icon:""},{id:"transporte",lbl:"Transporte",icon:""},{id:"alimentacion",lbl:"Alimentacin",icon:""},{id:"otros",lbl:"Otros",icon:""}],go=()=>{const X={};Ii.forEach(et=>{X[et.id]={estimado:0,real:0,detalle:""}});const Te={id:Math.random().toString(36).slice(2,10),solicitante:k,..._t,dias:parseInt(_t.dias)||1,estado:"solicitado",gastos:[],anticipoEntregado:0,itemsViaje:X,creadoDesde:"portal"},Pe=[...fe().adm_viaticos||[],Te];Me("adm_viaticos",Pe),Ie(Pe.filter(et=>et.solicitante===k)),Yt(Te.id),oi({destino:"",dias:1,concepto:"",fecha:fi(),fechaRegreso:""}),Ze(!1)},ki=(X,Te,Pe,et)=>{const gt=(fe().adm_viaticos||[]).map(vt=>{if(vt.id!==X)return vt;const At={...vt.itemsViaje||{}};return At[Te]={...At[Te]||{estimado:0,real:0,detalle:""},[Pe]:et},{...vt,itemsViaje:At}});Me("adm_viaticos",gt),Ie(gt.filter(vt=>vt.solicitante===k))},Er=(X,Te)=>{const Pe=(fe().adm_viaticos||[]).map(et=>et.id===X?{...et,gastos:[...et.gastos||[],{id:Math.random().toString(36).slice(2,10),...Te}]}:et);Me("adm_viaticos",Pe),Ie(Pe.filter(et=>et.solicitante===k))},Qi=X=>Ii.reduce((Te,Pe)=>{var et;return Te+(parseFloat((et=(X.itemsViaje||{})[Pe.id])==null?void 0:et.estimado)||0)},0),Ar=X=>Ii.reduce((Te,Pe)=>{var et;return Te+(parseFloat((et=(X.itemsViaje||{})[Pe.id])==null?void 0:et.real)||0)},0)+(X.gastos||[]).reduce((Te,Pe)=>Te+Pe.monto,0),Fr={solicitado:{lbl:"Solicitado",c:$.amber},aprobado:{lbl:"Aprobado",c:$.blue},entregado:{lbl:"Anticipo entregado",c:"#5B3A8C"},legalizado:{lbl:"Legalizado",c:$.green},rechazado:{lbl:"Rechazado",c:$.red}};Le.find(X=>X.id===mt);const[Vt,di]=F.useState(null),rl=()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:" Mis Viajes y Viticos"}),e.jsx("p",{style:{margin:0,fontSize:10,color:$.inkLight},children:"Solicita viticos, registra gastos y legaliza"})]}),e.jsxs("button",{onClick:()=>Ze(!0),style:{padding:"8px 16px",background:$.ink,color:"#fff",border:"none",borderRadius:5,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:5},children:[e.jsx(Oe,{size:11})," Solicitar viaje"]})]}),Le.length===0?e.jsxs("div",{style:{...se.card,textAlign:"center",padding:40,color:$.inkLight},children:[e.jsx(Ao,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"No tienes solicitudes de viaje."}),e.jsx("p",{style:{fontSize:10,color:$.inkXLight},children:'Pulsa "Solicitar viaje" para crear una.'})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Le.map(X=>{const Te=Qi(X),Pe=Ar(X),et=Fr[X.estado]||Fr.solicitado;return e.jsxs("div",{onClick:()=>Yt(X.id===mt?null:X.id),style:{...se.card,cursor:"pointer",marginBottom:0,border:mt===X.id?`2px solid ${$.ink}`:`1px solid ${$.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[X.destino," ",e.jsxs("span",{style:{fontSize:10,fontWeight:400,color:$.inkMid},children:[" ",X.dias," das  ",X.fecha,X.fechaRegreso?`  ${X.fechaRegreso}`:""]})]}),e.jsx("div",{style:{fontSize:10,color:$.inkMid,marginTop:2},children:X.concepto})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:et.c+"22",color:et.c},children:et.lbl}),e.jsxs("div",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,marginTop:4},children:["Est: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Te),Pe>0&&e.jsxs("span",{style:{color:"#5B3A8C",marginLeft:8},children:["Real: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Pe)]})]})]})]}),mt===X.id&&e.jsxs("div",{style:{marginTop:12,borderTop:`1px solid ${$.border}`,paddingTop:12},onClick:gt=>gt.stopPropagation(),children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Desglose estimado"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",marginBottom:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${$.border}`},children:"tem"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${$.border}`},children:"Detalle"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:$.blue,textAlign:"right",borderBottom:`1px solid ${$.border}`},children:"Estimado"}),(X.estado==="entregado"||X.estado==="legalizado")&&e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#5B3A8C",textAlign:"right",borderBottom:`1px solid ${$.border}`},children:"Real"})]})}),e.jsxs("tbody",{children:[Ii.map((gt,vt)=>{const At=(X.itemsViaje||{})[gt.id]||{estimado:0,real:0,detalle:""},Ri=X.estado==="solicitado"||X.estado==="aprobado",ci=X.estado==="entregado"||X.estado==="legalizado";return e.jsxs("tr",{style:{borderBottom:`1px solid ${$.border}`,background:vt%2?"#FFFFFF":"#fff"},children:[e.jsxs("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:600},children:[gt.icon," ",gt.lbl]}),e.jsx("td",{style:{padding:"3px 4px"},children:Ri?e.jsx("input",{type:"text",value:At.detalle||"",placeholder:"Detalle...",onChange:Mn=>ki(X.id,gt.id,"detalle",Mn.target.value),style:{width:"100%",border:`1px solid ${$.border}`,borderRadius:3,padding:"3px 6px",fontSize:9,background:"#fff",fontFamily:"'DM Sans',sans-serif"}}):e.jsx("span",{style:{fontSize:9,color:$.inkMid},children:At.detalle||""})}),e.jsx("td",{style:{padding:"3px 4px"},children:Ri?e.jsx("input",{type:"number",value:At.estimado||"",placeholder:"0",onChange:Mn=>ki(X.id,gt.id,"estimado",Mn.target.value),style:{width:"100%",textAlign:"right",border:`1px solid ${$.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:$.blue,background:"#fff"}}):e.jsxs("div",{style:{textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:$.blue,padding:"3px 6px"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(parseFloat(At.estimado)||0)]})}),(X.estado==="entregado"||X.estado==="legalizado")&&e.jsx("td",{style:{padding:"3px 4px"},children:ci?e.jsx("input",{type:"number",value:At.real||"",placeholder:"0",onChange:Mn=>ki(X.id,gt.id,"real",Mn.target.value),style:{width:"100%",textAlign:"right",border:`1px solid ${$.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",background:"#fff"}}):e.jsxs("div",{style:{textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",padding:"3px 6px"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(parseFloat(At.real)||0)]})})]},gt.id)}),e.jsxs("tr",{style:{borderTop:`2px solid ${$.ink}`,background:"#EDEBE7"},children:[e.jsx("td",{colSpan:2,style:{padding:"4px 8px",fontSize:10,fontWeight:800},children:"TOTAL"}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:$.blue},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Te)]}),(X.estado==="entregado"||X.estado==="legalizado")&&e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:"#5B3A8C"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Ar(X))]})]})]})]}),X.estado==="solicitado"&&e.jsx("div",{style:{background:$.amberBg,border:`1px solid ${$.amber}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:$.amber,fontWeight:600},children:" Pendiente de aprobacin por Administracin. Completa el desglose estimado arriba."}),X.estado==="aprobado"&&e.jsx("div",{style:{background:$.blueBg,border:`1px solid ${$.blue}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:$.blue,fontWeight:600},children:" Aprobado. Administracin gestionar la compra de tiquetes y hotel."}),X.estado==="entregado"&&e.jsxs("div",{style:{background:"#F0ECF6",border:"1px solid #5B3A8C33",borderRadius:4,padding:"8px 12px",fontSize:10,color:"#5B3A8C",fontWeight:600},children:[" Anticipo entregado: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(X.anticipoEntregado||0),'. Registra los gastos reales en la columna "Real" y aade gastos extra abajo.',e.jsx("button",{onClick:()=>di({fecha:fi(),concepto:"",monto:0,soporte:""}),style:{display:"block",marginTop:6,padding:"4px 12px",background:"#5B3A8C",color:"#fff",border:"none",borderRadius:3,fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir gasto extra"})]}),X.estado==="legalizado"&&e.jsx("div",{style:{background:$.greenBg,border:`1px solid ${$.green}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:$.green,fontWeight:600},children:" Legalizado y cerrado."}),X.estado==="rechazado"&&e.jsx("div",{style:{background:$.redBg,border:`1px solid ${$.red}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:$.red,fontWeight:600},children:" Rechazado por Administracin."}),(X.gastos||[]).length>0&&e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Gastos extra"}),X.gastos.map(gt=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 8px",borderBottom:`1px solid ${$.border}`,fontSize:10},children:[e.jsxs("span",{children:[gt.fecha,"  ",gt.concepto]}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:$.red},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(gt.monto)]})]},gt.id))]})]})]},X.id)})}),dt&&e.jsx("div",{style:se.overlay,onClick:()=>Ze(!1),children:e.jsxs("div",{style:se.modal,onClick:X=>X.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:4,fontSize:14,fontWeight:700},children:" Solicitar viaje"}),e.jsx("p",{style:{fontSize:10,color:$.inkLight,marginBottom:14},children:"Despus de crear podrs completar el desglose (vuelos, hotel, etc.)"}),e.jsx(yt,{label:"Destino",children:e.jsx(bt,{value:_t.destino,onChange:X=>oi({..._t,destino:X}),placeholder:"Ciudad / lugar"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 80px",gap:10},children:[e.jsx(yt,{label:"Concepto / motivo",children:e.jsx(bt,{value:_t.concepto,onChange:X=>oi({..._t,concepto:X}),placeholder:"Visita obra, capacitacin..."})}),e.jsx(yt,{label:"Das",children:e.jsx(bt,{type:"number",value:_t.dias,onChange:X=>oi({..._t,dias:X})})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(yt,{label:"Fecha ida",children:e.jsx(bt,{type:"date",value:_t.fecha,onChange:X=>oi({..._t,fecha:X})})}),e.jsx(yt,{label:"Fecha regreso",children:e.jsx(bt,{type:"date",value:_t.fechaRegreso,onChange:X=>oi({..._t,fechaRegreso:X})})})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${$.border}`},children:[e.jsx(tt,{variant:"outline",onClick:()=>Ze(!1),children:"Cancelar"}),e.jsxs(tt,{variant:"primary",onClick:go,disabled:!_t.destino,children:[e.jsx(yn,{size:12}),"Enviar solicitud"]})]})]})}),Vt&&e.jsx("div",{style:se.overlay,onClick:()=>di(null),children:e.jsxs("div",{style:se.modal,onClick:X=>X.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:12,fontSize:14,fontWeight:700},children:"Gasto extra"}),e.jsx(yt,{label:"Fecha",children:e.jsx(bt,{type:"date",value:Vt.fecha,onChange:X=>di({...Vt,fecha:X})})}),e.jsx(yt,{label:"Concepto",children:e.jsx(bt,{value:Vt.concepto,onChange:X=>di({...Vt,concepto:X}),placeholder:"Taxi, imprevisto..."})}),e.jsx(yt,{label:"Monto",children:e.jsx(bt,{type:"number",value:Vt.monto,onChange:X=>di({...Vt,monto:X})})}),e.jsx(yt,{label:"Soporte",children:e.jsx(bt,{value:Vt.soporte,onChange:X=>di({...Vt,soporte:X}),placeholder:"Ref. factura"})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${$.border}`},children:[e.jsx(tt,{variant:"outline",onClick:()=>di(null),children:"Cancelar"}),e.jsxs(tt,{variant:"primary",onClick:()=>{Er(mt,{...Vt,monto:parseFloat(Vt.monto)||0}),di(null)},children:[e.jsx(wo,{size:12}),"Guardar"]})]})]})})]}),Zi=()=>A?e.jsx("div",{style:se.overlay,onClick:()=>E(null),children:e.jsxs("div",{style:se.modal,onClick:X=>X.stopPropagation(),children:[e.jsxs("h3",{style:{marginBottom:16,fontSize:14,fontWeight:700},children:["Imputar horas  ",A.fecha]}),e.jsx(yt,{label:"Fecha",children:e.jsx(bt,{type:"date",value:A.fecha,onChange:X=>de(E,"fecha",X)})}),e.jsx(yt,{label:"Orden de trabajo (OT)",children:e.jsx(yi,{value:A.otCodigo,onChange:X=>de(E,"otCodigo",X),options:[{value:"",label:"Seleccionar OT..."},...te.map(X=>({value:X,label:X}))]})}),e.jsx(yt,{label:"Actividad",children:e.jsx(bt,{value:A.actividad,onChange:X=>de(E,"actividad",X),placeholder:"Ej. Diseo conceptual"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(yt,{label:"Horas normales",children:e.jsx(bt,{type:"number",value:A.horasNormales,onChange:X=>de(E,"horasNormales",Number(X))})}),e.jsx(yt,{label:"Horas extra",children:e.jsx(bt,{type:"number",value:A.horasExtra||0,onChange:X=>de(E,"horasExtra",Number(X))})})]}),e.jsx(yt,{label:"Descripcin (opcional)",children:e.jsx(bt,{value:A.descripcion||"",onChange:X=>de(E,"descripcion",X),placeholder:"Notas sobre el trabajo realizado"})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${$.border}`},children:[e.jsx(tt,{variant:"outline",onClick:()=>E(null),children:"Cancelar"}),e.jsxs(tt,{variant:"primary",onClick:ce,children:[e.jsx(wo,{size:12}),"Guardar borrador"]})]})]})}):null,Tr=()=>w?e.jsx("div",{style:se.overlay,onClick:()=>_(null),children:e.jsxs("div",{style:se.modal,onClick:X=>X.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:16,fontSize:14,fontWeight:700},children:"Nueva solicitud"}),e.jsx(yt,{label:"Tipo de solicitud",children:e.jsx(yi,{value:w.tipo,onChange:X=>de(_,"tipo",X),options:[{value:"",label:"Seleccionar..."},...Cn.map(X=>({value:X.id,label:`${X.icono} ${X.lbl}`}))]})}),w.tipo&&(()=>{const X=U(w.tipo);return e.jsxs(e.Fragment,{children:[X.requiereFechas&&e.jsxs(e.Fragment,{children:[e.jsx(yt,{label:"Fecha inicio",children:e.jsx(bt,{type:"date",value:w.fechaInicio,onChange:Te=>de(_,"fechaInicio",Te)})}),e.jsx(yt,{label:"Fecha fin",children:e.jsx(bt,{type:"date",value:w.fechaFin,onChange:Te=>de(_,"fechaFin",Te)})})]}),X.requiereHoras&&e.jsx(yt,{label:"Horas",children:e.jsx(bt,{type:"number",value:w.horas||0,onChange:Te=>de(_,"horas",Number(Te))})}),e.jsx(yt,{label:"Motivo / Descripcin",children:e.jsx(yi,{value:w.motivo,onChange:Te=>de(_,"motivo",Te),options:[{value:"",label:"Seleccionar motivo..."},...(w.tipo==="licEspecial"?hf:uf).map(Te=>({value:Te,label:Te}))]})}),e.jsx(yt,{label:"Descripcin adicional (opcional)",children:e.jsx(bt,{value:w.descripcion||"",onChange:Te=>de(_,"descripcion",Te),placeholder:"Aade detalle si lo deseas..."})}),X.requiereDoc&&e.jsxs(yt,{label:"Documento adjunto (opcional)",children:[e.jsx("input",{type:"file",accept:"application/pdf,image/*",onChange:Te=>{const Pe=Te.target.files[0];if(!Pe)return;const et=new FileReader;et.onload=gt=>_(vt=>({...vt,docNombre:Pe.name,docBase64:gt.target.result})),et.readAsDataURL(Pe)},style:{fontSize:11}}),w.docNombre&&e.jsxs("div",{style:{fontSize:10,color:$.green,marginTop:3},children:[" ",w.docNombre]})]})]})})(),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${$.border}`},children:[e.jsx(tt,{variant:"outline",onClick:()=>_(null),children:"Cancelar"}),e.jsxs(tt,{variant:"primary",onClick:Y,disabled:!w.tipo,children:[e.jsx(yn,{size:12}),"Enviar solicitud"]})]})]})}):null;return e.jsxs("div",{style:se.page,children:[e.jsxs("div",{style:{background:$.surface,borderBottom:`1px solid ${$.border}`,padding:"0 20px",display:"flex",overflowX:"auto"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"10px 12px 10px 0",borderRight:`1px solid ${$.border}`,marginRight:8,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:24,height:24,background:$.ink,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:10,fontWeight:800,color:"#fff",letterSpacing:.5},children:"H"})}),e.jsx("span",{style:{fontSize:11,fontWeight:700,color:$.ink},children:k})]}),ge.map(X=>{const Te=p===X.id;return e.jsxs("button",{onClick:()=>d(X.id),style:se.navBtn(Te),children:[X.lbl,X.badge>0&&e.jsx("span",{style:{background:$.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:X.badge})]},X.id)}),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>f(!1),style:{...se.navBtn(!1),color:$.red},children:[e.jsx(Nc,{size:11}),"Salir"]})]}),e.jsxs("div",{style:{padding:"20px 20px",maxWidth:900,margin:"0 auto",paddingBottom:40},children:[p==="calendario"&&e.jsx(I,{}),p==="partes"&&e.jsx(N,{}),p==="solicitudes"&&e.jsx(q,{}),p==="viajes"&&e.jsx(rl,{}),p==="ficha"&&e.jsx(J,{}),p==="documentos"&&e.jsx(R,{})]}),e.jsx(Zi,{}),e.jsx(Tr,{})]})}function la({onCancel:t,onSave:i,saveLabel:o="Guardar"}){return e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:20,paddingTop:16,borderTop:`1px solid ${$.border}`},children:[e.jsx(tt,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsxs(tt,{variant:"primary",onClick:i,children:[e.jsx(wo,{size:12}),o]})]})}const Qa=[{id:"dashboard",lbl:"Dashboard",I:Ji,desc:"KPIs y mtricas de RRHH"},{id:"cargos",lbl:"Cargos y Salarios",I:Bi,desc:"Plantilla y cargas sociales"},{id:"jornada",lbl:"Jornada Laboral",I:Ta,desc:"Horas, festivos y productividad"},{id:"activos",lbl:"Activos y Estructura",I:Tn,desc:"NIIF, licencias y gastos"},{id:"equipos",lbl:"Equipos de Trabajo",I:Bi,desc:"Configura equipos para APUs"},{id:"asistencia",lbl:"Asistencia Obra",I:wd,desc:"Control GPS+Foto de entrada/salida"},{id:"partes",lbl:"Partes de Trabajo",I:En,desc:"Vista admin  empleados imputan desde Portal"},{id:"novedades",lbl:"Novedades Nmina",I:Et,desc:"Vacaciones, bajas, permisos y horas extra"},{id:"docs",lbl:"Documentos",I:Ao,desc:"Nminas, contratos y certificados"},{id:"portal",lbl:"Portal Empleado",I:vn,desc:"Vista del trabajador"}];function Ef({pais:t="CO"}){var Z,K;const[i,o]=F.useState("dashboard"),n={pais:t},[a,r]=mi(xi.cargos,[]),[s,g]=mi(xi.jornada,lf),[h,b]=mi(xi.activos,[]),[j,k]=mi(xi.licencias,[]),[v,m]=mi(xi.gastos,[]),[f,p]=mi(xi.equipos,[]),[d,c]=mi(xi.partes,[]),[l,x]=mi(xi.asistencia,[]),[y,u]=mi(xi.empleados,[]),[S,A]=mi(xi.novedades,[]),[E,w]=mi(xi.fichas,[]),[_,z]=mi(xi.docs,[]),T=d.filter(P=>P.estado==="Enviado").length,L=S.filter(P=>P.estado==="Pendiente").length;return e.jsxs(e.Fragment,{children:[e.jsx(rf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:$.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:$.surface,borderBottom:`1px solid ${$.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:$.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:$.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:$.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:$.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase",color:$.ink},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:$.inkLight,marginLeft:10},children:"/ Recursos Humanos"})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[T>0&&e.jsxs("div",{style:{background:$.amberBg,border:`1px solid ${$.amber}33`,borderRadius:3,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>o("partes"),children:[e.jsx(li,{size:11,color:$.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:$.amber},children:[T," parte",T>1?"s":""," pendiente",T>1?"s":""]})]}),L>0&&e.jsxs("div",{style:{background:"#FAF0E0",border:"1px solid #8C6A0033",borderRadius:3,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>o("novedades"),children:[e.jsx(Fa,{size:11,color:"#8C6A00"}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:"#8C6A00"},children:[L," nov. pendiente",L>1?"s":""]})]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:$.surface,borderRight:`1px solid ${$.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[Qa.map(P=>{const te=i===P.id;return e.jsxs("button",{onClick:()=>o(P.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:te?`3px solid ${$.ink}`:"3px solid transparent",background:te?$.accent:"transparent",color:te?$.ink:$.inkLight,fontSize:12,fontWeight:te?700:400,cursor:"pointer",textAlign:"left",width:"100%",position:"relative",transition:"all .1s"},children:[e.jsx(P.I,{size:13,style:{flexShrink:0}}),e.jsx("span",{style:{lineHeight:1.2},children:P.lbl}),P.id==="partes"&&T>0&&e.jsx("span",{style:{marginLeft:"auto",background:$.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:T}),P.id==="novedades"&&L>0&&e.jsx("span",{style:{marginLeft:"auto",background:"#8C6A00",color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:L})]},P.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:$.inkXLight,letterSpacing:.8,borderTop:`1px solid ${$.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:i==="portal"?e.jsx(zf,{partes:d,savePartes:c,novedades:S,saveNovedades:A,fichas:E,saveFichas:w,docs:_,saveDocs:z,cargos:a,empleados:y,saveEmpleados:u}):e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:$.ink,letterSpacing:-.2},children:(Z=Qa.find(P=>P.id===i))==null?void 0:Z.lbl}),e.jsx("p",{style:{fontSize:11,color:$.inkLight,marginTop:2},children:(K=Qa.find(P=>P.id===i))==null?void 0:K.desc})]}),i==="dashboard"&&e.jsxs("div",{className:"fade-up",style:{padding:"20px 0"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Cargos",a.length,"#111"],[" Empleados",y.length,"#3B3B3B"],[" Partes",d.length,"#111"],[" Novedades pend.",S.filter(P=>P.estado==="Pendiente").length,S.filter(P=>P.estado==="Pendiente").length>0?"#8C6A00":"#111111"]].map(([P,te,he])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:P}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:he},children:te})]},P))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Horas aprobadas",d.filter(P=>P.estado==="Aprobado").reduce((P,te)=>P+Number(te.horasNormales||0)+Number(te.horasExtra||0),0)+"h","#111111"],[" Vacaciones aprobadas",S.filter(P=>P.tipo==="vacaciones"&&P.estado==="Aprobada").reduce((P,te)=>P+Number(te.dias||0),0)+"d","#3B3B3B"],[" Bajas activas",S.filter(P=>P.tipo==="baja"&&P.estado==="Aprobada").length,"#B91C1C"],[" Viticos pend.",[].filter(P=>P.estado==="solicitado").length,"#8C6A00"]].map(([P,te,he])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:P}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:he},children:te})]},P))})]}),i==="cargos"&&e.jsx(mf,{cargos:a,saveCargos:r,jornada:s}),i==="jornada"&&e.jsx(bf,{jornada:s,saveJornada:g}),i==="activos"&&e.jsx(yf,{activos:h,saveActivos:b,licencias:j,saveLicencias:k,gastos:v,saveGastos:m}),i==="equipos"&&e.jsx(vf,{equipo:f,setEquipo:p,cargos:a,pais:(n==null?void 0:n.pais)||"CO"}),i==="asistencia"&&e.jsx(Sf,{equipo:f,asistencia:l,setAsistencia:x,pais:(n==null?void 0:n.pais)||"CO"}),i==="partes"&&e.jsx(jf,{partes:d,setPartes:c,equipo:f,cargos:a,currentUser:null,pais:(n==null?void 0:n.pais)||"CO"}),i==="novedades"&&e.jsx(Cf,{novedades:S,saveNovedades:A}),i==="docs"&&e.jsx(wf,{docs:_,saveDocs:z,fichas:E,cargos:a})]})})]})]})]})}const oe={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C0BDB8",border:"#E0E0E0",accent:"#EDEBE7",shadow:"0 1px 3px rgba(0,0,0,.06)",shadowMd:"0 4px 20px rgba(0,0,0,.09)",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",orange:"#7C3A1E",orangeBg:"#FDF0E8"},Af=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800;900&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'DM Sans',sans-serif;background:${oe.bg};}
    .mono{font-family:'DM Mono',monospace;}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    .fade-up{animation:fadeUp .18s ease both}
    input,button,select{font-family:'DM Sans',sans-serif;}
    input:focus,select:focus{outline:none;border-color:${oe.ink}!important;}
    ::-webkit-scrollbar{width:4px;height:4px;}
    ::-webkit-scrollbar-thumb{background:${oe.border};border-radius:2px;}
    table{border-collapse:collapse;}
  `});function mn(t,i){const[o,n]=F.useState(i);return useEffect(()=>{Ee.get(t).then(r=>{if(r)try{n(JSON.parse(r))}catch{}}).catch(()=>{})},[t]),[o,r=>{const s=typeof r=="function"?r(o):r;n(s);try{Ee.set(t,JSON.stringify(s))}catch{}}]}const Go={CO:{label:"Colombia",flag:"",ref:"NTC 2050 / RETIE",mono_V:120,tri_VLN:120,tri_VLL:208,FS:1.25,curvas:["C","D"],dV_max_rama:3,dV_max_total:5,breakers:[6,10,15,20,25,30,40,50,60,70,80,90,100,110,125,150,175,200]},ES:{label:"Espaa",flag:"",ref:"REBT ITC-BT-19",mono_V:230,tri_VLN:230,tri_VLL:400,FS:1.25,curvas:["B","C","D"],dV_max_rama:3,dV_max_total:5,breakers:[6,10,13,16,20,25,32,40,50,63,80,100,125,160,200,250]}},ol=[1.5,2.5,4,6,10,16,25,35,50,70,95,120],cc={Cobre:.01786,Aluminio:.02857},pc={1.5:15,2.5:21,4:27,6:34,10:46,16:61,25:80,35:99,50:119,70:151,95:182,120:210},gc={1.5:null,2.5:null,4:20,6:26,10:35,16:46,25:60,35:75,50:90,70:115,95:138,120:160};function qs(t,i){const o=Go[i].breakers;return o.find(n=>n>=t)||o[o.length-1]}function uc(t,i){const o=i==="Cobre"?pc:gc;for(const n of ol)if(o[n]&&o[n]>=t)return n;return 120}function hc(t,i,o,n,a,r){const s=cc[n],g=Go[r],h=a==="Monofsica"?g.mono_V:g.tri_VLL;return(a==="Monofsica"?2:Math.sqrt(3))*t*i*s/o/h*100}function fc(t,i,o,n,a,r){const s=cc[o],g=Go[a],h=n==="Monofsica"?g.mono_V:g.tri_VLL,b=n==="Monofsica"?2:Math.sqrt(3),j=h/(r*1e3),k=b*t*s/i;return h/(j+k)/1e3}const Jt=t=>isNaN(t)||t==null?"":Number(t).toLocaleString("es-CO",{maximumFractionDigits:2}),Za=t=>isNaN(t)||t==null?"":"$ "+Number(t).toLocaleString("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0}),Rt=({label:t,value:i,onChange:o,unit:n,type:a="number",placeholder:r="",step:s,min:g})=>e.jsxs("div",{style:{marginBottom:10},children:[t&&e.jsxs("div",{style:{fontSize:9,color:oe.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:[t,n&&e.jsxs("span",{style:{color:oe.inkXLight,marginLeft:4},children:["(",n,")"]})]}),e.jsx("input",{type:a,value:i,onChange:h=>o(h.target.value),placeholder:r,step:s,min:g,style:{width:"100%",padding:"8px 10px",border:`1.5px solid ${oe.border}`,borderRadius:4,fontSize:12,background:oe.surface,color:oe.ink}})]}),Vi=({label:t,value:i,onChange:o,options:n,small:a=!1})=>e.jsxs("div",{style:{marginBottom:a?0:10},children:[t&&e.jsx("div",{style:{fontSize:9,color:oe.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:t}),e.jsx("select",{value:i,onChange:r=>o(r.target.value),style:{width:"100%",padding:a?"6px 8px":"8px 10px",border:`1.5px solid ${oe.border}`,borderRadius:4,fontSize:12,background:oe.surface,color:oe.ink},children:n.map(r=>e.jsx("option",{value:r.v||r,children:r.l||r},r.v||r))})]}),Ff=({ok:t,warn:i,text:o})=>e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:3,background:i?oe.amberBg:t?oe.greenBg:oe.redBg,border:`1px solid ${i?oe.amber:t?oe.green:oe.red}33`},children:[i?e.jsx(li,{size:9,color:oe.amber}):t?e.jsx(Ho,{size:9,color:oe.green}):e.jsx(li,{size:9,color:oe.red}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:i?oe.amber:t?oe.green:oe.red},children:o})]}),$a=({pais:t})=>e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:5,padding:"3px 10px",borderRadius:12,background:oe.accent,border:`1px solid ${oe.border}`,fontSize:10,color:oe.inkMid},children:[e.jsx("span",{children:Go[t].flag}),e.jsx("span",{style:{fontWeight:700},children:t==="CO"?"NTC 2050  RETIE":"REBT  ITC-BT"})]}),Ur=[{id:"dashboard",label:"Dashboard",I:Ji,desc:"Vista general de herramientas"},{id:"cuadro",label:"Cuadro de Cargas",I:sl,desc:"Tabla completa circuito a circuito"},{id:"circuito",label:"Circuito Rpido",I:sl,desc:"Clculo unitario de un circuito"},{id:"iluminacion",label:"Iluminacin",I:zd,desc:"Diseo luminotcnico  RETILAP / CTE DB-HE3"},{id:"concreto",label:"Concreto",I:Uc,desc:"Volmenes y mezclas ACI 211"},{id:"cubicacion",label:"Cubicacin",I:Ed,desc:"reas, volmenes y permetros"},{id:"materiales",label:"Materiales",I:Tn,desc:"Presupuesto rpido de obra"},{id:"unidades",label:"Unidades",I:Vc,desc:"Conversin entre sistemas"}],Kl=()=>({id:Date.now()+Math.random(),desc:"",tipo:"General",cant:1,wUnit:"",fp:.9,simult:1,material:"Cobre",longitud:"",seccionManual:"",curva:"C",fase:"L1"});function Tf({pais:t}){const i=Go[t],[o,n]=mn("hab:herr:cuadro:red","Monofsica"),[a,r]=mn("hab:herr:cuadro:iccb","6"),[s,g]=mn("hab:herr:cuadro:filas",[Kl()]),[h,b]=mn("hab:herr:cuadro:nombre","Tablero General"),j=o==="Monofsica"?i.mono_V:i.tri_VLL,k=o==="Monofsica"?i.mono_V:i.tri_VLN,v=(E,w,_)=>g(z=>z.map(T=>T.id===E?{...T,[w]:_}:T)),m=()=>g(E=>[...E,Kl()]),f=E=>g(w=>w.filter(_=>_.id!==E)),p=F.useMemo(()=>s.map(E=>{const w=Number(E.cant)||0,_=Number(E.wUnit)||0,z=Number(E.fp)||1,T=Number(E.simult)||1,L=Number(E.longitud)||0,Z=w*_*T,K=z>0?Z/z:Z,P=j>0&&K>0?K/k:0,te=P*i.FS,he=te>0?qs(te,t):null,Q=te>0?uc(te,E.material):null,Se=Number(E.seccionManual)||Q||0,ae=L>0&&P>0&&Se>0?hc(L,P,Se,E.material,o,t):null,U=L>0&&Se>0&&Number(a)>0?fc(L,Se,E.material,o,t,Number(a)):null,M=E.material==="Cobre"?pc[Se]:gc[Se],B=ae!==null?ae<=i.dV_max_rama:null,H=U!==null?U>.001:null;return{totalW:Z,totalVA:K,I:P,Id:te,breaker:he,seccion:Se,secAuto:Q,dV:ae,iccFin:U,dVok:B,iccOk:H,iMaxCond:M}}),[s,o,t,a,j,k,i]),d=p.reduce((E,w)=>E+w.totalW,0),c=p.reduce((E,w)=>E+w.totalVA,0),l=j>0?c/k:0,x=qs(l*i.FS,t),y=["General","Iluminacin","Tomacorriente","Motor","Aire Acondicionado","Calefaccin","Bomba","UPS","Carga EV","Otro"],u=o==="Monofsica"?["L1"]:["L1","L2","L3"],S={padding:"7px 8px",fontSize:8,letterSpacing:.8,textTransform:"uppercase",color:oe.inkLight,fontWeight:700,textAlign:"left",background:oe.bg,borderBottom:`2px solid ${oe.border}`,whiteSpace:"nowrap"},A={padding:"5px 6px",fontSize:11,borderBottom:`1px solid ${oe.border}`,verticalAlign:"middle"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:10,marginBottom:12,background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"14px 16px"},children:[e.jsx(Rt,{label:"Nombre del tablero",value:h,onChange:b,type:"text"}),e.jsx(Vi,{label:"Tipo de red",value:o,onChange:n,options:[{v:"Monofsica",l:"Monofsica"},{v:"Trifsica",l:"Trifsica"}]}),e.jsx(Rt,{label:"Icc barra (kA)",value:a,onChange:r,step:"0.5",min:"1"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:oe.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Normativa"}),e.jsx("div",{style:{padding:"8px 0"},children:e.jsx($a,{pais:t})})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:oe.inkMid},children:[e.jsxs("span",{style:{fontWeight:700,color:oe.ink},className:"mono",children:[Jt(d)," W"]})," totales ",e.jsxs("span",{style:{fontWeight:700,color:oe.blue,marginLeft:6},className:"mono",children:[Jt(c)," VA"]})," ",e.jsxs("span",{style:{fontWeight:700,color:oe.red,marginLeft:6},className:"mono",children:["I=",Jt(l)," A"]})," ",e.jsxs("span",{style:{fontWeight:700,color:oe.amber,marginLeft:6},children:["Breaker principal: ",x," A"]})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:6},children:e.jsxs("button",{onClick:m,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 12px",background:oe.ink,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:11,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(Oe,{size:12}),"Circuito"]})})]}),e.jsx("div",{style:{overflowX:"auto",background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8},children:e.jsxs("table",{style:{width:"100%",minWidth:1200},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:S,children:"#"}),e.jsx("th",{style:{...S,minWidth:130},children:"Descripcin"}),e.jsx("th",{style:S,children:"Tipo"}),e.jsx("th",{style:{...S,width:50},children:"Cant"}),e.jsx("th",{style:{...S,width:70},children:"W unit"}),e.jsx("th",{style:{...S,width:50},children:"FP"}),e.jsx("th",{style:{...S,width:60},children:"Simult."}),e.jsx("th",{style:S,children:"Total W"}),e.jsx("th",{style:S,children:"Total VA"}),e.jsx("th",{style:S,children:"I (A)"}),e.jsx("th",{style:S,children:"IFS (A)"}),e.jsx("th",{style:S,children:"Breaker"}),e.jsx("th",{style:S,children:"Curva"}),e.jsx("th",{style:S,children:"Material"}),e.jsx("th",{style:{...S,width:60},children:"Long (m)"}),e.jsx("th",{style:S,children:"Secc mm"}),e.jsx("th",{style:S,children:"V %"}),e.jsx("th",{style:S,children:"Icc fin"}),o==="Trifsica"&&e.jsx("th",{style:S,children:"Fase"}),e.jsx("th",{style:S})]})}),e.jsx("tbody",{children:s.map((E,w)=>{const _=p[w];return e.jsxs("tr",{style:{background:w%2===0?oe.surface:oe.bg+"80"},children:[e.jsx("td",{style:{...A,color:oe.inkLight,fontWeight:700},children:w+1}),e.jsx("td",{style:A,children:e.jsx("input",{value:E.desc,onChange:z=>v(E.id,"desc",z.target.value),placeholder:"Ej: Iluminacin sala",style:{width:"100%",padding:"4px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("select",{value:E.tipo,onChange:z=>v(E.id,"tipo",z.target.value),style:{width:"100%",padding:"4px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:10,background:"transparent"},children:y.map(z=>e.jsx("option",{children:z},z))})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.cant,onChange:z=>v(E.id,"cant",z.target.value),min:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.wUnit,onChange:z=>v(E.id,"wUnit",z.target.value),placeholder:"0",style:{width:"100%",padding:"4px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.fp,onChange:z=>v(E.id,"fp",z.target.value),step:"0.01",min:"0.1",max:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.simult,onChange:z=>v(E.id,"simult",z.target.value),step:"0.1",min:"0.1",max:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:{...A,fontWeight:_.totalW>0?600:400},className:"mono",children:_.totalW>0?Jt(_.totalW):""}),e.jsx("td",{style:{...A},className:"mono",children:_.totalVA>0?Jt(_.totalVA):""}),e.jsx("td",{style:{...A,color:oe.blue,fontWeight:600},className:"mono",children:_.I>0?Jt(_.I):""}),e.jsx("td",{style:{...A},className:"mono",children:_.Id>0?Jt(_.Id):""}),e.jsx("td",{style:{...A},children:_.breaker?e.jsxs("span",{style:{background:oe.ink,color:"#fff",borderRadius:3,padding:"2px 7px",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace"},children:[_.breaker,"A"]}):""}),e.jsx("td",{style:A,children:e.jsx("select",{value:E.curva,onChange:z=>v(E.id,"curva",z.target.value),style:{padding:"3px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent"},children:i.curvas.map(z=>e.jsx("option",{children:z},z))})}),e.jsx("td",{style:A,children:e.jsxs("select",{value:E.material,onChange:z=>v(E.id,"material",z.target.value),style:{padding:"3px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent",minWidth:70},children:[e.jsx("option",{children:"Cobre"}),e.jsx("option",{children:"Aluminio"})]})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.longitud,onChange:z=>v(E.id,"longitud",z.target.value),placeholder:"0",style:{width:"100%",padding:"4px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsxs("td",{style:A,children:[e.jsxs("select",{value:E.seccionManual||_.secAuto||"",onChange:z=>v(E.id,"seccionManual",z.target.value),style:{padding:"3px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:E.seccionManual?"transparent":oe.greenBg,minWidth:55},children:[e.jsx("option",{value:"",children:"Auto"}),ol.map(z=>e.jsx("option",{value:z,children:z},z))]}),_.seccion>0&&e.jsxs("div",{style:{fontSize:8,color:oe.green,marginTop:1},className:"mono",children:[_.seccion,"mm"]})]}),e.jsx("td",{style:A,children:_.dV!==null?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:_.dVok?oe.green:oe.red},children:[Jt(_.dV),"%"]}),e.jsx("div",{style:{marginTop:2},children:e.jsx(Ff,{ok:_.dVok,text:_.dVok?`${i.dV_max_rama}% `:`>${i.dV_max_rama}% `})})]}):e.jsx("span",{style:{color:oe.inkXLight},children:""})}),e.jsx("td",{style:A,children:_.iccFin!==null?e.jsxs("span",{className:"mono",style:{fontSize:11,color:oe.inkMid},children:[_.iccFin.toFixed(2)," kA"]}):e.jsx("span",{style:{color:oe.inkXLight},children:""})}),o==="Trifsica"&&e.jsx("td",{style:A,children:e.jsx("select",{value:E.fase,onChange:z=>v(E.id,"fase",z.target.value),style:{padding:"3px 6px",border:`1px solid ${oe.border}`,borderRadius:3,fontSize:11,background:"transparent"},children:u.map(z=>e.jsx("option",{children:z},z))})}),e.jsx("td",{style:A,children:e.jsx("button",{onClick:()=>f(E.id),style:{background:"none",border:"none",cursor:"pointer",color:oe.red,fontSize:16,lineHeight:1,padding:2},children:""})})]},E.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:oe.ink},children:[e.jsxs("td",{colSpan:7,style:{padding:"10px 12px",fontSize:10,fontWeight:700,color:"rgba(255,255,255,.5)",textTransform:"uppercase",letterSpacing:1},children:["TOTALES  ",s.length," circuitos  FS=",i.FS,"  ",j,"V"]}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#fff"},children:[Jt(d)," W"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#adf"},children:[Jt(c)," VA"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#faa"},children:[Jt(l)," A"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:11,color:"rgba(255,255,255,.5)"},children:[Jt(l*i.FS)," A"]})}),e.jsx("td",{style:{padding:"10px 8px"},children:e.jsxs("span",{style:{background:"#fff",color:oe.ink,borderRadius:3,padding:"3px 8px",fontSize:12,fontWeight:800,fontFamily:"'DM Mono',monospace"},children:[x,"A"]})}),e.jsx("td",{colSpan:o==="Trifsica"?7:6}),e.jsx("td",{})]})})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10,flexWrap:"wrap"},children:[e.jsxs("div",{style:{fontSize:9,color:oe.inkLight},children:[e.jsx("span",{style:{background:oe.greenBg,padding:"1px 5px",borderRadius:2,fontSize:8},children:"Auto"})," Seccin calculada automticamente por corriente"]}),e.jsxs("div",{style:{fontSize:9,color:oe.inkLight},children:[" V max permitido: ",e.jsxs("strong",{children:[i.dV_max_rama,"%"]})," por circuito (",i.ref,")"]}),e.jsx("div",{style:{fontSize:9,color:oe.inkLight},children:" Resistividad Cu: 0.01786 mm/m  Al: 0.02857 mm/m  T=20C"})]})]})}function Bf({pais:t}){const i=Go[t],[o,n]=F.useState("Monofsica"),[a,r]=F.useState(""),[s,g]=F.useState("0.9"),[h,b]=F.useState("1.0"),[j,k]=F.useState(""),[v,m]=F.useState("Cobre"),[f,p]=F.useState("6"),[d,c]=F.useState(""),l=o==="Monofsica"?i.mono_V:i.tri_VLN;o==="Monofsica"?i.mono_V:i.tri_VLL;const x=Number(a)*Number(h)||0,y=s>0?x/Number(s):x,u=l>0&&y>0?y/l:0,S=u*i.FS,A=S>0?qs(S,t):null,E=S>0?uc(S,v):null,w=Number(d)||E||0,_=Number(j)>0&&u>0&&w>0?hc(Number(j),u,w,v,o,t):null,z=Number(j)>0&&w>0&&Number(f)>0?fc(Number(j),w,v,o,t,Number(f)):null,T=_!==null?_<=i.dV_max_rama:null,L=({label:Z,val:K,unit:P,hi:te,warn:he})=>e.jsxs("div",{style:{background:te?oe.ink:he?oe.amberBg:oe.bg,border:`1px solid ${te?oe.ink:he?oe.amber+"44":oe.border}`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:te?"rgba(255,255,255,.4)":oe.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:4},children:Z}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:te?"#fff":he?oe.amber:oe.ink},children:K||""}),P&&e.jsx("div",{style:{fontSize:9,color:te?"rgba(255,255,255,.4)":oe.inkLight,marginTop:2},children:P})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:oe.inkLight,fontWeight:700},children:"Datos del circuito"}),e.jsx($a,{pais:t})]}),e.jsx(Vi,{label:"Tipo de red",value:o,onChange:n,options:[{v:"Monofsica",l:`Monofsica (${i.mono_V}V)`},{v:"Trifsica",l:`Trifsica (${i.tri_VLL||""}V)`}]}),e.jsx(Rt,{label:"Potencia total instalada",value:a,onChange:r,unit:"W"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Rt,{label:"Factor de potencia",value:s,onChange:g,step:"0.01",min:"0.5",max:"1"}),e.jsx(Rt,{label:"Factor simultaneidad",value:h,onChange:b,step:"0.1",min:"0.1",max:"1"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Rt,{label:"Longitud circuito",value:j,onChange:k,unit:"m"}),e.jsx(Rt,{label:"Icc en barra (kA)",value:f,onChange:p,step:"0.5"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Vi,{label:"Material conductor",value:v,onChange:m,options:["Cobre","Aluminio"]}),e.jsx(Vi,{label:"Seccin (vaco=auto)",value:d,onChange:c,options:[{v:"",l:"Auto"},...ol.map(Z=>({v:Z,l:`${Z} mm`}))]})]})]}),e.jsxs("div",{style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:oe.inkLight,fontWeight:700,marginBottom:14},children:"Resultados"}),u>0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(L,{label:`Potencia activa (${Number(h)})`,val:`${Jt(x)} W`}),e.jsx(L,{label:"Potencia aparente",val:`${Jt(y)} VA`})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(L,{label:`Corriente nominal (${l}V)`,val:`${Jt(u)} A`}),e.jsx(L,{label:`Corriente diseo (${i.FS})`,val:`${Jt(S)} A`})]}),e.jsx(L,{label:"Breaker recomendado",val:`${A} A  Curva ${i.curvas[0]}`,hi:!0}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(L,{label:`Seccin ${d?"manual":"auto (${material})"}`,val:`${w} mm`,warn:d&&Number(d)<(E||0)}),_!==null&&e.jsxs("div",{style:{background:T?oe.greenBg:oe.redBg,border:`1px solid ${T?oe.green:oe.red}33`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:T?oe.green:oe.red,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Cada de tensin"}),e.jsxs("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:T?oe.green:oe.red},children:[Jt(_),"%"]}),e.jsx("div",{style:{fontSize:9,color:T?oe.green:oe.red,marginTop:2},children:T?`  ${i.dV_max_rama}% (${i.ref})`:` Supera ${i.dV_max_rama}% mx`})]})]}),z!==null&&e.jsx(L,{label:"Corriente cortocircuito fin de lnea",val:`${z.toFixed(3)} kA`}),e.jsxs("div",{style:{background:oe.accent,borderRadius:4,padding:"8px 10px",fontSize:10,color:oe.inkMid,lineHeight:1.7,marginTop:4},children:[e.jsxs("strong",{children:["Normativa ",i.flag," ",t,":"]})," ",i.ref,"  FS=",i.FS,"  V_max=",i.dV_max_rama,"% por rama / ",i.dV_max_total,"% total"]})]}):e.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:oe.inkXLight,fontSize:12},children:"Completa los datos para ver resultados"})]})]})}function If(){const[t,i]=F.useState(""),[o,n]=F.useState("21"),[a,r]=F.useState("normal"),s={14:{ce:280,ag:205,ar:810,gr:960},"17.5":{ce:310,ag:200,ar:790,gr:940},21:{ce:350,ag:195,ar:760,gr:920},28:{ce:400,ag:190,ar:720,gr:880},35:{ce:450,ag:185,ar:680,gr:850}},g=s[o]||s[21],h=Number(t)||0,b=({l:j,val:k,u:v,hi:m})=>e.jsxs("div",{style:{background:m?oe.ink:oe.bg,border:`1px solid ${m?oe.ink:oe.border}`,borderRadius:6,padding:"12px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:9,color:m?"rgba(255,255,255,.4)":oe.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:6},children:j}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:m?"#fff":oe.ink},children:k}),v&&e.jsx("div",{style:{fontSize:9,color:m?"rgba(255,255,255,.4)":oe.inkLight,marginTop:2},children:v})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:oe.inkLight,fontWeight:700,marginBottom:14},children:"Datos ACI 211"}),e.jsx(Rt,{label:"Volumen requerido",value:t,onChange:i,unit:"m"}),e.jsx(Vi,{label:"Resistencia f'c",value:o,onChange:n,options:[{v:"14",l:"14 MPa (2000 PSI)  Ciclpeo"},{v:"17.5",l:"17.5 MPa (2500 PSI)  Cimientos"},{v:"21",l:"21 MPa (3000 PSI)  Estructural"},{v:"28",l:"28 MPa (4000 PSI)  Alta resist."},{v:"35",l:"35 MPa (5000 PSI)  Especial"}]}),e.jsx(Vi,{label:"Tipo de agregado",value:a,onChange:r,options:[{v:"normal",l:"Normal (grava triturada)"},{v:"liviano",l:"Liviano (+8% agua)"}]}),e.jsxs("div",{style:{background:oe.blueBg,border:`1px solid ${oe.blue}22`,borderRadius:5,padding:"10px 12px",marginTop:8},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:oe.blue,marginBottom:4,letterSpacing:1,textTransform:"uppercase"},children:"Dosificacin por m"}),e.jsxs("div",{style:{fontSize:11,color:oe.blue},children:["Ce: ",g.ce," kg  Ag: ",g.ag," L  Ar: ",g.ar," kg  Gr: ",g.gr," kg"]})]})]}),e.jsxs("div",{style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"20px"},children:[e.jsxs("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:oe.inkLight,fontWeight:700,marginBottom:14},children:["Cantidades para ",h||"?"," m"]}),h>0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(b,{l:"Cemento",val:`${(g.ce*h).toFixed(0)} kg`,hi:!0}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(b,{l:"Sacos 50 kg",val:Math.ceil(g.ce*h/50),u:"sacos"}),e.jsx(b,{l:"Agua",val:`${(g.ag*h*(a==="liviano"?1.08:1)).toFixed(0)} L`})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(b,{l:"Arena",val:`${(g.ar*h).toFixed(0)} kg`}),e.jsx(b,{l:"Grava",val:`${(g.gr*h).toFixed(0)} kg`})]})]}):e.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:oe.inkXLight,fontSize:12},children:"Ingresa el volumen"})]})]})}function Rf(){const[t,i]=F.useState("losa"),[o,n]=F.useState(""),[a,r]=F.useState(""),[s,g]=F.useState(""),[h,b]=F.useState(""),[j,k]=F.useState("0.12"),v=F.useMemo(()=>{const f=Number(o)||0,p=Number(a)||0,d=Number(s)||0,c=Number(h)||0,l=Number(j)||0;return t==="losa"?{area:f*p,volumen:f*p*l,perimetro:2*(f+p)}:t==="columna"?{area:f*p,volumen:f*p*d,perimetro:2*(f+p)}:t==="viga"?{area:f*p,volumen:f*p*d,perimetro:2*(f+p)}:t==="cilindro"?{area:Math.PI*c*c,volumen:Math.PI*c*c*d,perimetro:2*Math.PI*c}:t==="muro"?{area:f*d,volumen:f*d*l,perimetro:2*(f+d)}:{area:0,volumen:0,perimetro:0}},[t,o,a,s,h,j]),m=({l:f,val:p,u:d,hi:c})=>e.jsxs("div",{style:{background:c?oe.ink:oe.bg,border:`1px solid ${c?oe.ink:oe.border}`,borderRadius:6,padding:"12px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:9,color:c?"rgba(255,255,255,.4)":oe.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:6},children:f}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:c?"#fff":oe.ink},children:p||""}),d&&e.jsx("div",{style:{fontSize:9,color:c?"rgba(255,255,255,.4)":oe.inkLight,marginTop:2},children:d})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:oe.inkLight,fontWeight:700,marginBottom:14},children:"Elemento estructural"}),e.jsx(Vi,{label:"Tipo",value:t,onChange:i,options:[{v:"losa",l:"Losa / Placa"},{v:"columna",l:"Columna"},{v:"viga",l:"Viga"},{v:"cilindro",l:"Pilote / Cilindro"},{v:"muro",l:"Muro / Pared"}]}),t!=="cilindro"&&e.jsx(Rt,{label:t==="muro"?"Longitud":"Ancho (a)",value:o,onChange:n,unit:"m"}),t==="losa"&&e.jsx(Rt,{label:"Largo (b)",value:a,onChange:r,unit:"m"}),(t==="columna"||t==="viga")&&e.jsx(Rt,{label:"Ancho (b)",value:a,onChange:r,unit:"m"}),t==="cilindro"&&e.jsx(Rt,{label:"Radio",value:h,onChange:b,unit:"m"}),t!=="losa"&&e.jsx(Rt,{label:"Altura / Longitud",value:s,onChange:g,unit:"m"}),(t==="losa"||t==="muro")&&e.jsx(Rt,{label:t==="losa"?"Espesor":"Ancho muro",value:j,onChange:k,unit:"m"})]}),e.jsxs("div",{style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:oe.inkLight,fontWeight:700,marginBottom:14},children:"Resultados"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(m,{l:"rea",val:v.area>0?`${v.area.toFixed(3)}`:"",u:"m",hi:!0}),e.jsx(m,{l:"Volumen",val:v.volumen>0?`${v.volumen.toFixed(4)}`:"",u:"m"}),e.jsx(m,{l:"Permetro",val:v.perimetro>0?`${v.perimetro.toFixed(2)}`:"",u:"m"}),v.volumen>0&&e.jsxs("div",{style:{background:oe.greenBg,border:`1px solid ${oe.green}22`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:oe.green,fontWeight:700,letterSpacing:1,textTransform:"uppercase",marginBottom:4},children:"Concreto estimado (f'c=21MPa +10%)"}),e.jsxs("div",{className:"mono",style:{fontSize:13,fontWeight:700,color:oe.green},children:[(v.volumen*1.1*350).toFixed(0)," kg cemento  ",Math.ceil(v.volumen*1.1*350/50)," sacos"]})]})]})]})]})}function _f(){const[t,i]=mn("hab:herr:materiales",[]),[o,n]=F.useState({nombre:"",unidad:"m",cantidad:"",precioUnit:""}),a=(h,b)=>n(j=>({...j,[h]:b})),r=()=>{!o.nombre||!o.cantidad||!o.precioUnit||(i(h=>[...h,{...o,id:Date.now(),sub:Number(o.cantidad)*Number(o.precioUnit)}]),n({nombre:"",unidad:"m",cantidad:"",precioUnit:""}))},s=h=>i(b=>b.filter(j=>j.id!==h)),g=t.reduce((h,b)=>h+b.sub,0);return e.jsxs("div",{className:"fade-up",style:{maxWidth:900},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr auto",gap:8,marginBottom:12,background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"14px 16px",alignItems:"end"},children:[e.jsx(Rt,{label:"Material / tem",value:o.nombre,onChange:h=>a("nombre",h),type:"text",placeholder:"Ej. Concreto f'c=21MPa"}),e.jsx(Vi,{label:"Unidad",value:o.unidad,onChange:h=>a("unidad",h),options:["m","m","ml","kg","und","gl","m"]}),e.jsx(Rt,{label:"Cantidad",value:o.cantidad,onChange:h=>a("cantidad",h)}),e.jsx(Rt,{label:"Precio unitario",value:o.precioUnit,onChange:h=>a("precioUnit",h)}),e.jsx("div",{style:{paddingBottom:0},children:e.jsx("button",{onClick:r,style:{padding:"9px 16px",background:oe.ink,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:12,fontWeight:700,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",height:36},children:"+ Aadir"})})]}),t.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:oe.inkXLight,fontSize:12,background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8},children:"Aade materiales para calcular"}):e.jsx("div",{style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:oe.bg,borderBottom:`2px solid ${oe.border}`},children:["Material","Unidad","Cantidad","Precio Unit.","Subtotal",""].map(h=>e.jsx("th",{style:{padding:"9px 12px",textAlign:"left",fontSize:9,letterSpacing:1,textTransform:"uppercase",color:oe.inkLight,fontWeight:700},children:h},h))})}),e.jsx("tbody",{children:t.map(h=>e.jsxs("tr",{style:{borderBottom:`1px solid ${oe.border}`},children:[e.jsx("td",{style:{padding:"10px 12px",fontWeight:500},children:h.nombre}),e.jsx("td",{style:{padding:"10px 12px",color:oe.inkMid},children:h.unidad}),e.jsx("td",{style:{padding:"10px 12px"},className:"mono",children:Number(h.cantidad).toLocaleString()}),e.jsx("td",{style:{padding:"10px 12px"},className:"mono",children:Za(Number(h.precioUnit))}),e.jsx("td",{style:{padding:"10px 12px",fontWeight:700},className:"mono",children:Za(h.sub)}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("button",{onClick:()=>s(h.id),style:{background:"none",border:"none",cursor:"pointer",color:oe.red,fontSize:16},children:""})})]},h.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:oe.ink},children:[e.jsx("td",{colSpan:4,style:{padding:"12px",fontSize:11,fontWeight:700,color:"rgba(255,255,255,.5)",textTransform:"uppercase",letterSpacing:1},children:"Total presupuesto de materiales"}),e.jsx("td",{style:{padding:"12px"},className:"mono",children:e.jsx("span",{style:{fontSize:16,fontWeight:800,color:"#fff"},children:Za(g)})}),e.jsx("td",{})]})})]})})]})}const es=[{id:"oficina_gral",lbl:"Oficina general",luxCO:500,luxES:500,veei:3,ugr:19,ra:80,cat:"Oficinas"},{id:"oficina_tec",lbl:"Oficina tcnica / Dibujo",luxCO:750,luxES:750,veei:3,ugr:16,ra:80,cat:"Oficinas"},{id:"sala_reuniones",lbl:"Sala de reuniones",luxCO:300,luxES:500,veei:3,ugr:19,ra:80,cat:"Oficinas"},{id:"recepcion",lbl:"Recepcin / Lobby",luxCO:300,luxES:300,veei:3.5,ugr:22,ra:80,cat:"Oficinas"},{id:"archivo",lbl:"Archivo / Bodega oficina",luxCO:200,luxES:200,veei:4,ugr:25,ra:60,cat:"Oficinas"},{id:"sala_estar",lbl:"Sala de estar",luxCO:150,luxES:200,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"dormitorio",lbl:"Dormitorio",luxCO:100,luxES:150,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"cocina_res",lbl:"Cocina residencial",luxCO:300,luxES:300,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"bano",lbl:"Bao",luxCO:200,luxES:200,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"circulacion",lbl:"Circulacin / Pasillo",luxCO:100,luxES:100,veei:7.5,ugr:25,ra:80,cat:"Residencial"},{id:"escalera",lbl:"Escaleras",luxCO:150,luxES:150,veei:4,ugr:25,ra:80,cat:"Residencial"},{id:"garaje",lbl:"Garaje / Parqueadero",luxCO:75,luxES:75,veei:5,ugr:25,ra:40,cat:"Residencial"},{id:"aula",lbl:"Aula de clase",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"laboratorio",lbl:"Laboratorio",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"biblioteca",lbl:"Biblioteca / Lectura",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"comercio",lbl:"Comercio general",luxCO:300,luxES:300,veei:5,ugr:22,ra:80,cat:"Comercio"},{id:"supermercado",lbl:"Supermercado",luxCO:500,luxES:500,veei:5,ugr:22,ra:80,cat:"Comercio"},{id:"restaurante",lbl:"Restaurante",luxCO:200,luxES:200,veei:8,ugr:22,ra:80,cat:"Comercio"},{id:"hospital",lbl:"Hospital  general",luxCO:300,luxES:300,veei:4,ugr:19,ra:80,cat:"Salud"},{id:"consultorio",lbl:"Consultorio mdico",luxCO:500,luxES:500,veei:4,ugr:19,ra:90,cat:"Salud"},{id:"quirofano",lbl:"Quirfano",luxCO:1e3,luxES:1e3,veei:4,ugr:19,ra:90,cat:"Salud"},{id:"nave_ind",lbl:"Nave industrial general",luxCO:300,luxES:300,veei:4,ugr:25,ra:60,cat:"Industrial"},{id:"ind_fina",lbl:"Industria  trabajo fino",luxCO:500,luxES:500,veei:4,ugr:22,ra:80,cat:"Industrial"},{id:"almacen",lbl:"Almacn / Depsito",luxCO:150,luxES:100,veei:5,ugr:25,ra:60,cat:"Industrial"},{id:"ext_acera",lbl:"Acera / Andn exterior",luxCO:20,luxES:20,veei:null,ugr:null,ra:20,cat:"Exterior"},{id:"ext_parqueo",lbl:"Parqueadero exterior",luxCO:50,luxES:50,veei:null,ugr:null,ra:20,cat:"Exterior"}],ts=[{id:"panel_40w",lbl:"Panel LED 6060  40W",w:40,lm:4e3,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"panel_36w",lbl:"Panel LED 6060  36W",w:36,lm:3600,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"panel_24w",lbl:"Panel LED 3030  24W",w:24,lm:2400,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"down_18w",lbl:"Downlight LED 20  18W",w:18,lm:1800,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"down_12w",lbl:"Downlight LED 15  12W",w:12,lm:1200,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"down_9w",lbl:"Downlight LED 12  9W",w:9,lm:900,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"tubo_18w",lbl:"Tubo LED T8 120cm  18W",w:18,lm:2e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"tubo_9w",lbl:"Tubo LED T8 60cm  9W",w:9,lm:1e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"regleta_36w",lbl:"Regleta 2T8 LED  36W",w:36,lm:4e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"campana_100w",lbl:"Campana LED industrial  100W",w:100,lm:13e3,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"campana_150w",lbl:"Campana LED industrial  150W",w:150,lm:2e4,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"campana_200w",lbl:"Campana LED industrial  200W",w:200,lm:26e3,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"aplique_12w",lbl:"Aplique de pared  12W",w:12,lm:1e3,tipo:"Aplique",temp:"3000K",vida:3e4,irc:80},{id:"plafon_24w",lbl:"Plafn LED 30  24W",w:24,lm:2200,tipo:"Adosado",temp:"4000K",vida:4e4,irc:80},{id:"plafon_18w",lbl:"Plafn LED 25  18W",w:18,lm:1600,tipo:"Adosado",temp:"4000K",vida:4e4,irc:80},{id:"spot_9w",lbl:"Spot LED GU10  9W",w:9,lm:800,tipo:"Spot",temp:"3000K",vida:25e3,irc:80},{id:"lineal_20w",lbl:"Perfil lineal LED  20W/m",w:20,lm:2200,tipo:"Lineal",temp:"4000K",vida:5e4,irc:90}];function Jl(t,i,o){const n=Math.min(.95,.25+.35*Math.log10(1+t)),a=1+(i-.5)*.15+(o-.3)*.1;return Math.min(.9,Math.max(.2,n*a))}function Mf({pais:t}){const[i,o]=F.useState(!1),[n,a]=F.useState("oficina_gral"),[r,s]=F.useState("5"),[g,h]=F.useState("4"),[b,j]=F.useState("2.8"),[k,v]=F.useState("0.85"),[m,f]=F.useState("0"),[p,d]=F.useState("0.7"),[c,l]=F.useState("0.5"),[x,y]=F.useState("0.2"),[u,S]=F.useState("panel_40w"),[A,E]=F.useState("0.8"),w=es.find(K=>K.id===n),_=ts.find(K=>K.id===u),z=F.useMemo(()=>{if(!w||!_)return null;const K=+r,P=+g,te=+b,he=+k,Q=+m,Se=+A;if(K<=0||P<=0||te<=0)return null;const ae=t==="CO"?w.luxCO:w.luxES,U=K*P,M=te-he-Q;if(M<=0)return null;const B=K*P/(M*(K+P)),H=Jl(B,+p,+c),ee=ae*U/(H*Se),D=Math.ceil(ee/_.lm),O=Math.max(1,D),le=K/P;let re=Math.round(Math.sqrt(O/le)),de=Math.ceil(O/Math.max(1,re));re<1&&(re=1),de*re<O&&de++;const G=de*re,ce=G*_.lm*H*Se/U,V=K/de,Y=P/re,W=G*_.w,se=W/U,ge=ce>0?W*100/(U*ce):0,ue=Math.min(.95,.4+.3*H+.1*(B>2?1:B/2)),ye=ce>=ae,be=w.veei?ge<=w.veei:!0,I=_.irc>=w.ra,N=ue>=.6,q=Math.max(V,Y)<=1.5*M;return{luxReq:ae,S:U,h:M,K:B,CU:H,flujoTotal:ee,nCalc:O,nReal:G,rows:de,cols:re,luxReal:ce,distL:V,distA:Y,potTotal:W,dpea:se,veei:ge,unifEst:ue,luxOk:ye,veeiOk:be,ircOk:I,unifOk:N,distMaxOk:q,allOk:ye&&be&&I&&N&&q}},[n,r,g,b,k,m,p,c,A,u,t,w,_]),T=F.useMemo(()=>{if(!w)return[];const K=+r,P=+g,te=+b,he=+k,Q=+m,Se=+A;if(K<=0||P<=0||te<=0)return[];const ae=t==="CO"?w.luxCO:w.luxES,U=K*P,M=te-he-Q;if(M<=0)return[];const B=K*P/(M*(K+P)),H=Jl(B,+p,+c),ee=[];return ts.forEach(D=>{if(D.irc<w.ra)return;const O=ae*U/(H*Se),le=Math.ceil(O/D.lm),re=Math.max(1,le),de=K/P;let G=Math.round(Math.sqrt(re/de)),ce=Math.ceil(re/Math.max(1,G));G<1&&(G=1),ce*G<re&&ce++;const V=ce*G,Y=V*D.lm*H*Se/U,W=K/ce,se=P/G,ge=V*D.w,ue=Y>0?ge*100/(U*Y):0,ye=Math.min(.95,.4+.3*H+.1*(B>2?1:B/2)),be=Y>=ae,I=w.veei?ue<=w.veei:!0,N=ye>=.6,q=Math.max(W,se)<=1.5*M;if(!(be&&I&&N&&q))return;const R=D.lm/D.w,ie=ge/U;ee.push({lumOp:D,nReal:V,rows:ce,cols:G,luxReal:Math.round(Y),potTotal:ge,dpea:ie.toFixed(1),veei:ue.toFixed(2),eficacia:R.toFixed(0),distL:W.toFixed(2),distA:se.toFixed(2)})}),ee.sort((D,O)=>D.potTotal-O.potTotal),ee.slice(0,5)},[n,r,g,b,k,m,p,c,A,t,w]),L=K=>{S(K.lumOp.id)},Z={background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:16,marginBottom:12,boxShadow:oe.shadow};return e.jsxs("div",{className:"fade-up",style:{maxWidth:1100},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsxs("button",{onClick:()=>o(!i),style:{padding:"6px 14px",border:`1px solid ${oe.border}`,borderRadius:4,background:i?oe.blueBg:"#fff",color:i?oe.blue:oe.inkLight,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" ",i?"Ocultar":"Ver"," tabla normativa  ",t==="CO"?"RETILAP":"UNE 12464-1"]}),e.jsx($a,{pais:t})]}),i&&e.jsx("div",{style:{...Z,background:oe.blueBg,maxHeight:220,overflowY:"auto",marginBottom:16},children:e.jsxs("table",{style:{width:"100%",fontSize:9},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"rgba(30,79,140,.06)"},children:["Cat.","Espacio","Lux mn (CO)","Lux mn (ES)","UGR mx","Ra mn","VEEI lm"].map(K=>e.jsx("th",{style:{padding:"4px 8px",textAlign:"left",fontWeight:700,color:oe.blue,borderBottom:`1px solid ${oe.blue}33`},children:K},K))})}),e.jsx("tbody",{children:es.map(K=>e.jsxs("tr",{style:{borderBottom:`1px solid ${oe.border}`,background:K.id===n?"rgba(30,79,140,.08)":"transparent"},children:[e.jsx("td",{style:{padding:"3px 8px",color:oe.inkLight},children:K.cat}),e.jsx("td",{style:{padding:"3px 8px",fontWeight:K.id===n?700:400},children:K.lbl}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:K.luxCO}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:K.luxES}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:K.ugr??""}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:K.ra}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:K.veei??"N/A"})]},K.id))})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:Z,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Tipo de espacio"}),e.jsx(Vi,{value:n,onChange:a,options:Object.entries(es.reduce((K,P)=>((K[P.cat]=K[P.cat]||[]).push(P),K),{})).flatMap(([K,P])=>[{v:"__"+K,l:` ${K} `},...P.map(te=>({v:te.id,l:`${te.lbl}  ${t==="CO"?te.luxCO:te.luxES} lux`}))])}),w&&e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,fontSize:9},children:[e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:oe.amberBg,color:oe.amber,fontWeight:700},children:["Req: ",t==="CO"?w.luxCO:w.luxES," lux"]}),e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:oe.accent,color:oe.inkMid},children:["UGR  ",w.ugr??""]}),e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:oe.accent,color:oe.inkMid},children:["Ra  ",w.ra]}),w.veei&&e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:oe.accent,color:oe.inkMid},children:["VEEI  ",w.veei]})]})]}),e.jsxs("div",{style:Z,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Dimensiones (m)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[e.jsx(Rt,{label:"Largo",value:r,onChange:s,step:"0.1",min:"0.1"}),e.jsx(Rt,{label:"Ancho",value:g,onChange:h,step:"0.1",min:"0.1"}),e.jsx(Rt,{label:"Alto total",value:b,onChange:j,step:"0.1",min:"0.5"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Rt,{label:"Plano de trabajo",value:k,onChange:v,step:"0.05",unit:"m"}),e.jsx(Rt,{label:"Suspensin luminaria",value:m,onChange:f,step:"0.05",unit:"m"})]})]}),e.jsxs("div",{style:Z,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Reflectancias"}),[["Techo",p,d],["Paredes",c,l],["Suelo",x,y]].map(([K,P,te])=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx("span",{style:{fontSize:10,width:55,fontWeight:500},children:K}),e.jsx("input",{type:"range",min:.1,max:.9,step:.05,value:P,onChange:he=>te(he.target.value),style:{flex:1,accentColor:oe.blue}}),e.jsxs("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:oe.blue,minWidth:30},children:[(P*100).toFixed(0),"%"]})]},K)),e.jsx("div",{style:{fontSize:8,color:oe.inkLight},children:"Techo blanco  70%  Pared clara  50%  Suelo oscuro  20%"})]}),e.jsxs("div",{style:Z,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Luminaria"}),e.jsx(Vi,{value:u,onChange:S,options:Object.entries(ts.reduce((K,P)=>((K[P.tipo]=K[P.tipo]||[]).push(P),K),{})).flatMap(([K,P])=>[{v:"__"+K,l:` ${K} `},...P.map(te=>({v:te.id,l:`${te.lbl}  ${te.lm}lm`}))])}),_&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6,marginTop:8,fontSize:9},children:[{l:"Flujo",v:`${_.lm} lm`},{l:"Potencia",v:`${_.w} W`},{l:"Eficacia",v:`${Math.round(_.lm/_.w)} lm/W`},{l:"IRC",v:`${_.irc}`}].map(K=>e.jsxs("div",{style:{background:oe.bg,padding:"5px 8px",borderRadius:4,textAlign:"center"},children:[e.jsx("div",{className:"mono",style:{fontWeight:700,color:oe.blue},children:K.v}),e.jsx("div",{style:{color:oe.inkLight,fontSize:8},children:K.l})]},K.l))}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:9,color:oe.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Factor de mantenimiento (Cm)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"range",min:.5,max:1,step:.05,value:A,onChange:K=>E(K.target.value),style:{flex:1,accentColor:oe.blue}}),e.jsx("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:oe.blue,minWidth:24},children:A})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:8,color:oe.inkXLight},children:[e.jsx("span",{children:"Sucio 0.5"}),e.jsx("span",{children:"Limpio 1.0"})]})]})]})]}),e.jsx("div",{children:z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{...Z,background:z.allOk?oe.greenBg:oe.redBg,border:`1px solid ${z.allOk?oe.green:oe.red}33`,textAlign:"center",padding:20},children:[e.jsx("div",{style:{fontSize:28,fontWeight:800,color:z.allOk?oe.green:oe.red},children:z.allOk?" CUMPLE":" NO CUMPLE"}),e.jsx("div",{style:{fontSize:10,color:oe.inkMid,marginTop:2},children:t==="CO"?"RETILAP  Res. 181331/2009":"CTE DB-HE3 / UNE-EN 12464-1"})]}),!z.allOk&&T.length>0&&e.jsxs("div",{style:{...Z,background:"#FFFBE6",border:"1px solid #E6D44D55",padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#8C6A00",marginBottom:8},children:" Soluciones que S cumplen normativa"}),e.jsx("div",{style:{fontSize:9,color:oe.inkMid,marginBottom:8},children:'Haz clic en "Aplicar" para usar esa opcin automticamente'}),T.slice(0,3).map((K,P)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 10px",background:P===0?"#E8F4EE":"#fff",border:`1px solid ${P===0?oe.green+"44":oe.border}`,borderRadius:6,marginBottom:4},children:[P===0&&e.jsx("span",{style:{fontSize:14},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:P===0?oe.green:oe.ink},children:K.lumOp.lbl}),e.jsxs("div",{style:{fontSize:8,color:oe.inkMid},children:[K.nReal," uds (",K.rows,"",K.cols,")  ",K.luxReal," lux  ",K.potTotal,"W total  VEEI ",K.veei,"  ",K.eficacia," lm/W"]})]}),e.jsx("button",{onClick:()=>L(K),style:{padding:"4px 12px",background:P===0?oe.green:"#fff",color:P===0?"#fff":oe.blue,border:P===0?"none":`1px solid ${oe.blue}`,borderRadius:4,fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap"},children:"Aplicar"})]},K.lumOp.id))]}),z.allOk&&T.length>1&&e.jsxs("div",{style:{...Z,background:oe.blueBg,border:`1px solid ${oe.blue}22`,padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:oe.blue,marginBottom:6},children:" Se puede optimizar?"}),T.filter(K=>K.lumOp.id!==u).slice(0,2).map(K=>{const P=z.potTotal-K.potTotal;return P>0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",background:"#fff",border:`1px solid ${oe.border}`,borderRadius:5,marginBottom:3},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600},children:K.lumOp.lbl}),e.jsxs("div",{style:{fontSize:8,color:oe.inkMid},children:[K.nReal," uds  ",K.luxReal," lux  ",K.potTotal,"W",e.jsxs("span",{style:{color:oe.green,fontWeight:700,marginLeft:4},children:[" Ahorra ",P,"W"]})]})]}),e.jsx("button",{onClick:()=>L(K),style:{padding:"3px 10px",background:"#fff",color:oe.blue,border:`1px solid ${oe.blue}`,borderRadius:3,fontSize:8,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cambiar"})]},K.lumOp.id):null})]}),!z.allOk&&T.length===0&&e.jsxs("div",{style:{...Z,background:oe.redBg,border:`1px solid ${oe.red}33`,padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:oe.red,marginBottom:4},children:" Ninguna luminaria del catlogo cumple"}),e.jsx("div",{style:{fontSize:9,color:oe.inkMid},children:"Prueba a: aumentar reflectancias, reducir altura de suspensin, o el espacio requiere una luminaria de mayor flujo no incluida en el catlogo."})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:12},children:[{l:"Luminarias",v:z.nReal,u:`${z.rows}${z.cols}`,ok:!0},{l:"Iluminacin",v:Math.round(z.luxReal),u:`lux (req: ${z.luxReq})`,ok:z.luxOk},{l:"Potencia total",v:z.potTotal,u:"W",ok:!0},{l:"DPEA",v:z.dpea.toFixed(1),u:"W/m",ok:!0},{l:"VEEI",v:z.veei.toFixed(2),u:`W/m100lx${w!=null&&w.veei?` (lm: ${w.veei})`:""}`,ok:z.veeiOk},{l:"Superficie",v:z.S.toFixed(1),u:"m",ok:!0}].map(K=>e.jsxs("div",{style:{background:oe.surface,border:`1px solid ${K.ok?oe.border:oe.red}`,borderRadius:6,padding:"10px 12px",boxShadow:oe.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:K.ok?oe.inkLight:oe.red,textTransform:"uppercase",letterSpacing:.5},children:K.l}),e.jsx("div",{className:"mono",style:{fontSize:20,fontWeight:800,color:K.ok?oe.ink:oe.red,marginTop:2},children:K.v}),e.jsx("div",{style:{fontSize:8,color:oe.inkLight},children:K.u})]},K.l))}),e.jsxs("div",{style:Z,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Verificaciones normativas"}),[{l:`Iluminacin  ${z.luxReq} lux`,v:`${Math.round(z.luxReal)} lux`,ok:z.luxOk},{l:`VEEI  ${(w==null?void 0:w.veei)??"N/A"}`,v:w!=null&&w.veei?z.veei.toFixed(2):"N/A",ok:z.veeiOk},{l:`IRC  ${w==null?void 0:w.ra}`,v:`${_==null?void 0:_.irc}`,ok:z.ircOk},{l:"Uniformidad  0.6",v:z.unifEst.toFixed(2),ok:z.unifOk},{l:`Dist. luminarias  ${(1.5*z.h).toFixed(2)}m`,v:`${Math.max(z.distL,z.distA).toFixed(2)}m`,ok:z.distMaxOk}].map(K=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"5px 0",borderBottom:`1px solid ${oe.accent}`},children:[e.jsx("span",{style:{fontSize:13},children:K.ok?"":""}),e.jsx("span",{style:{flex:1,fontSize:10,fontWeight:500},children:K.l}),e.jsx("span",{className:"mono",style:{fontSize:10,fontWeight:700,color:K.ok?oe.green:oe.red},children:K.v})]},K.l))]}),e.jsxs("div",{style:Z,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Memoria de clculo"}),e.jsx("div",{style:{fontSize:9,lineHeight:2,color:oe.inkMid},children:[["Superficie (S)",`${r}  ${g} = ${z.S.toFixed(1)} m`],["Altura til (h)",`${b}  ${k}  ${m} = ${z.h.toFixed(2)} m`],["ndice local (K)",`(${r}${g}) / (${z.h.toFixed(2)}(${r}+${g})) = ${z.K.toFixed(2)}`],["Coef. utilizacin",`CU = ${z.CU.toFixed(3)} (t=${(p*100).toFixed(0)}%, p=${(c*100).toFixed(0)}%)`],["Flujo necesario",`(${z.luxReq}${z.S.toFixed(1)})/(${z.CU.toFixed(3)}${A}) = ${Math.round(z.flujoTotal).toLocaleString()} lm`],["N luminarias",`${Math.round(z.flujoTotal).toLocaleString()} / ${_.lm.toLocaleString()}  ${z.nCalc}  ${z.nReal} ud (${z.rows}${z.cols})`],["Separacin",`Largo: ${z.distL.toFixed(2)}m  Ancho: ${z.distA.toFixed(2)}m`]].map(([K,P])=>e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("span",{style:{fontWeight:700,color:oe.ink,minWidth:130},children:[K,":"]}),e.jsx("span",{className:"mono",style:{fontWeight:500},children:P})]},K))})]}),e.jsxs("div",{style:Z,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Disposicin en planta"}),e.jsxs("div",{style:{position:"relative",background:oe.bg,border:`2px solid ${oe.border}`,borderRadius:4,width:"100%",aspectRatio:`${r}/${g}`,maxHeight:200,overflow:"hidden"},children:[e.jsxs("div",{style:{position:"absolute",top:2,left:"50%",transform:"translateX(-50%)",fontSize:8,color:oe.inkLight},className:"mono",children:[r,"m"]}),e.jsxs("div",{style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%) rotate(90deg)",fontSize:8,color:oe.inkLight},className:"mono",children:[g,"m"]}),Array.from({length:z.rows},(K,P)=>Array.from({length:z.cols},(te,he)=>{const Q=(he+.5)/z.cols*100,Se=(P+.5)/z.rows*100;return e.jsx("div",{style:{position:"absolute",left:`${Q}%`,top:`${Se}%`,transform:"translate(-50%,-50%)",width:12,height:12,borderRadius:"50%",background:"radial-gradient(circle,#FFD600 30%,#FFD60044 100%)",border:"2px solid #FFC107",boxShadow:"0 0 6px #FFD60055"}},`${P}-${he}`)}))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:16,marginTop:6,fontSize:8,color:oe.inkLight},children:[e.jsxs("span",{children:[z.rows,"",z.cols," = ",z.nReal," luminarias"]}),e.jsxs("span",{children:["Sep: ",z.distL.toFixed(2),"m  ",z.distA.toFixed(2),"m"]})]})]})]}):e.jsxs("div",{style:{...Z,textAlign:"center",padding:40,color:oe.inkLight},children:[e.jsx(zd,{size:32,style:{opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600},children:"Completa los datos para ver el clculo"})]})})]})]})}function Df(){const[t,i]=F.useState("longitud"),[o,n]=F.useState("m"),[a,r]=F.useState("ft"),[s,g]=F.useState(""),h={longitud:{l:"Longitud",u:{m:1,cm:.01,mm:.001,km:1e3,ft:.3048,in:.0254,yd:.9144}},area:{l:"rea",u:{"m":1,"cm":1e-4,"km":1e6,"ft":.092903,"in":64516e-8,ha:1e4,ac:4046.86}},volumen:{l:"Volumen",u:{"m":1,"cm":1e-6,l:.001,ml:1e-6,gal:.00378541,"ft":.0283168}},peso:{l:"Masa",u:{kg:1,g:.001,t:1e3,lb:.453592,oz:.0283495}},temperatura:{l:"Temperatura",special:!0},presion:{l:"Presin",u:{Pa:1,kPa:1e3,MPa:1e6,"kgf/cm":98066.5,PSI:6894.76,bar:1e5}}},b=h[t],j=b!=null&&b.u?Object.keys(b.u):["C","F","K"],k=(f,p,d)=>{let c;return p==="C"?c=f:p==="F"?c=(f-32)*5/9:c=f-273.15,d==="C"?c:d==="F"?c*9/5+32:c+273.15},v=F.useMemo(()=>{const f=Number(s);if(isNaN(f)||!s)return null;if(t==="temperatura")return k(f,o,a).toFixed(4);const p=(b==null?void 0:b.u)||{};return!p[o]||!p[a]?null:(f*p[o]/p[a]).toFixed(8).replace(/\.?0+$/,"")},[s,o,a,t]),m=f=>{var d;i(f);const p=(d=h[f])!=null&&d.u?Object.keys(h[f].u):["C","F","K"];n(p[0]||""),r(p[1]||""),g("")};return e.jsxs("div",{className:"fade-up",style:{maxWidth:620},children:[e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:16},children:Object.entries(h).map(([f,p])=>e.jsx("button",{onClick:()=>m(f),style:{padding:"6px 14px",border:`1px solid ${t===f?oe.ink:oe.border}`,borderRadius:20,background:t===f?oe.ink:"transparent",color:t===f?"#fff":oe.inkMid,fontSize:11,fontWeight:t===f?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:p.l},f))}),e.jsxs("div",{style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"24px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 50px 1fr",gap:10,alignItems:"end",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:oe.inkLight,textTransform:"uppercase",letterSpacing:.8,fontWeight:700,marginBottom:5},children:"De"}),e.jsx("select",{value:o,onChange:f=>n(f.target.value),style:{width:"100%",padding:"9px 10px",border:`1.5px solid ${oe.border}`,borderRadius:4,fontSize:12,background:oe.surface},children:j.map(f=>e.jsx("option",{children:f},f))})]}),e.jsx("div",{style:{textAlign:"center",fontSize:18,color:oe.inkXLight,paddingBottom:4},children:""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:oe.inkLight,textTransform:"uppercase",letterSpacing:.8,fontWeight:700,marginBottom:5},children:"A"}),e.jsx("select",{value:a,onChange:f=>r(f.target.value),style:{width:"100%",padding:"9px 10px",border:`1.5px solid ${oe.border}`,borderRadius:4,fontSize:12,background:oe.surface},children:j.map(f=>e.jsx("option",{children:f},f))})]})]}),e.jsx(Rt,{label:"Valor",value:s,onChange:g,placeholder:"Ingresa el valor..."}),v!==null?e.jsxs("div",{style:{background:oe.ink,borderRadius:6,padding:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:"rgba(255,255,255,.4)",marginBottom:6},children:[s," ",o," ="]}),e.jsx("div",{className:"mono",style:{fontSize:28,fontWeight:800,color:"#fff"},children:v}),e.jsx("div",{style:{fontSize:14,color:"rgba(255,255,255,.4)",marginTop:4},children:a})]}):e.jsx("div",{style:{textAlign:"center",padding:"20px 0",color:oe.inkXLight,fontSize:12},children:"Ingresa un valor"})]})]})}function $f(){var r,s;const[t,i]=F.useState("dashboard"),[o,n]=mn("hab:config:pais","CO"),a=Go[o];return e.jsxs(e.Fragment,{children:[e.jsx(Af,{}),e.jsxs("div",{style:{minHeight:"100vh",background:oe.bg,fontFamily:"'DM Sans',sans-serif"},children:[e.jsxs("div",{style:{background:oe.ink,padding:"14px 28px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:800,letterSpacing:2,textTransform:"uppercase",color:"#fff"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,.3)",letterSpacing:1},children:"Herramientas Tcnicas"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.4)"},children:"Normativa:"}),e.jsx("div",{style:{display:"flex",background:"rgba(255,255,255,.08)",borderRadius:4,overflow:"hidden",border:"1px solid rgba(255,255,255,.12)"},children:["CO","ES"].map(g=>e.jsxs("button",{onClick:()=>n(g),style:{padding:"6px 14px",border:"none",background:o===g?"#fff":"transparent",color:o===g?oe.ink:"rgba(255,255,255,.5)",fontSize:11,fontWeight:o===g?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:5,transition:"all .12s"},children:[e.jsx("span",{style:{fontSize:13},children:g==="CO"?"":""}),g==="CO"?"Colombia":"Espaa"]},g))}),e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.35)"},children:a.ref})]})]}),e.jsx("div",{style:{background:oe.surface,borderBottom:`1px solid ${oe.border}`,display:"flex",overflowX:"auto",scrollbarWidth:"none",paddingLeft:16},children:Ur.map(g=>{const h=t===g.id;return e.jsxs("button",{onClick:()=>i(g.id),style:{display:"flex",alignItems:"center",gap:6,padding:"12px 16px",border:"none",background:"transparent",flexShrink:0,borderBottom:h?`2px solid ${oe.ink}`:"2px solid transparent",color:h?oe.ink:oe.inkLight,fontSize:11,fontWeight:h?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",letterSpacing:.2,transition:"color .1s"},children:[e.jsx(g.I,{size:12}),g.label]},g.id)})}),e.jsxs("div",{style:{padding:"24px 28px 60px"},children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:18,fontWeight:800,color:oe.ink,letterSpacing:-.2},children:(r=Ur.find(g=>g.id===t))==null?void 0:r.label}),e.jsx("p",{style:{fontSize:11,color:oe.inkLight,marginTop:2},children:(s=Ur.find(g=>g.id===t))==null?void 0:s.desc})]}),e.jsx($a,{pais:o})]}),t==="dashboard"&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:14},children:Ur.filter(g=>g.id!=="dashboard").map(g=>e.jsxs("div",{onClick:()=>i(g.id),style:{background:oe.surface,border:`1px solid ${oe.border}`,borderRadius:8,padding:"20px 18px",cursor:"pointer",boxShadow:oe.shadow,transition:"all .15s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx(g.I,{size:18,color:oe.ink}),e.jsx("div",{style:{fontSize:14,fontWeight:700},children:g.label})]}),e.jsx("div",{style:{fontSize:10,color:oe.inkLight,lineHeight:1.5},children:g.desc})]},g.id))}),t==="cuadro"&&e.jsx(Tf,{pais:o}),t==="circuito"&&e.jsx(Bf,{pais:o}),t==="iluminacion"&&e.jsx(Mf,{pais:o}),t==="concreto"&&e.jsx(If,{}),t==="cubicacion"&&e.jsx(Rf,{}),t==="materiales"&&e.jsx(_f,{}),t==="unidades"&&e.jsx(Df,{})]})]})]})}const _e={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",border:"#E0E0E0",borderMid:"#D5D2CC",accent:"#EDEBE7",accentBg:"#FFFFFF",success:"#111111",successBg:"#E8F4EE",warning:"#8C6A00",warningBg:"#FFF8E7",danger:"#B91C1C",dangerBg:"#FAE8E8",info:"#3B3B3B",infoBg:"#F0F0F0",sidebar:"#111",sidebarHover:"#222"},Yl=()=>Math.random().toString(36).slice(2,11)+Date.now().toString(36),is=()=>new Date().toISOString().split("T")[0],on={items:"hab:logistica:items",proveedores:"hab:logistica:proveedores",cotizaciones:"hab:logistica:cotizaciones"},ho=[{id:"epp",label:"EPPs",icon:"",color:"#B91C1C",desc:"Elementos de proteccin personal"},{id:"dotacion",label:"Dotaciones",icon:"",color:"#5B3A8C",desc:"Uniformes, chalecos, calzado de dotacin"},{id:"herr_menor",label:"Herramienta menor",icon:"",color:"#8C6A00",desc:"Martillos, niveles, flexmetros, paletas, llanas"},{id:"herr_mayor",label:"Herramienta mayor",icon:"",color:"#3B3B3B",desc:"Taladros, pulidoras, cortadoras, mezcladoras"},{id:"equipo_obra",label:"Equipos de obra",icon:"",color:"#0D5E6E",desc:"Andamios, escaleras, formaletas, compresores"},{id:"equipo_medic",label:"Equipos de medicin",icon:"",color:"#111111",desc:"Niveles lser, distancimetros, estaciones"},{id:"equipo_computo",label:"Equipos de cmputo",icon:"",color:"#555",desc:"PCs, porttiles, tablets, monitores"},{id:"consumible",label:"Consumibles",icon:"",color:"#7C3A1E",desc:"Discos de corte, brocas, lijas, cintas"},{id:"seguridad",label:"Sealizacin / Seguridad",icon:"",color:"#B91C1C",desc:"Conos, cintas, seales, extintores, botiquines"},{id:"transporte",label:"Transporte / Vehculos",icon:"",color:"#555",desc:"Vehculos, carretillas, montacargas"}],Pf=["Cabeza","Ojos y cara","Odos","Respiratorio","Manos","Pies","Cuerpo","Trabajo en alturas","Otro"],Of=["ud","par","juego","m","m","kg","l","rollo","caja","gl"],Io=({children:t,style:i})=>e.jsx("div",{style:{background:_e.surface,borderRadius:8,border:`1px solid ${_e.border}`,boxShadow:"0 1px 3px rgba(0,0,0,.04)",...i},children:t}),Ro=({children:t,on:i,sm:o,v:n,style:a,...r})=>{const s={display:"inline-flex",alignItems:"center",gap:5,border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",fontWeight:600,transition:"filter .15s",...a},g={pri:{background:_e.ink,color:"#fff",padding:o?"5px 12px":"8px 18px",fontSize:o?10:12},sec:{background:_e.accent,color:_e.ink,padding:o?"5px 12px":"8px 18px",fontSize:o?10:12,border:`1px solid ${_e.border}`},ghost:{background:"transparent",color:_e.inkMid,padding:o?"4px 8px":"6px 12px",fontSize:o?10:11},danger:{background:_e.dangerBg,color:_e.danger,padding:o?"5px 12px":"8px 18px",fontSize:o?10:12,border:`1px solid ${_e.danger}33`}};return e.jsx("button",{onClick:i,style:{...s,...g[n]||g.pri},onMouseEnter:h=>h.currentTarget.style.filter="brightness(1.1)",onMouseLeave:h=>h.currentTarget.style.filter="none",...r,children:t})},Ln=({t,s:i})=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700,color:_e.ink,margin:"0 0 2px"},children:t}),i&&e.jsx("p",{style:{fontSize:10,color:_e.inkLight,margin:"0 0 10px"},children:i})]}),Xt=({lbl:t,val:i,on:o,type:n="text",ph:a,style:r})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:_e.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:t}),e.jsx("input",{type:n,value:i||"",onChange:o,placeholder:a,style:{width:"100%",padding:"6px 10px",border:`1px solid ${_e.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:_e.bg,color:_e.ink}})]});function Lf(){var U;const[t,i]=F.useState([]),[o,n]=F.useState([]),[a,r]=F.useState({}),[s,g]=F.useState(!1);F.useEffect(()=>{(async()=>{const[M,B,H]=await Promise.all([Ee.get(on.items),Ee.get(on.proveedores),Ee.get(on.cotizaciones)]);M&&i(M),B&&n(B),H&&r(H),g(!0)})()},[]);const h=F.useCallback(M=>{const B=typeof M=="function"?M(t):M;i(B),Ee.set(on.items,B)},[t]),b=F.useCallback(M=>{const B=typeof M=="function"?M(o):M;n(B),Ee.set(on.proveedores,B)},[o]),j=F.useCallback(M=>{const B=typeof M=="function"?M(a):M;r(B),Ee.set(on.cotizaciones,B)},[a]),[k,v]=F.useState("dashboard"),[m,f]=F.useState("todos"),[p,d]=F.useState(""),[c,l]=F.useState(null),[x,y]=F.useState(null),[u,S]=F.useState(!1);F.useState(!1);const A=M=>M?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(M):"",E=F.useMemo(()=>{let M=t;if(m!=="todos"&&(M=M.filter(B=>B.familia===m)),p){const B=p.toLowerCase();M=M.filter(H=>(H.nombre||"").toLowerCase().includes(B)||(H.referencia||"").toLowerCase().includes(B))}return M},[t,m,p]),w=F.useMemo(()=>{const M={};return ho.forEach(B=>M[B.id]={count:0,valor:0}),t.forEach(B=>{M[B.familia]&&(M[B.familia].count++,M[B.familia].valor+=(B.precio||0)*(B.stockActual||0))}),{total:t.length,byFam:M,provs:o.length,valorTotal:t.reduce((B,H)=>B+(H.precio||0)*(H.stockActual||0),0)}},[t,o]),_=(M="epp")=>({id:Yl(),nombre:"",familia:M,subfamilia:"",referencia:"",marca:"",unidad:"ud",precio:0,proveedorId:"",vidaUtil:12,reposicionMeses:12,stockMinimo:0,stockActual:0,asociadoACargo:!1,cargosAsociados:[],notas:"",activo:!0,fechaCreacion:is()}),z=()=>({id:Yl(),nombre:"",nit:"",contacto:"",telefono:"",email:"",ciudad:"",especialidad:"",notas:"",activo:!0}),T=M=>{h(B=>B.find(ee=>ee.id===M.id)?B.map(ee=>ee.id===M.id?M:ee):[...B,M]),l(null),S(!1)},L=M=>h(B=>B.filter(H=>H.id!==M)),Z=M=>{b(B=>B.find(ee=>ee.id===M.id)?B.map(ee=>ee.id===M.id?M:ee):[...B,M]),y(null)},K=M=>b(B=>B.filter(H=>H.id!==M)),P=(M,B,H)=>{j(ee=>{const D={...ee};return D[M]||(D[M]={}),D[M][B]={precio:+H,fecha:is()},D})},te=(M,B)=>{var H;return((H=a[M])==null?void 0:H[B])||{}},he=M=>{const B=a[M]||{};let H=null,ee=1/0;return Object.entries(B).forEach(([D,O])=>{O.precio>0&&O.precio<ee&&(ee=O.precio,H=D)}),H},[Q,Se]=F.useState([]);F.useEffect(()=>{(()=>{try{const M=Ee.getSync("hab:rrhh:cargos");M&&Se(JSON.parse(M)||[])}catch{}})()},[]);const ae=()=>{const M=["Familia","Nombre","Referencia","Marca","Unidad","Precio","Stock","Vida til (meses)","Proveedor"],B=t.map(le=>{var de;const re=o.find(G=>G.id===le.proveedorId);return[((de=ho.find(G=>G.id===le.familia))==null?void 0:de.label)||le.familia,le.nombre,le.referencia,le.marca,le.unidad,le.precio,le.stockActual,le.vidaUtil,(re==null?void 0:re.nombre)||""]}),H="\uFEFF"+[M,...B].map(le=>le.map(re=>`"${re}"`).join(",")).join(`
`),ee=new Blob([H],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(ee),O=document.createElement("a");O.href=D,O.download="logistica_inventario.csv",O.click(),URL.revokeObjectURL(D)};return s?e.jsxs("div",{style:{minHeight:"100vh",background:_e.bg},children:[e.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
        *, *::before, *::after { box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: ${_e.ink} !important; }
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-thumb { background: ${_e.border}; border-radius: 2px; }
        @keyframes fadeUp { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:none; } }
        .fade { animation: fadeUp .15s ease both; }
      `}),e.jsxs("div",{style:{maxWidth:1400,margin:"0 auto",padding:"20px 24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",color:_e.inkLight,margin:"0 0 3px"},children:"Logstica y recursos"}),e.jsx("h1",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:24,fontWeight:800,color:_e.ink,margin:0},children:"Almacn  EPPs  Herramientas  Equipos"})]}),e.jsx("div",{style:{display:"flex",gap:8},children:e.jsxs(Ro,{sm:!0,v:"sec",on:ae,children:[e.jsx(Eo,{size:12})," Exportar CSV"]})})]}),e.jsx("div",{style:{display:"flex",borderBottom:`1px solid ${_e.border}`,marginBottom:20},children:[{id:"dashboard",lbl:"Dashboard"},{id:"inventario",lbl:"Inventario"},{id:"proveedores",lbl:"Proveedores"},{id:"comparativo",lbl:"Comparativo precios"},{id:"compras",lbl:"Lista de compra"}].map(M=>e.jsx("button",{onClick:()=>v(M.id),style:{padding:"10px 16px",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:600,letterSpacing:1,textTransform:"uppercase",background:"transparent",color:k===M.id?_e.ink:_e.inkLight,borderBottom:k===M.id?`2px solid ${_e.ink}`:"2px solid transparent",transition:"all .15s",marginBottom:-1},children:M.lbl},M.id))}),k==="dashboard"&&e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" tems inventario",t.length,"#111"],[" Proveedores",o.length,"#3B3B3B"],[" Stock bajo",t.filter(M=>M.stockActual<=M.stockMinimo).length,t.filter(M=>M.stockActual<=M.stockMinimo).length>0?"#B91C1C":"#111111"],[" Valor inventario","$"+A(t.reduce((M,B)=>M+(B.stockActual||0)*(B.precioRef||0),0)),"#111"]].map(([M,B,H])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${_e.border}`,borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:M}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:H},children:B})]},M))}),t.filter(M=>M.stockActual<=M.stockMinimo).length>0&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" Stock bajo: ",t.filter(M=>M.stockActual<=M.stockMinimo).map(M=>M.nombre).join(", ")]})]}),k==="inventario"&&e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"flex",gap:8,marginBottom:14,flexWrap:"wrap"},children:ho.map(M=>{var B;return e.jsxs("button",{onClick:()=>f(m===M.id?"todos":M.id),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 12px",border:`1px solid ${m===M.id?M.color:_e.border}`,borderRadius:6,background:m===M.id?M.color+"15":"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",transition:"all .1s"},children:[e.jsx("span",{style:{fontSize:16},children:M.icon}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:m===M.id?M.color:_e.inkMid},children:M.label}),e.jsx("div",{style:{fontSize:13,fontWeight:700,color:_e.ink},children:((B=w.byFam[M.id])==null?void 0:B.count)||0})]})]},M.id)})}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(Ci,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:_e.inkLight}}),e.jsx("input",{value:p,onChange:M=>d(M.target.value),placeholder:"Buscar por nombre o referencia...",style:{width:"100%",padding:"8px 8px 8px 32px",border:`1px solid ${_e.border}`,borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:"#fff"}})]}),e.jsxs(Ro,{on:()=>{l(_(m==="todos"?"epp":m)),S(!0)},children:[e.jsx(Oe,{size:12})," Nuevo tem"]})]}),e.jsx(Io,{style:{padding:0,overflow:"hidden"},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:900},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["","Nombre","Ref/Marca","Familia","Unid","Precio","Stock","Vida til","Proveedor",""].map((M,B)=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:`2px solid ${_e.border}`,textAlign:B>=4?"center":"left"},children:M},B))})}),e.jsxs("tbody",{children:[E.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:10,style:{padding:32,textAlign:"center",color:_e.inkLight,fontSize:13},children:["Sin tems",m!=="todos"?` en ${(U=ho.find(M=>M.id===m))==null?void 0:U.label}`:"","."]})}),E.map((M,B)=>{const H=ho.find(D=>D.id===M.familia),ee=o.find(D=>D.id===M.proveedorId);return e.jsxs("tr",{style:{background:B%2===0?"#fff":"#FFFFFF",borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"5px 6px",fontSize:16,textAlign:"center"},children:(H==null?void 0:H.icon)||""}),e.jsxs("td",{style:{padding:"5px 8px"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,color:_e.ink},children:M.nombre||"Sin nombre"}),M.notas&&e.jsx("div",{style:{fontSize:9,color:_e.inkLight,marginTop:1},children:M.notas})]}),e.jsxs("td",{style:{padding:"5px 8px"},children:[e.jsx("div",{style:{fontSize:10,color:_e.inkMid},children:M.referencia||""}),e.jsx("div",{style:{fontSize:9,color:_e.inkLight},children:M.marca||""})]}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("span",{style:{fontSize:9,fontWeight:600,color:(H==null?void 0:H.color)||_e.inkMid,background:(H==null?void 0:H.color)+"15",padding:"2px 6px",borderRadius:3},children:(H==null?void 0:H.label)||M.familia})}),e.jsx("td",{style:{padding:"5px 6px",textAlign:"center",fontSize:10},children:M.unidad}),e.jsx("td",{style:{padding:"5px 6px",textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:600},children:A(M.precio)}),e.jsxs("td",{style:{padding:"5px 6px",textAlign:"center"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:600,color:M.stockActual<=M.stockMinimo?_e.danger:_e.ink},children:M.stockActual||0}),M.stockMinimo>0&&M.stockActual<=M.stockMinimo&&e.jsx("span",{style:{fontSize:8,color:_e.danger,display:"block"},children:" bajo"})]}),e.jsxs("td",{style:{padding:"5px 6px",textAlign:"center",fontSize:10,color:_e.inkMid},children:[M.vidaUtil||""," meses"]}),e.jsx("td",{style:{padding:"5px 8px",fontSize:10},children:(ee==null?void 0:ee.nombre)||""}),e.jsxs("td",{style:{padding:"5px 4px",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>{l({...M}),S(!0)},style:{background:"none",border:"none",cursor:"pointer",color:_e.inkLight,padding:3},children:e.jsx(ro,{size:12})}),e.jsx("button",{onClick:()=>L(M.id),style:{background:"none",border:"none",cursor:"pointer",color:_e.danger,padding:3},children:e.jsx(He,{size:12})})]})]},M.id)})]})]})})})]}),k==="proveedores"&&e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx(Ln,{t:`${o.length} proveedores registrados`,s:"Gestin de proveedores para cotizaciones"}),e.jsxs(Ro,{on:()=>y(z()),children:[e.jsx(Oe,{size:12})," Nuevo proveedor"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:12},children:[o.map(M=>e.jsxs(Io,{style:{padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:_e.ink},children:M.nombre}),e.jsxs("div",{style:{fontSize:10,color:_e.inkMid,marginTop:2},children:[M.nit&&`NIT: ${M.nit}  `,M.ciudad||""]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>y({...M}),style:{background:"none",border:"none",cursor:"pointer",color:_e.inkLight,padding:3},children:e.jsx(ro,{size:12})}),e.jsx("button",{onClick:()=>K(M.id),style:{background:"none",border:"none",cursor:"pointer",color:_e.danger,padding:3},children:e.jsx(He,{size:12})})]})]}),M.contacto&&e.jsxs("div",{style:{fontSize:11,marginTop:6},children:[" ",M.contacto]}),M.telefono&&e.jsxs("div",{style:{fontSize:11,color:_e.inkMid},children:[" ",M.telefono]}),M.email&&e.jsxs("div",{style:{fontSize:11,color:_e.inkMid},children:[" ",M.email]}),M.especialidad&&e.jsx("div",{style:{fontSize:10,color:_e.info,marginTop:4,fontWeight:600},children:M.especialidad})]},M.id)),o.length===0&&e.jsxs(Io,{style:{padding:32,textAlign:"center",gridColumn:"1/-1"},children:[e.jsx(qc,{size:28,style:{color:_e.inkLight,opacity:.3,marginBottom:8}}),e.jsx("p",{style:{color:_e.inkLight,fontSize:13},children:"Sin proveedores. Aade el primero."})]})]})]}),k==="comparativo"&&e.jsxs("div",{className:"fade",children:[e.jsx(Ln,{t:"Comparativo de precios por proveedor",s:"Ingresa precios de cada proveedor para comparar"}),o.length===0?e.jsx(Io,{style:{padding:32,textAlign:"center"},children:e.jsx("p",{style:{color:_e.inkLight},children:"Primero aade proveedores en la pestaa Proveedores."})}):e.jsx(Io,{style:{padding:0,overflow:"hidden",marginTop:12},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:500+o.length*120},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${_e.border}`,textAlign:"left",position:"sticky",left:0,background:"#EDEBE7",zIndex:2,minWidth:50},children:"#"}),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${_e.border}`,textAlign:"left",position:"sticky",left:50,background:"#EDEBE7",zIndex:2,minWidth:180},children:"TEM"}),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${_e.border}`,textAlign:"center",width:50},children:"UND"}),o.map(M=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,textTransform:"uppercase",borderBottom:`2px solid ${_e.border}`,textAlign:"center",minWidth:110,color:_e.info,background:_e.infoBg},children:M.nombre},M.id)),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:_e.success,textTransform:"uppercase",borderBottom:`2px solid ${_e.border}`,textAlign:"center",width:100,background:_e.successBg},children:"MEJOR"})]})}),e.jsx("tbody",{children:t.map((M,B)=>{const H=he(M.id),ee=H?te(M.id,H):{},D=ho.find(O=>O.id===M.familia);return e.jsxs("tr",{style:{background:B%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${_e.border}`},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,color:"#999",position:"sticky",left:0,background:B%2===0?"#fff":"#FFFFFF",zIndex:1},children:B+1}),e.jsx("td",{style:{padding:"4px 8px",position:"sticky",left:50,background:B%2===0?"#fff":"#FFFFFF",zIndex:1},children:e.jsxs("span",{style:{fontSize:11,fontWeight:500},children:[D==null?void 0:D.icon," ",M.nombre]})}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontSize:10,color:_e.inkMid},children:M.unidad}),o.map(O=>{const le=te(M.id,O.id),re=H===O.id&&le.precio>0;return e.jsx("td",{style:{padding:"3px 4px",textAlign:"center",background:re?_e.successBg:"transparent",borderLeft:`1px solid ${_e.border}`},children:e.jsx("input",{type:"number",value:le.precio||"",placeholder:"",onChange:de=>P(M.id,O.id,de.target.value),style:{border:`1px solid ${re?_e.success:_e.border}`,borderRadius:3,padding:"3px 5px",fontSize:10,fontFamily:"'DM Mono',monospace",width:85,textAlign:"right",background:re?"#D4EDDA":"#fff",fontWeight:re?700:400}})},O.id)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700,color:_e.success,background:_e.successBg},children:ee.precio>0?A(ee.precio):""})]},M.id)})})]})})})]}),k==="compras"&&e.jsxs("div",{className:"fade",children:[e.jsx(Ln,{t:"Lista de compra",s:"tems con stock bajo o sin stock, agrupados por proveedor"}),(()=>{const M=t.filter(H=>H.stockActual<=(H.stockMinimo||0));if(M.length===0)return e.jsxs(Io,{style:{padding:32,textAlign:"center",marginTop:12},children:[e.jsx(Tn,{size:28,style:{color:_e.inkLight,opacity:.3,marginBottom:8}}),e.jsx("p",{style:{color:_e.inkLight},children:"No hay tems con stock bajo. Define stock mnimo en cada tem para activar alertas."})]});const B={};return M.forEach(H=>{const ee=he(H.id)||H.proveedorId||"sin_prov";B[ee]||(B[ee]=[]),B[ee].push(H)}),e.jsx("div",{style:{display:"grid",gap:12,marginTop:12},children:Object.entries(B).map(([H,ee])=>{const D=o.find(O=>O.id===H);return e.jsxs(Io,{style:{padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[" ",(D==null?void 0:D.nombre)||"Sin proveedor asignado"]}),(D==null?void 0:D.telefono)&&e.jsxs("div",{style:{fontSize:10,color:_e.inkMid},children:[D.telefono,"  ",D.email||""]})]}),e.jsxs("span",{style:{fontSize:11,fontWeight:600,color:_e.danger},children:[ee.length," tem",ee.length!==1?"s":""]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${_e.border}`},children:[e.jsx("th",{style:{padding:"4px 6px",textAlign:"left",fontSize:9,color:"#888",fontWeight:700},children:"TEM"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:50},children:"UND"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:60},children:"STOCK"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:60},children:"MN"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:_e.danger,fontWeight:700,width:60},children:"PEDIR"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"right",fontSize:9,color:"#888",fontWeight:700,width:80},children:"P.U."}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"right",fontSize:9,color:"#888",fontWeight:700,width:90},children:"SUBTOTAL"})]})}),e.jsx("tbody",{children:ee.map(O=>{var ce;const le=Math.max(0,(O.stockMinimo||1)-(O.stockActual||0)),re=he(O.id),G=(re?te(O.id,re):{}).precio||O.precio||0;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsxs("td",{style:{padding:"4px 6px",fontWeight:500},children:[(ce=ho.find(V=>V.id===O.familia))==null?void 0:ce.icon," ",O.nombre]}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",color:_e.inkMid},children:O.unidad}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",color:_e.danger,fontWeight:600},children:O.stockActual||0}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center"},children:O.stockMinimo||0}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontWeight:700,color:_e.danger,background:_e.dangerBg},children:le}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10},children:A(G)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600},children:A(G*le)})]},O.id)})})]})]},H)})})})()]}),u&&c&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{S(!1),l(null)},children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:520,maxHeight:"85vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Ln,{t:c.fechaCreacion===is()?"Nuevo tem":"Editar tem",s:"Registro de recurso / material"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"Nombre",val:c.nombre,on:M=>l({...c,nombre:M.target.value}),ph:"Ej: Casco de seguridad"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:_e.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Familia"}),e.jsx("select",{value:c.familia,onChange:M=>l({...c,familia:M.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${_e.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:_e.bg},children:ho.map(M=>e.jsxs("option",{value:M.id,children:[M.icon," ",M.label]},M.id))})]})]}),c.familia==="epp"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:_e.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Subfamilia EPP"}),e.jsxs("select",{value:c.subfamilia||"",onChange:M=>l({...c,subfamilia:M.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${_e.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:_e.bg},children:[e.jsx("option",{value:"",children:" Seleccionar "}),Pf.map(M=>e.jsx("option",{value:M,children:M},M))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"Referencia",val:c.referencia,on:M=>l({...c,referencia:M.target.value}),ph:"Ref."}),e.jsx(Xt,{lbl:"Marca",val:c.marca,on:M=>l({...c,marca:M.target.value}),ph:"Marca"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:_e.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Unidad"}),e.jsx("select",{value:c.unidad,onChange:M=>l({...c,unidad:M.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${_e.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:_e.bg},children:Of.map(M=>e.jsx("option",{value:M,children:M},M))})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"Precio unitario",type:"number",val:c.precio,on:M=>l({...c,precio:+M.target.value})}),e.jsx(Xt,{lbl:"Stock actual",type:"number",val:c.stockActual,on:M=>l({...c,stockActual:+M.target.value})}),e.jsx(Xt,{lbl:"Stock mnimo",type:"number",val:c.stockMinimo,on:M=>l({...c,stockMinimo:+M.target.value})}),e.jsx(Xt,{lbl:"Vida til (meses)",type:"number",val:c.vidaUtil,on:M=>l({...c,vidaUtil:+M.target.value})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:_e.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Proveedor principal"}),e.jsxs("select",{value:c.proveedorId||"",onChange:M=>l({...c,proveedorId:M.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${_e.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:_e.bg},children:[e.jsx("option",{value:"",children:" Sin asignar "}),o.map(M=>e.jsx("option",{value:M.id,children:M.nombre},M.id))]})]}),(c.familia==="epp"||c.familia==="dotacion")&&e.jsxs("div",{style:{marginBottom:8,background:_e.warningBg,borderRadius:4,padding:"8px 10px"},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:_e.warning,marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:"Asociar a cargos (para clculo en APU)"}),e.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:[Q.filter(M=>M.activo!==!1).map(M=>{const B=(c.cargosAsociados||[]).includes(M.id);return e.jsxs("button",{onClick:()=>{const H=c.cargosAsociados||[];l({...c,cargosAsociados:B?H.filter(ee=>ee!==M.id):[...H,M.id],asociadoACargo:!0})},style:{padding:"3px 8px",fontSize:10,cursor:"pointer",border:`1px solid ${B?_e.warning:_e.border}`,borderRadius:3,background:B?_e.warning+"25":"#fff",color:B?_e.warning:_e.inkMid,fontFamily:"'DM Sans',sans-serif",fontWeight:B?600:400},children:[B?" ":"",M.nombre]},M.id)}),Q.filter(M=>M.activo!==!1).length===0&&e.jsx("span",{style:{fontSize:10,color:_e.inkLight},children:"Sin cargos en RRHH."})]})]}),e.jsx(Xt,{lbl:"Notas",val:c.notas,on:M=>l({...c,notas:M.target.value}),ph:"Observaciones..."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(Ro,{on:()=>T(c),style:{flex:1},children:[e.jsx(xt,{size:12})," Guardar"]}),e.jsx(Ro,{v:"sec",on:()=>{S(!1),l(null)},style:{flex:1},children:"Cancelar"})]})]})}),x&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>y(null),children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Ln,{t:"Proveedor",s:"Datos del proveedor"}),e.jsx(Xt,{lbl:"Nombre / Empresa",val:x.nombre,on:M=>y({...x,nombre:M.target.value}),ph:"Nombre"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"NIT / CIF",val:x.nit,on:M=>y({...x,nit:M.target.value}),ph:"NIT"}),e.jsx(Xt,{lbl:"Ciudad",val:x.ciudad,on:M=>y({...x,ciudad:M.target.value}),ph:"Ciudad"})]}),e.jsx(Xt,{lbl:"Contacto",val:x.contacto,on:M=>y({...x,contacto:M.target.value}),ph:"Persona de contacto"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Xt,{lbl:"Telfono",val:x.telefono,on:M=>y({...x,telefono:M.target.value}),ph:"+57..."}),e.jsx(Xt,{lbl:"Email",val:x.email,on:M=>y({...x,email:M.target.value}),ph:"email@..."})]}),e.jsx(Xt,{lbl:"Especialidad",val:x.especialidad,on:M=>y({...x,especialidad:M.target.value}),ph:"Ej: EPPs, ferretera, elctricos"}),e.jsx(Xt,{lbl:"Notas",val:x.notas,on:M=>y({...x,notas:M.target.value}),ph:"Observaciones"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(Ro,{on:()=>Z(x),style:{flex:1},children:[e.jsx(xt,{size:12})," Guardar"]}),e.jsx(Ro,{v:"sec",on:()=>y(null),style:{flex:1},children:"Cancelar"})]})]})})]})]}):e.jsx("div",{style:{padding:40,textAlign:"center",color:_e.inkLight},children:"Cargando..."})}const Wf=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input, select, textarea { font-family: 'DM Sans', sans-serif; outline: none; }
    button { font-family: 'DM Sans', sans-serif; cursor: pointer; }
    @keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    .fade-up { animation: fadeUp .22s ease both; }
  `}),Ce={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.05)"},nl=()=>Math.random().toString(36).slice(2,9),mr=()=>new Date().toISOString(),Nf=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",Uf=t=>t?new Date(t).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"}):"",wa=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"",xc=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/6e4);if(o<60)return`hace ${o}m`;const n=Math.floor(o/60);return n<24?`hace ${n}h`:`hace ${Math.floor(n/24)}d`};function Xl(t,i){const[o,n]=F.useState(i),[a,r]=F.useState(!1);F.useEffect(()=>{(()=>{try{const g=Ee.getSync(t);g!=null&&g.value&&n(JSON.parse(g))}catch{}r(!0)})()},[t]);const s=F.useCallback(async g=>{const h=typeof g=="function"?g(o):g;n(h);try{Ee.set(t,JSON.stringify(h))}catch{}},[t,o]);return[o,s,a]}const wn=[{id:"ofertas",label:"Ofertas / CRM",icon:En,color:"#111111",desc:"Presupuestos y propuestas comerciales"},{id:"compras",label:"Compras / Insumos",icon:Tn,color:"#0D5E6E",desc:"rdenes de compra y contratos proveedores"},{id:"rrhh",label:"RRHH",icon:Bi,color:"#3B3B3B",desc:"Contrataciones, vacaciones y novedades"},{id:"pagos",label:"Pagos / Tesorera",icon:Sr,color:"#8C6A00",desc:"Pagos a proveedores, anticipos y facturas"},{id:"subcontratos",label:"Subcontratos",icon:Ao,color:"#5B3A8C",desc:"Contratos con subcontratistas"},{id:"calidad",label:"Calidad / SST",icon:Bn,color:"#B91C1C",desc:"No conformidades, inspecciones y permisos"}],Ql={pendiente:{label:"Pendiente",color:Ce.amber,bg:Ce.amberBg,icon:Ta},aprobado:{label:"Aprobado",color:Ce.green,bg:Ce.greenBg,icon:Ho},rechazado:{label:"Rechazado",color:Ce.red,bg:Ce.redBg,icon:Gc},devuelto:{label:"Devuelto",color:"#D4840A",bg:"#FFF3E0",icon:xa}},os=[{id:"dashboard",lbl:"Dashboard",I:Ba,desc:"Resumen general de aprobaciones"},{id:"ofertas",lbl:"Ofertas",I:En,desc:"Aprobaciones de presupuestos y propuestas"},{id:"compras",lbl:"Compras",I:Tn,desc:"rdenes de compra y contratos"},{id:"rrhh",lbl:"RRHH",I:Bi,desc:"Contrataciones y novedades"},{id:"pagos",lbl:"Pagos",I:Sr,desc:"Pagos y tesorera"},{id:"subcontratos",lbl:"Subcontratos",I:Ao,desc:"Contratos subcontratistas"},{id:"calidad",lbl:"Calidad / SST",I:Bn,desc:"No conformidades e inspecciones"},{id:"config",lbl:"Configuracin",I:Ad,desc:"Cadenas de aprobacin y umbrales"}],Li=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Ce.surface,border:`1px solid ${Ce.border}`,borderRadius:8,boxShadow:Ce.shadow,...i},...o,children:t}),mc=({estado:t})=>{const i=Ql[t]||Ql.pendiente,o=i.icon;return e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:4,background:i.bg,color:i.color,fontSize:10,fontWeight:700},children:[e.jsx(o,{size:11})," ",i.label]})},qi=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Ce.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?Ce.redBg:Ce.ink,color:i==="sec"?Ce.inkMid:i==="danger"?Ce.red:"#fff",...a},...r,children:t});function Vf({pais:t="CO"}){var l,x;const[i,o]=F.useState("dashboard"),[n,a,r]=Xl("hab:aprobaciones:items",[]),[s,g,h]=Xl("hab:aprobaciones:config",{usuarios:[{id:"david",nombre:"David Parra Galera",cargo:"Director Ejecutivo",email:"david@habitaris.co",nivel:1,avatar:""},{id:"ana",nombre:"Ana Mara Daz Buitrago",cargo:"Directora Creativa",email:"ana@habitaris.co",nivel:1,avatar:""},{id:"residente",nombre:"Residente de obra",cargo:"Residente",email:"residente@habitaris.co",nivel:2,avatar:""},{id:"admin",nombre:"Coordinador Administrativo",cargo:"Admin",email:"admin@habitaris.co",nivel:3,avatar:""}],cadenas:{ofertas:{aprobadores:["david","ana"],umbral:0,umbralAlto:5e7,aprobadorAlto:"david"},compras:{aprobadores:["residente"],umbral:5e6,aprobadorAlto:"david",umbralAlto:2e7},rrhh:{aprobadores:["david","ana"],umbral:0},pagos:{aprobadores:["david"],umbral:0,umbralAlto:1e7,aprobadorAlto:"david"},subcontratos:{aprobadores:["david"],umbral:1e7,aprobadorAlto:"david"},calidad:{aprobadores:["residente","david"],umbral:0}},notificaciones:!0}),[b,j]=F.useState("david"),[k,v]=F.useState([]);F.useEffect(()=>{(()=>{try{const y=Ee.getSync("hab:crm:ofertas");y!=null&&y.value&&v(JSON.parse(y)||[])}catch{}})()},[]);const m=y=>{const u={id:nl(),fecha:mr(),estado:"pendiente",historial:[],...y};return a(S=>[...S,u]),u},f=(y,u,S="")=>{a(A=>A.map(E=>{var _;return E.id!==y?E:{...E,estado:u==="aprobar"?"aprobado":u==="rechazar"?"rechazado":"devuelto",historial:[...E.historial||[],{accion:u,fecha:mr(),por:b,porNombre:((_=s.usuarios.find(z=>z.id===b))==null?void 0:_.nombre)||b,comentario:S}]}}))},p=F.useMemo(()=>{const y=n.filter(_=>_.estado==="pendiente"),u=y.filter(_=>{var T;const z=s.cadenas[_.modulo];return(T=z==null?void 0:z.aprobadores)==null?void 0:T.includes(b)}),S=n.filter(_=>_.estado==="aprobado"),A=n.filter(_=>_.estado==="rechazado"),E=n.filter(_=>_.estado==="devuelto"),w={};return wn.forEach(_=>{w[_.id]={total:n.filter(z=>z.modulo===_.id).length,pendientes:n.filter(z=>z.modulo===_.id&&z.estado==="pendiente").length}}),{pendientes:y.length,misPendientes:u.length,aprobados:S.length,rechazados:A.length,devueltos:E.length,byModule:w,total:n.length}},[n,b,s]),d=y=>n.filter(u=>u.modulo===y),c={border:`1px solid ${Ce.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx(Wf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Ce.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Ce.surface,borderBottom:`1px solid ${Ce.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Ce.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Ce.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Ce.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Ce.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase",color:Ce.ink},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Ce.inkLight,marginLeft:10},children:"/ Aprobaciones"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p.misPendientes>0&&e.jsxs("div",{style:{background:Ce.amberBg,border:`1px solid ${Ce.amber}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(Fa,{size:12,color:Ce.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:Ce.amber},children:[p.misPendientes," pendiente",p.misPendientes!==1?"s":""]})]}),e.jsx("select",{value:b,onChange:y=>j(y.target.value),style:{...c,fontSize:11,fontWeight:600,padding:"5px 8px",minWidth:160},children:s.usuarios.map(y=>e.jsxs("option",{value:y.id,children:[y.avatar," ",y.nombre]},y.id))})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:Ce.surface,borderRight:`1px solid ${Ce.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[os.map(y=>{const u=i===y.id,S=p.byModule[y.id],A=(S==null?void 0:S.pendientes)||0;return e.jsxs("button",{onClick:()=>o(y.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:u?`3px solid ${Ce.ink}`:"3px solid transparent",background:u?Ce.accent:"transparent",color:u?Ce.ink:Ce.inkLight,fontSize:12,fontWeight:u?700:400,cursor:"pointer",textAlign:"left",width:"100%",transition:"all .1s"},children:[e.jsx(y.I,{size:13,style:{flexShrink:0}}),e.jsx("span",{style:{flex:1,lineHeight:1.2},children:y.lbl}),A>0&&y.id!=="dashboard"&&y.id!=="config"&&e.jsx("span",{style:{background:Ce.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:A})]},y.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:Ce.inkXLight,letterSpacing:.8,borderTop:`1px solid ${Ce.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:Ce.ink,letterSpacing:-.2},children:(l=os.find(y=>y.id===i))==null?void 0:l.lbl}),e.jsx("p",{style:{fontSize:11,color:Ce.inkLight,marginTop:2},children:(x=os.find(y=>y.id===i))==null?void 0:x.desc})]}),i==="dashboard"&&e.jsx(qf,{stats:p,aprobaciones:n,config:s,usuarioActivo:b,actuar:f,setTab:o,ofertas:k}),i==="config"&&e.jsx(Gf,{config:s,saveConfig:g}),["ofertas","compras","rrhh","pagos","subcontratos","calidad"].includes(i)&&e.jsx(Hf,{modulo:i,items:d(i),config:s,usuarioActivo:b,actuar:f,addAprobacion:m,ofertas:k})]})})]})]})]})}function qf({stats:t,aprobaciones:i,config:o,usuarioActivo:n,actuar:a,setTab:r,ofertas:s}){const g=i.filter(j=>{var v;if(j.estado!=="pendiente")return!1;const k=o.cadenas[j.modulo];return(v=k==null?void 0:k.aprobadores)==null?void 0:v.includes(n)}).sort((j,k)=>k.fecha>j.fecha?1:-1),h=[...i].sort((j,k)=>k.fecha>j.fecha?1:-1).slice(0,10),b=o.usuarios.find(j=>j.id===n);return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{label:"Mis pendientes",val:t.misPendientes,color:Ce.amber,bg:Ce.amberBg},{label:"Total pendientes",val:t.pendientes,color:"#D4840A",bg:"#FFF3E0"},{label:"Aprobadas",val:t.aprobados,color:Ce.green,bg:Ce.greenBg},{label:"Rechazadas",val:t.rechazados,color:Ce.red,bg:Ce.redBg},{label:"Devueltas",val:t.devueltos,color:Ce.blue,bg:Ce.blueBg}].map(j=>e.jsxs(Li,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",letterSpacing:1},children:j.label}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:j.color,marginTop:4},children:j.val})]},j.label))}),e.jsx(Li,{style:{padding:"16px 20px",marginBottom:16,background:Ce.greenBg,border:`1px solid ${Ce.green}33`},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("span",{style:{fontSize:28},children:(b==null?void 0:b.avatar)||""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Ce.green},children:(b==null?void 0:b.nombre)||"Usuario"}),e.jsxs("div",{style:{fontSize:11,color:Ce.inkMid},children:[b==null?void 0:b.cargo,"  ",Object.entries(o.cadenas).filter(([,j])=>{var k;return(k=j.aprobadores)==null?void 0:k.includes(n)}).map(([j])=>j).join(", ")||"Sin mdulos asignados"]})]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs(Li,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",background:Ce.amberBg,borderBottom:`1px solid ${Ce.border}`},children:e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:Ce.amber,display:"flex",alignItems:"center",gap:6},children:[e.jsx(Ta,{size:13})," Mis pendientes (",g.length,")"]})}),e.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:g.length===0?e.jsxs("div",{style:{padding:24,textAlign:"center",color:Ce.inkLight,fontSize:12},children:[e.jsx(Ho,{size:24,style:{marginBottom:8,opacity:.3}}),e.jsx("div",{children:"Sin aprobaciones pendientes "})]}):g.map(j=>e.jsx(bc,{item:j,actuar:a,config:o,usuarioActivo:n,compact:!0,ofertas:s},j.id))})]}),e.jsxs(Li,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",background:Ce.blueBg,borderBottom:`1px solid ${Ce.border}`},children:e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:Ce.blue,display:"flex",alignItems:"center",gap:6},children:[e.jsx(zn,{size:13})," Por mdulo"]})}),wn.map(j=>{const k=t.byModule[j.id]||{},v=j.icon;return e.jsxs("div",{onClick:()=>r(j.id),style:{padding:"10px 16px",borderBottom:`1px solid ${Ce.border}`,cursor:"pointer",display:"flex",alignItems:"center",gap:10,transition:"background .1s"},onMouseEnter:m=>m.currentTarget.style.background=Ce.surfaceAlt,onMouseLeave:m=>m.currentTarget.style.background="transparent",children:[e.jsx("div",{style:{width:28,height:28,borderRadius:6,background:j.color+"15",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(v,{size:14,color:j.color})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600},children:j.label}),e.jsxs("div",{style:{fontSize:9,color:Ce.inkLight},children:[k.total||0," total"]})]}),k.pendientes>0&&e.jsx("span",{style:{background:Ce.amber,color:"#fff",fontSize:9,fontWeight:800,padding:"2px 7px",borderRadius:10},children:k.pendientes}),e.jsx(Yi,{size:12,color:Ce.inkLight})]},j.id)})]})]}),h.length>0&&e.jsxs(Li,{style:{marginTop:16,padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${Ce.border}`},children:e.jsx("div",{style:{fontSize:12,fontWeight:700,color:Ce.ink},children:"Actividad reciente"})}),h.map(j=>{const k=(j.historial||[]).slice(-1)[0],v=wn.find(m=>m.id===j.modulo);return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11},children:[e.jsx(mc,{estado:j.estado}),e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:600},children:j.titulo||j.referencia||"Sin ttulo"}),e.jsx("span",{style:{color:Ce.inkLight,marginLeft:6,fontSize:9},children:v==null?void 0:v.label})]}),j.monto>0&&e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,color:Ce.inkMid},children:["$",wa(j.monto)]}),e.jsx("span",{style:{fontSize:9,color:Ce.inkLight},children:xc((k==null?void 0:k.fecha)||j.fecha)})]},j.id)})]}),i.length===0&&e.jsxs(Li,{style:{padding:30,textAlign:"center",marginTop:16},children:[e.jsx(Bn,{size:36,style:{color:Ce.inkLight,opacity:.3,marginBottom:12}}),e.jsx("div",{style:{fontSize:14,fontWeight:600,color:Ce.inkMid,marginBottom:6},children:"Sin aprobaciones registradas"}),e.jsx("div",{style:{fontSize:11,color:Ce.inkLight,marginBottom:16},children:"Las aprobaciones se generan desde cada mdulo (Ofertas, Compras, etc.) o puedes crear una demo."}),e.jsxs(qi,{on:()=>{[{modulo:"ofertas",titulo:"OF-2026-001  Apto 301 Torre Norte",referencia:"OF-2026-001",monto:85e6,solicitante:"ana",tipo:"Presupuesto de ejecucin"},{modulo:"ofertas",titulo:"OF-2026-002  Diseo interior Oficinas",referencia:"OF-2026-002",monto:25e6,solicitante:"david",tipo:"Propuesta de diseo"},{modulo:"compras",titulo:"OC-001  Cemento y acero",referencia:"OC-001",monto:125e5,solicitante:"residente",tipo:"Orden de compra"},{modulo:"compras",titulo:"OC-002  Pisos porcelanato 60x60",referencia:"OC-002",monto:82e5,solicitante:"residente",tipo:"Orden de compra"},{modulo:"pagos",titulo:"PAG-001  Anticipo Ferretera El Tornillo",referencia:"PAG-001",monto:6e6,solicitante:"admin",tipo:"Pago a proveedor"},{modulo:"subcontratos",titulo:"SC-001  Instalaciones elctricas",referencia:"SC-001",monto:18e6,solicitante:"residente",tipo:"Subcontrato"},{modulo:"rrhh",titulo:"Contratacin auxiliar de obra",referencia:"RRHH-001",monto:28e5,solicitante:"residente",tipo:"Nueva contratacin"},{modulo:"calidad",titulo:"NC-001  Fisura en paete fachada",referencia:"NC-001",monto:0,solicitante:"residente",tipo:"No conformidad"}].forEach(k=>{const v=o.usuarios.find(m=>m.id===k.solicitante);saveAprobaciones(m=>[...m,{id:nl(),fecha:mr(),estado:"pendiente",historial:[{accion:"solicitar",fecha:mr(),por:k.solicitante,porNombre:(v==null?void 0:v.nombre)||k.solicitante,comentario:""}],...k}])})},children:[e.jsx(Oe,{size:12})," Crear datos de ejemplo"]})]})]})}function bc({item:t,actuar:i,config:o,usuarioActivo:n,compact:a,ofertas:r}){var m,f,p,d;const[s,g]=F.useState(!1),[h,b]=F.useState(""),j=t.estado==="pendiente"&&((f=(m=o.cadenas[t.modulo])==null?void 0:m.aprobadores)==null?void 0:f.includes(n)),k=wn.find(c=>c.id===t.modulo),v=c=>{if(c!=="aprobar"&&!h.trim()){alert("Escribe un comentario");return}i(t.id,c,h),b(""),g(!1)};return e.jsxs("div",{style:{borderBottom:`1px solid ${Ce.border}`},children:[e.jsxs("div",{onClick:()=>g(!s),style:{padding:a?"8px 16px":"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,transition:"background .1s",background:s?Ce.surfaceAlt:"transparent"},onMouseEnter:c=>{s||(c.currentTarget.style.background="#FFFFFF")},onMouseLeave:c=>{s||(c.currentTarget.style.background="transparent")},children:[!a&&k&&e.jsx("div",{style:{width:24,height:24,borderRadius:4,background:k.color+"15",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(k.icon,{size:12,color:k.color})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.titulo||t.referencia||"Sin ttulo"}),e.jsxs("div",{style:{fontSize:9,color:Ce.inkLight,marginTop:1},children:[t.tipo||""," ",t.solicitante&&` por ${((d=(p=o.usuarios.find(c=>c.id===t.solicitante))==null?void 0:p.nombre)==null?void 0:d.split(" ")[0])||t.solicitante}`]})]}),t.monto>0&&e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600,color:Ce.inkMid,flexShrink:0},children:["$",wa(t.monto)]}),e.jsx(mc,{estado:t.estado}),e.jsx("span",{style:{fontSize:9,color:Ce.inkLight,flexShrink:0},children:xc(t.fecha)}),s?e.jsx(Fn,{size:12,color:Ce.inkLight}):e.jsx(Yi,{size:12,color:Ce.inkLight})]}),s&&e.jsxs("div",{style:{padding:"0 16px 14px",background:Ce.surfaceAlt},children:[(t.historial||[]).length>0&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Historial"}),(t.historial||[]).map((c,l)=>e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${Ce.border}`,paddingLeft:10,marginLeft:4},children:[e.jsxs("span",{style:{color:Ce.inkLight,minWidth:60},children:[Nf(c.fecha)," ",Uf(c.fecha)]}),e.jsx("span",{style:{fontWeight:600},children:c.porNombre||c.por}),e.jsx("span",{style:{color:Ce.inkMid},children:c.accion==="solicitar"?"solicit aprobacin":c.accion==="aprobar"?" aprob":c.accion==="rechazar"?" rechaz":c.accion==="devolver"?" devolvi":c.accion}),c.comentario&&e.jsxs("span",{style:{color:Ce.amber,fontStyle:"italic"},children:[" ",c.comentario]})]},l))]}),j&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("input",{value:h,onChange:c=>b(c.target.value),placeholder:"Comentario (obligatorio para rechazar/devolver)...",style:{width:"100%",padding:"6px 10px",border:`1px solid ${Ce.border}`,borderRadius:4,fontSize:11,marginBottom:8,background:"#fff"}}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(qi,{sm:!0,on:()=>v("aprobar"),children:[e.jsx(xt,{size:11})," Aprobar"]}),e.jsxs(qi,{sm:!0,v:"sec",on:()=>v("devolver"),style:{color:Ce.amber,borderColor:Ce.amber+"44"},children:[e.jsx(xa,{size:11})," Devolver"]}),e.jsxs(qi,{sm:!0,v:"danger",on:()=>v("rechazar"),children:[e.jsx($t,{size:11})," Rechazar"]})]})]})]})]})}function Hf({modulo:t,items:i,config:o,usuarioActivo:n,actuar:a,addAprobacion:r,ofertas:s}){const[g,h]=F.useState("todos"),[b,j]=F.useState(""),[k,v]=F.useState(!1),[m,f]=F.useState({titulo:"",referencia:"",monto:0,tipo:""}),p=wn.find(u=>u.id===t),d=i.filter(u=>!(g!=="todos"&&u.estado!==g||b&&!(u.titulo||"").toLowerCase().includes(b.toLowerCase())&&!(u.referencia||"").toLowerCase().includes(b.toLowerCase()))).sort((u,S)=>S.fecha>u.fecha?1:-1),c=i.filter(u=>u.estado==="pendiente").length,l=()=>{var u;m.titulo.trim()&&(r({modulo:t,titulo:m.titulo,referencia:m.referencia,monto:parseFloat(m.monto)||0,tipo:m.tipo,solicitante:n,historial:[{accion:"solicitar",fecha:mr(),por:n,porNombre:((u=o.usuarios.find(S=>S.id===n))==null?void 0:u.nombre)||n,comentario:""}]}),f({titulo:"",referencia:"",monto:0,tipo:""}),v(!1))},x=o.cadenas[t]||{},y=(x.aprobadores||[]).map(u=>o.usuarios.find(S=>S.id===u)).filter(Boolean);return e.jsxs("div",{className:"fade-up",children:[e.jsx(Li,{style:{padding:"14px 18px",marginBottom:14,background:(p==null?void 0:p.color)+"08",border:`1px solid ${p==null?void 0:p.color}22`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p&&e.jsx(p.icon,{size:18,color:p.color}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:Ce.ink},children:p==null?void 0:p.label}),e.jsxs("div",{style:{fontSize:10,color:Ce.inkMid},children:[i.length," total  ",c," pendientes  Aprobadores: ",y.map(u=>u.nombre.split(" ")[0]).join(", ")||"Sin configurar",x.umbral>0&&`  Umbral: $${wa(x.umbral)}`]})]})]}),e.jsxs(qi,{sm:!0,on:()=>v(!0),children:[e.jsx(Oe,{size:11})," Nueva solicitud"]})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["todos","Todos"],["pendiente","Pendientes"],["aprobado","Aprobados"],["rechazado","Rechazados"],["devuelto","Devueltos"]].map(([u,S],A,E)=>e.jsxs("button",{onClick:()=>h(u),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${Ce.border}`,borderLeft:A>0?"none":void 0,borderRadius:A===0?"4px 0 0 4px":A===E.length-1?"0 4px 4px 0":"0",background:g===u?Ce.ink:"#fff",color:g===u?"#fff":Ce.inkMid},children:[S," ",u==="pendiente"&&c>0?`(${c})`:""]},u))}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ci,{size:12,style:{position:"absolute",left:8,top:8,color:Ce.inkLight}}),e.jsx("input",{value:b,onChange:u=>j(u.target.value),placeholder:"Buscar...",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"6px 10px",fontSize:11,background:"#fff",paddingLeft:26,width:200}})]})]}),e.jsx(Li,{style:{padding:0,overflow:"hidden"},children:d.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:Ce.inkLight,fontSize:12},children:["Sin aprobaciones ",g!=="todos"?`con estado "${g}"`:""," en ",p==null?void 0:p.label]}):d.map(u=>e.jsx(bc,{item:u,actuar:a,config:o,usuarioActivo:n,ofertas:s},u.id))}),k&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>v(!1),children:e.jsxs("div",{onClick:u=>u.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,marginBottom:4},children:"Nueva solicitud de aprobacin"}),e.jsxs("div",{style:{fontSize:11,color:Ce.inkLight,marginBottom:16},children:["Mdulo: ",p==null?void 0:p.label]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Ttulo / Descripcin"}),e.jsx("input",{value:m.titulo,onChange:u=>f({...m,titulo:u.target.value}),placeholder:"Ej: Orden de compra acero corrugado",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Referencia"}),e.jsx("input",{value:m.referencia,onChange:u=>f({...m,referencia:u.target.value}),placeholder:"OC-001",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Monto"}),e.jsx("input",{type:"number",value:m.monto||"",onChange:u=>f({...m,monto:u.target.value}),placeholder:"0",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%",fontFamily:"'DM Mono',monospace"}})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Tipo de solicitud"}),e.jsx("input",{value:m.tipo,onChange:u=>f({...m,tipo:u.target.value}),placeholder:"Ej: Orden de compra, Pago, Contrato...",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{style:{background:Ce.surfaceAlt,borderRadius:4,padding:"8px 12px",fontSize:10,color:Ce.inkMid,marginBottom:12},children:[" Aprobadores configurados: ",e.jsx("strong",{children:y.map(u=>u.nombre.split(" ")[0]).join(", ")||"Ninguno"}),x.umbral>0&&e.jsxs("span",{children:["  Umbral auto: ",e.jsxs("strong",{children:["$",wa(x.umbral)]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs(qi,{on:l,style:{flex:1},children:[e.jsx(yn,{size:11})," Solicitar aprobacin"]}),e.jsx(qi,{v:"sec",on:()=>v(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function Gf({config:t,saveConfig:i}){F.useState(null);const[o,n]=F.useState({nombre:"",cargo:"",email:"",nivel:3,avatar:""}),[a,r]=F.useState(!1),s=(k,v,m)=>{i(f=>({...f,cadenas:{...f.cadenas,[k]:{...f.cadenas[k],[v]:m}}}))},g=(k,v)=>{const f=(t.cadenas[k]||{}).aprobadores||[],p=f.includes(v)?f.filter(d=>d!==v):[...f,v];s(k,"aprobadores",p)},h=()=>{o.nombre.trim()&&(i(k=>({...k,usuarios:[...k.usuarios,{...o,id:nl()}]})),n({nombre:"",cargo:"",email:"",nivel:3,avatar:""}),r(!1))},b=k=>{i(v=>({...v,usuarios:v.usuarios.filter(m=>m.id!==k),cadenas:Object.fromEntries(Object.entries(v.cadenas).map(([m,f])=>[m,{...f,aprobadores:(f.aprobadores||[]).filter(p=>p!==k)}]))}))},j={border:`1px solid ${Ce.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs(Li,{style:{padding:18,marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Ce.ink},children:"Usuarios aprobadores"}),e.jsx("div",{style:{fontSize:10,color:Ce.inkLight},children:"Personas que participan en cadenas de aprobacin"})]}),e.jsxs(qi,{sm:!0,on:()=>r(!0),children:[e.jsx(Oe,{size:11})," Aadir usuario"]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:10},children:t.usuarios.map(k=>e.jsxs("div",{style:{border:`1px solid ${Ce.border}`,borderRadius:6,padding:"10px 14px",background:Ce.surfaceAlt},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:20},children:k.avatar}),e.jsx("button",{onClick:()=>b(k.id),style:{background:"none",border:"none",cursor:"pointer",color:Ce.red,padding:2},children:e.jsx(He,{size:11})})]}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:k.nombre}),e.jsx("div",{style:{fontSize:10,color:Ce.inkMid},children:k.cargo}),e.jsx("div",{style:{fontSize:9,color:Ce.inkLight,marginTop:2},children:k.email}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase"},children:"Nivel:"}),[1,2,3].map(v=>e.jsx("button",{onClick:()=>i(m=>({...m,usuarios:m.usuarios.map(f=>f.id===k.id?{...f,nivel:v}:f)})),style:{width:20,height:20,borderRadius:"50%",border:`1px solid ${k.nivel===v?Ce.green:Ce.border}`,background:k.nivel===v?Ce.greenBg:"#fff",color:k.nivel===v?Ce.green:Ce.inkLight,fontSize:9,fontWeight:700,cursor:"pointer"},children:v},v))]})]},k.id))})]}),e.jsxs(Li,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Ce.ink,marginBottom:4},children:"Cadenas de aprobacin por mdulo"}),e.jsx("div",{style:{fontSize:10,color:Ce.inkLight,marginBottom:14},children:"Define quin aprueba en cada mdulo y los umbrales de monto. Si el monto supera el umbral alto, se requiere el aprobador de nivel superior."}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:Ce.surfaceAlt},children:[e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",letterSpacing:.5,borderBottom:`2px solid ${Ce.border}`},children:"Mdulo"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Ce.border}`},children:"Aprobadores"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"right",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Ce.border}`,width:120},children:"Umbral estndar"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"right",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Ce.border}`,width:120},children:"Umbral alto"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Ce.border}`,width:140},children:"Aprobador nivel alto"})]})}),e.jsx("tbody",{children:wn.map(k=>{const v=t.cadenas[k.id]||{},m=k.icon;return e.jsxs("tr",{style:{borderBottom:`1px solid ${Ce.border}`},children:[e.jsx("td",{style:{padding:"10px 12px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(m,{size:14,color:k.color}),e.jsx("span",{style:{fontSize:12,fontWeight:600},children:k.label})]})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:t.usuarios.map(f=>{const p=(v.aprobadores||[]).includes(f.id);return e.jsxs("button",{onClick:()=>g(k.id,f.id),style:{padding:"3px 8px",fontSize:9,fontWeight:600,borderRadius:4,cursor:"pointer",border:`1px solid ${p?Ce.green:Ce.border}`,background:p?Ce.greenBg:"#fff",color:p?Ce.green:Ce.inkLight},children:[p?e.jsx(Fd,{size:8,style:{marginRight:3}}):e.jsx(Hc,{size:8,style:{marginRight:3}}),f.nombre.split(" ")[0]]},f.id)})})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("input",{type:"number",value:v.umbral||"",placeholder:"0",onChange:f=>s(k.id,"umbral",parseFloat(f.target.value)||0),style:{...j,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10}})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("input",{type:"number",value:v.umbralAlto||"",placeholder:"0",onChange:f=>s(k.id,"umbralAlto",parseFloat(f.target.value)||0),style:{...j,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10}})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsxs("select",{value:v.aprobadorAlto||"",onChange:f=>s(k.id,"aprobadorAlto",f.target.value),style:{...j,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Sin definir "}),t.usuarios.filter(f=>f.nivel<=1).map(f=>e.jsx("option",{value:f.id,children:f.nombre},f.id))]})})]},k.id)})})]})]}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:k=>k.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:400,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,marginBottom:12},children:"Nuevo usuario aprobador"}),[["nombre","Nombre completo","Ej: Carlos Rodrguez"],["cargo","Cargo","Ej: Residente de obra"],["email","Email","carlos@habitaris.co"]].map(([k,v,m])=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:v}),e.jsx("input",{value:o[k],onChange:f=>n({...o,[k]:f.target.value}),placeholder:m,style:{...j,width:"100%"}})]},k)),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Avatar"}),e.jsx("div",{style:{display:"flex",gap:4},children:["","","","","","","",""].map(k=>e.jsx("button",{onClick:()=>n({...o,avatar:k}),style:{width:28,height:28,borderRadius:4,cursor:"pointer",fontSize:16,border:`2px solid ${o.avatar===k?Ce.green:Ce.border}`,background:o.avatar===k?Ce.greenBg:"#fff"},children:k},k))})]}),e.jsxs("div",{style:{width:80},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Nivel"}),e.jsxs("select",{value:o.nivel,onChange:k=>n({...o,nivel:+k.target.value}),style:{...j,width:"100%"},children:[e.jsx("option",{value:1,children:"1 (Director)"}),e.jsx("option",{value:2,children:"2 (Coordinador)"}),e.jsx("option",{value:3,children:"3 (Operativo)"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsxs(qi,{on:h,style:{flex:1},children:[e.jsx(xt,{size:11})," Guardar"]}),e.jsx(qi,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}const Kf=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'DM Sans',sans-serif;background:#F5F4F1;-webkit-font-smoothing:antialiased}
    ::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}
    input,select,textarea{font-family:'DM Sans',sans-serif;outline:none}
    button{font-family:'DM Sans',sans-serif;cursor:pointer}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .22s ease both}
  `}),Re={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",purpleBg:"#F0ECF6",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},ns=()=>Math.random().toString(36).slice(2,9),Vr=()=>new Date().toISOString().split("T")[0],qr=(t,i)=>{const o=new Date(t);return o.setDate(o.getDate()+i),o.toISOString().split("T")[0]},Zl=(t,i)=>Math.round((new Date(i)-new Date(t))/864e5),nn=t=>Math.min(100,Math.max(0,Math.round(t))),rs=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short"}):"";function as(t,i){const o="habitaris_proy",[n,a]=F.useState(()=>{try{const s=JSON.parse(Ee.getSync(o))||{};return s[t]!=null?s[t]:i}catch{return i}}),r=F.useCallback(s=>{const g=typeof s=="function"?s(n):s;a(g);try{const h=JSON.parse(Ee.getSync(o))||{};h[t]=g,Ee.set(o,JSON.stringify(h))}catch{}},[t,n]);return[n,r]}const fo=({children:t,style:i})=>e.jsx("div",{style:{background:Re.surface,border:`1px solid ${Re.border}`,borderRadius:8,boxShadow:Re.shadow,...i},children:t}),ss=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Re.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?Re.redBg:Re.ink,color:i==="sec"?Re.inkMid:i==="danger"?Re.red:"#fff",...a},...r,children:t}),Jf=[{id:"dashboard",lbl:"Dashboard",I:Ji,desc:"KPIs y estado general"},{id:"gantt",lbl:"Cronograma",I:Ks,desc:"Diagrama de Gantt y programacin"},{id:"avances",lbl:"Avances",I:Ji,desc:"Registro de avance por actividad"},{id:"hitos",lbl:"Hitos",I:Td,desc:"Hitos y entregables del proyecto"},{id:"tablero",lbl:"Tablero",I:zn,desc:"Vista Kanban de tareas"},{id:"equipo",lbl:"Equipo",I:Bi,desc:"Asignacin de recursos"}];function Yf(){const[t,i]=F.useState("dashboard"),[o,n]=as("hab:proyectos:lista",[]),[a,r]=F.useState(null),[s,g]=as("hab:proyectos:actividades",[]),[h,b]=as("hab:proyectos:hitos",[]),j=o.find(u=>u.id===a),k=()=>{const u={id:ns(),nombre:"Nuevo proyecto",inicio:Vr(),fin:qr(Vr(),90),estado:"activo",descripcion:"",color:Re.purple};n(S=>[...S,u]),r(u.id)},v=(u,S)=>n(A=>A.map(E=>E.id===a?{...E,[u]:S}:E)),m=s.filter(u=>u.proyectoId===a),f=m.length>0?m.reduce((u,S)=>u+(S.avance||0),0)/m.length:0,p=()=>{const u={id:ns(),proyectoId:a,nombre:"Nueva actividad",inicio:Vr(),duracion:7,avance:0,responsable:"",predecessors:[],capitulo:""};g(S=>[...S,u])},d=(u,S,A)=>g(E=>E.map(w=>w.id===u?{...w,[S]:A}:w)),c=u=>g(S=>S.filter(A=>A.id!==u)),l=()=>{const u={id:ns(),proyectoId:a,nombre:"Nuevo hito",fecha:Vr(),completado:!1,descripcion:""};b(S=>[...S,u])},x=h.filter(u=>u.proyectoId===a),y={border:`1px solid ${Re.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff",width:"100%"};return e.jsxs(e.Fragment,{children:[e.jsx(Kf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Re.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Re.surface,borderBottom:`1px solid ${Re.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Re.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Re.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Re.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Re.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Re.inkLight,marginLeft:10},children:"/ Proyectos"})]})]}),j&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600},children:j.nombre}),e.jsxs("span",{style:{fontSize:10,padding:"2px 8px",borderRadius:10,background:Re.purpleBg,color:Re.purple,fontWeight:700},children:[nn(f),"%"]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:Re.surface,borderRight:`1px solid ${Re.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[e.jsxs("div",{style:{padding:"6px 12px 10px",borderBottom:`1px solid ${Re.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Re.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Proyectos"}),o.map(u=>e.jsxs("button",{onClick:()=>r(u.id),style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",fontSize:11,fontWeight:a===u.id?700:400,border:"none",borderRadius:4,cursor:"pointer",marginBottom:2,background:a===u.id?Re.purpleBg:"transparent",color:a===u.id?Re.purple:Re.inkMid},children:[" ",u.nombre]},u.id)),e.jsxs("button",{onClick:k,style:{display:"flex",alignItems:"center",gap:4,width:"100%",padding:"5px 10px",fontSize:10,border:`1px dashed ${Re.border}`,borderRadius:4,background:"transparent",color:Re.inkLight,marginTop:4},children:[e.jsx(Oe,{size:10})," Nuevo proyecto"]})]}),a&&Jf.map(u=>{const S=t===u.id;return e.jsxs("button",{onClick:()=>i(u.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:S?`3px solid ${Re.ink}`:"3px solid transparent",background:S?Re.accent:"transparent",color:S?Re.ink:Re.inkLight,fontSize:12,fontWeight:S?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(u.I,{size:13})," ",u.lbl]},u.id)})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1200},children:a?e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs("div",{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Proyectos",o.length,"#111",`${o.filter(u=>u.estado==="activo").length} activos`],[" Avance global",`${nn(f)}%`,f>=70?"#111111":f>=40?"#8C6A00":"#B91C1C",`${m.length} actividades`],[" Hitos",`${x.filter(u=>u.completado).length}/${x.length}`,"#3B3B3B",`${x.filter(u=>!u.completado).length} pendientes`],[" Actividades",m.length,"#111",j?`en ${j.nombre}`:""]].map(([u,S,A,E])=>e.jsxs(fo,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:u}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:A},children:S}),E&&e.jsx("div",{style:{fontSize:9,color:"#909090",marginTop:2},children:E})]},u))}),j&&e.jsxs(fo,{style:{marginBottom:12},children:[e.jsxs("div",{style:{fontSize:10,fontWeight:700,marginBottom:8},children:[" Avance  ",j.nombre]}),e.jsx("div",{style:{height:12,background:"#E0E0E0",borderRadius:6,overflow:"hidden",marginBottom:6},children:e.jsx("div",{style:{width:`${nn(f)}%`,height:"100%",borderRadius:6,background:f>=70?"#111111":f>=40?"#8C6A00":"#B91C1C"}})}),e.jsxs("div",{style:{fontSize:9,color:"#909090"},children:["Inicio: ",j.inicio,"  Fin: ",j.fin,"  ",m.length," actividades"]})]})]}),t==="gantt"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:10,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:Re.inkLight,textTransform:"uppercase"},children:"Nombre del proyecto"}),e.jsx("input",{value:j.nombre,onChange:u=>v("nombre",u.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:Re.inkLight,textTransform:"uppercase"},children:"Inicio"}),e.jsx("input",{type:"date",value:j.inicio,onChange:u=>v("inicio",u.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:Re.inkLight,textTransform:"uppercase"},children:"Fin estimado"}),e.jsx("input",{type:"date",value:j.fin,onChange:u=>v("fin",u.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:Re.inkLight,textTransform:"uppercase"},children:"Estado"}),e.jsxs("select",{value:j.estado,onChange:u=>v("estado",u.target.value),style:y,children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"finalizado",children:"Finalizado"})]})]})]}),e.jsxs(fo,{style:{padding:0,overflow:"hidden",marginBottom:16},children:[e.jsxs("div",{style:{padding:"10px 16px",borderBottom:`1px solid ${Re.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Cronograma"}),e.jsxs(ss,{sm:!0,on:p,children:[e.jsx(Oe,{size:10})," Actividad"]})]}),m.length===0?e.jsx("div",{style:{padding:30,textAlign:"center",color:Re.inkLight,fontSize:12},children:"Sin actividades. Agrega la primera."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:800},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Re.surfaceAlt},children:["#","Actividad","Inicio","Dur.(das)","Fin","Avance %","Responsable",""].map(u=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Re.inkLight,textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:`2px solid ${Re.border}`,whiteSpace:"nowrap"},children:u},u))})}),e.jsx("tbody",{children:m.map((u,S)=>{const A=qr(u.inicio,u.duracion);return e.jsxs("tr",{style:{borderBottom:`1px solid ${Re.border}`},children:[e.jsx("td",{style:{padding:"6px 10px",fontSize:10,color:Re.inkLight},children:S+1}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:u.nombre,onChange:E=>d(u.id,"nombre",E.target.value),style:{border:"none",background:"transparent",fontSize:12,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:u.inicio,onChange:E=>d(u.id,"inicio",E.target.value),style:{border:`1px solid ${Re.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"number",value:u.duracion,onChange:E=>d(u.id,"duracion",+E.target.value),style:{border:`1px solid ${Re.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,width:50,textAlign:"center",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px",fontSize:10,color:Re.inkMid,fontFamily:"'DM Mono',monospace"},children:rs(A)}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:Re.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${u.avance||0}%`,background:u.avance>=100?Re.green:Re.purple,borderRadius:3,transition:"width .2s"}})}),e.jsx("input",{type:"number",value:u.avance||0,min:0,max:100,onChange:E=>d(u.id,"avance",nn(+E.target.value)),style:{width:36,border:`1px solid ${Re.border}`,borderRadius:3,padding:"2px 4px",fontSize:9,textAlign:"center",fontFamily:"'DM Mono',monospace",background:"#fff"}})]})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:u.responsable||"",onChange:E=>d(u.id,"responsable",E.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:11,width:100}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>c(u.id),style:{background:"none",border:"none",color:Re.red,cursor:"pointer"},children:e.jsx(He,{size:12})})})]},u.id)})})]})})]}),m.length>0&&e.jsxs(fo,{style:{padding:16,marginBottom:16},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:10},children:"Vista Gantt"}),(()=>{const u=m.reduce((E,w)=>w.inicio<E?w.inicio:E,m[0].inicio),S=m.reduce((E,w)=>{const _=qr(w.inicio,w.duracion);return _>E?_:E},u),A=Math.max(Zl(u,S),1);return m.map(E=>{const _=Zl(u,E.inicio)/A*100,z=Math.max(E.duracion/A*100,2);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("div",{style:{width:120,fontSize:10,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:E.nombre}),e.jsx("div",{style:{flex:1,height:14,background:Re.surfaceAlt,borderRadius:3,position:"relative",border:`1px solid ${Re.border}`},children:e.jsx("div",{style:{position:"absolute",left:`${_}%`,width:`${z}%`,height:"100%",background:E.avance>=100?Re.green:Re.purple+"88",borderRadius:3},children:e.jsx("div",{style:{height:"100%",width:`${E.avance||0}%`,background:E.avance>=100?Re.green:Re.purple,borderRadius:3}})})}),e.jsxs("span",{style:{fontSize:9,fontFamily:"'DM Mono',monospace",color:Re.inkLight,minWidth:30,textAlign:"right"},children:[E.avance||0,"%"]})]},E.id)})})()]}),e.jsxs(fo,{style:{padding:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Avance global del proyecto"}),e.jsxs("div",{style:{fontSize:10,color:Re.inkLight},children:[m.length," actividades  ",m.filter(u=>u.avance>=100).length," completadas"]})]}),e.jsxs("div",{style:{fontSize:28,fontWeight:800,color:f>=100?Re.green:Re.purple},children:[nn(f),"%"]})]}),e.jsx("div",{style:{height:8,background:Re.border,borderRadius:4,marginTop:8,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${f}%`,background:f>=100?Re.green:Re.purple,borderRadius:4,transition:"width .3s"}})})]})]}),t==="avances"&&e.jsxs(fo,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Registro de avances"}),m.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:Re.inkLight},children:"Agrega actividades primero en el Cronograma"}):m.map(u=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${Re.border}`},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600},children:u.nombre}),e.jsxs("div",{style:{fontSize:9,color:Re.inkLight},children:[u.responsable||"Sin asignar","  ",rs(u.inicio),"  ",rs(qr(u.inicio,u.duracion))]})]}),e.jsxs("div",{style:{width:160,display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"range",min:0,max:100,value:u.avance||0,onChange:S=>d(u.id,"avance",+S.target.value),style:{flex:1,accentColor:Re.purple}}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,fontFamily:"'DM Mono',monospace",color:u.avance>=100?Re.green:Re.purple,minWidth:30},children:[u.avance||0,"%"]})]})]},u.id))]}),t==="hitos"&&e.jsxs(fo,{style:{padding:18},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"Hitos del proyecto"}),e.jsxs(ss,{sm:!0,on:l,children:[e.jsx(Oe,{size:10})," Nuevo hito"]})]}),x.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:Re.inkLight},children:"Sin hitos definidos"}):x.sort((u,S)=>u.fecha>S.fecha?1:-1).map(u=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${Re.border}`},children:[e.jsx("button",{onClick:()=>b(S=>S.map(A=>A.id===u.id?{...A,completado:!A.completado}:A)),style:{width:24,height:24,borderRadius:"50%",border:`2px solid ${u.completado?Re.green:Re.border}`,background:u.completado?Re.greenBg:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:u.completado&&e.jsx(xt,{size:12,color:Re.green})}),e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:u.nombre,onChange:S=>b(A=>A.map(E=>E.id===u.id?{...E,nombre:S.target.value}:E)),style:{border:"none",background:"transparent",fontSize:13,fontWeight:600,width:"100%",textDecoration:u.completado?"line-through":"none",color:u.completado?Re.inkLight:Re.ink}})}),e.jsx("input",{type:"date",value:u.fecha,onChange:S=>b(A=>A.map(E=>E.id===u.id?{...E,fecha:S.target.value}:E)),style:{border:`1px solid ${Re.border}`,borderRadius:3,padding:"3px 8px",fontSize:10,background:"#fff"}}),e.jsx(Td,{size:12,color:u.completado?Re.green:new Date(u.fecha)<new Date?Re.red:Re.amber}),e.jsx("button",{onClick:()=>b(S=>S.filter(A=>A.id!==u.id)),style:{background:"none",border:"none",color:Re.red,cursor:"pointer"},children:e.jsx(He,{size:12})})]},u.id))]}),t==="tablero"&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12},children:[{id:"pendiente",label:"Pendiente",color:Re.inkLight,bg:Re.surfaceAlt},{id:"en_curso",label:"En curso",color:Re.blue,bg:Re.blueBg},{id:"revision",label:"En revisin",color:Re.amber,bg:Re.amberBg},{id:"completado",label:"Completado",color:Re.green,bg:Re.greenBg}].map(u=>{const S=m.filter(A=>u.id==="completado"?A.avance>=100:u.id==="revision"?A.avance>=80&&A.avance<100:u.id==="en_curso"?A.avance>0&&A.avance<80:!A.avance||A.avance===0);return e.jsxs("div",{children:[e.jsxs("div",{style:{padding:"8px 12px",background:u.bg,borderRadius:"6px 6px 0 0",border:`1px solid ${Re.border}`,borderBottom:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:700,color:u.color},children:u.label}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:u.color,background:u.color+"22",padding:"1px 6px",borderRadius:8},children:S.length})]}),e.jsx("div",{style:{border:`1px solid ${Re.border}`,borderRadius:"0 0 6px 6px",minHeight:120,background:"#fff",padding:6},children:S.map(A=>e.jsxs("div",{style:{padding:"8px 10px",marginBottom:4,background:Re.surfaceAlt,borderRadius:4,border:`1px solid ${Re.border}`,fontSize:11},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:2},children:A.nombre}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:Re.inkLight},children:[e.jsx("span",{children:A.responsable||""}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[A.avance||0,"%"]})]})]},A.id))})]},u.id)})}),t==="equipo"&&e.jsxs(fo,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Asignacin de recursos"}),(()=>{const u=[...new Set(m.map(S=>S.responsable).filter(Boolean))];return u.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:Re.inkLight},children:"Asigna responsables en las actividades del Cronograma"}):u.map(S=>{const A=m.filter(w=>w.responsable===S),E=A.reduce((w,_)=>w+(_.avance||0),0)/A.length;return e.jsxs("div",{style:{marginBottom:14,padding:"12px 16px",background:Re.surfaceAlt,borderRadius:6,border:`1px solid ${Re.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[" ",S]}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:Re.purple},children:[A.length," tareas  ",nn(E),"% avance"]})]}),A.map(w=>e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",fontSize:10,padding:"3px 0"},children:[e.jsx("span",{style:{flex:1},children:w.nombre}),e.jsx("div",{style:{width:60,height:4,background:Re.border,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${w.avance||0}%`,background:Re.purple,borderRadius:2}})}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,minWidth:24,textAlign:"right"},children:[w.avance||0,"%"]})]},w.id))]},S)})})()]})]}):e.jsxs("div",{style:{textAlign:"center",padding:60,color:Re.inkLight},children:[e.jsx(Ks,{size:40,style:{opacity:.3,marginBottom:12}}),e.jsx("div",{style:{fontSize:16,fontWeight:600,marginBottom:4},children:"Selecciona o crea un proyecto"}),e.jsx("div",{style:{fontSize:12,marginBottom:16},children:"Gestiona cronogramas, avances, hitos y equipo"}),e.jsxs(ss,{on:k,children:[e.jsx(Oe,{size:12})," Crear proyecto"]})]})})]})]})]})}const Xf=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Ge={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",teal:"#0D5E6E",tealBg:"#E0F4F4",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Ti=()=>Math.random().toString(36).slice(2,9),ls=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"";function ds(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Ee.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const a=F.useCallback(async r=>{const s=typeof r=="function"?r(o):r;n(s);try{Ee.set(t,JSON.stringify(s))}catch{}},[t,o]);return[o,a]}const Wn=({children:t,style:i})=>e.jsx("div",{style:{background:Ge.surface,border:`1px solid ${Ge.border}`,borderRadius:8,boxShadow:Ge.shadow,...i},children:t}),xo=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Ge.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":Ge.ink,color:i==="sec"?Ge.inkMid:"#fff",...a},...r,children:t}),Hr=[{id:"dashboard",lbl:"Dashboard",I:lr,desc:"Resumen de la biblioteca"},{id:"apus",lbl:"APUs",I:lr,desc:"Anlisis de precios unitarios normalizados"},{id:"materiales",lbl:"Materiales",I:zn,desc:"Catlogo maestro de materiales y precios"},{id:"textos",lbl:"Textos tipo",I:Et,desc:"Plantillas de alcance, exclusiones y clusulas"},{id:"categorias",lbl:"Categoras",I:Bd,desc:"Organizacin por captulos y familias"}],Qf=[{id:Ti(),codigo:"APU-001",nombre:"Paete liso sobre muro e=1.5cm",unidad:"m",costo:28500,categoria:"Paetes",insumos:[{nombre:"Mortero 1:4",unidad:"m",cantidad:.018,precio:38e4},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.45,precio:22e3},{nombre:"Mano de obra ayudante",unidad:"h",cantidad:.35,precio:14e3},{nombre:"Herramienta menor",unidad:"gl",cantidad:.03,precio:5e4}]},{id:Ti(),codigo:"APU-002",nombre:"Mampostera en bloque No.5 e=12cm",unidad:"m",costo:62e3,categoria:"Mampostera",insumos:[{nombre:"Bloque No.5 (12x20x40)",unidad:"ud",cantidad:12.5,precio:2200},{nombre:"Mortero de pega 1:4",unidad:"m",cantidad:.015,precio:38e4},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.65,precio:22e3},{nombre:"Mano de obra ayudante",unidad:"h",cantidad:.5,precio:14e3}]},{id:Ti(),codigo:"APU-003",nombre:"Estuco sobre muro",unidad:"m",costo:18500,categoria:"Acabados",insumos:[{nombre:"Estuco plstico",unidad:"kg",cantidad:1.5,precio:3200},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.35,precio:22e3},{nombre:"Lija y herramienta",unidad:"gl",cantidad:.02,precio:3e4}]},{id:Ti(),codigo:"APU-004",nombre:"Pintura vinilo 2 manos tipo 1",unidad:"m",costo:14200,categoria:"Acabados",insumos:[{nombre:"Pintura vinilo tipo 1",unidad:"gl",cantidad:.065,precio:72e3},{nombre:"Rodillo y bandeja",unidad:"gl",cantidad:.01,precio:25e3},{nombre:"Mano de obra pintor",unidad:"h",cantidad:.3,precio:22e3}]},{id:Ti(),codigo:"APU-005",nombre:"Piso porcelanato 60x60",unidad:"m",costo:95e3,categoria:"Pisos",insumos:[{nombre:"Porcelanato 60x60",unidad:"m",cantidad:1.05,precio:55e3},{nombre:"Pegante para porcelanato",unidad:"kg",cantidad:5,precio:2800},{nombre:"Boquilla",unidad:"kg",cantidad:.5,precio:8500},{nombre:"Mano de obra enchapador",unidad:"h",cantidad:.8,precio:25e3}]}],Zf=[{id:Ti(),titulo:"Exclusiones estndar  Obra",categoria:"Exclusiones",texto:`Esta propuesta NO incluye, salvo acuerdo escrito:
- Licencias y permisos de construccin
- Obra de estructura o cimentacin no contemplada
- Suministro e instalacin de electrodomsticos
- Mudanzas y trasteos
- Diseo o rediseo arquitectnico
- Adecuaciones en zonas comunes
- Amoblamiento libre`},{id:Ti(),titulo:"Garantas estndar  Obra",categoria:"Garantas",texto:`Habitaris garantiza los trabajos ejecutados por un perodo de 12 meses:
- Estabilidad y solidez: 10 aos (Ley 1796)
- Impermeabilizacin: 5 aos
- Acabados y revestimientos: 1 ao
- Instalaciones: 1 ao
- Carpintera: 1 ao`},{id:Ti(),titulo:"Condiciones de pago  Obra integral",categoria:"Pagos",texto:`Forma de pago:
1. 50% Anticipo contra firma de contrato
2. 30% Contra avance del 50% de obra
3. 10% Contra finalizacin de obra
4. 10% Retencin de garanta (3 meses)`},{id:Ti(),titulo:"Trminos generales",categoria:"Trminos",texto:`Los precios incluyen materiales, mano de obra, herramienta y administracin.
Cualquier trabajo no contemplado se cotizar como adicional.
El cronograma podr ajustarse por fuerza mayor o cambios del cliente.`}];function ex(){var m,f;const[t,i]=F.useState("dashboard"),[o,n]=ds("hab:biblioteca:apus",[]),[a,r]=ds("hab:biblioteca:textos",[]),[s,g]=ds("hab:biblioteca:categorias",["Paetes","Mampostera","Acabados","Pisos","Instalaciones","Carpintera","Demoliciones","Impermeabilizacin"]),[h,b]=F.useState(""),[j,k]=F.useState(null),v={border:`1px solid ${Ge.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx(Xf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Ge.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Ge.surface,borderBottom:`1px solid ${Ge.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Ge.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Ge.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Ge.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Ge.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Ge.inkLight},children:"/ Biblioteca"})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:Ge.surface,borderRight:`1px solid ${Ge.border}`,paddingTop:8,overflowY:"auto"},children:Hr.map(p=>e.jsxs("button",{onClick:()=>i(p.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===p.id?`3px solid ${Ge.ink}`:"3px solid transparent",background:t===p.id?Ge.accent:"transparent",color:t===p.id?Ge.ink:Ge.inkLight,fontSize:12,fontWeight:t===p.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(p.I,{size:13})," ",p.lbl]},p.id))}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700},children:(m=Hr.find(p=>p.id===t))==null?void 0:m.lbl}),e.jsx("p",{style:{fontSize:11,color:Ge.inkLight,marginTop:2},children:(f=Hr.find(p=>p.id===t))==null?void 0:f.desc})]}),t==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" APUs",o.length,"#111"],[" Materiales",materiales.length,"#3B3B3B"],[" Textos tipo",a.length,"#5B3A8C"],[" Categoras",s.length,"#8C6A00"]].map(([p,d,c])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Ge.border}`,borderRadius:8,padding:"14px 16px",boxShadow:Ge.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:c},children:d})]},p))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12},children:Hr.filter(p=>p.id!=="dashboard").map(p=>e.jsxs("div",{onClick:()=>i(p.id),style:{background:Ge.surface,border:`1px solid ${Ge.border}`,borderRadius:8,padding:"18px 16px",cursor:"pointer",boxShadow:Ge.shadow},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx(p.I,{size:16,color:Ge.ink}),e.jsx("div",{style:{fontSize:13,fontWeight:700},children:p.lbl})]}),e.jsx("div",{style:{fontSize:10,color:Ge.inkLight},children:p.desc})]},p.id))})]}),t==="apus"&&e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsxs("div",{style:{position:"relative",flex:1},children:[e.jsx(Ci,{size:12,style:{position:"absolute",left:8,top:9,color:Ge.inkLight}}),e.jsx("input",{value:h,onChange:p=>b(p.target.value),placeholder:"Buscar APU...",style:{...v,width:"100%",paddingLeft:26}})]}),e.jsxs(xo,{sm:!0,on:()=>{const p={id:Ti(),codigo:`APU-${String(o.length+1).padStart(3,"0")}`,nombre:"Nuevo APU",unidad:"m",costo:0,categoria:"",insumos:[]};n(d=>[...d,p]),k(p.id)},children:[e.jsx(Oe,{size:10})," Nuevo APU"]}),o.length===0&&e.jsx(xo,{sm:!0,v:"sec",on:()=>n(Qf),children:" Cargar ejemplos"})]}),e.jsxs(Wn,{style:{padding:0,overflow:"hidden"},children:[o.filter(p=>!h||p.nombre.toLowerCase().includes(h.toLowerCase())||p.codigo.toLowerCase().includes(h.toLowerCase())).map(p=>e.jsxs("div",{style:{borderBottom:`1px solid ${Ge.border}`},children:[e.jsxs("div",{onClick:()=>k(j===p.id?null:p.id),style:{padding:"10px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:j===p.id?Ge.surfaceAlt:"transparent"},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:Ge.teal,background:Ge.tealBg,padding:"2px 6px",borderRadius:3},children:p.codigo}),e.jsx("span",{style:{flex:1,fontSize:12,fontWeight:600},children:p.nombre}),e.jsx("span",{style:{fontSize:9,color:Ge.inkLight,background:Ge.surfaceAlt,padding:"2px 6px",borderRadius:3},children:p.categoria||""}),e.jsx("span",{style:{fontSize:10,color:Ge.inkMid},children:p.unidad}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700,color:Ge.green},children:["$",ls(p.costo)]}),j===p.id?e.jsx(Yi,{size:12,style:{transform:"rotate(90deg)"}}):e.jsx(Yi,{size:12})]}),j===p.id&&e.jsxs("div",{style:{padding:"0 16px 14px",background:Ge.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Ge.inkLight,textTransform:"uppercase"},children:"Nombre"}),e.jsx("input",{value:p.nombre,onChange:d=>n(c=>c.map(l=>l.id===p.id?{...l,nombre:d.target.value}:l)),style:{...v,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Ge.inkLight,textTransform:"uppercase"},children:"Cdigo"}),e.jsx("input",{value:p.codigo,onChange:d=>n(c=>c.map(l=>l.id===p.id?{...l,codigo:d.target.value}:l)),style:{...v,width:"100%",fontFamily:"'DM Mono',monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Ge.inkLight,textTransform:"uppercase"},children:"Unidad"}),e.jsx("select",{value:p.unidad,onChange:d=>n(c=>c.map(l=>l.id===p.id?{...l,unidad:d.target.value}:l)),style:{...v,width:"100%"},children:["ud","m","m","m","ml","kg","gl","l","h","da"].map(d=>e.jsx("option",{children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Ge.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsxs("select",{value:p.categoria||"",onChange:d=>n(c=>c.map(l=>l.id===p.id?{...l,categoria:d.target.value}:l)),style:{...v,width:"100%"},children:[e.jsx("option",{value:"",children:""}),s.map(d=>e.jsx("option",{children:d},d))]})]})]}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Composicin"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:10},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Ge.accent},children:["Insumo","Und","Cantidad","P.Unit","Subtotal",""].map(d=>e.jsx("th",{style:{padding:"4px 8px",textAlign:d==="Subtotal"||d==="P.Unit"||d==="Cantidad"?"right":"left",fontSize:8,fontWeight:700,color:Ge.inkLight},children:d},d))})}),e.jsxs("tbody",{children:[(p.insumos||[]).map((d,c)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Ge.border}`},children:[e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{value:d.nombre,onChange:l=>{const x=[...p.insumos||[]];x[c]={...x[c],nombre:l.target.value},n(y=>y.map(u=>u.id===p.id?{...u,insumos:x}:u))},style:{border:"none",background:"transparent",width:"100%",fontSize:10}})}),e.jsx("td",{style:{padding:"4px 8px",width:40},children:e.jsx("input",{value:d.unidad,onChange:l=>{const x=[...p.insumos||[]];x[c]={...x[c],unidad:l.target.value},n(y=>y.map(u=>u.id===p.id?{...u,insumos:x}:u))},style:{border:"none",background:"transparent",width:30,fontSize:10,textAlign:"center"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:e.jsx("input",{type:"number",value:d.cantidad,onChange:l=>{const x=[...p.insumos||[]];x[c]={...x[c],cantidad:+l.target.value};const y=x.reduce((u,S)=>u+S.cantidad*S.precio,0);n(u=>u.map(S=>S.id===p.id?{...S,insumos:x,costo:Math.round(y)}:S))},style:{border:"none",background:"transparent",width:50,fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:e.jsx("input",{type:"number",value:d.precio,onChange:l=>{const x=[...p.insumos||[]];x[c]={...x[c],precio:+l.target.value};const y=x.reduce((u,S)=>u+S.cantidad*S.precio,0);n(u=>u.map(S=>S.id===p.id?{...S,insumos:x,costo:Math.round(y)}:S))},style:{border:"none",background:"transparent",width:70,fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",ls(Math.round(d.cantidad*d.precio))]}),e.jsx("td",{style:{padding:"4px 8px",width:24},children:e.jsx("button",{onClick:()=>{const l=(p.insumos||[]).filter((y,u)=>u!==c),x=l.reduce((y,u)=>y+u.cantidad*u.precio,0);n(y=>y.map(u=>u.id===p.id?{...u,insumos:l,costo:Math.round(x)}:u))},style:{background:"none",border:"none",color:Ge.red,cursor:"pointer"},children:e.jsx(He,{size:10})})})]},c)),e.jsxs("tr",{style:{background:Ge.greenBg},children:[e.jsx("td",{colSpan:4,style:{padding:"6px 8px",fontWeight:700,fontSize:11},children:"COSTO DIRECTO"}),e.jsxs("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:Ge.green},children:["$",ls(p.costo)]}),e.jsx("td",{})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs(xo,{sm:!0,v:"sec",on:()=>{const d=[...p.insumos||[],{nombre:"",unidad:"ud",cantidad:1,precio:0}];n(c=>c.map(l=>l.id===p.id?{...l,insumos:d}:l))},children:[e.jsx(Oe,{size:9})," Insumo"]}),e.jsxs(xo,{sm:!0,v:"sec",on:()=>{var d;return(d=navigator.clipboard)==null?void 0:d.writeText(JSON.stringify(p,null,2))},children:[e.jsx(fa,{size:9})," Copiar JSON"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{onClick:()=>n(d=>d.filter(c=>c.id!==p.id)),style:{background:"none",border:"none",color:Ge.red,fontSize:10,cursor:"pointer"},children:" Eliminar APU"})]})]})]},p.id)),o.length===0&&e.jsx("div",{style:{padding:30,textAlign:"center",color:Ge.inkLight},children:"Sin APUs. Carga los ejemplos o crea uno nuevo."})]})]}),t==="materiales"&&e.jsx("div",{className:"fade-up",children:e.jsxs(Wn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,marginBottom:4},children:"Catlogo maestro de materiales"}),e.jsx("div",{style:{fontSize:11,color:Ge.inkLight,marginBottom:14},children:"Los materiales del catlogo se sincronizan con el mdulo de Insumos del CRM."}),e.jsxs("div",{style:{padding:20,textAlign:"center",background:Ge.surfaceAlt,borderRadius:6,border:`1px solid ${Ge.border}`},children:[e.jsx(lr,{size:24,style:{color:Ge.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:Ge.inkMid},children:"El catlogo maestro se gestiona desde el tab de Insumos en cada oferta del CRM"}),e.jsx("div",{style:{fontSize:10,color:Ge.inkLight,marginTop:4},children:"Los precios de proveedores se centralizan all con cotizaciones comparativas"})]})]})}),t==="textos"&&e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsx("div",{style:{flex:1}}),e.jsxs(xo,{sm:!0,on:()=>r(p=>[...p,{id:Ti(),titulo:"Nuevo texto",categoria:"",texto:""}]),children:[e.jsx(Oe,{size:10})," Nuevo texto"]}),a.length===0&&e.jsx(xo,{sm:!0,v:"sec",on:()=>r(Zf),children:" Cargar ejemplos"})]}),a.map(p=>e.jsxs(Wn,{style:{padding:16,marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6,alignItems:"center"},children:[e.jsx("input",{value:p.titulo,onChange:d=>r(c=>c.map(l=>l.id===p.id?{...l,titulo:d.target.value}:l)),style:{flex:1,border:"none",background:"transparent",fontSize:14,fontWeight:700}}),e.jsxs("select",{value:p.categoria||"",onChange:d=>r(c=>c.map(l=>l.id===p.id?{...l,categoria:d.target.value}:l)),style:{...v,width:120,fontSize:10},children:[e.jsx("option",{value:"",children:"Sin categora"}),["Alcance","Exclusiones","Garantas","Pagos","Trminos","Legal","Otro"].map(d=>e.jsx("option",{children:d},d))]}),e.jsxs(xo,{sm:!0,v:"sec",on:()=>{var d;return(d=navigator.clipboard)==null?void 0:d.writeText(p.texto)},children:[e.jsx(fa,{size:9})," Copiar"]}),e.jsx("button",{onClick:()=>r(d=>d.filter(c=>c.id!==p.id)),style:{background:"none",border:"none",color:Ge.red,cursor:"pointer"},children:e.jsx(He,{size:12})})]}),e.jsx("textarea",{value:p.texto,onChange:d=>r(c=>c.map(l=>l.id===p.id?{...l,texto:d.target.value}:l)),rows:5,style:{width:"100%",border:`1px solid ${Ge.border}`,borderRadius:4,padding:"8px 10px",fontSize:11,resize:"vertical",lineHeight:1.6,background:Ge.surfaceAlt}})]},p.id)),a.length===0&&e.jsx(Wn,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Ge.inkLight},children:"Sin textos tipo. Carga los ejemplos o crea uno nuevo."})})]}),t==="categorias"&&e.jsx("div",{className:"fade-up",children:e.jsxs(Wn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Categoras de APUs"}),s.map((p,d)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 0",borderBottom:`1px solid ${Ge.border}`},children:[e.jsx(Bd,{size:12,color:Ge.teal}),e.jsx("input",{value:p,onChange:c=>{const l=[...s];l[d]=c.target.value,g(l)},style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:500}}),e.jsxs("span",{style:{fontSize:9,color:Ge.inkLight},children:[o.filter(c=>c.categoria===p).length," APUs"]}),e.jsx("button",{onClick:()=>g(c=>c.filter((l,x)=>x!==d)),style:{background:"none",border:"none",color:Ge.red,cursor:"pointer"},children:e.jsx(He,{size:11})})]},d)),e.jsxs(xo,{sm:!0,v:"sec",on:()=>g(p=>[...p,"Nueva categora"]),style:{marginTop:10},children:[e.jsx(Oe,{size:10})," Aadir categora"]})]})})]})]})]})]})}const tx=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Ne={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},ed=()=>Math.random().toString(36).slice(2,9),td=()=>new Date().toISOString().split("T")[0],_o=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"$0",ix=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function id(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Ee.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const a=F.useCallback(async r=>{const s=typeof r=="function"?r(o):r;n(s);try{Ee.set(t,JSON.stringify(s))}catch{}},[t,o]);return[o,a]}const rn=({children:t,style:i})=>e.jsx("div",{style:{background:Ne.surface,border:`1px solid ${Ne.border}`,borderRadius:8,boxShadow:Ne.shadow,...i},children:t}),Gr=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Ne.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":Ne.ink,color:i==="sec"?Ne.inkMid:"#fff",cursor:"pointer",...a},...r,children:t}),ox=[{id:"dashboard",lbl:"Dashboard",I:Ba,desc:"Resumen financiero del perodo"},{id:"ingresos",lbl:"Ingresos",I:Id,desc:"Facturacin, cobros y anticipos"},{id:"egresos",lbl:"Egresos",I:Rd,desc:"Pagos, compras y nmina"},{id:"facturas",lbl:"Facturas",I:_d,desc:"Emisin y seguimiento de facturas"},{id:"costos",lbl:"Costos reales",I:Md,desc:"Comparacin presupuesto vs ejecucin"},{id:"informes",lbl:"Informes",I:Et,desc:"Reportes financieros y tributarios"}];function nx(){const[t,i]=F.useState("dashboard"),[o,n]=id("hab:conta:movimientos",[]),[a,r]=id("hab:conta:facturas",[]),s=o.filter(d=>d.tipo==="ingreso"),g=o.filter(d=>d.tipo==="egreso"),h=s.reduce((d,c)=>d+(c.monto||0),0),b=g.reduce((d,c)=>d+(c.monto||0),0),j=h-b,k=d=>{const c={id:ed(),tipo:d,fecha:td(),concepto:"",monto:0,categoria:"",proyecto:"",estado:"registrado"};n(l=>[...l,c])},v=(d,c,l)=>n(x=>x.map(y=>y.id===d?{...y,[c]:l}:y)),m=d=>n(c=>c.filter(l=>l.id!==d)),f=()=>{const d={id:ed(),numero:`FV-${String(a.length+1).padStart(4,"0")}`,fecha:td(),cliente:"",concepto:"",subtotal:0,iva:0,total:0,estado:"borrador"};r(c=>[...c,d])},p={border:`1px solid ${Ne.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx(tx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Ne.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Ne.surface,borderBottom:`1px solid ${Ne.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Ne.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Ne.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Ne.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Ne.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Ne.inkLight},children:"/ Contabilidad"})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:Ne.surface,borderRight:`1px solid ${Ne.border}`,paddingTop:8},children:ox.map(d=>e.jsxs("button",{onClick:()=>i(d.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===d.id?`3px solid ${Ne.ink}`:"3px solid transparent",background:t===d.id?Ne.accent:"transparent",color:t===d.id?Ne.ink:Ne.inkLight,fontSize:12,fontWeight:t===d.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(d.I,{size:13})," ",d.lbl]},d.id))}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Ingresos",val:_o(h),color:Ne.green,bg:Ne.greenBg,icon:Id},{lbl:"Egresos",val:_o(b),color:Ne.red,bg:Ne.redBg,icon:Rd},{lbl:"Balance",val:_o(j),color:j>=0?Ne.green:Ne.red,bg:j>=0?Ne.greenBg:Ne.redBg,icon:Sr},{lbl:"Facturas",val:a.length,color:Ne.blue,bg:Ne.blueBg,icon:_d}].map(d=>e.jsx(rn,{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ne.inkLight,textTransform:"uppercase",letterSpacing:1},children:d.lbl}),e.jsx("div",{style:{fontSize:22,fontWeight:800,color:d.color,marginTop:4,fontFamily:"'DM Mono',monospace"},children:d.val})]}),e.jsx("div",{style:{width:32,height:32,borderRadius:8,background:d.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(d.icon,{size:16,color:d.color})})]})},d.lbl))}),e.jsxs(rn,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${Ne.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"ltimos movimientos"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(Gr,{sm:!0,on:()=>k("ingreso"),style:{background:Ne.green},children:[e.jsx(Oe,{size:10})," Ingreso"]}),e.jsxs(Gr,{sm:!0,on:()=>k("egreso"),style:{background:Ne.red},children:[e.jsx(Oe,{size:10})," Egreso"]})]})]}),o.length===0?e.jsx("div",{style:{padding:30,textAlign:"center",color:Ne.inkLight},children:"Sin movimientos registrados"}):[...o].sort((d,c)=>c.fecha>d.fecha?1:-1).slice(0,15).map(d=>e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11},children:[e.jsx("span",{style:{fontSize:14},children:d.tipo==="ingreso"?"":""}),e.jsx("span",{style:{fontSize:10,color:Ne.inkLight},children:ix(d.fecha)}),e.jsx("span",{style:{flex:1,fontWeight:500},children:d.concepto||"Sin concepto"}),d.proyecto&&e.jsx("span",{style:{fontSize:9,padding:"2px 6px",background:Ne.blueBg,color:Ne.blue,borderRadius:3},children:d.proyecto}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:d.tipo==="ingreso"?Ne.green:Ne.red},children:[d.tipo==="ingreso"?"+":"","$",_o(d.monto)]})]},d.id))]})]}),(t==="ingresos"||t==="egresos")&&(()=>{const d=t==="ingresos"?"ingreso":"egreso",c=o.filter(l=>l.tipo===d);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:t==="ingresos"?"Registro de ingresos":"Registro de egresos"}),e.jsxs(Gr,{sm:!0,on:()=>k(d),style:{background:d==="ingreso"?Ne.green:Ne.red},children:[e.jsx(Oe,{size:10})," Nuevo ",d]})]}),e.jsx(rn,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Ne.surfaceAlt},children:["Fecha","Concepto","Categora","Proyecto","Monto","Estado",""].map(l=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Ne.inkLight,textTransform:"uppercase",textAlign:l==="Monto"?"right":"left",borderBottom:`2px solid ${Ne.border}`},children:l},l))})}),e.jsxs("tbody",{children:[c.sort((l,x)=>x.fecha>l.fecha?1:-1).map(l=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Ne.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.fecha,onChange:x=>v(l.id,"fecha",x.target.value),style:{...p,padding:"3px 6px",fontSize:10,border:"none",background:"transparent"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.concepto,onChange:x=>v(l.id,"concepto",x.target.value),placeholder:"Concepto...",style:{border:"none",background:"transparent",fontSize:12,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsxs("select",{value:l.categoria||"",onChange:x=>v(l.id,"categoria",x.target.value),style:{...p,fontSize:10,padding:"3px 6px",border:"none",background:"transparent"},children:[e.jsx("option",{value:"",children:""}),(d==="ingreso"?["Anticipo","Corte de obra","Diseo","Consultora","Otro"]:["Materiales","Mano de obra","Subcontrato","Equipos","Transporte","Servicios","Otro"]).map(x=>e.jsx("option",{children:x},x))]})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.proyecto||"",onChange:x=>v(l.id,"proyecto",x.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right"},children:e.jsx("input",{type:"number",value:l.monto||"",onChange:x=>v(l.id,"monto",+x.target.value),style:{border:`1px solid ${Ne.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,width:100,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:l.estado,onChange:x=>v(l.id,"estado",x.target.value),style:{...p,fontSize:9,padding:"2px 6px"},children:["registrado","pendiente","pagado","anulado"].map(x=>e.jsx("option",{children:x},x))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>m(l.id),style:{background:"none",border:"none",color:Ne.red,cursor:"pointer"},children:e.jsx(He,{size:11})})})]},l.id)),c.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:7,style:{padding:20,textAlign:"center",color:Ne.inkLight},children:["Sin ",d,"s registrados"]})}),c.length>0&&e.jsxs("tr",{style:{background:d==="ingreso"?Ne.greenBg:Ne.redBg},children:[e.jsx("td",{colSpan:4,style:{padding:"8px 10px",fontWeight:700},children:"TOTAL"}),e.jsxs("td",{style:{padding:"8px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:d==="ingreso"?Ne.green:Ne.red},children:["$",_o(c.reduce((l,x)=>l+(x.monto||0),0))]}),e.jsx("td",{colSpan:2})]})]})]})})]})})(),t==="facturas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Facturacin"}),e.jsxs(Gr,{sm:!0,on:f,children:[e.jsx(Oe,{size:10})," Nueva factura"]})]}),e.jsx(rn,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Ne.surfaceAlt},children:["N","Fecha","Cliente","Concepto","Subtotal","IVA","Total","Estado",""].map(d=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Ne.inkLight,textTransform:"uppercase",textAlign:["Subtotal","IVA","Total"].includes(d)?"right":"left",borderBottom:`2px solid ${Ne.border}`},children:d},d))})}),e.jsxs("tbody",{children:[a.map(d=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Ne.border}`},children:[e.jsx("td",{style:{padding:"6px 10px",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:700},children:d.numero}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:d.fecha,onChange:c=>r(l=>l.map(x=>x.id===d.id?{...x,fecha:c.target.value}:x)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:d.cliente,onChange:c=>r(l=>l.map(x=>x.id===d.id?{...x,cliente:c.target.value}:x)),placeholder:"Cliente",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:d.concepto,onChange:c=>r(l=>l.map(x=>x.id===d.id?{...x,concepto:c.target.value}:x)),placeholder:"Concepto",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right"},children:e.jsx("input",{type:"number",value:d.subtotal||"",onChange:c=>{const l=+c.target.value,x=Math.round(l*.19);r(y=>y.map(u=>u.id===d.id?{...u,subtotal:l,iva:x,total:l+x}:u))},style:{border:`1px solid ${Ne.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,width:80,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:Ne.inkLight},children:_o(d.iva)}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700},children:_o(d.total)}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:d.estado,onChange:c=>r(l=>l.map(x=>x.id===d.id?{...x,estado:c.target.value}:x)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Ne.border}`,borderRadius:3,background:d.estado==="pagada"?Ne.greenBg:d.estado==="enviada"?Ne.blueBg:"#fff"},children:["borrador","enviada","pagada","anulada"].map(c=>e.jsx("option",{children:c},c))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>r(c=>c.filter(l=>l.id!==d.id)),style:{background:"none",border:"none",color:Ne.red,cursor:"pointer"},children:e.jsx(He,{size:11})})})]},d.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:30,textAlign:"center",color:Ne.inkLight},children:"Sin facturas"})})]})]})})]}),t==="costos"&&e.jsxs(rn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:4},children:"Control de costos reales"}),e.jsx("div",{style:{fontSize:11,color:Ne.inkLight,marginBottom:14},children:"Comparacin entre presupuesto aprobado y ejecucin real"}),e.jsxs("div",{style:{padding:30,textAlign:"center",background:Ne.surfaceAlt,borderRadius:6,border:`1px solid ${Ne.border}`},children:[e.jsx(Md,{size:32,style:{color:Ne.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:Ne.inkMid},children:"Se alimenta automticamente de los egresos registrados por proyecto"}),e.jsx("div",{style:{fontSize:10,color:Ne.inkLight,marginTop:4},children:"Registra egresos asociados a un proyecto para ver el comparativo"})]})]}),t==="informes"&&e.jsxs(rn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Informes financieros"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[{lbl:"Estado de resultados",desc:"P&L por perodo con ingresos y gastos",icon:""},{lbl:"Flujo de caja real",desc:"Entradas y salidas por mes",icon:""},{lbl:"Cuentas por cobrar",desc:"Facturas pendientes de cobro",icon:""},{lbl:"Cuentas por pagar",desc:"Obligaciones pendientes con proveedores",icon:""},{lbl:"Retenciones",desc:"Retencin en la fuente, ICA, IVA",icon:""},{lbl:"Reporte DIAN",desc:"Informacin exgena y declaraciones",icon:""}].map(d=>e.jsxs("div",{style:{padding:"14px 16px",background:Ne.surfaceAlt,borderRadius:6,border:`1px solid ${Ne.border}`,cursor:"pointer"},onMouseEnter:c=>c.currentTarget.style.borderColor=Ne.blue,onMouseLeave:c=>c.currentTarget.style.borderColor=Ne.border,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:18},children:d.icon}),e.jsx("span",{style:{fontSize:12,fontWeight:700},children:d.lbl})]}),e.jsx("div",{style:{fontSize:10,color:Ne.inkLight},children:d.desc})]},d.lbl))})]})]})})]})]})]})}const rx=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Be={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Nn=()=>Math.random().toString(36).slice(2,9),Un=()=>new Date().toISOString().split("T")[0];function Vn(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Ee.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const a=F.useCallback(async r=>{const s=typeof r=="function"?r(o):r;n(s);try{Ee.set(t,JSON.stringify(s))}catch{}},[t,o]);return[o,a]}const _i=({children:t,style:i})=>e.jsx("div",{style:{background:Be.surface,border:`1px solid ${Be.border}`,borderRadius:8,boxShadow:Be.shadow,...i},children:t}),qn=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Be.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":Be.ink,color:i==="sec"?Be.inkMid:"#fff",cursor:"pointer",...a},...r,children:t}),ax=[{id:"dashboard",lbl:"Dashboard",I:Kc,desc:"Indicadores de seguridad"},{id:"inspecciones",lbl:"Inspecciones",I:Jc,desc:"Inspecciones programadas y realizadas"},{id:"incidentes",lbl:"Incidentes",I:li,desc:"Registro de accidentes e incidentes"},{id:"riesgos",lbl:"Matriz de riesgos",I:Bn,desc:"Identificacin y valoracin de riesgos"},{id:"capacitaciones",lbl:"Capacitaciones",I:Bi,desc:"Programa de formacin SST"},{id:"permisos",lbl:"Permisos trabajo",I:Et,desc:"Permisos de trabajo en alturas, caliente, confinado"},{id:"epps",lbl:"EPPs",I:sr,desc:"Control de entrega de EPPs y dotacin"}],sx=["Cada de alturas","Elctrico","Mecnico","Qumico","Biolgico","Ergonmico","Psicosocial","Trabajo en caliente","Espacio confinado","Excavaciones"],cs=[{id:1,lbl:"Bajo",color:Be.green,bg:Be.greenBg},{id:2,lbl:"Medio",color:Be.amber,bg:Be.amberBg},{id:3,lbl:"Alto",color:"#D4840A",bg:"#FFF3E0"},{id:4,lbl:"Crtico",color:Be.red,bg:Be.redBg}];function lx(){const[t,i]=F.useState("dashboard"),[o,n]=Vn("hab:sst:inspecciones",[]),[a,r]=Vn("hab:sst:incidentes",[]),[s,g]=Vn("hab:sst:riesgos",[]),[h,b]=Vn("hab:sst:capacitaciones",[]),[j,k]=Vn("hab:sst:permisos",[]),v={border:`1px solid ${Be.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},m=(()=>{if(a.length===0)return"";const f=[...a].sort((p,d)=>d.fecha>p.fecha?1:-1)[0];return Math.floor((Date.now()-new Date(f.fecha).getTime())/864e5)})();return e.jsxs(e.Fragment,{children:[e.jsx(rx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Be.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Be.surface,borderBottom:`1px solid ${Be.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Be.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Be.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Be.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Be.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Be.inkLight},children:"/ SST"}),e.jsx("div",{style:{flex:1}}),a.filter(f=>f.estado==="abierto").length>0&&e.jsxs("div",{style:{background:Be.redBg,border:`1px solid ${Be.red}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(li,{size:12,color:Be.red}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:Be.red},children:[a.filter(f=>f.estado==="abierto").length," incidente",a.filter(f=>f.estado==="abierto").length!==1?"s":""," abierto",a.filter(f=>f.estado==="abierto").length!==1?"s":""]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:210,flexShrink:0,background:Be.surface,borderRight:`1px solid ${Be.border}`,paddingTop:8,overflowY:"auto"},children:ax.map(f=>{const p=t===f.id,d=f.id==="incidentes"?a.filter(c=>c.estado==="abierto").length:f.id==="inspecciones"?o.filter(c=>c.estado==="pendiente").length:0;return e.jsxs("button",{onClick:()=>i(f.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:p?`3px solid ${Be.ink}`:"3px solid transparent",background:p?Be.accent:"transparent",color:p?Be.ink:Be.inkLight,fontSize:12,fontWeight:p?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(f.I,{size:13})," ",e.jsx("span",{style:{flex:1},children:f.lbl}),d>0&&e.jsx("span",{style:{background:Be.red,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:d})]},f.id)})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Das sin incidentes",val:m,color:Be.green,bg:Be.greenBg},{lbl:"Inspecciones mes",val:o.filter(f=>{const p=new Date(f.fecha),d=new Date;return p.getMonth()===d.getMonth()&&p.getFullYear()===d.getFullYear()}).length,color:Be.blue,bg:Be.blueBg},{lbl:"Incidentes abiertos",val:a.filter(f=>f.estado==="abierto").length,color:Be.red,bg:Be.redBg},{lbl:"Riesgos altos",val:s.filter(f=>f.severidad>=3).length,color:Be.amber,bg:Be.amberBg},{lbl:"Capacitaciones",val:h.length,color:"#5B3A8C",bg:"#F0ECF6"}].map(f=>e.jsxs(_i,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Be.inkLight,textTransform:"uppercase",letterSpacing:1},children:f.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:f.color,marginTop:4},children:f.val})]},f.lbl))}),e.jsxs(_i,{style:{padding:24,marginBottom:16,background:m===""||m>30?Be.greenBg:m>7?Be.amberBg:Be.redBg,border:`1px solid ${m===""||m>30?Be.green:m>7?Be.amber:Be.red}33`,textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:48,fontWeight:800,color:m===""||m>30?Be.green:m>7?Be.amber:Be.red},children:[" ",m]}),e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Be.ink,marginTop:4},children:"Das sin incidentes"}),e.jsx("div",{style:{fontSize:11,color:Be.inkMid},children:"Seguridad es responsabilidad de todos"})]})]}),t==="inspecciones"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Inspecciones de seguridad"}),e.jsxs(qn,{sm:!0,on:()=>n(f=>[...f,{id:Nn(),fecha:Un(),tipo:"General",ubicacion:"",inspector:"",estado:"pendiente",hallazgos:"",calificacion:0}]),children:[e.jsx(Oe,{size:10})," Nueva inspeccin"]})]}),e.jsx(_i,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Be.surfaceAlt},children:["Fecha","Tipo","Ubicacin","Inspector","Estado","Hallazgos","Calif.",""].map(f=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Be.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${Be.border}`},children:f},f))})}),e.jsxs("tbody",{children:[o.sort((f,p)=>p.fecha>f.fecha?1:-1).map(f=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Be.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:f.fecha,onChange:p=>n(d=>d.map(c=>c.id===f.id?{...c,fecha:p.target.value}:c)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.tipo,onChange:p=>n(d=>d.map(c=>c.id===f.id?{...c,tipo:p.target.value}:c)),style:{border:"none",background:"transparent",fontSize:11},children:["General","Alturas","Elctrica","Orden y aseo","EPPs","Herramientas","Sealizacin","Excavaciones"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.ubicacion,onChange:p=>n(d=>d.map(c=>c.id===f.id?{...c,ubicacion:p.target.value}:c)),placeholder:"Zona...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.inspector,onChange:p=>n(d=>d.map(c=>c.id===f.id?{...c,inspector:p.target.value}:c)),placeholder:"Nombre",style:{border:"none",background:"transparent",fontSize:11,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.estado,onChange:p=>n(d=>d.map(c=>c.id===f.id?{...c,estado:p.target.value}:c)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3,background:f.estado==="realizada"?Be.greenBg:f.estado==="pendiente"?Be.amberBg:"#fff"},children:["pendiente","realizada","cancelada"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.hallazgos||"",onChange:p=>n(d=>d.map(c=>c.id===f.id?{...c,hallazgos:p.target.value}:c)),placeholder:"Observaciones...",style:{border:"none",background:"transparent",fontSize:10,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"number",min:0,max:100,value:f.calificacion||"",onChange:p=>n(d=>d.map(c=>c.id===f.id?{...c,calificacion:+p.target.value}:c)),style:{width:36,border:`1px solid ${Be.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>n(p=>p.filter(d=>d.id!==f.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(He,{size:11})})})]},f.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:Be.inkLight},children:"Sin inspecciones"})})]})]})})]}),t==="incidentes"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Registro de incidentes"}),e.jsxs(qn,{sm:!0,on:()=>r(f=>[...f,{id:Nn(),fecha:Un(),tipo:"Incidente",descripcion:"",ubicacion:"",personas:"",severidad:1,estado:"abierto",accionCorrectiva:""}]),style:{background:Be.red},children:[e.jsx(Oe,{size:10})," Reportar incidente"]})]}),a.sort((f,p)=>p.fecha>f.fecha?1:-1).map(f=>{const p=cs.find(d=>d.id===f.severidad)||cs[0];return e.jsx(_i,{style:{padding:14,marginBottom:8,borderLeft:`4px solid ${p.color}`},children:e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"2px 6px",borderRadius:3,background:p.bg,color:p.color},children:p.lbl}),e.jsx("select",{value:f.tipo,onChange:d=>r(c=>c.map(l=>l.id===f.id?{...l,tipo:d.target.value}:l)),style:{border:"none",background:"transparent",fontSize:10,fontWeight:600},children:["Incidente","Accidente","Casi-accidente","Condicin insegura","Acto inseguro"].map(d=>e.jsx("option",{children:d},d))}),e.jsx("input",{type:"date",value:f.fecha,onChange:d=>r(c=>c.map(l=>l.id===f.id?{...l,fecha:d.target.value}:l)),style:{border:"none",background:"transparent",fontSize:10,color:Be.inkLight}}),e.jsx("div",{style:{flex:1}}),e.jsx("select",{value:f.estado,onChange:d=>r(c=>c.map(l=>l.id===f.id?{...l,estado:d.target.value}:l)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3,background:f.estado==="cerrado"?Be.greenBg:Be.redBg},children:["abierto","en investigacin","cerrado"].map(d=>e.jsx("option",{children:d},d))}),e.jsx("select",{value:f.severidad,onChange:d=>r(c=>c.map(l=>l.id===f.id?{...l,severidad:+d.target.value}:l)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3},children:cs.map(d=>e.jsx("option",{value:d.id,children:d.lbl},d.id))})]}),e.jsx("textarea",{value:f.descripcion,onChange:d=>r(c=>c.map(l=>l.id===f.id?{...l,descripcion:d.target.value}:l)),placeholder:"Descripcin del incidente...",rows:2,style:{width:"100%",border:`1px solid ${Be.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,resize:"vertical",background:Be.surfaceAlt}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:6},children:[e.jsx("input",{value:f.ubicacion||"",onChange:d=>r(c=>c.map(l=>l.id===f.id?{...l,ubicacion:d.target.value}:l)),placeholder:" Ubicacin",style:{...v,fontSize:10}}),e.jsx("input",{value:f.personas||"",onChange:d=>r(c=>c.map(l=>l.id===f.id?{...l,personas:d.target.value}:l)),placeholder:" Personas involucradas",style:{...v,fontSize:10}})]}),e.jsx("input",{value:f.accionCorrectiva||"",onChange:d=>r(c=>c.map(l=>l.id===f.id?{...l,accionCorrectiva:d.target.value}:l)),placeholder:" Accin correctiva...",style:{...v,width:"100%",fontSize:10,marginTop:6}})]}),e.jsx("button",{onClick:()=>r(d=>d.filter(c=>c.id!==f.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(He,{size:12})})]})},f.id)}),a.length===0&&e.jsx(_i,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Be.inkLight},children:"Sin incidentes registrados "})})]}),t==="riesgos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Matriz de riesgos"}),e.jsxs(qn,{sm:!0,on:()=>g(f=>[...f,{id:Nn(),tipo:"Cada de alturas",actividad:"",control:"",severidad:2,probabilidad:2,responsable:""}]),children:[e.jsx(Oe,{size:10})," Nuevo riesgo"]})]}),e.jsx(_i,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Be.surfaceAlt},children:["Tipo de riesgo","Actividad","Control existente","Sev.","Prob.","Nivel","Responsable",""].map(f=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Be.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${Be.border}`},children:f},f))})}),e.jsxs("tbody",{children:[s.map(f=>{const p=(f.severidad||1)*(f.probabilidad||1),d=p>=9?Be.red:p>=4?Be.amber:Be.green;return e.jsxs("tr",{style:{borderBottom:`1px solid ${Be.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.tipo,onChange:c=>g(l=>l.map(x=>x.id===f.id?{...x,tipo:c.target.value}:x)),style:{border:"none",background:"transparent",fontSize:11,fontWeight:600},children:sx.map(c=>e.jsx("option",{children:c},c))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.actividad||"",onChange:c=>g(l=>l.map(x=>x.id===f.id?{...x,actividad:c.target.value}:x)),placeholder:"Actividad...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.control||"",onChange:c=>g(l=>l.map(x=>x.id===f.id?{...x,control:c.target.value}:x)),placeholder:"Medida de control...",style:{border:"none",background:"transparent",fontSize:10,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.severidad,onChange:c=>g(l=>l.map(x=>x.id===f.id?{...x,severidad:+c.target.value}:x)),style:{width:42,fontSize:10,border:`1px solid ${Be.border}`,borderRadius:3,textAlign:"center"},children:[1,2,3,4].map(c=>e.jsx("option",{value:c,children:c},c))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.probabilidad,onChange:c=>g(l=>l.map(x=>x.id===f.id?{...x,probabilidad:+c.target.value}:x)),style:{width:42,fontSize:10,border:`1px solid ${Be.border}`,borderRadius:3,textAlign:"center"},children:[1,2,3,4].map(c=>e.jsx("option",{value:c,children:c},c))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("span",{style:{fontSize:10,fontWeight:700,padding:"2px 8px",borderRadius:3,background:d+"18",color:d},children:p})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.responsable||"",onChange:c=>g(l=>l.map(x=>x.id===f.id?{...x,responsable:c.target.value}:x)),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>g(c=>c.filter(l=>l.id!==f.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(He,{size:11})})})]},f.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:Be.inkLight},children:"Sin riesgos identificados"})})]})]})})]}),t==="capacitaciones"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Programa de capacitaciones"}),e.jsxs(qn,{sm:!0,on:()=>b(f=>[...f,{id:Nn(),fecha:Un(),tema:"",duracion:1,instructor:"",asistentes:0,estado:"programada"}]),children:[e.jsx(Oe,{size:10})," Nueva capacitacin"]})]}),h.sort((f,p)=>p.fecha>f.fecha?1:-1).map(f=>e.jsx(_i,{style:{padding:14,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("input",{type:"date",value:f.fecha,onChange:p=>b(d=>d.map(c=>c.id===f.id?{...c,fecha:p.target.value}:c)),style:{border:`1px solid ${Be.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:f.tema,onChange:p=>b(d=>d.map(c=>c.id===f.id?{...c,tema:p.target.value}:c)),placeholder:"Tema de la capacitacin",style:{flex:1,border:"none",background:"transparent",fontSize:13,fontWeight:600}}),e.jsx("span",{style:{fontSize:9,color:Be.inkLight},children:"Duracin:"}),e.jsx("input",{type:"number",value:f.duracion,onChange:p=>b(d=>d.map(c=>c.id===f.id?{...c,duracion:+p.target.value}:c)),style:{width:36,border:`1px solid ${Be.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center"}}),e.jsx("span",{style:{fontSize:9,color:Be.inkLight},children:"h"}),e.jsx("input",{value:f.instructor||"",onChange:p=>b(d=>d.map(c=>c.id===f.id?{...c,instructor:p.target.value}:c)),placeholder:"Instructor",style:{width:100,border:`1px solid ${Be.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("span",{style:{fontSize:9,color:Be.inkLight},children:"Asist:"}),e.jsx("input",{type:"number",value:f.asistentes||"",onChange:p=>b(d=>d.map(c=>c.id===f.id?{...c,asistentes:+p.target.value}:c)),style:{width:36,border:`1px solid ${Be.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center"}}),e.jsx("select",{value:f.estado,onChange:p=>b(d=>d.map(c=>c.id===f.id?{...c,estado:p.target.value}:c)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3,background:f.estado==="realizada"?Be.greenBg:"#fff"},children:["programada","realizada","cancelada"].map(p=>e.jsx("option",{children:p},p))}),e.jsx("button",{onClick:()=>b(p=>p.filter(d=>d.id!==f.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(He,{size:11})})]})},f.id)),h.length===0&&e.jsx(_i,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Be.inkLight},children:"Sin capacitaciones programadas"})})]}),t==="permisos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Permisos de trabajo"}),e.jsxs(qn,{sm:!0,on:()=>k(f=>[...f,{id:Nn(),fecha:Un(),tipo:"Alturas",actividad:"",ubicacion:"",responsable:"",vigencia:Un(),estado:"activo"}]),children:[e.jsx(Oe,{size:10})," Nuevo permiso"]})]}),e.jsx(_i,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Be.surfaceAlt},children:["Fecha","Tipo","Actividad","Ubicacin","Responsable","Vigencia","Estado",""].map(f=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Be.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${Be.border}`},children:f},f))})}),e.jsxs("tbody",{children:[j.sort((f,p)=>p.fecha>f.fecha?1:-1).map(f=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Be.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:f.fecha,onChange:p=>k(d=>d.map(c=>c.id===f.id?{...c,fecha:p.target.value}:c)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.tipo,onChange:p=>k(d=>d.map(c=>c.id===f.id?{...c,tipo:p.target.value}:c)),style:{border:"none",background:"transparent",fontSize:11,fontWeight:600},children:["Alturas","Trabajo en caliente","Espacio confinado","Excavaciones","Elctrico","Izaje de cargas"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.actividad||"",onChange:p=>k(d=>d.map(c=>c.id===f.id?{...c,actividad:p.target.value}:c)),placeholder:"Actividad...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.ubicacion||"",onChange:p=>k(d=>d.map(c=>c.id===f.id?{...c,ubicacion:p.target.value}:c)),placeholder:"Zona",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.responsable||"",onChange:p=>k(d=>d.map(c=>c.id===f.id?{...c,responsable:p.target.value}:c)),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:f.vigencia,onChange:p=>k(d=>d.map(c=>c.id===f.id?{...c,vigencia:p.target.value}:c)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.estado,onChange:p=>k(d=>d.map(c=>c.id===f.id?{...c,estado:p.target.value}:c)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Be.border}`,borderRadius:3,background:f.estado==="activo"?Be.greenBg:Be.redBg},children:["activo","cerrado","cancelado"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>k(p=>p.filter(d=>d.id!==f.id)),style:{background:"none",border:"none",color:Be.red,cursor:"pointer"},children:e.jsx(He,{size:11})})})]},f.id)),j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:Be.inkLight},children:"Sin permisos"})})]})]})})]}),t==="epps"&&e.jsxs(_i,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:4},children:"Control de EPPs y dotacin"}),e.jsx("div",{style:{fontSize:11,color:Be.inkLight,marginBottom:14},children:"El inventario de EPPs se gestiona desde el mdulo de Logstica"}),e.jsxs("div",{style:{padding:20,textAlign:"center",background:Be.surfaceAlt,borderRadius:6,border:`1px solid ${Be.border}`},children:[e.jsx(sr,{size:32,style:{color:Be.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:Be.inkMid},children:"El control de entrega y reposicin se sincroniza con Logstica  EPPs"})]})]})]})})]})]})]})}const ne={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",success:"#111111",successBg:"#EBEBEB",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},Ae={fontFamily:"'DM Sans',sans-serif"},yc="hab:formacion:",Kr=t=>{try{return JSON.parse(Ee.getSync(yc+t))||null}catch{return null}},Jr=(t,i)=>{Ee.set(yc+t,JSON.stringify(i))},da=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),Hn=[{id:"legal_sst",label:"Legal / SST",icon:"",color:"#B91C1C"},{id:"legal_corp",label:"Legal Corporativo",icon:"",color:"#3B3B3B"},{id:"operativo",label:"Operativo / Diseo",icon:"",color:"#5B3A8C"},{id:"admin",label:"Administrativo",icon:"",color:"#8C6A00"},{id:"tech",label:"Tecnologa / Herramientas",icon:"",color:"#0D5E6E"},{id:"cliente",label:"Atencin al Cliente",icon:"",color:"#111111"}],dx=[{id:"co_sst_induccion",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Induccin SG-SST",duracionMin:60,desc:"Induccin obligatoria al Sistema de Gestin de Seguridad y Salud en el Trabajo. Decreto 1072/2015, Art. 2.2.4.6.11.",contenido:"Poltica SST de la empresa, peligros y riesgos del cargo, plan de emergencias, reporte de incidentes, derechos y deberes del trabajador.",normativa:"Decreto 1072/2015  Resolucin 0312/2019",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_alturas",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Trabajo Seguro en Alturas",duracionMin:480,desc:"Curso obligatorio para todo trabajador que realice labores a 1.5m o ms sobre nivel inferior. Resolucin 4272/2021.",contenido:"Marco normativo, sistemas de proteccin contra cadas, permisos de trabajo, procedimientos de rescate, prcticas en campo.",normativa:"Resolucin 4272/2021  Resolucin 1409/2012",vigenciaMeses:12,renovable:!0,aplica:["obra","supervisores","instaladores"]},{id:"co_sst_primeros_auxilios",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Primeros Auxilios",duracionMin:120,desc:"Formacin bsica en primeros auxilios para brigadistas y personal designado. Decreto 1072/2015.",contenido:"Evaluacin de la escena, RCP bsico, control de hemorragias, inmovilizacin, quemaduras, traslado de heridos.",normativa:"Decreto 1072/2015  Resolucin 0312/2019",vigenciaMeses:24,renovable:!0,aplica:["brigadistas","obra"]},{id:"co_sst_emergencias",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Plan de Emergencias y Evacuacin",duracionMin:60,desc:"Capacitacin sobre el plan de emergencias de la empresa: rutas de evacuacin, puntos de encuentro, roles.",contenido:"Tipos de emergencia, alarmas, roles del brigadista, evacuacin, uso de extintores, simulacros.",normativa:"Decreto 1072/2015 Art. 2.2.4.6.25",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_ergonomia",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Biomecnico / Ergonoma",duracionMin:60,desc:"Prevencin de lesiones osteomusculares por posturas prolongadas, movimientos repetitivos y manejo de cargas.",contenido:"Higiene postural en oficina, pausas activas, levantamiento seguro de cargas, diseo del puesto de trabajo.",normativa:"Decreto 1072/2015  GTC 45",vigenciaMeses:12,renovable:!0,aplica:["oficina","todos"]},{id:"co_sst_quimicos",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Manejo Seguro de Productos Qumicos",duracionMin:60,desc:"Identificacin y manejo de pinturas, solventes, adhesivos y materiales peligrosos usados en remodelacin.",contenido:"SGA (Sistema Globalmente Armonizado), hojas de seguridad, almacenamiento, EPP, derrames, disposicin.",normativa:"Decreto 1496/2018  GTC 45",vigenciaMeses:12,renovable:!0,aplica:["obra","instaladores"]},{id:"co_sst_psicosocial",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Psicosocial y Salud Mental",duracionMin:60,desc:"Identificacin y prevencin de factores de riesgo psicosocial: estrs, acoso laboral, burnout.",contenido:"Resolucin 2646/2008, batera de riesgo psicosocial, estrategias de afrontamiento, canales de apoyo.",normativa:"Resolucin 2646/2008  Ley 1616/2013",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_electrico",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Elctrico (RETIE)",duracionMin:120,desc:"Seguridad en instalaciones elctricas durante remodelacin. Obligatorio si hay intervencin elctrica.",contenido:"RETIE, 5 reglas de oro, bloqueo/etiquetado, EPP dielctricos, permisos de trabajo.",normativa:"RETIE  Resolucin 90708/2013",vigenciaMeses:24,renovable:!0,aplica:["instaladores","obra"]},{id:"co_sst_espacios",pais:"CO",cat:"legal_sst",obligatorio:!1,nombre:"Espacios Confinados",duracionMin:120,desc:"Procedimientos para trabajos en espacios confinados (stanos, tanques, ductos).",contenido:"Identificacin de espacios confinados, monitoreo atmosfrico, permisos, rescate.",normativa:"Resolucin 0491/2020",vigenciaMeses:12,renovable:!0,aplica:["obra"]},{id:"co_datos",pais:"CO",cat:"legal_corp",obligatorio:!0,nombre:"Proteccin de Datos Personales (Habeas Data)",duracionMin:60,desc:"Ley 1581/2012 de proteccin de datos personales. Obligatorio para todo empleado que maneje datos de clientes.",contenido:"Principios de tratamiento de datos, autorizacin, derechos ARCO, incidentes de seguridad, responsabilidad.",normativa:"Ley 1581/2012  Decreto 1377/2013",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_acoso",pais:"CO",cat:"legal_corp",obligatorio:!0,nombre:"Prevencin del Acoso Laboral",duracionMin:60,desc:"Ley 1010/2006 de acoso laboral. Todo trabajador debe conocer conductas, mecanismos de denuncia y comit de convivencia.",contenido:"Tipos de acoso, comit de convivencia laboral, procedimiento de queja, medidas preventivas y correctivas.",normativa:"Ley 1010/2006  Resolucin 2646/2008",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_laft",pais:"CO",cat:"legal_corp",obligatorio:!1,nombre:"Prevencin LAFT (Lavado de Activos)",duracionMin:60,desc:"Prevencin de lavado de activos y financiacin del terrorismo. Recomendado para empresas con contratos de alto valor.",contenido:"Seales de alerta, debida diligencia, reporte de operaciones sospechosas, SAGRILAFT.",normativa:"Circular Externa SFC 055/2016",vigenciaMeses:12,renovable:!0,aplica:["directivos","comercial"]},{id:"co_nsr10",pais:"CO",cat:"operativo",obligatorio:!1,nombre:"Norma Sismo Resistente NSR-10",duracionMin:120,desc:"Conocimiento de la NSR-10 aplicable a diseo y remodelacin de estructuras.",contenido:"Ttulos A (requisitos generales), J (proteccin contra incendio), K (requisitos complementarios para diseo arquitectnico).",normativa:"NSR-10  Ley 400/1997",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"co_pot",pais:"CO",cat:"operativo",obligatorio:!1,nombre:"Normativa Urbanstica y POT",duracionMin:90,desc:"Plan de Ordenamiento Territorial, licencias urbansticas y norma aplicable a proyectos de remodelacin.",contenido:"Tipos de licencia, normas urbansticas, usos del suelo, ndices, retrocesos, alturas, trmites ante curaduras.",normativa:"Decreto 1077/2015  Decreto 1203/2017",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","directivos"]},{id:"co_proc_diseno",pais:"CO",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Diseo Habitaris",duracionMin:90,desc:"Protocolo interno de diseo: flujo del proyecto, entregables por fase, revisiones, aprobaciones del cliente.",contenido:"Brief  Concepto  Anteproyecto  Proyecto  Detalles tcnicos  Planos de obra. Checklist por fase, nomenclatura de archivos.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"co_proc_obra",pais:"CO",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Obra",duracionMin:90,desc:"Protocolo interno de ejecucin de obra: acta de inicio, control diario, bitcora, recepcin de materiales.",contenido:"Acta de vecindad, acta de inicio, bitcora diaria, control de avance, gestin de cambios, entrega parcial/final.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"co_admin_proc",pais:"CO",cat:"admin",obligatorio:!0,nombre:"Procedimientos Administrativos Internos",duracionMin:60,desc:"Protocolo interno: compras, caja chica, viticos, aprobaciones, archivo documental.",contenido:"Flujo de compras, aprobaciones por monto, rendicin de viticos, gestin documental, archivo digital.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["administrativos","todos"]},{id:"co_admin_factura",pais:"CO",cat:"admin",obligatorio:!1,nombre:"Facturacin Electrnica",duracionMin:60,desc:"Normativa y operacin de facturacin electrnica ante la DIAN.",contenido:"Resolucin de habilitacin, notas crdito/dbito, documento soporte, tiempos de envo, contingencia.",normativa:"Resolucin DIAN 000042/2020",vigenciaMeses:0,renovable:!1,aplica:["administrativos","contabilidad"]},{id:"co_bim",pais:"CO",cat:"tech",obligatorio:!1,nombre:"Metodologa BIM",duracionMin:240,desc:"Building Information Modeling aplicado a diseo interior y remodelacin.",contenido:"Conceptos BIM, modelado en Revit, familias, coordinacin de disciplinas, LOD, entregables BIM.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"co_soft_diseno",pais:"CO",cat:"tech",obligatorio:!1,nombre:"Software de Diseo (AutoCAD / SketchUp / Revit)",duracionMin:480,desc:"Capacitacin en herramientas de diseo utilizadas en la empresa.",contenido:"Segn software: interfaz, dibujo 2D/3D, renderizado, ploteo, exportacin de planos.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"co_suite_hab",pais:"CO",cat:"tech",obligatorio:!0,nombre:"Uso de la Suite Habitaris",duracionMin:60,desc:"Capacitacin en el uso de la plataforma de gestin: CRM, formularios, proyectos, RRHH.",contenido:"Mdulos de la suite, flujo de ofertas, formularios, gestin de proyectos, reportes.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"co_atencion",pais:"CO",cat:"cliente",obligatorio:!0,nombre:"Protocolo de Atencin al Cliente",duracionMin:60,desc:"Estndares de servicio, comunicacin con el cliente, manejo de quejas y expectativas.",contenido:"Primera impresin, escucha activa, gestin de expectativas, manejo de conflictos, seguimiento post-servicio.",normativa:"Procedimiento interno",vigenciaMeses:12,renovable:!0,aplica:["comercial","diseadores","todos"]},{id:"es_prl_general",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Prevencin de Riesgos Laborales  General",duracionMin:480,desc:"Formacin PRL adaptada al puesto de trabajo. Art. 19 LPRL. Obligatoria para todo trabajador.",contenido:"Conceptos bsicos PRL, riesgos generales y especficos del puesto, medidas preventivas, EPIs, sealizacin.",normativa:"Ley 31/1995 (LPRL) Art. 19  RD 39/1997",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"es_prl_oficina",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"PRL  Pantallas de Visualizacin de Datos",duracionMin:120,desc:"Riesgos ergonmicos en trabajo con ordenadores. Obligatorio para personal de oficina.",contenido:"Ergonoma del puesto, fatiga visual, pausas, configuracin de pantalla, mobiliario, ejercicios.",normativa:"RD 488/1997",vigenciaMeses:0,renovable:!1,aplica:["oficina","diseadores","administrativos"]},{id:"es_prl_construccion",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"PRL  Construccin (20h Convenio)",duracionMin:1200,desc:"Formacin obligatoria del Convenio General de Construccin para personal que visita/trabaja en obra.",contenido:"Parte troncal (14h): riesgos generales en obra, medidas preventivas. Parte especfica (6h): segn oficio.",normativa:"VI CGSC  RD 1627/1997",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores","arquitectos"]},{id:"es_prl_primeros_auxilios",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Primeros Auxilios",duracionMin:120,desc:"Formacin en primeros auxilios para personal designado. Art. 20 LPRL.",contenido:"Conducta PAS, RCP, DESA, hemorragias, fracturas, quemaduras, intoxicaciones.",normativa:"Ley 31/1995 Art. 20",vigenciaMeses:24,renovable:!0,aplica:["brigadistas","designados"]},{id:"es_prl_emergencias",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Plan de Emergencia y Evacuacin",duracionMin:60,desc:"Actuacin ante emergencias: incendio, evacuacin, confinamiento.",contenido:"Plan de autoproteccin, roles, uso de extintores y BIE, rutas de evacuacin, simulacros.",normativa:"Ley 31/1995 Art. 20  RD 393/2007",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_prl_coord",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Coordinacin de Actividades Empresariales (CAE)",duracionMin:60,desc:"Obligaciones cuando concurren varias empresas en un mismo centro de trabajo (obra).",contenido:"RD 171/2004, intercambio de informacin, instrucciones, vigilancia, recurso preventivo.",normativa:"RD 171/2004",vigenciaMeses:0,renovable:!1,aplica:["supervisores","directivos"]},{id:"es_rgpd",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Proteccin de Datos (RGPD + LOPDGDD)",duracionMin:120,desc:"Reglamento General de Proteccin de Datos y LOPDGDD. Obligatorio para todo personal que maneje datos.",contenido:"Principios, bases de legitimacin, derechos del interesado, brechas de seguridad, DPD, sanciones.",normativa:"Reglamento UE 2016/679  LO 3/2018",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_acoso",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Prevencin Acoso Sexual y por Razn de Sexo",duracionMin:60,desc:"LO 10/2022 obliga a TODAS las empresas a formar a su plantilla. Protocolo de actuacin.",contenido:"Definiciones legales, identificacin de conductas, procedimiento de denuncia, medidas cautelares, confidencialidad.",normativa:"LO 3/2007 Art. 48  LO 10/2022 Art. 12",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_igualdad",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Igualdad y Plan de Igualdad",duracionMin:60,desc:"Sensibilizacin en igualdad de oportunidades. Plan de igualdad obligatorio si 50 empleados.",contenido:"Marco normativo, brecha salarial, lenguaje inclusivo, corresponsabilidad, medidas del plan.",normativa:"LO 3/2007  RD 901/2020",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_lgtbi",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Igualdad LGTBI y Diversidad",duracionMin:60,desc:"Ley 4/2023 y RD 1026/2024. Obligatorio para empresas 50 empleados desde abril 2025.",contenido:"Diversidad sexual e identidad de gnero, protocolo frente a LGTBIfobia, entornos inclusivos.",normativa:"Ley 4/2023  RD 1026/2024",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_desconexion",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Desconexin Digital",duracionMin:30,desc:"Derecho a la desconexin digital fuera del horario laboral. LOPDGDD Art. 88.",contenido:"Poltica de desconexin, gestin del tiempo digital, prevencin de fatiga informtica, buenas prcticas.",normativa:"LO 3/2018 Art. 88",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_canal_denuncias",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Canal Interno de Denuncias",duracionMin:30,desc:"Ley 2/2023 (Whistleblowing). Obligatorio 50 empleados. Formacin sobre uso y proteccin del informante.",contenido:"Qu se puede denunciar, cmo funciona el canal, proteccin del informante, confidencialidad, plazos.",normativa:"Ley 2/2023",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_blanqueo",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Prevencin de Blanqueo de Capitales",duracionMin:60,desc:"Ley 10/2010. Obligatorio para promotores inmobiliarios y operaciones >15.000 en efectivo.",contenido:"Debida diligencia, identificacin del cliente, operaciones sospechosas, conservacin documental.",normativa:"Ley 10/2010 Art. 29",vigenciaMeses:12,renovable:!0,aplica:["directivos","comercial"]},{id:"es_cte",pais:"ES",cat:"operativo",obligatorio:!1,nombre:"Cdigo Tcnico de Edificacin (CTE)",duracionMin:120,desc:"Conocimiento del CTE aplicable a reformas y rehabilitacin.",contenido:"DB-HE (ahorro energtico), DB-SI (incendios), DB-SUA (seguridad de utilizacin), DB-HS (salubridad).",normativa:"RD 314/2006",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"es_proc_diseno",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Diseo Habitaris",duracionMin:90,desc:"Protocolo interno de diseo: flujo del proyecto, entregables, revisiones, aprobaciones.",contenido:"Brief  Concepto  Anteproyecto  Proyecto ejecutivo  Detalles. Checklist por fase.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"es_proc_obra",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Obra / Reforma",duracionMin:90,desc:"Protocolo interno de ejecucin: acta de replanteo, libro de rdenes, certificaciones.",contenido:"Licencia de obra, acta de replanteo, libro de rdenes, certificaciones parciales, acta de recepcin.",normativa:"Procedimiento interno  LOE",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"es_residuos",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Gestin de Residuos de Construccin (RCD)",duracionMin:60,desc:"Plan de gestin de residuos obligatorio en obra. Separacin, transporte y gestin autorizada.",contenido:"RD 105/2008, tipos de residuos, plan de gestin, documentos de control, gestores autorizados.",normativa:"RD 105/2008  Ley 7/2022",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"es_bim",pais:"ES",cat:"tech",obligatorio:!1,nombre:"Metodologa BIM",duracionMin:240,desc:"Building Information Modeling. Licitacin pblica ya lo exige en muchos proyectos.",contenido:"Conceptos BIM, modelado Revit, IFC, coordinacin, LOD, entregables.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"es_suite_hab",pais:"ES",cat:"tech",obligatorio:!0,nombre:"Uso de la Suite Habitaris",duracionMin:60,desc:"Capacitacin en el uso de la plataforma de gestin.",contenido:"CRM, formularios, proyectos, RRHH, reportes.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"es_atencion",pais:"ES",cat:"cliente",obligatorio:!0,nombre:"Protocolo de Atencin al Cliente",duracionMin:60,desc:"Estndares de servicio, comunicacin, gestin de expectativas y reclamaciones.",contenido:"Primera impresin, escucha activa, gestin de quejas, libro de reclamaciones, seguimiento.",normativa:"Procedimiento interno",vigenciaMeses:12,renovable:!0,aplica:["comercial","diseadores","todos"]}],cx=[{id:"todos",label:"Todos los empleados"},{id:"directivos",label:"Directivos / Gerencia"},{id:"arquitectos",label:"Arquitectos"},{id:"diseadores",label:"Diseadores de interiores"},{id:"ingenieros",label:"Ingenieros"},{id:"obra",label:"Personal de obra"},{id:"supervisores",label:"Supervisores / Residentes"},{id:"instaladores",label:"Instaladores / Tcnicos"},{id:"administrativos",label:"Administrativos"},{id:"comercial",label:"Comercial / Ventas"},{id:"contabilidad",label:"Contabilidad / Finanzas"},{id:"oficina",label:"Personal de oficina"},{id:"brigadistas",label:"Brigadistas"},{id:"designados",label:"Designados especiales"}];function ca(t){if(!t)return"";if(t<60)return`${t} min`;const i=Math.floor(t/60),o=t%60;return o?`${i}h ${o}min`:`${i}h`}function pa(t){return t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):""}function px(t,i){const o=new Date(t);return o.setMonth(o.getMonth()+i),o.toISOString()}function Mi(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}function gx({tabs:t,active:i,onChange:o,style:n}){return e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${ne.border}`,...n},children:t.map(a=>e.jsxs("button",{onClick:()=>o(a.id),style:{...Ae,padding:"10px 18px",fontSize:12,fontWeight:i===a.id?700:500,color:i===a.id?ne.accent:ne.inkLight,background:"none",border:"none",borderBottom:i===a.id?`2px solid ${ne.accent}`:"2px solid transparent",cursor:"pointer",transition:"all .15s"},children:[a.icon&&e.jsx("span",{style:{marginRight:6},children:a.icon}),a.label,a.badge!=null&&e.jsx("span",{style:{marginLeft:6,background:i===a.id?ne.accent:ne.border,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:a.badge})]},a.id))})}function ti({children:t,color:i,bg:o,style:n}){return e.jsx("span",{style:{...Ae,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o,...n},children:t})}function od({children:t,style:i,onClick:o}){return e.jsx("div",{onClick:o,style:{background:"#fff",border:`1px solid ${ne.border}`,borderRadius:10,padding:20,boxShadow:ne.shadow,transition:"all .15s",cursor:o?"pointer":void 0,...i},onMouseEnter:n=>{o&&(n.currentTarget.style.boxShadow=ne.shadowMd)},onMouseLeave:n=>{o&&(n.currentTarget.style.boxShadow=ne.shadow)},children:t})}function ux({value:t,onChange:i,placeholder:o}){return e.jsxs("div",{style:{position:"relative"},children:[e.jsx("span",{style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",fontSize:14,opacity:.4},children:""}),e.jsx("input",{value:t,onChange:n=>i(n.target.value),placeholder:o||"Buscar",style:{...Ae,width:"100%",padding:"8px 12px 8px 34px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:6,outline:"none",boxSizing:"border-box"},onFocus:n=>n.target.style.borderColor=ne.accent,onBlur:n=>n.target.style.borderColor=ne.border})]})}function hx({preguntas:t,onChange:i}){const o=()=>i([...t,{id:da(),texto:"",opciones:["","","",""],correcta:0}]),n=(s,g,h)=>{const b=[...t];b[s]={...b[s],[g]:h},i(b)},a=(s,g,h)=>{const b=[...t],j=[...b[s].opciones];j[g]=h,b[s]={...b[s],opciones:j},i(b)},r=s=>i(t.filter((g,h)=>h!==s));return e.jsxs("div",{children:[e.jsxs("div",{style:{...Ae,fontSize:12,fontWeight:600,color:ne.ink,marginBottom:10},children:["Cuestionario de evaluacin (",t.length," preguntas)"]}),t.map((s,g)=>e.jsxs("div",{style:{border:`1px solid ${ne.border}`,borderRadius:8,padding:14,marginBottom:10,background:ne.surface},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("span",{style:{...Ae,fontSize:11,fontWeight:600,color:ne.inkMid},children:["Pregunta ",g+1]}),e.jsx("button",{onClick:()=>r(g),style:{...Ae,fontSize:10,color:ne.danger,background:"none",border:"none",cursor:"pointer"},children:" Eliminar"})]}),e.jsx("input",{value:s.texto,onChange:h=>n(g,"texto",h.target.value),placeholder:"Escribe la pregunta",style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,marginBottom:8,boxSizing:"border-box"}}),s.opciones.map((h,b)=>e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:4},children:[e.jsx("input",{type:"radio",name:`q_${s.id}`,checked:s.correcta===b,onChange:()=>n(g,"correcta",b),style:{accentColor:ne.accent}}),e.jsx("input",{value:h,onChange:j=>a(g,b,j.target.value),placeholder:`Opcin ${b+1}`,style:{...Ae,flex:1,padding:"5px 8px",fontSize:11,border:`1px solid ${ne.border}`,borderRadius:4}})]},b)),e.jsx("p",{style:{...Ae,fontSize:10,color:ne.inkLight,marginTop:4},children:" Marca el radio de la respuesta correcta"})]},s.id)),e.jsx("button",{onClick:o,style:{...Ae,padding:"7px 16px",fontSize:11,fontWeight:600,color:ne.accent,background:ne.accentBg,border:`1px solid ${ne.accent}33`,borderRadius:6,cursor:"pointer"},children:"+ Aadir pregunta"})]})}function fx({preguntas:t,onComplete:i}){const[o,n]=F.useState({}),[a,r]=F.useState(!1),[s,g]=F.useState(null),h=(m,f)=>{a||n(p=>({...p,[m]:f}))},b=()=>{let m=0;t.forEach(p=>{o[p.id]===p.correcta&&m++});const f=Math.round(m/t.length*100);g(f),r(!0),i(f)},j=Object.keys(o).length,k=t.length,v=s!=null&&s>=70;return e.jsxs("div",{children:[!a&&e.jsxs("div",{style:{...Ae,fontSize:12,color:ne.inkMid,marginBottom:16},children:["Responde todas las preguntas. Necesitas ",e.jsx("b",{children:"70%"})," para aprobar. (",j,"/",k," respondidas)"]}),a&&e.jsxs("div",{style:{padding:20,borderRadius:10,marginBottom:20,textAlign:"center",background:v?ne.successBg:ne.dangerBg,border:`1px solid ${v?ne.success:ne.danger}33`},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:v?"":""}),e.jsxs("div",{style:{...Ae,fontSize:22,fontWeight:700,color:v?ne.success:ne.danger},children:[s,"%"]}),e.jsx("div",{style:{...Ae,fontSize:13,color:v?ne.success:ne.danger,marginTop:4},children:v?"Aprobado! Formacin completada.":"No aprobado. Puedes volver a intentarlo."})]}),t.map((m,f)=>{const p=o[m.id],d=a&&p===m.correcta,c=a&&p!==void 0&&p!==m.correcta;return e.jsxs("div",{style:{border:`1px solid ${a?d?ne.success+"55":c?ne.danger+"55":ne.border:ne.border}`,borderRadius:8,padding:14,marginBottom:10,background:"#fff"},children:[e.jsxs("div",{style:{...Ae,fontSize:12,fontWeight:600,color:ne.ink,marginBottom:10},children:[f+1,". ",m.texto]}),m.opciones.map((l,x)=>{if(!l)return null;const y=p===x,u=a&&x===m.correcta;let S=y?ne.accentBg:"transparent",A=y?ne.accent:ne.border;return a&&(u?(S=ne.successBg,A=ne.success):y&&!u&&(S=ne.dangerBg,A=ne.danger)),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",padding:"6px 10px",borderRadius:6,marginBottom:4,cursor:a?"default":"pointer",border:`1px solid ${A}`,background:S,transition:"all .15s"},onClick:()=>h(m.id,x),children:[e.jsx("input",{type:"radio",name:`take_${m.id}`,checked:y,readOnly:!0,style:{accentColor:a?u?ne.success:ne.danger:ne.accent}}),e.jsx("span",{style:{...Ae,fontSize:12,color:ne.ink},children:l}),a&&u&&e.jsx("span",{style:{marginLeft:"auto",fontSize:12},children:""})]},x)})]},m.id)}),!a&&e.jsx("button",{onClick:b,disabled:j<k,style:{...Ae,padding:"10px 28px",fontSize:13,fontWeight:700,color:"#fff",background:j<k?ne.inkLight:ne.accent,border:"none",borderRadius:8,cursor:j<k?"not-allowed":"pointer",marginTop:10},children:"Enviar respuestas"})]})}function xx({curso:t,trabajador:i,fecha:o,score:n}){return e.jsxs("div",{style:{border:`2px solid ${ne.accent}`,borderRadius:12,padding:40,textAlign:"center",background:"linear-gradient(135deg, #FFFFFF 0%, #EBEBEB 100%)",maxWidth:600,margin:"0 auto"},children:[e.jsx("div",{style:{fontSize:12,letterSpacing:3,color:ne.inkLight,textTransform:"uppercase",marginBottom:8},children:"Certificado de formacin"}),e.jsx("div",{style:{width:60,height:2,background:ne.accent,margin:"0 auto 20px"}}),e.jsx("div",{style:{...Ae,fontSize:10,color:ne.inkLight,marginBottom:4},children:"Se certifica que"}),e.jsx("div",{style:{...Ae,fontSize:22,fontWeight:700,color:ne.ink,marginBottom:16},children:i}),e.jsx("div",{style:{...Ae,fontSize:10,color:ne.inkLight,marginBottom:4},children:"ha completado satisfactoriamente la formacin"}),e.jsx("div",{style:{...Ae,fontSize:16,fontWeight:600,color:ne.accent,marginBottom:8},children:t.nombre}),e.jsxs("div",{style:{...Ae,fontSize:11,color:ne.inkMid,marginBottom:4},children:["Duracin: ",ca(t.duracionMin)]}),n!=null&&e.jsxs("div",{style:{...Ae,fontSize:11,color:ne.inkMid,marginBottom:4},children:["Calificacin: ",n,"%"]}),t.normativa&&t.normativa!==""&&t.normativa!=="Procedimiento interno"&&e.jsxs("div",{style:{...Ae,fontSize:10,color:ne.inkLight,marginBottom:16},children:["Normativa: ",t.normativa]}),e.jsx("div",{style:{...Ae,fontSize:12,color:ne.ink,marginTop:20},children:pa(o)}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:30,paddingTop:20,borderTop:`1px solid ${ne.border}`},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:120,borderBottom:`1px solid ${ne.ink}`,marginBottom:4}}),e.jsx("div",{style:{...Ae,fontSize:9,color:ne.inkLight},children:"Responsable de Formacin"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:120,borderBottom:`1px solid ${ne.ink}`,marginBottom:4}}),e.jsx("div",{style:{...Ae,fontSize:9,color:ne.inkLight},children:"Gerencia"})]})]})]})}function mx(){const[t,i]=F.useState("catalogo"),[o,n]=F.useState(()=>Kr("cursos")||dx),[a,r]=F.useState(()=>Kr("asignaciones")||[]),[s,g]=F.useState(()=>Kr("completados")||[]),[h,b]=F.useState(()=>Kr("trabajadores")||[{id:"t1",nombre:"Ana Garca",cargo:"Diseadora de interiores",roles:["diseadores","oficina","todos"],pais:"CO"},{id:"t2",nombre:"Carlos Lpez",cargo:"Arquitecto",roles:["arquitectos","oficina","todos"],pais:"CO"},{id:"t3",nombre:"Mara Rodrguez",cargo:"Supervisora de obra",roles:["supervisores","obra","todos","brigadistas"],pais:"CO"},{id:"t4",nombre:"Pedro Martnez",cargo:"Instalador",roles:["instaladores","obra","todos"],pais:"CO"},{id:"t5",nombre:"Laura Snchez",cargo:"Administrativa",roles:["administrativos","oficina","todos"],pais:"CO"},{id:"t6",nombre:"David Torres",cargo:"Comercial",roles:["comercial","oficina","todos"],pais:"CO"}]),[j,k]=F.useState("CO"),[v,m]=F.useState("all"),[f,p]=F.useState(""),[d,c]=F.useState(null),[l,x]=F.useState(null),[y,u]=F.useState(null),[S,A]=F.useState(null),[E,w]=F.useState(null);F.useEffect(()=>Jr("cursos",o),[o]),F.useEffect(()=>Jr("asignaciones",a),[a]),F.useEffect(()=>Jr("completados",s),[s]),F.useEffect(()=>Jr("trabajadores",h),[h]);const _=F.useMemo(()=>o.filter(D=>{if(D.pais!==j||v!=="all"&&D.cat!==v)return!1;if(f){const O=f.toLowerCase();return D.nombre.toLowerCase().includes(O)||D.desc.toLowerCase().includes(O)||(D.normativa||"").toLowerCase().includes(O)}return!0}),[o,j,v,f]),z=F.useMemo(()=>{const D=h.filter(V=>V.pais===j),O=o.filter(V=>V.pais===j),le=O.filter(V=>V.obligatorio);let re=0,de=0,G=0,ce=0;return D.forEach(V=>{const Y=a.filter(W=>W.trabajadorId===V.id);re+=Y.length,Y.forEach(W=>{const se=s.find(ge=>ge.asignacionId===W.id);if(se&&(de++,se.vencimiento)){const ge=Mi(se.vencimiento);ge<0?ce++:ge<=60&&G++}})}),{trabajadores:D.length,cursos:O.length,obligatorios:le.length,asignados:re,completados:de,porVencer:G,vencidos:ce,pctComp:re?Math.round(de/re*100):0}},[h,o,a,s,j]),T=(D,O)=>{a.find(re=>re.cursoId===D&&re.trabajadorId===O)||r(re=>[...re,{id:da(),cursoId:D,trabajadorId:O,fechaAsignacion:new Date().toISOString()}])},L=()=>{const D=o.filter(re=>re.pais===j&&re.obligatorio),O=h.filter(re=>re.pais===j);let le=0;D.forEach(re=>{O.forEach(de=>{re.aplica.some(ce=>ce==="todos"||de.roles.includes(ce))&&(a.find(V=>V.cursoId===re.id&&V.trabajadorId===de.id)||(T(re.id,de.id),le++))})}),alert(le?` Se asignaron ${le} formaciones automticamente`:" Todas las formaciones obligatorias ya estn asignadas")},Z=(D,O)=>{const le=a.find(ce=>ce.id===D);if(!le)return;const re=o.find(ce=>ce.id===le.cursoId),de=re!=null&&re.vigenciaMeses?px(new Date,re.vigenciaMeses):null,G={id:da(),asignacionId:D,cursoId:le.cursoId,trabajadorId:le.trabajadorId,fecha:new Date().toISOString(),score:O,vencimiento:de};g(ce=>[...ce.filter(V=>V.asignacionId!==D),G])},K=()=>{var re;const D=d?o.find(de=>de.id===d):null;if(!D)return null;const O=a.filter(de=>de.cursoId===D.id),le=Hn.find(de=>de.id===D.cat);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>c(null),children:e.jsxs("div",{onClick:de=>de.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:6},children:[e.jsxs(ti,{color:le==null?void 0:le.color,bg:(le==null?void 0:le.color)+"18",children:[le==null?void 0:le.icon," ",le==null?void 0:le.label]}),D.obligatorio&&e.jsx(ti,{color:ne.danger,bg:ne.dangerBg,children:"Obligatorio"}),e.jsx(ti,{color:ne.inkLight,bg:ne.bg,children:D.pais==="CO"?" Colombia":" Espaa"})]}),e.jsx("h2",{style:{...Ae,fontSize:20,fontWeight:700,color:ne.ink,margin:0},children:D.nombre})]}),e.jsx("button",{onClick:()=>c(null),style:{...Ae,fontSize:18,color:ne.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...Ae,fontSize:13,color:ne.inkMid,lineHeight:1.6,marginBottom:12},children:D.desc}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsxs("div",{style:{padding:12,background:ne.surface,borderRadius:8},children:[e.jsx("div",{style:{...Ae,fontSize:10,color:ne.inkLight,marginBottom:2},children:"Duracin"}),e.jsx("div",{style:{...Ae,fontSize:14,fontWeight:600,color:ne.ink},children:ca(D.duracionMin)})]}),e.jsxs("div",{style:{padding:12,background:ne.surface,borderRadius:8},children:[e.jsx("div",{style:{...Ae,fontSize:10,color:ne.inkLight,marginBottom:2},children:"Vigencia"}),e.jsx("div",{style:{...Ae,fontSize:14,fontWeight:600,color:ne.ink},children:D.vigenciaMeses?`${D.vigenciaMeses} meses`:"Sin vencimiento"})]})]}),D.normativa&&D.normativa!==""&&e.jsxs("div",{style:{padding:10,background:ne.infoBg,borderRadius:8,marginBottom:12},children:[e.jsx("span",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.info},children:" Normativa: "}),e.jsx("span",{style:{...Ae,fontSize:11,color:ne.info},children:D.normativa})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{...Ae,fontSize:11,fontWeight:600,color:ne.inkMid,marginBottom:4},children:"Contenido temtico:"}),e.jsx("p",{style:{...Ae,fontSize:12,color:ne.inkMid,lineHeight:1.6,margin:0},children:D.contenido})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{...Ae,fontSize:11,fontWeight:600,color:ne.inkMid,marginBottom:4},children:"Aplica a:"}),e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:D.aplica.map(de=>{const G=cx.find(ce=>ce.id===de);return e.jsx(ti,{color:ne.inkMid,bg:ne.bg,children:(G==null?void 0:G.label)||de},de)})})]}),e.jsxs("div",{style:{border:`1px dashed ${ne.border}`,borderRadius:8,padding:16,textAlign:"center",marginBottom:16},children:[e.jsx("div",{style:{fontSize:28,marginBottom:6},children:""}),e.jsx("div",{style:{...Ae,fontSize:12,color:ne.inkLight},children:"Material del curso (vdeos, PDFs, presentaciones)"}),e.jsx("div",{style:{...Ae,fontSize:10,color:ne.inkLight,marginTop:4},children:"Sube contenido desde la pestaa de edicin del curso"})]}),((re=D.preguntas)==null?void 0:re.length)>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{...Ae,fontSize:12,fontWeight:600,color:ne.ink,marginBottom:8},children:[" Cuestionario (",D.preguntas.length," preguntas)"]}),e.jsx("p",{style:{...Ae,fontSize:11,color:ne.inkLight},children:"Los trabajadores deben aprobar con mnimo 70% para completar la formacin."})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs("div",{style:{...Ae,fontSize:12,fontWeight:600,color:ne.ink,marginBottom:10},children:[" Trabajadores asignados (",O.length,")"]}),O.length===0&&e.jsx("p",{style:{...Ae,fontSize:11,color:ne.inkLight},children:"Ningn trabajador asignado an."}),O.map(de=>{const G=h.find(W=>W.id===de.trabajadorId),ce=s.find(W=>W.asignacionId===de.id),V=(ce==null?void 0:ce.vencimiento)&&Mi(ce.vencimiento)<0,Y=(ce==null?void 0:ce.vencimiento)&&Mi(ce.vencimiento)>=0&&Mi(ce.vencimiento)<=60;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 0",borderBottom:`1px solid ${ne.border}`},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:ne.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:600,color:ne.accent},children:((G==null?void 0:G.nombre)||"?")[0]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ae,fontSize:12,fontWeight:600,color:ne.ink},children:G==null?void 0:G.nombre}),e.jsx("div",{style:{...Ae,fontSize:10,color:ne.inkLight},children:G==null?void 0:G.cargo})]}),ce?e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(ti,{color:V?ne.danger:Y?ne.warning:ne.success,bg:V?ne.dangerBg:Y?ne.warningBg:ne.successBg,children:V?" Vencido":Y?" Por vencer":` ${ce.score||100}%`}),e.jsxs("div",{style:{...Ae,fontSize:9,color:ne.inkLight,marginTop:2},children:[pa(ce.fecha),ce.vencimiento&&`  ${pa(ce.vencimiento)}`]})]}):e.jsx(ti,{color:ne.warning,bg:ne.warningBg,children:" Pendiente"})]},de.id)})]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:20},children:e.jsx("button",{onClick:()=>{u({...D}),c(null)},style:{...Ae,padding:"8px 20px",fontSize:12,fontWeight:600,color:ne.accent,background:ne.accentBg,border:`1px solid ${ne.accent}33`,borderRadius:6,cursor:"pointer"},children:" Editar curso"})})]})})},P=()=>{if(!y)return null;const D=!o.find(re=>re.id===y.id),O=(re,de)=>u(G=>({...G,[re]:de})),le=()=>{n(D?re=>[...re,y]:re=>re.map(de=>de.id===y.id?y:de)),u(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>u(null),children:e.jsxs("div",{onClick:re=>re.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:680,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Ae,fontSize:18,fontWeight:700,color:ne.ink,marginBottom:16},children:D?" Nuevo curso":" Editar curso"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Pas"}),e.jsxs("select",{value:y.pais,onChange:re=>O("pais",re.target.value),style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5},children:[e.jsx("option",{value:"CO",children:" Colombia"}),e.jsx("option",{value:"ES",children:" Espaa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Categora"}),e.jsx("select",{value:y.cat,onChange:re=>O("cat",re.target.value),style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5},children:Hn.map(re=>e.jsxs("option",{value:re.id,children:[re.icon," ",re.label]},re.id))})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Nombre del curso"}),e.jsx("input",{value:y.nombre||"",onChange:re=>O("nombre",re.target.value),style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:y.desc||"",onChange:re=>O("desc",re.target.value),rows:3,style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Contenido temtico"}),e.jsx("textarea",{value:y.contenido||"",onChange:re=>O("contenido",re.target.value),rows:3,style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Duracin (min)"}),e.jsx("input",{type:"number",value:y.duracionMin||"",onChange:re=>O("duracionMin",parseInt(re.target.value)||0),style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Vigencia (meses, 0=sin venc.)"}),e.jsx("input",{type:"number",value:y.vigenciaMeses||0,onChange:re=>O("vigenciaMeses",parseInt(re.target.value)||0),style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Normativa"}),e.jsx("input",{value:y.normativa||"",onChange:re=>O("normativa",re.target.value),style:{...Ae,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ne.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginBottom:12},children:[e.jsxs("label",{style:{...Ae,display:"flex",gap:6,alignItems:"center",fontSize:12,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:y.obligatorio||!1,onChange:re=>O("obligatorio",re.target.checked),style:{accentColor:ne.accent}}),"Formacin obligatoria"]}),e.jsxs("label",{style:{...Ae,display:"flex",gap:6,alignItems:"center",fontSize:12,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:y.renovable||!1,onChange:re=>O("renovable",re.target.checked),style:{accentColor:ne.accent}}),"Renovable peridicamente"]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{...Ae,fontSize:10,fontWeight:600,color:ne.inkLight},children:"Material (URLs de vdeo/documentos, uno por lnea)"}),e.jsx("textarea",{value:(y.material||[]).join(`
`),rows:3,onChange:re=>O("material",re.target.value.split(`
`).filter(de=>de.trim())),placeholder:`https://youtube.com/watch?v=...
https://drive.google.com/file/...`,style:{...Ae,width:"100%",padding:"7px 10px",fontSize:11,border:`1px solid ${ne.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsx(hx,{preguntas:y.preguntas||[],onChange:re=>O("preguntas",re)}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>u(null),style:{...Ae,padding:"8px 20px",fontSize:12,color:ne.inkMid,background:ne.bg,border:`1px solid ${ne.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:le,style:{...Ae,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ne.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},te=()=>{const D=l?h.find(re=>re.id===l):null;if(!D)return null;const O=a.filter(re=>re.trabajadorId===D.id),le=s.filter(re=>re.trabajadorId===D.id);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>x(null),children:e.jsxs("div",{onClick:re=>re.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",gap:14,alignItems:"center"},children:[e.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:ne.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,color:ne.accent},children:D.nombre[0]}),e.jsxs("div",{children:[e.jsx("h2",{style:{...Ae,fontSize:18,fontWeight:700,color:ne.ink,margin:0},children:D.nombre}),e.jsx("div",{style:{...Ae,fontSize:12,color:ne.inkLight},children:D.cargo}),e.jsx("div",{style:{display:"flex",gap:4,marginTop:4},children:D.roles.map(re=>e.jsx(ti,{color:ne.inkMid,bg:ne.bg,children:re},re))})]})]}),e.jsx("button",{onClick:()=>x(null),style:{...Ae,fontSize:18,color:ne.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{...Ae,fontSize:11,fontWeight:600,color:ne.inkMid},children:"Progreso formativo"}),e.jsxs("span",{style:{...Ae,fontSize:11,fontWeight:600,color:ne.accent},children:[le.length,"/",O.length," completadas"]})]}),e.jsx("div",{style:{height:8,background:ne.bg,borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${O.length?le.length/O.length*100:0}%`,background:ne.accent,borderRadius:4,transition:"width .3s"}})})]}),O.map(re=>{var W;const de=o.find(se=>se.id===re.cursoId),G=s.find(se=>se.asignacionId===re.id),ce=Hn.find(se=>se.id===(de==null?void 0:de.cat)),V=(G==null?void 0:G.vencimiento)&&Mi(G.vencimiento)<0,Y=(G==null?void 0:G.vencimiento)&&Mi(G.vencimiento)>=0&&Mi(G.vencimiento)<=60;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${ne.border}`},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:8,background:(ce==null?void 0:ce.color)+"18",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:ce==null?void 0:ce.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ae,fontSize:12,fontWeight:600,color:ne.ink},children:de==null?void 0:de.nombre}),e.jsxs("div",{style:{...Ae,fontSize:10,color:ne.inkLight},children:[ca(de==null?void 0:de.duracionMin),"  ",de==null?void 0:de.normativa]})]}),e.jsx("div",{style:{display:"flex",gap:6,alignItems:"center"},children:G?e.jsxs(e.Fragment,{children:[e.jsx(ti,{color:V?ne.danger:Y?ne.warning:ne.success,bg:V?ne.dangerBg:Y?ne.warningBg:ne.successBg,children:V?"Vencido":Y?`Vence ${pa(G.vencimiento)}`:` ${G.score||100}%`}),e.jsx("button",{onClick:()=>w(G),title:"Ver certificado",style:{...Ae,padding:"4px 8px",fontSize:10,color:ne.accent,background:ne.accentBg,border:`1px solid ${ne.accent}33`,borderRadius:4,cursor:"pointer"},children:""})]}):e.jsxs(e.Fragment,{children:[e.jsx(ti,{color:ne.warning,bg:ne.warningBg,children:"Pendiente"}),((W=de==null?void 0:de.preguntas)==null?void 0:W.length)>0?e.jsx("button",{onClick:()=>{A({cursoId:de.id,trabajadorId:D.id,asignacionId:re.id}),x(null)},style:{...Ae,padding:"4px 10px",fontSize:10,fontWeight:600,color:"#fff",background:ne.accent,border:"none",borderRadius:4,cursor:"pointer"},children:" Evaluar"}):e.jsx("button",{onClick:()=>Z(re.id,100),style:{...Ae,padding:"4px 10px",fontSize:10,fontWeight:600,color:"#fff",background:ne.accent,border:"none",borderRadius:4,cursor:"pointer"},children:" Completar"})]})})]},re.id)}),O.length===0&&e.jsx("p",{style:{...Ae,fontSize:12,color:ne.inkLight,textAlign:"center",padding:20},children:"No tiene formaciones asignadas"})]})})},he=()=>{var le;if(!S)return null;const D=o.find(re=>re.id===S.cursoId),O=h.find(re=>re.id===S.trabajadorId);return(le=D==null?void 0:D.preguntas)!=null&&le.length?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>A(null),children:e.jsxs("div",{onClick:re=>re.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("h2",{style:{...Ae,fontSize:16,fontWeight:700,color:ne.ink,marginBottom:4},children:[" Evaluacin: ",D.nombre]}),e.jsxs("p",{style:{...Ae,fontSize:12,color:ne.inkLight,marginBottom:20},children:["Trabajador: ",O==null?void 0:O.nombre]}),e.jsx(fx,{preguntas:D.preguntas,onComplete:re=>{re>=70&&Z(S.asignacionId,re)}}),e.jsx("button",{onClick:()=>A(null),style:{...Ae,marginTop:16,padding:"8px 20px",fontSize:12,color:ne.inkMid,background:ne.bg,border:`1px solid ${ne.border}`,borderRadius:6,cursor:"pointer"},children:"Cerrar"})]})}):null},Q=()=>{if(!E)return null;const D=o.find(le=>le.id===E.cursoId),O=h.find(le=>le.id===E.trabajadorId);return!D||!O?null:e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>w(null),children:e.jsxs("div",{onClick:le=>le.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:680,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx(xx,{curso:D,trabajador:O.nombre,fecha:E.fecha,score:E.score}),e.jsx("div",{style:{textAlign:"center",marginTop:20},children:e.jsx("button",{onClick:()=>w(null),style:{...Ae,padding:"8px 24px",fontSize:12,color:ne.inkMid,background:ne.bg,border:`1px solid ${ne.border}`,borderRadius:6,cursor:"pointer"},children:"Cerrar"})})]})})},Se=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:16},children:[e.jsx("div",{style:{display:"flex",gap:2},children:[["CO"," Colombia"],["ES"," Espaa"]].map(([D,O])=>e.jsx("button",{onClick:()=>k(D),style:{...Ae,padding:"6px 14px",fontSize:11,fontWeight:j===D?700:500,color:j===D?"#fff":ne.inkMid,background:j===D?ne.accent:ne.surface,border:`1px solid ${j===D?ne.accent:ne.border}`,borderRadius:6,cursor:"pointer"},children:O},D))}),e.jsxs("select",{value:v,onChange:D=>m(D.target.value),style:{...Ae,padding:"6px 12px",fontSize:11,border:`1px solid ${ne.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todas las categoras"}),Hn.map(D=>e.jsxs("option",{value:D.id,children:[D.icon," ",D.label]},D.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx(ux,{value:f,onChange:p,placeholder:"Buscar por nombre, normativa"})}),e.jsx("button",{onClick:()=>u({id:da(),pais:j,cat:"operativo",nombre:"",desc:"",contenido:"",normativa:"",duracionMin:60,vigenciaMeses:0,obligatorio:!1,renovable:!1,aplica:["todos"],preguntas:[],material:[]}),style:{...Ae,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:ne.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo curso"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"},children:[{label:"Total cursos",val:z.cursos,icon:""},{label:"Obligatorios",val:z.obligatorios,icon:""},{label:"Completados",val:`${z.pctComp}%`,icon:""},{label:"Vencidos",val:z.vencidos,icon:"",danger:z.vencidos>0},{label:"Por vencer",val:z.porVencer,icon:"",warning:z.porVencer>0}].map((D,O)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"12px 16px",background:D.danger?ne.dangerBg:D.warning?ne.warningBg:"#fff",border:`1px solid ${D.danger?ne.danger+"33":D.warning?ne.warning+"33":ne.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...Ae,fontSize:10,color:ne.inkLight},children:[D.icon," ",D.label]}),e.jsx("div",{style:{...Ae,fontSize:20,fontWeight:700,color:D.danger?ne.danger:D.warning?ne.warning:ne.ink},children:D.val})]},O))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px,1fr))",gap:12},children:_.map(D=>{var de;const O=Hn.find(G=>G.id===D.cat),le=a.filter(G=>G.cursoId===D.id).length,re=s.filter(G=>G.cursoId===D.id).length;return e.jsxs(od,{onClick:()=>c(D.id),style:{borderLeft:`3px solid ${(O==null?void 0:O.color)||ne.accent}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(ti,{color:O==null?void 0:O.color,bg:(O==null?void 0:O.color)+"18",children:[O==null?void 0:O.icon," ",O==null?void 0:O.label]}),D.obligatorio&&e.jsx(ti,{color:ne.danger,bg:ne.dangerBg,children:"Obligatorio"})]}),e.jsx("div",{style:{...Ae,fontSize:14,fontWeight:700,color:ne.ink,marginBottom:4},children:D.nombre}),e.jsx("div",{style:{...Ae,fontSize:11,color:ne.inkLight,lineHeight:1.5,marginBottom:10,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:D.desc}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{...Ae,fontSize:10,color:ne.inkLight},children:[" ",ca(D.duracionMin),"  ",D.vigenciaMeses?` ${D.vigenciaMeses}m`:""]}),e.jsxs("div",{style:{...Ae,fontSize:10,color:ne.inkMid},children:[" ",le,"   ",re]})]}),((de=D.preguntas)==null?void 0:de.length)>0&&e.jsxs("div",{style:{...Ae,fontSize:9,color:ne.accent,marginTop:6},children:[" ",D.preguntas.length," preguntas"]})]},D.id)})}),_.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:ne.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Ae,fontSize:13},children:"No se encontraron cursos con los filtros seleccionados"})]})]}),ae=()=>{const D=h.filter(O=>O.pais===j);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:16},children:[e.jsx("div",{style:{display:"flex",gap:2},children:[["CO",""],["ES",""]].map(([O,le])=>e.jsx("button",{onClick:()=>k(O),style:{...Ae,padding:"6px 14px",fontSize:11,fontWeight:j===O?700:500,color:j===O?"#fff":ne.inkMid,background:j===O?ne.accent:ne.surface,border:`1px solid ${j===O?ne.accent:ne.border}`,borderRadius:6,cursor:"pointer"},children:le},O))}),e.jsx("button",{onClick:L,style:{...Ae,padding:"7px 16px",fontSize:11,fontWeight:600,color:ne.info,background:ne.infoBg,border:`1px solid ${ne.info}33`,borderRadius:6,cursor:"pointer"},children:" Auto-asignar obligatorias"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px,1fr))",gap:12},children:D.map(O=>{const le=a.filter(ce=>ce.trabajadorId===O.id),re=s.filter(ce=>ce.trabajadorId===O.id),de=re.filter(ce=>ce.vencimiento&&Mi(ce.vencimiento)<0).length,G=le.length?Math.round(re.length/le.length*100):0;return e.jsxs(od,{onClick:()=>x(O.id),children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginBottom:12},children:[e.jsx("div",{style:{width:44,height:44,borderRadius:"50%",background:ne.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,color:ne.accent},children:O.nombre[0]}),e.jsxs("div",{children:[e.jsx("div",{style:{...Ae,fontSize:14,fontWeight:700,color:ne.ink},children:O.nombre}),e.jsx("div",{style:{...Ae,fontSize:11,color:ne.inkLight},children:O.cargo})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[e.jsxs("span",{style:{...Ae,fontSize:10,color:ne.inkLight},children:[re.length,"/",le.length," completadas"]}),e.jsxs("span",{style:{...Ae,fontSize:10,fontWeight:600,color:G===100?ne.success:G>50?ne.warning:ne.danger},children:[G,"%"]})]}),e.jsx("div",{style:{height:6,background:ne.bg,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${G}%`,background:G===100?ne.success:G>50?"#D4840A":ne.danger,borderRadius:3,transition:"width .3s"}})})]}),de>0&&e.jsxs(ti,{color:ne.danger,bg:ne.dangerBg,children:[" ",de," vencida(s)"]})]},O.id)})}),D.length===0&&e.jsx("div",{style:{textAlign:"center",padding:40,color:ne.inkLight},children:e.jsx("p",{style:{...Ae,fontSize:13},children:"No hay trabajadores registrados para este pas. Vinclalos desde RRHH."})})]})},U=()=>{const D=[];return a.forEach(O=>{const le=s.find(G=>G.asignacionId===O.id),re=o.find(G=>G.id===O.cursoId),de=h.find(G=>G.id===O.trabajadorId);if(!(!re||!de||re.pais!==j)){if(!le)D.push({tipo:"pendiente",curso:re,trab:de,asig:O,prioridad:re.obligatorio?1:3});else if(le.vencimiento){const G=Mi(le.vencimiento);G<0?D.push({tipo:"vencido",curso:re,trab:de,comp:le,dias:Math.abs(G),prioridad:0}):G<=60&&D.push({tipo:"por_vencer",curso:re,trab:de,comp:le,dias:G,prioridad:2})}}}),D.sort((O,le)=>O.prioridad-le.prioridad),e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:2,marginBottom:16},children:[["CO",""],["ES",""]].map(([O,le])=>e.jsx("button",{onClick:()=>k(O),style:{...Ae,padding:"6px 14px",fontSize:11,fontWeight:j===O?700:500,color:j===O?"#fff":ne.inkMid,background:j===O?ne.accent:ne.surface,border:`1px solid ${j===O?ne.accent:ne.border}`,borderRadius:6,cursor:"pointer"},children:le},O))}),D.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:""}),e.jsx("p",{style:{...Ae,fontSize:14,color:ne.success,fontWeight:600},children:"Todo al da"}),e.jsx("p",{style:{...Ae,fontSize:12,color:ne.inkLight},children:"No hay formaciones pendientes, vencidas ni por vencer."})]}):e.jsx("div",{children:D.map((O,le)=>{const re={vencido:ne.dangerBg,por_vencer:ne.warningBg,pendiente:ne.infoBg},de={vencido:ne.danger,por_vencer:ne.warning,pendiente:ne.info},G={vencido:"",por_vencer:"",pendiente:""},ce={vencido:`Vencido hace ${O.dias} das`,por_vencer:`Vence en ${O.dias} das`,pendiente:"Pendiente de completar"};return e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:re[O.tipo],border:`1px solid ${de[O.tipo]}22`,borderRadius:8,marginBottom:8},children:[e.jsx("span",{style:{fontSize:20},children:G[O.tipo]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ae,fontSize:12,fontWeight:600,color:ne.ink},children:O.curso.nombre}),e.jsxs("div",{style:{...Ae,fontSize:11,color:ne.inkMid},children:[O.trab.nombre,"  ",O.trab.cargo]})]}),e.jsx(ti,{color:de[O.tipo],bg:"rgba(255,255,255,.7)",children:ce[O.tipo]}),O.curso.obligatorio&&e.jsx(ti,{color:ne.danger,bg:"rgba(255,255,255,.7)",children:"Obligatorio"})]},le)})})]})},M=()=>{const D=j==="CO"?[{ley:"Decreto 1072/2015",desc:"Decreto nico Reglamentario del Sector Trabajo. Establece la obligatoriedad del SG-SST.",aplica:"Toda empresa"},{ley:"Resolucin 0312/2019",desc:"Estndares Mnimos del SG-SST ajustados por tamao de empresa y nivel de riesgo.",aplica:"Toda empresa"},{ley:"Resolucin 4272/2021",desc:"Requisitos mnimos de seguridad para trabajo en alturas (1.5m).",aplica:"Personal en obra"},{ley:"Resolucin 2646/2008",desc:"Factores de riesgo psicosocial en el trabajo y determinacin del origen de las patologas.",aplica:"Toda empresa"},{ley:"Ley 1616/2013",desc:"Ley de Salud Mental. Promocin de la salud mental en ambientes laborales.",aplica:"Toda empresa"},{ley:"Ley 1581/2012",desc:"Rgimen general de proteccin de datos personales (Habeas Data).",aplica:"Toda empresa que maneje datos"},{ley:"Ley 1010/2006",desc:"Medidas para prevenir, corregir y sancionar el acoso laboral.",aplica:"Toda empresa"},{ley:"Decreto 1496/2018",desc:"Sistema Globalmente Armonizado (SGA) para clasificacin y etiquetado de productos qumicos.",aplica:"Empresas con qumicos"},{ley:"Resolucin 0491/2020",desc:"Requisitos mnimos de seguridad para trabajo en espacios confinados.",aplica:"Personal en obra (si aplica)"},{ley:"RETIE",desc:"Reglamento Tcnico de Instalaciones Elctricas. Resolucin 90708/2013.",aplica:"Instaladores elctricos"},{ley:"NSR-10",desc:"Norma Sismo Resistente de Colombia. Ley 400/1997 y Decreto 926/2010.",aplica:"Arquitectos e ingenieros"}]:[{ley:"Ley 31/1995 (LPRL)",desc:"Ley de Prevencin de Riesgos Laborales. Art. 19: formacin obligatoria adaptada al puesto.",aplica:"Toda empresa"},{ley:"RD 39/1997 (RSP)",desc:"Reglamento de los Servicios de Prevencin. Niveles de formacin (bsico, intermedio, superior).",aplica:"Toda empresa"},{ley:"VI CGSC",desc:"VI Convenio General del Sector de la Construccin. Formacin por oficios (8h a 20h).",aplica:"Personal en obra"},{ley:"RD 1627/1997",desc:"Disposiciones mnimas de seguridad y salud en obras de construccin.",aplica:"Obras de construccin"},{ley:"RD 488/1997",desc:"Disposiciones sobre trabajo con pantallas de visualizacin de datos.",aplica:"Personal de oficina"},{ley:"RD 171/2004",desc:"Coordinacin de Actividades Empresariales (CAE).",aplica:"Concurrencia empresarial"},{ley:"RGPD (UE 2016/679)",desc:"Reglamento General de Proteccin de Datos de la Unin Europea.",aplica:"Toda empresa con datos"},{ley:"LO 3/2018 (LOPDGDD)",desc:"Ley Orgnica de Proteccin de Datos y Garanta de Derechos Digitales. Art. 88: desconexin digital.",aplica:"Toda empresa"},{ley:"LO 3/2007",desc:"Ley de Igualdad. Plan de igualdad obligatorio 50 empleados. Protocolo acoso sexual.",aplica:"Toda empresa"},{ley:"LO 10/2022",desc:"Ley de garanta integral de la libertad sexual. Formacin obligatoria para toda empresa.",aplica:"Toda empresa"},{ley:"Ley 4/2023",desc:"Igualdad real de personas trans y derechos LGTBI. RD 1026/2024 para 50 empleados.",aplica:"Empresas 50"},{ley:"Ley 2/2023",desc:"Proteccin del informante (Whistleblowing). Canal de denuncias obligatorio 50 empleados.",aplica:"Empresas 50"},{ley:"Ley 10/2010",desc:"Prevencin del blanqueo de capitales. Obligatorio para promotores inmobiliarios.",aplica:"Sector inmobiliario"},{ley:"RD 314/2006 (CTE)",desc:"Cdigo Tcnico de la Edificacin. Documentos bsicos aplicables a reformas.",aplica:"Arquitectos e ingenieros"},{ley:"RD 105/2008",desc:"Regulacin de residuos de construccin y demolicin (RCD).",aplica:"Obras de construccin"}];return e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:2,marginBottom:16},children:[["CO"," Colombia"],["ES"," Espaa"]].map(([O,le])=>e.jsx("button",{onClick:()=>k(O),style:{...Ae,padding:"6px 14px",fontSize:11,fontWeight:j===O?700:500,color:j===O?"#fff":ne.inkMid,background:j===O?ne.accent:ne.surface,border:`1px solid ${j===O?ne.accent:ne.border}`,borderRadius:6,cursor:"pointer"},children:le},O))}),e.jsx("div",{style:{background:ne.infoBg,border:`1px solid ${ne.info}22`,borderRadius:8,padding:14,marginBottom:16},children:e.jsxs("p",{style:{...Ae,fontSize:12,color:ne.info,margin:0},children:[" Referencia normativa para empresas de ",e.jsx("b",{children:"diseo, arquitectura y remodelacin"})," en ",j==="CO"?"Colombia":"Espaa",". Verifica siempre la vigencia con tu asesor legal/SST."]})}),D.map((O,le)=>e.jsxs("div",{style:{display:"flex",gap:14,padding:"14px 0",borderBottom:`1px solid ${ne.border}`},children:[e.jsx("div",{style:{minWidth:160},children:e.jsx("div",{style:{...Ae,fontSize:12,fontWeight:700,color:ne.ink},children:O.ley})}),e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{...Ae,fontSize:12,color:ne.inkMid,lineHeight:1.5},children:O.desc})}),e.jsx("div",{style:{minWidth:130,textAlign:"right"},children:e.jsx(ti,{color:ne.inkMid,bg:ne.bg,children:O.aplica})})]},le))]})},B=a.filter(D=>!s.find(O=>O.asignacionId===D.id)).length,H=s.filter(D=>D.vencimiento&&Mi(D.vencimiento)<0).length,ee=B+H;return e.jsxs("div",{style:{...Ae,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...Ae,fontSize:22,fontWeight:700,color:ne.ink,margin:"0 0 4px"},children:" Formacin"}),e.jsx("p",{style:{...Ae,fontSize:12,color:ne.inkLight,margin:0},children:"Gestin de formaciones obligatorias, operativas y corporativas"})]}),e.jsx(gx,{active:t,onChange:i,tabs:[{id:"catalogo",icon:"",label:"Catlogo de Cursos",badge:z.cursos},{id:"trabajadores",icon:"",label:"Trabajadores"},{id:"alertas",icon:"",label:"Alertas",badge:ee||null},{id:"normativa",icon:"",label:"Normativa"}]}),e.jsxs("div",{style:{paddingTop:20},children:[t==="catalogo"&&Se(),t==="trabajadores"&&ae(),t==="alertas"&&U(),t==="normativa"&&M()]}),K(),P(),te(),he(),Q()]})}const ve={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},at={fontFamily:"'DM Sans',sans-serif"},vc="hab:carnets:",bx=t=>{try{return JSON.parse(Ee.getSync(vc+t))||null}catch{return null}},yx=(t,i)=>{Ee.set(vc+t,JSON.stringify(i))},vx=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7);function wr(t,i=120,o="#111",n="transparent"){const r=i/21,s=(j,k)=>{let v=0;for(let m=0;m<j.length;m++)v=(v<<5)-v+j.charCodeAt(m)*(k+1)|0;return v};let g=[];const h=(j,k)=>{for(let v=0;v<7;v++)for(let m=0;m<7;m++){const f=m===0||m===6||v===0||v===6,p=m>=2&&m<=4&&v>=2&&v<=4;(f||p)&&g.push({x:j+m,y:k+v})}};h(0,0),h(14,0),h(0,14);for(let j=0;j<21;j++)for(let k=0;k<21;k++)!(k<8&&j<8||k>12&&j<8||k<8&&j>12)&&Math.abs(s(t,k*21+j))%3!==0&&g.push({x:k,y:j});const b=g.map(j=>`<rect x="${j.x*r}" y="${j.y*r}" width="${r}" height="${r}" fill="${o}" rx="0.5"/>`).join("");return`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${i}" viewBox="0 0 ${i} ${i}">${b}</svg>`}function jx(){var t,i,o,n,a,r,s,g,h,b,j;try{const k=JSON.parse(Ee.getSync("hab:config"))||{};return{nombre:((t=k.empresa)==null?void 0:t.nombre)||"Habitaris",nit:((i=k.empresa)==null?void 0:i.nit)||"901.922.136-8",direccion:((o=k.empresa)==null?void 0:o.direccion)||"Bogot D.C., Colombia",telefono:((n=k.empresa)==null?void 0:n.telefono)||"+57 350 566 1545",email:((a=k.empresa)==null?void 0:a.email)||"info@habitaris.co",web:((r=k.empresa)==null?void 0:r.web)||"www.habitaris.co",logo:((s=k.apariencia)==null?void 0:s.logo)||null,colorPrimario:((g=k.apariencia)==null?void 0:g.colorPrimario)||"#111111",colorAcento:((h=k.apariencia)==null?void 0:h.colorAcento)||"#111111",tipografia:((b=k.apariencia)==null?void 0:b.tipografia)||"DM Sans",slogan:((j=k.apariencia)==null?void 0:j.slogan)||"Diseo  Arquitectura  Remodelacin"}}catch{return{nombre:"Habitaris",colorPrimario:"#111",colorAcento:"#111111",tipografia:"DM Sans",slogan:"Diseo  Arquitectura  Remodelacin"}}}const Sx=[{id:"e1",nombre:"Ana Garca Ruiz",cargo:"Diseadora de Interiores",departamento:"Diseo",email:"ana@habitaris.co",telefono:"+57 310 555 1234",foto:null,fechaIngreso:"2023-03-15",tipoDoc:"CC",documento:"1.020.456.789",rh:"O+",eps:"Sura",arl:"Sura"},{id:"e2",nombre:"Carlos Lpez Meja",cargo:"Arquitecto Senior",departamento:"Arquitectura",email:"carlos@habitaris.co",telefono:"+57 311 555 5678",foto:null,fechaIngreso:"2022-08-01",tipoDoc:"CC",documento:"80.456.123",rh:"A+",eps:"Compensar",arl:"Sura"},{id:"e3",nombre:"Mara Rodrguez Pea",cargo:"Directora de Obra",departamento:"Obra",email:"maria@habitaris.co",telefono:"+57 320 555 9012",foto:null,fechaIngreso:"2023-01-10",tipoDoc:"CC",documento:"52.789.456",rh:"B+",eps:"Sanitas",arl:"Positiva"},{id:"e4",nombre:"Pedro Martnez Torres",cargo:"Instalador Tcnico",departamento:"Obra",email:"pedro@habitaris.co",telefono:"+57 300 555 3456",foto:null,fechaIngreso:"2024-02-20",tipoDoc:"CC",documento:"1.098.765.432",rh:"O-",eps:"Nueva EPS",arl:"Positiva"},{id:"e5",nombre:"Laura Snchez Daz",cargo:"Gerente General",departamento:"Direccin",email:"laura@habitaris.co",telefono:"+57 315 555 7890",foto:null,fechaIngreso:"2022-01-01",tipoDoc:"CC",documento:"35.123.789",rh:"AB+",eps:"Sura",arl:"Sura"},{id:"e6",nombre:"David Torres Vargas",cargo:"Asesor Comercial",departamento:"Comercial",email:"david@habitaris.co",telefono:"+57 318 555 2345",foto:null,fechaIngreso:"2024-06-01",tipoDoc:"CC",documento:"1.015.432.876",rh:"A-",eps:"Compensar",arl:"Sura"}],nd=[{id:"classic",label:"Clsico",desc:"Diseo limpio con franja superior de color"},{id:"modern",label:"Moderno",desc:"Degradado diagonal con tipografa bold"},{id:"minimal",label:"Minimalista",desc:"Blanco y negro con detalles de acento"},{id:"obra",label:"Obra / SST",desc:"Datos de emergencia, EPS, ARL, RH y contacto"}],rd=[{id:"corporate",label:"Corporativa",desc:"Elegante con logo centrado y datos al reverso"},{id:"creative",label:"Creativa",desc:"Color de acento con layout asimtrico"},{id:"minimal_biz",label:"Minimalista",desc:"Tipografa limpia, mxima legibilidad"}];function Cx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const a=wr(`https://${i.web}/team/${t.id}`,80,i.colorPrimario);return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:8,background:i.colorPrimario}}),e.jsxs("div",{style:{padding:"20px 24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100% - 8px)"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,textAlign:"center",lineHeight:1.5},children:[t.tipoDoc,": ",t.documento,e.jsx("br",{}),"RH: ",t.rh,"  EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),"Ingreso: ",new Date(t.fechaIngreso).toLocaleDateString("es-CO")]}),e.jsxs("div",{style:{fontSize:7,color:ve.inkLight,marginTop:8},children:["En caso de emergencia contactar al ",i.telefono]})]})]})}return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:56,background:i.colorPrimario,display:"flex",alignItems:"center",padding:"0 20px",gap:10},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:24,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:14,fontWeight:700,color:"#fff",letterSpacing:1.5},children:i.nombre.toUpperCase()})}),e.jsxs("div",{style:{padding:"14px 20px",display:"flex",gap:14},children:[e.jsx("div",{style:{width:64,height:76,borderRadius:8,background:ve.bg,border:`2px solid ${i.colorAcento}`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:28,fontWeight:700,color:i.colorAcento},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:ve.ink,marginBottom:2,lineHeight:1.2},children:t.nombre}),e.jsx("div",{style:{fontSize:10,fontWeight:600,color:i.colorAcento,marginBottom:6},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,lineHeight:1.5},children:[t.departamento,e.jsx("br",{}),t.email,e.jsx("br",{}),t.telefono]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:3,background:i.colorAcento}})]})}function kx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const a=wr(`https://${i.web}/team/${t.id}`,80,"#fff");return e.jsx("div",{style:{width:320,height:200,borderRadius:10,overflow:"hidden",background:`linear-gradient(135deg, ${i.colorPrimario} 0%, ${i.colorAcento} 100%)`,position:"relative",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:20},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,.7)",textAlign:"center",lineHeight:1.6},children:[t.tipoDoc,": ",t.documento,"  RH: ",t.rh,e.jsx("br",{}),"EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),"Emergencias: ",i.telefono]})]})})}return e.jsxs("div",{style:{width:320,height:200,borderRadius:10,overflow:"hidden",background:`linear-gradient(135deg, ${i.colorPrimario} 0%, ${i.colorAcento} 100%)`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{padding:"20px 24px",display:"flex",gap:16,height:"100%",boxSizing:"border-box"},children:[e.jsx("div",{style:{width:68,height:82,borderRadius:10,background:"rgba(255,255,255,.15)",border:"2px solid rgba(255,255,255,.3)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}):e.jsx("span",{style:{fontSize:30,fontWeight:800,color:"rgba(255,255,255,.6)"},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:800,color:"#fff",marginBottom:2,lineHeight:1.2,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:10,fontWeight:500,color:"rgba(255,255,255,.65)",marginBottom:10},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,.5)",lineHeight:1.6},children:[t.departamento,"  ",t.email,e.jsx("br",{}),t.telefono]})]})]}),e.jsx("div",{style:{position:"absolute",top:14,right:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:18,objectFit:"contain",opacity:.8}}):e.jsx("span",{style:{fontSize:10,fontWeight:700,color:"rgba(255,255,255,.4)",letterSpacing:1.5,textTransform:"uppercase"},children:i.nombre})})]})}function wx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const a=wr(`https://${i.web}/team/${t.id}`,80,ve.ink);return e.jsx("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:20},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,textAlign:"center",lineHeight:1.6},children:[t.tipoDoc," ",t.documento,"  RH: ",t.rh,e.jsx("br",{}),"EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),i.telefono]})]})})}return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{display:"flex",height:"100%"},children:[e.jsx("div",{style:{width:4,background:i.colorAcento}}),e.jsxs("div",{style:{flex:1,padding:"20px 22px",display:"flex",gap:14},children:[e.jsx("div",{style:{width:60,height:72,borderRadius:6,background:ve.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:26,fontWeight:700,color:ve.inkLight},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:ve.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,marginBottom:8,textTransform:"uppercase",letterSpacing:.5},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,lineHeight:1.6},children:[t.departamento,e.jsx("br",{}),t.email,"  ",t.telefono]})]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:10,right:16,fontSize:8,fontWeight:600,color:ve.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:i.nombre})]})}function zx({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:32,background:"#B91C1C",display:"flex",alignItems:"center",padding:"0 16px"},children:e.jsx("span",{style:{fontSize:10,fontWeight:700,color:"#fff",letterSpacing:1},children:" DATOS DE EMERGENCIA"})}),e.jsxs("div",{style:{padding:"10px 16px",fontSize:9,color:ve.ink,lineHeight:1.8},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"2px 10px"},children:[e.jsx("b",{children:"RH:"}),e.jsx("span",{style:{fontSize:14,fontWeight:800,color:"#B91C1C"},children:t.rh}),e.jsx("b",{children:"EPS:"}),e.jsx("span",{children:t.eps}),e.jsx("b",{children:"ARL:"}),e.jsx("span",{children:t.arl}),e.jsx("b",{children:"Doc:"}),e.jsxs("span",{children:[t.tipoDoc," ",t.documento]}),e.jsx("b",{children:"Ingreso:"}),e.jsx("span",{children:new Date(t.fechaIngreso).toLocaleDateString("es-CO")})]}),e.jsxs("div",{style:{marginTop:8,padding:"6px 10px",background:"#FFF3F3",borderRadius:4,border:"1px solid #B91C1C33"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#B91C1C"},children:"Contacto de emergencia empresa:"}),e.jsxs("div",{style:{fontSize:9,color:ve.ink},children:[i.telefono,"  ",i.email]})]})]}),e.jsxs("div",{style:{position:"absolute",bottom:6,right:10,fontSize:7,color:ve.inkLight},children:["Si encuentra esta tarjeta, devulvala a ",i.nombre]})]}):e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{height:44,background:i.colorPrimario,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:20,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:12,fontWeight:700,color:"#fff",letterSpacing:1},children:i.nombre.toUpperCase()}),e.jsx("span",{style:{fontSize:8,fontWeight:600,color:"rgba(255,255,255,.5)",background:"rgba(255,255,255,.1)",padding:"2px 8px",borderRadius:3},children:"PERSONAL DE OBRA"})]}),e.jsxs("div",{style:{padding:"10px 16px",display:"flex",gap:12},children:[e.jsx("div",{style:{width:58,height:70,borderRadius:6,background:ve.bg,border:`2px solid ${i.colorAcento}`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4}}):e.jsx("span",{style:{fontSize:24,fontWeight:700,color:i.colorAcento},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:ve.ink,marginBottom:1},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,marginBottom:4},children:t.cargo}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("span",{style:{fontSize:18,fontWeight:800,color:"#B91C1C",padding:"2px 8px",background:"#FFF3F3",borderRadius:4},children:t.rh}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,lineHeight:1.5},children:["EPS: ",t.eps,e.jsx("br",{}),"ARL: ",t.arl]})]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:3,background:"#B91C1C"}})]})}const jc={classic:Cx,modern:kx,minimal:wx,obra:zx};function Ex({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsx("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",background:i.colorPrimario,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{textAlign:"center"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:32,objectFit:"contain",marginBottom:10}}):e.jsx("div",{style:{fontSize:18,fontWeight:800,color:"#fff",letterSpacing:2,marginBottom:6},children:i.nombre.toUpperCase()}),e.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,.45)",letterSpacing:2,textTransform:"uppercase"},children:i.slogan})]})}):e.jsxs("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${ve.border}`,fontFamily:`'${n}',sans-serif`,position:"relative"},children:[e.jsx("div",{style:{height:4,background:i.colorAcento}}),e.jsxs("div",{style:{padding:"22px 24px"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,color:ve.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,textTransform:"uppercase",letterSpacing:.8,marginBottom:14},children:t.cargo}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"3px 8px",fontSize:8,color:ve.inkMid},children:[e.jsx("span",{style:{color:ve.inkLight},children:""}),e.jsx("span",{children:t.email}),e.jsx("span",{style:{color:ve.inkLight},children:""}),e.jsx("span",{children:t.telefono}),e.jsx("span",{style:{color:ve.inkLight},children:""}),e.jsx("span",{children:i.direccion}),e.jsx("span",{style:{color:ve.inkLight},children:""}),e.jsx("span",{children:i.web})]})]}),e.jsx("div",{style:{position:"absolute",bottom:12,right:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:16,objectFit:"contain",opacity:.3}}):e.jsx("span",{style:{fontSize:8,fontWeight:700,color:ve.inkLight,letterSpacing:1.5,textTransform:"uppercase",opacity:.3},children:i.nombre})})]})}function Ax({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const a=wr(`https://${i.web}/team/${t.id}`,70,"#fff");return e.jsxs("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",background:`linear-gradient(145deg, ${i.colorAcento} 0%, ${i.colorPrimario} 100%)`,fontFamily:`'${n}',sans-serif`,display:"flex",alignItems:"center",justifyContent:"center",gap:24,padding:"0 30px"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a}}),e.jsxs("div",{style:{textAlign:"left"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:22,objectFit:"contain",marginBottom:8}}):e.jsx("div",{style:{fontSize:14,fontWeight:800,color:"#fff",letterSpacing:1.5,marginBottom:6},children:i.nombre}),e.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.5)",letterSpacing:1.5,textTransform:"uppercase",lineHeight:1.6},children:[i.slogan,e.jsx("br",{}),i.web]})]})]})}return e.jsxs("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",position:"relative",background:"#fff",border:`1px solid ${ve.border}`,fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:100,height:"100%",background:`linear-gradient(180deg, ${i.colorAcento} 0%, ${i.colorPrimario} 100%)`},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("div",{style:{width:44,height:52,borderRadius:8,background:"rgba(255,255,255,.15)",border:"1.5px solid rgba(255,255,255,.25)",display:"flex",alignItems:"center",justifyContent:"center"},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:22,fontWeight:800,color:"rgba(255,255,255,.6)"},children:t.nombre[0]})})})}),e.jsxs("div",{style:{marginLeft:112,padding:"22px 20px"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,color:ve.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,textTransform:"uppercase",letterSpacing:.8,marginBottom:14},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:ve.inkMid,lineHeight:1.8},children:[t.email,e.jsx("br",{}),t.telefono,e.jsx("br",{}),i.web]})]})]})}function Fx({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsx("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${ve.border}`,fontFamily:`'${n}',sans-serif`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:28,objectFit:"contain",opacity:.2}}):e.jsx("div",{style:{fontSize:16,fontWeight:800,color:ve.ink,letterSpacing:3,opacity:.12},children:i.nombre.toUpperCase()}),e.jsx("div",{style:{fontSize:7,color:ve.inkLight,letterSpacing:2,textTransform:"uppercase",marginTop:8},children:i.slogan})]})}):e.jsxs("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${ve.border}`,fontFamily:`'${n}',sans-serif`,position:"relative",padding:24,boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:[e.jsx("div",{style:{position:"absolute",top:20,right:20},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:14,objectFit:"contain",opacity:.25}}):e.jsx("span",{style:{fontSize:8,fontWeight:700,color:ve.inkLight,letterSpacing:1.5,textTransform:"uppercase",opacity:.3},children:i.nombre})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:16,fontWeight:700,color:ve.ink,marginBottom:1,letterSpacing:-.5},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:500,color:i.colorAcento,marginBottom:12},children:t.cargo}),e.jsxs("div",{style:{display:"flex",gap:16,fontSize:8,color:ve.inkLight},children:[e.jsx("span",{children:t.email}),e.jsx("span",{children:t.telefono}),e.jsx("span",{children:i.web})]})]})]})}const Sc={corporate:Ex,creative:Ax,minimal_biz:Fx};function Tx({emp:t,brand:i}){const o=i.tipografia,n=wr(`https://${i.web}/team/${t.id}`,100,i.colorAcento);return e.jsxs("div",{style:{width:320,borderRadius:16,overflow:"hidden",background:"#fff",boxShadow:"0 8px 32px rgba(0,0,0,.12)",fontFamily:`'${o}',sans-serif`},children:[e.jsxs("div",{style:{height:80,background:`linear-gradient(135deg, ${i.colorPrimario}, ${i.colorAcento})`,position:"relative",display:"flex",alignItems:"flex-end",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:12,left:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:16,objectFit:"contain",opacity:.6}}):e.jsx("span",{style:{fontSize:9,fontWeight:700,color:"rgba(255,255,255,.5)",letterSpacing:1.5},children:i.nombre.toUpperCase()})}),e.jsx("div",{style:{width:72,height:72,borderRadius:"50%",background:"#fff",border:"3px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",transform:"translateY(36px)",boxShadow:"0 4px 12px rgba(0,0,0,.1)"},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%"}}):e.jsx("span",{style:{fontSize:28,fontWeight:800,color:i.colorAcento},children:t.nombre[0]})})]}),e.jsxs("div",{style:{padding:"44px 24px 20px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:ve.ink,marginBottom:2},children:t.nombre}),e.jsx("div",{style:{fontSize:11,fontWeight:500,color:i.colorAcento,marginBottom:4},children:t.cargo}),e.jsxs("div",{style:{fontSize:10,color:ve.inkLight,marginBottom:16},children:[t.departamento,"  ",i.nombre]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"center",marginBottom:16},children:[{icon:"",label:"Email",val:t.email},{icon:"",label:"Llamar",val:t.telefono},{icon:"",label:"Web",val:i.web}].map((a,r)=>e.jsxs("div",{style:{flex:1,padding:"10px 6px",background:ve.surface,borderRadius:10,border:`1px solid ${ve.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:16,marginBottom:2},children:a.icon}),e.jsx("div",{style:{fontSize:8,fontWeight:600,color:ve.inkMid},children:a.label})]},r))}),e.jsxs("div",{style:{textAlign:"left",fontSize:10,color:ve.inkMid,lineHeight:1.8,padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:ve.inkLight},children:"Email"}),e.jsx("span",{children:t.email})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:ve.inkLight},children:"Telfono"}),e.jsx("span",{children:t.telefono})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:ve.inkLight},children:"Direccin"}),e.jsx("span",{children:i.direccion})]})]}),e.jsxs("div",{style:{marginTop:16,padding:16,background:ve.surface,borderRadius:12,display:"inline-block"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:n}}),e.jsx("div",{style:{fontSize:8,color:ve.inkLight,marginTop:4},children:"Escanea para guardar contacto"})]})]})]})}function Bx({empleados:t,brand:i,tipo:o,template:n}){const a=o==="carnet"?jc[n]:Sc[n];return a?e.jsxs("div",{style:{background:"#fff",padding:20},children:[e.jsxs("div",{style:{...at,fontSize:11,color:ve.inkLight,marginBottom:16,textAlign:"center"},children:["Vista previa de impresin  ",t.length," ",o==="carnet"?"carnets":"tarjetas"," (frente y reverso)"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:t.map(r=>e.jsxs(vr.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{...at,fontSize:9,color:ve.inkLight,marginBottom:4},children:["Frente  ",r.nombre]}),e.jsx(a,{emp:r,brand:i,side:"front"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{...at,fontSize:9,color:ve.inkLight,marginBottom:4},children:"Reverso"}),e.jsx(a,{emp:r,brand:i,side:"back"})]})]},r.id))})]}):null}function Ix(){const t=F.useMemo(()=>jx(),[]),[i,o]=F.useState("carnets"),[n,a]=F.useState(()=>bx("empleados")||Sx),[r,s]=F.useState(null),[g,h]=F.useState("classic"),[b,j]=F.useState("corporate"),[k,v]=F.useState("front"),[m,f]=F.useState(!1),[p,d]=F.useState([]),[c,l]=F.useState(null),[x,y]=F.useState("");F.useEffect(()=>yx("empleados",n),[n]);const u=F.useMemo(()=>{if(!x)return n;const Z=x.toLowerCase();return n.filter(K=>K.nombre.toLowerCase().includes(Z)||K.cargo.toLowerCase().includes(Z)||K.departamento.toLowerCase().includes(Z))},[n,x]),S=r?n.find(Z=>Z.id===r):u[0],A=Z=>{d(K=>K.includes(Z)?K.filter(P=>P!==Z):[...K,Z])},E=[{id:"carnets",icon:"",label:"Carnets Corporativos"},{id:"tarjetas",icon:"",label:"Tarjetas de Visita"},{id:"virtual",icon:"",label:"Tarjeta Virtual"},{id:"empleados",icon:"",label:"Empleados"}],w=()=>{if(!c)return null;const Z=!n.find(he=>he.id===c.id),K=(he,Q)=>l(Se=>({...Se,[he]:Q})),P=()=>{a(Z?he=>[...he,c]:he=>he.map(Q=>Q.id===c.id?c:Q)),l(null)},te=[["nombre","Nombre completo","text"],["cargo","Cargo","text"],["departamento","Departamento","text"],["email","Email corporativo","email"],["telefono","Telfono","tel"],["tipoDoc","Tipo documento","text"],["documento","N documento","text"],["rh","Grupo sanguneo","text"],["eps","EPS","text"],["arl","ARL","text"],["fechaIngreso","Fecha ingreso","date"]];return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>l(null),children:e.jsxs("div",{onClick:he=>he.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:520,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...at,fontSize:16,fontWeight:700,color:ve.ink,marginBottom:16},children:Z?" Nuevo empleado":" Editar empleado"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:te.map(([he,Q,Se])=>e.jsxs("div",{style:{gridColumn:he==="nombre"?"1 / -1":void 0},children:[e.jsx("label",{style:{...at,fontSize:10,fontWeight:600,color:ve.inkLight},children:Q}),e.jsx("input",{type:Se,value:c[he]||"",onChange:ae=>K(he,ae.target.value),style:{...at,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})]},he))}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("label",{style:{...at,fontSize:10,fontWeight:600,color:ve.inkLight},children:"Foto (URL)"}),e.jsx("input",{value:c.foto||"",onChange:he=>K("foto",he.target.value),placeholder:"https://ejemplo.com/foto.jpg",style:{...at,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>l(null),style:{...at,padding:"8px 20px",fontSize:12,color:ve.inkMid,background:ve.bg,border:`1px solid ${ve.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:P,style:{...at,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ve.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},_=()=>{var K;const Z=jc[g];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[nd.map(P=>e.jsx("button",{onClick:()=>h(P.id),style:{...at,padding:"8px 16px",fontSize:11,fontWeight:g===P.id?700:500,color:g===P.id?"#fff":ve.inkMid,background:g===P.id?ve.accent:ve.surface,border:`1px solid ${g===P.id?ve.accent:ve.border}`,borderRadius:6,cursor:"pointer"},children:P.label},P.id)),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>v(P=>P==="front"?"back":"front"),style:{...at,padding:"8px 14px",fontSize:11,color:ve.info,background:ve.infoBg,border:`1px solid ${ve.info}33`,borderRadius:6,cursor:"pointer"},children:[" ",k==="front"?"Ver reverso":"Ver frente"]}),e.jsx("button",{onClick:()=>f(!m),style:{...at,padding:"8px 14px",fontSize:11,fontWeight:600,color:m?ve.danger:ve.inkMid,background:m?ve.dangerBg:ve.surface,border:`1px solid ${m?ve.danger+"33":ve.border}`,borderRadius:6,cursor:"pointer"},children:m?" Cancelar lote":" Imprimir lote"})]}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:x,onChange:P=>y(P.target.value),placeholder:"Buscar",style:{...at,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})}),u.map(P=>e.jsxs("div",{onClick:()=>{s(P.id),m&&A(P.id)},style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,transition:"all .1s",background:r===P.id?ve.accentBg:p.includes(P.id)?ve.infoBg:"transparent",border:`1px solid ${r===P.id?ve.accent+"33":"transparent"}`},children:[m&&e.jsx("input",{type:"checkbox",checked:p.includes(P.id),readOnly:!0,style:{accentColor:ve.accent}}),e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:ve.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:ve.accent,flexShrink:0},children:P.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...at,fontSize:11,fontWeight:600,color:ve.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:P.nombre}),e.jsx("div",{style:{...at,fontSize:9,color:ve.inkLight},children:P.cargo})]})]},P.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:m&&p.length>0?e.jsx(Bx,{empleados:n.filter(P=>p.includes(P.id)),brand:t,tipo:"carnet",template:g}):S?e.jsxs("div",{children:[e.jsxs("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginBottom:8},children:[k==="front"?"FRENTE":"REVERSO","  Plantilla: ",(K=nd.find(P=>P.id===g))==null?void 0:K.label]}),e.jsx("div",{style:{transform:"scale(1.2)",transformOrigin:"top center",marginBottom:40},children:e.jsx(Z,{emp:S,brand:t,side:k})}),e.jsx("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginTop:60},children:"Tamao: 85.6mm  54mm (estndar ISO/IEC 7810 CR80)"})]}):e.jsxs("div",{style:{...at,textAlign:"center",padding:40,color:ve.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado para ver su carnet"})]})})]})]})},z=()=>{var K;const Z=Sc[b];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[rd.map(P=>e.jsx("button",{onClick:()=>j(P.id),style:{...at,padding:"8px 16px",fontSize:11,fontWeight:b===P.id?700:500,color:b===P.id?"#fff":ve.inkMid,background:b===P.id?ve.accent:ve.surface,border:`1px solid ${b===P.id?ve.accent:ve.border}`,borderRadius:6,cursor:"pointer"},children:P.label},P.id)),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>v(P=>P==="front"?"back":"front"),style:{...at,padding:"8px 14px",fontSize:11,color:ve.info,background:ve.infoBg,border:`1px solid ${ve.info}33`,borderRadius:6,cursor:"pointer"},children:[" ",k==="front"?"Ver reverso":"Ver frente"]})]}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:x,onChange:P=>y(P.target.value),placeholder:"Buscar",style:{...at,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})}),u.map(P=>e.jsxs("div",{onClick:()=>s(P.id),style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,background:r===P.id?ve.accentBg:"transparent",border:`1px solid ${r===P.id?ve.accent+"33":"transparent"}`},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:ve.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:ve.accent,flexShrink:0},children:P.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...at,fontSize:11,fontWeight:600,color:ve.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:P.nombre}),e.jsx("div",{style:{...at,fontSize:9,color:ve.inkLight},children:P.cargo})]})]},P.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:S?e.jsxs("div",{children:[e.jsxs("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginBottom:8},children:[k==="front"?"FRENTE":"REVERSO","  Plantilla: ",(K=rd.find(P=>P.id===b))==null?void 0:K.label]}),e.jsx("div",{style:{transform:"scale(1.15)",transformOrigin:"top center",marginBottom:30},children:e.jsx(Z,{emp:S,brand:t,side:k})}),e.jsx("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginTop:50},children:"Tamao: 90mm  50mm (estndar europeo)"})]}):e.jsxs("div",{style:{...at,textAlign:"center",padding:40,color:ve.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado"})]})})]})]})},T=()=>e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:x,onChange:Z=>y(Z.target.value),placeholder:"Buscar",style:{...at,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})}),u.map(Z=>e.jsxs("div",{onClick:()=>s(Z.id),style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,background:r===Z.id?ve.accentBg:"transparent",border:`1px solid ${r===Z.id?ve.accent+"33":"transparent"}`},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:ve.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:ve.accent,flexShrink:0},children:Z.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...at,fontSize:11,fontWeight:600,color:ve.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:Z.nombre}),e.jsx("div",{style:{...at,fontSize:9,color:ve.inkLight},children:Z.cargo})]})]},Z.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:S?e.jsxs("div",{children:[e.jsx("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginBottom:12},children:"TARJETA VIRTUAL  vista previa mvil"}),e.jsx(Tx,{emp:S,brand:t}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:20},children:[e.jsx("button",{style:{...at,padding:"8px 18px",fontSize:11,fontWeight:600,color:ve.accent,background:ve.accentBg,border:`1px solid ${ve.accent}33`,borderRadius:6,cursor:"pointer"},children:" Copiar enlace"}),e.jsx("button",{style:{...at,padding:"8px 18px",fontSize:11,fontWeight:600,color:ve.info,background:ve.infoBg,border:`1px solid ${ve.info}33`,borderRadius:6,cursor:"pointer"},children:" Compartir WhatsApp"}),e.jsx("button",{style:{...at,padding:"8px 18px",fontSize:11,fontWeight:600,color:ve.inkMid,background:ve.surface,border:`1px solid ${ve.border}`,borderRadius:6,cursor:"pointer"},children:" Descargar vCard"})]}),e.jsx("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginTop:12},children:"El destinatario puede guardar el contacto directamente escaneando el QR"})]}):e.jsxs("div",{style:{...at,textAlign:"center",padding:40,color:ve.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado"})]})})]})}),L=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:x,onChange:Z=>y(Z.target.value),placeholder:"Buscar por nombre, cargo, departamento",style:{...at,width:"100%",padding:"8px 12px",fontSize:12,border:`1px solid ${ve.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>l({id:vx(),nombre:"",cargo:"",departamento:"",email:"",telefono:"",tipoDoc:"CC",documento:"",rh:"O+",eps:"",arl:"",fechaIngreso:new Date().toISOString().slice(0,10),foto:null}),style:{...at,padding:"8px 18px",fontSize:11,fontWeight:700,color:"#fff",background:ve.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo empleado"})]}),e.jsx("div",{style:{background:"#fff",borderRadius:10,border:`1px solid ${ve.border}`,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:ve.surface},children:["","Nombre","Cargo","Departamento","Email","Doc","RH",""].map((Z,K)=>e.jsx("th",{style:{...at,padding:"10px 12px",textAlign:"left",fontSize:10,fontWeight:600,color:ve.inkLight,borderBottom:`1px solid ${ve.border}`},children:Z},K))})}),e.jsx("tbody",{children:u.map(Z=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ve.border}`},onMouseEnter:K=>K.currentTarget.style.background=ve.surface,onMouseLeave:K=>K.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:ve.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:ve.accent},children:Z.nombre[0]})}),e.jsx("td",{style:{...at,padding:"8px 12px",fontWeight:600,color:ve.ink},children:Z.nombre}),e.jsx("td",{style:{...at,padding:"8px 12px",color:ve.inkMid},children:Z.cargo}),e.jsx("td",{style:{...at,padding:"8px 12px",color:ve.inkMid},children:Z.departamento}),e.jsx("td",{style:{...at,padding:"8px 12px",color:ve.inkLight,fontSize:11},children:Z.email}),e.jsxs("td",{style:{...at,padding:"8px 12px",color:ve.inkLight,fontSize:11},children:[Z.tipoDoc," ",Z.documento]}),e.jsx("td",{style:{...at,padding:"8px 12px"},children:e.jsx("span",{style:{fontWeight:700,color:"#B91C1C",fontSize:13},children:Z.rh})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("button",{onClick:()=>l({...Z}),style:{...at,padding:"4px 10px",fontSize:10,color:ve.accent,background:ve.accentBg,border:`1px solid ${ve.accent}33`,borderRadius:4,cursor:"pointer"},children:""})})]},Z.id))})]})}),e.jsx("p",{style:{...at,fontSize:10,color:ve.inkLight,marginTop:12},children:" Tip: En produccin, los empleados se vincularn automticamente desde el mdulo de RRHH."})]});return e.jsxs("div",{style:{...at,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...at,fontSize:22,fontWeight:700,color:ve.ink,margin:"0 0 4px"},children:" Identidad Corporativa"}),e.jsxs("p",{style:{...at,fontSize:12,color:ve.inkLight,margin:0},children:["Carnets corporativos, tarjetas de visita fsicas y virtuales con la identidad de ",t.nombre]})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${ve.border}`,marginBottom:20},children:E.map(Z=>e.jsxs("button",{onClick:()=>o(Z.id),style:{...at,padding:"10px 18px",fontSize:12,fontWeight:i===Z.id?700:500,color:i===Z.id?ve.accent:ve.inkLight,background:"none",border:"none",borderBottom:i===Z.id?`2px solid ${ve.accent}`:"2px solid transparent",cursor:"pointer",transition:"all .15s"},children:[Z.icon," ",Z.label]},Z.id))}),i==="carnets"&&_(),i==="tarjetas"&&z(),i==="virtual"&&T(),i==="empleados"&&L(),w()]})}const ke={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},We={fontFamily:"'DM Sans',sans-serif"},Cc="hab:firmas:",ad=t=>{try{return JSON.parse(Ee.getSync(Cc+t))||null}catch{return null}},sd=(t,i)=>{Ee.set(Cc+t,JSON.stringify(i))},Yr=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),ps=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",gs=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function ld({onSave:t,onCancel:i,signer:o,width:n=480,height:a=200}){const r=F.useRef(null),[s,g]=F.useState(!1),[h,b]=F.useState(!1),j=F.useRef(null);F.useEffect(()=>{const c=r.current;if(!c)return;const l=c.getContext("2d");l.fillStyle="#fff",l.fillRect(0,0,n,a),l.strokeStyle="#E0E0E0",l.lineWidth=1,l.setLineDash([4,4]),l.beginPath(),l.moveTo(30,a-40),l.lineTo(n-30,a-40),l.stroke(),l.setLineDash([]),l.fillStyle="#AAA",l.font="10px 'DM Sans', sans-serif",l.fillText("Firma aqu",30,a-20)},[n,a]);const k=c=>{const x=r.current.getBoundingClientRect(),y=c.touches?c.touches[0].clientX:c.clientX,u=c.touches?c.touches[0].clientY:c.clientY;return{x:(y-x.left)*(n/x.width),y:(u-x.top)*(a/x.height)}},v=c=>{c.preventDefault(),g(!0),j.current=k(c)},m=c=>{if(!s)return;c.preventDefault();const x=r.current.getContext("2d"),y=k(c);x.strokeStyle="#111",x.lineWidth=2.5,x.lineCap="round",x.lineJoin="round",x.beginPath(),x.moveTo(j.current.x,j.current.y),x.lineTo(y.x,y.y),x.stroke(),j.current=y,b(!0)},f=()=>{g(!1),j.current=null},p=()=>{const l=r.current.getContext("2d");l.fillStyle="#fff",l.fillRect(0,0,n,a),l.strokeStyle="#E0E0E0",l.lineWidth=1,l.setLineDash([4,4]),l.beginPath(),l.moveTo(30,a-40),l.lineTo(n-30,a-40),l.stroke(),l.setLineDash([]),l.fillStyle="#AAA",l.font="10px 'DM Sans', sans-serif",l.fillText("Firma aqu",30,a-20),b(!1)},d=()=>{if(!h)return;const c=r.current.toDataURL("image/png");t(c)};return e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:20,border:`1px solid ${ke.border}`},children:[o&&e.jsxs("div",{style:{...We,fontSize:12,color:ke.inkMid,marginBottom:12},children:["Firmante: ",e.jsx("b",{children:o})]}),e.jsx("div",{style:{border:`2px solid ${ke.border}`,borderRadius:8,overflow:"hidden",marginBottom:12,touchAction:"none",cursor:"crosshair"},children:e.jsx("canvas",{ref:r,width:n,height:a,style:{width:"100%",height:"auto",display:"block"},onMouseDown:v,onMouseMove:m,onMouseUp:f,onMouseLeave:f,onTouchStart:v,onTouchMove:m,onTouchEnd:f})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"space-between"},children:[e.jsx("button",{onClick:p,style:{...We,padding:"7px 16px",fontSize:11,color:ke.inkMid,background:ke.bg,border:`1px solid ${ke.border}`,borderRadius:6,cursor:"pointer"},children:" Limpiar"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[i&&e.jsx("button",{onClick:i,style:{...We,padding:"7px 16px",fontSize:11,color:ke.inkMid,background:ke.bg,border:`1px solid ${ke.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:d,disabled:!h,style:{...We,padding:"7px 20px",fontSize:11,fontWeight:700,color:"#fff",background:h?ke.accent:ke.inkLight,border:"none",borderRadius:6,cursor:h?"pointer":"not-allowed"},children:" Firmar"})]})]})]})}function Rx(t){let i=0;for(let o=0;o<t.length;o++)i=(i<<5)-i+t.charCodeAt(o)|0;return Math.abs(i).toString(16).toUpperCase().padStart(8,"0")}const Xr=[{id:"contrato",label:"Contrato",icon:"",color:"#3B3B3B"},{id:"acta",label:"Acta",icon:"",color:"#111111"},{id:"otros",label:"Otros / Anexo",icon:"",color:"#5B3A8C"},{id:"carta",label:"Carta / Comunicacin",icon:"",color:"#8C6A00"},{id:"poder",label:"Poder / Autorizacin",icon:"",color:"#0D5E6E"},{id:"poliza",label:"Pliza / Seguro",icon:"",color:"#B91C1C"},{id:"recibo",label:"Recibo / Paz y Salvo",icon:"",color:"#111111"},{id:"conformidad",label:"Acta de Conformidad",icon:"",color:"#0D7377"},{id:"otro",label:"Otro documento",icon:"",color:"#555"}],us=[{id:"borrador",label:"Borrador",color:"#888",bg:"#F5F5F5"},{id:"pendiente",label:"Pendiente",color:"#8C6A00",bg:"#FFF8EE"},{id:"parcial",label:"Firma parcial",color:"#3B3B3B",bg:"#F0F0F0"},{id:"completado",label:"Firmado",color:"#111111",bg:"#EBEBEB"},{id:"rechazado",label:"Rechazado",color:"#B91C1C",bg:"#FDF0F0"},{id:"vencido",label:"Vencido",color:"#B91C1C",bg:"#FDF0F0"}],_x=[{id:"d1",tipo:"contrato",titulo:"Contrato de Diseo Interior  Apto 502 Rosales",descripcion:"Contrato de prestacin de servicios de diseo interior para apartamento en Rosales, Bogot.",cliente:"Mara Fernanda Gmez",proyecto:"Apto 502 Rosales",valor:"$45.000.000 COP",firmantes:[{id:"f1",nombre:"Laura Snchez Daz",rol:"Representante Legal",email:"laura@habitaris.co",estado:"pendiente",firma:null,fechaFirma:null},{id:"f2",nombre:"Mara Fernanda Gmez",rol:"Cliente",email:"mfgomez@email.com",estado:"pendiente",firma:null,fechaFirma:null}],estado:"pendiente",fechaCreacion:"2026-02-20T10:00:00Z",fechaLimite:"2026-03-05",auditoria:[{fecha:"2026-02-20T10:00:00Z",accion:"Documento creado",usuario:"Sistema"}]},{id:"d2",tipo:"acta",titulo:"Acta de Inicio  Remodelacin Casa Chic",descripcion:"Acta de inicio de obras de remodelacin integral.",cliente:"Andrs Meja Ruiz",proyecto:"Casa Chic Norte",valor:"$120.000.000 COP",firmantes:[{id:"f3",nombre:"Carlos Lpez Meja",rol:"Director de Proyecto",email:"carlos@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo1",fecha:"2026-02-18T14:30:00Z"},fechaFirma:"2026-02-18T14:30:00Z"},{id:"f4",nombre:"Andrs Meja Ruiz",rol:"Propietario",email:"amejia@email.com",estado:"pendiente",firma:null,fechaFirma:null},{id:"f5",nombre:"Mara Rodrguez Pea",rol:"Directora de Obra",email:"maria@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo2",fecha:"2026-02-18T15:00:00Z"},fechaFirma:"2026-02-18T15:00:00Z"}],estado:"parcial",fechaCreacion:"2026-02-18T09:00:00Z",fechaLimite:"2026-02-28",auditoria:[{fecha:"2026-02-18T09:00:00Z",accion:"Documento creado",usuario:"Sistema"},{fecha:"2026-02-18T14:30:00Z",accion:"Firmado por Carlos Lpez Meja",usuario:"Carlos Lpez"},{fecha:"2026-02-18T15:00:00Z",accion:"Firmado por Mara Rodrguez Pea",usuario:"Mara Rodrguez"}]},{id:"d3",tipo:"conformidad",titulo:"Acta de Conformidad  Entrega Oficina 301",descripcion:"Acta de conformidad y recepcin final de obra de adecuacin de oficina.",cliente:"TechStar S.A.S",proyecto:"Oficina 301 WTC",valor:"$85.000.000 COP",firmantes:[{id:"f6",nombre:"Laura Snchez Daz",rol:"Gerente General",email:"laura@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo3",fecha:"2026-02-10T11:00:00Z"},fechaFirma:"2026-02-10T11:00:00Z"},{id:"f7",nombre:"Roberto Acosta",rol:"Rep. Legal TechStar",email:"racosta@techstar.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo4",fecha:"2026-02-10T16:00:00Z"},fechaFirma:"2026-02-10T16:00:00Z"}],estado:"completado",fechaCreacion:"2026-02-10T08:00:00Z",fechaLimite:"2026-02-15",auditoria:[{fecha:"2026-02-10T08:00:00Z",accion:"Documento creado",usuario:"Sistema"},{fecha:"2026-02-10T11:00:00Z",accion:"Firmado por Laura Snchez Daz",usuario:"Laura Snchez"},{fecha:"2026-02-10T16:00:00Z",accion:"Firmado por Roberto Acosta",usuario:"Roberto Acosta"},{fecha:"2026-02-10T16:00:00Z",accion:"Documento completado  todas las firmas recogidas",usuario:"Sistema"}]}];function Gn({children:t,color:i,bg:o}){return e.jsx("span",{style:{...We,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o},children:t})}function Mx(){const[t,i]=F.useState("documentos"),[o,n]=F.useState(()=>ad("docs")||_x),[a,r]=F.useState(()=>ad("firmas_guardadas")||[]),[s,g]=F.useState(""),[h,b]=F.useState("all"),[j,k]=F.useState("all"),[v,m]=F.useState(null),[f,p]=F.useState(null),[d,c]=F.useState(null);F.useState(null),F.useEffect(()=>sd("docs",o),[o]),F.useEffect(()=>sd("firmas_guardadas",a),[a]);const l=F.useMemo(()=>o.filter(z=>{var T,L;if(h!=="all"&&z.estado!==h||j!=="all"&&z.tipo!==j)return!1;if(s){const Z=s.toLowerCase();return z.titulo.toLowerCase().includes(Z)||((T=z.cliente)==null?void 0:T.toLowerCase().includes(Z))||((L=z.proyecto)==null?void 0:L.toLowerCase().includes(Z))}return!0}),[o,h,j,s]),x=F.useMemo(()=>{const z=o.length,T=o.filter(te=>te.estado==="pendiente"||te.estado==="parcial").length,L=o.filter(te=>te.estado==="completado").length,Z=o.filter(te=>te.estado==="rechazado").length,K=o.filter(te=>te.estado!=="completado"&&te.fechaLimite&&new Date(te.fechaLimite)<new Date).length,P=o.reduce((te,he)=>te+he.firmantes.filter(Q=>Q.estado==="pendiente").length,0);return{total:z,pendientes:T,completados:L,rechazados:Z,vencidos:K,firmasPendientes:P}},[o]),y=(z,T,L)=>{n(Z=>Z.map(K=>{if(K.id!==z)return K;const P=K.firmantes.map(U=>U.id!==T?U:{...U,estado:"firmado",firma:{imagen:L,fecha:new Date().toISOString()},fechaFirma:new Date().toISOString()}),te=P.every(U=>U.estado==="firmado"),he=P.some(U=>U.estado==="firmado"),Q=te?"completado":he?"parcial":K.estado,Se=P.find(U=>U.id===T),ae=[...K.auditoria,{fecha:new Date().toISOString(),accion:`Firmado por ${Se==null?void 0:Se.nombre}`,usuario:Se==null?void 0:Se.nombre}];return te&&ae.push({fecha:new Date().toISOString(),accion:"Documento completado  todas las firmas recogidas",usuario:"Sistema"}),{...K,firmantes:P,estado:Q,auditoria:ae}})),c(null)},u=()=>{var P;const z=v?o.find(te=>te.id===v):null;if(!z)return null;const T=Xr.find(te=>te.id===z.tipo),L=us.find(te=>te.id===z.estado),Z=Rx(z.id+z.titulo+z.fechaCreacion),K=z.fechaLimite&&new Date(z.fechaLimite)<new Date&&z.estado!=="completado";return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>m(null),children:e.jsxs("div",{onClick:te=>te.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:720,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:6},children:[e.jsxs(Gn,{color:T==null?void 0:T.color,bg:(T==null?void 0:T.color)+"18",children:[T==null?void 0:T.icon," ",T==null?void 0:T.label]}),e.jsx(Gn,{color:L==null?void 0:L.color,bg:L==null?void 0:L.bg,children:L==null?void 0:L.label}),K&&e.jsx(Gn,{color:ke.danger,bg:ke.dangerBg,children:" Vencido"})]}),e.jsx("h2",{style:{...We,fontSize:18,fontWeight:700,color:ke.ink,margin:0},children:z.titulo})]}),e.jsx("button",{onClick:()=>m(null),style:{...We,fontSize:18,color:ke.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...We,fontSize:12,color:ke.inkMid,lineHeight:1.6,marginBottom:16},children:z.descripcion}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:20},children:[{label:"Cliente",val:z.cliente},{label:"Proyecto",val:z.proyecto},{label:"Valor",val:z.valor},{label:"Creado",val:gs(z.fechaCreacion)},{label:"Fecha lmite",val:gs(z.fechaLimite)},{label:"Hash",val:`#${Z}`}].map((te,he)=>e.jsxs("div",{style:{padding:10,background:ke.surface,borderRadius:6},children:[e.jsx("div",{style:{...We,fontSize:9,color:ke.inkLight,marginBottom:2},children:te.label}),e.jsx("div",{style:{...We,fontSize:12,fontWeight:600,color:ke.ink},children:te.val||""})]},he))}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("div",{style:{...We,fontSize:13,fontWeight:700,color:ke.ink,marginBottom:12},children:" Firmantes"}),z.firmantes.map((te,he)=>{var ae;const Q=te.estado==="firmado",Se=te.estado==="rechazado";return e.jsxs("div",{style:{display:"flex",gap:14,alignItems:"center",padding:"12px 16px",background:Q?ke.accentBg:Se?ke.dangerBg:ke.surface,border:`1px solid ${Q?ke.accent+"33":Se?ke.danger+"33":ke.border}`,borderRadius:8,marginBottom:8},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:Q?ke.accent+"22":Se?ke.danger+"22":ke.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:700,color:Q?ke.accent:Se?ke.danger:ke.inkLight},children:Q?"":Se?"":he+1}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...We,fontSize:13,fontWeight:600,color:ke.ink},children:te.nombre}),e.jsxs("div",{style:{...We,fontSize:10,color:ke.inkLight},children:[te.rol,"  ",te.email]}),Q&&te.fechaFirma&&e.jsxs("div",{style:{...We,fontSize:9,color:ke.accent,marginTop:2},children:["Firmado: ",ps(te.fechaFirma)]}),Se&&te.motivoRechazo&&e.jsxs("div",{style:{...We,fontSize:9,color:ke.danger,marginTop:2},children:["Motivo: ",te.motivoRechazo]})]}),Q&&((ae=te.firma)==null?void 0:ae.imagen)&&te.firma.imagen.startsWith("data:image")&&e.jsx("div",{style:{border:`1px solid ${ke.border}`,borderRadius:6,overflow:"hidden",background:"#fff"},children:e.jsx("img",{src:te.firma.imagen,alt:"Firma",style:{height:50,objectFit:"contain"}})}),te.estado==="pendiente"&&z.estado!=="rechazado"&&e.jsx("div",{style:{display:"flex",gap:6},children:e.jsx("button",{onClick:()=>{c({docId:z.id,firmanteId:te.id,nombre:te.nombre}),m(null)},style:{...We,padding:"6px 14px",fontSize:10,fontWeight:700,color:"#fff",background:ke.accent,border:"none",borderRadius:5,cursor:"pointer"},children:" Firmar"})})]},te.id)})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{...We,fontSize:10,color:ke.inkLight},children:"Progreso de firmas"}),e.jsxs("span",{style:{...We,fontSize:10,fontWeight:600,color:ke.accent},children:[z.firmantes.filter(te=>te.estado==="firmado").length,"/",z.firmantes.length]})]}),e.jsx("div",{style:{height:6,background:ke.bg,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:3,transition:"width .3s",width:`${z.firmantes.filter(te=>te.estado==="firmado").length/z.firmantes.length*100}%`,background:z.estado==="completado"?ke.accent:z.estado==="rechazado"?ke.danger:ke.warning}})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{...We,fontSize:13,fontWeight:700,color:ke.ink,marginBottom:10},children:" Trazabilidad / Auditora"}),e.jsx("div",{style:{borderLeft:`2px solid ${ke.border}`,paddingLeft:16,marginLeft:8},children:z.auditoria.map((te,he)=>e.jsxs("div",{style:{marginBottom:12,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-22,top:2,width:12,height:12,borderRadius:"50%",background:he===z.auditoria.length-1?ke.accent:ke.bg,border:`2px solid ${he===z.auditoria.length-1?ke.accent:ke.border}`}}),e.jsx("div",{style:{...We,fontSize:10,color:ke.inkLight},children:ps(te.fecha)}),e.jsx("div",{style:{...We,fontSize:12,color:ke.ink},children:te.accion}),e.jsxs("div",{style:{...We,fontSize:10,color:ke.inkLight},children:["por ",te.usuario]})]},he))})]}),z.estado==="completado"&&e.jsxs("div",{style:{marginTop:20,padding:20,borderRadius:10,background:"linear-gradient(135deg, #EBEBEB 0%, #F0F0F0 100%)",border:`1px solid ${ke.accent}33`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:28,marginBottom:8},children:""}),e.jsx("div",{style:{...We,fontSize:14,fontWeight:700,color:ke.accent},children:"Documento firmado digitalmente"}),e.jsxs("div",{style:{...We,fontSize:11,color:ke.inkMid,marginTop:4},children:["Hash de integridad: ",e.jsxs("code",{style:{background:"#fff",padding:"2px 8px",borderRadius:4,fontSize:10},children:["SHA-",Z,"-",z.firmantes.length,"F"]})]}),e.jsxs("div",{style:{...We,fontSize:10,color:ke.inkLight,marginTop:4},children:[z.firmantes.length," firmante(s)  Completado: ",ps((P=z.auditoria[z.auditoria.length-1])==null?void 0:P.fecha)]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20},children:[e.jsx("button",{onClick:()=>{p({...z,firmantes:z.firmantes.map(te=>({...te}))}),m(null)},style:{...We,padding:"8px 18px",fontSize:11,color:ke.accent,background:ke.accentBg,border:`1px solid ${ke.accent}33`,borderRadius:6,cursor:"pointer"},children:" Editar"}),e.jsx("button",{style:{...We,padding:"8px 18px",fontSize:11,color:ke.info,background:ke.infoBg,border:`1px solid ${ke.info}33`,borderRadius:6,cursor:"pointer"},children:" Enviar por email"}),e.jsx("button",{style:{...We,padding:"8px 18px",fontSize:11,color:ke.inkMid,background:ke.surface,border:`1px solid ${ke.border}`,borderRadius:6,cursor:"pointer"},children:" Descargar PDF"})]})]})})},S=()=>d?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1001,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>c(null),children:e.jsxs("div",{onClick:z=>z.stopPropagation(),style:{maxWidth:560,width:"100%"},children:[e.jsx("div",{style:{...We,fontSize:14,fontWeight:700,color:"#fff",marginBottom:12,textAlign:"center"},children:" Firma Digital"}),e.jsx(ld,{signer:d.nombre,onSave:z=>y(d.docId,d.firmanteId,z),onCancel:()=>c(null)}),a.length>0&&e.jsxs("div",{style:{background:"#fff",borderRadius:10,padding:14,marginTop:12,border:`1px solid ${ke.border}`},children:[e.jsx("div",{style:{...We,fontSize:11,fontWeight:600,color:ke.inkMid,marginBottom:8},children:"O usar firma guardada:"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:a.map(z=>e.jsxs("div",{onClick:()=>y(d.docId,d.firmanteId,z.imagen),style:{border:`1px solid ${ke.border}`,borderRadius:6,padding:4,cursor:"pointer",background:"#fff",transition:"all .15s"},onMouseEnter:T=>T.currentTarget.style.borderColor=ke.accent,onMouseLeave:T=>T.currentTarget.style.borderColor=ke.border,children:[e.jsx("img",{src:z.imagen,alt:z.nombre,style:{height:40,objectFit:"contain"}}),e.jsx("div",{style:{...We,fontSize:8,color:ke.inkLight,textAlign:"center"},children:z.nombre})]},z.id))})]})]})}):null,A=()=>{if(!f)return null;const z=!o.find(te=>te.id===f.id),T=(te,he)=>p(Q=>({...Q,[te]:he})),L=()=>T("firmantes",[...f.firmantes,{id:Yr(),nombre:"",rol:"",email:"",estado:"pendiente",firma:null,fechaFirma:null}]),Z=(te,he,Q)=>{const Se=[...f.firmantes];Se[te]={...Se[te],[he]:Q},T("firmantes",Se)},K=te=>T("firmantes",f.firmantes.filter((he,Q)=>Q!==te)),P=()=>{const te={...f};z?(te.fechaCreacion=new Date().toISOString(),te.auditoria=[{fecha:new Date().toISOString(),accion:"Documento creado",usuario:"Sistema"}],te.estado="pendiente",n(he=>[...he,te])):(te.auditoria=[...te.auditoria,{fecha:new Date().toISOString(),accion:"Documento editado",usuario:"Sistema"}],n(he=>he.map(Q=>Q.id===te.id?te:Q))),p(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>p(null),children:e.jsxs("div",{onClick:te=>te.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...We,fontSize:16,fontWeight:700,color:ke.ink,marginBottom:16},children:z?" Nuevo documento para firma":" Editar documento"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...We,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Tipo de documento"}),e.jsx("select",{value:f.tipo,onChange:te=>T("tipo",te.target.value),style:{...We,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5},children:Xr.map(te=>e.jsxs("option",{value:te.id,children:[te.icon," ",te.label]},te.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...We,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Fecha lmite de firma"}),e.jsx("input",{type:"date",value:f.fechaLimite||"",onChange:te=>T("fechaLimite",te.target.value),style:{...We,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("label",{style:{...We,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Ttulo del documento"}),e.jsx("input",{value:f.titulo||"",onChange:te=>T("titulo",te.target.value),style:{...We,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("label",{style:{...We,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:f.descripcion||"",onChange:te=>T("descripcion",te.target.value),rows:2,style:{...We,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...We,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Cliente"}),e.jsx("input",{value:f.cliente||"",onChange:te=>T("cliente",te.target.value),style:{...We,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...We,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Proyecto"}),e.jsx("input",{value:f.proyecto||"",onChange:te=>T("proyecto",te.target.value),style:{...We,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...We,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Valor"}),e.jsx("input",{value:f.valor||"",onChange:te=>T("valor",te.target.value),style:{...We,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{...We,fontSize:12,fontWeight:600,color:ke.ink,marginBottom:8},children:[" Firmantes (",f.firmantes.length,")"]}),f.firmantes.map((te,he)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8,marginBottom:6,alignItems:"end"},children:[e.jsxs("div",{children:[he===0&&e.jsx("label",{style:{...We,fontSize:9,color:ke.inkLight},children:"Nombre"}),e.jsx("input",{value:te.nombre,onChange:Q=>Z(he,"nombre",Q.target.value),placeholder:"Nombre completo",style:{...We,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[he===0&&e.jsx("label",{style:{...We,fontSize:9,color:ke.inkLight},children:"Rol"}),e.jsx("input",{value:te.rol,onChange:Q=>Z(he,"rol",Q.target.value),placeholder:"Ej: Rep. Legal",style:{...We,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[he===0&&e.jsx("label",{style:{...We,fontSize:9,color:ke.inkLight},children:"Email"}),e.jsx("input",{value:te.email,onChange:Q=>Z(he,"email",Q.target.value),placeholder:"email@...",style:{...We,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsx("button",{onClick:()=>K(he),style:{...We,padding:"6px 8px",fontSize:10,color:ke.danger,background:"none",border:"none",cursor:"pointer"},children:""})]},te.id||he)),e.jsx("button",{onClick:L,style:{...We,padding:"5px 14px",fontSize:10,color:ke.accent,background:ke.accentBg,border:`1px solid ${ke.accent}33`,borderRadius:5,cursor:"pointer",marginTop:4},children:"+ Aadir firmante"})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>p(null),style:{...We,padding:"8px 20px",fontSize:12,color:ke.inkMid,background:ke.bg,border:`1px solid ${ke.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:P,style:{...We,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ke.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},E=()=>e.jsxs("div",{children:[e.jsx("div",{style:{...We,fontSize:13,fontWeight:700,color:ke.ink,marginBottom:12},children:"Mis firmas guardadas"}),e.jsx("p",{style:{...We,fontSize:12,color:ke.inkLight,marginBottom:16},children:"Guarda tus firmas frecuentes para reutilizarlas rpidamente al firmar documentos."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px,1fr))",gap:12,marginBottom:20},children:a.map(z=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${ke.border}`,borderRadius:10,padding:16,textAlign:"center"},children:[e.jsx("div",{style:{border:`1px solid ${ke.border}`,borderRadius:6,overflow:"hidden",marginBottom:8,background:"#fff"},children:e.jsx("img",{src:z.imagen,alt:z.nombre,style:{height:70,objectFit:"contain",display:"block",margin:"0 auto"}})}),e.jsx("div",{style:{...We,fontSize:12,fontWeight:600,color:ke.ink},children:z.nombre}),e.jsx("div",{style:{...We,fontSize:10,color:ke.inkLight},children:gs(z.fecha)}),e.jsx("button",{onClick:()=>r(T=>T.filter(L=>L.id!==z.id)),style:{...We,marginTop:8,padding:"4px 12px",fontSize:10,color:ke.danger,background:ke.dangerBg,border:`1px solid ${ke.danger}33`,borderRadius:4,cursor:"pointer"},children:" Eliminar"})]},z.id))}),e.jsxs("div",{style:{maxWidth:520},children:[e.jsx("div",{style:{...We,fontSize:12,fontWeight:600,color:ke.inkMid,marginBottom:8},children:"Crear nueva firma guardada"}),e.jsx(ld,{onSave:z=>{const T=prompt("Nombre para esta firma (ej: 'Mi firma formal'):");T&&r(L=>[...L,{id:Yr(),nombre:T,imagen:z,fecha:new Date().toISOString()}])}})]})]}),w=()=>e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Total",val:x.total,icon:""},{label:"Pendientes",val:x.pendientes,icon:"",warn:x.pendientes>0},{label:"Firmados",val:x.completados,icon:""},{label:"Firmas pendientes",val:x.firmasPendientes,icon:"",warn:x.firmasPendientes>0},{label:"Vencidos",val:x.vencidos,icon:"",danger:x.vencidos>0}].map((z,T)=>e.jsxs("div",{style:{flex:1,minWidth:110,padding:"10px 14px",background:z.danger?ke.dangerBg:z.warn?ke.warningBg:"#fff",border:`1px solid ${z.danger?ke.danger+"33":z.warn?ke.warning+"33":ke.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...We,fontSize:9,color:ke.inkLight},children:[z.icon," ",z.label]}),e.jsx("div",{style:{...We,fontSize:18,fontWeight:700,color:z.danger?ke.danger:z.warn?ke.warning:ke.ink},children:z.val})]},T))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("select",{value:h,onChange:z=>b(z.target.value),style:{...We,padding:"6px 12px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todos los estados"}),us.map(z=>e.jsx("option",{value:z.id,children:z.label},z.id))]}),e.jsxs("select",{value:j,onChange:z=>k(z.target.value),style:{...We,padding:"6px 12px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),Xr.map(z=>e.jsxs("option",{value:z.id,children:[z.icon," ",z.label]},z.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx("input",{value:s,onChange:z=>g(z.target.value),placeholder:"Buscar por ttulo, cliente, proyecto",style:{...We,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>p({id:Yr(),tipo:"contrato",titulo:"",descripcion:"",cliente:"",proyecto:"",valor:"",firmantes:[{id:Yr(),nombre:"",rol:"",email:"",estado:"pendiente",firma:null,fechaFirma:null}],estado:"borrador",fechaCreacion:null,fechaLimite:"",auditoria:[]}),style:{...We,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:ke.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo documento"})]}),l.map(z=>{const T=Xr.find(te=>te.id===z.tipo),L=us.find(te=>te.id===z.estado),Z=z.firmantes.filter(te=>te.estado==="firmado").length,K=z.firmantes.length,P=z.fechaLimite&&new Date(z.fechaLimite)<new Date&&z.estado!=="completado";return e.jsxs("div",{onClick:()=>m(z.id),style:{display:"flex",gap:14,alignItems:"center",padding:"14px 18px",background:"#fff",border:`1px solid ${ke.border}`,borderRadius:10,marginBottom:8,cursor:"pointer",transition:"all .15s",boxShadow:ke.shadow},onMouseEnter:te=>te.currentTarget.style.boxShadow=ke.shadowMd,onMouseLeave:te=>te.currentTarget.style.boxShadow=ke.shadow,children:[e.jsx("div",{style:{width:42,height:42,borderRadius:10,background:(T==null?void 0:T.color)+"15",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0},children:T==null?void 0:T.icon}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{...We,fontSize:13,fontWeight:700,color:ke.ink,marginBottom:2},children:z.titulo}),e.jsxs("div",{style:{...We,fontSize:11,color:ke.inkLight},children:[z.cliente,"  ",z.proyecto," ",z.valor&&` ${z.valor}`]})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexShrink:0},children:[e.jsxs("div",{style:{textAlign:"center",marginRight:8},children:[e.jsxs("div",{style:{...We,fontSize:10,fontWeight:600,color:ke.inkMid},children:[Z,"/",K]}),e.jsx("div",{style:{width:40,height:4,background:ke.bg,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${Z/K*100}%`,borderRadius:2,background:z.estado==="completado"?ke.accent:ke.warning}})})]}),e.jsx(Gn,{color:L==null?void 0:L.color,bg:L==null?void 0:L.bg,children:L==null?void 0:L.label}),P&&e.jsx(Gn,{color:ke.danger,bg:ke.dangerBg,children:""})]})]},z.id)}),l.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:ke.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...We,fontSize:13},children:"No se encontraron documentos"})]})]}),_=[{id:"documentos",icon:"",label:"Documentos",badge:x.pendientes||null},{id:"firmas",icon:"",label:"Mis Firmas"}];return e.jsxs("div",{style:{...We,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...We,fontSize:22,fontWeight:700,color:ke.ink,margin:"0 0 4px"},children:" Firma Digital"}),e.jsx("p",{style:{...We,fontSize:12,color:ke.inkLight,margin:0},children:"Firma y gestin de documentos digitales con trazabilidad completa"})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${ke.border}`,marginBottom:20},children:_.map(z=>e.jsxs("button",{onClick:()=>i(z.id),style:{...We,padding:"10px 18px",fontSize:12,fontWeight:t===z.id?700:500,color:t===z.id?ke.accent:ke.inkLight,background:"none",border:"none",borderBottom:t===z.id?`2px solid ${ke.accent}`:"2px solid transparent",cursor:"pointer"},children:[z.icon," ",z.label,z.badge&&e.jsx("span",{style:{marginLeft:6,background:ke.warning,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:z.badge})]},z.id))}),t==="documentos"&&w(),t==="firmas"&&E(),u(),S(),A()]})}const ze={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},Ue={fontFamily:"'DM Sans',sans-serif"},kc="hab:legal:",Qr=t=>{try{return JSON.parse(Ee.getSync(kc+t))||null}catch{return null}},Zr=(t,i)=>{Ee.set(kc+t,JSON.stringify(i))},hs=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),an=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function Mo({children:t,color:i,bg:o}){return e.jsx("span",{style:{...Ue,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o},children:t})}function dd(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}const ea=[{id:"contratos",label:"Contratos",icon:"",color:"#3B3B3B"},{id:"otrosies",label:"Otroses / Modificaciones",icon:"",color:"#5B3A8C"},{id:"actas",label:"Actas",icon:"",color:"#111111"},{id:"cartas",label:"Cartas / Comunicaciones",icon:"",color:"#8C6A00"},{id:"poderes",label:"Poderes / Autorizaciones",icon:"",color:"#0D5E6E"},{id:"formatos",label:"Formatos Internos",icon:"",color:"#555"}],Dx=[{id:"tpl_contrato_diseno",cat:"contratos",nombre:"Contrato de Diseo Interior",desc:"Contrato de prestacin de servicios de diseo interior. Incluye alcance, fases, entregables, honorarios y forma de pago.",variables:["nombre_cliente","documento_cliente","direccion_inmueble","descripcion_alcance","valor_honorarios","forma_pago","plazo_dias","fecha"],contenido:`CONTRATO DE PRESTACIN DE SERVICIOS DE DISEO INTERIOR

Entre {{empresa_nombre}}, con NIT {{empresa_nit}}, representada por {{rep_legal}}, en adelante EL CONTRATISTA, y {{nombre_cliente}}, identificado con {{documento_cliente}}, en adelante EL CLIENTE.

OBJETO: El CONTRATISTA se compromete a prestar servicios profesionales de diseo interior para el inmueble ubicado en {{direccion_inmueble}}.

ALCANCE: {{descripcion_alcance}}

VALOR Y FORMA DE PAGO: El valor total de los honorarios es de {{valor_honorarios}}, pagaderos as: {{forma_pago}}.

PLAZO: {{plazo_dias}} das calendario a partir de la firma del presente contrato.

OBLIGACIONES DEL CONTRATISTA:
1. Elaborar propuesta de diseo segn briefing aprobado
2. Presentar renders y planos tcnicos
3. Entregar memoria descriptiva y presupuesto de obra
4. Realizar seguimiento durante la ejecucin (si aplica)

OBLIGACIONES DEL CLIENTE:
1. Suministrar informacin veraz del inmueble
2. Realizar los pagos en los plazos acordados
3. Aprobar o solicitar ajustes en los plazos establecidos

Se firma en {{ciudad}} a los {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_obra",cat:"contratos",nombre:"Contrato de Obra / Remodelacin",desc:"Contrato de ejecucin de obra de remodelacin. Incluye presupuesto, cronograma, garantas y penalizaciones.",variables:["nombre_cliente","documento_cliente","direccion_inmueble","descripcion_obra","valor_obra","anticipo_pct","plazo_dias","fecha"],contenido:`CONTRATO DE OBRA PARA REMODELACIN

Entre {{empresa_nombre}}, NIT {{empresa_nit}}, en adelante EL CONTRATISTA, y {{nombre_cliente}}, identificado con {{documento_cliente}}, en adelante EL PROPIETARIO.

OBJETO: Ejecucin de obras de remodelacin en {{direccion_inmueble}} segn diseo aprobado.

DESCRIPCIN: {{descripcion_obra}}

VALOR: {{valor_obra}} (IVA incluido). ANTICIPO: {{anticipo_pct}}% contra firma. El saldo se pagar segn avance de obra certificado.

PLAZO: {{plazo_dias}} das calendario.

GARANTAS:
- Estabilidad de obra: 5 aos
- Acabados: 1 ao
- Instalaciones: 2 aos

Se firma en {{ciudad}} a los {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_laboral",cat:"contratos",nombre:"Contrato Laboral a Trmino Fijo",desc:"Contrato laboral para personal vinculado a proyectos con trmino definido.",variables:["nombre_empleado","documento_empleado","cargo","salario","fecha_inicio","fecha_fin","funciones"],contenido:`CONTRATO INDIVIDUAL DE TRABAJO A TRMINO FIJO

EMPLEADOR: {{empresa_nombre}}, NIT {{empresa_nit}}
TRABAJADOR: {{nombre_empleado}}, C.C. {{documento_empleado}}
CARGO: {{cargo}}

El EMPLEADOR contrata los servicios del TRABAJADOR para desempear el cargo de {{cargo}} con las siguientes funciones: {{funciones}}

REMUNERACIN: {{salario}} mensuales, pagaderos quincenalmente.
VIGENCIA: Del {{fecha_inicio}} al {{fecha_fin}}.

JORNADA: 48 horas semanales.

El presente contrato se rige por el Cdigo Sustantivo del Trabajo.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_prest_serv",cat:"contratos",nombre:"Contrato de Prestacin de Servicios",desc:"Para contratistas independientes, proveedores y consultores.",variables:["nombre_contratista","documento_contratista","objeto","valor","plazo","entregables"],contenido:`CONTRATO DE PRESTACIN DE SERVICIOS PROFESIONALES

CONTRATANTE: {{empresa_nombre}}
CONTRATISTA: {{nombre_contratista}}, {{documento_contratista}}

OBJETO: {{objeto}}
VALOR: {{valor}}
PLAZO: {{plazo}}
ENTREGABLES: {{entregables}}

El CONTRATISTA acta como independiente, sin subordinacin laboral. Es responsable de sus propias obligaciones tributarias y de seguridad social.`,pais:"CO",obligatorio:!1},{id:"tpl_otrosi",cat:"otrosies",nombre:"Otros Modificatorio",desc:"Modificacin de clusulas de un contrato vigente.",variables:["numero_contrato","fecha_contrato","clausulas_modificadas","nuevo_texto"],contenido:`OTROS MODIFICATORIO AL CONTRATO {{numero_contrato}}

Las partes acuerdan modificar las siguientes clusulas del contrato de fecha {{fecha_contrato}}:

CLUSULAS MODIFICADAS: {{clausulas_modificadas}}

NUEVO TEXTO: {{nuevo_texto}}

Las dems clusulas permanecen vigentes e inalteradas.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_inicio",cat:"actas",nombre:"Acta de Inicio de Obra",desc:"Acta de inicio de ejecucin de obra con datos del proyecto, participantes y compromisos.",variables:["proyecto","direccion","contrato_ref","participantes","observaciones","fecha"],contenido:`ACTA DE INICIO DE OBRA

PROYECTO: {{proyecto}}
DIRECCIN: {{direccion}}
CONTRATO REF: {{contrato_ref}}
FECHA: {{fecha}}

PARTICIPANTES:
{{participantes}}

Se da inicio formal a las obras de acuerdo con el contrato referenciado, el diseo aprobado y el cronograma pactado.

OBSERVACIONES: {{observaciones}}

Se firma por las partes como constancia.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_vecindad",cat:"actas",nombre:"Acta de Vecindad",desc:"Registro del estado de inmuebles vecinos antes de iniciar obra.",variables:["proyecto","direccion_obra","inmuebles_vecinos","estado_actual","registro_fotografico","fecha"],contenido:`ACTA DE VECINDAD

PROYECTO: {{proyecto}}
DIRECCIN OBRA: {{direccion_obra}}
FECHA: {{fecha}}

INMUEBLES INSPECCIONADOS:
{{inmuebles_vecinos}}

ESTADO ACTUAL REGISTRADO:
{{estado_actual}}

Se adjunta registro fotogrfico de {{registro_fotografico}} fotografas como soporte.

Esta acta tiene carcter probatorio del estado previo de los inmuebles vecinos.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_entrega",cat:"actas",nombre:"Acta de Entrega / Recepcin Final",desc:"Acta de recepcin final de obra con checklist de verificacin.",variables:["proyecto","cliente","items_verificados","observaciones","pendientes","garantias","fecha"],contenido:`ACTA DE ENTREGA Y RECEPCIN FINAL

PROYECTO: {{proyecto}}
CLIENTE: {{cliente}}
FECHA: {{fecha}}

Se procede a la entrega formal del proyecto con los siguientes tems verificados:
{{items_verificados}}

OBSERVACIONES: {{observaciones}}
PENDIENTES (si aplica): {{pendientes}}

GARANTAS:
{{garantias}}

El CLIENTE declara recibir a satisfaccin.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_comite",cat:"actas",nombre:"Acta de Comit de Obra",desc:"Registro de reuniones de seguimiento de obra.",variables:["numero","proyecto","asistentes","temas","compromisos","proxima_reunion","fecha"],contenido:`ACTA DE COMIT DE OBRA N {{numero}}

PROYECTO: {{proyecto}}
FECHA: {{fecha}}
ASISTENTES: {{asistentes}}

TEMAS TRATADOS:
{{temas}}

COMPROMISOS:
{{compromisos}}

PRXIMA REUNIN: {{proxima_reunion}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_cobro",cat:"cartas",nombre:"Carta de Cobro / Recordatorio de Pago",desc:"Comunicacin formal recordando saldos pendientes.",variables:["destinatario","concepto","valor_adeudado","fecha_vencimiento","plazo_respuesta","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Recordatorio de pago  {{concepto}}

Cordial saludo.

Permtanos recordarle que a la fecha se encuentra pendiente el pago de {{valor_adeudado}} correspondiente a {{concepto}}, con fecha de vencimiento {{fecha_vencimiento}}.

Agradecemos realizar el pago en un plazo de {{plazo_respuesta}} das.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_terminacion",cat:"cartas",nombre:"Carta de Terminacin de Contrato",desc:"Comunicacin formal de terminacin de relacin contractual.",variables:["destinatario","contrato_ref","motivo","fecha_efectiva","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Terminacin contrato {{contrato_ref}}

Por medio de la presente le comunicamos la terminacin del contrato referenciado por el siguiente motivo: {{motivo}}

La terminacin ser efectiva a partir del {{fecha_efectiva}}.

Quedan vigentes las obligaciones pendientes y las garantas pactadas.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_garantia",cat:"cartas",nombre:"Carta de Reclamacin de Garanta",desc:"Comunicacin de activacin de garanta por defectos post-entrega.",variables:["destinatario","proyecto","items_garantia","plazo_respuesta","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Reclamacin de garanta  {{proyecto}}

Nos permitimos reportar los siguientes tems que requieren atencin bajo la garanta del proyecto:

{{items_garantia}}

Solicitamos atencin en un plazo de {{plazo_respuesta}} das hbiles.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_poder",cat:"poderes",nombre:"Poder Especial",desc:"Autorizacin para actuar en nombre de la empresa ante trmites especficos.",variables:["apoderado","documento_apoderado","facultades","vigencia","fecha"],contenido:`PODER ESPECIAL

{{rep_legal}}, en calidad de representante legal de {{empresa_nombre}}, NIT {{empresa_nit}}, confiere poder especial a {{apoderado}}, identificado con {{documento_apoderado}}, para:

{{facultades}}

VIGENCIA: {{vigencia}}

Otorgado en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_paz_salvo",cat:"formatos",nombre:"Paz y Salvo",desc:"Certificacin de cumplimiento de obligaciones contractuales.",variables:["beneficiario","contrato_ref","concepto","fecha"],contenido:`PAZ Y SALVO

{{empresa_nombre}} certifica que {{beneficiario}} se encuentra a paz y salvo por concepto de {{concepto}} del contrato {{contrato_ref}}.

Se expide en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_cert_laboral",cat:"formatos",nombre:"Certificacin Laboral",desc:"Certificado de vinculacin laboral con cargo y salario.",variables:["nombre_empleado","documento_empleado","cargo","fecha_ingreso","salario","fecha"],contenido:`CERTIFICACIN LABORAL

{{empresa_nombre}}, NIT {{empresa_nit}}, certifica que {{nombre_empleado}}, identificado con C.C. {{documento_empleado}}, labora en esta empresa desde el {{fecha_ingreso}} desempeando el cargo de {{cargo}}, con un salario mensual de {{salario}}.

Se expide a solicitud del interesado en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1}],cd=[{id:"rcextra",label:"RC Extracontractual",icon:"",color:"#B91C1C"},{id:"todo_riesgo",label:"Todo Riesgo Construccin",icon:"",color:"#3B3B3B"},{id:"cumplimiento",label:"Cumplimiento",icon:"",color:"#111111"},{id:"calidad",label:"Calidad / Estabilidad",icon:"",color:"#5B3A8C"},{id:"prestaciones",label:"Prestaciones Sociales",icon:"",color:"#8C6A00"},{id:"vehicular",label:"Vehicular / SOAT",icon:"",color:"#0D5E6E"},{id:"otro",label:"Otro seguro",icon:"",color:"#555"}],$x=[{id:"s1",tipo:"todo_riesgo",aseguradora:"Seguros Bolvar",poliza:"POL-2026-001245",proyecto:"Casa Chic Norte",valor_asegurado:"$120.000.000",prima:"$3.600.000",vigencia_inicio:"2026-01-15",vigencia_fin:"2026-07-15",beneficiario:"Andrs Meja Ruiz",estado:"vigente",notas:"Cubre daos durante ejecucin de obra"},{id:"s2",tipo:"rcextra",aseguradora:"Sura",poliza:"RC-2026-778899",proyecto:"General empresa",valor_asegurado:"$500.000.000",prima:"$8.500.000",vigencia_inicio:"2026-01-01",vigencia_fin:"2026-12-31",beneficiario:"Habitaris S.A.S",estado:"vigente",notas:"Responsabilidad civil por daos a terceros"},{id:"s3",tipo:"cumplimiento",aseguradora:"Liberty Seguros",poliza:"CUM-2025-556677",proyecto:"Oficina 301 WTC",valor_asegurado:"$85.000.000",prima:"$2.125.000",vigencia_inicio:"2025-06-01",vigencia_fin:"2026-06-01",beneficiario:"TechStar S.A.S",estado:"por_vencer",notas:"Garanta de cumplimiento del contrato"},{id:"s4",tipo:"calidad",aseguradora:"Seguros Bolvar",poliza:"CAL-2025-112233",proyecto:"Apto 502 Rosales",valor_asegurado:"$45.000.000",prima:"$675.000",vigencia_inicio:"2025-03-01",vigencia_fin:"2030-03-01",beneficiario:"Mara Fernanda Gmez",estado:"vigente",notas:"Garanta de estabilidad de obra  5 aos"}],fs=[{id:"abierto",label:"Abierto",color:"#3B3B3B",bg:"#F0F0F0"},{id:"en_curso",label:"En curso",color:"#8C6A00",bg:"#FFF8EE"},{id:"favorable",label:"Favorable",color:"#111111",bg:"#EBEBEB"},{id:"cerrado",label:"Cerrado",color:"#555",bg:"#F5F5F5"},{id:"perdido",label:"Desfavorable",color:"#B91C1C",bg:"#FDF0F0"}],Px=[{id:"p1",tipo:"Reclamacin de garanta",contraparte:"Proveedor XYZ Pisos",proyecto:"Oficina 301 WTC",descripcion:"Reclamacin por defectos en piso laminado instalado. Present levantamiento a los 3 meses.",estado:"en_curso",fecha_inicio:"2026-01-20",abogado:"Dr. Martn Velsquez",valor_pretension:"$8.500.000",seguimiento:[{fecha:"2026-01-20",nota:"Se enva carta de reclamacin al proveedor"},{fecha:"2026-01-30",nota:"Proveedor responde negando responsabilidad"},{fecha:"2026-02-10",nota:"Se enva informe pericial con registro fotogrfico"},{fecha:"2026-02-20",nota:"Reunin de conciliacin programada para marzo 5"}]},{id:"p2",tipo:"Incumplimiento contractual",contraparte:"Cliente: Roberto Pineda",proyecto:"Remodelacin Apto 801 Virrey",descripcion:"Cliente se rehsa a pagar saldo final ($18M) alegando inconformidad no sustentada.",estado:"abierto",fecha_inicio:"2026-02-01",abogado:"Dra. Carolina Mendoza",valor_pretension:"$18.000.000",seguimiento:[{fecha:"2026-02-01",nota:"Se enva carta de cobro prejudicial"},{fecha:"2026-02-15",nota:"Sin respuesta del cliente. Se prepara demanda ejecutiva."}]}];function Ox(){const[t,i]=F.useState("plantillas"),[o,n]=F.useState(()=>Qr("plantillas")||Dx),[a,r]=F.useState(()=>Qr("documentos_gen")||[]),[s,g]=F.useState(()=>Qr("seguros")||$x),[h,b]=F.useState(()=>Qr("procesos")||Px),[j,k]=F.useState(""),[v,m]=F.useState("all"),[f,p]=F.useState(null),[d,c]=F.useState(null),[l,x]=F.useState(null),[y,u]=F.useState(null),[S,A]=F.useState(null),[E,w]=F.useState(null);F.useEffect(()=>Zr("plantillas",o),[o]),F.useEffect(()=>Zr("documentos_gen",a),[a]),F.useEffect(()=>Zr("seguros",s),[s]),F.useEffect(()=>Zr("procesos",h),[h]);const _=F.useMemo(()=>{const ae=s.filter(B=>new Date(B.vigencia_fin)>=new Date),U=s.filter(B=>{const H=dd(B.vigencia_fin);return H>=0&&H<=60}),M=s.filter(B=>new Date(B.vigencia_fin)<new Date);return{total:s.length,vigentes:ae.length,porVencer:U.length,vencidos:M.length}},[s]),z=()=>{const ae=o.filter(U=>v!=="all"&&U.cat!==v?!1:j?U.nombre.toLowerCase().includes(j.toLowerCase())||U.desc.toLowerCase().includes(j.toLowerCase()):!0);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16,alignItems:"center"},children:[e.jsxs("select",{value:v,onChange:U=>m(U.target.value),style:{...Ue,padding:"6px 12px",fontSize:11,border:`1px solid ${ze.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todas las categoras"}),ea.map(U=>e.jsxs("option",{value:U.id,children:[U.icon," ",U.label]},U.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx("input",{value:j,onChange:U=>k(U.target.value),placeholder:"Buscar plantilla",style:{...Ue,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${ze.border}`,borderRadius:6,boxSizing:"border-box"}})})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px,1fr))",gap:12},children:ae.map(U=>{const M=ea.find(B=>B.id===U.cat);return e.jsxs("div",{onClick:()=>p(U.id),style:{background:"#fff",border:`1px solid ${ze.border}`,borderLeft:`3px solid ${M==null?void 0:M.color}`,borderRadius:10,padding:18,cursor:"pointer",boxShadow:ze.shadow,transition:"all .15s"},onMouseEnter:B=>B.currentTarget.style.boxShadow=ze.shadowMd,onMouseLeave:B=>B.currentTarget.style.boxShadow=ze.shadow,children:[e.jsx("div",{style:{display:"flex",gap:6,marginBottom:8},children:e.jsxs(Mo,{color:M==null?void 0:M.color,bg:(M==null?void 0:M.color)+"18",children:[M==null?void 0:M.icon," ",M==null?void 0:M.label]})}),e.jsx("div",{style:{...Ue,fontSize:14,fontWeight:700,color:ze.ink,marginBottom:4},children:U.nombre}),e.jsx("div",{style:{...Ue,fontSize:11,color:ze.inkLight,lineHeight:1.5,marginBottom:8,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:U.desc}),e.jsxs("div",{style:{...Ue,fontSize:10,color:ze.inkLight},children:[" ",U.variables.length," campos  ",U.pais==="CO"?"":""]})]},U.id)})})]})},T=()=>{const ae=f?o.find(M=>M.id===f):null;if(!ae)return null;const U=ea.find(M=>M.id===ae.cat);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>p(null),children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:720,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[e.jsxs("div",{children:[e.jsxs(Mo,{color:U==null?void 0:U.color,bg:(U==null?void 0:U.color)+"18",children:[U==null?void 0:U.icon," ",U==null?void 0:U.label]}),e.jsx("h2",{style:{...Ue,fontSize:18,fontWeight:700,color:ze.ink,margin:"8px 0 4px"},children:ae.nombre}),e.jsx("p",{style:{...Ue,fontSize:12,color:ze.inkLight,margin:0},children:ae.desc})]}),e.jsx("button",{onClick:()=>p(null),style:{...Ue,fontSize:18,color:ze.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...Ue,fontSize:11,fontWeight:600,color:ze.inkMid,marginBottom:6},children:"Campos variables:"}),e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:ae.variables.map(M=>e.jsx(Mo,{color:ze.info,bg:ze.infoBg,children:`{{${M}}}`},M))})]}),e.jsx("div",{style:{background:ze.surface,border:`1px solid ${ze.border}`,borderRadius:8,padding:20,marginBottom:16,maxHeight:300,overflow:"auto"},children:e.jsx("pre",{style:{...Ue,fontSize:11,color:ze.inkMid,lineHeight:1.7,whiteSpace:"pre-wrap",margin:0},children:ae.contenido})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>{w({plantilla:ae,variables:{}}),p(null)},style:{...Ue,padding:"8px 20px",fontSize:12,fontWeight:700,color:"#fff",background:ze.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Generar documento"}),e.jsx("button",{style:{...Ue,padding:"8px 18px",fontSize:12,color:ze.inkMid,background:ze.bg,border:`1px solid ${ze.border}`,borderRadius:6,cursor:"pointer"},children:" Editar plantilla"})]})]})})},L=()=>{if(!E)return null;const{plantilla:ae,variables:U}=E,M=(D,O)=>w(le=>({...le,variables:{...le.variables,[D]:O}})),B={empresa_nombre:"Habitaris S.A.S",empresa_nit:"901.922.136-8",rep_legal:"Laura Snchez Daz",ciudad:"Bogot D.C.",fecha:new Date().toLocaleDateString("es-CO",{day:"numeric",month:"long",year:"numeric"})},H=ae.contenido.replace(/\{\{(\w+)\}\}/g,(D,O)=>U[O]||B[O]||`[${O}]`),ee=()=>{const D={id:hs(),plantillaId:ae.id,titulo:`${ae.nombre}  ${U[ae.variables[0]]||"Sin datos"}`,contenido:H,variables:{...B,...U},fecha:new Date().toISOString()};r(O=>[...O,D]),w(null),alert(" Documento generado y guardado")};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>w(null),children:e.jsxs("div",{onClick:D=>D.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:800,width:"100%",maxHeight:"90vh",overflow:"auto",padding:28},children:[e.jsxs("h2",{style:{...Ue,fontSize:16,fontWeight:700,color:ze.ink,marginBottom:4},children:[" Generar: ",ae.nombre]}),e.jsx("p",{style:{...Ue,fontSize:11,color:ze.inkLight,marginBottom:16},children:"Completa los campos y genera el documento."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:16},children:ae.variables.map(D=>e.jsxs("div",{children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ze.inkLight},children:D.replace(/_/g," ")}),e.jsx("input",{value:U[D]||"",onChange:O=>M(D,O.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ze.border}`,borderRadius:5,boxSizing:"border-box"}})]},D))}),e.jsx("div",{style:{...Ue,fontSize:11,fontWeight:600,color:ze.inkMid,marginBottom:6},children:"Vista previa:"}),e.jsx("div",{style:{background:ze.surface,border:`1px solid ${ze.border}`,borderRadius:8,padding:20,marginBottom:16,maxHeight:300,overflow:"auto"},children:e.jsx("pre",{style:{...Ue,fontSize:11,color:ze.ink,lineHeight:1.7,whiteSpace:"pre-wrap",margin:0},children:H})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>w(null),style:{...Ue,padding:"8px 20px",fontSize:12,color:ze.inkMid,background:ze.bg,border:`1px solid ${ze.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{style:{...Ue,padding:"8px 18px",fontSize:12,color:ze.info,background:ze.infoBg,border:`1px solid ${ze.info}33`,borderRadius:6,cursor:"pointer"},children:" Enviar a Firma Digital"}),e.jsx("button",{onClick:ee,style:{...Ue,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ze.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar documento"})]})]})})},Z=()=>e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Total plizas",val:_.total,icon:""},{label:"Vigentes",val:_.vigentes,icon:""},{label:"Por vencer (60d)",val:_.porVencer,icon:"",warn:_.porVencer>0},{label:"Vencidas",val:_.vencidos,icon:"",danger:_.vencidos>0}].map((ae,U)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"10px 14px",background:ae.danger?ze.dangerBg:ae.warn?ze.warningBg:"#fff",border:`1px solid ${ae.danger?ze.danger+"33":ae.warn?ze.warning+"33":ze.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...Ue,fontSize:9,color:ze.inkLight},children:[ae.icon," ",ae.label]}),e.jsx("div",{style:{...Ue,fontSize:18,fontWeight:700,color:ae.danger?ze.danger:ae.warn?ze.warning:ze.ink},children:ae.val})]},U))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:j,onChange:ae=>k(ae.target.value),placeholder:"Buscar pliza, proyecto, aseguradora",style:{...Ue,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${ze.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>u({id:hs(),tipo:"todo_riesgo",aseguradora:"",poliza:"",proyecto:"",valor_asegurado:"",prima:"",vigencia_inicio:"",vigencia_fin:"",beneficiario:"",estado:"vigente",notas:""}),style:{...Ue,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:ze.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nueva pliza"})]}),s.map(ae=>{const U=cd.find(ee=>ee.id===ae.tipo),M=dd(ae.vigencia_fin),B=M<0,H=M>=0&&M<=60;return e.jsxs("div",{onClick:()=>c(ae.id),style:{display:"flex",gap:14,alignItems:"center",padding:"14px 18px",background:"#fff",border:`1px solid ${B?ze.danger+"44":H?ze.warning+"44":ze.border}`,borderRadius:10,marginBottom:8,cursor:"pointer",boxShadow:ze.shadow,transition:"all .15s"},onMouseEnter:ee=>ee.currentTarget.style.boxShadow=ze.shadowMd,onMouseLeave:ee=>ee.currentTarget.style.boxShadow=ze.shadow,children:[e.jsx("div",{style:{width:42,height:42,borderRadius:10,background:(U==null?void 0:U.color)+"15",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0},children:U==null?void 0:U.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ue,fontSize:13,fontWeight:700,color:ze.ink},children:U==null?void 0:U.label}),e.jsxs("div",{style:{...Ue,fontSize:11,color:ze.inkLight},children:[ae.aseguradora,"  Pliza: ",ae.poliza]}),e.jsxs("div",{style:{...Ue,fontSize:10,color:ze.inkLight},children:[ae.proyecto,"  Beneficiario: ",ae.beneficiario]})]}),e.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[e.jsx("div",{style:{...Ue,fontSize:12,fontWeight:600,color:ze.ink},children:ae.valor_asegurado}),e.jsxs("div",{style:{...Ue,fontSize:10,color:ze.inkLight},children:[an(ae.vigencia_inicio),"  ",an(ae.vigencia_fin)]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(Mo,{color:B?ze.danger:H?ze.warning:ze.accent,bg:B?ze.dangerBg:H?ze.warningBg:ze.accentBg,children:B?`Vencida hace ${Math.abs(M)}d`:H?`Vence en ${M}d`:"Vigente"})})]})]},ae.id)})]}),K=()=>{if(!y)return null;const ae=!s.find(B=>B.id===y.id),U=(B,H)=>u(ee=>({...ee,[B]:H})),M=()=>{g(ae?B=>[...B,y]:B=>B.map(H=>H.id===y.id?y:H)),u(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>u(null),children:e.jsxs("div",{onClick:B=>B.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:580,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Ue,fontSize:16,fontWeight:700,color:ze.ink,marginBottom:16},children:ae?" Nueva pliza":" Editar pliza"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[["tipo","Tipo",!0],["aseguradora","Aseguradora"],["poliza","N Pliza"],["proyecto","Proyecto"],["valor_asegurado","Valor asegurado"],["prima","Prima"],["vigencia_inicio","Inicio vigencia","date"],["vigencia_fin","Fin vigencia","date"],["beneficiario","Beneficiario"],["notas","Notas"]].map(([B,H,ee])=>e.jsxs("div",{style:{gridColumn:B==="notas"?"1/-1":void 0},children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ze.inkLight},children:H}),ee===!0?e.jsx("select",{value:y[B],onChange:D=>U(B,D.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ze.border}`,borderRadius:5},children:cd.map(D=>e.jsxs("option",{value:D.id,children:[D.icon," ",D.label]},D.id))}):e.jsx("input",{type:ee||"text",value:y[B]||"",onChange:D=>U(B,D.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ze.border}`,borderRadius:5,boxSizing:"border-box"}})]},B))}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>u(null),style:{...Ue,padding:"8px 20px",fontSize:12,color:ze.inkMid,background:ze.bg,border:`1px solid ${ze.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:M,style:{...Ue,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ze.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},P=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:j,onChange:ae=>k(ae.target.value),placeholder:"Buscar proceso",style:{...Ue,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${ze.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>A({id:hs(),tipo:"",contraparte:"",proyecto:"",descripcion:"",estado:"abierto",fecha_inicio:new Date().toISOString().slice(0,10),abogado:"",valor_pretension:"",seguimiento:[]}),style:{...Ue,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:ze.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo proceso"})]}),h.map(ae=>{const U=fs.find(M=>M.id===ae.estado);return e.jsxs("div",{onClick:()=>x(ae.id),style:{background:"#fff",border:`1px solid ${ze.border}`,borderRadius:10,padding:18,marginBottom:10,cursor:"pointer",boxShadow:ze.shadow,transition:"all .15s"},onMouseEnter:M=>M.currentTarget.style.boxShadow=ze.shadowMd,onMouseLeave:M=>M.currentTarget.style.boxShadow=ze.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:6},children:[e.jsxs("div",{children:[e.jsx("div",{style:{...Ue,fontSize:14,fontWeight:700,color:ze.ink},children:ae.tipo}),e.jsxs("div",{style:{...Ue,fontSize:11,color:ze.inkLight},children:["vs. ",ae.contraparte,"  ",ae.proyecto]})]}),e.jsx(Mo,{color:U==null?void 0:U.color,bg:U==null?void 0:U.bg,children:U==null?void 0:U.label})]}),e.jsx("div",{style:{...Ue,fontSize:11,color:ze.inkMid,marginBottom:6,lineHeight:1.5},children:ae.descripcion}),e.jsxs("div",{style:{display:"flex",gap:16,...Ue,fontSize:10,color:ze.inkLight},children:[e.jsxs("span",{children:[" ",ae.abogado]}),e.jsxs("span",{children:[" ",ae.valor_pretension]}),e.jsxs("span",{children:[" ",an(ae.fecha_inicio)]}),e.jsxs("span",{children:[" ",ae.seguimiento.length," notas"]})]})]},ae.id)}),h.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:ze.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Ue,fontSize:13},children:"No hay procesos legales registrados"})]})]}),te=()=>{const ae=l?h.find(ee=>ee.id===l):null;if(!ae)return null;const U=fs.find(ee=>ee.id===ae.estado),[M,B]=F.useState(""),H=()=>{M.trim()&&(b(ee=>ee.map(D=>D.id===ae.id?{...D,seguimiento:[...D.seguimiento,{fecha:new Date().toISOString().slice(0,10),nota:M}]}:D)),B(""))};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>x(null),children:e.jsxs("div",{onClick:ee=>ee.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx(Mo,{color:U==null?void 0:U.color,bg:U==null?void 0:U.bg,children:U==null?void 0:U.label}),e.jsx("h2",{style:{...Ue,fontSize:18,fontWeight:700,color:ze.ink,margin:"8px 0 2px"},children:ae.tipo}),e.jsxs("div",{style:{...Ue,fontSize:12,color:ze.inkLight},children:["vs. ",ae.contraparte,"  ",ae.proyecto]})]}),e.jsx("button",{onClick:()=>x(null),style:{...Ue,fontSize:18,color:ze.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...Ue,fontSize:12,color:ze.inkMid,lineHeight:1.6,marginBottom:16},children:ae.descripcion}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:20},children:[{label:"Abogado",val:ae.abogado},{label:"Valor pretensin",val:ae.valor_pretension},{label:"Fecha inicio",val:an(ae.fecha_inicio)}].map((ee,D)=>e.jsxs("div",{style:{padding:10,background:ze.surface,borderRadius:6},children:[e.jsx("div",{style:{...Ue,fontSize:9,color:ze.inkLight},children:ee.label}),e.jsx("div",{style:{...Ue,fontSize:12,fontWeight:600,color:ze.ink},children:ee.val})]},D))}),e.jsx("div",{style:{...Ue,fontSize:13,fontWeight:700,color:ze.ink,marginBottom:10},children:" Seguimiento"}),e.jsx("div",{style:{borderLeft:`2px solid ${ze.border}`,paddingLeft:16,marginLeft:8,marginBottom:16},children:ae.seguimiento.map((ee,D)=>e.jsxs("div",{style:{marginBottom:12,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-22,top:2,width:10,height:10,borderRadius:"50%",background:D===ae.seguimiento.length-1?ze.accent:ze.bg,border:`2px solid ${D===ae.seguimiento.length-1?ze.accent:ze.border}`}}),e.jsx("div",{style:{...Ue,fontSize:10,color:ze.inkLight},children:an(ee.fecha)}),e.jsx("div",{style:{...Ue,fontSize:12,color:ze.ink},children:ee.nota})]},D))}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("input",{value:M,onChange:ee=>B(ee.target.value),placeholder:"Aadir nota de seguimiento",onKeyDown:ee=>ee.key==="Enter"&&H(),style:{...Ue,flex:1,padding:"7px 12px",fontSize:12,border:`1px solid ${ze.border}`,borderRadius:6}}),e.jsx("button",{onClick:H,style:{...Ue,padding:"7px 16px",fontSize:11,fontWeight:600,color:"#fff",background:ze.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nota"})]})]})})},he=()=>{if(!S)return null;const ae=!h.find(B=>B.id===S.id),U=(B,H)=>A(ee=>({...ee,[B]:H})),M=()=>{b(ae?B=>[...B,S]:B=>B.map(H=>H.id===S.id?S:H)),A(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>A(null),children:e.jsxs("div",{onClick:B=>B.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:540,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Ue,fontSize:16,fontWeight:700,color:ze.ink,marginBottom:16},children:ae?" Nuevo proceso":" Editar"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[[["tipo","Tipo de proceso"],["contraparte","Contraparte"],["proyecto","Proyecto vinculado"],["abogado","Abogado responsable"],["valor_pretension","Valor pretensin"],["fecha_inicio","Fecha inicio","date"]].map(([B,H,ee])=>e.jsxs("div",{children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ze.inkLight},children:H}),e.jsx("input",{type:ee||"text",value:S[B]||"",onChange:D=>U(B,D.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ze.border}`,borderRadius:5,boxSizing:"border-box"}})]},B)),e.jsxs("div",{style:{gridColumn:"1/-1"},children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ze.inkLight},children:"Estado"}),e.jsx("select",{value:S.estado,onChange:B=>U("estado",B.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ze.border}`,borderRadius:5},children:fs.map(B=>e.jsx("option",{value:B.id,children:B.label},B.id))})]}),e.jsxs("div",{style:{gridColumn:"1/-1"},children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ze.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:S.descripcion||"",onChange:B=>U("descripcion",B.target.value),rows:3,style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ze.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>A(null),style:{...Ue,padding:"8px 20px",fontSize:12,color:ze.inkMid,background:ze.bg,border:`1px solid ${ze.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:M,style:{...Ue,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ze.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},Q=()=>e.jsx("div",{children:a.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40,color:ze.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Ue,fontSize:13},children:"No hay documentos generados an. Ve a Plantillas y genera uno."})]}):a.map(ae=>{const U=o.find(B=>B.id===ae.plantillaId),M=ea.find(B=>B.id===(U==null?void 0:U.cat));return e.jsxs("div",{style:{background:"#fff",border:`1px solid ${ze.border}`,borderRadius:10,padding:16,marginBottom:8,boxShadow:ze.shadow},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsxs("div",{children:[e.jsxs(Mo,{color:M==null?void 0:M.color,bg:(M==null?void 0:M.color)+"18",children:[M==null?void 0:M.icon," ",M==null?void 0:M.label]}),e.jsx("div",{style:{...Ue,fontSize:13,fontWeight:700,color:ze.ink,marginTop:4},children:ae.titulo})]}),e.jsx("div",{style:{...Ue,fontSize:10,color:ze.inkLight},children:an(ae.fecha)})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{style:{...Ue,padding:"5px 12px",fontSize:10,color:ze.info,background:ze.infoBg,border:`1px solid ${ze.info}33`,borderRadius:4,cursor:"pointer"},children:" Ver"}),e.jsx("button",{style:{...Ue,padding:"5px 12px",fontSize:10,color:ze.accent,background:ze.accentBg,border:`1px solid ${ze.accent}33`,borderRadius:4,cursor:"pointer"},children:" Enviar a firma"}),e.jsx("button",{style:{...Ue,padding:"5px 12px",fontSize:10,color:ze.inkMid,background:ze.surface,border:`1px solid ${ze.border}`,borderRadius:4,cursor:"pointer"},children:" PDF"})]})]},ae.id)})}),Se=[{id:"plantillas",icon:"",label:"Plantillas",badge:o.length},{id:"generados",icon:"",label:"Docs Generados",badge:a.length||null},{id:"seguros",icon:"",label:"Seguros / Plizas",badge:_.porVencer+_.vencidos||null},{id:"procesos",icon:"",label:"Procesos Legales",badge:h.filter(ae=>ae.estado==="abierto"||ae.estado==="en_curso").length||null}];return e.jsxs("div",{style:{...Ue,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...Ue,fontSize:22,fontWeight:700,color:ze.ink,margin:"0 0 4px"},children:" Legal"}),e.jsx("p",{style:{...Ue,fontSize:12,color:ze.inkLight,margin:0},children:"Plantillas contractuales, gestin de plizas, seguimiento de procesos legales"})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${ze.border}`,marginBottom:20},children:Se.map(ae=>e.jsxs("button",{onClick:()=>i(ae.id),style:{...Ue,padding:"10px 16px",fontSize:12,fontWeight:t===ae.id?700:500,color:t===ae.id?ze.accent:ze.inkLight,background:"none",border:"none",borderBottom:t===ae.id?`2px solid ${ze.accent}`:"2px solid transparent",cursor:"pointer"},children:[ae.icon," ",ae.label,ae.badge&&e.jsx("span",{style:{marginLeft:6,background:t===ae.id?ze.accent:ze.border,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:ae.badge})]},ae.id))}),t==="plantillas"&&z(),t==="generados"&&Q(),t==="seguros"&&Z(),t==="procesos"&&P(),T(),L(),K(),te(),he()]})}const Lx=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'DM Sans',sans-serif;background:#F5F4F1;-webkit-font-smoothing:antialiased}
    ::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}
    input,select,textarea{font-family:'DM Sans',sans-serif;outline:none}
    button{font-family:'DM Sans',sans-serif;cursor:pointer}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .22s ease both}
  `}),pe={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",purpleBg:"#F0ECF6",teal:"#0D5E6E",tealBg:"#E0F4F4",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},It=()=>Math.random().toString(36).slice(2,9),Uo=()=>new Date().toISOString().split("T")[0],to=()=>new Date().toISOString(),wc=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",Wx=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/36e5);return o<1?"hace momentos":o<24?`hace ${o}h`:`hace ${Math.floor(o/24)}d`};function sn(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Ee.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const a=F.useCallback(async r=>{const s=typeof r=="function"?r(o):r;n(s);try{Ee.set(t,JSON.stringify(s))}catch{}},[t,o]);return[o,a]}const si=({children:t,style:i})=>e.jsx("div",{style:{background:pe.surface,border:`1px solid ${pe.border}`,borderRadius:8,boxShadow:pe.shadow,...i},children:t}),co=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${pe.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?pe.redBg:pe.ink,color:i==="sec"?pe.inkMid:i==="danger"?pe.red:"#fff",...a},...r,children:t}),tr=({label:t,color:i,bg:o})=>e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:3,padding:"2px 7px",borderRadius:3,background:o,color:i,fontSize:9,fontWeight:700},children:t}),xs=[{id:"dashboard",lbl:"Dashboard",I:Ba,desc:"Indicadores generales de calidad"},{id:"nc",lbl:"No conformidades",I:li,desc:"Registro y gestin de no conformidades"},{id:"auditorias",lbl:"Auditoras",I:Ys,desc:"Auditoras internas y externas programadas"},{id:"protocolos",lbl:"Protocolos",I:Et,desc:"Protocolos de ensayo, pruebas y recepcin"},{id:"checklists",lbl:"Listas de chequeo",I:xt,desc:"Listas de verificacin por actividad"},{id:"entregas",lbl:"Actas de entrega",I:zn,desc:"Actas parciales y finales de obra"},{id:"indicadores",lbl:"Indicadores KPI",I:Yc,desc:"Mtricas y metas de calidad"}],ir=[{id:"menor",lbl:"Menor",color:pe.amber,bg:pe.amberBg},{id:"mayor",lbl:"Mayor",color:"#D4840A",bg:"#FFF3E0"},{id:"critica",lbl:"Crtica",color:pe.red,bg:pe.redBg}],Nx=["Materiales fuera de especificacin","Dimensiones fuera de tolerancia","Acabado defectuoso","Instalacin incorrecta","Falta de planeidad","Fisuras o grietas","Humedad o filtracin","Incumplimiento de planos","Incumplimiento de norma","Falta de documentacin","Otro"],Ux=["Interna","Externa","Seguimiento","Pre-entrega","Recepcin materiales"],Vx=["Ensayo de resistencia (concreto)","Prueba hidrosttica","Prueba de estanqueidad","Verificacin de niveles","Prueba de aislamiento elctrico","Ensayo de compactacin","Verificacin de planeidad","Prueba de carga","Inspeccin visual de soldadura","Prueba de adherencia (pintura)","Otro"];function qx(){var x,y;const[t,i]=F.useState("dashboard"),[o,n]=sn("hab:calidad:nc",[]),[a,r]=sn("hab:calidad:auditorias",[]),[s,g]=sn("hab:calidad:protocolos",[]),[h,b]=sn("hab:calidad:checklists",[]),[j,k]=sn("hab:calidad:entregas",[]),[v,m]=sn("hab:calidad:indicadores",[{id:It(),nombre:"Tasa de NC por actividad",meta:5,actual:3.2,unidad:"%",periodo:"mensual"},{id:It(),nombre:"NC cerradas en plazo",meta:90,actual:78,unidad:"%",periodo:"mensual"},{id:It(),nombre:"Auditoras realizadas",meta:4,actual:2,unidad:"ud",periodo:"trimestral"},{id:It(),nombre:"Satisfaccin cliente",meta:4.5,actual:4.2,unidad:"/5",periodo:"por proyecto"},{id:It(),nombre:"Reprocesos",meta:2,actual:1,unidad:"%",periodo:"mensual"}]),f={border:`1px solid ${pe.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},p=o.filter(u=>u.estado==="abierta"||u.estado==="en_proceso").length,d=o.filter(u=>u.estado==="cerrada").length,c=a.filter(u=>u.estado==="programada").length,l=o.filter(u=>u.severidad==="critica"&&u.estado!=="cerrada").length;return e.jsxs(e.Fragment,{children:[e.jsx(Lx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:pe.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:pe.surface,borderBottom:`1px solid ${pe.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:pe.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:pe.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:pe.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:pe.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:pe.inkLight,marginLeft:10},children:"/ Calidad y Auditora"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[l>0&&e.jsxs("div",{style:{background:pe.redBg,border:`1px solid ${pe.red}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>i("nc"),children:[e.jsx(li,{size:12,color:pe.red}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:pe.red},children:[l," NC crtica",l!==1?"s":""]})]}),c>0&&e.jsxs("div",{style:{background:pe.blueBg,border:`1px solid ${pe.blue}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>i("auditorias"),children:[e.jsx(Ys,{size:12,color:pe.blue}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:pe.blue},children:[c," auditora",c!==1?"s":""," pendiente",c!==1?"s":""]})]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:pe.surface,borderRight:`1px solid ${pe.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[xs.map(u=>{const S=t===u.id,A=u.id==="nc"?p:u.id==="auditorias"?c:0;return e.jsxs("button",{onClick:()=>i(u.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:S?`3px solid ${pe.ink}`:"3px solid transparent",background:S?pe.accent:"transparent",color:S?pe.ink:pe.inkLight,fontSize:12,fontWeight:S?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(u.I,{size:13})," ",e.jsx("span",{style:{flex:1,lineHeight:1.2},children:u.lbl}),A>0&&e.jsx("span",{style:{background:u.id==="nc"?pe.red:pe.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:A})]},u.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:pe.inkXLight,letterSpacing:.8,borderTop:`1px solid ${pe.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:pe.ink,letterSpacing:-.2},children:(x=xs.find(u=>u.id===t))==null?void 0:x.lbl}),e.jsx("p",{style:{fontSize:11,color:pe.inkLight,marginTop:2},children:(y=xs.find(u=>u.id===t))==null?void 0:y.desc})]}),t==="dashboard"&&e.jsx(Hx,{ncs:o,auditorias:a,indicadores:v,ncAbiertas:p,ncCerradas:d,audPendientes:c,ncCriticas:l,setTab:i}),t==="nc"&&e.jsx(Gx,{ncs:o,saveNcs:n,inp:f}),t==="auditorias"&&e.jsx(Kx,{auditorias:a,saveAud:r,inp:f}),t==="protocolos"&&e.jsx(Jx,{protocolos:s,saveProt:g,inp:f}),t==="checklists"&&e.jsx(Yx,{checklists:h,saveCheck:b,inp:f}),t==="entregas"&&e.jsx(Xx,{entregas:j,saveEntregas:k,inp:f}),t==="indicadores"&&e.jsx(Qx,{indicadores:v,saveKpi:m,inp:f})]})})]})]})]})}function Hx({ncs:t,auditorias:i,indicadores:o,ncAbiertas:n,ncCerradas:a,audPendientes:r,ncCriticas:s,setTab:g}){const h=t.length,b=h>0?Math.round(a/h*100):100;return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"NC abiertas",val:n,color:pe.red,bg:pe.redBg},{lbl:"NC crticas",val:s,color:s>0?pe.red:pe.green,bg:s>0?pe.redBg:pe.greenBg},{lbl:"Tasa de cierre",val:`${b}%`,color:b>=80?pe.green:pe.amber,bg:b>=80?pe.greenBg:pe.amberBg},{lbl:"Auditoras pend.",val:r,color:pe.blue,bg:pe.blueBg},{lbl:"Total NC",val:h,color:pe.inkMid,bg:pe.surfaceAlt}].map(j=>e.jsxs(si,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase",letterSpacing:1},children:j.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:j.color,marginTop:4},children:j.val})]},j.lbl))}),e.jsxs(si,{style:{padding:20,marginBottom:16,textAlign:"center",background:b>=80&&s===0?pe.greenBg:s>0?pe.redBg:pe.amberBg,border:`1px solid ${b>=80&&s===0?pe.green:s>0?pe.red:pe.amber}33`},children:[e.jsxs("div",{style:{fontSize:40,fontWeight:800,color:b>=80&&s===0?pe.green:s>0?pe.red:pe.amber},children:[b>=80&&s===0?"":s>0?"":""," ",b,"%"]}),e.jsx("div",{style:{fontSize:14,fontWeight:700,color:pe.ink,marginTop:4},children:"ndice de conformidad"}),e.jsx("div",{style:{fontSize:11,color:pe.inkMid},children:s>0?`${s} no conformidad(es) crtica(s) requieren atencin inmediata`:n>0?`${n} NC abiertas pendientes de resolucin`:"Sistema de calidad sin hallazgos abiertos"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs(si,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:pe.redBg,borderBottom:`1px solid ${pe.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,fontWeight:700,color:pe.red},children:"NC recientes"}),e.jsx("button",{onClick:()=>g("nc"),style:{background:"none",border:"none",fontSize:9,color:pe.red,fontWeight:600,cursor:"pointer"},children:"Ver todas "})]}),t.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:pe.inkLight,fontSize:11},children:"Sin no conformidades "}):[...t].sort((j,k)=>k.fecha>j.fecha?1:-1).slice(0,5).map(j=>{var v;const k=ir.find(m=>m.id===j.severidad)||ir[0];return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:8,fontSize:10},children:[e.jsx(tr,{label:k.lbl,color:k.color,bg:k.bg}),e.jsx("span",{style:{flex:1,fontWeight:500},children:((v=j.descripcion)==null?void 0:v.slice(0,50))||"Sin descripcin"}),e.jsx(tr,{label:j.estado,color:j.estado==="cerrada"?pe.green:pe.amber,bg:j.estado==="cerrada"?pe.greenBg:pe.amberBg})]},j.id)})]}),e.jsxs(si,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:pe.blueBg,borderBottom:`1px solid ${pe.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,fontWeight:700,color:pe.blue},children:"Indicadores clave"}),e.jsx("button",{onClick:()=>g("indicadores"),style:{background:"none",border:"none",fontSize:9,color:pe.blue,fontWeight:600,cursor:"pointer"},children:"Configurar "})]}),o.slice(0,5).map(j=>{const k=j.unidad==="%"?j.actual<=j.meta:j.actual>=j.meta,v=j.meta>0?Math.min(j.actual/j.meta*100,100):0;return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:3},children:[e.jsx("span",{style:{fontWeight:600},children:j.nombre}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:k?pe.green:pe.amber},children:[j.actual,j.unidad," / ",j.meta,j.unidad]})]}),e.jsx("div",{style:{height:4,background:pe.border,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${v}%`,background:k?pe.green:pe.amber,borderRadius:2,transition:"width .3s"}})})]},j.id)})]})]}),t.length===0&&i.length===0&&e.jsxs(si,{style:{padding:24,textAlign:"center",marginTop:16},children:[e.jsx(Ys,{size:32,style:{color:pe.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:13,fontWeight:600,color:pe.inkMid,marginBottom:12},children:"Sin datos de calidad an"}),e.jsxs(co,{on:()=>{const j=[{id:It(),fecha:to(),numero:"NC-001",proyecto:"Torre Norte Apto 301",ubicacion:"Bao principal",categoria:"Fisuras o grietas",severidad:"mayor",descripcion:"Fisura longitudinal en paete de muro, longitud aprox 1.2m. Zona hmeda del bao principal.",estado:"abierta",responsable:"Residente",accionCorrectiva:"",fechaLimite:(()=>{const v=new Date;return v.setDate(v.getDate()+7),v.toISOString().split("T")[0]})(),evidencias:"Foto tomada",seguimiento:[]},{id:It(),fecha:to(),numero:"NC-002",proyecto:"Torre Norte Apto 301",ubicacion:"Cocina",categoria:"Dimensiones fuera de tolerancia",severidad:"menor",descripcion:"Mesn de cocina 2cm ms corto de lo especificado en plano. No afecta funcionalidad.",estado:"en_proceso",responsable:"Contratista carpintera",accionCorrectiva:"Se ajustar la pieza en la prxima visita",fechaLimite:(()=>{const v=new Date;return v.setDate(v.getDate()+5),v.toISOString().split("T")[0]})(),evidencias:"",seguimiento:[{fecha:to(),nota:"Se contact al proveedor para rehacer pieza",por:"Residente"}]},{id:It(),fecha:to(),numero:"NC-003",proyecto:"Oficinas Chic",ubicacion:"Piso 4 - Zona abierta",categoria:"Acabado defectuoso",severidad:"critica",descripcion:"Porcelanato presenta manchas de xido en 15m de la zona abierta. Material de lote defectuoso.",estado:"abierta",responsable:"Proveedor Cermicas",accionCorrectiva:"",fechaLimite:Uo(),evidencias:"Fotos y video",seguimiento:[]},{id:It(),fecha:to(),numero:"NC-004",proyecto:"Casa Campestre Cha",ubicacion:"Cubierta",categoria:"Humedad o filtracin",severidad:"mayor",descripcion:"Filtracin en unin de cubierta con muro fachada norte. Se evidencia humedad en cielo raso.",estado:"cerrada",responsable:"Impermeabilizador",accionCorrectiva:"Se resell junta con membrana asfltica y se verific estanqueidad",fechaLimite:Uo(),evidencias:"Antes/despus",seguimiento:[{fecha:to(),nota:"Reparacin ejecutada",por:"Residente"},{fecha:to(),nota:"Prueba de estanqueidad OK, se cierra NC",por:"Director"}]}];saveNcs(j);const k=[{id:It(),fecha:Uo(),tipo:"Interna",proyecto:"Torre Norte",auditor:"David Parra",alcance:"Revisin acabados pisos 1-3",estado:"programada",hallazgos:"",calificacion:0},{id:It(),fecha:(()=>{const v=new Date;return v.setDate(v.getDate()-7),v.toISOString().split("T")[0]})(),tipo:"Pre-entrega",proyecto:"Casa Campestre Cha",auditor:"Ana Mara Daz",alcance:"Verificacin general pre-entrega al cliente",estado:"realizada",hallazgos:"3 hallazgos menores en acabados de pintura",calificacion:85}];saveAud(k)},children:[e.jsx(Oe,{size:12})," Crear datos de ejemplo"]})]})]})}function Gx({ncs:t,saveNcs:i,inp:o}){const[n,a]=F.useState("todos"),[r,s]=F.useState(""),[g,h]=F.useState(null),b=()=>{const m={id:It(),fecha:to(),numero:`NC-${String(t.length+1).padStart(3,"0")}`,proyecto:"",ubicacion:"",categoria:"Otro",severidad:"menor",descripcion:"",estado:"abierta",responsable:"",accionCorrectiva:"",fechaLimite:"",evidencias:"",seguimiento:[]};i(f=>[...f,m]),h(m.id)},j=(m,f,p)=>i(d=>d.map(c=>c.id===m?{...c,[f]:p}:c)),k=(m,f)=>{i(p=>p.map(d=>d.id===m?{...d,seguimiento:[...d.seguimiento||[],{fecha:to(),nota:f,por:"Usuario"}]}:d))},v=t.filter(m=>!(n!=="todos"&&m.estado!==n||r&&!(m.descripcion||"").toLowerCase().includes(r.toLowerCase())&&!(m.numero||"").toLowerCase().includes(r.toLowerCase())&&!(m.proyecto||"").toLowerCase().includes(r.toLowerCase()))).sort((m,f)=>f.fecha>m.fecha?1:-1);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["todos","Todas"],["abierta","Abiertas"],["en_proceso","En proceso"],["cerrada","Cerradas"]].map(([m,f],p,d)=>e.jsxs("button",{onClick:()=>a(m),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${pe.border}`,borderLeft:p>0?"none":void 0,borderRadius:p===0?"4px 0 0 4px":p===d.length-1?"0 4px 4px 0":"0",background:n===m?pe.ink:"#fff",color:n===m?"#fff":pe.inkMid},children:[f," ",m==="abierta"?`(${t.filter(c=>c.estado==="abierta").length})`:""]},m))}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ci,{size:12,style:{position:"absolute",left:8,top:9,color:pe.inkLight}}),e.jsx("input",{value:r,onChange:m=>s(m.target.value),placeholder:"Buscar NC...",style:{...o,paddingLeft:26,width:200}})]}),e.jsxs(co,{sm:!0,on:b,style:{background:pe.red},children:[e.jsx(Oe,{size:10})," Nueva NC"]})]}),e.jsx(si,{style:{padding:0,overflow:"hidden"},children:v.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:pe.inkLight,fontSize:12},children:["Sin no conformidades ",n!=="todos"?`con estado "${n}"`:""]}):v.map(m=>{const f=ir.find(c=>c.id===m.severidad)||ir[0],p=g===m.id,d=m.fechaLimite&&new Date(m.fechaLimite)<new Date&&m.estado!=="cerrada";return e.jsxs("div",{style:{borderBottom:`1px solid ${pe.border}`},children:[e.jsxs("div",{onClick:()=>h(p?null:m.id),style:{padding:"10px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:p?pe.surfaceAlt:"transparent",borderLeft:`4px solid ${f.color}`},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:pe.blue,background:pe.blueBg,padding:"2px 6px",borderRadius:3},children:m.numero}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.descripcion||"Sin descripcin"}),e.jsxs("div",{style:{fontSize:9,color:pe.inkLight,marginTop:1},children:[m.proyecto||"Sin proyecto","  ",m.ubicacion||"Sin ubicacin","  ",m.categoria]})]}),e.jsx(tr,{label:f.lbl,color:f.color,bg:f.bg}),d&&e.jsx(tr,{label:"VENCIDA",color:pe.red,bg:pe.redBg}),e.jsx(tr,{label:m.estado,color:m.estado==="cerrada"?pe.green:m.estado==="en_proceso"?pe.blue:pe.amber,bg:m.estado==="cerrada"?pe.greenBg:m.estado==="en_proceso"?pe.blueBg:pe.amberBg}),e.jsx("span",{style:{fontSize:9,color:pe.inkLight},children:Wx(m.fecha)}),p?e.jsx(Fn,{size:12}):e.jsx(Yi,{size:12})]}),p&&e.jsxs("div",{style:{padding:"0 16px 14px 20px",background:pe.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:8,marginTop:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:m.proyecto||"",onChange:c=>j(m.id,"proyecto",c.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Ubicacin"}),e.jsx("input",{value:m.ubicacion||"",onChange:c=>j(m.id,"ubicacion",c.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Responsable"}),e.jsx("input",{value:m.responsable||"",onChange:c=>j(m.id,"responsable",c.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Fecha lmite"}),e.jsx("input",{type:"date",value:m.fechaLimite||"",onChange:c=>j(m.id,"fechaLimite",c.target.value),style:{...o,width:"100%"}})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsx("select",{value:m.categoria,onChange:c=>j(m.id,"categoria",c.target.value),style:{...o,width:"100%"},children:Nx.map(c=>e.jsx("option",{children:c},c))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Severidad"}),e.jsx("select",{value:m.severidad,onChange:c=>j(m.id,"severidad",c.target.value),style:{...o,width:"100%"},children:ir.map(c=>e.jsx("option",{value:c.id,children:c.lbl},c.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Estado"}),e.jsx("select",{value:m.estado,onChange:c=>j(m.id,"estado",c.target.value),style:{...o,width:"100%",background:m.estado==="cerrada"?pe.greenBg:m.estado==="en_proceso"?pe.blueBg:"#fff"},children:["abierta","en_proceso","cerrada"].map(c=>e.jsx("option",{value:c,children:c},c))})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Descripcin del hallazgo"}),e.jsx("textarea",{value:m.descripcion||"",onChange:c=>j(m.id,"descripcion",c.target.value),rows:2,style:{...o,width:"100%",resize:"vertical",lineHeight:1.5}})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Accin correctiva"}),e.jsx("textarea",{value:m.accionCorrectiva||"",onChange:c=>j(m.id,"accionCorrectiva",c.target.value),rows:2,placeholder:"Describir la accin correctiva aplicada o propuesta...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5,background:m.estado==="cerrada"?pe.greenBg:"#fff"}})]}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:pe.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Seguimiento"}),(m.seguimiento||[]).map((c,l)=>{var x;return e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${pe.border}`,paddingLeft:10,marginLeft:4,marginBottom:2},children:[e.jsx("span",{style:{color:pe.inkLight,minWidth:60,fontSize:9},children:wc((x=c.fecha)==null?void 0:x.split("T")[0])}),e.jsx("span",{style:{fontWeight:600,fontSize:9},children:c.por}),e.jsx("span",{style:{color:pe.inkMid},children:c.nota})]},l)}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:4},children:[e.jsx("input",{id:`seg-nc-${m.id}`,placeholder:"Aadir nota de seguimiento...",style:{...o,flex:1,fontSize:10}}),e.jsxs(co,{sm:!0,v:"sec",on:()=>{const c=document.getElementById(`seg-nc-${m.id}`);c!=null&&c.value.trim()&&(k(m.id,c.value),c.value="")},children:[e.jsx(Oe,{size:9})," Aadir"]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:e.jsx("button",{onClick:()=>i(c=>c.filter(l=>l.id!==m.id)),style:{background:"none",border:"none",color:pe.red,fontSize:10,cursor:"pointer"},children:" Eliminar NC"})})]})]},m.id)})})]})}function Kx({auditorias:t,saveAud:i,inp:o}){const n=()=>{i(r=>[...r,{id:It(),fecha:Uo(),tipo:"Interna",proyecto:"",auditor:"",alcance:"",estado:"programada",hallazgos:"",calificacion:0,items:[]}])},a=(r,s,g)=>i(h=>h.map(b=>b.id===r?{...b,[s]:g}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:n,children:[e.jsx(Oe,{size:10})," Nueva auditora"]})}),t.sort((r,s)=>s.fecha>r.fecha?1:-1).map(r=>e.jsxs(si,{style:{padding:16,marginBottom:10,borderLeft:`4px solid ${r.estado==="realizada"?pe.green:r.estado==="programada"?pe.blue:pe.inkLight}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{type:"date",value:r.fecha,onChange:s=>a(r.id,"fecha",s.target.value),style:{border:`1px solid ${pe.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("select",{value:r.tipo,onChange:s=>a(r.id,"tipo",s.target.value),style:{...o,width:140,fontSize:11,fontWeight:600},children:Ux.map(s=>e.jsx("option",{children:s},s))}),e.jsx("input",{value:r.proyecto||"",onChange:s=>a(r.id,"proyecto",s.target.value),placeholder:"Proyecto",style:{flex:1,...o,fontWeight:600}}),e.jsx("input",{value:r.auditor||"",onChange:s=>a(r.id,"auditor",s.target.value),placeholder:"Auditor",style:{width:140,...o,fontSize:10}}),e.jsx("select",{value:r.estado,onChange:s=>a(r.id,"estado",s.target.value),style:{fontSize:9,padding:"3px 8px",border:`1px solid ${pe.border}`,borderRadius:3,background:r.estado==="realizada"?pe.greenBg:r.estado==="programada"?pe.blueBg:"#fff"},children:["programada","en_curso","realizada","cancelada"].map(s=>e.jsx("option",{children:s},s))}),e.jsx("button",{onClick:()=>i(s=>s.filter(g=>g.id!==r.id)),style:{background:"none",border:"none",color:pe.red,cursor:"pointer"},children:e.jsx(He,{size:12})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Alcance"}),e.jsx("input",{value:r.alcance||"",onChange:s=>a(r.id,"alcance",s.target.value),placeholder:"reas y actividades a auditar",style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Calificacin (%)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"range",min:0,max:100,value:r.calificacion||0,onChange:s=>a(r.id,"calificacion",+s.target.value),style:{flex:1,accentColor:r.calificacion>=80?pe.green:pe.amber}}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:r.calificacion>=80?pe.green:r.calificacion>=50?pe.amber:pe.red},children:[r.calificacion||0,"%"]})]})]})]}),r.estado==="realizada"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Hallazgos"}),e.jsx("textarea",{value:r.hallazgos||"",onChange:s=>a(r.id,"hallazgos",s.target.value),rows:2,placeholder:"Resumen de hallazgos...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5}})]})]},r.id)),t.length===0&&e.jsx(si,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:pe.inkLight},children:"Sin auditoras programadas"})})]})}function Jx({protocolos:t,saveProt:i,inp:o}){const n=()=>{i(r=>[...r,{id:It(),fecha:Uo(),tipo:"Otro",proyecto:"",ubicacion:"",responsable:"",resultado:"pendiente",valor:"",valorRef:"",observaciones:""}])},a=(r,s,g)=>i(h=>h.map(b=>b.id===r?{...b,[s]:g}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:n,children:[e.jsx(Oe,{size:10})," Nuevo protocolo"]})}),e.jsx(si,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:pe.surfaceAlt},children:["Fecha","Tipo de ensayo/prueba","Proyecto","Ubicacin","Valor","Ref.","Resultado","Responsable",""].map(r=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${pe.border}`},children:r},r))})}),e.jsxs("tbody",{children:[t.sort((r,s)=>s.fecha>r.fecha?1:-1).map(r=>e.jsxs("tr",{style:{borderBottom:`1px solid ${pe.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:r.fecha,onChange:s=>a(r.id,"fecha",s.target.value),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:r.tipo,onChange:s=>a(r.id,"tipo",s.target.value),style:{border:"none",background:"transparent",fontSize:10,fontWeight:600},children:Vx.map(s=>e.jsx("option",{children:s},s))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.proyecto||"",onChange:s=>a(r.id,"proyecto",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.ubicacion||"",onChange:s=>a(r.id,"ubicacion",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.valor||"",onChange:s=>a(r.id,"valor",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:60,fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.valorRef||"",onChange:s=>a(r.id,"valorRef",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:60,fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:r.resultado,onChange:s=>a(r.id,"resultado",s.target.value),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${pe.border}`,borderRadius:3,background:r.resultado==="conforme"?pe.greenBg:r.resultado==="no_conforme"?pe.redBg:"#fff"},children:[["pendiente","Pendiente"],["conforme","Conforme"],["no_conforme","No conforme"]].map(([s,g])=>e.jsx("option",{value:s,children:g},s))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.responsable||"",onChange:s=>a(r.id,"responsable",s.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:70}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>i(s=>s.filter(g=>g.id!==r.id)),style:{background:"none",border:"none",color:pe.red,cursor:"pointer"},children:e.jsx(He,{size:11})})})]},r.id)),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:30,textAlign:"center",color:pe.inkLight},children:"Sin protocolos registrados"})})]})]})})]})}function Yx({checklists:t,saveCheck:i,inp:o}){const[n,a]=F.useState(null),r=()=>{const b={id:It(),nombre:"Nueva lista de chequeo",proyecto:"",fecha:Uo(),responsable:"",items:[{id:It(),texto:"Verificar niveles y plomos",ok:!1},{id:It(),texto:"Verificar dimensiones segn plano",ok:!1},{id:It(),texto:"Verificar acabado superficial",ok:!1},{id:It(),texto:"Verificar juntas y sellantes",ok:!1},{id:It(),texto:"Verificar limpieza del rea",ok:!1}]};i(j=>[...j,b]),a(b.id)},s=(b,j,k)=>i(v=>v.map(m=>m.id===b?{...m,[j]:k}:m)),g=(b,j)=>{i(k=>k.map(v=>v.id===b?{...v,items:v.items.map(m=>m.id===j?{...m,ok:!m.ok}:m)}:v))},h=b=>{i(j=>j.map(k=>k.id===b?{...k,items:[...k.items,{id:It(),texto:"",ok:!1}]}:k))};return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:r,children:[e.jsx(Oe,{size:10})," Nueva lista"]})}),t.map(b=>{const j=b.items.filter(f=>f.ok).length,k=b.items.length,v=k>0?Math.round(j/k*100):0,m=n===b.id;return e.jsxs(si,{style:{marginBottom:10,padding:0,overflow:"hidden"},children:[e.jsxs("div",{onClick:()=>a(m?null:b.id),style:{padding:"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:m?pe.surfaceAlt:"transparent"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",border:`3px solid ${v>=100?pe.green:pe.border}`,display:"flex",alignItems:"center",justifyContent:"center",background:v>=100?pe.greenBg:"transparent",flexShrink:0},children:v>=100?e.jsx(Ho,{size:16,color:pe.green}):e.jsxs("span",{style:{fontSize:9,fontWeight:800,fontFamily:"'DM Mono',monospace",color:pe.inkMid},children:[v,"%"]})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:b.nombre}),e.jsxs("div",{style:{fontSize:9,color:pe.inkLight},children:[b.proyecto||"Sin proyecto","  ",j,"/",k," items  ",wc(b.fecha)]})]}),e.jsx("div",{style:{width:80,height:6,background:pe.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${v}%`,background:v>=100?pe.green:pe.blue,borderRadius:3}})}),m?e.jsx(Fn,{size:12}):e.jsx(Yi,{size:12})]}),m&&e.jsxs("div",{style:{padding:"0 16px 14px",background:pe.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",gap:8,marginBottom:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Nombre"}),e.jsx("input",{value:b.nombre,onChange:f=>s(b.id,"nombre",f.target.value),style:{...o,width:"100%",fontWeight:700}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:b.proyecto||"",onChange:f=>s(b.id,"proyecto",f.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase"},children:"Responsable"}),e.jsx("input",{value:b.responsable||"",onChange:f=>s(b.id,"responsable",f.target.value),style:{...o,width:"100%"}})]})]}),b.items.map((f,p)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"5px 0",borderBottom:`1px solid ${pe.border}`},children:[e.jsx("button",{onClick:()=>g(b.id,f.id),style:{width:22,height:22,borderRadius:4,border:`2px solid ${f.ok?pe.green:pe.border}`,background:f.ok?pe.greenBg:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:f.ok&&e.jsx(xt,{size:12,color:pe.green})}),e.jsx("input",{value:f.texto,onChange:d=>{i(c=>c.map(l=>l.id===b.id?{...l,items:l.items.map(x=>x.id===f.id?{...x,texto:d.target.value}:x)}:l))},placeholder:"Descripcin del item...",style:{flex:1,border:"none",background:"transparent",fontSize:11,textDecoration:f.ok?"line-through":"none",color:f.ok?pe.inkLight:pe.ink}}),e.jsx("button",{onClick:()=>i(d=>d.map(c=>c.id===b.id?{...c,items:c.items.filter(l=>l.id!==f.id)}:c)),style:{background:"none",border:"none",color:pe.red,cursor:"pointer"},children:e.jsx(He,{size:10})})]},f.id)),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs(co,{sm:!0,v:"sec",on:()=>h(b.id),children:[e.jsx(Oe,{size:9})," Aadir item"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{onClick:()=>i(f=>f.filter(p=>p.id!==b.id)),style:{background:"none",border:"none",color:pe.red,fontSize:10,cursor:"pointer"},children:" Eliminar lista"})]})]})]},b.id)}),t.length===0&&e.jsx(si,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:pe.inkLight},children:"Sin listas de chequeo. Crea la primera."})})]})}function Xx({entregas:t,saveEntregas:i,inp:o}){const n=()=>{i(r=>[...r,{id:It(),fecha:Uo(),tipo:"parcial",proyecto:"",cliente:"",descripcion:"",items:[],estado:"borrador",observaciones:"",firmaCliente:!1,firmaHabitaris:!1}])},a=(r,s,g)=>i(h=>h.map(b=>b.id===r?{...b,[s]:g}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:n,children:[e.jsx(Oe,{size:10})," Nueva acta"]})}),t.sort((r,s)=>s.fecha>r.fecha?1:-1).map(r=>e.jsxs(si,{style:{padding:16,marginBottom:10,borderLeft:`4px solid ${r.estado==="firmada"?pe.green:r.estado==="enviada"?pe.blue:pe.inkLight}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{type:"date",value:r.fecha,onChange:s=>a(r.id,"fecha",s.target.value),style:{border:`1px solid ${pe.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsxs("select",{value:r.tipo,onChange:s=>a(r.id,"tipo",s.target.value),style:{...o,width:100,fontSize:11,fontWeight:600},children:[e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"final",children:"Final"}),e.jsx("option",{value:"provisional",children:"Provisional"})]}),e.jsx("input",{value:r.proyecto||"",onChange:s=>a(r.id,"proyecto",s.target.value),placeholder:"Proyecto",style:{flex:1,...o,fontWeight:600}}),e.jsx("input",{value:r.cliente||"",onChange:s=>a(r.id,"cliente",s.target.value),placeholder:"Cliente",style:{width:140,...o,fontSize:10}}),e.jsx("select",{value:r.estado,onChange:s=>a(r.id,"estado",s.target.value),style:{fontSize:9,padding:"3px 8px",border:`1px solid ${pe.border}`,borderRadius:3,background:r.estado==="firmada"?pe.greenBg:r.estado==="enviada"?pe.blueBg:"#fff"},children:["borrador","enviada","firmada"].map(s=>e.jsx("option",{children:s},s))}),e.jsx("button",{onClick:()=>i(s=>s.filter(g=>g.id!==r.id)),style:{background:"none",border:"none",color:pe.red,cursor:"pointer"},children:e.jsx(He,{size:12})})]}),e.jsx("textarea",{value:r.descripcion||"",onChange:s=>a(r.id,"descripcion",s.target.value),rows:2,placeholder:"Descripcin de los trabajos entregados...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5,marginBottom:6}}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",fontSize:10},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.firmaHabitaris||!1,onChange:s=>a(r.id,"firmaHabitaris",s.target.checked)}),e.jsx("span",{style:{fontWeight:600},children:"Firma Habitaris"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.firmaCliente||!1,onChange:s=>a(r.id,"firmaCliente",s.target.checked)}),e.jsx("span",{style:{fontWeight:600},children:"Firma Cliente"})]}),e.jsx("input",{value:r.observaciones||"",onChange:s=>a(r.id,"observaciones",s.target.value),placeholder:"Observaciones...",style:{flex:1,...o,fontSize:10}})]})]},r.id)),t.length===0&&e.jsx(si,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:pe.inkLight},children:"Sin actas de entrega"})})]})}function Qx({indicadores:t,saveKpi:i,inp:o}){const n=()=>{i(r=>[...r,{id:It(),nombre:"Nuevo indicador",meta:0,actual:0,unidad:"%",periodo:"mensual"}])},a=(r,s,g)=>i(h=>h.map(b=>b.id===r?{...b,[s]:g}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:n,children:[e.jsx(Oe,{size:10})," Nuevo indicador"]})}),e.jsx(si,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:pe.surfaceAlt},children:["Indicador","Meta","Actual","Unidad","Perodo","Cumplimiento",""].map(r=>e.jsx("th",{style:{padding:"8px 12px",fontSize:8,fontWeight:700,color:pe.inkLight,textTransform:"uppercase",textAlign:["Meta","Actual"].includes(r)?"right":"left",borderBottom:`2px solid ${pe.border}`},children:r},r))})}),e.jsx("tbody",{children:t.map(r=>{const s=r.meta>0?Math.min(r.actual/r.meta*100,150):0,g=r.unidad==="%"&&(r.nombre.toLowerCase().includes("reproceso")||r.nombre.toLowerCase().includes("nc por"))?r.actual<=r.meta:r.actual>=r.meta;return e.jsxs("tr",{style:{borderBottom:`1px solid ${pe.border}`},children:[e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("input",{value:r.nombre,onChange:h=>a(r.id,"nombre",h.target.value),style:{border:"none",background:"transparent",fontSize:12,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"8px 12px",textAlign:"right"},children:e.jsx("input",{type:"number",value:r.meta||"",onChange:h=>a(r.id,"meta",+h.target.value),style:{width:50,border:`1px solid ${pe.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"8px 12px",textAlign:"right"},children:e.jsx("input",{type:"number",value:r.actual||"",onChange:h=>a(r.id,"actual",+h.target.value),style:{width:50,border:`1px solid ${pe.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,background:g?pe.greenBg:pe.amberBg,color:g?pe.green:pe.amber}})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("select",{value:r.unidad,onChange:h=>a(r.id,"unidad",h.target.value),style:{border:"none",background:"transparent",fontSize:10},children:["%","ud","/5","das","h"].map(h=>e.jsx("option",{children:h},h))})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("select",{value:r.periodo,onChange:h=>a(r.id,"periodo",h.target.value),style:{border:"none",background:"transparent",fontSize:10},children:["mensual","trimestral","semestral","anual","por proyecto"].map(h=>e.jsx("option",{children:h},h))})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:pe.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${Math.min(s,100)}%`,background:g?pe.green:pe.amber,borderRadius:3,transition:"width .3s"}})}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:g?pe.green:pe.amber},children:g?"":""})]})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("button",{onClick:()=>i(h=>h.filter(b=>b.id!==r.id)),style:{background:"none",border:"none",color:pe.red,cursor:"pointer"},children:e.jsx(He,{size:11})})})]},r.id)})})]})})]})}const Zx=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),De={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Kn=()=>Math.random().toString(36).slice(2,9),ms=()=>new Date().toISOString().split("T")[0],pd=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",em=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/36e5);return o<24?`hace ${o}h`:`hace ${Math.floor(o/24)}d`};function ta(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Ee.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const a=F.useCallback(async r=>{const s=typeof r=="function"?r(o):r;n(s);try{Ee.set(t,JSON.stringify(s))}catch{}},[t,o]);return[o,a]}const Di=({children:t,style:i})=>e.jsx("div",{style:{background:De.surface,border:`1px solid ${De.border}`,borderRadius:8,boxShadow:De.shadow,...i},children:t}),ln=({children:t,v:i,sm:o,on:n,style:a,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${De.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":De.ink,color:i==="sec"?De.inkMid:"#fff",cursor:"pointer",...a},...r,children:t}),tm=[{id:"dashboard",lbl:"Dashboard",I:Ba,desc:"Resumen de postventa y satisfaccin"},{id:"tickets",lbl:"Tickets",I:jr,desc:"Solicitudes y reclamos de clientes"},{id:"garantias",lbl:"Garantas",I:Et,desc:"Control de garantas vigentes"},{id:"visitas",lbl:"Visitas",I:Dd,desc:"Visitas de inspeccin y correccin"},{id:"encuestas",lbl:"Satisfaccin",I:Xc,desc:"Encuestas y calificaciones"}],Jn=[{id:"baja",lbl:"Baja",color:De.green,bg:De.greenBg},{id:"media",lbl:"Media",color:De.amber,bg:De.amberBg},{id:"alta",lbl:"Alta",color:"#D4840A",bg:"#FFF3E0"},{id:"urgente",lbl:"Urgente",color:De.red,bg:De.redBg}],im=["Impermeabilizacin","Pintura","Grietas/fisuras","Instalaciones hidrulicas","Instalaciones elctricas","Carpintera","Pisos","Cielos","Cerraduras/chapas","Otro"];function om(){const[t,i]=F.useState("dashboard"),[o,n]=ta("hab:postventa:tickets",[]),[a,r]=ta("hab:postventa:garantias",[]),[s,g]=ta("hab:postventa:visitas",[]),[h,b]=ta("hab:postventa:encuestas",[]),[j,k]=F.useState(null),v={border:`1px solid ${De.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},m=()=>{const l={id:Kn(),fecha:new Date().toISOString(),numero:`TK-${String(o.length+1).padStart(4,"0")}`,cliente:"",proyecto:"",categoria:"Otro",prioridad:"media",descripcion:"",estado:"abierto",contacto:"",telefono:"",email:"",seguimiento:[],resolucion:""};n(x=>[...x,l]),k(l.id)},f=(l,x,y)=>n(u=>u.map(S=>S.id===l?{...S,[x]:y}:S)),p=(l,x)=>{n(y=>y.map(u=>u.id===l?{...u,seguimiento:[...u.seguimiento||[],{id:Kn(),fecha:new Date().toISOString(),nota:x,por:"Habitaris"}]}:u))},d=o.filter(l=>l.estado==="abierto"||l.estado==="en_proceso"),c=h.length>0?(h.reduce((l,x)=>l+(x.calificacion||0),0)/h.length).toFixed(1):"";return e.jsxs(e.Fragment,{children:[e.jsx(Zx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:De.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:De.surface,borderBottom:`1px solid ${De.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:De.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:De.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:De.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:De.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:De.inkLight},children:"/ Postventa"}),e.jsx("div",{style:{flex:1}}),d.length>0&&e.jsxs("div",{style:{background:De.amberBg,border:`1px solid ${De.amber}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(li,{size:12,color:De.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:De.amber},children:[d.length," ticket",d.length!==1?"s":""," abierto",d.length!==1?"s":""]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:De.surface,borderRight:`1px solid ${De.border}`,paddingTop:8},children:tm.map(l=>{const x=l.id==="tickets"?d.length:0;return e.jsxs("button",{onClick:()=>i(l.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===l.id?`3px solid ${De.ink}`:"3px solid transparent",background:t===l.id?De.accent:"transparent",color:t===l.id?De.ink:De.inkLight,fontSize:12,fontWeight:t===l.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(l.I,{size:13})," ",e.jsx("span",{style:{flex:1},children:l.lbl}),x>0&&e.jsx("span",{style:{background:De.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:x})]},l.id)})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Tickets abiertos",val:d.length,color:De.amber,bg:De.amberBg},{lbl:"Total tickets",val:o.length,color:De.blue,bg:De.blueBg},{lbl:"Resueltos",val:o.filter(l=>l.estado==="cerrado").length,color:De.green,bg:De.greenBg},{lbl:"Garantas activas",val:a.filter(l=>new Date(l.vencimiento)>new Date).length,color:"#5B3A8C",bg:"#F0ECF6"},{lbl:"Satisfaccin",val:c,color:parseFloat(c)>=4?De.green:De.amber,bg:parseFloat(c)>=4?De.greenBg:De.amberBg}].map(l=>e.jsxs(Di,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase",letterSpacing:1},children:l.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:l.color,marginTop:4},children:l.val})]},l.lbl))}),e.jsxs(Di,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${De.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Tickets recientes"}),e.jsxs(ln,{sm:!0,on:m,children:[e.jsx(Oe,{size:10})," Nuevo ticket"]})]}),o.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:De.inkLight},children:[e.jsx(Dd,{size:28,style:{opacity:.3,marginBottom:8}}),e.jsx("div",{children:"Sin tickets de postventa"})]}):[...o].sort((l,x)=>x.fecha>l.fecha?1:-1).slice(0,8).map(l=>{var y,u;const x=Jn.find(S=>S.id===l.prioridad)||Jn[1];return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11,cursor:"pointer"},onClick:()=>{i("tickets"),k(l.id)},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:De.blue},children:l.numero}),e.jsxs("span",{style:{flex:1,fontWeight:500},children:[((y=l.descripcion)==null?void 0:y.slice(0,60))||"Sin descripcin",((u=l.descripcion)==null?void 0:u.length)>60?"...":""]}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:x.bg,color:x.color,fontWeight:700},children:x.lbl}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:l.estado==="cerrado"?De.greenBg:l.estado==="en_proceso"?De.blueBg:De.amberBg,color:l.estado==="cerrado"?De.green:l.estado==="en_proceso"?De.blue:De.amber,fontWeight:700},children:l.estado}),e.jsx("span",{style:{fontSize:9,color:De.inkLight},children:em(l.fecha)})]},l.id)})]})]}),t==="tickets"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Tickets de postventa"}),e.jsxs(ln,{sm:!0,on:m,children:[e.jsx(Oe,{size:10})," Nuevo ticket"]})]}),o.sort((l,x)=>x.fecha>l.fecha?1:-1).map(l=>{var u;const x=Jn.find(S=>S.id===l.prioridad)||Jn[1],y=j===l.id;return e.jsxs(Di,{style:{marginBottom:8,padding:0,overflow:"hidden",borderLeft:`4px solid ${x.color}`},children:[e.jsxs("div",{onClick:()=>k(y?null:l.id),style:{padding:"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:y?De.surfaceAlt:"transparent"},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:700,color:De.blue},children:l.numero}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:600},children:[l.cliente||"Cliente","  ",l.proyecto||"Proyecto"]}),e.jsxs("div",{style:{fontSize:10,color:De.inkLight},children:[l.categoria,"  ",pd((u=l.fecha)==null?void 0:u.split("T")[0])]})]}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:x.bg,color:x.color,fontWeight:700},children:x.lbl}),e.jsx("select",{value:l.estado,onChange:S=>{S.stopPropagation(),f(l.id,"estado",S.target.value)},style:{fontSize:9,padding:"2px 6px",border:`1px solid ${De.border}`,borderRadius:3,background:l.estado==="cerrado"?De.greenBg:l.estado==="en_proceso"?De.blueBg:De.amberBg},children:["abierto","en_proceso","cerrado"].map(S=>e.jsx("option",{value:S,children:S},S))}),y?e.jsx(Yi,{size:12,style:{transform:"rotate(90deg)"}}):e.jsx(Yi,{size:12})]}),y&&e.jsxs("div",{style:{padding:"0 16px 14px",background:De.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Cliente"}),e.jsx("input",{value:l.cliente||"",onChange:S=>f(l.id,"cliente",S.target.value),style:{...v,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:l.proyecto||"",onChange:S=>f(l.id,"proyecto",S.target.value),style:{...v,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsx("select",{value:l.categoria,onChange:S=>f(l.id,"categoria",S.target.value),style:{...v,width:"100%"},children:im.map(S=>e.jsx("option",{children:S},S))})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsx("input",{value:l.contacto||"",onChange:S=>f(l.id,"contacto",S.target.value),placeholder:" Contacto",style:v}),e.jsx("input",{value:l.telefono||"",onChange:S=>f(l.id,"telefono",S.target.value),placeholder:" Telfono",style:v}),e.jsx("input",{value:l.email||"",onChange:S=>f(l.id,"email",S.target.value),placeholder:" Email",style:v})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Descripcin del problema"}),e.jsx("textarea",{value:l.descripcion||"",onChange:S=>f(l.id,"descripcion",S.target.value),rows:3,style:{...v,width:"100%",resize:"vertical",lineHeight:1.5}})]}),e.jsx("div",{style:{display:"flex",gap:8,marginBottom:8},children:e.jsx("select",{value:l.prioridad,onChange:S=>f(l.id,"prioridad",S.target.value),style:{...v,width:100},children:Jn.map(S=>e.jsx("option",{value:S.id,children:S.lbl},S.id))})}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:De.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Seguimiento"}),(l.seguimiento||[]).map(S=>{var A;return e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${De.border}`,paddingLeft:10,marginLeft:4,marginBottom:2},children:[e.jsx("span",{style:{color:De.inkLight,minWidth:60},children:pd((A=S.fecha)==null?void 0:A.split("T")[0])}),e.jsx("span",{style:{fontWeight:600},children:S.por}),e.jsx("span",{style:{color:De.inkMid},children:S.nota})]},S.id)}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:4},children:[e.jsx("input",{id:`seg-${l.id}`,placeholder:"Aadir nota de seguimiento...",style:{...v,flex:1,fontSize:10}}),e.jsxs(ln,{sm:!0,v:"sec",on:()=>{const S=document.getElementById(`seg-${l.id}`);S!=null&&S.value.trim()&&(p(l.id,S.value),S.value="")},children:[e.jsx(Oe,{size:9})," Aadir"]})]}),l.estado==="cerrado"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Resolucin"}),e.jsx("textarea",{value:l.resolucion||"",onChange:S=>f(l.id,"resolucion",S.target.value),rows:2,placeholder:"Descripcin de la solucin aplicada...",style:{...v,width:"100%",resize:"vertical",background:De.greenBg}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:e.jsx("button",{onClick:()=>n(S=>S.filter(A=>A.id!==l.id)),style:{background:"none",border:"none",color:De.red,fontSize:10,cursor:"pointer"},children:" Eliminar ticket"})})]})]},l.id)}),o.length===0&&e.jsx(Di,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:De.inkLight},children:"Sin tickets. Crea el primero."})})]}),t==="garantias"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Control de garantas"}),e.jsxs(ln,{sm:!0,on:()=>r(l=>[...l,{id:Kn(),proyecto:"",cliente:"",concepto:"",inicio:ms(),vencimiento:(()=>{const x=new Date;return x.setFullYear(x.getFullYear()+1),x.toISOString().split("T")[0]})(),estado:"vigente"}]),children:[e.jsx(Oe,{size:10})," Nueva garanta"]})]}),e.jsx(Di,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:De.surfaceAlt},children:["Proyecto","Cliente","Concepto","Inicio","Vencimiento","Estado",""].map(l=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${De.border}`},children:l},l))})}),e.jsxs("tbody",{children:[a.map(l=>{const x=new Date(l.vencimiento)>new Date;return e.jsxs("tr",{style:{borderBottom:`1px solid ${De.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.proyecto||"",onChange:y=>r(u=>u.map(S=>S.id===l.id?{...S,proyecto:y.target.value}:S)),placeholder:"Proyecto",style:{border:"none",background:"transparent",fontSize:11,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.cliente||"",onChange:y=>r(u=>u.map(S=>S.id===l.id?{...S,cliente:y.target.value}:S)),placeholder:"Cliente",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.concepto||"",onChange:y=>r(u=>u.map(S=>S.id===l.id?{...S,concepto:y.target.value}:S)),placeholder:"Concepto",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.inicio,onChange:y=>r(u=>u.map(S=>S.id===l.id?{...S,inicio:y.target.value}:S)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.vencimiento,onChange:y=>r(u=>u.map(S=>S.id===l.id?{...S,vencimiento:y.target.value}:S)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"2px 6px",borderRadius:3,background:x?De.greenBg:De.redBg,color:x?De.green:De.red},children:x?"Vigente":"Vencida"})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>r(y=>y.filter(u=>u.id!==l.id)),style:{background:"none",border:"none",color:De.red,cursor:"pointer"},children:e.jsx(He,{size:11})})})]},l.id)}),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:30,textAlign:"center",color:De.inkLight},children:"Sin garantas registradas"})})]})]})})]}),t==="visitas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Visitas de postventa"}),e.jsxs(ln,{sm:!0,on:()=>g(l=>[...l,{id:Kn(),fecha:ms(),proyecto:"",cliente:"",motivo:"",responsable:"",estado:"programada",observaciones:""}]),children:[e.jsx(Oe,{size:10})," Nueva visita"]})]}),s.sort((l,x)=>x.fecha>l.fecha?1:-1).map(l=>e.jsxs(Di,{style:{padding:14,marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{type:"date",value:l.fecha,onChange:x=>g(y=>y.map(u=>u.id===l.id?{...u,fecha:x.target.value}:u)),style:{border:`1px solid ${De.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:l.proyecto||"",onChange:x=>g(y=>y.map(u=>u.id===l.id?{...u,proyecto:x.target.value}:u)),placeholder:"Proyecto",style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:600}}),e.jsx("input",{value:l.cliente||"",onChange:x=>g(y=>y.map(u=>u.id===l.id?{...u,cliente:x.target.value}:u)),placeholder:"Cliente",style:{width:120,...v,fontSize:10}}),e.jsx("input",{value:l.responsable||"",onChange:x=>g(y=>y.map(u=>u.id===l.id?{...u,responsable:x.target.value}:u)),placeholder:"Responsable",style:{width:100,...v,fontSize:10}}),e.jsx("select",{value:l.estado,onChange:x=>g(y=>y.map(u=>u.id===l.id?{...u,estado:x.target.value}:u)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${De.border}`,borderRadius:3,background:l.estado==="realizada"?De.greenBg:"#fff"},children:["programada","realizada","cancelada"].map(x=>e.jsx("option",{children:x},x))}),e.jsx("button",{onClick:()=>g(x=>x.filter(y=>y.id!==l.id)),style:{background:"none",border:"none",color:De.red,cursor:"pointer"},children:e.jsx(He,{size:11})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:6},children:[e.jsx("input",{value:l.motivo||"",onChange:x=>g(y=>y.map(u=>u.id===l.id?{...u,motivo:x.target.value}:u)),placeholder:"Motivo de la visita",style:{...v,fontSize:10}}),e.jsx("input",{value:l.observaciones||"",onChange:x=>g(y=>y.map(u=>u.id===l.id?{...u,observaciones:x.target.value}:u)),placeholder:"Observaciones",style:{...v,fontSize:10}})]})]},l.id)),s.length===0&&e.jsx(Di,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:De.inkLight},children:"Sin visitas programadas"})})]}),t==="encuestas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Encuestas de satisfaccin"}),e.jsxs(ln,{sm:!0,on:()=>b(l=>[...l,{id:Kn(),fecha:ms(),proyecto:"",cliente:"",calificacion:5,comentario:""}]),children:[e.jsx(Oe,{size:10})," Nueva encuesta"]})]}),h.length>0&&e.jsxs(Di,{style:{padding:16,marginBottom:14,textAlign:"center",background:parseFloat(c)>=4?De.greenBg:De.amberBg},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Satisfaccin promedio"}),e.jsxs("div",{style:{fontSize:36,fontWeight:800,color:parseFloat(c)>=4?De.green:De.amber},children:["".repeat(Math.round(parseFloat(c)||0))," ",c,"/5"]}),e.jsxs("div",{style:{fontSize:11,color:De.inkMid},children:[h.length," encuestas realizadas"]})]}),h.sort((l,x)=>x.fecha>l.fecha?1:-1).map(l=>e.jsxs(Di,{style:{padding:14,marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"date",value:l.fecha,onChange:x=>b(y=>y.map(u=>u.id===l.id?{...u,fecha:x.target.value}:u)),style:{border:`1px solid ${De.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:l.proyecto||"",onChange:x=>b(y=>y.map(u=>u.id===l.id?{...u,proyecto:x.target.value}:u)),placeholder:"Proyecto",style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:600}}),e.jsx("input",{value:l.cliente||"",onChange:x=>b(y=>y.map(u=>u.id===l.id?{...u,cliente:x.target.value}:u)),placeholder:"Cliente",style:{width:120,...v,fontSize:10}}),e.jsx("div",{style:{display:"flex",gap:2},children:[1,2,3,4,5].map(x=>e.jsx("button",{onClick:()=>b(y=>y.map(u=>u.id===l.id?{...u,calificacion:x}:u)),style:{background:"none",border:"none",fontSize:18,cursor:"pointer",opacity:x<=l.calificacion?1:.2},children:""},x))}),e.jsx("button",{onClick:()=>b(x=>x.filter(y=>y.id!==l.id)),style:{background:"none",border:"none",color:De.red,cursor:"pointer"},children:e.jsx(He,{size:11})})]}),e.jsx("input",{value:l.comentario||"",onChange:x=>b(y=>y.map(u=>u.id===l.id?{...u,comentario:x.target.value}:u)),placeholder:"Comentarios del cliente...",style:{...v,width:"100%",marginTop:6,fontSize:10}})]},l.id)),h.length===0&&e.jsx(Di,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:De.inkLight},children:"Sin encuestas. Crea la primera."})})]})]})})]})]})]})}const nm=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),we={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},zo=()=>Math.random().toString(36).slice(2,10),Zt=()=>new Date().toISOString().split("T")[0],Ct=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),ji=({children:t,style:i,...o})=>e.jsx("div",{style:{background:we.surface,border:`1px solid ${we.border}`,borderRadius:8,padding:16,boxShadow:we.shadow,...i},...o,children:t}),Bt=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${we.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?we.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),ft=({lbl:t,val:i,on:o,ph:n,type:a,style:r,...s})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),e.jsx("input",{type:a||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${we.border}`,borderRadius:4,fontSize:11,background:"#fff"},...s})]}),qo=({t,s:i})=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700},children:t}),i&&e.jsx("p",{style:{margin:0,fontSize:10,color:we.inkMid},children:i})]}),kn=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),Ui={border:`1px solid ${we.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},gd=[{id:"dashboard",lbl:" Dashboard",icon:Ji},{id:"caja",lbl:" Caja Chica",icon:Sr},{id:"tarjeta",lbl:" Legalizaciones",icon:Qc},{id:"viaticos",lbl:" Viticos",icon:Ao},{id:"flujo",lbl:" Flujo Empresa",icon:Ji},{id:"cxc",lbl:" CxC / CxP",icon:Et}];function rm({data:t,save:i}){var S;const o=t.adm_cajas||[],n=A=>i("adm_cajas",typeof A=="function"?A(o):A),[a,r]=F.useState(((S=o[0])==null?void 0:S.id)||null),[s,g]=F.useState(!1),[h,b]=F.useState(!1),[j,k]=F.useState({nombre:"",fondoInicial:0,responsable:""}),[v,m]=F.useState({fecha:Zt(),tipo:"salida",concepto:"",monto:0,responsable:"",soporte:"",proyecto:""}),f=o.find(A=>A.id===a),p=(f==null?void 0:f.movimientos)||[],d=((f==null?void 0:f.fondoInicial)||0)+p.reduce((A,E)=>A+(E.tipo==="entrada"?E.monto:-E.monto),0),c=()=>{const A={id:zo(),...j,fondoInicial:parseFloat(j.fondoInicial)||0,movimientos:[],estado:"abierta",fechaCreacion:Zt()};n([...o,A]),r(A.id),k({nombre:"",fondoInicial:0,responsable:""}),g(!1)},l=()=>{const A={id:zo(),...v,monto:parseFloat(v.monto)||0};n(o.map(E=>E.id===a?{...E,movimientos:[...E.movimientos,A]}:E)),m({fecha:Zt(),tipo:"salida",concepto:"",monto:0,responsable:"",soporte:"",proyecto:""}),b(!1)},x=A=>n(o.map(E=>E.id===a?{...E,movimientos:E.movimientos.filter(w=>w.id!==A)}:E)),y=()=>n(o.map(A=>A.id===a?{...A,estado:"cerrada",fechaCierre:Zt()}:A)),u=()=>{const A=p.filter(w=>w.tipo==="salida").reduce((w,_)=>w+_.monto,0)-p.filter(w=>w.tipo==="entrada").reduce((w,_)=>w+_.monto,0);if(A<=0)return;const E={id:zo(),fecha:Zt(),tipo:"entrada",concepto:"Reposicin de caja chica",monto:A,responsable:"Admin",soporte:"",proyecto:""};n(o.map(w=>w.id===a?{...w,movimientos:[...w.movimientos,E]}:w))};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:we.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Caja chica"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Control de fondos menores"})]}),e.jsxs(Bt,{on:()=>g(!0),children:[e.jsx(Oe,{size:11})," Nueva caja"]})]}),o.length===0?e.jsx(ji,{style:{textAlign:"center",padding:40,color:we.inkLight},children:'Sin cajas creadas. Pulsa "+ Nueva caja" para empezar.'}):e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx("div",{style:{width:200,flexShrink:0},children:o.map(A=>{const E=(A.fondoInicial||0)+(A.movimientos||[]).reduce((w,_)=>w+(_.tipo==="entrada"?_.monto:-_.monto),0);return e.jsxs(ji,{onClick:()=>r(A.id),style:{padding:"10px 12px",marginBottom:6,cursor:"pointer",border:a===A.id?`2px solid ${we.green}`:`1px solid ${we.border}`},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:A.nombre}),e.jsx("div",{style:{fontSize:9,color:we.inkMid},children:A.responsable}),e.jsxs("div",{style:{fontSize:14,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E>=0?we.green:we.red,marginTop:4},children:["$",Ct(E)]}),e.jsx(kn,{color:A.estado==="abierta"?we.green:we.red,children:A.estado==="abierta"?"Abierta":"Cerrada"})]},A.id)})}),f&&e.jsxs(ji,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#EDEBE7",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:f.nombre}),e.jsxs("div",{style:{fontSize:9,color:we.inkMid},children:["Fondo: $",Ct(f.fondoInicial),"  Responsable: ",f.responsable]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Saldo actual"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:d>=0?we.green:we.red},children:["$",Ct(d)]})]})]}),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${we.border}`,display:"flex",gap:6},children:[f.estado==="abierta"&&e.jsxs(e.Fragment,{children:[e.jsxs(Bt,{on:()=>b(!0),children:[e.jsx(Oe,{size:10})," Movimiento"]}),e.jsx(Bt,{v:"sec",on:u,children:" Reponer"}),e.jsx(Bt,{v:"sec",on:y,children:" Cerrar caja"})]}),f.estado==="cerrada"&&e.jsxs(kn,{color:we.red,children:["Caja cerrada el ",f.fechaCierre]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Tipo","Concepto","Proyecto","Responsable","Soporte","Monto",""].map(A=>e.jsx("th",{style:{padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`1px solid ${we.border}`,textAlign:A==="Monto"?"right":"left"},children:A},A))})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:20,textAlign:"center",color:we.inkLight,fontSize:11},children:"Sin movimientos"})}):p.map((A,E)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${we.border}`,background:E%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"5px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:A.fecha}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx(kn,{color:A.tipo==="entrada"?we.green:we.red,children:A.tipo==="entrada"?" Entrada":" Salida"})}),e.jsx("td",{style:{padding:"5px 8px",fontSize:10,fontWeight:500},children:A.concepto}),e.jsx("td",{style:{padding:"5px 8px",fontSize:9,color:we.inkMid},children:A.proyecto||""}),e.jsx("td",{style:{padding:"5px 8px",fontSize:9,color:we.inkMid},children:A.responsable}),e.jsx("td",{style:{padding:"5px 8px",fontSize:8,color:we.blue},children:A.soporte||""}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:A.tipo==="entrada"?we.green:we.red},children:[A.tipo==="entrada"?"+":"","$",Ct(A.monto)]}),e.jsx("td",{style:{padding:"3px 4px"},children:f.estado==="abierta"&&e.jsx("button",{onClick:()=>x(A.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},A.id))})]})})]})]}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>g(!1),children:e.jsxs("div",{onClick:A=>A.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:400,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(qo,{t:"Nueva caja chica",s:"Fondo rotatorio para gastos menores"}),e.jsx(ft,{lbl:"Nombre",val:j.nombre,on:A=>k({...j,nombre:A.target.value}),ph:"Caja obra Chic"}),e.jsx(ft,{lbl:"Fondo inicial",val:j.fondoInicial,on:A=>k({...j,fondoInicial:A.target.value}),type:"number",ph:"500000"}),e.jsx(ft,{lbl:"Responsable",val:j.responsable,on:A=>k({...j,responsable:A.target.value}),ph:"Almacenista"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(Bt,{on:c,style:{flex:1},children:[e.jsx(xt,{size:11})," Crear"]}),e.jsx(Bt,{v:"sec",on:()=>g(!1),style:{flex:1},children:"Cancelar"})]})]})}),h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:A=>A.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(qo,{t:"Nuevo movimiento",s:f==null?void 0:f.nombre}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsx(ft,{lbl:"Fecha",val:v.fecha,on:A=>m({...v,fecha:A.target.value}),type:"date",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Tipo"}),e.jsxs("select",{value:v.tipo,onChange:A=>m({...v,tipo:A.target.value}),style:{...Ui,width:"100%"},children:[e.jsx("option",{value:"salida",children:" Salida"}),e.jsx("option",{value:"entrada",children:" Entrada"})]})]})]}),e.jsx(ft,{lbl:"Concepto",val:v.concepto,on:A=>m({...v,concepto:A.target.value}),ph:"Taxi obra, material menor..."}),e.jsx(ft,{lbl:"Monto",val:v.monto,on:A=>m({...v,monto:A.target.value}),type:"number",ph:"25000"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Proyecto",val:v.proyecto,on:A=>m({...v,proyecto:A.target.value}),ph:"Chic 94",style:{flex:1}}),e.jsx(ft,{lbl:"Responsable",val:v.responsable,on:A=>m({...v,responsable:A.target.value}),ph:"Quien gasta",style:{flex:1}})]}),e.jsx(ft,{lbl:"Soporte / factura",val:v.soporte,on:A=>m({...v,soporte:A.target.value}),ph:"Ref. factura o soporte"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(Bt,{on:l,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar"]}),e.jsx(Bt,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function am({data:t,save:i}){const o=t.adm_tarjeta||[],n=c=>i("adm_tarjeta",typeof c=="function"?c(o):c),[a,r]=F.useState(!1),[s,g]=F.useState("todos"),[h,b]=F.useState({fecha:Zt(),concepto:"",monto:0,tarjeta:"Corp. Visa",proyecto:"",centroCosto:"",factura:"",correoRef:"",estado:"pendiente"}),j=()=>{n([...o,{id:zo(),...h,monto:parseFloat(h.monto)||0}]),b({fecha:Zt(),concepto:"",monto:0,tarjeta:"Corp. Visa",proyecto:"",centroCosto:"",factura:"",correoRef:"",estado:"pendiente"}),r(!1)},k=(c,l,x)=>n(o.map(y=>y.id===c?{...y,[l]:x}:y)),v=c=>n(o.filter(l=>l.id!==c)),m=s==="todos"?o:o.filter(c=>c.estado===s),f=o.filter(c=>c.estado==="pendiente"),p=f.reduce((c,l)=>c+l.monto,0),d={pendiente:{lbl:"Pendiente",color:we.amber},legalizado:{lbl:"Legalizado",color:we.blue},aprobado:{lbl:"Aprobado",color:we.green},rechazado:{lbl:"Rechazado",color:we.red}};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:we.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Tarjeta corporativa"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Legalizaciones  ",f.length," pendientes  $",Ct(p)]})]}),e.jsxs(Bt,{on:()=>r(!0),children:[e.jsx(Oe,{size:11})," Nuevo movimiento"]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:[["todos","Todos"],["pendiente","Pendientes"],["legalizado","Legalizados"],["aprobado","Aprobados"],["rechazado","Rechazados"]].map(([c,l],x,y)=>e.jsxs("button",{onClick:()=>g(c),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${we.border}`,borderLeft:x>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:x===0?"5px 0 0 5px":x===y.length-1?"0 5px 5px 0":"0",background:s===c?"#111":"#fff",color:s===c?"#fff":we.inkMid},children:[l," ",c!=="todos"&&e.jsxs("span",{style:{marginLeft:3,fontSize:8},children:["(",o.filter(u=>c==="todos"||u.estado===c).length,")"]})]},c))}),e.jsx(ji,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Tarjeta","Concepto","Proyecto","Centro costo","Factura","Correo ref.","Monto","Estado",""].map(c=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${we.border}`,textAlign:c==="Monto"?"right":"left"},children:c},c))})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:24,textAlign:"center",color:we.inkLight,fontSize:11},children:"Sin movimientos"})}):m.map((c,l)=>{var x,y;return e.jsxs("tr",{style:{borderBottom:`1px solid ${we.border}`,background:l%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:c.fecha}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9},children:c.tarjeta}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:500},children:c.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:we.inkMid},children:c.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:we.inkMid},children:c.centroCosto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:we.blue},children:c.factura||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:we.inkMid},children:c.correoRef||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11},children:["$",Ct(c.monto)]}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("select",{value:c.estado,onChange:u=>k(c.id,"estado",u.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:((x=d[c.estado])==null?void 0:x.color)+"22",color:(y=d[c.estado])==null?void 0:y.color},children:Object.entries(d).map(([u,S])=>e.jsx("option",{value:u,children:S.lbl},u))})}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>v(c.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},c.id)})})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:c=>c.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(qo,{t:"Nuevo movimiento tarjeta",s:"Registrar gasto para legalizar"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Fecha",val:h.fecha,on:c=>b({...h,fecha:c.target.value}),type:"date",style:{flex:1}}),e.jsx(ft,{lbl:"Tarjeta",val:h.tarjeta,on:c=>b({...h,tarjeta:c.target.value}),ph:"Corp. Visa",style:{flex:1}})]}),e.jsx(ft,{lbl:"Concepto",val:h.concepto,on:c=>b({...h,concepto:c.target.value}),ph:"Almuerzo equipo, materiales..."}),e.jsx(ft,{lbl:"Monto",val:h.monto,on:c=>b({...h,monto:c.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Proyecto",val:h.proyecto,on:c=>b({...h,proyecto:c.target.value}),ph:"Opcional",style:{flex:1}}),e.jsx(ft,{lbl:"Centro de costo",val:h.centroCosto,on:c=>b({...h,centroCosto:c.target.value}),ph:"Admin, Obra...",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Ref. factura",val:h.factura,on:c=>b({...h,factura:c.target.value}),ph:"FV-001234",style:{flex:1}}),e.jsx(ft,{lbl:"Correo referencia",val:h.correoRef,on:c=>b({...h,correoRef:c.target.value}),ph:"Asunto email",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(Bt,{on:j,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar"]}),e.jsx(Bt,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function sm({data:t,save:i}){const o=t.adm_viaticos||[],n=E=>i("adm_viaticos",typeof E=="function"?E(o):E),[a,r]=F.useState(!1),[s,g]=F.useState(null),[h,b]=F.useState(!1),[j,k]=F.useState({solicitante:"",destino:"",dias:1,concepto:"",fecha:Zt(),fechaRegreso:""}),[v,m]=F.useState({fecha:Zt(),concepto:"",monto:0,soporte:""}),f=[{id:"vuelo_ida",lbl:" Vuelo ida",icon:""},{id:"vuelo_vuelta",lbl:" Vuelo vuelta",icon:""},{id:"hotel",lbl:" Hotel",icon:""},{id:"transporte",lbl:" Transporte terrestre",icon:""},{id:"alimentacion",lbl:" Alimentacin",icon:""},{id:"otros",lbl:" Otros",icon:""}],p=o.find(E=>E.id===s),d={solicitado:{lbl:"Solicitado",color:we.amber},aprobado:{lbl:"Aprobado",color:we.blue},entregado:{lbl:"Anticipo entregado",color:"#5B3A8C"},legalizado:{lbl:"Legalizado",color:we.green},rechazado:{lbl:"Rechazado",color:we.red}},c=E=>{const w=E.itemsViaje||{},_=f.reduce((L,Z)=>{var K;return L+(parseFloat((K=w[Z.id])==null?void 0:K.estimado)||0)},0),z=f.reduce((L,Z)=>{var K;return L+(parseFloat((K=w[Z.id])==null?void 0:K.real)||0)},0),T=(E.gastos||[]).reduce((L,Z)=>L+Z.monto,0);return{estimado:_,real:z,gastosExtra:T,totalReal:z+T}},l=()=>{const E={};f.forEach(_=>{E[_.id]={estimado:0,real:0,detalle:""}});const w={id:zo(),...j,dias:parseInt(j.dias)||1,estado:"solicitado",gastos:[],anticipoEntregado:0,itemsViaje:E};n([...o,w]),g(w.id),k({solicitante:"",destino:"",dias:1,concepto:"",fecha:Zt(),fechaRegreso:""}),r(!1)},x=(E,w,_)=>n(o.map(z=>z.id===E?{...z,[w]:_}:z)),y=(E,w,_,z)=>{n(o.map(T=>{if(T.id!==E)return T;const L={...T.itemsViaje||{}};return L[w]={...L[w]||{estimado:0,real:0,detalle:""},[_]:z},{...T,itemsViaje:L}}))},u=()=>{const E={id:zo(),...v,monto:parseFloat(v.monto)||0};n(o.map(w=>w.id===s?{...w,gastos:[...w.gastos,E]}:w)),m({fecha:Zt(),concepto:"",monto:0,soporte:""}),b(!1)},S=E=>n(o.map(w=>w.id===s?{...w,gastos:w.gastos.filter(_=>_.id!==E)}:w)),A=E=>{n(o.filter(w=>w.id!==E)),s===E&&g(null)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:we.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Viticos"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Solicitudes, anticipos y legalizaciones"})]}),e.jsxs(Bt,{on:()=>r(!0),children:[e.jsx(Oe,{size:11})," Nueva solicitud"]})]}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx("div",{style:{width:280,flexShrink:0},children:o.length===0?e.jsx(ji,{style:{textAlign:"center",padding:20,color:we.inkLight,fontSize:11},children:"Sin solicitudes"}):o.map(E=>{var z,T;const w=c(E),_=(E.anticipoEntregado||0)-w.totalReal;return e.jsxs(ji,{onClick:()=>g(E.id),style:{padding:"10px 12px",marginBottom:6,cursor:"pointer",border:s===E.id?`2px solid ${we.green}`:`1px solid ${we.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:E.solicitante}),e.jsx(kn,{color:((z=d[E.estado])==null?void 0:z.color)||we.amber,children:((T=d[E.estado])==null?void 0:T.lbl)||E.estado})]}),e.jsxs("div",{style:{fontSize:9,color:we.inkMid},children:[E.destino,"  ",E.dias," das  ",E.fecha]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:4,fontSize:8},children:[e.jsxs("span",{children:["Est: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",Ct(w.estimado)]})]}),e.jsxs("span",{children:["Real: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",Ct(w.totalReal)]})]}),e.jsxs("span",{style:{color:_>=0?we.green:we.red},children:[_>=0?"Sobra":"Debe",": ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",Ct(Math.abs(_))]})]})]})]},E.id)})}),p?e.jsxs(ji,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#EDEBE7",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700},children:[p.solicitante,"  ",p.destino]}),e.jsxs("div",{style:{fontSize:9,color:we.inkMid},children:[p.concepto,"  ",p.dias," das  ",p.fecha,p.fechaRegreso?`  ${p.fechaRegreso}`:""]})]}),e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[e.jsx("select",{value:p.estado,onChange:E=>x(p.id,"estado",E.target.value),style:{...Ui,fontSize:9,fontWeight:600},children:Object.entries(d).map(([E,w])=>e.jsx("option",{value:E,children:w.lbl},E))}),e.jsx("button",{onClick:()=>A(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},title:"Eliminar",children:e.jsx(He,{size:12})})]})]}),(()=>{const E=c(p),w=(p.anticipoEntregado||0)-E.totalReal;return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6,padding:"10px 16px",borderBottom:`1px solid ${we.border}`},children:[["Estimado",Ct(E.estimado),we.ink],["Anticipo",Ct(p.anticipoEntregado||0),we.blue],["Real tems",Ct(E.real),"#5B3A8C"],["Otros gastos",Ct(E.gastosExtra),we.red],[w>=0?"Saldo a favor":"Saldo a deber",Ct(Math.abs(w)),w>=0?we.green:we.red]].map(([_,z,T])=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:_}),e.jsxs("div",{style:{fontSize:13,fontWeight:800,fontFamily:"'DM Mono',monospace",color:T},children:["$",z]})]},_))})})(),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${we.border}`,display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:9,fontWeight:600,color:we.inkMid},children:"Anticipo entregado:"}),e.jsx("input",{type:"number",value:p.anticipoEntregado||"",placeholder:"0",onChange:E=>x(p.id,"anticipoEntregado",parseFloat(E.target.value)||0),style:{...Ui,width:130,fontFamily:"'DM Mono',monospace",fontWeight:700}})]}),e.jsxs("div",{style:{padding:"10px 16px",borderBottom:`1px solid ${we.border}`},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:8},children:"Desglose del viaje  Estimado vs Real"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${we.border}`,width:"30%"},children:"TEM"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${we.border}`,width:"25%"},children:"DETALLE"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:we.blue,textAlign:"right",borderBottom:`1px solid ${we.border}`,width:"18%"},children:"ESTIMADO"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#5B3A8C",textAlign:"right",borderBottom:`1px solid ${we.border}`,width:"18%"},children:"REAL"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right",borderBottom:`1px solid ${we.border}`,width:"9%"},children:"DIF."})]})}),e.jsxs("tbody",{children:[f.map((E,w)=>{const _=(p.itemsViaje||{})[E.id]||{estimado:0,real:0,detalle:""},z=parseFloat(_.estimado)||0,L=(parseFloat(_.real)||0)-z;return e.jsxs("tr",{style:{borderBottom:`1px solid ${we.border}`,background:w%2?"#FFFFFF":"#fff"},children:[e.jsxs("td",{style:{padding:"5px 8px",fontSize:10,fontWeight:600},children:[E.icon," ",E.lbl.replace(/^[^\s]+ /,"")]}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"text",value:_.detalle||"",placeholder:"Aerolnea, hotel...",onChange:Z=>y(p.id,E.id,"detalle",Z.target.value),style:{...Ui,width:"100%",fontSize:9,padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"number",value:_.estimado||"",placeholder:"0",onChange:Z=>y(p.id,E.id,"estimado",Z.target.value),style:{...Ui,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:we.blue,padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"number",value:_.real||"",placeholder:"0",onChange:Z=>y(p.id,E.id,"real",Z.target.value),style:{...Ui,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:700,color:L===0?we.inkLight:L>0?we.red:we.green},children:L===0?"":L>0?`+${Ct(L)}`:`${Ct(Math.abs(L))}`})]},E.id)}),(()=>{const E=c(p),w=E.real-E.estimado;return e.jsxs("tr",{style:{borderTop:`2px solid ${we.ink}`,background:"#EDEBE7"},children:[e.jsx("td",{colSpan:2,style:{padding:"5px 8px",fontSize:10,fontWeight:800},children:"TOTAL TEMS"}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:we.blue},children:["$",Ct(E.estimado)]}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:"#5B3A8C"},children:["$",Ct(E.real)]}),e.jsx("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:700,color:w===0?we.inkLight:w>0?we.red:we.green},children:w===0?"":w>0?`+${Ct(w)}`:`${Ct(Math.abs(w))}`})]})})()]})]})]}),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${we.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Otros gastos (no previstos)"}),e.jsxs(Bt,{on:()=>b(!0),style:{padding:"4px 10px",fontSize:9},children:[e.jsx(Oe,{size:9})," Gasto"]})]}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Concepto","Soporte","Monto",""].map(E=>e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`1px solid ${we.border}`,textAlign:E==="Monto"?"right":"left"},children:E},E))})}),e.jsx("tbody",{children:(p.gastos||[]).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{padding:12,textAlign:"center",color:we.inkLight,fontSize:9},children:"Sin gastos adicionales"})}):(p.gastos||[]).map((E,w)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${we.border}`,background:w%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:E.fecha}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10},children:E.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:we.blue},children:E.soporte||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:we.red},children:["$",Ct(E.monto)]}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>S(E.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},E.id))})]})]}):e.jsx(ji,{style:{flex:1,textAlign:"center",padding:40,color:we.inkLight},children:"Selecciona una solicitud"})]}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:E=>E.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:440,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(qo,{t:"Nueva solicitud de viticos",s:"Se crear con desglose de tems para estimar costos"}),e.jsx(ft,{lbl:"Solicitante",val:j.solicitante,on:E=>k({...j,solicitante:E.target.value}),ph:"Nombre completo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Destino",val:j.destino,on:E=>k({...j,destino:E.target.value}),ph:"Ciudad / lugar",style:{flex:1}}),e.jsx(ft,{lbl:"Das",val:j.dias,on:E=>k({...j,dias:E.target.value}),type:"number",style:{flex:"0 0 65px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Fecha ida",val:j.fecha,on:E=>k({...j,fecha:E.target.value}),type:"date",style:{flex:1}}),e.jsx(ft,{lbl:"Fecha regreso",val:j.fechaRegreso,on:E=>k({...j,fechaRegreso:E.target.value}),type:"date",style:{flex:1}})]}),e.jsx(ft,{lbl:"Concepto / motivo",val:j.concepto,on:E=>k({...j,concepto:E.target.value}),ph:"Visita obra, capacitacin, reunin cliente..."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(Bt,{on:l,style:{flex:1},children:[e.jsx(xt,{size:11})," Crear solicitud"]}),e.jsx(Bt,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})}),h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:E=>E.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:380,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(qo,{t:"Gasto adicional",s:(p==null?void 0:p.solicitante)+"  "+(p==null?void 0:p.destino)}),e.jsx(ft,{lbl:"Fecha",val:v.fecha,on:E=>m({...v,fecha:E.target.value}),type:"date"}),e.jsx(ft,{lbl:"Concepto",val:v.concepto,on:E=>m({...v,concepto:E.target.value}),ph:"Imprevisto, taxi extra..."}),e.jsx(ft,{lbl:"Monto",val:v.monto,on:E=>m({...v,monto:E.target.value}),type:"number"}),e.jsx(ft,{lbl:"Soporte",val:v.soporte,on:E=>m({...v,soporte:E.target.value}),ph:"Ref. factura"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(Bt,{on:u,style:{flex:1},children:[e.jsx(xt,{size:11})," Aadir"]}),e.jsx(Bt,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function lm({data:t,save:i}){const o=t.adm_flujo||[],n=u=>i("adm_flujo",typeof u=="function"?u(o):u),[a,r]=F.useState(!1),[s,g]=F.useState(()=>{const u=new Date;return`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`}),[h,b]=F.useState({fecha:Zt(),tipo:"ingreso",categoria:"",concepto:"",monto:0,proyecto:"",factura:"",estado:"realizado"}),j=["Cobro proyecto","Anticipo cliente","Reembolso","Otro ingreso"],k=["Nmina","Proveedores","Arriendo","Servicios","Impuestos","Seguros","Transporte","Materiales","Otro egreso"],v=()=>{n([...o,{id:zo(),...h,monto:parseFloat(h.monto)||0}]),b({fecha:Zt(),tipo:"ingreso",categoria:"",concepto:"",monto:0,proyecto:"",factura:"",estado:"realizado"}),r(!1)},m=u=>n(o.filter(S=>S.id!==u)),f=o.filter(u=>{var S;return(S=u.fecha)==null?void 0:S.startsWith(s)}),p=f.filter(u=>u.tipo==="ingreso").reduce((u,S)=>u+S.monto,0),d=f.filter(u=>u.tipo==="egreso").reduce((u,S)=>u+S.monto,0),l=o.filter(u=>u.fecha<=s+"-31"&&u.estado==="realizado").reduce((u,S)=>u+(S.tipo==="ingreso"?S.monto:-S.monto),0),x=f.filter(u=>u.estado==="proyectado");x.filter(u=>u.tipo==="ingreso").reduce((u,S)=>u+S.monto,0),x.filter(u=>u.tipo==="egreso").reduce((u,S)=>u+S.monto,0);const y=[...new Set(o.map(u=>{var S;return(S=u.fecha)==null?void 0:S.slice(0,7)}).filter(Boolean))].sort();return y.includes(s)||y.push(s),y.sort(),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:we.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Flujo de caja empresa"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Ingresos, egresos y proyeccin"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:s,onChange:u=>g(u.target.value),style:{...Ui,fontWeight:600},children:y.map(u=>e.jsx("option",{value:u,children:u},u))}),e.jsxs(Bt,{on:()=>r(!0),children:[e.jsx(Oe,{size:11})," Movimiento"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[["Ingresos mes",Ct(p),we.green,""],["Egresos mes",Ct(d),we.red,""],["Neto mes",Ct(p-d),p-d>=0?we.green:we.red,""],["Saldo acumulado",Ct(l),l>=0?we.green:we.red,""]].map(([u,S,A,E])=>e.jsxs(ji,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:[E," ",u]}),e.jsxs("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:A,marginTop:2},children:["$",S]})]},u))}),l<0&&e.jsxs("div",{style:{background:we.redBg,border:`1px solid ${we.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(li,{size:14,color:we.red}),e.jsx("div",{style:{fontSize:10,color:we.red,fontWeight:600},children:" Saldo acumulado negativo. Revisa cobros pendientes o reduce egresos."})]}),e.jsx(ji,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Tipo","Categora","Concepto","Proyecto","Factura","Estado","Monto",""].map(u=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${we.border}`,textAlign:u==="Monto"?"right":"left"},children:u},u))})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:we.inkLight,fontSize:11},children:["Sin movimientos en ",s]})}):f.sort((u,S)=>u.fecha.localeCompare(S.fecha)).map((u,S)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${we.border}`,background:S%2?"#FFFFFF":"#fff",opacity:u.estado==="proyectado"?.6:1},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:u.fecha}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx(kn,{color:u.tipo==="ingreso"?we.green:we.red,children:u.tipo==="ingreso"?" Ingreso":" Egreso"})}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:we.inkMid},children:u.categoria||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:500},children:u.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:we.inkMid},children:u.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:we.blue},children:u.factura||""}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx(kn,{color:u.estado==="realizado"?we.green:we.amber,children:u.estado==="realizado"?"Realizado":"Proyectado"})}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:u.tipo==="ingreso"?we.green:we.red},children:[u.tipo==="ingreso"?"+":"","$",Ct(u.monto)]}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>m(u.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},u.id))})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:u=>u.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(qo,{t:"Nuevo movimiento",s:"Ingreso o egreso de la empresa"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Fecha",val:h.fecha,on:u=>b({...h,fecha:u.target.value}),type:"date",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Tipo"}),e.jsxs("select",{value:h.tipo,onChange:u=>b({...h,tipo:u.target.value,categoria:""}),style:{...Ui,width:"100%"},children:[e.jsx("option",{value:"ingreso",children:" Ingreso"}),e.jsx("option",{value:"egreso",children:" Egreso"})]})]}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Estado"}),e.jsxs("select",{value:h.estado,onChange:u=>b({...h,estado:u.target.value}),style:{...Ui,width:"100%"},children:[e.jsx("option",{value:"realizado",children:"Realizado"}),e.jsx("option",{value:"proyectado",children:"Proyectado"})]})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Categora"}),e.jsxs("select",{value:h.categoria,onChange:u=>b({...h,categoria:u.target.value}),style:{...Ui,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),(h.tipo==="ingreso"?j:k).map(u=>e.jsx("option",{children:u},u))]})]}),e.jsx(ft,{lbl:"Concepto",val:h.concepto,on:u=>b({...h,concepto:u.target.value}),ph:"Descripcin"}),e.jsx(ft,{lbl:"Monto",val:h.monto,on:u=>b({...h,monto:u.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Proyecto",val:h.proyecto,on:u=>b({...h,proyecto:u.target.value}),ph:"Opcional",style:{flex:1}}),e.jsx(ft,{lbl:"Factura",val:h.factura,on:u=>b({...h,factura:u.target.value}),ph:"FV-001234",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(Bt,{on:v,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar"]}),e.jsx(Bt,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function dm({data:t,save:i}){const o=t.adm_cuentas||[],n=l=>i("adm_cuentas",typeof l=="function"?l(o):l),[a,r]=F.useState("cobrar"),[s,g]=F.useState(!1),[h,b]=F.useState({tipo:"cobrar",tercero:"",concepto:"",monto:0,fechaEmision:Zt(),fechaVence:"",factura:"",proyecto:"",estado:"vigente"}),j=o.filter(l=>l.tipo===a),k=j.filter(l=>l.estado==="vigente").reduce((l,x)=>l+x.monto,0),v=j.filter(l=>l.estado==="vencida").reduce((l,x)=>l+x.monto,0),m=j.filter(l=>l.estado==="pagada").reduce((l,x)=>l+x.monto,0),f=()=>{n([...o,{id:zo(),...h,tipo:a,monto:parseFloat(h.monto)||0}]),b({tipo:a,tercero:"",concepto:"",monto:0,fechaEmision:Zt(),fechaVence:"",factura:"",proyecto:"",estado:"vigente"}),g(!1)},p=(l,x,y)=>n(o.map(u=>u.id===l?{...u,[x]:y}:u)),d=l=>n(o.filter(x=>x.id!==l));F.useEffect(()=>{const l=Zt(),x=o.map(y=>y.estado==="vigente"&&y.fechaVence&&y.fechaVence<l?{...y,estado:"vencida"}:y);JSON.stringify(x)!==JSON.stringify(o)&&n(x)},[]);const c={vigente:{lbl:"Vigente",color:we.blue},vencida:{lbl:"Vencida",color:we.red},pagada:{lbl:a==="cobrar"?"Cobrada":"Pagada",color:we.green},parcial:{lbl:"Parcial",color:we.amber}};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{margin:0,fontSize:10,color:we.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:["Cuentas por ",a==="cobrar"?"cobrar":"pagar"]}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:a==="cobrar"?"Lo que nos deben":"Lo que debemos"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["cobrar"," Por cobrar"],["pagar"," Por pagar"]].map(([l,x],y)=>e.jsx("button",{onClick:()=>r(l),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${we.border}`,borderLeft:y>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:y===0?"5px 0 0 5px":"0 5px 5px 0",background:a===l?"#111":"#fff",color:a===l?"#fff":we.inkMid},children:x},l))}),e.jsxs(Bt,{on:()=>g(!0),children:[e.jsx(Oe,{size:11})," Nueva cuenta"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12,marginBottom:16},children:[["Vigentes",Ct(k),we.blue],["Vencidas",Ct(v),we.red],[a==="cobrar"?"Cobradas":"Pagadas",Ct(m),we.green]].map(([l,x,y])=>e.jsxs(ji,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:l}),e.jsxs("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y,marginTop:2},children:["$",x]})]},l))}),v>0&&e.jsxs("div",{style:{background:we.redBg,border:`1px solid ${we.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(li,{size:14,color:we.red}),e.jsxs("div",{style:{fontSize:10,color:we.red,fontWeight:600},children:[j.filter(l=>l.estado==="vencida").length," ",a==="cobrar"?"facturas por cobrar":"facturas por pagar"," vencidas por $",Ct(v)]})]}),e.jsx(ji,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Factura","Tercero","Concepto","Proyecto","Emitida","Vence","Monto","Estado",""].map(l=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${we.border}`,textAlign:l==="Monto"?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:we.inkLight,fontSize:11},children:"Sin cuentas registradas"})}):j.sort((l,x)=>(l.fechaVence||"").localeCompare(x.fechaVence||"")).map((l,x)=>{var y,u;return e.jsxs("tr",{style:{borderBottom:`1px solid ${we.border}`,background:l.estado==="vencida"?"#FAE8E844":x%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l.factura||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:600},children:l.tercero}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10},children:l.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:we.inkMid},children:l.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,fontFamily:"'DM Mono',monospace"},children:l.fechaEmision}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,fontFamily:"'DM Mono',monospace",color:l.estado==="vencida"?we.red:we.ink,fontWeight:l.estado==="vencida"?700:400},children:l.fechaVence||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11},children:["$",Ct(l.monto)]}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("select",{value:l.estado,onChange:S=>p(l.id,"estado",S.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:((y=c[l.estado])==null?void 0:y.color)+"22",color:(u=c[l.estado])==null?void 0:u.color},children:Object.entries(c).map(([S,A])=>e.jsx("option",{value:S,children:A.lbl},S))})}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>d(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},l.id)})})]})}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>g(!1),children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(qo,{t:`Nueva cuenta por ${a}`,s:a==="cobrar"?"Factura emitida a cliente":"Factura recibida de proveedor"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Tercero",val:h.tercero,on:l=>b({...h,tercero:l.target.value}),ph:a==="cobrar"?"Cliente":"Proveedor",style:{flex:1}}),e.jsx(ft,{lbl:"Nro. factura",val:h.factura,on:l=>b({...h,factura:l.target.value}),ph:"FV-001234",style:{flex:1}})]}),e.jsx(ft,{lbl:"Concepto",val:h.concepto,on:l=>b({...h,concepto:l.target.value}),ph:"Anticipo 30%, Acta parcial..."}),e.jsx(ft,{lbl:"Monto",val:h.monto,on:l=>b({...h,monto:l.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ft,{lbl:"Fecha emisin",val:h.fechaEmision,on:l=>b({...h,fechaEmision:l.target.value}),type:"date",style:{flex:1}}),e.jsx(ft,{lbl:"Fecha vencimiento",val:h.fechaVence,on:l=>b({...h,fechaVence:l.target.value}),type:"date",style:{flex:1}})]}),e.jsx(ft,{lbl:"Proyecto",val:h.proyecto,on:l=>b({...h,proyecto:l.target.value}),ph:"Opcional"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(Bt,{on:f,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar"]}),e.jsx(Bt,{v:"sec",on:()=>g(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function cm(){const t="habitaris_admin",[i,o]=F.useState({});F.useEffect(()=>{Ee.get(t).then(S=>{try{S&&o(JSON.parse(S))}catch{}}).catch(()=>{})},[]);const n=(S,A)=>o(E=>{const w={...E,[S]:A};return Ee.set(t,JSON.stringify(w)),w}),[a,r]=F.useState("dashboard"),s=i.adm_cajas||[],g=i.adm_tarjeta||[],h=i.adm_viaticos||[],b=i.adm_flujo||[],j=i.adm_cuentas||[],k=s.reduce((S,A)=>{const E=A.movimientos||[];return S+(A.fondoInicial||0)+E.reduce((w,_)=>w+(_.tipo==="entrada"?_.monto:-_.monto),0)},0),v=g.filter(S=>S.estado==="pendiente"),m=h.filter(S=>S.estado==="solicitado"||S.estado==="aprobado"),p=new Date().toISOString().split("T")[0].slice(0,7),d=b.filter(S=>{var A;return(A=S.fecha)==null?void 0:A.startsWith(p)}),c=d.filter(S=>S.tipo==="ingreso").reduce((S,A)=>S+A.monto,0),l=d.filter(S=>S.tipo==="egreso").reduce((S,A)=>S+A.monto,0),x=j.filter(S=>S.tipo==="cobrar"&&S.estado==="vencida").reduce((S,A)=>S+A.monto,0),y=j.filter(S=>S.tipo==="pagar"&&S.estado==="vencida").reduce((S,A)=>S+A.monto,0),u=S=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(S||0);return e.jsxs(e.Fragment,{children:[e.jsx(nm,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Administracin"}),e.jsx("div",{style:{fontSize:10,color:we.inkMid},children:"Caja chica  Tarjeta  Viticos  Flujo empresa  CxC / CxP"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:gd.map((S,A)=>e.jsx("button",{onClick:()=>r(S.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${we.border}`,borderLeft:A>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:A===0?"6px 0 0 6px":A===gd.length-1?"0 6px 6px 0":"0",background:a===S.id?"#111":"#fff",color:a===S.id?"#fff":we.inkMid,borderBottom:a===S.id?"2px solid #fff":`1px solid ${we.border}`},children:S.lbl},S.id))}),a==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Saldo cajas","$"+u(k),k>=0?"#111111":"#B91C1C"],[" Legaliz. pend.",v.length,v.length>0?"#8C6A00":"#111111"],[" Viticos pend.",m.length,m.length>0?"#8C6A00":"#111111"],[" Flujo neto mes","$"+u(c-l),c-l>=0?"#111111":"#B91C1C"]].map(([S,A,E])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${we.border}`,borderRadius:8,padding:"14px 16px",boxShadow:we.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:S}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E},children:A})]},S))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Ingresos mes","$"+u(c),"#111111"],[" Egresos mes","$"+u(l),"#B91C1C"],[" CxC vencidas","$"+u(x),x>0?"#B91C1C":"#111111"],[" CxP vencidas","$"+u(y),y>0?"#B91C1C":"#111111"]].map(([S,A,E])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${we.border}`,borderRadius:8,padding:"14px 16px",boxShadow:we.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:S}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E},children:A})]},S))}),(x>0||y>0||v.length>0)&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" ",[x>0&&`CxC vencidas $${u(x)}`,y>0&&`CxP vencidas $${u(y)}`,v.length>0&&`${v.length} legalizaciones pendientes`].filter(Boolean).join("  ")]})]}),a==="caja"&&e.jsx(rm,{data:i,save:n}),a==="tarjeta"&&e.jsx(am,{data:i,save:n}),a==="viaticos"&&e.jsx(sm,{data:i,save:n}),a==="flujo"&&e.jsx(lm,{data:i,save:n}),a==="cxc"&&e.jsx(dm,{data:i,save:n})]})]})}const pm=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),qe={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},zr=()=>Math.random().toString(36).slice(2,10),Hi=()=>new Date().toISOString().split("T")[0],Ot=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),ga=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:1}).format(t||0),Gi=({children:t,style:i,...o})=>e.jsx("div",{style:{background:qe.surface,border:`1px solid ${qe.border}`,borderRadius:8,padding:16,boxShadow:qe.shadow,...i},...o,children:t}),ii=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${qe.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?qe.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),ct=({lbl:t,val:i,on:o,ph:n,type:a,style:r,children:s,...g})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),s||e.jsx("input",{type:a||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${qe.border}`,borderRadius:4,fontSize:11,background:"#fff"},...g})]}),ua=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),Si={border:`1px solid ${qe.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},Wi={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${qe.border}`,textAlign:"left"},nt={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${qe.border}`},ud="habitaris_flotas",hd=[{id:"dashboard",lbl:" Dashboard"},{id:"vehiculos",lbl:" Vehculos"},{id:"km",lbl:" Partes KM"},{id:"combustible",lbl:" Combustible"},{id:"docs",lbl:" Documentacin"},{id:"manto",lbl:" Mantenimiento"}],gm=["Camioneta","Camin","Volqueta","Furgn","Automvil","Motocicleta","Maquinaria","Otro"],bs={activo:{lbl:"Activo",c:qe.green},taller:{lbl:"En taller",c:qe.amber},inactivo:{lbl:"Inactivo",c:qe.red}};function um({vehs:t,setVehs:i}){const[o,n]=F.useState(!1),[a,r]=F.useState(null),[s,g]=F.useState(""),[h,b]=F.useState({placa:"",marca:"",modelo:"",anio:new Date().getFullYear(),tipo:"Camioneta",conductor:"",proyecto:"",kmActual:0,estado:"activo",color:"",vin:"",observaciones:""}),j=()=>b({placa:"",marca:"",modelo:"",anio:new Date().getFullYear(),tipo:"Camioneta",conductor:"",proyecto:"",kmActual:0,estado:"activo",color:"",vin:"",observaciones:""}),k=l=>{b({...l}),r(l.id),n(!0)},v=()=>{j(),r(null),n(!0)},m=()=>{h.placa&&(i(a?t.map(l=>l.id===a?{...h,id:a}:l):[...t,{...h,id:zr(),fechaRegistro:Hi()}]),n(!1),j(),r(null))},f=l=>i(t.filter(x=>x.id!==l)),p=t.filter(l=>{var y,u,S,A;const x=s.toLowerCase();return!x||((y=l.placa)==null?void 0:y.toLowerCase().includes(x))||((u=l.marca)==null?void 0:u.toLowerCase().includes(x))||((S=l.conductor)==null?void 0:S.toLowerCase().includes(x))||((A=l.proyecto)==null?void 0:A.toLowerCase().includes(x))}),d=t.filter(l=>l.estado==="activo").length,c=t.filter(l=>l.estado==="taller").length;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Flota vehicular  ",t.length," vehculos"]}),e.jsxs("p",{style:{margin:0,fontSize:10,color:qe.inkMid},children:[d," activos  ",c," en taller"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ci,{size:12,style:{position:"absolute",left:8,top:8,color:qe.inkLight}}),e.jsx("input",{value:s,onChange:l=>g(l.target.value),placeholder:"Buscar placa, marca, conductor...",style:{...Si,paddingLeft:26,width:220}})]}),e.jsxs(ii,{on:v,children:[e.jsx(Oe,{size:11})," Nuevo vehculo"]})]})]}),e.jsx(Gi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Tipo","Marca / Modelo","Ao","Conductor","Proyecto","KM actual","Estado",""].map(l=>e.jsx("th",{style:{...Wi,textAlign:l==="KM actual"?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:qe.inkLight,fontSize:11},children:"Sin vehculos registrados"})}):p.map((l,x)=>{const y=bs[l.estado]||bs.activo;return e.jsxs("tr",{style:{background:x%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:12},children:l.placa}),e.jsx("td",{style:{...nt,fontSize:9},children:l.tipo}),e.jsxs("td",{style:{...nt,fontWeight:600},children:[l.marca," ",l.modelo]}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace"},children:l.anio}),e.jsx("td",{style:{...nt,fontSize:9,color:qe.inkMid},children:l.conductor||""}),e.jsx("td",{style:{...nt,fontSize:9,color:qe.inkMid},children:l.proyecto||""}),e.jsx("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:Ot(l.kmActual)}),e.jsx("td",{style:nt,children:e.jsx(ua,{color:y.c,children:y.lbl})}),e.jsxs("td",{style:{...nt,whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>k(l),style:{background:"none",border:"none",cursor:"pointer",color:qe.blue,marginRight:4},children:e.jsx(ro,{size:11})}),e.jsx("button",{onClick:()=>f(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})]})]},l.id)})})]})}),o&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{n(!1),r(null)},children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:500,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:a?"Editar vehculo":"Nuevo vehculo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Placa",val:h.placa,on:l=>b({...h,placa:l.target.value.toUpperCase()}),ph:"ABC-123",style:{flex:"0 0 120px"}}),e.jsx(ct,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:h.tipo,onChange:l=>b({...h,tipo:l.target.value}),style:{...Si,width:"100%"},children:gm.map(l=>e.jsx("option",{children:l},l))})}),e.jsx(ct,{lbl:"Estado",style:{flex:1},children:e.jsx("select",{value:h.estado,onChange:l=>b({...h,estado:l.target.value}),style:{...Si,width:"100%"},children:Object.entries(bs).map(([l,x])=>e.jsx("option",{value:l,children:x.lbl},l))})})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Marca",val:h.marca,on:l=>b({...h,marca:l.target.value}),ph:"Toyota",style:{flex:1}}),e.jsx(ct,{lbl:"Modelo",val:h.modelo,on:l=>b({...h,modelo:l.target.value}),ph:"Hilux",style:{flex:1}}),e.jsx(ct,{lbl:"Ao",val:h.anio,on:l=>b({...h,anio:l.target.value}),type:"number",style:{flex:"0 0 80px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Color",val:h.color,on:l=>b({...h,color:l.target.value}),ph:"Blanco",style:{flex:1}}),e.jsx(ct,{lbl:"VIN / Chasis",val:h.vin,on:l=>b({...h,vin:l.target.value}),ph:"Opcional",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Conductor asignado",val:h.conductor,on:l=>b({...h,conductor:l.target.value}),ph:"Nombre",style:{flex:1}}),e.jsx(ct,{lbl:"Proyecto",val:h.proyecto,on:l=>b({...h,proyecto:l.target.value}),ph:"Obra asignada",style:{flex:1}})]}),e.jsx(ct,{lbl:"KM actual",val:h.kmActual,on:l=>b({...h,kmActual:l.target.value}),type:"number"}),e.jsx(ct,{lbl:"Observaciones",val:h.observaciones,on:l=>b({...h,observaciones:l.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:m,style:{flex:1},children:[e.jsx(xt,{size:11})," ",a?"Guardar":"Crear"]}),e.jsx(ii,{v:"sec",on:()=>{n(!1),r(null)},style:{flex:1},children:"Cancelar"})]})]})})]})}function hm({vehs:t,setVehs:i,partes:o,setPartes:n}){const[a,r]=F.useState(!1),[s,g]=F.useState(()=>{const p=new Date;return`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}`}),[h,b]=F.useState({vehId:"",fecha:Hi(),kmInicio:0,kmFin:0,conductor:"",proyecto:"",ruta:"",observaciones:""}),j=()=>{const p=t.find(c=>c.id===h.vehId);if(!p)return;const d={id:zr(),...h,kmInicio:parseFloat(h.kmInicio)||0,kmFin:parseFloat(h.kmFin)||0,placa:p.placa};n([...o,d]),d.kmFin>(parseFloat(p.kmActual)||0)&&i(t.map(c=>c.id===h.vehId?{...c,kmActual:d.kmFin}:c)),b({vehId:"",fecha:Hi(),kmInicio:0,kmFin:0,conductor:"",proyecto:"",ruta:"",observaciones:""}),r(!1)},k=p=>n(o.filter(d=>d.id!==p)),v=o.filter(p=>{var d;return(d=p.fecha)==null?void 0:d.startsWith(s)}).sort((p,d)=>p.fecha.localeCompare(d.fecha)),m=v.reduce((p,d)=>p+Math.max(0,(d.kmFin||0)-(d.kmInicio||0)),0),f=[...new Set(o.map(p=>{var d;return(d=p.fecha)==null?void 0:d.slice(0,7)}).filter(Boolean))];return f.includes(s)||f.push(s),f.sort(),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Partes de kilmetros"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:qe.inkMid},children:[s,"  ",v.length," registros  ",Ot(m)," km total"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:s,onChange:p=>g(p.target.value),style:{...Si,fontWeight:600},children:f.map(p=>e.jsx("option",{value:p,children:p},p))}),e.jsxs(ii,{on:()=>r(!0),children:[e.jsx(Oe,{size:11})," Registro"]})]})]}),e.jsx(Gi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Placa","Conductor","Proyecto","Ruta","KM inicio","KM fin","Recorrido",""].map(p=>e.jsx("th",{style:{...Wi,textAlign:["KM inicio","KM fin","Recorrido"].includes(p)?"right":"left"},children:p},p))})}),e.jsxs("tbody",{children:[v.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:qe.inkLight,fontSize:11},children:["Sin registros en ",s]})}):v.map((p,d)=>{const c=Math.max(0,(p.kmFin||0)-(p.kmInicio||0));return e.jsxs("tr",{style:{background:d%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace"},children:p.fecha}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:p.placa}),e.jsx("td",{style:{...nt,fontSize:9},children:p.conductor||""}),e.jsx("td",{style:{...nt,fontSize:9,color:qe.inkMid},children:p.proyecto||""}),e.jsx("td",{style:{...nt,fontSize:9},children:p.ruta||""}),e.jsx("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ot(p.kmInicio)}),e.jsx("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ot(p.kmFin)}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:qe.green},children:[Ot(c)," km"]}),e.jsx("td",{style:nt,children:e.jsx("button",{onClick:()=>k(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},p.id)}),v.length>0&&e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("td",{colSpan:7,style:{...nt,fontWeight:800,borderTop:`2px solid ${qe.ink}`},children:"TOTAL MES"}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:800,color:qe.green,fontSize:12,borderTop:`2px solid ${qe.ink}`},children:[Ot(m)," km"]}),e.jsx("td",{style:{...nt,borderTop:`2px solid ${qe.ink}`}})]})]})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nuevo registro KM"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:h.vehId,onChange:p=>{const d=t.find(c=>c.id===p.target.value);b({...h,vehId:p.target.value,kmInicio:(d==null?void 0:d.kmActual)||0,conductor:(d==null?void 0:d.conductor)||h.conductor})},style:{...Si,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.filter(p=>p.estado==="activo").map(p=>e.jsxs("option",{value:p.id,children:[p.placa,"  ",p.marca," ",p.modelo]},p.id))]})}),e.jsx(ct,{lbl:"Fecha",val:h.fecha,on:p=>b({...h,fecha:p.target.value}),type:"date",style:{flex:"0 0 140px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"KM inicio",val:h.kmInicio,on:p=>b({...h,kmInicio:p.target.value}),type:"number",style:{flex:1}}),e.jsx(ct,{lbl:"KM fin",val:h.kmFin,on:p=>b({...h,kmFin:p.target.value}),type:"number",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Recorrido"}),e.jsxs("div",{style:{padding:"6px 8px",fontSize:14,fontWeight:800,fontFamily:"'DM Mono',monospace",color:qe.green},children:[Ot(Math.max(0,(parseFloat(h.kmFin)||0)-(parseFloat(h.kmInicio)||0)))," km"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Conductor",val:h.conductor,on:p=>b({...h,conductor:p.target.value}),ph:"Nombre",style:{flex:1}}),e.jsx(ct,{lbl:"Proyecto",val:h.proyecto,on:p=>b({...h,proyecto:p.target.value}),ph:"Obra",style:{flex:1}})]}),e.jsx(ct,{lbl:"Ruta / destino",val:h.ruta,on:p=>b({...h,ruta:p.target.value}),ph:"Bogot  Obra Chic  Bogot"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:j,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar"]}),e.jsx(ii,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function fm({vehs:t,tanqueos:i,setTanqueos:o}){const[n,a]=F.useState(!1),[r,s]=F.useState(()=>{const l=new Date;return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`}),[g,h]=F.useState({vehId:"",fecha:Hi(),litros:0,valorTotal:0,km:0,estacion:"",tipoCombus:"Diesel",factura:""}),b=["Diesel","Gasolina corriente","Gasolina extra","Gas natural","Elctrico"],j=()=>{const l=t.find(x=>x.id===g.vehId);l&&(o([...i,{id:zr(),...g,litros:parseFloat(g.litros)||0,valorTotal:parseFloat(g.valorTotal)||0,km:parseFloat(g.km)||0,placa:l.placa}]),h({vehId:"",fecha:Hi(),litros:0,valorTotal:0,km:0,estacion:"",tipoCombus:"Diesel",factura:""}),a(!1))},k=l=>o(i.filter(x=>x.id!==l)),v=i.filter(l=>{var x;return(x=l.fecha)==null?void 0:x.startsWith(r)}),m=v.reduce((l,x)=>l+x.litros,0),f=v.reduce((l,x)=>l+x.valorTotal,0),p=m>0?f/m:0,d=[...new Set(i.map(l=>{var x;return(x=l.fecha)==null?void 0:x.slice(0,7)}).filter(Boolean))];d.includes(r)||d.push(r),d.sort();const c={};return v.forEach(l=>{c[l.placa]||(c[l.placa]={litros:0,gasto:0,tanqueos:0}),c[l.placa].litros+=l.litros,c[l.placa].gasto+=l.valorTotal,c[l.placa].tanqueos++}),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Consumo de combustible"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:qe.inkMid},children:[r,"  ",v.length," tanqueos"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:r,onChange:l=>s(l.target.value),style:{...Si,fontWeight:600},children:d.map(l=>e.jsx("option",{value:l,children:l},l))}),e.jsxs(ii,{on:()=>a(!0),children:[e.jsx(Oe,{size:11})," Tanqueo"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Litros total",ga(m)+" L",qe.blue],[" Gasto total","$"+Ot(f),qe.red],[" $/Litro prom.","$"+Ot(p),qe.ink],[" Vehculos",Object.keys(c).length+"",qe.ink]].map(([l,x,y])=>e.jsxs(Gi,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:l}),e.jsx("div",{style:{fontSize:16,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y,marginTop:2},children:x})]},l))}),Object.keys(c).length>0&&e.jsxs(Gi,{style:{padding:0,overflow:"hidden",marginBottom:14},children:[e.jsx("div",{style:{padding:"8px 12px",background:"#EDEBE7",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Resumen por vehculo"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Wi,children:"Placa"}),e.jsx("th",{style:{...Wi,textAlign:"right"},children:"Tanqueos"}),e.jsx("th",{style:{...Wi,textAlign:"right"},children:"Litros"}),e.jsx("th",{style:{...Wi,textAlign:"right"},children:"Gasto"}),e.jsx("th",{style:{...Wi,textAlign:"right"},children:"$/Litro"})]})}),e.jsx("tbody",{children:Object.entries(c).sort((l,x)=>x[1].gasto-l[1].gasto).map(([l,x],y)=>e.jsxs("tr",{style:{background:y%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l}),e.jsx("td",{style:{...nt,textAlign:"right"},children:x.tanqueos}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[ga(x.litros)," L"]}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:qe.red},children:["$",Ot(x.gasto)]}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:["$",Ot(x.litros>0?x.gasto/x.litros:0)]})]},l))})]})]}),e.jsx(Gi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Placa","Tipo","Estacin","Litros","Valor","KM","Factura",""].map(l=>e.jsx("th",{style:{...Wi,textAlign:["Litros","Valor","KM"].includes(l)?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:v.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:qe.inkLight,fontSize:11},children:["Sin tanqueos en ",r]})}):v.sort((l,x)=>l.fecha.localeCompare(x.fecha)).map((l,x)=>e.jsxs("tr",{style:{background:x%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace"},children:l.fecha}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l.placa}),e.jsx("td",{style:{...nt,fontSize:9},children:l.tipoCombus}),e.jsx("td",{style:{...nt,fontSize:9},children:l.estacion||""}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[ga(l.litros)," L"]}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",Ot(l.valorTotal)]}),e.jsx("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Ot(l.km)}),e.jsx("td",{style:{...nt,fontSize:8,color:qe.blue},children:l.factura||""}),e.jsx("td",{style:nt,children:e.jsx("button",{onClick:()=>k(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},l.id))})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>a(!1),children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Registrar tanqueo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:g.vehId,onChange:l=>h({...g,vehId:l.target.value}),style:{...Si,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(l=>e.jsxs("option",{value:l.id,children:[l.placa,"  ",l.marca," ",l.modelo]},l.id))]})}),e.jsx(ct,{lbl:"Fecha",val:g.fecha,on:l=>h({...g,fecha:l.target.value}),type:"date",style:{flex:"0 0 140px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Tipo combustible",style:{flex:1},children:e.jsx("select",{value:g.tipoCombus,onChange:l=>h({...g,tipoCombus:l.target.value}),style:{...Si,width:"100%"},children:b.map(l=>e.jsx("option",{children:l},l))})}),e.jsx(ct,{lbl:"Estacin",val:g.estacion,on:l=>h({...g,estacion:l.target.value}),ph:"Terpel Cra 7",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Litros",val:g.litros,on:l=>h({...g,litros:l.target.value}),type:"number",style:{flex:1}}),e.jsx(ct,{lbl:"Valor total",val:g.valorTotal,on:l=>h({...g,valorTotal:l.target.value}),type:"number",style:{flex:1}}),e.jsx(ct,{lbl:"KM odmetro",val:g.km,on:l=>h({...g,km:l.target.value}),type:"number",style:{flex:1}})]}),e.jsx(ct,{lbl:"Ref. factura",val:g.factura,on:l=>h({...g,factura:l.target.value}),ph:"FV-00123"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:j,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar"]}),e.jsx(ii,{v:"sec",on:()=>a(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function xm({vehs:t,docVehs:i,setDocVehs:o}){const[n,a]=F.useState(!1),[r,s]=F.useState({vehId:"",tipo:"soat",fechaExpedicion:Hi(),fechaVence:"",entidad:"",poliza:"",costo:0,observaciones:""}),g=[{id:"soat",lbl:"SOAT",icon:""},{id:"tecno",lbl:"Tecnomecnica",icon:""},{id:"seguro",lbl:"Seguro todo riesgo",icon:""},{id:"tarjeta_prop",lbl:"Tarjeta de propiedad",icon:""},{id:"licencia_trans",lbl:"Licencia de trnsito",icon:""},{id:"revision_gas",lbl:"Revisin de gases",icon:""},{id:"poliza_rce",lbl:"Pliza RCE",icon:""},{id:"otro",lbl:"Otro",icon:""}],h=()=>{const p=t.find(d=>d.id===r.vehId);p&&(o([...i,{id:zr(),...r,costo:parseFloat(r.costo)||0,placa:p.placa}]),s({vehId:"",tipo:"soat",fechaExpedicion:Hi(),fechaVence:"",entidad:"",poliza:"",costo:0,observaciones:""}),a(!1))},b=p=>o(i.filter(d=>d.id!==p)),j=Hi(),k=new Date;k.setDate(k.getDate()+30);const v=k.toISOString().split("T")[0],m=i.filter(p=>p.fechaVence&&p.fechaVence<j),f=i.filter(p=>p.fechaVence&&p.fechaVence>=j&&p.fechaVence<=v);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Documentacin vehicular"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:qe.inkMid},children:[i.length," documentos  ",m.length," vencidos  ",f.length," por vencer"]})]}),e.jsxs(ii,{on:()=>a(!0),children:[e.jsx(Oe,{size:11})," Documento"]})]}),(m.length>0||f.length>0)&&e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[m.length>0&&e.jsxs("div",{style:{flex:1,background:qe.redBg,border:`1px solid ${qe.red}33`,borderRadius:6,padding:"8px 12px",display:"flex",alignItems:"center",gap:6},children:[e.jsx(li,{size:14,color:qe.red}),e.jsxs("div",{style:{fontSize:10,color:qe.red,fontWeight:600},children:[" ",m.length," documento",m.length>1?"s":""," vencido",m.length>1?"s":"",": ",m.map(p=>{var d;return p.placa+" "+((d=g.find(c=>c.id===p.tipo))==null?void 0:d.lbl)}).join(", ")]})]}),f.length>0&&e.jsxs("div",{style:{flex:1,background:qe.amberBg,border:`1px solid ${qe.amber}33`,borderRadius:6,padding:"8px 12px",display:"flex",alignItems:"center",gap:6},children:[e.jsx(li,{size:14,color:qe.amber}),e.jsxs("div",{style:{fontSize:10,color:qe.amber,fontWeight:600},children:[" ",f.length," por vencer en 30 das"]})]})]}),e.jsx(Gi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Documento","Entidad","Pliza/Nro","Expedicin","Vencimiento","Costo","Estado",""].map(p=>e.jsx("th",{style:{...Wi,textAlign:p==="Costo"?"right":"left"},children:p},p))})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:qe.inkLight,fontSize:11},children:"Sin documentos"})}):i.sort((p,d)=>(p.fechaVence||"z").localeCompare(d.fechaVence||"z")).map((p,d)=>{const c=g.find(y=>y.id===p.tipo)||g[7],l=p.fechaVence&&p.fechaVence<j,x=p.fechaVence&&!l&&p.fechaVence<=v;return e.jsxs("tr",{style:{background:l?"#FAE8E844":x?"#FAF0E044":d%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:p.placa}),e.jsxs("td",{style:{...nt,fontWeight:600},children:[c.icon," ",c.lbl]}),e.jsx("td",{style:{...nt,fontSize:9},children:p.entidad||""}),e.jsx("td",{style:{...nt,fontSize:9,fontFamily:"'DM Mono',monospace"},children:p.poliza||""}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontSize:9},children:p.fechaExpedicion}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:l||x?700:400,color:l?qe.red:x?qe.amber:qe.ink},children:p.fechaVence||"N/A"}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:["$",Ot(p.costo)]}),e.jsx("td",{style:nt,children:l?e.jsx(ua,{color:qe.red,children:"Vencido"}):x?e.jsx(ua,{color:qe.amber,children:"Por vencer"}):e.jsx(ua,{color:qe.green,children:"Vigente"})}),e.jsx("td",{style:nt,children:e.jsx("button",{onClick:()=>b(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},p.id)})})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>a(!1),children:e.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nuevo documento"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:r.vehId,onChange:p=>s({...r,vehId:p.target.value}),style:{...Si,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(p=>e.jsxs("option",{value:p.id,children:[p.placa,"  ",p.marca," ",p.modelo]},p.id))]})}),e.jsx(ct,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:r.tipo,onChange:p=>s({...r,tipo:p.target.value}),style:{...Si,width:"100%"},children:g.map(p=>e.jsxs("option",{value:p.id,children:[p.icon," ",p.lbl]},p.id))})})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Entidad / aseguradora",val:r.entidad,on:p=>s({...r,entidad:p.target.value}),ph:"Sura, Colpatria...",style:{flex:1}}),e.jsx(ct,{lbl:"Nro. pliza / doc",val:r.poliza,on:p=>s({...r,poliza:p.target.value}),ph:"POL-123",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Fecha expedicin",val:r.fechaExpedicion,on:p=>s({...r,fechaExpedicion:p.target.value}),type:"date",style:{flex:1}}),e.jsx(ct,{lbl:"Fecha vencimiento",val:r.fechaVence,on:p=>s({...r,fechaVence:p.target.value}),type:"date",style:{flex:1}})]}),e.jsx(ct,{lbl:"Costo",val:r.costo,on:p=>s({...r,costo:p.target.value}),type:"number"}),e.jsx(ct,{lbl:"Observaciones",val:r.observaciones,on:p=>s({...r,observaciones:p.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:h,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar"]}),e.jsx(ii,{v:"sec",on:()=>a(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function mm({vehs:t,mantos:i,setMantos:o}){const[n,a]=F.useState(!1),[r,s]=F.useState("todos"),[g,h]=F.useState({vehId:"",tipo:"preventivo",descripcion:"",fechaProg:"",fechaReal:"",kmProg:0,kmReal:0,taller:"",costo:0,estado:"programado",factura:"",observaciones:""}),b=[{id:"preventivo",lbl:" Preventivo",desc:"Cambio aceite, filtros, revisin general"},{id:"correctivo",lbl:" Correctivo",desc:"Reparacin de falla o avera"},{id:"llantas",lbl:" Llantas",desc:"Cambio, rotacin o alineacin"},{id:"frenos",lbl:" Frenos",desc:"Pastillas, discos, lquido"},{id:"electrico",lbl:" Elctrico",desc:"Batera, alternador, luces"},{id:"carroceria",lbl:" Carrocera",desc:"Pintura, latonera, vidrios"},{id:"otro",lbl:" Otro",desc:"Otro tipo de mantenimiento"}],j={programado:{lbl:"Programado",c:qe.blue},en_curso:{lbl:"En curso",c:qe.amber},completado:{lbl:"Completado",c:qe.green},cancelado:{lbl:"Cancelado",c:qe.red}},k=()=>{const x=t.find(y=>y.id===g.vehId);x&&(o([...i,{id:zr(),...g,kmProg:parseFloat(g.kmProg)||0,kmReal:parseFloat(g.kmReal)||0,costo:parseFloat(g.costo)||0,placa:x.placa}]),h({vehId:"",tipo:"preventivo",descripcion:"",fechaProg:"",fechaReal:"",kmProg:0,kmReal:0,taller:"",costo:0,estado:"programado",factura:"",observaciones:""}),a(!1))},v=(x,y,u)=>o(i.map(S=>S.id===x?{...S,[y]:u}:S)),m=x=>o(i.filter(y=>y.id!==x)),f=r==="todos"?i:i.filter(x=>x.estado===r),p=i.filter(x=>x.estado==="completado").reduce((x,y)=>x+y.costo,0),d=i.filter(x=>x.estado==="programado"),c=Hi(),l=d.filter(x=>x.fechaProg&&x.fechaProg<c);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Plan de mantenimiento"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:qe.inkMid},children:[i.length," registros  ",d.length," programados  $",Ot(p)," invertido"]})]}),e.jsxs(ii,{on:()=>a(!0),children:[e.jsx(Oe,{size:11})," Mantenimiento"]})]}),l.length>0&&e.jsxs("div",{style:{background:qe.redBg,border:`1px solid ${qe.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(li,{size:14,color:qe.red}),e.jsxs("div",{style:{fontSize:10,color:qe.red,fontWeight:600},children:[" ",l.length," mantenimiento",l.length>1?"s":""," vencido",l.length>1?"s":"",": ",l.map(x=>x.placa).join(", ")]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:[["todos","Todos"],["programado","Programados"],["en_curso","En curso"],["completado","Completados"]].map(([x,y],u,S)=>e.jsx("button",{onClick:()=>s(x),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${qe.border}`,borderLeft:u>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:u===0?"5px 0 0 5px":u===S.length-1?"0 5px 5px 0":"0",background:r===x?"#111":"#fff",color:r===x?"#fff":qe.inkMid},children:y},x))}),e.jsx(Gi,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Tipo","Descripcin","Taller","F. programada","F. real","Costo","Estado",""].map(x=>e.jsx("th",{style:{...Wi,textAlign:x==="Costo"?"right":"left"},children:x},x))})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:qe.inkLight,fontSize:11},children:"Sin mantenimientos"})}):f.sort((x,y)=>(x.fechaProg||"z").localeCompare(y.fechaProg||"z")).map((x,y)=>{const u=b.find(E=>E.id===x.tipo)||b[6],S=j[x.estado]||j.programado,A=x.estado==="programado"&&x.fechaProg&&x.fechaProg<c;return e.jsxs("tr",{style:{background:A?"#FAE8E844":y%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:x.placa}),e.jsx("td",{style:{...nt,fontSize:9},children:u.lbl}),e.jsx("td",{style:{...nt,fontSize:10,maxWidth:200},children:x.descripcion||""}),e.jsx("td",{style:{...nt,fontSize:9},children:x.taller||""}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontSize:9,color:A?qe.red:qe.ink,fontWeight:A?700:400},children:x.fechaProg||""}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontSize:9},children:x.fechaReal||""}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",Ot(x.costo)]}),e.jsx("td",{style:nt,children:e.jsx("select",{value:x.estado,onChange:E=>v(x.id,"estado",E.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:S.c+"22",color:S.c},children:Object.entries(j).map(([E,w])=>e.jsx("option",{value:E,children:w.lbl},E))})}),e.jsx("td",{style:nt,children:e.jsx("button",{onClick:()=>m(x.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},x.id)})})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>a(!1),children:e.jsxs("div",{onClick:x=>x.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:500,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Programar mantenimiento"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:g.vehId,onChange:x=>h({...g,vehId:x.target.value}),style:{...Si,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(x=>e.jsxs("option",{value:x.id,children:[x.placa,"  ",x.marca," ",x.modelo]},x.id))]})}),e.jsx(ct,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:g.tipo,onChange:x=>h({...g,tipo:x.target.value}),style:{...Si,width:"100%"},children:b.map(x=>e.jsx("option",{value:x.id,children:x.lbl},x.id))})})]}),e.jsx(ct,{lbl:"Descripcin",val:g.descripcion,on:x=>h({...g,descripcion:x.target.value}),ph:"Cambio aceite 10W-40, filtro aceite, filtro aire..."}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Fecha programada",val:g.fechaProg,on:x=>h({...g,fechaProg:x.target.value}),type:"date",style:{flex:1}}),e.jsx(ct,{lbl:"Fecha real",val:g.fechaReal,on:x=>h({...g,fechaReal:x.target.value}),type:"date",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"KM programado",val:g.kmProg,on:x=>h({...g,kmProg:x.target.value}),type:"number",style:{flex:1}}),e.jsx(ct,{lbl:"KM real",val:g.kmReal,on:x=>h({...g,kmReal:x.target.value}),type:"number",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Taller",val:g.taller,on:x=>h({...g,taller:x.target.value}),ph:"Nombre taller",style:{flex:1}}),e.jsx(ct,{lbl:"Costo",val:g.costo,on:x=>h({...g,costo:x.target.value}),type:"number",style:{flex:1}})]}),e.jsx(ct,{lbl:"Ref. factura",val:g.factura,on:x=>h({...g,factura:x.target.value}),ph:"FV-00123"}),e.jsx(ct,{lbl:"Observaciones",val:g.observaciones,on:x=>h({...g,observaciones:x.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ii,{on:k,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar"]}),e.jsx(ii,{v:"sec",on:()=>a(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function bm(){const[t,i]=F.useState({});F.useEffect(()=>{Ee.get(ud).then(T=>{try{T&&i(JSON.parse(T))}catch{}}).catch(()=>{})},[]);const o=(T,L)=>i(Z=>{const K={...Z,[T]:typeof L=="function"?L(Z[T]):L};return Ee.set(ud,JSON.stringify(K)),K}),n=t.vehiculos||[],a=T=>o("vehiculos",typeof T=="function"?T(n):T),r=t.partesKm||[],s=T=>o("partesKm",typeof T=="function"?T(r):T),g=t.tanqueos||[],h=T=>o("tanqueos",typeof T=="function"?T(g):T),b=t.docVehs||[],j=T=>o("docVehs",typeof T=="function"?T(b):T),k=t.mantos||[],v=T=>o("mantos",typeof T=="function"?T(k):T),[m,f]=F.useState("dashboard"),p=Hi(),d=p.slice(0,7),c=new Date;c.setDate(c.getDate()+30);const l=c.toISOString().split("T")[0],x=n.filter(T=>T.estado==="activo").length,y=n.filter(T=>T.estado==="taller").length,u=b.filter(T=>T.fechaVence&&T.fechaVence<p).length,S=b.filter(T=>T.fechaVence&&T.fechaVence>=p&&T.fechaVence<=l).length,A=k.filter(T=>T.estado==="programado"&&T.fechaProg&&T.fechaProg<p).length,E=r.filter(T=>{var L;return(L=T.fecha)==null?void 0:L.startsWith(d)}).reduce((T,L)=>T+Math.max(0,(L.kmFin||0)-(L.kmInicio||0)),0),w=g.filter(T=>{var L;return(L=T.fecha)==null?void 0:L.startsWith(d)}).reduce((T,L)=>T+L.valorTotal,0),_=g.filter(T=>{var L;return(L=T.fecha)==null?void 0:L.startsWith(d)}).reduce((T,L)=>T+L.litros,0),z=k.filter(T=>T.estado==="completado").reduce((T,L)=>T+L.costo,0);return e.jsxs(e.Fragment,{children:[e.jsx(pm,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Control de Flotas"}),e.jsx("div",{style:{fontSize:10,color:qe.inkMid},children:"Vehculos  Kilmetros  Combustible  Documentos  Mantenimiento"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:hd.map((T,L)=>e.jsx("button",{onClick:()=>f(T.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${qe.border}`,borderLeft:L>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:L===0?"6px 0 0 6px":L===hd.length-1?"0 6px 6px 0":"0",background:m===T.id?"#111":"#fff",color:m===T.id?"#fff":qe.inkMid},children:T.lbl},T.id))}),m==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Vehculos activos",`${x}/${n.length}`,qe.ink],[" En taller",y,y>0?"#8C6A00":"#111111"],[" KM mes",`${Ot(E)} km`,"#3B3B3B"],[" Combustible mes",`$${Ot(w)}`,"#B91C1C"]].map(([T,L,Z])=>e.jsxs(Gi,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:T}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Z},children:L})]},T))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Docs vencidos",u,u>0?"#B91C1C":"#111111"],[" Docs por vencer",S,S>0?"#8C6A00":"#111111"],[" Mantos vencidos",A,A>0?"#B91C1C":"#111111"],[" Costo mantos total",`$${Ot(z)}`,qe.ink]].map(([T,L,Z])=>e.jsxs(Gi,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:T}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Z},children:L})]},T))}),_>0&&e.jsx(Gi,{style:{marginBottom:12,padding:"10px 14px"},children:e.jsxs("div",{style:{fontSize:9,fontWeight:600,color:qe.inkMid},children:[" Precio promedio/litro: ",e.jsxs("strong",{style:{color:qe.ink},children:["$",Ot(w/_)]}),"  Litros mes: ",e.jsxs("strong",{children:[ga(_)," L"]})]})}),(u>0||A>0)&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" ",[u>0&&`${u} documentos vencidos`,A>0&&`${A} mantenimientos vencidos`].filter(Boolean).join("  ")]})]}),m==="vehiculos"&&e.jsx(um,{vehs:n,setVehs:a}),m==="km"&&e.jsx(hm,{vehs:n,setVehs:a,partes:r,setPartes:s}),m==="combustible"&&e.jsx(fm,{vehs:n,tanqueos:g,setTanqueos:h}),m==="docs"&&e.jsx(xm,{vehs:n,docVehs:b,setDocVehs:j}),m==="manto"&&e.jsx(mm,{vehs:n,mantos:k,setMantos:v})]})]})}const ym=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Qe={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},bn=()=>Math.random().toString(36).slice(2,10),ko=()=>new Date().toISOString().split("T")[0],vo=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),br=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Qe.surface,border:`1px solid ${Qe.border}`,borderRadius:8,padding:16,boxShadow:Qe.shadow,...i},...o,children:t}),so=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${Qe.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?Qe.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),ui=({lbl:t,val:i,on:o,ph:n,type:a,style:r,children:s,...g})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),s||e.jsx("input",{type:a||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${Qe.border}`,borderRadius:4,fontSize:11,background:"#fff"},...g})]}),Hs=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),Fi={border:`1px solid ${Qe.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},za={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Qe.border}`,textAlign:"left"},Tt={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${Qe.border}`},fd="habitaris_compras",xd=[{id:"dashboard",lbl:" Dashboard"},{id:"oc",lbl:" rdenes de Compra"},{id:"recep",lbl:" Recepcin"},{id:"eval",lbl:" Evaluacin Proveedores"}];function vm({ocs:t,setOCs:i}){var A,E;const[o,n]=F.useState(!1),[a,r]=F.useState(null),[s,g]=F.useState(""),[h,b]=F.useState("todos"),[j,k]=F.useState({proveedor:"",proyecto:"",solicitante:"",fechaEntrega:"",condicionPago:"Contado",observaciones:"",items:[{id:bn(),desc:"",und:"",cant:0,valorUnit:0}]}),v={borrador:{lbl:"Borrador",c:Qe.inkLight},pendiente:{lbl:"Pendiente",c:Qe.amber},aprobada:{lbl:"Aprobada",c:Qe.blue},enviada:{lbl:"Enviada prov.",c:"#5B3A8C"},parcial:{lbl:"Recibida parcial",c:Qe.amber},completa:{lbl:"Completa",c:Qe.green},cancelada:{lbl:"Cancelada",c:Qe.red}},m=["Contado","Crdito 30 das","Crdito 60 das","Anticipo 50%","Contra entrega"],f=()=>{const w=j.items.filter(L=>L.desc.trim()).map(L=>({...L,cant:parseFloat(L.cant)||0,valorUnit:parseFloat(L.valorUnit)||0}));if(!j.proveedor||w.length===0)return;const _=w.reduce((L,Z)=>L+Z.cant*Z.valorUnit,0),z=`OC-${String(t.length+1).padStart(4,"0")}`,T={id:bn(),num:z,...j,items:w,total:_,estado:"borrador",fecha:ko(),historial:[{fecha:ko(),accion:"Creada",usuario:"Admin"}]};i([...t,T]),r(T.id),k({proveedor:"",proyecto:"",solicitante:"",fechaEntrega:"",condicionPago:"Contado",observaciones:"",items:[{id:bn(),desc:"",und:"",cant:0,valorUnit:0}]}),n(!1)},p=(w,_)=>{i(t.map(z=>{var T;return z.id!==w?z:{...z,estado:_,historial:[...z.historial||[],{fecha:ko(),accion:`Estado  ${(T=v[_])==null?void 0:T.lbl}`,usuario:"Admin"}]}}))},d=w=>{i(t.filter(_=>_.id!==w)),a===w&&r(null)},c=()=>k({...j,items:[...j.items,{id:bn(),desc:"",und:"",cant:0,valorUnit:0}]}),l=(w,_,z)=>k({...j,items:j.items.map((T,L)=>L===w?{...T,[_]:z}:T)}),x=w=>k({...j,items:j.items.filter((_,z)=>z!==w)}),y=t.filter(w=>{var z,T,L;if(h!=="todos"&&w.estado!==h)return!1;const _=s.toLowerCase();return!_||((z=w.num)==null?void 0:z.toLowerCase().includes(_))||((T=w.proveedor)==null?void 0:T.toLowerCase().includes(_))||((L=w.proyecto)==null?void 0:L.toLowerCase().includes(_))}),u=t.find(w=>w.id===a),S=t.filter(w=>w.estado==="pendiente").reduce((w,_)=>w+_.total,0);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["rdenes de Compra  ",t.length," OCs"]}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Qe.inkMid},children:[t.filter(w=>w.estado==="pendiente").length," pendientes  $",vo(S)," por aprobar"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ci,{size:12,style:{position:"absolute",left:8,top:8,color:Qe.inkLight}}),e.jsx("input",{value:s,onChange:w=>g(w.target.value),placeholder:"Buscar OC, proveedor...",style:{...Fi,paddingLeft:26,width:200}})]}),e.jsxs(so,{on:()=>n(!0),children:[e.jsx(Oe,{size:11})," Nueva OC"]})]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14,flexWrap:"wrap"},children:[["todos","Todos"],...Object.entries(v).map(([w,_])=>[w,_.lbl])].map(([w,_],z,T)=>e.jsxs("button",{onClick:()=>b(w),style:{padding:"5px 12px",fontSize:9,fontWeight:600,cursor:"pointer",border:`1px solid ${Qe.border}`,borderLeft:z>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:z===0?"5px 0 0 5px":z===T.length-1?"0 5px 5px 0":"0",background:h===w?"#111":"#fff",color:h===w?"#fff":Qe.inkMid},children:[_," ",e.jsxs("span",{style:{fontSize:7,marginLeft:2},children:["(",t.filter(L=>w==="todos"||L.estado===w).length,")"]})]},w))}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx(br,{style:{flex:1,padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Nro.","Fecha","Proveedor","Proyecto","tems","Total","Entrega","Estado"].map(w=>e.jsx("th",{style:{...za,textAlign:w==="Total"?"right":"left"},children:w},w))})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:24,textAlign:"center",color:Qe.inkLight,fontSize:11},children:"Sin rdenes"})}):y.sort((w,_)=>_.fecha.localeCompare(w.fecha)).map((w,_)=>{var T;const z=v[w.estado]||v.borrador;return e.jsxs("tr",{onClick:()=>r(w.id===a?null:w.id),style:{cursor:"pointer",background:a===w.id?"#F0F0F022":_%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Tt,fontFamily:"'DM Mono',monospace",fontWeight:700,color:Qe.blue},children:w.num}),e.jsx("td",{style:{...Tt,fontFamily:"'DM Mono',monospace",fontSize:9},children:w.fecha}),e.jsx("td",{style:{...Tt,fontWeight:600},children:w.proveedor}),e.jsx("td",{style:{...Tt,fontSize:9,color:Qe.inkMid},children:w.proyecto||""}),e.jsx("td",{style:{...Tt,fontSize:9},children:((T=w.items)==null?void 0:T.length)||0}),e.jsxs("td",{style:{...Tt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:["$",vo(w.total)]}),e.jsx("td",{style:{...Tt,fontFamily:"'DM Mono',monospace",fontSize:9},children:w.fechaEntrega||""}),e.jsx("td",{style:Tt,children:e.jsx(Hs,{color:z.c,children:z.lbl})})]},w.id)})})]})}),u&&e.jsxs(br,{style:{width:360,flexShrink:0,padding:0,overflow:"hidden",alignSelf:"flex-start"},children:[e.jsxs("div",{style:{padding:"12px 14px",background:"#EDEBE7"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:u.num}),e.jsx("button",{onClick:()=>d(u.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:12})})]}),e.jsxs("div",{style:{fontSize:9,color:Qe.inkMid,marginTop:2},children:[u.proveedor,"  ",u.proyecto||"Sin proyecto","  ",u.fecha]})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:`1px solid ${Qe.border}`,display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:9,fontWeight:600,color:Qe.inkMid},children:"Estado:"}),e.jsx("select",{value:u.estado,onChange:w=>p(u.id,w.target.value),style:{fontSize:9,fontWeight:700,padding:"3px 8px",borderRadius:10,border:"none",cursor:"pointer",background:(((A=v[u.estado])==null?void 0:A.c)||Qe.inkLight)+"22",color:((E=v[u.estado])==null?void 0:E.c)||Qe.inkLight},children:Object.entries(v).map(([w,_])=>e.jsx("option",{value:w,children:_.lbl},w))})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:`1px solid ${Qe.border}`,fontSize:9},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Solicitante:"})," ",u.solicitante||""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Condicin pago:"})," ",u.condicionPago]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Entrega esperada:"})," ",u.fechaEntrega||""]}),u.observaciones&&e.jsx("div",{style:{marginTop:4,color:Qe.inkMid},children:u.observaciones})]}),e.jsxs("div",{style:{padding:"6px 0"},children:[e.jsx("div",{style:{padding:"0 14px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"tems"}),(u.items||[]).map((w,_)=>e.jsxs("div",{style:{padding:"4px 14px",borderBottom:`1px solid ${Qe.border}`,display:"flex",justifyContent:"space-between",fontSize:9},children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[w.cant," ",w.und]}),"  ",w.desc]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700},children:["$",vo(w.cant*w.valorUnit)]})]},w.id||_)),e.jsxs("div",{style:{padding:"6px 14px",display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:11,borderTop:`2px solid ${Qe.ink}`},children:[e.jsx("span",{children:"TOTAL"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:["$",vo(u.total)]})]})]}),(u.historial||[]).length>0&&e.jsxs("div",{style:{padding:"8px 14px",borderTop:`1px solid ${Qe.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"Historial"}),u.historial.map((w,_)=>e.jsxs("div",{style:{fontSize:8,color:Qe.inkMid,marginBottom:2},children:[w.fecha,"  ",w.accion]},_))]})]})]}),o&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>n(!1),children:e.jsxs("div",{onClick:w=>w.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:600,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nueva Orden de Compra"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ui,{lbl:"Proveedor",val:j.proveedor,on:w=>k({...j,proveedor:w.target.value}),ph:"Nombre proveedor",style:{flex:1}}),e.jsx(ui,{lbl:"Proyecto",val:j.proyecto,on:w=>k({...j,proyecto:w.target.value}),ph:"Obra / proyecto",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ui,{lbl:"Solicitante",val:j.solicitante,on:w=>k({...j,solicitante:w.target.value}),ph:"Quien solicita",style:{flex:1}}),e.jsx(ui,{lbl:"Fecha entrega",val:j.fechaEntrega,on:w=>k({...j,fechaEntrega:w.target.value}),type:"date",style:{flex:1}}),e.jsx(ui,{lbl:"Condicin pago",style:{flex:1},children:e.jsx("select",{value:j.condicionPago,onChange:w=>k({...j,condicionPago:w.target.value}),style:{...Fi,width:"100%"},children:m.map(w=>e.jsx("option",{children:w},w))})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"tems"}),e.jsx("button",{onClick:c,style:{fontSize:9,color:Qe.blue,background:"none",border:"none",cursor:"pointer",fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir lnea"})]}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Descripcin","Und","Cant","Valor unit.","Subtotal",""].map(w=>e.jsx("th",{style:{padding:"3px 4px",fontSize:7,fontWeight:700,color:"#888",textAlign:["Cant","Valor unit.","Subtotal"].includes(w)?"right":"left",borderBottom:`1px solid ${Qe.border}`},children:w},w))})}),e.jsx("tbody",{children:j.items.map((w,_)=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"2px 2px"},children:e.jsx("input",{value:w.desc,onChange:z=>l(_,"desc",z.target.value),placeholder:"Material o servicio",style:{...Fi,width:"100%",fontSize:10}})}),e.jsx("td",{style:{padding:"2px 2px",width:50},children:e.jsx("input",{value:w.und,onChange:z=>l(_,"und",z.target.value),placeholder:"m",style:{...Fi,width:"100%",fontSize:10,textAlign:"center"}})}),e.jsx("td",{style:{padding:"2px 2px",width:65},children:e.jsx("input",{type:"number",value:w.cant,onChange:z=>l(_,"cant",z.target.value),style:{...Fi,width:"100%",fontSize:10,textAlign:"right"}})}),e.jsx("td",{style:{padding:"2px 2px",width:90},children:e.jsx("input",{type:"number",value:w.valorUnit,onChange:z=>l(_,"valorUnit",z.target.value),style:{...Fi,width:"100%",fontSize:10,textAlign:"right"}})}),e.jsxs("td",{style:{padding:"2px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,width:90},children:["$",vo((parseFloat(w.cant)||0)*(parseFloat(w.valorUnit)||0))]}),e.jsx("td",{style:{padding:"2px",width:20},children:j.items.length>1&&e.jsx("button",{onClick:()=>x(_),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:9})})})]},w.id))})]}),e.jsxs("div",{style:{textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:12,marginTop:6},children:["Total: $",vo(j.items.reduce((w,_)=>w+(parseFloat(_.cant)||0)*(parseFloat(_.valorUnit)||0),0))]})]}),e.jsx(ui,{lbl:"Observaciones",val:j.observaciones,on:w=>k({...j,observaciones:w.target.value}),ph:"Notas adicionales"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(so,{on:f,style:{flex:1},children:[e.jsx(xt,{size:11})," Crear OC"]}),e.jsx(so,{v:"sec",on:()=>n(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function jm({ocs:t,setOCs:i,recepciones:o,setRecepciones:n}){const[a,r]=F.useState(!1),[s,g]=F.useState(""),[h,b]=F.useState({ocId:"",fecha:ko(),recibidoPor:"",observaciones:"",items:[]}),j=t.filter(m=>["aprobada","enviada","parcial"].includes(m.estado)),k=m=>{const f=t.find(c=>c.id===m);if(!f)return;const p={};o.filter(c=>c.ocId===m).forEach(c=>{(c.items||[]).forEach(l=>{p[l.itemId]=(p[l.itemId]||0)+(l.cantRecibida||0)})});const d=(f.items||[]).map(c=>({itemId:c.id,desc:c.desc,und:c.und,cantOC:c.cant,cantYaRecibida:p[c.id]||0,cantRecibida:0,conforme:!0,observacion:""}));b({ocId:m,fecha:ko(),recibidoPor:"",observaciones:"",items:d}),g(m)},v=()=>{if(!h.ocId||h.items.every(p=>(parseFloat(p.cantRecibida)||0)===0))return;const m={id:bn(),...h,items:h.items.map(p=>({...p,cantRecibida:parseFloat(p.cantRecibida)||0}))};n([...o,m]);const f=t.find(p=>p.id===h.ocId);if(f){const p={};[...o.filter(c=>c.ocId===h.ocId),m].forEach(c=>{(c.items||[]).forEach(l=>{p[l.itemId]=(p[l.itemId]||0)+l.cantRecibida})});const d=(f.items||[]).every(c=>(p[c.id]||0)>=c.cant);i(t.map(c=>c.id===h.ocId?{...c,estado:d?"completa":"parcial",historial:[...c.historial||[],{fecha:ko(),accion:d?"Recepcin completa":"Recepcin parcial",usuario:h.recibidoPor||"Admin"}]}:c))}b({ocId:"",fecha:ko(),recibidoPor:"",observaciones:"",items:[]}),r(!1)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Recepcin de mercanca"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Qe.inkMid},children:[o.length," recepciones  ",j.length," OCs pendientes"]})]}),e.jsxs(so,{on:()=>r(!0),children:[e.jsx(Oe,{size:11})," Nueva recepcin"]})]}),e.jsx(br,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","OC","Proveedor","Recibido por","tems","Conformes","Observaciones"].map(m=>e.jsx("th",{style:za,children:m},m))})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:24,textAlign:"center",color:Qe.inkLight,fontSize:11},children:"Sin recepciones"})}):o.sort((m,f)=>f.fecha.localeCompare(m.fecha)).map((m,f)=>{const p=t.find(l=>l.id===m.ocId),d=(m.items||[]).filter(l=>l.cantRecibida>0).length,c=(m.items||[]).filter(l=>l.cantRecibida>0&&l.conforme).length;return e.jsxs("tr",{style:{background:f%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Tt,fontFamily:"'DM Mono',monospace"},children:m.fecha}),e.jsx("td",{style:{...Tt,fontFamily:"'DM Mono',monospace",fontWeight:700,color:Qe.blue},children:(p==null?void 0:p.num)||""}),e.jsx("td",{style:{...Tt,fontWeight:600},children:(p==null?void 0:p.proveedor)||""}),e.jsx("td",{style:{...Tt,fontSize:9},children:m.recibidoPor||""}),e.jsx("td",{style:{...Tt,fontSize:9},children:d}),e.jsx("td",{style:Tt,children:c===d?e.jsx(Hs,{color:Qe.green,children:" Todo conforme"}):e.jsxs(Hs,{color:Qe.red,children:[c,"/",d," conformes"]})}),e.jsx("td",{style:{...Tt,fontSize:8,color:Qe.inkMid,maxWidth:150,overflow:"hidden",textOverflow:"ellipsis"},children:m.observaciones||""})]},m.id)})})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:m=>m.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:650,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Recepcin de mercanca"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ui,{lbl:"Orden de compra",style:{flex:1},children:e.jsxs("select",{value:h.ocId,onChange:m=>k(m.target.value),style:{...Fi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar OC "}),j.map(m=>e.jsxs("option",{value:m.id,children:[m.num,"  ",m.proveedor," ($",vo(m.total),")"]},m.id))]})}),e.jsx(ui,{lbl:"Fecha",val:h.fecha,on:m=>b({...h,fecha:m.target.value}),type:"date",style:{flex:"0 0 140px"}}),e.jsx(ui,{lbl:"Recibido por",val:h.recibidoPor,on:m=>b({...h,recibidoPor:m.target.value}),ph:"Almacenista",style:{flex:1}})]}),h.items.length>0&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:6},children:"tems de la OC"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Descripcin","Und","Pedido","Ya recibido","Recibir ahora","Conforme?","Obs."].map(m=>e.jsx("th",{style:{padding:"3px 6px",fontSize:7,fontWeight:700,color:"#888",textAlign:["Pedido","Ya recibido","Recibir ahora"].includes(m)?"right":"left",borderBottom:`1px solid ${Qe.border}`},children:m},m))})}),e.jsx("tbody",{children:h.items.map((m,f)=>{const p=m.cantOC-m.cantYaRecibida;return e.jsxs("tr",{style:{borderBottom:`1px solid ${Qe.border}`,background:f%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 6px",fontSize:10},children:m.desc}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9,textAlign:"center"},children:m.und}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10},children:m.cantOC}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:Qe.inkMid},children:m.cantYaRecibida}),e.jsx("td",{style:{padding:"2px 4px",width:80},children:e.jsx("input",{type:"number",value:m.cantRecibida,max:p,onChange:d=>b({...h,items:h.items.map((c,l)=>l===f?{...c,cantRecibida:d.target.value}:c)}),style:{...Fi,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:Qe.green}})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:m.conforme,onChange:d=>b({...h,items:h.items.map((c,l)=>l===f?{...c,conforme:d.target.checked}:c)})})}),e.jsx("td",{style:{padding:"2px 4px",width:100},children:e.jsx("input",{value:m.observacion||"",placeholder:"Nota",onChange:d=>b({...h,items:h.items.map((c,l)=>l===f?{...c,observacion:d.target.value}:c)}),style:{...Fi,width:"100%",fontSize:8}})})]},m.itemId)})})]})]}),e.jsx(ui,{lbl:"Observaciones generales",val:h.observaciones,on:m=>b({...h,observaciones:m.target.value}),ph:"Notas sobre la recepcin"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(so,{on:v,style:{flex:1},children:[e.jsx(xt,{size:11})," Registrar recepcin"]}),e.jsx(so,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function Sm({ocs:t,recepciones:i,evaluaciones:o,setEvaluaciones:n}){const[a,r]=F.useState(!1),[s,g]=F.useState({proveedor:"",periodo:"",calidad:5,puntualidad:5,precio:5,comunicacion:5,documentacion:5,observaciones:""}),h=[{id:"calidad",lbl:"Calidad del material/servicio",icon:""},{id:"puntualidad",lbl:"Puntualidad en entregas",icon:""},{id:"precio",lbl:"Competitividad de precios",icon:""},{id:"comunicacion",lbl:"Comunicacin y respuesta",icon:""},{id:"documentacion",lbl:"Documentacin y facturacin",icon:""}],b=()=>{if(!s.proveedor)return;const d=(s.calidad+s.puntualidad+s.precio+s.comunicacion+s.documentacion)/5;n([...o,{id:bn(),...s,promedio:Math.round(d*10)/10,fecha:ko()}]),g({proveedor:"",periodo:"",calidad:5,puntualidad:5,precio:5,comunicacion:5,documentacion:5,observaciones:""}),r(!1)},j=d=>n(o.filter(c=>c.id!==d)),k=[...new Set(t.map(d=>d.proveedor).filter(Boolean))],v={};o.forEach(d=>{v[d.proveedor]||(v[d.proveedor]={evals:[],sum:0}),v[d.proveedor].evals.push(d),v[d.proveedor].sum+=d.promedio});const m=Object.entries(v).map(([d,c])=>({prov:d,count:c.evals.length,promedio:Math.round(c.sum/c.evals.length*10)/10,last:c.evals.sort((l,x)=>x.fecha.localeCompare(l.fecha))[0]})).sort((d,c)=>c.promedio-d.promedio),f=d=>d>=8?Qe.green:d>=5?Qe.amber:Qe.red,p=({val:d,max:c=10})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{width:80,height:6,background:"#E0E0E0",borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{width:`${d/c*100}%`,height:"100%",background:f(d),borderRadius:3}})}),e.jsx("span",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:f(d)},children:d})]});return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Evaluacin de proveedores"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Qe.inkMid},children:[o.length," evaluaciones  ",m.length," proveedores calificados"]})]}),e.jsxs(so,{on:()=>r(!0),children:[e.jsx(Oe,{size:11})," Evaluar"]})]}),m.length>0&&e.jsxs(br,{style:{padding:0,overflow:"hidden",marginBottom:16},children:[e.jsx("div",{style:{padding:"8px 14px",background:"#EDEBE7",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:" Ranking general"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["#","Proveedor","Evaluaciones","Promedio","Tendencia"].map(d=>e.jsx("th",{style:{...za,textAlign:d==="#"?"center":"left"},children:d},d))})}),e.jsx("tbody",{children:m.map((d,c)=>{var l;return e.jsxs("tr",{style:{background:c%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Tt,textAlign:"center",fontWeight:800,fontSize:12,color:c===0?"#D4A700":c===1?"#888":c===2?"#A0522D":Qe.ink},children:c===0?"":c===1?"":c===2?"":c+1}),e.jsx("td",{style:{...Tt,fontWeight:700},children:d.prov}),e.jsxs("td",{style:{...Tt,fontSize:9},children:[d.count," eval",d.count>1?"s":""]}),e.jsx("td",{style:Tt,children:e.jsx(p,{val:d.promedio})}),e.jsxs("td",{style:{...Tt,fontSize:9,color:Qe.inkMid},children:["ltima: ",(l=d.last)==null?void 0:l.fecha]})]},d.prov)})})]})]}),e.jsxs(br,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"8px 14px",background:"#F5F4F1",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Historial de evaluaciones"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Fecha","Proveedor","Perodo","Calidad","Puntualidad","Precio","Comun.","Doc.","Promedio",""].map(d=>e.jsx("th",{style:{...za,textAlign:["Calidad","Puntualidad","Precio","Comun.","Doc.","Promedio"].includes(d)?"center":"left"},children:d},d))})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:24,textAlign:"center",color:Qe.inkLight,fontSize:11},children:"Sin evaluaciones"})}):o.sort((d,c)=>c.fecha.localeCompare(d.fecha)).map((d,c)=>e.jsxs("tr",{style:{background:c%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Tt,fontFamily:"'DM Mono',monospace",fontSize:9},children:d.fecha}),e.jsx("td",{style:{...Tt,fontWeight:600},children:d.proveedor}),e.jsx("td",{style:{...Tt,fontSize:9},children:d.periodo||""}),["calidad","puntualidad","precio","comunicacion","documentacion"].map(l=>e.jsx("td",{style:{...Tt,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:f(d[l])},children:d[l]},l)),e.jsx("td",{style:{...Tt,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:12,color:f(d.promedio)},children:d.promedio}),e.jsx("td",{style:Tt,children:e.jsx("button",{onClick:()=>j(d.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:10})})})]},d.id))})]})]}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:480,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Evaluar proveedor"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs(ui,{lbl:"Proveedor",style:{flex:1},children:[e.jsxs("select",{value:s.proveedor,onChange:d=>g({...s,proveedor:d.target.value}),style:{...Fi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),k.map(d=>e.jsx("option",{children:d},d)),e.jsx("option",{value:"__otro",children:"+ Otro..."})]}),s.proveedor==="__otro"&&e.jsx("input",{value:"",onChange:d=>g({...s,proveedor:d.target.value}),placeholder:"Nombre proveedor",style:{...Fi,width:"100%",marginTop:4}})]}),e.jsx(ui,{lbl:"Perodo",val:s.periodo,on:d=>g({...s,periodo:d.target.value}),ph:"Ene-Mar 2026",style:{flex:1}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:8},children:"Calificacin (1-10)"}),h.map(d=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[e.jsxs("div",{style:{width:180,fontSize:10},children:[d.icon," ",d.lbl]}),e.jsx("input",{type:"range",min:"1",max:"10",value:s[d.id],onChange:c=>g({...s,[d.id]:parseInt(c.target.value)}),style:{flex:1,accentColor:f(s[d.id])}}),e.jsx("div",{style:{width:28,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:14,color:f(s[d.id])},children:s[d.id]})]},d.id)),e.jsxs("div",{style:{textAlign:"right",fontSize:12,fontWeight:800,fontFamily:"'DM Mono',monospace",color:f((s.calidad+s.puntualidad+s.precio+s.comunicacion+s.documentacion)/5),marginTop:4},children:["Promedio: ",((s.calidad+s.puntualidad+s.precio+s.comunicacion+s.documentacion)/5).toFixed(1)]})]}),e.jsx(ui,{lbl:"Observaciones",val:s.observaciones,on:d=>g({...s,observaciones:d.target.value}),ph:"Notas sobre desempeo"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(so,{on:b,style:{flex:1},children:[e.jsx(xt,{size:11})," Guardar evaluacin"]}),e.jsx(so,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function Cm(){const[t,i]=F.useState({});useEffect(()=>{Ee.get(fd).then(p=>{try{p&&i(JSON.parse(p))}catch{}}).catch(()=>{})},[]);const o=(p,d)=>i(c=>{const l={...c,[p]:typeof d=="function"?d(c[p]):d};return Ee.set(fd,JSON.stringify(l)),l}),n=t.ocs||[],a=p=>o("ocs",typeof p=="function"?p(n):p),r=t.recepciones||[],s=p=>o("recepciones",typeof p=="function"?p(r):p),g=t.evaluaciones||[],h=p=>o("evaluaciones",typeof p=="function"?p(g):p),[b,j]=F.useState("dashboard"),k=n.filter(p=>p.estado==="pendiente"),v=n.filter(p=>p.estado==="completa"),m=n.filter(p=>p.estado!=="cancelada").reduce((p,d)=>p+d.total,0),f=g.length>0?g.reduce((p,d)=>p+d.promedio,0)/g.length:0;return e.jsxs(e.Fragment,{children:[e.jsx(ym,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Compras"}),e.jsx("div",{style:{fontSize:10,color:Qe.inkMid},children:"rdenes de compra  Recepcin  Evaluacin proveedores"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:xd.map((p,d)=>e.jsx("button",{onClick:()=>j(p.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${Qe.border}`,borderLeft:d>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:d===0?"6px 0 0 6px":d===xd.length-1?"0 6px 6px 0":"0",background:b===p.id?"#111":"#fff",color:b===p.id?"#fff":Qe.inkMid},children:p.lbl},p.id))}),b==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Total OCs",n.length,"#111"],[" Pendientes",k.length,k.length>0?"#8C6A00":"#111111"],[" Completas",v.length,"#111111"],[" Valor total",`$${vo(m)}`,"#111"]].map(([p,d,c])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Qe.border}`,borderRadius:8,padding:"14px 16px",boxShadow:Qe.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:c},children:d})]},p))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12,marginBottom:16},children:[[" Recepciones",r.length,"#3B3B3B"],[" Evaluaciones",g.length,"#111"],[" Nota media proveedores",f>0?f.toFixed(1):"",f>=8?"#111111":f>=5?"#8C6A00":"#B91C1C"]].map(([p,d,c])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Qe.border}`,borderRadius:8,padding:"14px 16px",boxShadow:Qe.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:c},children:d})]},p))})]}),b==="oc"&&e.jsx(vm,{ocs:n,setOCs:a}),b==="recep"&&e.jsx(jm,{ocs:n,setOCs:a,recepciones:r,setRecepciones:s}),b==="eval"&&e.jsx(Sm,{ocs:n,recepciones:r,evaluaciones:g,setEvaluaciones:h})]})]})}const km=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Fe={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},wt=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),wm=()=>new Date().toISOString().split("T")[0],mo=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Fe.surface,border:`1px solid ${Fe.border}`,borderRadius:8,padding:16,boxShadow:Fe.shadow,...i},...o,children:t}),ys=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),vs=[{id:"general",lbl:" General",color:Fe.ink},{id:"proyectos",lbl:" Proyectos",color:"#5B3A8C"},{id:"admin",lbl:" Administracin",color:"#6B5B8C"},{id:"compras",lbl:" Compras",color:"#0D5E6E"},{id:"flotas",lbl:" Flotas",color:"#2E5E4E"},{id:"rrhh",lbl:" RRHH",color:"#3B3B3B"},{id:"crm",lbl:" CRM / Ofertas",color:"#111111"},{id:"formularios",lbl:" Formularios",color:"#5B3A8C"}],dn=t=>{try{const i=Ee.getSync(t);return i?JSON.parse(i):{}}catch{return{}}};function zm(){return F.useMemo(()=>{const t=dn("habitaris_crm"),i=dn("habitaris_admin"),o=dn("habitaris_flotas"),n=dn("habitaris_compras"),a=wm(),r=i.adm_cajas||[],s=i.adm_tarjeta||[],g=i.adm_viaticos||[],h=i.adm_flujo||[],b=i.adm_cuentas||[],j=r.reduce((R,ie)=>{const fe=ie.movimientos||[];return R+(ie.fondoInicial||0)+fe.reduce((Me,Le)=>Me+(Le.tipo==="entrada"?Le.monto:-Le.monto),0)},0),k=s.filter(R=>R.estado==="pendiente"),v=g.filter(R=>R.estado==="solicitado"||R.estado==="aprobado"),m=(()=>{const R=new Date,ie=`${R.getFullYear()}-${String(R.getMonth()+1).padStart(2,"0")}`,fe=h.filter(Ie=>{var dt;return(dt=Ie.fecha)==null?void 0:dt.startsWith(ie)}),Me=fe.filter(Ie=>Ie.tipo==="ingreso").reduce((Ie,dt)=>Ie+dt.monto,0),Le=fe.filter(Ie=>Ie.tipo==="egreso").reduce((Ie,dt)=>Ie+dt.monto,0);return{ing:Me,egr:Le,neto:Me-Le}})(),f=b.filter(R=>R.tipo==="cobrar"),p=b.filter(R=>R.tipo==="pagar"),d=f.filter(R=>R.estado==="vigente").reduce((R,ie)=>R+ie.monto,0),c=f.filter(R=>R.estado==="vencida").reduce((R,ie)=>R+ie.monto,0),l=p.filter(R=>R.estado==="vigente").reduce((R,ie)=>R+ie.monto,0),x=p.filter(R=>R.estado==="vencida").reduce((R,ie)=>R+ie.monto,0),y=n.ocs||[],u=n.recepciones||[],S=n.evaluaciones||[],A=y.filter(R=>R.estado==="pendiente"),E=y.filter(R=>R.estado==="enviada"||R.estado==="parcial"),w=y.filter(R=>R.estado!=="cancelada").reduce((R,ie)=>R+ie.total,0),_=o.vehiculos||[];o.partesKm;const z=o.tanqueos||[],T=o.docVehs||[],L=o.mantos||[],Z=_.filter(R=>R.estado==="activo").length,K=_.filter(R=>R.estado==="taller").length,P=T.filter(R=>R.fechaVence&&R.fechaVence<a),te=L.filter(R=>R.estado==="programado"&&R.fechaProg&&R.fechaProg<a),he=new Date;he.setDate(he.getDate()+30);const Q=he.toISOString().split("T")[0],Se=T.filter(R=>R.fechaVence&&R.fechaVence>=a&&R.fechaVence<=Q),ae=(()=>{const R=new Date,ie=`${R.getFullYear()}-${String(R.getMonth()+1).padStart(2,"0")}`;return z.filter(fe=>{var Me;return(Me=fe.fecha)==null?void 0:Me.startsWith(ie)}).reduce((fe,Me)=>fe+Me.valorTotal,0)})(),U=t.deals||[],M=U.filter(R=>R.estado==="Ganada"),B=M.reduce((R,ie)=>R+(ie.presupuestoFinal||ie.presupuesto||0),0),H=U.filter(R=>["Contacto","Visita","Propuesta","Negociacin"].includes(R.estado)),ee=H.reduce((R,ie)=>R+(ie.presupuesto||0),0),D=dn("habitaris_proy"),O=D["hab:proyectos:lista"]||[],le=D["hab:proyectos:actividades"]||[],re=D["hab:proyectos:hitos"]||[],de=O.filter(R=>R.estado==="activo"),G=O.filter(R=>R.estado==="completado"),ce=de.map(R=>{const ie=le.filter(Me=>Me.proyectoId===R.id),fe=ie.length>0?ie.reduce((Me,Le)=>Me+(Le.avance||0),0)/ie.length:0;return{id:R.id,nombre:R.nombre,avance:Math.round(fe),acts:ie.length,fin:R.fin}}),V=ce.length>0?Math.round(ce.reduce((R,ie)=>R+ie.avance,0)/ce.length):0,Y=re.filter(R=>R.completado).length,W=re.filter(R=>!R.completado).length,se=ce.filter(R=>{if(!R.fin)return!1;const ie=Math.round((new Date(R.fin)-new Date)/864e5);return ie<0||ie<30&&R.avance<70}),ue=dn("habitaris_formularios").forms||[],ye=[];Ee.listSync("hab:briefing:").items.forEach(R=>{try{ye.push(JSON.parse(R.value))}catch{}});const I=[],N=ye.filter(R=>!I.includes(R.id)),q={};N.forEach(R=>{const ie=ue.find(Me=>Me.id===R.formularioId),fe=(ie==null?void 0:ie.modulo)||"general";q[fe]||(q[fe]=[]),q[fe].push({...R,_formNombre:(ie==null?void 0:ie.nombre)||R.formularioNombre||"Formulario"})});const J=[];return Object.entries(q).forEach(([R,ie])=>{const fe=R==="crm"?"CRM":R==="sst"?"SST":R.charAt(0).toUpperCase()+R.slice(1);J.push({mod:R,sev:"alta",icon:"",msg:`${ie.length} formulario${ie.length>1?"s":""} sin asignar en ${fe}`,color:Fe.purple,isForm:!0,count:ie.length})}),c>0&&J.push({mod:"admin",sev:"alta",icon:"",msg:`${f.filter(R=>R.estado==="vencida").length} CxC vencidas por $${wt(c)}`,color:Fe.red}),x>0&&J.push({mod:"admin",sev:"alta",icon:"",msg:`${p.filter(R=>R.estado==="vencida").length} CxP vencidas por $${wt(x)}`,color:Fe.red}),k.length>0&&J.push({mod:"admin",sev:"media",icon:"",msg:`${k.length} legalizaciones tarjeta pendientes ($${wt(k.reduce((R,ie)=>R+ie.monto,0))})`,color:Fe.amber}),v.length>0&&J.push({mod:"admin",sev:"media",icon:"",msg:`${v.length} solicitudes viticos pendientes`,color:Fe.amber}),m.neto<0&&J.push({mod:"admin",sev:"alta",icon:"",msg:`Flujo caja negativo este mes: $${wt(m.neto)}`,color:Fe.red}),P.length>0&&J.push({mod:"flotas",sev:"alta",icon:"",msg:`${P.length} documentos vehiculares vencidos`,color:Fe.red}),Se.length>0&&J.push({mod:"flotas",sev:"media",icon:"",msg:`${Se.length} documentos por vencer en 30 das`,color:Fe.amber}),te.length>0&&J.push({mod:"flotas",sev:"alta",icon:"",msg:`${te.length} mantenimientos vencidos`,color:Fe.red}),K>0&&J.push({mod:"flotas",sev:"baja",icon:"",msg:`${K} vehculos en taller`,color:Fe.blue}),A.length>0&&J.push({mod:"compras",sev:"media",icon:"",msg:`${A.length} OCs pendientes de aprobacin ($${wt(A.reduce((R,ie)=>R+ie.total,0))})`,color:Fe.amber}),E.length>0&&J.push({mod:"compras",sev:"baja",icon:"",msg:`${E.length} OCs esperando recepcin`,color:Fe.blue}),se.length>0&&J.push({mod:"proyectos",sev:"alta",icon:"",msg:`${se.length} proyecto${se.length>1?"s":""} con retraso: ${se.map(R=>R.nombre).join(", ")}`,color:Fe.red}),W>0&&J.push({mod:"proyectos",sev:"baja",icon:"",msg:`${W} hito${W>1?"s":""} pendiente${W>1?"s":""}`,color:Fe.blue}),{admin:{saldoCajas:j,tarjetaPend:k.length,viaticosPend:v.length,flujoMes:m,cxcVigente:d,cxcVencida:c,cxpVigente:l,cxpVencida:x},compras:{total:y.length,pendientes:A.length,totalCompras:w,recepciones:u.length,evals:S.length},flotas:{total:_.length,activos:Z,taller:K,docsVencidos:P.length,docsPorVencer:Se.length,mantosVencidos:te.length,gastoCombustible:ae},crm:{deals:U.length,ganados:M.length,totalVentas:B,pipeline:ee,enCurso:H.length},proyectos:{total:O.length,activos:de.length,completados:G.length,avancePromedio:V,actividades:le.length,hitosCompletos:Y,hitosPendientes:W,retrasados:se.length,avancesProy:ce},formularios:{total:ye.length,sinProcesar:N.length,sinProcesarPorModulo:q},alertas:J}},[])}function Em(){var p;const[t,i]=F.useState("general"),o=zm(),n=t==="general"?o.alertas:o.alertas.filter(d=>d.mod===t),a=n.filter(d=>d.sev==="alta"),r=({icon:d,label:c,value:l,sub:x,color:y,trend:u})=>e.jsx(mo,{style:{padding:"14px 16px",minWidth:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:[d," ",c]}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y||Fe.ink},children:l}),x&&e.jsx("div",{style:{fontSize:9,color:Fe.inkMid,marginTop:2},children:x})]}),u&&e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:u>=0?Fe.green:Fe.red,display:"flex",alignItems:"center",gap:2},children:[u>=0?e.jsx(Ji,{size:10}):e.jsx(Zc,{size:10})," ",u>=0?"+":"",u,"%"]})]})}),s=()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Ventas (ganadas)",value:`$${wt(o.crm.totalVentas)}`,sub:`${o.crm.ganados} proyectos ganados`,color:Fe.green}),e.jsx(r,{icon:"",label:"Pipeline activo",value:`$${wt(o.crm.pipeline)}`,sub:`${o.crm.enCurso} oportunidades`,color:Fe.blue}),e.jsx(r,{icon:"",label:"Flujo caja mes",value:`$${wt(o.admin.flujoMes.neto)}`,sub:`Ing: $${wt(o.admin.flujoMes.ing)}  Egr: $${wt(o.admin.flujoMes.egr)}`,color:o.admin.flujoMes.neto>=0?Fe.green:Fe.red}),e.jsx(r,{icon:"",label:"Compras activas",value:`$${wt(o.compras.totalCompras)}`,sub:`${o.compras.total} OCs  ${o.compras.pendientes} pendientes`,color:Fe.ink})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"CxC vigentes",value:`$${wt(o.admin.cxcVigente)}`,sub:o.admin.cxcVencida>0?` $${wt(o.admin.cxcVencida)} vencidas`:"",color:Fe.blue}),e.jsx(r,{icon:"",label:"CxP vigentes",value:`$${wt(o.admin.cxpVigente)}`,sub:o.admin.cxpVencida>0?` $${wt(o.admin.cxpVencida)} vencidas`:"",color:Fe.red}),e.jsx(r,{icon:"",label:"Flota",value:`${o.flotas.activos}/${o.flotas.total}`,sub:`${o.flotas.taller} en taller  $${wt(o.flotas.gastoCombustible)} combustible/mes`,color:Fe.ink}),e.jsx(r,{icon:"",label:"Saldo cajas chicas",value:`$${wt(o.admin.saldoCajas)}`,sub:`${o.admin.tarjetaPend} legaliz. pend.`,color:o.admin.saldoCajas>=0?Fe.green:Fe.red})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Proyectos activos",value:o.proyectos.activos,sub:`${o.proyectos.total} total  ${o.proyectos.completados} completados`,color:Fe.ink}),e.jsx(r,{icon:"",label:"Avance promedio",value:`${o.proyectos.avancePromedio}%`,color:o.proyectos.avancePromedio>=70?Fe.green:o.proyectos.avancePromedio>=40?Fe.amber:Fe.red}),e.jsx(r,{icon:"",label:"Retrasados",value:o.proyectos.retrasados,color:o.proyectos.retrasados>0?Fe.red:Fe.green}),e.jsx(r,{icon:"",label:"Formularios sin asignar",value:o.formularios.sinProcesar,color:o.formularios.sinProcesar>0?Fe.purple:Fe.green,sub:o.formularios.sinProcesar>0?Object.entries(o.formularios.sinProcesarPorModulo).map(([d,c])=>`${d}: ${c.length}`).join("  "):"Todo al da"})]}),o.formularios.sinProcesar>0&&e.jsx(mo,{style:{padding:"14px 18px",marginBottom:20,background:"#F3EEFF",border:"1px solid #5B3A8C33"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"#5B3A8C",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,flexShrink:0},children:o.formularios.sinProcesar}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#5B3A8C"},children:" Formularios sin asignar"}),e.jsxs("div",{style:{fontSize:10,color:"#7A5AAA",marginTop:2},children:[Object.entries(o.formularios.sinProcesarPorModulo).map(([d,c])=>{const l=d==="crm"?"CRM/Ofertas":d==="sst"?"SST":d.charAt(0).toUpperCase()+d.slice(1);return`${c.length} en ${l}`}).join("  "),"  ","Ve a ",e.jsx("strong",{children:"Formularios  Respuestas"})," para procesar"]})]})]})})]}),f={general:s,admin:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Saldo cajas chicas",value:`$${wt(o.admin.saldoCajas)}`,color:o.admin.saldoCajas>=0?Fe.green:Fe.red}),e.jsx(r,{icon:"",label:"Legaliz. pendientes",value:o.admin.tarjetaPend,color:o.admin.tarjetaPend>0?Fe.amber:Fe.green}),e.jsx(r,{icon:"",label:"Viticos pendientes",value:o.admin.viaticosPend,color:o.admin.viaticosPend>0?Fe.amber:Fe.green}),e.jsx(r,{icon:"",label:"Flujo neto mes",value:`$${wt(o.admin.flujoMes.neto)}`,color:o.admin.flujoMes.neto>=0?Fe.green:Fe.red})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"CxC vigentes",value:`$${wt(o.admin.cxcVigente)}`,color:Fe.blue}),e.jsx(r,{icon:"",label:"CxC vencidas",value:`$${wt(o.admin.cxcVencida)}`,color:o.admin.cxcVencida>0?Fe.red:Fe.green}),e.jsx(r,{icon:"",label:"CxP vigentes",value:`$${wt(o.admin.cxpVigente)}`,color:Fe.amber}),e.jsx(r,{icon:"",label:"CxP vencidas",value:`$${wt(o.admin.cxpVencida)}`,color:o.admin.cxpVencida>0?Fe.red:Fe.green})]})]}),compras:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total OCs",value:o.compras.total,color:Fe.ink}),e.jsx(r,{icon:"",label:"OCs pendientes",value:o.compras.pendientes,color:o.compras.pendientes>0?Fe.amber:Fe.green}),e.jsx(r,{icon:"",label:"Valor compras",value:`$${wt(o.compras.totalCompras)}`,color:Fe.ink}),e.jsx(r,{icon:"",label:"Recepciones",value:o.compras.recepciones,color:Fe.blue})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Evaluaciones proveedores",value:o.compras.evals,color:Fe.ink}),e.jsxs(mo,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:" Tasa de recepcin"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Fe.green},children:[o.compras.total>0?Math.round(o.compras.recepciones/o.compras.total*100):0,"%"]})]})]})]}),flotas:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total vehculos",value:o.flotas.total,sub:`${o.flotas.activos} activos`,color:Fe.ink}),e.jsx(r,{icon:"",label:"En taller",value:o.flotas.taller,color:o.flotas.taller>0?Fe.amber:Fe.green}),e.jsx(r,{icon:"",label:"Combustible mes",value:`$${wt(o.flotas.gastoCombustible)}`,color:Fe.red}),e.jsx(r,{icon:"",label:"Docs vencidos",value:o.flotas.docsVencidos,sub:`${o.flotas.docsPorVencer} por vencer`,color:o.flotas.docsVencidos>0?Fe.red:Fe.green})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Mantenimientos vencidos",value:o.flotas.mantosVencidos,color:o.flotas.mantosVencidos>0?Fe.red:Fe.green}),e.jsx(r,{icon:"",label:"Docs por vencer (30d)",value:o.flotas.docsPorVencer,color:o.flotas.docsPorVencer>0?Fe.amber:Fe.green})]})]}),rrhh:()=>e.jsx("div",{className:"fade-up",children:e.jsxs(mo,{style:{padding:20,textAlign:"center",color:Fe.inkMid},children:[e.jsx(Bi,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Los KPIs de RRHH se alimentan del mdulo de RRHH."}),e.jsxs("p",{style:{fontSize:10,color:Fe.inkXLight},children:["Viticos pendientes: ",o.admin.viaticosPend]})]})}),crm:()=>e.jsx("div",{className:"fade-up",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total ofertas",value:o.crm.deals,color:Fe.ink}),e.jsx(r,{icon:"",label:"Ganadas",value:o.crm.ganados,color:Fe.green}),e.jsx(r,{icon:"",label:"Ventas totales",value:`$${wt(o.crm.totalVentas)}`,color:Fe.green}),e.jsx(r,{icon:"",label:"Pipeline",value:`$${wt(o.crm.pipeline)}`,sub:`${o.crm.enCurso} activas`,color:Fe.blue})]})}),proyectos:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total proyectos",value:o.proyectos.total,sub:`${o.proyectos.activos} activos  ${o.proyectos.completados} completados`,color:Fe.ink}),e.jsx(r,{icon:"",label:"Avance promedio",value:`${o.proyectos.avancePromedio}%`,color:o.proyectos.avancePromedio>=70?Fe.green:o.proyectos.avancePromedio>=40?Fe.amber:Fe.red}),e.jsx(r,{icon:"",label:"Retrasados",value:o.proyectos.retrasados,color:o.proyectos.retrasados>0?Fe.red:Fe.green}),e.jsx(r,{icon:"",label:"Hitos",value:`${o.proyectos.hitosCompletos}/${o.proyectos.hitosCompletos+o.proyectos.hitosPendientes}`,sub:`${o.proyectos.hitosPendientes} pendientes`,color:Fe.blue})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Actividades totales",value:o.proyectos.actividades,color:Fe.ink}),e.jsxs(mo,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:" Tasa de completitud"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Fe.green},children:[o.proyectos.total>0?Math.round(o.proyectos.completados/o.proyectos.total*100):0,"%"]})]})]}),(o.proyectos.avancesProy||[]).length>0&&e.jsxs(mo,{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,marginBottom:10},children:" Avance por proyecto activo"}),o.proyectos.avancesProy.map(d=>e.jsxs("div",{style:{marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3},children:[e.jsx("span",{style:{fontSize:10,fontWeight:600},children:d.nombre}),e.jsxs("span",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:d.avance>=70?Fe.green:d.avance>=40?Fe.amber:Fe.red},children:[d.avance,"%"]})]}),e.jsx("div",{style:{height:8,background:Fe.accent,borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{width:`${d.avance}%`,height:"100%",borderRadius:4,background:d.avance>=70?Fe.green:d.avance>=40?Fe.amber:Fe.red,transition:"width .3s"}})}),e.jsxs("div",{style:{fontSize:8,color:Fe.inkLight,marginTop:2},children:[d.acts," actividades  Fin: ",d.fin||""]})]},d.id))]})]})}[t]||s;return e.jsxs(e.Fragment,{children:[e.jsx(km,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Dashboard"}),e.jsxs("div",{style:{fontSize:10,color:Fe.inkMid},children:["Vista consolidada de la empresa  ",new Date().toLocaleDateString("es-CO",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:vs.map((d,c)=>e.jsx("button",{onClick:()=>i(d.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${Fe.border}`,borderLeft:c>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:c===0?"6px 0 0 6px":c===vs.length-1?"0 6px 6px 0":"0",background:t===d.id?d.color:"#fff",color:t===d.id?"#fff":Fe.inkMid},children:d.lbl},d.id))}),e.jsx(f,{}),n.length>0&&e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,marginBottom:10,display:"flex",alignItems:"center",gap:6},children:[e.jsx(li,{size:14,color:a.length>0?Fe.red:Fe.amber}),"Alertas ",t!=="general"&&` ${((p=vs.find(d=>d.id===t))==null?void 0:p.lbl)||""}`,e.jsx(ys,{color:a.length>0?Fe.red:Fe.amber,children:n.length})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:n.sort((d,c)=>{const l={alta:0,media:1,baja:2};return(l[d.sev]||2)-(l[c.sev]||2)}).map((d,c)=>e.jsxs("div",{style:{background:d.sev==="alta"?Fe.redBg:d.sev==="media"?Fe.amberBg:Fe.blueBg,border:`1px solid ${d.color}33`,borderRadius:6,padding:"8px 14px",display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:16},children:d.icon}),e.jsx("div",{style:{flex:1,fontSize:10,fontWeight:600,color:d.color},children:d.msg}),e.jsx(ys,{color:d.color,children:d.sev}),t==="general"&&e.jsx(ys,{color:Fe.inkLight,children:d.mod})]},c))})]}),n.length===0&&e.jsxs(mo,{style:{textAlign:"center",padding:20,color:Fe.green,marginBottom:20},children:[e.jsx("div",{style:{fontSize:16,marginBottom:4},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Sin alertas activas"}),e.jsx("div",{style:{fontSize:10,color:Fe.inkMid},children:"Todo en orden"})]}),(t==="general"||t==="admin")&&e.jsxs(mo,{style:{marginBottom:20},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:12},children:" Flujo de caja empresa  Mes actual"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:16},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Ingresos"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Fe.green},children:["$",wt(o.admin.flujoMes.ing)]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Egresos"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Fe.red},children:["$",wt(o.admin.flujoMes.egr)]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Neto"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:o.admin.flujoMes.neto>=0?Fe.green:Fe.red},children:["$",wt(o.admin.flujoMes.neto)]})]})]}),e.jsxs("div",{style:{marginTop:12,height:16,background:Fe.accent,borderRadius:8,overflow:"hidden",display:"flex"},children:[o.admin.flujoMes.ing>0&&e.jsx("div",{style:{width:`${o.admin.flujoMes.ing/(o.admin.flujoMes.ing+o.admin.flujoMes.egr)*100}%`,background:Fe.green,borderRadius:"8px 0 0 8px",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:7,color:"#fff",fontWeight:700},children:"Ingresos"})}),o.admin.flujoMes.egr>0&&e.jsx("div",{style:{width:`${o.admin.flujoMes.egr/(o.admin.flujoMes.ing+o.admin.flujoMes.egr)*100}%`,background:Fe.red,borderRadius:"0 8px 8px 0",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:7,color:"#fff",fontWeight:700},children:"Egresos"})})]})]}),e.jsx("div",{style:{textAlign:"center",padding:"10px 0",fontSize:9,color:Fe.inkXLight},children:"Habitaris Suite  Dashboard actualizado en tiempo real desde cloud store"})]})]})}const or="habitaris_config",Po={empresa:{nombre:"Habitaris",razonSocial:"Habitaris S.A.S.",nit:"901.922.136-8",eslogan:"Diseo  Interiorismo  Arquitectura",domicilio:"Bogot D.C.",telefono:"+57 350 5661545",web:"habitaris.co"},correo:{emailPrincipal:"comercial@habitaris.co",emailjs_serviceId:"service_6x3478l",emailjs_templateId:"template_lzgrxc6",emailjs_publicKey:"64nk2FHknwpLqc1p4"},app:{url:"https://habitaris-suite.vercel.app"},whatsapp:{numero:"573505661545",mensajePlantilla:`Hola {{nombre}},

 *{{formulario}}*

Te adjunto el formulario para que lo completes. brelo en tu navegador.

Gracias.

 {{empresa}}`},legal:{avisoPrivacidad:"En {{razonSocial}} (NIT {{nit}}, domicilio {{domicilio}}, email: {{email}}, tel: {{telefono}}), tratamos tus datos personales para procesar tu solicitud de briefing, enviar cotizaciones y gestionar proyectos. Cumplimos con la Ley 1581/2012 y Rgimen de Proteccin de Datos. Derechos (acceso, rectificacin, supresin, revocacin): va {{email}}.",habeasData:"Al enviar este formulario autorizo a {{razonSocial}}, para el uso de mis datos personales con el fin de elaborar propuestas de diseo, coordinar servicios relacionados y, en caso de ser necesario, compartirlos con proveedores o contratistas de confianza exclusivamente para la correcta ejecucin del proyecto. En todo momento se garantizar la confidencialidad y proteccin de mi informacin, conforme a la normativa de Habeas Data en Colombia (Ley 1581 de 2012).",confirmacion:"La informacin entregada es verdica y ser utilizada nicamente para la elaboracin de la propuesta de diseo. {{razonSocial}} garantiza la confidencialidad de los datos y no los compartir con terceros, salvo con proveedores o contratistas de confianza cuando sea necesario para la correcta ejecucin del proyecto, previa autorizacin del cliente."},formularios:{mensajeExitoDefault:"Gracias por completar el formulario. Nos pondremos en contacto pronto.",firmaEmail:`{{razonSocial}}
{{eslogan}}`},apariencia:{logo:"",colorPrimario:"#111111",colorSecundario:"#3B3B3B",colorAcento:"#111111",tipografia:"DM Sans",slogan:"Diseo  Interiorismo  Arquitectura"},supabase:{url:"https://xlzkasdskatnikuavefh.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM"}};function vi(){var t,i;try{const o=Ee.getSync(or);if(!o)return Ee.set(or,JSON.stringify(Po)),Po;const n=JSON.parse(o),a=zc(Po,n);return(t=a.supabase)!=null&&t.url||(a.supabase={...a.supabase,url:Po.supabase.url}),(i=a.supabase)!=null&&i.anonKey||(a.supabase={...a.supabase,anonKey:Po.supabase.anonKey}),Ee.set(or,JSON.stringify(a)),a}catch{return Po}}function Am(t,i){if(!t)return t;const o=i||vi();return t.replace(/\{\{razonSocial\}\}/g,o.empresa.razonSocial).replace(/\{\{nit\}\}/g,o.empresa.nit).replace(/\{\{domicilio\}\}/g,o.empresa.domicilio).replace(/\{\{email\}\}/g,o.correo.emailPrincipal).replace(/\{\{telefono\}\}/g,o.empresa.telefono).replace(/\{\{empresa\}\}/g,o.empresa.nombre).replace(/\{\{eslogan\}\}/g,o.empresa.eslogan).replace(/\{\{web\}\}/g,o.empresa.web)}function zc(t,i){const o={...t};for(const n of Object.keys(i))i[n]&&typeof i[n]=="object"&&!Array.isArray(i[n])&&t[n]?o[n]=zc(t[n],i[n]):o[n]=i[n];return o}const Ve={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",green:"#111111",greenBg:"#E8F4EE",blue:"#3B3B3B",blueBg:"#F0F0F0",amber:"#8C6A00",amberBg:"#FFF4E0",red:"#B91C1C",redBg:"#FAE8E8",purple:"#5B3A8C",gold:"#111111",shadow:"0 1px 4px rgba(0,0,0,.06)"},Fm={fontFamily:"'DM Sans',sans-serif"},js=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Ve.surface,border:`1px solid ${Ve.border}`,borderRadius:8,padding:16,boxShadow:Ve.shadow,...i},...o,children:t}),yr=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${Ve.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?Ve.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),ha={border:`1px solid ${Ve.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff",width:"100%"},md=[{id:"empresa",label:"Empresa",icon:Ed,color:Ve.ink},{id:"correo",label:"Correo / EmailJS",icon:An,color:Ve.blue},{id:"app",label:"App / Deploy",icon:tp,color:Ve.green},{id:"whatsapp",label:"WhatsApp",icon:jr,color:"#25D366"},{id:"legal",label:"Textos legales",icon:Bn,color:Ve.red},{id:"formularios",label:"Formularios",icon:Et,color:Ve.purple},{id:"apariencia",label:"Marca / Apariencia",icon:ip,color:Ve.gold},{id:"supabase",label:"Base de datos",icon:lr,color:"#3ECF8E"}],Tm={empresa:[{key:"nombre",label:"Nombre comercial",placeholder:"Habitaris"},{key:"razonSocial",label:"Razn social",placeholder:"Habitaris S.A.S."},{key:"nit",label:"NIT",placeholder:"901.922.136-8"},{key:"eslogan",label:"Eslogan / Subttulo",placeholder:"Diseo  Interiorismo  Arquitectura"},{key:"domicilio",label:"Domicilio",placeholder:"Bogot D.C."},{key:"telefono",label:"Telfono principal",placeholder:"+57 350 5661545"},{key:"web",label:"Sitio web / dominio",placeholder:"habitaris.co"}],correo:[{key:"emailPrincipal",label:"Email principal (remitente)",placeholder:"comercial@habitaris.co"},{key:"emailjs_serviceId",label:"EmailJS Service ID",placeholder:"service_xxxxxxx"},{key:"emailjs_templateId",label:"EmailJS Template ID",placeholder:"template_xxxxxxx"},{key:"emailjs_publicKey",label:"EmailJS Public Key",placeholder:"xxxxxxxxxxxxxxxxx"}],app:[{key:"url",label:"URL de la app (Vercel)",placeholder:"https://habitaris-suite.vercel.app"}],whatsapp:[{key:"numero",label:"Nmero WhatsApp (con cdigo pas)",placeholder:"573505661545"},{key:"mensajePlantilla",label:"Mensaje plantilla",placeholder:`Hola {{nombre}},
 *{{formulario}}*...`,area:!0}],legal:[{key:"avisoPrivacidad",label:"Aviso de privacidad",placeholder:"En {{razonSocial}} (NIT {{nit}}...",area:!0},{key:"habeasData",label:"Autorizacin habeas data (Ley 1581)",placeholder:"Al enviar este formulario autorizo a {{razonSocial}}...",area:!0},{key:"confirmacion",label:"Texto de confirmacin",placeholder:"La informacin entregada es verdica...",area:!0}],formularios:[{key:"mensajeExitoDefault",label:"Mensaje de xito por defecto",placeholder:"Gracias por completar el formulario."},{key:"firmaEmail",label:"Firma en emails",placeholder:`{{razonSocial}}
{{eslogan}}`,area:!0}],apariencia:[{key:"colorPrimario",label:"Color primario (header, botones)",placeholder:"#111111",color:!0},{key:"colorSecundario",label:"Color secundario (enlaces, badges)",placeholder:"#3B3B3B",color:!0},{key:"colorAcento",label:"Color acento (destacados, progreso)",placeholder:"#111111",color:!0},{key:"slogan",label:"Slogan / Tagline",placeholder:"Diseo  Interiorismo  Arquitectura"}],supabase:[{key:"url",label:"Project URL",placeholder:"https://xxxxx.supabase.co"},{key:"anonKey",label:"Anon Public Key",placeholder:"eyJhbGciOiJIUzI1NiIs..."}]};function Bm(){var m,f;const[t,i]=F.useState(()=>vi()),[o,n]=F.useState("empresa"),[a,r]=F.useState(!1),[s,g]=F.useState(!1),h=(p,d,c)=>{i(l=>({...l,[p]:{...l[p],[d]:c}})),g(!0),r(!1)},b=()=>{Ee.set(or,JSON.stringify(t)),g(!1),r(!0),setTimeout(()=>r(!1),3e3)},j=()=>{confirm("Restablecer toda la configuracin a los valores por defecto? Se perdern los cambios.")&&(Ee.delete(or),i(Po),g(!1))},k=md.find(p=>p.id===o),v=Tm[o]||[];return e.jsxs("div",{style:{...Fm,maxWidth:1100,margin:"0 auto",padding:"20px 16px 80px"},children:[e.jsx("style",{children:`
        .fade-up{animation:fadeUp .3s ease}
        @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .cfg-inp:focus{outline:none;border-color:${Ve.green}!important;box-shadow:0 0 0 2px ${Ve.green}22}
      `}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:22,fontWeight:700},children:" Configuracin"}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:11,color:Ve.inkMid},children:"Ajustes generales de la aplicacin  Todos los mdulos leen de aqu"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s&&e.jsx("span",{style:{fontSize:9,color:Ve.amber,fontWeight:600},children:" Sin guardar"}),a&&e.jsx("span",{style:{fontSize:9,color:Ve.green,fontWeight:600},children:" Guardado"}),e.jsxs(yr,{v:"sec",on:j,children:[e.jsx(ep,{size:10})," Restablecer"]}),e.jsxs(yr,{on:b,children:[e.jsx(wo,{size:10})," Guardar configuracin"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx(js,{style:{padding:8},children:md.map(p=>{const d=p.icon,c=o===p.id;return e.jsxs("button",{onClick:()=>n(p.id),style:{display:"flex",alignItems:"center",gap:8,width:"100%",padding:"8px 10px",border:"none",borderRadius:6,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:c?"#111":"transparent",color:c?"#fff":Ve.inkMid,fontSize:11,fontWeight:c?700:500,textAlign:"left",transition:"all .15s",marginBottom:2},children:[e.jsx(d,{size:13,color:c?"#fff":p.color}),p.label]},p.id)})}),e.jsxs(js,{style:{marginTop:12,padding:"12px 14px",background:Ve.blueBg,border:`1px solid ${Ve.blue}22`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ve.blue,textTransform:"uppercase",marginBottom:4},children:" Variables dinmicas"}),e.jsxs("div",{style:{fontSize:9,color:Ve.blue,lineHeight:1.6},children:["En textos legales puedes usar:",e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{razonSocial}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{nit}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{email}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{telefono}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{domicilio}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{empresa}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{eslogan}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{web}}"}),e.jsx("br",{}),"Se reemplazan automticamente."]})]})]}),e.jsx("div",{style:{flex:1},className:"fade-up",children:e.jsxs(js,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[k&&e.jsx(k.icon,{size:16,color:k.color}),e.jsx("h2",{style:{margin:0,fontSize:16,fontWeight:700},children:k==null?void 0:k.label})]}),o==="apariencia"&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:20,borderBottom:`1px solid ${Ve.border}`,paddingBottom:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:8},children:" Logo de la empresa"}),e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:[e.jsx("div",{style:{width:120,height:60,border:`2px dashed ${Ve.border}`,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",background:"#fff",flexShrink:0},children:(m=t.apariencia)!=null&&m.logo?e.jsx("img",{src:t.apariencia.logo,alt:"Logo",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}):e.jsx("span",{style:{fontSize:9,color:Ve.inkLight},children:"Sin logo"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("input",{type:"file",accept:"image/png,image/svg+xml,image/jpeg",onChange:p=>{var l;const d=(l=p.target.files)==null?void 0:l[0];if(!d)return;if(d.size>5e5){alert("El logo debe pesar menos de 500KB");return}const c=new FileReader;c.onload=x=>h("apariencia","logo",x.target.result),c.readAsDataURL(d)},style:{fontSize:10,marginBottom:6}}),e.jsx("div",{style:{fontSize:8,color:Ve.inkLight},children:"PNG, SVG o JPG  mx 500KB  Se usa en header, formularios, PDFs y emails"}),((f=t.apariencia)==null?void 0:f.logo)&&e.jsx("button",{onClick:()=>h("apariencia","logo",""),style:{marginTop:4,fontSize:9,color:Ve.red,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar logo"})]})]})]})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:14},children:v.map(p=>{var d,c,l,x;return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:4,letterSpacing:.5},children:p.label}),p.color?e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"color",value:((d=t[o])==null?void 0:d[p.key])||p.placeholder,onChange:y=>h(o,p.key,y.target.value),style:{width:40,height:32,border:"none",borderRadius:4,cursor:"pointer"}}),e.jsx("input",{className:"cfg-inp",value:((c=t[o])==null?void 0:c[p.key])||"",onChange:y=>h(o,p.key,y.target.value),placeholder:p.placeholder,style:{...ha,width:140,fontFamily:"'DM Mono',monospace",fontSize:10}})]}):p.area?e.jsx("textarea",{className:"cfg-inp",rows:4,value:((l=t[o])==null?void 0:l[p.key])||"",onChange:y=>h(o,p.key,y.target.value),placeholder:p.placeholder,style:{...ha,resize:"vertical",lineHeight:1.6}}):e.jsx("input",{className:"cfg-inp",value:((x=t[o])==null?void 0:x[p.key])||"",onChange:y=>h(o,p.key,y.target.value),placeholder:p.placeholder,style:ha})]},p.key)})}),o==="legal"&&e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ve.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:8},children:" Vista previa (variables reemplazadas)"}),v.map(p=>{var d;return e.jsxs("div",{style:{marginBottom:10,padding:"8px 12px",background:Ve.bg,borderRadius:4,border:`1px solid ${Ve.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ve.inkLight,marginBottom:3},children:p.label}),e.jsx("div",{style:{fontSize:10,color:Ve.ink,lineHeight:1.5,whiteSpace:"pre-wrap"},children:Am(((d=t.legal)==null?void 0:d[p.key])||"",t)})]},p.key)})]}),o==="apariencia"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ve.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:8},children:" Tipografa"}),e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=DM Sans:wght@400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap');"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:["DM Sans","Inter","Poppins","DM Sans","Playfair Display"].map(p=>{var c,l;const d=(((c=t.apariencia)==null?void 0:c.tipografia)||"DM Sans")===p;return e.jsxs("button",{onClick:()=>h("apariencia","tipografia",p),style:{padding:"10px 16px",borderRadius:8,cursor:"pointer",fontFamily:`'${p}',sans-serif`,border:d?`2px solid ${((l=t.apariencia)==null?void 0:l.colorPrimario)||"#111"}`:`1px solid ${Ve.border}`,background:d?"#111":"#fff",color:d?"#fff":Ve.ink,fontSize:13,fontWeight:600,transition:"all .15s",minWidth:100,textAlign:"center"},children:[e.jsx("div",{children:p}),e.jsx("div",{style:{fontSize:9,fontWeight:400,marginTop:2,opacity:.6},children:"Aa Bb Cc 123"})]},p)})})]}),e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ve.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:8},children:" Paletas predefinidas"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[{name:"Elegante oscuro",p:"#111111",s:"#3B3B3B",a:"#111111"},{name:"Profesional azul",p:"#1E3A5F",s:"#2E7D96",a:"#E8B931"},{name:"Natural verde",p:"#1B4332",s:"#52796F",a:"#D4A373"},{name:"Moderno violeta",p:"#2D1B69",s:"#5B3A8C",a:"#F4A261"},{name:"Clido terracota",p:"#6B3A2A",s:"#A0522D",a:"#DEB887"},{name:"Minimalista",p:"#333333",s:"#666666",a:"#999999"}].map(p=>e.jsxs("button",{onClick:()=>{h("apariencia","colorPrimario",p.p),h("apariencia","colorSecundario",p.s),h("apariencia","colorAcento",p.a)},style:{padding:"8px 12px",borderRadius:6,cursor:"pointer",border:`1px solid ${Ve.border}`,background:"#fff",fontFamily:"'DM Sans',sans-serif",textAlign:"center",transition:"all .15s"},children:[e.jsxs("div",{style:{display:"flex",gap:4,marginBottom:4,justifyContent:"center"},children:[e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.p}}),e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.s}}),e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.a}})]}),e.jsx("div",{style:{fontSize:8,color:Ve.inkMid,fontWeight:600},children:p.name})]},p.name))})]}),e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ve.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:8},children:" Vista previa en vivo"}),(()=>{var S,A,E,w;const p=t.apariencia||{},d=p.colorPrimario||"#111",c=p.colorSecundario||"#3B3B3B",l=p.colorAcento||"#111111",x=p.tipografia||"DM Sans",y=p.slogan||((S=t.empresa)==null?void 0:S.eslogan)||"Diseo  Interiorismo  Arquitectura",u=((A=t.empresa)==null?void 0:A.nombre)||"Habitaris";return e.jsxs("div",{style:{borderRadius:10,overflow:"hidden",border:`1px solid ${Ve.border}`,boxShadow:"0 2px 12px rgba(0,0,0,.08)"},children:[e.jsxs("div",{style:{background:d,padding:"14px 20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p.logo?e.jsx("img",{src:p.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("div",{style:{fontFamily:`'${x}',sans-serif`,fontWeight:700,fontSize:14,letterSpacing:3,color:"#fff",textTransform:"uppercase"},children:u}),e.jsx("div",{style:{fontSize:7,letterSpacing:2,color:"rgba(255,255,255,.4)",textTransform:"uppercase",fontFamily:`'${x}',sans-serif`},children:y})]}),e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,.5)",fontFamily:`'${x}',sans-serif`},children:"Paso 1 de 5"})]}),e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${l},${l}88,${l})`}}),e.jsxs("div",{style:{padding:"20px 24px",background:"#fff"},children:[e.jsx("h3",{style:{fontFamily:`'${x}',sans-serif`,fontSize:16,fontWeight:700,margin:"0 0 4px",color:d},children:"Briefing Inicial"}),e.jsx("p",{style:{fontFamily:`'${x}',sans-serif`,fontSize:11,color:"#888",margin:"0 0 14px"},children:"Cuntanos sobre tu proyecto"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsx("div",{style:{padding:"6px 14px",borderRadius:16,background:d,color:"#fff",fontSize:10,fontWeight:600,fontFamily:`'${x}',sans-serif`},children:"Diseo interior"}),e.jsx("div",{style:{padding:"6px 14px",borderRadius:16,border:`1px solid ${Ve.border}`,color:Ve.inkMid,fontSize:10,fontWeight:400,fontFamily:`'${x}',sans-serif`},children:"Obra nueva"})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{style:{padding:"8px 20px",background:d,color:"#fff",border:"none",borderRadius:6,fontSize:11,fontWeight:700,fontFamily:`'${x}',sans-serif`,cursor:"default"},children:"Siguiente "}),e.jsx("button",{style:{padding:"8px 20px",background:"#fff",color:c,border:`1px solid ${c}44`,borderRadius:6,fontSize:11,fontWeight:600,fontFamily:`'${x}',sans-serif`,cursor:"default"},children:" Atrs"})]})]}),e.jsxs("div",{style:{padding:"10px 24px",background:Ve.bg,borderTop:`1px solid ${Ve.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontFamily:`'${x}',sans-serif`,fontSize:9,color:Ve.inkLight},children:[((E=t.empresa)==null?void 0:E.razonSocial)||"Empresa S.A.S.","  ",((w=t.empresa)==null?void 0:w.domicilio)||"Bogot"]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:d}}),e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:c}}),e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:l}})]})]})]})})()]})]}),o==="correo"&&e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ve.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:8},children:" Probar conexin"}),e.jsx(Im,{config:t})]}),o==="supabase"&&e.jsx("div",{style:{marginTop:20,borderTop:`1px solid ${Ve.border}`,paddingTop:14},children:e.jsx(Rm,{config:t})})]})},o)]})]})}function Im({config:t}){const[i,o]=F.useState(""),[n,a]=F.useState(""),[r,s]=F.useState(!1),g=async()=>{if(i){s(!0),a("Enviando...");try{const h=await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:t.correo.emailjs_serviceId,template_id:t.correo.emailjs_templateId,user_id:t.correo.emailjs_publicKey,template_params:{client_name:"Test",client_email:i,form_name:"Email de prueba",from_name:t.empresa.nombre,form_link:"Este es un email de prueba desde Habitaris."}})});a(h.ok?" Email enviado correctamente":" Error: "+h.status)}catch(h){a(" Error: "+h.message)}s(!1)}};return e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase"},children:"Email de prueba"}),e.jsx("input",{value:i,onChange:h=>o(h.target.value),placeholder:"tu@email.com",style:ha})]}),e.jsxs(yr,{on:g,disabled:r,style:{whiteSpace:"nowrap"},children:[e.jsx(An,{size:10})," ",r?"Enviando...":"Enviar test"]}),n&&e.jsx("span",{style:{fontSize:9,color:n.startsWith("")?Ve.green:n.startsWith("")?Ve.red:Ve.amber,fontWeight:600},children:n})]})}function Rm({config:t}){var f,p,d,c;const[i,o]=F.useState(!1),[n,a]=F.useState(""),[r,s]=F.useState(!1),[g,h]=F.useState(null),[b,j]=F.useState(!1),k=async()=>{o(!0),a("Probando...");const l=await th();a(l.ok?" Conexin exitosa":" "+l.error),o(!1)},v=async()=>{s(!0),h(null);const l=await ih();h(l),s(!1)},m=((f=t.supabase)==null?void 0:f.url)&&((p=t.supabase)==null?void 0:p.anonKey);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#E8F8EE",border:"1px solid #3ECF8E33",borderRadius:6},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#1B7A4B",marginBottom:4},children:" Cmo configurar Supabase?"}),e.jsxs("div",{style:{fontSize:10,color:"#2D6A4F",lineHeight:1.6},children:["1. Ve a ",e.jsx("strong",{children:"supabase.com"}),"  Crea cuenta gratis",e.jsx("br",{}),"2. Nuevo proyecto  Nombre: ",e.jsx("code",{style:{fontSize:9},children:"habitaris-suite"}),"  Regin: So Paulo",e.jsx("br",{}),"3. Settings  API  Copia ",e.jsx("strong",{children:"Project URL"})," y ",e.jsx("strong",{children:"anon public"})," key",e.jsx("br",{}),"4. Pgalos arriba y guarda configuracin",e.jsx("br",{}),'5. Haz clic en "Crear tablas" abajo']})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:8},children:" Probar conexin"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs(yr,{on:k,v:m?"":"sec",disabled:i||!m,children:[e.jsx(lr,{size:10})," ",i?"Probando...":"Probar conexin"]}),n&&e.jsx("span",{style:{fontSize:9,fontWeight:600,color:n.startsWith("")?Ve.green:n.startsWith("")?Ve.red:Ve.amber},children:n}),!m&&e.jsx("span",{style:{fontSize:9,color:Ve.amber},children:" Primero configura URL y Key arriba"})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:8},children:" Crear tablas"}),e.jsxs("p",{style:{fontSize:10,color:Ve.inkMid,marginBottom:8},children:["Se crearn 3 tablas: ",e.jsx("code",{style:{fontSize:9},children:"form_events"})," (estadsticas), ",e.jsx("code",{style:{fontSize:9},children:"form_responses"})," (respuestas), ",e.jsx("code",{style:{fontSize:9},children:"form_links"})," (enlaces)."]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(yr,{on:v,v:"sec",disabled:r||!m,children:r?"Creando...":" Verificar / Crear tablas"}),e.jsxs("button",{onClick:()=>j(!b),style:{fontSize:9,color:Ve.blue,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textDecoration:"underline"},children:[b?"Ocultar":"Ver"," SQL manual"]})]}),g&&e.jsx("div",{style:{marginTop:10,padding:"10px 14px",borderRadius:6,background:g.ok?"#E8F8EE":"#FFF4E0",border:`1px solid ${g.ok?"#3ECF8E":"#F59E0B"}33`},children:g.ok?e.jsxs("span",{style:{fontSize:10,color:"#1B7A4B",fontWeight:600},children:[" ",g.msg||"Tablas listas"]}):g.error==="manual_sql"?e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:10,color:Ve.amber,fontWeight:600},children:[" Tablas faltantes: ",g.missing.join(", ")]}),e.jsx("p",{style:{fontSize:9,color:Ve.inkMid,marginTop:4},children:'Necesitas ejecutar el SQL manualmente en Supabase  SQL Editor. Haz clic en "Ver SQL manual" y copia el cdigo.'})]}):e.jsxs("span",{style:{fontSize:10,color:Ve.red,fontWeight:600},children:[" ",g.error]})}),b&&e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase"},children:"SQL para copiar en Supabase  SQL Editor"}),e.jsx("button",{onClick:()=>{var l;(l=navigator.clipboard)==null||l.writeText(Ps()),alert(" SQL copiado")},style:{fontSize:9,color:Ve.blue,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Copiar"})]}),e.jsx("pre",{style:{fontSize:9,background:"#1a1a2e",color:"#e0e0e0",padding:14,borderRadius:6,overflow:"auto",maxHeight:300,lineHeight:1.5,fontFamily:"'DM Mono',monospace"},children:Ps()})]})]}),m&&e.jsxs("div",{style:{padding:"10px 14px",background:Ve.bg,borderRadius:6,border:`1px solid ${Ve.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ve.inkMid,textTransform:"uppercase",marginBottom:6},children:"Estado de conexin"}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{fontSize:10},children:[e.jsx("span",{style:{color:"#3ECF8E",fontWeight:700},children:""})," URL: ",e.jsxs("code",{style:{fontSize:9},children:[(d=t.supabase.url)==null?void 0:d.replace("https://","").slice(0,20),"..."]})]}),e.jsxs("div",{style:{fontSize:10},children:[e.jsx("span",{style:{color:"#3ECF8E",fontWeight:700},children:""})," Key: ",e.jsxs("code",{style:{fontSize:9},children:[(c=t.supabase.anonKey)==null?void 0:c.slice(0,20),"..."]})]})]})]})]})}const _m=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),xe={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#111111",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},ht=()=>Math.random().toString(36).slice(2,10),Ki=()=>new Date().toISOString().split("T")[0],Mm={fontFamily:"'DM Sans',sans-serif"};function Ss(t,i){if(!(i!=null&&i.campos))return null;const o=i.campos.filter(m=>{var f;return(f=m.scoring)==null?void 0:f.enabled});if(o.length===0)return null;let n=0,a=0,r=0,s=0,g=0;const h=[];o.forEach(m=>{const f=m.scoring.weight||1,p=m.mapKey||m.id;let d=t[p];if(d===void 0)return;a+=f;const c=m.scoring.rules||{};let l="neutral";if(Array.isArray(d)){const y=d.map(u=>c[u]||"neutral");y.includes("red")?l="red":y.every(u=>u==="green")?l="green":l="neutral"}else l=c[String(d)]||"neutral";let x=0;l==="green"?(x=f,r++):l==="neutral"?(x=f*.5,g++):(x=0,s++),n+=x,h.push({label:m.label,value:Array.isArray(d)?d.join(", "):String(d),flag:l,points:x,maxPoints:f})});const b=a>0?Math.round(n/a*100)/10:0,j=b>=7?"green":b>=4?"yellow":"red";return{score:b,level:j,levelLabel:j==="green"?" Cliente potencial":j==="yellow"?" Revisar":" No califica",conclusion:j==="green"?"Perfil alineado con los servicios. Recomendacin: contactar en las prximas 24h.":j==="yellow"?"Algunos puntos requieren validacin. Recomendacin: agendar llamada exploratoria.":"Expectativas no alineadas con los servicios. Recomendacin: responder cortsmente y archivar.",greens:r,reds:s,yellows:g,totalPoints:n,maxPoints:a,details:h}}const Dm=async t=>{try{const i=vi();return(await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:i.correo.emailjs_serviceId,template_id:i.correo.emailjs_templateId,user_id:i.correo.emailjs_publicKey,template_params:t})})).ok}catch{return!1}},Lt=({children:t,style:i,...o})=>e.jsx("div",{style:{background:xe.surface,border:`1px solid ${xe.border}`,borderRadius:8,padding:16,boxShadow:xe.shadow,...i},...o,children:t}),Co=({children:t,on:i,v:o,style:n,...a})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${xe.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?xe.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...a,children:t}),nr=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),St={border:`1px solid ${xe.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},Ea={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${xe.border}`,textAlign:"left"},Ht={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${xe.border}`},ia="habitaris_formularios",bd=[{id:"dashboard",lbl:" Dashboard"},{id:"mis_forms",lbl:" Mis formularios"},{id:"constructor",lbl:" Constructor"},{id:"enviados",lbl:" Enviados"},{id:"respuestas",lbl:" Respuestas"},{id:"estadisticas",lbl:" Estadsticas"},{id:"plantillas",lbl:" Plantillas"}],oa=[{tipo:"text",lbl:"Texto corto",icon:"",desc:"Una lnea de texto"},{tipo:"textarea",lbl:"Texto largo",icon:"",desc:"Prrafo multilnea"},{tipo:"number",lbl:"Nmero",icon:"",desc:"Valor numrico"},{tipo:"email",lbl:"Email",icon:"",desc:"Correo electrnico"},{tipo:"tel",lbl:"Telfono",icon:"",desc:"Nmero telefnico"},{tipo:"date",lbl:"Fecha",icon:"",desc:"Selector de fecha"},{tipo:"select",lbl:"Desplegable",icon:"",desc:"Lista de opciones"},{tipo:"radio",lbl:"Opcin nica",icon:"",desc:"Elegir una opcin"},{tipo:"chips",lbl:"Seleccin mltiple",icon:"",desc:"Elegir varias opciones"},{tipo:"rango",lbl:"Rango/Escala",icon:"",desc:"Rango numrico"},{tipo:"rating",lbl:"Valoracin",icon:"",desc:"Estrellas 1-5"},{tipo:"yesno",lbl:"S / No",icon:"",desc:"Pregunta de s o no"},{tipo:"seccion",lbl:"Seccin",icon:"",desc:"Encabezado de seccin"},{tipo:"info",lbl:"Texto informativo",icon:"",desc:"Prrafo informativo (sin respuesta)"}],Pa=[{id:"general",lbl:"General"},{id:"crm",lbl:"CRM / Ofertas"},{id:"rrhh",lbl:"RRHH"},{id:"sst",lbl:"SST"},{id:"calidad",lbl:"Calidad"},{id:"postventa",lbl:"Postventa"},{id:"proyectos",lbl:"Proyectos"},{id:"logistica",lbl:"Logstica"},{id:"compras",lbl:"Compras"},{id:"flotas",lbl:"Flotas"},{id:"admin",lbl:"Administracin"}],$m={Amazonas:["Leticia","Otra"],Antioquia:["Medelln","Bello","Envigado","Itag","Rionegro","Sabaneta","Apartad","Otra"],Arauca:["Arauca","Saravena","Otra"],Atlntico:["Barranquilla","Soledad","Malambo","Otra"],"Bogot D.C.":["Bogot"],Bolvar:["Cartagena","Magangu","Turbaco","Otra"],Boyac:["Tunja","Duitama","Sogamoso","Otra"],Caldas:["Manizales","Villamara","La Dorada","Otra"],Caquet:["Florencia","Otra"],Casanare:["Yopal","Aguazul","Otra"],Cauca:["Popayn","Santander de Quilichao","Otra"],Cesar:["Valledupar","Aguachica","Otra"],Choc:["Quibd","Otra"],Crdoba:["Montera","Ceret","Lorica","Otra"],Cundinamarca:["Soacha","Cha","Zipaquir","Facatativ","Girardot","Fusagasug","Mosquera","Madrid","Cajic","Otra"],Guaina:["Inrida","Otra"],Guaviare:["San Jos del Guaviare","Otra"],Huila:["Neiva","Pitalito","Garzn","Otra"],"La Guajira":["Riohacha","Maicao","Otra"],Magdalena:["Santa Marta","Cinaga","Otra"],Meta:["Villavicencio","Acacas","Granada","Otra"],Nario:["Pasto","Ipiales","Tumaco","Otra"],"Norte de Santander":["Ccuta","Ocaa","Pamplona","Otra"],Putumayo:["Mocoa","Puerto Ass","Otra"],Quindo:["Armenia","Calarc","Otra"],Risaralda:["Pereira","Dosquebradas","Santa Rosa de Cabal","Otra"],"San Andrs y Providencia":["San Andrs","Providencia","Otra"],Santander:["Bucaramanga","Floridablanca","Girn","Piedecuesta","Barrancabermeja","Otra"],Sucre:["Sincelejo","Corozal","Otra"],Tolima:["Ibagu","Espinal","Melgar","Otra"],"Valle del Cauca":["Cali","Palmira","Buenaventura","Tulu","Buga","Jamund","Yumbo","Otra"],Vaups:["Mit","Otra"],Vichada:["Puerto Carreo","Otra"]},Ec=[{id:"briefing_inicial",version:6,nombre:"Briefing Inicial Habitaris",modulo:"crm",desc:"Formulario completo de briefing para nuevos proyectos",campos:[{id:"f_privacidad",tipo:"info",label:"Aviso de Privacidad: En Habitaris SAS (NIT 901.922.136-8, domicilio Bogot D.C., email: comercial.co, tel: +57 350 5661545), tratamos tus datos personales para procesar tu solicitud de briefing, enviar cotizaciones y gestionar proyectos. Cumplimos con la Ley 1581/2012 y Rgimen de Proteccin de Datos. Derechos (acceso, rectificacin, supresin, revocacin): va comercial.co.",desc:"",required:!1,opciones:[],logica:null},{id:"f_acepta_priv",tipo:"yesno",label:"Aceptas el aviso de privacidad?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"aceptaPrivacidad"},{id:"s1",tipo:"seccion",label:"Datos del cliente",desc:"Informacin personal y de contacto",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_nombre",tipo:"text",label:"Nombre y apellidos",placeholder:"Escribe tu nombre completo",required:!0,opciones:[],logica:null,mapKey:"nombre"},{id:"f_tipo_doc_co",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["Cdula de ciudadana (CC)","Cdula de extranjera (CE)","NIT","Pasaporte"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_es",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["DNI","NIE","CIF","Pasaporte"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_mx",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["CURP","RFC","INE","Pasaporte"],logica:{fieldId:"f_pais",value:"Mxico"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_otro",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["Documento de identidad","Pasaporte","Otro"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa","Mxico"]},mapKey:"tipoDocumento"},{id:"f_num_doc",tipo:"text",label:"Nmero de documento",placeholder:"Ej: 1.234.567.890",required:!0,opciones:[],logica:null,mapKey:"numDocumento"},{id:"f_email",tipo:"email",label:"Correo electrnico",placeholder:"name@example.com",required:!0,opciones:[],logica:null,mapKey:"email"},{id:"f_pais",tipo:"select",label:"Pas del proyecto",placeholder:"",required:!0,opciones:["Colombia","Espaa","Mxico","Chile","Per","Ecuador","Argentina","Panam","Estados Unidos","Otro"],logica:null,mapKey:"pais"},{id:"f_tel",tipo:"tel_combo",label:"Telfono de contacto",placeholder:"Ej: 3505661545",required:!0,opciones:["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"],logica:null,mapKey:"telefono",codMapKey:"codigoTel",paisRef:"f_pais"},{id:"f_propietario",tipo:"select",label:"Cul es tu relacin con el inmueble?",placeholder:"",required:!0,opciones:["Soy el propietario","Estoy en arriendo","Acto en nombre del propietario","Acto en nombre de un tercero"],logica:null,mapKey:"propietario",scoring:{enabled:!0,weight:2,rules:{"Soy el propietario":"green","Estoy en arriendo":"neutral","Acto en nombre del propietario":"red","Acto en nombre de un tercero":"red"}}},{id:"s3",tipo:"seccion",label:"Ubicacin del proyecto",desc:"Dnde est el inmueble?",required:!1,opciones:[],logica:null},{id:"f_depto_co",tipo:"select",label:"Departamento",placeholder:"",required:!0,opciones:["Amazonas","Antioquia","Arauca","Atlntico","Bogot D.C.","Bolvar","Boyac","Caldas","Caquet","Casanare","Cauca","Cesar","Choc","Crdoba","Cundinamarca","Guaina","Guaviare","Huila","La Guajira","Magdalena","Meta","Nario","Norte de Santander","Putumayo","Quindo","Risaralda","San Andrs y Providencia","Santander","Sucre","Tolima","Valle del Cauca","Vaups","Vichada"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"departamento"},{id:"f_depto_es",tipo:"select",label:"Comunidad autnoma",placeholder:"",required:!0,opciones:["Andaluca","Aragn","Asturias","Baleares","Canarias","Cantabria","Castilla-La Mancha","Castilla y Len","Catalua","Ceuta","Comunidad Valenciana","Extremadura","Galicia","La Rioja","Madrid","Melilla","Murcia","Navarra","Pas Vasco"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"departamento"},{id:"f_depto_mx",tipo:"select",label:"Estado",placeholder:"",required:!0,opciones:["Aguascalientes","Baja California","Baja California Sur","Campeche","Chiapas","Chihuahua","Ciudad de Mxico","Coahuila","Colima","Durango","Estado de Mxico","Guanajuato","Guerrero","Hidalgo","Jalisco","Michoacn","Morelos","Nayarit","Nuevo Len","Oaxaca","Puebla","Quertaro","Quintana Roo","San Luis Potos","Sinaloa","Sonora","Tabasco","Tamaulipas","Tlaxcala","Veracruz","Yucatn","Zacatecas"],logica:{fieldId:"f_pais",value:"Mxico"},mapKey:"departamento"},{id:"f_depto_otro",tipo:"text",label:"Regin / Estado / Provincia",placeholder:"Escribe tu regin",required:!0,opciones:[],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa","Mxico"]},mapKey:"departamento"},{id:"f_ciudad_co",tipo:"select",label:"Ciudad o poblacin",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"ciudad",dynamicOpciones:{dependsOn:"f_depto_co",map:$m}},{id:"f_ciudad_otro",tipo:"text",label:"Ciudad o poblacin",placeholder:"Escribe la ciudad",required:!0,opciones:[],logica:{fieldId:"f_pais",notValue:"Colombia"},mapKey:"ciudad"},{id:"f_direccion",tipo:"text",label:"Direccin del proyecto",placeholder:"Ej: Calle 100 #15-20 / Av. de la Constitucin 5",required:!0,opciones:[],logica:null,mapKey:"direccion"},{id:"f_tipo_vivienda",tipo:"select",label:"Tipo de inmueble",placeholder:"",required:!0,opciones:["Apartamento","Casa","Local comercial","Oficina","Finca / Rural","Otro"],logica:null,mapKey:"tipoVivienda"},{id:"f_num_apto",tipo:"text",label:"Nmero de apartamento / piso",placeholder:"Ej: Apto 501, Piso 3",required:!0,opciones:[],logica:{fieldId:"f_tipo_vivienda",value:"Apartamento"},mapKey:"numApto"},{id:"f_edificio",tipo:"text",label:"Nombre del edificio, conjunto o urbanizacin",placeholder:"Ej: Edificio Torres del Parque",required:!1,opciones:[],logica:null,mapKey:"edificio"},{id:"f_cod_postal",tipo:"text",label:"Cdigo postal",placeholder:"Ej: 110111",required:!1,opciones:[],logica:null,mapKey:"codigoPostal"},{id:"s3b",tipo:"seccion",label:"Datos del inmueble",desc:"Caractersticas del espacio",required:!1,opciones:[],logica:null},{id:"f_area",tipo:"text",label:"rea aproximada en m",placeholder:"Ej: 85",required:!0,opciones:[],logica:null,mapKey:"area"},{id:"f_habitaciones",tipo:"text",label:"Nmero de habitaciones/reas a intervenir",placeholder:"Ej: 3",required:!0,opciones:[],logica:null,mapKey:"habitaciones"},{id:"f_espacios",tipo:"chips",label:"Qu espacios incluye el proyecto?",placeholder:"",required:!0,opciones:["Sala","Comedor","Cocina","Habitaciones","Baos","Terraza / Balcn","Estudio / Oficina","Local comercial","Jardn / Patio","Fachada"],logica:null,mapKey:"espacios"},{id:"s2",tipo:"seccion",label:"Sobre el servicio",desc:"Qu necesitas?",required:!1,opciones:[],logica:null},{id:"f_servicio",tipo:"chips",label:"Qu servicio te interesa?",placeholder:"",required:!0,opciones:["Diseo arquitectnico / Obra nueva","Diseo arquitectnico / Reforma","Interiorismo / Diseo de interiores","Biointeriorismo","Supervisin de obra (Presencial)","Supervisin de obra (Online)","Asesora de Compras"],logica:null,mapKey:"servicios"},{id:"f_tipo_proy",tipo:"select",label:"El proyecto es residencial, comercial o rural?",placeholder:"",required:!0,opciones:["Residencial","Comercial","Rural"],logica:null,mapKey:"tipoProyecto"},{id:"s4",tipo:"seccion",label:"Estilo y diseo",desc:"Tus preferencias estticas",required:!1,opciones:[],logica:null},{id:"f_estilo",tipo:"chips",label:"Estilo preferido",placeholder:"",required:!0,opciones:["Bio-natural / Orgnico","Bohemio","Clsico","Escandinavo","Industrial","Minimalista","Moderno","Rstico","Otro"],logica:null,mapKey:"estilo"},{id:"f_colores",tipo:"textarea",label:"Colores, materiales y elementos clave",placeholder:"Describe los colores y materiales que te gustan...",required:!0,opciones:[],logica:null,mapKey:"colores"},{id:"f_links_ref",tipo:"textarea",label:"Pega aqu los links de tus ideas o referentes (Pinterest, Instagram, etc.)",placeholder:"https://...",required:!1,opciones:[],logica:null,mapKey:"linksReferentes"},{id:"s5",tipo:"seccion",label:"Expectativas del proyecto",desc:"Qu esperas lograr?",required:!1,opciones:[],logica:null},{id:"f_lograr",tipo:"chips",label:"Qu esperas lograr con este proyecto?",placeholder:"",required:!0,opciones:["Inspiracin o ideas generales","Planos base y distribucin funcional","Diseo integral con renders, acabados y mobiliario","Supervisin y acompaamiento durante la ejecucin"],logica:null,mapKey:"expectativas",scoring:{enabled:!0,weight:3,rules:{"Inspiracin o ideas generales":"red","Planos base y distribucin funcional":"neutral","Diseo integral con renders, acabados y mobiliario":"green","Supervisin y acompaamiento durante la ejecucin":"green"}}},{id:"f_importante",tipo:"chips",label:"Lo ms importante para ti en el proyecto",placeholder:"",required:!0,opciones:["Esttica / Diseo","Funcionalidad","Presupuesto ajustado","Tiempo de entrega","Exclusividad / Personalizacin"],logica:null,mapKey:"prioridades",scoring:{enabled:!0,weight:2,rules:{"Esttica / Diseo":"green",Funcionalidad:"green","Presupuesto ajustado":"red","Tiempo de entrega":"neutral","Exclusividad / Personalizacin":"green"}}},{id:"s6",tipo:"seccion",label:"Presupuesto y financiacin",desc:"Informacin econmica del proyecto",required:!1,opciones:[],logica:null},{id:"f_presupuesto_co",tipo:"select",label:"Presupuesto estimado (COP)",placeholder:"",required:!0,opciones:["Menos de $10.000.000","$10.000.000 - $30.000.000","$30.000.000 - $60.000.000","$60.000.000 - $100.000.000","Ms de $100.000.000"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de $10.000.000":"red","$10.000.000 - $30.000.000":"neutral","$30.000.000 - $60.000.000":"green","$60.000.000 - $100.000.000":"green","Ms de $100.000.000":"green"}}},{id:"f_presupuesto_es",tipo:"select",label:"Presupuesto estimado (EUR)",placeholder:"",required:!0,opciones:["Menos de 10.000","10.000 - 30.000","30.000 - 60.000","60.000 - 100.000","Ms de 100.000"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de 10.000":"red","10.000 - 30.000":"neutral","30.000 - 60.000":"green","60.000 - 100.000":"green","Ms de 100.000":"green"}}},{id:"f_presupuesto_otro",tipo:"select",label:"Presupuesto estimado (USD)",placeholder:"",required:!0,opciones:["Menos de $5.000","$5.000 - $15.000","$15.000 - $30.000","$30.000 - $50.000","Ms de $50.000"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa"]},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de $5.000":"red","$5.000 - $15.000":"neutral","$15.000 - $30.000":"green","$30.000 - $50.000":"green","Ms de $50.000":"green"}}},{id:"f_honorarios",tipo:"select",label:"Tu presupuesto incluye los honorarios de diseo?",placeholder:"",required:!0,opciones:["S, incluye diseo y ejecucin","Solo ejecucin/materiales, el diseo aparte","No, espero que el diseo est incluido sin costo","No estoy seguro"],logica:null,mapKey:"honorariosDiseo",scoring:{enabled:!0,weight:5,rules:{"S, incluye diseo y ejecucin":"green","Solo ejecucin/materiales, el diseo aparte":"green","No, espero que el diseo est incluido sin costo":"red","No estoy seguro":"neutral"}}},{id:"f_financiar",tipo:"select",label:"Cmo planeas financiar el proyecto?",placeholder:"",required:!0,opciones:["Con recursos propios","Crdito bancario o leasing habitacional","Con apoyo de un tercero","An no lo tengo definido"],logica:null,mapKey:"financiacion",scoring:{enabled:!0,weight:3,rules:{"Con recursos propios":"green","Crdito bancario o leasing habitacional":"neutral","Con apoyo de un tercero":"neutral","An no lo tengo definido":"red"}}},{id:"f_invertido",tipo:"select",label:"Has invertido antes en diseo profesional?",placeholder:"",required:!0,opciones:["S","No, pero estoy dispuesto","No, nunca lo hara"],logica:null,mapKey:"inversionPrevia",scoring:{enabled:!0,weight:3,rules:{S:"green","No, pero estoy dispuesto":"neutral","No, nunca lo hara":"red"}}},{id:"f_gratuito",tipo:"select",label:"Esperas que el diseo sea gratuito o solo de referencia?",placeholder:"",required:!0,opciones:["S, solo busco ideas generales","No, estoy dispuesto a pagar por un diseo profesional"],logica:null,mapKey:"expectativaPago",scoring:{enabled:!0,weight:4,rules:{"S, solo busco ideas generales":"red","No, estoy dispuesto a pagar por un diseo profesional":"green"}}},{id:"f_exceder",tipo:"select",label:"Aceptaras una propuesta que supere tu presupuesto, si garantiza calidad y durabilidad?",placeholder:"",required:!0,opciones:["S, puedo ajustarme","No, solo lo hago si es ms barato"],logica:null,mapKey:"flexibilidad",scoring:{enabled:!0,weight:4,rules:{"S, puedo ajustarme":"green","No, solo lo hago si es ms barato":"red"}}},{id:"f_anticipo",tipo:"yesno",label:"Dispuesto a pagar anticipo 30-50%?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"anticipo",scoring:{enabled:!0,weight:5,rules:{S:"green",No:"red"}}},{id:"f_contratistas",tipo:"select",label:"Quieres que te recomendemos contratistas de confianza para la obra?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"contratistas"},{id:"s7",tipo:"seccion",label:"Plazos",desc:"Tiempos del proyecto",required:!1,opciones:[],logica:null},{id:"f_plazo",tipo:"select",label:"Plazo esperado para finalizacin",placeholder:"",required:!0,opciones:["1 - 3 meses","3 - 6 meses","> 6 Meses"],logica:null,mapKey:"plazo",scoring:{enabled:!0,weight:2,rules:{"1 - 3 meses":"red","3 - 6 meses":"neutral","> 6 Meses":"green"}}},{id:"f_inicio",tipo:"date",label:"Fecha tentativa de inicio",placeholder:"",required:!0,opciones:[],logica:null,mapKey:"fechaInicio"},{id:"s8",tipo:"seccion",label:"Informacin de facturacin",desc:"Datos para facturacin electrnica",required:!1,opciones:[],logica:null},{id:"f_mismos_datos",tipo:"yesno",label:"Los datos de facturacin son los mismos del cliente?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"mismosDatosFactura"},{id:"f_fact_info_si",tipo:"info",label:" Se usarn los datos ingresados en la seccin 'Datos del cliente' para la facturacin. Podrs revisarlos antes de confirmar.",desc:"",required:!1,opciones:[],logica:{fieldId:"f_mismos_datos",value:"S"}},{id:"f_razon_social",tipo:"text",label:"Nombre o razn social para facturacin",placeholder:"Escribe tu respuesta aqu...",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"razonSocial"},{id:"f_tipo_doc_fact_co",tipo:"select",label:"Tipo de documento (facturacin)",placeholder:"",required:!0,opciones:["Cdula de ciudadana (CC)","Cdula de extranjera (CE)","NIT","Pasaporte"],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"tipoDocFactura"},{id:"f_num_doc_fact",tipo:"text",label:"Nmero de documento (facturacin)",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"numDocFactura"},{id:"f_email_fact",tipo:"email",label:"Email para envo de factura",placeholder:"name@example.com",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"emailFactura"},{id:"f_dir_fact",tipo:"text",label:"Direccin de facturacin",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"dirFacturacion"},{id:"f_forma_pago_co",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Enlace PSE","Tarjeta de Crdito/Dbito","Transferencia bancaria","Nequi / Daviplata"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"formaPago"},{id:"f_forma_pago_es",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Bizum","Tarjeta de Crdito/Dbito","Transferencia bancaria","PayPal"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"formaPago"},{id:"f_forma_pago_otro",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Tarjeta de Crdito/Dbito","Transferencia bancaria","PayPal"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa"]},mapKey:"formaPago"},{id:"f_retenciones",tipo:"yesno",label:"Aplican retenciones especiales?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"retenciones"},{id:"f_det_ret",tipo:"textarea",label:"Detalle de retenciones",placeholder:"Escribe tu respuesta aqu...",required:!0,opciones:[],logica:{fieldId:"f_retenciones",value:"S"},mapKey:"detalleRetenciones"},{id:"s9",tipo:"seccion",label:"Autorizaciones legales",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_confirmacion",tipo:"info",label:" Confirmacin: La informacin entregada es verdica y ser utilizada nicamente para la elaboracin de la propuesta de diseo. Habitaris S.A.S. garantiza la confidencialidad de los datos y no los compartir con terceros, salvo con proveedores o contratistas de confianza cuando sea necesario para la correcta ejecucin del proyecto, previa autorizacin del cliente.",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_acepta_conf",tipo:"yesno",label:"Confirmas que la informacin es verdica?",placeholder:"",required:!0,opciones:["S","No"],logica:{fieldId:"f_acepta_priv",value:"S"},mapKey:"confirmacion"},{id:"f_habeas",tipo:"info",label:" Autorizacin de tratamiento de datos personales: Al enviar este formulario autorizo a Habitaris S.A.S., para el uso de mis datos personales con el fin de elaborar propuestas de diseo, coordinar servicios relacionados y, en caso de ser necesario, compartirlos con proveedores o contratistas de confianza exclusivamente para la correcta ejecucin del proyecto. En todo momento se garantizar la confidencialidad y proteccin de mi informacin, conforme a la normativa de Habeas Data en Colombia (Ley 1581 de 2012).",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_acepta_habeas",tipo:"yesno",label:"Autorizas el tratamiento de datos personales?",placeholder:"",required:!0,opciones:["S","No"],logica:{fieldId:"f_acepta_priv",value:"S"},mapKey:"habeasData"}],config:{titulo:"BRIEFING INICIAL",subtitulo:"Cuntanos sobre tu proyecto para preparar la mejor propuesta",mensajeExito:"Gracias por diligenciar el Briefing de tu proyecto. Nos pondremos en contacto contigo pronto.",telRespuesta:"573505661545"}},{id:"encuesta_satisfaccion",nombre:"Encuesta de satisfaccin",modulo:"postventa",desc:"Evaluar experiencia del cliente post-entrega",campos:[{id:ht(),tipo:"seccion",label:"Tu experiencia",desc:"Aydanos a mejorar",required:!1,opciones:[],logica:null},{id:ht(),tipo:"text",label:"Nombre",placeholder:"Tu nombre",required:!0,opciones:[],logica:null},{id:ht(),tipo:"text",label:"Proyecto/Inmueble",placeholder:"Nombre del proyecto o direccin",required:!0,opciones:[],logica:null},{id:ht(),tipo:"rating",label:"Calidad de la construccin",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"rating",label:"Cumplimiento de plazos",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"rating",label:"Atencin al cliente",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"rating",label:"Relacin calidad/precio",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"yesno",label:"Recomendaras nuestros servicios?",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"textarea",label:"Comentarios adicionales",placeholder:"Tu opinin nos importa...",required:!1,opciones:[],logica:null}],config:{titulo:"Encuesta de satisfaccin",subtitulo:"Tu opinin nos ayuda a mejorar",mensajeExito:"Gracias por tu tiempo! Tu opinin es muy valiosa para nosotros."}},{id:"inspeccion_sst",nombre:"Inspeccin SST",modulo:"sst",desc:"Checklist de seguridad en obra",campos:[{id:ht(),tipo:"seccion",label:"Informacin general",desc:"",required:!1,opciones:[],logica:null},{id:ht(),tipo:"text",label:"Proyecto/Obra",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"text",label:"Inspector",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"date",label:"Fecha de inspeccin",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"seccion",label:"Checklist de seguridad",desc:"Evale cada aspecto",required:!1,opciones:[],logica:null},{id:ht(),tipo:"radio",label:"EPPs: Personal usa casco?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:ht(),tipo:"radio",label:"EPPs: Personal usa arns en alturas?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:ht(),tipo:"radio",label:"EPPs: Personal usa botas de seguridad?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:ht(),tipo:"radio",label:"Sealizacin: reas demarcadas?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:ht(),tipo:"radio",label:"Orden y aseo: rea de trabajo limpia?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:ht(),tipo:"radio",label:"Herramientas: En buen estado?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:ht(),tipo:"textarea",label:"Hallazgos y observaciones",placeholder:"Detalle los hallazgos...",required:!1,opciones:[],logica:null},{id:ht(),tipo:"radio",label:"Resultado general",placeholder:"",required:!0,opciones:["Aprobado","Aprobado con observaciones","No aprobado"],logica:null}],config:{titulo:"Inspeccin de Seguridad y Salud",subtitulo:"Checklist de verificacin en obra",mensajeExito:"Inspeccin registrada correctamente."}},{id:"recepcion_material",nombre:"Recepcin de material",modulo:"logistica",desc:"Registrar recepcin en almacn",campos:[{id:ht(),tipo:"text",label:"Orden de compra / Referencia",placeholder:"OC-0001",required:!0,opciones:[],logica:null},{id:ht(),tipo:"text",label:"Proveedor",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"date",label:"Fecha recepcin",placeholder:"",required:!0,opciones:[],logica:null},{id:ht(),tipo:"text",label:"Recibido por",placeholder:"Nombre almacenista",required:!0,opciones:[],logica:null},{id:ht(),tipo:"textarea",label:"Materiales recibidos",placeholder:"Detalle tems, cantidades...",required:!0,opciones:[],logica:null},{id:ht(),tipo:"radio",label:"Estado del material conforme?",placeholder:"",required:!0,opciones:["Conforme","No conforme","Parcialmente conforme"],logica:null},{id:ht(),tipo:"textarea",label:"Observaciones",placeholder:"Notas sobre estado, faltantes...",required:!1,opciones:[],logica:null}],config:{titulo:"Recepcin de material",subtitulo:"Registro de entrada al almacn",mensajeExito:"Recepcin registrada."}}];function Pm({forms:t,setForms:i,editId:o,setEditId:n,onSaved:a,envios:r,addEnvio:s}){var W,se,ge,ue,ye,be;const g=o?t.find(I=>I.id===o):null,[h,b]=F.useState((g==null?void 0:g.nombre)||""),[j,k]=F.useState((g==null?void 0:g.modulo)||"general"),[v,m]=F.useState((g==null?void 0:g.campos)||[]),[f,p]=F.useState((g==null?void 0:g.config)||{titulo:"",subtitulo:"",mensajeExito:"Gracias por tu respuesta!",telRespuesta:"",vista:"pasos",colorAccent:"#111111",botonTexto:""}),[d,c]=F.useState(null),[l,x]=F.useState(!1),[y,u]=F.useState(!1),[S,A]=F.useState({nombre:"",email:"",tel:""}),[E,w]=F.useState("Colombia"),[_,z]=F.useState(""),[T,L]=F.useState(""),[Z,K]=F.useState(0),[P,te]=F.useState("");F.useState(null);const he=I=>{const N=oa.find(J=>J.tipo===I),q={id:ht(),tipo:I,label:(N==null?void 0:N.lbl)||I,placeholder:"",required:!1,opciones:I==="rating"?[]:I==="yesno"?["S","No"]:[],logica:null,desc:""};["select","radio","chips","rango"].includes(I)&&(q.opciones=["Opcin 1","Opcin 2"]),m([...v,q]),c(v.length)},Q=(I,N,q)=>m(v.map((J,R)=>R===I?{...J,[N]:q}:J)),Se=I=>{m(v.filter((N,q)=>q!==I)),d===I?c(null):d>I&&c(d-1)},ae=(I,N)=>{const q=I+N;if(q<0||q>=v.length)return;const J=[...v];[J[I],J[q]]=[J[q],J[I]],m(J),c(q)},U=()=>{if(!h.trim())return;const I={id:(g==null?void 0:g.id)||ht(),nombre:h,modulo:j,campos:v,config:{...f,titulo:f.titulo||h},createdAt:(g==null?void 0:g.createdAt)||Ki(),updatedAt:Ki(),activo:!0};i(g?t.map(N=>N.id===I.id?I:N):[...t,I]),a(I)},M=(I,N)=>{const q=vi(),J={id:(g==null?void 0:g.id)||"form",nombre:h,campos:v,config:{...f,titulo:f.titulo||h,paisProyecto:N||"Colombia"},cliente:I||null},R=JSON.stringify(J),ie=(f.telRespuesta||q.whatsapp.numero||"").replace(/[^0-9]/g,"");return q.empresa.nombre.toUpperCase(),q.empresa.eslogan,`<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>${f.titulo||h||"Formulario"}</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:#F5F4F1;color:#111}
.hdr{background:#111;padding:14px 24px}.hdr-in{max-width:640px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
.logo{font-weight:700;font-size:14px;letter-spacing:3px;color:#fff}.logo-sub{font-size:7px;letter-spacing:2px;color:rgba(255,255,255,.4);text-transform:uppercase;margin-top:2px}
.prog{max-width:640px;margin:8px auto 0;height:3px;background:rgba(255,255,255,.1);border-radius:2px}.prog-bar{height:100%;background:#111111;border-radius:2px;transition:width .3s;width:0%}
.wrap{max-width:640px;margin:0 auto;padding:28px 20px 120px}
.client-b{background:#F0F0F0;border:1px solid rgba(30,79,140,.2);border-radius:8px;padding:12px 16px;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.client-av{width:36px;height:36px;border-radius:50%;background:#3B3B3B;color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700}
.client-n{font-size:13px;font-weight:700;color:#3B3B3B}.client-e{font-size:10px;color:#5A8BC2;margin-top:2px}
.title{text-align:center;margin-bottom:28px}.title h1{font-size:22px;font-weight:700;margin:0 0 6px}.title p{font-size:13px;color:#555}
.card{background:#fff;border-radius:10px;padding:24px 28px;border:1px solid #E0E0E0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
.fld{margin-bottom:16px}.lbl{font-size:11px;font-weight:600;display:block;margin-bottom:5px}.req{color:#B91C1C}
.inp{width:100%;padding:10px 14px;border:1px solid #E0E0E0;border-radius:6px;font-size:14px;font-family:'DM Sans',sans-serif;color:#111;background:#fff;box-sizing:border-box}
.inp:disabled{background:#F0F0F0;border-color:rgba(30,79,140,.27);color:#3B3B3B;font-weight:600}
textarea.inp{resize:vertical}select.inp{appearance:auto}
.sec{margin-top:24px;margin-bottom:12px;padding-top:16px;border-top:2px solid #111}.sec h3{font-size:14px;font-weight:700}.sec p{font-size:11px;color:#909090;margin-top:4px}
.info-b{margin-bottom:16px;padding:12px 16px;background:#F0F0F0;border-radius:8px;border:1px solid rgba(30,79,140,.2);font-size:13px;color:#3B3B3B}
.radio-g{display:flex;flex-direction:column;gap:6px;margin-top:4px}.radio-g label{display:flex;align-items:center;gap:8px;font-size:13px;padding:6px 10px;border-radius:6px;cursor:pointer}
.radio-g label.sel{background:#F0F0F0;border:1px solid rgba(30,79,140,.2)}.radio-g input{accent-color:#111}
.chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}.chip{padding:6px 14px;font-size:12px;border-radius:20px;border:1px solid #E0E0E0;background:#fff;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.chip.sel{background:#111;color:#fff;border-color:#111;font-weight:700}
.stars{display:flex;gap:6px;margin-top:4px}.star{font-size:28px;cursor:pointer;background:none;border:none;transition:all .15s}
.yn{display:flex;gap:8px;margin-top:6px}.yn-btn{padding:10px 24px;font-size:14px;border-radius:24px;border:1px solid #E0E0E0;background:#fff;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.yn-btn.sel{background:#111;color:#fff;border-color:#111;font-weight:700}
.sticky{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:2px solid #111;padding:12px 20px;z-index:200;box-shadow:0 -4px 20px rgba(0,0,0,.08)}
.sticky-in{max-width:640px;margin:0 auto;display:flex;justify-content:center}
.submit{padding:14px 40px;background:#111;color:#fff;border:none;border-radius:6px;font-size:15px;font-weight:700;cursor:pointer;letter-spacing:.5px;font-family:'DM Sans',sans-serif}
.err{font-size:12px;color:#B91C1C;text-align:center;margin:12px 0}
.ok{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#F5F4F1}
.ok-card{background:#fff;border-radius:12px;padding:40px;max-width:480px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,.08)}
.lock{font-size:8px;color:#3B3B3B;font-weight:400}
</style></head><body>
<div id="app"></div>
<script>
const DEF=${R};
const cfg=DEF.config||{};const campos=DEF.campos||[];const cliente=DEF.cliente||null;
const empresaNombre="${q.empresa.nombre.toUpperCase().replace(/"/g,'\\"')}";
const empresaEslogan="${q.empresa.eslogan.replace(/"/g,'\\"')}";
const vals={};let submitted=false;
// One-time use check
const privField=campos.find(c=>c.mapKey==='aceptaPrivacidad');
const privId=privField?privField.id:'f_acepta_priv';
const formKey='hab_used_'+(DEF.id||'')+'_'+(cliente?cliente.email||cliente.nombre:'');
if(store.getSync(formKey)){submitted=true;}
// Prefill client fields
if(cliente){campos.forEach(c=>{
  if(cliente.email&&(c.mapKey==="email"||c.tipo==="email"))vals[c.id]=cliente.email;
  if(cliente.nombre&&(c.mapKey==="nombre"||(c.tipo==="text"&&c.label.toLowerCase().includes("nombre"))))vals[c.id]=cliente.nombre;
  if(cliente.tel&&(c.mapKey==="telefono"||c.tipo==="tel"))vals[c.id]=cliente.tel;
});}
// Prefill country from config
const paisProy=cfg.paisProyecto||"Colombia";
const paisCodeMap={"Colombia":"+57","Espaa":"+34","Mxico":"+52","Chile":"+56","Per":"+51","Ecuador":"+593","Argentina":"+54","Panam":"+507","Estados Unidos":"+1","Otro":"+"};
campos.forEach(c=>{
  if(c.mapKey==="pais")vals[c.id]=paisProy;
});
function isLocked(c){if(!cliente)return false;
  if(cliente.email&&(c.mapKey==="email"||c.tipo==="email"))return true;
  if(cliente.nombre&&(c.mapKey==="nombre"||(c.tipo==="text"&&c.label.toLowerCase().includes("nombre"))))return true;
  if(cliente.tel&&cliente.tel.trim()&&(c.mapKey==="telefono"||c.tipo==="tel"||c.tipo==="tel_combo"))return true;
  if(c.mapKey==="pais")return true;
  return false;}
function isVisible(c){if(!c.logica||!c.logica.fieldId)return true;
  if(!c.logica.value&&!c.logica.notValues&&!c.logica.notValue)return true;
  const dv=vals[c.logica.fieldId];
  if(c.logica.notValues){return !c.logica.notValues.includes(String(dv||""));}
  if(c.logica.notValue){return String(dv||"")!==c.logica.notValue;}
  const ex=c.logica.value;
  if(Array.isArray(dv))return dv.includes(ex);return String(dv||"")===ex;}
function render(){
  const app=document.getElementById("app");
  if(submitted){app.innerHTML=\`<div class="ok"><div class="ok-card"><div style="font-size:48px;margin-bottom:12px"></div><h2 style="font-size:20px;font-weight:700;color:#111111;margin:0 0 8px">Enviado!</h2><p style="font-size:13px;color:#555;line-height:1.6">\${cfg.mensajeExito||"Gracias por completar el formulario."}</p></div></div>\`;return;}
  // Privacy gate: if user declined, show goodbye
  if(vals[privId]==='No'){app.innerHTML=\`<div class="ok"><div class="ok-card"><div style="font-size:48px;margin-bottom:12px"></div><h2 style="font-size:20px;font-weight:700;color:#111;margin:0 0 8px">Gracias por tu tiempo</h2><p style="font-size:13px;color:#555;line-height:1.6">Para poder continuar con el briefing, necesitamos tu autorizacin para el tratamiento de datos personales. Si cambias de opinin, vuelve a abrir este formulario.</p></div></div>\`;return;}
  const privAccepted=vals[privId]==='S';
  const privInfoField=campos.find(c=>c.tipo==='info'&&c.label&&c.label.includes('Aviso de Privacidad'));
  const visibleCampos=privAccepted?campos:campos.filter(c=>c.id===privId||(privInfoField&&c.id===privInfoField.id));
  const totalReq=visibleCampos.filter(c=>c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)).length;
  const filledReq=visibleCampos.filter(c=>c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)&&vals[c.id]&&(Array.isArray(vals[c.id])?vals[c.id].length>0:true)).length;
  const pct=totalReq>0?Math.round((filledReq/totalReq)*100):0;
  let h=\`<div class="hdr"><div class="hdr-in"><div><div class="logo">\${empresaNombre}</div><div class="logo-sub">\${empresaEslogan}</div></div><div style="font-size:10px;color:rgba(255,255,255,.4)">\${pct}% completo</div></div><div class="prog"><div class="prog-bar" style="width:\${pct}%"></div></div></div>\`;
  h+=\`<div class="wrap">\`;
  if(cliente){h+=\`<div class="client-b"><div class="client-av">\${(cliente.nombre||cliente.email||"?")[0].toUpperCase()}</div><div><div class="client-n">Formulario para: \${cliente.nombre||cliente.email}</div>\${cliente.email?\`<div class="client-e">\${cliente.email}</div>\`:""}</div></div>\`;}
  h+=\`<div class="title"><h1>\${cfg.titulo||DEF.nombre||"Formulario"}</h1>\${cfg.subtitulo?\`<p>\${cfg.subtitulo}</p>\`:""}</div>\`;
  h+=\`<div class="card">\`;
  visibleCampos.forEach((c,i)=>{
    if(!isVisible(c))return;
    if(c.tipo==="seccion"){h+=\`<div class="sec"><h3>\${c.label}</h3>\${c.desc?\`<p>\${c.desc}</p>\`:""}</div>\`;return;}
    if(c.tipo==="info"){h+=\`<div class="info-b">\${c.label}</div>\`;return;}
    const locked=isLocked(c);const v=vals[c.id]||"";const req=c.required?\`<span class="req"> *</span>\`:"";
    h+=\`<div class="fld">\`;
    if(locked){
      h+=\`<label class="lbl">\${c.label} <span class="lock"> prellenado</span></label>\`;
      if(c.tipo==="tel_combo"){
        const codVal=vals["_cod_"+c.id]||"+57";
        h+=\`<div style="display:flex;gap:0"><div class="inp" style="width:90px;flex-shrink:0;border-radius:6px 0 0 6px;border-right:none;font-weight:700;font-size:13px;color:#3B3B3B;background:#F0F0F0;display:flex;align-items:center;justify-content:center;border-color:rgba(30,79,140,.27)">\${codVal}</div><input class="inp" value="\${v}" disabled style="flex:1;border-radius:0 6px 6px 0"/></div>\`;
      }else if(c.tipo==="select"){h+=\`<select class="inp" disabled><option>\${v}</option></select>\`;}
      else{h+=\`<input class="inp" value="\${v}" disabled/>\`;}
    }else if(c.tipo==="tel_combo"){
      const paisVal=c.paisRef?vals[c.paisRef]:paisProy;
      const defCode=paisCodeMap[paisVal]||"+57";
      if(!vals["_cod_"+c.id])vals["_cod_"+c.id]=defCode;
      const codVal=vals["_cod_"+c.id];
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<div style="display:flex;gap:0"><select class="inp" style="width:90px;flex-shrink:0;border-radius:6px 0 0 6px;border-right:none;font-weight:700;font-size:13px;color:#3B3B3B;background:#F5F4F1" onchange="vals['_cod_'+'\${c.id}']=this.value;render()">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<option value="\${o}" \${codVal===o?"selected":""}>\${o}</option>\`;});
      h+=\`</select><input class="inp" type="tel" value="\${v}" placeholder="\${c.placeholder||""}" style="flex:1;border-radius:0 6px 6px 0" onchange="vals['\${c.id}']=this.value;render()"/></div>\`;
    }else if(["text","email","tel","number","date"].includes(c.tipo)){
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<input class="inp" type="\${c.tipo}" value="\${v}" placeholder="\${c.placeholder||""}" onchange="vals['\${c.id}']=this.value;render()"/>\`;
    }else if(c.tipo==="textarea"){
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<textarea class="inp" rows="3" placeholder="\${c.placeholder||""}" onchange="vals['\${c.id}']=this.value;render()">\${v}</textarea>\`;
    }else if(c.tipo==="select"||c.tipo==="rango"){
      let opts=c.opciones||[];
      if(c.dynamicOpciones){const dv=vals[c.dynamicOpciones.dependsOn]||"";opts=(c.dynamicOpciones.map&&c.dynamicOpciones.map[dv])||c.dynamicOpciones.fallback||[];}
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<select class="inp" onchange="vals['\${c.id}']=this.value;render()"><option value="">Seleccionar...</option>\`;
      opts.forEach(o=>{h+=\`<option value="\${o}" \${v===o?"selected":""}>\${o}</option>\`;});
      h+=\`</select>\`;
    }else if(c.tipo==="radio"){
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="radio-g">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<label class="\${v===o?"sel":""}"><input type="radio" name="r\${c.id}" \${v===o?"checked":""} onchange="vals['\${c.id}']='\${o}';render()"/> \${o}</label>\`;});
      h+=\`</div>\`;
    }else if(c.tipo==="chips"){
      const sel=Array.isArray(vals[c.id])?vals[c.id]:[];
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="chips">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<span class="chip \${sel.includes(o)?"sel":""}" onclick="var s=Array.isArray(vals['\${c.id}'])?vals['\${c.id}']:[];if(s.includes('\${o}'))s=s.filter(x=>x!=='\${o}');else s.push('\${o}');vals['\${c.id}']=s;render()">\${o}</span>\`;});
      h+=\`</div>\`;
    }else if(c.tipo==="rating"){
      const stars=parseInt(v)||0;
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="stars">\`;
      for(let n=1;n<=5;n++){h+=\`<button class="star" style="opacity:\${n<=stars?1:.3};filter:\${n<=stars?"none":"grayscale(1)"}" onclick="vals['\${c.id}']=\${n};render()"></button>\`;}
      h+=\`</div>\${stars>0?\`<div style="font-size:11px;color:#555;margin-top:4px">\${stars} de 5</div>\`:""}\`;
    }else if(c.tipo==="yesno"){
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="yn">\`;
      ["S","No"].forEach(o=>{h+=\`<button class="yn-btn \${v===o?"sel":""}" onclick="vals['\${c.id}']='\${o}';render()">\${o}</button>\`;});
      h+=\`</div>\`;
    }
    h+=\`</div>\`;
  });
  h+=\`</div><div id="err" class="err"></div></div>\`;
  h+=\`<div class="sticky"><div class="sticky-in"><button class="submit" onclick="doSubmit()">Enviar formulario</button></div></div>\`;
  app.innerHTML=h;
}
function doSubmit(){
  document.getElementById("err").textContent="";
  for(const c of campos){
    if(c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)&&!isLocked(c)){
      const v=vals[c.id];if(!v||(Array.isArray(v)&&v.length===0)){document.getElementById("err").textContent='El campo "'+c.label+'" es obligatorio.';return;}
    }
  }
  const lines=campos.filter(c=>c.tipo!=="seccion"&&c.tipo!=="info"&&vals[c.id]).map(c=>{
    let v=Array.isArray(vals[c.id])?vals[c.id].join(", "):vals[c.id];
    if(c.tipo==="tel_combo"){const code=vals["_cod_"+c.id]||"";v=code+" "+v;}
    return" "+c.label+": "+v;});
  const cl=cliente?" Cliente: "+(cliente.nombre||"")+" ("+(cliente.email||"")+")\\n":"";
  const msg=" RESPUESTA: "+(DEF.nombre||"Formulario")+"\\n\\n"+cl+lines.join("\\n")+"\\n\\nFecha: "+new Date().toISOString().split("T")[0];
  const tel="${ie}";
  submitted=true;store.set(formKey,'1');render();
  setTimeout(()=>{window.open("https://wa.me/"+(tel?tel:"")+"?text="+encodeURIComponent(msg),"_blank");},600);
}
render();
<\/script></body></html>`},[B,H]=F.useState(""),ee=()=>{var Me,Le,Ie,dt,Ze,mt,Yt,_t,oi,Ii,go;if(!S.email&&!S.nombre)return;const I={nombre:S.nombre,email:S.email,tel:((S.codTel||"+57").replace(/[^0-9+]/g,"")+" "+S.tel).trim()},N=M(I,E),q=new Blob([N],{type:"text/html"}),J=URL.createObjectURL(q);z(J),L(`formulario-${(h||"form").replace(/\s+/g,"-").toLowerCase()}-${(S.nombre||"cliente").replace(/\s+/g,"-").toLowerCase()}.html`);const R=ht()+Date.now().toString(36),ie=vi(),fe=(((Me=ie.app)==null?void 0:Me.url)||"").replace(/\/$/,"");if(fe){const ki={linkId:R,maxUsos:Z||0,fechaCaducidad:P||""},Er={id:(g==null?void 0:g.id)||"form",nombre:h,campos:v,config:{...f,titulo:f.titulo||h,paisProyecto:E},cliente:I||null,linkConfig:ki,modulo:j,marca:{logo:((Le=ie.apariencia)==null?void 0:Le.logo)||"",colorPrimario:((Ie=ie.apariencia)==null?void 0:Ie.colorPrimario)||"#111",colorSecundario:((dt=ie.apariencia)==null?void 0:dt.colorSecundario)||"#3B3B3B",colorAcento:((Ze=ie.apariencia)==null?void 0:Ze.colorAcento)||"#111111",tipografia:((mt=ie.apariencia)==null?void 0:mt.tipografia)||"DM Sans",slogan:((Yt=ie.apariencia)==null?void 0:Yt.slogan)||((_t=ie.empresa)==null?void 0:_t.eslogan)||"",empresa:((oi=ie.empresa)==null?void 0:oi.nombre)||"Habitaris",razonSocial:((Ii=ie.empresa)==null?void 0:Ii.razonSocial)||"",domicilio:((go=ie.empresa)==null?void 0:go.domicilio)||""}},Qi=ic(Er);H(`${fe}/form#${Qi}`)}s({id:ht(),formId:(g==null?void 0:g.id)||"nuevo",formNombre:h||"(sin nombre)",cliente:I,fecha:Ki(),hora:new Date().toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}),linkId:R,maxUsos:Z||0,expiry:P||""})},[D,O]=F.useState(!1),[le,re]=F.useState(!1),de=()=>{if(!_)return;const I=document.createElement("a");I.href=_,I.download=T||"formulario.html",I.click()},G=()=>{const I=vi(),N=S.nombre||"cliente",q=B?`

 ${B}`:"",J=I.whatsapp.mensajePlantilla.replace(/\{\{nombre\}\}/g,N).replace(/\{\{formulario\}\}/g,h||"Formulario").replace(/\{\{empresa\}\}/g,I.empresa.nombre)+q,R=S.tel?(S.codTel||"+57").replace(/[^0-9]/g,"")+S.tel.replace(/[^0-9]/g,""):"";window.open(`https://wa.me/${R}?text=${encodeURIComponent(J)}`,"_blank")},ce=async()=>{if(!S.email){alert("Ingresa el email del cliente");return}const I=vi();O(!0);const N=await Dm({client_name:S.nombre||"Cliente",client_email:S.email,form_name:h||"Formulario",from_name:I.empresa.nombre,form_link:B||"En breve recibirs el formulario por WhatsApp."});O(!1),N?(re(!0),setTimeout(()=>re(!1),5e3)):alert("Error al enviar. Revisa Configuracin  Correo / EmailJS.")},V=()=>{A({nombre:"",email:"",tel:"",codTel:""}),z(""),L(""),H(""),w("Colombia"),u(!0)},Y=d!==null?v[d]:null;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:[e.jsx("input",{value:h,onChange:I=>b(I.target.value),placeholder:"Nombre del formulario",style:{...St,fontSize:16,fontWeight:700,padding:"8px 12px",flex:1,maxWidth:400}}),e.jsx("select",{value:j,onChange:I=>k(I.target.value),style:{...St,width:160},children:Pa.map(I=>e.jsx("option",{value:I.id,children:I.lbl},I.id))})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(Co,{v:"sec",on:()=>x(!l),children:[e.jsx(vn,{size:11})," ",l?"Editor":"Vista previa"]}),e.jsxs(Co,{v:"sec",on:V,children:[e.jsx(op,{size:11})," Compartir"]}),e.jsxs(Co,{on:U,children:[e.jsx(xt,{size:11})," ",g?"Actualizar":"Guardar"]})]})]}),e.jsxs(Lt,{style:{padding:"8px 14px",marginBottom:14,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Ttulo pblico"}),e.jsx("input",{value:f.titulo,onChange:I=>p({...f,titulo:I.target.value}),placeholder:h,style:{...St,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Subttulo"}),e.jsx("input",{value:f.subtitulo||"",onChange:I=>p({...f,subtitulo:I.target.value}),placeholder:"Descripcin breve",style:{...St,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Mensaje de xito"}),e.jsx("input",{value:f.mensajeExito||"",onChange:I=>p({...f,mensajeExito:I.target.value}),placeholder:"Gracias!",style:{...St,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{width:130},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Tel WhatsApp"}),e.jsx("input",{value:f.telRespuesta||"",onChange:I=>p({...f,telRespuesta:I.target.value}),placeholder:"573001234567",style:{...St,width:"100%",fontSize:10}})]})]}),e.jsxs(Lt,{style:{padding:"8px 14px",marginBottom:14,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{minWidth:120},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Vista del formulario"}),e.jsx("div",{style:{display:"flex",gap:4,marginTop:3},children:[{v:"pasos",l:" Paso a paso"},{v:"scroll",l:" Completo"}].map(I=>e.jsx("button",{type:"button",onClick:()=>p({...f,vista:I.v}),style:{...Mm,padding:"4px 10px",fontSize:9,fontWeight:(f.vista||"pasos")===I.v?700:400,borderRadius:4,border:(f.vista||"pasos")===I.v?`2px solid ${xe.ink}`:`1px solid ${xe.border}`,background:(f.vista||"pasos")===I.v?xe.ink:"#fff",color:(f.vista||"pasos")===I.v?"#fff":xe.inkMid,cursor:"pointer"},children:I.l},I.v))})]}),e.jsxs("div",{style:{minWidth:100},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Color del botn"}),e.jsxs("div",{style:{display:"flex",gap:4,marginTop:3,alignItems:"center"},children:[["#111111","#3B3B3B","#111111","#111111","#8B2252"].map(I=>e.jsx("button",{type:"button",onClick:()=>p({...f,colorAccent:I}),style:{width:20,height:20,borderRadius:"50%",background:I,border:(f.colorAccent||"#111111")===I?"3px solid #111111":"2px solid #ddd",cursor:"pointer",padding:0}},I)),e.jsx("input",{type:"color",value:f.colorAccent||"#111111",onChange:I=>p({...f,colorAccent:I.target.value}),style:{width:20,height:20,border:"none",padding:0,cursor:"pointer",borderRadius:4}})]})]}),e.jsxs("div",{style:{flex:1,minWidth:120},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Texto del botn enviar"}),e.jsx("input",{value:f.botonTexto||"",onChange:I=>p({...f,botonTexto:I.target.value}),placeholder:"Enviar formulario",style:{...St,width:"100%",fontSize:10}})]})]}),l?e.jsxs(Lt,{style:{maxWidth:640,margin:"0 auto",padding:"32px 28px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[e.jsx("h2",{style:{fontSize:20,fontWeight:700,margin:"0 0 4px"},children:f.titulo||h||"Formulario"}),f.subtitulo&&e.jsx("p",{style:{fontSize:12,color:xe.inkMid},children:f.subtitulo})]}),v.map(I=>(oa.find(N=>N.tipo===I.tipo),I.tipo==="seccion"?e.jsxs("div",{style:{marginTop:20,marginBottom:8,paddingTop:14,borderTop:`2px solid ${xe.ink}`},children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700},children:I.label}),I.desc&&e.jsx("p",{style:{fontSize:10,color:xe.inkMid,marginTop:2},children:I.desc})]},I.id):I.tipo==="info"?e.jsx("div",{style:{marginBottom:12,padding:"10px 14px",background:xe.blueBg,borderRadius:6,fontSize:11,color:xe.blue},children:I.label},I.id):e.jsxs("div",{style:{marginBottom:14},children:[e.jsxs("label",{style:{display:"block",fontSize:11,fontWeight:600,marginBottom:4},children:[I.label,I.required&&e.jsx("span",{style:{color:xe.red},children:" *"})]}),(I.tipo==="text"||I.tipo==="email"||I.tipo==="tel"||I.tipo==="number"||I.tipo==="date")&&e.jsx("input",{type:I.tipo,placeholder:I.placeholder,disabled:!0,style:{...St,width:"100%",background:"#FFFFFF"}}),I.tipo==="textarea"&&e.jsx("textarea",{rows:2,placeholder:I.placeholder,disabled:!0,style:{...St,width:"100%",resize:"vertical",background:"#FFFFFF"}}),I.tipo==="select"&&e.jsxs("select",{disabled:!0,style:{...St,width:"100%",background:"#FFFFFF"},children:[e.jsx("option",{children:"Seleccionar..."}),(I.opciones||[]).map(N=>e.jsx("option",{children:N},N))]}),I.tipo==="radio"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:4},children:(I.opciones||[]).map(N=>e.jsxs("label",{style:{fontSize:11,display:"flex",alignItems:"center",gap:6,padding:"4px 8px",borderRadius:4,background:"#FFFFFF"},children:[e.jsx("input",{type:"radio",name:I.id,disabled:!0}),N]},N))}),I.tipo==="chips"&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:4},children:(I.opciones||[]).map(N=>e.jsx("span",{style:{fontSize:10,padding:"4px 12px",borderRadius:14,border:`1px solid ${xe.border}`,background:"#fff"},children:N},N))}),I.tipo==="rango"&&e.jsxs("select",{disabled:!0,style:{...St,width:"100%",background:"#FFFFFF"},children:[e.jsx("option",{children:"Seleccionar..."}),(I.opciones||[]).map(N=>e.jsx("option",{children:N},N))]}),I.tipo==="rating"&&e.jsx("div",{style:{display:"flex",gap:4,marginTop:4},children:[1,2,3,4,5].map(N=>e.jsx("span",{style:{fontSize:20,opacity:.3},children:""},N))}),I.tipo==="yesno"&&e.jsx("div",{style:{display:"flex",gap:8,marginTop:4},children:["S","No"].map(N=>e.jsx("span",{style:{fontSize:10,padding:"6px 16px",borderRadius:14,border:`1px solid ${xe.border}`,background:"#fff",fontWeight:600},children:N},N))})]},I.id)))]}):e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsxs(Lt,{style:{width:180,flexShrink:0,padding:8,alignSelf:"flex-start",position:"sticky",top:20},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",padding:"4px 8px",marginBottom:4},children:"Bloques"}),oa.map(I=>e.jsxs("button",{onClick:()=>he(I.tipo),style:{display:"flex",alignItems:"center",gap:6,width:"100%",padding:"6px 8px",border:"none",background:"transparent",borderRadius:4,cursor:"pointer",fontSize:10,color:xe.ink,fontFamily:"'DM Sans',sans-serif",textAlign:"left"},onMouseEnter:N=>N.currentTarget.style.background=xe.accent,onMouseLeave:N=>N.currentTarget.style.background="transparent",children:[e.jsx("span",{children:I.icon})," ",I.lbl]},I.tipo))]}),e.jsxs("div",{style:{flex:1},children:[v.length===0&&e.jsxs(Lt,{style:{textAlign:"center",padding:40,color:xe.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("div",{style:{fontSize:14,fontWeight:600},children:"Aade bloques desde el panel izquierdo"}),e.jsx("div",{style:{fontSize:10,marginTop:4},children:"Arrastra y configura los campos de tu formulario"})]}),v.map((I,N)=>{var R,ie,fe;const q=oa.find(Me=>Me.tipo===I.tipo),J=d===N;return e.jsxs("div",{onClick:()=>c(N),style:{background:"#fff",border:`1px solid ${J?xe.blue:xe.border}`,borderRadius:6,padding:"10px 12px",marginBottom:6,cursor:"pointer",boxShadow:J?"0 0 0 2px #3B3B3B22":"none",transition:"all .15s",display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("button",{onClick:Me=>{Me.stopPropagation(),ae(N,-1)},style:{background:"none",border:"none",cursor:"pointer",padding:0,color:N===0?xe.inkXLight:xe.inkMid},children:e.jsx(Js,{size:10})}),e.jsx("button",{onClick:Me=>{Me.stopPropagation(),ae(N,1)},style:{background:"none",border:"none",cursor:"pointer",padding:0,color:N===v.length-1?xe.inkXLight:xe.inkMid},children:e.jsx(Fn,{size:10})})]}),e.jsx("span",{style:{fontSize:14},children:(q==null?void 0:q.icon)||""}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600},children:[I.label,I.required&&e.jsx("span",{style:{color:xe.red,fontSize:9,marginLeft:4},children:"obligatorio"}),((R=I.scoring)==null?void 0:R.enabled)&&e.jsx("span",{style:{fontSize:9,marginLeft:4},children:""})]}),e.jsxs("div",{style:{fontSize:8,color:xe.inkLight},children:[q==null?void 0:q.lbl," ",I.logica?` Condicional: si "${((ie=v.find(Me=>{var Le;return Me.id===((Le=I.logica)==null?void 0:Le.fieldId)}))==null?void 0:ie.label)||"?"}" = "${((fe=I.logica)==null?void 0:fe.value)||"?"}"`:""]})]}),e.jsx("button",{onClick:Me=>{Me.stopPropagation(),Q(N,"required",!I.required)},title:I.required?"Obligatorio":"Opcional",style:{background:"none",border:"none",cursor:"pointer",color:I.required?xe.red:xe.inkXLight},children:I.required?e.jsx(np,{size:16}):e.jsx(rp,{size:16})}),e.jsx("button",{onClick:Me=>{Me.stopPropagation(),Se(N)},style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(He,{size:12})})]},I.id)})]}),Y&&e.jsxs(Lt,{style:{width:260,flexShrink:0,padding:12,alignSelf:"flex-start",position:"sticky",top:20},children:[e.jsxs("div",{style:{fontSize:10,fontWeight:700,marginBottom:10,display:"flex",alignItems:"center",gap:6},children:[e.jsx(Ad,{size:12})," Configurar campo"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Etiqueta / Pregunta"}),e.jsx("input",{value:Y.label,onChange:I=>Q(d,"label",I.target.value),style:{...St,width:"100%"}})]}),Y.tipo!=="seccion"&&Y.tipo!=="info"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Placeholder"}),e.jsx("input",{value:Y.placeholder||"",onChange:I=>Q(d,"placeholder",I.target.value),style:{...St,width:"100%"}})]}),(Y.tipo==="seccion"||Y.tipo==="info")&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Descripcin"}),e.jsx("textarea",{value:Y.desc||"",onChange:I=>Q(d,"desc",I.target.value),rows:2,style:{...St,width:"100%",resize:"vertical"}})]}),["select","radio","chips","rango"].includes(Y.tipo)&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Opciones (una por lnea)"}),e.jsx("textarea",{value:(Y.opciones||[]).join(`
`),onChange:I=>Q(d,"opciones",I.target.value.split(`
`).filter(Boolean)),rows:4,style:{...St,width:"100%",resize:"vertical",fontFamily:"'DM Mono',monospace",fontSize:10}})]}),Y.tipo!=="seccion"&&Y.tipo!=="info"&&e.jsx("div",{style:{marginBottom:8},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:10,fontWeight:600},children:[e.jsx("input",{type:"checkbox",checked:Y.required,onChange:I=>Q(d,"required",I.target.checked),style:{accentColor:xe.red}}),"Obligatorio"]})}),Y.tipo!=="seccion"&&Y.tipo!=="info"&&v.filter(I=>I.id!==Y.id&&I.tipo!=="seccion"&&I.tipo!=="info").length>0&&e.jsxs("div",{style:{marginBottom:8,borderTop:`1px solid ${xe.border}`,paddingTop:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Lgica condicional"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:9},children:"Mostrar si"}),e.jsxs("select",{value:((W=Y.logica)==null?void 0:W.fieldId)||"",onChange:I=>{var q;const N=I.target.value;Q(d,"logica",N?{fieldId:N,value:((q=Y.logica)==null?void 0:q.value)||""}:null)},style:{...St,fontSize:9,flex:1},children:[e.jsx("option",{value:"",children:"Sin condicin"}),v.filter(I=>I.id!==Y.id&&I.tipo!=="seccion"&&I.tipo!=="info").map(I=>e.jsx("option",{value:I.id,children:I.label},I.id))]})]}),((se=Y.logica)==null?void 0:se.fieldId)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:9},children:"= "}),e.jsx("input",{value:((ge=Y.logica)==null?void 0:ge.value)||"",onChange:I=>Q(d,"logica",{...Y.logica,value:I.target.value}),placeholder:"valor",style:{...St,fontSize:9,flex:1}})]})]}),e.jsxs("div",{style:{borderTop:`1px solid ${xe.border}`,paddingTop:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Clave de mapeo (integracin)"}),e.jsx("input",{value:Y.mapKey||"",onChange:I=>Q(d,"mapKey",I.target.value),placeholder:"ej: nombre, email",style:{...St,width:"100%",fontSize:9}})]}),["select","radio","chips","yesno","rango"].includes(Y.tipo)&&e.jsxs("div",{style:{borderTop:`1px solid ${xe.border}`,paddingTop:8,marginTop:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:10,fontWeight:700,marginBottom:6},children:[e.jsx("input",{type:"checkbox",checked:!!((ue=Y.scoring)!=null&&ue.enabled),onChange:I=>{const N=Y.scoring?{...Y.scoring,enabled:I.target.checked}:{enabled:I.target.checked,weight:1,rules:{}};Q(d,"scoring",N)},style:{accentColor:"#111111"}})," Regla de scoring"]}),((ye=Y.scoring)==null?void 0:ye.enabled)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:6},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Peso"}),e.jsx("select",{value:((be=Y.scoring)==null?void 0:be.weight)||1,onChange:I=>Q(d,"scoring",{...Y.scoring,weight:parseInt(I.target.value)}),style:{...St,width:60,fontSize:9},children:[1,2,3,4,5].map(I=>e.jsxs("option",{value:I,children:[I," pts"]},I))})]}),e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"Clasificar opciones"}),(Y.opciones||["S","No"]).map(I=>{var q,J;const N=((J=(q=Y.scoring)==null?void 0:q.rules)==null?void 0:J[I])||"neutral";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:3},children:[e.jsx("div",{style:{flex:1,fontSize:9,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:I}),[{v:"green",l:""},{v:"neutral",l:""},{v:"red",l:""}].map(R=>e.jsx("button",{type:"button",onClick:()=>{var fe;const ie={...((fe=Y.scoring)==null?void 0:fe.rules)||{},[I]:R.v};Q(d,"scoring",{...Y.scoring,rules:ie})},style:{width:22,height:22,border:N===R.v?"2px solid #111":"1px solid #ddd",borderRadius:4,background:N===R.v?"#F5F4F1":"#fff",cursor:"pointer",fontSize:12,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:R.l},R.v))]},I)})]})]})]})]}),y&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"flex-start",justifyContent:"center",paddingTop:40,overflowY:"auto"},onClick:()=>u(!1),children:e.jsxs("div",{onClick:I=>I.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:460,maxHeight:"85vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)",marginBottom:40},children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700,marginBottom:4},children:" Enviar formulario a cliente"}),e.jsxs("p",{style:{margin:"0 0 16px",fontSize:10,color:xe.inkMid},children:[h||"Sin nombre","  Se genera un archivo HTML que el cliente abre en su navegador"]}),e.jsxs("div",{style:{background:xe.accent,borderRadius:6,padding:"12px 14px",marginBottom:14},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:8},children:" Datos del cliente"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Nombre *"}),e.jsx("input",{value:S.nombre,onChange:I=>{A({...S,nombre:I.target.value}),z("")},placeholder:"Juan Prez",style:{...St,width:"100%",fontSize:11}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Email"}),e.jsx("input",{value:S.email,onChange:I=>{A({...S,email:I.target.value}),z("")},placeholder:"juan@empresa.com",type:"email",style:{...St,width:"100%",fontSize:11}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"WhatsApp"}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("select",{value:S.codTel||{Colombia:"+57",Espaa:"+34",Mxico:"+52",Chile:"+56",Per:"+51",Ecuador:"+593",Argentina:"+54",Panam:"+507","Estados Unidos":"+1"}[E]||"+57",onChange:I=>{A({...S,codTel:I.target.value}),z("")},style:{...St,width:80,flexShrink:0,borderRadius:"6px 0 0 6px",borderRight:"none",fontWeight:700,fontSize:11,color:"#3B3B3B",background:"#F5F4F1"},children:["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"].map(I=>e.jsx("option",{value:I,children:I},I))}),e.jsx("input",{value:S.tel,onChange:I=>{A({...S,tel:I.target.value}),z("")},placeholder:"3001234567",style:{...St,flex:1,fontSize:11,borderRadius:"0 6px 6px 0"}})]})]})]}),e.jsxs("div",{style:{background:"#F5F0FF",borderRadius:6,padding:"12px 14px",marginBottom:14,border:"1px solid #11111122"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#111111",textTransform:"uppercase",marginBottom:8},children:" Pas del proyecto"}),e.jsx("select",{value:E,onChange:I=>{w(I.target.value),z("")},style:{...St,width:"100%",fontSize:11,marginBottom:8},children:["Colombia","Espaa","Mxico","Chile","Per","Ecuador","Argentina","Panam","Estados Unidos","Otro"].map(I=>e.jsx("option",{value:I,children:I},I))}),e.jsx("div",{style:{fontSize:8,color:"#111111",lineHeight:1.4},children:" Define la divisa, departamentos/comunidades, tipo de documento y cdigo telefnico del formulario"})]}),e.jsxs("div",{style:{background:"#F5F0FF",borderRadius:6,padding:"12px 14px",marginBottom:14,border:"1px solid #11111122"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#111111",textTransform:"uppercase",marginBottom:8},children:" Control del enlace"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Mximo de envos"}),e.jsxs("select",{value:Z,onChange:I=>{K(parseInt(I.target.value)),z("")},style:{...St,width:"100%",fontSize:11},children:[e.jsx("option",{value:0,children:" Ilimitado"}),e.jsx("option",{value:1,children:"1 vez"}),e.jsx("option",{value:2,children:"2 veces"}),e.jsx("option",{value:3,children:"3 veces"}),e.jsx("option",{value:5,children:"5 veces"}),e.jsx("option",{value:10,children:"10 veces"})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Fecha de caducidad"}),e.jsx("input",{type:"date",value:P,onChange:I=>{te(I.target.value),z("")},min:new Date().toISOString().split("T")[0],style:{...St,width:"100%",fontSize:11}})]})]}),e.jsxs("div",{style:{fontSize:8,color:"#111111",marginTop:6,lineHeight:1.4},children:[Z>0?` El cliente podr enviar mximo ${Z} ${Z===1?"vez":"veces"}`:" Sin lmite de envos",P?`   Caduca el ${new Date(P+"T23:59:59").toLocaleDateString("es-CO",{day:"numeric",month:"short",year:"numeric"})}`:"  Sin caducidad"]})]}),_?e.jsxs("div",{style:{marginBottom:10,padding:"8px 10px",background:xe.greenBg,borderRadius:4,border:`1px solid ${xe.green}33`,fontSize:9,color:xe.green,fontWeight:600},children:[" Formulario listo para ",S.nombre||S.email,"  ",e.jsx("strong",{children:T}),B&&e.jsx("div",{style:{marginTop:4,fontSize:8,color:xe.inkMid,fontWeight:400},children:" Link pblico generado  se enviar por email y WhatsApp automticamente"})]}):e.jsx(Co,{on:ee,style:{width:"100%",justifyContent:"center",marginBottom:14,padding:"10px 0"},disabled:!S.nombre,children:" Generar formulario personalizado"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,opacity:_?1:.4,pointerEvents:_?"auto":"none"},children:[e.jsxs("button",{onClick:de,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${xe.border}`,borderRadius:6,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:xe.greenBg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Et,{size:14,color:xe.green})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:" Descargar formulario (.html)"}),e.jsx("div",{style:{fontSize:8,color:xe.inkMid},children:"Archivo que puedes adjuntar por WhatsApp o email"})]})]}),e.jsxs("button",{onClick:G,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${xe.border}`,borderRadius:6,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:"#E8F8E8",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(jr,{size:14,color:"#25D366"})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:"Abrir WhatsApp"}),e.jsx("div",{style:{fontSize:8,color:xe.inkMid},children:S.tel?`Mensaje al ${S.codTel||"+57"} ${S.tel}`:"Adjunta el archivo descargado"})]})]}),e.jsxs("button",{onClick:ce,disabled:D,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${le?xe.green:xe.border}`,borderRadius:6,background:le?xe.greenBg:"#fff",cursor:D?"wait":"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left",opacity:D?.6:1},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:le?xe.greenBg:xe.amberBg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(An,{size:14,color:le?xe.green:xe.amber})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:D?"Enviando...":le?" Email enviado con link":` Enviar email con link (${vi().correo.emailPrincipal})`}),e.jsx("div",{style:{fontSize:8,color:xe.inkMid},children:le?`Enviado a ${S.email} con link directo`:S.email?"El cliente recibe email con link al formulario":"Ingresa email del cliente"})]})]})]}),e.jsxs("div",{style:{marginTop:12,padding:"8px 10px",background:xe.accent,borderRadius:4,fontSize:8,color:xe.inkMid,lineHeight:1.5},children:[" ",e.jsx("strong",{children:"Flujo recomendado:"}),e.jsx("br",{}),"1 ",e.jsx("strong",{children:"Email"}),"  el cliente recibe un link directo al formulario",e.jsx("br",{}),"2 ",e.jsx("strong",{children:"WhatsApp"}),"  tambin incluye el link al formulario",e.jsx("br",{}),"3 ",e.jsx("strong",{children:"Descargar"}),"  archivo .html de respaldo (funciona sin internet)"]}),e.jsx(Co,{v:"sec",on:()=>u(!1),style:{width:"100%",marginTop:10,justifyContent:"center"},children:"Cerrar"})]})})]})}function Om({forms:t,setForms:i,onEdit:o,onNew:n}){const[a,r]=F.useState(""),s=t.filter(b=>{var k,v;const j=a.toLowerCase();return!j||((k=b.nombre)==null?void 0:k.toLowerCase().includes(j))||((v=b.modulo)==null?void 0:v.toLowerCase().includes(j))}),g=b=>{confirm("Eliminar formulario?")&&i(t.filter(j=>j.id!==b))},h=b=>i([...t,{...b,id:ht(),nombre:b.nombre+" (copia)",createdAt:Ki(),updatedAt:Ki()}]);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Mis formularios  ",t.length]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ci,{size:12,style:{position:"absolute",left:8,top:8,color:xe.inkLight}}),e.jsx("input",{value:a,onChange:b=>r(b.target.value),placeholder:"Buscar...",style:{...St,paddingLeft:26,width:180}})]}),e.jsxs(Co,{on:n,children:[e.jsx(Oe,{size:11})," Nuevo formulario"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280,1fr))",gap:12},children:s.map(b=>{const j=(b.campos||[]).filter(m=>m.tipo!=="seccion"&&m.tipo!=="info").length,k=(b.campos||[]).filter(m=>m.required).length,v=Pa.find(m=>m.id===b.modulo);return e.jsxs(Lt,{style:{padding:0,overflow:"hidden",cursor:"pointer"},onClick:()=>o(b.id),children:[e.jsxs("div",{style:{padding:"14px 16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:b.nombre}),e.jsxs("div",{style:{fontSize:9,color:xe.inkMid,marginTop:2},children:[j," campos  ",k," obligatorios"]})]}),e.jsx(nr,{color:xe.blue,children:(v==null?void 0:v.lbl)||"General"})]}),e.jsxs("div",{style:{fontSize:8,color:xe.inkLight,marginTop:6},children:["Creado: ",b.createdAt,"  Editado: ",b.updatedAt]})]}),e.jsxs("div",{style:{borderTop:`1px solid ${xe.border}`,display:"flex",padding:"0"},children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),o(b.id)},style:{flex:1,padding:"6px 0",border:"none",background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:xe.blue,fontFamily:"'DM Sans',sans-serif"},children:" Editar"}),e.jsx("button",{onClick:m=>{m.stopPropagation(),h(b)},style:{flex:1,padding:"6px 0",border:"none",borderLeft:`1px solid ${xe.border}`,background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:xe.inkMid,fontFamily:"'DM Sans',sans-serif"},children:" Duplicar"}),e.jsx("button",{onClick:m=>{m.stopPropagation(),g(b.id)},style:{flex:1,padding:"6px 0",border:"none",borderLeft:`1px solid ${xe.border}`,background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:xe.red,fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]},b.id)})})]})}function Lm({forms:t,respuestas:i,onReload:o,loading:n,onDelete:a,onClearAll:r}){const[s,g]=F.useState(""),[h,b]=F.useState(null),[j,k]=F.useState(new Set),[v,m]=F.useState(!1),[f,p]=F.useState(""),[d,c]=F.useState(null),[l,x]=F.useState(!1),[y,u]=F.useState(!1),[S,A]=F.useState(()=>{try{return JSON.parse(Ee.getSync("hab:form:procesados")||"[]")}catch{return[]}}),[E,w]=F.useState("todos");F.useEffect(()=>{Promise.resolve(!1).then(x)},[]);const _=B=>k(H=>{const ee=new Set(H);return ee.has(B)?ee.delete(B):ee.add(B),ee}),z=B=>k(H=>H.size===B.length?new Set:new Set(B)),T=Ee.getSync("hab:form:deletePass")||"",L=T||y,Z=async B=>{if(!L){K(B);return}if(y){if(T){c(B),p(""),m(!0);return}return}T&&(c(B),p(""),m(!0))},K=B=>{B.type==="single"&&a?a(B.target):B.type==="selected"&&a?(j.forEach(H=>{const ee=i.find(D=>D.id===H);ee&&a(ee)}),k(new Set)):B.type==="all"&&r&&(r(),k(new Set)),m(!1),c(null)},P=()=>{f===T?K(d):alert("Contrasea incorrecta")},te=(B,H)=>{const ee=[...S,B];A(ee),Ee.set("hab:form:procesados",JSON.stringify(ee))},he=(B,H)=>{const ee=S.filter(D=>D!==B);A(ee),Ee.set("hab:form:procesados",JSON.stringify(ee))},Q=B=>B.processed||S.includes(B.id),Se=async B=>{var H,ee,D,O,le;try{let re=[];try{const Y=Ee.getSync("hab:crm:clientes2");Y&&(re=JSON.parse(Y)||[])}catch{}const de=re.find(Y=>Y.email&&Y.email===B.clienteEmail);let G;if(de)G=de.id;else{const Y={id:Math.random().toString(36).slice(2,9),nombre:B.razonSocial||B.clienteNombre||"",tipo:B.razonSocial?"Empresa":"Persona natural",nit:B.documento||"",email:B.clienteEmail||"",telMovil:B.clienteTel||B.telefono||"",prefijoMovil:"+57",ciudad:B.ciudad||"",pais:"CO",notas:[B.edificio?`Proyecto: ${B.edificio}`:"",B.tipoProyecto?`Tipo: ${B.tipoProyecto}`:"",B.area?`rea: ${B.area} m`:"",B.presupuesto?`Presupuesto: ${Number(B.presupuesto).toLocaleString("es-CO")}`:""].filter(Boolean).join(" | "),emailFactura:B.emailFactura||B.clienteEmail||"",dirFacturacion:B.dirFacturacion||"",briefingId:B.id,fechaAlta:new Date().toISOString().split("T")[0]};re.push(Y),G=Y.id,Ee.set("hab:crm:clientes2",JSON.stringify(re))}let ce=[];try{const Y=Ee.getSync("hab:v4");Y&&(ce=JSON.parse(Y)||[])}catch{}const V={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),nombre:[B.edificio,(H=B.clienteNombre)==null?void 0:H.split(" ").slice(-1)[0]].filter(Boolean).join("  ")||"Nuevo proyecto",cliente:B.clienteNombre||B.razonSocial||"",clienteId:G,email:B.clienteEmail||"",telefono:B.clienteTel||B.telefono||"",direccion:[B.ciudad,B.edificio].filter(Boolean).join("  "),tipoProyecto:B.tipoProyecto||"",estado:"borrador",fechaOferta:new Date().toISOString().split("T")[0],presupuestoCliente:B.presupuesto?Number(String(B.presupuesto).replace(/[^0-9]/g,"")):0,m2:B.area||"",notas:[(ee=B.servicios)!=null&&ee.length?`Servicios: ${Array.isArray(B.servicios)?B.servicios.join(", "):B.servicios}`:"",(D=B.estilo)!=null&&D.length?`Estilo: ${Array.isArray(B.estilo)?B.estilo.join(", "):B.estilo}`:"",(O=B.espacios)!=null&&O.length?`Espacios: ${Array.isArray(B.espacios)?B.espacios.join(", "):B.espacios}`:"",B.colores?`Materiales: ${B.colores}`:"",(le=B.expectativas)!=null&&le.length?`Expectativas: ${Array.isArray(B.expectativas)?B.expectativas.join("; "):B.expectativas}`:"",B.linksReferentes?`Referencias: ${B.linksReferentes}`:""].filter(Boolean).join(`
`),razonSocial:B.razonSocial||"",documento:B.documento||"",emailFactura:B.emailFactura||B.clienteEmail||"",dirFacturacion:B.dirFacturacion||"",retencion:B.retenciones==="S",detalleRet:B.detalleRetenciones||"",anticipoAcept:B.anticipo||"",formaPago:B.formaPago||"",briefingId:B.id,lineas:[],capitulos:[],cronograma:[]};ce.push(V),Ee.set("hab:v4",JSON.stringify(ce)),te(B.id,B._sbId),alert(` Procesado:

 Cliente: ${de?"ya exista":"creado"}  ${B.clienteNombre||B.clienteEmail}
 Oferta borrador creada en CRM (hab:v4)

Ve a CRM  Ofertas para continuar.`)}catch(re){console.error("procesarRespuesta error:",re),alert("Error procesando respuesta: "+re.message)}};let ae=s?i.filter(B=>B.formularioId===s):i;E==="pendiente"&&(ae=ae.filter(B=>!Q(B))),E==="procesado"&&(ae=ae.filter(B=>Q(B)));const U=i.filter(B=>!Q(B)),M=B=>{var V,Y;const H=vi(),ee=t.find(W=>W.id===B.formularioId)||t.find(W=>W.nombre===B.formularioNombre),D=(ee==null?void 0:ee.campos)||[],O=["id","fecha","formularioId","formularioNombre","clienteNombre","clienteEmail","clienteTel"],le=[];let re={title:"Informacin general",fields:[]};D.forEach(W=>{if(W.tipo==="seccion")re.fields.length>0&&le.push(re),re={title:W.label,desc:W.desc||"",fields:[]};else if(W.tipo!=="info"){const se=W.mapKey||W.id;let ge=B[se];ge===void 0&&Object.entries(B).filter(([ue])=>!O.includes(ue)).forEach(([ue,ye])=>{(ue===W.label||ue===W.mapKey)&&(ge=ye)}),ge!==void 0&&re.fields.push({label:W.label,value:Array.isArray(ge)?ge.join(", "):String(ge),tipo:W.tipo})}}),re.fields.length>0&&le.push(re),(le.length===0||le.every(W=>W.fields.length===0))&&(le.length=0,le.push({title:"Respuestas",desc:"",fields:Object.entries(B).filter(([W])=>!O.includes(W)).map(([W,se])=>({label:W,value:Array.isArray(se)?se.join(", "):String(se),tipo:"text"}))}));const de=new Date().toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}),G=`<!DOCTYPE html><html><head><meta charset="utf-8">
<style>
@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;color:#111;background:#fff}
@page{size:A4;margin:0}
.page{width:210mm;min-height:297mm;margin:0 auto;padding:0;position:relative}

/* Header */
.header{background:#111;color:#fff;padding:28px 36px;display:flex;justify-content:space-between;align-items:center}
.logo{font-size:18px;font-weight:800;letter-spacing:5px;text-transform:uppercase}
.logo-sub{font-size:7px;letter-spacing:3px;color:rgba(255,255,255,.4);text-transform:uppercase;margin-top:2px}
.header-right{text-align:right}
.header-right div{font-size:8px;color:rgba(255,255,255,.5);letter-spacing:1px}

/* Gold bar */
.gold-bar{height:3px;background:linear-gradient(90deg,#111111,#E8D48B,#111111)}

/* Title block */
.title-block{padding:28px 36px 20px;border-bottom:1px solid #E0E0E0}
.doc-type{font-size:8px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#909090;margin-bottom:4px}
.doc-title{font-size:22px;font-weight:700;line-height:1.2;margin-bottom:6px}
.doc-meta{display:flex;gap:24px;margin-top:10px}
.meta-item{font-size:9px;color:#555}
.meta-item strong{color:#111;font-weight:700}

/* Client card */
.client-card{margin:20px 36px;background:#F5F4F1;border:1px solid #E0E0E0;border-radius:6px;padding:16px 20px;display:flex;align-items:center;gap:14px}
.client-avatar{width:42px;height:42px;border-radius:50%;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;flex-shrink:0}
.client-info{flex:1}
.client-name{font-size:14px;font-weight:700}
.client-email{font-size:10px;color:#3B3B3B;margin-top:2px}
.client-tel{font-size:9px;color:#909090;margin-top:1px}

/* Sections */
.section{margin:20px 36px}
.section-title{font-size:12px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:#111;padding-bottom:6px;border-bottom:2px solid #111;margin-bottom:12px;display:flex;align-items:center;gap:6px}
.section-desc{font-size:9px;color:#909090;margin:-8px 0 12px;font-weight:400}

/* Fields */
.field{margin-bottom:10px;display:flex;border-bottom:1px solid #F0EEEA;padding-bottom:8px}
.field-label{width:180px;flex-shrink:0;font-size:9px;font-weight:700;color:#555;text-transform:uppercase;letter-spacing:.5px;padding-top:2px}
.field-value{flex:1;font-size:12px;font-weight:500;color:#111}
.field-rating{color:#111111;font-size:14px;letter-spacing:2px}

/* Footer */
.footer{position:fixed;bottom:0;left:0;right:0;background:#111;color:#fff;padding:12px 36px;display:flex;justify-content:space-between;align-items:center;font-size:7px;letter-spacing:2px}
.footer-gold{height:2px;background:linear-gradient(90deg,#111111,#E8D48B,#111111)}

/* Print */
@media print{
  body{-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .page{width:100%;min-height:auto}
  .no-print{display:none!important}
}
</style></head><body>
<div class="page">
  <!-- Header -->
  <div class="header">
    <div>
      <div class="logo">${H.empresa.nombre.toUpperCase()}</div>
      <div class="logo-sub">${H.empresa.eslogan}</div>
    </div>
    <div class="header-right">
      <div>INFORME DE FORMULARIO</div>
      <div style="margin-top:4px;font-size:9px;color:rgba(255,255,255,.7)">${de}</div>
    </div>
  </div>
  <div class="gold-bar"></div>

  <!-- Title -->
  <div class="title-block">
    <div class="doc-type">Formulario</div>
    <div class="doc-title">${B.formularioNombre||(ee==null?void 0:ee.nombre)||"Respuesta"}</div>
    <div class="doc-meta">
      <div class="meta-item"><strong>Fecha respuesta:</strong> ${B.fecha}</div>
      <div class="meta-item"><strong>ID:</strong> ${((V=B.id)==null?void 0:V.slice(0,8))||""}</div>
      ${ee?`<div class="meta-item"><strong>Mdulo:</strong> ${((Y=Pa.find(W=>W.id===ee.modulo))==null?void 0:Y.lbl)||"General"}</div>`:""}
      <div class="meta-item"><strong>Campos:</strong> ${le.reduce((W,se)=>W+se.fields.length,0)}</div>
    </div>
  </div>

  <!-- Client card -->
  ${B.clienteNombre||B.clienteEmail?`
  <div class="client-card">
    <div class="client-avatar">${(B.clienteNombre||B.clienteEmail||"?")[0].toUpperCase()}</div>
    <div class="client-info">
      ${B.clienteNombre?`<div class="client-name">${B.clienteNombre}</div>`:""}
      ${B.clienteEmail?`<div class="client-email">${B.clienteEmail}</div>`:""}
      ${B.clienteTel?`<div class="client-tel"> ${B.clienteTel}</div>`:""}
    </div>
  </div>`:""}

  <!-- Scoring -->
  ${function(){var W=Ss(B,ee);if(!W)return"";var se={green:{bg:"#E8F4EE",border:"#111111",text:"#111111"},yellow:{bg:"#FAF0E0",border:"#8C6A00",text:"#8C6A00"},red:{bg:"#FAE8E8",border:"#B91C1C",text:"#B91C1C"}},ge=se[W.level],ue=W.details.map(function(ye){var be=ye.flag==="green"?"#111111":ye.flag==="red"?"#B91C1C":"#8C6A00",I=ye.flag==="green"?"":ye.flag==="red"?"":"";return'<tr style="border-bottom:1px solid #F0EEEA"><td style="padding:6px 12px;font-weight:600">'+ye.label+'</td><td style="padding:6px 12px">'+ye.value+'</td><td style="padding:6px 12px;text-align:center;font-weight:700;color:'+be+';font-family:DM Mono,monospace">'+ye.points+"/"+ye.maxPoints+'</td><td style="padding:6px 12px;text-align:center">'+I+"</td></tr>"}).join("");return'<div style="margin:20px 36px;border:1px solid '+ge.border+'44;border-radius:8px;overflow:hidden"><div style="display:flex;align-items:center;gap:16px;padding:16px 20px;background:'+ge.bg+'"><div style="font-size:28px;font-weight:800;font-family:DM Mono,monospace;color:'+ge.text+'">'+W.score.toFixed(1)+'<span style="font-size:12px">/10</span></div><div style="flex:1"><div style="font-size:14px;font-weight:700;color:'+ge.text+'">'+W.levelLabel+'</div><div style="font-size:9px;color:'+ge.text+';opacity:.8;margin-top:2px">'+W.conclusion+'</div></div><div style="display:flex;gap:10px"><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#111111">'+W.greens+'</div><div style="font-size:8px;color:#888"></div></div><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#8C6A00">'+W.yellows+'</div><div style="font-size:8px;color:#888"></div></div><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#B91C1C">'+W.reds+'</div><div style="font-size:8px;color:#888"></div></div></div></div><table style="width:100%;border-collapse:collapse;font-size:10px"><thead><tr style="background:#F5F4F1"><th style="padding:6px 12px;text-align:left;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Criterio</th><th style="padding:6px 12px;text-align:left;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Respuesta</th><th style="padding:6px 12px;text-align:center;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Puntos</th><th style="padding:6px 12px;text-align:center;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0"></th></tr></thead><tbody>'+ue+"</tbody></table></div>"}()}

  <!-- Sections -->
  ${le.map((W,se)=>`
  <div class="section">
    <div class="section-title"><span style="color:#111111"></span> ${W.title}</div>
    ${W.desc?`<div class="section-desc">${W.desc}</div>`:""}
    ${W.fields.map(ge=>`
    <div class="field">
      <div class="field-label">${ge.label}</div>
      <div class="field-value">${ge.tipo==="rating"?`<span class="field-rating">${"".repeat(parseInt(ge.value)||0)}${"".repeat(5-(parseInt(ge.value)||0))}</span> <span style="font-size:10px;color:#909090">(${ge.value}/5)</span>`:ge.tipo==="yesno"?`<span style="display:inline-block;padding:2px 12px;border-radius:10px;font-size:10px;font-weight:700;background:${ge.value==="S"?"#E8F4EE":"#FAE8E8"};color:${ge.value==="S"?"#111111":"#B91C1C"}">${ge.value}</span>`:ge.value}</div>
    </div>`).join("")}
  </div>`).join("")}

  <!-- Confidentiality -->
  <div style="margin:30px 36px;padding:12px 16px;background:#F5F4F1;border-radius:4px;border-left:3px solid #111111">
    <div style="font-size:7px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#909090;margin-bottom:4px">CONFIDENCIALIDAD</div>
    <div style="font-size:8px;color:#555;line-height:1.6">Este documento contiene informacin confidencial de ${H.empresa.nombre} y su cliente. Queda prohibida su reproduccin o distribucin sin autorizacin expresa.</div>
  </div>

  <!-- Footer -->
  <div class="footer-gold" style="position:fixed;bottom:28px;left:0;right:0"></div>
  <div class="footer">
    <span>${H.empresa.nombre.toUpperCase()}  ${B.formularioNombre||""}  ${B.clienteNombre||""}</span>
    <span>${de}</span>
  </div>
</div>

<!-- Print button -->
<div class="no-print" style="position:fixed;top:12px;right:12px;display:flex;gap:8px;z-index:100">
  <button onclick="window.print()" style="padding:10px 24px;background:#111;color:#fff;border:none;border-radius:6px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;letter-spacing:1px"> Imprimir / PDF</button>
  <button onclick="window.close()" style="padding:10px 16px;background:#fff;color:#111;border:1px solid #E0E0E0;border-radius:6px;font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer"> Cerrar</button>
</div>
</body></html>`,ce=window.open("","_blank");ce.document.write(G),ce.document.close()};return e.jsxs("div",{className:"fade-up",children:[U.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",background:"#F3EEFF",border:"1px solid #11111133",borderRadius:8,marginBottom:14},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:"#111111",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:700,flexShrink:0},children:U.length}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#111111"},children:[" Tienes ",U.length," formulario",U.length>1?"s":""," sin asignar"]}),e.jsx("div",{style:{fontSize:9,color:"#555555",marginTop:2},children:'Haz clic en "Procesar" para crear cliente y borrador de oferta en CRM automticamente'})]}),e.jsx("button",{onClick:()=>w("pendiente"),style:{padding:"6px 14px",fontSize:10,fontWeight:700,background:"#111111",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Ver pendientes"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Respuestas  ",i.length]}),o&&e.jsxs("button",{onClick:o,disabled:n,style:{padding:"4px 10px",fontSize:9,fontWeight:600,cursor:n?"wait":"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${xe.border}`,borderRadius:4,background:"#fff",color:xe.inkMid,opacity:n?.5:1},children:[" ",n?"Cargando...":"Recargar"]}),j.size>0&&e.jsxs("button",{onClick:()=>Z({type:"selected"}),style:{padding:"4px 14px",fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:"none",borderRadius:4,background:xe.red,color:"#fff"},children:[" Eliminar seleccionados (",j.size,")"]}),j.size===0&&r&&i.length>0&&e.jsx("button",{onClick:()=>Z({type:"all"}),style:{padding:"4px 10px",fontSize:9,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${xe.red}44`,borderRadius:4,background:"#fff",color:xe.red},children:" Limpiar todo"}),e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[l&&e.jsx("button",{onClick:async()=>{y?confirm("Desactivar Touch ID / biometra?")&&u(!1):alert("No se pudo registrar. Intenta de nuevo.")},style:{background:"none",border:`1px solid ${y?"#111111":"#ddd"}`,borderRadius:4,cursor:"pointer",fontSize:10,padding:"3px 8px",color:y?"#111111":"#888"},title:y?"Touch ID activo  clic para desactivar":"Activar Touch ID",children:y?" Touch ID":" Activar Touch ID"}),e.jsx("button",{onClick:()=>{const B=Ee.getSync("hab:form:deletePass")||"",H=prompt("Contrasea para eliminar (dejar vaco para desactivar):",B);H!==null&&(H?Ee.set("hab:form:deletePass",H):Ee.delete("hab:form:deletePass"))},style:{background:"none",border:"none",cursor:"pointer",fontSize:12,opacity:.4},title:T?" Contrasea activa  clic para cambiar":" Sin contrasea  clic para configurar",children:T?"":""})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[{v:"todos",l:"Todos"},{v:"pendiente",l:" Pendientes"},{v:"procesado",l:" Procesados"}].map((B,H)=>e.jsx("button",{onClick:()=>w(B.v),style:{padding:"5px 12px",fontSize:9,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${xe.border}`,borderLeft:H>0?"none":void 0,borderRadius:H===0?"4px 0 0 4px":H===2?"0 4px 4px 0":"0",background:E===B.v?"#111":"#fff",color:E===B.v?"#fff":xe.inkMid},children:B.l},B.v))}),e.jsxs("select",{value:s,onChange:B=>g(B.target.value),style:{...St,width:200},children:[e.jsx("option",{value:"",children:"Todos los formularios"}),t.map(B=>e.jsx("option",{value:B.id,children:B.nombre},B.id))]})]})]}),e.jsx(Lt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F0F0F0"},children:[e.jsx("th",{style:{...Ea,width:30},children:e.jsx("input",{type:"checkbox",checked:ae.length>0&&j.size===ae.length,onChange:()=>z(ae.map(B=>B.id)),style:{cursor:"pointer"}})}),["Fecha","Hora","Formulario","Cliente","Email","Score","Estado","Acciones"].map(B=>e.jsx("th",{style:Ea,children:B},B))]})}),e.jsx("tbody",{children:ae.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:xe.inkLight,fontSize:11},children:["Sin respuestas",E!=="todos"?" con este filtro":""]})}):ae.sort((B,H)=>(H.fecha||"").localeCompare(B.fecha||"")).map(B=>{var re;const H=Q(B),ee=B.created_at?new Date(B.created_at):null,D=ee?ee.toISOString().split("T")[0]:B.fecha||"",O=ee?ee.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}):"",le=(h==null?void 0:h.id)===B.id;return e.jsxs(vr.Fragment,{children:[e.jsxs("tr",{style:{cursor:"pointer",background:j.has(B.id)?"#FDF5F5":le?"#F0EEFF":H?"":"#FDFBFF",transition:"background .15s"},onClick:()=>b(le?null:B),children:[e.jsx("td",{style:{...Ht,width:30},onClick:de=>de.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:j.has(B.id),onChange:()=>_(B.id),style:{cursor:"pointer"}})}),e.jsx("td",{style:{...Ht,fontFamily:"'DM Mono',monospace",fontSize:9},children:D}),e.jsx("td",{style:{...Ht,fontSize:9},children:O}),e.jsx("td",{style:{...Ht,fontWeight:600,fontSize:10},children:B.formularioNombre||((re=t.find(de=>de.id===B.formularioId))==null?void 0:re.nombre)||""}),e.jsx("td",{style:{...Ht,fontWeight:600,fontSize:10},children:B.clienteNombre||""}),e.jsx("td",{style:{...Ht,fontSize:9,color:xe.blue},children:B.clienteEmail||""}),e.jsx("td",{style:{...Ht,textAlign:"center"},children:(()=>{const de=t.find(W=>W.id===B.formularioId)||t.find(W=>W.nombre===B.formularioNombre),G=Ss(B,de);if(!G)return e.jsx("span",{style:{fontSize:8,color:xe.inkLight},children:""});const ce=G.level==="green"?xe.green:G.level==="red"?xe.red:xe.amber,V=G.level==="green"?xe.greenBg:G.level==="red"?xe.redBg:xe.amberBg,Y=G.level==="green"?"":G.level==="red"?"":"";return e.jsxs("span",{style:{fontSize:9,fontWeight:700,padding:"2px 8px",borderRadius:10,background:V,color:ce},children:[Y," ",G.score.toFixed(1)]})})()}),e.jsx("td",{style:Ht,children:H?e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:xe.greenBg,color:xe.green},children:" Procesado"}):e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:"#F3EEFF",color:"#111111"},children:" Pendiente"})}),e.jsxs("td",{style:{...Ht,whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:de=>{de.stopPropagation(),b(le?null:B)},style:{background:"none",border:"none",cursor:"pointer",marginRight:4},title:"Ver detalle",children:le?e.jsx(Js,{size:11,color:xe.blue}):e.jsx(Fn,{size:11,color:xe.blue})}),e.jsx("button",{onClick:de=>{de.stopPropagation(),M(B)},style:{background:"none",border:"none",cursor:"pointer",marginRight:4},title:"Generar informe",children:e.jsx(Et,{size:11,color:xe.ink})}),!H&&e.jsx("button",{onClick:de=>{de.stopPropagation(),Se(B)},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:"#111111",color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},title:"Crear cliente + oferta en CRM",children:" Procesar"}),H&&e.jsx("button",{onClick:de=>{de.stopPropagation(),he(B.id,B._sbId)},style:{padding:"3px 8px",fontSize:8,fontWeight:600,background:"#fff",color:xe.inkMid,border:`1px solid ${xe.border}`,borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},title:"Marcar como pendiente",children:""}),a&&e.jsx("button",{onClick:de=>{de.stopPropagation(),Z({type:"single",target:B})},style:{background:"none",border:"none",cursor:"pointer",marginLeft:4,opacity:.5},title:"Eliminar respuesta",children:e.jsx(He,{size:11,color:xe.red})})]})]}),le&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:0,borderBottom:`2px solid ${xe.blue}33`},children:e.jsxs("div",{style:{padding:"14px 16px",background:"#F8F7FF"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[e.jsxs("h3",{style:{fontSize:12,fontWeight:700,margin:0},children:[" Detalle  ",B.clienteNombre||B.fecha]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[!H&&e.jsx(Co,{v:"pri",on:()=>Se(B),children:" Procesar  CRM"}),H&&e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"4px 12px",borderRadius:10,background:xe.greenBg,color:xe.green},children:" Procesado"}),e.jsxs(Co,{v:"sec",on:()=>M(B),children:[e.jsx(Et,{size:10})," Informe"]})]})]}),(()=>{const de=t.find(Y=>Y.id===B.formularioId)||t.find(Y=>Y.nombre===B.formularioNombre),G=Ss(B,de);if(!G)return null;const V={green:{bg:"#E8F4EE",border:"#111111",text:"#111111"},yellow:{bg:"#FAF0E0",border:"#8C6A00",text:"#8C6A00"},red:{bg:"#FAE8E8",border:"#B91C1C",text:"#B91C1C"}}[G.level];return e.jsxs("div",{style:{marginBottom:12,border:`1px solid ${V.border}33`,borderRadius:6,overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 14px",background:V.bg},children:[e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:V.text},children:[G.score.toFixed(1),e.jsx("span",{style:{fontSize:10},children:"/10"})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:V.text},children:G.levelLabel}),e.jsx("div",{style:{fontSize:8,color:V.text,opacity:.8},children:G.conclusion})]}),e.jsx("div",{style:{display:"flex",gap:6},children:[["",G.greens,xe.green],["",G.yellows,xe.amber],["",G.reds,xe.red]].map(([Y,W,se])=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:800,color:se},children:W}),e.jsx("div",{style:{fontSize:7},children:Y})]},Y))})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:4,padding:"8px 14px",background:"#fff"},children:G.details.map((Y,W)=>{const se=Y.flag==="green"?xe.green:Y.flag==="red"?xe.red:xe.amber,ge=Y.flag==="green"?"":Y.flag==="red"?"":"";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 8px",background:xe.bg,borderRadius:4,fontSize:9},children:[e.jsx("span",{children:ge}),e.jsx("span",{style:{fontWeight:600,flex:1},children:Y.label}),e.jsx("span",{style:{color:xe.inkMid},children:Y.value}),e.jsxs("span",{style:{fontWeight:700,color:se,fontFamily:"'DM Mono',monospace"},children:[Y.points,"/",Y.maxPoints]})]},W)})})]})})(),(()=>{const de=V=>B[V]!==void 0?Array.isArray(B[V])?B[V].join(", "):String(B[V]):null,G=(V,Y)=>Y?e.jsxs("div",{style:{padding:"4px 8px",background:"#fff",borderRadius:4,border:`1px solid ${xe.border}`},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:V}),e.jsx("div",{style:{fontSize:10,fontWeight:600,marginTop:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Y})]}):null,ce=(V,Y)=>e.jsxs("div",{style:{gridColumn:"1/-1",fontSize:9,fontWeight:700,color:xe.inkMid,marginTop:6,paddingBottom:2,borderBottom:`1px solid ${xe.border}`},children:[V," ",Y]});return e.jsxs("div",{children:[(B.clienteNombre||B.clienteEmail)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",background:xe.blueBg,borderRadius:6,border:`1px solid ${xe.blue}22`,marginBottom:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:xe.blue,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700},children:(B.clienteNombre||B.clienteEmail||"?")[0].toUpperCase()}),e.jsxs("div",{style:{flex:1},children:[B.clienteNombre&&e.jsx("div",{style:{fontSize:12,fontWeight:700,color:xe.blue},children:B.clienteNombre}),e.jsxs("div",{style:{display:"flex",gap:12,fontSize:9,color:xe.inkMid,marginTop:2},children:[B.clienteEmail&&e.jsxs("span",{children:[" ",B.clienteEmail]}),B.clienteTel&&e.jsxs("span",{children:[" ",B.clienteTel]}),de("tipoDocumento")&&e.jsxs("span",{children:[" ",de("tipoDocumento")," ",de("numDocumento")||""]})]})]}),de("propietario")&&e.jsx("div",{style:{padding:"3px 10px",borderRadius:12,fontSize:8,fontWeight:700,background:de("propietario")==="Soy el propietario"?xe.greenBg:xe.amberBg,color:de("propietario")==="Soy el propietario"?xe.green:xe.amber},children:de("propietario")})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6},children:[ce("","Ubicacin"),G("Pas",de("pais")),G("Departamento/Regin",de("departamento")),G("Ciudad",de("ciudad")),G("Direccin",de("direccion")),G("Inmueble",de("tipoVivienda")),G("rea m",de("area")),ce("","Proyecto y Diseo"),G("Servicios",de("servicios")),G("Tipo proyecto",de("tipoProyecto")),G("Estilo",de("estilo")),G("Espacios",de("espacios")),G("Expectativas",de("expectativas")),G("Prioridades",de("prioridades")),ce("","Presupuesto"),G("Presupuesto",de("presupuesto")),G("Honorarios diseo",de("honorariosDiseo")),G("Financiacin",de("financiacion")),G("Anticipo 30-50%",de("anticipo")),G("Forma de pago",de("formaPago")),G("Flexibilidad",de("flexibilidad")),ce("","Plazos"),G("Plazo",de("plazo")),G("Fecha inicio",de("fechaInicio"))]})]})})()]})})})]},B.id)})})]})}),v&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>m(!1),children:e.jsxs("div",{onClick:B=>B.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:340,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:32,textAlign:"center",marginBottom:8},children:""}),e.jsx("h3",{style:{margin:"0 0 4px",fontSize:14,fontWeight:700,textAlign:"center"},children:"Confirmar eliminacin"}),e.jsx("p",{style:{margin:"0 0 16px",fontSize:10,color:xe.inkMid,textAlign:"center"},children:(d==null?void 0:d.type)==="all"?"Eliminar TODAS las respuestas":(d==null?void 0:d.type)==="selected"?`Eliminar ${j.size} respuesta${j.size>1?"s":""}`:"Eliminar respuesta"}),e.jsx("input",{type:"password",value:f,onChange:B=>p(B.target.value),onKeyDown:B=>{B.key==="Enter"&&P()},placeholder:"Ingresa la contrasea",autoFocus:!0,style:{...St,width:"100%",fontSize:12,marginBottom:12,textAlign:"center"}}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>m(!1),style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:600,border:`1px solid ${xe.border}`,borderRadius:4,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"}),e.jsx("button",{onClick:P,style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:700,border:"none",borderRadius:4,background:xe.red,color:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]})})]})}function Wm({forms:t,setForms:i,onEdit:o}){const n=a=>{var r,s;try{const g=t.find(k=>k.sourceTemplate===a.id||k.nombre===a.nombre);if(g){g.sourceTemplate||i(t.map(k=>k.id===g.id?{...k,sourceTemplate:a.id}:k)),o(g.id);return}const h={};a.campos.forEach(k=>{h[k.id]=ht()});const b=a.campos.map(k=>{const v={...k,id:h[k.id]};return v.logica&&v.logica.fieldId&&h[v.logica.fieldId]&&(v.logica={...v.logica,fieldId:h[v.logica.fieldId]}),v.paisRef&&h[v.paisRef]&&(v.paisRef=h[v.paisRef]),v.dynamicOpciones&&v.dynamicOpciones.dependsOn&&h[v.dynamicOpciones.dependsOn]&&(v.dynamicOpciones={...v.dynamicOpciones,dependsOn:h[v.dynamicOpciones.dependsOn]}),v}),j={id:ht(),nombre:a.nombre,modulo:a.modulo||"general",campos:b,config:{...a.config||{},titulo:((r=a.config)==null?void 0:r.titulo)||a.nombre,vista:((s=a.config)==null?void 0:s.vista)||"pasos"},createdAt:Ki(),updatedAt:Ki(),activo:!0,sourceTemplate:a.id};i([...t,j]),o(j.id)}catch(g){console.error("Error al usar plantilla:",g),alert("Error al crear formulario desde plantilla")}};return e.jsxs("div",{className:"fade-up",children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700,marginBottom:14},children:"Plantillas prediseadas"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280,1fr))",gap:12},children:Ec.map(a=>{const r=Pa.find(g=>g.id===a.modulo),s=t.find(g=>g.sourceTemplate===a.id||g.nombre===a.nombre);return e.jsxs(Lt,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"14px 16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:a.nombre}),e.jsx(nr,{color:xe.purple,children:(r==null?void 0:r.lbl)||"General"})]}),e.jsx("div",{style:{fontSize:10,color:xe.inkMid,marginTop:4},children:a.desc}),e.jsxs("div",{style:{fontSize:8,color:xe.inkLight,marginTop:4},children:[a.campos.filter(g=>g.tipo!=="seccion").length," campos  ",a.campos.filter(g=>g.required).length," obligatorios"]})]}),e.jsx("div",{style:{borderTop:`1px solid ${xe.border}`,padding:0},children:e.jsx("button",{onClick:()=>n(a),style:{width:"100%",padding:"8px 0",border:"none",background:"transparent",cursor:"pointer",fontSize:10,fontWeight:700,color:s?xe.blue:xe.green,fontFamily:"'DM Sans',sans-serif"},children:s?" Editar formulario existente":" Usar esta plantilla"})})]},a.id)})})]})}function Nm({forms:t}){const[i,o]=F.useState(!0),[n,a]=F.useState(null),[r,s]=F.useState("all"),[g,h]=F.useState(null);if(F.useEffect(()=>{if(Ni()){o(!1);return}Promise.resolve({}).then(S=>{a(S),o(!1)}).catch(()=>o(!1))},[]),F.useEffect(()=>{h(null)},[r]),i)return e.jsx(Lt,{style:{padding:28,textAlign:"center"},children:e.jsx("div",{style:{fontSize:11,color:xe.inkMid},children:"Cargando estadsticas..."})});const b=(n==null?void 0:n.events)||[],j=(n==null?void 0:n.responses)||[],k=b.filter(S=>S.event_type==="open"),v=b.filter(S=>S.event_type==="submit"),m=b.filter(S=>S.event_type==="close"&&S.duration_seconds>0),f=m.length>0?Math.round(m.reduce((S,A)=>S+A.duration_seconds,0)/m.length):0,p=k.length>0?Math.round(v.length/k.length*100):0,d=S=>S<60?`${S}s`:S<3600?`${Math.floor(S/60)}m ${S%60}s`:`${Math.floor(S/3600)}h ${Math.floor(S%3600/60)}m`,c={};b.forEach(S=>{const A=(S.form_id||"")+"_"+(S.client_email||S.client_name||"anon");c[A]||(c[A]={form_id:S.form_id,form_name:S.form_name||S.form_id,client_name:S.client_name||"",client_email:S.client_email||"",opens:0,submits:0,lastDate:null,duration:0,durationCount:0}),S.event_type==="open"&&c[A].opens++,S.event_type==="submit"&&c[A].submits++,S.event_type==="close"&&S.duration_seconds>0&&(c[A].duration+=S.duration_seconds,c[A].durationCount++);const E=S.created_at?new Date(S.created_at):null;E&&(!c[A].lastDate||E>c[A].lastDate)&&(c[A].lastDate=E)});let l=Object.values(c);r!=="all"&&(l=l.filter(S=>S.form_id===r)),l.sort((S,A)=>(A.lastDate||0)-(S.lastDate||0));const x=[...new Set(b.map(S=>S.form_id).concat(j.map(S=>S.form_id)))],y={padding:"8px 10px",textAlign:"left",fontWeight:700,fontSize:8,textTransform:"uppercase",color:xe.inkMid,borderBottom:`1px solid ${xe.border}`},u={padding:"8px 10px",fontSize:11,borderBottom:`1px solid ${xe.border}`,verticalAlign:"middle"};return e.jsxs("div",{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginBottom:16},children:[[" Aperturas",k.length,"#3B3B3B"],[" Envos",v.length,"#111111"],[" Conversin",`${p}%`,"#111111"],[" Tiempo promedio",d(f),"#8C6A00"]].map(([S,A,E])=>e.jsxs(Lt,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:S}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E},children:A})]},S))}),e.jsx(Lt,{style:{padding:"14px 16px",marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:xe.inkMid,textTransform:"uppercase"},children:"Filtrar por formulario:"}),e.jsxs("select",{value:r,onChange:S=>s(S.target.value),style:{...St,width:260,fontSize:11},children:[e.jsx("option",{value:"all",children:" Todos los formularios"}),t.map(S=>e.jsx("option",{value:S.id,children:S.nombre},S.id)),x.filter(S=>!t.find(A=>A.id===S)).map(S=>e.jsxs("option",{value:S,children:["ID: ",S]},S))]})]})}),g&&e.jsxs(Lt,{style:{padding:"16px",marginBottom:16},children:[e.jsx("h3",{style:{margin:"0 0 12px",fontSize:14,fontWeight:700},children:" Detalle del formulario"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:14},children:[["Aperturas",g.totalOpens,"#3B3B3B"],["Envos",g.totalSubmits,"#111111"],["Conversin",g.conversionRate+"%","#111111"],["Tiempo prom.",d(g.avgDurationSec),"#8C6A00"]].map(([S,A,E])=>e.jsxs("div",{style:{padding:"10px 12px",background:xe.bg,borderRadius:6,border:`1px solid ${xe.border}`},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:S}),e.jsx("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E},children:A})]},S))})]}),e.jsxs(Lt,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"14px 16px",borderBottom:`1px solid ${xe.border}`},children:e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700},children:" Formularios recibidos"})}),l.length===0?e.jsx("div",{style:{fontSize:11,color:xe.inkMid,textAlign:"center",padding:28},children:"No hay actividad registrada an."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:xe.bg},children:["Estado","Fecha","Hora","Formulario","Cliente","Aperturas","Envos","Tiempo","Conversin"].map(S=>e.jsx("th",{style:y,children:S},S))})}),e.jsx("tbody",{children:l.map((S,A)=>{const E=S.submits>0,w=S.opens>0?Math.round(S.submits/S.opens*100):0,_=S.durationCount>0?Math.round(S.duration/S.durationCount):0,z=S.lastDate?S.lastDate.toISOString().split("T")[0]:"",T=S.lastDate?S.lastDate.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}):"";return e.jsxs("tr",{style:{background:A%2===0?"#fff":"#FFFFFF"},children:[e.jsx("td",{style:u,children:e.jsx("span",{style:{fontSize:9,padding:"3px 10px",borderRadius:10,fontWeight:700,color:E?xe.green:xe.amber,background:E?xe.greenBg:xe.amberBg},children:E?" Recibido":" Pendiente"})}),e.jsx("td",{style:{...u,fontFamily:"'DM Mono',monospace",fontSize:9},children:z}),e.jsx("td",{style:{...u,fontSize:9},children:T}),e.jsx("td",{style:{...u,fontWeight:600},children:S.form_name}),e.jsxs("td",{style:u,children:[e.jsx("div",{style:{fontWeight:600,fontSize:11},children:S.client_name||""}),S.client_email&&e.jsx("div",{style:{fontSize:9,color:xe.blue},children:S.client_email})]}),e.jsx("td",{style:{...u,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#3B3B3B"},children:S.opens}),e.jsx("td",{style:{...u,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111"},children:S.submits}),e.jsx("td",{style:{...u,textAlign:"center",fontSize:10,color:xe.inkMid},children:_>0?d(_):""}),e.jsx("td",{style:{...u,textAlign:"center"},children:e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,color:w>=50?xe.green:w>0?xe.amber:xe.inkLight},children:[w,"%"]})})]},A)})})]})})]})]})}function Um({envios:t,onBlock:i,onDelete:o,respuestas:n}){const[a,r]=F.useState("pendiente"),s=w=>w.blocked?"bloqueado":n.some(_=>{var z;return _.clienteEmail===((z=w.cliente)==null?void 0:z.email)&&_.formularioId===w.formId})?"respondido":"pendiente",g={todos:t.length,pendiente:0,respondido:0,bloqueado:0};t.forEach(w=>{g[s(w)]++});const h=a==="todos"?t:t.filter(w=>s(w)===a),[b,j]=F.useState(new Set),[k,v]=F.useState(!1),[m,f]=F.useState(""),[p,d]=F.useState(null),c=w=>j(_=>{const z=new Set(_);return z.has(w)?z.delete(w):z.add(w),z}),l=()=>j(w=>w.size===t.length?new Set:new Set(t.map(_=>_.id))),x=Ee.getSync("hab:form:deletePass")||"",u=x||!1,S=async w=>{if(!u){A(w);return}x&&(d(w),f(""),v(!0))},A=async w=>{if(w.type==="single")await o(w.target.linkId||w.target.id);else if(w.type==="selected"){for(const _ of b){const z=t.find(T=>T.id===_);z&&await o(z.linkId||z.id)}j(new Set)}else if(w.type==="all"){for(const _ of t)await o(_.linkId||_.id);j(new Set)}v(!1),d(null)},E=()=>{m===x?A(p):alert("Contrasea incorrecta")};return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Formularios enviados  ",h.length]}),b.size>0&&e.jsxs("button",{onClick:()=>S({type:"selected"}),style:{padding:"5px 14px",fontSize:9,fontWeight:700,background:xe.red,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" Eliminar seleccionados (",b.size,")"]}),b.size===0&&t.length>0&&e.jsx("button",{onClick:()=>S({type:"all"}),style:{padding:"5px 14px",fontSize:9,fontWeight:600,background:"#fff",color:xe.red,border:`1px solid ${xe.red}44`,borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Limpiar todo"})]})}),e.jsx("div",{style:{display:"flex",gap:6,marginBottom:10},children:[["pendiente"," Pendientes"],["respondido"," Respondidos"],["bloqueado"," Bloqueados"],["todos","Todos"]].map(([w,_])=>e.jsxs("button",{onClick:()=>{r(w),j(new Set)},style:{padding:"5px 12px",fontSize:10,fontWeight:a===w?700:500,background:a===w?"#111":"#fff",color:a===w?"#fff":"#555",border:a===w?"1px solid #111":"1px solid #E0E0E0",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[_," (",g[w],")"]},w))}),e.jsx(Lt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F0F0F0"},children:[e.jsx("th",{style:{...Ea,width:30},children:e.jsx("input",{type:"checkbox",checked:t.length>0&&b.size===t.length,onChange:l,style:{cursor:"pointer"}})}),["Fecha","Hora","Formulario","Cliente","Email","Telfono","Estado","Acciones"].map(w=>e.jsx("th",{style:Ea,children:w},w))]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:xe.inkLight,fontSize:11},children:a==="todos"?"No has enviado formularios an":"Sin resultados para este filtro"})}):[...h].reverse().map(w=>{var T,L,Z;const _=n.some(K=>{var P;return K.clienteEmail===((P=w.cliente)==null?void 0:P.email)&&K.formularioId===w.formId}),z=w.blocked;return e.jsxs("tr",{style:{background:b.has(w.id)||z?"#FDF5F5":""},children:[e.jsx("td",{style:{...Ht,width:30},children:e.jsx("input",{type:"checkbox",checked:b.has(w.id),onChange:()=>c(w.id),style:{cursor:"pointer"}})}),e.jsx("td",{style:{...Ht,fontFamily:"'DM Mono',monospace",fontSize:9},children:w.fecha}),e.jsx("td",{style:{...Ht,fontSize:9},children:w.hora}),e.jsx("td",{style:{...Ht,fontWeight:600},children:w.formNombre}),e.jsx("td",{style:{...Ht,fontWeight:600},children:((T=w.cliente)==null?void 0:T.nombre)||""}),e.jsx("td",{style:{...Ht,fontSize:9,color:xe.blue},children:((L=w.cliente)==null?void 0:L.email)||""}),e.jsx("td",{style:{...Ht,fontSize:9},children:((Z=w.cliente)==null?void 0:Z.tel)||""}),e.jsx("td",{style:Ht,children:z?e.jsx(nr,{color:xe.red,children:" Bloqueado"}):_?e.jsx(nr,{color:xe.green,children:" Respondido"}):e.jsx(nr,{color:xe.amber,children:" Pendiente"})}),e.jsxs("td",{style:{...Ht,whiteSpace:"nowrap"},children:[z?e.jsx("button",{onClick:()=>{i(w.linkId||w.id,!1)},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:xe.green,color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Desbloquear"}):e.jsx("button",{onClick:()=>{confirm("Bloquear este enlace?")&&i(w.linkId||w.id,!0)},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:xe.red,color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Bloquear"}),e.jsx("button",{onClick:()=>S({type:"single",target:w}),style:{background:"none",border:"none",cursor:"pointer",marginLeft:4,opacity:.5},children:e.jsx(He,{size:11,color:xe.red})})]})]},w.id)})})]})}),k&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>v(!1),children:e.jsxs("div",{onClick:w=>w.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:340,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:32,textAlign:"center",marginBottom:8},children:""}),e.jsx("h3",{style:{margin:"0 0 4px",fontSize:14,fontWeight:700,textAlign:"center"},children:"Confirmar eliminacin"}),e.jsx("p",{style:{margin:"0 0 16px",fontSize:10,color:xe.inkMid,textAlign:"center"},children:(p==null?void 0:p.type)==="all"?"Eliminar TODOS los envos":(p==null?void 0:p.type)==="selected"?`Eliminar ${b.size} envo${b.size>1?"s":""}`:"Eliminar envo"}),e.jsx("input",{type:"password",value:m,onChange:w=>f(w.target.value),onKeyDown:w=>{w.key==="Enter"&&E()},placeholder:"Ingresa la contrasea",autoFocus:!0,style:{...St,width:"100%",fontSize:12,marginBottom:12,textAlign:"center"}}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>v(!1),style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:600,border:`1px solid ${xe.border}`,borderRadius:4,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"}),e.jsx("button",{onClick:E,style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:700,border:"none",borderRadius:4,background:xe.red,color:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]})})]})}function Vm(){const[t,i]=F.useState(()=>{try{const T=JSON.parse(Ee.getSync(ia))||{};return T.forms||(T.forms=[]),T}catch{return{forms:[]}}});F.useEffect(()=>{(()=>{var T;try{const L=Ee.getSync(ia);if(L!=null&&L.value){const Z=JSON.parse(L);(T=Z==null?void 0:Z.forms)!=null&&T.length&&i(K=>{const P=new Set((K.forms||[]).map(Q=>Q.id)),te=(Z.forms||[]).filter(Q=>!P.has(Q.id)),he={...Z,forms:[...K.forms||[],...te]};return Ee.set(ia,JSON.stringify(he)),he})}}catch(L){console.warn("Cloud load forms:",L)}})()},[]);const o=(T,L)=>i(Z=>{const K={...Z,[T]:typeof L=="function"?L(Z[T]):L};return Ee.set(ia,JSON.stringify(K)),K}),n=t.forms||[],a=T=>o("forms",typeof T=="function"?T(n):T);F.useEffect(()=>{(()=>{try{const T=Ee.getSync("hab:form:procesados");if(T!=null&&T.value){const L=JSON.parse(T),Z=JSON.parse(Ee.getSync("hab:form:procesados")||"[]"),K=[...new Set([...Z,...L])];Ee.set("hab:form:procesados",JSON.stringify(K))}}catch{}})()},[]),F.useEffect(()=>{const T=t.forms||[];let L=[...T],Z=!1;Ec.forEach(K=>{var te,he;const P=T.find(Q=>Q.sourceTemplate===K.id||Q.nombre===K.nombre);if(P){if(K.version&&(!P.templateVersion||P.templateVersion<K.version)){const Q={};K.campos.forEach(ae=>{Q[ae.id]=ht()});const Se=K.campos.map(ae=>{const U={...ae,id:Q[ae.id]};return U.logica&&U.logica.fieldId&&Q[U.logica.fieldId]&&(U.logica={...U.logica,fieldId:Q[U.logica.fieldId]}),U.paisRef&&Q[U.paisRef]&&(U.paisRef=Q[U.paisRef]),U.dynamicOpciones&&U.dynamicOpciones.dependsOn&&Q[U.dynamicOpciones.dependsOn]&&(U.dynamicOpciones={...U.dynamicOpciones,dependsOn:Q[U.dynamicOpciones.dependsOn]}),U});L=L.map(ae=>{var U,M;return ae.id===P.id?{...ae,campos:Se,config:{...K.config||{},titulo:((U=K.config)==null?void 0:U.titulo)||K.nombre,vista:((M=K.config)==null?void 0:M.vista)||"pasos"},updatedAt:Ki(),templateVersion:K.version,sourceTemplate:K.id}:ae}),Z=!0}}else{const Q={};K.campos.forEach(ae=>{Q[ae.id]=ht()});const Se=K.campos.map(ae=>{const U={...ae,id:Q[ae.id]};return U.logica&&U.logica.fieldId&&Q[U.logica.fieldId]&&(U.logica={...U.logica,fieldId:Q[U.logica.fieldId]}),U.paisRef&&Q[U.paisRef]&&(U.paisRef=Q[U.paisRef]),U.dynamicOpciones&&U.dynamicOpciones.dependsOn&&Q[U.dynamicOpciones.dependsOn]&&(U.dynamicOpciones={...U.dynamicOpciones,dependsOn:Q[U.dynamicOpciones.dependsOn]}),U});L.push({id:ht(),nombre:K.nombre,modulo:K.modulo||"general",campos:Se,config:{...K.config||{},titulo:((te=K.config)==null?void 0:te.titulo)||K.nombre,vista:((he=K.config)==null?void 0:he.vista)||"pasos"},createdAt:Ki(),updatedAt:Ki(),activo:!0,sourceTemplate:K.id,templateVersion:K.version||1}),Z=!0}}),Z&&o("forms",L)},[]);const[r,s]=F.useState([]),[g,h]=F.useState(!0),b=async()=>{h(!0);try{if(Ni()){const T=await ph();if(T){s(T.map(L=>({id:L.link_id||L.id,formId:L.form_id,formNombre:L.form_name||"",cliente:{nombre:L.client_name||"",email:L.client_email||"",tel:L.client_tel||""},fecha:L.created_at?new Date(L.created_at).toLocaleDateString("es-CO"):"",hora:L.created_at?new Date(L.created_at).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}):"",linkId:L.link_id,maxUsos:L.max_uses||0,expiry:L.expires_at||"",blocked:!L.active}))),h(!1);return}}}catch(T){console.warn("loadEnvios error:",T)}s(t.envios||[]),h(!1)};F.useEffect(()=>{b()},[]);const j=async T=>{var L,Z,K;if(Ni())try{await sh({form_id:T.formId,form_name:T.formNombre,link_id:T.linkId,client_name:((L=T.cliente)==null?void 0:L.nombre)||null,client_email:((Z=T.cliente)==null?void 0:Z.email)||null,client_tel:((K=T.cliente)==null?void 0:K.tel)||null,max_uses:T.maxUsos||0,expires_at:T.expiry?new Date(T.expiry).toISOString():null}),await b()}catch(P){console.warn("addEnvio SB error:",P)}else o("envios",[...t.envios||[],T])},k=async(T,L)=>{if(Ni())try{L?await dh(T):await ch(T),await b()}catch(Z){console.warn("blockEnvio error:",Z)}},v=async T=>{var L,Z;try{const K=vi(),P=(L=K==null?void 0:K.supabase)==null?void 0:L.url,te=(Z=K==null?void 0:K.supabase)==null?void 0:Z.anonKey;P&&te&&await fetch(P+"/rest/v1/form_links?link_id=eq."+encodeURIComponent(T),{method:"DELETE",headers:{apikey:te,Authorization:"Bearer "+te,Prefer:"return=minimal"}}),await b()}catch(K){console.warn("deleteEnvio error:",K)}},[m,f]=F.useState([]),[p,d]=F.useState(!1),c=async()=>{d(!0);const T=[],L=new Set;if(Ni())try{const K=await ah();K&&K.length>0&&K.forEach(P=>{const te=P.data||{},he={...te,_sbId:P.id,id:te.id||P.id,formularioId:P.form_id||te.formularioId,formularioNombre:P.form_name||te.formularioNombre,clienteNombre:P.client_name||te.clienteNombre,clienteEmail:P.client_email||te.clienteEmail,clienteTel:P.client_tel||te.clienteTel,fecha:te.fecha||(P.created_at?P.created_at.split("T")[0]:""),created_at:P.created_at||null,processed:P.processed||!1};L.has(he.id)||(L.add(he.id),T.push(he))})}catch(K){console.warn("Error loading Supabase responses:",K)}Ee.listSync("hab:form:resp:").items.forEach(K=>{try{const P=JSON.parse(K.value);P&&all.push(P)}catch{}}),f(T),d(!1)};F.useEffect(()=>{c()},[]);const l=async T=>{T._sbId;const L=Ee.listSync("hab:briefing:").items;for(const Z of L)try{const K=JSON.parse(Z.value);if((K==null?void 0:K.id)===T.id){Ee.delete(Z.key);break}}catch{}f(Z=>Z.filter(K=>K.id!==T.id))},x=async()=>{Ni();const T=Ee.listSync("hab:briefing:").items;for(const L of T)Ee.delete(L.key);f([])},[y,u]=F.useState(()=>"dashboard"),S=T=>{u(T);try{Ee.set("hab:form:tab",T)}catch{}},[A,E]=F.useState(null),w=T=>{E(T||null),S("constructor")},_=()=>{E(null),S("constructor")},z=T=>{E(T.id),S("mis_forms")};return e.jsxs(e.Fragment,{children:[e.jsx(_m,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Formularios"}),e.jsx("div",{style:{fontSize:10,color:xe.inkMid},children:"Constructor  Plantillas  Respuestas  Compartir"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:bd.map((T,L)=>e.jsx("button",{onClick:()=>{S(T.id),T.id!=="constructor"&&E(null)},style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${xe.border}`,borderLeft:L>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:L===0?"6px 0 0 6px":L===bd.length-1?"0 6px 6px 0":"0",background:y===T.id?"#111":"#fff",color:y===T.id?"#fff":xe.inkMid},children:T.lbl},T.id))}),y==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:(()=>{const T=[],L=m.filter(Z=>!T.includes(Z.id)).length;return[[" Formularios",n.length,"#111"],[" Enviados",r.length,"#3B3B3B"],[" Respuestas",m.length,"#111111"],[" Sin asignar",L,(L>0,"#111111")]]})().map(([T,L,Z])=>e.jsxs(Lt,{style:{padding:"14px 16px",cursor:T.includes("Sin asignar")&&L>0?"pointer":void 0},onClick:T.includes("Sin asignar")&&L>0?()=>S("respuestas"):void 0,children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:T}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Z},children:L})]},T))}),(()=>{const T=[],L=m.filter(Z=>!T.includes(Z.id)).length;return L===0?null:e.jsx(Lt,{style:{padding:"12px 16px",marginBottom:16,background:"#F3EEFF",border:"1px solid #11111133",cursor:"pointer"},onClick:()=>S("respuestas"),children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"#111111",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700},children:L}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#111111"},children:[" Tienes ",L," formulario",L>1?"s":""," sin asignar"]}),e.jsx("div",{style:{fontSize:9,color:"#555555",marginTop:1},children:"Haz clic para ir a Respuestas y procesarlos  crear cliente + borrador oferta"})]})]})})})(),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12},children:[e.jsxs(Lt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:_,children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Crear formulario"}),e.jsx("div",{style:{fontSize:9,color:xe.inkMid,marginTop:2},children:"Desde cero con el constructor"})]}),e.jsxs(Lt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:()=>S("plantillas"),children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Usar plantilla"}),e.jsx("div",{style:{fontSize:9,color:xe.inkMid,marginTop:2},children:"Briefing, SST, encuestas..."})]}),e.jsxs(Lt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:()=>S("respuestas"),children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Ver respuestas"}),e.jsxs("div",{style:{fontSize:9,color:xe.inkMid,marginTop:2},children:[m.length," respuestas recibidas"]})]})]})]}),y==="mis_forms"&&e.jsx(Om,{forms:n,setForms:a,onEdit:w,onNew:_}),y==="constructor"&&e.jsx(Pm,{forms:n,setForms:a,editId:A,setEditId:E,onSaved:z,envios:r,addEnvio:j}),y==="enviados"&&e.jsx(Um,{envios:r,onBlock:k,onDelete:v,respuestas:m}),y==="respuestas"&&e.jsx(Lm,{forms:n,respuestas:m,onReload:c,loading:p,onDelete:l,onClearAll:x}),y==="estadisticas"&&e.jsx(Nm,{forms:n}),y==="plantillas"&&e.jsx(Wm,{forms:n,setForms:a,onEdit:w})]})]})}const Ke={ink:"#111",inkMid:"#444",inkLight:"#888",inkXLight:"#C8C5BE",bg:"#F5F4F1",surface:"#FFFFFF",border:"#E0E0E0",green:"#111111",greenBg:"#E8F4EE",greenLight:"#D4EDDF",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FFF8EE",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 4px rgba(0,0,0,.06), 0 8px 32px rgba(0,0,0,.08)"},Oi={fontFamily:"'DM Sans',sans-serif"},yd=(t,i="COP")=>!t&&t!==0?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:i,minimumFractionDigits:0,maximumFractionDigits:0}).format(t),vd=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric"}):"";function bo({title:t,icon:i,children:o}){return e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("h3",{style:{...Oi,fontSize:13,fontWeight:700,color:Ke.ink,margin:"0 0 12px",display:"flex",alignItems:"center",gap:8,textTransform:"uppercase",letterSpacing:.5},children:[e.jsx("span",{children:i})," ",t]}),e.jsx("div",{style:{background:Ke.surface,borderRadius:12,padding:20,border:"1px solid "+Ke.border},children:o})]})}function Cs({label:t,value:i,highlight:o}){return e.jsxs("div",{style:{flex:1,minWidth:140,background:o?Ke.greenBg:"#FFFFFF",borderRadius:10,padding:"14px 16px",border:"1px solid "+(o?Ke.greenLight:Ke.border)},children:[e.jsx("p",{style:{...Oi,margin:"0 0 4px",fontSize:9,fontWeight:600,textTransform:"uppercase",letterSpacing:1,color:Ke.inkLight},children:t}),e.jsx("p",{style:{...Oi,margin:0,fontSize:18,fontWeight:700,color:o?Ke.green:Ke.ink},children:i})]})}function qm({token:t}){const[i,o]=F.useState(null),[n,a]=F.useState(!0),[r,s]=F.useState(null),[g,h]=F.useState(null),[b,j]=F.useState(""),[k,v]=F.useState(!1),[m,f]=F.useState(!1);if(F.useEffect(()=>{if(!t){s("no_token"),a(!1);return}Qu(t).then(x=>{x?o(x):s("not_found"),a(!1)}).catch(()=>{s("error"),a(!1)})},[t]),n)return e.jsx("div",{style:{...Oi,minHeight:"100vh",background:Ke.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16,animation:"pulse 1.5s ease infinite"},children:""}),e.jsx("p",{style:{fontSize:14,color:Ke.inkMid},children:"Cargando oferta..."}),e.jsx("style",{children:"@keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}"})]})});if(r||!i)return e.jsx("div",{style:{...Oi,minHeight:"100vh",background:Ke.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:Ke.surface,borderRadius:16,padding:48,textAlign:"center",boxShadow:Ke.shadow,maxWidth:420},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("h2",{style:{margin:"0 0 8px",fontSize:18,color:Ke.ink},children:"Enlace no vlido"}),e.jsx("p",{style:{margin:0,fontSize:13,color:Ke.inkMid,lineHeight:1.6},children:"Este enlace de oferta no existe o ha expirado."})]})});if(i.status!=="pendiente"||m){const x={aprobada:{icon:"",label:"Oferta Aprobada",color:Ke.green,bg:Ke.greenBg},rechazada:{icon:"",label:"Oferta Rechazada",color:Ke.red,bg:Ke.redBg},devuelta:{icon:"",label:"Oferta Devuelta",color:Ke.amber,bg:Ke.amberBg}},y=x[i.status]||x.aprobada,u=i.offer_data||{};return e.jsx("div",{style:{...Oi,minHeight:"100vh",background:Ke.bg,display:"flex",alignItems:"center",justifyContent:"center",padding:20},children:e.jsxs("div",{style:{background:Ke.surface,borderRadius:16,padding:48,textAlign:"center",boxShadow:Ke.shadow,maxWidth:480},children:[e.jsx("div",{style:{fontSize:56,marginBottom:16},children:y.icon}),e.jsx("h2",{style:{margin:"0 0 8px",fontSize:22,color:y.color,fontWeight:700},children:y.label}),e.jsxs("p",{style:{margin:"0 0 6px",fontSize:14,color:Ke.inkMid},children:[u.ref||"Oferta","  ",u.cliente||""]}),e.jsxs("p",{style:{margin:"0 0 20px",fontSize:12,color:Ke.inkLight},children:["Respondida el ",vd(i.client_responded_at)]}),i.client_comments&&e.jsxs("div",{style:{background:y.bg,borderRadius:8,padding:16,textAlign:"left"},children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:y.color},children:"Sus comentarios"}),e.jsx("p",{style:{margin:0,fontSize:13,color:Ke.ink,lineHeight:1.6,whiteSpace:"pre-wrap"},children:i.client_comments})]}),e.jsx("p",{style:{margin:"24px 0 0",fontSize:11,color:Ke.inkLight},children:"Si necesita hacer cambios, contacte con su representante."})]})})}const p=i.offer_data||{},d=p.divisa||"COP",c=x=>x?e.jsx("div",{style:{fontSize:13,color:Ke.ink,lineHeight:1.7,whiteSpace:"pre-wrap"},children:x}):e.jsx("p",{style:{margin:0,fontSize:13,color:Ke.inkLight,fontStyle:"italic"},children:"No especificado"}),l=async()=>{if(g){if(g==="devolver"&&!b.trim()){alert("Por favor, indique los cambios que necesita.");return}v(!0);try{const y=await Zu(t,{aprobar:"aprobada",rechazar:"rechazada",devolver:"devuelta"}[g],b);o(y),f(!0)}catch(x){alert("Error al enviar. Intente de nuevo."),console.error(x)}v(!1)}};return e.jsxs("div",{style:{...Oi,minHeight:"100vh",background:Ke.bg},children:[e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif}"}),e.jsx("div",{style:{background:"#111",color:"#fff",padding:"28px 0"},children:e.jsx("div",{style:{maxWidth:760,margin:"0 auto",padding:"0 24px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:10,letterSpacing:2,textTransform:"uppercase",color:"rgba(255,255,255,.5)",marginBottom:4},children:["Propuesta Comercial  ",i.revision||"Rev.01"]}),e.jsx("h1",{style:{fontSize:24,fontWeight:700,margin:0},children:p.ref||"Oferta"})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("p",{style:{fontSize:12,color:"rgba(255,255,255,.7)",margin:0},children:p.firmante||"Habitaris"}),e.jsx("p",{style:{fontSize:11,color:"rgba(255,255,255,.4)",margin:0},children:vd(p.fecha)})]})]})})}),e.jsxs("div",{style:{maxWidth:760,margin:"0 auto",padding:"32px 24px 120px"},children:[e.jsxs("div",{style:{background:Ke.blueBg,border:"1px solid "+Ke.blue+"33",borderRadius:12,padding:"16px 20px",marginBottom:28,display:"flex",alignItems:"center",gap:12},children:[e.jsx("span",{style:{fontSize:24},children:""}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,fontWeight:600,color:Ke.blue,margin:"0 0 2px"},children:"Pendiente de su respuesta"}),e.jsx("p",{style:{fontSize:11,color:Ke.inkMid,margin:0},children:"Revise los detalles y apruebe, rechace o solicite cambios al final."})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:28,flexWrap:"wrap"},children:[e.jsx(Cs,{label:"Proyecto",value:p.proyecto||p.titulo||""}),e.jsx(Cs,{label:"PVP sin IVA ("+d+")",value:yd(p.pvp,d)}),e.jsx(Cs,{label:"PVP con IVA ("+d+")",value:yd(p.pvpIva,d),highlight:!0})]}),e.jsx(bo,{title:"Datos del proyecto",icon:"",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,fontSize:13},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:Ke.inkLight,fontSize:11},children:"Cliente"}),e.jsx("br",{}),e.jsx("strong",{children:p.cliente||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Ke.inkLight,fontSize:11},children:"Proyecto"}),e.jsx("br",{}),e.jsx("strong",{children:p.proyecto||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Ke.inkLight,fontSize:11},children:"Ubicacin"}),e.jsx("br",{}),e.jsx("strong",{children:p.ubicacion||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Ke.inkLight,fontSize:11},children:"Revisin"}),e.jsx("br",{}),e.jsx("strong",{children:i.revision})]})]})}),p.alcance&&e.jsx(bo,{title:"Alcance del servicio",icon:"",children:c(p.alcance)}),p.fases&&e.jsx(bo,{title:"Fases del proyecto",icon:"",children:c(p.fases)}),p.exclusiones&&e.jsx(bo,{title:"Exclusiones",icon:"",children:c(p.exclusiones)}),p.condPago&&e.jsx(bo,{title:"Condiciones de pago",icon:"",children:c(p.condPago)}),p.plazo&&e.jsx(bo,{title:"Plazo de ejecucin",icon:"",children:c(p.plazo)}),p.garantias&&e.jsx(bo,{title:"Garantas",icon:"",children:c(p.garantias)}),p.terminos&&e.jsx(bo,{title:"Trminos y condiciones",icon:"",children:c(p.terminos)}),p.notaLegal&&e.jsxs("div",{style:{background:"#FFFFFF",borderRadius:10,padding:16,marginBottom:28,border:"1px solid "+Ke.border},children:[e.jsx("p",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:1,color:Ke.inkLight,margin:"0 0 6px"},children:"Nota legal"}),e.jsx("p",{style:{fontSize:11,color:Ke.inkMid,lineHeight:1.6,margin:0},children:p.notaLegal})]}),e.jsxs("div",{style:{background:Ke.surface,borderRadius:16,padding:28,boxShadow:Ke.shadow,border:"2px solid "+Ke.border},children:[e.jsx("h3",{style:{fontSize:16,fontWeight:700,color:Ke.ink,margin:"0 0 6px"},children:"Su decisin"}),e.jsx("p",{style:{fontSize:12,color:Ke.inkMid,margin:"0 0 20px",lineHeight:1.5},children:"Seleccione una opcin y aada comentarios si lo desea."}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"},children:[{id:"aprobar",icon:"",label:"Aprobar oferta",color:Ke.green,bg:Ke.greenBg,desc:"Acepto las condiciones"},{id:"devolver",icon:"",label:"Solicitar cambios",color:Ke.amber,bg:Ke.amberBg,desc:"Necesito modificaciones"},{id:"rechazar",icon:"",label:"Rechazar oferta",color:Ke.red,bg:Ke.redBg,desc:"No me interesa"}].map(x=>e.jsxs("button",{onClick:()=>h(x.id),style:{...Oi,flex:1,minWidth:160,padding:"16px 14px",borderRadius:12,cursor:"pointer",textAlign:"left",background:g===x.id?x.bg:Ke.surface,border:"2px solid "+(g===x.id?x.color:Ke.border),transition:"all .15s"},children:[e.jsx("div",{style:{fontSize:22,marginBottom:6},children:x.icon}),e.jsx("div",{style:{fontSize:12,fontWeight:700,color:g===x.id?x.color:Ke.ink,marginBottom:2},children:x.label}),e.jsx("div",{style:{fontSize:10,color:Ke.inkLight,lineHeight:1.4},children:x.desc})]},x.id))}),g&&e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:Ke.ink,marginBottom:6},children:g==="devolver"?"Describa los cambios que necesita *":"Comentarios (opcional)"}),e.jsx("textarea",{value:b,onChange:x=>j(x.target.value),placeholder:g==="devolver"?"Indique qu ajustes necesita...":"Puede aadir notas...",rows:4,style:{...Oi,width:"100%",padding:12,borderRadius:8,border:"1px solid "+Ke.border,fontSize:13,resize:"vertical",background:"#FFFFFF"}})]}),g&&e.jsx("button",{onClick:l,disabled:k,style:{...Oi,width:"100%",padding:"14px 24px",borderRadius:10,fontSize:14,fontWeight:700,border:"none",cursor:k?"wait":"pointer",color:"#fff",background:g==="aprobar"?Ke.green:g==="rechazar"?Ke.red:Ke.amber,opacity:k?.6:1},children:k?"Enviando...":g==="aprobar"?" Confirmar aprobacin":g==="rechazar"?" Confirmar rechazo":" Enviar solicitud de cambios"})]}),e.jsx("div",{style:{textAlign:"center",marginTop:40,padding:"20px 0",borderTop:"1px solid "+Ke.border},children:e.jsxs("p",{style:{fontSize:11,color:Ke.inkLight,margin:0},children:["Propuesta enviada por ",e.jsx("strong",{style:{color:Ke.ink},children:p.firmante||"Habitaris"})]})})]})]})}const me={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},$e={fontFamily:"'DM Sans',sans-serif"},Ac="hab:portal:",Fc=t=>{try{return JSON.parse(store.getSync(Ac+t))||null}catch{return null}},Hm=(t,i)=>store.set(Ac+t,JSON.stringify(i)),ni=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function Gm(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}function rr({children:t,color:i,bg:o,style:n}){return e.jsx("span",{style:{...$e,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o,...n},children:t})}function Tc(){var t,i,o,n,a,r,s,g;try{const h=JSON.parse(store.getSync("hab:config"))||{};return{nombre:((t=h.empresa)==null?void 0:t.nombre)||"Habitaris",logo:((i=h.apariencia)==null?void 0:i.logo)||null,colorPrimario:((o=h.apariencia)==null?void 0:o.colorPrimario)||"#111111",colorAcento:((n=h.apariencia)==null?void 0:n.colorAcento)||"#111111",tipografia:((a=h.apariencia)==null?void 0:a.tipografia)||"DM Sans",telefono:((r=h.empresa)==null?void 0:r.telefono)||"+57 350 566 1545",email:((s=h.empresa)==null?void 0:s.email)||"info@habitaris.co",web:((g=h.empresa)==null?void 0:g.web)||"www.habitaris.co"}}catch{return{nombre:"Habitaris",colorPrimario:"#111",colorAcento:"#111111",tipografia:"DM Sans"}}}const Bc=[{id:"resumen",label:"Resumen del proyecto",icon:"",desc:"Estado general, progreso, datos clave"},{id:"documentos",label:"Documentos",icon:"",desc:"Contratos, planos, presupuestos, actas"},{id:"firmas",label:"Firmas pendientes",icon:"",desc:"Documentos que requieren firma del cliente"},{id:"avance",label:"Avance de obra",icon:"",desc:"Progreso por fase, fotos, bitcora"},{id:"pagos",label:"Pagos y facturas",icon:"",desc:"Estado de cuenta, facturas, recibos"},{id:"cronograma",label:"Cronograma",icon:"",desc:"Fases del proyecto con fechas"},{id:"comunicaciones",label:"Comunicaciones",icon:"",desc:"Mensajes y notificaciones del equipo"},{id:"garantias",label:"Garantas",icon:"",desc:"Plizas, garantas post-entrega"}],ar=[{id:"briefing",label:"Briefing",color:"#888",bg:"#F5F5F5",pct:5},{id:"diseno",label:"Diseo",color:"#5B3A8C",bg:"#F3EEF9",pct:20},{id:"aprobacion",label:"Aprobacin",color:"#8C6A00",bg:"#FFF8EE",pct:30},{id:"licencias",label:"Licencias",color:"#3B3B3B",bg:"#F0F0F0",pct:35},{id:"obra",label:"En obra",color:"#D4840A",bg:"#FFF3E0",pct:60},{id:"acabados",label:"Acabados",color:"#0D7377",bg:"#E6F5F5",pct:85},{id:"entrega",label:"Entrega",color:"#111111",bg:"#EBEBEB",pct:95},{id:"postventa",label:"Postventa",color:"#111111",bg:"#EBEBEB",pct:100}],Ic=[{id:"portal_1",clienteId:"c1",clienteNombre:"Mara Fernanda Gmez",clienteEmail:"mfgomez@email.com",proyecto:"Diseo Interior  Apto 502 Rosales",estado:"diseno",progreso:25,ofertaRef:"OFR-2026-001",valorContrato:"$45.000.000 COP",equipoAsignado:[{nombre:"Ana Garca",cargo:"Diseadora lder"},{nombre:"Carlos Lpez",cargo:"Arquitecto"}],fechaInicio:"2026-02-15",fechaEstimadaFin:"2026-06-15",seccionesActivas:["resumen","documentos","firmas","pagos","cronograma","comunicaciones"],accessToken:"mfg502ros",documentos:[{id:"doc1",nombre:"Contrato de Diseo Interior",tipo:"contrato",fecha:"2026-02-15",estado:"firmado",descargable:!0},{id:"doc2",nombre:"Brief de Diseo Aprobado",tipo:"brief",fecha:"2026-02-18",estado:"aprobado",descargable:!0},{id:"doc3",nombre:"Propuesta de Concepto v1",tipo:"diseo",fecha:"2026-02-25",estado:"en_revision",descargable:!0},{id:"doc4",nombre:"Presupuesto Estimado de Obra",tipo:"presupuesto",fecha:"2026-02-20",estado:"pendiente",descargable:!1}],firmasPendientes:[{id:"fp1",documento:"Aprobacin de Concepto de Diseo",fechaLimite:"2026-03-10",estado:"pendiente"}],pagos:[{id:"pago1",concepto:"Anticipo  Diseo (50%)",valor:"$22.500.000",fecha:"2026-02-15",estado:"pagado"},{id:"pago2",concepto:"Segundo pago  Diseo (30%)",valor:"$13.500.000",fecha:"2026-04-01",estado:"pendiente"},{id:"pago3",concepto:"Pago final  Diseo (20%)",valor:"$9.000.000",fecha:"2026-06-15",estado:"pendiente"}],cronograma:[{fase:"Briefing y levantamiento",inicio:"2026-02-15",fin:"2026-02-22",completado:100},{fase:"Concepto de diseo",inicio:"2026-02-23",fin:"2026-03-10",completado:60},{fase:"Anteproyecto",inicio:"2026-03-11",fin:"2026-04-05",completado:0},{fase:"Proyecto ejecutivo",inicio:"2026-04-06",fin:"2026-05-15",completado:0},{fase:"Detalles tcnicos y planos de obra",inicio:"2026-05-16",fin:"2026-06-10",completado:0},{fase:"Entrega final",inicio:"2026-06-11",fin:"2026-06-15",completado:0}],comunicaciones:[{id:"com1",fecha:"2026-02-25",de:"Ana Garca",mensaje:"Hola Mara Fernanda, ya tenemos lista la primera propuesta de concepto. La subimos al portal para tu revisin. Esperamos tus comentarios!"},{id:"com2",fecha:"2026-02-20",de:"Sistema",mensaje:"Se ha generado tu portal de cliente. Aqu podrs seguir el avance de tu proyecto."},{id:"com3",fecha:"2026-02-15",de:"Laura Snchez",mensaje:"Bienvenida! Estamos encantados de iniciar este proyecto contigo. Tu diseadora lder ser Ana Garca."}],garantias:[]},{id:"portal_2",clienteId:"c2",clienteNombre:"Andrs Meja Ruiz",clienteEmail:"amejia@email.com",proyecto:"Remodelacin Integral  Casa Chic Norte",estado:"obra",progreso:55,ofertaRef:"OFR-2025-089",valorContrato:"$120.000.000 COP",equipoAsignado:[{nombre:"Carlos Lpez",cargo:"Director de proyecto"},{nombre:"Mara Rodrguez",cargo:"Directora de obra"},{nombre:"Pedro Martnez",cargo:"Instalador tcnico"}],fechaInicio:"2025-10-01",fechaEstimadaFin:"2026-04-30",seccionesActivas:["resumen","documentos","firmas","avance","pagos","cronograma","comunicaciones","garantias"],accessToken:"amr_chico",documentos:[{id:"doc5",nombre:"Contrato de Obra",tipo:"contrato",fecha:"2025-10-01",estado:"firmado",descargable:!0},{id:"doc6",nombre:"Acta de Inicio",tipo:"acta",fecha:"2025-10-05",estado:"firmado",descargable:!0},{id:"doc7",nombre:"Acta de Vecindad",tipo:"acta",fecha:"2025-10-05",estado:"firmado",descargable:!0},{id:"doc8",nombre:"Planos Aprobados",tipo:"planos",fecha:"2025-09-20",estado:"aprobado",descargable:!0},{id:"doc9",nombre:"Acta Comit #8",tipo:"acta",fecha:"2026-02-20",estado:"aprobado",descargable:!0},{id:"doc10",nombre:"Otros  Cambio de acabados bao",tipo:"otrosi",fecha:"2026-02-10",estado:"firmado",descargable:!0}],firmasPendientes:[{id:"fp2",documento:"Acta de Comit #9  Febrero",fechaLimite:"2026-03-01",estado:"pendiente"},{id:"fp3",documento:"Aprobacin cambio cocina integral",fechaLimite:"2026-03-05",estado:"pendiente"}],pagos:[{id:"pago4",concepto:"Anticipo (30%)",valor:"$36.000.000",fecha:"2025-10-01",estado:"pagado"},{id:"pago5",concepto:"Avance 1  Demolicin y estructura (20%)",valor:"$24.000.000",fecha:"2025-11-15",estado:"pagado"},{id:"pago6",concepto:"Avance 2  Instalaciones (20%)",valor:"$24.000.000",fecha:"2026-01-15",estado:"pagado"},{id:"pago7",concepto:"Avance 3  Acabados (20%)",valor:"$24.000.000",fecha:"2026-03-15",estado:"pendiente"},{id:"pago8",concepto:"Pago final (10%)",valor:"$12.000.000",fecha:"2026-04-30",estado:"pendiente"}],cronograma:[{fase:"Demolicin y preparacin",inicio:"2025-10-05",fin:"2025-10-30",completado:100},{fase:"Estructura y mampostera",inicio:"2025-11-01",fin:"2025-12-15",completado:100},{fase:"Instalaciones (elctrica, hidrulica)",inicio:"2025-12-16",fin:"2026-01-31",completado:100},{fase:"Paetes y pisos",inicio:"2026-02-01",fin:"2026-02-28",completado:70},{fase:"Carpintera y acabados",inicio:"2026-03-01",fin:"2026-04-10",completado:0},{fase:"Limpieza y entrega",inicio:"2026-04-11",fin:"2026-04-30",completado:0}],avanceObra:[{fecha:"2026-02-24",nota:"Avance de pisos en sala y comedor al 80%. Pendiente habitaciones.",fotos:3},{fecha:"2026-02-17",nota:"Inicio de instalacin de piso en sala principal. Material lleg completo.",fotos:5},{fecha:"2026-02-10",nota:"Paetes terminados en toda la casa. Se inicia alistamiento de pisos.",fotos:4},{fecha:"2026-01-30",nota:"Pruebas de presin hidrulica OK. Instalacin elctrica completada.",fotos:6}],comunicaciones:[{id:"com4",fecha:"2026-02-24",de:"Mara Rodrguez",mensaje:"Andrs, el avance de pisos va al 80% en sala. Esta semana arrancamos habitaciones. Te sub las fotos al portal."},{id:"com5",fecha:"2026-02-10",de:"Carlos Lpez",mensaje:"Otros del cambio de acabados del bao ya est firmado por ambas partes. Queda en el portal."},{id:"com6",fecha:"2026-02-01",de:"Sistema",mensaje:"Nuevo documento pendiente de firma: Acta de Comit #9"}],garantias:[{tipo:"Todo Riesgo Construccin",aseguradora:"Seguros Bolvar",vigencia:"2026-07-15",poliza:"POL-2026-001245"},{tipo:"RC Extracontractual",aseguradora:"Sura",vigencia:"2026-12-31",poliza:"RC-2026-778899"}]},{id:"portal_3",clienteId:"c3",clienteNombre:"TechStar S.A.S",clienteEmail:"admin@techstar.co",proyecto:"Adecuacin Oficina 301  WTC Bogot",estado:"postventa",progreso:100,ofertaRef:"OFR-2025-045",valorContrato:"$85.000.000 COP",equipoAsignado:[{nombre:"Ana Garca",cargo:"Diseadora"},{nombre:"Mara Rodrguez",cargo:"Directora de obra"}],fechaInicio:"2025-06-01",fechaEstimadaFin:"2025-12-15",seccionesActivas:["resumen","documentos","pagos","garantias"],accessToken:"ts_301wtc",documentos:[{id:"doc11",nombre:"Contrato de Obra",tipo:"contrato",fecha:"2025-06-01",estado:"firmado",descargable:!0},{id:"doc12",nombre:"Acta de Entrega Final",tipo:"acta",fecha:"2025-12-10",estado:"firmado",descargable:!0},{id:"doc13",nombre:"Acta de Conformidad",tipo:"acta",fecha:"2025-12-10",estado:"firmado",descargable:!0},{id:"doc14",nombre:"Planos As-Built",tipo:"planos",fecha:"2025-12-12",estado:"entregado",descargable:!0}],firmasPendientes:[],pagos:[{id:"pago9",concepto:"Anticipo (30%)",valor:"$25.500.000",fecha:"2025-06-01",estado:"pagado"},{id:"pago10",concepto:"Avance 1 (30%)",valor:"$25.500.000",fecha:"2025-08-15",estado:"pagado"},{id:"pago11",concepto:"Avance 2 (30%)",valor:"$25.500.000",fecha:"2025-11-01",estado:"pagado"},{id:"pago12",concepto:"Retencin final (10%)",valor:"$8.500.000",fecha:"2025-12-15",estado:"pagado"}],cronograma:[],comunicaciones:[],garantias:[{tipo:"Estabilidad de obra",aseguradora:"Seguros Bolvar",vigencia:"2030-12-10",poliza:"CAL-2025-112233"},{tipo:"Cumplimiento",aseguradora:"Liberty Seguros",vigencia:"2026-06-01",poliza:"CUM-2025-556677"}]}];function Km(){try{const t=new URLSearchParams(window.location.search);return t.get("token")||t.get("t")||null}catch{return null}}function Rc({portal:t,brand:i}){const[o,n]=F.useState("resumen"),a=i.tipografia||"DM Sans",r=i.colorPrimario,s=i.colorAcento,g=ar.find(l=>l.id===t.estado),h=Bc.filter(l=>t.seccionesActivas.includes(l.id)),c={resumen:()=>{var l,x,y;return e.jsxs("div",{children:[e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:24,marginBottom:16,border:`1px solid ${me.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:10,color:me.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Estado actual"}),e.jsx("div",{style:{...$e,fontSize:18,fontWeight:700,color:g==null?void 0:g.color},children:g==null?void 0:g.label})]}),e.jsxs("div",{style:{...$e,fontSize:32,fontWeight:800,color:s},children:[t.progreso,"%"]})]}),e.jsx("div",{style:{height:10,background:me.bg,borderRadius:5,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${t.progreso}%`,background:s,borderRadius:5,transition:"width .5s"}})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12},children:ar.slice(0,7).map(u=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",margin:"0 auto 4px",background:t.progreso>=u.pct?s:me.border}}),e.jsx("div",{style:{...$e,fontSize:8,color:t.progreso>=u.pct?me.ink:me.inkLight},children:u.label})]},u.id))})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px,1fr))",gap:12,marginBottom:16},children:[{label:"Valor contrato",val:t.valorContrato,icon:""},{label:"Inicio",val:ni(t.fechaInicio),icon:""},{label:"Entrega estimada",val:ni(t.fechaEstimadaFin),icon:""},{label:"Oferta ref.",val:t.ofertaRef,icon:""}].map((u,S)=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${me.border}`,borderRadius:10,padding:16},children:[e.jsxs("div",{style:{...$e,fontSize:10,color:me.inkLight},children:[u.icon," ",u.label]}),e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.ink,marginTop:2},children:u.val})]},S))}),e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:20,border:`1px solid ${me.border}`,marginBottom:16},children:[e.jsx("div",{style:{...$e,fontSize:13,fontWeight:700,color:me.ink,marginBottom:12},children:" Tu equipo"}),e.jsx("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:t.equipoAsignado.map((u,S)=>e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"8px 14px",background:me.surface,borderRadius:8},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:s+"22",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:s},children:u.nombre[0]}),e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:12,fontWeight:600,color:me.ink},children:u.nombre}),e.jsx("div",{style:{...$e,fontSize:10,color:me.inkLight},children:u.cargo})]})]},S))})]}),t.firmasPendientes.length>0&&e.jsxs("div",{style:{background:me.warningBg,border:`1px solid ${me.warning}33`,borderRadius:10,padding:16,marginBottom:12},children:[e.jsxs("div",{style:{...$e,fontSize:12,fontWeight:700,color:me.warning},children:[" Tienes ",t.firmasPendientes.length," documento(s) pendiente(s) de firma"]}),e.jsx("div",{style:{...$e,fontSize:11,color:me.warning,marginTop:4},children:'Ve a la seccin "Firmas pendientes" para revisarlos y firmar.'})]}),t.pagos.filter(u=>u.estado==="pendiente").length>0&&e.jsxs("div",{style:{background:me.infoBg,border:`1px solid ${me.info}33`,borderRadius:10,padding:16},children:[e.jsxs("div",{style:{...$e,fontSize:12,fontWeight:700,color:me.info},children:[" Prximo pago: ",(l=t.pagos.find(u=>u.estado==="pendiente"))==null?void 0:l.concepto]}),e.jsxs("div",{style:{...$e,fontSize:11,color:me.info,marginTop:4},children:[(x=t.pagos.find(u=>u.estado==="pendiente"))==null?void 0:x.valor,"  ",ni((y=t.pagos.find(u=>u.estado==="pendiente"))==null?void 0:y.fecha)]})]})]})},documentos:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.ink,marginBottom:16},children:" Documentos del proyecto"}),t.documentos.map(l=>{const y={firmado:{c:me.accent,bg:me.accentBg},aprobado:{c:me.accent,bg:me.accentBg},en_revision:{c:me.warning,bg:me.warningBg},pendiente:{c:me.info,bg:me.infoBg},entregado:{c:me.accent,bg:me.accentBg}}[l.estado]||{c:me.inkLight,bg:me.bg};return e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"14px 16px",background:"#fff",border:`1px solid ${me.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{fontSize:24},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...$e,fontSize:13,fontWeight:600,color:me.ink},children:l.nombre}),e.jsxs("div",{style:{...$e,fontSize:10,color:me.inkLight},children:[l.tipo,"  ",ni(l.fecha)]})]}),e.jsx(rr,{color:y.c,bg:y.bg,children:l.estado}),l.descargable&&e.jsx("button",{style:{...$e,padding:"6px 12px",fontSize:10,fontWeight:600,color:s,background:s+"15",border:`1px solid ${s}33`,borderRadius:5,cursor:"pointer"},children:" Descargar"})]},l.id)})]}),firmas:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.ink,marginBottom:16},children:" Documentos pendientes de firma"}),t.firmasPendientes.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...$e,fontSize:13,color:me.accent},children:"No tienes documentos pendientes de firma"})]}):t.firmasPendientes.map(l=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"16px 18px",background:"#fff",border:`1px solid ${me.warning}44`,borderRadius:10,marginBottom:10},children:[e.jsx("div",{style:{fontSize:28},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...$e,fontSize:13,fontWeight:700,color:me.ink},children:l.documento}),e.jsxs("div",{style:{...$e,fontSize:11,color:me.inkLight},children:["Fecha lmite: ",ni(l.fechaLimite)]})]}),e.jsx("button",{style:{...$e,padding:"8px 20px",fontSize:12,fontWeight:700,color:"#fff",background:s,border:"none",borderRadius:6,cursor:"pointer"},children:" Firmar ahora"})]},l.id))]}),avance:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.ink,marginBottom:16},children:" Avance de obra"}),(t.avanceObra||[]).length===0?e.jsx("p",{style:{...$e,fontSize:12,color:me.inkLight},children:"An no hay registros de avance."}):e.jsx("div",{style:{borderLeft:`2px solid ${me.border}`,paddingLeft:20,marginLeft:10},children:t.avanceObra.map((l,x)=>e.jsxs("div",{style:{marginBottom:20,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-27,top:2,width:12,height:12,borderRadius:"50%",background:x===0?s:me.bg,border:`2px solid ${x===0?s:me.border}`}}),e.jsx("div",{style:{...$e,fontSize:10,fontWeight:600,color:s},children:ni(l.fecha)}),e.jsx("div",{style:{...$e,fontSize:13,color:me.ink,marginTop:4,lineHeight:1.6},children:l.nota}),l.fotos>0&&e.jsxs("div",{style:{...$e,fontSize:10,color:me.inkLight,marginTop:4},children:[" ",l.fotos," foto(s) adjuntas"]})]},x))})]}),pagos:()=>{const l=t.pagos.filter(S=>S.estado==="pagado"),x=t.pagos.filter(S=>S.estado==="pendiente"),y=l.length,u=t.pagos.length;return e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.ink,marginBottom:12},children:" Estado de pagos"}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16},children:[e.jsxs("div",{style:{flex:1,padding:16,background:me.accentBg,borderRadius:10,border:`1px solid ${me.accent}33`},children:[e.jsx("div",{style:{...$e,fontSize:10,color:me.accent},children:"Pagado"}),e.jsxs("div",{style:{...$e,fontSize:20,fontWeight:700,color:me.accent},children:[y,"/",u]})]}),x.length>0&&e.jsxs("div",{style:{flex:1,padding:16,background:me.warningBg,borderRadius:10,border:`1px solid ${me.warning}33`},children:[e.jsx("div",{style:{...$e,fontSize:10,color:me.warning},children:"Prximo pago"}),e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.warning},children:x[0].valor}),e.jsx("div",{style:{...$e,fontSize:10,color:me.warning},children:ni(x[0].fecha)})]})]}),t.pagos.map(S=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:"#fff",border:`1px solid ${me.border}`,borderRadius:8,marginBottom:6},children:[e.jsx("div",{style:{fontSize:18},children:S.estado==="pagado"?"":""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...$e,fontSize:12,fontWeight:600,color:me.ink},children:S.concepto}),e.jsx("div",{style:{...$e,fontSize:10,color:me.inkLight},children:ni(S.fecha)})]}),e.jsx("div",{style:{...$e,fontSize:13,fontWeight:700,color:S.estado==="pagado"?me.accent:me.ink},children:S.valor}),e.jsx(rr,{color:S.estado==="pagado"?me.accent:me.warning,bg:S.estado==="pagado"?me.accentBg:me.warningBg,children:S.estado==="pagado"?"Pagado":"Pendiente"})]},S.id))]})},cronograma:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.ink,marginBottom:16},children:" Cronograma del proyecto"}),t.cronograma.map((l,x)=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:"#fff",border:`1px solid ${me.border}`,borderRadius:8,marginBottom:6},children:[e.jsx("div",{style:{width:40,textAlign:"center"},children:e.jsx("div",{style:{...$e,fontSize:18,fontWeight:800,color:l.completado===100?me.accent:l.completado>0?me.warning:me.inkLight},children:l.completado===100?"":`${l.completado}%`})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...$e,fontSize:12,fontWeight:600,color:me.ink},children:l.fase}),e.jsxs("div",{style:{...$e,fontSize:10,color:me.inkLight},children:[ni(l.inicio),"  ",ni(l.fin)]}),e.jsx("div",{style:{height:4,background:me.bg,borderRadius:2,marginTop:4,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${l.completado}%`,borderRadius:2,background:l.completado===100?me.accent:s}})})]})]},x))]}),comunicaciones:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.ink,marginBottom:16},children:" Comunicaciones"}),t.comunicaciones.map(l=>e.jsxs("div",{style:{display:"flex",gap:12,padding:"14px 16px",background:"#fff",border:`1px solid ${me.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:s+"22",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:s,flexShrink:0},children:l.de[0]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{...$e,fontSize:12,fontWeight:600,color:me.ink},children:l.de}),e.jsx("span",{style:{...$e,fontSize:10,color:me.inkLight},children:ni(l.fecha)})]}),e.jsx("div",{style:{...$e,fontSize:12,color:me.inkMid,lineHeight:1.6},children:l.mensaje})]})]},l.id))]}),garantias:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...$e,fontSize:14,fontWeight:700,color:me.ink,marginBottom:16},children:" Garantas y plizas"}),(t.garantias||[]).length===0?e.jsx("p",{style:{...$e,fontSize:12,color:me.inkLight},children:"Las garantas se activarn al finalizar el proyecto."}):t.garantias.map((l,x)=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"14px 16px",background:"#fff",border:`1px solid ${me.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{fontSize:24},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...$e,fontSize:13,fontWeight:600,color:me.ink},children:l.tipo}),e.jsxs("div",{style:{...$e,fontSize:10,color:me.inkLight},children:[l.aseguradora,"  Pliza: ",l.poliza]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{...$e,fontSize:11,color:me.inkMid},children:"Vigente hasta"}),e.jsx("div",{style:{...$e,fontSize:12,fontWeight:600,color:Gm(l.vigencia)<60?me.warning:me.accent},children:ni(l.vigencia)})]})]},x))]})};return e.jsxs("div",{style:{minHeight:"100vh",background:me.bg,fontFamily:`'${a}',sans-serif`},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${a.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:r,padding:"0 24px",height:56,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:26,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:15,fontWeight:700,color:"#fff",letterSpacing:1.5},children:i.nombre.toUpperCase()}),e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.4)",letterSpacing:1},children:"PORTAL CLIENTE"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"rgba(255,255,255,.12)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:"rgba(255,255,255,.6)"},children:t.clienteNombre[0]}),e.jsx("span",{style:{fontSize:11,color:"rgba(255,255,255,.6)"},children:t.clienteNombre})]})]}),i.colorAcento&&e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${s},${s}88)`}}),e.jsxs("div",{style:{padding:"24px 24px 0",maxWidth:960,margin:"0 auto"},children:[e.jsx("div",{style:{...$e,fontSize:10,color:me.inkLight,textTransform:"uppercase",letterSpacing:1.5,marginBottom:4},children:"Proyecto"}),e.jsx("h1",{style:{...$e,fontSize:22,fontWeight:700,color:me.ink,margin:"0 0 20px"},children:t.proyecto})]}),e.jsxs("div",{style:{display:"flex",maxWidth:960,margin:"0 auto",padding:"0 24px 40px",gap:20},children:[e.jsx("div",{style:{width:200,flexShrink:0},children:h.map(l=>e.jsxs("button",{onClick:()=>n(l.id),style:{...$e,display:"flex",gap:8,alignItems:"center",width:"100%",padding:"10px 14px",fontSize:12,fontWeight:o===l.id?700:500,textAlign:"left",color:o===l.id?s:me.inkMid,background:o===l.id?s+"12":"transparent",border:"none",borderRadius:8,cursor:"pointer",marginBottom:2,transition:"all .15s"},children:[e.jsx("span",{children:l.icon})," ",l.label,l.id==="firmas"&&t.firmasPendientes.length>0&&e.jsx("span",{style:{marginLeft:"auto",background:me.warning,color:"#fff",padding:"1px 6px",borderRadius:8,fontSize:9},children:t.firmasPendientes.length})]},l.id))}),e.jsx("div",{style:{flex:1,minWidth:0},children:c[o]?c[o]():e.jsx("p",{children:"Seccin no disponible"})})]}),e.jsx("div",{style:{textAlign:"center",padding:"20px 24px 30px",borderTop:`1px solid ${me.border}`},children:e.jsxs("p",{style:{...$e,fontSize:10,color:me.inkLight},children:[i.nombre,"  ",i.telefono,"  ",i.email]})})]})}function Jm(){const t=F.useMemo(()=>Tc(),[]),[i,o]=F.useState(()=>Fc("portales")||Ic),[n,a]=F.useState(null);F.useState(null);const[r,s]=F.useState(null),[g,h]=F.useState("");F.useEffect(()=>Hm("portales",i),[i]);const b=F.useMemo(()=>{if(!g)return i;const v=g.toLowerCase();return i.filter(m=>m.clienteNombre.toLowerCase().includes(v)||m.proyecto.toLowerCase().includes(v))},[i,g]),j=()=>{const v=n?i.find(d=>d.id===n):null;if(!v)return null;const m=ar.find(d=>d.id===v.estado),f=d=>{o(c=>c.map(l=>{if(l.id!==v.id)return l;const x=l.seccionesActivas.includes(d)?l.seccionesActivas.filter(y=>y!==d):[...l.seccionesActivas,d];return{...l,seccionesActivas:x}}))},p=(d,c)=>{o(l=>l.map(x=>x.id===v.id?{...x,[d]:c}:x))};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>a(null),children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx(rr,{color:m==null?void 0:m.color,bg:m==null?void 0:m.bg,children:m==null?void 0:m.label}),e.jsx("h2",{style:{...$e,fontSize:18,fontWeight:700,color:me.ink,margin:"8px 0 2px"},children:v.proyecto}),e.jsxs("div",{style:{...$e,fontSize:12,color:me.inkLight},children:["Cliente: ",v.clienteNombre,"  ",v.clienteEmail]})]}),e.jsx("button",{onClick:()=>a(null),style:{...$e,fontSize:18,color:me.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{background:me.infoBg,border:`1px solid ${me.info}22`,borderRadius:8,padding:14,marginBottom:16},children:[e.jsx("div",{style:{...$e,fontSize:10,fontWeight:600,color:me.info,marginBottom:4},children:" Enlace del cliente"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("code",{style:{...$e,flex:1,fontSize:11,background:"#fff",padding:"6px 10px",borderRadius:4,border:`1px solid ${me.border}`,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:`${window.location.origin}/portal?token=${v.accessToken}`}),e.jsx("button",{onClick:()=>{var d;(d=navigator.clipboard)==null||d.writeText(`${window.location.origin}/portal?token=${v.accessToken}`),alert(" Enlace copiado")},style:{...$e,padding:"6px 12px",fontSize:10,fontWeight:600,color:me.info,background:"#fff",border:`1px solid ${me.info}33`,borderRadius:5,cursor:"pointer"},children:" Copiar"}),e.jsx("button",{style:{...$e,padding:"6px 12px",fontSize:10,fontWeight:600,color:"#fff",background:"#25D366",border:"none",borderRadius:5,cursor:"pointer"},children:" WhatsApp"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...$e,fontSize:10,fontWeight:600,color:me.inkLight},children:"Estado del proyecto"}),e.jsx("select",{value:v.estado,onChange:d=>p("estado",d.target.value),style:{...$e,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${me.border}`,borderRadius:5},children:ar.map(d=>e.jsx("option",{value:d.id,children:d.label},d.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...$e,fontSize:10,fontWeight:600,color:me.inkLight},children:"Progreso (%)"}),e.jsx("input",{type:"number",min:0,max:100,value:v.progreso,onChange:d=>p("progreso",parseInt(d.target.value)||0),style:{...$e,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${me.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...$e,fontSize:12,fontWeight:700,color:me.ink,marginBottom:8},children:" Secciones visibles para el cliente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:Bc.map(d=>e.jsxs("label",{style:{...$e,display:"flex",gap:8,alignItems:"center",padding:"8px 12px",background:v.seccionesActivas.includes(d.id)?me.accentBg:me.surface,border:`1px solid ${v.seccionesActivas.includes(d.id)?me.accent+"33":me.border}`,borderRadius:6,cursor:"pointer",fontSize:12},children:[e.jsx("input",{type:"checkbox",checked:v.seccionesActivas.includes(d.id),onChange:()=>f(d.id),style:{accentColor:me.accent}}),e.jsx("span",{children:d.icon}),e.jsx("span",{style:{fontWeight:v.seccionesActivas.includes(d.id)?600:400},children:d.label})]},d.id))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:16},children:[e.jsxs("div",{style:{padding:10,background:me.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...$e,fontSize:16,fontWeight:700,color:me.ink},children:v.documentos.length}),e.jsx("div",{style:{...$e,fontSize:9,color:me.inkLight},children:"Documentos"})]}),e.jsxs("div",{style:{padding:10,background:me.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...$e,fontSize:16,fontWeight:700,color:me.warning},children:v.firmasPendientes.length}),e.jsx("div",{style:{...$e,fontSize:9,color:me.inkLight},children:"Firmas pend."})]}),e.jsxs("div",{style:{padding:10,background:me.surface,borderRadius:6,textAlign:"center"},children:[e.jsxs("div",{style:{...$e,fontSize:16,fontWeight:700,color:me.accent},children:[v.pagos.filter(d=>d.estado==="pagado").length,"/",v.pagos.length]}),e.jsx("div",{style:{...$e,fontSize:9,color:me.inkLight},children:"Pagos"})]}),e.jsxs("div",{style:{padding:10,background:me.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...$e,fontSize:16,fontWeight:700,color:me.ink},children:v.comunicaciones.length}),e.jsx("div",{style:{...$e,fontSize:9,color:me.inkLight},children:"Mensajes"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>{s(v),a(null)},style:{...$e,padding:"8px 18px",fontSize:11,fontWeight:600,color:me.info,background:me.infoBg,border:`1px solid ${me.info}33`,borderRadius:6,cursor:"pointer"},children:" Vista previa cliente"}),e.jsx("button",{style:{...$e,padding:"8px 18px",fontSize:11,fontWeight:600,color:me.accent,background:me.accentBg,border:`1px solid ${me.accent}33`,borderRadius:6,cursor:"pointer"},children:" Aadir documento"}),e.jsx("button",{style:{...$e,padding:"8px 18px",fontSize:11,fontWeight:600,color:me.warning,background:me.warningBg,border:`1px solid ${me.warning}33`,borderRadius:6,cursor:"pointer"},children:" Enviar mensaje"})]})]})})},k=()=>r?e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1001,background:"rgba(0,0,0,.6)"},onClick:()=>s(null),children:[e.jsx("div",{style:{position:"absolute",top:10,right:20,zIndex:2},children:e.jsx("button",{onClick:()=>s(null),style:{...$e,padding:"8px 18px",fontSize:12,fontWeight:700,color:"#fff",background:"rgba(0,0,0,.6)",border:"none",borderRadius:8,cursor:"pointer"},children:" Cerrar vista previa"})}),e.jsx("div",{onClick:v=>v.stopPropagation(),style:{height:"100%",overflow:"auto"},children:e.jsx(Rc,{portal:r,brand:t})})]}):null;return e.jsxs("div",{style:{...$e,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...$e,fontSize:22,fontWeight:700,color:me.ink,margin:"0 0 4px"},children:" Portal de Clientes"}),e.jsx("p",{style:{...$e,fontSize:12,color:me.inkLight,margin:0},children:"Gestiona los entornos de acceso de tus clientes: documentos, firmas, avances y pagos"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Portales activos",val:i.length,icon:""},{label:"En diseo",val:i.filter(v=>v.estado==="diseno").length,icon:""},{label:"En obra",val:i.filter(v=>["obra","acabados"].includes(v.estado)).length,icon:""},{label:"Firmas pendientes",val:i.reduce((v,m)=>v+m.firmasPendientes.length,0),icon:"",warn:!0},{label:"Completados",val:i.filter(v=>v.estado==="postventa").length,icon:""}].map((v,m)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"10px 14px",background:"#fff",border:`1px solid ${me.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...$e,fontSize:9,color:me.inkLight},children:[v.icon," ",v.label]}),e.jsx("div",{style:{...$e,fontSize:18,fontWeight:700,color:me.ink},children:v.val})]},m))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:g,onChange:v=>h(v.target.value),placeholder:"Buscar por cliente o proyecto",style:{...$e,width:"100%",padding:"8px 12px",fontSize:12,border:`1px solid ${me.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{style:{...$e,padding:"8px 18px",fontSize:11,fontWeight:700,color:"#fff",background:me.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo portal"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px,1fr))",gap:12},children:b.map(v=>{const m=ar.find(d=>d.id===v.estado),f=v.firmasPendientes.length,p=v.pagos.filter(d=>d.estado==="pendiente").length;return e.jsxs("div",{onClick:()=>a(v.id),style:{background:"#fff",border:`1px solid ${me.border}`,borderRadius:12,padding:20,cursor:"pointer",boxShadow:me.shadow,transition:"all .15s"},onMouseEnter:d=>d.currentTarget.style.boxShadow=me.shadowMd,onMouseLeave:d=>d.currentTarget.style.boxShadow=me.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:10},children:[e.jsx(rr,{color:m==null?void 0:m.color,bg:m==null?void 0:m.bg,children:m==null?void 0:m.label}),e.jsxs("span",{style:{...$e,fontSize:18,fontWeight:800,color:me.accent},children:[v.progreso,"%"]})]}),e.jsx("div",{style:{...$e,fontSize:15,fontWeight:700,color:me.ink,marginBottom:2},children:v.proyecto}),e.jsx("div",{style:{...$e,fontSize:12,color:me.inkLight,marginBottom:10},children:v.clienteNombre}),e.jsx("div",{style:{height:6,background:me.bg,borderRadius:3,overflow:"hidden",marginBottom:12},children:e.jsx("div",{style:{height:"100%",width:`${v.progreso}%`,background:me.accent,borderRadius:3}})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("span",{style:{...$e,fontSize:10,color:me.inkLight},children:[" ",v.documentos.length," docs"]}),f>0&&e.jsxs(rr,{color:me.warning,bg:me.warningBg,children:[" ",f," firmas"]}),p>0&&e.jsxs("span",{style:{...$e,fontSize:10,color:me.inkLight},children:[" ",p," pagos pend."]})]}),e.jsxs("div",{style:{...$e,fontSize:10,color:me.inkLight,marginTop:8},children:[ni(v.fechaInicio),"  ",ni(v.fechaEstimadaFin),"  ",v.seccionesActivas.length," secciones activas"]})]},v.id)})}),j(),k()]})}function Ym(){const t=window.location.hash.slice(1);if(t&&t.length>=20&&t.length<=30&&/^[A-Za-z0-9]+$/.test(t))return e.jsx(qm,{token:t});const i=F.useMemo(()=>Tc(),[]),o=Km(),n=Fc("portales")||Ic;if(o){const a=n.find(r=>r.accessToken===o);return a?e.jsx(Rc,{portal:a,brand:i}):e.jsx("div",{style:{minHeight:"100vh",background:me.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("h2",{style:{...$e,fontSize:20,fontWeight:700,color:me.ink},children:"Portal no encontrado"}),e.jsxs("p",{style:{...$e,fontSize:13,color:me.inkLight},children:["El enlace no es vlido o ha expirado. Contacta a ",i.nombre,"."]}),e.jsxs("p",{style:{...$e,fontSize:12,color:me.inkLight,marginTop:8},children:[i.telefono,"  ",i.email]})]})})}return e.jsx(Jm,{})}const na="https://xlzkasdskatnikuavefh.supabase.co",jd="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM",Aa="hab:session",Do={h:{apikey:jd,Authorization:`Bearer ${jd}`,"Content-Type":"application/json",Prefer:"return=representation"},async q(t,i=""){try{const o=await fetch(`${na}/rest/v1/${t}?${i}`,{headers:this.h});return o.ok?await o.json():null}catch{return null}},async i(t,i){try{const o=await fetch(`${na}/rest/v1/${t}`,{method:"POST",headers:this.h,body:JSON.stringify(i)});return o.ok?await o.json():null}catch{return null}},async u(t,i,o){try{const n=await fetch(`${na}/rest/v1/${t}?${i}`,{method:"PATCH",headers:this.h,body:JSON.stringify(o)});return n.ok?await n.json():null}catch{return null}},async d(t,i){try{return(await fetch(`${na}/rest/v1/${t}?${i}`,{method:"DELETE",headers:this.h})).ok}catch{return!1}}},pt={ink:"#111",inkMid:"#555",inkLight:"#999",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",green:"#2D6A2E",greenBg:"#EAFAEA",blue:"#3B3B3B",blueBg:"#F0F0F0",amber:"#8C6A00",amberBg:"#FFF8E0",red:"#B91C1C",redBg:"#FAE8E8",gold:"#111",shadow:"0 1px 4px rgba(0,0,0,.06)"};async function ks(t){const i=new TextEncoder().encode(t+"_hab_2026"),o=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(o)).map(n=>n.toString(16).padStart(2,"0")).join("")}const Xm={superadmin:{label:"Super Admin",color:pt.gold},admin:{label:"Administrador",color:pt.blue},gerente:{label:"Gerente",color:pt.green},disenador:{label:"Diseador",color:"#5B3A8C"},ingeniero:{label:"Ingeniero",color:"#0D5E6E"},comercial:{label:"Comercial",color:pt.amber},contable:{label:"Contable",color:pt.red},auxiliar:{label:"Auxiliar",color:pt.inkLight}};function Qm(){try{const t=sessionStorage.getItem(Aa);if(!t)return null;const i=JSON.parse(t);return Date.now()-i.ts>24*60*60*1e3?(sessionStorage.removeItem(Aa),null):i}catch{return null}}function ws(t){sessionStorage.setItem(Aa,JSON.stringify({id:t.id,email:t.email,nombre:t.nombre,rol:t.rol,ts:Date.now()}))}function Zm(){return!!Qm()}function e0(){sessionStorage.removeItem(Aa)}function t0({onSuccess:t}){var z;const[i,o]=F.useState("login"),[n,a]=F.useState(""),[r,s]=F.useState(""),[g,h]=F.useState(""),[b,j]=F.useState(!1),[k,v]=F.useState(""),[m,f]=F.useState(!0),[p,d]=F.useState(null),[c,l]=F.useState(null);F.useEffect(()=>{x()},[]);async function x(){f(!0);const L=new URLSearchParams(window.location.search).get("invite");if(L){const K=await Do.q("users",`invite_token=eq.${L}&estado=eq.pendiente&limit=1`);if(K&&K.length>0){d(K[0]),l(L),a(K[0].email),o("invite"),f(!1);return}}const Z=await Do.q("users","email=eq.dparra@habitaris.co&limit=1");if(Z&&Z.length>0&&!Z[0].password_hash){o("setup"),a("dparra@habitaris.co"),f(!1);return}o("login"),f(!1)}async function y(){if(v(""),!n||!r){v("Ingresa email y contrasea");return}f(!0);const T=await Do.q("users",`email=eq.${n.toLowerCase().trim()}&limit=1`);if(!T||T.length===0){v("Usuario no encontrado"),f(!1);return}const L=T[0];if(L.estado==="inactivo"){v("Cuenta desactivada. Contacta al administrador."),f(!1);return}if(!L.password_hash){v("Configura tu contrasea desde el enlace de invitacin."),f(!1);return}if(await ks(r)!==L.password_hash){v("Contrasea incorrecta"),f(!1);return}await Do.u("users",`id=eq.${L.id}`,{ultimo_login:new Date().toISOString()}),ws(L),f(!1),t()}async function u(){if(v(""),!r||r.length<6){v("Mnimo 6 caracteres");return}if(r!==g){v("No coinciden");return}f(!0);const T=await ks(r),L=await Do.q("users","email=eq.dparra@habitaris.co&limit=1");L&&L.length>0?(await Do.u("users",`id=eq.${L[0].id}`,{password_hash:T,estado:"activo",ultimo_login:new Date().toISOString()}),ws({...L[0],estado:"activo"}),window.history.replaceState({},"",window.location.pathname),f(!1),t()):(v("Error"),f(!1))}async function S(){if(v(""),!r||r.length<6){v("Mnimo 6 caracteres");return}if(r!==g){v("No coinciden");return}f(!0);const T=await ks(r);await Do.u("users",`id=eq.${p.id}`,{password_hash:T,estado:"activo",invite_token:null,ultimo_login:new Date().toISOString()}),ws({...p,estado:"activo"}),window.history.replaceState({},"",window.location.pathname),f(!1),t()}const[A,E]=F.useState("Habitaris");F.useEffect(()=>{Ee.get("habitaris_config").then(T=>{var L;try{const Z=JSON.parse(T||"{}");(L=Z.empresa)!=null&&L.nombre&&E(Z.empresa.nombre)}catch{}}).catch(()=>{})},[]);const w={width:"100%",padding:"10px 12px 10px 34px",border:`1px solid ${pt.border}`,borderRadius:8,fontSize:13,fontFamily:"'DM Sans',sans-serif",background:"#FFFFFF"},_={...w,paddingLeft:12};return m&&i==="login"?e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg,#F8F7F4,#EDEBE7)",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("style",{children:"*{box-sizing:border-box}@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');"}),e.jsx("div",{style:{color:pt.inkLight,fontSize:14},children:"Cargando..."})]}):e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg,#F8F7F4,#EDEBE7)",fontFamily:"'DM Sans',sans-serif",padding:20},children:[e.jsx("style",{children:`*{box-sizing:border-box}@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');.li:focus{outline:none;border-color:${pt.green}!important;box-shadow:0 0 0 3px ${pt.green}18}`}),e.jsxs("div",{style:{width:"100%",maxWidth:400,background:"#fff",borderRadius:16,boxShadow:"0 4px 24px rgba(0,0,0,.08)",padding:"36px 32px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("div",{style:{width:52,height:52,borderRadius:0,background:"transparent",display:"inline-flex",alignItems:"center",justifyContent:"center",marginBottom:14},children:e.jsxs("svg",{width:"52",height:"52",viewBox:"0 0 52 52",fill:"none",children:[e.jsx("rect",{x:"6",y:"8",width:"36",height:"36",stroke:"#111",strokeWidth:"1.8",fill:"none"}),e.jsx("line",{x1:"3",y1:"6",x2:"15",y2:"6",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"3",y1:"6",x2:"3",y2:"18",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"45",y1:"46",x2:"33",y2:"46",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"45",y1:"46",x2:"45",y2:"34",stroke:"#111",strokeWidth:"1.5"}),e.jsx("rect",{x:"15",y:"16",width:"6.5",height:"18",fill:"#111"}),e.jsx("rect",{x:"15",y:"23",width:"18",height:"5.5",fill:"#111"}),e.jsx("rect",{x:"26.5",y:"16",width:"6.5",height:"18",fill:"#111"})]})}),e.jsxs("h1",{style:{margin:0,fontSize:20,fontWeight:700,color:pt.ink},children:[A," ",e.jsx("span",{style:{fontWeight:300,color:pt.inkLight},children:"Suite"})]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:11,color:pt.inkLight},children:i==="setup"?"Configura tu acceso de administrador":i==="invite"?`Bienvenid@, ${p==null?void 0:p.nombre}. Configura tu contrasea`:"Acceso exclusivo para usuarios autorizados"})]}),k&&e.jsxs("div",{style:{background:pt.redBg,border:`1px solid ${pt.red}33`,borderRadius:8,padding:"8px 12px",marginBottom:14,fontSize:11,color:pt.red,display:"flex",alignItems:"center",gap:6},children:[e.jsx($t,{size:13}),k]}),i==="login"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:pt.inkMid,textTransform:"uppercase",letterSpacing:.5,display:"block",marginBottom:4},children:"Email"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(An,{size:14,color:pt.inkLight,style:{position:"absolute",left:10,top:11}}),e.jsx("input",{className:"li",value:n,onChange:T=>a(T.target.value),placeholder:"tu@email.com",type:"email",onKeyDown:T=>T.key==="Enter"&&y(),style:w})]})]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:pt.inkMid,textTransform:"uppercase",letterSpacing:.5,display:"block",marginBottom:4},children:"Contrasea"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Fd,{size:14,color:pt.inkLight,style:{position:"absolute",left:10,top:11}}),e.jsx("input",{className:"li",value:r,onChange:T=>s(T.target.value),placeholder:"",type:b?"text":"password",onKeyDown:T=>T.key==="Enter"&&y(),style:w}),e.jsx("button",{onClick:()=>j(!b),style:{position:"absolute",right:8,top:8,border:"none",background:"none",cursor:"pointer"},children:b?e.jsx(ap,{size:15,color:pt.inkLight}):e.jsx(vn,{size:15,color:pt.inkLight})})]})]}),e.jsx("button",{onClick:y,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:pt.ink,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Verificando...":"Iniciar sesin"}),e.jsx("p",{style:{textAlign:"center",marginTop:18,fontSize:10,color:pt.inkLight},children:"No tienes cuenta? Solicita acceso al administrador"})]}),i==="setup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{background:pt.amberBg,border:`1px solid ${pt.amber}33`,borderRadius:8,padding:"10px 12px",marginBottom:14,fontSize:10,color:pt.amber},children:[e.jsx("strong",{children:" Primera vez:"})," Contrasea para Super Admin (dparra@habitaris.co)"]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:pt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Email"}),e.jsx("input",{value:"dparra@habitaris.co",disabled:!0,style:{..._,background:"#f0f0f0",color:pt.inkMid}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:pt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Nueva contrasea"}),e.jsx("input",{className:"li",value:r,onChange:T=>s(T.target.value),placeholder:"Mnimo 6 caracteres",type:b?"text":"password",style:_})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:pt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Confirmar"}),e.jsx("input",{className:"li",value:g,onChange:T=>h(T.target.value),placeholder:"Repite la contrasea",type:b?"text":"password",onKeyDown:T=>T.key==="Enter"&&u(),style:_})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:14,fontSize:10,color:pt.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:b,onChange:()=>j(!b)})," Mostrar"]}),e.jsx("button",{onClick:u,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:pt.green,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Configurando...":" Crear mi cuenta"})]}),i==="invite"&&p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{background:pt.blueBg,border:`1px solid ${pt.blue}33`,borderRadius:8,padding:"10px 12px",marginBottom:14,fontSize:10,color:pt.blue},children:[e.jsx("strong",{children:""})," Invitad@ como ",e.jsx("strong",{children:(z=Xm[p.rol])==null?void 0:z.label}),". Configura tu contrasea."]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:pt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Email"}),e.jsx("input",{value:p.email,disabled:!0,style:{..._,background:"#f0f0f0",color:pt.inkMid}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:pt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Nueva contrasea"}),e.jsx("input",{className:"li",value:r,onChange:T=>s(T.target.value),placeholder:"Mnimo 6 caracteres",type:b?"text":"password",style:_})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:pt.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Confirmar"}),e.jsx("input",{className:"li",value:g,onChange:T=>h(T.target.value),placeholder:"Repite",type:b?"text":"password",onKeyDown:T=>T.key==="Enter"&&S(),style:_})]}),e.jsx("button",{onClick:S,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:pt.blue,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Configurando...":" Activar mi cuenta"})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:20,fontSize:9,color:pt.inkLight},children:[A," Suite  Acceso protegido"]})]})]})}const Gs=[{id:"dashboard",label:"Dashboard",icon:"",desc:"KPIs financieros, alertas, flujo caja, vista consolidada empresa",color:"#111111",component:Em,ready:!0},{id:"formularios",label:"Formularios",icon:"",desc:"Constructor, plantillas, lgica condicional, compartir WhatsApp/email",color:"#111111",component:Vm,ready:!0},{id:"crm",label:"CRM / Ofertas",icon:"",desc:"Ofertas, clientes, proveedores, APU, borrador y presupuesto",color:"#111111",component:nf,ready:!0},{id:"rrhh",label:"RRHH",icon:"",desc:"Equipo, cargos, partes de trabajo, asistencia y nmina",color:"#111111",component:Ef,ready:!0},{id:"herramientas",label:"Herramientas Tcnicas",icon:"",desc:"Cuadro de cargas, concreto, cubicacin, materiales, unidades",color:"#111111",component:$f,ready:!0},{id:"logistica",label:"Logstica",icon:"",desc:"Almacn, EPPs, dotaciones, herramientas, equipos, compras y proveedores",color:"#111111",component:Lf,ready:!0},{id:"compras",label:"Compras",icon:"",desc:"rdenes de compra, recepcin mercanca, evaluacin proveedores",color:"#111111",component:Cm,ready:!0},{id:"aprobaciones",label:"Aprobaciones",icon:"",desc:"Flujos de aprobacin, cadenas, umbrales y permisos por mdulo",color:"#111111",component:Vf,ready:!0},{id:"proyectos",label:"Proyectos",icon:"",desc:"Gantt, avances, seguimiento de obra y control de calidad",color:"#111111",component:Yf,ready:!0},{id:"biblioteca",label:"Biblioteca",icon:"",desc:"APUs normalizados, materiales, precios unitarios y textos tipo",color:"#111111",component:ex,ready:!0},{id:"contabilidad",label:"Contabilidad",icon:"",desc:"Facturacin, costos reales, ingresos, egresos e informes",color:"#555555",component:nx,ready:!0},{id:"sst",label:"SST",icon:"",desc:"Seguridad y salud en el trabajo, inspecciones y riesgos",color:"#111111",component:lx,ready:!0},{id:"formacion",label:"Formacin",icon:"",desc:"Cursos obligatorios y operativos, evaluaciones, certificados, control de vencimientos",color:"#111111",component:mx,ready:!0},{id:"carnets",label:"Identidad Corporativa",icon:"",desc:"Carnets, tarjetas de visita fsicas y virtuales, QR de contacto, branding del equipo",color:"#111111",component:Ix,ready:!0},{id:"firmas",label:"Firma Digital",icon:"",desc:"Firma de documentos con pad digital, trazabilidad, firmas guardadas y certificados",color:"#111111",component:Mx,ready:!0},{id:"legal",label:"Legal",icon:"",desc:"Plantillas contractuales, plizas/seguros, procesos legales, comunicaciones",color:"#111111",component:Ox,ready:!0},{id:"calidad",label:"Calidad y Auditora",icon:"",desc:"No conformidades, auditoras, protocolos, checklists e indicadores",color:"#111111",component:qx,ready:!0},{id:"postventa",label:"Postventa",icon:"",desc:"Garantas, incidencias y atencin al cliente post-entrega",color:"#111111",component:om,ready:!0},{id:"admin",label:"Administracin",icon:"",desc:"Caja chica, tarjeta corporativa, viticos, flujo empresa, CxC/CxP",color:"#111111",component:cm,ready:!0},{id:"flotas",label:"Control de Flotas",icon:"",desc:"Vehculos, kilmetros, combustible, documentacin, mantenimiento",color:"#111111",component:bm,ready:!0},{id:"config",label:"Configuracin",icon:"",desc:"Empresa, correo, WhatsApp, legal, apariencia  ajustes globales",color:"#555555",component:Bm,ready:!0}],jo={fontFamily:"'DM Sans',sans-serif"};function i0(){return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",flexDirection:"column",gap:16},children:[e.jsx("div",{style:{width:40,height:40,border:"3px solid #E4E1DB",borderTopColor:"#111111",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),e.jsx("style",{children:"@keyframes spin{to{transform:rotate(360deg)}}"}),e.jsx("p",{style:{...jo,fontSize:13,color:"#888"},children:"Cargando mdulo"})]})}function _c({lang:t,setLang:i}){return e.jsx("div",{style:{display:"flex",gap:4},children:[["es"," Espaol"],["en"," English"]].map(([o,n])=>e.jsx("button",{onClick:()=>i(o),style:{...jo,padding:"4px 10px",borderRadius:4,border:"none",cursor:"pointer",fontSize:10,fontWeight:600,background:t===o?"#111111":"rgba(255,255,255,0.12)",color:t===o?"#fff":"rgba(255,255,255,0.55)",transition:"all .15s"},children:n},o))})}function o0({onSelect:t,lang:i,setLang:o,onLogout:n}){var j;const a=Gs.filter(k=>k.ready),r=Gs.filter(k=>!k.ready),s=F.useMemo(()=>vi(),[]),g=s.apariencia||{},h=g.colorPrimario||"#111",b=g.tipografia||"DM Sans";return e.jsxs("div",{style:{minHeight:"100vh",background:"#F0EEE9"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${b.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:h,padding:"0 28px",height:52,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[g.logo?e.jsx("img",{src:g.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("span",{dangerouslySetInnerHTML:{__html:'<svg width="120" height="28" viewBox="0 0 120 28" fill="none"><rect x="3" y="4" width="20" height="20" stroke="white" strokeWidth="1.2" fill="none"/><line x1="1" y1="2.5" x2="8" y2="2.5" stroke="white" strokeWidth="1"/><line x1="1.5" y1="2.5" x2="1.5" y2="9.5" stroke="white" strokeWidth="1"/><line x1="25" y1="25.5" x2="18" y2="25.5" stroke="white" strokeWidth="1"/><line x1="24.5" y1="25.5" x2="24.5" y2="18.5" stroke="white" strokeWidth="1"/><rect x="8" y="8" width="3.5" height="11" fill="white"/><rect x="8" y="12" width="10" height="3" fill="white"/><rect x="14.5" y="8" width="3.5" height="11" fill="white"/><text x="30" y="19.5" fill="white" font-family="DM Sans, sans-serif" font-size="15" font-weight="400" letter-spacing="3">abitaris</text></svg>'}}),g.slogan&&e.jsx("span",{style:{fontFamily:`'${b}',sans-serif`,fontSize:8,letterSpacing:1.5,color:"rgba(255,255,255,.35)",textTransform:"uppercase"},children:g.slogan})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(_c,{lang:i,setLang:o}),n&&e.jsx("button",{onClick:n,style:{...jo,padding:"4px 12px",borderRadius:4,border:"1px solid rgba(255,255,255,0.15)",cursor:"pointer",fontSize:10,fontWeight:600,background:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.55)",transition:"all .15s"},onMouseEnter:k=>k.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:k=>k.currentTarget.style.background="rgba(255,255,255,0.08)",children:" Salir"})]})]}),g.colorAcento&&e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${g.colorAcento},${g.colorAcento}88,${g.colorAcento})`}}),e.jsxs("div",{style:{maxWidth:920,margin:"0 auto",padding:"48px 28px 40px"},children:[e.jsx("p",{style:{fontFamily:`'${b}',sans-serif`,fontSize:10,color:"#888",letterSpacing:1.5,textTransform:"uppercase",marginBottom:6},children:"Suite de gestin"}),e.jsx("h1",{style:{fontFamily:`'${b}',sans-serif`,fontSize:30,fontWeight:700,color:"#111",marginBottom:4,letterSpacing:-.5},children:"Selecciona un mdulo"}),e.jsxs("p",{style:{fontFamily:`'${b}',sans-serif`,fontSize:13,color:"#888",marginBottom:40},children:[((j=s.empresa)==null?void 0:j.nombre)||"Habitaris","  ",i==="es"?"Espaol":"English"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(240px,1fr))",gap:14,marginBottom:36},children:a.map(k=>e.jsxs("button",{onClick:()=>t(k.id),style:{background:"#fff",border:"1px solid #E4E1DB",borderRadius:10,padding:22,textAlign:"left",cursor:"pointer",transition:"all .15s",boxShadow:"0 1px 4px rgba(0,0,0,.06)",fontFamily:"'DM Sans',sans-serif"},onMouseEnter:v=>{v.currentTarget.style.boxShadow="0 4px 16px rgba(0,0,0,.10)",v.currentTarget.style.borderColor=k.color},onMouseLeave:v=>{v.currentTarget.style.boxShadow="0 1px 4px rgba(0,0,0,.06)",v.currentTarget.style.borderColor="#E4E1DB"},children:[e.jsx("div",{style:{fontSize:26,marginBottom:10},children:k.icon}),e.jsx("div",{style:{...jo,fontSize:14,fontWeight:700,color:"#111",marginBottom:4},children:k.label}),e.jsx("div",{style:{...jo,fontSize:11,color:"#888",lineHeight:1.5,marginBottom:12},children:k.desc}),e.jsx("div",{style:{...jo,fontSize:10,fontWeight:700,color:k.color,textTransform:"uppercase",letterSpacing:.8},children:"Abrir "})]},k.id))}),e.jsx("p",{style:{...jo,fontSize:10,color:"#AAA",letterSpacing:1.5,textTransform:"uppercase",marginBottom:10},children:"Prximamente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(190px,1fr))",gap:10},children:r.map(k=>e.jsxs("div",{style:{background:"#FAFAF8",border:"1px solid #E4E1DB",borderRadius:8,padding:"13px 15px",opacity:.6,fontFamily:"'DM Sans',sans-serif"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7,marginBottom:4},children:[e.jsx("span",{style:{fontSize:17},children:k.icon}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#555"},children:k.label})]}),e.jsx("div",{style:{fontSize:10,color:"#999",lineHeight:1.5,marginBottom:7},children:k.desc}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#AAA",textTransform:"uppercase",letterSpacing:.8},children:"En desarrollo"})]},k.id))}),e.jsx("p",{style:{...jo,marginTop:40,fontSize:11,color:"#AAA",textAlign:"center"},children:"v1.0  Habitaris S.A.S  NIT 901.922.136-8  Bogot D.C."})]})]})}function n0({mod:t,onBack:i,lang:o,setLang:n,onLogout:a}){const s=F.useMemo(()=>vi(),[]).apariencia||{},g=s.colorPrimario||"#111",h=s.tipografia||"DM Sans";return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,height:48,background:g,zIndex:1e3,display:"flex",alignItems:"center",padding:"0 18px",gap:14,fontFamily:`'${h}',sans-serif`},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${h.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsx("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:5,padding:"5px 12px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:5,cursor:"pointer",color:"rgba(255,255,255,0.65)",fontSize:12,fontWeight:500,transition:"all .15s",fontFamily:`'${h}',sans-serif`},onMouseEnter:b=>b.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:b=>b.currentTarget.style.background="rgba(255,255,255,0.1)",children:" Mdulos"}),e.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.15)"}}),e.jsx("span",{style:{fontSize:13,color:"rgba(255,255,255,0.35)"},children:t.icon}),s.logo?e.jsx("img",{src:s.logo,alt:"Logo",style:{height:22,objectFit:"contain"}}):e.jsx("span",{dangerouslySetInnerHTML:{__html:'<svg width="100" height="22" viewBox="0 0 100 22" fill="none"><rect x="2" y="3" width="16" height="16" stroke="white" strokeWidth="1" fill="none"/><line x1="0.5" y1="1.5" x2="6" y2="1.5" stroke="white" strokeWidth="0.8"/><line x1="1" y1="1.5" x2="1" y2="7" stroke="white" strokeWidth="0.8"/><line x1="19.5" y1="20.5" x2="14" y2="20.5" stroke="white" strokeWidth="0.8"/><line x1="19" y1="20.5" x2="19" y2="15" stroke="white" strokeWidth="0.8"/><rect x="6" y="6.5" width="3" height="9" fill="white"/><rect x="6" y="9.5" width="8" height="2.5" fill="white"/><rect x="11" y="6.5" width="3" height="9" fill="white"/><text x="24" y="15.5" fill="white" font-family="DM Sans, sans-serif" font-size="12" font-weight="400" letter-spacing="2.5">abitaris</text></svg>'}}),e.jsxs("span",{style:{fontSize:13,color:"rgba(255,255,255,0.4)"},children:["/ ",t.label]}),e.jsx("div",{style:{flex:1}}),e.jsx(_c,{lang:o,setLang:n}),a&&e.jsx("button",{onClick:a,style:{marginLeft:8,padding:"4px 10px",borderRadius:4,border:"1px solid rgba(255,255,255,0.15)",cursor:"pointer",fontSize:10,fontWeight:600,background:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.55)",fontFamily:`'${h}',sans-serif`,transition:"all .15s"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:b=>b.currentTarget.style.background="rgba(255,255,255,0.08)",children:" Salir"}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:2,background:`linear-gradient(90deg, ${t.color}, ${t.color}44)`}})]})}function r0(){const[t,i]=F.useState(!1),[o,n]=F.useState(()=>sessionStorage.getItem("hab:active_module")||null),[a,r]=F.useState("es"),[s,g]=F.useState(Zm());if(vr.useEffect(()=>{Ee.init("habitaris").then(()=>i(!0)).catch(()=>i(!0))},[]),!t)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"DM Sans,sans-serif",color:"#999"},children:"Cargando..."});const h=Gs.find(f=>f.id===o),b=f=>{sessionStorage.setItem("hab:active_module",f),n(f)},j=()=>{sessionStorage.removeItem("hab:active_module"),n(null)},k=()=>{e0(),g(!1)},v=window.location.pathname;if(v.startsWith("/portal"))return e.jsx(Ym,{});if(v.startsWith("/form"))return e.jsx(uh,{});if(!s)return e.jsx(t0,{onSuccess:()=>g(!0)});if(!o||!(h!=null&&h.component))return e.jsx(o0,{onSelect:b,lang:a,setLang:r,onLogout:k});const m=h.component;return e.jsxs("div",{style:{minHeight:"100vh",background:"#F0EEE9",paddingTop:48},children:[e.jsx(n0,{mod:h,onBack:j,lang:a,setLang:r,onLogout:k}),e.jsx(F.Suspense,{fallback:e.jsx(i0,{}),children:e.jsx(m,{lang:a})})]})}Es.createRoot(document.getElementById("root")).render(e.jsx(vr.StrictMode,{children:e.jsx(r0,{})}));
