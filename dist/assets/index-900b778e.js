import{r as F,a as Ac,R as hr}from"./vendor-b1791c80.js";import{createClient as Fc}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";import{L as Sn,I as Za,P as No,C as yt,T as Je,a as Ne,X as Ot,S as ki,F as Bt,b as Yi,c as gd,B as Tc,d as Xi,e as xa,A as hd,D as vn,f as ko,g as Cn,H as ir,h as La,U as fd,i as Bc,E as fn,j as Ic,k as Rc,l as Wa,m as kn,M as ms,n as fr,o as li,p as bs,q as Ri,r as xr,s as ys,t as ro,u as Vo,v as wn,w as Mc,x as zo,y as xd,z as ma,G as zn,J as _c,K as ba,Z as el,N as md,O as Dc,Q as bd,R as $c,V as Pc,W as vs,Y as yd,_ as vd,$ as jd,a0 as Oc,a1 as Lc,a2 as Sd,a3 as or,a4 as Cd,a5 as kd,a6 as wd,a7 as zd,a8 as Ed,a9 as Wc,aa as Nc,ab as Na,ac as Uc,ad as Ad,ae as Vc,af as qc,ag as Hc,ah as Gc,ai as Kc,aj as Jc,ak as Yc,al as Xc,am as Qc,an as Zc}from"./icons-c79d8dc1.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();var Fd={exports:{}},js={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ep=F,tp=Symbol.for("react.element"),ip=Symbol.for("react.fragment"),op=Object.prototype.hasOwnProperty,np=ep.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rp={key:!0,ref:!0,__self:!0,__source:!0};function Td(t,i,o){var n,s={},r=null,a=null;o!==void 0&&(r=""+o),i.key!==void 0&&(r=""+i.key),i.ref!==void 0&&(a=i.ref);for(n in i)op.call(i,n)&&!rp.hasOwnProperty(n)&&(s[n]=i[n]);if(t&&t.defaultProps)for(n in i=t.defaultProps,i)s[n]===void 0&&(s[n]=i[n]);return{$$typeof:tp,type:t,key:r,ref:a,props:s,_owner:np.current}}js.Fragment=ip;js.jsx=Td;js.jsxs=Td;Fd.exports=js;var e=Fd.exports,ya={},tl=Ac;ya.createRoot=tl.createRoot,ya.hydrateRoot=tl.hydrateRoot;function Ss(t,i){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)i.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(o[n[s]]=t[n[s]]);return o}function sp(t,i,o,n){function s(r){return r instanceof o?r:new o(function(a){a(r)})}return new(o||(o=Promise))(function(r,a){function u(j){try{b(n.next(j))}catch(C){a(C)}}function h(j){try{b(n.throw(j))}catch(C){a(C)}}function b(j){j.done?r(j.value):s(j.value).then(u,h)}b((n=n.apply(t,i||[])).next())})}const ap=t=>t?(...i)=>t(...i):(...i)=>fetch(...i);class Ua extends Error{constructor(i,o="FunctionsError",n){super(i),this.name=o,this.context=n}}class lp extends Ua{constructor(i){super("Failed to send a request to the Edge Function","FunctionsFetchError",i)}}class il extends Ua{constructor(i){super("Relay Error invoking the Edge Function","FunctionsRelayError",i)}}class ol extends Ua{constructor(i){super("Edge Function returned a non-2xx status code","FunctionsHttpError",i)}}var va;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(va||(va={}));class dp{constructor(i,{headers:o={},customFetch:n,region:s=va.Any}={}){this.url=i,this.headers=o,this.region=s,this.fetch=ap(n)}setAuth(i){this.headers.Authorization=`Bearer ${i}`}invoke(i){return sp(this,arguments,void 0,function*(o,n={}){var s;let r,a;try{const{headers:u,method:h,body:b,signal:j,timeout:C}=n;let v={},{region:m}=n;m||(m=this.region);const f=new URL(`${this.url}/${o}`);m&&m!=="any"&&(v["x-region"]=m,f.searchParams.set("forceFunctionRegion",m));let p;b&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&b instanceof Blob||b instanceof ArrayBuffer?(v["Content-Type"]="application/octet-stream",p=b):typeof b=="string"?(v["Content-Type"]="text/plain",p=b):typeof FormData<"u"&&b instanceof FormData?p=b:(v["Content-Type"]="application/json",p=JSON.stringify(b)):b&&typeof b!="string"&&!(typeof Blob<"u"&&b instanceof Blob)&&!(b instanceof ArrayBuffer)&&!(typeof FormData<"u"&&b instanceof FormData)?p=JSON.stringify(b):p=b;let c=j;C&&(a=new AbortController,r=setTimeout(()=>a.abort(),C),j?(c=a.signal,j.addEventListener("abort",()=>a.abort())):c=a.signal);const d=yield this.fetch(f.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},v),this.headers),u),body:p,signal:c}).catch(g=>{throw new lp(g)}),l=d.headers.get("x-relay-error");if(l&&l==="true")throw new il(d);if(!d.ok)throw new ol(d);let x=((s=d.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),y;return x==="application/json"?y=yield d.json():x==="application/octet-stream"||x==="application/pdf"?y=yield d.blob():x==="text/event-stream"?y=d:x==="multipart/form-data"?y=yield d.formData():y=yield d.text(),{data:y,error:null,response:d}}catch(u){return{data:null,error:u,response:u instanceof ol||u instanceof il?u.context:void 0}}finally{r&&clearTimeout(r)}})}}var cp=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},pp=class{constructor(t){var i,o,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(i=t.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=t.signal,this.isMaybeSingle=(o=t.isMaybeSingle)!==null&&o!==void 0?o:!1,this.urlLengthLimit=(n=t.urlLengthLimit)!==null&&n!==void 0?n:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,i){return this.headers=new Headers(this.headers),this.headers.set(t,i),this}then(t,i){var o=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let a=null,u=null,h=null,b=r.status,j=r.statusText;if(r.ok){var C,v;if(o.method!=="HEAD"){var m;const d=await r.text();d===""||(o.headers.get("Accept")==="text/csv"||o.headers.get("Accept")&&(!((m=o.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?u=d:u=JSON.parse(d))}const p=(C=o.headers.get("Prefer"))===null||C===void 0?void 0:C.match(/count=(exact|planned|estimated)/),c=(v=r.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");p&&c&&c.length>1&&(h=parseInt(c[1])),o.isMaybeSingle&&o.method==="GET"&&Array.isArray(u)&&(u.length>1?(a={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,b=406,j="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{var f;const p=await r.text();try{a=JSON.parse(p),Array.isArray(a)&&r.status===404&&(u=[],a=null,b=200,j="OK")}catch{r.status===404&&p===""?(b=204,j="No Content"):a={message:p}}if(a&&o.isMaybeSingle&&(!(a==null||(f=a.details)===null||f===void 0)&&f.includes("0 rows"))&&(a=null,b=200,j="OK"),a&&o.shouldThrowOnError)throw new cp(a)}return{error:a,data:u,count:h,status:b,statusText:j}});return this.shouldThrowOnError||(s=s.catch(r=>{var a;let u="",h="",b="";const j=r==null?void 0:r.cause;if(j){var C,v,m,f;const d=(C=j==null?void 0:j.message)!==null&&C!==void 0?C:"",l=(v=j==null?void 0:j.code)!==null&&v!==void 0?v:"";u=`${(m=r==null?void 0:r.name)!==null&&m!==void 0?m:"FetchError"}: ${r==null?void 0:r.message}`,u+=`

Caused by: ${(f=j==null?void 0:j.name)!==null&&f!==void 0?f:"Error"}: ${d}`,l&&(u+=` (${l})`),j!=null&&j.stack&&(u+=`
${j.stack}`)}else{var p;u=(p=r==null?void 0:r.stack)!==null&&p!==void 0?p:""}const c=this.url.toString().length;return(r==null?void 0:r.name)==="AbortError"||(r==null?void 0:r.code)==="ABORT_ERR"?(b="",h="Request was aborted (timeout or manual cancellation)",c>this.urlLengthLimit&&(h+=`. Note: Your request URL is ${c} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((j==null?void 0:j.name)==="HeadersOverflowError"||(j==null?void 0:j.code)==="UND_ERR_HEADERS_OVERFLOW")&&(b="",h="HTTP headers exceeded server limits (typically 16KB)",c>this.urlLengthLimit&&(h+=`. Your request URL is ${c} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(a=r==null?void 0:r.name)!==null&&a!==void 0?a:"FetchError"}: ${r==null?void 0:r.message}`,details:u,hint:h,code:b},data:null,count:null,status:0,statusText:""}})),s.then(t,i)}returns(){return this}overrideTypes(){return this}},up=class extends pp{select(t){let i=!1;const o=(t??"*").split("").map(n=>/\s/.test(n)&&!i?"":(n==='"'&&(i=!i),n)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:i=!0,nullsFirst:o,foreignTable:n,referencedTable:s=n}={}){const r=s?`${s}.order`:"order",a=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${a?`${a},`:""}${t}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:i,referencedTable:o=i}={}){const n=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(n,`${t}`),this}range(t,i,{foreignTable:o,referencedTable:n=o}={}){const s=typeof n>"u"?"offset":`${n}.offset`,r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(r,`${i-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:i=!1,settings:o=!1,buffers:n=!1,wal:s=!1,format:r="text"}={}){var a;const u=[t?"analyze":null,i?"verbose":null,o?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),h=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${h}"; options=${u};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const nl=new RegExp("[,()]");var sn=class extends up{eq(t,i){return this.url.searchParams.append(t,`eq.${i}`),this}neq(t,i){return this.url.searchParams.append(t,`neq.${i}`),this}gt(t,i){return this.url.searchParams.append(t,`gt.${i}`),this}gte(t,i){return this.url.searchParams.append(t,`gte.${i}`),this}lt(t,i){return this.url.searchParams.append(t,`lt.${i}`),this}lte(t,i){return this.url.searchParams.append(t,`lte.${i}`),this}like(t,i){return this.url.searchParams.append(t,`like.${i}`),this}likeAllOf(t,i){return this.url.searchParams.append(t,`like(all).{${i.join(",")}}`),this}likeAnyOf(t,i){return this.url.searchParams.append(t,`like(any).{${i.join(",")}}`),this}ilike(t,i){return this.url.searchParams.append(t,`ilike.${i}`),this}ilikeAllOf(t,i){return this.url.searchParams.append(t,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(t,i){return this.url.searchParams.append(t,`ilike(any).{${i.join(",")}}`),this}regexMatch(t,i){return this.url.searchParams.append(t,`match.${i}`),this}regexIMatch(t,i){return this.url.searchParams.append(t,`imatch.${i}`),this}is(t,i){return this.url.searchParams.append(t,`is.${i}`),this}isDistinct(t,i){return this.url.searchParams.append(t,`isdistinct.${i}`),this}in(t,i){const o=Array.from(new Set(i)).map(n=>typeof n=="string"&&nl.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`in.(${o})`),this}notIn(t,i){const o=Array.from(new Set(i)).map(n=>typeof n=="string"&&nl.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`not.in.(${o})`),this}contains(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cs.{${i.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(i)}`),this}containedBy(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cd.{${i.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(i)}`),this}rangeGt(t,i){return this.url.searchParams.append(t,`sr.${i}`),this}rangeGte(t,i){return this.url.searchParams.append(t,`nxl.${i}`),this}rangeLt(t,i){return this.url.searchParams.append(t,`sl.${i}`),this}rangeLte(t,i){return this.url.searchParams.append(t,`nxr.${i}`),this}rangeAdjacent(t,i){return this.url.searchParams.append(t,`adj.${i}`),this}overlaps(t,i){return typeof i=="string"?this.url.searchParams.append(t,`ov.${i}`):this.url.searchParams.append(t,`ov.{${i.join(",")}}`),this}textSearch(t,i,{config:o,type:n}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");const r=o===void 0?"":`(${o})`;return this.url.searchParams.append(t,`${s}fts${r}.${i}`),this}match(t){return Object.entries(t).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(t,i,o){return this.url.searchParams.append(t,`not.${i}.${o}`),this}or(t,{foreignTable:i,referencedTable:o=i}={}){const n=o?`${o}.or`:"or";return this.url.searchParams.append(n,`(${t})`),this}filter(t,i,o){return this.url.searchParams.append(t,`${i}.${o}`),this}},gp=class{constructor(t,{headers:i={},schema:o,fetch:n,urlLengthLimit:s=8e3}){this.url=t,this.headers=new Headers(i),this.schema=o,this.fetch=n,this.urlLengthLimit=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,i){const{head:o=!1,count:n}=i??{},s=o?"HEAD":"GET";let r=!1;const a=(t??"*").split("").map(b=>/\s/.test(b)&&!r?"":(b==='"'&&(r=!r),b)).join(""),{url:u,headers:h}=this.cloneRequestState();return u.searchParams.set("select",a),n&&h.append("Prefer",`count=${n}`),new sn({method:s,url:u,headers:h,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:i,defaultToNull:o=!0}={}){var n;const s="POST",{url:r,headers:a}=this.cloneRequestState();if(i&&a.append("Prefer",`count=${i}`),o||a.append("Prefer","missing=default"),Array.isArray(t)){const u=t.reduce((h,b)=>h.concat(Object.keys(b)),[]);if(u.length>0){const h=[...new Set(u)].map(b=>`"${b}"`);r.searchParams.set("columns",h.join(","))}}return new sn({method:s,url:r,headers:a,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:i,ignoreDuplicates:o=!1,count:n,defaultToNull:s=!0}={}){var r;const a="POST",{url:u,headers:h}=this.cloneRequestState();if(h.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&u.searchParams.set("on_conflict",i),n&&h.append("Prefer",`count=${n}`),s||h.append("Prefer","missing=default"),Array.isArray(t)){const b=t.reduce((j,C)=>j.concat(Object.keys(C)),[]);if(b.length>0){const j=[...new Set(b)].map(C=>`"${C}"`);u.searchParams.set("columns",j.join(","))}}return new sn({method:a,url:u,headers:h,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:i}={}){var o;const n="PATCH",{url:s,headers:r}=this.cloneRequestState();return i&&r.append("Prefer",`count=${i}`),new sn({method:n,url:s,headers:r,schema:this.schema,body:t,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var i;const o="DELETE",{url:n,headers:s}=this.cloneRequestState();return t&&s.append("Prefer",`count=${t}`),new sn({method:o,url:n,headers:s,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}};function nr(t){"@babel/helpers - typeof";return nr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},nr(t)}function hp(t,i){if(nr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(nr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function fp(t){var i=hp(t,"string");return nr(i)=="symbol"?i:i+""}function xp(t,i,o){return(i=fp(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function rl(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),o.push.apply(o,n)}return o}function wr(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?rl(Object(o),!0).forEach(function(n){xp(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):rl(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}var mp=class Bd{constructor(i,{headers:o={},schema:n,fetch:s,timeout:r,urlLengthLimit:a=8e3}={}){this.url=i,this.headers=new Headers(o),this.schemaName=n,this.urlLengthLimit=a;const u=s??globalThis.fetch;r!==void 0&&r>0?this.fetch=(h,b)=>{const j=new AbortController,C=setTimeout(()=>j.abort(),r),v=b==null?void 0:b.signal;if(v){if(v.aborted)return clearTimeout(C),u(h,b);const m=()=>{clearTimeout(C),j.abort()};return v.addEventListener("abort",m,{once:!0}),u(h,wr(wr({},b),{},{signal:j.signal})).finally(()=>{clearTimeout(C),v.removeEventListener("abort",m)})}return u(h,wr(wr({},b),{},{signal:j.signal})).finally(()=>clearTimeout(C))}:this.fetch=u}from(i){if(!i||typeof i!="string"||i.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new gp(new URL(`${this.url}/${i}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(i){return new Bd(this.url,{headers:this.headers,schema:i,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(i,o={},{head:n=!1,get:s=!1,count:r}={}){var a;let u;const h=new URL(`${this.url}/rpc/${i}`);let b;const j=m=>m!==null&&typeof m=="object"&&(!Array.isArray(m)||m.some(j)),C=n&&Object.values(o).some(j);C?(u="POST",b=o):n||s?(u=n?"HEAD":"GET",Object.entries(o).filter(([m,f])=>f!==void 0).map(([m,f])=>[m,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([m,f])=>{h.searchParams.append(m,f)})):(u="POST",b=o);const v=new Headers(this.headers);return C?v.set("Prefer",r?`count=${r},return=minimal`:"return=minimal"):r&&v.set("Prefer",`count=${r}`),new sn({method:u,url:h,headers:v,schema:this.schemaName,body:b,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}};class bp{constructor(){}static detectEnvironment(){var i;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((i=navigator.userAgent)===null||i===void 0)&&i.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const o=globalThis.process;if(o){const n=o.versions;if(n&&n.node){const s=n.node,r=parseInt(s.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const i=this.detectEnvironment();if(i.constructor)return i.constructor;let o=i.error||"WebSocket not supported in this environment.";throw i.workaround&&(o+=`

Suggested solution: ${i.workaround}`),new Error(o)}static createWebSocket(i,o){const n=this.getWebSocketConstructor();return new n(i,o)}static isWebSocketSupported(){try{const i=this.detectEnvironment();return i.type==="native"||i.type==="ws"}catch{return!1}}}const yp="2.97.0",vp=`realtime-js/${yp}`,jp="1.0.0",Id="2.0.0",sl=Id,ja=1e4,Sp=1e3,Cp=100;var bo;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(bo||(bo={}));var Vt;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Vt||(Vt={}));var Fi;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Fi||(Fi={}));var Sa;(function(t){t.websocket="websocket"})(Sa||(Sa={}));var $o;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})($o||($o={}));class kp{constructor(i){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=i??[]}encode(i,o){if(i.event===this.BROADCAST_EVENT&&!(i.payload instanceof ArrayBuffer)&&typeof i.payload.event=="string")return o(this._binaryEncodeUserBroadcastPush(i));let n=[i.join_ref,i.ref,i.topic,i.event,i.payload];return o(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(i){var o;return this._isArrayBuffer((o=i.payload)===null||o===void 0?void 0:o.payload)?this._encodeBinaryUserBroadcastPush(i):this._encodeJsonUserBroadcastPush(i)}_encodeBinaryUserBroadcastPush(i){var o,n;const s=(n=(o=i.payload)===null||o===void 0?void 0:o.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(i,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(i){var o,n;const s=(n=(o=i.payload)===null||o===void 0?void 0:o.payload)!==null&&n!==void 0?n:{},a=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(i,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(i,o,n){var s,r;const a=i.topic,u=(s=i.ref)!==null&&s!==void 0?s:"",h=(r=i.join_ref)!==null&&r!==void 0?r:"",b=i.payload.event,j=this.allowedMetadataKeys?this._pick(i.payload,this.allowedMetadataKeys):{},C=Object.keys(j).length===0?"":JSON.stringify(j);if(h.length>255)throw new Error(`joinRef length ${h.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`topic length ${a.length} exceeds maximum of 255`);if(b.length>255)throw new Error(`userEvent length ${b.length} exceeds maximum of 255`);if(C.length>255)throw new Error(`metadata length ${C.length} exceeds maximum of 255`);const v=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+u.length+a.length+b.length+C.length,m=new ArrayBuffer(this.HEADER_LENGTH+v);let f=new DataView(m),p=0;f.setUint8(p++,this.KINDS.userBroadcastPush),f.setUint8(p++,h.length),f.setUint8(p++,u.length),f.setUint8(p++,a.length),f.setUint8(p++,b.length),f.setUint8(p++,C.length),f.setUint8(p++,o),Array.from(h,d=>f.setUint8(p++,d.charCodeAt(0))),Array.from(u,d=>f.setUint8(p++,d.charCodeAt(0))),Array.from(a,d=>f.setUint8(p++,d.charCodeAt(0))),Array.from(b,d=>f.setUint8(p++,d.charCodeAt(0))),Array.from(C,d=>f.setUint8(p++,d.charCodeAt(0)));var c=new Uint8Array(m.byteLength+n.byteLength);return c.set(new Uint8Array(m),0),c.set(new Uint8Array(n),m.byteLength),c.buffer}decode(i,o){if(this._isArrayBuffer(i)){let n=this._binaryDecode(i);return o(n)}if(typeof i=="string"){const n=JSON.parse(i),[s,r,a,u,h]=n;return o({join_ref:s,ref:r,topic:a,event:u,payload:h})}return o({})}_binaryDecode(i){const o=new DataView(i),n=o.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(i,o,s)}}_decodeUserBroadcast(i,o,n){const s=o.getUint8(1),r=o.getUint8(2),a=o.getUint8(3),u=o.getUint8(4);let h=this.HEADER_LENGTH+4;const b=n.decode(i.slice(h,h+s));h=h+s;const j=n.decode(i.slice(h,h+r));h=h+r;const C=n.decode(i.slice(h,h+a));h=h+a;const v=i.slice(h,i.byteLength),m=u===this.JSON_ENCODING?JSON.parse(n.decode(v)):v,f={type:this.BROADCAST_EVENT,event:j,payload:m};return a>0&&(f.meta=JSON.parse(C)),{join_ref:null,ref:null,topic:b,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(i){var o;return i instanceof ArrayBuffer||((o=i==null?void 0:i.constructor)===null||o===void 0?void 0:o.name)==="ArrayBuffer"}_pick(i,o){return!i||typeof i!="object"?{}:Object.fromEntries(Object.entries(i).filter(([n])=>o.includes(n)))}}class Rd{constructor(i,o){this.callback=i,this.timerCalc=o,this.timer=void 0,this.tries=0,this.callback=i,this.timerCalc=o}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var It;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(It||(It={}));const al=(t,i,o={})=>{var n;const s=(n=o.skipTypes)!==null&&n!==void 0?n:[];return i?Object.keys(i).reduce((r,a)=>(r[a]=wp(a,t,i,s),r),{}):{}},wp=(t,i,o,n)=>{const s=i.find(u=>u.name===t),r=s==null?void 0:s.type,a=o[t];return r&&!n.includes(r)?Md(r,a):Ca(a)},Md=(t,i)=>{if(t.charAt(0)==="_"){const o=t.slice(1,t.length);return Fp(i,o)}switch(t){case It.bool:return zp(i);case It.float4:case It.float8:case It.int2:case It.int4:case It.int8:case It.numeric:case It.oid:return Ep(i);case It.json:case It.jsonb:return Ap(i);case It.timestamp:return Tp(i);case It.abstime:case It.date:case It.daterange:case It.int4range:case It.int8range:case It.money:case It.reltime:case It.text:case It.time:case It.timestamptz:case It.timetz:case It.tsrange:case It.tstzrange:return Ca(i);default:return Ca(i)}},Ca=t=>t,zp=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Ep=t=>{if(typeof t=="string"){const i=parseFloat(t);if(!Number.isNaN(i))return i}return t},Ap=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},Fp=(t,i)=>{if(typeof t!="string")return t;const o=t.length-1,n=t[o];if(t[0]==="{"&&n==="}"){let r;const a=t.slice(1,o);try{r=JSON.parse("["+a+"]")}catch{r=a?a.split(","):[]}return r.map(u=>Md(i,u))}return t},Tp=t=>typeof t=="string"?t.replace(" ","T"):t,_d=t=>{const i=new URL(t);return i.protocol=i.protocol.replace(/^ws/i,"http"),i.pathname=i.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),i.pathname===""||i.pathname==="/"?i.pathname="/api/broadcast":i.pathname=i.pathname+"/api/broadcast",i.href};class As{constructor(i,o,n={},s=ja){this.channel=i,this.event=o,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(i){this.timeout=i,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(i){this.payload=Object.assign(Object.assign({},this.payload),i)}receive(i,o){var n;return this._hasReceived(i)&&o((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:i,callback:o}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const i=o=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=o,this._matchReceive(o)};this.channel._on(this.refEvent,{},i),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(i,o){this.refEvent&&this.channel._trigger(this.refEvent,{status:i,response:o})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:i,response:o}){this.recHooks.filter(n=>n.status===i).forEach(n=>n.callback(o))}_hasReceived(i){return this.receivedResp&&this.receivedResp.status===i}}var ll;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(ll||(ll={}));class Gn{constructor(i,o){this.channel=i,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(o==null?void 0:o.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:r,onLeave:a,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Gn.syncState(this.state,s,r,a),this.pendingDiffs.forEach(h=>{this.state=Gn.syncDiff(this.state,h,r,a)}),this.pendingDiffs=[],u()}),this.channel._on(n.diff,{},s=>{const{onJoin:r,onLeave:a,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Gn.syncDiff(this.state,s,r,a),u())}),this.onJoin((s,r,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:r,newPresences:a})}),this.onLeave((s,r,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:r,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(i,o,n,s){const r=this.cloneDeep(i),a=this.transformState(o),u={},h={};return this.map(r,(b,j)=>{a[b]||(h[b]=j)}),this.map(a,(b,j)=>{const C=r[b];if(C){const v=j.map(c=>c.presence_ref),m=C.map(c=>c.presence_ref),f=j.filter(c=>m.indexOf(c.presence_ref)<0),p=C.filter(c=>v.indexOf(c.presence_ref)<0);f.length>0&&(u[b]=f),p.length>0&&(h[b]=p)}else u[b]=j}),this.syncDiff(r,{joins:u,leaves:h},n,s)}static syncDiff(i,o,n,s){const{joins:r,leaves:a}={joins:this.transformState(o.joins),leaves:this.transformState(o.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(r,(u,h)=>{var b;const j=(b=i[u])!==null&&b!==void 0?b:[];if(i[u]=this.cloneDeep(h),j.length>0){const C=i[u].map(m=>m.presence_ref),v=j.filter(m=>C.indexOf(m.presence_ref)<0);i[u].unshift(...v)}n(u,j,h)}),this.map(a,(u,h)=>{let b=i[u];if(!b)return;const j=h.map(C=>C.presence_ref);b=b.filter(C=>j.indexOf(C.presence_ref)<0),i[u]=b,s(u,b,h),b.length===0&&delete i[u]}),i}static map(i,o){return Object.getOwnPropertyNames(i).map(n=>o(n,i[n]))}static transformState(i){return i=this.cloneDeep(i),Object.getOwnPropertyNames(i).reduce((o,n)=>{const s=i[n];return"metas"in s?o[n]=s.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):o[n]=s,o},{})}static cloneDeep(i){return JSON.parse(JSON.stringify(i))}onJoin(i){this.caller.onJoin=i}onLeave(i){this.caller.onLeave=i}onSync(i){this.caller.onSync=i}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var dl;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(dl||(dl={}));var Kn;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Kn||(Kn={}));var to;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(to||(to={}));class cn{constructor(i,o={config:{}},n){var s,r;if(this.topic=i,this.params=o,this.socket=n,this.bindings={},this.state=Vt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=i.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},o.config),this.timeout=this.socket.timeout,this.joinPush=new As(this,Fi.join,this.params,this.timeout),this.rejoinTimer=new Rd(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Vt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Vt.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Vt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Fi.reply,{},(a,u)=>{this._trigger(this._replyEventName(u),a)}),this.presence=new Gn(this),this.broadcastEndpointURL=_d(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((r=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||r===void 0)&&r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(i,o=this.timeout){var n,s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Vt.closed){const{config:{broadcast:a,presence:u,private:h}}=this.params,b=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(m=>m.filter))!==null&&s!==void 0?s:[],j=!!this.bindings[Kn.PRESENCE]&&this.bindings[Kn.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,C={},v={broadcast:a,presence:Object.assign(Object.assign({},u),{enabled:j}),postgres_changes:b,private:h};this.socket.accessTokenValue&&(C.access_token=this.socket.accessTokenValue),this._onError(m=>i==null?void 0:i(to.CHANNEL_ERROR,m)),this._onClose(()=>i==null?void 0:i(to.CLOSED)),this.updateJoinPayload(Object.assign({config:v},C)),this.joinedOnce=!0,this._rejoin(o),this.joinPush.receive("ok",async({postgres_changes:m})=>{var f;if(this.socket._isManualToken()||this.socket.setAuth(),m===void 0){i==null||i(to.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,c=(f=p==null?void 0:p.length)!==null&&f!==void 0?f:0,d=[];for(let l=0;l<c;l++){const x=p[l],{filter:{event:y,schema:g,table:S,filter:A}}=x,E=m&&m[l];if(E&&E.event===y&&cn.isFilterValueEqual(E.schema,g)&&cn.isFilterValueEqual(E.table,S)&&cn.isFilterValueEqual(E.filter,A))d.push(Object.assign(Object.assign({},x),{id:E.id}));else{this.unsubscribe(),this.state=Vt.errored,i==null||i(to.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=d,i&&i(to.SUBSCRIBED);return}}).receive("error",m=>{this.state=Vt.errored,i==null||i(to.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{i==null||i(to.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(i,o={}){return await this.send({type:"presence",event:"track",payload:i},o.timeout||this.timeout)}async untrack(i={}){return await this.send({type:"presence",event:"untrack"},i)}on(i,o,n){return this.state===Vt.joined&&i===Kn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(i,o,n)}async httpSend(i,o,n={}){var s;if(o==null)return Promise.reject("Payload is required for httpSend()");const r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(u.status===202)return{success:!0};let h=u.statusText;try{const b=await u.json();h=b.error||b.message||h}catch{}return Promise.reject(new Error(h))}async send(i,o={}){var n,s;if(!this._canPush()&&i.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:r,payload:a}=i,u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:a,private:this.private}]})};try{const b=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(n=o.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=b.body)===null||s===void 0?void 0:s.cancel()),b.ok?"ok":"error"}catch(b){return b.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var a,u,h;const b=this._push(i.type,i,o.timeout||this.timeout);i.type==="broadcast"&&!(!((h=(u=(a=this.params)===null||a===void 0?void 0:a.config)===null||u===void 0?void 0:u.broadcast)===null||h===void 0)&&h.ack)&&r("ok"),b.receive("ok",()=>r("ok")),b.receive("error",()=>r("error")),b.receive("timeout",()=>r("timed out"))})}updateJoinPayload(i){this.joinPush.updatePayload(i)}unsubscribe(i=this.timeout){this.state=Vt.leaving;const o=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Fi.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new As(this,Fi.leave,{},i),n.receive("ok",()=>{o(),s("ok")}).receive("timeout",()=>{o(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(i=>i.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Vt.closed,this.bindings={}}async _fetchWithTimeout(i,o,n){const s=new AbortController,r=setTimeout(()=>s.abort(),n),a=await this.socket.fetch(i,Object.assign(Object.assign({},o),{signal:s.signal}));return clearTimeout(r),a}_push(i,o,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${i}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new As(this,i,o,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(i){if(i.startTimeout(),this.pushBuffer.push(i),this.pushBuffer.length>Cp){const o=this.pushBuffer.shift();o&&(o.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${o.event}`,o.payload))}}_onMessage(i,o,n){return o}_isMember(i){return this.topic===i}_joinRef(){return this.joinPush.ref}_trigger(i,o,n){var s,r;const a=i.toLocaleLowerCase(),{close:u,error:h,leave:b,join:j}=Fi;if(n&&[u,h,b,j].indexOf(a)>=0&&n!==this._joinRef())return;let v=this._onMessage(a,o,n);if(o&&!v)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(m=>{var f,p,c;return((f=m.filter)===null||f===void 0?void 0:f.event)==="*"||((c=(p=m.filter)===null||p===void 0?void 0:p.event)===null||c===void 0?void 0:c.toLocaleLowerCase())===a}).map(m=>m.callback(v,n)):(r=this.bindings[a])===null||r===void 0||r.filter(m=>{var f,p,c,d,l,x;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const y=m.id,g=(f=m.filter)===null||f===void 0?void 0:f.event;return y&&((p=o.ids)===null||p===void 0?void 0:p.includes(y))&&(g==="*"||(g==null?void 0:g.toLocaleLowerCase())===((c=o.data)===null||c===void 0?void 0:c.type.toLocaleLowerCase()))}else{const y=(l=(d=m==null?void 0:m.filter)===null||d===void 0?void 0:d.event)===null||l===void 0?void 0:l.toLocaleLowerCase();return y==="*"||y===((x=o==null?void 0:o.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof v=="object"&&"ids"in v){const f=v.data,{schema:p,table:c,commit_timestamp:d,type:l,errors:x}=f;v=Object.assign(Object.assign({},{schema:p,table:c,commit_timestamp:d,eventType:l,new:{},old:{},errors:x}),this._getPayloadRecords(f))}m.callback(v,n)})}_isClosed(){return this.state===Vt.closed}_isJoined(){return this.state===Vt.joined}_isJoining(){return this.state===Vt.joining}_isLeaving(){return this.state===Vt.leaving}_replyEventName(i){return`chan_reply_${i}`}_on(i,o,n){const s=i.toLocaleLowerCase(),r={type:s,filter:o,callback:n};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}_off(i,o){const n=i.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var r;return!(((r=s.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&cn.isEqual(s.filter,o))})),this}static isEqual(i,o){if(Object.keys(i).length!==Object.keys(o).length)return!1;for(const n in i)if(i[n]!==o[n])return!1;return!0}static isFilterValueEqual(i,o){return(i??void 0)===(o??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(i){this._on(Fi.close,{},i)}_onError(i){this._on(Fi.error,{},o=>i(o))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(i=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Vt.joining,this.joinPush.resend(i))}_getPayloadRecords(i){const o={new:{},old:{}};return(i.type==="INSERT"||i.type==="UPDATE")&&(o.new=al(i.columns,i.record)),(i.type==="UPDATE"||i.type==="DELETE")&&(o.old=al(i.columns,i.old_record)),o}}const Fs=()=>{},zr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Bp=[1e3,2e3,5e3,1e4],Ip=1e4,Rp=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Mp{constructor(i,o){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ja,this.transport=null,this.heartbeatIntervalMs=zr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Fs,this.ref=0,this.reconnectTimer=null,this.vsn=sl,this.logger=Fs,this.conn=null,this.sendBuffer=[],this.serializer=new kp,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=s=>s?(...r)=>s(...r):(...r)=>fetch(...r),!(!((n=o==null?void 0:o.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=o.params.apikey,this.endPoint=`${i}/${Sa.websocket}`,this.httpEndpoint=_d(i),this._initializeOptions(o),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(o==null?void 0:o.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=bp.createWebSocket(this.endpointURL())}catch(i){this._setConnectionState("disconnected");const o=i.message;throw o.includes("Node.js")?new Error(`${o}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${o}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(i,o){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(i?this.conn.close(i,o??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(i){const o=await i.unsubscribe();return this.channels.length===0&&this.disconnect(),o}async removeAllChannels(){const i=await Promise.all(this.channels.map(o=>o.unsubscribe()));return this.channels=[],this.disconnect(),i}log(i,o,n){this.logger(i,o,n)}connectionState(){switch(this.conn&&this.conn.readyState){case bo.connecting:return $o.Connecting;case bo.open:return $o.Open;case bo.closing:return $o.Closing;default:return $o.Closed}}isConnected(){return this.connectionState()===$o.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(i,o={config:{}}){const n=`realtime:${i}`,s=this.getChannels().find(r=>r.topic===n);if(s)return s;{const r=new cn(`realtime:${i}`,o,this);return this.channels.push(r),r}}push(i){const{topic:o,event:n,payload:s,ref:r}=i,a=()=>{this.encode(i,u=>{var h;(h=this.conn)===null||h===void 0||h.send(u)})};this.log("push",`${o} ${n} (${r})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(i=null){this._authPromise=this._performAuth(i);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var i;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(o){this.log("error","error in heartbeat callback",o)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(o){this.log("error","error in heartbeat callback",o)}this._wasManualDisconnect=!1,(i=this.conn)===null||i===void 0||i.close(Sp,"heartbeat timeout"),setTimeout(()=>{var o;this.isConnected()||(o=this.reconnectTimer)===null||o===void 0||o.scheduleTimeout()},zr.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(o){this.log("error","error in heartbeat callback",o)}this._setAuthSafely("heartbeat")}onHeartbeat(i){this.heartbeatCallback=i}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(i=>i()),this.sendBuffer=[])}_makeRef(){let i=this.ref+1;return i===this.ref?this.ref=0:this.ref=i,this.ref.toString()}_leaveOpenTopic(i){let o=this.channels.find(n=>n.topic===i&&(n._isJoined()||n._isJoining()));o&&(this.log("transport",`leaving duplicate topic "${i}"`),o.unsubscribe())}_remove(i){this.channels=this.channels.filter(o=>o.topic!==i.topic)}_onConnMessage(i){this.decode(i.data,o=>{if(o.topic==="phoenix"&&o.event==="phx_reply"&&o.ref&&o.ref===this.pendingHeartbeatRef){const b=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(o.payload.status==="ok"?"ok":"error",b)}catch(j){this.log("error","error in heartbeat callback",j)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:s,payload:r,ref:a}=o,u=a?`(${a})`:"",h=r.status||"";this.log("receive",`${h} ${n} ${s} ${u}`.trim(),r),this.channels.filter(b=>b._isMember(n)).forEach(b=>b._trigger(s,r,a)),this._triggerStateCallbacks("message",o)})}_clearTimer(i){var o;i==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):i==="reconnect"&&((o=this.reconnectTimer)===null||o===void 0||o.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=i=>this._onConnError(i),this.conn.onmessage=i=>this._onConnMessage(i),this.conn.onclose=i=>this._onConnClose(i),this.conn.readyState===bo.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===bo.open||this.conn.readyState===bo.connecting)try{this.conn.close()}catch(i){this.log("error","Error closing connection",i)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(i=>i.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(o=>{this.log("error","error waiting for auth on connect",o),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const i=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(i),this.workerRef.onerror=o=>{this.log("worker","worker error",o.message),this._terminateWorker()},this.workerRef.onmessage=o=>{o.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(i){var o;this._setConnectionState("disconnected"),this.log("transport","close",i),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(o=this.reconnectTimer)===null||o===void 0||o.scheduleTimeout(),this._triggerStateCallbacks("close",i)}_onConnError(i){this._setConnectionState("disconnected"),this.log("transport",`${i}`),this._triggerChanError(),this._triggerStateCallbacks("error",i);try{this.heartbeatCallback("error")}catch(o){this.log("error","error in heartbeat callback",o)}}_triggerChanError(){this.channels.forEach(i=>i._trigger(Fi.error))}_appendParams(i,o){if(Object.keys(o).length===0)return i;const n=i.match(/\?/)?"&":"?",s=new URLSearchParams(o);return`${i}${n}${s}`}_workerObjectUrl(i){let o;if(i)o=i;else{const n=new Blob([Rp],{type:"application/javascript"});o=URL.createObjectURL(n)}return o}_setConnectionState(i,o=!1){this._connectionState=i,i==="connecting"?this._wasManualDisconnect=!1:i==="disconnecting"&&(this._wasManualDisconnect=o)}async _performAuth(i=null){let o,n=!1;if(i)o=i,n=!0;else if(this.accessToken)try{o=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),o=this.accessTokenValue}else o=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=o&&(this.accessTokenValue=o,this.channels.forEach(s=>{const r={access_token:o,version:vp};o&&s.updateJoinPayload(r),s.joinedOnce&&s._isJoined()&&s._push(Fi.access_token,{access_token:o})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(i="general"){this._isManualToken()||this.setAuth().catch(o=>{this.log("error",`Error setting auth in ${i}`,o)})}_triggerStateCallbacks(i,o){try{this.stateChangeCallbacks[i].forEach(n=>{try{n(o)}catch(s){this.log("error",`error in ${i} callback`,s)}})}catch(n){this.log("error",`error triggering ${i} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Rd(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},zr.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(i){var o,n,s,r,a,u,h,b,j,C,v,m;switch(this.transport=(o=i==null?void 0:i.transport)!==null&&o!==void 0?o:null,this.timeout=(n=i==null?void 0:i.timeout)!==null&&n!==void 0?n:ja,this.heartbeatIntervalMs=(s=i==null?void 0:i.heartbeatIntervalMs)!==null&&s!==void 0?s:zr.HEARTBEAT_INTERVAL,this.worker=(r=i==null?void 0:i.worker)!==null&&r!==void 0?r:!1,this.accessToken=(a=i==null?void 0:i.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(u=i==null?void 0:i.heartbeatCallback)!==null&&u!==void 0?u:Fs,this.vsn=(h=i==null?void 0:i.vsn)!==null&&h!==void 0?h:sl,i!=null&&i.params&&(this.params=i.params),i!=null&&i.logger&&(this.logger=i.logger),(i!=null&&i.logLevel||i!=null&&i.log_level)&&(this.logLevel=i.logLevel||i.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(b=i==null?void 0:i.reconnectAfterMs)!==null&&b!==void 0?b:f=>Bp[f-1]||Ip,this.vsn){case jp:this.encode=(j=i==null?void 0:i.encode)!==null&&j!==void 0?j:(f,p)=>p(JSON.stringify(f)),this.decode=(C=i==null?void 0:i.decode)!==null&&C!==void 0?C:(f,p)=>p(JSON.parse(f));break;case Id:this.encode=(v=i==null?void 0:i.encode)!==null&&v!==void 0?v:this.serializer.encode.bind(this.serializer),this.decode=(m=i==null?void 0:i.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=i==null?void 0:i.workerUrl}}}var rr=class extends Error{constructor(t,i){var o;super(t),this.name="IcebergError",this.status=i.status,this.icebergType=i.icebergType,this.icebergCode=i.icebergCode,this.details=i.details,this.isCommitStateUnknown=i.icebergType==="CommitStateUnknownException"||[500,502,504].includes(i.status)&&((o=i.icebergType)==null?void 0:o.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function _p(t,i,o){const n=new URL(i,t);if(o)for(const[s,r]of Object.entries(o))r!==void 0&&n.searchParams.set(s,r);return n.toString()}async function Dp(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function $p(t){const i=t.fetchImpl??globalThis.fetch;return{async request({method:o,path:n,query:s,body:r,headers:a}){const u=_p(t.baseUrl,n,s),h=await Dp(t.auth),b=await i(u,{method:o,headers:{...r?{"Content-Type":"application/json"}:{},...h,...a},body:r?JSON.stringify(r):void 0}),j=await b.text(),C=(b.headers.get("content-type")||"").includes("application/json"),v=C&&j?JSON.parse(j):j;if(!b.ok){const m=C?v:void 0,f=m==null?void 0:m.error;throw new rr((f==null?void 0:f.message)??`Request failed with status ${b.status}`,{status:b.status,icebergType:f==null?void 0:f.type,icebergCode:f==null?void 0:f.code,details:m})}return{status:b.status,headers:b.headers,data:v}}}}function Er(t){return t.join("")}var Pp=class{constructor(t,i=""){this.client=t,this.prefix=i}async listNamespaces(t){const i=t?{parent:Er(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:i})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(t,i){const o={namespace:t.namespace,properties:i==null?void 0:i.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:o})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Er(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Er(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Er(t.namespace)}`}),!0}catch(i){if(i instanceof rr&&i.status===404)return!1;throw i}}async createNamespaceIfNotExists(t,i){try{return await this.createNamespace(t,i)}catch(o){if(o instanceof rr&&o.status===409)return;throw o}}};function Ho(t){return t.join("")}var Op=class{constructor(t,i="",o){this.client=t,this.prefix=i,this.accessDelegation=o}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables`})).data.identifiers}async createTable(t,i){const o={};return this.accessDelegation&&(o["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables`,body:i,headers:o})).data.metadata}async updateTable(t,i){const o=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables/${t.name}`,body:i});return{"metadata-location":o.data["metadata-location"],metadata:o.data.metadata}}async dropTable(t,i){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((i==null?void 0:i.purge)??!1)}})}async loadTable(t){const i={};return this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables/${t.name}`,headers:i})).data.metadata}async tableExists(t){const i={};this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ho(t.namespace)}/tables/${t.name}`,headers:i}),!0}catch(o){if(o instanceof rr&&o.status===404)return!1;throw o}}async createTableIfNotExists(t,i){try{return await this.createTable(t,i)}catch(o){if(o instanceof rr&&o.status===409)return await this.loadTable({namespace:t.namespace,name:i.name});throw o}}},Lp=class{constructor(t){var n;let i="v1";t.catalogName&&(i+=`/${t.catalogName}`);const o=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=$p({baseUrl:o,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(n=t.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new Pp(this.client,i),this.tableOps=new Op(this.client,i,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,i){return this.namespaceOps.createNamespace(t,i)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,i){return this.tableOps.createTable(t,i)}async updateTable(t,i){return this.tableOps.updateTable(t,i)}async dropTable(t,i){await this.tableOps.dropTable(t,i)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,i){return this.namespaceOps.createNamespaceIfNotExists(t,i)}async createTableIfNotExists(t,i){return this.tableOps.createTableIfNotExists(t,i)}},Cs=class extends Error{constructor(t,i="storage",o,n){super(t),this.__isStorageError=!0,this.namespace=i,this.name=i==="vectors"?"StorageVectorsError":"StorageError",this.status=o,this.statusCode=n}};function ks(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var Ar=class extends Cs{constructor(t,i,o,n="storage"){super(t,n,i,o),this.name=n==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=i,this.statusCode=o}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Dd=class extends Cs{constructor(t,i,o="storage"){super(t,o),this.name=o==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=i}};const Wp=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),Np=t=>{if(typeof t!="object"||t===null)return!1;const i=Object.getPrototypeOf(t);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},ka=t=>{if(Array.isArray(t))return t.map(o=>ka(o));if(typeof t=="function"||t!==Object(t))return t;const i={};return Object.entries(t).forEach(([o,n])=>{const s=o.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));i[s]=ka(n)}),i},Up=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function sr(t){"@babel/helpers - typeof";return sr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},sr(t)}function Vp(t,i){if(sr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(sr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function qp(t){var i=Vp(t,"string");return sr(i)=="symbol"?i:i+""}function Hp(t,i,o){return(i=qp(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function cl(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),o.push.apply(o,n)}return o}function lt(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?cl(Object(o),!0).forEach(function(n){Hp(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):cl(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}const pl=t=>{var i;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(i=t.error)===null||i===void 0?void 0:i.message)||JSON.stringify(t)},Gp=async(t,i,o,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(o!=null&&o.noResolveJson)){const s=t,r=s.status||500;if(typeof s.json=="function")s.json().then(a=>{const u=(a==null?void 0:a.statusCode)||(a==null?void 0:a.code)||r+"";i(new Ar(pl(a),r,u,n))}).catch(()=>{if(n==="vectors"){const a=r+"";i(new Ar(s.statusText||`HTTP ${r} error`,r,a,n))}else{const a=r+"";i(new Ar(s.statusText||`HTTP ${r} error`,r,a,n))}});else{const a=r+"";i(new Ar(s.statusText||`HTTP ${r} error`,r,a,n))}}else i(new Dd(pl(t),t,n))},Kp=(t,i,o,n)=>{const s={method:t,headers:(i==null?void 0:i.headers)||{}};return t==="GET"||t==="HEAD"||!n?lt(lt({},s),o):(Np(n)?(s.headers=lt({"Content-Type":"application/json"},i==null?void 0:i.headers),s.body=JSON.stringify(n)):s.body=n,i!=null&&i.duplex&&(s.duplex=i.duplex),lt(lt({},s),o))};async function Bn(t,i,o,n,s,r,a){return new Promise((u,h)=>{t(o,Kp(i,n,s,r)).then(b=>{if(!b.ok)throw b;if(n!=null&&n.noResolveJson)return b;if(a==="vectors"){const j=b.headers.get("content-type");if(b.headers.get("content-length")==="0"||b.status===204)return{};if(!j||!j.includes("application/json"))return{}}return b.json()}).then(b=>u(b)).catch(b=>Gp(b,h,n,a))})}function $d(t="storage"){return{get:async(i,o,n,s)=>Bn(i,"GET",o,n,s,void 0,t),post:async(i,o,n,s,r)=>Bn(i,"POST",o,s,r,n,t),put:async(i,o,n,s,r)=>Bn(i,"PUT",o,s,r,n,t),head:async(i,o,n,s)=>Bn(i,"HEAD",o,lt(lt({},n),{},{noResolveJson:!0}),s,void 0,t),remove:async(i,o,n,s,r)=>Bn(i,"DELETE",o,s,r,n,t)}}const Jp=$d("storage"),{get:ar,post:Ai,put:wa,head:Yp,remove:Va}=Jp,fi=$d("vectors");var En=class{constructor(t,i={},o,n="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=i,this.fetch=Wp(o),this.namespace=n}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,i){return this.headers=lt(lt({},this.headers),{},{[t]:i}),this}async handleOperation(t){var i=this;try{return{data:await t(),error:null}}catch(o){if(i.shouldThrowOnError)throw o;if(ks(o))return{data:null,error:o};throw o}}},Xp=class{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i}then(t,i){return this.execute().then(t,i)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ks(i))return{data:null,error:i};throw i}}};let Pd;Pd=Symbol.toStringTag;var Qp=class{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i,this[Pd]="BlobDownloadBuilder",this.promise=null}asStream(){return new Xp(this.downloadFn,this.shouldThrowOnError)}then(t,i){return this.getPromise().then(t,i)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(ks(i))return{data:null,error:i};throw i}}};const Zp={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ul={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var eu=class extends En{constructor(t,i={},o,n){super(t,i,n,"storage"),this.bucketId=o}async uploadOrUpdate(t,i,o,n){var s=this;return s.handleOperation(async()=>{let r;const a=lt(lt({},ul),n);let u=lt(lt({},s.headers),t==="POST"&&{"x-upsert":String(a.upsert)});const h=a.metadata;typeof Blob<"u"&&o instanceof Blob?(r=new FormData,r.append("cacheControl",a.cacheControl),h&&r.append("metadata",s.encodeMetadata(h)),r.append("",o)):typeof FormData<"u"&&o instanceof FormData?(r=o,r.has("cacheControl")||r.append("cacheControl",a.cacheControl),h&&!r.has("metadata")&&r.append("metadata",s.encodeMetadata(h))):(r=o,u["cache-control"]=`max-age=${a.cacheControl}`,u["content-type"]=a.contentType,h&&(u["x-metadata"]=s.toBase64(s.encodeMetadata(h))),(typeof ReadableStream<"u"&&r instanceof ReadableStream||r&&typeof r=="object"&&"pipe"in r&&typeof r.pipe=="function")&&!a.duplex&&(a.duplex="half")),n!=null&&n.headers&&(u=lt(lt({},u),n.headers));const b=s._removeEmptyFolders(i),j=s._getFinalPath(b),C=await(t=="PUT"?wa:Ai)(s.fetch,`${s.url}/object/${j}`,r,lt({headers:u},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{path:b,id:C.Id,fullPath:C.Key}})}async upload(t,i,o){return this.uploadOrUpdate("POST",t,i,o)}async uploadToSignedUrl(t,i,o,n){var s=this;const r=s._removeEmptyFolders(t),a=s._getFinalPath(r),u=new URL(s.url+`/object/upload/sign/${a}`);return u.searchParams.set("token",i),s.handleOperation(async()=>{let h;const b=lt({upsert:ul.upsert},n),j=lt(lt({},s.headers),{"x-upsert":String(b.upsert)});return typeof Blob<"u"&&o instanceof Blob?(h=new FormData,h.append("cacheControl",b.cacheControl),h.append("",o)):typeof FormData<"u"&&o instanceof FormData?(h=o,h.append("cacheControl",b.cacheControl)):(h=o,j["cache-control"]=`max-age=${b.cacheControl}`,j["content-type"]=b.contentType),{path:r,fullPath:(await wa(s.fetch,u.toString(),h,{headers:j})).Key}})}async createSignedUploadUrl(t,i){var o=this;return o.handleOperation(async()=>{let n=o._getFinalPath(t);const s=lt({},o.headers);i!=null&&i.upsert&&(s["x-upsert"]="true");const r=await Ai(o.fetch,`${o.url}/object/upload/sign/${n}`,{},{headers:s}),a=new URL(o.url+r.url),u=a.searchParams.get("token");if(!u)throw new Cs("No token returned by API");return{signedUrl:a.toString(),path:t,token:u}})}async update(t,i,o){return this.uploadOrUpdate("PUT",t,i,o)}async move(t,i,o){var n=this;return n.handleOperation(async()=>await Ai(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:t,destinationKey:i,destinationBucket:o==null?void 0:o.destinationBucket},{headers:n.headers}))}async copy(t,i,o){var n=this;return n.handleOperation(async()=>({path:(await Ai(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:t,destinationKey:i,destinationBucket:o==null?void 0:o.destinationBucket},{headers:n.headers})).Key}))}async createSignedUrl(t,i,o){var n=this;return n.handleOperation(async()=>{let s=n._getFinalPath(t),r=await Ai(n.fetch,`${n.url}/object/sign/${s}`,lt({expiresIn:i},o!=null&&o.transform?{transform:o.transform}:{}),{headers:n.headers});const a=o!=null&&o.download?`&download=${o.download===!0?"":o.download}`:"";return{signedUrl:encodeURI(`${n.url}${r.signedURL}${a}`)}})}async createSignedUrls(t,i,o){var n=this;return n.handleOperation(async()=>{const s=await Ai(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:i,paths:t},{headers:n.headers}),r=o!=null&&o.download?`&download=${o.download===!0?"":o.download}`:"";return s.map(a=>lt(lt({},a),{},{signedUrl:a.signedURL?encodeURI(`${n.url}${a.signedURL}${r}`):null}))})}download(t,i,o){const n=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),r=s?`?${s}`:"",a=this._getFinalPath(t),u=()=>ar(this.fetch,`${this.url}/${n}/${a}${r}`,{headers:this.headers,noResolveJson:!0},o);return new Qp(u,this.shouldThrowOnError)}async info(t){var i=this;const o=i._getFinalPath(t);return i.handleOperation(async()=>ka(await ar(i.fetch,`${i.url}/object/info/${o}`,{headers:i.headers})))}async exists(t){var i=this;const o=i._getFinalPath(t);try{return await Yp(i.fetch,`${i.url}/object/${o}`,{headers:i.headers}),{data:!0,error:null}}catch(n){if(i.shouldThrowOnError)throw n;if(ks(n)&&n instanceof Dd){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}}getPublicUrl(t,i){const o=this._getFinalPath(t),n=[],s=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";s!==""&&n.push(s);const r=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});a!==""&&n.push(a);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${o}${u}`)}}}async remove(t){var i=this;return i.handleOperation(async()=>await Va(i.fetch,`${i.url}/object/${i.bucketId}`,{prefixes:t},{headers:i.headers}))}async list(t,i,o){var n=this;return n.handleOperation(async()=>{const s=lt(lt(lt({},Zp),i),{},{prefix:t||""});return await Ai(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},o)})}async listV2(t,i){var o=this;return o.handleOperation(async()=>{const n=lt({},t);return await Ai(o.fetch,`${o.url}/object/list-v2/${o.bucketId}`,n,{headers:o.headers},i)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const i=[];return t.width&&i.push(`width=${t.width}`),t.height&&i.push(`height=${t.height}`),t.resize&&i.push(`resize=${t.resize}`),t.format&&i.push(`format=${t.format}`),t.quality&&i.push(`quality=${t.quality}`),i.join("&")}};const tu="2.97.0",mr={"X-Client-Info":`storage-js/${tu}`};var iu=class extends En{constructor(t,i={},o,n){const s=new URL(t);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase."));const r=s.href.replace(/\/$/,""),a=lt(lt({},mr),i);super(r,a,o,"storage")}async listBuckets(t){var i=this;return i.handleOperation(async()=>{const o=i.listBucketOptionsToQueryString(t);return await ar(i.fetch,`${i.url}/bucket${o}`,{headers:i.headers})})}async getBucket(t){var i=this;return i.handleOperation(async()=>await ar(i.fetch,`${i.url}/bucket/${t}`,{headers:i.headers}))}async createBucket(t,i={public:!1}){var o=this;return o.handleOperation(async()=>await Ai(o.fetch,`${o.url}/bucket`,{id:t,name:t,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:o.headers}))}async updateBucket(t,i){var o=this;return o.handleOperation(async()=>await wa(o.fetch,`${o.url}/bucket/${t}`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:o.headers}))}async emptyBucket(t){var i=this;return i.handleOperation(async()=>await Ai(i.fetch,`${i.url}/bucket/${t}/empty`,{},{headers:i.headers}))}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await Va(i.fetch,`${i.url}/bucket/${t}`,{},{headers:i.headers}))}listBucketOptionsToQueryString(t){const i={};return t&&("limit"in t&&(i.limit=String(t.limit)),"offset"in t&&(i.offset=String(t.offset)),t.search&&(i.search=t.search),t.sortColumn&&(i.sortColumn=t.sortColumn),t.sortOrder&&(i.sortOrder=t.sortOrder)),Object.keys(i).length>0?"?"+new URLSearchParams(i).toString():""}},ou=class extends En{constructor(t,i={},o){const n=t.replace(/\/$/,""),s=lt(lt({},mr),i);super(n,s,o,"storage")}async createBucket(t){var i=this;return i.handleOperation(async()=>await Ai(i.fetch,`${i.url}/bucket`,{name:t},{headers:i.headers}))}async listBuckets(t){var i=this;return i.handleOperation(async()=>{const o=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&o.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&o.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&o.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&o.set("sortOrder",t.sortOrder),t!=null&&t.search&&o.set("search",t.search);const n=o.toString(),s=n?`${i.url}/bucket?${n}`:`${i.url}/bucket`;return await ar(i.fetch,s,{headers:i.headers})})}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await Va(i.fetch,`${i.url}/bucket/${t}`,{},{headers:i.headers}))}from(t){var i=this;if(!Up(t))throw new Cs("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const o=new Lp({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>i.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(o,{get(s,r){const a=s[r];return typeof a!="function"?a:async(...u)=>{try{return{data:await a.apply(s,u),error:null}}catch(h){if(n)throw h;return{data:null,error:h}}}}})}},nu=class extends En{constructor(t,i={},o){const n=t.replace(/\/$/,""),s=lt(lt({},mr),{},{"Content-Type":"application/json"},i);super(n,s,o,"vectors")}async createIndex(t){var i=this;return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/CreateIndex`,t,{headers:i.headers})||{})}async getIndex(t,i){var o=this;return o.handleOperation(async()=>await fi.post(o.fetch,`${o.url}/GetIndex`,{vectorBucketName:t,indexName:i},{headers:o.headers}))}async listIndexes(t){var i=this;return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/ListIndexes`,t,{headers:i.headers}))}async deleteIndex(t,i){var o=this;return o.handleOperation(async()=>await fi.post(o.fetch,`${o.url}/DeleteIndex`,{vectorBucketName:t,indexName:i},{headers:o.headers})||{})}},ru=class extends En{constructor(t,i={},o){const n=t.replace(/\/$/,""),s=lt(lt({},mr),{},{"Content-Type":"application/json"},i);super(n,s,o,"vectors")}async putVectors(t){var i=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/PutVectors`,t,{headers:i.headers})||{})}async getVectors(t){var i=this;return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/GetVectors`,t,{headers:i.headers}))}async listVectors(t){var i=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/ListVectors`,t,{headers:i.headers}))}async queryVectors(t){var i=this;return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/QueryVectors`,t,{headers:i.headers}))}async deleteVectors(t){var i=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/DeleteVectors`,t,{headers:i.headers})||{})}},su=class extends En{constructor(t,i={},o){const n=t.replace(/\/$/,""),s=lt(lt({},mr),{},{"Content-Type":"application/json"},i);super(n,s,o,"vectors")}async createBucket(t){var i=this;return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:i.headers})||{})}async getBucket(t){var i=this;return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/GetVectorBucket`,{vectorBucketName:t},{headers:i.headers}))}async listBuckets(t={}){var i=this;return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/ListVectorBuckets`,t,{headers:i.headers}))}async deleteBucket(t){var i=this;return i.handleOperation(async()=>await fi.post(i.fetch,`${i.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:i.headers})||{})}},au=class extends su{constructor(t,i={}){super(t,i.headers||{},i.fetch)}from(t){return new lu(this.url,this.headers,t,this.fetch)}async createBucket(t){var i=()=>super.createBucket,o=this;return i().call(o,t)}async getBucket(t){var i=()=>super.getBucket,o=this;return i().call(o,t)}async listBuckets(t={}){var i=()=>super.listBuckets,o=this;return i().call(o,t)}async deleteBucket(t){var i=()=>super.deleteBucket,o=this;return i().call(o,t)}},lu=class extends nu{constructor(t,i,o,n){super(t,i,n),this.vectorBucketName=o}async createIndex(t){var i=()=>super.createIndex,o=this;return i().call(o,lt(lt({},t),{},{vectorBucketName:o.vectorBucketName}))}async listIndexes(t={}){var i=()=>super.listIndexes,o=this;return i().call(o,lt(lt({},t),{},{vectorBucketName:o.vectorBucketName}))}async getIndex(t){var i=()=>super.getIndex,o=this;return i().call(o,o.vectorBucketName,t)}async deleteIndex(t){var i=()=>super.deleteIndex,o=this;return i().call(o,o.vectorBucketName,t)}index(t){return new du(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},du=class extends ru{constructor(t,i,o,n,s){super(t,i,s),this.vectorBucketName=o,this.indexName=n}async putVectors(t){var i=()=>super.putVectors,o=this;return i().call(o,lt(lt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async getVectors(t){var i=()=>super.getVectors,o=this;return i().call(o,lt(lt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async listVectors(t={}){var i=()=>super.listVectors,o=this;return i().call(o,lt(lt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async queryVectors(t){var i=()=>super.queryVectors,o=this;return i().call(o,lt(lt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}async deleteVectors(t){var i=()=>super.deleteVectors,o=this;return i().call(o,lt(lt({},t),{},{vectorBucketName:o.vectorBucketName,indexName:o.indexName}))}},cu=class extends iu{constructor(t,i={},o,n){super(t,i,o,n)}from(t){return new eu(this.url,this.headers,t,this.fetch)}get vectors(){return new au(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new ou(this.url+"/iceberg",this.headers,this.fetch)}};const Od="2.97.0",an=30*1e3,za=3,Ts=za*an,pu="http://localhost:9999",uu="supabase.auth.token",gu={"X-Client-Info":`gotrue-js/${Od}`},Ea="X-Supabase-Api-Version",Ld={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},hu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,fu=10*60*1e3;class lr extends Error{constructor(i,o,n){super(i),this.__isAuthError=!0,this.name="AuthError",this.status=o,this.code=n}}function Ze(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class xu extends lr{constructor(i,o,n){super(i,o,n),this.name="AuthApiError",this.status=o,this.code=n}}function mu(t){return Ze(t)&&t.name==="AuthApiError"}class Po extends lr{constructor(i,o){super(i),this.name="AuthUnknownError",this.originalError=o}}class po extends lr{constructor(i,o,n,s){super(i,n,s),this.name=o,this.status=n}}class gi extends po{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Bs(t){return Ze(t)&&t.name==="AuthSessionMissingError"}class Go extends po{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Fr extends po{constructor(i){super(i,"AuthInvalidCredentialsError",400,void 0)}}class Tr extends po{constructor(i,o=null){super(i,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function bu(t){return Ze(t)&&t.name==="AuthImplicitGrantRedirectError"}class gl extends po{constructor(i,o=null){super(i,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class yu extends po{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Aa extends po{constructor(i,o){super(i,"AuthRetryableFetchError",o,void 0)}}function Is(t){return Ze(t)&&t.name==="AuthRetryableFetchError"}class hl extends po{constructor(i,o,n){super(i,"AuthWeakPasswordError",o,"weak_password"),this.reasons=n}}class Fa extends po{constructor(i){super(i,"AuthInvalidJwtError",400,"invalid_jwt")}}const ls="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),fl=` 	
\r=`.split(""),vu=(()=>{const t=new Array(128);for(let i=0;i<t.length;i+=1)t[i]=-1;for(let i=0;i<fl.length;i+=1)t[fl[i].charCodeAt(0)]=-2;for(let i=0;i<ls.length;i+=1)t[ls[i].charCodeAt(0)]=i;return t})();function xl(t,i,o){if(t!==null)for(i.queue=i.queue<<8|t,i.queuedBits+=8;i.queuedBits>=6;){const n=i.queue>>i.queuedBits-6&63;o(ls[n]),i.queuedBits-=6}else if(i.queuedBits>0)for(i.queue=i.queue<<6-i.queuedBits,i.queuedBits=6;i.queuedBits>=6;){const n=i.queue>>i.queuedBits-6&63;o(ls[n]),i.queuedBits-=6}}function Wd(t,i,o){const n=vu[t];if(n>-1)for(i.queue=i.queue<<6|n,i.queuedBits+=6;i.queuedBits>=8;)o(i.queue>>i.queuedBits-8&255),i.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function ml(t){const i=[],o=a=>{i.push(String.fromCodePoint(a))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},r=a=>{Cu(a,n,o)};for(let a=0;a<t.length;a+=1)Wd(t.charCodeAt(a),s,r);return i.join("")}function ju(t,i){if(t<=127){i(t);return}else if(t<=2047){i(192|t>>6),i(128|t&63);return}else if(t<=65535){i(224|t>>12),i(128|t>>6&63),i(128|t&63);return}else if(t<=1114111){i(240|t>>18),i(128|t>>12&63),i(128|t>>6&63),i(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Su(t,i){for(let o=0;o<t.length;o+=1){let n=t.charCodeAt(o);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(t.charCodeAt(o+1)-56320&65535|s)+65536,o+=1}ju(n,i)}}function Cu(t,i,o){if(i.utf8seq===0){if(t<=127){o(t);return}for(let n=1;n<6;n+=1)if(!(t>>7-n&1)){i.utf8seq=n;break}if(i.utf8seq===2)i.codepoint=t&31;else if(i.utf8seq===3)i.codepoint=t&15;else if(i.utf8seq===4)i.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");i.utf8seq-=1}else if(i.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");i.codepoint=i.codepoint<<6|t&63,i.utf8seq-=1,i.utf8seq===0&&o(i.codepoint)}}function xn(t){const i=[],o={queue:0,queuedBits:0},n=s=>{i.push(s)};for(let s=0;s<t.length;s+=1)Wd(t.charCodeAt(s),o,n);return new Uint8Array(i)}function ku(t){const i=[];return Su(t,o=>i.push(o)),new Uint8Array(i)}function Oo(t){const i=[],o={queue:0,queuedBits:0},n=s=>{i.push(s)};return t.forEach(s=>xl(s,o,n)),xl(null,o,n),i.join("")}function wu(t){return Math.round(Date.now()/1e3)+t}function zu(){return Symbol("auth-callback")}const Yt=()=>typeof window<"u"&&typeof document<"u",Ao={tested:!1,writable:!1},Nd=()=>{if(!Yt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ao.tested)return Ao.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ao.tested=!0,Ao.writable=!0}catch{Ao.tested=!0,Ao.writable=!1}return Ao.writable};function Eu(t){const i={},o=new URL(t);if(o.hash&&o.hash[0]==="#")try{new URLSearchParams(o.hash.substring(1)).forEach((s,r)=>{i[r]=s})}catch{}return o.searchParams.forEach((n,s)=>{i[s]=n}),i}const Ud=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),Au=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",ln=async(t,i,o)=>{await t.setItem(i,JSON.stringify(o))},Fo=async(t,i)=>{const o=await t.getItem(i);if(!o)return null;try{return JSON.parse(o)}catch{return o}},Jt=async(t,i)=>{await t.removeItem(i)};class ws{constructor(){this.promise=new ws.promiseConstructor((i,o)=>{this.resolve=i,this.reject=o})}}ws.promiseConstructor=Promise;function Br(t){const i=t.split(".");if(i.length!==3)throw new Fa("Invalid JWT structure");for(let n=0;n<i.length;n++)if(!hu.test(i[n]))throw new Fa("JWT not in base64url format");return{header:JSON.parse(ml(i[0])),payload:JSON.parse(ml(i[1])),signature:xn(i[2]),raw:{header:i[0],payload:i[1]}}}async function Fu(t){return await new Promise(i=>{setTimeout(()=>i(null),t)})}function Tu(t,i){return new Promise((n,s)=>{(async()=>{for(let r=0;r<1/0;r++)try{const a=await t(r);if(!i(r,null,a)){n(a);return}}catch(a){if(!i(r,a)){s(a);return}}})()})}function Bu(t){return("0"+t.toString(16)).substr(-2)}function Iu(){const i=new Uint32Array(56);if(typeof crypto>"u"){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=o.length;let s="";for(let r=0;r<56;r++)s+=o.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(i),Array.from(i,Bu).join("")}async function Ru(t){const o=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",o),s=new Uint8Array(n);return Array.from(s).map(r=>String.fromCharCode(r)).join("")}async function Mu(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const o=await Ru(t);return btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ko(t,i,o=!1){const n=Iu();let s=n;o&&(s+="/PASSWORD_RECOVERY"),await ln(t,`${i}-code-verifier`,s);const r=await Mu(n);return[r,n===r?"plain":"s256"]}const _u=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Du(t){const i=t.headers.get(Ea);if(!i||!i.match(_u))return null;try{return new Date(`${i}T00:00:00.0Z`)}catch{return null}}function $u(t){if(!t)throw new Error("Missing exp claim");const i=Math.floor(Date.now()/1e3);if(t<=i)throw new Error("JWT has expired")}function Pu(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ou=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Jo(t){if(!Ou.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Rs(){const t={};return new Proxy(t,{get:(i,o)=>{if(o==="__isUserNotAvailableProxy")return!0;if(typeof o=="symbol"){const n=o.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${o}" property of the session object is not supported. Please use getUser() instead.`)},set:(i,o)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${o}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(i,o)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${o}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Lu(t,i){return new Proxy(t,{get:(o,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)"||r==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(o,n,s)}return!i.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i.value=!0),Reflect.get(o,n,s)}})}function bl(t){return JSON.parse(JSON.stringify(t))}const _o=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Wu=[502,503,504];async function yl(t){var i;if(!Au(t))throw new Aa(_o(t),0);if(Wu.includes(t.status))throw new Aa(_o(t),t.status);let o;try{o=await t.json()}catch(r){throw new Po(_o(r),r)}let n;const s=Du(t);if(s&&s.getTime()>=Ld["2024-01-01"].timestamp&&typeof o=="object"&&o&&typeof o.code=="string"?n=o.code:typeof o=="object"&&o&&typeof o.error_code=="string"&&(n=o.error_code),n){if(n==="weak_password")throw new hl(_o(o),t.status,((i=o.weak_password)===null||i===void 0?void 0:i.reasons)||[]);if(n==="session_not_found")throw new gi}else if(typeof o=="object"&&o&&typeof o.weak_password=="object"&&o.weak_password&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.reasons.reduce((r,a)=>r&&typeof a=="string",!0))throw new hl(_o(o),t.status,o.weak_password.reasons);throw new xu(_o(o),t.status||500,n)}const Nu=(t,i,o,n)=>{const s={method:t,headers:(i==null?void 0:i.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},i==null?void 0:i.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),o))};async function dt(t,i,o,n){var s;const r=Object.assign({},n==null?void 0:n.headers);r[Ea]||(r[Ea]=Ld["2024-01-01"].name),n!=null&&n.jwt&&(r.Authorization=`Bearer ${n.jwt}`);const a=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(a.redirect_to=n.redirectTo);const u=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",h=await Uu(t,i,o+u,{headers:r,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(h):{data:Object.assign({},h),error:null}}async function Uu(t,i,o,n,s,r){const a=Nu(i,n,s,r);let u;try{u=await t(o,Object.assign({},a))}catch(h){throw console.error(h),new Aa(_o(h),0)}if(u.ok||await yl(u),n!=null&&n.noResolveJson)return u;try{return await u.json()}catch(h){await yl(h)}}function zi(t){var i;let o=null;Hu(t)&&(o=Object.assign({},t),t.expires_at||(o.expires_at=wu(t.expires_in)));const n=(i=t.user)!==null&&i!==void 0?i:t;return{data:{session:o,user:n},error:null}}function vl(t){const i=zi(t);return!i.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((o,n)=>o&&typeof n=="string",!0)&&(i.data.weak_password=t.weak_password),i}function jo(t){var i;return{data:{user:(i=t.user)!==null&&i!==void 0?i:t},error:null}}function Vu(t){return{data:t,error:null}}function qu(t){const{action_link:i,email_otp:o,hashed_token:n,redirect_to:s,verification_type:r}=t,a=Ss(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:i,email_otp:o,hashed_token:n,redirect_to:s,verification_type:r},h=Object.assign({},a);return{data:{properties:u,user:h},error:null}}function jl(t){return t}function Hu(t){return t.access_token&&t.refresh_token&&t.expires_in}const Ms=["global","local","others"];class Gu{constructor({url:i="",headers:o={},fetch:n}){this.url=i,this.headers=o,this.fetch=Ud(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(i,o=Ms[0]){if(Ms.indexOf(o)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ms.join(", ")}`);try{return await dt(this.fetch,"POST",`${this.url}/logout?scope=${o}`,{headers:this.headers,jwt:i,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ze(n))return{data:null,error:n};throw n}}async inviteUserByEmail(i,o={}){try{return await dt(this.fetch,"POST",`${this.url}/invite`,{body:{email:i,data:o.data},headers:this.headers,redirectTo:o.redirectTo,xform:jo})}catch(n){if(Ze(n))return{data:{user:null},error:n};throw n}}async generateLink(i){try{const{options:o}=i,n=Ss(i,["options"]),s=Object.assign(Object.assign({},n),o);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await dt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:qu,redirectTo:o==null?void 0:o.redirectTo})}catch(o){if(Ze(o))return{data:{properties:null,user:null},error:o};throw o}}async createUser(i){try{return await dt(this.fetch,"POST",`${this.url}/admin/users`,{body:i,headers:this.headers,xform:jo})}catch(o){if(Ze(o))return{data:{user:null},error:o};throw o}}async listUsers(i){var o,n,s,r,a,u,h;try{const b={nextPage:null,lastPage:0,total:0},j=await dt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(o=i==null?void 0:i.page)===null||o===void 0?void 0:o.toString())!==null&&n!==void 0?n:"",per_page:(r=(s=i==null?void 0:i.perPage)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:""},xform:jl});if(j.error)throw j.error;const C=await j.json(),v=(a=j.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(h=(u=j.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&h!==void 0?h:[];return m.length>0&&(m.forEach(f=>{const p=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(f.split(";")[1].split("=")[1]);b[`${c}Page`]=p}),b.total=parseInt(v)),{data:Object.assign(Object.assign({},C),b),error:null}}catch(b){if(Ze(b))return{data:{users:[]},error:b};throw b}}async getUserById(i){Jo(i);try{return await dt(this.fetch,"GET",`${this.url}/admin/users/${i}`,{headers:this.headers,xform:jo})}catch(o){if(Ze(o))return{data:{user:null},error:o};throw o}}async updateUserById(i,o){Jo(i);try{return await dt(this.fetch,"PUT",`${this.url}/admin/users/${i}`,{body:o,headers:this.headers,xform:jo})}catch(n){if(Ze(n))return{data:{user:null},error:n};throw n}}async deleteUser(i,o=!1){Jo(i);try{return await dt(this.fetch,"DELETE",`${this.url}/admin/users/${i}`,{headers:this.headers,body:{should_soft_delete:o},xform:jo})}catch(n){if(Ze(n))return{data:{user:null},error:n};throw n}}async _listFactors(i){Jo(i.userId);try{const{data:o,error:n}=await dt(this.fetch,"GET",`${this.url}/admin/users/${i.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:o,error:n}}catch(o){if(Ze(o))return{data:null,error:o};throw o}}async _deleteFactor(i){Jo(i.userId),Jo(i.id);try{return{data:await dt(this.fetch,"DELETE",`${this.url}/admin/users/${i.userId}/factors/${i.id}`,{headers:this.headers}),error:null}}catch(o){if(Ze(o))return{data:null,error:o};throw o}}async _listOAuthClients(i){var o,n,s,r,a,u,h;try{const b={nextPage:null,lastPage:0,total:0},j=await dt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(o=i==null?void 0:i.page)===null||o===void 0?void 0:o.toString())!==null&&n!==void 0?n:"",per_page:(r=(s=i==null?void 0:i.perPage)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:""},xform:jl});if(j.error)throw j.error;const C=await j.json(),v=(a=j.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(h=(u=j.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&h!==void 0?h:[];return m.length>0&&(m.forEach(f=>{const p=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(f.split(";")[1].split("=")[1]);b[`${c}Page`]=p}),b.total=parseInt(v)),{data:Object.assign(Object.assign({},C),b),error:null}}catch(b){if(Ze(b))return{data:{clients:[]},error:b};throw b}}async _createOAuthClient(i){try{return await dt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:i,headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Ze(o))return{data:null,error:o};throw o}}async _getOAuthClient(i){try{return await dt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Ze(o))return{data:null,error:o};throw o}}async _updateOAuthClient(i,o){try{return await dt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${i}`,{body:o,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ze(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(i){try{return await dt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(o){if(Ze(o))return{data:null,error:o};throw o}}async _regenerateOAuthClientSecret(i){try{return await dt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${i}/regenerate_secret`,{headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Ze(o))return{data:null,error:o};throw o}}}function Sl(t={}){return{getItem:i=>t[i]||null,setItem:(i,o)=>{t[i]=o},removeItem:i=>{delete t[i]}}}const Yo={debug:!!(globalThis&&Nd()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Vd extends Error{constructor(i){super(i),this.isAcquireTimeout=!0}}class Cl extends Vd{}async function Ku(t,i,o){Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,i);const n=new globalThis.AbortController;i>0&&setTimeout(()=>{n.abort(),Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},i),await Promise.resolve();try{return await globalThis.navigator.locks.request(t,i===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await o()}finally{Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(i===0)throw Yo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Cl(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Yo.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await o()}})}catch(s){throw(s==null?void 0:s.name)==="AbortError"?new Cl(`Acquiring an exclusive Navigator LockManager lock "${t}" timed out waiting ${i}ms`):s}}function Ju(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function qd(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Yu(t){return parseInt(t,16)}function Xu(t){const i=new TextEncoder().encode(t);return"0x"+Array.from(i,n=>n.toString(16).padStart(2,"0")).join("")}function Qu(t){var i;const{chainId:o,domain:n,expirationTime:s,issuedAt:r=new Date,nonce:a,notBefore:u,requestId:h,resources:b,scheme:j,uri:C,version:v}=t;{if(!Number.isInteger(o))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${o}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!C)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(v!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${v}`);if(!((i=t.statement)===null||i===void 0)&&i.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const m=qd(t.address),f=j?`${j}://${n}`:n,p=t.statement?`${t.statement}
`:"",c=`${f} wants you to sign in with your Ethereum account:
${m}

${p}`;let d=`URI: ${C}
Version: ${v}
Chain ID: ${o}${a?`
Nonce: ${a}`:""}
Issued At: ${r.toISOString()}`;if(s&&(d+=`
Expiration Time: ${s.toISOString()}`),u&&(d+=`
Not Before: ${u.toISOString()}`),h&&(d+=`
Request ID: ${h}`),b){let l=`
Resources:`;for(const x of b){if(!x||typeof x!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${x}`);l+=`
- ${x}`}d+=l}return`${c}
${d}`}class Lt extends Error{constructor({message:i,code:o,cause:n,name:s}){var r;super(i,{cause:n}),this.__isWebAuthnError=!0,this.name=(r=s??(n instanceof Error?n.name:void 0))!==null&&r!==void 0?r:"Unknown Error",this.code=o}}class ds extends Lt{constructor(i,o){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o,message:i}),this.name="WebAuthnUnknownError",this.originalError=o}}function Zu({error:t,options:i}){var o,n,s;const{publicKey:r}=i;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Lt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((o=r.authenticatorSelection)===null||o===void 0?void 0:o.requireResidentKey)===!0)return new Lt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(i.mediation==="conditional"&&((n=r.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Lt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=r.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Lt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Lt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Lt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return r.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new Lt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Lt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const a=window.location.hostname;if(Hd(a)){if(r.rp.id!==a)return new Lt({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Lt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new Lt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Lt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Lt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function eg({error:t,options:i}){const{publicKey:o}=i;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Lt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Lt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const n=window.location.hostname;if(Hd(n)){if(o.rpId!==n)return new Lt({message:`The RP ID "${o.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Lt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Lt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Lt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class tg{createNewAbortSignal(){if(this.controller){const o=new Error("Cancelling existing WebAuthn API call for new one");o.name="AbortError",this.controller.abort(o)}const i=new AbortController;return this.controller=i,i.signal}cancelCeremony(){if(this.controller){const i=new Error("Manually cancelling existing WebAuthn API call");i.name="AbortError",this.controller.abort(i),this.controller=void 0}}}const ig=new tg;function og(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:i,user:o,excludeCredentials:n}=t,s=Ss(t,["challenge","user","excludeCredentials"]),r=xn(i).buffer,a=Object.assign(Object.assign({},o),{id:xn(o.id).buffer}),u=Object.assign(Object.assign({},s),{challenge:r,user:a});if(n&&n.length>0){u.excludeCredentials=new Array(n.length);for(let h=0;h<n.length;h++){const b=n[h];u.excludeCredentials[h]=Object.assign(Object.assign({},b),{id:xn(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return u}function ng(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:i,allowCredentials:o}=t,n=Ss(t,["challenge","allowCredentials"]),s=xn(i).buffer,r=Object.assign(Object.assign({},n),{challenge:s});if(o&&o.length>0){r.allowCredentials=new Array(o.length);for(let a=0;a<o.length;a++){const u=o[a];r.allowCredentials[a]=Object.assign(Object.assign({},u),{id:xn(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return r}function rg(t){var i;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const o=t;return{id:t.id,rawId:t.id,response:{attestationObject:Oo(new Uint8Array(t.response.attestationObject)),clientDataJSON:Oo(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(i=o.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function sg(t){var i;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const o=t,n=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Oo(new Uint8Array(s.authenticatorData)),clientDataJSON:Oo(new Uint8Array(s.clientDataJSON)),signature:Oo(new Uint8Array(s.signature)),userHandle:s.userHandle?Oo(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(i=o.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function Hd(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function kl(){var t,i;return!!(Yt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((i=navigator==null?void 0:navigator.credentials)===null||i===void 0?void 0:i.get)=="function")}async function ag(t){try{const i=await navigator.credentials.create(t);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new ds("Browser returned unexpected credential type",i)}:{data:null,error:new ds("Empty credential response",i)}}catch(i){return{data:null,error:Zu({error:i,options:t})}}}async function lg(t){try{const i=await navigator.credentials.get(t);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new ds("Browser returned unexpected credential type",i)}:{data:null,error:new ds("Empty credential response",i)}}catch(i){return{data:null,error:eg({error:i,options:t})}}}const dg={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},cg={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function cs(...t){const i=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),o=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of t)if(s)for(const r in s){const a=s[r];if(a!==void 0)if(Array.isArray(a))n[r]=a;else if(o(a))n[r]=a;else if(i(a)){const u=n[r];i(u)?n[r]=cs(u,a):n[r]=cs(a)}else n[r]=a}return n}function pg(t,i){return cs(dg,t,i||{})}function ug(t,i){return cs(cg,t,i||{})}class gg{constructor(i){this.client=i,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(i){return this.client.mfa.enroll(Object.assign(Object.assign({},i),{factorType:"webauthn"}))}async _challenge({factorId:i,webauthn:o,friendlyName:n,signal:s},r){var a;try{const{data:u,error:h}=await this.client.mfa.challenge({factorId:i,webauthn:o});if(!u)return{data:null,error:h};const b=s??ig.createNewAbortSignal();if(u.webauthn.type==="create"){const{user:j}=u.webauthn.credential_options.publicKey;if(!j.name){const C=n;if(C)j.name=`${j.id}:${C}`;else{const m=(await this.client.getUser()).data.user,f=((a=m==null?void 0:m.user_metadata)===null||a===void 0?void 0:a.name)||(m==null?void 0:m.email)||(m==null?void 0:m.id)||"User";j.name=`${j.id}:${f}`}}j.displayName||(j.displayName=j.name)}switch(u.webauthn.type){case"create":{const j=pg(u.webauthn.credential_options.publicKey,r==null?void 0:r.create),{data:C,error:v}=await ag({publicKey:j,signal:b});return C?{data:{factorId:i,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:C}},error:null}:{data:null,error:v}}case"request":{const j=ug(u.webauthn.credential_options.publicKey,r==null?void 0:r.request),{data:C,error:v}=await lg(Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:j,signal:b}));return C?{data:{factorId:i,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:C}},error:null}:{data:null,error:v}}}}catch(u){return Ze(u)?{data:null,error:u}:{data:null,error:new Po("Unexpected error in challenge",u)}}}async _verify({challengeId:i,factorId:o,webauthn:n}){return this.client.mfa.verify({factorId:o,challengeId:i,webauthn:n})}async _authenticate({factorId:i,webauthn:{rpId:o=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},r){if(!o)return{data:null,error:new lr("rpId is required for WebAuthn authentication")};try{if(!kl())return{data:null,error:new Po("Browser does not support WebAuthn",null)};const{data:a,error:u}=await this.challenge({factorId:i,webauthn:{rpId:o,rpOrigins:n},signal:s},{request:r});if(!a)return{data:null,error:u};const{webauthn:h}=a;return this._verify({factorId:i,challengeId:a.challengeId,webauthn:{type:h.type,rpId:o,rpOrigins:n,credential_response:h.credential_response}})}catch(a){return Ze(a)?{data:null,error:a}:{data:null,error:new Po("Unexpected error in authenticate",a)}}}async _register({friendlyName:i,webauthn:{rpId:o=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},r){if(!o)return{data:null,error:new lr("rpId is required for WebAuthn registration")};try{if(!kl())return{data:null,error:new Po("Browser does not support WebAuthn",null)};const{data:a,error:u}=await this._enroll({friendlyName:i});if(!a)return await this.client.mfa.listFactors().then(j=>{var C;return(C=j.data)===null||C===void 0?void 0:C.all.find(v=>v.factor_type==="webauthn"&&v.friendly_name===i&&v.status!=="unverified")}).then(j=>j?this.client.mfa.unenroll({factorId:j==null?void 0:j.id}):void 0),{data:null,error:u};const{data:h,error:b}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:o,rpOrigins:n},signal:s},{create:r});return h?this._verify({factorId:a.id,challengeId:h.challengeId,webauthn:{rpId:o,rpOrigins:n,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:b}}catch(a){return Ze(a)?{data:null,error:a}:{data:null,error:new Po("Unexpected error in register",a)}}}}Ju();const hg={url:pu,storageKey:uu,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:gu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function wl(t,i,o){return await o()}const Xo={};class dr{get jwks(){var i,o;return(o=(i=Xo[this.storageKey])===null||i===void 0?void 0:i.jwks)!==null&&o!==void 0?o:{keys:[]}}set jwks(i){Xo[this.storageKey]=Object.assign(Object.assign({},Xo[this.storageKey]),{jwks:i})}get jwks_cached_at(){var i,o;return(o=(i=Xo[this.storageKey])===null||i===void 0?void 0:i.cachedAt)!==null&&o!==void 0?o:Number.MIN_SAFE_INTEGER}set jwks_cached_at(i){Xo[this.storageKey]=Object.assign(Object.assign({},Xo[this.storageKey]),{cachedAt:i})}constructor(i){var o,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const r=Object.assign(Object.assign({},hg),i);if(this.storageKey=r.storageKey,this.instanceID=(o=dr.nextInstanceID[this.storageKey])!==null&&o!==void 0?o:0,dr.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.instanceID>0&&Yt()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=r.persistSession,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Gu({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Ud(r.fetch),this.lock=r.lock||wl,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,this.throwOnError=r.throwOnError,this.lockAcquireTimeout=r.lockAcquireTimeout,r.lock?this.lock=r.lock:this.persistSession&&Yt()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=Ku:this.lock=wl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new gg(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:Nd()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Sl(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Sl(this.memoryStorage)),Yt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a);try{await this._notifyAllSubscribers(a.data.event,a.data.session,!1)}catch(u){this._debug("#broadcastChannel","error",u)}})}r.skipAutoInitialize||this.initialize().catch(a=>{this._debug("#initialize()","error",a)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(i){if(this.throwOnError&&i&&i.error)throw i.error;return i}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Od}) ${new Date().toISOString()}`}_debug(...i){return this.logDebugMessages&&this.logger(this._logPrefix(),...i),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var i;try{let o={},n="none";if(Yt()&&(o=Eu(window.location.href),this._isImplicitGrantCallback(o)?n="implicit":await this._isPKCECallback(o)&&(n="pkce")),Yt()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:r}=await this._getSessionFromURL(o,n);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),bu(r)){const h=(i=r.details)===null||i===void 0?void 0:i.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:r}}return{error:r}}const{session:a,redirectType:u}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",u),await this._saveSession(a),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(o){return Ze(o)?this._returnResult({error:o}):this._returnResult({error:new Po("Unexpected error during initialization",o)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(i){var o,n,s;try{const r=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(o=i==null?void 0:i.options)===null||o===void 0?void 0:o.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=i==null?void 0:i.options)===null||s===void 0?void 0:s.captchaToken}},xform:zi}),{data:a,error:u}=r;if(u||!a)return this._returnResult({data:{user:null,session:null},error:u});const h=a.session,b=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:b,session:h},error:null})}catch(r){if(Ze(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signUp(i){var o,n,s;try{let r;if("email"in i){const{email:j,password:C,options:v}=i;let m=null,f=null;this.flowType==="pkce"&&([m,f]=await Ko(this.storage,this.storageKey)),r=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v==null?void 0:v.emailRedirectTo,body:{email:j,password:C,data:(o=v==null?void 0:v.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:m,code_challenge_method:f},xform:zi})}else if("phone"in i){const{phone:j,password:C,options:v}=i;r=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:j,password:C,data:(n=v==null?void 0:v.data)!==null&&n!==void 0?n:{},channel:(s=v==null?void 0:v.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:zi})}else throw new Fr("You must provide either an email or phone number and a password");const{data:a,error:u}=r;if(u||!a)return await Jt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:u});const h=a.session,b=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:b,session:h},error:null})}catch(r){if(await Jt(this.storage,`${this.storageKey}-code-verifier`),Ze(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithPassword(i){try{let o;if("email"in i){const{email:r,password:a,options:u}=i;o=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:a,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:vl})}else if("phone"in i){const{phone:r,password:a,options:u}=i;o=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:a,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:vl})}else throw new Fr("You must provide either an email or phone number and a password");const{data:n,error:s}=o;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const r=new Go;return this._returnResult({data:{user:null,session:null},error:r})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(o){if(Ze(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithOAuth(i){var o,n,s,r;return await this._handleProviderSignIn(i.provider,{redirectTo:(o=i.options)===null||o===void 0?void 0:o.redirectTo,scopes:(n=i.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=i.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(r=i.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(i){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(i))}async signInWithWeb3(i){const{chain:o}=i;switch(o){case"ethereum":return await this.signInWithEthereum(i);case"solana":return await this.signInWithSolana(i);default:throw new Error(`@supabase/auth-js: Unsupported chain "${o}"`)}}async signInWithEthereum(i){var o,n,s,r,a,u,h,b,j,C,v;let m,f;if("message"in i)m=i.message,f=i.signature;else{const{chain:p,wallet:c,statement:d,options:l}=i;let x;if(Yt())if(typeof c=="object")x=c;else{const w=window;if("ethereum"in w&&typeof w.ethereum=="object"&&"request"in w.ethereum&&typeof w.ethereum.request=="function")x=w.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof c!="object"||!(l!=null&&l.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=c}const y=new URL((o=l==null?void 0:l.url)!==null&&o!==void 0?o:window.location.href),g=await x.request({method:"eth_requestAccounts"}).then(w=>w).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!g||g.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const S=qd(g[0]);let A=(n=l==null?void 0:l.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!A){const w=await x.request({method:"eth_chainId"});A=Yu(w)}const E={domain:y.host,address:S,statement:d,uri:y.href,version:"1",chainId:A,nonce:(s=l==null?void 0:l.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(a=(r=l==null?void 0:l.signInWithEthereum)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(u=l==null?void 0:l.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(h=l==null?void 0:l.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(b=l==null?void 0:l.signInWithEthereum)===null||b===void 0?void 0:b.requestId,resources:(j=l==null?void 0:l.signInWithEthereum)===null||j===void 0?void 0:j.resources};m=Qu(E),f=await x.request({method:"personal_sign",params:[Xu(m),S]})}try{const{data:p,error:c}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:f},!((C=i.options)===null||C===void 0)&&C.captchaToken?{gotrue_meta_security:{captcha_token:(v=i.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:zi});if(c)throw c;if(!p||!p.session||!p.user){const d=new Go;return this._returnResult({data:{user:null,session:null},error:d})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:c})}catch(p){if(Ze(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(i){var o,n,s,r,a,u,h,b,j,C,v,m;let f,p;if("message"in i)f=i.message,p=i.signature;else{const{chain:c,wallet:d,statement:l,options:x}=i;let y;if(Yt())if(typeof d=="object")y=d;else{const S=window;if("solana"in S&&typeof S.solana=="object"&&("signIn"in S.solana&&typeof S.solana.signIn=="function"||"signMessage"in S.solana&&typeof S.solana.signMessage=="function"))y=S.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof d!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=d}const g=new URL((o=x==null?void 0:x.url)!==null&&o!==void 0?o:window.location.href);if("signIn"in y&&y.signIn){const S=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},x==null?void 0:x.signInWithSolana),{version:"1",domain:g.host,uri:g.href}),l?{statement:l}:null));let A;if(Array.isArray(S)&&S[0]&&typeof S[0]=="object")A=S[0];else if(S&&typeof S=="object"&&"signedMessage"in S&&"signature"in S)A=S;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)f=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),p=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in y)||typeof y.signMessage!="function"||!("publicKey"in y)||typeof y!="object"||!y.publicKey||!("toBase58"in y.publicKey)||typeof y.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${g.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...l?["",l,""]:[""],"Version: 1",`URI: ${g.href}`,`Issued At: ${(s=(n=x==null?void 0:x.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((r=x==null?void 0:x.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...!((a=x==null?void 0:x.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...!((u=x==null?void 0:x.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...!((h=x==null?void 0:x.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...!((b=x==null?void 0:x.signInWithSolana)===null||b===void 0)&&b.requestId?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...!((C=(j=x==null?void 0:x.signInWithSolana)===null||j===void 0?void 0:j.resources)===null||C===void 0)&&C.length?["Resources",...x.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const S=await y.signMessage(new TextEncoder().encode(f),"utf8");if(!S||!(S instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=S}}try{const{data:c,error:d}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Oo(p)},!((v=i.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(m=i.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:zi});if(d)throw d;if(!c||!c.session||!c.user){const l=new Go;return this._returnResult({data:{user:null,session:null},error:l})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:Object.assign({},c),error:d})}catch(c){if(Ze(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async _exchangeCodeForSession(i){const o=await Fo(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(o??"").split("/");try{if(!n&&this.flowType==="pkce")throw new yu;const{data:r,error:a}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:i,code_verifier:n},xform:zi});if(await Jt(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!r||!r.session||!r.user){const u=new Go;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign(Object.assign({},r),{redirectType:s??null}),error:a})}catch(r){if(await Jt(this.storage,`${this.storageKey}-code-verifier`),Ze(r))return this._returnResult({data:{user:null,session:null,redirectType:null},error:r});throw r}}async signInWithIdToken(i){try{const{options:o,provider:n,token:s,access_token:r,nonce:a}=i,u=await dt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:r,nonce:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zi}),{data:h,error:b}=u;if(b)return this._returnResult({data:{user:null,session:null},error:b});if(!h||!h.session||!h.user){const j=new Go;return this._returnResult({data:{user:null,session:null},error:j})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:b})}catch(o){if(Ze(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithOtp(i){var o,n,s,r,a;try{if("email"in i){const{email:u,options:h}=i;let b=null,j=null;this.flowType==="pkce"&&([b,j]=await Ko(this.storage,this.storageKey));const{error:C}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(o=h==null?void 0:h.data)!==null&&o!==void 0?o:{},create_user:(n=h==null?void 0:h.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:b,code_challenge_method:j},redirectTo:h==null?void 0:h.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:C})}if("phone"in i){const{phone:u,options:h}=i,{data:b,error:j}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},create_user:(r=h==null?void 0:h.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},channel:(a=h==null?void 0:h.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:b==null?void 0:b.message_id},error:j})}throw new Fr("You must provide either an email or phone number.")}catch(u){if(await Jt(this.storage,`${this.storageKey}-code-verifier`),Ze(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(i){var o,n;try{let s,r;"options"in i&&(s=(o=i.options)===null||o===void 0?void 0:o.redirectTo,r=(n=i.options)===null||n===void 0?void 0:n.captchaToken);const{data:a,error:u}=await dt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},i),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:zi});if(u)throw u;if(!a)throw new Error("An error occurred on token verification.");const h=a.session,b=a.user;return h!=null&&h.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(i.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:b,session:h},error:null})}catch(s){if(Ze(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(i){var o,n,s,r,a;try{let u=null,h=null;this.flowType==="pkce"&&([u,h]=await Ko(this.storage,this.storageKey));const b=await dt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in i?{provider_id:i.providerId}:null),"domain"in i?{domain:i.domain}:null),{redirect_to:(n=(o=i.options)===null||o===void 0?void 0:o.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=i==null?void 0:i.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:i.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:h}),headers:this.headers,xform:Vu});return!((r=b.data)===null||r===void 0)&&r.url&&Yt()&&!(!((a=i.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(b.data.url),this._returnResult(b)}catch(u){if(await Jt(this.storage,`${this.storageKey}-code-verifier`),Ze(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async i=>{const{data:{session:o},error:n}=i;if(n)throw n;if(!o)throw new gi;const{error:s}=await dt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:o.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(i){if(Ze(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async resend(i){try{const o=`${this.url}/resend`;if("email"in i){const{email:n,type:s,options:r}=i,{error:a}=await dt(this.fetch,"POST",o,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in i){const{phone:n,type:s,options:r}=i,{data:a,error:u}=await dt(this.fetch,"POST",o,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:u})}throw new Fr("You must provide either an email or phone number and a type")}catch(o){if(Ze(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async o=>o))}async _acquireLock(i,o){this._debug("#_acquireLock","begin",i);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await o()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,i,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=o();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(i){this._debug("#_useSession","begin");try{const o=await this.__loadSession();return await i(o)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let i=null;const o=await Fo(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",o),o!==null&&(this._isValidSession(o)?i=o:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!i)return{data:{session:null},error:null};const n=i.expires_at?i.expires_at*1e3-Date.now()<Ts:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",i.expires_at),!n){if(this.userStorage){const a=await Fo(this.userStorage,this.storageKey+"-user");a!=null&&a.user?i.user=a.user:i.user=Rs()}if(this.storage.isServer&&i.user&&!i.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};i.user=Lu(i.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:i},error:null}}const{data:s,error:r}=await this._callRefreshToken(i.refresh_token);return r?this._returnResult({data:{session:null},error:r}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(i){if(i)return await this._getUser(i);await this.initializePromise;const o=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return o.data.user&&(this.suppressGetSessionWarning=!0),o}async _getUser(i){try{return i?await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:i,xform:jo}):await this._useSession(async o=>{var n,s,r;const{data:a,error:u}=o;if(u)throw u;return!(!((n=a.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new gi}:await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0,xform:jo})})}catch(o){if(Ze(o))return Bs(o)&&(await this._removeSession(),await Jt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:o});throw o}}async updateUser(i,o={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(i,o))}async _updateUser(i,o={}){try{return await this._useSession(async n=>{const{data:s,error:r}=n;if(r)throw r;if(!s.session)throw new gi;const a=s.session;let u=null,h=null;this.flowType==="pkce"&&i.email!=null&&([u,h]=await Ko(this.storage,this.storageKey));const{data:b,error:j}=await dt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:o==null?void 0:o.emailRedirectTo,body:Object.assign(Object.assign({},i),{code_challenge:u,code_challenge_method:h}),jwt:a.access_token,xform:jo});if(j)throw j;return a.user=b.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(n){if(await Jt(this.storage,`${this.storageKey}-code-verifier`),Ze(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(i){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(i))}async _setSession(i){try{if(!i.access_token||!i.refresh_token)throw new gi;const o=Date.now()/1e3;let n=o,s=!0,r=null;const{payload:a}=Br(i.access_token);if(a.exp&&(n=a.exp,s=n<=o),s){const{data:u,error:h}=await this._callRefreshToken(i.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!u)return{data:{user:null,session:null},error:null};r=u}else{const{data:u,error:h}=await this._getUser(i.access_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});r={access_token:i.access_token,refresh_token:i.refresh_token,user:u.user,token_type:"bearer",expires_in:n-o,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return this._returnResult({data:{user:r.user,session:r},error:null})}catch(o){if(Ze(o))return this._returnResult({data:{session:null,user:null},error:o});throw o}}async refreshSession(i){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(i))}async _refreshSession(i){try{return await this._useSession(async o=>{var n;if(!i){const{data:a,error:u}=o;if(u)throw u;i=(n=a.session)!==null&&n!==void 0?n:void 0}if(!(i!=null&&i.refresh_token))throw new gi;const{data:s,error:r}=await this._callRefreshToken(i.refresh_token);return r?this._returnResult({data:{user:null,session:null},error:r}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(o){if(Ze(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async _getSessionFromURL(i,o){try{if(!Yt())throw new Tr("No browser detected.");if(i.error||i.error_description||i.error_code)throw new Tr(i.error_description||"Error in URL with unspecified error_description",{error:i.error||"unspecified_error",code:i.error_code||"unspecified_code"});switch(o){case"implicit":if(this.flowType==="pkce")throw new gl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Tr("Not a valid implicit grant flow url.");break;default:}if(o==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!i.code)throw new gl("No code detected.");const{data:l,error:x}=await this._exchangeCodeForSession(i.code);if(x)throw x;const y=new URL(window.location.href);return y.searchParams.delete("code"),window.history.replaceState(window.history.state,"",y.toString()),{data:{session:l.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:r,refresh_token:a,expires_in:u,expires_at:h,token_type:b}=i;if(!r||!u||!a||!b)throw new Tr("No session defined in URL");const j=Math.round(Date.now()/1e3),C=parseInt(u);let v=j+C;h&&(v=parseInt(h));const m=v-j;m*1e3<=an&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${C}s`);const f=v-C;j-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,v,j):j-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,v,j);const{data:p,error:c}=await this._getUser(r);if(c)throw c;const d={provider_token:n,provider_refresh_token:s,access_token:r,expires_in:C,expires_at:v,refresh_token:a,token_type:b,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:d,redirectType:i.type},error:null})}catch(n){if(Ze(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(i){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),i):!!(i.access_token||i.error_description)}async _isPKCECallback(i){const o=await Fo(this.storage,`${this.storageKey}-code-verifier`);return!!(i.code&&o)}async signOut(i={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(i))}async _signOut({scope:i}={scope:"global"}){return await this._useSession(async o=>{var n;const{data:s,error:r}=o;if(r&&!Bs(r))return this._returnResult({error:r});const a=(n=s.session)===null||n===void 0?void 0:n.access_token;if(a){const{error:u}=await this.admin.signOut(a,i);if(u&&!(mu(u)&&(u.status===404||u.status===401||u.status===403)||Bs(u)))return this._returnResult({error:u})}return i!=="others"&&(await this._removeSession(),await Jt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(i){const o=zu(),n={id:o,callback:i,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",o),this.stateChangeEmitters.delete(o)}};return this._debug("#onAuthStateChange()","registered callback with id",o),this.stateChangeEmitters.set(o,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(o)})))(),{data:{subscription:n}}}async _emitInitialSession(i){return await this._useSession(async o=>{var n,s;try{const{data:{session:r},error:a}=o;if(a)throw a;await((n=this.stateChangeEmitters.get(i))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",i,"session",r)}catch(r){await((s=this.stateChangeEmitters.get(i))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",i,"error",r),console.error(r)}})}async resetPasswordForEmail(i,o={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Ko(this.storage,this.storageKey,!0));try{return await dt(this.fetch,"POST",`${this.url}/recover`,{body:{email:i,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:o.captchaToken}},headers:this.headers,redirectTo:o.redirectTo})}catch(r){if(await Jt(this.storage,`${this.storageKey}-code-verifier`),Ze(r))return this._returnResult({data:null,error:r});throw r}}async getUserIdentities(){var i;try{const{data:o,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(i=o.user.identities)!==null&&i!==void 0?i:[]},error:null})}catch(o){if(Ze(o))return this._returnResult({data:null,error:o});throw o}}async linkIdentity(i){return"token"in i?this.linkIdentityIdToken(i):this.linkIdentityOAuth(i)}async linkIdentityOAuth(i){var o;try{const{data:n,error:s}=await this._useSession(async r=>{var a,u,h,b,j;const{data:C,error:v}=r;if(v)throw v;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,i.provider,{redirectTo:(a=i.options)===null||a===void 0?void 0:a.redirectTo,scopes:(u=i.options)===null||u===void 0?void 0:u.scopes,queryParams:(h=i.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await dt(this.fetch,"GET",m,{headers:this.headers,jwt:(j=(b=C.session)===null||b===void 0?void 0:b.access_token)!==null&&j!==void 0?j:void 0})});if(s)throw s;return Yt()&&!(!((o=i.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:i.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(Ze(n))return this._returnResult({data:{provider:i.provider,url:null},error:n});throw n}}async linkIdentityIdToken(i){return await this._useSession(async o=>{var n;try{const{error:s,data:{session:r}}=o;if(s)throw s;const{options:a,provider:u,token:h,access_token:b,nonce:j}=i,C=await dt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=r==null?void 0:r.access_token)!==null&&n!==void 0?n:void 0,body:{provider:u,id_token:h,access_token:b,nonce:j,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:zi}),{data:v,error:m}=C;return m?this._returnResult({data:{user:null,session:null},error:m}):!v||!v.session||!v.user?this._returnResult({data:{user:null,session:null},error:new Go}):(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("USER_UPDATED",v.session)),this._returnResult({data:v,error:m}))}catch(s){if(await Jt(this.storage,`${this.storageKey}-code-verifier`),Ze(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(i){try{return await this._useSession(async o=>{var n,s;const{data:r,error:a}=o;if(a)throw a;return await dt(this.fetch,"DELETE",`${this.url}/user/identities/${i.identity_id}`,{headers:this.headers,jwt:(s=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(o){if(Ze(o))return this._returnResult({data:null,error:o});throw o}}async _refreshAccessToken(i){const o=`#_refreshAccessToken(${i.substring(0,5)}...)`;this._debug(o,"begin");try{const n=Date.now();return await Tu(async s=>(s>0&&await Fu(200*Math.pow(2,s-1)),this._debug(o,"refreshing attempt",s),await dt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:i},headers:this.headers,xform:zi})),(s,r)=>{const a=200*Math.pow(2,s);return r&&Is(r)&&Date.now()+a-n<an})}catch(n){if(this._debug(o,"error",n),Ze(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(o,"end")}}_isValidSession(i){return typeof i=="object"&&i!==null&&"access_token"in i&&"refresh_token"in i&&"expires_at"in i}async _handleProviderSignIn(i,o){const n=await this._getUrlForProvider(`${this.url}/authorize`,i,{redirectTo:o.redirectTo,scopes:o.scopes,queryParams:o.queryParams});return this._debug("#_handleProviderSignIn()","provider",i,"options",o,"url",n),Yt()&&!o.skipBrowserRedirect&&window.location.assign(n),{data:{provider:i,url:n},error:null}}async _recoverAndRefresh(){var i,o;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Fo(this.storage,this.storageKey);if(s&&this.userStorage){let a=await Fo(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:s.user},await ln(this.userStorage,this.storageKey+"-user",a)),s.user=(i=a==null?void 0:a.user)!==null&&i!==void 0?i:Rs()}else if(s&&!s.user&&!s.user){const a=await Fo(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(s.user=a.user,await Jt(this.storage,this.storageKey+"-user"),await ln(this.storage,this.storageKey,s)):s.user=Rs()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const r=((o=s.expires_at)!==null&&o!==void 0?o:1/0)*1e3-Date.now()<Ts;if(this._debug(n,`session has${r?"":" not"} expired with margin of ${Ts}s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),Is(a)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:u}=await this._getUser(s.access_token);!u&&(a!=null&&a.user)?(s.user=a.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(n,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(i){var o,n;if(!i)throw new gi;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${i.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new ws;const{data:r,error:a}=await this._refreshAccessToken(i);if(a)throw a;if(!r.session)throw new gi;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const u={data:r.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(r){if(this._debug(s,"error",r),Ze(r)){const a={data:null,error:r};return Is(r)||await this._removeSession(),(o=this.refreshingDeferred)===null||o===void 0||o.resolve(a),a}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(i,o,n=!0){const s=`#_notifyAllSubscribers(${i})`;this._debug(s,"begin",o,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:i,session:o});const r=[],a=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(i,o)}catch(h){r.push(h)}});if(await Promise.all(a),r.length>0){for(let u=0;u<r.length;u+=1)console.error(r[u]);throw r[0]}}finally{this._debug(s,"end")}}async _saveSession(i){this._debug("#_saveSession()",i),this.suppressGetSessionWarning=!0,await Jt(this.storage,`${this.storageKey}-code-verifier`);const o=Object.assign({},i),n=o.user&&o.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&o.user&&await ln(this.userStorage,this.storageKey+"-user",{user:o.user});const s=Object.assign({},o);delete s.user;const r=bl(s);await ln(this.storage,this.storageKey,r)}else{const s=bl(o);await ln(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Jt(this.storage,this.storageKey),await Jt(this.storage,this.storageKey+"-code-verifier"),await Jt(this.storage,this.storageKey+"-user"),this.userStorage&&await Jt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const i=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{i&&Yt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",i)}catch(o){console.error("removing visibilitychange callback failed",o)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const i=setInterval(()=>this._autoRefreshTokenTick(),an);this.autoRefreshTicker=i,i&&typeof i=="object"&&typeof i.unref=="function"?i.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(i);const o=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=o,o&&typeof o=="object"&&typeof o.unref=="function"?o.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(o)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const i=this.autoRefreshTicker;this.autoRefreshTicker=null,i&&clearInterval(i);const o=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,o&&clearTimeout(o)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const i=Date.now();try{return await this._useSession(async o=>{const{data:{session:n}}=o;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-i)/an);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${an}ms, refresh threshold is ${za} ticks`),s<=za&&await this._callRefreshToken(n.refresh_token)})}catch(o){console.error("Auto refresh tick failed with error. This is likely a transient error.",o)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(i){if(i.isAcquireTimeout||i instanceof Vd)this._debug("auto refresh token tick lock not available");else throw i}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Yt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(i){this._debug("#visibilityChangedCallback","error",i)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(i){console.error("_handleVisibilityChange",i)}}async _onVisibilityChanged(i){const o=`#_onVisibilityChanged(${i})`;this._debug(o,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),i||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(o,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(i,o,n){const s=[`provider=${encodeURIComponent(o)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[r,a]=await Ko(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(u.toString())}if(n!=null&&n.queryParams){const r=new URLSearchParams(n.queryParams);s.push(r.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${i}?${s.join("&")}`}async _unenroll(i){try{return await this._useSession(async o=>{var n;const{data:s,error:r}=o;return r?this._returnResult({data:null,error:r}):await dt(this.fetch,"DELETE",`${this.url}/factors/${i.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(o){if(Ze(o))return this._returnResult({data:null,error:o});throw o}}async _enroll(i){try{return await this._useSession(async o=>{var n,s;const{data:r,error:a}=o;if(a)return this._returnResult({data:null,error:a});const u=Object.assign({friendly_name:i.friendlyName,factor_type:i.factorType},i.factorType==="phone"?{phone:i.phone}:i.factorType==="totp"?{issuer:i.issuer}:{}),{data:h,error:b}=await dt(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return b?this._returnResult({data:null,error:b}):(i.factorType==="totp"&&h.type==="totp"&&(!((s=h==null?void 0:h.totp)===null||s===void 0)&&s.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(o){if(Ze(o))return this._returnResult({data:null,error:o});throw o}}async _verify(i){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async o=>{var n;const{data:s,error:r}=o;if(r)return this._returnResult({data:null,error:r});const a=Object.assign({challenge_id:i.challengeId},"webauthn"in i?{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_response:i.webauthn.type==="create"?rg(i.webauthn.credential_response):sg(i.webauthn.credential_response)})}:{code:i.code}),{data:u,error:h}=await dt(this.fetch,"POST",`${this.url}/factors/${i.factorId}/verify`,{body:a,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:h}))})}catch(o){if(Ze(o))return this._returnResult({data:null,error:o});throw o}})}async _challenge(i){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async o=>{var n;const{data:s,error:r}=o;if(r)return this._returnResult({data:null,error:r});const a=await dt(this.fetch,"POST",`${this.url}/factors/${i.factorId}/challenge`,{body:i,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(a.error)return a;const{data:u}=a;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:og(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:ng(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(o){if(Ze(o))return this._returnResult({data:null,error:o});throw o}})}async _challengeAndVerify(i){const{data:o,error:n}=await this._challenge({factorId:i.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:i.factorId,challengeId:o.id,code:i.code})}async _listFactors(){var i;const{data:{user:o},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const r of(i=o==null?void 0:o.factors)!==null&&i!==void 0?i:[])s.all.push(r),r.status==="verified"&&s[r.factor_type].push(r);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(i){var o,n,s,r;if(i)try{const{payload:m}=Br(i);let f=null;m.aal&&(f=m.aal);let p=f;const{data:{user:c},error:d}=await this.getUser(i);if(d)return this._returnResult({data:null,error:d});((n=(o=c==null?void 0:c.factors)===null||o===void 0?void 0:o.filter(y=>y.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(p="aal2");const x=m.amr||[];return{data:{currentLevel:f,nextLevel:p,currentAuthenticationMethods:x},error:null}}catch(m){if(Ze(m))return this._returnResult({data:null,error:m});throw m}const{data:{session:a},error:u}=await this.getSession();if(u)return this._returnResult({data:null,error:u});if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:h}=Br(a.access_token);let b=null;h.aal&&(b=h.aal);let j=b;((r=(s=a.user.factors)===null||s===void 0?void 0:s.filter(m=>m.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(j="aal2");const v=h.amr||[];return{data:{currentLevel:b,nextLevel:j,currentAuthenticationMethods:v},error:null}}async _getAuthorizationDetails(i){try{return await this._useSession(async o=>{const{data:{session:n},error:s}=o;return s?this._returnResult({data:null,error:s}):n?await dt(this.fetch,"GET",`${this.url}/oauth/authorizations/${i}`,{headers:this.headers,jwt:n.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new gi})})}catch(o){if(Ze(o))return this._returnResult({data:null,error:o});throw o}}async _approveAuthorization(i,o){try{return await this._useSession(async n=>{const{data:{session:s},error:r}=n;if(r)return this._returnResult({data:null,error:r});if(!s)return this._returnResult({data:null,error:new gi});const a=await dt(this.fetch,"POST",`${this.url}/oauth/authorizations/${i}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return a.data&&a.data.redirect_url&&Yt()&&!(o!=null&&o.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(n){if(Ze(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(i,o){try{return await this._useSession(async n=>{const{data:{session:s},error:r}=n;if(r)return this._returnResult({data:null,error:r});if(!s)return this._returnResult({data:null,error:new gi});const a=await dt(this.fetch,"POST",`${this.url}/oauth/authorizations/${i}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return a.data&&a.data.redirect_url&&Yt()&&!(o!=null&&o.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(n){if(Ze(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async i=>{const{data:{session:o},error:n}=i;return n?this._returnResult({data:null,error:n}):o?await dt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:o.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new gi})})}catch(i){if(Ze(i))return this._returnResult({data:null,error:i});throw i}}async _revokeOAuthGrant(i){try{return await this._useSession(async o=>{const{data:{session:n},error:s}=o;return s?this._returnResult({data:null,error:s}):n?(await dt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:i.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new gi})})}catch(o){if(Ze(o))return this._returnResult({data:null,error:o});throw o}}async fetchJwk(i,o={keys:[]}){let n=o.keys.find(u=>u.kid===i);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(u=>u.kid===i),n&&this.jwks_cached_at+fu>s)return n;const{data:r,error:a}=await dt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=s,n=r.keys.find(u=>u.kid===i),!n)?null:n}async getClaims(i,o={}){try{let n=i;if(!n){const{data:m,error:f}=await this.getSession();if(f||!m.session)return this._returnResult({data:null,error:f});n=m.session.access_token}const{header:s,payload:r,signature:a,raw:{header:u,payload:h}}=Br(n);o!=null&&o.allowExpired||$u(r.exp);const b=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,o!=null&&o.keys?{keys:o.keys}:o==null?void 0:o.jwks);if(!b){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:r,header:s,signature:a},error:null}}const j=Pu(s.alg),C=await crypto.subtle.importKey("jwk",b,j,!0,["verify"]);if(!await crypto.subtle.verify(j,C,a,ku(`${u}.${h}`)))throw new Fa("Invalid JWT signature");return{data:{claims:r,header:s,signature:a},error:null}}catch(n){if(Ze(n))return this._returnResult({data:null,error:n});throw n}}}dr.nextInstanceID={};const fg=dr,xg="2.97.0";let qn="";typeof Deno<"u"?qn="deno":typeof document<"u"?qn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?qn="react-native":qn="node";const mg={"X-Client-Info":`supabase-js-${qn}/${xg}`},bg={headers:mg},yg={schema:"public"},vg={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},jg={};function cr(t){"@babel/helpers - typeof";return cr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},cr(t)}function Sg(t,i){if(cr(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var n=o.call(t,i||"default");if(cr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(t)}function Cg(t){var i=Sg(t,"string");return cr(i)=="symbol"?i:i+""}function kg(t,i,o){return(i=Cg(i))in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function zl(t,i){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),o.push.apply(o,n)}return o}function Pt(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?zl(Object(o),!0).forEach(function(n){kg(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):zl(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}const wg=t=>t?(...i)=>t(...i):(...i)=>fetch(...i),zg=()=>Headers,Eg=(t,i,o)=>{const n=wg(o),s=zg();return async(r,a)=>{var u;const h=(u=await i())!==null&&u!==void 0?u:t;let b=new s(a==null?void 0:a.headers);return b.has("apikey")||b.set("apikey",t),b.has("Authorization")||b.set("Authorization",`Bearer ${h}`),n(r,Pt(Pt({},a),{},{headers:b}))}};function Ag(t){return t.endsWith("/")?t:t+"/"}function Fg(t,i){var o,n;const{db:s,auth:r,realtime:a,global:u}=t,{db:h,auth:b,realtime:j,global:C}=i,v={db:Pt(Pt({},h),s),auth:Pt(Pt({},b),r),realtime:Pt(Pt({},j),a),storage:{},global:Pt(Pt(Pt({},C),u),{},{headers:Pt(Pt({},(o=C==null?void 0:C.headers)!==null&&o!==void 0?o:{}),(n=u==null?void 0:u.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return t.accessToken?v.accessToken=t.accessToken:delete v.accessToken,v}function Tg(t){const i=t==null?void 0:t.trim();if(!i)throw new Error("supabaseUrl is required.");if(!i.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Ag(i))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Bg=class extends fg{constructor(t){super(t)}},Ig=class{constructor(t,i,o){var n,s;this.supabaseUrl=t,this.supabaseKey=i;const r=Tg(t);if(!i)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const a=`sb-${r.hostname.split(".")[0]}-auth-token`,u={db:yg,realtime:jg,auth:Pt(Pt({},vg),{},{storageKey:a}),global:bg},h=Fg(o??{},u);if(this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=h.global.headers)!==null&&s!==void 0?s:{},h.accessToken)this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(j,C)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(C)} is not possible`)}});else{var b;this.auth=this._initSupabaseAuthClient((b=h.auth)!==null&&b!==void 0?b:{},this.headers,h.global.fetch)}this.fetch=Eg(i,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Pt({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(j=>this.realtime.setAuth(j)).catch(j=>console.warn("Failed to set initial Realtime auth token:",j)),this.rest=new mp(new URL("rest/v1",r).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch,timeout:h.db.timeout,urlLengthLimit:h.db.urlLengthLimit}),this.storage=new cu(this.storageUrl.href,this.headers,this.fetch,o==null?void 0:o.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new dp(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,i={},o={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,i,o)}channel(t,i={config:{}}){return this.realtime.channel(t,i)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,i,o;if(t.accessToken)return await t.accessToken();const{data:n}=await t.auth.getSession();return(i=(o=n.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:o,storage:n,userStorage:s,storageKey:r,flowType:a,lock:u,debug:h,throwOnError:b},j,C){const v={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Bg({url:this.authUrl.href,headers:Pt(Pt({},v),j),storageKey:r,autoRefreshToken:t,persistSession:i,detectSessionInUrl:o,storage:n,userStorage:s,flowType:a,lock:u,debug:h,throwOnError:b,fetch:C,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Mp(this.realtimeUrl.href,Pt(Pt({},t),{},{params:Pt(Pt({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,i)=>{this._handleTokenChanged(t,"CLIENT",i==null?void 0:i.access_token)})}_handleTokenChanged(t,i,o){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==o?(this.changedAccessToken=o,this.realtime.setAuth(o)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Rg=(t,i,o)=>new Ig(t,i,o);function Mg(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const i=t.version;if(i==null)return!1;const o=i.match(/^v(\d+)\./);return o?parseInt(o[1],10)<=18:!1}Mg()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const _g="https://xlzkasdskatnikuavefh.supabase.co",Dg="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM",In=Rg(_g,Dg),Rn="kv_store";let uo="habitaris",ui={},El=!1;const Fe={async init(t="habitaris",i=null){uo=t;try{const{data:o,error:n}=await In.from(Rn).select("key, value").eq("tenant_id",uo);!n&&o&&(ui={},o.forEach(s=>{ui[s.key]=s.value}),o.forEach(s=>console.log("[store] key:",s.key,"size:",(s.value||"").length)),console.log(`[store] Loaded ${o.length} keys for tenant ${uo}`))}catch(o){console.warn("[store] Preload failed, starting with empty cache:",o.message)}El=!0},getSync(t){const i=ui[t]??null;return i!==null&&typeof i!="string"?JSON.stringify(i):i},async get(t){if(t in ui)return ui[t];try{const{data:i,error:o}=await In.from(Rn).select("value").eq("tenant_id",uo).eq("key",t).single();if(!o&&i)return ui[t]=i.value,i.value}catch(i){console.warn(`[store] get(${t}) failed:`,i.message)}return null},set(t,i){ui[t]=i,In.from(Rn).upsert({tenant_id:uo,key:t,value:i,updated_at:new Date().toISOString()},{onConflict:"tenant_id,key"}).then(({error:o})=>{o&&console.warn(`[store] set(${t}) cloud error:`,o.message)})},async delete(t){delete ui[t];const{error:i}=await In.from(Rn).delete().eq("tenant_id",uo).eq("key",t);i&&console.warn(`[store] delete(${t}) error:`,i.message)},async list(t=""){const i=Object.keys(ui).filter(o=>o.startsWith(t)).map(o=>({key:o,value:ui[o]}));if(i.length>0)return{keys:i.map(o=>o.key),items:i};try{const{data:o,error:n}=await In.from(Rn).select("key, value").eq("tenant_id",uo).like("key",`${t}%`);if(!n&&o)return o.forEach(s=>{ui[s.key]=s.value}),{keys:o.map(s=>s.key),items:o}}catch(o){console.warn(`[store] list(${t}) error:`,o.message)}return{keys:[],items:[]}},listSync(t=""){const i=Object.entries(ui).filter(([o])=>o.startsWith(t)).map(([o,n])=>({key:o,value:n}));return{keys:i.map(o=>o.key),items:i}},get ready(){return El},get tenantId(){return uo},get cacheSize(){return Object.keys(ui).length}},$g="https://xlzkasdskatnikuavefh.supabase.co",Pg="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0MTkxNTMsImV4cCI6MjA1NTk5NTE1M30.kNYsPMsRB0GaxrF1VDqIMeGmxD_K43zQXJIFMn1KlHk",Gd=Fc($g,Pg);async function Og(t){const{data:i,error:o}=await Gd.from("offer_portals").select("*").eq("token",t).single();return o?null:i}async function Lg(t,i,o=""){const{data:n,error:s}=await Gd.from("offer_portals").update({status:i,client_comments:o,client_responded_at:new Date().toISOString()}).eq("token",t).select().single();if(s)throw console.error("respondPortal:",s),s;return n}const Wg="habitaris_config",Al="https://xlzkasdskatnikuavefh.supabase.co",Fl="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM";function An(){try{const t=(()=>null)(Wg);return{url:Al,key:Fl}}catch{return{url:Al,key:Fl}}}function Fn(t){return{apikey:t,Authorization:`Bearer ${t}`,"Content-Type":"application/json",Prefer:"return=representation"}}async function qa(t,i=""){const o=An();if(!o)return null;try{const n=await fetch(`${o.url}/rest/v1/${t}?${i}`,{headers:Fn(o.key)});return n.ok?await n.json():null}catch{return null}}async function br(t,i){const o=An();if(!o)return null;try{const n=await fetch(`${o.url}/rest/v1/${t}`,{method:"POST",headers:Fn(o.key),body:JSON.stringify(i)});return n.ok?await n.json():(console.warn("Supabase insert error:",n.status),null)}catch(n){return console.warn("Supabase insert error:",n),null}}async function Ha(t,i,o){const n=An();if(!n)return null;try{const s=await fetch(`${n.url}/rest/v1/${t}?${i}`,{method:"PATCH",headers:Fn(n.key),body:JSON.stringify(o)});return s.ok?await s.json():null}catch{return null}}async function Ng(){const t=An();if(!t)return{ok:!1,error:"URL o clave no configuradas"};try{const i=await fetch(`${t.url}/rest/v1/`,{headers:Fn(t.key)});return i.ok?{ok:!0}:{ok:!1,error:`Error HTTP ${i.status}`}}catch(i){return{ok:!1,error:i.message}}}async function Ug(){const t=An();if(!t)return{ok:!1,error:"Configura Supabase primero"};const i=`
    -- Form events (opens, views, time tracking)
    CREATE TABLE IF NOT EXISTS form_events (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      event_type TEXT NOT NULL DEFAULT 'open',
      link_id TEXT,
      client_name TEXT,
      client_email TEXT,
      duration_seconds INTEGER DEFAULT 0,
      user_agent TEXT,
      ip TEXT,
      metadata JSONB DEFAULT '{}'
    );

    -- Form responses (actual submitted data)
    CREATE TABLE IF NOT EXISTS form_responses (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      link_id TEXT,
      client_name TEXT,
      client_email TEXT,
      client_tel TEXT,
      module TEXT DEFAULT 'general',
      data JSONB DEFAULT '{}',
      processed BOOLEAN DEFAULT false,
      processed_at TIMESTAMPTZ,
      notes TEXT
    );

    -- Form links (track each shared link)
    CREATE TABLE IF NOT EXISTS form_links (
      id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
      created_at TIMESTAMPTZ DEFAULT now(),
      form_id TEXT NOT NULL,
      form_name TEXT,
      link_id TEXT UNIQUE NOT NULL,
      client_name TEXT,
      client_email TEXT,
      max_uses INTEGER DEFAULT 0,
      current_uses INTEGER DEFAULT 0,
      expires_at TIMESTAMPTZ,
      active BOOLEAN DEFAULT true
    );

    -- Enable RLS but allow anon access (simple setup)
    ALTER TABLE form_events ENABLE ROW LEVEL SECURITY;
    ALTER TABLE form_responses ENABLE ROW LEVEL SECURITY;
    ALTER TABLE form_links ENABLE ROW LEVEL SECURITY;

    -- Policies: allow all for anon (single-tenant app)
    DO $$ BEGIN
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_events') THEN
        CREATE POLICY anon_all_events ON form_events FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_responses') THEN
        CREATE POLICY anon_all_responses ON form_responses FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
      IF NOT EXISTS (SELECT 1 FROM pg_policies WHERE policyname = 'anon_all_links') THEN
        CREATE POLICY anon_all_links ON form_links FOR ALL TO anon USING (true) WITH CHECK (true);
      END IF;
    END $$;
  `;try{return(await fetch(`${t.url}/rest/v1/rpc/exec_sql`,{method:"POST",headers:Fn(t.key),body:JSON.stringify({query:i})})).ok?{ok:!0}:await Tl(t)}catch{return await Tl(t)}}async function Tl(t){const i=["form_events","form_responses","form_links"],o=[];for(const n of i)try{(await fetch(`${t.url}/rest/v1/${n}?select=id&limit=1`,{headers:Fn(t.key)})).ok||o.push(n)}catch{o.push(n)}return o.length===0?{ok:!0,msg:"Tablas ya existen"}:{ok:!1,error:"manual_sql",missing:o,sql:Ta()}}function Ta(){return`-- Ejecuta esto en Supabase  SQL Editor  New Query  Run

CREATE TABLE IF NOT EXISTS form_events (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  event_type TEXT NOT NULL DEFAULT 'open',
  link_id TEXT,
  client_name TEXT,
  client_email TEXT,
  duration_seconds INTEGER DEFAULT 0,
  user_agent TEXT,
  metadata JSONB DEFAULT '{}'
);

CREATE TABLE IF NOT EXISTS form_responses (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  link_id TEXT,
  client_name TEXT,
  client_email TEXT,
  client_tel TEXT,
  module TEXT DEFAULT 'general',
  data JSONB DEFAULT '{}',
  processed BOOLEAN DEFAULT false,
  processed_at TIMESTAMPTZ,
  notes TEXT
);

CREATE TABLE IF NOT EXISTS form_links (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT now(),
  form_id TEXT NOT NULL,
  form_name TEXT,
  link_id TEXT UNIQUE NOT NULL,
  client_name TEXT,
  client_email TEXT,
  client_tel TEXT,
  max_uses INTEGER DEFAULT 0,
  current_uses INTEGER DEFAULT 0,
  expires_at TIMESTAMPTZ,
  active BOOLEAN DEFAULT true
);

-- Habilitar RLS
ALTER TABLE form_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE form_responses ENABLE ROW LEVEL SECURITY;
ALTER TABLE form_links ENABLE ROW LEVEL SECURITY;

-- Polticas de acceso
CREATE POLICY anon_all_events ON form_events FOR ALL TO anon USING (true) WITH CHECK (true);
CREATE POLICY anon_all_responses ON form_responses FOR ALL TO anon USING (true) WITH CHECK (true);
CREATE POLICY anon_all_links ON form_links FOR ALL TO anon USING (true) WITH CHECK (true);
`}async function Vg(t,i,o,n,s){return br("form_events",{form_id:t,form_name:i,event_type:"open",link_id:o||null,client_name:n||null,client_email:s||null,user_agent:navigator.userAgent||null})}async function Bl(t,i,o){return br("form_events",{form_id:t,event_type:"close",link_id:i||null,duration_seconds:Math.round(o)})}async function qg(t,i,o,n,s){return br("form_events",{form_id:t,form_name:i,event_type:"submit",link_id:o||null,client_name:n||null,client_email:s||null})}async function Hg(t){return br("form_responses",t)}async function Gg(){return qa("form_responses","order=created_at.desc&limit=500")}async function Kg(t){return br("form_links",t)}async function Kd(t){const i=await qa("form_links",`link_id=eq.${t}&limit=1`);return i&&i.length>0?i[0]:null}async function Jg(t){const i=await Kd(t);return i?Ha("form_links",`link_id=eq.${t}`,{current_uses:(i.current_uses||0)+1}):null}async function Yg(t){return Ha("form_links",`link_id=eq.${t}`,{active:!1})}async function Xg(t){return Ha("form_links",`link_id=eq.${t}`,{active:!0})}async function Qg(){return qa("form_links","order=created_at.desc")}function Ui(){return An()!==null}const st={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",border:"#E0E0E0",success:"#111111",successBg:"#E8F4EE",accent:"#3B3B3B",accentBg:"#F0F0F0",gold:"#C9A84C"},Oi={fontFamily:"'DM Sans',sans-serif"};function Zg(){try{const t=window.location.hash.slice(1);return t?JSON.parse(decodeURIComponent(atob(t))):null}catch{return null}}function Jd(t){try{return btoa(encodeURIComponent(JSON.stringify(t)))}catch{return""}}function Il({campo:t,value:i,onChange:o,accent:n,allVals:s}){const{tipo:r,label:a,placeholder:u,required:h}=t,b=n||st.ink,j={...Oi,fontSize:12,fontWeight:600,color:st.ink,display:"block",marginBottom:6},C={...Oi,width:"100%",padding:"12px 16px",border:"1px solid "+st.border,borderRadius:8,fontSize:14,color:st.ink,boxSizing:"border-box",background:"#fff",outline:"none"};let v=t.opciones||[],m=a;if(t.dynamicOpciones&&s){const f=s[t.dynamicOpciones.dependsOn]||"",p=t.dynamicOpciones.map[f];p?v=p:t.dynamicOpciones.fallback?v=t.dynamicOpciones.fallback:v=[]}if(t.dynamicLabel&&s){const f=s[t.dynamicLabel.dependsOn]||"",p=t.dynamicLabel.map[f];p&&(m=p)}if(r==="tel_combo"&&s){const f=t.paisRef||"",p=s[f]||"",c={Colombia:"+57",Espaa:"+34",Mxico:"+52",Chile:"+56",Per:"+51",Ecuador:"+593",Argentina:"+54",Panam:"+507","Estados Unidos":"+1",Otro:"+"},d="_cod_"+t.id,l=s[d]||c[p]||"+57",x=t.opciones||["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"];return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("select",{value:l,onChange:y=>o(i,y.target.value),style:{...C,width:90,flexShrink:0,borderRadius:"8px 0 0 8px",borderRight:"none",fontWeight:700,fontSize:13,color:"#3B3B3B",background:"#F5F4F1"},children:x.map(y=>e.jsx("option",{value:y,children:y},y))}),e.jsx("input",{type:"tel",value:i||"",onChange:y=>o(y.target.value),placeholder:u||"",style:{...C,flex:1,borderRadius:"0 8px 8px 0"}})]})]})}if(["text","email","tel","number","date"].includes(r))return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("input",{type:r,value:i||"",onChange:f=>o(f.target.value),placeholder:u||"",style:C})]});if(r==="textarea")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("textarea",{value:i||"",onChange:f=>o(f.target.value),rows:3,placeholder:u||"",style:{...C,resize:"vertical"}})]});if(r==="select"||r==="rango")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsxs("select",{value:i||"",onChange:f=>o(f.target.value),style:C,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),(v||[]).map(f=>e.jsx("option",{value:f,children:f},f))]})]});if(r==="chips"){const f=Array.isArray(i)?i:[];return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:6},children:(v||[]).map(p=>{const c=f.includes(p);return e.jsx("button",{type:"button",onClick:()=>o(c?f.filter(d=>d!==p):[...f,p]),style:{...Oi,padding:"8px 16px",fontSize:12,fontWeight:c?700:400,borderRadius:20,border:c?"2px solid "+b:"1px solid "+st.border,background:c?b:"#fff",color:c?"#fff":st.inkMid,cursor:"pointer",transition:"all .15s"},children:p},p)})})]})}if(r==="radio")return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginTop:6},children:(v||[]).map(f=>e.jsxs("label",{style:{...Oi,display:"flex",alignItems:"center",gap:10,fontSize:13,cursor:"pointer",padding:"10px 14px",borderRadius:8,background:i===f?b:"#fff",color:i===f?"#fff":st.ink,border:i===f?"2px solid "+b:"1px solid "+st.border,transition:"all .15s"},children:[e.jsx("input",{type:"radio",checked:i===f,onChange:()=>o(f),style:{display:"none"}}),f]},f))})]});if(r==="rating"){const f=parseInt(i)||0;return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:6},children:[1,2,3,4,5].map(p=>e.jsx("button",{type:"button",onClick:()=>o(p),style:{background:"none",border:"none",cursor:"pointer",fontSize:32,filter:p<=f?"none":"grayscale(1)",opacity:p<=f?1:.3},children:""},p))})]})}return r==="yesno"?e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:j,children:[m,h&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginTop:6},children:["S","No"].map(f=>e.jsx("button",{type:"button",onClick:()=>o(f),style:{...Oi,padding:"12px 32px",fontSize:14,fontWeight:i===f?700:400,borderRadius:24,border:i===f?"2px solid "+b:"1px solid "+st.border,background:i===f?b:"#fff",color:i===f?"#fff":st.inkMid,cursor:"pointer",transition:"all .15s",flex:1,textAlign:"center"},children:f},f))})]}):r==="info"?e.jsx("div",{style:{marginBottom:20,padding:"14px 18px",background:st.accentBg,borderRadius:8,border:"1px solid "+st.accent+"22"},children:e.jsx("p",{style:{...Oi,fontSize:12,color:st.accent,margin:0,lineHeight:1.6},children:m})}):r==="seccion"?e.jsxs("div",{style:{marginTop:28,marginBottom:14,paddingTop:18,borderTop:"2px solid "+b},children:[e.jsx("h3",{style:{...Oi,fontSize:15,fontWeight:700,color:st.ink,margin:0},children:m}),t.desc&&e.jsx("p",{style:{...Oi,fontSize:11,color:st.inkLight,margin:"4px 0 0"},children:t.desc})]}):null}function eh(){var je,V;const[t,i]=F.useState(null),[o,n]=F.useState({}),[s,r]=F.useState(!1),[a,u]=F.useState(""),[h,b]=F.useState(0),[j,C]=F.useState("next"),[v,m]=F.useState(0),[f,p]=F.useState(null),c=F.useRef(null),d=F.useRef(Date.now());if(F.useEffect(()=>{i(Zg())},[]),F.useEffect(()=>{var me;if(!t)return;const te=t.campos||[],ce=t.cliente||null;if(ce){const le={};te.forEach(be=>{ce.email&&be.mapKey==="email"&&(le[be.id]=ce.email),ce.nombre&&be.mapKey==="nombre"&&(le[be.id]=ce.nombre),ce.tel&&be.mapKey==="telefono"&&(le[be.id]=ce.tel)}),n(be=>({...le,...be}))}const pe=((me=t.config)==null?void 0:me.paisProyecto)||"Colombia",_={};te.forEach(le=>{le.mapKey==="pais"&&(_[le.id]=pe)}),n(le=>({..._,...le}));const ae=t.linkConfig||{};if(ae.blocked){p("blocked");return}if(ae.fechaCaducidad&&new Date(ae.fechaCaducidad)<new Date){p("expired");return}if(ae.maxUsos&&ae.maxUsos>0){const le="hab_link_uses_"+(ae.linkId||t.id||"");if(parseInt(Fe.getSync(le)||"0")>=ae.maxUsos){p("maxuses");return}}const Be=ae.linkId;Be&&Ui()&&Kd(Be).then(le=>{if(le){if(!le.active){p("inactive");return}if(le.expires_at&&new Date(le.expires_at)<new Date){p("expired");return}if(le.max_uses>0&&le.current_uses>=le.max_uses){p("maxuses");return}}}).catch(()=>{}),d.current=Date.now(),Ui()&&Vg(t.id,t.nombre,ae.linkId,ce==null?void 0:ce.nombre,ce==null?void 0:ce.email).catch(()=>{});const Q=()=>{const le=Math.round((Date.now()-d.current)/1e3);Ui()&&Bl(t.id,ae.linkId,le).catch(()=>{})};return window.addEventListener("beforeunload",Q),()=>window.removeEventListener("beforeunload",Q)},[t]),!t)return e.jsxs("div",{style:{minHeight:"100vh",background:st.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');"}),e.jsxs("div",{style:{background:st.surface,borderRadius:12,padding:40,maxWidth:400,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:40,marginBottom:16},children:""}),e.jsx("h2",{style:{...Oi,fontSize:18,fontWeight:700,color:st.ink},children:"Formulario no disponible"}),e.jsx("p",{style:{...Oi,fontSize:13,color:st.inkMid,marginTop:8},children:"Este enlace no es vlido o ha expirado."})]})]});if(f){const te={expired:{icon:"",title:"Formulario expirado",desc:"La fecha de caducidad de este formulario ha pasado. Contacta a quien te lo envi."},maxuses:{icon:"",title:"Lmite de envos alcanzado",desc:"Este formulario ya fue completado el nmero mximo de veces permitido."},inactive:{icon:"",title:"Enlace desactivado",desc:"Este enlace ha sido desactivado. Contacta a quien te lo envi."},blocked:{icon:"",title:"Formulario bloqueado",desc:"Este formulario ha sido bloqueado por el remitente. Si crees que es un error, contacta a quien te lo envi."}},ce=te[f]||te.expired,pe=((je=t==null?void 0:t.marca)==null?void 0:je.tipografia)||"DM Sans";return e.jsxs("div",{style:{minHeight:"100vh",background:st.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${pe.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:st.surface,borderRadius:12,padding:40,maxWidth:400,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[((V=t==null?void 0:t.marca)==null?void 0:V.logo)&&e.jsx("img",{src:t.marca.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:ce.icon}),e.jsx("h2",{style:{fontFamily:`'${pe}',sans-serif`,fontSize:18,fontWeight:700,color:st.ink},children:ce.title}),e.jsx("p",{style:{fontFamily:`'${pe}',sans-serif`,fontSize:13,color:st.inkMid,marginTop:8,lineHeight:1.6},children:ce.desc})]})]})}const l=t.campos||[],x=t.config||{},y=t.cliente||null,g=t.marca||{},S=x.colorAccent||g.colorPrimario||"#111111",A=g.colorSecundario||"#3B3B3B",E=g.colorAcento||"#C9A84C",w=g.tipografia||"DM Sans",I={fontFamily:`'${w}',sans-serif`},z=x.vista||"pasos",B=x.botonTexto||"Enviar formulario",P=(te,ce)=>{n(pe=>({...pe,[te]:ce})),u("")},q=te=>U(te)?$(te)?he(te):te.tipo==="tel_combo"?e.jsx(Il,{campo:te,value:o[te.id],onChange:(ce,pe)=>{pe!==void 0?P("_cod_"+te.id,pe):P(te.id,ce)},accent:S,allVals:o},te.id):e.jsx(Il,{campo:te,value:o[te.id],onChange:ce=>P(te.id,ce),accent:S,allVals:o},te.id):null,U=te=>{if(!te.logica||!te.logica.fieldId||!te.logica.value&&!te.logica.notValues&&!te.logica.notValue)return!0;const ce=o[te.logica.fieldId];if(te.logica.notValues)return!te.logica.notValues.includes(String(ce||""));if(te.logica.notValue)return String(ce||"")!==te.logica.notValue;const pe=te.logica.value;return Array.isArray(ce)?ce.includes(pe):String(ce||"")===pe},$=te=>y?!!(y.email&&te.mapKey==="email"||y.nombre&&te.mapKey==="nombre"||y.tel&&y.tel.trim()&&(te.mapKey==="telefono"||te.tipo==="tel_combo")||te.mapKey==="pais"):te.mapKey==="pais",Y=[],ge=l.find(te=>te.mapKey==="aceptaPrivacidad"),J=l.find(te=>te.tipo==="info"&&te.label&&te.label.includes("Aviso de Privacidad"));ge&&Y.push({title:"Aviso de Privacidad",desc:"Antes de comenzar, necesitamos tu autorizacin",icon:"",fields:[J,ge].filter(Boolean),isPrivacy:!0});let ye={title:x.titulo||t.nombre||"Formulario",desc:x.subtitulo||"",icon:"",fields:[]};l.forEach(te=>{te.id===(ge&&ge.id)||te.id===(J&&J.id)||(te.tipo==="seccion"?(ye.fields.length>0&&Y.push(ye),ye={title:te.label,desc:te.desc||"",icon:"",fields:[]}):ye.fields.push(te))}),ye.fields.length>0&&Y.push(ye);const oe=Y.filter(te=>te.isPrivacy||te.fields.some(ce=>U(ce)));if(ge&&o[ge.id]==="No")return e.jsxs("div",{style:{minHeight:"100vh",background:st.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${w.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:st.surface,borderRadius:12,padding:40,maxWidth:480,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[g.logo&&e.jsx("img",{src:g.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),e.jsx("h2",{style:{...I,fontSize:20,fontWeight:700,color:st.ink},children:"Gracias por tu tiempo"}),e.jsx("p",{style:{...I,fontSize:13,color:st.inkMid,lineHeight:1.6,marginTop:8},children:"Para continuar necesitamos tu autorizacin para el tratamiento de datos personales."})]})]});const R=!ge||o[ge.id]==="S"?h:0,T=oe.length,W=oe[R]||oe[0],X=R>=T-1,M=l.filter(te=>te.required&&te.tipo!=="seccion"&&te.tipo!=="info").length,O=l.filter(te=>te.required&&te.tipo!=="seccion"&&te.tipo!=="info"&&o[te.id]&&(Array.isArray(o[te.id])?o[te.id].length>0:!0)).length,ne=M>0?Math.round(O/M*100):0,ie=T>1?Math.round(R/(T-1)*100):0,re=(te,ce)=>{C(ce||"next"),m(pe=>pe+1),b(te),u(""),c.current&&c.current.scrollIntoView({behavior:"smooth"})},H=()=>{if(!W)return!0;for(const te of W.fields)if(U(te)&&te.required&&te.tipo!=="seccion"&&te.tipo!=="info"){const ce=o[te.id];if(!ce||Array.isArray(ce)&&ce.length===0)return u('El campo "'+te.label+'" es obligatorio.'),!1}return!0},se=()=>{for(const te of l)if(U(te)&&te.required&&te.tipo!=="seccion"&&te.tipo!=="info"){const ce=o[te.id];if(!ce||Array.isArray(ce)&&ce.length===0)return u('El campo "'+te.label+'" es obligatorio.'),!1}return!0},N=()=>{H()&&(X?ue():re(R+1,"next"))},G=()=>{R>0&&re(R-1,"prev")},ue=async()=>{if(z==="pasos"&&!H()||z==="scroll"&&!se())return;const te=t.linkConfig||{},ce={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36)};ce.fecha=new Date().toISOString().split("T")[0],ce.formularioId=t.id,ce.formularioNombre=t.nombre,y&&(ce.clienteNombre=y.nombre,ce.clienteEmail=y.email,ce.clienteTel=y.tel);const pe=l.find(_=>_.tipo==="tel_combo");if(pe&&o[pe.id]){const _=(o["_cod_"+pe.id]||"")+" "+o[pe.id];ce.clienteTel=ce.clienteTel||_,pe.mapKey&&(ce[pe.mapKey]=o[pe.id]),pe.codMapKey&&(ce[pe.codMapKey]=o["_cod_"+pe.id]||"")}l.forEach(_=>{_.tipo!=="seccion"&&o[_.id]!==void 0&&(ce[_.mapKey||_.id]=o[_.id]),_.tipo==="tel_combo"&&_.codMapKey&&(ce[_.codMapKey]=o["_cod_"+_.id]||"")});try{const _="hab:briefing:"+ce.id;Fe.set(_,JSON.stringify(ce))}catch{}try{const _="hab:form:responses";let ae=[];try{const Be=Fe.getSync(_);Be&&(ae=JSON.parse(Be))}catch{}ae.push({id:ce.id,formId:t.id,fecha:ce.fecha,nombre:ce.nombre||ce.email||""}),Fe.set(_,JSON.stringify(ae))}catch{}if(Ui())try{await Hg({form_id:t.id,form_name:t.nombre,link_id:te.linkId||null,client_name:(y==null?void 0:y.nombre)||ce.clienteNombre||null,client_email:(y==null?void 0:y.email)||ce.clienteEmail||null,client_tel:(y==null?void 0:y.tel)||ce.clienteTel||null,module:t.modulo||x.modulo||"general",data:ce}),await qg(t.id,t.nombre,te.linkId,y==null?void 0:y.nombre,y==null?void 0:y.email);const _=Math.round((Date.now()-d.current)/1e3);_>0&&await Bl(t.id,te.linkId,_).catch(()=>{}),te.linkId&&await Jg(te.linkId)}catch(_){console.warn("Supabase save error:",_)}if(te.maxUsos&&te.maxUsos>0){const _="hab_link_uses_"+(te.linkId||t.id||""),ae=parseInt(Fe.getSync(_)||"0");Fe.set(_,String(ae+1))}r(!0);try{const _=l.filter(Te=>{var $e;return($e=Te.scoring)==null?void 0:$e.enabled});let ae="";if(_.length>0){let Te=0,$e=0,Ye=0,bt=0,Ct=0;const ft=[];_.forEach(Gt=>{const ci=Gt.scoring.weight||1,Qa=Gt.mapKey||Gt.id;let eo=o[Gt.id];if(eo===void 0)return;$e+=ci;const kr=Gt.scoring.rules||{};let K="neutral";if(Array.isArray(eo)){const St=eo.map(Tt=>kr[Tt]||"neutral");St.includes("red")?K="red":St.every(Tt=>Tt==="green")?K="green":K="neutral"}else K=kr[String(eo)]||"neutral";let Me=K==="green"?ci:K==="neutral"?ci*.5:0;Te+=Me,K==="green"?Ye++:K==="red"?bt++:Ct++;const We=K==="green"?"":K==="red"?"":"",tt=K==="green"?"#111111":K==="red"?"#B91C1C":"#8C6A00",gt=Array.isArray(eo)?eo.join(", "):eo;ft.push(`<tr><td style="padding:5px 10px;font-size:11px;font-weight:600;">${Gt.label}</td><td style="padding:5px 10px;font-size:11px;">${gt}</td><td style="padding:5px 10px;text-align:center;font-weight:700;color:${tt};">${Me}/${ci}</td><td style="padding:5px 10px;text-align:center;">${We}</td></tr>`)});const wi=$e>0?Math.round(Te/$e*100)/10:0,di=wi>=7?"green":wi>=4?"yellow":"red",Zi={green:{bg:"#E8F4EE",text:"#111111"},yellow:{bg:"#FAF0E0",text:"#8C6A00"},red:{bg:"#FAE8E8",text:"#B91C1C"}}[di],Sr=di==="green"?" Cliente potencial":di==="yellow"?" Revisar":" No califica",Cr=di==="green"?"Contactar en las prximas 24h.":di==="yellow"?"Agendar llamada exploratoria.":"Responder cortsmente y archivar.";ae=`<div style="margin:16px 0;border:1px solid ${Zi.text}33;border-radius:8px;overflow:hidden;">
          <div style="display:flex;align-items:center;gap:14px;padding:14px 16px;background:${Zi.bg};">
            <div style="font-size:24px;font-weight:800;color:${Zi.text};">${wi.toFixed(1)}/10</div>
            <div><div style="font-size:13px;font-weight:700;color:${Zi.text};">${Sr}</div><div style="font-size:9px;color:${Zi.text};">${Cr}</div></div>
            <div style="margin-left:auto;display:flex;gap:8px;"><span>${Ye}</span><span>${Ct}</span><span>${bt}</span></div>
          </div>
          <table style="width:100%;border-collapse:collapse;">${ft.join("")}</table>
        </div>`}let Be=ae,Q="";l.forEach(Te=>{if(Te.tipo==="seccion"){Q=Te.label,Be+=`<div style="margin-top:16px;padding:10px 14px;background:#F5F5F5;border-radius:6px;border-left:3px solid #C9A84C;">
            <p style="margin:0;font-size:12px;font-weight:bold;color:#111;">${Te.label}</p>
            ${Te.desc?`<p style="margin:2px 0 0;font-size:10px;color:#888;">${Te.desc}</p>`:""}
          </div>`;return}if(Te.tipo==="info")return;const $e=o[Te.id];if($e===void 0||$e===""||Array.isArray($e)&&$e.length===0)return;const Ye=Array.isArray($e)?$e.join(", "):$e;Be+=`<div style="padding:8px 14px;border-bottom:1px solid #f0f0f0;">
          <p style="margin:0;font-size:10px;color:#888;font-weight:600;">${Te.label}</p>
          <p style="margin:3px 0 0;font-size:13px;color:#111;">${Ye}</p>
        </div>`});const me=(y==null?void 0:y.nombre)||ce.clienteNombre||ce.nombre||"Sin nombre",le=(y==null?void 0:y.email)||ce.clienteEmail||ce.email||"",be=(y==null?void 0:y.tel)||ce.clienteTel||ce.telefono||"";await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:"service_6x3478l",template_id:"template_6lla2i8",user_id:"64nk2FHknwpLqc1p4",template_params:{form_name:t.nombre||"Formulario",client_name:me,client_email:le,client_tel:be,fecha:ce.fecha+"  "+new Date().toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}),contenido:Be}})})}catch(_){console.warn("Email notification error:",_)}};if(s)return e.jsxs("div",{style:{minHeight:"100vh",background:st.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${w.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:st.surface,borderRadius:12,padding:40,maxWidth:480,textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,.08)"},children:[g.logo&&e.jsx("img",{src:g.logo,alt:"Logo",style:{height:32,objectFit:"contain",marginBottom:12}}),e.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),e.jsx("h2",{style:{...I,fontSize:20,fontWeight:700,color:st.success,margin:"0 0 8px"},children:"Enviado!"}),e.jsx("p",{style:{...I,fontSize:13,color:st.inkMid,lineHeight:1.6},children:x.mensajeExito||"Gracias por completar el formulario."}),g.empresa&&e.jsxs("p",{style:{...I,fontSize:10,color:st.inkLight,marginTop:16},children:[g.empresa,g.slogan?`  ${g.slogan}`:""]})]})]});const he=te=>{if(te.tipo==="tel_combo"){const ce=o["_cod_"+te.id]||"+57";return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:{...I,fontSize:12,fontWeight:600,color:st.ink,display:"block",marginBottom:6},children:[te.label," ",e.jsx("span",{style:{fontSize:9,color:A,fontWeight:400},children:" prellenado"})]}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("div",{style:{...I,width:90,flexShrink:0,padding:"12px 0",border:`1px solid ${A}33`,borderRadius:"8px 0 0 8px",borderRight:"none",fontSize:14,color:A,background:A+"15",fontWeight:700,textAlign:"center"},children:ce}),e.jsx("input",{type:"text",value:o[te.id]||"",disabled:!0,style:{...I,flex:1,padding:"12px 16px",border:`1px solid ${A}33`,borderRadius:"0 8px 8px 0",fontSize:14,color:A,boxSizing:"border-box",background:A+"15",fontWeight:600}})]})]},te.id)}return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("label",{style:{...I,fontSize:12,fontWeight:600,color:st.ink,display:"block",marginBottom:6},children:[te.label," ",e.jsx("span",{style:{fontSize:9,color:A,fontWeight:400},children:" prellenado"})]}),e.jsx("input",{type:"text",value:o[te.id]||"",disabled:!0,style:{...I,width:"100%",padding:"12px 16px",border:`1px solid ${A}33`,borderRadius:8,fontSize:14,color:A,boxSizing:"border-box",background:A+"15",fontWeight:600}})]},te.id)},we=()=>e.jsxs("div",{style:{background:S,padding:"14px 24px"},children:[e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[g.logo?e.jsx("img",{src:g.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("div",{style:{...I,fontWeight:700,fontSize:14,letterSpacing:3,color:"#fff",textTransform:"uppercase"},children:g.empresa||"HABITARIS"}),g.slogan&&e.jsx("div",{style:{...I,fontSize:7,letterSpacing:2,color:"rgba(255,255,255,.4)",textTransform:"uppercase"},children:g.slogan})]}),e.jsx("div",{style:{...I,fontSize:10,color:"rgba(255,255,255,.5)"},children:z==="pasos"?"Paso "+(R+1)+" de "+T:ne+"% completo"})]}),e.jsx("div",{style:{maxWidth:640,margin:"8px auto 0",height:3,background:"rgba(255,255,255,.15)",borderRadius:2},children:e.jsx("div",{style:{width:(z==="pasos"?ie:ne)+"%",height:"100%",background:E,borderRadius:2,transition:"width .4s ease"}})})]}),Ve=()=>!y||z==="pasos"&&R!==(ge?1:0)?null:e.jsxs("div",{style:{background:A+"15",border:`1px solid ${A}22`,borderRadius:10,padding:"14px 18px",marginBottom:20,display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:A,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,flexShrink:0},children:(y.nombre||"?")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{style:{...I,fontSize:13,fontWeight:700,color:A},children:["Formulario para: ",y.nombre||y.email]}),y.email&&e.jsx("div",{style:{...I,fontSize:10,color:A+"99"},children:y.email})]})]}),Ee=()=>a?e.jsxs("div",{style:{...I,fontSize:12,color:"#B91C1C",textAlign:"center",margin:"14px 0",padding:"10px 16px",background:"#FAE8E8",borderRadius:6,border:"1px solid #B91C1C22"},children:[" ",a]}):null;return z==="scroll"?e.jsxs("div",{style:{minHeight:"100vh",background:st.bg},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${w.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0}body{font-family:'${w}',sans-serif}input:focus,textarea:focus,select:focus{border-color:${S}!important;box-shadow:0 0 0 3px ${S}15}`}),e.jsx(we,{}),e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",padding:"28px 20px 100px"},children:[e.jsx(Ve,{}),e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("h1",{style:{...I,fontSize:22,fontWeight:700,margin:"0 0 6px"},children:x.titulo||t.nombre||"Formulario"}),x.subtitulo&&e.jsx("p",{style:{...I,fontSize:13,color:st.inkMid},children:x.subtitulo})]}),e.jsx("div",{style:{background:st.surface,borderRadius:12,padding:"28px 28px 12px",border:"1px solid "+st.border,boxShadow:"0 2px 16px rgba(0,0,0,.04)"},children:l.map(te=>q(te))}),e.jsx(Ee,{})]}),e.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:st.surface,borderTop:"1px solid "+st.border,padding:"12px 20px",zIndex:200,boxShadow:"0 -4px 20px rgba(0,0,0,.06)"},children:e.jsx("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"center"},children:e.jsxs("button",{onClick:ue,style:{...I,padding:"14px 40px",background:S,color:"#fff",border:"none",borderRadius:8,fontSize:15,fontWeight:700,cursor:"pointer"},children:[B," "]})})})]}):e.jsxs("div",{style:{minHeight:"100vh",background:st.bg},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${w.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0}body{font-family:'${w}',sans-serif}@keyframes slideNext{from{opacity:0;transform:translateX(40px)}to{opacity:1;transform:translateX(0)}}@keyframes slidePrev{from{opacity:0;transform:translateX(-40px)}to{opacity:1;transform:translateX(0)}}.step-next{animation:slideNext .3s ease both}.step-prev{animation:slidePrev .3s ease both}input:focus,textarea:focus,select:focus{border-color:${S}!important;box-shadow:0 0 0 3px ${S}15}`}),e.jsx("div",{ref:c}),e.jsx(we,{}),e.jsx("div",{style:{maxWidth:640,margin:"0 auto",padding:"16px 20px 0"},children:e.jsx("div",{style:{display:"flex",gap:4,justifyContent:"center"},children:oe.map((te,ce)=>e.jsx("div",{style:{height:4,flex:1,maxWidth:40,borderRadius:2,background:ce<R?st.success:ce===R?S:st.border,transition:"background .3s"}},ce))})}),e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",padding:"20px 20px 140px"},children:[e.jsx(Ve,{}),e.jsxs("div",{className:j==="next"?"step-next":"step-prev",children:[e.jsxs("div",{style:{marginBottom:20},children:[W&&W.icon&&e.jsx("div",{style:{fontSize:28,marginBottom:4},children:W.icon}),e.jsx("h2",{style:{...I,fontSize:22,fontWeight:700,color:st.ink,margin:"0 0 4px"},children:W&&W.title}),W&&W.desc&&e.jsx("p",{style:{...I,fontSize:13,color:st.inkMid},children:W.desc})]}),e.jsx("div",{style:{background:st.surface,borderRadius:12,padding:"28px 28px 12px",border:"1px solid "+st.border,boxShadow:"0 2px 16px rgba(0,0,0,.04)"},children:W&&W.fields.map(te=>te.tipo==="seccion"?null:q(te))}),e.jsx(Ee,{})]},v)]}),e.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:st.surface,borderTop:"1px solid "+st.border,padding:"14px 20px",zIndex:200,boxShadow:"0 -4px 20px rgba(0,0,0,.06)"},children:e.jsxs("div",{style:{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[R>0?e.jsx("button",{onClick:G,style:{...I,padding:"12px 24px",background:"#fff",color:st.ink,border:"1px solid "+st.border,borderRadius:8,fontSize:13,fontWeight:600,cursor:"pointer"},children:" Atrs"}):e.jsx("div",{}),e.jsxs("div",{style:{...I,fontSize:10,color:st.inkLight},children:[R+1," / ",T]}),e.jsx("button",{onClick:N,style:{...I,padding:"12px 32px",background:S,color:"#fff",border:"none",borderRadius:8,fontSize:14,fontWeight:700,cursor:"pointer"},children:X?(B||"Enviar")+" ":"Siguiente "})]})})]})}const Rl=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 14px; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; color: #111; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
    input:focus, select:focus, textarea:focus { outline: none; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    .fade { animation: fadeUp .2s ease; }
    @media print {
      .no-print { display:none!important; visibility:hidden!important; height:0!important; overflow:hidden!important; margin:0!important; padding:0!important; }
      body { background:#fff!important; -webkit-print-color-adjust:exact; print-color-adjust:exact; margin:0; padding:0; font-size:10pt; line-height:1.55; color:#111; }
      * { box-shadow:none!important; animation:none!important; }
      @page { size:A4; margin:12mm 16mm 14mm 16mm; }
      main,[style*="marginLeft"]{ margin-left:0!important; max-width:100%!important; padding:0!important; }
      div[style*="position: fixed"],div[style*="position:fixed"]{ display:none!important; }
      div[style*="width: 200"],div[style*="width:200px"]{ display:none!important; width:0!important; }
      table { page-break-inside:auto; width:100%!important; border-collapse:collapse; font-size:9pt; }
      tr { page-break-inside:avoid; }
      h1,h2,h3 { page-break-after:avoid; }
      img { max-width:100%!important; }
      input,select { border:none!important; background:transparent!important; padding:1px 0!important; font-size:10pt!important; -webkit-appearance:none!important; color:#111!important; font-family:'DM Sans',sans-serif!important; }
      textarea { display:none!important; }
      .ptr { display:block!important; white-space:pre-wrap; font-size:10pt; line-height:1.55; color:#111; }
      button { display:none!important; }
      .print-only { display:block!important; }
      .print-flex { display:flex!important; }
      .print-page-break { page-break-before:always; }
      .print-section { page-break-inside:avoid; margin-bottom:10pt!important; }
      .p-cover { display:flex!important; flex-direction:column; justify-content:center; align-items:center; min-height:92vh; page-break-after:always; text-align:center; }
      .p-hdr { display:flex!important; justify-content:space-between; align-items:center; border-bottom:1.5pt solid #111; padding-bottom:6pt; margin-bottom:12pt; }
    }
    @media (max-width:1200px) {
      [style*="gridTemplateColumns: 1fr 1fr 1fr"]{ grid-template-columns:1fr 1fr!important; }
    }
    @media (max-width:900px) {
      [style*="gridTemplateColumns: 1fr 1fr 1fr"],[style*="gridTemplateColumns: 1fr 1fr"]{ grid-template-columns:1fr!important; }
    }
    .print-only,.print-flex,.p-cover,.p-hdr,.ptr { display:none; }
  `}),k={bg:"#F5F4F1",surface:"#FFFFFF",sidebar:"#111111",sidebarHov:"#1C1C1C",sidebarAct:"#242424",ink:"#111111",inkMid:"#555555",inkLight:"#999999",inkXLight:"#BBBBBB",border:"#E0E0E0",borderMid:"#CCCAC4",accentBg:"#EDEBE7",success:"#2B7A52",successBg:"#E6F4EC",warning:"#8A6020",warningBg:"#FAF2E2",error:"#B91C1C",errorBg:"#FAE8E8",info:"#2A5F8C",infoBg:"#E8F1FA",shadow:"0 1px 2px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04)",shadowMd:"0 4px 20px rgba(0,0,0,0.10)",accent:"#111111",danger:"#B91C1C"},Ga=({size:t=34,color:i="#fff"})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"4.5",y:"2.5",width:"25",height:"25",stroke:i,strokeWidth:"0.7",opacity:"0.4"}),e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:i,strokeWidth:"1.1"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:i}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:i}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:i})]}),Bi=[{id:"arq_nueva",cod:"DAN",nombre:"Diseo arquitectnico obra nueva",descripcion:"Desarrollamos proyectos desde cero, acompaando al cliente desde la conceptualizacin hasta la documentacin tcnica completa.",alcances:["Reunin inicial","Levantamiento de informacin y anlisis del lote","Desarrollo de anteproyecto (plantas, cortes, fachadas conceptuales)","Modelado 3D y visualizaciones","Ajustes y desarrollo de proyecto arquitectnico definitivo","Planos tcnicos constructivos","Cuadro de reas","Especificaciones de materiales"],entregables:[{nombre:"Proceso creativo",horas:24},{nombre:"Planta arquitectnica propuesta",horas:24},{nombre:"Cortes longitudinal y transversal",horas:8},{nombre:"Fachadas",horas:8},{nombre:"Planta arquitectnica constructiva (cotas y niveles)",horas:8},{nombre:"Plano de instalaciones hidrulicas",horas:8},{nombre:"Planta arquitectnica cielo rasos",horas:8},{nombre:"Planta arquitectnica pisos y enchapes",horas:8},{nombre:"Planta de iluminacin y puntos elctricos",horas:24},{nombre:"Tabla de iluminacin",horas:24},{nombre:"Planos de carpinteras, detalles y despieces",horas:24},{nombre:"Detalles constructivos",horas:36},{nombre:"Plano de puertas y ventanas",horas:24},{nombre:"Tabla de acabados y especificaciones",horas:24},{nombre:"Memoria de calidades",horas:24},{nombre:"Modelado 3D",horas:32},{nombre:"Renderizado",horas:16}]},{id:"arq_reforma",cod:"DAR",nombre:"Diseo arquitectnico reforma",descripcion:"Intervenimos espacios existentes para transformarlos funcional y estticamente, optimizando distribucin, iluminacin y materialidad.",alcances:["Visita tcnica y levantamiento del estado actual","Diagnstico funcional y espacial","Propuesta de redistribucin arquitectnica","Modelado 3D del espacio intervenido","Planos tcnicos de reforma","Especificaciones de acabados","Detalles constructivos clave"],entregables:[{nombre:"Proceso creativo",horas:16},{nombre:"Planta arquitectnica levantamiento",horas:5},{nombre:"Planta arquitectnica propuesta",horas:8},{nombre:"Cortes longitudinal y transversal",horas:3},{nombre:"Planta arquitectnica demoliciones",horas:4},{nombre:"Planta arquitectnica constructiva (cotas y niveles)",horas:3},{nombre:"Plano de instalaciones hidrulicas",horas:2},{nombre:"Planta arquitectnica cielo rasos",horas:4},{nombre:"Planta arquitectnica pisos y enchapes",horas:6},{nombre:"Planta de iluminacin y puntos elctricos",horas:6},{nombre:"Tabla de iluminacin",horas:8},{nombre:"Planos de carpinteras, detalles y despieces",horas:8},{nombre:"Detalles constructivos",horas:8},{nombre:"Plano de puertas y ventanas",horas:8},{nombre:"Tabla de acabados y especificaciones",horas:16},{nombre:"Memoria de calidades",horas:16},{nombre:"Modelado 3D",horas:24},{nombre:"Renderizado",horas:16}]},{id:"interiorismo",cod:"DIN",nombre:"Diseo de interiores",descripcion:"Transforma espacios en experiencias habitables, funcionales y emocionalmente coherentes. Integra funcin, esttica, tcnica y bienestar.",alcances:["Concepto creativo y moodboard","Propuesta de distribucin de mobiliario","Seleccin de materiales, acabados y paleta cromtica","Diseo de iluminacin (ambiental, funcional y decorativa)","Diseo de mobiliario a medida (si aplica)","Modelado 3D","Lista de compras y especificaciones"],entregables:[{nombre:"Proceso creativo",horas:5},{nombre:"Planta arquitectnica levantamiento",horas:3},{nombre:"Cortes longitudinal y transversal",horas:1},{nombre:"Planta de iluminacin y puntos elctricos",horas:1},{nombre:"Tabla de iluminacin",horas:2},{nombre:"Planos de carpinteras, detalles y despieces",horas:3},{nombre:"Plano de amueblamiento",horas:2},{nombre:"Moodboard",horas:1},{nombre:"Biofilia",horas:2},{nombre:"Tabla de mobiliario",horas:6},{nombre:"Lista de compras",horas:5},{nombre:"Modelado 3D",horas:6},{nombre:"Renderizado",horas:6}]},{id:"obra_integral",cod:"OBR",nombre:"Obra integral",descripcion:"Gestionamos y ejecutamos el proyecto completo, garantizando coherencia entre diseo y construccin.",alcances:["Direccin y supervisin de obra","Coordinacin de proveedores y contratistas","Control de calidad y acabados","Cronograma de ejecucin","Control de presupuesto","Seguimiento tcnico permanente","Entrega final con revisin detallada"],entregables:[]},{id:"consultoria",cod:"CON",nombre:"Consultora",descripcion:"Asesoramiento personalizado por horas segn las necesidades especficas del proyecto.",alcances:[],entregables:[]}],Ba=["Proyecto Arquitectnico Completo","Proyecto Interiorismo","Proyecto Interiorismo Espacio"],th=[{nombre:"Planta arquitectnica levantamiento",arq:5,int:3,esp:2},{nombre:"Planta arquitectnica propuesta",arq:8,int:5,esp:2},{nombre:"Cortes longitudinal y transversal",arq:3,int:2,esp:1},{nombre:"Fachadas",arq:3,int:0,esp:0},{nombre:"Planta arquitectnica demoliciones",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica constructiva / cotas",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica cielo rasos",arq:2,int:2,esp:1},{nombre:"Planta arquitectnica pisos y enchapes",arq:2,int:2,esp:1},{nombre:"Planta de iluminacin y puntos elctricos",arq:4,int:3,esp:1},{nombre:"Tabla de iluminacin",arq:5,int:3,esp:2},{nombre:"Planos de carpinteras, detalles y despieces",arq:8,int:6,esp:3},{nombre:"Detalles constructivos",arq:8,int:6,esp:2},{nombre:"Plano de puertas y ventanas",arq:8,int:4,esp:2},{nombre:"Plano de amueblamiento",arq:4,int:4,esp:2},{nombre:"Moodboard",arq:3,int:2,esp:1},{nombre:"Tabla de acabados y especificaciones",arq:16,int:8,esp:6},{nombre:"Lista de compras / FF&E",arq:8,int:8,esp:5},{nombre:"Memoria de calidades",arq:8,int:6,esp:3},{nombre:"Modelado 3D",arq:24,int:16,esp:8},{nombre:"Renderizado",arq:8,int:6,esp:3}],Yd=()=>th.map(t=>({nombre:t.nombre,incluir:!1,cant:1,horasArq:t.arq,horasInt:t.int,horasEsp:t.esp})),Ir=[{grupo:"DISEO",cod:"DAN",label:"Diseo arquitectnico  Obra nueva"},{grupo:"DISEO",cod:"DAR",label:"Diseo arquitectnico  Reforma parcial"},{grupo:"DISEO",cod:"DIN",label:"Diseo de interiores"},{grupo:"DISEO",cod:"DBI",label:"Biointeriorismo"},{grupo:"EJECUCIN",cod:"REF",label:"Reforma parcial"},{grupo:"EJECUCIN",cod:"RIN",label:"Reforma integral"},{grupo:"EJECUCIN",cod:"ONV",label:"Obra nueva (ejecucin)"},{grupo:"DIRECCIN / CONTROL",cod:"SUP",label:"Supervisin presencial"},{grupo:"DIRECCIN / CONTROL",cod:"SUO",label:"Supervisin online"},{grupo:"SERVICIOS COMPLEMENTARIOS",cod:"ASC",label:"Asesora de compras"}],_s=[{val:"apartamento",label:"Apartamento",ph1:"Nombre del edificio",ph2:"Ej: Apto 403"},{val:"casa_conjunto",label:"Casa en conjunto",ph1:"Nombre del conjunto",ph2:"Ej: Casa 12"},{val:"casa_independiente",label:"Casa independiente",ph1:"Nombre del lugar",ph2:"Ej: La Colina"},{val:"local",label:"Local / Oficina",ph1:"Nombre del edificio",ph2:"Ej: Local 201"},{val:"otro",label:"Otro",ph1:"Lugar / Referencia",ph2:"Referencia adicional"}],Ml=(t,i="01",o=0)=>{const n=new Date,s=String(n.getFullYear()).slice(2),r=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0"),u=`R${String(o).padStart(2,"0")}`;return`${t}_${s}${r}${a}_${String(i).padStart(2,"0")}_${u}`},Xd=(t,i,o)=>{if(!i&&!o)return"";const n=(i==null?void 0:i.trim())||"",s=(o==null?void 0:o.trim())||"";return!n&&!s?"":s?n?`${n}  ${s}`:s:n},Ka=["Borrador","Presentada","En revisin","Ganada","Perdida","Cancelada"],_l={Borrador:{bg:"#EDEBE7",txt:"#777"},Presentada:{bg:k.infoBg,txt:k.info},"En revisin":{bg:k.warningBg,txt:k.warning},Ganada:{bg:k.successBg,txt:k.success},Perdida:{bg:k.errorBg,txt:k.error},Cancelada:{bg:"#EDE8F0",txt:"#826B82"}},ih={actividadCod:"DIN",digitoControl:"01",revision:0,codigoOferta:"",tipoInmueble:"apartamento",lugarNombre:"",lugarReferencia:"",cliente:"",proyecto:"",ubicacion:"",estado:"Borrador",notas:"",relacionadaCon:null,emailCliente:"",telCliente:"",fechaInicio:"",fechaEntrega:"",firmaRepresentante:"David Parra Galera",elaboradoPor:"",tipoProyecto:"OBRA",subtipoDiseno:Ba[1],servicioId:"interiorismo",tarifaIVA:.19,margen:.25,uDecl:.1,uDeclMode:"auto",modoCalcObra:"margen",aiuA:.08,aiuI:.03,aiuU:.07,tipoCliente:"PN",medioPago:"PSE",aplicar4x1000:"SI",pctRCE:.007,pctTRC:.007,pctAdm:.002,pctICA:.009,pctReteFuente:0,pctReteICA:0,pctReteIVA:0,costosDirectos:[],entregablesOferta:[],apuSalarioAnual:0,apuPrestaciones:.65,apuHDia:8,apuDiasSem:5,apuSemanas:52,apuPctProductivas:.6,apuLicencias:0,apuEquipos:0,apuAccesorios:0,apuIndirectos:0,apuModoHora:"AUTO",apuCostoHoraManual:0,planos:Yd(),pais:"CO",divisa:"COP",borradorLineas:[],pctU:.07,gg:.13,bi:.06,orgNodos:[],glosarioOferta:[],entregaConfig:{incluirAlcance:!0,incluirEntregables:!0,incluirCronograma:!0,incluirOrganigrama:!1,incluirGlosario:!0,incluirTerminos:!0,incluirCondicionesPago:!0,incluirDesglosePrecio:!1,terminosCondiciones:`Los plazos indicados son estimados y podrn ajustarse segn la complejidad del desarrollo.
Los cambios solicitados fuera del alcance descrito se cotizarn por separado.
La propuesta tiene una validez indicada en este documento.
El inicio de los trabajos est sujeto al pago del anticipo acordado.`},matProveedores:[],matCotizaciones:{},ofertaEquipos:[]};function Jn(t){const{tarifaIVA:i,margen:o,tipoProyecto:n,subtipoDiseno:s,medioPago:r,aplicar4x1000:a,pctRCE:u,pctTRC:h,pctAdm:b,pctICA:j,pctReteFuente:C,pctReteICA:v,pctReteIVA:m,costosDirectos:f=[],apuSalarioAnual:p,apuPrestaciones:c,apuHDia:d,apuDiasSem:l,apuSemanas:x,apuPctProductivas:y,apuLicencias:g,apuEquipos:S,apuAccesorios:A,apuIndirectos:E,apuModoHora:w,apuCostoHoraManual:I,planos:z=[]}=t,B=d*l*x*y,P=p*(1+c)+Number(g)+Number(S)+Number(A)+Number(E),q=w==="MANUAL"?Number(I):B>0?P/B:0,U=V=>s===Ba[0]?V.horasArq:s===Ba[1]?V.horasInt:V.horasEsp,$=z.filter(V=>V.incluir).reduce((V,te)=>V+Number(te.cant)*U(te),0),Y=$*q,ge=f.filter(V=>V.tipo==="M").reduce((V,te)=>V+(parseFloat(te.valor)||0),0),J=f.filter(V=>V.tipo==="MO").reduce((V,te)=>V+(parseFloat(te.valor)||0),0),ye=f.filter(V=>V.tipo==="SUB").reduce((V,te)=>V+(parseFloat(te.valor)||0),0),oe=(t.borradorLineas||[]).filter(V=>!V.esCapitulo).reduce((V,te)=>V+(te.precioCD||0),0),R=oe>0?oe:ge+J+ye+(n==="DISEO"?Y:0),T=t.ivaComision??.19;let W=0;r==="PSE"?W=(t.pctComPSE??.012)*(1+T):r==="Tarjeta"?W=(t.pctComTarjeta??.036)*(1+T):r==="Transferencia"?W=(t.pctComTransf??0)*(1+T):r==="Manual"&&(W=t.pctComManual??0);const M=W+(a==="SI"?.004:0),O=u+h+b+j,ne=t.modoCalcObra||"margen",ie=t.ggPct||0;let re,H,se,N,G,ue;if(n==="OBRA"&&(t.pais||"CO")==="CO"&&ne==="aiu"){const V=t.aiuA??.08,te=t.aiuI??.03,ce=t.aiuU??.07,pe=V+te+ce,_=R*(1+pe);H=1-O,se=1-M;const ae=H*se;re=ae>0?_/ae:0,N=ae>0?(1+pe)/ae:0,G=ce,ue=pe}else{H=1-o-O-ie,se=1-M;const V=H*se;re=V>0?R/V:0,N=V>0?1/V:0,G=n==="OBRA"?t.uDecl??o:o,ue=o}const he=H*se,we=n==="OBRA"?G*re*i:re*i,Ve=re+we,Ee=(C+v+m)*re,je=n==="OBRA"&&ne==="aiu"?re-R-O*re-M*re:ue*re;return{COSTO:R,costoDis:Y,cdM:ge,cdMO:J,cdSB:ye,f:M,g:O,ggPct:ie,den:he,den1:H,denGF:se,coefMult:N,U:G,margenEfectivo:ue,hAnio:B,estr:P,costoH:q,hDis:$,PVP:re,IVA:we,PVP_IVA:Ve,GC:O*re,GG:ie*re,ICA:j*re,fin:M*re,margenCOP:je,ret:Ee,neto:Ve-Ee}}const Ft=(t,i=0)=>t==null||isNaN(t)?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:i,minimumFractionDigits:i}).format(t),pt=t=>`${(t*100).toFixed(2)}%`,zt=()=>Math.random().toString(36).substr(2,9),qt=()=>new Date().toISOString().split("T")[0];async function oh(){try{const t=Fe.getSync("hab:v4");return t?JSON.parse(t):[]}catch{return[]}}async function Ds(t){try{Fe.set("hab:v4",JSON.stringify(t))}catch(i){console.error(i)}}async function ps(){try{return Fe.listSync("hab:briefing:").items.map(i=>{try{return JSON.parse(i)}catch{return null}}).filter(Boolean).sort((i,o)=>new Date(o.fecha||0)-new Date(i.fecha||0))}catch{return[]}}function Ia(t){try{Fe.set("hab:briefing:"+t.id,JSON.stringify(t))}catch{}}async function nh(t){try{Fe.delete("hab:briefing:"+t)}catch{}}function Ra(t){var i,o,n,s;return{cliente:t.nombre||"",emailCliente:t.email||"",telCliente:(t.telefono||"").replace(/^\+57\s*/,""),ubicacion:[t.ciudad,t.edificio].filter(Boolean).join("  ")||"",proyecto:[t.edificio,(i=t.nombre)==null?void 0:i.split(" ").slice(-1)[0]].filter(Boolean).join("  ")||"",estado:"Prospecto",notas:[(o=t.estilo)!=null&&o.length?`Estilo: ${Array.isArray(t.estilo)?t.estilo.join(", "):t.estilo}`:"",(n=t.espacios)!=null&&n.length?`Espacios: ${Array.isArray(t.espacios)?t.espacios.join(", "):t.espacios}`:"",t.colores_materiales?`Materiales: ${t.colores_materiales}`:"",(s=t.que_esperas)!=null&&s.length?`Expectativas: ${Array.isArray(t.que_esperas)?t.que_esperas.join("; "):t.que_esperas}`:"",t.links_ref?`Referencias: ${t.links_ref}`:""].filter(Boolean).join(`
`),razonSocial:t.razon_social||"",documento:t.documento||"",emailFactura:t.email_factura||t.email||"",dirFacturacion:t.dir_facturacion||"",retencion:t.retenciones==="S",detalleRet:t.detalle_retenciones||"",anticipoAcept:t.anticipo||"",formaPago:t.forma_pago||"",fechaInicio:t.fecha_inicio||"",fechaEntrega:t.plazo||"",lugarNombre:t.edificio||"",briefingId:t.id}}function Qd(t){return{id:Math.random().toString(36).slice(2,9),nombre:t.razon_social||t.nombre||"",tipo:t.razon_social?"Empresa":"Persona natural",nit:t.documento||"",email:t.email||"",telMovil:(t.telefono||"").replace(/^\+57\s*/,""),prefijoMovil:"+57",ciudad:t.ciudad||"",pais:"CO",notas:[t.edificio?`Proyecto: ${t.edificio}`:"",t.tipo_proyecto?`Tipo: ${t.tipo_proyecto}`:"",t.area_m2?`rea: ${t.area_m2} m`:"",t.presupuesto?`Presupuesto: $ ${Number(t.presupuesto).toLocaleString("es-CO")}`:"",t.como_conociste?`Canal: ${t.como_conociste}`:""].filter(Boolean).join(" | "),emailFactura:t.email_factura||t.email||"",dirFacturacion:t.dir_facturacion||"",razonSocial:t.razon_social||"",retenciones:t.retenciones||"",detalleRet:t.detalle_retenciones||"",formaPago:t.forma_pago||"",anticipo:t.anticipo||"",direccion:t.direccion_proyecto||"",fechaInicio:t.fecha_inicio||"",fechaEntrega:t.plazo||"",lugarNombre:t.edificio||"",briefingId:t.id,fechaAlta:new Date().toISOString().split("T")[0]}}const Ma=({e:t})=>{const i=_l[t]||_l.Borrador;return e.jsx("span",{style:{background:i.bg,color:i.txt,padding:"3px 10px",borderRadius:2,fontSize:10,fontWeight:600,letterSpacing:.8,textTransform:"uppercase",display:"inline-block",whiteSpace:"nowrap",fontFamily:"'DM Sans', sans-serif"},children:t})},rt=({children:t,style:i,...o})=>e.jsx("div",{style:{background:k.surface,borderRadius:3,boxShadow:k.shadow,border:`1px solid ${k.border}`,...i},...o,children:t}),ht=({children:t,v:i="pri",on:o,icon:n,sm:s,style:r,dis:a,...u})=>{const h={display:"inline-flex",alignItems:"center",gap:6,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontWeight:500,cursor:a?"not-allowed":"pointer",transition:"all .15s",border:"none",fontSize:s?11:12,padding:s?"5px 11px":"9px 16px",letterSpacing:.4,opacity:a?.5:1,...r},b={pri:{background:k.ink,color:"#fff"},sec:{background:k.accentBg,color:k.ink},ghost:{background:"transparent",color:k.inkMid},danger:{background:k.errorBg,color:k.error},out:{background:"transparent",color:k.ink,border:`1px solid ${k.borderMid}`}};return e.jsxs("button",{style:{...h,...b[i]},onClick:o,disabled:a,...u,children:[n&&e.jsx(n,{size:s?12:13}),t]})},ot=({lbl:t,val:i,on:o,type:n="text",ph:s,rt:r,note:a,step:u,min:h,style:b})=>{const[j,C]=F.useState(String(i??"")),[v,m]=F.useState(!1);return F.useEffect(()=>{v||C(String(i??""))},[i,v]),e.jsxs("div",{style:{marginBottom:14},children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1,fontFamily:"'DM Sans', sans-serif"},children:t}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:n,value:j,placeholder:s,step:u,min:h,onChange:f=>{C(f.target.value),o(f)},style:{width:"100%",padding:"9px 12px",paddingRight:r?38:12,border:`1px solid ${k.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:k.ink,background:k.bg,transition:"border .15s",...b},onFocus:f=>{m(!0),f.target.style.borderColor=k.ink,f.target.select()},onBlur:f=>{m(!1),f.target.style.borderColor=k.border}}),r&&e.jsx("span",{style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",fontSize:11,color:k.inkLight},children:r})]}),a&&e.jsx("p",{style:{fontSize:10,color:k.inkLight,margin:"3px 0 0"},children:a})]})},mn=({lbl:t,val:i,on:o,opts:n,note:s})=>e.jsxs("div",{style:{marginBottom:14},children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:t}),e.jsx("select",{value:i,onChange:o,style:{width:"100%",padding:"9px 12px",border:`1px solid ${k.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:k.ink,background:k.bg},onFocus:r=>r.target.style.borderColor=k.ink,onBlur:r=>r.target.style.borderColor=k.border,children:n.map(r=>e.jsx("option",{value:r.v??r,children:r.l??r},r.v??r))}),s&&e.jsx("p",{style:{fontSize:10,color:k.inkLight,margin:"3px 0 0"},children:s})]}),Mt=({t,s:i})=>e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h3",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:15,fontWeight:600,color:k.ink,margin:0,letterSpacing:.2,textTransform:"uppercase"},children:t}),i&&e.jsx("p",{style:{fontSize:11,color:k.inkLight,margin:"3px 0 0",fontWeight:400},children:i})]}),Rr=({lbl:t,val:i,icon:o,col:n,sub:s})=>e.jsx(rt,{style:{padding:"18px 20px",flex:1,minWidth:150},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,fontWeight:600,color:k.inkLight,margin:"0 0 8px",textTransform:"uppercase",letterSpacing:1.5},children:t}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:22,fontWeight:700,color:n,margin:0},children:i}),s&&e.jsx("p",{style:{fontSize:10,color:k.inkLight,margin:"4px 0 0"},children:s})]}),e.jsx("div",{style:{background:`${n}15`,borderRadius:2,padding:8},children:e.jsx(o,{size:15,color:n})})]})}),Zd=[{key:"nombre",lbl:"Nombre",icon:""},{key:"email",lbl:"Email",icon:""},{key:"telefono",lbl:"Telfono",icon:""},{key:"como_conociste",lbl:"Cmo nos conoci?",icon:""},{key:"ciudad",lbl:"Ciudad",icon:""},{key:"edificio",lbl:"Edificio / Conjunto",icon:""},{key:"direccion_proyecto",lbl:"Direccin proyecto",icon:""},{key:"tipo_proyecto",lbl:"Tipo de proyecto",icon:""},{key:"area_m2",lbl:"rea (m)",icon:""},{key:"num_habitaciones",lbl:"Habitaciones / reas",icon:""},{key:"estilo",lbl:"Estilo preferido",icon:""},{key:"colores_materiales",lbl:"Colores y materiales",icon:""},{key:"espacios",lbl:"Espacios a intervenir",icon:""},{key:"fecha_inicio",lbl:"Fecha tentativa inicio",icon:""},{key:"plazo",lbl:"Plazo de finalizacin",icon:""},{key:"presupuesto",lbl:"Presupuesto (COP)",icon:""},{key:"financiacion",lbl:"Financiacin",icon:""},{key:"lo_mas_importante",lbl:"Prioridad principal",icon:""},{key:"que_esperas",lbl:"Qu espera lograr?",icon:""},{key:"contratistas",lbl:"Recomendar contratistas?",icon:""},{key:"forma_pago",lbl:"Forma de pago",icon:""},{key:"razon_social",lbl:"Razn social",icon:""},{key:"documento",lbl:"Documento",icon:""},{key:"email_factura",lbl:"Email facturacin",icon:""},{key:"dir_facturacion",lbl:"Direccin facturacin",icon:""},{key:"retenciones",lbl:"Retenciones especiales",icon:""},{key:"detalle_retenciones",lbl:"Detalle retenciones",icon:""}];function rh({b:t,onClose:i,onCreateOffer:o,onCreateClient:n}){const s=(a,u)=>!u||u===""?"":Array.isArray(u)?u.join(", "):a==="presupuesto"?`$ ${Number(u).toLocaleString("es-CO")} COP`:String(u),r=Zd.filter(a=>t[a.key]&&t[a.key]!=="");return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:a=>a.target===a.currentTarget&&i(),children:e.jsxs("div",{style:{background:k.surface,borderRadius:4,width:"100%",maxWidth:680,maxHeight:"85vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:k.shadowMd},children:[e.jsxs("div",{style:{padding:"18px 22px",borderBottom:`1px solid ${k.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:16,fontWeight:700,margin:0},children:t.nombre||"Sin nombre"}),e.jsxs("p",{style:{fontSize:11,color:k.inkLight,margin:"3px 0 0",letterSpacing:.5},children:["Briefing recibido  ",t.fecha||"","  ",t.ciudad||""]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[n&&e.jsx("button",{onClick:n,style:{padding:"8px 16px",background:k.infoBg,color:k.info,border:`1px solid ${k.info}33`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:700,cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"+ Crear cliente"}),e.jsx("button",{onClick:o,style:{padding:"8px 16px",background:k.ink,color:"#fff",border:"none",borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:700,cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"+ Crear oferta"}),e.jsx("button",{onClick:i,style:{padding:"8px 12px",background:"transparent",border:`1px solid ${k.border}`,borderRadius:3,cursor:"pointer",color:k.inkMid},children:e.jsx(Ot,{size:14})})]})]}),e.jsxs("div",{style:{overflowY:"auto",padding:"18px 22px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:r.map(a=>e.jsxs("div",{style:{padding:"10px 12px",background:k.bg,borderRadius:3,border:`1px solid ${k.border}`},children:[e.jsxs("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 4px"},children:[a.icon," ",a.lbl]}),e.jsx("p",{style:{fontSize:13,fontWeight:500,color:k.ink,margin:0,lineHeight:1.4},children:s(a.key,t[a.key])})]},a.key))}),t.links_ref&&e.jsxs("div",{style:{marginTop:10,padding:"10px 12px",background:k.infoBg,borderRadius:3,border:`1px solid ${k.info}22`},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:k.info,margin:"0 0 4px"},children:" Links de referencia"}),e.jsx("p",{style:{fontSize:12,color:k.ink,margin:0,wordBreak:"break-all"},children:t.links_ref})]})]})]})})}async function sh(){try{return Fe.listSync("hab:forms:").items.map(i=>{try{return JSON.parse(i)}catch{return null}}).filter(Boolean).sort((i,o)=>(o.updatedAt||"").localeCompare(i.updatedAt||""))}catch{return[]}}function ah(t){try{t.updatedAt=new Date().toISOString(),Fe.set(`hab:forms:${t.id}`,JSON.stringify(t))}catch{}}async function lh(t){try{Fe.delete(`hab:forms:${t}`)}catch{}}const Mr=()=>Math.random().toString(36).slice(2,8),dh=[{nombre:"Briefing Diseo Interior",desc:"Formulario completo para proyectos de diseo",icon:"",config:{titulo:"Cuntanos sobre tu proyecto",subtitulo:"Solo toma 5-7 minutos. Tus respuestas nos ayudan a preparar una propuesta personalizada.",mensajeExito:"Gracias! Nos pondremos en contacto pronto con tu propuesta.",telRespuesta:"573183818736"},campos:[{tipo:"seccion",label:"Datos personales",icon:"",desc:"Informacin de contacto"},{tipo:"text",label:"Nombre completo",required:!0,mapKey:"nombre"},{tipo:"email",label:"Correo electrnico",required:!0,mapKey:"email"},{tipo:"tel",label:"WhatsApp / Celular",required:!0,mapKey:"telefono"},{tipo:"select",label:"Cmo nos conociste?",mapKey:"como_conociste",opciones:["Instagram","Google","Referido","Pgina web","Evento","Otro"]},{tipo:"seccion",label:"Tu proyecto",icon:""},{tipo:"text",label:"Ciudad",required:!0,mapKey:"ciudad"},{tipo:"text",label:"Edificio / Conjunto",mapKey:"edificio"},{tipo:"text",label:"Direccin del proyecto",mapKey:"direccion_proyecto"},{tipo:"select",label:"Tipo de proyecto",required:!0,mapKey:"tipo_proyecto",opciones:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"]},{tipo:"number",label:"rea aproximada (m)",mapKey:"area_m2"},{tipo:"text",label:"Nmero de habitaciones o reas",mapKey:"num_habitaciones"},{tipo:"seccion",label:"Estilo y preferencias",icon:""},{tipo:"chips",label:"Estilos que te gustan",mapKey:"estilo",opciones:["Moderno","Contemporneo","Minimalista","Industrial","Nrdico","Clsico","Rstico","Eclctico","Japandi","Otro"]},{tipo:"chips",label:"Espacios a intervenir",mapKey:"espacios",opciones:["Sala","Comedor","Cocina","Hab. principal","Hab. secundaria","Bao social","Bao privado","Estudio","Terraza/Balcn","Lavandera"]},{tipo:"textarea",label:"Colores y materiales que te gustan",mapKey:"colores_materiales",placeholder:"Ej: tonos clidos, madera natural, mrmol..."},{tipo:"textarea",label:"Links de referencia (Pinterest, Instagram...)",mapKey:"links_ref",placeholder:"Pega aqu los links de inspiracin"},{tipo:"seccion",label:"Presupuesto y tiempos",icon:""},{tipo:"rango",label:"Presupuesto aproximado",mapKey:"presupuesto",opciones:["Menos de $20M","$20M - $50M","$50M - $100M","$100M - $200M","Ms de $200M","An no definido"]},{tipo:"select",label:"Financiacin",mapKey:"financiacion",opciones:["Recursos propios","Crdito hipotecario","Leasing","Otro"]},{tipo:"date",label:"Fecha tentativa de inicio",mapKey:"fecha_inicio"},{tipo:"text",label:"Plazo deseado de finalizacin",mapKey:"plazo",placeholder:"Ej: 3 meses"},{tipo:"seccion",label:"Expectativas",icon:""},{tipo:"textarea",label:"Qu es lo ms importante para ti en este proyecto?",mapKey:"lo_mas_importante"},{tipo:"textarea",label:"Qu esperas lograr con el diseo?",mapKey:"que_esperas"},{tipo:"radio",label:"Necesitas que recomendemos contratistas?",mapKey:"contratistas",opciones:["S","No","Tal vez"]},{tipo:"seccion",label:"Facturacin (opcional)",icon:"",desc:"Solo si necesita factura"},{tipo:"text",label:"Razn social",mapKey:"razon_social"},{tipo:"text",label:"NIT / Cdula",mapKey:"documento"},{tipo:"email",label:"Email de facturacin",mapKey:"email_factura"},{tipo:"text",label:"Direccin de facturacin",mapKey:"dir_facturacion"},{tipo:"radio",label:"Tiene retenciones especiales?",mapKey:"retenciones",opciones:["No","S"]},{tipo:"radio",label:"Confirmo que la informacin es correcta",mapKey:"confirmacion",required:!0,opciones:["S"]}]},{nombre:"Briefing Obra / Remodelacin",desc:"Enfocado en construccin y remodelacin",icon:"",config:{titulo:"Cuntanos sobre tu obra",subtitulo:"Necesitamos algunos datos para preparar tu presupuesto.",mensajeExito:"Gracias! Te enviaremos el presupuesto pronto.",telRespuesta:"573183818736"},campos:[{tipo:"seccion",label:"Datos de contacto",icon:""},{tipo:"text",label:"Nombre completo",required:!0,mapKey:"nombre"},{tipo:"email",label:"Correo electrnico",required:!0,mapKey:"email"},{tipo:"tel",label:"WhatsApp / Celular",required:!0,mapKey:"telefono"},{tipo:"seccion",label:"La obra",icon:""},{tipo:"text",label:"Ciudad",required:!0,mapKey:"ciudad"},{tipo:"text",label:"Direccin de la obra",mapKey:"direccion_proyecto"},{tipo:"select",label:"Tipo de obra",required:!0,mapKey:"tipo_proyecto",opciones:["Remodelacin total","Remodelacin parcial","Obra nueva","Ampliacin","Adecuacin","Otro"]},{tipo:"number",label:"rea total (m)",mapKey:"area_m2"},{tipo:"chips",label:"reas a intervenir",mapKey:"espacios",opciones:["Estructura","Mampostera","Pisos","Cielos","Cocina","Baos","Instalaciones elctricas","Instalaciones hidrulicas","Pintura","Carpintera","Fachada"]},{tipo:"textarea",label:"Descripcin de lo que necesita",mapKey:"lo_mas_importante",placeholder:"Describe brevemente el alcance de la obra"},{tipo:"seccion",label:"Tiempos y presupuesto",icon:""},{tipo:"rango",label:"Presupuesto aproximado",mapKey:"presupuesto",opciones:["Menos de $30M","$30M - $80M","$80M - $150M","$150M - $300M","Ms de $300M","Sin definir"]},{tipo:"date",label:"Fecha deseada de inicio",mapKey:"fecha_inicio"},{tipo:"text",label:"Plazo esperado",mapKey:"plazo"},{tipo:"radio",label:"Ya tiene planos?",mapKey:"tiene_planos",opciones:["S","No","En proceso"]},{tipo:"radio",label:"Ya tiene permisos/licencias?",mapKey:"tiene_licencias",opciones:["S","No","En trmite","No s si aplica"]},{tipo:"seccion",label:"Facturacin",icon:""},{tipo:"text",label:"Razn social",mapKey:"razon_social"},{tipo:"text",label:"NIT / Cdula",mapKey:"documento"},{tipo:"email",label:"Email de facturacin",mapKey:"email_factura"}]},{nombre:"Encuesta de satisfaccin",desc:"Post-proyecto para feedback del cliente",icon:"",config:{titulo:"Cmo fue tu experiencia?",subtitulo:"Tu opinin nos ayuda a mejorar.",mensajeExito:"Gracias por tu feedback! Lo valoramos mucho.",telRespuesta:"573183818736"},campos:[{tipo:"text",label:"Nombre",required:!0,mapKey:"nombre"},{tipo:"text",label:"Proyecto",mapKey:"edificio"},{tipo:"radio",label:"Satisfaccin general",required:!0,mapKey:"satisfaccion",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Calidad del diseo",mapKey:"calidad_diseno",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Comunicacin del equipo",mapKey:"comunicacion",opciones:[" Excelente"," Buena"," Regular"," Mala"]},{tipo:"radio",label:"Cumplimiento de plazos",mapKey:"cumplimiento",opciones:[" Excelente"," Bueno"," Regular"," Malo"]},{tipo:"radio",label:"Nos recomendara?",required:!0,mapKey:"recomendaria",opciones:["Definitivamente s","Probablemente s","No estoy seguro","Probablemente no"]},{tipo:"textarea",label:"Qu fue lo mejor del proyecto?",mapKey:"lo_mejor"},{tipo:"textarea",label:"Qu podramos mejorar?",mapKey:"mejorar"},{tipo:"textarea",label:"Comentarios adicionales",mapKey:"comentarios"}]}],$s=[{tipo:"text",label:"Texto corto",icon:"Aa"},{tipo:"email",label:"Email",icon:"@"},{tipo:"tel",label:"Telfono",icon:""},{tipo:"number",label:"Nmero",icon:"#"},{tipo:"date",label:"Fecha",icon:""},{tipo:"textarea",label:"Texto largo",icon:""},{tipo:"select",label:"Desplegable",icon:""},{tipo:"radio",label:"Opcin nica",icon:""},{tipo:"chips",label:"Seleccin mlt.",icon:""},{tipo:"rango",label:"Rango",icon:""},{tipo:"seccion",label:"Separador",icon:""}];function ch(){var P,q,U,$,Y,ge;const[t,i]=F.useState([]),[o,n]=F.useState(!0),[s,r]=F.useState(null),[a,u]=F.useState(!1),[h,b]=F.useState(null),[j,C]=F.useState(""),[v,m]=F.useState(""),[f,p]=F.useState(""),[c,d]=F.useState(!1);F.useEffect(()=>{sh().then(J=>{i(J),n(!1)})},[]);const l=J=>{const ye={id:Mr()+Date.now().toString(36),nombre:J.nombre,config:{...J.config},campos:J.campos.map(oe=>({...oe,id:oe.id||Mr()})),createdAt:new Date().toISOString()};r(ye)},x=()=>{r({id:Mr()+Date.now().toString(36),nombre:"Nuevo formulario",config:{titulo:"",subtitulo:"",mensajeExito:"Gracias por tu respuesta!",telRespuesta:"573183818736"},campos:[],createdAt:new Date().toISOString()})},y=async()=>{s&&(await ah(s),i(J=>J.find(oe=>oe.id===s.id)?J.map(oe=>oe.id===s.id?s:oe):[s,...J]),r(null))},g=async J=>{window.confirm("Eliminar este formulario?")&&(await lh(J),i(ye=>ye.filter(oe=>oe.id!==J)))},S=J=>{const ye=Jd(J);return`${window.location.origin}/form#${ye}`},A=J=>{var ye;try{const oe=S(J);(ye=navigator.clipboard)==null||ye.writeText(oe),d(!0),setTimeout(()=>d(!1),2e3)}catch{}},E=J=>{var R;const ye=S(J),oe=`Hola${f?` ${f}`:""}!  Te invitamos a completar este formulario:

 ${((R=J.config)==null?void 0:R.titulo)||J.nombre}
${ye}

Gracias!`,L=j.replace(/\D/g,"");window.open(L?`https://wa.me/57${L}?text=${encodeURIComponent(oe)}`:`https://wa.me/?text=${encodeURIComponent(oe)}`,"_blank")},w=J=>{var R,T;const ye=S(J),oe=encodeURIComponent(((R=J.config)==null?void 0:R.titulo)||J.nombre),L=encodeURIComponent(`Hola${f?` ${f}`:""},

Te invitamos a completar este formulario:

${((T=J.config)==null?void 0:T.titulo)||J.nombre}
${ye}

Gracias!
Equipo Habitaris`);window.open(`mailto:${v}?subject=${oe}&body=${L}`,"_blank")},I={width:"100%",padding:"7px 10px",border:`1px solid ${k.border}`,borderRadius:4,fontFamily:"'DM Sans',sans-serif",fontSize:12,background:k.surface,color:k.ink,boxSizing:"border-box"},z={fontSize:9,fontWeight:600,color:k.inkLight,display:"block",marginBottom:4,textTransform:"uppercase",letterSpacing:1};if(s){const J=s,ye=W=>r(X=>({...X,...W})),oe=(W,X)=>r(M=>({...M,campos:M.campos.map((O,ne)=>ne===W?{...O,...X}:O)})),L=W=>r(X=>({...X,campos:X.campos.filter((M,O)=>O!==W)})),R=(W,X)=>r(M=>{const O=[...M.campos],ne=W+X;return ne<0||ne>=O.length?M:([O[W],O[ne]]=[O[ne],O[W]],{...M,campos:O})}),T=W=>{var M;const X={id:Mr(),tipo:W,label:((M=$s.find(O=>O.tipo===W))==null?void 0:M.label)||W,required:!1,mapKey:""};["select","radio","chips","rango"].includes(W)&&(X.opciones=["Opcin 1","Opcin 2"]),W==="seccion"&&(X.icon="",X.desc=""),r(O=>({...O,campos:[...O.campos,X]}))};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("button",{onClick:()=>{window.confirm("Descartar cambios?")&&r(null)},style:{background:"none",border:"none",cursor:"pointer",color:k.inkMid,padding:4},children:e.jsx(hd,{size:18})}),e.jsxs("div",{children:[e.jsx("input",{value:J.nombre,onChange:W=>ye({nombre:W.target.value}),style:{border:"none",fontSize:18,fontWeight:700,fontFamily:"'DM Sans',sans-serif",background:"transparent",width:320},placeholder:"Nombre del formulario"}),e.jsxs("p",{style:{fontSize:10,color:k.inkLight,margin:0},children:[J.campos.length," campos"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(ht,{v:"out",on:()=>u(!a),children:a?" Editar":" Preview"}),e.jsx(ht,{icon:yt,on:y,children:"Guardar formulario"})]})]}),!a&&e.jsx(rt,{style:{padding:16,marginBottom:16,borderLeft:`3px solid ${k.info}`},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Ttulo visible al cliente"}),e.jsx("input",{value:((P=J.config)==null?void 0:P.titulo)||"",onChange:W=>ye({config:{...J.config,titulo:W.target.value}}),style:I,placeholder:"Cuntanos sobre tu proyecto"})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Subttulo"}),e.jsx("input",{value:((q=J.config)==null?void 0:q.subtitulo)||"",onChange:W=>ye({config:{...J.config,subtitulo:W.target.value}}),style:I,placeholder:"Solo toma 5 minutos"})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Mensaje al enviar"}),e.jsx("input",{value:((U=J.config)==null?void 0:U.mensajeExito)||"",onChange:W=>ye({config:{...J.config,mensajeExito:W.target.value}}),style:I})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"WhatsApp de respuestas"}),e.jsx("input",{value:(($=J.config)==null?void 0:$.telRespuesta)||"",onChange:W=>ye({config:{...J.config,telRespuesta:W.target.value}}),style:I,placeholder:"573183818736"})]})]})}),a?e.jsxs(rt,{style:{padding:24,maxWidth:640,margin:"0 auto"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:20},children:[e.jsx("h2",{style:{fontSize:18,fontWeight:700,margin:"0 0 4px"},children:((Y=J.config)==null?void 0:Y.titulo)||J.nombre}),((ge=J.config)==null?void 0:ge.subtitulo)&&e.jsx("p",{style:{fontSize:12,color:k.inkMid},children:J.config.subtitulo})]}),J.campos.map((W,X)=>W.tipo==="seccion"?e.jsxs("div",{style:{marginTop:20,marginBottom:8,paddingTop:12,borderTop:`2px solid ${k.ink}`},children:[e.jsxs("h3",{style:{fontSize:13,fontWeight:700},children:[W.icon||""," ",W.label]}),W.desc&&e.jsx("p",{style:{fontSize:11,color:k.inkMid},children:W.desc})]},X):e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("label",{style:{fontSize:11,fontWeight:600,display:"block",marginBottom:4},children:[W.label,W.required&&e.jsx("span",{style:{color:"#B91C1C"},children:" *"})]}),["text","email","tel","number","date"].includes(W.tipo)&&e.jsx("input",{disabled:!0,style:{...I,opacity:.6},placeholder:W.placeholder||"",type:W.tipo}),W.tipo==="textarea"&&e.jsx("textarea",{disabled:!0,rows:2,style:{...I,opacity:.6,resize:"none"},placeholder:W.placeholder||""}),(W.tipo==="select"||W.tipo==="rango")&&e.jsx("select",{disabled:!0,style:{...I,opacity:.6},children:e.jsx("option",{children:(W.opciones||[])[0]||"..."})}),W.tipo==="radio"&&e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:2},children:(W.opciones||[]).map(M=>e.jsxs("label",{style:{fontSize:11,display:"flex",gap:4,alignItems:"center"},children:[e.jsx("input",{type:"radio",disabled:!0}),M]},M))}),W.tipo==="chips"&&e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:2},children:(W.opciones||[]).map(M=>e.jsx("span",{style:{padding:"3px 10px",fontSize:10,border:`1px solid ${k.border}`,borderRadius:20},children:M},M))})]},X))]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[J.campos.map((W,X)=>{var M;return e.jsxs(rt,{style:{padding:"10px 14px",borderLeft:W.tipo==="seccion"?`3px solid ${k.ink}`:`3px solid ${k.border}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2,alignItems:"center",paddingTop:2},children:[e.jsx("button",{onClick:()=>R(X,-1),disabled:X===0,style:{background:"none",border:"none",cursor:X>0?"pointer":"default",opacity:X>0?1:.3,fontSize:10,padding:0},children:""}),e.jsx("span",{style:{fontSize:8,color:k.inkLight,background:k.bg,borderRadius:2,padding:"1px 5px",letterSpacing:.5,textTransform:"uppercase"},children:((M=$s.find(O=>O.tipo===W.tipo))==null?void 0:M.icon)||"?"}),e.jsx("button",{onClick:()=>R(X,1),disabled:X===J.campos.length-1,style:{background:"none",border:"none",cursor:X<J.campos.length-1?"pointer":"default",opacity:X<J.campos.length-1?1:.3,fontSize:10,padding:0},children:""})]}),e.jsxs("div",{style:{flex:1,display:"grid",gridTemplateColumns:W.tipo==="seccion"?"1fr auto":"2fr 1fr 1fr auto",gap:6,alignItems:"center"},children:[e.jsx("input",{value:W.label,onChange:O=>oe(X,{label:O.target.value}),style:{...I,fontWeight:W.tipo==="seccion"?700:400,fontSize:W.tipo==="seccion"?13:12},placeholder:"Etiqueta"}),W.tipo!=="seccion"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{value:W.mapKey||"",onChange:O=>oe(X,{mapKey:O.target.value}),style:{...I,fontSize:10,fontFamily:"'DM Mono',monospace"},placeholder:"clave",title:"Clave para mapeo a briefing"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:10,color:k.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:!!W.required,onChange:O=>oe(X,{required:O.target.checked})}),"Obligatorio"]})]}),e.jsx("button",{onClick:()=>L(X),style:{background:"none",border:"none",cursor:"pointer",color:k.error,padding:2},children:e.jsx(Je,{size:12})})]})]}),["select","radio","chips","rango"].includes(W.tipo)&&e.jsxs("div",{style:{marginTop:6,marginLeft:28},children:[e.jsx("label",{style:{...z,marginBottom:3},children:"Opciones (una por lnea)"}),e.jsx("textarea",{value:(W.opciones||[]).join(`
`),onChange:O=>oe(X,{opciones:O.target.value.split(`
`)}),rows:Math.min((W.opciones||[]).length+1,6),style:{...I,fontSize:11,resize:"vertical"}})]}),["text","email","tel","number","textarea"].includes(W.tipo)&&e.jsx("div",{style:{marginTop:4,marginLeft:28},children:e.jsx("input",{value:W.placeholder||"",onChange:O=>oe(X,{placeholder:O.target.value}),style:{...I,fontSize:10,color:k.inkLight},placeholder:"Placeholder (opcional)"})}),W.tipo==="seccion"&&e.jsxs("div",{style:{marginTop:4,marginLeft:28,display:"flex",gap:6},children:[e.jsx("input",{value:W.icon||"",onChange:O=>oe(X,{icon:O.target.value}),style:{...I,width:40,textAlign:"center"},placeholder:""}),e.jsx("input",{value:W.desc||"",onChange:O=>oe(X,{desc:O.target.value}),style:{...I,flex:1,fontSize:10},placeholder:"Descripcin de la seccin"})]})]},W.id||X)}),e.jsxs(rt,{style:{padding:"12px 16px",background:k.bg,borderStyle:"dashed"},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 8px"},children:"Agregar campo"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:$s.map(W=>e.jsxs("button",{onClick:()=>T(W.tipo),style:{padding:"5px 10px",fontSize:10,fontFamily:"'DM Sans',sans-serif",border:`1px solid ${k.border}`,borderRadius:4,background:k.surface,cursor:"pointer",color:k.ink,display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{fontSize:11},children:W.icon})," ",W.label]},W.tipo))})]})]})]})}const B=h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:J=>J.target===J.currentTarget&&b(null),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",padding:24,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("h3",{style:{fontSize:15,fontWeight:700,margin:0},children:[" Compartir: ",h.nombre]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:k.inkMid},children:e.jsx(Ot,{size:18})})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:z,children:"Link del formulario"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("div",{style:{flex:1,padding:"8px 10px",background:k.bg,border:`1px solid ${k.border}`,borderRadius:4,fontSize:10,color:k.inkMid,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:"'DM Mono',monospace"},children:S(h)}),e.jsx("button",{onClick:()=>A(h),style:{padding:"8px 14px",border:`1px solid ${k.border}`,borderRadius:4,fontSize:11,fontWeight:600,background:c?k.successBg:k.surface,color:c?k.success:k.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap"},children:c?" Copiado":" Copiar"})]})]}),e.jsx("div",{style:{marginBottom:16,textAlign:"center"},children:e.jsx("a",{href:S(h),target:"_blank",rel:"noreferrer",style:{fontSize:11,color:k.info},children:" Ver preview en nueva pestaa"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Nombre (opc.)"}),e.jsx("input",{value:f,onChange:J=>p(J.target.value),style:I,placeholder:"Juan"})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"WhatsApp"}),e.jsx("input",{value:j,onChange:J=>C(J.target.value),style:I,placeholder:"300 123 4567"})]}),e.jsxs("div",{children:[e.jsx("label",{style:z,children:"Email"}),e.jsx("input",{value:v,onChange:J=>m(J.target.value),style:I,placeholder:"juan@mail.com"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>E(h),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"12px",background:"#25D366",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:700,color:"#fff",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(ms,{size:16})," WhatsApp"]}),e.jsxs("button",{onClick:()=>w(h),disabled:!v,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"12px",background:v?k.ink:k.bg,border:"none",borderRadius:6,cursor:v?"pointer":"default",fontSize:13,fontWeight:600,color:v?"#fff":k.inkLight,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(fr,{size:16})," Email"]})]})]})});return e.jsxs("div",{className:"fade",children:[B,e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("p",{style:{fontSize:10,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 10px"},children:"Crear desde plantilla"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:10},children:[dh.map((J,ye)=>e.jsxs("div",{onClick:()=>l(J),style:{background:k.surface,border:`1px solid ${k.border}`,borderRadius:6,padding:16,cursor:"pointer",transition:"all .15s"},onMouseEnter:oe=>{oe.currentTarget.style.borderColor=k.ink,oe.currentTarget.style.boxShadow=k.shadowSm},onMouseLeave:oe=>{oe.currentTarget.style.borderColor=k.border,oe.currentTarget.style.boxShadow="none"},children:[e.jsx("div",{style:{fontSize:28,marginBottom:8},children:J.icon}),e.jsx("div",{style:{fontSize:13,fontWeight:700,marginBottom:2},children:J.nombre}),e.jsx("div",{style:{fontSize:11,color:k.inkLight},children:J.desc}),e.jsxs("div",{style:{fontSize:9,color:k.inkXLight,marginTop:6},children:[J.campos.length," campos"]})]},ye)),e.jsxs("div",{onClick:x,style:{background:k.bg,border:`2px dashed ${k.border}`,borderRadius:6,padding:16,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:120,transition:"all .15s"},onMouseEnter:J=>J.currentTarget.style.borderColor=k.ink,onMouseLeave:J=>J.currentTarget.style.borderColor=k.border,children:[e.jsx(Ne,{size:24,style:{color:k.inkLight,marginBottom:6}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:k.inkMid},children:"En blanco"})]})]})]}),o?e.jsx("div",{style:{textAlign:"center",padding:40,color:k.inkLight},children:"Cargando..."}):t.length>0&&e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:10,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 10px"},children:["Mis formularios (",t.length,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map(J=>{var ye;return e.jsxs("div",{style:{background:k.surface,border:`1px solid ${k.border}`,borderRadius:4,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:J.nombre}),e.jsxs("div",{style:{fontSize:10,color:k.inkLight,marginTop:2},children:[((ye=J.campos)==null?void 0:ye.length)||0," campos  ",J.updatedAt?new Date(J.updatedAt).toLocaleDateString("es-CO"):""]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>b(J),style:{padding:"6px 12px",background:"#25D366",color:"#fff",border:"none",borderRadius:4,fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Compartir"}),e.jsx("button",{onClick:()=>{var oe;return r({...J,campos:((oe=J.campos)==null?void 0:oe.map(L=>({...L})))||[]})},style:{padding:"6px 12px",background:k.surface,border:`1px solid ${k.border}`,borderRadius:4,fontSize:10,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Editar"}),e.jsx("button",{onClick:()=>g(J.id),style:{padding:"6px 8px",background:"transparent",border:`1px solid ${k.border}`,borderRadius:4,cursor:"pointer",color:k.error},children:e.jsx(Je,{size:11})})]})]},J.id)})})]})]})}function ph(){return e.jsx(ch,{})}function uh({sv:t,onCreateOfferFromBriefing:i,onCreateClientFromBriefing:o}){const[n,s]=F.useState("enviar"),[r,a]=F.useState([]),[u,h]=F.useState(!0),[b,j]=F.useState(null),[C,v]=F.useState(null),[m,f]=F.useState(!1),[p,c]=F.useState(""),[d,l]=F.useState(null);F.useEffect(()=>{ps().then(z=>{a(z),h(!1)})},[]);const x=()=>{h(!0),ps().then(z=>{a(z),h(!1)})},y=async z=>{window.confirm("Eliminar este briefing?")&&(v(z),await nh(z),a(B=>B.filter(P=>P.id!==z)),v(null))},g=async z=>{const B={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0],...z};return await Ia(B),a(P=>[B,...P]),B},S=async()=>{try{let z=JSON.parse(p);if(Array.isArray(z)){for(const B of z)await g(B);alert(` ${z.length} briefing(s) importados`)}else await g(z),alert(" Briefing importado");c(""),f(!1)}catch{alert(" JSON invlido. Copia el JSON exacto de Getformly.")}},A=()=>({nombre:"",email:"",telefono:"",como_conociste:"",ciudad:"",edificio:"",direccion_proyecto:"",tipo_proyecto:"Diseo interior",area_m2:"",num_habitaciones:"",estilo:[],colores_materiales:"",espacios:[],fecha_inicio:"",plazo:"",presupuesto:"",financiacion:"",lo_mas_importante:"",que_esperas:[],contratistas:"",forma_pago:"",razon_social:"",documento:"",email_factura:"",dir_facturacion:"",retenciones:"No",detalle_retenciones:"",links_ref:""}),E=[{id:"enviar",lbl:"Mis formularios",I:Sn},{id:"recibidos",lbl:`Recibidos (${r.length})`,I:Za},{id:"ingresar",lbl:"Ingresar manual",I:No}],w={width:"100%",padding:"7px 10px",border:`1px solid ${k.border}`,borderRadius:4,fontFamily:"'DM Sans',sans-serif",fontSize:12,background:k.surface,color:k.ink,boxSizing:"border-box"},I={fontSize:9,fontWeight:600,color:k.inkLight,display:"block",marginBottom:4,textTransform:"uppercase",letterSpacing:1};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,letterSpacing:-.5,margin:"0 0 4px"},children:"Formularios"}),e.jsx("p",{style:{fontSize:12,color:k.inkLight,margin:0},children:"Enva el briefing, ingresa respuestas y crea clientes y ofertas"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>f(!0),style:{padding:"7px 14px",border:`1px solid ${k.border}`,borderRadius:3,background:k.surface,color:k.inkMid,fontFamily:"'DM Sans',sans-serif",fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:" Importar JSON"}),e.jsx("button",{onClick:x,style:{padding:"7px 14px",border:`1px solid ${k.border}`,borderRadius:3,background:k.surface,color:k.inkMid,fontFamily:"'DM Sans',sans-serif",fontSize:11,cursor:"pointer"},children:" Actualizar"})]})]}),m&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:z=>z.target===z.currentTarget&&f(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:560,width:"100%",padding:24,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsx("h3",{style:{fontSize:15,fontWeight:700,margin:"0 0 8px"},children:" Importar JSON de Getformly"}),e.jsx("p",{style:{fontSize:11,color:k.inkMid,margin:"0 0 12px"},children:"Pega el JSON de la respuesta del formulario. Acepta un objeto o un array de objetos."}),e.jsx("textarea",{value:p,onChange:z=>c(z.target.value),placeholder:'{"nombre": "Juan Prez", "email": "juan@mail.com", ...}',rows:10,style:{...w,fontSize:11,fontFamily:"'DM Mono',monospace",resize:"vertical"}}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsx("button",{onClick:S,style:{padding:"8px 18px",background:k.ink,color:"#fff",border:"none",borderRadius:4,fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Importar"}),e.jsx("button",{onClick:()=>{f(!1),c("")},style:{padding:"8px 18px",background:"transparent",color:k.inkMid,border:`1px solid ${k.border}`,borderRadius:4,fontSize:12,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"})]})]})}),e.jsx("div",{style:{display:"flex",gap:2,marginBottom:20,borderBottom:`1px solid ${k.border}`,paddingBottom:0},children:E.map(z=>e.jsxs("button",{onClick:()=>s(z.id),style:{display:"flex",alignItems:"center",gap:7,padding:"10px 18px",border:"none",borderBottom:n===z.id?`2px solid ${k.ink}`:"2px solid transparent",background:"transparent",color:n===z.id?k.ink:k.inkLight,fontFamily:"'DM Sans',sans-serif",fontSize:12,fontWeight:n===z.id?700:400,cursor:"pointer",letterSpacing:.5,marginBottom:-1},children:[e.jsx(z.I,{size:13}),z.lbl]},z.id))}),n==="enviar"&&e.jsx(ph,{}),n==="ingresar"&&(()=>{const z=d||A(),B=($,Y)=>l(ge=>({...ge||A(),[$]:Y}));d||l(A());const P=["Moderno","Contemporneo","Minimalista","Industrial","Nrdico","Clsico","Rstico","Eclctico","Japandi","Otro"],q=["Sala","Comedor","Cocina","Habitacin principal","Habitacin secundaria","Bao social","Bao privado","Estudio","Terraza/Balcn","Zona de lavandera","Lobby/Hall"],U=async()=>{if(!z.nombre){alert("El nombre es obligatorio");return}const $=await g(z);l(A()),s("recibidos"),alert(` Briefing de "${$.nombre}" guardado`)};return e.jsx("div",{className:"fade",children:e.jsxs(rt,{style:{padding:22,borderLeft:`3px solid ${k.ink}`},children:[e.jsx(Mt,{t:"Ingresar respuesta de briefing",s:"Completa los campos segn la informacin proporcionada por el cliente"}),e.jsxs("div",{style:{marginTop:16,marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:k.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${k.border}`},children:" Datos del cliente"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Nombre completo *"}),e.jsx("input",{value:z.nombre,onChange:$=>B("nombre",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Email"}),e.jsx("input",{type:"email",value:z.email,onChange:$=>B("email",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Telfono"}),e.jsx("input",{value:z.telefono,onChange:$=>B("telefono",$.target.value),placeholder:"300 123 4567",style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Cmo nos conoci?"}),e.jsxs("select",{value:z.como_conociste,onChange:$=>B("como_conociste",$.target.value),style:w,children:[e.jsx("option",{value:"",children:""}),["Instagram","Google","Referido","Pgina web","Evento","Otro"].map($=>e.jsx("option",{children:$},$))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Ciudad"}),e.jsx("input",{value:z.ciudad,onChange:$=>B("ciudad",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Edificio / Conjunto"}),e.jsx("input",{value:z.edificio,onChange:$=>B("edificio",$.target.value),style:w})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:k.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${k.border}`},children:" Datos del proyecto"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Tipo de proyecto"}),e.jsx("select",{value:z.tipo_proyecto,onChange:$=>B("tipo_proyecto",$.target.value),style:w,children:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"].map($=>e.jsx("option",{children:$},$))})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Direccin del proyecto"}),e.jsx("input",{value:z.direccion_proyecto,onChange:$=>B("direccion_proyecto",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"rea (m)"}),e.jsx("input",{type:"number",value:z.area_m2,onChange:$=>B("area_m2",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"N habitaciones / reas"}),e.jsx("input",{value:z.num_habitaciones,onChange:$=>B("num_habitaciones",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Fecha tentativa inicio"}),e.jsx("input",{type:"date",value:z.fecha_inicio,onChange:$=>B("fecha_inicio",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Plazo deseado"}),e.jsx("input",{value:z.plazo,onChange:$=>B("plazo",$.target.value),placeholder:"Ej: 3 meses",style:w})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:k.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${k.border}`},children:" Estilo y preferencias"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Estilos preferidos (seleccionar varios)"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:2},children:P.map($=>{const Y=(z.estilo||[]).includes($);return e.jsx("button",{onClick:()=>B("estilo",Y?(z.estilo||[]).filter(ge=>ge!==$):[...z.estilo||[],$]),style:{padding:"4px 10px",fontSize:10,fontWeight:Y?700:400,borderRadius:20,border:Y?`1px solid ${k.ink}`:`1px solid ${k.border}`,background:Y?k.ink:"#fff",color:Y?"#fff":k.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:$},$)})})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Espacios a intervenir"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:2},children:q.map($=>{const Y=(z.espacios||[]).includes($);return e.jsx("button",{onClick:()=>B("espacios",Y?(z.espacios||[]).filter(ge=>ge!==$):[...z.espacios||[],$]),style:{padding:"4px 10px",fontSize:10,fontWeight:Y?700:400,borderRadius:20,border:Y?`1px solid ${k.info}`:`1px solid ${k.border}`,background:Y?k.infoBg:"#fff",color:Y?k.info:k.inkMid,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:$},$)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Colores y materiales preferidos"}),e.jsx("textarea",{value:z.colores_materiales,onChange:$=>B("colores_materiales",$.target.value),rows:2,style:{...w,resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Links de referencia (Pinterest, etc.)"}),e.jsx("textarea",{value:z.links_ref,onChange:$=>B("links_ref",$.target.value),rows:2,style:{...w,resize:"vertical"}})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:k.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${k.border}`},children:" Presupuesto y expectativas"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Presupuesto aproximado (COP)"}),e.jsx("input",{type:"number",value:z.presupuesto,onChange:$=>B("presupuesto",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Financiacin"}),e.jsxs("select",{value:z.financiacion,onChange:$=>B("financiacion",$.target.value),style:w,children:[e.jsx("option",{value:"",children:""}),["Recursos propios","Crdito hipotecario","Leasing","Otro"].map($=>e.jsx("option",{children:$},$))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Forma de pago"}),e.jsxs("select",{value:z.forma_pago,onChange:$=>B("forma_pago",$.target.value),style:w,children:[e.jsx("option",{value:"",children:""}),["Transferencia","Tarjeta de crdito","Efectivo","Cheque","Otro"].map($=>e.jsx("option",{children:$},$))]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Lo ms importante del proyecto"}),e.jsx("textarea",{value:z.lo_mas_importante,onChange:$=>B("lo_mas_importante",$.target.value),rows:2,style:{...w,resize:"vertical"},placeholder:"Qu es lo que ms le importa al cliente?"})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Qu espera lograr?"}),e.jsx("textarea",{value:Array.isArray(z.que_esperas)?z.que_esperas.join(`
`):z.que_esperas||"",onChange:$=>B("que_esperas",$.target.value.split(`
`)),rows:2,style:{...w,resize:"vertical"},placeholder:"Una lnea por expectativa"})]})]})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h4",{style:{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:k.info,margin:"0 0 10px",paddingBottom:6,borderBottom:`1px solid ${k.border}`},children:" Datos de facturacin (si aplica)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Razn social"}),e.jsx("input",{value:z.razon_social,onChange:$=>B("razon_social",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"NIT / Cdula"}),e.jsx("input",{value:z.documento,onChange:$=>B("documento",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Email facturacin"}),e.jsx("input",{value:z.email_factura,onChange:$=>B("email_factura",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Direccin facturacin"}),e.jsx("input",{value:z.dir_facturacion,onChange:$=>B("dir_facturacion",$.target.value),style:w})]}),e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Retenciones especiales"}),e.jsx("select",{value:z.retenciones,onChange:$=>B("retenciones",$.target.value),style:w,children:["No","S"].map($=>e.jsx("option",{children:$},$))})]}),z.retenciones==="S"&&e.jsxs("div",{children:[e.jsx("label",{style:I,children:"Detalle retenciones"}),e.jsx("input",{value:z.detalle_retenciones,onChange:$=>B("detalle_retenciones",$.target.value),style:w})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16,paddingTop:16,borderTop:`1px solid ${k.border}`},children:[e.jsx(ht,{icon:yt,on:U,children:"Guardar briefing"}),e.jsx(ht,{v:"out",on:async()=>{if(!z.nombre){alert("El nombre es obligatorio");return}const $=await g(z);o&&o($),l(A()),s("recibidos")},children:" Guardar + Crear cliente"}),e.jsx(ht,{v:"out",on:async()=>{if(!z.nombre){alert("El nombre es obligatorio");return}const $=await g(z);i($,t),l(A())},children:" Guardar + Crear oferta"}),e.jsx(ht,{v:"out",on:()=>l(A()),children:"Limpiar"})]})]})})})(),n==="recibidos"&&(u?e.jsx("div",{style:{textAlign:"center",padding:"60px 0",color:k.inkLight},children:"Cargando briefings..."}):r.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"80px 0"},children:[e.jsx(Za,{size:40,style:{color:k.inkXLight,display:"block",margin:"0 auto 14px"}}),e.jsx("p",{style:{color:k.inkLight,fontSize:14},children:"No hay briefings recibidos an"}),e.jsx("p",{style:{color:k.inkXLight,fontSize:12,marginTop:6},children:"Ingresa uno manualmente o importa un JSON desde Getformly"}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:16},children:[e.jsxs("button",{onClick:()=>s("ingresar"),style:{padding:"8px 18px",background:k.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(No,{size:12,style:{marginRight:4}})," Ingresar manualmente"]}),e.jsx("button",{onClick:()=>f(!0),style:{padding:"8px 18px",background:"transparent",color:k.inkMid,border:`1px solid ${k.border}`,borderRadius:6,cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:" Importar JSON"})]})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:r.map(z=>e.jsxs("div",{style:{background:k.surface,border:`1px solid ${k.border}`,borderRadius:3,padding:"14px 18px",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"border-color .15s"},onMouseEnter:B=>B.currentTarget.style.borderColor=k.borderMid,onMouseLeave:B=>B.currentTarget.style.borderColor=k.border,children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("span",{style:{fontWeight:600,fontSize:14,color:k.ink},children:z.nombre||"Sin nombre"}),z.confirmacion==="S"&&e.jsx("span",{style:{fontSize:9,letterSpacing:1,textTransform:"uppercase",background:k.successBg,color:k.success,border:`1px solid ${k.success}33`,padding:"2px 7px",borderRadius:2,fontWeight:700},children:"Completo"})]}),e.jsx("div",{style:{display:"flex",gap:16,marginTop:4,flexWrap:"wrap"},children:[z.email&&{ic:"",v:z.email},z.ciudad&&{ic:"",v:z.ciudad},z.tipo_proyecto&&{ic:"",v:z.tipo_proyecto},z.area_m2&&{ic:"",v:`${z.area_m2} m`},z.presupuesto&&{ic:"",v:`$ ${Number(z.presupuesto).toLocaleString("es-CO")} COP`}].filter(Boolean).map((B,P)=>e.jsxs("span",{style:{fontSize:11,color:k.inkLight},children:[B.ic," ",B.v]},P))})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexShrink:0,marginLeft:16},children:[e.jsx("span",{style:{fontSize:10,color:k.inkXLight,marginRight:4},children:z.fecha||""}),e.jsx("button",{onClick:()=>j(z),style:{padding:"6px 12px",background:k.accentBg,border:`1px solid ${k.border}`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:k.ink,fontWeight:600},children:"Ver detalle"}),e.jsx("button",{onClick:()=>{o&&o(z)},style:{padding:"6px 12px",background:k.infoBg,border:`1px solid ${k.info}33`,borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:k.info,fontWeight:600},children:"+ Cliente"}),e.jsx("button",{onClick:()=>i(z,t),style:{padding:"6px 12px",background:k.ink,border:"none",borderRadius:3,fontFamily:"'DM Sans',sans-serif",fontSize:10,cursor:"pointer",color:"#fff",fontWeight:700,letterSpacing:.5},children:"+ Oferta"}),e.jsx("button",{onClick:()=>y(z.id),disabled:C===z.id,style:{padding:"6px 8px",background:"transparent",border:`1px solid ${k.border}`,borderRadius:3,cursor:"pointer",color:k.error,opacity:C===z.id?.4:1},children:e.jsx(Je,{size:11})})]})]},z.id))})),b&&e.jsx(rh,{b,onClose:()=>j(null),onCreateOffer:()=>{j(null),i(b,t)},onCreateClient:()=>{j(null),o&&o(b)}})]})}function gh(){const t="hab:crm:clientes2",[i,o]=F.useState([]),[n,s]=F.useState(null),[r,a]=F.useState(""),[u,h]=F.useState([]),[b,j]=F.useState(!1);F.useEffect(()=>{(()=>{try{const d=Fe.getSync(t);if(d){const l=(JSON.parse(d)||[]).map(x=>({...x,telMovil:(x.telMovil||x.tel||"").replace(/^\+57\s*/,""),notas:(x.notas||"").replace(/Presupuesto: NaN/g,"Presupuesto: ")}));o(l)}}catch{}})(),ps().then(d=>h(d))},[]);const C=d=>{o(d);try{Fe.set(t,JSON.stringify(d))}catch{}},v=()=>Math.random().toString(36).slice(2,9),m=()=>({id:v(),nombre:"",tipo:"Empresa",nit:"",email:"",tel:"",ciudad:"",pais:"CO",notas:""}),f=i.filter(d=>!r||d.nombre.toLowerCase().includes(r.toLowerCase())||(d.nit||"").includes(r)),p=d=>{const l=Qd(d);s(l),j(!1)},c=(d={})=>({border:"1px solid #E0E0E0",borderRadius:6,padding:"7px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",width:"100%",...d});return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Clientes"}),e.jsxs("p",{style:{fontSize:12,color:k.inkLight,margin:"3px 0 0"},children:[i.length," registros"]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[u.length>0&&e.jsxs("button",{onClick:()=>j(!0),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:k.infoBg,color:k.info,border:`1px solid ${k.info}33`,borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600},children:[" Desde briefing (",u.length,")"]}),e.jsxs("button",{onClick:()=>s(m()),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:k.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:600},children:[e.jsx(Ne,{size:14})," Nuevo cliente"]})]})]}),b&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:d=>d.target===d.currentTarget&&j(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",maxHeight:"65vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:"Crear cliente desde briefing"}),e.jsx("div",{style:{fontSize:10,color:"#888",marginTop:2},children:"Los datos se pre-llenarn en el formulario"})]}),e.jsx("button",{onClick:()=>j(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx(Ot,{size:18})})]}),e.jsxs("div",{style:{overflowY:"auto",padding:14},children:[u.map(d=>e.jsxs("div",{onClick:()=>p(d),style:{padding:"12px 14px",border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,cursor:"pointer"},onMouseEnter:l=>l.currentTarget.style.background="#F5F4F1",onMouseLeave:l=>l.currentTarget.style.background="#fff",children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:d.nombre||"Sin nombre"}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2,display:"flex",gap:12},children:[d.email&&e.jsxs("span",{children:[" ",d.email]}),d.telefono&&e.jsxs("span",{children:[" ",d.telefono]}),d.ciudad&&e.jsxs("span",{children:[" ",d.ciudad]}),d.razon_social&&e.jsxs("span",{children:[" ",d.razon_social]})]})]},d.id)),u.length===0&&e.jsx("div",{style:{textAlign:"center",padding:30,color:"#888",fontSize:12},children:"No hay briefings. Ingresa uno en Formularios  Ingresar manual."})]})]})}),e.jsxs("div",{style:{position:"relative",marginBottom:16},children:[e.jsx(ki,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:k.inkLight}}),e.jsx("input",{value:r,onChange:d=>a(d.target.value),placeholder:"Buscar por nombre o NIT...",style:{...c(),paddingLeft:32}})]}),n&&e.jsxs(rt,{style:{padding:22,marginBottom:20,borderLeft:`3px solid ${k.ink}`},children:[e.jsx(Mt,{t:n.id&&i.find(d=>d.id===n.id)?"Editar cliente":"Nuevo cliente",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(ot,{lbl:"Nombre / Razn social",val:n.nombre,on:d=>s(l=>({...l,nombre:d.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Tipo"}),e.jsx("select",{value:n.tipo,onChange:d=>s(l=>({...l,tipo:d.target.value})),style:{...c()},children:["Empresa","Persona natural","Promotor","Particular"].map(d=>e.jsx("option",{children:d},d))})]}),e.jsx(ot,{lbl:"NIT / CIF / DNI",val:n.nit,on:d=>s(l=>({...l,nit:d.target.value}))}),e.jsx(ot,{lbl:"Email",val:n.email,on:d=>s(l=>({...l,email:d.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mvil"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoMovil||"+57",onChange:d=>s(l=>({...l,prefijoMovil:d.target.value})),style:{...c(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(d=>e.jsx("option",{value:d.split(" ")[0],children:d},d))}),e.jsx("input",{value:n.telMovil||n.tel||"",onChange:d=>s(l=>({...l,telMovil:d.target.value})),placeholder:"300 123 4567",style:{...c()}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Fijo"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoFijo||"+57",onChange:d=>s(l=>({...l,prefijoFijo:d.target.value})),style:{...c(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(d=>e.jsx("option",{value:d.split(" ")[0],children:d},d))}),e.jsx("input",{value:n.telFijo||"",onChange:d=>s(l=>({...l,telFijo:d.target.value})),placeholder:"601 234 5678",style:{...c()}})]})]}),e.jsx(ot,{lbl:"Ciudad",val:n.ciudad,on:d=>s(l=>({...l,ciudad:d.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Pas"}),e.jsx("select",{value:n.pais,onChange:d=>s(l=>({...l,pais:d.target.value})),style:{...c()},children:["CO","ES","MX","US","Otro"].map(d=>e.jsx("option",{children:d},d))})]}),e.jsx(ot,{lbl:"Direccin",val:n.direccion||"",on:d=>s(l=>({...l,direccion:d.target.value}))})]}),e.jsxs("div",{style:{marginTop:16,padding:"16px 0",borderTop:`1px solid ${k.border}`},children:[e.jsx("p",{style:{fontSize:10,fontWeight:700,color:k.inkLight,letterSpacing:1.5,textTransform:"uppercase",margin:"0 0 12px"},children:"Datos de facturacin"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(ot,{lbl:"Razn social",val:n.razonSocial||"",on:d=>s(l=>({...l,razonSocial:d.target.value}))}),e.jsx(ot,{lbl:"Email facturacin",val:n.emailFactura||"",on:d=>s(l=>({...l,emailFactura:d.target.value}))}),e.jsx(ot,{lbl:"Dir. facturacin",val:n.dirFacturacion||"",on:d=>s(l=>({...l,dirFacturacion:d.target.value}))}),e.jsx(ot,{lbl:"Forma de pago",val:n.formaPago||"",on:d=>s(l=>({...l,formaPago:d.target.value}))}),e.jsx(ot,{lbl:"Retenciones",val:n.retenciones||"",on:d=>s(l=>({...l,retenciones:d.target.value}))}),e.jsx(ot,{lbl:"Detalle retenciones",val:n.detalleRet||"",on:d=>s(l=>({...l,detalleRet:d.target.value}))})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginTop:12},children:e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas"}),e.jsx("textarea",{value:n.notas,onChange:d=>s(l=>({...l,notas:d.target.value})),rows:2,style:{...c(),resize:"vertical"}})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:14},children:[e.jsx(ht,{icon:Bt,v:"sec",on:()=>{const d=(n.telMovil||"").replace(/^\+57\s*/,""),l=g=>g||'<span style="color:#ccc;font-style:italic"></span>',x=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>${n.nombre} - Habitaris</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
@page{size:A4;margin:20mm 0}
body{font-family:'DM Sans',sans-serif;color:#1a1a1a}
.page{max-width:170mm;margin:0 auto}
/* Logo area */
.logo-row{display:flex;align-items:center;gap:10px;margin-bottom:6px}
.logo-svg{flex-shrink:0}
.brand{font-size:22px;font-weight:300;letter-spacing:1px;color:#1a1a1a}
.brand b{font-weight:800}
/* Divider */
.line{height:1px;background:#1a1a1a;margin:8px 0 20px}
/* Doc title + client */
.title-row{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:24px}
.doc-title{font-size:8px;font-weight:600;letter-spacing:3px;text-transform:uppercase;color:#999}
.client-name{font-size:20px;font-weight:700;letter-spacing:-.3px}
/* Sections */
.sec{margin-bottom:20px}
.sec-t{font-size:7.5px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:#999;margin-bottom:10px;padding-bottom:5px;border-bottom:1px solid #e5e2de}
.g{display:grid;grid-template-columns:1fr 1fr 1fr;gap:2px 20px}
.f{margin-bottom:11px}
.fl{font-size:6.5px;font-weight:600;letter-spacing:1.8px;text-transform:uppercase;color:#aaa;margin-bottom:1px}
.fv{font-size:11px;font-weight:500;color:#1a1a1a;line-height:1.3}
.tag{display:inline-block;padding:1px 7px;background:#f0efec;font-size:9px;font-weight:600;letter-spacing:.5px;color:#666}
.nbox{background:#faf9f7;border-left:2px solid #ddd;padding:10px 14px;font-size:10px;line-height:1.7;color:#666;white-space:pre-wrap}
/* Footer */
.ft{margin-top:30px;padding-top:10px;border-top:1px solid #e5e2de;display:flex;justify-content:space-between}
.ft span{font-size:6px;letter-spacing:1.5px;text-transform:uppercase;color:#bbb}
</style></head><body>
<div class="page">
  <div class="logo-row">
    <svg class="logo-svg" width="38" height="38" viewBox="0 0 34 34" fill="none">
      <rect x="4.5" y="2.5" width="25" height="25" stroke="#1a1a1a" stroke-width=".7" opacity=".35"/>
      <rect x="2.5" y="4.5" width="25" height="25" stroke="#1a1a1a" stroke-width="1.2"/>
      <rect x="7.5" y="10" width="4" height="13" fill="#1a1a1a"/>
      <rect x="7.5" y="15.5" width="13" height="3" fill="#1a1a1a"/>
      <rect x="16.5" y="10" width="4" height="13" fill="#1a1a1a"/>
    </svg>
    <div class="brand"><b>H</b>abitaris</div>
  </div>
  <div class="line"></div>
  <div class="title-row">
    <span class="doc-title">Ficha de cliente</span>
    <span class="client-name">${n.nombre||""}</span>
  </div>

  <div class="sec"><div class="sec-t">Informacin general</div><div class="g">
    <div class="f"><div class="fl">Nombre</div><div class="fv">${l(n.nombre)}</div></div>
    <div class="f"><div class="fl">Tipo</div><div class="fv"><span class="tag">${n.tipo||""}</span></div></div>
    <div class="f"><div class="fl">NIT / CIF / DNI</div><div class="fv">${l(n.nit)}</div></div>
    <div class="f"><div class="fl">Email</div><div class="fv">${l(n.email)}</div></div>
    <div class="f"><div class="fl">Mvil</div><div class="fv">${d?(n.prefijoMovil||"+57")+" "+d:l("")}</div></div>
    <div class="f"><div class="fl">Fijo</div><div class="fv">${l(n.telFijo)}</div></div>
    <div class="f"><div class="fl">Ciudad</div><div class="fv">${l(n.ciudad)}</div></div>
    <div class="f"><div class="fl">Pas</div><div class="fv">${l(n.pais)}</div></div>
    <div class="f"><div class="fl">Direccin</div><div class="fv">${l(n.direccion)}</div></div>
  </div></div>

  <div class="sec"><div class="sec-t">Datos de facturacin</div><div class="g">
    <div class="f"><div class="fl">Razn social</div><div class="fv">${l(n.razonSocial)}</div></div>
    <div class="f"><div class="fl">Email facturacin</div><div class="fv">${l(n.emailFactura)}</div></div>
    <div class="f"><div class="fl">Dir. facturacin</div><div class="fv">${l(n.dirFacturacion)}</div></div>
    <div class="f"><div class="fl">Forma de pago</div><div class="fv">${l(n.formaPago)}</div></div>
    <div class="f"><div class="fl">Retenciones</div><div class="fv">${l(n.retenciones)}</div></div>
    <div class="f"><div class="fl">Detalle retenciones</div><div class="fv">${l(n.detalleRet)}</div></div>
  </div></div>

  ${n.notas?'<div class="sec"><div class="sec-t">Notas</div><div class="nbox">'+n.notas+"</div></div>":""}

  <div class="ft"><span>Habitaris Suite  CRM</span><span>${new Date().toLocaleDateString("es-CO")}</span><span>Confidencial</span></div>
</div></body></html>`,y=window.open("","_blank","width=800,height=1000");y.document.write(x),y.document.close(),y.onafterprint=()=>y.close(),setTimeout(()=>y.print(),500)},children:"PDF / Imprimir"}),n.briefingId&&e.jsx(ht,{v:"sec",on:()=>{try{const d=Fe.getSync("hab:briefing:"+n.briefingId);if(d){const l=JSON.parse(d);s(x=>({...x,email:l.email||x.email,telMovil:(l.telefono||"").replace(/^\+57\s*/,"")||x.telMovil,ciudad:l.ciudad||x.ciudad,direccion:l.direccion_proyecto||x.direccion,razonSocial:l.razon_social||x.razonSocial,emailFactura:l.email_factura||l.email||x.emailFactura,dirFacturacion:l.dir_facturacion||x.dirFacturacion,formaPago:l.forma_pago||x.formaPago,retenciones:l.retenciones||x.retenciones,detalleRet:l.detalle_retenciones||x.detalleRet,nit:l.documento||x.nit})),alert("Datos actualizados desde briefing")}else{const l=Fe.getSync("hab:v4");if(l){const y=(JSON.parse(l)||[]).find(g=>g.briefingId===n.briefingId);y?(s(g=>({...g,email:y.emailCliente||y.email||g.email,telMovil:(y.telCliente||"").replace(/^\+57\s*/,"")||g.telMovil,ciudad:(y.ubicacion||"").split("  ")[0]||g.ciudad,razonSocial:y.razonSocial||g.razonSocial,emailFactura:y.emailFactura||g.emailFactura,dirFacturacion:y.dirFacturacion||g.dirFacturacion,formaPago:y.formaPago||g.formaPago,retenciones:y.retencion?"Si":g.retenciones,detalleRet:y.detalleRet||g.detalleRet,nit:y.documento||g.nit})),alert("Datos actualizados desde la oferta vinculada")):alert("No se encontraron datos del briefing ni oferta vinculada")}else alert("No se encontraron datos del briefing")}}catch(d){alert("Error: "+d.message)}},children:"Actualizar datos"}),e.jsx(ht,{icon:yt,on:()=>{if(!n.nombre){alert("El nombre es obligatorio");return}const d=i.find(l=>l.id===n.id);C(d?i.map(l=>l.id===n.id?n:l):[...i,n]),s(null)},children:"Guardar"}),e.jsx(ht,{v:"out",on:()=>s(null),children:"Cancelar"}),i.find(d=>d.id===n.id)&&e.jsxs(ht,{v:"out",on:()=>{window.confirm("Eliminar?")&&(C(i.filter(d=>d.id!==n.id)),s(null))},children:[e.jsx(Je,{size:13})," Eliminar"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280px,1fr))",gap:12},children:[f.map(d=>e.jsxs(rt,{style:{padding:18,cursor:"pointer",transition:"box-shadow .15s"},onClick:()=>s({...d}),onMouseEnter:l=>l.currentTarget.style.boxShadow=k.shadowMd,onMouseLeave:l=>l.currentTarget.style.boxShadow=k.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:k.ink},children:d.nombre}),e.jsxs("div",{style:{fontSize:11,color:k.inkLight,marginTop:2},children:[d.tipo,"  ",d.ciudad||"","  ",d.pais]})]}),e.jsx("div",{style:{background:k.accentBg,borderRadius:4,padding:"2px 7px",fontSize:10,color:k.inkMid},children:d.nit||""})]}),(d.email||d.telMovil||d.tel||d.telFijo)&&e.jsxs("div",{style:{marginTop:8,fontSize:11,color:k.inkMid,display:"flex",gap:12,flexWrap:"wrap"},children:[d.email&&e.jsxs("span",{children:[" ",d.email]}),(d.telMovil||d.tel)&&e.jsxs("span",{children:[" ",d.prefijoMovil||"+57"," ",(d.telMovil||d.tel||"").replace(/^\+57\s*/,"")]}),d.telFijo&&e.jsxs("span",{children:[" ",d.prefijoFijo||"+57"," ",d.telFijo]})]})]},d.id)),f.length===0&&e.jsx("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:40,color:k.inkLight,fontSize:13},children:r?"Sin resultados. Prueba otro trmino.":"Sin clientes. Aade el primero."})]})]})}function hh(){const t="hab:crm:proveedores",[i,o]=F.useState([]),[n,s]=F.useState(null),[r,a]=F.useState(""),[u,h]=F.useState("Todos"),b=["Todos","Preliminares","Demoliciones","Movimiento de tierras","Cimentaciones","Estructura","Mampostera","Cubierta","Instalaciones elctricas","Instalaciones hidrosanitarias","Instalaciones de gas","Acabados","Pisos y enchapes","Pintura","Carpintera metlica","Carpintera madera / mobiliario","Obras exteriores","Equipamiento especial","Diseo y direccin","Otros"];F.useEffect(()=>{(()=>{try{const p=Fe.getSync(t);p&&o(JSON.parse(p)||[])}catch{}})()},[]);const j=p=>{o(p);try{Fe.set(t,JSON.stringify(p))}catch{}},C=()=>Math.random().toString(36).slice(2,9),v=()=>({id:C(),nombre:"",categoria:"Materiales",nit:"",email:"",tel:"",contacto:"",ciudad:"",web:"",notas:"",calificacion:5,metodoPago:"Transferencia",formaPago:"Contado",prefijoFijo:"+601"}),m=i.filter(p=>(u==="Todos"||p.categoria===u)&&(!r||p.nombre.toLowerCase().includes(r.toLowerCase()))),f=(p={})=>({border:"1px solid #E0E0E0",borderRadius:6,padding:"7px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",width:"100%",...p});return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Proveedores"}),e.jsxs("p",{style:{fontSize:12,color:k.inkLight,margin:"3px 0 0"},children:[i.length," registros"]})]}),e.jsxs("button",{onClick:()=>s(v()),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:k.ink,color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:600},children:[e.jsx(Ne,{size:14})," Nuevo proveedor"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(ki,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:k.inkLight}}),e.jsx("input",{value:r,onChange:p=>a(p.target.value),placeholder:"Buscar proveedor...",style:{...f(),paddingLeft:32}})]}),b.map(p=>e.jsx("button",{onClick:()=>h(p),style:{padding:"6px 12px",border:`1px solid ${u===p?k.ink:k.border}`,borderRadius:20,background:u===p?k.ink:"transparent",color:u===p?"#fff":k.inkMid,cursor:"pointer",fontSize:11,fontFamily:"'DM Sans',sans-serif",fontWeight:u===p?600:400},children:p},p))]}),n&&e.jsxs(rt,{style:{padding:22,marginBottom:20,borderLeft:"3px solid #3B3B3B"},children:[e.jsx(Mt,{t:i.find(p=>p.id===n.id)?"Editar proveedor":"Nuevo proveedor",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},children:[e.jsx(ot,{lbl:"Nombre / Razn social",val:n.nombre,on:p=>s(c=>({...c,nombre:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Categora"}),e.jsx("select",{value:n.categoria,onChange:p=>s(c=>({...c,categoria:p.target.value})),style:{...f()},children:b.filter(p=>p!=="Todos").map(p=>e.jsx("option",{children:p},p))})]}),e.jsx(ot,{lbl:"NIT / CIF",val:n.nit,on:p=>s(c=>({...c,nit:p.target.value}))}),e.jsx(ot,{lbl:"Contacto",val:n.contacto,on:p=>s(c=>({...c,contacto:p.target.value}))}),e.jsx(ot,{lbl:"Email",val:n.email,on:p=>s(c=>({...c,email:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mvil"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoMovil||"+57",onChange:p=>s(c=>({...c,prefijoMovil:p.target.value})),style:{...f(),width:82,flexShrink:0,fontSize:12},children:["+57 ","+34 ","+52 ","+1 "].map(p=>e.jsx("option",{value:p.split(" ")[0],children:p},p))}),e.jsx("input",{value:n.telMovil||n.tel||"",onChange:p=>s(c=>({...c,telMovil:p.target.value})),placeholder:"300 123 4567",style:{...f()}})]})]}),e.jsx(ot,{lbl:"Ciudad",val:n.ciudad,on:p=>s(c=>({...c,ciudad:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Telfono fijo"}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("select",{value:n.prefijoFijo||"+601",onChange:p=>s(c=>({...c,prefijoFijo:p.target.value})),style:{...f(),width:90,flexShrink:0,fontSize:12},children:["+601  Bog","+602  Cali","+604  Med","+605  B/manga","+91  Mad","+93  Bcn"].map(p=>e.jsx("option",{value:p.split(" ")[0],children:p},p))}),e.jsx("input",{value:n.telFijo||"",onChange:p=>s(c=>({...c,telFijo:p.target.value})),placeholder:"234 5678",style:{...f()}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Mtodo de pago"}),e.jsx("select",{value:n.metodoPago||"Transferencia",onChange:p=>s(c=>({...c,metodoPago:p.target.value})),style:{...f()},children:["Transferencia","Cheque","Efectivo","PSE","Consignacin","Otro"].map(p=>e.jsx("option",{children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Forma de pago (plazo)"}),e.jsx("select",{value:n.formaPago||"Contado",onChange:p=>s(c=>({...c,formaPago:p.target.value})),style:{...f()},children:["Contado","Crdito 15d","Crdito 30d","Crdito 45d","Crdito 60d","Crdito 90d","Anticipo + saldo","Otro"].map(p=>e.jsx("option",{children:p},p))})]}),e.jsx(ot,{lbl:"Sitio web",val:n.web,on:p=>s(c=>({...c,web:p.target.value}))}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Calificacin (1-5)"}),e.jsx("div",{style:{display:"flex",gap:4},children:[1,2,3,4,5].map(p=>e.jsx("button",{onClick:()=>s(c=>({...c,calificacion:p})),style:{fontSize:20,background:"none",border:"none",cursor:"pointer",color:p<=n.calificacion?"#F5A623":"#DDD"},children:""},p))})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas"}),e.jsx("textarea",{value:n.notas,onChange:p=>s(c=>({...c,notas:p.target.value})),rows:2,style:{...f(),resize:"vertical"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:14},children:[e.jsx(ht,{icon:yt,on:()=>{if(!n.nombre){alert("El nombre es obligatorio");return}const p=i.find(c=>c.id===n.id);j(p?i.map(c=>c.id===n.id?n:c):[...i,n]),s(null)},children:"Guardar"}),e.jsx(ht,{v:"out",on:()=>s(null),children:"Cancelar"}),i.find(p=>p.id===n.id)&&e.jsxs(ht,{v:"out",on:()=>{window.confirm("Eliminar?")&&(j(i.filter(p=>p.id!==n.id)),s(null))},children:[e.jsx(Je,{size:13})," Eliminar"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(290px,1fr))",gap:12},children:[m.map(p=>e.jsxs(rt,{style:{padding:18,cursor:"pointer",transition:"box-shadow .15s"},onClick:()=>s({...p}),onMouseEnter:c=>c.currentTarget.style.boxShadow=k.shadowMd,onMouseLeave:c=>c.currentTarget.style.boxShadow=k.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:k.ink},children:p.nombre}),e.jsxs("div",{style:{fontSize:11,color:k.inkLight,marginTop:2},children:[p.categoria,"  ",p.ciudad||""]})]}),e.jsx("div",{style:{display:"flex",gap:1},children:[1,2,3,4,5].map(c=>e.jsx("span",{style:{fontSize:12,color:c<=(p.calificacion||0)?"#F5A623":"#DDD"},children:""},c))})]}),(p.contacto||p.email||p.telMovil||p.tel||p.telFijo)&&e.jsxs("div",{style:{marginTop:8,fontSize:11,color:k.inkMid,display:"flex",gap:10,flexWrap:"wrap"},children:[p.contacto&&e.jsxs("span",{children:[" ",p.contacto]}),p.email&&e.jsxs("span",{children:[" ",p.email]}),(p.telMovil||p.tel)&&e.jsxs("span",{children:[" ",p.prefijoMovil||"+57"," ",p.telMovil||p.tel]}),p.telFijo&&e.jsxs("span",{children:[" ",p.prefijoFijo||"+601"," ",p.telFijo]})]}),(p.formaPago||p.metodoPago||p.nit)&&e.jsxs("div",{style:{marginTop:4,fontSize:10,color:k.inkLight,display:"flex",gap:10},children:[p.nit&&e.jsxs("span",{children:["NIT: ",p.nit]}),p.metodoPago&&e.jsxs("span",{children:[" ",p.metodoPago]}),p.formaPago&&e.jsxs("span",{children:[" ",p.formaPago]})]})]},p.id)),m.length===0&&e.jsx("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:40,color:k.inkLight,fontSize:13},children:r||u!=="Todos"?"Sin resultados.":"Sin proveedores. Aade el primero."})]})]})}const fh=[{id:"dashboard",lbl:"Dashboard",en:"Dashboard",I:Bc},{id:"offers",lbl:"Ofertas",en:"Offers",I:Bt},{id:"clientes",lbl:"Clientes",en:"Clients",I:fd}];function xh({view:t,sv:i,lang:o,setLang:n,open:s,toggle:r}){return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,className:"no-print",style:{position:"fixed",top:10,left:s?208:10,zIndex:1002,width:28,height:28,background:s?"rgba(255,255,255,0.1)":"#111",color:s?"rgba(255,255,255,0.5)":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",transition:"left .2s ease"},children:s?"":""}),e.jsxs("div",{className:"no-print",style:{width:200,background:k.sidebar,height:"100vh",position:"fixed",left:s?0:-200,top:0,display:"flex",flexDirection:"column",transition:"left .2s ease",zIndex:1001},children:[e.jsx("div",{style:{padding:"22px 18px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(Ga,{size:32,color:"#fff"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:"'DM Sans', sans-serif",fontWeight:600,fontSize:14,letterSpacing:4,color:"#fff",textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:9,letterSpacing:2,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",fontWeight:400},children:o==="en"?"CRM  Offers":"CRM  Ofertas"})]})]})}),e.jsx("nav",{style:{padding:"12px 8px",flex:1},children:fh.map(a=>{const u=t===a.id||t.startsWith("offer-")&&a.id==="offers";return e.jsxs("button",{onClick:()=>i(a.id),style:{display:"flex",alignItems:"center",gap:10,width:"100%",padding:"10px 12px",borderRadius:2,border:"none",cursor:"pointer",background:u?k.sidebarAct:"transparent",color:u?"#fff":"rgba(255,255,255,0.35)",fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:u?600:400,letterSpacing:1.2,textTransform:"uppercase",marginBottom:1,transition:"all .15s",borderLeft:u?"2px solid rgba(255,255,255,0.6)":"2px solid transparent"},children:[e.jsx(a.I,{size:13}),o==="en"&&a.en?a.en:a.lbl]},a.id)})}),e.jsxs("div",{style:{padding:"14px 18px",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("div",{style:{display:"flex",gap:0,marginBottom:8},children:[["es"," ES"],["en"," EN"]].map(([a,u])=>e.jsx("button",{onClick:()=>n(a),style:{flex:1,padding:"5px 0",fontSize:10,fontWeight:600,cursor:"pointer",border:"1px solid rgba(255,255,255,0.15)",fontFamily:"'DM Sans',sans-serif",borderRadius:a==="es"?"4px 0 0 4px":"0 4px 4px 0",background:o===a?"#fff":"transparent",color:o===a?"#111":"rgba(255,255,255,0.4)"},children:u},a))}),e.jsx("p",{style:{fontSize:9,color:"rgba(255,255,255,0.15)",margin:0,letterSpacing:1,textTransform:"uppercase"},children:"v3.0  Fase 2  2025"})]})]})]})}function mh({offers:t,sv:i,sei:o,lang:n}){const s=F.useMemo(()=>{const a=t.filter(b=>b.estado==="Ganada"),u=t.filter(b=>b.estado==="Perdida"),h=t.filter(b=>!["Ganada","Perdida","Cancelada"].includes(b.estado));return{gan:a,per:u,act:h,pip:h.reduce((b,j)=>b+(Jn(j).PVP_IVA||0),0),ganado:a.reduce((b,j)=>b+(Jn(j).PVP_IVA||0),0),tasa:a.length+u.length>0?(a.length/(a.length+u.length)*100).toFixed(0):0}},[t]),r=[...t].sort((a,u)=>new Date(u.updatedAt)-new Date(a.updatedAt)).slice(0,6);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{marginBottom:28},children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 6px"},children:n==="en"?"General panel":"Panel general"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:k.ink,margin:0,letterSpacing:-.5},children:"Dashboard"})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[e.jsx(Rr,{lbl:n==="en"?"Total offers":"Total ofertas",val:t.length,icon:Bt,col:k.ink}),e.jsx(Rr,{lbl:n==="en"?"Active pipeline":"Pipeline activo",val:Ft(s.pip),icon:Yi,col:k.info,sub:`${s.act.length} ${n==="en"?"offer(s)":"oferta(s)"}`}),e.jsx(Rr,{lbl:n==="en"?"Total won":"Total ganado",val:Ft(s.ganado),icon:gd,col:k.success,sub:`${s.gan.length} ${n==="en"?"won":"ganada(s)"}`}),e.jsx(Rr,{lbl:n==="en"?"Win rate":"% Adjudicacin",val:`${s.tasa}%`,icon:Tc,col:k.warning,sub:`${s.per.length} ${n==="en"?"lost":"perdida(s)"}`})]}),e.jsx("div",{style:{display:"flex",gap:8,marginBottom:22,flexWrap:"wrap"},children:Ka.map(a=>{const u=t.filter(h=>h.estado===a).length;return u?e.jsxs("div",{onClick:()=>i("offers"),style:{display:"flex",alignItems:"center",gap:8,background:k.surface,border:`1px solid ${k.border}`,borderRadius:2,padding:"7px 13px",cursor:"pointer"},children:[e.jsx(Ma,{e:a}),e.jsx("span",{style:{fontSize:13,fontWeight:700,color:k.ink},children:u})]},a):null})}),e.jsxs(rt,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${k.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:13,fontWeight:700,color:k.ink,margin:0,textTransform:"uppercase",letterSpacing:.5},children:"Ofertas recientes"}),e.jsx(ht,{v:"ghost",sm:!0,icon:Xi,on:()=>i("offers"),children:"Ver todas"})]}),r.length===0?e.jsxs("div",{style:{padding:48,textAlign:"center",color:k.inkLight},children:[e.jsx(Bt,{size:30,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{margin:"0 0 14px",fontSize:13},children:"An no hay ofertas"}),e.jsx(ht,{icon:Ne,on:()=>i("offer-new"),children:"Nueva oferta"})]}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Cliente","Proyecto","Tipo","PVP c/IVA","Estado",""].map(a=>e.jsx("th",{style:{padding:"10px 16px",textAlign:"left",fontSize:9,fontWeight:600,color:k.inkLight,textTransform:"uppercase",letterSpacing:1.2},children:a},a))})}),e.jsx("tbody",{children:r.map(a=>{const u=Jn(a);return e.jsxs("tr",{style:{borderTop:`1px solid ${k.border}`},onMouseEnter:h=>h.currentTarget.style.background="#FFFFFF",onMouseLeave:h=>h.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"12px 16px",fontSize:13,fontWeight:500,color:k.ink},children:a.cliente||""}),e.jsx("td",{style:{padding:"12px 16px",fontSize:12,color:k.inkMid},children:a.proyecto||""}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("span",{style:{fontSize:9,background:k.accentBg,color:k.ink,padding:"2px 8px",borderRadius:2,fontWeight:700,letterSpacing:1,textTransform:"uppercase"},children:a.tipoProyecto==="DISEO"?(a.subtipoDiseno||"Diseo").split(" ").pop():a.tipoProyecto})}),e.jsx("td",{style:{padding:"12px 16px",fontSize:13,fontWeight:700,color:k.ink},children:Ft(u.PVP_IVA)}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(Ma,{e:a.estado})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx(ht,{sm:!0,v:"ghost",icon:No,on:()=>{o(a.id),i("offer-edit")}})})]},a.id)})})]})]})]})}function bh({offers:t,sv:i,sei:o,onDel:n,onDup:s}){const[r,a]=F.useState(""),[u,h]=F.useState("Todos"),[b,j]=F.useState("Todos"),C=F.useMemo(()=>t.filter(v=>(!r||[v.cliente,v.proyecto,v.ubicacion].join(" ").toLowerCase().includes(r.toLowerCase()))&&(u==="Todos"||v.estado===u)&&(b==="Todos"||v.tipoProyecto===b)).sort((v,m)=>new Date(m.updatedAt)-new Date(v.updatedAt)),[t,r,u,b]);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:28},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 6px"},children:"Biblioteca"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:k.ink,margin:0,letterSpacing:-.5},children:"Ofertas"}),e.jsxs("p",{style:{color:k.inkLight,fontSize:11,margin:"4px 0 0"},children:[t.length," oferta(s) registrada(s)"]})]}),e.jsx(ht,{icon:Ne,on:()=>i("offer-new"),children:"Nueva oferta"})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(ki,{size:13,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:k.inkLight}}),e.jsx("input",{value:r,onChange:v=>a(v.target.value),placeholder:"Buscar cliente, proyecto...",style:{width:"100%",padding:"9px 12px 9px 32px",border:`1px solid ${k.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:k.surface,color:k.ink}})]}),[{val:u,sv:h,opts:["Todos",...Ka]},{val:b,sv:j,opts:["Todos","OBRA","DISEO"]}].map(({val:v,sv:m,opts:f},p)=>e.jsx("select",{value:v,onChange:c=>m(c.target.value),style:{padding:"9px 12px",border:`1px solid ${k.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:k.surface,color:k.ink},children:f.map(c=>e.jsx("option",{value:c,children:c},c))},p))]}),e.jsx(rt,{style:{padding:0,overflow:"hidden"},children:C.length===0?e.jsx("div",{style:{padding:40,textAlign:"center",color:k.inkLight},children:e.jsx("p",{style:{fontSize:13},children:"No se encontraron ofertas"})}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["#","Cliente / Proyecto","Modalidad","Costo dir.","PVP c/IVA","Margen","Estado","Fecha",""].map(v=>e.jsx("th",{style:{padding:"10px 14px",textAlign:"left",fontSize:9,fontWeight:600,color:k.inkLight,textTransform:"uppercase",letterSpacing:1,whiteSpace:"nowrap"},children:v},v))})}),e.jsx("tbody",{children:C.map((v,m)=>{const f=Jn(v);return e.jsxs("tr",{style:{borderTop:`1px solid ${k.border}`},onMouseEnter:p=>p.currentTarget.style.background="#FFFFFF",onMouseLeave:p=>p.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"11px 14px",fontSize:10,color:k.inkLight,fontWeight:600},children:String(m+1).padStart(3,"0")}),e.jsxs("td",{style:{padding:"11px 14px"},children:[e.jsx("p",{style:{margin:0,fontSize:13,fontWeight:600,color:k.ink},children:v.cliente||""}),e.jsx("p",{style:{margin:0,fontSize:11,color:k.inkLight},children:v.proyecto||"Sin nombre"})]}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsx("span",{style:{fontSize:9,background:k.accentBg,color:k.ink,padding:"2px 8px",borderRadius:2,fontWeight:700,letterSpacing:.8,textTransform:"uppercase"},children:v.tipoProyecto==="DISEO"?v.subtipoDiseno||"Diseo":v.tipoProyecto})}),e.jsx("td",{style:{padding:"11px 14px",fontSize:12,color:k.inkMid},children:Ft(f.COSTO)}),e.jsx("td",{style:{padding:"11px 14px",fontSize:13,fontWeight:700,color:k.ink},children:Ft(f.PVP_IVA)}),e.jsx("td",{style:{padding:"11px 14px",fontSize:12,color:f.PVP>0?k.success:k.inkLight},children:f.PVP>0?pt(v.margen):""}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsx(Ma,{e:v.estado})}),e.jsx("td",{style:{padding:"11px 14px",fontSize:10,color:k.inkLight,whiteSpace:"nowrap"},children:v.updatedAt?new Date(v.updatedAt).toLocaleDateString("es-CO"):""}),e.jsx("td",{style:{padding:"11px 14px"},children:e.jsxs("div",{style:{display:"flex",gap:3},children:[e.jsx(ht,{sm:!0,v:"ghost",icon:No,on:()=>{o(v.id),i("offer-edit")}}),e.jsx(ht,{sm:!0,v:"ghost",icon:xa,on:()=>s(v.id)}),e.jsx(ht,{sm:!0,v:"danger",icon:Je,on:()=>n(v.id)})]})})]},v.id)})})]})})]})}const Qr=[{id:"DIS",label:"Diseo",color:"#5B3A8C",icon:"",modo:"diseno"},{id:"REF",label:"Reforma / construccin",color:"#8C6A00",icon:"",modo:"ejecucion"},{id:"INS",label:"Instalaciones",color:"#3B3B3B",icon:"",modo:"ejecucion"},{id:"MOB",label:"Carpintera y mobiliario",color:"#6B4226",icon:"",modo:"ejecucion"},{id:"DIR",label:"Direccin / supervisin",color:"#0D5E6E",icon:"",modo:"diseno"},{id:"SER",label:"Servicios tcnicos",color:"#555555",icon:"",modo:"diseno"}],Ps=[{id:"g01",termino:"Planta arquitectnica",definicion:"Representacin grfica horizontal a escala de la distribucin y dimensiones de los espacios de un nivel."},{id:"g02",termino:"Corte o seccin",definicion:"Representacin grfica vertical que muestra la relacin entre niveles, alturas y elementos constructivos."},{id:"g03",termino:"Fachada",definicion:"Representacin grfica de la vista exterior del proyecto, mostrando materiales, proporciones y acabados."},{id:"g04",termino:"Planta constructiva",definicion:"Planta con cotas, niveles, ejes y especificaciones tcnicas para la ejecucin en obra."},{id:"g05",termino:"Modelado 3D",definicion:"Representacin tridimensional digital del proyecto que permite visualizar espacios, materiales y proporciones."},{id:"g06",termino:"Renderizado",definicion:"Imagen fotorrealista generada a partir del modelo 3D que simula iluminacin, materiales y ambientacin."},{id:"g07",termino:"Moodboard",definicion:"Tablero visual de inspiracin que rene referencias de estilo, colores, texturas y mobiliario para definir la direccin esttica."},{id:"g08",termino:"Memoria de calidades",definicion:"Documento que especifica las marcas, referencias y caractersticas tcnicas de todos los materiales y acabados del proyecto."},{id:"g09",termino:"Carpinteras",definicion:"Elementos de madera, metal o PVC como puertas, ventanas, closets y mobiliario fijo diseados a medida."},{id:"g10",termino:"Biofilia",definicion:"Integracin de elementos naturales (vegetacin, luz natural, materiales orgnicos) en el diseo para mejorar el bienestar."},{id:"g11",termino:"APU",definicion:"Anlisis de Precio Unitario. Desglose detallado del costo de una actividad incluyendo materiales, mano de obra, equipos e indirectos."},{id:"g12",termino:"AIU",definicion:"Administracin, Imprevistos y Utilidad. Porcentaje que se aplica sobre los costos directos para cubrir gastos indirectos del proyecto."},{id:"g13",termino:"Cronograma",definicion:"Planificacin temporal del proyecto que establece la secuencia, duracin y dependencias de cada actividad."},{id:"g14",termino:"Alcance",definicion:"Descripcin detallada de los trabajos, servicios y entregables incluidos en la propuesta."},{id:"g15",termino:"Entregable",definicion:"Producto o documento especfico que forma parte del alcance contratado y ser entregado al cliente."}],Mn=[{id:"CAP00",label:"00  Preliminares e instalaciones provisionales",color:"#555555"},{id:"CAP01",label:"01  Demoliciones y desmonte",color:"#8C6A00"},{id:"CAP02",label:"02  Movimiento de tierras",color:"#6B4226"},{id:"CAP03",label:"03  Cimentaciones",color:"#5B3A8C"},{id:"CAP04",label:"04  Estructura",color:"#3B3B3B"},{id:"CAP05",label:"05  Mampostera y cerramientos",color:"#0D5E6E"},{id:"CAP06",label:"06  Cubierta e impermeabilizacin",color:"#8C6A00"},{id:"CAP07",label:"07  Instalaciones elctricas",color:"#111111"},{id:"CAP08",label:"08  Instalaciones hidrosanitarias",color:"#3B3B3B"},{id:"CAP09",label:"09  Instalaciones de gas",color:"#B91C1C"},{id:"CAP10",label:"10  Acabados generales",color:"#555555"},{id:"CAP11",label:"11  Pisos y enchapes",color:"#6B4226"},{id:"CAP12",label:"12  Pintura",color:"#5B3A8C"},{id:"CAP13",label:"13  Carpintera metlica y vidriera",color:"#0D5E6E"},{id:"CAP14",label:"14  Carpintera de madera y mobiliario",color:"#6B4226"},{id:"CAP15",label:"15  Obras exteriores y urbanismo",color:"#111111"},{id:"CAP16",label:"16  Equipamiento especial",color:"#555555"},{id:"CAP17",label:"17  Diseo y direccin tcnica",color:"#5B3A8C"},{id:"CAP18",label:"18  Admin, imprevistos y utilidad (AIU)",color:"#3B3B3B"}],Dl=[{id:"lev",nombre:"Levantamiento arquitectnico",horas:4,tipo:"plano"},{id:"propArq",nombre:"Propuesta arquitectnica",horas:8,tipo:"plano"},{id:"propInt",nombre:"Propuesta de interiores",horas:6,tipo:"plano"},{id:"cortes",nombre:"Cortes y fachadas",horas:3,tipo:"plano"},{id:"det",nombre:"Detalles constructivos",horas:4,tipo:"plano"},{id:"inst_e",nombre:"Plano instalaciones elctricas",horas:3,tipo:"plano"},{id:"inst_h",nombre:"Plano instalaciones hidrosanitarias",horas:3,tipo:"plano"},{id:"render",nombre:"Renders 3D exteriores (x3)",horas:12,tipo:"render"},{id:"render_i",nombre:"Renders 3D interiores (x5)",horas:10,tipo:"render"},{id:"recorrido",nombre:"Recorrido virtual 360",horas:16,tipo:"render"},{id:"memoria",nombre:"Memoria descriptiva",horas:4,tipo:"doc"},{id:"cuadro",nombre:"Cuadro de reas",horas:2,tipo:"doc"},{id:"presup",nombre:"Presupuesto de obra (tem por tem)",horas:8,tipo:"doc"},{id:"licencia",nombre:"Gestin licencia construccin",horas:20,tipo:"tramite"},{id:"topog",nombre:"Levantamiento topogrfico",horas:0,tipo:"subcontrata"},{id:"estruc",nombre:"Clculo estructural",horas:0,tipo:"subcontrata"},{id:"suelos",nombre:"Estudio de suelos",horas:0,tipo:"subcontrata"}],no=[{codigo:"EPP-001",nombre:"Casco de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:24,precioRef:35e3},{codigo:"EPP-002",nombre:"Botas de seguridad",familia:"epp",unidad:"par",vidaUtilMeses:12,precioRef:12e4},{codigo:"EPP-003",nombre:"Guantes de carnaza",familia:"epp",unidad:"par",vidaUtilMeses:3,precioRef:12e3},{codigo:"EPP-004",nombre:"Gafas de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:12,precioRef:18e3},{codigo:"EPP-005",nombre:"Chaleco reflectivo",familia:"epp",unidad:"ud",vidaUtilMeses:12,precioRef:25e3},{codigo:"EPP-006",nombre:"Proteccin auditiva",familia:"epp",unidad:"ud",vidaUtilMeses:6,precioRef:8e3},{codigo:"EPP-007",nombre:"Mascarilla con filtro",familia:"epp",unidad:"ud",vidaUtilMeses:1,precioRef:15e3},{codigo:"EPP-008",nombre:"Arns de seguridad",familia:"epp",unidad:"ud",vidaUtilMeses:36,precioRef:18e4},{codigo:"EPP-009",nombre:"Guantes de nitrilo",familia:"epp",unidad:"caja",vidaUtilMeses:1,precioRef:28e3},{codigo:"EPP-010",nombre:"Careta de soldar",familia:"epp",unidad:"ud",vidaUtilMeses:24,precioRef:85e3},{codigo:"DOT-001",nombre:"Overol de trabajo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:65e3},{codigo:"DOT-002",nombre:"Camiseta con logo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:3e4},{codigo:"DOT-003",nombre:"Pantaln de trabajo",familia:"dotacion",unidad:"ud",vidaUtilMeses:6,precioRef:45e3},{codigo:"HM-001",nombre:"Martillo de ua",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:35e3},{codigo:"HM-002",nombre:"Juego destornilladores",familia:"herr_menor",unidad:"jgo",vidaUtilMeses:24,precioRef:45e3},{codigo:"HM-003",nombre:"Flexmetro 5m",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:22e3},{codigo:"HM-004",nombre:"Nivel de burbuja 60cm",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:38e3},{codigo:"HM-005",nombre:"Llana dentada",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:18e3},{codigo:"HM-006",nombre:"Llana lisa",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:15e3},{codigo:"HM-007",nombre:"Maceta 2lb",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:25e3},{codigo:"HM-008",nombre:"Cincel plano",familia:"herr_menor",unidad:"ud",vidaUtilMeses:12,precioRef:12e3},{codigo:"HM-009",nombre:"Pala redonda",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:3e4},{codigo:"HM-010",nombre:"Pica",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:28e3},{codigo:"HM-011",nombre:"Carretilla",familia:"herr_menor",unidad:"ud",vidaUtilMeses:18,precioRef:95e3},{codigo:"HM-012",nombre:"Pinza pelacables",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:25e3},{codigo:"HM-013",nombre:"Alicate universal",familia:"herr_menor",unidad:"ud",vidaUtilMeses:24,precioRef:28e3},{codigo:"HM-014",nombre:'Llave ajustable 10"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:36,precioRef:32e3},{codigo:"HM-015",nombre:'Esptula 3"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:6,precioRef:8e3},{codigo:"HM-016",nombre:"Rodillo de pintura",familia:"herr_menor",unidad:"ud",vidaUtilMeses:3,precioRef:12e3},{codigo:"HM-017",nombre:'Brocha 4"',familia:"herr_menor",unidad:"ud",vidaUtilMeses:3,precioRef:8e3},{codigo:"HY-001",nombre:"Taladro percutor",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:28e4},{codigo:"HY-002",nombre:'Pulidora 7"',familia:"herr_mayor",unidad:"ud",vidaUtilMeses:36,precioRef:35e4},{codigo:"HY-003",nombre:"Sierra circular",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:42e4},{codigo:"HY-004",nombre:"Rotomartillo SDS",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:48,precioRef:65e4},{codigo:"HY-005",nombre:"Cortadora de baldosa",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:36,precioRef:38e4},{codigo:"HY-006",nombre:"Compresor de aire",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:60,precioRef:85e4},{codigo:"HY-007",nombre:"Equipo de soldadura",familia:"herr_mayor",unidad:"ud",vidaUtilMeses:60,precioRef:95e4},{codigo:"EO-001",nombre:"Andamio certificado",familia:"equipo_obra",unidad:"cuerpo",vidaUtilMeses:60,precioRef:18e4},{codigo:"EO-002",nombre:"Escalera tijera 2m",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:18e4},{codigo:"EO-003",nombre:"Escalera extensin 4m",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:35e4},{codigo:"EO-004",nombre:"Mezcladora de concreto",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:60,precioRef:25e5},{codigo:"EO-005",nombre:"Vibrador de concreto",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:48,precioRef:12e5},{codigo:"EO-006",nombre:"Pluma gra manual",familia:"equipo_obra",unidad:"ud",vidaUtilMeses:60,precioRef:35e5},{codigo:"EM-001",nombre:"Flexmetro lser",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:25e4},{codigo:"EM-002",nombre:"Nivel lser",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:48e4},{codigo:"EM-003",nombre:"Multmetro digital",familia:"equipo_medic",unidad:"ud",vidaUtilMeses:36,precioRef:12e4},{codigo:"CO-001",nombre:"Cinta aislante",familia:"consumible",unidad:"rollo",vidaUtilMeses:1,precioRef:5e3},{codigo:"CO-002",nombre:"Silicona transparente",familia:"consumible",unidad:"tubo",vidaUtilMeses:1,precioRef:12e3},{codigo:"CO-003",nombre:'Disco de corte 7"',familia:"consumible",unidad:"ud",vidaUtilMeses:1,precioRef:8e3},{codigo:"CO-004",nombre:"Broca para concreto set",familia:"consumible",unidad:"jgo",vidaUtilMeses:3,precioRef:35e3},{codigo:"CO-005",nombre:"Lija #80 pliego",familia:"consumible",unidad:"pliego",vidaUtilMeses:1,precioRef:3e3},{codigo:"SC-001",nombre:"Cinta de demarcacin",familia:"seguridad",unidad:"rollo",vidaUtilMeses:1,precioRef:15e3},{codigo:"SC-002",nombre:"Malla de cerramiento",familia:"seguridad",unidad:"rollo",vidaUtilMeses:6,precioRef:45e3},{codigo:"SC-003",nombre:"Sealizacin obra",familia:"seguridad",unidad:"jgo",vidaUtilMeses:12,precioRef:85e3},{codigo:"SC-004",nombre:"Extintor multipropsito",familia:"seguridad",unidad:"ud",vidaUtilMeses:12,precioRef:65e3},{codigo:"SC-005",nombre:"Botiqun tipo A",familia:"seguridad",unidad:"ud",vidaUtilMeses:12,precioRef:12e4}],pn={peon:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],ayudante:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","DOT-001"],oficial2:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],oficial1:["EPP-001","EPP-002","EPP-003","EPP-004","EPP-005","EPP-006","DOT-001"],encargado:["EPP-001","EPP-002","EPP-004","EPP-005","DOT-002","DOT-003"],residente:["EPP-001","EPP-002","EPP-005","DOT-002"],jefe_obra:["EPP-001","EPP-002","EPP-005","DOT-002"],arq:["EPP-001","EPP-005"],ing:["EPP-001","EPP-002","EPP-005","DOT-002"]},_a={eq_elec_basico:["HY-001","HM-002","HM-012","HM-013","EM-003","CO-001","EO-002"],eq_obra_civil:["HM-009","HM-010","HM-011","HM-004","HM-003","HM-007","HM-008","HM-005","EO-003","EO-001"],eq_diseno_int:["EM-001","EM-002","HM-003"]},Hn={epp:"EPP",dotacion:"Dotacin",herr_menor:"Herram. menor",herr_mayor:"Herram. mayor",equipo_obra:"Equipo obra",equipo_medic:"Medicin",consumible:"Consumible",seguridad:"Seguridad"},us={epp:"",dotacion:"",herr_menor:"",herr_mayor:"",equipo_obra:"",equipo_medic:"",consumible:"",seguridad:""},Lo=t=>no.find(i=>i.codigo===t),yh=[{id:"dir_creativo",nombre:"Director Creativo",salarioBruto:8e6,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0},{id:"arq_senior",nombre:"Arquitecto Senior",salarioBruto:55e5,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0},{id:"arq_junior",nombre:"Arquitecto Junior",salarioBruto:3e6,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0},{id:"disenador_int",nombre:"Diseador de Interiores",salarioBruto:4e6,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0},{id:"modelador_3d",nombre:"Modelador 3D / BIM",salarioBruto:35e5,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0},{id:"dibujante",nombre:"Dibujante Tcnico",salarioBruto:25e5,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0},{id:"residente",nombre:"Residente de Obra",salarioBruto:42e5,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0},{id:"aux_admin",nombre:"Auxiliar Administrativo",salarioBruto:18e5,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0}],vh=[{id:"macbook_pro",nombre:'MacBook Pro 14"',valorCompra:12e6,vidaUtilAnios:5,usoAnual:1760,activo:!0},{id:"monitor_4k",nombre:'Monitor 4K 27"',valorCompra:25e5,vidaUtilAnios:5,usoAnual:1760,activo:!0},{id:"ipad_pro",nombre:"iPad Pro + Pencil",valorCompra:5e6,vidaUtilAnios:4,usoAnual:1760,activo:!0},{id:"impresora_a3",nombre:"Plotter / Impresora A3",valorCompra:8e6,vidaUtilAnios:7,usoAnual:1760,activo:!0},{id:"disco_ext",nombre:"Disco SSD externo 2TB",valorCompra:6e5,vidaUtilAnios:4,usoAnual:1760,activo:!0}],jh=[{id:"autocad",nombre:"AutoCAD",costoAnual:36e5,activo:!0},{id:"revit",nombre:"Revit",costoAnual:48e5,activo:!0},{id:"sketchup_pro",nombre:"SketchUp Pro",costoAnual:12e5,activo:!0},{id:"adobe_suite",nombre:"Adobe Creative Suite",costoAnual:18e5,activo:!0},{id:"lumion",nombre:"Lumion",costoAnual:72e5,activo:!0},{id:"enscape",nombre:"Enscape",costoAnual:24e5,activo:!0},{id:"office365",nombre:"Microsoft 365",costoAnual:48e4,activo:!0},{id:"canva_pro",nombre:"Canva Pro",costoAnual:36e4,activo:!0}],Sh={hDia:8,diasSemana:5,semanasAnio:50,pctProductivas:75,diasFestivos:18,diasAusencias:5},Ch=[{id:"epp_casco",nombre:"Casco de seguridad",familia:"epp",precio:45e3,vidaUtil:12,activo:!0,asociadoACargo:!0,cargosAsociados:["residente"]},{id:"epp_chaleco",nombre:"Chaleco reflectivo",familia:"epp",precio:25e3,vidaUtil:6,activo:!0,asociadoACargo:!0,cargosAsociados:["residente"]},{id:"epp_botas",nombre:"Botas de seguridad",familia:"epp",precio:18e4,vidaUtil:12,activo:!0,asociadoACargo:!0,cargosAsociados:["residente"]},{id:"epp_gafas",nombre:"Gafas de seguridad",familia:"epp",precio:15e3,vidaUtil:6,activo:!0,asociadoACargo:!0,cargosAsociados:["residente"]},{id:"epp_guantes",nombre:"Guantes de trabajo",familia:"epp",precio:12e3,vidaUtil:3,activo:!0,asociadoACargo:!0,cargosAsociados:["residente"]},{id:"dot_camisa",nombre:"Camisa corporativa",familia:"dotacion",precio:85e3,vidaUtil:12,activo:!0,asociadoACargo:!1,cargosAsociados:[]},{id:"herr_flexo",nombre:"Flexmetro 5m",familia:"herr_menor",precio:35e3,vidaUtil:24,activo:!0},{id:"herr_nivel",nombre:"Nivel lser",familia:"herr_menor",precio:35e4,vidaUtil:36,activo:!0},{id:"herr_distanc",nombre:"Distancimetro lser",familia:"herr_menor",precio:28e4,vidaUtil:36,activo:!0}],kh={id:"cuad_diseno_std",nombre:"Equipo Diseo Estndar",cargos:[{id:"cd1",cargoId:"dir_creativo",cantidad:1},{id:"cd2",cargoId:"arq_senior",cantidad:1},{id:"cd3",cargoId:"modelador_3d",cantidad:1}],activosUsados:[{id:"ad1",activoId:"macbook_pro",cantidad:3},{id:"ad2",activoId:"monitor_4k",cantidad:3}],licenciasUsadas:[{id:"ld1",licId:"autocad",cantidad:2},{id:"ld2",licId:"sketchup_pro",cantidad:1},{id:"ld3",licId:"lumion",cantidad:1},{id:"ld4",licId:"adobe_suite",cantidad:3}],logItemsUsados:[],rendimiento:1,notas:"Cuadrilla estndar para proyectos de diseo arquitectnico e interiores."},wh={id:"cuad_obra_std",nombre:"Equipo Supervisin Obra",cargos:[{id:"co1",cargoId:"residente",cantidad:1},{id:"co2",cargoId:"aux_admin",cantidad:1}],activosUsados:[{id:"ao1",activoId:"macbook_pro",cantidad:1},{id:"ao2",activoId:"ipad_pro",cantidad:1}],licenciasUsadas:[{id:"lo1",licId:"office365",cantidad:2}],logItemsUsados:[{id:"lio1",itemId:"herr_flexo",cantidad:1},{id:"lio2",itemId:"herr_nivel",cantidad:1},{id:"lio3",itemId:"herr_distanc",cantidad:1}],rendimiento:1,notas:"Cuadrilla estndar para supervisin y direccin de obra."},zh=async()=>{var t,i,o,n,s,r,a,u,h,b,j,C;try{return await Promise.all([(i=(t=window.storage)==null?void 0:t.set)==null?void 0:i.call(t,"hab:rrhh:cargos",JSON.stringify(yh)),(n=(o=window.storage)==null?void 0:o.set)==null?void 0:n.call(o,"hab:rrhh:activos",JSON.stringify(vh)),(r=(s=window.storage)==null?void 0:s.set)==null?void 0:r.call(s,"hab:rrhh:licencias",JSON.stringify(jh)),(u=(a=window.storage)==null?void 0:a.set)==null?void 0:u.call(a,"hab:rrhh:jornada",JSON.stringify(Sh)),(b=(h=window.storage)==null?void 0:h.set)==null?void 0:b.call(h,"hab:logistica:items",JSON.stringify(Ch)),(C=(j=window.storage)==null?void 0:j.set)==null?void 0:C.call(j,"hab:crm:equipos",JSON.stringify([kh,wh]))]),!0}catch(v){return console.error("Seed error:",v),!1}},Eh=async()=>{var t,i,o,n,s,r,a,u,h,b;try{return await Promise.all([(i=(t=window.storage)==null?void 0:t.set)==null?void 0:i.call(t,"hab:rrhh:cargos",JSON.stringify([])),(n=(o=window.storage)==null?void 0:o.set)==null?void 0:n.call(o,"hab:rrhh:activos",JSON.stringify([])),(r=(s=window.storage)==null?void 0:s.set)==null?void 0:r.call(s,"hab:rrhh:licencias",JSON.stringify([])),(u=(a=window.storage)==null?void 0:a.set)==null?void 0:u.call(a,"hab:logistica:items",JSON.stringify([])),(b=(h=window.storage)==null?void 0:h.set)==null?void 0:b.call(h,"hab:crm:equipos",JSON.stringify([]))]),!0}catch(j){return console.error("Clear error:",j),!1}},Eo={CO:{categorias:[{id:"peon",label:"Pen de obra",salario:1423500,factor:1.618,horasMes:192},{id:"oficial2",label:"Oficial 2",salario:175e4,factor:1.618,horasMes:192},{id:"oficial1",label:"Oficial 1",salario:21e5,factor:1.618,horasMes:192},{id:"encargado",label:"Encargado de obra",salario:28e5,factor:1.618,horasMes:192},{id:"residente",label:"Residente / Inspector",salario:42e5,factor:1.618,horasMes:192},{id:"arq",label:"Arquitecto",salario:35e5,factor:1.618,horasMes:192},{id:"ing",label:"Ingeniero",salario:45e5,factor:1.618,horasMes:192}]},ES:{categorias:[{id:"peon",label:"Pen ordinario",salarioAnual:20800,ss:.299,horasAnio:1736},{id:"ayudante",label:"Ayudante",salarioAnual:22400,ss:.299,horasAnio:1736},{id:"oficial2",label:"Oficial 2",salarioAnual:24600,ss:.299,horasAnio:1736},{id:"oficial1",label:"Oficial 1",salarioAnual:27200,ss:.299,horasAnio:1736},{id:"encargado",label:"Encargado",salarioAnual:32e3,ss:.299,horasAnio:1736},{id:"jefe_obra",label:"Jefe de obra",salarioAnual:45e3,ss:.299,horasAnio:1736},{id:"arq",label:"Arquitecto/Aparejador",salarioAnual:4e4,ss:.299,horasAnio:1736}]}},Ah=t=>t.salario*t.factor/t.horasMes,Fh=t=>t.salarioAnual*(1+t.ss)/t.horasAnio,lo=(t,i)=>{var s;const n=(((s=Eo[i])==null?void 0:s.categorias)||[]).find(r=>r.id===t);return n?i==="CO"?Ah(n):Fh(n):0},Th=(t,i)=>{const o=i.pais||"CO",n=o==="CO"?"COP":"EUR",s=t.apu||{},r=t.tipo;if(r==="diseno_arq"||r==="diseno_int"){const p=s.estudios||[],c=s.mo||[],d=s.subcontratas||[],l=p.reduce((E,w)=>E+(w.horas||0),0),x=i.apuModoHora==="MANUAL"?i.apuCostoHoraManual||0:(()=>{const E=(i.apuHDia||8)*(i.apuDiasSem||5)*(i.apuSemanas||52)*(i.apuPctProductivas||.6),w=(i.apuSalarioAnual||0)*(1+(i.apuPrestaciones||.65))+(i.apuLicencias||0)+(i.apuEquipos||0)+(i.apuAccesorios||0);return E>0?w/E:0})(),y=l*x,g=c.reduce((E,w)=>E+(w.horas||0)*lo(w.catId,o),0),S=d.reduce((E,w)=>E+(w.importe||0),0);return{CD:y+g+S,cdDis:y,cdMO:g,cdSub:S,horasTotal:l,costoH:x,moneda:n}}s.cuadrillas;const a=s.materiales||[],u=s.equipos||[],h=s.subcontratas||[],j=(s.equiposUsados||[]).reduce((p,c)=>{var y;let d=null;try{d=(JSON.parse(((y=Fe.get("hab:crm:equipos"))==null?void 0:y.value)||"null")||Ja).find(S=>S.id===c.eqId)}catch{}if(!d)return p;const x=(c.rendimientoOverride??d.rendimiento)*(t.cantidad||1);return p+d.cargos.reduce((g,S)=>{const A=lo(S.catId,o);return g+A*x*(S.cantidad||1)},0)+(d.equiposCosto||0)+(d.licenciasCosto||0)},0),C=a.reduce((p,c)=>p+(c.cantidad||0)*(c.precio||0),0),v=u.reduce((p,c)=>p+(c.cantidad||0)*(c.precio||0),0),m=h.reduce((p,c)=>p+(c.importe||0),0);return{CD:j+C+v+m,cdMO:j,cdMat:C,cdEq:v,cdSub:m,moneda:n}},Ja=[{id:"eq_elec_basico",nombre:"Equipo elctrico bsico",cargos:[{id:"c1",catId:"oficial1",cantidad:1},{id:"c2",catId:"ayudante",cantidad:1}],equiposCosto:15e3,licenciasCosto:0,rendimiento:.05},{id:"eq_obra_civil",nombre:"Equipo obra civil",cargos:[{id:"c3",catId:"oficial1",cantidad:1},{id:"c4",catId:"peon",cantidad:2}],equiposCosto:25e3,licenciasCosto:0,rendimiento:.08},{id:"eq_diseno_int",nombre:"Equipo diseo",cargos:[{id:"c5",catId:"arq",cantidad:1}],equiposCosto:0,licenciasCosto:8e3,rendimiento:1}];function ec(){const[t,i]=F.useState(Ja),[o,n]=F.useState(!1);return F.useEffect(()=>{(async()=>{try{const r=await Fe.get("hab:crm:equipos"),a=r?JSON.parse(r.value):null;a!=null&&a.length&&i(a)}catch{}n(!0)})()},[]),[t,async r=>{i(r);try{await Fe.set("hab:crm:equipos",JSON.stringify(r))}catch{}},o]}function Bh({pais:t,onClose:i}){var p;const[o,n]=ec(),[s,r]=F.useState(null),[a,u]=F.useState(null),h=((p=Eo[t])==null?void 0:p.categorias)||[],b=()=>Math.random().toString(36).slice(2,9),j=c=>c!=null&&!isNaN(c)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(c):"0",C=t==="CO"?"COP":"EUR",v=()=>{var c;return{id:b(),nombre:"",rendimiento:.1,cargos:[{id:b(),catId:((c=h[0])==null?void 0:c.id)||"",cantidad:1}],equiposCosto:0,licenciasCosto:0}},m=c=>c.cargos.reduce((d,l)=>{const x=lo(l.catId,t);return d+x*c.rendimiento*(l.cantidad||1)},0)+(c.equiposCosto||0)+(c.licenciasCosto||0),f=(c={})=>({border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 7px",fontSize:12,fontFamily:"'DM Sans',sans-serif",...c});return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:1100,display:"flex",alignItems:"flex-start",justifyContent:"center",overflowY:"auto",padding:"20px 16px"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,width:"100%",maxWidth:680,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Biblioteca global"}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:"#111"},children:"Equipos de trabajo"})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>{u(v()),r(null)},style:{padding:"6px 12px",background:"#111111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ne,{size:12})," Nuevo equipo"]}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx(Ot,{size:20})})]})]}),e.jsxs("div",{style:{padding:"14px 18px"},children:[a&&e.jsxs("div",{style:{border:"1px solid #111111",borderRadius:8,padding:14,marginBottom:16,background:"#F0FAF5"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#111111",marginBottom:10},children:s?"Editando equipo":"Nuevo equipo"}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[e.jsxs("div",{style:{flex:2},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Nombre del equipo"}),e.jsx("input",{value:a.nombre,onChange:c=>u(d=>({...d,nombre:c.target.value})),placeholder:"Ej: Equipo elctrico bsico",style:{...f(),width:"100%",fontSize:13}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Rendimiento (h/ud)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:a.rendimiento,onChange:c=>u(d=>({...d,rendimiento:parseFloat(c.target.value)||0})),style:{...f(),width:"100%",textAlign:"center"}})]})]}),e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:5},children:"Cargos"}),a.cargos.map((c,d)=>e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6,alignItems:"center"},children:[e.jsx("select",{value:c.catId,onChange:l=>u(x=>({...x,cargos:x.cargos.map((y,g)=>g===d?{...y,catId:l.target.value}:y)})),style:{...f(),flex:2},children:h.map(l=>e.jsx("option",{value:l.id,children:l.label},l.id))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flex:1},children:[e.jsx("span",{style:{fontSize:11,color:"#888"},children:""}),e.jsx("input",{type:"number",min:"1",value:c.cantidad,onChange:l=>u(x=>({...x,cargos:x.cargos.map((y,g)=>g===d?{...y,cantidad:parseInt(l.target.value)||1}:y)})),style:{...f(),width:50,textAlign:"center"}})]}),e.jsxs("span",{style:{fontSize:11,color:"#888",fontFamily:"'DM Mono',monospace",flex:1},children:[j(lo(c.catId,t))," ",C,"/h"]}),e.jsx("button",{onClick:()=>u(l=>({...l,cargos:l.cargos.filter((x,y)=>y!==d)})),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:12})})]},c.id)),e.jsxs("button",{onClick:()=>u(c=>{var d;return{...c,cargos:[...c.cargos,{id:b(),catId:((d=h[0])==null?void 0:d.id)||"",cantidad:1}]}}),style:{fontSize:11,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:3,marginBottom:10},children:[e.jsx(Ne,{size:11})," Aadir cargo"]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Equipos/herramientas"}),e.jsx("input",{type:"number",min:"0",value:a.equiposCosto,onChange:c=>u(d=>({...d,equiposCosto:parseFloat(c.target.value)||0})),style:{...f(),width:"100%"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:3},children:"Licencias/medios"}),e.jsx("input",{type:"number",min:"0",value:a.licenciasCosto,onChange:c=>u(d=>({...d,licenciasCosto:parseFloat(c.target.value)||0})),style:{...f(),width:"100%"}})]})]}),e.jsxs("div",{style:{fontSize:12,color:"#111111",fontWeight:600,marginBottom:10},children:["Costo/ud estimado: ",j(m(a))," ",C]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{onClick:()=>{if(!a.nombre){alert("Pon un nombre al equipo");return}n(s?o.map(c=>c.id===s?{...a,id:s}:c):[...o,a]),u(null),r(null)},style:{padding:"6px 14px",background:"#111111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(yt,{size:12})," Guardar"]}),e.jsx("button",{onClick:()=>{u(null),r(null)},style:{padding:"6px 14px",border:"1px solid #E0E0E0",background:"#fff",borderRadius:6,cursor:"pointer",fontSize:12},children:"Cancelar"})]})]}),o.map((c,d)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:"1px solid #E0E0E0"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,color:"#111"},children:c.nombre}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2},children:[c.cargos.map(l=>{var y,g;const x=(g=(y=Eo[t])==null?void 0:y.categorias)==null?void 0:g.find(S=>S.id===l.catId);return`${l.cantidad} ${(x==null?void 0:x.label)||l.catId}`}).join("  "),c.equiposCosto>0?`  +${j(c.equiposCosto)} eq.`:"",c.licenciasCosto>0?`  +${j(c.licenciasCosto)} lic.`:""]})]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:600,color:"#111111",minWidth:100,textAlign:"right"},children:[j(m(c)),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:10,fontWeight:400,color:"#888"},children:[C,"/ud  rend ",c.rendimiento,"h"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>{u({...c}),r(c.id)},style:{background:"none",border:"1px solid #E0E0E0",borderRadius:4,cursor:"pointer",padding:"4px 8px",fontSize:11,color:"#555"},children:"Editar"}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar este equipo?")&&n(o.filter(l=>l.id!==c.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:13})})]})]},c.id)),o.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"24px",color:"#888",fontSize:13},children:"Sin equipos. Crea el primero."})]})]})})}function Ih({pais:t,linea:i,apu:o,setApu:n}){const[s,r]=ec(),[a,u]=F.useState(!1),h=t==="CO"?"COP":"EUR",b=c=>c!=null?new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(c):"0",j=o.equiposUsados||[],C=c=>{j.find(l=>l.eqId===c)||!s.find(l=>l.id===c)||n(l=>({...l,equiposUsados:[...l.equiposUsados||[],{id:Math.random().toString(36).slice(2,8),eqId:c,rendimientoOverride:null}]}))},v=c=>n(d=>({...d,equiposUsados:(d.equiposUsados||[]).filter(l=>l.id!==c)})),m=(c,d,l)=>n(x=>({...x,equiposUsados:(x.equiposUsados||[]).map(y=>y.id===c?{...y,[d]:l}:y)})),f=(c,d)=>{const l=d??c.rendimiento;return c.cargos.reduce((x,y)=>{const g=lo(y.catId,t);return x+g*l*(y.cantidad||1)},0)+(c.equiposCosto||0)+(c.licenciasCosto||0)},p=j.reduce((c,d)=>{const l=s.find(y=>y.id===d.eqId);if(!l)return c;const x=d.rendimientoOverride??l.rendimiento;return c+f(l,x)*(i.cantidad||1)},0);return e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8,paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Equipos de trabajo (MO)"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("select",{defaultValue:"",onChange:c=>{c.target.value&&(C(c.target.value),c.target.value="")},style:{border:"1px solid #3B3B3B",borderRadius:5,padding:"3px 8px",fontSize:12,color:"#3B3B3B",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:"#F0F0F0"},children:[e.jsx("option",{value:"",children:"+ Aadir equipo de biblioteca"}),s.map(c=>e.jsxs("option",{value:c.id,children:[c.nombre,"  ",b(f(c,null)),h,"/ud"]},c.id))]}),e.jsx("button",{onClick:()=>u(!0),style:{border:"1px solid #E0E0E0",borderRadius:5,padding:"3px 8px",fontSize:11,cursor:"pointer",background:"#fff",color:"#555",fontFamily:"'DM Sans',sans-serif"},children:"Gestionar biblioteca"})]})]}),j.length===0&&e.jsx("div",{style:{color:"#BBB",fontSize:12,padding:"8px 0",textAlign:"center"},children:"Selecciona equipos de la biblioteca para calcular MO"}),j.map(c=>{var S;const d=s.find(A=>A.id===c.eqId);if(!d)return null;const l=c.rendimientoOverride??d.rendimiento,x=f(d,l),y=x*(i.cantidad||1),g=((S=Eo[t])==null?void 0:S.categorias)||[];return e.jsxs("div",{style:{border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,overflow:"hidden"},children:[e.jsxs("div",{style:{background:"#F5F4F1",padding:"7px 12px",display:"flex",alignItems:"center",gap:10,borderBottom:"1px solid #E0E0E0"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,color:"#111",flex:1},children:d.nombre}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#555"},children:[e.jsx("span",{children:"Rendimiento:"}),e.jsx("input",{type:"number",min:"0",step:"0.001",value:l,onChange:A=>m(c.id,"rendimientoOverride",parseFloat(A.target.value)||0),style:{width:65,border:"1px solid #E0E0E0",borderRadius:4,padding:"3px 5px",fontSize:12,textAlign:"center",fontFamily:"'DM Sans',sans-serif"}}),e.jsxs("span",{children:["h/",i.unidad||"ud"]}),e.jsxs("span",{style:{fontSize:10,color:"#BBB",marginLeft:2},children:["(bib: ",d.rendimiento,"h)"]})]}),e.jsx("button",{onClick:()=>v(c.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:13})})]}),e.jsxs("div",{style:{padding:"8px 12px",fontSize:12,color:"#555"},children:[d.cargos.map((A,E)=>{const w=g.find(z=>z.id===A.catId),I=lo(A.catId,t);return e.jsxs("span",{style:{marginRight:12},children:[A.cantidad," ",(w==null?void 0:w.label)||A.catId," (",b(I),h,"/h)"]},E)}),d.equiposCosto>0&&e.jsxs("span",{style:{marginRight:12},children:["+",b(d.equiposCosto)," eq."]}),d.licenciasCosto>0&&e.jsxs("span",{children:["+",b(d.licenciasCosto)," lic."]}),e.jsxs("span",{style:{float:"right",fontWeight:700,color:"#111111",fontFamily:"'DM Mono',monospace"},children:[b(x),"/ud  ",b(y)," total"]})]})]},c.id)}),j.length>0&&e.jsxs("div",{style:{textAlign:"right",fontSize:13,fontWeight:600,color:"#111111",fontFamily:"'DM Mono',monospace",marginBottom:8},children:["Total MO: ",b(p)," ",h]}),a&&e.jsx(Bh,{pais:t,onClose:()=>u(!1)})]})}function Rh({linea:t,oferta:i,onSave:o,onClose:n}){var x;const s=i.pais||"CO",r=s==="CO"?"COP":"EUR",a=t.tipo,u=Qr.find(y=>y.id===a),h=(u==null?void 0:u.modo)==="diseno",[b,j]=F.useState(t.apu||{estudios:[],mo:[],subcontratas:[],equiposUsados:[],materiales:[],equipos:[]}),C=Th({...t,apu:b},i);(x=Eo[s])!=null&&x.categorias;const v=(y,g,S,A)=>j(E=>({...E,[y]:E[y].map(w=>w.id===g?{...w,[S]:A}:w)})),m=(y,g)=>j(S=>({...S,[y]:S[y].filter(A=>A.id!==g)})),f=(y,g)=>j(S=>({...S,[y]:[...S[y]||[],{id:zt(),...g}]})),p=(y,g=0)=>y!=null&&!isNaN(y)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:g,maximumFractionDigits:g}).format(y):"0",c={padding:"5px 8px",fontSize:10,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",textAlign:"left"},d={padding:"5px 6px",borderBottom:"1px solid #E0E0E0",fontSize:13,verticalAlign:"middle"},l=(y={})=>({border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 6px",fontSize:12,fontFamily:"'DM Sans',sans-serif",...y});return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:999,display:"flex",alignItems:"flex-start",justifyContent:"center",overflowY:"auto",padding:"20px 16px"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,width:"100%",maxWidth:820,boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:["APU  ",u==null?void 0:u.icon," ",u==null?void 0:u.label]}),e.jsxs("div",{style:{fontSize:15,fontWeight:700,color:"#111",marginTop:2},children:[t.descripcion||"Partida sin nombre","  ",t.cantidad," ",t.unidad]})]}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx(Ot,{size:20})})]}),e.jsxs("div",{style:{padding:"14px 18px"},children:[h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:8,paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Estudios / Entregables"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:8},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:c,children:"Entregable"}),e.jsx("th",{style:{...c,textAlign:"center",width:80},children:"Horas"}),e.jsx("th",{style:{...c,textAlign:"center",width:60},children:"Incl."}),e.jsx("th",{style:c})]})}),e.jsx("tbody",{children:(b.estudios||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:d,children:e.jsxs("select",{value:y.estudioId,onChange:g=>{const S=Dl.find(A=>A.id===g.target.value);v("estudios",y.id,"estudioId",g.target.value),S&&v("estudios",y.id,"nombre",S.nombre),S&&y.tipo!=="subcontrata"&&v("estudios",y.id,"horas",S.horas),v("estudios",y.id,"tipo",(S==null?void 0:S.tipo)||"plano")},style:{...l(),width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),["plano","render","doc","tramite","subcontrata"].map(g=>e.jsx("optgroup",{label:g.toUpperCase(),children:Dl.filter(S=>S.tipo===g).map(S=>e.jsx("option",{value:S.id,children:S.nombre},S.id))},g))]})}),e.jsx("td",{style:d,children:y.tipo==="subcontrata"?e.jsx("input",{type:"number",value:y.importe||0,onChange:g=>v("estudios",y.id,"importe",parseFloat(g.target.value)||0),placeholder:"importe",style:{...l(),width:90,textAlign:"right"}}):e.jsx("input",{type:"number",value:y.horas||0,onChange:g=>v("estudios",y.id,"horas",parseFloat(g.target.value)||0),style:{...l(),width:60,textAlign:"center"}})}),e.jsx("td",{style:{...d,textAlign:"center"},children:y.tipo==="subcontrata"?e.jsx("span",{style:{fontSize:11,color:"#888"},children:"sub"}):e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:12},children:p((y.horas||0)*C.costoH,0)})}),e.jsx("td",{style:d,children:e.jsx("button",{onClick:()=>m("estudios",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:12})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>f("estudios",{estudioId:"",nombre:"",horas:0,tipo:"plano",importe:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:12},children:[e.jsx(Ne,{size:12})," Aadir entregable"]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:6,padding:"8px 12px",fontSize:11,color:"#555",marginBottom:8,display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:600},children:"Costo/hora:"}),i.apuModoHora==="MANUAL"?e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:["Manual: ",p(i.apuCostoHoraManual||0,0)," ",r,"/h"]}):e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:[p(C.costoH||0,0)," ",r,"/h",e.jsxs("span",{style:{color:"#888",fontFamily:"'DM Sans',sans-serif"},children:["(salario ",(i.apuSalarioAnual||0).toLocaleString("es-CO")," +",((i.apuPrestaciones||0)*100).toFixed(0),"% SS ",p((i.apuHDia||8)*(i.apuDiasSem||5)*(i.apuSemanas||52)*(i.apuPctProductivas||.6),0),"h prod.)"]})]}),e.jsx("span",{style:{color:"#BBB",marginLeft:"auto",fontSize:10},children:"Configurable en tab APU Diseo (oferta)"})]}),e.jsxs("div",{style:{textAlign:"right",fontSize:13,fontWeight:600,color:"#111",marginBottom:12},children:["Total horas: ",e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[p(C.horasTotal||0,1)," h"]}),"Subtotal MO diseo: ",e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:[p(C.cdDis||0,0)," ",r]})]})]}),!h&&e.jsxs(e.Fragment,{children:[e.jsx(Ih,{pais:s,linea:t,apu:b,setApu:j}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Materiales"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...c,width:90},children:"Cdigo"}),e.jsx("th",{style:{...c,width:"35%"},children:"Descripcin"}),e.jsx("th",{style:c,children:"Unidad"}),e.jsx("th",{style:{...c,textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{...c,textAlign:"right",width:110},children:"Precio unit."}),e.jsx("th",{style:{...c,textAlign:"right",width:100},children:"Subtotal"}),e.jsx("th",{style:c})]})}),e.jsx("tbody",{children:(b.materiales||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:d,children:e.jsxs("select",{value:y.codigoCat||"",onChange:g=>{const S=g.target.value,A=no.find(E=>E.codigo===S);A?(v("materiales",y.id,"codigoCat",S),v("materiales",y.id,"descripcion",A.nombre),v("materiales",y.id,"unidad",A.unidad||"ud"),!y.precio&&A.precioRef&&v("materiales",y.id,"precio",A.precioRef)):v("materiales",y.id,"codigoCat","")},style:{...l(),width:"100%",fontSize:10,fontFamily:"'DM Mono',monospace",padding:"3px 4px"},children:[e.jsx("option",{value:"",children:""}),no.filter(g=>["consumible","seguridad"].includes(g.familia)).map(g=>e.jsx("option",{value:g.codigo,children:g.codigo},g.codigo))]})}),e.jsx("td",{style:d,children:e.jsx("input",{value:y.descripcion||"",onChange:g=>v("materiales",y.id,"descripcion",g.target.value),style:{...l(),width:"100%"},placeholder:"Material..."})}),e.jsx("td",{style:d,children:e.jsx("select",{value:y.unidad||"ud",onChange:g=>v("materiales",y.id,"unidad",g.target.value),style:l(),children:["m","m","ml","kg","ton","ud","gl","l","m","rollo","pliego","jgo","caja","tubo","par"].map(g=>e.jsx("option",{children:g},g))})}),e.jsx("td",{style:d,children:e.jsx("input",{type:"number",min:"0",step:"0.001",value:y.cantidad||0,onChange:g=>v("materiales",y.id,"cantidad",parseFloat(g.target.value)||0),style:{...l(),width:70,textAlign:"center"}})}),e.jsx("td",{style:d,children:e.jsx("input",{type:"number",min:"0",value:y.precio||0,onChange:g=>v("materiales",y.id,"precio",parseFloat(g.target.value)||0),style:{...l(),width:100,textAlign:"right"}})}),e.jsx("td",{style:{...d,textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:600},children:p((y.cantidad||0)*(y.precio||0),0)}),e.jsx("td",{style:d,children:e.jsx("button",{onClick:()=>m("materiales",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>f("materiales",{codigoCat:"",descripcion:"",unidad:"ud",cantidad:0,precio:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[e.jsx(Ne,{size:12})," Aadir material"]}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Equipos / herramientas directos"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...c,width:90},children:"Cdigo"}),e.jsx("th",{style:{...c,width:"35%"},children:"Descripcin"}),e.jsx("th",{style:c,children:"Unidad"}),e.jsx("th",{style:{...c,textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{...c,textAlign:"right",width:110},children:"Precio unit."}),e.jsx("th",{style:{...c,textAlign:"right",width:100},children:"Subtotal"}),e.jsx("th",{style:c})]})}),e.jsx("tbody",{children:(b.equipos||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:d,children:e.jsxs("select",{value:y.codigoCat||"",onChange:g=>{const S=g.target.value,A=no.find(E=>E.codigo===S);A?(v("equipos",y.id,"codigoCat",S),v("equipos",y.id,"descripcion",A.nombre),v("equipos",y.id,"unidad",A.unidad||"ud"),!y.precio&&A.precioRef&&v("equipos",y.id,"precio",A.precioRef)):v("equipos",y.id,"codigoCat","")},style:{...l(),width:"100%",fontSize:10,fontFamily:"'DM Mono',monospace",padding:"3px 4px"},children:[e.jsx("option",{value:"",children:""}),no.filter(g=>["herr_menor","herr_mayor","equipo_obra","equipo_medic"].includes(g.familia)).map(g=>e.jsxs("option",{value:g.codigo,children:[g.codigo," ",g.nombre]},g.codigo))]})}),e.jsx("td",{style:d,children:e.jsx("input",{value:y.descripcion||y.nombre||"",onChange:g=>v("equipos",y.id,"descripcion",g.target.value),style:{...l(),width:"100%"},placeholder:"Equipo..."})}),e.jsx("td",{style:d,children:e.jsx("select",{value:y.unidad||"ud",onChange:g=>v("equipos",y.id,"unidad",g.target.value),style:l(),children:["ud","h","da","mes","gl","cuerpo","jgo"].map(g=>e.jsx("option",{children:g},g))})}),e.jsx("td",{style:d,children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:y.cantidad||0,onChange:g=>v("equipos",y.id,"cantidad",parseFloat(g.target.value)||0),style:{...l(),width:70,textAlign:"center"}})}),e.jsx("td",{style:d,children:e.jsx("input",{type:"number",min:"0",value:y.precio||0,onChange:g=>v("equipos",y.id,"precio",parseFloat(g.target.value)||0),style:{...l(),width:100,textAlign:"right"}})}),e.jsx("td",{style:{...d,textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:600},children:p((y.cantidad||0)*(y.precio||0),0)}),e.jsx("td",{style:d,children:e.jsx("button",{onClick:()=>m("equipos",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>f("equipos",{codigoCat:"",descripcion:"",unidad:"ud",cantidad:0,precio:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[e.jsx(Ne,{size:12})," Aadir equipo/herramienta"]})]}),e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,margin:"12px 0 8px",paddingBottom:4,borderBottom:"1px solid #E0E0E0"},children:"Subcontratas"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...c,width:"70%"},children:"Descripcin del trabajo subcontratado"}),e.jsx("th",{style:{...c,textAlign:"right"},children:"Importe"}),e.jsx("th",{style:c})]})}),e.jsx("tbody",{children:(b.subcontratas||[]).map(y=>e.jsxs("tr",{children:[e.jsx("td",{style:d,children:e.jsx("input",{value:y.descripcion||"",onChange:g=>v("subcontratas",y.id,"descripcion",g.target.value),style:{...l(),width:"100%"}})}),e.jsx("td",{style:d,children:e.jsx("input",{type:"number",min:"0",value:y.importe||0,onChange:g=>v("subcontratas",y.id,"importe",parseFloat(g.target.value)||0),style:{...l(),width:120,textAlign:"right"}})}),e.jsx("td",{style:d,children:e.jsx("button",{onClick:()=>m("subcontratas",y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:11})})})]},y.id))})]}),e.jsxs("button",{onClick:()=>f("subcontratas",{descripcion:"",importe:0}),style:{fontSize:12,color:"#3B3B3B",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:4,marginBottom:12},children:[e.jsx(Ne,{size:12})," Aadir subcontrata"]}),e.jsxs("div",{style:{background:"#E8F4EE",border:"1px solid #B8DEC9",borderRadius:8,padding:"12px 14px",marginTop:8},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#111111",marginBottom:8,textTransform:"uppercase",letterSpacing:.5},children:"Resumen costos directos"}),h?[["Diseo/planos",C.cdDis],["MO directa",C.cdMO],["Subcontratas",C.cdSub]].map(([y,g])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,padding:"2px 0",borderBottom:"1px solid #B8DEC9"},children:[e.jsx("span",{style:{color:"#111111"},children:y}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:[p(g||0,0)," ",r]})]},y)):[["Mano de obra (cuadrillas)",C.cdMO],["Materiales",C.cdMat],["Equipos directos",C.cdEq],["Subcontratas",C.cdSub]].map(([y,g])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,padding:"2px 0",borderBottom:"1px solid #B8DEC9"},children:[e.jsx("span",{style:{color:"#111111"},children:y}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:[p(g||0,0)," ",r]})]},y)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:15,padding:"8px 0 0",fontWeight:700,color:"#111111"},children:[e.jsx("span",{children:"CD Total"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[p(C.CD||0,0)," ",r]})]})]})]}),e.jsxs("div",{style:{padding:"12px 18px",borderTop:"1px solid #E0E0E0",display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx("button",{onClick:n,style:{padding:"7px 16px",border:"1px solid #E0E0E0",borderRadius:6,background:"#fff",cursor:"pointer",fontSize:13},children:"Cancelar"}),e.jsxs("button",{onClick:()=>o({apu:b,precioCD:C.CD}),style:{padding:"7px 16px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:13,fontWeight:600,display:"flex",alignItems:"center",gap:5},children:[e.jsx(yt,{size:14})," Guardar APU"]})]})]})})}const oi=(t,i,o)=>{o.pais;const n=o.margen||.25,s=o.ggPct||0,r=(o.pctRCE||0)+(o.pctTRC||0)+(o.pctAdm||0)+(o.pctICA||0),a=o.ivaComision??.19;let u=0;o.medioPago==="PSE"?u=(o.pctComPSE??.012)*(1+a):o.medioPago==="Tarjeta"?u=(o.pctComTarjeta??.036)*(1+a):o.medioPago==="Transferencia"?u=(o.pctComTransf??0)*(1+a):o.medioPago==="Manual"&&(u=o.pctComManual??0);const h=o.aplicar4x1000==="SI"?.004:0,b=u+h,j=o.modoCalcObra||"margen",C=o.tipoProyecto==="OBRA"&&j==="aiu"?1-r:1-n-r-s,v=1-b,m=C*v;let f=t;if(o.tipoProyecto==="OBRA"&&j==="aiu"){const l=(o.aiuA||.08)+(o.aiuI||.03)+(o.aiuU||.07);f=t*(1+l)}const p=m>0?f/m:0,c=i||1,d=j==="aiu"?(o.aiuA||.08)*t:s*p;return{puCoste:c>0?t/c:0,totalCoste:t,puVenta:c>0?p/c:0,totalVenta:p,cd:t,gc:r*p,gg:d,gf:b*p,margenCOP:n*p,pvp:p,coefMult:m>0?(j==="aiu"?f/t:1)/m:0,den:m}};function Mh({d:t,set:i,r:o}){const n=t.pais||"CO",s=n==="CO"?"COP":"EUR",r=(M,O=0)=>M!=null&&!isNaN(M)?new Intl.NumberFormat("es-ES",{minimumFractionDigits:O,maximumFractionDigits:O}).format(M):"0",[a,u]=F.useState(null),[h,b]=F.useState(null),[j,C]=F.useState(!1),[v,m]=F.useState("todos"),[f,p]=F.useState(!1),[c,d]=F.useState("detallado"),[l,x]=F.useState(null),y=t.borradorLineas||[],g=M=>i("borradorLineas",M),S=()=>g([...y,{id:zt(),esCapitulo:!0,nombre:"CAPTULO "+(y.filter(M=>M.esCapitulo).length+1),tipo:Mn[0].id}]),A=M=>g([...y,{id:zt(),esCapitulo:!1,tipo:M||Mn[0].id,codigo:"",descripcion:"",unidad:"m",cantidad:1,apu:null,precioCD:0}]),E=(M,O,ne)=>g(y.map(ie=>ie.id===M?{...ie,[O]:ne}:ie)),w=M=>g(y.filter(O=>O.id!==M)),I=(M,O)=>{const ne=[...y],ie=ne.findIndex(re=>re.id===M);ie+O<0||ie+O>=ne.length||([ne[ie],ne[ie+O]]=[ne[ie+O],ne[ie]],g(ne))},z=M=>x(M),B=M=>M.preventDefault(),P=M=>{if(!l||l===M){x(null);return}const O=[...y],ne=O.findIndex(H=>H.id===l),ie=O.findIndex(H=>H.id===M);if(ne<0||ie<0){x(null);return}const[re]=O.splice(ne,1);O.splice(ie,0,re),g(O),x(null)},q=(M,O)=>{g(y.map(ne=>ne.id===M?{...ne,...O}:ne)),u(null)},U=()=>{const M=y.filter(O=>!O.esCapitulo&&O.descripcion).map(O=>({id:O.id,otId:t.id,otNombre:t.proyecto||t.cliente,codigo:O.codigo,nombre:O.descripcion,unidad:O.unidad,cantidad:O.cantidad,presupuesto:O.precioCD||0,avance:0,estado:"pendiente"}));try{Fe.set("hab:proj:actividades:"+t.id,JSON.stringify(M)),alert(` ${M.length} actividades exportadas al mdulo Proyectos.`)}catch(O){alert("Error: "+O.message)}},$=y.filter(M=>!M.esCapitulo).reduce((M,O)=>M+(O.precioCD||0),0),Y=t.pctU||.07,ge=.08,J=.03,ye=n==="CO"?$*(ge+J+Y):0,oe=n==="ES"?$*(t.gg||.13):0,L=n==="ES"?$*(t.bi||.06):0,R=n==="CO"?t.tarifaIVA||.19:t.tarifaIVA||.1,T=y.find(M=>M.id===a),W=["m","m","ml","m","kg","ton","ud","gl","h","da","sem","mes","l","mxl","vje"],X=()=>{for(let M=y.length-1;M>=0;M--)if(y[M].esCapitulo)return y[M].tipo;return Mn[0].id};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("button",{onClick:S,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"1px solid #E0E0E0",borderRadius:6,background:"#F5F4F1",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:500},children:[e.jsx(Sn,{size:13})," Aadir captulo"]}),e.jsxs("button",{onClick:()=>A(X()),style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:600},children:[e.jsx(Ne,{size:13})," Nueva partida"]}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{display:"flex",border:"1px solid #E0E0E0",borderRadius:6,overflow:"hidden"},children:[["coste","Vista interna",!1],["venta","Vista cliente",!0]].map(([M,O,ne])=>e.jsx("button",{onClick:()=>p(ne),style:{padding:"6px 14px",border:"none",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:f===ne?"#111":"#fff",color:f===ne?"#fff":"#555",transition:"all .15s"},children:O},M))}),f&&e.jsx("div",{style:{display:"flex",border:"1px solid #E0E0E0",borderRadius:6,overflow:"hidden",marginLeft:8},children:[["detallado","Detallado"],["capitulos","Captulos"],["total","Total"]].map(([M,O])=>e.jsx("button",{onClick:()=>d(M),style:{padding:"6px 10px",border:"none",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:c===M?"#3B3B3B":"#fff",color:c===M?"#fff":"#888",transition:"all .15s"},children:O},M))}),e.jsxs("button",{onClick:()=>C(!0),style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",marginLeft:8,border:"none",borderRadius:6,background:"#3B3B3B",color:"#fff",cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif",fontWeight:700},children:[e.jsx(fn,{size:13})," APUs de Venta"]}),t.estado==="Ganada"&&e.jsxs("button",{onClick:U,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",border:"none",borderRadius:6,background:"#3B3B3B",color:"#fff",cursor:"pointer",fontSize:13,fontFamily:"'DM Sans',sans-serif",fontWeight:600},children:[e.jsx(Ic,{size:13})," Exportar al Gantt"]})]}),(()=>{const M=y.filter(H=>!H.esCapitulo&&H.precioCD).reduce((H,se)=>H+oi(se.precioCD||0,se.cantidad||1,t).totalVenta,0),O=M*R,ne=M+O,ie=M-$,re=M>0?(ie/M*100).toFixed(1):0;return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(145px,1fr))",gap:8,marginBottom:14},children:[["Costos directos",r($,0)+" "+s,"#555"],n==="CO"?["AIU "+((ge+J+Y)*100).toFixed(0)+"%",r(ye,0)+" "+s,"#8C6A00"]:["GG+BI "+((t.gg||.13)*100+(t.bi||.06)*100).toFixed(0)+"%",r(oe+L,0)+" "+s,"#3B3B3B"],["Venta s/IVA",r(M,0)+" "+s,"#3B3B3B"],["IVA "+(R*100).toFixed(0)+"%",r(O,0)+" "+s,"#555"],["TOTAL c/IVA",r(ne,0)+" "+s,"#111111"],["Margen",re+"%  "+r(ie,0),"#2B7A52"]].map(([H,se,N])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"8px 10px",borderLeft:"3px solid "+N},children:[e.jsx("div",{style:{fontSize:9,color:"#888",marginBottom:2},children:H}),e.jsx("div",{style:{fontSize:12,fontWeight:700,color:N,fontFamily:"'DM Mono',monospace"},children:se})]},H))})})(),e.jsx("div",{style:{border:"1px solid #E0E0E0",borderRadius:8,overflow:"hidden",marginBottom:14,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:f?700:1100},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:[{l:"Cd",w:52},{l:"Descripcin / Actividad",w:"20%"},{l:"Tipo",w:96},{l:"Unid",w:52},{l:"Cant.",w:68},...f?[]:[{l:"PU coste",w:86},{l:"CD Total ",w:100}],{l:"PU venta",w:96},{l:"Total venta",w:106},...f?[]:[{l:"% Inc.",w:52}],...f?[{l:"APU Vta",w:64}]:[{l:"APU",w:64}],{l:"",w:52}].filter(M=>M.w!==0).map(M=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"2px solid #E0E0E0",textAlign:"left",width:M.w,minWidth:typeof M.w=="number"?M.w:void 0},children:M.l},M.l))})}),e.jsxs("tbody",{children:[y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:f?8:12,style:{padding:"32px",textAlign:"center",color:"#999",fontSize:13},children:"Aade un captulo y partidas para construir el borrador."})}),f&&c==="total"&&y.length>0&&(()=>{const M=y.filter(O=>!O.esCapitulo&&O.precioCD).reduce((O,ne)=>O+oi(ne.precioCD||0,ne.cantidad||1,t).totalVenta,0);return e.jsxs("tr",{style:{background:"#fff"},children:[e.jsxs("td",{colSpan:5,style:{padding:"12px 12px",fontSize:13,fontWeight:600},children:[t.proyecto||"Proyecto","  Precio total"]}),e.jsx("td",{style:{padding:"12px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"12px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700,color:"#111111"},children:r(M,0)}),e.jsx("td",{})]})})(),f&&c==="capitulos"&&y.length>0&&(()=>{const M=[];let O=null,ne=[];y.forEach(H=>{H.esCapitulo?(O&&M.push({cap:O,items:ne}),O=H,ne=[]):ne.push(H)}),O&&M.push({cap:O,items:ne});const ie=[];let re=!1;return y.forEach(H=>{H.esCapitulo&&(re=!0),!re&&!H.esCapitulo&&ie.push(H)}),e.jsxs(e.Fragment,{children:[ie.length>0&&e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("td",{colSpan:5,style:{padding:"10px 12px",fontSize:12,fontWeight:600,fontStyle:"italic"},children:"Partidas sin captulo"}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:"#111111"},children:r(ie.reduce((H,se)=>H+(se.precioCD>0?oi(se.precioCD,se.cantidad||1,t).totalVenta:0),0),0)}),e.jsx("td",{})]}),M.map(({cap:H,items:se},N)=>{const G=se.reduce((ue,he)=>ue+(he.precioCD>0?oi(he.precioCD,he.cantidad||1,t).totalVenta:0),0);return e.jsxs("tr",{style:{background:N%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${k.border}`},children:[e.jsxs("td",{colSpan:5,style:{padding:"10px 12px"},children:[e.jsx("span",{style:{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5},children:H.nombre||"Captulo"}),e.jsxs("span",{style:{marginLeft:8,fontSize:10,color:k.inkLight},children:[se.length," partida",se.length!==1?"s":""]})]}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,color:"#3B3B3B"},children:""}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:700,color:"#111111"},children:r(G,0)}),e.jsx("td",{})]},H.id)})]})})(),(!f||c==="detallado")&&y.map((M,O)=>{var re,H,se,N;if(M.esCapitulo){const G=Mn.find(ue=>ue.id===(M.tipo||"CAP00"));return e.jsxs("tr",{draggable:!0,onDragStart:()=>z(M.id),onDragOver:B,onDrop:()=>P(M.id),style:{background:l===M.id?"#D5D2CC":"#EDEBE7",cursor:"grab",opacity:l===M.id?.5:1},children:[e.jsx("td",{colSpan:2,style:{padding:"8px 12px"},children:e.jsx("input",{value:M.nombre||"",onChange:ue=>E(M.id,"nombre",ue.target.value),style:{fontWeight:700,fontSize:13,color:"#111",background:"transparent",border:"none",outline:"none",width:"100%",textTransform:"uppercase",letterSpacing:.5}})}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("select",{value:M.tipo||"CAP00",onChange:ue=>E(M.id,"tipo",ue.target.value),style:{border:"1px solid #CCC",borderRadius:5,padding:"3px 7px",fontSize:11,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:(G==null?void 0:G.color)||"#8C6A00",width:"100%"},children:Mn.map(ue=>e.jsx("option",{value:ue.id,children:ue.label},ue.id))})}),e.jsx("td",{colSpan:f?4:7,style:{padding:"6px 8px",color:"#AAA",fontSize:10,fontStyle:"italic"},children:"Captulo agrupador"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right"},children:e.jsx("button",{onClick:()=>w(M.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:12})})})]},M.id)}const ne=Qr.find(G=>G.id===M.tipo),ie=M.apu&&(((re=M.apu.estudios)==null?void 0:re.length)||0)+(((H=M.apu.equiposUsados)==null?void 0:H.length)||0)+(((se=M.apu.materiales)==null?void 0:se.length)||0)+(((N=M.apu.subcontratas)==null?void 0:N.length)||0)>0;return e.jsxs("tr",{draggable:!0,onDragStart:()=>z(M.id),onDragOver:B,onDrop:()=>P(M.id),style:{background:l===M.id?"#D5E8F9":O%2===0?"#fff":"#F9F8F5",transition:"background .1s",cursor:"grab",opacity:l===M.id?.5:1},onMouseEnter:G=>{l||(G.currentTarget.style.background="#F0F0F0")},onMouseLeave:G=>{l||(G.currentTarget.style.background=O%2===0?"#fff":"#F9F8F5")},children:[e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{value:M.codigo||"",onChange:G=>E(M.id,"codigo",G.target.value),style:{width:52,border:"1px solid #E0E0E0",borderRadius:4,padding:"3px 5px",fontSize:11,fontFamily:"'DM Mono',monospace",textAlign:"center"}})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{value:M.descripcion||"",onChange:G=>E(M.id,"descripcion",G.target.value),placeholder:"Descripcin de la actividad...",style:{width:"100%",border:"1px solid #E0E0E0",borderRadius:4,padding:"5px 8px",fontSize:13}})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("select",{value:M.tipo||Qr[0].id,onChange:G=>E(M.id,"tipo",G.target.value),style:{border:"1px solid #E0E0E0",borderRadius:5,padding:"3px 6px",fontSize:11,background:"transparent",cursor:"pointer",color:(ne==null?void 0:ne.color)||"#555",fontFamily:"'DM Sans',sans-serif",maxWidth:110},children:Qr.map(G=>e.jsxs("option",{value:G.id,children:[G.icon," ",G.label]},G.id))})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("select",{value:M.unidad||"m",onChange:G=>E(M.id,"unidad",G.target.value),style:{border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 4px",fontSize:12,width:56},children:W.map(G=>e.jsx("option",{children:G},G))})}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:M.cantidad||0,onChange:G=>E(M.id,"cantidad",parseFloat(G.target.value)||0),style:{width:72,border:"1px solid #E0E0E0",borderRadius:4,padding:"4px 6px",fontSize:13,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),(()=>{const G=ie||M.precioCD>0?oi(M.precioCD||0,M.cantidad||1,t):null,ue=y.filter(Ve=>!Ve.esCapitulo&&Ve.precioCD).reduce((Ve,Ee)=>Ve+oi(Ee.precioCD||0,Ee.cantidad||1,t).totalVenta,0),he=G&&ue>0?G.totalVenta/ue*100:0,we={padding:"5px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12,verticalAlign:"middle"};return e.jsxs(e.Fragment,{children:[!f&&e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{...we,color:ie||M.precioCD>0?"#555":"#DDD"},children:(ie||M.precioCD>0)&&G?r(G.puCoste,0):""}),e.jsx("td",{style:{...we,fontWeight:ie||M.precioCD>0?600:400,color:ie||M.precioCD>0?"#111":"#DDD"},children:e.jsx("input",{type:"number",min:"0",step:"100",value:M.precioCD||"",placeholder:"0",onChange:Ve=>E(M.id,"precioCD",parseFloat(Ve.target.value)||0),style:{width:90,border:`1px solid ${M.precioCD>0?"#111111":"#E0E0E0"}`,borderRadius:4,padding:"3px 6px",fontSize:12,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,background:M.precioCD>0?"#E6F4EC":"#fff",color:M.precioCD>0?"#111":"#999"}})})]}),e.jsx("td",{style:{...we,color:ie||M.precioCD>0?"#3B3B3B":"#DDD",fontWeight:600},children:(ie||M.precioCD>0)&&G?r(G.puVenta,0):""}),e.jsx("td",{style:{...we,color:ie||M.precioCD>0?"#111111":"#DDD",fontWeight:700},children:(ie||M.precioCD>0)&&G?r(G.totalVenta,0):""}),!f&&e.jsx("td",{style:{...we,fontSize:10,color:he>5?"#111111":"#999"},children:ie||M.precioCD>0?he.toFixed(1)+"%":""})]})})(),!f&&e.jsx("td",{style:{padding:"5px 8px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:3,justifyContent:"center"},children:[e.jsxs("button",{onClick:()=>u(M.id),style:{background:ie?"#111111":"transparent",color:ie?"#fff":"#3B3B3B",border:`1px solid ${ie?"#111111":"#3B3B3B"}`,borderRadius:5,padding:"3px 8px",fontSize:11,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:3},children:[e.jsx(Rc,{size:10}),ie?"APU ":"+ APU"]}),(Number(M.precioCD)>0||ie)&&e.jsxs("button",{onClick:()=>b(M.id),style:{background:"#3B3B3B",color:"#fff",border:"none",borderRadius:5,padding:"3px 7px",fontSize:10,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:2},children:[e.jsx(fn,{size:10})," Venta"]})]})}),e.jsx("td",{style:{padding:"5px 4px"},children:e.jsxs("div",{style:{display:"flex",gap:1},children:[f&&(Number(M.precioCD)>0||ie)&&e.jsxs("button",{onClick:()=>b(M.id),style:{background:"#3B3B3B",color:"#fff",border:"none",borderRadius:4,padding:"3px 7px",fontSize:10,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:2},children:[e.jsx(fn,{size:10}),"APU Venta"]}),!f&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>I(M.id,-1),style:{background:"none",border:"none",cursor:"pointer",color:"#BBB",padding:2},children:e.jsx(Wa,{size:11})}),e.jsx("button",{onClick:()=>I(M.id,1),style:{background:"none",border:"none",cursor:"pointer",color:"#BBB",padding:2},children:e.jsx(kn,{size:11})}),e.jsx("button",{onClick:()=>w(M.id),style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C",padding:2},children:e.jsx(Je,{size:11})})]})]})})]},M.id)})]}),e.jsx("tfoot",{children:(()=>{const M=y.filter(se=>!se.esCapitulo&&se.precioCD).reduce((se,N)=>se+oi(N.precioCD||0,N.cantidad||1,t).totalVenta,0),O=t.tipoProyecto==="OBRA",ne=o.U||t.margen,ie=O?ne*M*(t.tarifaIVA||.19):M*(t.tarifaIVA||.19),re=M+ie,H=f?8:12;return f?e.jsxs(e.Fragment,{children:[e.jsxs("tr",{style:{background:"#F5F4F1",borderTop:"2px solid #333"},children:[e.jsx("td",{colSpan:H-1,style:{padding:"10px 12px",fontSize:12,fontWeight:700},children:"Subtotal"}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700},children:[r(M,0)," ",s]})]}),e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("td",{colSpan:H-1,style:{padding:"6px 12px",fontSize:11,color:k.inkMid},children:O?`IVA ${((t.tarifaIVA||.19)*100).toFixed(0)}% sobre utilidad`:`IVA ${((t.tarifaIVA||.19)*100).toFixed(0)}%`}),e.jsxs("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:12},children:[r(ie,0)," ",s]})]}),e.jsxs("tr",{style:{background:"#111"},children:[e.jsx("td",{colSpan:H-1,style:{padding:"12px 12px",color:"#fff",fontSize:14,fontWeight:700},children:"TOTAL"}),e.jsxs("td",{style:{padding:"12px 8px",textAlign:"right",color:"#fff",fontFamily:"'DM Mono',monospace",fontSize:16,fontWeight:700},children:[r(re,0)," ",s]})]})]}):e.jsxs("tr",{style:{background:"#111"},children:[e.jsx("td",{colSpan:4,style:{padding:"10px 12px",color:"#fff",fontSize:13,fontWeight:600},children:"TOTALES"}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",color:"#ccc",fontFamily:"'DM Mono',monospace",fontSize:11},children:[y.filter(se=>!se.esCapitulo).length," partidas"]}),e.jsx("td",{style:{padding:"10px 8px"}}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",color:"#aaa",fontFamily:"'DM Mono',monospace",fontSize:12},children:r($,0)}),e.jsx("td",{style:{padding:"10px 8px"}}),e.jsxs("td",{style:{padding:"10px 8px",textAlign:"right",color:"#fff",fontFamily:"'DM Mono',monospace",fontSize:14,fontWeight:700},children:[r(M,0)," ",s]}),e.jsx("td",{style:{padding:"10px 8px",textAlign:"right",color:"#aaa",fontSize:10},children:"100%"}),e.jsx("td",{colSpan:2})]})})()})]})}),a&&T&&e.jsx(Rh,{linea:T,oferta:t,onSave:M=>q(T.id,M),onClose:()=>u(null)}),j&&(()=>{var Ve;const M=t.tipoProyecto==="OBRA",O=o.U||t.margen;y.filter(Ee=>Ee.esCapitulo);const ne=y.filter(Ee=>!Ee.esCapitulo&&Number(Ee.precioCD)>0),ie={};let re=null;y.forEach(Ee=>{if(Ee.esCapitulo){re=Ee;return}if(!Ee.esCapitulo&&Number(Ee.precioCD)>0){const je=re?re.id:"__sin_cap__",V=re?re.descripcion:"Sin captulo";ie[je]||(ie[je]={nombre:V,items:[]});const te=oi(Number(Ee.precioCD),Ee.cantidad||1,t),ce=M?O*te.pvp*(t.tarifaIVA||.19):te.pvp*(t.tarifaIVA||.19);ie[je].items.push({...Ee,v:te,ivaL:ce})}});const H=Object.keys(ie),se=v==="todos"?H:H.filter(Ee=>Ee===v),N=ne.reduce((Ee,je)=>Ee+oi(je.precioCD||0,je.cantidad||1,t).pvp,0),G=ne.reduce((Ee,je)=>Ee+Number(je.precioCD||0),0),ue=()=>{const Ee=["Captulo","Cdigo","Descripcin","Und","Cant","PU Coste","CD Total","GC","GF","Margen","PVP s/IVA","PU Venta","IVA","PVP c/IVA","Coef.Mult"],je=[];se.forEach(pe=>{const _=ie[pe];_.items.forEach(ae=>{je.push([_.nombre,ae.codigo||"",ae.descripcion||"",ae.und||"",ae.cantidad||1,(ae.v.puCoste||0).toFixed(0),(ae.v.cd||0).toFixed(0),(ae.v.gc||0).toFixed(0),(ae.v.gf||0).toFixed(0),(ae.v.margenCOP||0).toFixed(0),(ae.v.pvp||0).toFixed(0),(ae.v.puVenta||0).toFixed(0),(ae.ivaL||0).toFixed(0),(ae.v.pvp+ae.ivaL).toFixed(0),(ae.v.coefMult||0).toFixed(4)])})});const V=[Ee.join(";"),...je.map(pe=>pe.join(";"))].join(`
`),te=new Blob(["\uFEFF"+V],{type:"text/csv;charset=utf-8"}),ce=document.createElement("a");ce.href=URL.createObjectURL(te),ce.download=`APUs_Venta_${t.codigoOferta||"oferta"}.csv`,ce.click()},he=()=>{const Ee=window.open("","_blank");let je=`<html><head><title>APUs de Venta - ${t.codigoOferta||""}</title>
          <style>@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@400;600;700&family=DM+Mono:wght@400;500&display=swap');
          *{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;padding:28px;color:#111;font-size:11px}
          h1{font-size:18px;margin-bottom:4px}h2{font-size:13px;margin:20px 0 8px;padding:6px 0;border-bottom:2px solid #111}
          .meta{color:#888;font-size:10px;margin-bottom:16px}
          table{width:100%;border-collapse:collapse;margin-bottom:16px}
          th{background:#F5F4F1;padding:5px 6px;font-size:8px;text-transform:uppercase;letter-spacing:0.5px;text-align:right;border-bottom:2px solid #E0E0E0}
          th:nth-child(1),th:nth-child(2){text-align:left}
          td{padding:5px 6px;border-bottom:1px solid #E0E0E0;font-size:10px;text-align:right}
          td:nth-child(1),td:nth-child(2){text-align:left}
          .mono{font-family:'DM Mono',monospace}.bold{font-weight:700}.green{color:#111111}.blue{color:#3B3B3B}
          .totrow td{font-weight:700;border-top:2px solid #111;padding-top:8px}
          .param{background:#F5F4F1;padding:10px 14px;border-radius:4px;font-size:9px;color:#555;margin-bottom:16px}
          @media print{body{padding:12px}}
          </style></head><body>`;je+=`<h1>APUs de Venta  ${t.proyecto||t.codigoOferta||"Oferta"}</h1>`,je+=`<div class="meta">${t.codigoOferta||""}  ${t.cliente||""}  ${s}  ${new Date().toLocaleDateString("es-CO")}</div>`,je+=`<div class="param">Margen: ${(t.margen*100).toFixed(1)}%  GC: ${((o.g||0)*100).toFixed(2)}%  GF: ${((o.f||0)*100).toFixed(2)}%  IVA: ${((t.tarifaIVA||.19)*100).toFixed(0)}%${M?" (sobre utilidad)":""}</div>`,se.forEach(V=>{const te=ie[V];je+=`<h2>${te.nombre}</h2><table><tr><th>Descripcin</th><th>Und</th><th>Cant</th><th>PU Coste</th><th>CD</th><th>GC</th><th>GF</th><th>Margen</th><th>PVP s/IVA</th><th>PU Venta</th><th>IVA</th><th>PVP c/IVA</th></tr>`;let ce=0;te.items.forEach(pe=>{const _=pe.v.pvp+pe.ivaL;ce+=_,je+=`<tr><td>${pe.descripcion||""}</td><td>${pe.und||""}</td><td class="mono">${pe.cantidad||1}</td>`,je+=`<td class="mono">${r(pe.v.puCoste,0)}</td><td class="mono">${r(pe.v.cd,0)}</td>`,je+=`<td class="mono">${r(pe.v.gc,0)}</td><td class="mono">${r(pe.v.gf,0)}</td>`,je+=`<td class="mono">${r(pe.v.margenCOP,0)}</td>`,je+=`<td class="mono bold blue">${r(pe.v.pvp,0)}</td>`,je+=`<td class="mono">${r(pe.v.puVenta,0)}</td>`,je+=`<td class="mono">${r(pe.ivaL,0)}</td>`,je+=`<td class="mono bold green">${r(_,0)}</td></tr>`}),je+=`<tr class="totrow"><td colspan="8">Subtotal ${te.nombre}</td><td colspan="4" class="mono green">${r(ce,0)} ${s}</td></tr></table>`}),je+=`<table style="margin-top:16px"><tr class="totrow"><td colspan="8" style="font-size:14px">TOTAL VENTA</td><td colspan="4" class="mono green" style="font-size:14px">${r(N+ne.reduce((V,te)=>{const ce=oi(te.precioCD||0,te.cantidad||1,t);return V+(M?O*ce.pvp*(t.tarifaIVA||.19):ce.pvp*(t.tarifaIVA||.19))},0),0)} ${s}</td></tr></table>`,je+="</body></html>",Ee.document.write(je),Ee.document.close(),setTimeout(()=>Ee.print(),300)},we={fontFamily:"'DM Mono',monospace",fontSize:11,textAlign:"right"};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:16},onClick:()=>C(!1),children:e.jsxs("div",{onClick:Ee=>Ee.stopPropagation(),style:{background:"#fff",borderRadius:10,width:"95%",maxWidth:1100,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.25)"},children:[e.jsxs("div",{style:{padding:"16px 22px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:17,fontWeight:700,margin:0},children:" APUs de Venta"}),e.jsxs("p",{style:{fontSize:10,color:"#888",margin:"3px 0 0"},children:[t.codigoOferta||"","  ",t.cliente||"","  ",ne.length," partidas con precio"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsxs("select",{value:v,onChange:Ee=>m(Ee.target.value),style:{padding:"6px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:11,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"todos",children:"Todos los captulos"}),H.map(Ee=>e.jsx("option",{value:Ee,children:ie[Ee].nombre},Ee))]}),e.jsxs("button",{onClick:ue,style:{padding:"6px 14px",background:"#fff",border:"1px solid #E0E0E0",borderRadius:4,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(vn,{size:12})," CSV"]}),e.jsxs("button",{onClick:he,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:4,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Bt,{size:12})," PDF / Imprimir"]}),e.jsx("button",{onClick:()=>C(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888",padding:4},children:e.jsx(Ot,{size:18})})]})]}),e.jsxs("div",{style:{padding:"8px 22px",background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",display:"flex",gap:20,flexShrink:0,fontSize:10,color:"#555"},children:[e.jsxs("span",{children:["Margen: ",e.jsxs("strong",{children:[(t.margen*100).toFixed(1),"%"]})]}),e.jsxs("span",{children:["GC: ",e.jsxs("strong",{children:[((o.g||0)*100).toFixed(2),"%"]})]}),e.jsxs("span",{children:["GF: ",e.jsxs("strong",{children:[((o.f||0)*100).toFixed(2),"%"]})]}),e.jsxs("span",{children:["IVA: ",e.jsxs("strong",{children:[((t.tarifaIVA||.19)*100).toFixed(0),"%"]}),M?" (sobre U)":""]}),e.jsxs("span",{children:["Coef. mult: ",e.jsxs("strong",{children:[" ",ne.length>0?(Ve=oi(1,1,t).coefMult)==null?void 0:Ve.toFixed(4):""]})]}),e.jsxs("span",{style:{marginLeft:"auto",fontWeight:700,color:"#111111"},children:["Total coste: ",r(G,0),"  Total venta: ",r(N,0)," ",s]})]}),e.jsxs("div",{style:{overflowY:"auto",flex:1,padding:"0 22px 22px"},children:[ne.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 0",color:"#888"},children:[e.jsx("p",{style:{fontSize:14},children:"No hay partidas con precio para mostrar APUs de venta."}),e.jsx("p",{style:{fontSize:11,marginTop:6},children:"Aade partidas con costo directo en el borrador."})]}):se.map(Ee=>{const je=ie[Ee],V=je.items.reduce((ce,pe)=>ce+pe.v.pvp,0),te=je.items.reduce((ce,pe)=>ce+pe.ivaL,0);return e.jsxs("div",{children:[e.jsxs("h3",{style:{fontSize:12,fontWeight:700,margin:"18px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:je.nombre}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:[r(V+te,0)," ",s]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Descripcin","Und","Cant","PU Coste","CD Total","GC","GF","Margen","PVP s/IVA","PU Venta","IVA","PVP c/IVA"].map(ce=>e.jsx("th",{style:{padding:"5px 6px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,textAlign:ce==="Descripcin"||ce==="Und"?"left":"right",borderBottom:"1px solid #E0E0E0"},children:ce},ce))})}),e.jsxs("tbody",{children:[je.items.map(ce=>{const pe=ce.v.pvp+ce.ivaL;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},onMouseEnter:_=>_.currentTarget.style.background="#FFFFFF",onMouseLeave:_=>_.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"6px",fontSize:11,maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:ce.descripcion||""}),e.jsx("td",{style:{padding:"6px",fontSize:10,color:"#888"},children:ce.und||""}),e.jsx("td",{style:{...we,padding:"6px"},children:ce.cantidad||1}),e.jsx("td",{style:{...we,padding:"6px",color:"#888"},children:r(ce.v.puCoste,0)}),e.jsx("td",{style:{...we,padding:"6px"},children:r(ce.v.cd,0)}),e.jsx("td",{style:{...we,padding:"6px",color:"#888"},children:r(ce.v.gc,0)}),e.jsx("td",{style:{...we,padding:"6px",color:"#888"},children:r(ce.v.gf,0)}),e.jsx("td",{style:{...we,padding:"6px",color:"#D4A017"},children:r(ce.v.margenCOP,0)}),e.jsx("td",{style:{...we,padding:"6px",fontWeight:700,color:"#3B3B3B"},children:r(ce.v.pvp,0)}),e.jsx("td",{style:{...we,padding:"6px"},children:r(ce.v.puVenta,0)}),e.jsx("td",{style:{...we,padding:"6px",color:"#888"},children:r(ce.ivaL,0)}),e.jsx("td",{style:{...we,padding:"6px",fontWeight:700,color:"#111111"},children:r(pe,0)})]},ce.id)}),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsxs("td",{colSpan:8,style:{padding:"8px 6px",fontWeight:700,fontSize:11},children:["Subtotal ",je.nombre]}),e.jsx("td",{style:{...we,padding:"8px 6px",fontWeight:700,color:"#3B3B3B"},children:r(V,0)}),e.jsx("td",{style:{...we,padding:"8px 6px"},children:""}),e.jsx("td",{style:{...we,padding:"8px 6px",color:"#888"},children:r(te,0)}),e.jsx("td",{style:{...we,padding:"8px 6px",fontWeight:700,color:"#111111"},children:r(V+te,0)})]})]})]})]},Ee)}),ne.length>0&&e.jsxs("div",{style:{marginTop:20,padding:"14px 0",borderTop:"3px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:16,fontWeight:700},children:"TOTAL VENTA"}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:18,fontWeight:700,color:"#111111"},children:[r(N+ne.reduce((Ee,je)=>{const V=oi(je.precioCD||0,je.cantidad||1,t);return Ee+(M?O*V.pvp*(t.tarifaIVA||.19):V.pvp*(t.tarifaIVA||.19))},0),0)," ",s]}),e.jsxs("div",{style:{fontSize:10,color:"#888",marginTop:2},children:["sin IVA: ",r(N,0)," + IVA: ",r(ne.reduce((Ee,je)=>{const V=oi(je.precioCD||0,je.cantidad||1,t);return Ee+(M?O*V.pvp*(t.tarifaIVA||.19):V.pvp*(t.tarifaIVA||.19))},0),0)]})]})]})]})]})})})(),h&&(()=>{var N,G;const M=y.find(ue=>ue.id===h);if(!M||Number(M.precioCD)<=0)return null;const O=oi(Number(M.precioCD),M.cantidad||1,t),ne=t.tipoProyecto==="OBRA",ie=o.U||t.margen,re=ne?ie*O.pvp*(t.tarifaIVA||.19):O.pvp*(t.tarifaIVA||.19),H={display:"flex",justifyContent:"space-between",padding:"7px 0",borderBottom:`1px solid ${k.border}`,fontSize:13},se={fontFamily:"'DM Mono',monospace",fontWeight:600};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(null),children:e.jsxs("div",{onClick:ue=>ue.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,maxWidth:520,width:"90%",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:"APU de Venta"}),e.jsxs("p",{style:{margin:"4px 0 0",fontSize:11,color:k.inkLight},children:[M.descripcion||"Partida","  Cant: ",M.cantidad||1," ",M.und||"und"]})]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:k.inkLight},children:e.jsx(Ot,{size:18})})]}),e.jsxs("div",{style:H,children:[e.jsx("span",{children:"Costo directo (CD)"}),e.jsx("span",{style:se,children:Ft(O.cd)})]}),e.jsxs("div",{style:H,children:[e.jsx("span",{style:{color:k.inkMid,paddingLeft:12},children:" PU coste"}),e.jsx("span",{style:{...se,color:k.inkMid},children:Ft(O.puCoste)})]}),e.jsxs("div",{style:H,children:[e.jsxs("span",{children:["Gastos contratacin (GC) ",pt(o.g||0)]}),e.jsx("span",{style:se,children:Ft(O.gc)})]}),e.jsxs("div",{style:H,children:[e.jsxs("span",{children:["Gastos financieros (GF) ",pt(o.f||0)]}),e.jsx("span",{style:se,children:Ft(O.gf)})]}),e.jsxs("div",{style:H,children:[e.jsxs("span",{children:["Margen ",pt(t.margen)]}),e.jsx("span",{style:se,children:Ft(O.margenCOP)})]}),e.jsxs("div",{style:{...H,fontWeight:700,fontSize:15,borderBottom:"2px solid #111"},children:[e.jsx("span",{children:"PVP sin IVA"}),e.jsx("span",{style:se,children:Ft(O.pvp)})]}),e.jsxs("div",{style:H,children:[e.jsx("span",{style:{color:k.inkMid,paddingLeft:12},children:" PU venta"}),e.jsx("span",{style:{...se,color:k.inkMid},children:Ft(O.puVenta)})]}),e.jsxs("div",{style:H,children:[e.jsxs("span",{children:["IVA ",ne?`(U ${pt(ie)}  ${pt(t.tarifaIVA)})`:pt(t.tarifaIVA)]}),e.jsx("span",{style:se,children:Ft(re)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px 0",fontSize:16,fontWeight:700},children:[e.jsx("span",{children:"PVP con IVA"}),e.jsx("span",{style:{...se,color:k.success},children:Ft(O.pvp+re)})]}),e.jsxs("div",{style:{background:k.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:k.inkMid,marginTop:8},children:["Coef. multiplicador: ",e.jsxs("strong",{children:[" ",(N=O.coefMult)==null?void 0:N.toFixed(4)]}),"  Denominador: ",e.jsx("strong",{children:(G=O.den)==null?void 0:G.toFixed(4)})]})]})})})()]})}function _h({d:t,set:i}){const[o,n]=F.useState(""),[s,r]=F.useState(""),a=Bi.find(c=>c.id===t.servicioId)||Bi[2],u=t.entregablesOferta||[];F.useEffect(()=>{if(t.servicioId&&(!t.entregablesOferta||t.entregablesOferta.length===0)){const c=Bi.find(d=>d.id===t.servicioId);c&&c.entregables.length>0&&i("entregablesOferta",c.entregables.map((d,l)=>({id:"ent_"+l,nombre:d.nombre,horasBase:d.horas,horas:d.horas,incluir:!0,custom:!1})))}},[t.servicioId]);const h=c=>{i("servicioId",c);const d=Bi.find(l=>l.id===c);d&&(i("actividadCod",d.cod),d.entregables.length>0?i("entregablesOferta",d.entregables.map((l,x)=>({id:"ent_"+x,nombre:l.nombre,horasBase:l.horas,horas:l.horas,incluir:!0,custom:!1}))):i("entregablesOferta",[]))},b=c=>{i("entregablesOferta",u.map(d=>d.id===c?{...d,incluir:!d.incluir}:d))},j=(c,d)=>{i("entregablesOferta",u.map(l=>l.id===c?{...l,horas:Number(d)||0}:l))},C=()=>{if(!o.trim())return;const c={id:"custom_"+Date.now(),nombre:o.trim(),horasBase:Number(s)||0,horas:Number(s)||0,incluir:!0,custom:!0};i("entregablesOferta",[...u,c]),n(""),r("")},v=c=>{i("entregablesOferta",u.filter(d=>d.id!==c))},m=u.filter(c=>c.incluir).reduce((c,d)=>c+(d.horas||0),0),f=u.filter(c=>c.incluir).length,p={card:{background:"#fff",border:`1px solid ${k.border}`,borderRadius:6,padding:"20px 24px",marginBottom:16},sTitle:{fontSize:9,fontWeight:700,letterSpacing:2.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 14px"}};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:p.card,children:[e.jsx("p",{style:p.sTitle,children:"Servicio"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16},children:Bi.map(c=>e.jsx("button",{onClick:()=>h(c.id),style:{padding:"8px 16px",border:`1px solid ${t.servicioId===c.id?k.ink:k.border}`,background:t.servicioId===c.id?k.ink:"#fff",color:t.servicioId===c.id?"#fff":k.ink,borderRadius:4,fontSize:11,fontWeight:t.servicioId===c.id?700:500,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",letterSpacing:.3,transition:"all .15s"},children:c.nombre},c.id))}),a.descripcion&&e.jsx("p",{style:{fontSize:12,color:k.inkMid,lineHeight:1.6,margin:0,maxWidth:700},children:a.descripcion})]}),a.alcances.length>0&&e.jsxs("div",{style:p.card,children:[e.jsx("p",{style:p.sTitle,children:"Alcances del servicio"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px 20px"},children:a.alcances.map((c,d)=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8,padding:"6px 0"},children:[e.jsx("span",{style:{color:k.ink,fontSize:11,marginTop:1,flexShrink:0},children:""}),e.jsx("span",{style:{fontSize:12,color:k.ink,lineHeight:1.4},children:c})]},d))})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16},children:[e.jsxs("div",{style:{flex:1,background:"#fff",border:`1px solid ${k.border}`,borderRadius:6,padding:"14px 18px"},children:[e.jsx("p",{style:{fontSize:8,fontWeight:600,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 4px"},children:"Entregables incluidos"}),e.jsx("p",{style:{fontSize:22,fontWeight:700,color:k.ink,margin:0},children:f})]}),e.jsxs("div",{style:{flex:1,background:"#fff",border:`1px solid ${k.border}`,borderRadius:6,padding:"14px 18px"},children:[e.jsx("p",{style:{fontSize:8,fontWeight:600,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 4px"},children:"Horas totales"}),e.jsxs("p",{style:{fontSize:22,fontWeight:700,color:k.ink,margin:0},children:[m,"h"]})]}),e.jsxs("div",{style:{flex:1,background:"#fff",border:`1px solid ${k.border}`,borderRadius:6,padding:"14px 18px"},children:[e.jsx("p",{style:{fontSize:8,fontWeight:600,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 4px"},children:"Das estimados (8h/da)"}),e.jsx("p",{style:{fontSize:22,fontWeight:700,color:k.ink,margin:0},children:Math.ceil(m/8)})]})]}),u.length>0&&e.jsxs("div",{style:p.card,children:[e.jsx("p",{style:p.sTitle,children:"Entregables"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`},children:[e.jsx("th",{style:{textAlign:"left",padding:"8px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,width:30}}),e.jsx("th",{style:{textAlign:"left",padding:"8px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight},children:"Entregable"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,width:80},children:"Hrs base"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,width:90},children:"Hrs ajustadas"}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:u.map(c=>e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`,opacity:c.incluir?1:.4,transition:"opacity .15s"},children:[e.jsx("td",{style:{padding:"8px 0"},children:e.jsx("input",{type:"checkbox",checked:c.incluir,onChange:()=>b(c.id),style:{width:14,height:14,cursor:"pointer",accentColor:k.ink}})}),e.jsxs("td",{style:{padding:"8px 0",fontSize:12,color:k.ink,fontWeight:c.incluir?500:400},children:[c.nombre,c.custom&&e.jsx("span",{style:{marginLeft:6,fontSize:8,padding:"1px 5px",background:k.infoBg,color:k.info,borderRadius:2,fontWeight:600},children:"CUSTOM"})]}),e.jsxs("td",{style:{textAlign:"center",padding:"8px 0",fontSize:11,color:k.inkLight},children:[c.horasBase,"h"]}),e.jsx("td",{style:{textAlign:"center",padding:"8px 4px"},children:e.jsx("input",{type:"number",value:c.horas,onChange:d=>j(c.id,d.target.value),style:{width:60,textAlign:"center",border:`1px solid ${k.border}`,borderRadius:3,padding:"4px 6px",fontSize:12,fontWeight:600,color:k.ink,fontFamily:"'DM Sans',sans-serif",background:c.horas!==c.horasBase?"#FFF8E1":"#fff"}})}),e.jsx("td",{style:{padding:"8px 0"},children:c.custom&&e.jsx("button",{onClick:()=>v(c.id),style:{background:"none",border:"none",cursor:"pointer",color:k.error,fontSize:12},children:""})})]},c.id))})]})]}),e.jsxs("div",{style:p.card,children:[e.jsx("p",{style:p.sTitle,children:"Aadir entregable personalizado"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:600,color:k.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:"Nombre"}),e.jsx("input",{value:o,onChange:c=>n(c.target.value),placeholder:"Ej: Plano de paisajismo",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:3,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif"},onKeyDown:c=>c.key==="Enter"&&C()})]}),e.jsxs("div",{style:{width:90},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:600,color:k.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:"Horas"}),e.jsx("input",{type:"number",value:s,onChange:c=>r(c.target.value),placeholder:"0",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:3,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif",textAlign:"center"},onKeyDown:c=>c.key==="Enter"&&C()})]}),e.jsx("button",{onClick:C,style:{padding:"8px 16px",background:k.ink,color:"#fff",border:"none",borderRadius:3,fontSize:11,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",letterSpacing:.5,whiteSpace:"nowrap"},children:"+ Aadir"})]})]}),a.entregables.length===0&&u.length===0&&e.jsxs("div",{style:{padding:"40px 0",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:13,color:k.inkLight,margin:"0 0 8px"},children:a.id==="consultoria"?"La consultora se personaliza por horas segn necesidades del proyecto.":"Este servicio no tiene entregables predefinidos."}),e.jsx("p",{style:{fontSize:11,color:k.inkLight},children:"Puedes aadir entregables personalizados usando el formulario de arriba."})]}),f>0&&(a.id==="arq_nueva"||a.id==="arq_reforma"||a.id==="interiorismo")&&e.jsx("div",{style:{background:"#111",borderRadius:8,padding:"20px 24px",marginTop:8},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:14,fontWeight:700,color:"#fff"},children:"Generar oferta automtica"}),e.jsxs("p",{style:{margin:0,fontSize:11,color:"#999",lineHeight:1.5},children:["Crea el borrador con ",f," entregables (",m,"h), asigna equipo de diseo, calcula APU y genera flujo de caja. Todo editable despus."]})]}),e.jsx("button",{onClick:async()=>{let c=0,d=null;try{const E=await Fe.get("hab:crm:equipos"),w=E?JSON.parse(E.value):[];if(d=w.find(I=>I.nombre&&I.nombre.toLowerCase().includes("diseo"))||w[0],d){const[I,z,B,P]=await Promise.all([Fe.get("hab:rrhh:cargos"),Fe.get("hab:rrhh:activos"),Fe.get("hab:rrhh:licencias"),Fe.get("hab:rrhh:jornada")]),q=I?JSON.parse(I.value):[],U=z?JSON.parse(z.value):[],$=B?JSON.parse(B.value):[],Y=P?JSON.parse(P.value):{hDia:8,diasSemana:5,semanasAnio:50,pctProductivas:75,diasFestivos:18,diasAusencias:5},J=(Y.diasSemana*Y.semanasAnio-(Y.diasFestivos||18)-(Y.diasAusencias||5))*Y.hDia*((Y.pctProductivas||75)/100),ye=(d.cargos||[]).reduce((R,T)=>{const W=q.find(O=>O.id===T.cargoId);if(!W||!W.salarioBruto)return R;const X=1+((W.prestaciones||52.18)+(W.segSocial||12.5)+(W.parafiscales||9))/100,M=W.salarioBruto*12*X;return R+(J>0?M/J:0)*(T.cantidad||1)},0),oe=(d.activosUsados||[]).reduce((R,T)=>{const W=U.find(M=>M.id===T.activoId);if(!W||!W.valorCompra)return R;const X=W.valorCompra/(W.vidaUtilAnios||5);return R+X/(W.usoAnual||1760)*(T.cantidad||1)},0),L=(d.licenciasUsadas||[]).reduce((R,T)=>{const W=$.find(X=>X.id===T.licId);return W?R+(W.costoAnual||0)/(J||1760)*(T.cantidad||1):R},0);c=ye+oe+L}}catch(E){console.error("Error reading team:",E)}if(c===0){const E=(t.apuHDia||8)*(t.apuDiasSem||5)*(t.apuSemanas||52)*(t.apuPctProductivas||.6),w=(t.apuSalarioAnual||0)*(1+(t.apuPrestaciones||.65))+Number(t.apuLicencias||0)+Number(t.apuEquipos||0)+Number(t.apuAccesorios||0);c=E>0?w/E:25e3}const l=u.filter(E=>E.incluir),x=()=>Math.random().toString(36).slice(2,10),y={id:x(),esCapitulo:!0,nombre:"DISEO  "+a.nombre.toUpperCase(),tipo:"CAP17"},g=l.map((E,w)=>({id:x(),esCapitulo:!1,tipo:"CAP17",codigo:a.cod+"-"+String(w+1).padStart(2,"0"),descripcion:E.nombre,unidad:"h",cantidad:E.horas||0,precioCD:(E.horas||0)*c,apu:{estudios:[{id:E.id,nombre:E.nombre,horas:E.horas||0}],mo:[],subcontratas:[]}}));i("borradorLineas",[y,...g]),d&&i("ofertaEquipos",[{id:x(),nombre:d.nombre,cargos:(d.cargos||[]).map(E=>({...E,id:x()})),activosUsados:d.activosUsados||[],licenciasUsadas:d.licenciasUsadas||[],logItemsUsados:d.logItemsUsados||[],rendimiento:d.rendimiento||1,notas:"Auto-generado desde Alcances"}]),c>0&&(i("apuModoHora","MANUAL"),i("apuCostoHoraManual",Math.round(c)));const S=l.reduce((E,w)=>E+(w.horas||0)*c,0),A=Math.ceil(m/8);i("flujoHitos",[{id:x(),nombre:"Anticipo",pct:30,monto:Math.round(S*.3),dia:0},{id:x(),nombre:"Avance 50%",pct:40,monto:Math.round(S*.4),dia:Math.round(A*.5)},{id:x(),nombre:"Entrega final",pct:30,monto:Math.round(S*.3),dia:A}]),i("cronoDias",A),i("cronoInicio",new Date().toISOString().slice(0,10)),alert(` Oferta generada:
 ${g.length} partidas de diseo
 Costo/hora equipo: ${Math.round(c).toLocaleString()} COP/h
 Total: ${Math.round(S).toLocaleString()} COP
 Duracin estimada: ${A} das

Revisa las pestaas Borrador, Equipos y Flujo de caja.`)},style:{padding:"12px 28px",background:"#fff",color:"#111",border:"none",borderRadius:6,fontSize:13,fontWeight:800,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",letterSpacing:.5,whiteSpace:"nowrap",transition:"all .15s"},children:" Generar oferta"})]})})]})}function Dh({d:t,set:i}){const[o,n]=F.useState(null),[s,r]=F.useState(!0);F.useEffect(()=>{if(t.briefingId)try{const b=Fe.getSync("hab:briefing:"+t.briefingId);b&&n(JSON.parse(b))}catch{}r(!1)},[t.briefingId]);const a=Zd,u={label:{fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 4px",fontWeight:600},val:{fontSize:13,color:k.ink,margin:"0 0 12px",lineHeight:1.5},card:{background:"#fff",border:`1px solid ${k.border}`,borderRadius:6,padding:"20px 24px",marginBottom:16},grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0 24px"}};if(s)return e.jsx("div",{style:{padding:40,textAlign:"center",color:k.inkLight},children:"Cargando..."});if(!t.briefingId)return e.jsxs("div",{style:{padding:"60px 0",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:14,color:k.inkLight,margin:"0 0 12px"},children:"Esta oferta no tiene un briefing vinculado."}),e.jsx("p",{style:{fontSize:12,color:k.inkLight},children:'Puedes crear una oferta desde un briefing en Briefings  Recibidos  "Crear oferta"'})]});if(!o)return e.jsx("div",{style:{padding:"60px 0",textAlign:"center"},children:e.jsxs("p",{style:{fontSize:14,color:k.inkLight},children:["Briefing vinculado (ID: ",t.briefingId,") pero los datos no se encontraron en la base de datos."]})});const h=[{title:"Identificacin del proyecto",icon:"",keys:["nombre","email","telefono","como_conociste","ciudad","edificio","direccion_proyecto","tipo_proyecto","area_m2","num_habitaciones"]},{title:"Diseo y estilo",icon:"",keys:["estilo","colores_materiales","espacios","fecha_inicio","plazo"]},{title:"Presupuesto y financiacin",icon:"",keys:["presupuesto","financiacion","lo_mas_importante","que_esperas","links_ref"]},{title:"Datos de facturacin",icon:"",keys:["razon_social","documento","email_factura","dir_facturacion","retenciones","detalle_retenciones","anticipo","forma_pago"]}];return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:18},children:""}),e.jsx("h3",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:18,fontWeight:700,margin:0,color:k.ink},children:"Informe de Briefing"})]}),e.jsxs("p",{style:{fontSize:11,color:k.inkLight,margin:"4px 0 0"},children:["Respuestas del cliente  ",o.fecha||"","  ",o.nombre||"Sin nombre"]})]}),h.map((b,j)=>b.keys.some(v=>{const m=o[v];return m&&(Array.isArray(m)?m.length>0:String(m).trim()!=="")})?e.jsxs("div",{style:u.card,children:[e.jsxs("h4",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:13,fontWeight:700,margin:"0 0 16px",color:k.ink,display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:b.icon})," ",b.title]}),e.jsx("div",{style:u.grid,children:b.keys.map(v=>{const m=o[v];if(!m||Array.isArray(m)&&m.length===0||String(m).trim()==="")return null;const f=a.find(d=>d.key===v),p=(f==null?void 0:f.lbl)||v,c=Array.isArray(m)?m.join(", "):String(m);return e.jsxs("div",{children:[e.jsx("p",{style:u.label,children:p}),e.jsx("p",{style:u.val,children:c})]},v)})})]},j):null)]})}const $h=[{id:"briefing",lbl:"Briefing",en:"Briefing"},{id:"general",lbl:"General",en:"General"},{id:"alcances",lbl:"Alcances",en:"Scope"},{id:"params",lbl:"Parmetros",en:"Parameters"},{id:"borrador",lbl:"Borrador + APU",en:"Draft + APU"},{id:"cronograma",lbl:"Cronograma",en:"Schedule"},{id:"flujo",lbl:"Flujo de caja",en:"Cash Flow"},{id:"organigrama",lbl:"Organigrama",en:"Org Chart"},{id:"gg",lbl:"Gastos generales",en:"Overhead"},{id:"insumos",lbl:"Insumos",en:"Supplies"},{id:"equipos",lbl:"Equipos trabajo",en:"Work Teams"},{id:"resumen",lbl:"Resumen",en:"Summary"},{id:"entrega",lbl:"Entrega cliente",en:"Client Delivery"}];function Ph({offers:t,editId:i,prefillData:o,onSave:n,onBack:s,lang:r}){const a=i?t.find(d=>d.id===i):null,[u,h]=F.useState(()=>({...ih,...a||{},...!i&&o?o:{},id:(a==null?void 0:a.id)||zt(),createdAt:(a==null?void 0:a.createdAt)||qt(),updatedAt:qt(),planos:(a==null?void 0:a.planos)||Yd()})),[b,j]=F.useState("general");F.useEffect(()=>{if(!i&&(o!=null&&o.lugarNombre)&&!u.proyecto){const d=Xd(u.tipoInmueble,u.lugarNombre,u.lugarReferencia);d&&h(l=>({...l,proyecto:d}))}},[]);const[C,v]=F.useState(!1),m=(d,l)=>h(x=>({...x,[d]:l,updatedAt:qt()})),f=F.useMemo(()=>Jn(u),[u]),p=()=>{n(u),v(!0),setTimeout(()=>v(!1),2200)},c=()=>{const d=[["Campo","Valor"],["Cliente",u.cliente],["Proyecto",u.proyecto],["Estado",u.estado],["Tipo",u.tipoProyecto],...u.tipoProyecto==="DISEO"?[["Modalidad",u.subtipoDiseno]]:[],["Costo (COP)",f.COSTO],["PVP sin IVA",f.PVP],["IVA",f.IVA],["PVP c/IVA",f.PVP_IVA],["Margen $",f.margenCOP],["Financieros",f.fin],["Retenciones",f.ret],["Neto",f.neto]],l=new Blob(["\uFEFF"+d.map(g=>g.map(S=>`"${S}"`).join(",")).join(`
`)],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(l),y=document.createElement("a");y.href=x,y.download=`Oferta_${u.cliente||"Habitaris"}_${u.proyecto||"SN"}.csv`,y.click(),URL.revokeObjectURL(x)};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{className:"no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:22,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("button",{onClick:s,style:{background:"none",border:"none",cursor:"pointer",color:k.inkMid,padding:4},children:e.jsx(hd,{size:18})}),e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",color:k.inkLight,margin:"0 0 3px"},children:[i?r==="en"?"Edit offer":"Editar oferta":r==="en"?"New offer":"Nueva oferta",!i&&(o==null?void 0:o.briefingId)&&e.jsxs("span",{style:{marginLeft:8,background:"#E6F4EC",color:"#2B7A52",border:"1px solid #2B7A5233",borderRadius:2,padding:"1px 7px",fontSize:8,fontWeight:700,letterSpacing:.5},children:[" ",r==="en"?"FROM BRIEFING":"DESDE BRIEFING"]})]}),e.jsxs("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:22,fontWeight:700,color:k.ink,margin:0},children:[u.cliente||(r==="en"?"No client":"Sin cliente"),u.proyecto?`  ${u.proyecto}`:""]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ht,{v:"out",icon:vn,sm:!0,on:c,children:r==="en"?"Export CSV":"Exportar CSV"}),e.jsxs(ht,{v:"out",icon:Bt,sm:!0,on:()=>window.print(),children:["PDF / ",r==="en"?"Print":"Imprimir"]}),e.jsx(ht,{icon:ko,on:p,style:C?{background:k.success}:{},children:C?r==="en"?"Saved!":"Guardado!":r==="en"?"Save offer":"Guardar oferta"})]})]}),e.jsx("div",{className:"no-print",style:{display:"flex",borderBottom:`1px solid ${k.border}`,marginBottom:22,overflowX:"auto",whiteSpace:"nowrap"},children:$h.map(d=>e.jsx("button",{onClick:()=>j(d.id),style:{padding:"10px 16px",border:"none",cursor:"pointer",fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:600,letterSpacing:1,textTransform:"uppercase",background:"transparent",color:b===d.id?k.ink:k.inkLight,borderBottom:b===d.id?`2px solid ${k.ink}`:"2px solid transparent",transition:"all .15s",marginBottom:-1},children:r==="en"&&d.en?d.en:d.lbl},d.id))}),b==="briefing"&&e.jsx(Dh,{d:u,set:m}),b==="general"&&e.jsx(Oh,{d:u,set:m,offers:t}),b==="alcances"&&e.jsx(_h,{d:u,set:m}),b==="params"&&e.jsx(Lh,{d:u,set:m,r:f}),b==="borrador"&&e.jsx(Mh,{d:u,set:m,r:f}),b==="cronograma"&&e.jsx(Wh,{d:u,set:m,r:f}),b==="flujo"&&e.jsx(Uh,{d:u,set:m,r:f}),b==="organigrama"&&e.jsx(Hh,{d:u,set:m}),b==="gg"&&e.jsx(Nh,{d:u,set:m,r:f}),b==="insumos"&&e.jsx(qh,{d:u,set:m,r:f}),b==="equipos"&&e.jsx(Vh,{d:u,set:m}),b==="resumen"&&e.jsx(Gh,{d:u,r:f}),b==="entrega"&&e.jsx(Kh,{d:u,set:m,r:f})]})}function Oh({d:t,set:i,offers:o}){const n=_s.find(x=>x.val===t.tipoInmueble)||_s[0];Ir.find(x=>x.cod===t.actividadCod)||Ir[0];const s=[...new Set(Ir.map(x=>x.grupo))],[r,a]=F.useState([]),[u,h]=F.useState(!1),[b,j]=F.useState(!1);F.useEffect(()=>{ps().then(x=>a(x))},[]);const C=(x,y,g)=>{const S=Ml(x,y,g);i("codigoOferta",S)},v=(x,y)=>{i("proyecto",Xd(t.tipoInmueble,x,y))},m=x=>{i("actividadCod",x),C(x,t.digitoControl,t.revision)},f=x=>{i("digitoControl",x),C(t.actividadCod,x,t.revision)},p=x=>{i("revision",x),C(t.actividadCod,t.digitoControl,x)},c=x=>{i("lugarNombre",x),v(x,t.lugarReferencia)},d=x=>{i("lugarReferencia",x),v(t.lugarNombre,x)},l=t.codigoOferta||Ml(t.actividadCod,t.digitoControl,t.revision);return e.jsxs("div",{className:"fade",children:[t.briefingId?e.jsxs("div",{style:{background:"#E8F4EE",border:"1px solid #B8DEC9",borderRadius:8,padding:"10px 16px",marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(gd,{size:14,style:{color:"#111111"}}),e.jsx("span",{style:{fontSize:12,color:"#111111",fontWeight:600},children:"Oferta creada desde briefing"})]}):e.jsxs("div",{style:{background:"#F0F0F0",border:"1px solid #B8D4F0",borderRadius:8,padding:"12px 16px",marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(Cn,{size:16,style:{color:"#3B3B3B"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:"#3B3B3B"},children:r.length>0?`${r.length} briefing${r.length>1?"s":""} disponible${r.length>1?"s":""}`:"Tienes datos de un briefing?"}),e.jsx("div",{style:{fontSize:10,color:"#3B3B3B99"},children:r.length>0?"Importa los datos del cliente para pre-llenar la oferta":"Ingresa un briefing en Formularios y luego imprtalo aqu"})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[r.length>0&&e.jsx("button",{onClick:()=>h(!0),style:{padding:"6px 14px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:11,fontWeight:700,display:"flex",alignItems:"center",gap:5,fontFamily:"'DM Sans',sans-serif"},children:" Importar briefing"}),e.jsx("button",{onClick:()=>j(!0),style:{padding:"6px 14px",background:r.length>0?"#fff":"#3B3B3B",color:r.length>0?"#3B3B3B":"#fff",border:r.length>0?"1px solid #3B3B3B33":"none",borderRadius:6,cursor:"pointer",fontSize:11,fontWeight:600,display:"flex",alignItems:"center",gap:5,fontFamily:"'DM Sans',sans-serif"},children:" Ingresar rpido"})]})]}),u&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:x=>x.target===x.currentTarget&&h(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:520,width:"100%",maxHeight:"65vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:"Seleccionar briefing"}),e.jsx("button",{onClick:()=>h(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx(Ot,{size:18})})]}),e.jsx("div",{style:{overflowY:"auto",padding:14},children:r.map(x=>e.jsxs("div",{onClick:()=>{const y=Ra(x);Object.entries(y).forEach(([g,S])=>i(g,S)),i("briefingId",x.id),h(!1)},style:{padding:"12px 14px",border:"1px solid #E0E0E0",borderRadius:8,marginBottom:8,cursor:"pointer"},onMouseEnter:y=>y.currentTarget.style.background="#F5F4F1",onMouseLeave:y=>y.currentTarget.style.background="#fff",children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:x.nombre||"Sin nombre"}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2},children:[x.email||"","  ",new Date(x.creadoEn||Date.now()).toLocaleDateString("es-CO")]})]},x.id))})]})}),b&&(()=>{const x=[{k:"nombre",l:"Nombre completo *",ph:"Juan Prez",required:!0},{k:"email",l:"Email",ph:"juan@mail.com",type:"email"},{k:"telefono",l:"WhatsApp",ph:"300 123 4567",type:"tel"},{k:"ciudad",l:"Ciudad",ph:"Bogot"},{k:"edificio",l:"Edificio / Conjunto",ph:"Torres del Parque"},{k:"tipo_proyecto",l:"Tipo de proyecto",ph:"",sel:["Diseo interior","Remodelacin","Obra nueva","Adecuacin comercial","Otro"]},{k:"area_m2",l:"rea (m)",ph:"80",type:"number"},{k:"presupuesto",l:"Presupuesto (COP)",ph:"50000000",type:"number"},{k:"lo_mas_importante",l:"Qu necesita el cliente?",ph:"Descripcin breve del proyecto...",ta:!0},{k:"razon_social",l:"Razn social",ph:"Empresa S.A.S"},{k:"documento",l:"NIT / Cdula",ph:"901.000.000-0"}];return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:500,display:"flex",alignItems:"center",justifyContent:"center",padding:24},onClick:y=>y.target===y.currentTarget&&j(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:10,maxWidth:600,width:"100%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #E0E0E0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:15},children:" Ingreso rpido de briefing"}),e.jsx("div",{style:{fontSize:10,color:"#888",marginTop:2},children:"Los datos se importarn directamente a esta oferta"})]}),e.jsx("button",{onClick:()=>j(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx(Ot,{size:18})})]}),e.jsx("div",{style:{overflowY:"auto",padding:"16px 20px"},id:"qb-form",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:x.map(y=>e.jsxs("div",{style:y.ta?{gridColumn:"1/-1"}:{},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#888",marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:y.l}),y.sel?e.jsxs("select",{"data-qb":y.k,defaultValue:"",style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),y.sel.map(g=>e.jsx("option",{value:g,children:g},g))]}):y.ta?e.jsx("textarea",{"data-qb":y.k,rows:2,placeholder:y.ph,style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical",boxSizing:"border-box"}}):e.jsx("input",{"data-qb":y.k,type:y.type||"text",placeholder:y.ph,style:{width:"100%",padding:"8px 10px",border:"1px solid #E0E0E0",borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",boxSizing:"border-box"}})]},y.k))})}),e.jsxs("div",{style:{padding:"12px 20px",borderTop:"1px solid #E0E0E0",display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:async()=>{const y={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0]};if(document.querySelectorAll("[data-qb]").forEach(S=>{const A=S.getAttribute("data-qb");S.value&&(y[A]=S.value)}),!y.nombre){alert("El nombre es obligatorio");return}await Ia(y),a(S=>[y,...S]);const g=Ra(y);Object.entries(g).forEach(([S,A])=>i(S,A)),i("briefingId",y.id),j(!1)},style:{padding:"8px 20px",background:"#111",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:700,fontFamily:"'DM Sans',sans-serif"},children:"Importar a esta oferta"}),e.jsx("button",{onClick:async()=>{const y={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),fecha:new Date().toISOString().split("T")[0]};if(document.querySelectorAll("[data-qb]").forEach(g=>{const S=g.getAttribute("data-qb");g.value&&(y[S]=g.value)}),!y.nombre){alert("El nombre es obligatorio");return}await Ia(y),a(g=>[y,...g]),j(!1),alert(" Briefing guardado. Puedes importarlo cuando quieras.")},style:{padding:"8px 20px",background:"transparent",color:"#555",border:"1px solid #E0E0E0",borderRadius:6,cursor:"pointer",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:"Solo guardar briefing"})]})]})})})(),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(rt,{style:{padding:22},children:[e.jsx(Mt,{t:"Codificacin del proyecto",s:"Cdigo automtico segn formato Habitaris"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Tipo de actividad"}),e.jsx("select",{value:t.actividadCod,onChange:x=>m(x.target.value),style:{width:"100%",padding:"9px 12px",border:`1px solid ${k.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:k.ink,background:k.bg},onFocus:x=>x.target.style.borderColor=k.ink,onBlur:x=>x.target.style.borderColor=k.border,children:s.map(x=>e.jsx("optgroup",{label:x,children:Ir.filter(y=>y.grupo===x).map(y=>e.jsxs("option",{value:y.cod,children:[y.cod,"  ",y.label]},y.cod))},x))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(ot,{lbl:"Dgito de control",val:t.digitoControl,on:x=>f(x.target.value),ph:"01",note:"2 dgitos  orden del da"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Revisin"}),e.jsx("select",{value:t.revision,onChange:x=>p(+x.target.value),style:{width:"100%",padding:"9px 12px",border:`1px solid ${k.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,color:k.ink,background:k.bg},onFocus:x=>x.target.style.borderColor=k.ink,onBlur:x=>x.target.style.borderColor=k.border,children:[0,1,2,3,4,5,6,7,8,9].map(x=>e.jsxs("option",{value:x,children:["R",String(x).padStart(2,"0")]},x))})]})]}),e.jsxs("div",{style:{background:k.ink,borderRadius:2,padding:"14px 16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 3px",fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:1.5},children:"Cdigo de oferta"}),e.jsx("p",{style:{margin:0,fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:"#fff",letterSpacing:1.5},children:l})]}),e.jsx("button",{onClick:()=>{var x;return(x=navigator.clipboard)==null?void 0:x.writeText(l)},style:{background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:2,padding:"6px 12px",color:"#fff",fontFamily:"'DM Sans', sans-serif",fontSize:10,cursor:"pointer",letterSpacing:.8},children:"COPIAR"})]})]}),e.jsxs(rt,{style:{padding:22},children:[e.jsx(Mt,{t:"Identificacin del proyecto",s:"Nombre automtico segn tipo de inmueble"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:8,textTransform:"uppercase",letterSpacing:1},children:"Tipo de inmueble"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:_s.map(x=>e.jsx("button",{onClick:()=>i("tipoInmueble",x.val),style:{padding:"5px 12px",borderRadius:2,border:`1px solid ${t.tipoInmueble===x.val?k.ink:k.border}`,fontFamily:"'DM Sans', sans-serif",fontSize:11,fontWeight:t.tipoInmueble===x.val?700:400,background:t.tipoInmueble===x.val?k.ink:"transparent",color:t.tipoInmueble===x.val?"#fff":k.inkMid,cursor:"pointer",transition:"all .15s"},children:x.label},x.val))})]}),e.jsx(ot,{lbl:n.ph1,val:t.lugarNombre,on:x=>c(x.target.value),ph:`Ej: ${n.ph1}`}),e.jsx(ot,{lbl:n.ph2,val:t.lugarReferencia,on:x=>d(x.target.value),ph:n.ph2}),e.jsxs("div",{style:{background:k.accentBg,borderRadius:2,padding:"12px 16px",border:`1px solid ${k.borderMid}`,marginBottom:14},children:[e.jsx("p",{style:{margin:"0 0 3px",fontSize:9,color:k.inkLight,textTransform:"uppercase",letterSpacing:1.5},children:"Nombre del proyecto"}),e.jsx("p",{style:{margin:0,fontSize:15,fontWeight:700,color:k.ink},children:t.proyecto||e.jsx("span",{style:{color:k.inkLight,fontWeight:400},children:"Se completar automticamente"})})]}),e.jsx(ot,{lbl:"Cliente / Empresa",val:t.cliente,on:x=>i("cliente",x.target.value),ph:"Nombre del cliente"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(ot,{lbl:"Email cliente",val:t.emailCliente||"",on:x=>i("emailCliente",x.target.value),ph:"cliente@email.com"}),e.jsx(ot,{lbl:"Telfono cliente",val:t.telCliente||"",on:x=>i("telCliente",x.target.value),ph:"+57 300 000 0000"})]}),e.jsx(ot,{lbl:"Ciudad / Barrio",val:t.ubicacion,on:x=>i("ubicacion",x.target.value),ph:"Ej: Bogot, Chapinero"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(ot,{lbl:"Fecha inicio estimada",type:"date",val:t.fechaInicio||"",on:x=>i("fechaInicio",x.target.value)}),e.jsx(ot,{lbl:"Fecha entrega estimada",type:"date",val:t.fechaEntrega||"",on:x=>i("fechaEntrega",x.target.value)})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(mn,{lbl:"Firma / Representante",val:t.firmaRepresentante||"David Parra Galera",on:x=>i("firmaRepresentante",x.target.value),opts:["David Parra Galera","Ana Mara Daz Buitrago"]}),e.jsx(ot,{lbl:"Elaborado por",val:t.elaboradoPor||"",on:x=>i("elaboradoPor",x.target.value),ph:"Nombre de quien elabora"})]}),e.jsx(mn,{lbl:"Estado",val:t.estado,on:x=>i("estado",x.target.value),opts:Ka})]}),e.jsx(rt,{style:{padding:22,gridColumn:"1 / -1"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:k.inkLight,marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Notas internas"}),e.jsx("textarea",{value:t.notas,onChange:x=>i("notas",x.target.value),rows:3,placeholder:"Observaciones, acuerdos, follow-ups...",style:{width:"100%",padding:"9px 12px",border:`1px solid ${k.border}`,borderRadius:2,fontFamily:"'DM Sans', sans-serif",fontSize:12,background:k.bg,resize:"vertical",color:k.ink}})]}),e.jsxs("div",{children:[e.jsx(mn,{lbl:"Relacionada con oferta",val:t.relacionadaCon||"",on:x=>i("relacionadaCon",x.target.value||null),note:"Vincula a una revisin o variante anterior",opts:[{v:"",l:" Ninguna "},...o.filter(x=>x.id!==t.id).map(x=>({v:x.id,l:`${x.codigoOferta||x.cliente}  ${x.proyecto||"sin nombre"}`}))]}),e.jsxs("div",{style:{background:k.accentBg,borderRadius:2,padding:"10px 14px",fontSize:11,color:k.inkMid},children:["Creada: ",e.jsx("strong",{children:t.createdAt}),"  Actualizada: ",e.jsx("strong",{children:t.updatedAt})]})]})]})}),e.jsxs(rt,{style:{padding:22,marginTop:16},children:[e.jsx(Mt,{t:"Alcance del proyecto",s:"Descripcin del servicio para la propuesta"}),e.jsx("div",{style:{display:"flex",gap:6,marginBottom:10},children:(t.tipoProyecto==="OBRA"?[["obra_integral","Obra integral"],["obra_parcial","Obra parcial"],["remodelacion","Remodelacin"],["custom","Personalizado"]]:[["diseno_integral","Diseo integral"],["diseno_espacios","Diseo de espacios"],["consultoria","Consultora"],["custom","Personalizado"]]).map(([x,y])=>e.jsx("button",{onClick:()=>{i("alcanceTipo",x),x!=="custom"&&i("alcanceTexto",{obra_integral:`El presente presupuesto comprende la ejecucin integral de obra civil, acabados e instalaciones del proyecto, incluyendo:

 Obra civil: cimentacin, estructura, mampostera, cubierta
 Instalaciones: hidrosanitarias, elctricas, gas, red de datos
 Acabados: pisos, enchapes, pintura, carpintera metlica y en madera
 Equipamiento fijo: cocina, baos, closets

No incluye: mobiliario suelto, electrodomsticos, decoracin ni paisajismo exterior salvo que se indique expresamente.`,obra_parcial:`El presente presupuesto comprende la ejecucin parcial de las actividades indicadas en el borrador de costes, segn las especificaciones tcnicas acordadas.

El alcance se limita estrictamente a las partidas incluidas en el presupuesto detallado. Cualquier trabajo adicional ser objeto de una adenda o presupuesto complementario.`,remodelacion:`El presente presupuesto comprende los trabajos de remodelacin del espacio indicado, incluyendo:

 Demoliciones y retiro de escombros
 Modificaciones en instalaciones existentes
 Nuevos acabados segn diseo aprobado
 Carpintera y mobiliario fijo indicado

Se asume que la estructura existente se encuentra en buen estado. Cualquier refuerzo estructural requerido ser presupuestado aparte.`,diseno_integral:`El servicio de diseo integral comprende:

 Levantamiento y diagnstico del espacio existente
 Propuesta conceptual y desarrollo de concepto
 Diseo arquitectnico: plantas, cortes, fachadas
 Diseo interior: seleccin de materiales, mobiliario, iluminacin
 Planos tcnicos de detalle para ejecucin
 Especificaciones tcnicas y libro de acabados
 Acompaamiento en la seleccin de proveedores

Incluye hasta 2 rondas de ajustes por etapa de diseo.`,diseno_espacios:`El servicio de diseo de espacios comprende:

 Anlisis funcional del espacio
 Propuesta de distribucin y layout
 Seleccin de paleta de materiales y acabados
 Renders 3D fotorrealistas (3 vistas principales)
 Planos de mobiliario y especificaciones

No incluye planos tcnicos de instalaciones ni direccin de obra.`,consultoria:`El servicio de consultora incluye:

 Visita tcnica al sitio
 Informe de diagnstico y recomendaciones
 Estimacin presupuestaria de referencia
 Cronograma indicativo

No incluye desarrollo de diseo ni planos tcnicos.`}[x]||"")},style:{padding:"6px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${t.alcanceTipo===x?k.ink:k.border}`,borderRadius:4,background:t.alcanceTipo===x?k.ink:"#fff",color:t.alcanceTipo===x?"#fff":k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:y},x))}),e.jsx("textarea",{value:t.alcanceTexto||"",onChange:x=>i("alcanceTexto",x.target.value),rows:10,placeholder:"Describe el alcance del servicio...",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:4,padding:"10px 12px",fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical",lineHeight:1.6,background:k.bg,color:k.ink}}),e.jsx("p",{style:{fontSize:10,color:k.inkLight,marginTop:6,margin:0},children:'Este texto aparecer en la seccin "Alcance" del documento de entrega al cliente.'})]})]})]})}function Lh({d:t,set:i,r:o}){const n=t.pais||"CO",s=(r,a)=>{a==="CO"?r==="PN"?(i("pctReteFuente",.02),i("pctReteICA",.009),i("pctReteIVA",.15)):(i("pctReteFuente",.035),i("pctReteICA",.009),i("pctReteIVA",.15)):(i("pctReteFuente",.15),i("pctReteICA",0),i("pctReteIVA",0))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fade",style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:20},children:[e.jsxs(rt,{style:{padding:22},children:[e.jsx(Mt,{t:"Pas y Tipo Fiscal",s:"Localizacin y mrgenes"}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Pas / Mercado"}),e.jsx("div",{style:{display:"flex",gap:6},children:[{id:"CO",flag:"",label:"Colombia"},{id:"ES",flag:"",label:"Espaa"}].map(r=>e.jsxs("button",{onClick:()=>{i("pais",r.id),i("divisa",r.id==="CO"?"COP":"EUR"),i("tarifaIVA",r.id==="CO"?.19:.1)},style:{flex:1,padding:"7px 4px",border:`2px solid ${n===r.id?r.id==="CO"?"#111111":"#3B3B3B":"#E0E0E0"}`,borderRadius:6,background:n===r.id?r.id==="CO"?"#E8F4EE":"#F0F0F0":"transparent",cursor:"pointer",fontSize:12,fontWeight:n===r.id?700:400,color:n===r.id?r.id==="CO"?"#111111":"#3B3B3B":"#555",fontFamily:"'DM Sans',sans-serif"},children:[r.flag," ",r.label]},r.id))})]}),e.jsx(mn,{lbl:"Tipo fiscal",val:t.tipoProyecto,on:r=>i("tipoProyecto",r.target.value),opts:["OBRA","DISEO"],note:"OBRA  IVA sobre utilidad  DISEO  IVA pleno"}),e.jsx(ot,{lbl:n==="CO"?"Tarifa IVA":"IVA (21%=general, 10%=obra, 4%=superred.)",type:"number",val:(t.tarifaIVA*100).toFixed(0),on:r=>i("tarifaIVA",+r.target.value/100),rt:"%",step:"1"}),t.pais==="CO"&&t.tipoProyecto==="OBRA"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:10,marginTop:6},children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Modo de clculo (OBRA)"}),e.jsx("div",{style:{display:"flex",gap:0},children:[{id:"margen",lbl:"Margen"},{id:"aiu",lbl:"AIU"}].map(r=>e.jsx("button",{onClick:()=>i("modoCalcObra",r.id),style:{flex:1,padding:"8px 12px",fontSize:12,cursor:"pointer",fontWeight:600,border:"1px solid #111",fontFamily:"'DM Sans',sans-serif",borderRadius:r.id==="margen"?"6px 0 0 6px":"0 6px 6px 0",background:(t.modoCalcObra||"margen")===r.id?"#111":"#fff",color:(t.modoCalcObra||"margen")===r.id?"#fff":"#555"},children:r.lbl},r.id))})]}),(t.modoCalcObra||"margen")==="margen"?e.jsxs(e.Fragment,{children:[e.jsx(ot,{lbl:"Margen (%)",type:"number",val:(t.margen*100).toFixed(1),on:r=>i("margen",+r.target.value/100),rt:"%",step:"0.1",note:`PVP = CD / ${(1-t.margen).toFixed(2)} (ej: 30%  /0.70, 20%  /0.80)`}),e.jsx(ot,{lbl:"U declarada para IVA (%)",type:"number",val:((t.uDecl||.1)*100).toFixed(1),on:r=>i("uDecl",+r.target.value/100),rt:"%",step:"0.1",note:"Solo para calcular el IVA sobre utilidad. No afecta al PVP."}),e.jsxs("div",{style:{background:k.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:k.inkMid},children:["PVP = CD / ",e.jsx("strong",{children:(1-t.margen).toFixed(2)}),"  IVA = U ",e.jsxs("strong",{children:[((t.uDecl||.1)*100).toFixed(1),"%"]}),"  PVP  ",e.jsxs("strong",{children:[(t.tarifaIVA*100).toFixed(0),"%"]})," = ",Ft(o.IVA)]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{lbl:"A  Administracin (%)",type:"number",val:((t.aiuA||.08)*100).toFixed(1),on:r=>i("aiuA",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(ot,{lbl:"I  Imprevistos (%)",type:"number",val:((t.aiuI||.03)*100).toFixed(1),on:r=>i("aiuI",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(ot,{lbl:"U  Utilidad (%)",type:"number",val:((t.aiuU||.07)*100).toFixed(1),on:r=>i("aiuU",+r.target.value/100),rt:"%",step:"0.1"}),e.jsxs("div",{style:{background:k.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:k.inkMid},children:["AIU = ",e.jsxs("strong",{children:[(((t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))*100).toFixed(1),"%"]})," sobre CD  IVA = U ",e.jsxs("strong",{children:[((t.aiuU||.07)*100).toFixed(1),"%"]}),"  PVP  ",e.jsxs("strong",{children:[(t.tarifaIVA*100).toFixed(0),"%"]})," = ",Ft(o.IVA)]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{lbl:"Margen objetivo",type:"number",val:(t.margen*100).toFixed(1),on:r=>i("margen",+r.target.value/100),rt:"%",step:"0.1",note:"Para clculo del PVP"}),e.jsxs("div",{style:{background:k.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:k.inkMid},children:["IVA ",t.pais==="ES"?"ES":"DISEO"," = IVA pleno sobre ",e.jsx("strong",{children:"PVP completo"})," = ",Ft(o.IVA)]})]}),n==="ES"&&e.jsxs(e.Fragment,{children:[e.jsx(ot,{lbl:"% Gastos Generales (GG)",type:"number",val:((t.gg||.13)*100).toFixed(1),on:r=>i("gg",+r.target.value/100),rt:"%",step:"0.1"}),e.jsx(ot,{lbl:"% Beneficio Industrial (BI)",type:"number",val:((t.bi||.06)*100).toFixed(1),on:r=>i("bi",+r.target.value/100),rt:"%",step:"0.1"})]})]}),e.jsxs(rt,{style:{padding:22},children:[e.jsx(Mt,{t:"Gastos de Contratacin (GC)",s:"Coste directo  llevan margen"}),e.jsx(ot,{lbl:"% RCE",type:"number",val:(t.pctRCE*100).toFixed(2),on:r=>i("pctRCE",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% TRC",type:"number",val:(t.pctTRC*100).toFixed(2),on:r=>i("pctTRC",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% Adm. contratacin PH",type:"number",val:(t.pctAdm*100).toFixed(2),on:r=>i("pctAdm",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% ICA (Bogot)",type:"number",val:(t.pctICA*100).toFixed(2),on:r=>i("pctICA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsxs("div",{style:{background:k.accentBg,borderRadius:4,padding:"8px 12px",fontSize:11,color:k.inkMid,marginTop:6},children:["Total GC: ",e.jsx("strong",{children:pt((t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0)+(t.pctICA||0))}),"  sobre PVP, llevan margen"]})]}),e.jsxs(rt,{style:{padding:22},children:[e.jsx(Mt,{t:"Retenciones",s:"Solo impactan flujo de caja"}),e.jsx(mn,{lbl:"Tipo de cliente",val:t.tipoCliente,on:r=>{i("tipoCliente",r.target.value),s(r.target.value,n)},opts:["PN","EMPRESA"],note:n==="CO"?t.tipoCliente==="PN"?"PN  ReteFuente 2%  ReteICA 0.9%  ReteIVA 15%":"Empresa  ReteFuente 3.5%  ReteICA 0.9%  ReteIVA 15%":"ES  IRPF 15%"}),e.jsx(ot,{lbl:"% ReteFuente",type:"number",val:(t.pctReteFuente*100).toFixed(2),on:r=>i("pctReteFuente",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% ReteICA",type:"number",val:(t.pctReteICA*100).toFixed(2),on:r=>i("pctReteICA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsx(ot,{lbl:"% ReteIVA",type:"number",val:(t.pctReteIVA*100).toFixed(2),on:r=>i("pctReteIVA",+r.target.value/100),rt:"%",step:"0.01"}),e.jsxs("div",{style:{background:k.accentBg,borderRadius:2,padding:"10px 14px",fontSize:11,color:k.inkMid,marginTop:8},children:["Total retenciones: ",e.jsx("strong",{children:pt(t.pctReteFuente+t.pctReteICA+t.pctReteIVA)})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginTop:20},children:[e.jsxs(rt,{style:{padding:22},children:[e.jsx(Mt,{t:"Condiciones de pago",s:"Para el documento de entrega al cliente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:10},children:[["Anticipo / firma","condPct1",.3],["Avance 50%","condPct2",.3],["Entrega final","condPct3",.3],["Retencin (30 das)","condPct4",.1]].map(([r,a,u])=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:r}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"number",value:((t[a]??u)*100).toFixed(0),min:0,max:100,onChange:h=>i(a,+h.target.value/100),style:{width:60,border:`1px solid ${k.border}`,borderRadius:4,padding:"6px 8px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:k.bg,textAlign:"right"}}),e.jsx("span",{style:{fontSize:11,color:k.inkLight},children:"%"}),e.jsxs("span",{style:{fontSize:11,color:k.inkLight},children:["= ",Ft((t[a]??u)*(o.PVP||0))]})]})]},a))}),e.jsxs("div",{style:{fontSize:11,color:Math.abs((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1)-1)<.001?k.success:k.warning},children:["Total: ",(((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1))*100).toFixed(0),"%",Math.abs((t.condPct1??.3)+(t.condPct2??.3)+(t.condPct3??.3)+(t.condPct4??.1)-1)>=.001?"  debe sumar 100%":" "]})]}),e.jsxs(rt,{style:{padding:22},children:[e.jsx(Mt,{t:"Gastos Financieros (GF)",s:"NO llevan margen  Editables"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6,marginBottom:10},children:[["PSE","PSE"],["Tarjeta","Tarjeta"],["Transferencia","Transf."],["Manual","Manual"]].map(([r,a])=>e.jsx("button",{onClick:()=>i("medioPago",r),style:{padding:"5px 6px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${t.medioPago===r?k.ink:k.border}`,borderRadius:4,background:t.medioPago===r?k.ink:"#fff",color:t.medioPago===r?"#fff":k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:a},r))}),t.medioPago==="PSE"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#999",marginBottom:3,textTransform:"uppercase",letterSpacing:.8},children:"Banco PSE"}),e.jsx("select",{value:t.bancoPSE||"custom",onChange:r=>{const a=r.target.value;i("bancoPSE",a);const u={bancolombia:.01,davivienda:.009,nequi:.012,bbva:.01};u[a]!==void 0&&i("pctComPSE",u[a])},style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:k.bg},children:[["bancolombia","Bancolombia (1.0%)"],["davivienda","Davivienda (0.9%)"],["nequi","Nequi (1.2%)"],["bbva","BBVA (1.0%)"],["custom","Otro"]].map(([r,a])=>e.jsx("option",{value:r,children:a},r))})]}),t.medioPago==="Tarjeta"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:"#999",marginBottom:3,textTransform:"uppercase",letterSpacing:.8},children:"Pasarela"}),e.jsx("select",{value:t.pasarelaTarjeta||"custom",onChange:r=>{const a=r.target.value;i("pasarelaTarjeta",a);const u={wompi:.029,getnet:.025,epayco:.032,mercadopago:.0349,redsys:.005};u[a]!==void 0&&i("pctComTarjeta",u[a])},style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:k.bg},children:(n==="CO"?[["wompi","Wompi (2.9%)"],["getnet","Getnet (2.5%)"],["epayco","ePayco (3.2%)"],["mercadopago","M.Pago (3.49%)"],["custom","Otra"]]:[["redsys","Redsys (0.5%)"],["custom","Otra"]]).map(([r,a])=>e.jsx("option",{value:r,children:a},r))})]}),e.jsx(ot,{lbl:t.medioPago==="PSE"?"Tasa PSE (% sin IVA)":t.medioPago==="Tarjeta"?"Tasa tarjeta (% sin IVA)":t.medioPago==="Manual"?"Comisin manual (%)":"Tasa transferencia (%)",type:"number",val:((t.medioPago==="PSE"?t.pctComPSE??.012:t.medioPago==="Tarjeta"?t.pctComTarjeta??.036:t.medioPago==="Manual"?t.pctComManual??0:t.pctComTransf??0)*100).toFixed(2),on:r=>{const a=+r.target.value/100;t.medioPago==="PSE"?i("pctComPSE",a):t.medioPago==="Tarjeta"?i("pctComTarjeta",a):t.medioPago==="Manual"?i("pctComManual",a):i("pctComTransf",a)},rt:"%",step:"0.01"}),t.medioPago!=="Manual"&&e.jsx(ot,{lbl:"IVA sobre comisin",type:"number",val:((t.ivaComision??.19)*100).toFixed(0),on:r=>i("ivaComision",+r.target.value/100),rt:"%",step:"1"}),e.jsx(mn,{lbl:"Aplicar 41000",val:t.aplicar4x1000,on:r=>i("aplicar4x1000",r.target.value),opts:["SI","NO"]}),e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"8px 12px",fontSize:11,color:"#8C6A00",marginTop:6,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:["Total GF: ",e.jsx("strong",{children:pt(o.f||0)})," = ",Ft(o.fin||0)]}),e.jsx("button",{onClick:()=>{i("pctComPSE",.012),i("pctComTarjeta",.036),i("pctComTransf",0),i("pctComManual",0),i("ivaComision",n==="CO"?.19:.21),i("aplicar4x1000","SI")},style:{background:"none",border:"1px solid #C9A254",borderRadius:3,padding:"2px 8px",fontSize:9,fontWeight:600,color:"#8C6A00",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Restablecer"})]})]})]}),e.jsxs(rt,{style:{padding:22,marginTop:20},children:[e.jsx(Mt,{t:"Representantes Habitaris",s:"Para documentos de entrega y firma"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Firma del documento"}),e.jsxs("select",{value:t.firmaRepresentante||"David Parra Galera",onChange:r=>i("firmaRepresentante",r.target.value),style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:k.bg},children:[e.jsx("option",{value:"David Parra Galera",children:"David Parra Galera  Dir. Ejecutivo y Produccin"}),e.jsx("option",{value:"Ana Mara Daz Buitrago",children:"Ana Mara Daz Buitrago  Dir. Creativa y Diseo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Elaborado por"}),e.jsx("input",{value:t.elaboradoPor||"",onChange:r=>i("elaboradoPor",r.target.value),placeholder:"Nombre de quien elabor la oferta",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:k.bg,marginBottom:6}}),e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:"#999",marginBottom:5,textTransform:"uppercase",letterSpacing:1},children:"Cargo elaborador"}),e.jsx("input",{value:t.cargoElaborador||"",onChange:r=>i("cargoElaborador",r.target.value),placeholder:"Cargo",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:4,padding:"8px 10px",fontSize:13,fontFamily:"'DM Sans',sans-serif",background:k.bg}})]})]})]}),(()=>{const r=t.pais||"CO";let a=0,u="Sin comisin";const h=t.ivaComision??.19;t.medioPago==="PSE"&&(a=(t.pctComPSE??.012)*(1+h),u=`PSE ${((t.pctComPSE??.012)*100).toFixed(2)}% + IVA ${(h*100).toFixed(0)}%`),t.medioPago==="Tarjeta"&&(a=(t.pctComTarjeta??.036)*(1+h),u=`Tarjeta ${((t.pctComTarjeta??.036)*100).toFixed(2)}% + IVA ${(h*100).toFixed(0)}%`),t.medioPago==="Transferencia"&&(a=(t.pctComTransf??0)*(1+h),u=a>0?`Transf. ${((t.pctComTransf??0)*100).toFixed(2)}% + IVA ${(h*100).toFixed(0)}%`:"Transferencia (sin comisin)"),t.medioPago==="Manual"&&(a=t.pctComManual??0,u=`Manual ${((t.pctComManual??0)*100).toFixed(2)}%`);const b=t.aplicar4x1000==="SI"?.004:0,j=a+b,C=(t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0),v=t.pctICA||0,m=C+v,f=t.modoCalcObra||"margen",p=t.margen||.25,c=f==="aiu"?1-m:1-p-m,d=1-j,l=c*d,x=l>0?f==="aiu"?(1+(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))/l:1/l:0,y={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:"1px solid #E0E0E0",fontSize:12},g={fontFamily:"'DM Mono',monospace",fontWeight:600,fontSize:12},S={fontSize:11,color:k.inkLight,marginLeft:12};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginTop:20},children:[e.jsxs(rt,{style:{padding:18},children:[e.jsx(Mt,{t:"Gastos Financieros (GF)",s:"NO llevan margen  se suman al final"}),e.jsxs("div",{style:y,children:[e.jsxs("span",{children:["Comisin cobro ",e.jsx("span",{style:S,children:u})]}),e.jsx("span",{style:g,children:pt(a)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Gravamen 41000"}),e.jsx("span",{style:g,children:pt(b)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0 0",fontWeight:700,fontSize:13},children:[e.jsx("span",{children:"Total GF"}),e.jsx("span",{style:{...g,color:j>0?k.warning:k.inkLight},children:pt(j)})]})]}),e.jsxs(rt,{style:{padding:18},children:[e.jsx(Mt,{t:"Gastos de Contratacin (GC)",s:"Coste directo  LLEVA margen"}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Pliza RCE"}),e.jsx("span",{style:g,children:pt(t.pctRCE||0)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Pliza TRC"}),e.jsx("span",{style:g,children:pt(t.pctTRC||0)})]}),e.jsxs("div",{style:y,children:[e.jsx("span",{children:"Adm. contratacin"}),e.jsx("span",{style:g,children:pt(t.pctAdm||0)})]}),e.jsxs("div",{style:y,children:[e.jsxs("span",{children:["ICA ",r==="CO"?"(Bogot)":"(municipal)"]}),e.jsx("span",{style:g,children:pt(t.pctICA||0)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0 0",fontWeight:700,fontSize:13},children:[e.jsx("span",{children:"Total GC"}),e.jsx("span",{style:{...g,color:m>0?k.warning:k.inkLight},children:pt(m)})]})]}),e.jsxs(rt,{style:{padding:18,gridColumn:"1 / -1",background:k.ink,borderRadius:6},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:12},children:[[f==="aiu"?"AIU":"Margen",pt(f==="aiu"?(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07):p),"#aaa"],["GC (lleva M)",pt(m),"#aaa"],["Den (1MGC)",c.toFixed(4),"#fff"],["GF (sin M)",pt(j),"#aaa"],["Den (1GF)",d.toFixed(4),"#fff"]].map(([A,E,w])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:A}),e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:16,fontWeight:700,color:w},children:E})]},A))}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:14,paddingTop:12,borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:"Denominador total"}),e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:20,fontWeight:700,color:"#fff"},children:l.toFixed(4)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4},children:"Coeficiente multiplicador"}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:20,fontWeight:700,color:"#fff"},children:[" ",x.toFixed(4)]})]})]}),e.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:"1px solid rgba(255,255,255,0.1)",fontSize:11,color:"rgba(255,255,255,0.5)"},children:[f==="aiu"?"Frmula AIU: PVP = CD  (1+AIU) / (1GC) / (1GF)":"Frmula: PVP = CD / (1MGC) / (1GF)","  un CD de 1.000.000 genera PVP = ",l>0?Ft(f==="aiu"?1e6*(1+(t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))/l:1e6/l):""]})]})]})})()]})}function Wh({d:t,set:i,r:o}){const n=t.pais||"CO",s=n==="CO"?"COP":"EUR",r=L=>L?new Intl.NumberFormat(n==="CO"?"es-CO":"es-ES",{style:"currency",currency:s,minimumFractionDigits:0,maximumFractionDigits:0}).format(L):"",a=t.cronogramaActivos||[],u=L=>i("cronogramaActivos",typeof L=="function"?L(a):L),h=()=>{const L=t.borradorLineas||[],R=[];L.forEach(T=>{if(T.esCapitulo)a.find(W=>W.srcId===T.id)?R.push(a.find(W=>W.srcId===T.id)):R.push({id:zt(),srcId:T.id,nombre:T.nombre||T.descripcion||"Captulo",inicio:t.fechaInicio||qt(),duracion:30,avance:0,nivel:0,responsable:"",color:"#111111",precioCD:0,esCapitulo:!0});else{const W=T.precioCD>0?oi(T.precioCD,T.cantidad||1,t):null;if(!a.find(X=>X.srcId===T.id))R.push({id:zt(),srcId:T.id,nombre:T.descripcion||"Actividad",inicio:t.fechaInicio||qt(),duracion:15,avance:0,nivel:1,responsable:"",color:"#2A5F8C",pred:"",precioCD:T.precioCD||0,totalVenta:(W==null?void 0:W.totalVenta)||0,esCapitulo:!1});else{const X=a.find(M=>M.srcId===T.id);R.push({...X,precioCD:T.precioCD||0,totalVenta:(W==null?void 0:W.totalVenta)||0})}}}),a.filter(T=>!T.srcId).forEach(T=>R.push(T)),u(R)},b=()=>u([...a,{id:zt(),nombre:"Nueva actividad",inicio:t.fechaInicio||qt(),duracion:7,avance:0,nivel:0,responsable:"",color:"#2A5F8C",pred:"",precioCD:0,esCapitulo:!1}]),j=()=>u([...a,{id:zt(),nombre:"NUEVO CAPTULO",inicio:t.fechaInicio||qt(),duracion:30,avance:0,nivel:0,responsable:"",color:"#111111",precioCD:0,esCapitulo:!0}]),C=L=>u(a.filter(R=>R.id!==L)),v=(L,R,T)=>u(a.map(W=>W.id===L?{...W,[R]:T}:W)),m=L=>u(a.map(R=>R.id===L?{...R,nivel:Math.min(3,(R.nivel||0)+1)}:R)),f=L=>u(a.map(R=>R.id===L?{...R,nivel:Math.max(0,(R.nivel||0)-1)}:R)),p=(L,R)=>{const T=[...a],W=T.findIndex(X=>X.id===L);R===-1&&W>0&&([T[W-1],T[W]]=[T[W],T[W-1]]),R===1&&W<T.length-1&&([T[W],T[W+1]]=[T[W+1],T[W]]),u(T)},c=L=>{var H,se;const R=[];for(let N=L+1;N<a.length&&!(a[N].esCapitulo||(a[N].nivel||0)===0);N++)R.push(a[N]);if(R.length===0)return{start:(H=a[L])==null?void 0:H.inicio,dur:((se=a[L])==null?void 0:se.duracion)||30,cd:0,venta:0,avance:0};const T=R.map(N=>new Date(N.inicio||qt()).getTime()),W=R.map(N=>{const G=new Date(N.inicio||qt());return G.setDate(G.getDate()+(N.duracion||1)-1),G.getTime()}),X=Math.min(...T),M=Math.max(...W),O=Math.ceil((M-X)/864e5)+1,ne=R.reduce((N,G)=>N+(G.precioCD||0),0),ie=R.reduce((N,G)=>N+(G.totalVenta||0),0),re=R.length>0?Math.round(R.reduce((N,G)=>N+(G.avance||0),0)/R.length):0;return{start:new Date(X).toISOString().split("T")[0],dur:O,cd:ne,venta:ie,avance:re}},d=L=>{const R=new Date(L.inicio||qt());return R.setDate(R.getDate()+(L.duracion||1)-1),R.toISOString().split("T")[0]},l=a.flatMap(L=>[new Date(L.inicio||qt()).getTime(),new Date(d(L)).getTime()]),x=new Date(l.length?Math.min(...l):Date.now()),y=new Date(l.length?Math.max(...l):Date.now()+90*864e5),g=Math.max(30,Math.ceil((y-x)/864e5)+14),S=4,A=L=>Math.max(0,Math.ceil((new Date(L||qt())-x)/864e5)),E=[];for(let L=0;L<Math.ceil(g/7);L++){const R=new Date(x);R.setDate(R.getDate()+L*7),E.push(R)}const[w,I]=F.useState(!1),[z,B]=F.useState(50),[P,q]=F.useState(!1),U=a.filter(L=>!L.esCapitulo).reduce((L,R)=>L+(R.precioCD||0),0),$=a.filter(L=>!L.esCapitulo).reduce((L,R)=>L+(R.totalVenta||0),0),Y=()=>{const L=window.open("","_blank"),R=t.fechaInicio?new Date(t.fechaInicio).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"",T=t.fechaEntrega?new Date(t.fechaEntrega).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"",W=a.length>0?g:"";let X=`<html><head><title>Cronograma - ${t.codigoOferta||""}</title>
    <style>@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    @page{size:landscape;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'DM Sans',sans-serif;color:#111;font-size:10px;padding:20px}
    .header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;padding-bottom:12px;border-bottom:3px solid #111}
    .logo{font-size:16px;font-weight:800;letter-spacing:3px}
    .logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}
    .project-info{text-align:right}
    .project-title{font-size:14px;font-weight:700}
    .project-meta{font-size:9px;color:#555;margin-top:2px}
    .kpis{display:flex;gap:16px;margin-bottom:14px;padding:8px 0;border-bottom:1px solid #E0E0E0}
    .kpi{font-size:9px;color:#555}.kpi strong{color:#111;font-size:11px}
    table{width:100%;border-collapse:collapse;margin-bottom:8px}
    th{background:#F5F4F1;padding:4px 6px;font-size:7px;text-transform:uppercase;letter-spacing:0.5px;font-weight:700;color:#888;text-align:left;border-bottom:2px solid #E0E0E0}
    td{padding:4px 6px;border-bottom:1px solid #F5F5F5;font-size:9px}
    .cap td{font-weight:700;background:#F5F4F1;border-bottom:2px solid #E0E0E0;font-size:10px}
    .mono{font-family:'DM Mono',monospace}.green{color:#111111}.blue{color:#3B3B3B}
    .bar-row{height:18px;position:relative;margin:1px 0}
    .bar{height:14px;border-radius:3px;position:absolute;top:2px;min-width:4px}
    .avance{height:14px;border-radius:3px;position:absolute;top:2px;opacity:0.3}
    .gantt-header{font-size:7px;color:#888;border-bottom:1px solid #E0E0E0;padding:2px 0}
    .footer{margin-top:12px;padding-top:8px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:8px;color:#888}
    .totrow td{font-weight:700;border-top:2px solid #111;padding-top:6px}
    @media print{body{padding:0}}
    </style></head><body>`;X+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',X+=`<div class="project-info"><div class="project-title">${t.proyecto||t.codigoOferta||"Proyecto"}</div>`,X+=`<div class="project-meta">${t.codigoOferta||""}  Rev. ${t.revision||"R00"}  ${t.cliente||"Sin cliente"}</div>`,X+=`<div class="project-meta">${t.ubicacion||""}</div></div></div>`,X+='<div class="kpis">',X+=`<div class="kpi">Inicio: <strong>${R}</strong></div>`,X+=`<div class="kpi">Entrega: <strong>${T}</strong></div>`,X+=`<div class="kpi">Duracin: <strong>${W} das</strong></div>`,X+=`<div class="kpi">Actividades: <strong>${a.filter(O=>!O.esCapitulo).length}</strong></div>`,X+=`<div class="kpi">CD Total: <strong class="mono">${r(U)}</strong></div>`,X+=`<div class="kpi">Venta Total: <strong class="mono green">${r($)}</strong></div>`,X+="</div>",X+='<table><thead><tr><th>#</th><th>WBS</th><th style="min-width:140px">Actividad</th><th>Das</th><th>Inicio</th><th>Fin</th><th>Avance</th><th>Pred</th><th>CD</th><th>Venta</th><th>Responsable</th></tr></thead><tbody>';let M=[0];a.forEach((O,ne)=>{const ie=O.esCapitulo,re=O.nivel||0;M=M.slice(0,re+1),M[re]=(M[re]||0)+1;const H=M.filter((je,V)=>V<=re).join("."),se=re*16,N=ie?c(ne):null,G=ie&&N?N.dur:O.duracion||0,ue=(()=>{const je=new Date(O.inicio||qt());return je.setDate(je.getDate()+G-1),je.toLocaleDateString("es-CO")})(),he=new Date(ie&&(N!=null&&N.start)?N.start:O.inicio||qt()).toLocaleDateString("es-CO"),we=ie&&N?N.avance:O.avance||0,Ve=ie&&N?N.cd:O.precioCD||0,Ee=ie&&N?N.venta:O.totalVenta||0;X+=`<tr class="${ie?"cap":""}">`,X+=`<td>${ne+1}</td><td>${H}</td>`,X+=`<td style="padding-left:${6+se}px">${O.nombre||""}</td>`,X+=`<td class="mono">${G}</td><td>${he}</td><td>${ue}</td>`,X+=`<td>${we}%</td><td>${O.pred||""}</td>`,X+=`<td class="mono">${Ve>0?r(Ve):""}</td>`,X+=`<td class="mono green">${Ee>0?r(Ee):""}</td>`,X+=`<td>${O.responsable||""}</td></tr>`}),X+='<tr class="totrow"><td colspan="8"><strong>TOTAL PROYECTO</strong></td>',X+=`<td class="mono"><strong>${r(U)}</strong></td>`,X+=`<td class="mono green"><strong>${r($)}</strong></td><td></td></tr>`,X+="</tbody></table>",X+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Cronograma valorado</span>`,X+=`<span>Generado: ${new Date().toLocaleDateString("es-CO")}  Pgina 1</span></div>`,X+="</body></html>",L.document.write(X),L.document.close(),setTimeout(()=>L.print(),400)},ge=()=>{var re;const L=t.borradorLineas||[],R=t.pais||"CO",T=((re=Eo[R])==null?void 0:re.categorias)||[];let W=Ja;try{const H=Fe.get("hab:crm:equipos");H!=null&&H.value&&(W=JSON.parse(H.value))}catch{}const X={},M={},O={},ne={},ie=(H,se)=>{var N;return((N=se==null?void 0:se.recursosAsignados)==null?void 0:N.length)>0?se.recursosAsignados:pn[H]||[]};return a.filter(H=>!H.esCapitulo).forEach(H=>{const se=L.find(Ee=>Ee.id===H.srcId||Ee.descripcion===H.nombre);if(!se)return;const N=se.apu||{},G=H.inicio||t.fechaInicio||qt(),ue=(()=>{const Ee=new Date(G);return Ee.setDate(Ee.getDate()+(H.duracion||1)-1),Ee.toISOString().split("T")[0]})(),he=t.ofertaEquipos||[];(N.equiposUsados||[]).forEach(Ee=>{const je=W.find(_=>_.id===Ee.eqId);if(!je)return;const te=(Ee.rendimientoOverride??je.rendimiento)*(se.cantidad||1),ce=he.find(_=>_.nombre===je.nombre);((ce==null?void 0:ce.herrAsignadas)||_a[je.id]||[]).forEach(_=>{const ae=Lo(_);if(!ae)return;const Be=_;M[Be]||(M[Be]={codigo:_,nombre:ae.nombre,familia:ae.familia,unidad:ae.unidad||"ud",cantTotal:0,precioRef:ae.precioRef||0,actividades:[]}),M[Be].cantTotal=Math.max(M[Be].cantTotal,1),M[Be].actividades.push({nombre:H.nombre,inicio:G,fin:ue,cant:1})}),je.cargos.forEach(_=>{var be;const ae=T.find(Te=>Te.id===_.catId);if(!ae)return;const Be=te*(_.cantidad||1),Q=lo(_.catId,R);X[_.catId]||(X[_.catId]={label:ae.label,catId:_.catId,horas:0,costo:0,actividades:[],personas:0}),X[_.catId].horas+=Be,X[_.catId].costo+=Be*Q,X[_.catId].actividades.push({nombre:H.nombre,equipo:je.nombre,inicio:G,fin:ue,horas:Be,cant:_.cantidad,dias:H.duracion||0});const me=(be=ce==null?void 0:ce.cargos)==null?void 0:be.find(Te=>Te.cargoId===_.catId);ie(_.catId,me).forEach(Te=>{const $e=Lo(Te);if($e){ne[Te]||(ne[Te]={codigo:Te,nombre:$e.nombre,familia:$e.familia,unidad:$e.unidad,precioRef:$e.precioRef||0,personas:new Set,actividades:[],cantTotal:0});for(let Ye=0;Ye<(_.cantidad||1);Ye++)ne[Te].personas.add(`${_.catId}_${H.id}_${Ye}`);ne[Te].actividades.push({nombre:H.nombre,inicio:G,fin:ue,cant:_.cantidad||1})}})})}),(N.mo||[]).forEach(Ee=>{const je=T.find(ce=>ce.id===Ee.catId);if(!je)return;const V=lo(Ee.catId,R);X[Ee.catId]||(X[Ee.catId]={label:je.label,catId:Ee.catId,horas:0,costo:0,actividades:[],personas:0}),X[Ee.catId].horas+=Ee.horas||0,X[Ee.catId].costo+=(Ee.horas||0)*V,X[Ee.catId].actividades.push({nombre:H.nombre,equipo:"MO directa",inicio:G,fin:ue,horas:Ee.horas||0,cant:1,dias:H.duracion||0}),(pn[Ee.catId]||[]).forEach(ce=>{const pe=Lo(ce);pe&&(ne[ce]||(ne[ce]={codigo:ce,nombre:pe.nombre,familia:pe.familia,unidad:pe.unidad,precioRef:pe.precioRef||0,personas:new Set,actividades:[],cantTotal:0}),ne[ce].personas.add(`${Ee.catId}_${H.id}_mo`),ne[ce].actividades.push({nombre:H.nombre,inicio:G,fin:ue,cant:1}))})}),(N.equipos||[]).forEach(Ee=>{const je=Ee.descripcion||Ee.nombre||"Equipo";O[je]||(O[je]={codigo:"",nombre:je,familia:"equipo_obra",unidad:Ee.unidad||"ud",cantTotal:0,precioRef:Ee.precio||0,actividades:[]}),O[je].cantTotal=Math.max(O[je].cantTotal,Ee.cantidad||1),O[je].actividades.push({nombre:H.nombre,inicio:G,fin:ue,cant:Ee.cantidad||1})})}),Object.values(X).forEach(H=>{const se={};H.actividades.forEach(N=>{const G=new Date(N.inicio);for(let ue=0;ue<N.dias;ue++){const he=new Date(G.getTime()+ue*864e5).toISOString().split("T")[0];se[he]=(se[he]||0)+(N.cant||1)}}),H.personas=Math.max(1,...Object.values(se)),H.inicioMasTemprano=H.actividades.reduce((N,G)=>G.inicio<N?G.inicio:N,"9999"),H.finMasTardio=H.actividades.reduce((N,G)=>G.fin>N?G.fin:N,"0000")}),Object.values(ne).forEach(H=>{H.cantTotal=H.personas.size,H.inicioNecesario=H.actividades.reduce((se,N)=>N.inicio<se?N.inicio:se,"9999"),H.costoTotal=H.cantTotal*(H.precioRef||0)}),Object.values(M).forEach(H=>{H.inicioNecesario=H.actividades.reduce((se,N)=>N.inicio<se?N.inicio:se,"9999")}),Object.values(O).forEach(H=>{H.inicioNecesario=H.actividades.reduce((se,N)=>N.inicio<se?N.inicio:se,"9999")}),{personal:Object.values(X).sort((H,se)=>se.horas-H.horas),herramientas:Object.values(M).sort((H,se)=>H.inicioNecesario.localeCompare(se.inicioNecesario)),equiposObra:Object.values(O).sort((H,se)=>H.inicioNecesario.localeCompare(se.inicioNecesario)),epps:Object.values(ne).sort((H,se)=>se.cantTotal-H.cantTotal)}},J=L=>L&&L!=="9999"?new Date(L).toLocaleDateString("es-CO",{day:"numeric",month:"short",year:"numeric"}):"",ye=L=>{const R=window.open("","_blank"),{personal:T,herramientas:W,equiposObra:X,epps:M}=L,O=T.reduce((se,N)=>se+N.horas,0),ne=T.reduce((se,N)=>se+N.costo,0),ie=T.reduce((se,N)=>se+N.personas,0);t.pais;const re="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:10px;border-bottom:3px solid #111}.logo{font-size:16px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:12px;margin:14px 0 6px;padding:5px 0;border-bottom:2px solid #111}h3{font-size:10px;margin:8px 0 4px}.kpis{display:flex;gap:16px;margin-bottom:12px;font-size:9px;color:#555}.kpi strong{color:#111}table{width:100%;border-collapse:collapse;margin-bottom:10px}th{background:#F5F4F1;padding:3px 5px;font-size:7px;text-transform:uppercase;letter-spacing:.4px;font-weight:700;color:#888;text-align:left;border-bottom:2px solid #E0E0E0}td{padding:3px 5px;border-bottom:1px solid #F5F5F5;font-size:8px}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.blue{color:#3B3B3B}.bold{font-weight:700}.totrow td{font-weight:700;border-top:2px solid #111}.badge{background:#F0F0F0;color:#3B3B3B;padding:2px 8px;border-radius:3px;font-weight:700;font-size:10px}.footer{margin-top:12px;padding-top:6px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}@media print{body{padding:8px}}";let H=`<html><head><title>Plan de Recursos - ${t.codigoOferta||""}</title><style>${re}</style></head><body>`;H+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',H+='<div style="text-align:right"><div style="font-size:14px;font-weight:700">Plan de Recursos y Contratacin</div>',H+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,H+=`<div class="kpis"><div class="kpi">Total personas: <strong class="badge">${ie}</strong></div>`,H+=`<div class="kpi">Horas MO: <strong class="mono">${O.toFixed(0)} h</strong></div>`,H+=`<div class="kpi">Costo MO: <strong class="mono green">${r(ne)}</strong></div>`,H+=`<div class="kpi">EPPs: <strong>${M.length} tems</strong></div>`,H+=`<div class="kpi">Herramientas: <strong>${W.length+X.length} tems</strong></div></div>`,H+="<h2> 1. Personal  Contratacin</h2>",H+="<table><tr><th>Categora</th><th>Personas</th><th>Horas</th><th>Costo</th><th>Ingreso estimado</th><th>Hasta</th><th>Actividades</th></tr>",T.forEach(se=>{H+=`<tr><td class="bold">${se.label}</td><td class="badge mono">${se.personas}</td>`,H+=`<td class="mono">${se.horas.toFixed(0)}h</td><td class="mono green">${r(se.costo)}</td>`,H+=`<td class="mono">${J(se.inicioMasTemprano)}</td><td class="mono">${J(se.finMasTardio)}</td>`,H+=`<td>${se.actividades.map(N=>N.nombre).filter((N,G,ue)=>ue.indexOf(N)===G).join(", ")}</td></tr>`}),H+=`<tr class="totrow"><td>TOTAL</td><td class="badge mono">${ie}</td><td class="mono">${O.toFixed(0)}h</td><td class="mono green">${r(ne)}</td><td colspan="3"></td></tr></table>`,H+="<h2> 2. Elementos de Proteccin Personal (EPP)</h2>",H+="<table><tr><th>Cdigo</th><th>Elemento</th><th>Cant.</th><th>Precio ref.</th><th>Subtotal</th><th>Necesario desde</th></tr>",M.forEach(se=>{H+=`<tr><td class="mono bold">${se.codigo||""}</td><td>${se.nombre}</td><td class="mono">${se.cantTotal}</td><td class="mono">${r(se.precioRef||0)}</td><td class="mono green bold">${r(se.costoTotal||0)}</td><td class="mono">${J(se.inicioNecesario)}</td></tr>`}),H+=`<tr class="totrow"><td colspan="2">TOTAL EPPs</td><td class="mono">${M.reduce((se,N)=>se+N.cantTotal,0)}</td><td></td><td class="mono green bold">${r(M.reduce((se,N)=>se+(N.costoTotal||0),0))}</td><td></td></tr></table>`,H+="<h2> 3. Herramientas y Equipos</h2>",H+="<table><tr><th>Cdigo</th><th>Recurso</th><th>Tipo</th><th>Cant.</th><th>Precio ref.</th><th>Necesario desde</th><th>Actividades</th></tr>",[...W,...X].forEach(se=>{H+=`<tr><td class="mono bold">${se.codigo||""}</td><td>${se.nombre}</td><td>${Hn[se.familia]||""}</td><td class="mono">${se.cantTotal}</td>`,H+=`<td class="mono">${r(se.precioRef||0)}</td><td class="mono">${J(se.inicioNecesario)}</td>`,H+=`<td>${se.actividades.map(N=>N.nombre).filter((N,G,ue)=>ue.indexOf(N)===G).join(", ")}</td></tr>`}),H+="</table>",H+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Plan de recursos</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,H+="</body></html>",R.document.write(H),R.document.close(),setTimeout(()=>R.print(),400)},oe={border:`1px solid ${k.border}`,borderRadius:3,padding:"3px 5px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:k.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Cronograma valorado"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[a.length," actividades  ",r(U)," CD  ",r($)," venta"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[e.jsxs(ht,{sm:!0,v:"sec",on:h,children:[e.jsx(vn,{size:11})," Importar borrador"]}),e.jsxs(ht,{sm:!0,v:"sec",on:j,children:[e.jsx(Ne,{size:11})," Captulo"]}),e.jsxs(ht,{sm:!0,on:b,children:[e.jsx(Ne,{size:11})," Actividad"]}),e.jsx("button",{onClick:()=>I(!w),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${w?k.accent:k.border}`,borderRadius:4,background:w?"#E6F4EC":"#fff",color:w?"#111111":k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:w?" Valorado":" Valorado"}),e.jsxs("button",{onClick:Y,style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:"none",borderRadius:4,background:"#111",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Bt,{size:11})," Vista PDF"]}),e.jsxs("button",{onClick:()=>q(!0),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:"none",borderRadius:4,background:"#3B3B3B",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(ir,{size:11})," Recursos"]})]})]}),a.length===0?e.jsxs(rt,{style:{padding:40,textAlign:"center"},children:[e.jsx(La,{size:32,style:{color:k.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:k.inkLight,fontSize:13,margin:0},children:"Sin actividades. Importa desde el borrador o aade manualmente."})]}):e.jsx(rt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("div",{style:{display:"flex",minHeight:200},children:[e.jsx("div",{style:{width:`${z}%`,minWidth:400,flexShrink:0,borderRight:`2px solid ${k.border}`,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{width:30,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"#"}),e.jsx("th",{style:{width:34,padding:"6px 2px",fontSize:8,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"WBS"}),e.jsx("th",{style:{padding:"6px 8px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`,textAlign:"left",minWidth:160},children:"ACTIVIDAD"}),e.jsx("th",{style:{width:50,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"DAS"}),e.jsx("th",{style:{width:95,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"INICIO"}),e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"FIN"}),e.jsx("th",{style:{width:50,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"%"}),e.jsx("th",{style:{width:60,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"PRED"}),w&&e.jsxs(e.Fragment,{children:[e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"CD"}),e.jsx("th",{style:{width:80,padding:"6px 4px",fontSize:9,color:"#888",fontWeight:700,borderBottom:`2px solid ${k.border}`},children:"VENTA"})]}),e.jsx("th",{style:{width:64,padding:"6px 4px",borderBottom:`2px solid ${k.border}`}})]})}),e.jsx("tbody",{children:a.map((L,R)=>{const T=L.nivel||0,W=L.esCapitulo,X=W?c(R):null,M=W&&X?X.dur:L.duracion,O=W&&X?X.avance:L.avance||0;return e.jsxs("tr",{style:{background:W?"#F5F4F1":R%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${W?k.border:"#F5F5F5"}`,height:W?32:28},children:[e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",fontSize:9,color:"#BBB"},children:R+1}),e.jsx("td",{style:{padding:"2px 2px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:1,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>f(L.id),title:"Quitar sangra",style:{background:"none",border:"none",cursor:"pointer",color:T>0?"#888":"#DDD",padding:0,fontSize:10,lineHeight:1},children:""}),e.jsx("button",{onClick:()=>m(L.id),title:"Aadir sangra",style:{background:"none",border:"none",cursor:"pointer",color:T<3?"#888":"#DDD",padding:0,fontSize:10,lineHeight:1},children:""})]})}),e.jsx("td",{style:{padding:"2px 6px"},children:e.jsxs("div",{style:{paddingLeft:T*16,display:"flex",alignItems:"center",gap:4},children:[W&&e.jsx("span",{style:{background:"#111111",color:"#fff",padding:"0px 4px",borderRadius:2,fontSize:7,fontWeight:700,lineHeight:"14px"},children:""}),e.jsx("input",{value:L.nombre||"",onChange:ne=>v(L.id,"nombre",ne.target.value),style:{border:"none",background:"transparent",outline:"none",width:"100%",fontWeight:W?700:400,fontSize:W?11:10.5,color:k.ink,textTransform:W?"uppercase":"none",padding:"1px 0"}})]})}),e.jsx("td",{style:{padding:"2px 3px"},children:W?e.jsx("span",{style:{fontSize:10,color:k.inkMid,textAlign:"center",display:"block"},children:M}):e.jsx("input",{type:"number",value:L.duracion||"",min:1,onChange:ne=>v(L.id,"duracion",+ne.target.value),style:{...oe,width:40,textAlign:"center",padding:"2px 3px"}})}),e.jsx("td",{style:{padding:"2px 3px"},children:W?e.jsx("span",{style:{fontSize:9,color:k.inkMid},children:(X==null?void 0:X.start)||""}):e.jsx("input",{type:"date",value:L.inicio||"",onChange:ne=>v(L.id,"inicio",ne.target.value),style:{...oe,width:90,fontSize:10,padding:"2px 3px"}})}),e.jsx("td",{style:{padding:"2px 4px",fontSize:9,color:k.inkMid,textAlign:"center"},children:d(L)}),e.jsx("td",{style:{padding:"2px 3px",textAlign:"center"},children:e.jsxs("span",{style:{fontSize:9,fontWeight:O>0?600:400,color:O>=100?"#111111":O>0?"#3B3B3B":"#CCC"},children:[O,"%"]})}),e.jsx("td",{style:{padding:"2px 3px"},children:!W&&e.jsx("input",{value:L.pred||"",placeholder:"",onChange:ne=>v(L.id,"pred",ne.target.value),title:"Predecesor: n de fila (ej: 3, 5)",style:{...oe,width:36,textAlign:"center",fontSize:9,padding:"2px 2px"}})}),w&&e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{padding:"2px 4px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:W?700:400,color:k.inkMid},children:W?r((X==null?void 0:X.cd)||0):L.precioCD>0?r(L.precioCD):""}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:W?700:400,color:W?"#111111":"#3B3B3B"},children:W?r((X==null?void 0:X.venta)||0):L.totalVenta>0?r(L.totalVenta):""})]}),e.jsxs("td",{style:{padding:"2px 2px",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>p(L.id,-1),style:{background:"none",border:"none",cursor:"pointer",color:"#CCC",padding:1,fontSize:9},children:""}),e.jsx("button",{onClick:()=>p(L.id,1),style:{background:"none",border:"none",cursor:"pointer",color:"#CCC",padding:1,fontSize:9},children:""}),e.jsx("button",{onClick:()=>C(L.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx(Je,{size:10})})]})]},L.id)})}),w&&e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:"#E6F4EC",borderTop:"2px solid #111111"},children:[e.jsx("td",{colSpan:8,style:{padding:"6px 8px",fontSize:10,fontWeight:700,color:"#111111"},children:"TOTAL PROYECTO"}),e.jsx("td",{style:{padding:"6px 4px",textAlign:"right",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace",color:"#111111"},children:r(U)}),e.jsx("td",{style:{padding:"6px 4px",textAlign:"right",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace",color:"#111111"},children:r($)}),e.jsx("td",{})]})})]})}),e.jsxs("div",{style:{flex:1,overflowX:"auto",overflowY:"hidden",background:"#FFFFFF"},children:[e.jsx("div",{style:{display:"flex",borderBottom:`2px solid ${k.border}`,background:"#EDEBE7",height:28,position:"sticky",top:0},children:E.map((L,R)=>e.jsx("div",{style:{width:7*S,minWidth:7*S,flexShrink:0,fontSize:8,color:"#888",textAlign:"center",borderRight:"1px solid #E0E0E0",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},children:L.toLocaleDateString("es",{month:"short",day:"numeric"})},R))}),a.map((L,R)=>{const T=L.esCapitulo,W=T?c(R):null,X=T&&W?W.start:L.inicio,M=T&&W?W.dur:Math.max(1,L.duracion||1),O=T&&W?W.avance:L.avance||0,ne=A(X),ie=O/100,re=ne*S,H=Math.max(M*S,4),se=T?32:28,N=T?8:18,G=(se-N)/2,ue=L.pred?parseInt(L.pred)-1:-1,he=ue>=0&&ue<a.length?a[ue]:null;return e.jsxs("div",{style:{position:"relative",height:se,borderBottom:`1px solid ${T?"#E0E0E0":"#F5F5F5"}`},children:[R===0&&(()=>{const we=A(qt())*S;return we>0?e.jsx("div",{style:{position:"absolute",left:we,top:0,bottom:0,width:1,background:"#E44",zIndex:2,opacity:.5}}):null})(),e.jsx("div",{style:{position:"absolute",left:re,top:G,width:H,height:N,background:T?"#999":L.color||"#2A5F8C",borderRadius:T?"2px 2px 0 0":3,opacity:.2}}),e.jsx("div",{style:{position:"absolute",left:re,top:G,width:H*ie,height:N,background:T?"#555":L.color||"#2A5F8C",borderRadius:T?"2px 2px 0 0":3}}),T&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",left:re-3,top:G+N-2,width:6,height:6,background:"#555",transform:"rotate(45deg)"}}),e.jsx("div",{style:{position:"absolute",left:re+H-3,top:G+N-2,width:6,height:6,background:"#555",transform:"rotate(45deg)"}})]}),!T&&H>30&&e.jsx("span",{style:{position:"absolute",left:re+4,top:G+1,fontSize:8,color:"#fff",fontWeight:600,lineHeight:N+"px",textShadow:"0 1px 2px rgba(0,0,0,0.5)",pointerEvents:"none",maxWidth:H-8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:O>0?`${O}%`:""}),he&&(()=>{const we=(A(he.inicio)+Math.max(1,he.duracion||1))*S;return we<re?e.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:se,pointerEvents:"none",overflow:"visible"},children:[e.jsx("line",{x1:we,y1:se/2,x2:re,y2:se/2,stroke:"#E44",strokeWidth:1,strokeDasharray:"3,2",markerEnd:"url(#arrow)"}),e.jsx("defs",{children:e.jsx("marker",{id:"arrow",markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto",children:e.jsx("path",{d:"M0,0 L6,2 L0,4",fill:"#E44"})})})]}):null})(),!T&&e.jsx("input",{type:"range",min:0,max:100,value:O,onChange:we=>v(L.id,"avance",+we.target.value),title:`Avance: ${O}%`,style:{position:"absolute",left:re,top:G,width:H,height:N,opacity:0,cursor:"pointer"}})]},L.id)})]})]})}),P&&(()=>{const L=ge(),{personal:R,herramientas:T,equiposObra:W,epps:X}=L,M=R.reduce((N,G)=>N+G.horas,0),O=R.reduce((N,G)=>N+G.costo,0),ne=R.reduce((N,G)=>N+G.personas,0);t.pais;const ie=R.length>0||T.length>0||W.length>0,re=()=>{let N=`\uFEFFSeccin;Cdigo;Recurso;Familia;Cantidad;Horas;Costo;Precio ref.;Necesario desde;Hasta;Actividades
`;R.forEach(he=>{N+=`Personal;;${he.label};;${he.personas};${he.horas.toFixed(0)};${he.costo.toFixed(0)};;${he.inicioMasTemprano||""};${he.finMasTardio||""};${he.actividades.map(we=>we.nombre).filter((we,Ve,Ee)=>Ee.indexOf(we)===Ve).join(" | ")}
`}),X.forEach(he=>{N+=`EPP;${he.codigo||""};${he.nombre};${Hn[he.familia]||""};${he.cantTotal};;${he.costoTotal||0};${he.precioRef||0};${he.inicioNecesario||""};;${he.actividades.map(we=>we.nombre).filter((we,Ve,Ee)=>Ee.indexOf(we)===Ve).join(" | ")}
`}),[...T,...W].forEach(he=>{N+=`Herramienta;${he.codigo||""};${he.nombre};${Hn[he.familia]||""};${he.cantTotal};;;${he.precioRef||0};${he.inicioNecesario||""};;${he.actividades.map(we=>we.nombre).filter((we,Ve,Ee)=>Ee.indexOf(we)===Ve).join(" | ")}
`});const G=new Blob([N],{type:"text/csv;charset=utf-8"}),ue=document.createElement("a");ue.href=URL.createObjectURL(G),ue.download=`Recursos_${t.codigoOferta||"proyecto"}.csv`,ue.click()},H={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"2px solid #E0E0E0",textAlign:"left"},se={...H,textAlign:"right"};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.55)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:16},onClick:()=>q(!1),children:e.jsxs("div",{onClick:N=>N.stopPropagation(),style:{background:"#fff",borderRadius:10,width:"95%",maxWidth:1050,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,.25)"},children:[e.jsxs("div",{style:{padding:"14px 22px",borderBottom:"2px solid #111",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:16,fontWeight:700,margin:0},children:" Plan de Recursos y Contratacin"}),e.jsxs("p",{style:{fontSize:10,color:"#888",margin:"2px 0 0"},children:["Desde APUs + cronograma  ",t.codigoOferta||"","  ",t.cliente||""]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("button",{onClick:re,style:{padding:"5px 12px",background:"#fff",border:"1px solid #E0E0E0",borderRadius:4,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(vn,{size:11})," CSV"]}),e.jsxs("button",{onClick:()=>ye(L),style:{padding:"5px 12px",background:"#111",color:"#fff",border:"none",borderRadius:4,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Bt,{size:11})," PDF"]}),e.jsx("button",{onClick:()=>q(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#888"},children:e.jsx(Ot,{size:18})})]})]}),e.jsxs("div",{style:{padding:"8px 22px",background:"#F5F4F1",borderBottom:"1px solid #E0E0E0",display:"flex",gap:18,flexWrap:"wrap",flexShrink:0,fontSize:10,color:"#555"},children:[e.jsxs("span",{children:[" Personas: ",e.jsx("strong",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 8px",borderRadius:3,fontFamily:"'DM Mono',monospace"},children:ne})]}),e.jsxs("span",{children:[" Horas MO: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:[M.toFixed(0),"h"]})]}),e.jsxs("span",{children:[" Costo MO: ",e.jsx("strong",{style:{fontFamily:"'DM Mono',monospace",color:"#111111"},children:r(O)})]}),e.jsxs("span",{children:[" EPPs: ",e.jsxs("strong",{children:[X.length," tems"]})]}),e.jsxs("span",{children:[" Herr./Equipos: ",e.jsx("strong",{children:T.length+W.length})]})]}),e.jsx("div",{style:{overflowY:"auto",flex:1,padding:"0 22px 22px"},children:ie?e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 1. Personal  Contratacin y fechas de ingreso"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:H,children:"Categora"}),e.jsx("th",{style:se,children:"Personas"}),e.jsx("th",{style:se,children:"Horas"}),e.jsx("th",{style:se,children:"Costo"}),e.jsx("th",{style:H,children:"Ingreso estimado"}),e.jsx("th",{style:H,children:"Hasta"}),e.jsx("th",{style:H,children:"Actividades"})]})}),e.jsxs("tbody",{children:[R.map(N=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"7px 8px",fontWeight:600},children:N.label}),e.jsx("td",{style:{padding:"7px 8px",textAlign:"right"},children:e.jsx("span",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 10px",borderRadius:4,fontWeight:700,fontFamily:"'DM Mono',monospace",fontSize:13},children:N.personas})}),e.jsxs("td",{style:{padding:"7px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[N.horas.toFixed(0),"h"]}),e.jsx("td",{style:{padding:"7px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",color:"#111111",fontWeight:600},children:r(N.costo)}),e.jsx("td",{style:{padding:"7px 8px"},children:e.jsxs("span",{style:{background:"#E8F4EE",color:"#111111",padding:"2px 8px",borderRadius:3,fontWeight:600,fontSize:10},children:[" ",J(N.inicioMasTemprano)]})}),e.jsx("td",{style:{padding:"7px 8px",fontSize:10,color:"#888"},children:J(N.finMasTardio)}),e.jsx("td",{style:{padding:"7px 8px",fontSize:9,color:"#888",maxWidth:180},children:N.actividades.map(G=>G.nombre).filter((G,ue,he)=>he.indexOf(G)===ue).join(", ")})]},N.catId)),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsx("td",{style:{padding:"8px",fontWeight:700,fontSize:12},children:"TOTAL"}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:e.jsx("span",{style:{background:"#111",color:"#fff",padding:"3px 12px",borderRadius:4,fontWeight:700,fontFamily:"'DM Mono',monospace",fontSize:14},children:ne})}),e.jsxs("td",{style:{padding:"8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:[M.toFixed(0),"h"]}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111",fontSize:13},children:r(O)}),e.jsx("td",{colSpan:3})]})]})]}),X.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6,justifyContent:"space-between"},children:[e.jsx("span",{children:" 2. Elementos de Proteccin Personal (EPP)"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:11,color:"#111111",fontWeight:600},children:["Est. ",r(X.reduce((N,G)=>N+(G.costoTotal||0),0))]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:H,children:"Cdigo"}),e.jsx("th",{style:H,children:"Elemento"}),e.jsx("th",{style:se,children:"Cant."}),e.jsx("th",{style:se,children:"Precio ref."}),e.jsx("th",{style:se,children:"Subtotal"}),e.jsx("th",{style:H,children:"Necesario desde"})]})}),e.jsxs("tbody",{children:[X.map((N,G)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#FFF8E7",color:"#8C6A00",padding:"1px 6px",borderRadius:3},children:N.codigo||""})}),e.jsxs("td",{style:{padding:"6px 8px",fontWeight:600},children:[us[N.familia]||""," ",N.nombre]}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:N.cantTotal}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"},children:r(N.precioRef||0)}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:r(N.costoTotal||0)}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsxs("span",{style:{background:"#FFF8E7",color:"#8C6A00",padding:"2px 8px",borderRadius:3,fontSize:10,fontWeight:600},children:[" ",J(N.inicioNecesario)]})})]},G)),e.jsxs("tr",{style:{borderTop:"2px solid #111"},children:[e.jsx("td",{colSpan:2,style:{padding:"6px 8px",fontWeight:700},children:"TOTAL EPPs"}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:X.reduce((N,G)=>N+G.cantTotal,0)}),e.jsx("td",{}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111"},children:r(X.reduce((N,G)=>N+(G.costoTotal||0),0))}),e.jsx("td",{})]})]})]})]}),(T.length>0||W.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 3. Herramientas y Equipos de Obra"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:16},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:H,children:"Cdigo"}),e.jsx("th",{style:H,children:"Recurso"}),e.jsx("th",{style:H,children:"Tipo"}),e.jsx("th",{style:se,children:"Cant."}),e.jsx("th",{style:se,children:"Precio ref."}),e.jsx("th",{style:H,children:"Necesario desde"}),e.jsx("th",{style:H,children:"Actividades"})]})}),e.jsx("tbody",{children:[...T,...W].map((N,G)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"6px 8px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#F0F0F0",color:"#3B3B3B",padding:"1px 6px",borderRadius:3},children:N.codigo||""})}),e.jsxs("td",{style:{padding:"6px 8px",fontWeight:600},children:[us[N.familia]||""," ",N.nombre]}),e.jsx("td",{style:{padding:"6px 8px",fontSize:9,color:"#888"},children:Hn[N.familia]||N.familia}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:N.cantTotal}),e.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"},children:r(N.precioRef||0)}),e.jsx("td",{style:{padding:"6px 8px"},children:e.jsxs("span",{style:{background:"#F0F0F0",color:"#3B3B3B",padding:"2px 8px",borderRadius:3,fontSize:10,fontWeight:600},children:[" ",J(N.inicioNecesario)]})}),e.jsx("td",{style:{padding:"6px 8px",fontSize:9,color:"#888"},children:N.actividades.map(ue=>ue.nombre).filter((ue,he,we)=>we.indexOf(ue)===he).join(", ")})]},G))})]})]}),e.jsx("h3",{style:{fontSize:13,fontWeight:700,margin:"16px 0 8px",padding:"8px 0 6px",borderBottom:"2px solid #111",display:"flex",alignItems:"center",gap:6},children:" 4. Detalle de personal por actividad"}),R.map(N=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("h4",{style:{fontSize:11,fontWeight:700,margin:"8px 0 4px",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:N.label}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",color:"#111111",fontWeight:600,fontSize:10},children:[N.personas," pers.  ",N.horas.toFixed(0),"h  ",r(N.costo)]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:10},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#FFFFFF"},children:["Actividad","Equipo","Pers.","Horas","Inicio","Fin","Das"].map(G=>e.jsx("th",{style:{padding:"3px 6px",fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:"1px solid #E0E0E0",textAlign:G==="Actividad"||G==="Equipo"||G==="Inicio"||G==="Fin"?"left":"right"},children:G},G))})}),e.jsx("tbody",{children:N.actividades.map((G,ue)=>e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"4px 6px"},children:G.nombre}),e.jsx("td",{style:{padding:"4px 6px",color:"#888"},children:G.equipo}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:G.cant}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:G.horas.toFixed(1)}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9},children:J(G.inicio)}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9},children:J(G.fin)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:G.dias})]},ue))})]})]},N.catId))]}):e.jsxs("div",{style:{textAlign:"center",padding:"50px 0",color:"#888"},children:[e.jsx(ir,{size:32,style:{opacity:.3,marginBottom:10}}),e.jsx("p",{style:{fontSize:13,fontWeight:600},children:"No se encontraron recursos en los APUs."}),e.jsx("p",{style:{fontSize:11,marginTop:8,lineHeight:1.6,maxWidth:400,margin:"8px auto 0"},children:"Para generar el plan necesitas: partidas con APU en el borrador (con cuadrillas/MO asignada)  importar actividades al cronograma."})]})})]})})})()]})}const _r=[{id:"personal_dir",label:" Personal de direccin y administracin",items:[{desc:"Director de proyecto",unidad:"mes",cant:0,valorUnit:0},{desc:"Residente de obra / Coordinador",unidad:"mes",cant:0,valorUnit:0},{desc:"Profesional HSE / SISO",unidad:"mes",cant:0,valorUnit:0},{desc:"Coordinador administrativo",unidad:"mes",cant:0,valorUnit:0},{desc:"Almacenista",unidad:"mes",cant:0,valorUnit:0}]},{id:"seguridad",label:" Seguridad y salud en el trabajo",items:[{desc:"Ambulancia / servicio mdico",unidad:"mes",cant:0,valorUnit:0},{desc:"Sealizacin y demarcacin",unidad:"gl",cant:0,valorUnit:0},{desc:"Botiqun y elementos de emergencia",unidad:"gl",cant:0,valorUnit:0},{desc:"Capacitaciones SST",unidad:"gl",cant:0,valorUnit:0},{desc:"Exmenes mdicos ocupacionales",unidad:"gl",cant:0,valorUnit:0}]},{id:"instalaciones",label:" Instalaciones provisionales",items:[{desc:"Campamento / oficina temporal",unidad:"mes",cant:0,valorUnit:0},{desc:"Baos porttiles",unidad:"mes",cant:0,valorUnit:0},{desc:"Cerramiento provisional",unidad:"ml",cant:0,valorUnit:0},{desc:"Acometidas temporales (agua, luz)",unidad:"gl",cant:0,valorUnit:0}]},{id:"servicios",label:" Servicios y seguros",items:[{desc:"Pliza todo riesgo construccin",unidad:"gl",cant:0,valorUnit:0},{desc:"Pliza responsabilidad civil",unidad:"gl",cant:0,valorUnit:0},{desc:"Servicios pblicos obra",unidad:"mes",cant:0,valorUnit:0},{desc:"Transporte y logstica",unidad:"mes",cant:0,valorUnit:0},{desc:"Comunicaciones",unidad:"mes",cant:0,valorUnit:0}]},{id:"otros",label:" Otros gastos generales",items:[{desc:"Papelera y consumibles oficina",unidad:"mes",cant:0,valorUnit:0},{desc:"Ensayos y laboratorio",unidad:"gl",cant:0,valorUnit:0},{desc:"Imprevistos",unidad:"gl",cant:0,valorUnit:0}]}];function Nh({d:t,set:i,r:o}){const n=t.pais||"CO",s=n==="CO"?"COP":"EUR",r=z=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(z||0),a=t.ggMeses||6,u=(()=>{const z=(t.cronogramaActivos||[]).filter(q=>!q.esCapitulo&&q.duracion>0);if(z.length===0)return 0;const B=t.fechaInicio?new Date(t.fechaInicio):new Date;let P=B.getTime();return z.forEach(q=>{const U=new Date(q.inicio||B).getTime()+(q.duracion||1)*864e5;U>P&&(P=U)}),Math.max(1,Math.ceil((P-B.getTime())/(30*864e5)))})(),h=a,[b,j]=F.useState(()=>{var B;if(((B=t.ggItems)==null?void 0:B.length)>0)return t.ggItems;const z=[];return _r.forEach(P=>{P.items.forEach(q=>{z.push({id:zt(),categoria:P.id,desc:q.desc,unidad:q.unidad,cant:q.cant,valorUnit:q.valorUnit})})}),z});F.useEffect(()=>{i("ggItems",b)},[b]);const C=(z,B,P)=>j(q=>q.map(U=>U.id===z?{...U,[B]:P}:U)),v=z=>j(B=>B.filter(P=>P.id!==z)),m=z=>j(B=>[...B,{id:zt(),categoria:z,desc:"",unidad:"mes",cant:0,valorUnit:0}]),f=z=>(z.cant||0)*(z.valorUnit||0),p=b.reduce((z,B)=>z+f(B),0),c=o.COSTO||0,d=c>0?p/c:0,l=(t.borradorLineas||[]).filter(z=>!z.esCapitulo).length||1,x=()=>{j(z=>z.map(B=>B.unidad==="mes"?{...B,cant:a}:B))},y=z=>{u<=0||(i("ggMeses",u+(z?1:0)),z&&i("ggMesCierre",!0))},g=u>0&&u!==a&&u+1!==a,S=t.ggCriterio||"costo";F.useEffect(()=>{t.modoCalcObra==="aiu"&&i("aiuA",Math.round(d*1e4)/1e4),i("ggPct",Math.round(d*1e4)/1e4)},[p,c]);const A=()=>{const z=[],B=b.filter(L=>L.categoria==="personal_dir"&&L.desc.trim().length>0),P={director:"#111111",residente:"#2A5F8C",hse:"#8C2A2A",siso:"#8C2A2A",coordinador:"#6B5B8C",almacen:"#5B8DB8",admin:"#6B5B8C"},q={director:"",residente:"",hse:"",siso:"",coordinador:"",almacen:"",admin:""},U=L=>{const R=L.toLowerCase();for(const[T,W]of Object.entries(P))if(R.includes(T))return T;return null},$=B.find(L=>L.desc.toLowerCase().includes("director")),Y=zt();$?z.push({id:Y,parentId:null,nombre:"",cargo:$.desc,color:"#111111",icon:""}):z.push({id:Y,parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""}),B.filter(L=>L!==$).forEach(L=>{const R=U(L.desc);z.push({id:zt(),parentId:Y,nombre:"",cargo:L.desc,color:R?P[R]:"#555",icon:R?q[R]:""})});const ge=z.find(L=>L.cargo.toLowerCase().includes("residente"))||z.find(L=>L.parentId===Y)||z[0];(t.entregablesOferta||[]).filter(L=>L.incluir).reduce((L,R)=>L+(R.horas||0),0),typeof Bi<"u"&&Bi.find(L=>L.id===t.servicioId);const ye=t.ofertaEquipos||[],oe=new Set;ye.forEach(L=>{(L.cargos||[]).forEach(R=>{var X;const T=(((X=Eo[n])==null?void 0:X.categorias)||[]).find(M=>M.id===R.cargoId),W=(T==null?void 0:T.label)||R.cargoId;!oe.has(W)&&!z.find(M=>M.cargo.toLowerCase()===W.toLowerCase())&&(oe.add(W),z.push({id:zt(),parentId:(ge==null?void 0:ge.id)||Y,nombre:"",cargo:W,color:"#5B8DB8",icon:""}))})}),i("orgNodos",z)},E=()=>{const z=window.open("","_blank"),B="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:12px;margin:10px 0 4px;padding:6px 0 4px;border-bottom:2px solid #111}.kpis{display:flex;gap:14px;margin-bottom:10px;font-size:9px;color:#555}.kpi strong{color:#111}.kpi .badge{background:#111111;color:#fff;padding:1px 8px;border-radius:3px;font-weight:700;font-family:'DM Mono',monospace}table{width:100%;border-collapse:collapse;margin-bottom:8px}th{background:#F5F4F1;padding:3px 6px;font-size:7px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:left;border-bottom:1px solid #E0E0E0}td{padding:3px 6px;font-size:8px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.bold{font-weight:700}.r{text-align:right}.cat{background:#E8E6E1;font-weight:700;font-size:7px;text-transform:uppercase;letter-spacing:.4px;padding:4px 6px}.totrow td{border-top:2px solid #111;font-weight:700}.footer{margin-top:10px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}";let P=`<html><head><title>Gastos Generales - ${t.codigoOferta||""}</title><style>${B}</style></head><body>`;P+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',P+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Gastos Generales de Obra</div>',P+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,P+=`<div class="kpis"><div class="kpi">Costo directo: <strong class="mono">${r(c)}</strong></div>`,P+=`<div class="kpi">Total GG: <strong class="mono green">${r(p)}</strong></div>`,P+=`<div class="kpi">% GG: <span class="badge">${(d*100).toFixed(2)}%</span></div>`,P+=`<div class="kpi">Duracin: <strong>${h} meses</strong></div></div>`,_r.forEach(q=>{const U=b.filter(Y=>Y.categoria===q.id&&f(Y)>0);if(U.length===0)return;const $=U.reduce((Y,ge)=>Y+f(ge),0);P+=`<h2>${q.label}  ${r($)}</h2>`,P+='<table><tr><th>Descripcin</th><th>Unidad</th><th class="r">Cant.</th><th class="r">Valor unit.</th><th class="r">Subtotal</th></tr>',U.forEach(Y=>{P+=`<tr><td>${Y.desc}</td><td>${Y.unidad}</td><td class="mono r">${Y.cant}</td>`,P+=`<td class="mono r">${r(Y.valorUnit)}</td><td class="mono r bold green">${r(f(Y))}</td></tr>`}),P+="</table>"}),P+='<table style="margin-top:12px"><tr class="totrow"><td colspan="4" class="bold">TOTAL GASTOS GENERALES</td>',P+=`<td class="mono r bold green" style="font-size:11px">${r(p)} ${s}</td></tr>`,P+=`<tr><td colspan="4">Incidencia sobre costo directo</td><td class="mono r bold" style="font-size:11px">${(d*100).toFixed(2)}%</td></tr></table>`,P+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Gastos generales</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,P+="</body></html>",z.document.write(P),z.document.close(),setTimeout(()=>z.print(),400)},w=()=>{let z=`\uFEFFCategora;Descripcin;Unidad;Cantidad;Valor unitario;Subtotal
`;_r.forEach(q=>{b.filter(U=>U.categoria===q.id).forEach(U=>{z+=`${q.label};${U.desc};${U.unidad};${U.cant};${U.valorUnit};${f(U)}
`})}),z+=`;;;;;;TOTAL;${p}
;;;;;;% GG;${(d*100).toFixed(2)}%
`;const B=new Blob([z],{type:"text/csv;charset=utf-8"}),P=document.createElement("a");P.href=URL.createObjectURL(B),P.download=`GG_${t.codigoOferta||"proyecto"}.csv`,P.click()},I={border:`1px solid ${k.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:k.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Gastos generales de obra"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Costos indirectos distribuibles"})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[e.jsxs("button",{onClick:x,style:{padding:"6px 12px",border:`1px solid ${k.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:k.inkMid},children:[" Auto ",a," meses"]}),e.jsx("button",{onClick:A,style:{padding:"6px 12px",border:`1px solid ${k.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:k.inkMid},children:"  Organigrama"}),e.jsx("button",{onClick:w,style:{padding:"6px 12px",border:`1px solid ${k.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:k.inkMid},children:" CSV"}),e.jsxs("button",{onClick:E,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Bt,{size:11})," Vista PDF"]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:16},children:[[["Costo directo",r(c),k.ink],["Total GG",r(p),"#111111"],["% GG / CD",(d*100).toFixed(2)+"%","#3B3B3B"],["GG por actividad",r(l>0?p/l:0),"#8C6A00"]].map(([z,B,P])=>e.jsxs(rt,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:z}),e.jsx("div",{style:{fontSize:18,fontWeight:800,color:P,fontFamily:"'DM Mono',monospace",marginTop:2},children:B})]},z)),e.jsxs(rt,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5},children:"Duracin GG"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,marginTop:2},children:[e.jsx("input",{type:"number",min:1,max:120,value:a,onChange:z=>i("ggMeses",Math.max(1,parseInt(z.target.value)||1)),style:{width:50,fontSize:18,fontWeight:800,color:k.ink,fontFamily:"'DM Mono',monospace",textAlign:"center",border:"none",borderBottom:`2px solid ${k.border}`,background:"transparent",outline:"none"}}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#888"},children:"meses"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,marginTop:5,fontSize:8,color:k.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:!!t.ggMesCierre,onChange:z=>{const B=z.target.checked;i("ggMesCierre",B),i("ggMeses",B?a+1:Math.max(1,a-1))},style:{width:12,height:12,accentColor:"#111111"}}),"+1 mes cierre admin."]}),g&&e.jsxs("div",{style:{marginTop:6,background:"#FFF8E6",border:"1px solid #E6D44D55",borderRadius:4,padding:"5px 8px"},children:[e.jsxs("div",{style:{fontSize:8,color:"#8C6A00",fontWeight:600,marginBottom:3},children:[" Cronograma da ",u," meses, tienes ",a]}),e.jsxs("div",{style:{display:"flex",gap:3},children:[e.jsxs("button",{onClick:()=>y(!1),style:{flex:1,padding:"3px 4px",fontSize:7,fontWeight:700,cursor:"pointer",border:"1px solid #3B3B3B44",borderRadius:3,background:"#F0F0F0",color:"#3B3B3B",fontFamily:"'DM Sans',sans-serif"},children:["Usar ",u,"m"]}),e.jsxs("button",{onClick:()=>y(!0),style:{flex:1,padding:"3px 4px",fontSize:7,fontWeight:700,cursor:"pointer",border:"1px solid #11111144",borderRadius:3,background:"#E8F4EE",color:"#111111",fontFamily:"'DM Sans',sans-serif"},children:[u,"m + 1 cierre"]})]})]}),u>0&&!g&&e.jsx("div",{style:{fontSize:7,color:"#111111",marginTop:4},children:" Sincronizado con cronograma"})]})]}),e.jsx(rt,{style:{padding:"12px 16px",marginBottom:14},children:e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"flex-start",flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:"0 0 260px"},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Criterio de distribucin"}),e.jsx("div",{style:{display:"flex",gap:0},children:[{id:"costo",lbl:" Prop. al CD",desc:"Segn costo directo de cada actividad"},{id:"duracion",lbl:" Prop. duracin",desc:"Segn das de duracin"},{id:"mo",lbl:" Prop. a M.O.",desc:"Segn mano de obra"}].map((z,B)=>e.jsx("button",{onClick:()=>i("ggCriterio",z.id),style:{flex:1,padding:"5px 4px",fontSize:9,cursor:"pointer",fontWeight:600,border:`1px solid ${k.border}`,fontFamily:"'DM Sans',sans-serif",borderRadius:B===0?"4px 0 0 4px":B===2?"0 4px 4px 0":"0",borderLeft:B>0?"none":void 0,background:S===z.id?"#F0F0F0":"#fff",color:S===z.id?"#3B3B3B":k.inkMid},children:z.lbl},z.id))}),e.jsx("div",{style:{fontSize:9,color:"#888",marginTop:4},children:S==="costo"?"Cada actividad recibe GG proporcional a su costo directo":S==="duracion"?"Cada actividad recibe GG proporcional a su duracin en das":"Cada actividad recibe GG proporcional a su componente de mano de obra"})]}),e.jsxs("div",{style:{flex:1,background:"#F0F0F0",borderRadius:4,padding:"8px 12px"},children:[e.jsxs("div",{style:{fontSize:11,color:"#3B3B3B"},children:[" Estos gastos se ",e.jsx("strong",{children:"distribuyen en cada actividad"})," como coeficiente indirecto.",t.modoCalcObra==="aiu"?` En AIU  entra como A (Administracin) = ${(d*100).toFixed(2)}%. Se multiplica: CD  (1 + ${(d*100).toFixed(1)}% + I + U).`:` En modo margen  GG = ${(d*100).toFixed(2)}% entra en el denominador: PVP = CD / (1  M  GC  GG)  (1  GF).`]}),e.jsx("div",{style:{fontSize:10,color:"#3B3B3B",marginTop:4,fontWeight:600},children:"No visible en presupuesto de venta salvo que se solicite la estructura de costos."})]})]})}),_r.map(z=>{const B=b.filter(q=>q.categoria===z.id),P=B.reduce((q,U)=>q+f(U),0);return e.jsxs(rt,{style:{padding:0,marginBottom:12,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"8px 14px",background:"#F5F4F1",borderBottom:`1px solid ${k.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,color:k.ink},children:z.label}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:P>0?"#111111":"#CCC"},children:[r(P)," ",s]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"left",width:"40%"},children:"Descripcin"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"center",width:70},children:"Unidad"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"center",width:80},children:"Cant."}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"right",width:120},children:"Valor unit."}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",textAlign:"right",width:120},children:"Subtotal"}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:B.map(q=>e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`},children:[e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{value:q.desc,onChange:U=>C(q.id,"desc",U.target.value),style:{...I,width:"100%"},placeholder:"Descripcin del gasto"})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:e.jsx("select",{value:q.unidad,onChange:U=>C(q.id,"unidad",U.target.value),style:{...I,textAlign:"center"},children:["mes","gl","ud","ml","m","jgo","da"].map(U=>e.jsx("option",{children:U},U))})}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{type:"number",min:"0",step:"0.1",value:q.cant||0,onChange:U=>C(q.id,"cant",parseFloat(U.target.value)||0),style:{...I,width:"100%",textAlign:"center",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{type:"number",min:"0",value:q.valorUnit||0,onChange:U=>C(q.id,"valorUnit",parseFloat(U.target.value)||0),style:{...I,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:f(q)>0?"#111111":"#CCC"},children:r(f(q))}),e.jsx("td",{style:{padding:"4px 4px"},children:e.jsx("button",{onClick:()=>v(q.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx(Je,{size:10})})})]},q.id))})]}),e.jsx("div",{style:{padding:"4px 8px"},children:e.jsx("button",{onClick:()=>m(z.id),style:{width:"100%",padding:"4px 8px",fontSize:10,cursor:"pointer",border:`1px dashed ${k.border}`,borderRadius:3,background:"#fff",color:k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir tem"})})]},z.id)}),e.jsx(rt,{style:{padding:"14px 18px",background:"#E8F4EE",border:"1px solid #B8DEC9"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#111111",textTransform:"uppercase",letterSpacing:.5},children:"Total gastos generales"}),e.jsxs("div",{style:{fontSize:10,color:"#111111",marginTop:2},children:["Incidencia: ",e.jsxs("strong",{children:[(d*100).toFixed(2),"%"]})," sobre costo directo ",t.modoCalcObra==="aiu"?` AIU  A = ${(d*100).toFixed(2)}%`:` Coeficiente GG = ${(d*100).toFixed(2)}%`]})]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:22,fontWeight:800,color:"#111111"},children:[r(p)," ",e.jsx("span",{style:{fontSize:11,fontWeight:600},children:s})]})]})}),(()=>{const z=(t.borradorLineas||[]).filter($=>!$.esCapitulo&&($.precioCD||0)>0);if(z.length===0||p===0)return null;const B=z.reduce(($,Y)=>$+(Y.precioCD||0),0),P=z.reduce(($,Y)=>$+(Y.duracion||Y.cantidad||1),0),q=z.reduce(($,Y)=>{const ge=Y.apuData;if(!ge)return $;const J=(ge.equiposUsados||[]).reduce((ye,oe)=>ye+(oe.cuadrilla||[]).reduce((L,R)=>L+(R.cant||0)*(R.jornal||0)*(R.rendimiento||1),0),0)+(ge.moDirecta||[]).reduce((ye,oe)=>ye+(oe.cant||0)*(oe.jornal||0)*(oe.rendimiento||1),0);return $+J},0),U=$=>{if(S==="duracion")return P>0?($.duracion||$.cantidad||1)/P:0;if(S==="mo"){const Y=$.apuData;if(!Y||q===0)return B>0?($.precioCD||0)/B:0;const ge=(Y.equiposUsados||[]).reduce((J,ye)=>J+(ye.cuadrilla||[]).reduce((oe,L)=>oe+(L.cant||0)*(L.jornal||0)*(L.rendimiento||1),0),0)+(Y.moDirecta||[]).reduce((J,ye)=>J+(ye.cant||0)*(ye.jornal||0)*(ye.rendimiento||1),0);return q>0?ge/q:0}return B>0?($.precioCD||0)/B:0};return e.jsxs(rt,{style:{padding:0,marginTop:12,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"8px 14px",background:"#F5F4F1",borderBottom:`1px solid ${k.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:700},children:[" Distribucin por actividad",e.jsxs("span",{style:{fontSize:9,fontWeight:400,color:"#888",marginLeft:8},children:["Criterio: ",S==="costo"?"proporcional al CD":S==="duracion"?"proporcional a duracin":"proporcional a M.O."]})]}),e.jsxs("div",{style:{fontSize:10,color:"#888"},children:[z.length," actividades"]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#FFFFFF"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left"},children:"Actividad"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"CD"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"Peso %"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"GG asignado"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"CD + GG"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right"},children:"Incid. GG"})]})}),e.jsxs("tbody",{children:[z.slice(0,20).map(($,Y)=>{const ge=U($),J=p*ge,ye=($.precioCD||0)+J;return e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`},children:[e.jsx("td",{style:{padding:"3px 8px",fontSize:10,maxWidth:250,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:$.descripcion||$.partida||"Lnea "+(Y+1)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:r($.precioCD||0)}),e.jsxs("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",color:"#3B3B3B"},children:[(ge*100).toFixed(1),"%"]}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#111111"},children:r(J)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:r(ye)}),e.jsx("td",{style:{padding:"3px 8px",fontSize:10,textAlign:"right"},children:e.jsx("div",{style:{background:"#F0F0F0",borderRadius:10,height:6,overflow:"hidden"},children:e.jsx("div",{style:{background:"#3B3B3B",height:"100%",width:`${Math.min(ge*100*3,100)}%`,borderRadius:10}})})})]},$.id||Y)}),z.length>20&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,style:{padding:"4px 8px",fontSize:9,color:"#888",textAlign:"center"},children:["... y ",z.length-20," actividades ms"]})})]})]})})]})})()]})}function Uh({d:t,set:i,r:o}){var O,ne,ie,re,H,se;const n=t.pais||"CO",s=n==="CO"?"COP":"EUR",r=N=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(N||0),a=t.modoCobro||"avance_anticipo",u=t.fuenteAvance||"cronograma",h=t.fluPctAnticipo??.3,b=t.fluMesPrimerCobro??1,j=t.condDiasPago||30,C=t.condDiasCobro||30,m=(()=>{const N=(t.cronogramaActivos||[]).filter(G=>!G.esCapitulo&&G.duracion>0);if(N.length>0){const G=t.fechaInicio?new Date(t.fechaInicio):new Date;let ue=G.getTime();return N.forEach(he=>{const Ve=new Date(he.inicio||G).getTime()+(he.duracion||1)*864e5;Ve>ue&&(ue=Ve)}),Math.max(1,Math.ceil((ue-G.getTime())/(30*864e5)))}if(t.fechaInicio&&t.fechaEntrega){const G=new Date(t.fechaEntrega)-new Date(t.fechaInicio);return Math.max(1,Math.ceil(G/(30*864e5)))}return t.ggMeses||6})(),f=Math.ceil(C/30),p=Math.ceil(j/30),c=(()=>{if(a==="hitos"){const N=Math.max(0,...(t.flujoCobros||[]).map(G=>G.mes||0));return Math.max(12,N+f+2)}return Math.max(12,m+Math.max(f,p)+2)})(),[d,l]=F.useState(()=>t.flujoCobros||[{id:zt(),nombre:"Anticipo / Firma",pct:.3,mes:0},{id:zt(),nombre:"Avance 50%",pct:.3,mes:2},{id:zt(),nombre:"Entrega final",pct:.3,mes:4},{id:zt(),nombre:"Retencin final",pct:.1,mes:5}]);F.useEffect(()=>{i("flujoCobros",d)},[d]);const x=(N,G,ue)=>l(he=>he.map(we=>we.id===N?{...we,[G]:ue}:we)),y=()=>l(N=>[...N,{id:zt(),nombre:"Nuevo hito",pct:0,mes:0}]),g=N=>l(G=>G.filter(ue=>ue.id!==N)),S=d.reduce((N,G)=>N+(G.pct||0),0),[A,E]=F.useState(()=>t.fluAvanceManual||Array.from({length:12},()=>0));F.useEffect(()=>{i("fluAvanceManual",A)},[A]);const w=(N,G)=>E(ue=>ue.map((he,we)=>we===N?G:he)),I=A.reduce((N,G)=>N+G,0),B=u==="manual"?A:(()=>{const N=(t.cronogramaActivos||[]).filter(we=>!we.esCapitulo&&(we.precioVenta||we.precioCD)>0),G=N.reduce((we,Ve)=>we+(Ve.precioVenta||Ve.precioCD||0),0);if(G===0)return Array.from({length:c},()=>0);const ue=t.fechaInicio?new Date(t.fechaInicio):new Date,he=Array.from({length:c},()=>0);return N.forEach(we=>{const Ve=new Date(we.inicio||ue),Ee=Math.max(0,Math.round((Ve-ue)/(30*864e5))),je=Math.max(1,Math.ceil((we.duracion||30)/30)),V=(we.precioVenta||we.precioCD||0)/G;for(let te=Ee;te<Ee+je&&te<c;te++)he[te]+=V/je}),he})(),P=o.PVP||0,q=o.IVA||0,U=P+q,$=o.COSTO||0,Y=o.ret||0,ge=n==="CO"?{reteFuente:{pct:t.pctReteFuente||0},reteICA:{pct:t.pctReteICA||0},reteIVA:{pct:t.pctReteIVA||0},iva:{pct:t.tarifaIVA||.19}}:{iva:{pct:t.tarifaIVA||.21}},J=n==="CO"?(((O=ge.reteFuente)==null?void 0:O.pct)||0)+(((ne=ge.reteICA)==null?void 0:ne.pct)||0)+(((ie=ge.reteIVA)==null?void 0:ie.pct)||0):0,ye=(t.cronogramaActivos||[]).filter(N=>!N.esCapitulo&&N.precioCD>0),oe=N=>{if(ye.length>0){const G=t.fechaInicio?new Date(t.fechaInicio):new Date;let ue=0;return ye.forEach(he=>{const we=new Date(he.inicio||G),Ve=Math.max(0,Math.round((we-G)/(30*864e5))),Ee=Math.max(1,Math.ceil((he.duracion||30)/30));N>=Ve&&N<Ve+Ee&&(ue+=(he.precioCD||0)/Ee)}),ue}return N>=0&&N<m?$/Math.max(1,m):0},L=Array.from({length:c},(N,G)=>G);let R=0;const T=L.map(N=>{var te,ce;let G=0,ue=0,he=0;if(a==="hitos")G=d.filter(pe=>pe.mes===N).reduce((pe,_)=>pe+(_.pct||0)*P,0);else{const pe=a==="avance_anticipo";if(pe&&N===0)ue=h*P,G=ue;else if(N>=b){const _=B[N-b]||0,ae=_*P;pe?(he=_*h*P,G=ae-he):G=ae}}const we=G>0?t.tipoProyecto==="OBRA"?(o.U||t.margen||0)*G*(((te=ge.iva)==null?void 0:te.pct)||0):G*(((ce=ge.iva)==null?void 0:ce.pct)||0):0,Ve=G>0&&n==="CO"?G*J:0,Ee=G+we-Ve,je=oe(N),V=Ee-je;return R+=V,{m:N,cobro:G,anticipoM:ue,amortM:he,ivaM:we,retM:Ve,ingNeto:Ee,cos:je,neto:V,acum:R,avPct:a!=="hitos"&&N>=b&&B[N-b]||0}}),W=()=>{const N=window.open("","_blank"),G=T.reduce((V,te)=>V+te.cobro,0),ue=T.reduce((V,te)=>V+te.ivaM,0),he=T.reduce((V,te)=>V+te.retM,0),we=T.reduce((V,te)=>V+te.cos,0),Ve=T.length>0?T[T.length-1].acum:0,Ee="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:10mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:8px;padding:16px}.header{display:flex;justify-content:space-between;margin-bottom:10px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}h2{font-size:11px;margin:10px 0 4px}.kpis{display:flex;gap:14px;margin-bottom:8px;font-size:8px;color:#555}.kpi strong{color:#111}table{width:100%;border-collapse:collapse}th{background:#F5F4F1;padding:2px 4px;font-size:6px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:right;border-bottom:1px solid #E0E0E0}th:first-child{text-align:left}td{padding:2px 4px;font-size:7px;text-align:right;border-bottom:1px solid #F5F5F5}td:first-child{text-align:left;font-weight:600;background:#FFFFFF}td.section{background:#E8E6E1;font-weight:700;font-size:6px;text-transform:uppercase;letter-spacing:.4px;text-align:left;padding:3px 4px}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.red{color:#B91C1C}.bold{font-weight:700}.footer{margin-top:8px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:6px;color:#888}";let je=`<html><head><title>Flujo de caja - ${t.codigoOferta||""}</title><style>${Ee}</style></head><body>`;je+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',je+='<div style="text-align:right"><div style="font-size:12px;font-weight:700">Flujo de Caja Proyectado</div>',je+=`<div style="font-size:7px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div></div></div>`,je+=`<div class="kpis"><div class="kpi">PVP: <strong class="mono">${r(P)}</strong></div>`,je+=`<div class="kpi">Costo: <strong class="mono">${r($)}</strong></div>`,je+=`<div class="kpi">Duracin: <strong>${m} meses</strong></div>`,je+=`<div class="kpi">Modo: <strong>${a==="hitos"?"Hitos":a==="avance"?"Avance s/anticipo":"Avance c/anticipo"}</strong></div>`,je+=`${a!=="hitos"?`<div class="kpi">Anticipo: <strong>${(h*100).toFixed(0)}%</strong></div>`:""}</div>`,je+="<table><thead><tr><th>Concepto</th>",T.forEach(V=>{je+=`<th>${V.m===0?"M0":V.m+""}</th>`}),je+='<th style="background:#E6F4EC;color:#111111">Total</th></tr></thead><tbody>',a!=="hitos"&&(je+=`<tr><td class="section" colspan="${T.length+2}">AVANCE</td></tr>`,je+="<tr><td>% Avance</td>",T.forEach(V=>{je+=`<td class="mono">${V.avPct>0?(V.avPct*100).toFixed(1)+"%":""}</td>`}),je+=`<td class="mono bold">${(T.reduce((V,te)=>V+te.avPct,0)*100).toFixed(1)}%</td></tr>`),je+=`<tr><td class="section" colspan="${T.length+2}">COBROS</td></tr>`,je+="<tr><td>Cobros</td>",T.forEach(V=>{je+=`<td class="mono ${V.cobro>0?"green":""}">${V.cobro?r(V.cobro):""}</td>`}),je+=`<td class="mono green bold">${r(G)}</td></tr>`,a==="avance_anticipo"&&(je+="<tr><td> Anticipo</td>",T.forEach(V=>{je+=`<td class="mono">${V.anticipoM?r(V.anticipoM):""}</td>`}),je+=`<td class="mono">${r(T.reduce((V,te)=>V+te.anticipoM,0))}</td></tr>`,je+="<tr><td> Amortizacin</td>",T.forEach(V=>{je+=`<td class="mono">${V.amortM?r(V.amortM):""}</td>`}),je+=`<td class="mono">${r(T.reduce((V,te)=>V+te.amortM,0))}</td></tr>`),je+=`<tr><td class="section" colspan="${T.length+2}">IVA</td></tr>`,je+="<tr><td>IVA facturado</td>",T.forEach(V=>{je+=`<td class="mono">${V.ivaM?r(V.ivaM):""}</td>`}),je+=`<td class="mono">${r(ue)}</td></tr>`,n==="CO"&&(je+=`<tr><td class="section" colspan="${T.length+2}">RETENCIONES</td></tr>`,je+="<tr><td>Total retenciones</td>",T.forEach(V=>{je+=`<td class="mono red">${V.retM?r(V.retM):""}</td>`}),je+=`<td class="mono red bold">${r(he)}</td></tr>`),je+=`<tr><td class="section" colspan="${T.length+2}">COSTOS</td></tr>`,je+="<tr><td>Costos directos</td>",T.forEach(V=>{je+=`<td class="mono red">${V.cos?r(V.cos):""}</td>`}),je+=`<td class="mono red bold">${r(we)}</td></tr>`,je+=`<tr><td class="section" colspan="${T.length+2}">RESULTADO</td></tr>`,je+='<tr style="background:#F0F7FF"><td style="background:#F0F7FF" class="bold">Caja mensual</td>',T.forEach(V=>{je+=`<td class="mono bold ${V.neto>=0?"green":"red"}">${r(V.neto)}</td>`}),je+="<td></td></tr>",je+='<tr style="background:#E6F4EC"><td style="background:#E6F4EC" class="bold">Caja acumulada</td>',T.forEach(V=>{je+=`<td class="mono bold ${V.acum>=0?"green":"red"}">${r(V.acum)}</td>`}),je+=`<td class="mono bold ${Ve>=0?"green":"red"}">${r(Ve)}</td></tr>`,je+="</tbody></table>",je+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Flujo de caja</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,je+="</body></html>",N.document.write(je),N.document.close(),setTimeout(()=>N.print(),400)},X={border:`1px solid ${k.border}`,borderRadius:4,padding:"5px 8px",fontSize:12,fontFamily:"'DM Sans',sans-serif",background:k.bg},M=[{id:"hitos",lbl:"Hitos de pago",desc:"Pagos en fechas especficas"},{id:"avance",lbl:"Avance s/ anticipo",desc:"Certificacin mensual por avance"},{id:"avance_anticipo",lbl:"Avance c/ anticipo",desc:"Anticipo + certificacin - amortizacin"}];return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:k.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Flujo de caja proyectado"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[m," meses  ",r(P)," PVP  ",r($)," costo"]})]}),e.jsxs("button",{onClick:W,style:{padding:"7px 16px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:6},children:[e.jsx(Bt,{size:12})," Vista PDF"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[e.jsxs(rt,{style:{padding:18},children:[e.jsx(Mt,{t:"Configuracin de cobros",s:"Selecciona modalidad de facturacin"}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:M.map((N,G)=>e.jsx("button",{onClick:()=>i("modoCobro",N.id),style:{flex:1,padding:"8px 6px",fontSize:10,cursor:"pointer",fontWeight:600,border:`1px solid ${k.ink}`,fontFamily:"'DM Sans',sans-serif",borderRadius:G===0?"5px 0 0 5px":G===2?"0 5px 5px 0":"0",borderLeft:G>0?"none":void 0,background:a===N.id?k.ink:"#fff",color:a===N.id?"#fff":k.inkMid},children:N.lbl},N.id))}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:12},children:[e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Duracin"}),e.jsxs("div",{style:{fontSize:15,fontWeight:700},children:[m," meses"]}),e.jsxs("div",{style:{fontSize:8,color:"#888"},children:[" ",(t.cronogramaActivos||[]).length>0?"cronograma":"estimado"]})]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Primer mes cobro"}),e.jsx("input",{type:"number",value:b,min:0,max:12,onChange:N=>i("fluMesPrimerCobro",+N.target.value),style:{...X,width:"100%",fontSize:14,fontWeight:700,textAlign:"center",padding:"2px 6px"}})]}),a==="avance_anticipo"&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#8C6A00",textTransform:"uppercase"},children:"% Anticipo"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"number",value:(h*100).toFixed(0),min:0,max:100,onChange:N=>i("fluPctAnticipo",+N.target.value/100),style:{...X,width:50,fontSize:14,fontWeight:700,textAlign:"center",padding:"2px 6px"}}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#8C6A00"},children:"%"})]}),e.jsxs("div",{style:{fontSize:8,color:"#8C6A00"},children:[r(h*P)," ",s]})]}),a==="hitos"&&e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Meses mostrados"}),e.jsx("div",{style:{fontSize:15,fontWeight:700},children:c})]})]}),a==="hitos"&&e.jsxs(e.Fragment,{children:[d.map(N=>e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:6},children:[e.jsx("input",{style:{...X,flex:2,minWidth:0},value:N.nombre,onChange:G=>x(N.id,"nombre",G.target.value),placeholder:"Descripcin"}),e.jsxs("div",{style:{position:"relative",flex:"0 0 60px"},children:[e.jsx("input",{type:"number",style:{...X,width:"100%",paddingRight:16},value:(N.pct*100).toFixed(0),min:0,max:100,onChange:G=>x(N.id,"pct",+G.target.value/100)}),e.jsx("span",{style:{position:"absolute",right:6,top:"50%",transform:"translateY(-50%)",fontSize:10,color:k.inkLight},children:"%"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flex:"0 0 65px"},children:[e.jsx("span",{style:{fontSize:10,color:k.inkLight},children:"Mes"}),e.jsx("input",{type:"number",style:{...X,width:36},value:N.mes,min:0,onChange:G=>x(N.id,"mes",+G.target.value)})]}),e.jsx("button",{onClick:()=>g(N.id),style:{background:"none",border:"none",cursor:"pointer",color:k.danger,padding:4},children:e.jsx(Je,{size:12})})]},N.id)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:6},children:[e.jsxs(ht,{sm:!0,v:"ghost",on:y,children:[e.jsx(Ne,{size:11})," Aadir hito"]}),e.jsxs("span",{style:{fontSize:11,color:Math.abs(S-1)<.001?k.success:k.warning},children:["Total: ",(S*100).toFixed(0),"% ",Math.abs(S-1)>=.001?"":""]})]})]}),a!=="hitos"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",gap:0,marginBottom:10},children:[{id:"cronograma",lbl:" Desde cronograma"},{id:"manual",lbl:" Manual"}].map((N,G)=>e.jsx("button",{onClick:()=>i("fuenteAvance",N.id),style:{flex:1,padding:"6px 10px",fontSize:10,cursor:"pointer",fontWeight:600,border:`1px solid ${k.border}`,fontFamily:"'DM Sans',sans-serif",borderRadius:G===0?"4px 0 0 4px":"0 4px 4px 0",borderLeft:G>0?"none":void 0,background:u===N.id?"#F0F0F0":"#fff",color:u===N.id?"#3B3B3B":k.inkMid},children:N.lbl},N.id))}),u==="cronograma"?e.jsxs("div",{style:{background:"#E6F4EC",borderRadius:4,padding:"8px 10px",fontSize:11,color:"#111111"},children:[" Avance calculado desde ",e.jsxs("strong",{children:[(t.cronogramaActivos||[]).filter(N=>!N.esCapitulo).length," actividades"]})," del cronograma. El % de avance mensual se distribuye proporcionalmente al valor de cada actividad."]}):e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,color:k.inkLight,marginBottom:6},children:"Ingresa % de avance por mes (debe sumar 100%). Mes 1 = primer mes de ejecucin."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:4},children:Array.from({length:Math.max(m,6)},(N,G)=>G).map(N=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:8,color:"#888",fontWeight:700},children:["Mes ",N+1]}),e.jsx("input",{type:"number",min:0,max:100,value:((A[N]||0)*100).toFixed(0),onChange:G=>w(N,+G.target.value/100),style:{...X,width:"100%",textAlign:"center",fontSize:12,fontWeight:600,padding:"3px 2px"}})]},N))}),e.jsxs("div",{style:{textAlign:"right",fontSize:11,marginTop:4,color:Math.abs(I-1)<.01?k.success:k.warning},children:["Total: ",(I*100).toFixed(0),"% ",Math.abs(I-1)>=.01?"":""]})]}),a==="avance_anticipo"&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:4,padding:"8px 10px",fontSize:10,color:"#8C6A00",marginTop:8},children:[e.jsx("strong",{children:"Anticipo amortizable:"})," Mes 0  prefactura ",(h*100).toFixed(0),"% (",r(h*P),"). Desde mes ",b,"  certificacin por avance  amortizacin proporcional del anticipo."]}),a==="avance"&&e.jsxs("div",{style:{background:"#F0F0F0",borderRadius:4,padding:"8px 10px",fontSize:10,color:"#3B3B3B",marginTop:8},children:[e.jsx("strong",{children:"Sin anticipo:"})," Desde mes ",b,"  certificacin directa por % de avance ejecutado."]})]})]}),e.jsxs(rt,{style:{padding:18},children:[e.jsx(Mt,{t:"Resumen proyectado",s:"Flujo neto con IVA y retenciones"}),[["PVP sin IVA",r(P),k.ink],["+ IVA facturado",r(q),k.info],["PVP con IVA",r(U),k.ink],...n==="CO"?[[" ReteFuente",r(P*(((re=ge.reteFuente)==null?void 0:re.pct)||0)),k.warning],[" ReteICA",r(P*(((H=ge.reteICA)==null?void 0:H.pct)||0)),k.warning],[" ReteIVA",r(P*(((se=ge.reteIVA)==null?void 0:se.pct)||0)),k.warning]]:[],["Total retenciones",r(Y),k.danger],["Costo total",r($),k.warning],["Neto a recibir",r(U-Y),k.success]].map(([N,G,ue])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:`1px solid ${k.border}`,fontSize:12},children:[e.jsx("span",{style:{color:k.inkMid},children:N}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600,color:ue},children:G})]},N))]})]}),e.jsxs(rt,{style:{padding:0,overflow:"auto"},children:[e.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${k.border}`},children:e.jsx(Mt,{t:"Proyeccin mes a mes",s:`${a==="hitos"?"Hitos":a==="avance"?"Avance":"Avance + anticipo"}  ${u==="manual"?"Manual":"Cronograma"}  ${c} meses`})}),e.jsx("div",{style:{overflowX:"auto"},children:(()=>{const N=T,G={padding:"5px 6px",fontSize:8,fontWeight:700,color:"#666",textTransform:"uppercase",letterSpacing:.3,borderBottom:"2px solid #CCC",textAlign:"right",whiteSpace:"nowrap"},ue={padding:"4px 8px",fontSize:10,fontWeight:600,color:"#333",whiteSpace:"nowrap",borderRight:"1px solid #E0E0E0",background:"#F5F4F1",position:"sticky",left:0,zIndex:1,minWidth:160},he=(pe,_)=>({padding:"4px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",textAlign:"right",color:pe===0||pe===void 0?"#CCC":_||"#333",whiteSpace:"nowrap"}),we=pe=>pe===0?"":new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(pe),Ve=(pe,_)=>e.jsxs("tr",{style:{background:_||"#E8E6E1"},children:[e.jsx("td",{style:{...ue,background:_||"#E8E6E1",fontWeight:700,fontSize:9,textTransform:"uppercase",letterSpacing:.5},children:pe}),N.map(ae=>e.jsx("td",{style:{padding:"3px",borderBottom:"1px solid #DDD"}},ae.m)),e.jsx("td",{style:{padding:"3px",borderBottom:"1px solid #DDD"}})]},pe),Ee=N.reduce((pe,_)=>pe+_.cobro,0),je=N.reduce((pe,_)=>pe+_.ivaM,0),V=N.reduce((pe,_)=>pe+_.retM,0),te=N.reduce((pe,_)=>pe+_.cos,0),ce=N.length>0?N[N.length-1].acum:0;return e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:N.length*72+170},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...G,textAlign:"left",position:"sticky",left:0,background:"#F5F4F1",zIndex:2,minWidth:160},children:"CONCEPTO"}),N.map(pe=>e.jsx("th",{style:G,children:pe.m===0?"MES 0":pe.m+""},pe.m)),e.jsx("th",{style:{...G,background:"#E8F4EE",color:"#111111"},children:"TOTAL"})]})}),e.jsxs("tbody",{children:[a!=="hitos"&&e.jsxs(e.Fragment,{children:[Ve("% AVANCE","#F0F0F0"),e.jsxs("tr",{children:[e.jsx("td",{style:ue,children:"% Avance ejecutado"}),N.map(pe=>e.jsx("td",{style:he(pe.avPct,"#3B3B3B"),children:pe.avPct>0?(pe.avPct*100).toFixed(1)+"%":""},pe.m)),e.jsx("td",{style:he(1,"#3B3B3B"),children:e.jsxs("strong",{children:[(N.reduce((pe,_)=>pe+_.avPct,0)*100).toFixed(1),"%"]})})]})]}),Ve("COBROS","#D4EDDA"),e.jsxs("tr",{children:[e.jsx("td",{style:ue,children:a==="hitos"?"Cobros hitos":"Cobro neto"}),N.map(pe=>e.jsx("td",{style:he(pe.cobro,"#111111"),children:we(pe.cobro)},pe.m)),e.jsx("td",{style:he(Ee,"#111111"),children:e.jsx("strong",{children:we(Ee)})})]}),a==="avance_anticipo"&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsxs("td",{style:ue,children:[" Anticipo (",(h*100).toFixed(0),"%)"]}),N.map(pe=>e.jsx("td",{style:he(pe.anticipoM,"#8C6A00"),children:we(pe.anticipoM)},pe.m)),e.jsx("td",{style:he(N.reduce((pe,_)=>pe+_.anticipoM,0),"#8C6A00"),children:e.jsx("strong",{children:we(N.reduce((pe,_)=>pe+_.anticipoM,0))})})]}),e.jsxs("tr",{children:[e.jsx("td",{style:ue,children:" Amortizacin anticipo"}),N.map(pe=>e.jsx("td",{style:he(pe.amortM,"#8C6A00"),children:we(pe.amortM)},pe.m)),e.jsx("td",{style:he(N.reduce((pe,_)=>pe+_.amortM,0),"#8C6A00"),children:e.jsx("strong",{children:we(N.reduce((pe,_)=>pe+_.amortM,0))})})]})]}),Ve("IMPUESTOS","#FFF3CD"),e.jsxs("tr",{children:[e.jsx("td",{style:ue,children:"IVA facturado"}),N.map(pe=>e.jsx("td",{style:he(pe.ivaM,"#8C6A00"),children:we(pe.ivaM)},pe.m)),e.jsx("td",{style:he(je,"#8C6A00"),children:e.jsx("strong",{children:we(je)})})]}),n==="CO"&&e.jsxs(e.Fragment,{children:[Ve("RETENCIONES","#FCE4EC"),e.jsxs("tr",{children:[e.jsx("td",{style:ue,children:"Total retenciones"}),N.map(pe=>e.jsx("td",{style:he(pe.retM,"#B91C1C"),children:we(pe.retM)},pe.m)),e.jsx("td",{style:he(V,"#B91C1C"),children:e.jsx("strong",{children:we(V)})})]})]}),Ve("COSTOS","#F8D7DA"),e.jsxs("tr",{children:[e.jsx("td",{style:ue,children:ye.length>0?"Costos (cronograma)":"Costos (distribucin lineal)"}),N.map(pe=>e.jsx("td",{style:he(pe.cos,"#B91C1C"),children:we(pe.cos)},pe.m)),e.jsx("td",{style:he(te,"#B91C1C"),children:e.jsx("strong",{children:we(te)})})]}),Ve("RESULTADO","#D6E9F8"),e.jsxs("tr",{style:{background:"#F0F7FF"},children:[e.jsx("td",{style:{...ue,background:"#F0F7FF",fontWeight:700},children:"Caja mensual"}),N.map(pe=>e.jsx("td",{style:{...he(pe.neto,pe.neto>=0?"#111111":"#B91C1C"),fontWeight:700},children:we(pe.neto)},pe.m)),e.jsx("td",{style:{...he(0),fontWeight:700}})]}),e.jsxs("tr",{style:{background:"#E6F4EC"},children:[e.jsx("td",{style:{...ue,background:"#E6F4EC",fontWeight:700},children:"Caja acumulada"}),N.map(pe=>e.jsx("td",{style:{...he(pe.acum,pe.acum>=0?"#111111":"#B91C1C"),fontWeight:700,fontSize:11},children:we(pe.acum)},pe.m)),e.jsx("td",{style:{...he(ce,ce>=0?"#111111":"#B91C1C"),fontWeight:700,fontSize:11},children:e.jsx("strong",{children:we(ce)})})]})]})]})})()})]})]})}function Vh({d:t,set:i}){var Be;const o=t.pais||"CO",n=o==="CO"?"COP":"EUR",s=Q=>Q?new Intl.NumberFormat(o==="CO"?"es-CO":"es-ES",{maximumFractionDigits:0}).format(Q):"0",[r,a]=F.useState([]),[u,h]=F.useState([]),[b,j]=F.useState([]),[C,v]=F.useState({hDia:8,diasSemana:5,semanasAnio:50,pctProductivas:75,diasFestivos:18,diasAusencias:5}),[m,f]=F.useState([]),[p,c]=F.useState(!1);F.useEffect(()=>{(async()=>{try{const[Q,me,le,be,Te]=await Promise.all([Fe.get("hab:rrhh:cargos"),Fe.get("hab:rrhh:activos"),Fe.get("hab:rrhh:licencias"),Fe.get("hab:rrhh:jornada"),Fe.get("hab:logistica:items")]);Q&&a(JSON.parse(Q.value)||[]),me&&h(JSON.parse(me.value)||[]),le&&j(JSON.parse(le.value)||[]),be&&v(JSON.parse(be.value)),Te&&f(JSON.parse(Te.value)||[])}catch{}c(!0)})()},[]);const d=F.useMemo(()=>{const Q=C;return(Q.diasSemana*Q.semanasAnio-(Q.diasFestivos||18)-(Q.diasAusencias||5))*Q.hDia*((Q.pctProductivas||75)/100)},[C]),l=Q=>{const me=r.find(Te=>Te.id===Q);if(!me||!me.salarioBruto)return 0;const le=1+((me.prestaciones||52.18)+(me.segSocial||12.5)+(me.parafiscales||9))/100,be=me.salarioBruto*le;return d>0?be/d:0},x=((Be=Eo[o])==null?void 0:Be.categorias)||[],y=r.filter(Q=>Q.activo!==!1).length===0,g=y?x.map(Q=>({id:Q.id,nombre:Q.label,_fallback:!0})):r.filter(Q=>Q.activo!==!1),S=Q=>y?lo(Q,o):l(Q),A=Q=>{const me=g.find(le=>le.id===Q);return(me==null?void 0:me.nombre)||(me==null?void 0:me.label)||Q},E=u.filter(Q=>Q.activo!==!1&&Q.valorCompra>0),w=b.filter(Q=>Q.activo!==!1&&Q.costoAnual>0),I=Q=>{const me=u.find(Te=>Te.id===Q);if(!me||!me.valorCompra)return 0;const le=me.valorCompra/(me.vidaUtilAnios||5),be=me.usoAnual||1760;return le/be},z=(t.entregablesOferta||[]).filter(Q=>Q.incluir),B=z.reduce((Q,me)=>Q+(me.horas||0),0),P=typeof Bi<"u"?Bi.find(Q=>Q.id===t.servicioId):null,q=t.ofertaEquipos||[],U=Q=>i("ofertaEquipos",typeof Q=="function"?Q(q):Q),[$,Y]=F.useState(null),ge=Q=>{var le;const me={id:zt(),nombre:Q?Q.nombre:"Nuevo equipo",cargos:((Q==null?void 0:Q.cargos)||[{cargoId:((le=g[0])==null?void 0:le.id)||"",cantidad:1}]).map(be=>({...be,id:zt()})),activosUsados:(Q==null?void 0:Q.activosUsados)||[],licenciasUsadas:(Q==null?void 0:Q.licenciasUsadas)||[],rendimiento:(Q==null?void 0:Q.rendimiento)||.1,notas:""};U([...q,me]),Y(me.id)},J=Q=>{U(q.filter(me=>me.id!==Q)),$===Q&&Y(null)},ye=(Q,me,le)=>U(q.map(be=>be.id===Q?{...be,[me]:le}:be)),oe=Q=>U(q.map(me=>{var le;return me.id===Q?{...me,cargos:[...me.cargos,{id:zt(),cargoId:((le=g[0])==null?void 0:le.id)||"",cantidad:1}]}:me})),L=(Q,me)=>U(q.map(le=>le.id===Q?{...le,cargos:le.cargos.filter(be=>be.id!==me)}:le)),R=(Q,me,le,be)=>U(q.map(Te=>Te.id===Q?{...Te,cargos:Te.cargos.map($e=>$e.id===me?{...$e,[le]:be}:$e)}:Te)),T=Q=>U(q.map(me=>me.id===Q?{...me,activosUsados:[...me.activosUsados||[],{id:zt(),activoId:"",cantidad:1}]}:me)),W=(Q,me)=>U(q.map(le=>le.id===Q?{...le,activosUsados:(le.activosUsados||[]).filter(be=>be.id!==me)}:le)),X=(Q,me,le,be)=>U(q.map(Te=>Te.id===Q?{...Te,activosUsados:(Te.activosUsados||[]).map($e=>$e.id===me?{...$e,[le]:be}:$e)}:Te)),M=Q=>U(q.map(me=>me.id===Q?{...me,licenciasUsadas:[...me.licenciasUsadas||[],{id:zt(),licId:"",cantidad:1}]}:me)),O=(Q,me)=>U(q.map(le=>le.id===Q?{...le,licenciasUsadas:(le.licenciasUsadas||[]).filter(be=>be.id!==me)}:le)),ne=(Q,me,le,be)=>U(q.map(Te=>Te.id===Q?{...Te,licenciasUsadas:(Te.licenciasUsadas||[]).map($e=>$e.id===me?{...$e,[le]:be}:$e)}:Te)),ie=Q=>U(q.map(me=>me.id===Q?{...me,logItemsUsados:[...me.logItemsUsados||[],{id:zt(),itemId:"",cantidad:1}]}:me)),re=(Q,me)=>U(q.map(le=>le.id===Q?{...le,logItemsUsados:(le.logItemsUsados||[]).filter(be=>be.id!==me)}:le)),H=(Q,me,le,be)=>U(q.map(Te=>Te.id===Q?{...Te,logItemsUsados:(Te.logItemsUsados||[]).map($e=>$e.id===me?{...$e,[le]:be}:$e)}:Te)),se=m.filter(Q=>Q.familia==="epp"||Q.familia==="dotacion"),N=m.filter(Q=>Q.familia==="herr_menor"||Q.familia==="herr_mayor"||Q.familia==="consumible"),G=m.filter(Q=>Q.familia==="equipo_obra"||Q.familia==="equipo_medic"||Q.familia==="equipo_computo"),ue=[...se,...N,...G],he={epp:"",dotacion:"",herr_menor:"",herr_mayor:"",equipo_obra:"",equipo_medic:"",equipo_computo:"",consumible:"",seguridad:"",transporte:""},we=Q=>{const me=m.find(Te=>Te.id===Q);if(!me||!me.precio)return 0;const be=(me.vidaUtil||12)*(d||1760)/12;return me.precio/be},Ve=Q=>{const me=Q.cargos.map(le=>le.cargoId);return m.filter(le=>(le.familia==="epp"||le.familia==="dotacion")&&le.asociadoACargo&&(le.cargosAsociados||[]).some(be=>me.includes(be)))},Ee=Q=>{const me=Q.cargos.reduce((Ct,ft)=>Ct+S(ft.cargoId)*(ft.cantidad||1),0),le=(Q.activosUsados||[]).reduce((Ct,ft)=>Ct+I(ft.activoId)*(ft.cantidad||1),0),be=(Q.licenciasUsadas||[]).reduce((Ct,ft)=>{const wi=b.find(di=>di.id===ft.licId);return wi?Ct+(wi.costoAnual||0)/(d||1760)*(ft.cantidad||1):Ct},0),Te=(Q.logItemsUsados||[]).reduce((Ct,ft)=>Ct+we(ft.itemId)*(ft.cantidad||1),0),Ye=Ve(Q).reduce((Ct,ft)=>Ct+we(ft.id),0),bt=Te+Ye;return{moH:me,eqH:le,licH:be,logH:bt,totalH:me+le+be+bt,totalMes:(me+le+be+bt)*((d||1760)/12)}},je={border:`1px solid ${k.border}`,borderRadius:3,padding:"4px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"};r.filter(Q=>Q.activo!==!1).length>0;const[V,te]=F.useState(!1),ce=async()=>{try{const[Q,me,le,be,Te]=await Promise.all([Fe.get("hab:rrhh:cargos"),Fe.get("hab:rrhh:activos"),Fe.get("hab:rrhh:licencias"),Fe.get("hab:rrhh:jornada"),Fe.get("hab:logistica:items")]);Q&&a(JSON.parse(Q.value)||[]),me&&h(JSON.parse(me.value)||[]),le&&j(JSON.parse(le.value)||[]),be&&v(JSON.parse(be.value)),Te&&f(JSON.parse(Te.value)||[])}catch{}},pe=async()=>{te(!0),await zh()&&await ce(),te(!1)},_=async()=>{if(!window.confirm("Eliminar datos de prueba de RRHH y Logstica?"))return;te(!0),await Eh()&&(a([]),h([]),j([]),f([])),te(!1)},ae=()=>{const Q=window.open("","_blank"),me="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:portrait;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:9px;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:6px;letter-spacing:2px;color:#888;text-transform:uppercase}.eq-card{border:1.5px solid #3B3B3B;border-radius:6px;margin-bottom:10px;overflow:hidden;page-break-inside:avoid}.eq-header{background:#F0F0F0;padding:6px 12px;border-bottom:1px solid #C4D8EE}.eq-name{font-size:12px;font-weight:700}.eq-sub{font-size:7px;color:#555;margin-top:1px}.eq-body{padding:8px 12px}.section-title{font-size:7px;font-weight:700;color:#888;text-transform:uppercase;letter-spacing:.5px;margin:6px 0 3px;padding-bottom:2px;border-bottom:1px solid #F5F5F5}table{width:100%;border-collapse:collapse}th{font-size:6px;font-weight:700;color:#888;text-transform:uppercase;text-align:left;padding:2px 4px;border-bottom:1px solid #E0E0E0}td{padding:2px 4px;font-size:8px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.bold{font-weight:700}.r{text-align:right}.blue{color:#3B3B3B}.green{color:#111111}.tag{font-size:7px;background:#FFF8E7;color:#8C6A00;padding:1px 5px;border-radius:3px;display:inline-block;margin:1px}.tag-blue{background:#F0F0F0;color:#3B3B3B}.cost-box{background:#F5F4F1;border-radius:4px;padding:6px 10px;margin-top:6px;font-size:9px}.cost-row{display:flex;justify-content:space-between;margin-bottom:2px}.cost-total{border-top:1px solid #DDD;padding-top:3px;margin-top:3px;font-weight:700}.footer{margin-top:14px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}";let le=`<html><head><title>Equipos - ${t.codigoOferta||""}</title><style>${me}</style></head><body>`;le+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',le+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Equipos de Trabajo</div>',le+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div>`,le+=`<div style="font-size:8px;color:#888;margin-top:2px">${q.length} equipos  ${g.length} cargos disponibles</div></div></div>`,q.forEach(be=>{const Te=Ee(be);le+=`<div class="eq-card"><div class="eq-header"><div class="eq-name">${be.nombre}</div>`,le+=`<div class="eq-sub">${be.cargos.length} cargos  Rendimiento: ${be.rendimiento} h/ud  Total: ${s(Te.totalH)} ${n}/h</div></div>`,le+='<div class="eq-body">',le+='<div class="section-title"> Mano de obra</div>',le+=`<table><tr><th>Cargo</th><th class="r">Cant</th><th class="r">${n}/h</th><th class="r">Subtotal/h</th></tr>`,be.cargos.forEach($e=>{const Ye=S($e.cargoId);le+=`<tr><td>${A($e.cargoId)}</td><td class="mono r">${$e.cantidad||1}</td>`,le+=`<td class="mono r">${s(Ye)}</td><td class="mono r bold">${s(Ye*($e.cantidad||1))}</td></tr>`;const bt=$e.recursosAsignados||pn[$e.cargoId]||[];bt.length>0&&(le+='<tr><td colspan="4" style="padding-left:16px">',bt.forEach(Ct=>{const ft=Lo(Ct);ft&&(le+=`<span class="tag">${Ct} ${ft.nombre}</span> `)}),le+="</td></tr>")}),le+="</table>",(be.herrAsignadas||[]).length>0&&(le+='<div class="section-title"> Herramientas y equipos</div><div>',(be.herrAsignadas||[]).forEach($e=>{const Ye=Lo($e);Ye&&(le+=`<span class="tag tag-blue">${$e} ${Ye.nombre}</span> `)}),le+="</div>"),le+='<div class="cost-box">',le+=`<div class="cost-row"><span>M.O. / hora</span><span class="mono bold">${s(Te.moH)}</span></div>`,Te.eqH>0&&(le+=`<div class="cost-row"><span>Equipos / hora</span><span class="mono">${s(Te.eqH)}</span></div>`),Te.licH>0&&(le+=`<div class="cost-row"><span>Licencias / hora</span><span class="mono">${s(Te.licH)}</span></div>`),Te.logH>0&&(le+=`<div class="cost-row"><span>EPPs+Herram. / hora</span><span class="mono">${s(Te.logH)}</span></div>`),le+=`<div class="cost-row cost-total"><span>Total / hora</span><span class="mono blue" style="font-size:11px">${s(Te.totalH)} ${n}</span></div>`,le+="</div></div></div>"}),le+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Equipos de trabajo</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,le+="</body></html>",Q.document.write(le),Q.document.close(),setTimeout(()=>Q.print(),400)};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:k.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Conformacin de equipos de trabajo"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[q.length," equipos / cuadrillas"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(ht,{sm:!0,on:()=>ge(null),children:[e.jsx(Ne,{size:11})," Nuevo equipo"]}),q.length>0&&e.jsxs("button",{onClick:ae,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Bt,{size:11})," Vista PDF"]})]})]}),e.jsx(rt,{style:{padding:"10px 14px",marginBottom:14,background:y?"#FFF8E7":"#E6F4EC"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,flexWrap:"wrap",fontSize:11},children:[e.jsx("div",{style:{flex:1},children:y?e.jsxs("span",{style:{color:"#8C6A00"},children:[" ",e.jsx("strong",{children:"Sin cargos en RRHH"}),"  Usando tarifas predeterminadas. Crea cargos en ",e.jsx("strong",{children:"RRHH  Cargos"})," o carga datos de prueba."]}):e.jsxs("span",{style:{color:"#111111"},children:[" ",e.jsxs("strong",{children:[r.filter(Q=>Q.activo!==!1).length," cargos"]})," desde RRHH ",e.jsxs("strong",{children:[E.length," activos"]}),"  ",e.jsxs("strong",{children:[w.length," licencias"]}),"  Horas productivas/ao: ",e.jsx("strong",{children:Math.round(d)}),m.length>0&&e.jsxs(e.Fragment,{children:["  ",e.jsxs("strong",{children:[m.length," tems"]})," desde Logstica"]})]})}),e.jsxs("div",{style:{display:"flex",gap:6},children:[y&&e.jsx("button",{onClick:pe,disabled:V,style:{padding:"5px 14px",background:"#111",color:"#fff",border:"none",borderRadius:4,fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",opacity:V?.5:1,whiteSpace:"nowrap"},children:V?"Cargando...":" Cargar datos de prueba"}),!y&&e.jsx("button",{onClick:_,disabled:V,style:{padding:"4px 10px",background:"none",border:"1px solid #ccc",borderRadius:3,fontSize:9,color:"#999",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap"},children:"Limpiar datos prueba"})]})]})}),B>0&&q.length>0&&e.jsxs(rt,{style:{padding:"14px 18px",marginBottom:14,background:"#F5F4F1"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[e.jsx("p",{style:{margin:0,fontSize:9,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:k.inkLight},children:"Resumen Alcances  APU"}),P&&e.jsx("span",{style:{fontSize:10,padding:"2px 8px",background:"#fff",border:`1px solid ${k.border}`,borderRadius:3,color:k.ink,fontWeight:600},children:P.nombre})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 2px",fontSize:8,color:k.inkLight,fontWeight:600,textTransform:"uppercase",letterSpacing:1},children:"Entregables"}),e.jsx("p",{style:{margin:0,fontSize:18,fontWeight:700,color:k.ink},children:z.length})]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 2px",fontSize:8,color:k.inkLight,fontWeight:600,textTransform:"uppercase",letterSpacing:1},children:"Horas totales"}),e.jsxs("p",{style:{margin:0,fontSize:18,fontWeight:700,color:k.ink},children:[B,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 2px",fontSize:8,color:k.inkLight,fontWeight:600,textTransform:"uppercase",letterSpacing:1},children:"Costo/hora equipo"}),e.jsxs("p",{style:{margin:0,fontSize:18,fontWeight:700,color:k.ink},children:[q.length>0?s(Ee(q[0]).totalH):""," ",e.jsxs("span",{style:{fontSize:9,fontWeight:400,color:k.inkLight},children:[n,"/h"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 2px",fontSize:8,color:k.inkLight,fontWeight:600,textTransform:"uppercase",letterSpacing:1},children:"Costo total diseo"}),e.jsxs("p",{style:{margin:0,fontSize:18,fontWeight:700,color:"#2E7D32"},children:[q.length>0?s(B*Ee(q[0]).totalH):""," ",e.jsx("span",{style:{fontSize:9,fontWeight:400,color:k.inkLight},children:n})]})]})]})]}),q.length===0?e.jsxs(rt,{style:{padding:40,textAlign:"center"},children:[e.jsx(ir,{size:32,style:{color:k.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:k.inkLight,fontSize:13,margin:"0 0 12px"},children:"Sin equipos definidos. Crea el primero."}),e.jsxs(ht,{sm:!0,on:()=>ge(null),children:[e.jsx(Ne,{size:11})," Nuevo equipo"]})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(380px, 1fr))",gap:14},children:q.map(Q=>{const me=Ee(Q),le=$===Q.id;return e.jsxs(rt,{style:{padding:0,overflow:"hidden",border:le?"2px solid #3B3B3B":`1px solid ${k.border}`},children:[e.jsxs("div",{style:{padding:"10px 14px",background:le?"#F0F0F0":"#F5F4F1",borderBottom:`1px solid ${k.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[le?e.jsx("input",{value:Q.nombre,onChange:be=>ye(Q.id,"nombre",be.target.value),style:{...je,fontSize:13,fontWeight:700,width:"100%",background:"#fff"}}):e.jsx("div",{style:{fontSize:13,fontWeight:700,color:k.ink},children:Q.nombre}),e.jsxs("div",{style:{fontSize:9,color:k.inkLight,marginTop:2},children:[Q.cargos.length," cargo",Q.cargos.length!==1?"s":"","  Rend: ",Q.rendimiento," h/ud"]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>Y(le?null:Q.id),style:{background:"none",border:"none",cursor:"pointer",color:le?"#3B3B3B":k.inkLight,padding:4},children:e.jsx(No,{size:13})}),e.jsx("button",{onClick:()=>J(Q.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:4},children:e.jsx(Je,{size:13})})]})]}),e.jsxs("div",{style:{padding:"10px 14px"},children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:k.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:[" Mano de obra ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH)"})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:6,fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`},children:[e.jsx("th",{style:{padding:"3px 4px",textAlign:"left",fontSize:8,color:"#888",fontWeight:700},children:"CARGO"}),e.jsx("th",{style:{padding:"3px 4px",textAlign:"center",fontSize:8,color:"#888",fontWeight:700,width:40},children:"CANT"}),e.jsxs("th",{style:{padding:"3px 4px",textAlign:"right",fontSize:8,color:"#888",fontWeight:700,width:70},children:[n,"/H"]}),e.jsx("th",{style:{padding:"3px 4px",textAlign:"right",fontSize:8,color:"#888",fontWeight:700,width:75},children:"SUBTOT/H"}),le&&e.jsx("th",{style:{width:20}})]})}),e.jsx("tbody",{children:Q.cargos.map(be=>{const Te=S(be.cargoId);return e.jsxs(hr.Fragment,{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"3px 4px"},children:le?e.jsxs("select",{value:be.cargoId,onChange:$e=>R(Q.id,be.id,"cargoId",$e.target.value),style:{...je,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar "}),g.map($e=>e.jsx("option",{value:$e.id,children:$e.nombre||$e.label},$e.id))]}):e.jsx("span",{children:A(be.cargoId)})}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"center"},children:le?e.jsx("input",{type:"number",value:be.cantidad||1,min:1,onChange:$e=>R(Q.id,be.id,"cantidad",+$e.target.value),style:{...je,width:36,textAlign:"center",fontSize:10}}):e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:be.cantidad||1})}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:k.inkMid},children:s(Te)}),e.jsx("td",{style:{padding:"3px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600},children:s(Te*(be.cantidad||1))}),le&&e.jsx("td",{children:e.jsx("button",{onClick:()=>L(Q.id,be.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx(Ot,{size:10})})})]}),e.jsx("tr",{children:e.jsx("td",{colSpan:le?5:4,style:{padding:"0 4px 4px 20px"},children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:7,color:"#888",fontWeight:700,textTransform:"uppercase"},children:"EPP:"}),(be.recursosAsignados||pn[be.cargoId]||[]).map($e=>{const Ye=Lo($e);return Ye?e.jsxs("span",{style:{fontSize:8,background:"#FFF8E7",color:"#8C6A00",padding:"1px 5px",borderRadius:3,display:"inline-flex",alignItems:"center",gap:2},children:[us[Ye.familia]||""," ",e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:$e})," ",Ye.nombre,le&&e.jsx("button",{onClick:()=>{const bt=be.recursosAsignados||[...pn[be.cargoId]||[]];R(Q.id,be.id,"recursosAsignados",bt.filter(Ct=>Ct!==$e))},style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0,marginLeft:2},children:""})]},$e):null}),le&&e.jsxs("select",{value:"",onChange:$e=>{if(!$e.target.value)return;const Ye=be.recursosAsignados||[...pn[be.cargoId]||[]];Ye.includes($e.target.value)||R(Q.id,be.id,"recursosAsignados",[...Ye,$e.target.value]),$e.target.value=""},style:{fontSize:8,padding:"1px 4px",border:`1px dashed ${k.border}`,borderRadius:3,background:"#fff",cursor:"pointer",maxWidth:130},children:[e.jsx("option",{value:"",children:"+ EPP/Dotacin"}),no.filter($e=>$e.familia==="epp"||$e.familia==="dotacion").map($e=>e.jsxs("option",{value:$e.codigo,children:[$e.codigo," ",$e.nombre]},$e.codigo))]})]})})})]},be.id)})})]}),le&&e.jsx("button",{onClick:()=>oe(Q.id),style:{background:"none",border:`1px dashed ${k.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:k.inkMid,width:"100%",marginBottom:8},children:"+ Aadir cargo"}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:k.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:" Herramientas y equipos asignados"}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginBottom:6},children:[(Q.herrAsignadas||[]).map(be=>{const Te=Lo(be);return Te?e.jsxs("span",{style:{fontSize:8,background:"#F0F0F0",color:"#3B3B3B",padding:"2px 6px",borderRadius:3,display:"inline-flex",alignItems:"center",gap:2},children:[us[Te.familia]||""," ",e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:be})," ",Te.nombre,le&&e.jsx("button",{onClick:()=>{ye(Q.id,"herrAsignadas",(Q.herrAsignadas||[]).filter($e=>$e!==be))},style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0,marginLeft:2},children:""})]},be):null}),(Q.herrAsignadas||[]).length===0&&!le&&e.jsx("span",{style:{fontSize:9,color:"#999",fontStyle:"italic"},children:"Sin herramientas asignadas"}),le&&e.jsxs("select",{value:"",onChange:be=>{if(!be.target.value)return;const Te=Q.herrAsignadas||[];Te.includes(be.target.value)||ye(Q.id,"herrAsignadas",[...Te,be.target.value]),be.target.value=""},style:{fontSize:8,padding:"2px 6px",border:`1px dashed ${k.border}`,borderRadius:3,background:"#fff",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"+ Herramienta / Equipo"}),no.filter(be=>["herr_menor","herr_mayor","equipo_obra","equipo_medic","consumible","seguridad"].includes(be.familia)).map(be=>e.jsxs("option",{value:be.codigo,children:[be.codigo," ",be.nombre," (",Hn[be.familia],")"]},be.codigo))]}),le&&(Q.herrAsignadas||[]).length===0&&(()=>{const be=Object.keys(_a).find(Te=>{var $e;return($e=Q.nombre)==null?void 0:$e.toLowerCase().includes(Te.replace("eq_","").replace("_"," "))});return be?e.jsx("button",{onClick:()=>ye(Q.id,"herrAsignadas",[...Q.herrAsignadas||[],..._a[be]]),style:{fontSize:8,padding:"2px 8px",background:"#E6F4EC",border:"1px solid #111111",borderRadius:3,color:"#111111",cursor:"pointer",fontWeight:600},children:" Cargar defaults"}):null})()]}),(le||(Q.activosUsados||[]).length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:k.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" Equipos / herramientas ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH  Activos)"})]}),(Q.activosUsados||[]).length===0&&E.length===0?e.jsx("div",{style:{fontSize:10,color:"#999",marginBottom:6},children:"Sin activos en RRHH. Regstralos en RRHH  Activos fijos."}):e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:(Q.activosUsados||[]).map(be=>{const Te=u.find(Ye=>Ye.id===be.activoId),$e=I(be.activoId);return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:le?e.jsxs("select",{value:be.activoId,onChange:Ye=>X(Q.id,be.id,"activoId",Ye.target.value),style:{...je,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar activo "}),E.map(Ye=>e.jsxs("option",{value:Ye.id,children:[Ye.nombre," (",Ye.categoria,")"]},Ye.id))]}):e.jsx("span",{children:(Te==null?void 0:Te.nombre)||""})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:le?e.jsx("input",{type:"number",value:be.cantidad||1,min:1,onChange:Ye=>X(Q.id,be.id,"cantidad",+Ye.target.value),style:{...je,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:be.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:k.inkMid,width:60},children:[s($e),"/h"]}),le&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>W(Q.id,be.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx(Ot,{size:9})})})]},be.id)})})}),le&&E.length>0&&e.jsx("button",{onClick:()=>T(Q.id),style:{background:"none",border:`1px dashed ${k.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:k.inkMid,width:"100%",marginBottom:6},children:"+ Aadir equipo/herramienta"})]}),(le||(Q.licenciasUsadas||[]).length>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:k.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" Licencias software ",!y&&e.jsx("span",{style:{fontWeight:400},children:"(desde RRHH  Licencias)"})]}),(Q.licenciasUsadas||[]).length===0&&w.length===0?e.jsx("div",{style:{fontSize:10,color:"#999",marginBottom:6},children:"Sin licencias en RRHH."}):e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:(Q.licenciasUsadas||[]).map(be=>{const Te=b.find(Ye=>Ye.id===be.licId),$e=Te?(Te.costoAnual||0)/(d||1760):0;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:le?e.jsxs("select",{value:be.licId,onChange:Ye=>ne(Q.id,be.id,"licId",Ye.target.value),style:{...je,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar licencia "}),w.map(Ye=>e.jsxs("option",{value:Ye.id,children:[Ye.nombre," (",Ye.plan||"",")"]},Ye.id))]}):e.jsx("span",{children:(Te==null?void 0:Te.nombre)||""})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:le?e.jsx("input",{type:"number",value:be.cantidad||1,min:1,onChange:Ye=>ne(Q.id,be.id,"cantidad",+Ye.target.value),style:{...je,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:be.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:k.inkMid,width:60},children:[s($e),"/h"]}),le&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>O(Q.id,be.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx(Ot,{size:9})})})]},be.id)})})}),le&&w.length>0&&e.jsx("button",{onClick:()=>M(Q.id),style:{background:"none",border:`1px dashed ${k.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:k.inkMid,width:"100%",marginBottom:6},children:"+ Aadir licencia"})]}),(()=>{const be=Ve(Q),Te=Q.logItemsUsados||[];return be.length>0||Te.length>0||le?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:k.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4,marginTop:6},children:[" EPPs  Dotaciones  Herramientas ",e.jsx("span",{style:{fontWeight:400},children:"(desde Logstica)"})]}),be.length>0&&e.jsxs("div",{style:{background:"#FFF8E7",borderRadius:3,padding:"4px 8px",marginBottom:4,fontSize:9},children:[e.jsx("span",{style:{fontWeight:600,color:k.warning},children:"Auto por cargo:"}),be.map(Ye=>e.jsxs("span",{style:{marginLeft:6,color:k.inkMid},children:[he[Ye.familia]||""," ",Ye.nombre," (",s(we(Ye.id)),"/h)"]},Ye.id))]}),Te.length>0&&e.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:4,fontSize:10},children:e.jsx("tbody",{children:Te.map(Ye=>{const bt=m.find(ft=>ft.id===Ye.itemId),Ct=we(Ye.itemId);return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"2px 4px"},children:le?e.jsxs("select",{value:Ye.itemId,onChange:ft=>H(Q.id,Ye.id,"itemId",ft.target.value),style:{...je,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Seleccionar "}),ue.map(ft=>e.jsxs("option",{value:ft.id,children:[he[ft.familia]||""," ",ft.nombre," (",ft.familia,")"]},ft.id))]}):e.jsxs("span",{children:[he[bt==null?void 0:bt.familia]||""," ",(bt==null?void 0:bt.nombre)||""]})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center",width:36},children:le?e.jsx("input",{type:"number",value:Ye.cantidad||1,min:1,onChange:ft=>H(Q.id,Ye.id,"cantidad",+ft.target.value),style:{...je,width:32,textAlign:"center",fontSize:10}}):e.jsx("span",{children:Ye.cantidad||1})}),e.jsxs("td",{style:{padding:"2px 4px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:9,color:k.inkMid,width:60},children:[s(Ct),"/h"]}),le&&e.jsx("td",{style:{width:20},children:e.jsx("button",{onClick:()=>re(Q.id,Ye.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:1},children:e.jsx(Ot,{size:9})})})]},Ye.id)})})}),le&&ue.length>0&&e.jsx("button",{onClick:()=>ie(Q.id),style:{background:"none",border:`1px dashed ${k.border}`,borderRadius:3,padding:"2px 8px",fontSize:9,cursor:"pointer",color:k.inkMid,width:"100%",marginBottom:6},children:"+ Aadir EPP / herramienta"}),le&&ue.length===0&&e.jsx("div",{style:{fontSize:9,color:"#999",marginBottom:6},children:"Sin tems en Logstica. Regstralos en el mdulo Logstica."})]}):null})(),le&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:8,marginBottom:6},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:8,color:k.inkLight,fontWeight:600,textTransform:"uppercase",marginBottom:2},children:"Rendimiento (h/ud)"}),e.jsx("input",{type:"number",value:Q.rendimiento||0,step:.01,onChange:be=>ye(Q.id,"rendimiento",+be.target.value),style:{...je,width:"100%",textAlign:"right"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:8,color:k.inkLight,fontWeight:600,textTransform:"uppercase",marginBottom:2},children:"Notas"}),e.jsx("input",{value:Q.notas||"",onChange:be=>ye(Q.id,"notas",be.target.value),placeholder:"Observaciones...",style:{...je,width:"100%"}})]})]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:4,padding:"6px 10px",fontSize:10,marginTop:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:k.inkLight},children:"M.O. / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:s(me.moH)})]}),me.eqH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:k.inkLight},children:"Equipos / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:s(me.eqH)})]}),me.licH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:k.inkLight},children:"Licencias / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:s(me.licH)})]}),me.logH>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[e.jsx("span",{style:{color:k.inkLight},children:"EPPs+Herram. / hora"}),e.jsx("span",{style:{fontFamily:"'DM Mono',monospace"},children:s(me.logH)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:`1px solid ${k.border}`,paddingTop:3,marginTop:3},children:[e.jsx("span",{style:{fontWeight:600},children:"Total / hora"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#3B3B3B"},children:[s(me.totalH)," ",n]})]})]}),le&&e.jsxs("button",{onClick:()=>Y(null),style:{width:"100%",marginTop:10,padding:"7px 12px",fontSize:11,fontWeight:700,cursor:"pointer",border:"none",borderRadius:4,background:"#111111",color:"#fff",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",justifyContent:"center",gap:5},children:[e.jsx(yt,{size:12})," Guardar equipo"]})]})]},Q.id)})})]})}function qh({d:t,set:i,r:o}){var pe;const n=t.pais||"CO",s=_=>_?new Intl.NumberFormat(n==="CO"?"es-CO":"es-ES",{maximumFractionDigits:0}).format(_):"",r=[{id:"civil",label:" Materiales civiles",icon:""},{id:"electrico",label:" Materiales elctricos",icon:""},{id:"hidro",label:" Hidrulico / sanitario",icon:""},{id:"acabados",label:" Acabados",icon:""},{id:"epp",label:" EPPs y dotacin",icon:""},{id:"herr",label:" Herramientas y equipos",icon:""},{id:"transporte",label:" Transporte",icon:""},{id:"otros",label:" Otros insumos",icon:""}],[a,u]=F.useState("civil"),[h,b]=F.useState(!1),[j,C]=F.useState(!1),[v,m]=F.useState(null),[f,p]=F.useState({codigo:"",descripcion:"",unidad:"ud",familia:"civil"}),[c,d]=F.useState({nombre:"",contacto:"",tel:"",email:"",nit:""}),[l,x]=F.useState(""),[y,g]=F.useState([]),[S,A]=F.useState(!1);F.useState(null);const E=t.insumosLista||[],w=_=>i("insumosLista",typeof _=="function"?_(E):_),I=t.matProveedores||[],z=_=>i("matProveedores",typeof _=="function"?_(I):_),B=t.insCotizaciones2||{},P=_=>i("insCotizaciones2",typeof _=="function"?_(B):_),q=t.insAdjudicacion||{},U=_=>i("insAdjudicacion",typeof _=="function"?_(q):_),$=["slot1","slot2","slot3"],Y={slot1:"Cotizacin 1",slot2:"Cotizacin 2",slot3:"Cotizacin 3"},ge={slot1:"#3B3B3B",slot2:"#8C6A00",slot3:"#5B3A8C"},J={slot1:"#F0F0F0",slot2:"#FAF0E0",slot3:"#F0ECF6"},ye=_=>{const ae={civil:"MC",electrico:"ME",hidro:"MH",acabados:"MA",epp:"EPP",herr:"HE",transporte:"TR",otros:"OT"}[_]||"XX",Q=E.filter(me=>me.familia===_).reduce((me,le)=>{const be=le.codigo.match(/(\d+)$/);return be?Math.max(me,parseInt(be[1])):me},0);return`${ae}-${String(Q+1).padStart(3,"0")}`},oe=()=>{const _=f.familia||a,ae=f.codigo||ye(_);w([...E,{id:zt(),codigo:ae,descripcion:f.descripcion,unidad:f.unidad,familia:_,precioPrevisto:0,cantidad:1}]),p({codigo:"",descripcion:"",unidad:"ud",familia:_}),b(!1)},L=(_,ae,Be)=>w(E.map(Q=>Q.id===_?{...Q,[ae]:Be}:Q)),R=_=>{w(E.filter(Q=>Q.id!==_));const ae={...B};delete ae[_],P(ae);const Be={...q};delete Be[_],U(Be),g(y.filter(Q=>Q!==_))},T=()=>{if(!c.nombre.trim())return;const _={...c,id:zt(),fecha:qt()};z([...I,_]),d({nombre:"",contacto:"",tel:"",email:"",nit:""}),C(!1)},W=_=>{z(I.filter(Be=>Be.id!==_));const ae={...B};Object.keys(ae).forEach(Be=>{$.forEach(Q=>{var me,le;((le=(me=ae[Be])==null?void 0:me[Q])==null?void 0:le.provId)===_&&delete ae[Be][Q]})}),P(ae)},X=(_,ae)=>{var Be;return((Be=B[_])==null?void 0:Be[ae])||null},M=(_,ae,Be)=>{const Q={...B};Q[_]||(Q[_]={}),Q[_][ae]={...Q[_][ae]||{},...Be},P(Q)},O=(_,ae)=>{const Be={...B};if(Be[_]&&delete Be[_][ae],P(Be),q[_]===ae){const Q={...q};delete Q[_],U(Q)}},ne=(_,ae)=>{const Be={...B};y.forEach(Q=>{Be[Q]||(Be[Q]={}),Be[Q][ae]={provId:_,precio:0,cotArchivo:"",correoRef:""}}),P(Be),A(!1),g([])},ie=(_,ae,Be)=>{var Q,me,le;M(_,ae,{provId:Be,precio:((Q=X(_,ae))==null?void 0:Q.precio)||0,cotArchivo:((me=X(_,ae))==null?void 0:me.cotArchivo)||"",correoRef:((le=X(_,ae))==null?void 0:le.correoRef)||""})},re=(_,ae)=>{U({...q,[_]:ae})},H=_=>{const ae={...q};delete ae[_],U(ae)},se=_=>{const ae=q[_];if(ae){const Be=X(_,ae);if((Be==null?void 0:Be.precio)>0){const Q=I.find(me=>me.id===Be.provId);return{precio:Be.precio,provNombre:(Q==null?void 0:Q.nombre)||"",slot:ae,adjudicado:!0}}}return{precio:0,provNombre:"",slot:null,adjudicado:!1}},N=()=>{const _=[];(no||[]).filter(ae=>ae.familia==="epp"||ae.familia==="dotacion").forEach(ae=>{E.find(Be=>Be.codigo===ae.codigo)||_.push({id:zt(),codigo:ae.codigo,descripcion:ae.nombre,unidad:ae.unidad,familia:"epp",precioPrevisto:ae.precioRef||0,cantidad:1})}),_.length>0&&w([...E,..._])},G=()=>{const _=[];(no||[]).filter(ae=>["herr_menor","herr_mayor","equipo_obra","equipo_medic","consumible","seguridad"].includes(ae.familia)).forEach(ae=>{E.find(Be=>Be.codigo===ae.codigo)||_.push({id:zt(),codigo:ae.codigo,descripcion:ae.nombre,unidad:ae.unidad,familia:"herr",precioPrevisto:ae.precioRef||0,cantidad:1})}),_.length>0&&w([...E,..._])},ue=E.filter(_=>!(_.familia!==a||l&&!_.descripcion.toLowerCase().includes(l.toLowerCase())&&!_.codigo.toLowerCase().includes(l.toLowerCase()))),he=E.length,we=Object.keys(q).length;E.filter(_=>$.some(ae=>{var Be;return((Be=X(_.id,ae))==null?void 0:Be.precio)>0})).length;const Ve=ue.length>0&&ue.every(_=>y.includes(_.id)),Ee=()=>{g(Ve?y.filter(_=>!ue.find(ae=>ae.id===_)):[...new Set([...y,...ue.map(_=>_.id)])])},je=_=>{g(y.includes(_)?y.filter(ae=>ae!==_):[...y,_])},V=()=>{const _=window.open("","_blank"),ae="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:10mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;font-size:8px;padding:16px}.header{display:flex;justify-content:space-between;margin-bottom:10px;padding-bottom:8px;border-bottom:3px solid #111}.logo{font-size:14px;font-weight:800;letter-spacing:3px}h2{font-size:11px;margin:10px 0 4px;border-bottom:2px solid #111;padding-bottom:4px}table{width:100%;border-collapse:collapse;margin-bottom:8px}th{background:#F5F4F1;padding:3px 4px;font-size:6px;text-transform:uppercase;letter-spacing:.3px;font-weight:700;color:#888;text-align:left;border-bottom:1px solid #E0E0E0}td{padding:2px 4px;font-size:7px;border-bottom:1px solid #F5F5F5}.mono{font-family:'DM Mono',monospace}.green{color:#111111}.r{text-align:right}.bold{font-weight:700}.adj{background:#D4EDDA;font-weight:700;color:#111111}.footer{margin-top:10px;padding-top:4px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:6px;color:#888}";let Be=`<html><head><title>Comparativo - ${t.codigoOferta||""}</title><style>${ae}</style></head><body>`;Be+='<div class="header"><div><div class="logo">HABITARIS</div></div>',Be+='<div style="text-align:right"><div style="font-size:13px;font-weight:700">Comparativo de Insumos</div>',Be+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}</div></div></div>`,r.forEach(Q=>{const me=E.filter(le=>le.familia===Q.id);me.length!==0&&(Be+=`<h2>${Q.label} (${me.length})</h2>`,Be+='<table><tr><th>Cdigo</th><th>Descripcin</th><th>Und</th><th>Cant</th><th class="r">P. Previsto</th>',$.forEach(le=>Be+=`<th class="r">${Y[le]}</th>`),Be+='<th class="r" style="background:#E6F4EC">P. Final</th><th>Adjudicado a</th></tr>',me.forEach(le=>{const be=se(le.id);Be+=`<tr><td class="mono bold">${le.codigo}</td><td>${le.descripcion}</td><td>${le.unidad}</td><td class="mono">${le.cantidad||1}</td>`,Be+=`<td class="mono r">${s(le.precioPrevisto)}</td>`,$.forEach(Te=>{const $e=X(le.id,Te),Ye=q[le.id]===Te,bt=$e!=null&&$e.provId?I.find(Ct=>Ct.id===$e.provId):null;Be+=`<td class="mono r ${Ye?"adj":""}">${bt?bt.nombre+": ":""}${($e==null?void 0:$e.precio)>0?s($e.precio):""}</td>`}),Be+=`<td class="mono r bold green">${be.adjudicado?s(be.precio):""}</td>`,Be+=`<td>${be.adjudicado?be.provNombre:"Pendiente"}</td></tr>`}),Be+="</table>")}),Be+=`<div class="footer"><span>HABITARIS  Comparativo  ${t.codigoOferta||""}</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,Be+="</body></html>",_.document.write(Be),_.document.close(),setTimeout(()=>_.print(),400)},te={border:`1px solid ${k.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},ce={width:15,height:15,accentColor:"#111111",cursor:"pointer"};return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:k.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Insumos y comparativo de proveedores"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[he," insumos  ",I.length," proveedores  ",we," adjudicados"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[y.length>0&&e.jsxs("button",{onClick:()=>A(!0),style:{padding:"6px 14px",background:"#3B3B3B",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" Asignar proveedor a ",y.length," insumos"]}),e.jsx("button",{onClick:()=>{p({...f,familia:a}),b(!0)},style:{padding:"6px 12px",border:`1px solid ${k.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:k.inkMid},children:"+ Insumo"}),e.jsx("button",{onClick:()=>{d({nombre:"",contacto:"",tel:"",email:"",nit:""}),m(null),C(!0)},style:{padding:"6px 12px",border:`1px solid ${k.border}`,borderRadius:4,background:"#fff",fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",color:k.inkMid},children:"+ Proveedor"}),e.jsxs("button",{onClick:V,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Bt,{size:11})," Vista PDF"]})]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14,overflowX:"auto"},children:r.map((_,ae)=>{const Be=E.filter(Q=>Q.familia===_.id).length;return e.jsxs("button",{onClick:()=>{u(_.id),g([])},style:{padding:"8px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${k.border}`,borderLeft:ae>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:ae===0?"5px 0 0 5px":ae===r.length-1?"0 5px 5px 0":"0",background:a===_.id?"#111":"#fff",color:a===_.id?"#fff":k.inkMid},children:[_.icon," ",_.label.split(" ").slice(1).join(" ")," ",Be>0&&e.jsx("span",{style:{marginLeft:4,background:a===_.id?"rgba(255,255,255,0.2)":"#F5F5F5",padding:"0 5px",borderRadius:8,fontSize:9},children:Be})]},_.id)})}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsxs("div",{style:{width:240,flexShrink:0},children:[e.jsxs(rt,{style:{padding:"8px 10px",marginBottom:10},children:[e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:["Proveedores (",I.length,")"]}),I.map(_=>e.jsx("div",{style:{padding:"6px 0",borderBottom:`1px solid ${k.border}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:_.nombre}),_.contacto&&e.jsx("div",{style:{fontSize:9,color:"#888"},children:_.contacto}),_.email&&e.jsxs("div",{style:{fontSize:8,color:"#3B3B3B"},children:[" ",_.email]}),_.nit&&e.jsxs("div",{style:{fontSize:8,color:"#888"},children:["NIT: ",_.nit]})]}),e.jsxs("div",{style:{display:"flex",gap:2},children:[e.jsx("button",{onClick:()=>{m(_.id),d({nombre:_.nombre,contacto:_.contacto||"",tel:_.tel||"",email:_.email||"",nit:_.nit||""}),C(!0)},style:{background:"none",border:"none",cursor:"pointer",color:"#3B3B3B",padding:2,fontSize:10},children:""}),e.jsx("button",{onClick:()=>W(_.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx(Ot,{size:10})})]})]})},_.id)),I.length===0&&e.jsx("div",{style:{fontSize:10,color:"#CCC",padding:"8px 0"},children:"Sin proveedores"}),e.jsx("button",{onClick:()=>{d({nombre:"",contacto:"",tel:"",email:"",nit:""}),m(null),C(!0)},style:{width:"100%",marginTop:6,padding:"5px",fontSize:10,cursor:"pointer",border:`1px dashed ${k.border}`,borderRadius:4,background:"#fff",color:k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir proveedor"})]}),a==="epp"&&e.jsx("button",{onClick:N,style:{width:"100%",padding:"6px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${k.border}`,borderRadius:4,background:"#FFF8E7",color:"#8C6A00",fontFamily:"'DM Sans',sans-serif",marginBottom:8},children:" Cargar EPPs desde catlogo"}),a==="herr"&&e.jsx("button",{onClick:G,style:{width:"100%",padding:"6px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${k.border}`,borderRadius:4,background:"#FFF8E7",color:"#8C6A00",fontFamily:"'DM Sans',sans-serif",marginBottom:8},children:" Cargar herramientas desde catlogo"}),e.jsx("input",{value:l,onChange:_=>x(_.target.value),placeholder:" Buscar insumo...",style:{...te,width:"100%",marginBottom:8}}),y.length>0&&e.jsxs("div",{style:{background:"#F0F0F0",border:"1px solid #3B3B3B33",borderRadius:6,padding:"8px 10px",fontSize:10},children:[e.jsx("strong",{children:y.length})," insumos seleccionados",e.jsx("button",{onClick:()=>A(!0),style:{display:"block",width:"100%",marginTop:4,padding:"5px",fontSize:10,fontWeight:700,cursor:"pointer",border:"none",borderRadius:4,background:"#3B3B3B",color:"#fff",fontFamily:"'DM Sans',sans-serif"},children:" Asignar proveedor"}),e.jsx("button",{onClick:()=>g([]),style:{display:"block",width:"100%",marginTop:3,padding:"4px",fontSize:9,cursor:"pointer",border:`1px solid ${k.border}`,borderRadius:4,background:"#fff",color:k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"Deseleccionar todo"})]})]}),e.jsxs(rt,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:900},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{padding:"6px 4px",width:30,borderBottom:"2px solid #CCC"},children:e.jsx("input",{type:"checkbox",checked:Ve,onChange:Ee,style:ce})}),e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"left",width:80},children:"Cdigo"}),e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"left",minWidth:150},children:"Descripcin"}),e.jsx("th",{style:{padding:"6px 4px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"center",width:35},children:"Und"}),e.jsx("th",{style:{padding:"6px 4px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"center",width:40},children:"Cant"}),e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:"2px solid #CCC",textAlign:"right",width:80},children:"P. Prev."}),$.map(_=>e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,textTransform:"uppercase",borderBottom:`2px solid ${ge[_]}`,textAlign:"center",minWidth:140,color:ge[_],background:J[_]},children:Y[_]},_)),e.jsx("th",{style:{padding:"6px 6px",fontSize:8,fontWeight:700,color:"#111111",textTransform:"uppercase",borderBottom:"2px solid #111111",textAlign:"center",width:120,background:"#E6F4EC"},children:"P. Final / Adjud."}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:ue.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:"24px",textAlign:"center",color:"#CCC",fontSize:12},children:'Sin insumos en esta categora. Pulsa "+ Insumo" para aadir.'})}):ue.map((_,ae)=>{const Be=se(_.id),Q=y.includes(_.id);return e.jsxs("tr",{style:{background:Q?"#F0F0F022":ae%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${k.border}`},children:[e.jsx("td",{style:{padding:"4px 4px",textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:Q,onChange:()=>je(_.id),style:ce})}),e.jsx("td",{style:{padding:"4px 6px"},children:e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,background:"#F5F5F5",padding:"1px 6px",borderRadius:3},children:_.codigo})}),e.jsx("td",{style:{padding:"4px 6px"},children:e.jsx("input",{value:_.descripcion,onChange:me=>L(_.id,"descripcion",me.target.value),style:{...te,width:"100%",border:"none",background:"transparent",fontWeight:500,fontSize:11},placeholder:"Descripcin"})}),e.jsx("td",{style:{padding:"2px 2px",textAlign:"center"},children:e.jsx("select",{value:_.unidad,onChange:me=>L(_.id,"unidad",me.target.value),style:{...te,fontSize:9,border:"none",background:"transparent",textAlign:"center",padding:"2px"},children:["ud","m","m","m","ml","kg","gl","l","par","jgo","rollo","bulto","caneca","caja","saco","da","mes","h","viaje"].map(me=>e.jsx("option",{children:me},me))})}),e.jsx("td",{style:{padding:"2px 2px"},children:e.jsx("input",{type:"number",value:_.cantidad||1,min:1,onChange:me=>L(_.id,"cantidad",parseInt(me.target.value)||1),style:{...te,width:36,textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:10,border:"none",background:"transparent"}})}),e.jsx("td",{style:{padding:"2px 4px"},children:e.jsx("input",{type:"number",value:_.precioPrevisto||"",placeholder:"0",onChange:me=>L(_.id,"precioPrevisto",parseFloat(me.target.value)||0),style:{...te,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:"#888"}})}),$.map(me=>{const le=X(_.id,me);le!=null&&le.provId&&I.find(Te=>Te.id===le.provId);const be=q[_.id]===me;return e.jsx("td",{style:{padding:"3px 4px",borderLeft:`1px solid ${ge[me]}22`,background:be?"#D4EDDA":le?J[me]+"44":"transparent",verticalAlign:"top"},children:le?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[e.jsxs("select",{value:le.provId||"",onChange:Te=>M(_.id,me,{provId:Te.target.value}),style:{fontSize:8,fontWeight:700,color:ge[me],border:"none",background:"transparent",cursor:"pointer",maxWidth:100},children:[e.jsx("option",{value:"",children:" Prov "}),I.map(Te=>e.jsx("option",{value:Te.id,children:Te.nombre},Te.id))]}),e.jsx("button",{onClick:()=>O(_.id,me),title:"Quitar",style:{background:"none",border:"none",cursor:"pointer",color:"#C44",fontSize:8,padding:0},children:""})]}),e.jsx("input",{type:"number",value:le.precio||"",placeholder:"Precio",onChange:Te=>M(_.id,me,{precio:parseFloat(Te.target.value)||0}),style:{...te,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:be?700:400,border:be?"2px solid #111111":`1px solid ${k.border}`,background:be?"#D4EDDA":"#fff"}}),e.jsxs("div",{style:{display:"flex",gap:2,marginTop:2},children:[e.jsx("input",{value:le.cotArchivo||"",placeholder:" Cotizacin",onChange:Te=>M(_.id,me,{cotArchivo:Te.target.value}),style:{fontSize:7,padding:"1px 3px",border:`1px solid ${k.border}`,borderRadius:2,width:"50%",background:"#fff"}}),e.jsx("input",{value:le.correoRef||"",placeholder:" Correo",onChange:Te=>M(_.id,me,{correoRef:Te.target.value}),style:{fontSize:7,padding:"1px 3px",border:`1px solid ${k.border}`,borderRadius:2,width:"50%",background:"#fff"}})]}),le.precio>0&&e.jsx("button",{onClick:()=>be?H(_.id):re(_.id,me),style:{width:"100%",marginTop:3,padding:"2px",fontSize:8,fontWeight:700,border:be?"1px solid #111111":`1px dashed ${k.border}`,borderRadius:3,background:be?"#111111":"#fff",color:be?"#fff":"#888",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:be?" Adjudicado":"Adjudicar"})]}):e.jsx("div",{style:{textAlign:"center",padding:"6px 0"},children:e.jsxs("select",{value:"",onChange:Te=>{Te.target.value&&ie(_.id,me,Te.target.value)},style:{fontSize:8,padding:"2px 4px",border:`1px dashed ${k.border}`,borderRadius:3,background:"#fff",cursor:"pointer",color:k.inkMid,width:"100%"},children:[e.jsx("option",{value:"",children:"+ Proveedor"}),I.map(Te=>e.jsx("option",{value:Te.id,children:Te.nombre},Te.id))]})})},me)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",background:"#E6F4EC",verticalAlign:"middle"},children:Be.adjudicado?e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:800,color:"#111111"},children:s(Be.precio)}),e.jsxs("div",{style:{fontSize:7,color:"#111111",fontWeight:600},children:[" ",Be.provNombre]})]}):e.jsx("span",{style:{fontSize:8,color:"#999",fontStyle:"italic"},children:"Pendiente"})}),e.jsx("td",{style:{padding:"2px 4px"},children:e.jsx("button",{onClick:()=>R(_.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44",padding:2},children:e.jsx(Je,{size:10})})})]},_.id)})})]})}),e.jsx("div",{style:{padding:"6px 8px",borderTop:`1px solid ${k.border}`},children:e.jsxs("button",{onClick:()=>{p({...f,familia:a}),b(!0)},style:{width:"100%",padding:"5px 8px",fontSize:10,cursor:"pointer",border:`1px dashed ${k.border}`,borderRadius:3,background:"#fff",color:k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:["+ Aadir insumo a ",((pe=r.find(_=>_.id===a))==null?void 0:pe.label)||""]})})]})]}),h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:_=>_.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Mt,{t:"Nuevo insumo",s:"Se agrega a la maestra del proyecto"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:"0 0 100px"},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Cdigo"}),e.jsx("input",{value:f.codigo||ye(f.familia||a),onChange:_=>p({...f,codigo:_.target.value}),style:{...te,width:"100%",fontFamily:"'DM Mono',monospace",fontWeight:700}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Descripcin"}),e.jsx("input",{value:f.descripcion,onChange:_=>p({...f,descripcion:_.target.value}),style:{...te,width:"100%"},placeholder:"Ej: Cemento Portland tipo I"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Familia"}),e.jsx("select",{value:f.familia||a,onChange:_=>p({...f,familia:_.target.value}),style:{...te,width:"100%"},children:r.map(_=>e.jsx("option",{value:_.id,children:_.label},_.id))})]}),e.jsxs("div",{style:{flex:"0 0 80px"},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Unidad"}),e.jsx("select",{value:f.unidad,onChange:_=>p({...f,unidad:_.target.value}),style:{...te,width:"100%"},children:["ud","m","m","m","ml","kg","gl","l","par","jgo","rollo","bulto","caneca","caja","saco","da","mes","h","viaje"].map(_=>e.jsx("option",{children:_},_))})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ht,{on:oe,style:{flex:1},children:[e.jsx(yt,{size:11})," Aadir"]}),e.jsx(ht,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})}),j&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>C(!1),children:e.jsxs("div",{onClick:_=>_.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Mt,{t:v?"Editar proveedor":"Nuevo proveedor",s:"Para comparar cotizaciones"}),e.jsx(ot,{lbl:"Nombre / Empresa",val:c.nombre,on:_=>d({...c,nombre:_.target.value}),ph:"Ej: Ferretera El Tornillo"}),e.jsx(ot,{lbl:"NIT / CIF",val:c.nit||"",on:_=>d({...c,nit:_.target.value}),ph:"900.123.456-7"}),e.jsx(ot,{lbl:"Contacto",val:c.contacto,on:_=>d({...c,contacto:_.target.value}),ph:"Nombre persona"}),e.jsx(ot,{lbl:"Telfono",val:c.tel,on:_=>d({...c,tel:_.target.value}),ph:"+57 300..."}),e.jsx(ot,{lbl:"Email",val:c.email,on:_=>d({...c,email:_.target.value}),ph:"prov@email.com"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(ht,{on:()=>{v?(z(I.map(_=>_.id===v?{..._,...c}:_)),C(!1),m(null)):T()},style:{flex:1},children:[e.jsx(yt,{size:11})," ",v?"Guardar":"Aadir"]}),e.jsx(ht,{v:"sec",on:()=>{C(!1),m(null)},style:{flex:1},children:"Cancelar"})]})]})}),S&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>A(!1),children:e.jsxs("div",{onClick:_=>_.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:480,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Mt,{t:`Asignar proveedor a ${y.length} insumos`,s:"Elige proveedor y columna de cotizacin"}),I.length===0?e.jsx("div",{style:{padding:16,textAlign:"center",color:"#888",fontSize:12},children:"Primero aade proveedores"}):e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,marginBottom:8,color:"#555"},children:"A qu columna asignar?"}),$.map(_=>e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:ge[_],textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:Y[_]}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:I.map(ae=>e.jsx("button",{onClick:()=>ne(ae.id,_),style:{padding:"6px 14px",border:`1px solid ${ge[_]}44`,borderRadius:5,background:J[_],color:ge[_],fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:ae.nombre},ae.id))})]},_))]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ht,{v:"sec",on:()=>A(!1),style:{width:"100%"},children:"Cerrar"})})]})})]})}function Hh({d:t,set:i}){const o=t.orgNodos||[],n=A=>i("orgNodos",typeof A=="function"?A(o):A),[s,r]=F.useState(null),[a,u]=F.useState(!0),h={obra:{label:" Obra civil",nodes:[{id:"o1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"o2",parentId:"o1",nombre:"",cargo:"Director de Obra",color:"#2A5F8C",icon:""},{id:"o3",parentId:"o2",nombre:"",cargo:"Residente de Obra",color:"#5B8DB8",icon:""},{id:"o4",parentId:"o2",nombre:"",cargo:"Maestro de Obra",color:"#5B8DB8",icon:""},{id:"o5",parentId:"o2",nombre:"",cargo:"Almacenista",color:"#5B8DB8",icon:""},{id:"o6",parentId:"o1",nombre:"",cargo:"Directora de Diseo",color:"#8C5B2A",icon:""},{id:"o7",parentId:"o6",nombre:"",cargo:"Arquitecto",color:"#B88C5B",icon:""},{id:"o8",parentId:"o1",nombre:"",cargo:"Ing. HSE / SISO",color:"#8C2A2A",icon:""},{id:"o9",parentId:"o1",nombre:"",cargo:"Coord. Administrativo",color:"#6B5B8C",icon:""}]},diseno:{label:" Diseo interior",nodes:[{id:"d1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"d2",parentId:"d1",nombre:"",cargo:"Directora Creativa",color:"#8C5B2A",icon:""},{id:"d3",parentId:"d2",nombre:"",cargo:"Diseador Senior",color:"#B88C5B",icon:""},{id:"d4",parentId:"d2",nombre:"",cargo:"Diseador Junior",color:"#B88C5B",icon:""},{id:"d5",parentId:"d2",nombre:"",cargo:"Visualizador 3D",color:"#B88C5B",icon:""},{id:"d6",parentId:"d1",nombre:"",cargo:"Coord. Tcnico",color:"#2A5F8C",icon:""},{id:"d7",parentId:"d6",nombre:"",cargo:"Dibujante / Planos",color:"#5B8DB8",icon:""}]},mixto:{label:" Obra + Diseo",nodes:[{id:"m1",parentId:null,nombre:"",cargo:"Gerente de Proyecto",color:"#111111",icon:""},{id:"m2",parentId:"m1",nombre:"",cargo:"Director de Obra",color:"#2A5F8C",icon:""},{id:"m3",parentId:"m2",nombre:"",cargo:"Residente de Obra",color:"#5B8DB8",icon:""},{id:"m4",parentId:"m2",nombre:"",cargo:"Maestro de Obra",color:"#5B8DB8",icon:""},{id:"m5",parentId:"m2",nombre:"",cargo:"Almacenista",color:"#5B8DB8",icon:""},{id:"m6",parentId:"m1",nombre:"",cargo:"Directora de Diseo",color:"#8C5B2A",icon:""},{id:"m7",parentId:"m6",nombre:"",cargo:"Arquitecto",color:"#B88C5B",icon:""},{id:"m8",parentId:"m6",nombre:"",cargo:"Diseador Interior",color:"#B88C5B",icon:""},{id:"m9",parentId:"m1",nombre:"",cargo:"Ing. HSE / SISO",color:"#8C2A2A",icon:""},{id:"m10",parentId:"m1",nombre:"",cargo:"Coord. Administrativo",color:"#6B5B8C",icon:""},{id:"m11",parentId:"m1",nombre:"",cargo:"Coord. Compras",color:"#6B5B8C",icon:""}]},pequeno:{label:" Proyecto pequeo",nodes:[{id:"p1",parentId:null,nombre:"",cargo:"Director de Proyecto",color:"#111111",icon:""},{id:"p2",parentId:"p1",nombre:"",cargo:"Arquitecto / Diseador",color:"#8C5B2A",icon:""},{id:"p3",parentId:"p1",nombre:"",cargo:"Maestro de Obra",color:"#2A5F8C",icon:""}]}},b=A=>{const E=h[A].nodes,w=E.map(z=>({...z,id:zt()})),I=E.map(z=>z.id);w.forEach((z,B)=>{const P=I.indexOf(E[B].parentId);z.parentId=P>=0?w[P].id:null}),n(w),r(null)},j=A=>{const E={id:zt(),parentId:A,nombre:"",cargo:"Nuevo cargo",color:"#555",icon:""};n([...o,E]),r(E.id)},C=A=>{const E=new Set([A]);let w=!0;for(;w;)w=!1,o.forEach(I=>{I.parentId&&E.has(I.parentId)&&!E.has(I.id)&&(E.add(I.id),w=!0)});n(o.filter(I=>!E.has(I.id))),s&&E.has(s)&&r(null)},v=(A,E,w)=>n(o.map(I=>I.id===A?{...I,[E]:w}:I)),m=o.filter(A=>!A.parentId),f=A=>o.filter(E=>E.parentId===A),p=A=>{let E=0,w=o.find(I=>I.id===A);for(;w!=null&&w.parentId;)E++,w=o.find(I=>I.id===w.parentId);return E},c=(()=>{const A=[],E=w=>{o.filter(I=>I.parentId===w).forEach(I=>{A.push(I),E(I.id)})};return m.forEach(w=>{A.push(w),E(w.id)}),A})(),d=["","","","","","","","","","","","","","","","","","","","","","","",""],l=["#111111","#2A5F8C","#8C5B2A","#8C2A2A","#6B5B8C","#5B8DB8","#B88C5B","#555","#2B7A52","#3B3B3B","#C44","#888"],x={border:`1px solid ${k.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},y=({node:A})=>{const E=f(A.id),w=s===A.id;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{background:"#fff",border:`2px solid ${A.color||"#555"}`,borderRadius:8,padding:"8px 12px",minWidth:120,maxWidth:180,textAlign:"center",cursor:"pointer",boxShadow:w?`0 0 0 3px ${A.color||"#555"}44`:"0 1px 6px rgba(0,0,0,0.06)"},onClick:()=>r(A.id),children:[e.jsx("div",{style:{fontSize:18,marginBottom:2},children:A.icon||""}),a&&A.nombre&&e.jsx("div",{style:{fontSize:11,fontWeight:700,color:k.ink,lineHeight:1.2},children:A.nombre}),e.jsx("div",{style:{fontSize:9,color:A.color||"#555",fontWeight:700,textTransform:"uppercase",letterSpacing:.4,lineHeight:1.3,marginTop:1},children:A.cargo})]}),E.length>0&&e.jsx("div",{style:{width:2,height:16,background:"#DDD"}}),E.length>0&&e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start",position:"relative"},children:[E.length>1&&e.jsx("div",{style:{position:"absolute",top:0,height:2,background:"#DDD",left:`${100/(E.length*2)}%`,right:`${100/(E.length*2)}%`}}),E.map(I=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:2,height:16,background:"#DDD"}}),e.jsx(y,{node:I})]},I.id))]})]})},g=()=>{const A=window.open("","_blank"),E="@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap');@page{size:landscape;margin:12mm}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;color:#111;padding:20px}.header{display:flex;justify-content:space-between;margin-bottom:16px;padding-bottom:10px;border-bottom:3px solid #111}.logo{font-size:16px;font-weight:800;letter-spacing:3px}.logo-sub{font-size:7px;letter-spacing:2px;color:#888;text-transform:uppercase}.org-container{display:flex;justify-content:center;padding:16px 0}.node{background:#fff;border:2px solid var(--c);border-radius:8px;padding:8px 14px;min-width:120px;max-width:180px;text-align:center;display:inline-flex;flex-direction:column;align-items:center}.node .icon{font-size:18px;margin-bottom:2px}.node .name{font-size:10px;font-weight:700;color:#111;line-height:1.2}.node .role{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:.4px;color:var(--c);line-height:1.2;margin-top:1px}.branch{display:flex;flex-direction:column;align-items:center}.children{display:flex;gap:12px;align-items:flex-start;position:relative}.vline{width:2px;height:16px;background:#DDD;margin:0 auto}.hline{position:absolute;top:0;height:2px;background:#DDD}.footer{margin-top:20px;padding-top:6px;border-top:1px solid #E0E0E0;display:flex;justify-content:space-between;font-size:7px;color:#888}",w=z=>{const B=f(z.id);let P=`<div class="branch"><div class="node" style="--c:${z.color||"#555"}"><div class="icon">${z.icon||""}</div>`;return a&&z.nombre&&(P+=`<div class="name">${z.nombre}</div>`),P+=`<div class="role">${z.cargo}</div></div>`,B.length>0&&(P+='<div class="vline"></div><div class="children">',B.length>1&&(P+=`<div class="hline" style="left:${100/(B.length*2)}%;right:${100/(B.length*2)}%"></div>`),B.forEach(q=>{P+=`<div class="branch"><div class="vline"></div>${w(q)}</div>`}),P+="</div>"),P+="</div>",P};let I=`<html><head><title>Organigrama - ${t.codigoOferta||""}</title><style>${E}</style></head><body>`;I+='<div class="header"><div><div class="logo">HABITARIS</div><div class="logo-sub">Arquitectura  Interiorismo  Construccin</div></div>',I+='<div style="text-align:right"><div style="font-size:14px;font-weight:700">Organigrama del Proyecto</div>',I+=`<div style="font-size:8px;color:#555">${t.proyecto||""}  ${t.codigoOferta||""}  ${t.cliente||""}</div>`,I+=`<div style="font-size:8px;color:#888;margin-top:2px">${o.length} integrantes</div></div></div>`,I+='<div class="org-container">',m.forEach(z=>{I+=w(z)}),I+="</div>",I+=`<div class="footer"><span>HABITARIS  ${t.codigoOferta||""}  Organigrama</span><span>${new Date().toLocaleDateString("es-CO")}</span></div>`,I+="</body></html>",A.document.write(I),A.document.close(),setTimeout(()=>A.print(),400)},S=o.find(A=>A.id===s);return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:k.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Organigrama del proyecto"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:[o.length," integrantes"]})]}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,fontSize:10,color:k.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:a,onChange:A=>u(A.target.checked)})," Mostrar nombres"]}),e.jsxs("button",{onClick:g,style:{padding:"6px 14px",background:"#111",color:"#fff",border:"none",borderRadius:5,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:4},children:[e.jsx(Bt,{size:11})," Vista PDF"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{width:300,flexShrink:0},children:[e.jsxs(rt,{style:{padding:"10px 12px",marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Plantilla"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4},children:Object.entries(h).map(([A,E])=>e.jsx("button",{onClick:()=>b(A),style:{padding:"6px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${k.border}`,borderRadius:4,background:"#fff",fontFamily:"'DM Sans',sans-serif",color:k.inkMid,textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:E.label},A))})]}),e.jsxs(rt,{style:{padding:"6px 0",maxHeight:520,overflowY:"auto"},children:[e.jsx("div",{style:{padding:"4px 12px 6px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,borderBottom:`1px solid ${k.border}`},children:"Cargos del proyecto"}),c.map(A=>{const E=p(A.id),w=s===A.id;return e.jsxs("div",{onClick:()=>r(w?null:A.id),style:{padding:"5px 10px 5px "+(12+E*16)+"px",display:"flex",alignItems:"center",gap:6,cursor:"pointer",background:w?"#F0F0F0":"transparent",borderLeft:w?`3px solid ${A.color||"#555"}`:"3px solid transparent",borderBottom:`1px solid ${k.border}`,transition:"background .1s"},children:[e.jsx("span",{style:{fontSize:14,flexShrink:0},children:A.icon||""}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:A.color||"#555",textTransform:"uppercase",letterSpacing:.3,lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:A.cargo}),e.jsx("div",{style:{fontSize:10,color:k.ink,lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:A.nombre||e.jsx("span",{style:{color:"#CCC",fontStyle:"italic"},children:"Sin asignar"})})]}),e.jsx("button",{onClick:I=>{I.stopPropagation(),j(A.id)},title:"Aadir subordinado",style:{background:"none",border:"none",cursor:"pointer",color:A.color||"#555",padding:2,fontSize:14},children:"+"})]},A.id)}),o.length===0&&e.jsx("div",{style:{padding:"16px 12px",textAlign:"center",color:"#CCC",fontSize:11},children:"Selecciona una plantilla o aade un cargo"}),e.jsx("div",{style:{padding:"6px 12px"},children:e.jsx("button",{onClick:()=>j(null),style:{width:"100%",padding:"5px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px dashed ${k.border}`,borderRadius:4,background:"#fff",color:k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir cargo raz"})})]}),S&&e.jsxs(rt,{style:{padding:14,marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:700,color:S.color||"#555"},children:["Editar: ",S.cargo]}),e.jsx("button",{onClick:()=>r(null),style:{background:"none",border:"none",cursor:"pointer",color:k.inkLight,padding:2},children:e.jsx(Ot,{size:14})})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Cargo"}),e.jsx("input",{value:S.cargo,onChange:A=>v(S.id,"cargo",A.target.value),style:{...x,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Nombre"}),e.jsx("input",{value:S.nombre||"",onChange:A=>v(S.id,"nombre",A.target.value),placeholder:"Nombre completo",style:{...x,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Contacto"}),e.jsx("input",{value:S.contacto||"",onChange:A=>v(S.id,"contacto",A.target.value),placeholder:"Tel o email",style:{...x,width:"100%"}})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Reporta a"}),e.jsxs("select",{value:S.parentId||"",onChange:A=>v(S.id,"parentId",A.target.value||null),style:{...x,width:"100%"},children:[e.jsx("option",{value:"",children:" Raz (sin jefe) "}),o.filter(A=>A.id!==S.id).map(A=>e.jsxs("option",{value:A.id,children:[A.cargo," ",A.nombre?`(${A.nombre})`:""]},A.id))]})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Icono"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:d.map(A=>e.jsx("button",{onClick:()=>v(S.id,"icon",A),style:{width:24,height:24,border:`1px solid ${S.icon===A?"#111":"#E0E0E0"}`,borderRadius:3,background:S.icon===A?"#F5F4F1":"#fff",cursor:"pointer",fontSize:12,display:"flex",alignItems:"center",justifyContent:"center"},children:A},A))})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Color"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:l.map(A=>e.jsx("button",{onClick:()=>v(S.id,"color",A),style:{width:20,height:20,borderRadius:3,background:A,cursor:"pointer",border:S.color===A?"2px solid #111":"2px solid #E0E0E0"}},A))})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>j(S.id),style:{flex:1,padding:"5px 8px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${k.border}`,borderRadius:4,background:"#fff",color:k.inkMid,fontFamily:"'DM Sans',sans-serif"},children:"+ Subordinado"}),e.jsx("button",{onClick:()=>C(S.id),style:{padding:"5px 10px",fontSize:10,fontWeight:600,cursor:"pointer",border:"1px solid #C44",borderRadius:4,background:"#FEE",color:"#C44",fontFamily:"'DM Sans',sans-serif"},children:e.jsx(Je,{size:10})})]})]})]}),e.jsx(rt,{style:{flex:1,padding:20,overflowX:"auto",minHeight:300},children:o.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx(fd,{size:32,style:{color:k.inkLight,opacity:.3,marginBottom:12}}),e.jsx("p",{style:{color:k.inkLight,fontSize:13,margin:"0 0 12px"},children:"Selecciona una plantilla para comenzar"}),e.jsx("div",{style:{display:"flex",gap:6,justifyContent:"center",flexWrap:"wrap"},children:Object.entries(h).map(([A,E])=>e.jsx(ht,{sm:!0,v:"sec",on:()=>b(A),children:E.label},A))})]}):e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:8,paddingBottom:20},children:m.map(A=>e.jsx(y,{node:A},A.id))})})]})]})}function Gh({d:t,r:i}){const o=t.tipoProyecto==="OBRA",n=t.modoCalcObra||"margen",s=i.U||0,r=[{l:"Costo directo total (CD)",v:i.COSTO,b:!0},{l:" Materiales (M)",v:i.cdM,sub:!0},{l:" Mano de obra (MO)",v:i.cdMO,sub:!0},{l:" Subcontratas (SUB)",v:i.cdSB,sub:!0},...t.tipoProyecto==="DISEO"?[{l:" Diseo APU",v:i.costoDis,sub:!0}]:[],null,{l:"Gastos de contratacin (GC) "+pt(i.g),v:i.GC},{l:" Plizas (RCE+TRC+Adm)",v:((t.pctRCE||0)+(t.pctTRC||0)+(t.pctAdm||0))*i.PVP,sub:!0},{l:" ICA",v:i.ICA,sub:!0},{l:"Gastos financieros (GF) "+pt(i.f),v:i.fin},null,{l:`Margen objetivo ${pt(t.margen)}`,v:i.margenCOP,b:!0,col:k.success},...o?[{l:` Utilidad declarada para IVA (U): ${pt(s)}${n==="aiu"?" (AIU)":" (manual)"}`,v:s*i.PVP,sub:!0,col:"#3B3B3B"},{l:n==="aiu"?` AIU: A ${pt(t.aiuA||.08)} + I ${pt(t.aiuI||.03)} + U ${pt(t.aiuU||.07)} = ${pt((t.aiuA||.08)+(t.aiuI||.03)+(t.aiuU||.07))}`:` Margen ${pt(t.margen)} sobre PVP  U para IVA: ${pt(s)}`,v:null,sub:!0,note:!0}]:[],null,{l:"PVP sin IVA",v:i.PVP,b:!0},{l:o?`IVA ${pt(t.tarifaIVA)} sobre U ${pt(s)} del PVP`:t.pais==="ES"?`IVA ${pt(t.tarifaIVA)} (Espaa)`:`IVA ${pt(t.tarifaIVA)} pleno (DISEO)`,v:i.IVA,sub:!0},{l:"PVP con IVA",v:i.PVP_IVA,b:!0,col:k.ink}];return e.jsxs("div",{className:"fade",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(rt,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${k.border}`},children:e.jsx(Mt,{t:"Desglose de costos",s:"Construccin del precio de venta"})}),e.jsx("div",{style:{padding:"6px 0"},children:r.map((a,u)=>a===null?e.jsx("div",{style:{borderTop:`1px solid ${k.border}`,margin:"6px 0"}},u):e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"7px 20px",background:a.b&&!a.sub?k.accentBg:""},children:[e.jsx("span",{style:{fontSize:a.sub?11:12,color:a.col||k.inkMid,paddingLeft:a.sub?12:0,fontWeight:a.b?700:400},children:a.l}),a.v!=null&&e.jsx("span",{style:{fontSize:a.sub?11:12,color:a.col||k.ink,fontWeight:a.b?700:500,fontFamily:"'DM Mono',monospace"},children:Ft(a.v)})]},u))}),e.jsxs("div",{style:{borderTop:`2px solid ${k.border}`,padding:"14px 20px",background:"#F5F4F1"},children:[e.jsx("p",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,margin:"0 0 8px"},children:"Coeficientes aplicados"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8},children:[["Den. (1MGC)",(i.den1||0).toFixed(4)],["Den. (1GF)",(i.denGF||0).toFixed(4)],["Den. total",(i.den||0).toFixed(4)],["Coef. ",(i.coefMult||0).toFixed(4)]].map(([a,u])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:"#999",marginBottom:2},children:a}),e.jsx("div",{style:{fontSize:11,fontWeight:600,fontFamily:"'DM Mono',monospace"},children:u})]},a))})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{style:{background:k.ink,borderRadius:3,padding:"28px 28px"},children:[e.jsx("p",{style:{margin:"0 0 6px",fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:"rgba(255,255,255,0.4)"},children:"PVP Total al cliente"}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:40,fontWeight:700,color:"#fff",margin:"0 0 10px",letterSpacing:-1},children:Ft(i.PVP_IVA)}),e.jsxs("p",{style:{fontSize:10,color:"rgba(255,255,255,0.4)",margin:0},children:["IVA ",pt(t.tarifaIVA),"  Modo ",t.tipoProyecto,o&&`  U declarada ${pt(s)}`,t.tipoProyecto==="DISEO"&&`  ${t.subtipoDiseno}`]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[["PVP sin IVA",Ft(i.PVP),k.ink],["IVA",Ft(i.IVA),k.info],["Margen ("+pt(t.margen)+")",Ft(i.margenCOP),k.success],...o?[["Utilidad decl. ("+pt(s)+")",Ft(s*i.PVP),"#3B3B3B"]]:[],["Retenciones",Ft(i.ret),k.warning],["Neto a recibir",Ft(i.neto),k.ink]].map(([a,u,h])=>e.jsxs(rt,{style:{padding:"13px 16px"},children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:9,fontWeight:600,color:k.inkLight,textTransform:"uppercase",letterSpacing:1},children:a}),e.jsx("p",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:h,margin:0},children:u})]},a))}),e.jsxs(rt,{style:{padding:16},children:[e.jsx("p",{style:{fontSize:9,fontWeight:600,color:k.inkLight,textTransform:"uppercase",letterSpacing:1,margin:"0 0 10px"},children:"Parmetros aplicados"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:[`Margen ${pt(t.margen)}`,...o?[`U decl. ${pt(s)}`]:[],`IVA ${pt(t.tarifaIVA)}`,t.medioPago,t.aplicar4x1000==="SI"?"41000":"Sin 41000",`GC ${pt(i.g||0)}`,`GF ${pt(i.f||0)}`,`Coef. ${(i.coefMult||0).toFixed(4)}`].map(a=>e.jsx("span",{style:{background:k.accentBg,color:k.inkMid,fontSize:10,padding:"3px 8px",borderRadius:2,letterSpacing:.4},children:a},a))})]})]})]})}function Kh({d:t,set:i,r:o}){var c;t.pais;const n=t.entregaConfig||{incluirAlcance:!0,incluirEntregables:!0,incluirCronograma:!0,incluirOrganigrama:!1,incluirGlosario:!0,incluirTerminos:!0,incluirCondicionesPago:!0,incluirDesglosePrecio:!1,terminosCondiciones:""},s=(d,l)=>i("entregaConfig",{...n,[d]:l}),r=t.glosarioOferta||[],a=d=>i("glosarioOferta",d),[u,h]=F.useState(""),[b,j]=F.useState("");F.useEffect(()=>{r.length===0&&typeof Ps<"u"&&a(Ps.map(d=>({...d,incluir:!0})))},[]);const C=typeof Bi<"u"?Bi.find(d=>d.id===t.servicioId):null,v=(t.entregablesOferta||[]).filter(d=>d.incluir),m=v.reduce((d,l)=>d+(l.horas||0),0),f={card:{background:"#fff",border:`1px solid ${k.border}`,borderRadius:6,padding:"20px 24px",marginBottom:16},sTitle:{fontSize:9,fontWeight:700,letterSpacing:2.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 14px"}},p=({label:d,desc:l,checked:x,onChange:y})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0",borderBottom:`1px solid ${k.border}`},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:12,fontWeight:600,color:k.ink},children:d}),l&&e.jsx("p",{style:{margin:"2px 0 0",fontSize:10,color:k.inkLight},children:l})]}),e.jsxs("label",{style:{position:"relative",display:"inline-block",width:40,height:22,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:x,onChange:g=>y(g.target.checked),style:{opacity:0,width:0,height:0}}),e.jsx("span",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:x?"#111":"#ccc",borderRadius:22,transition:"all .2s"}}),e.jsx("span",{style:{position:"absolute",top:2,left:x?20:2,width:18,height:18,background:"#fff",borderRadius:"50%",transition:"all .2s",boxShadow:"0 1px 3px rgba(0,0,0,.2)"}})]})]});return e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:f.card,children:[e.jsx("p",{style:f.sTitle,children:"Configurar propuesta para el cliente"}),e.jsx("p",{style:{fontSize:11,color:k.inkLight,margin:"0 0 16px"},children:"Selecciona qu secciones incluir en el documento que recibir el cliente."}),e.jsx(p,{label:"Alcance del servicio",desc:"Descripcin de lo que incluye el servicio contratado",checked:n.incluirAlcance,onChange:d=>s("incluirAlcance",d)}),e.jsx(p,{label:"Listado de entregables",desc:`${v.length} entregables definidos`,checked:n.incluirEntregables,onChange:d=>s("incluirEntregables",d)}),e.jsx(p,{label:"Cronograma estimado",desc:`${Math.ceil(m/8)} das estimados`,checked:n.incluirCronograma,onChange:d=>s("incluirCronograma",d)}),e.jsx(p,{label:"Organigrama del equipo",desc:"Integrantes asignados al proyecto",checked:n.incluirOrganigrama,onChange:d=>s("incluirOrganigrama",d)}),e.jsx(p,{label:"Glosario de trminos",desc:`${r.filter(d=>d.incluir).length} trminos activos`,checked:n.incluirGlosario,onChange:d=>s("incluirGlosario",d)}),e.jsx(p,{label:"Trminos y condiciones",desc:"Clusulas legales y comerciales",checked:n.incluirTerminos,onChange:d=>s("incluirTerminos",d)}),e.jsx(p,{label:"Condiciones de pago",desc:"Hitos de pago y porcentajes",checked:n.incluirCondicionesPago,onChange:d=>s("incluirCondicionesPago",d)}),e.jsx(p,{label:"Desglose de precios",desc:"Mostrar precios unitarios al cliente (no recomendado para diseo)",checked:n.incluirDesglosePrecio,onChange:d=>s("incluirDesglosePrecio",d)})]}),n.incluirGlosario&&e.jsxs("div",{style:f.card,children:[e.jsx("p",{style:f.sTitle,children:"Glosario de trminos"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`},children:[e.jsx("th",{style:{width:30,padding:"6px 0"}}),e.jsx("th",{style:{textAlign:"left",padding:"6px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight},children:"Trmino"}),e.jsx("th",{style:{textAlign:"left",padding:"6px 0",fontSize:8,fontWeight:700,letterSpacing:1.5,textTransform:"uppercase",color:k.inkLight},children:"Definicin"}),e.jsx("th",{style:{width:30}})]})}),e.jsx("tbody",{children:r.map(d=>e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`,opacity:d.incluir?1:.35,transition:"opacity .15s"},children:[e.jsx("td",{style:{padding:"6px 0"},children:e.jsx("input",{type:"checkbox",checked:d.incluir,onChange:()=>a(r.map(l=>l.id===d.id?{...l,incluir:!l.incluir}:l)),style:{width:14,height:14,cursor:"pointer",accentColor:k.ink}})}),e.jsx("td",{style:{padding:"6px 4px",fontSize:11,fontWeight:600,color:k.ink,verticalAlign:"top",width:"25%"},children:d.termino}),e.jsx("td",{style:{padding:"6px 4px",fontSize:11,color:k.inkMid,lineHeight:1.4},children:d.definicion}),e.jsx("td",{children:!Ps.find(l=>l.id===d.id)&&e.jsx("button",{onClick:()=>a(r.filter(l=>l.id!==d.id)),style:{background:"none",border:"none",cursor:"pointer",color:k.error,fontSize:12},children:""})})]},d.id))})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12,alignItems:"flex-end"},children:[e.jsxs("div",{style:{width:"30%"},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:600,color:k.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Trmino"}),e.jsx("input",{value:u,onChange:d=>h(d.target.value),placeholder:"Ej: Bioclimtica",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:3,padding:"7px 10px",fontSize:11,fontFamily:"'DM Sans',sans-serif"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:600,color:k.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Definicin"}),e.jsx("input",{value:b,onChange:d=>j(d.target.value),placeholder:"Definicin del trmino...",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:3,padding:"7px 10px",fontSize:11,fontFamily:"'DM Sans',sans-serif"},onKeyDown:d=>{d.key==="Enter"&&u.trim()&&b.trim()&&(a([...r,{id:"custom_"+Date.now(),termino:u.trim(),definicion:b.trim(),incluir:!0}]),h(""),j(""))}})]}),e.jsx("button",{onClick:()=>{!u.trim()||!b.trim()||(a([...r,{id:"custom_"+Date.now(),termino:u.trim(),definicion:b.trim(),incluir:!0}]),h(""),j(""))},style:{padding:"7px 14px",background:k.ink,color:"#fff",border:"none",borderRadius:3,fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap"},children:"+ Aadir"})]})]}),n.incluirTerminos&&e.jsxs("div",{style:f.card,children:[e.jsx("p",{style:f.sTitle,children:"Trminos y condiciones"}),e.jsx("textarea",{value:n.terminosCondiciones||"",onChange:d=>s("terminosCondiciones",d.target.value),rows:6,placeholder:"Escribe aqu los trminos y condiciones de la propuesta...",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:4,padding:"10px 12px",fontSize:12,fontFamily:"'DM Sans',sans-serif",lineHeight:1.6,resize:"vertical",color:k.ink}})]}),e.jsxs("div",{style:{background:"#F5F4F1",borderRadius:8,padding:"16px 20px",border:`1px solid ${k.border}`},children:[e.jsx("p",{style:{...f.sTitle,marginBottom:10},children:"Resumen de la propuesta"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px 20px",fontSize:11},children:[n.incluirAlcance&&C&&e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{color:"#2E7D32"},children:""})," Alcance: ",((c=C.alcances)==null?void 0:c.length)||0," puntos"]}),n.incluirEntregables&&e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{color:"#2E7D32"},children:""})," ",v.length," entregables"]}),n.incluirCronograma&&e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{color:"#2E7D32"},children:""})," Cronograma: ",Math.ceil(m/8)," das"]}),n.incluirOrganigrama&&e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{color:"#2E7D32"},children:""})," Organigrama del equipo"]}),n.incluirGlosario&&e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{color:"#2E7D32"},children:""})," Glosario: ",r.filter(d=>d.incluir).length," trminos"]}),n.incluirTerminos&&e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{color:"#2E7D32"},children:""})," Trminos y condiciones"]}),n.incluirCondicionesPago&&e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{color:"#2E7D32"},children:""})," Condiciones de pago"]}),n.incluirDesglosePrecio&&e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{color:"#E65100"},children:""})," Desglose de precios visible"]})]})]})]})}const Jh=[{id:"q1",texto:"Cmo califica la calidad del diseo entregado?",tipo:"estrellas"},{id:"q2",texto:"Se cumplieron los plazos pactados?",tipo:"estrellas"},{id:"q3",texto:"La comunicacin con el equipo fue adecuada?",tipo:"estrellas"},{id:"q4",texto:"El presupuesto final se ajust al acordado?",tipo:"estrellas"},{id:"q5",texto:"Recomendara nuestros servicios? (NPS)",tipo:"nps"},{id:"q6",texto:"Qu podramos mejorar?",tipo:"texto"},{id:"q7",texto:"Comentarios adicionales",tipo:"texto"}],Yh=[{id:"p1",texto:"Calidad del material / servicio entregado",tipo:"estrellas"},{id:"p2",texto:"Cumplimiento de plazos de entrega",tipo:"estrellas"},{id:"p3",texto:"Relacin calidad/precio",tipo:"estrellas"},{id:"p4",texto:"Facilidad de comunicacin",tipo:"estrellas"},{id:"p5",texto:"Volvera a contratar este proveedor?",tipo:"sino"},{id:"p6",texto:"Observaciones",tipo:"texto"}];function Xh({offers:t}){const i="hab:crm:encuestas:satisfaccion",o="hab:crm:encuestas:proveedores",[n,s]=F.useState([]),[r,a]=F.useState([]),[u,h]=F.useState("satisfaccion"),[b,j]=F.useState(null),[C,v]=F.useState(null);F.useEffect(()=>{(()=>{try{const E=Fe.getSync(i);E&&s(JSON.parse(E)||[])}catch{}try{const E=Fe.getSync(o);E&&a(JSON.parse(E)||[])}catch{}})()},[]);const m=E=>{s(E);try{Fe.set(i,JSON.stringify(E))}catch{}},f=E=>{a(E);try{Fe.set(o,JSON.stringify(E))}catch{}},p=t.filter(E=>E.estado==="Ganada"),c=()=>Math.random().toString(36).slice(2,9),d=E=>({id:c(),ofertaId:(E==null?void 0:E.id)||"",proyecto:(E==null?void 0:E.proyecto)||"",cliente:(E==null?void 0:E.cliente)||"",fecha:new Date().toISOString().slice(0,10),respuestas:{},estado:"pendiente"}),l=()=>({id:c(),proveedor:"",proyecto:"",fecha:new Date().toISOString().slice(0,10),respuestas:{},estado:"pendiente"}),x=({value:E,onChange:w})=>e.jsxs("div",{style:{display:"flex",gap:2},children:[[1,2,3,4,5].map(I=>e.jsx("button",{onClick:()=>w(I),style:{fontSize:22,background:"none",border:"none",cursor:"pointer",color:I<=(E||0)?"#F5A623":"#DDD",transition:"color .1s"},children:""},I)),E>0&&e.jsxs("span",{style:{fontSize:11,color:k.inkLight,marginLeft:6,alignSelf:"center"},children:[E,"/5"]})]}),y=({value:E,onChange:w})=>e.jsxs("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:[Array.from({length:11},(I,z)=>z).map(I=>e.jsx("button",{onClick:()=>w(I),style:{width:32,height:32,borderRadius:6,border:"1px solid "+(I===E?"#111":"#E0E0E0"),background:I===E?I>=9?"#111111":I>=7?"#F5A623":"#B91C1C":"#fff",color:I===E?"#fff":"#555",fontWeight:I===E?700:400,fontSize:12,cursor:"pointer",transition:"all .1s"},children:I},I)),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",fontSize:9,color:k.inkLight,marginTop:2},children:[e.jsx("span",{children:"Nada probable"}),e.jsx("span",{children:"Muy probable"})]})]}),g=E=>{const w=E.flatMap(I=>Object.values(I.respuestas||{}).filter(z=>typeof z=="number"&&z>=1&&z<=5));return w.length>0?(w.reduce((I,z)=>I+z,0)/w.length).toFixed(1):""},S=E=>{const w=E.map(B=>{var P;return(P=B.respuestas)==null?void 0:P.q5}).filter(B=>typeof B=="number");if(w.length===0)return"";const I=w.filter(B=>B>=9).length,z=w.filter(B=>B<=6).length;return((I-z)/w.length*100).toFixed(0)},A=(E,w,I)=>e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:16},children:E.map(z=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:12,fontWeight:600,color:k.ink,marginBottom:6},children:z.texto}),z.tipo==="estrellas"&&e.jsx(x,{value:w[z.id]||0,onChange:B=>I({...w,[z.id]:B})}),z.tipo==="nps"&&e.jsx(y,{value:w[z.id],onChange:B=>I({...w,[z.id]:B})}),z.tipo==="sino"&&e.jsx("div",{style:{display:"flex",gap:8},children:["S","No","Con reservas"].map(B=>e.jsx("button",{onClick:()=>I({...w,[z.id]:B}),style:{padding:"6px 16px",borderRadius:6,border:`1px solid ${w[z.id]===B?"#111":"#E0E0E0"}`,background:w[z.id]===B?"#111":"#fff",color:w[z.id]===B?"#fff":"#555",fontSize:12,cursor:"pointer",fontWeight:w[z.id]===B?600:400},children:B},B))}),z.tipo==="texto"&&e.jsx("textarea",{value:w[z.id]||"",onChange:B=>I({...w,[z.id]:B.target.value}),rows:2,placeholder:"Escribe aqu...",style:{width:"100%",border:`1px solid ${k.border}`,borderRadius:6,padding:"8px 10px",fontSize:12,fontFamily:"'DM Sans',sans-serif",resize:"vertical"}})]},z.id))});return e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:0},children:"Encuestas ISO 9001"}),e.jsx("p",{style:{fontSize:12,color:k.inkLight,margin:"3px 0 0"},children:"Satisfaccin del cliente y evaluacin de proveedores"})]})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(160px,1fr))",gap:10,marginBottom:16},children:[["Enc. satisfaccin",n.length,"#111111"],["Promedio general",g(n)+"","#F5A623"],["NPS Score",S(n),"#3B3B3B"],["Eval. proveedores",r.length,"#8C6A00"],["Promedio proveed.",g(r)+"","#F5A623"]].map(([E,w,I])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"10px 12px",borderLeft:"3px solid "+I},children:[e.jsx("div",{style:{fontSize:9,color:"#888",marginBottom:2},children:E}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:I,fontFamily:"'DM Mono',monospace"},children:w})]},E))}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:16},children:[["satisfaccion","Satisfaccin cliente"],["proveedores","Evaluacin proveedores"]].map(([E,w])=>e.jsx("button",{onClick:()=>h(E),style:{padding:"8px 18px",border:`1px solid ${k.border}`,borderRadius:E==="satisfaccion"?"6px 0 0 6px":"0 6px 6px 0",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:u===E?"#111":"#fff",color:u===E?"#fff":"#555"},children:w},E))}),u==="satisfaccion"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsxs("select",{onChange:E=>{if(E.target.value){const w=p.find(I=>I.id===E.target.value);j(d(w)),E.target.value=""}},style:{border:`1px solid ${k.border}`,borderRadius:6,padding:"7px 12px",fontSize:12,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("option",{value:"",children:"+ Nueva encuesta desde oferta ganada..."}),p.map(E=>e.jsx("option",{value:E.id,children:E.proyecto||E.cliente||E.id},E.id))]}),e.jsxs("button",{onClick:()=>j(d({})),style:{padding:"7px 14px",border:"none",borderRadius:6,background:"#111111",color:"#fff",cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ne,{size:12})," Nueva en blanco"]})]}),b&&e.jsxs(rt,{style:{padding:22,marginBottom:16,borderLeft:"3px solid #111111"},children:[e.jsx(Mt,{t:"Encuesta de satisfaccin",s:b.proyecto||"Proyecto sin nombre"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsx(ot,{lbl:"Cliente",val:b.cliente,on:E=>j(w=>({...w,cliente:E.target.value}))}),e.jsx(ot,{lbl:"Proyecto",val:b.proyecto,on:E=>j(w=>({...w,proyecto:E.target.value}))})]}),A(Jh,b.respuestas,E=>j(w=>({...w,respuestas:E}))),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[e.jsx(ht,{icon:yt,on:()=>{const E={...b,estado:"completada"},w=n.find(I=>I.id===b.id);m(w?n.map(I=>I.id===b.id?E:I):[...n,E]),j(null)},children:"Guardar"}),e.jsx(ht,{v:"out",on:()=>j(null),children:"Cancelar"})]})]}),n.length>0&&e.jsx("div",{style:{border:`1px solid ${k.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Cliente","Proyecto","Promedio","NPS","Estado",""].map(E=>e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,borderBottom:"2px solid #E0E0E0"},children:E},E))})}),e.jsx("tbody",{children:n.map((E,w)=>{var B;const I=Object.entries(E.respuestas||{}).filter(([P,q])=>typeof q=="number"&&q>=1&&q<=5),z=I.length>0?(I.reduce((P,[,q])=>P+q,0)/I.length).toFixed(1):"";return e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`,background:w%2?"#F9F8F5":"#fff"},children:[e.jsx("td",{style:{padding:"8px 12px"},children:E.fecha}),e.jsx("td",{style:{padding:"8px 12px",fontWeight:600},children:E.cliente||""}),e.jsx("td",{style:{padding:"8px 12px"},children:E.proyecto||""}),e.jsxs("td",{style:{padding:"8px 12px",color:"#F5A623",fontWeight:700},children:[z,""]}),e.jsx("td",{style:{padding:"8px 12px",fontFamily:"'DM Mono',monospace"},children:((B=E.respuestas)==null?void 0:B.q5)??"-"}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("span",{style:{background:E.estado==="completada"?"#E6F4EC":"#FFF3E0",color:E.estado==="completada"?"#111111":"#F5A623",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:600},children:E.estado})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>j({...E}),style:{background:"none",border:"none",cursor:"pointer",color:k.ink},children:e.jsx(No,{size:12})}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar?")&&m(n.filter(P=>P.id!==E.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:12})})]})})]},E.id)})})]})})]}),u==="proveedores"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:14},children:e.jsxs("button",{onClick:()=>v(l()),style:{padding:"7px 14px",border:"none",borderRadius:6,background:"#8C6A00",color:"#fff",cursor:"pointer",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Ne,{size:12})," Evaluar proveedor"]})}),C&&e.jsxs(rt,{style:{padding:22,marginBottom:16,borderLeft:"3px solid #8C6A00"},children:[e.jsx(Mt,{t:"Evaluacin de proveedor",s:""}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsx(ot,{lbl:"Proveedor",val:C.proveedor,on:E=>v(w=>({...w,proveedor:E.target.value}))}),e.jsx(ot,{lbl:"Proyecto / Referencia",val:C.proyecto,on:E=>v(w=>({...w,proyecto:E.target.value}))})]}),A(Yh,C.respuestas,E=>v(w=>({...w,respuestas:E}))),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[e.jsx(ht,{icon:yt,on:()=>{const E={...C,estado:"completada"},w=r.find(I=>I.id===C.id);f(w?r.map(I=>I.id===C.id?E:I):[...r,E]),v(null)},children:"Guardar"}),e.jsx(ht,{v:"out",on:()=>v(null),children:"Cancelar"})]})]}),r.length>0&&e.jsx("div",{style:{border:`1px solid ${k.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Proveedor","Proyecto","Promedio","Repetir?","Estado",""].map(E=>e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,borderBottom:"2px solid #E0E0E0"},children:E},E))})}),e.jsx("tbody",{children:r.map((E,w)=>{var B;const I=Object.entries(E.respuestas||{}).filter(([P,q])=>typeof q=="number"&&q>=1&&q<=5),z=I.length>0?(I.reduce((P,[,q])=>P+q,0)/I.length).toFixed(1):"";return e.jsxs("tr",{style:{borderBottom:`1px solid ${k.border}`,background:w%2?"#F9F8F5":"#fff"},children:[e.jsx("td",{style:{padding:"8px 12px"},children:E.fecha}),e.jsx("td",{style:{padding:"8px 12px",fontWeight:600},children:E.proveedor||""}),e.jsx("td",{style:{padding:"8px 12px"},children:E.proyecto||""}),e.jsxs("td",{style:{padding:"8px 12px",color:"#F5A623",fontWeight:700},children:[z,""]}),e.jsx("td",{style:{padding:"8px 12px"},children:((B=E.respuestas)==null?void 0:B.p5)||""}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("span",{style:{background:E.estado==="completada"?"#E6F4EC":"#FFF3E0",color:E.estado==="completada"?"#111111":"#F5A623",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:600},children:E.estado})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>v({...E}),style:{background:"none",border:"none",cursor:"pointer",color:k.ink},children:e.jsx(No,{size:12})}),e.jsx("button",{onClick:()=>{window.confirm("Eliminar?")&&f(r.filter(P=>P.id!==E.id))},style:{background:"none",border:"none",cursor:"pointer",color:"#B91C1C"},children:e.jsx(Je,{size:12})})]})})]},E.id)})})]})})]})]})}function Qh(){return e.jsxs("div",{className:"fade",children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2.5,textTransform:"uppercase",color:k.inkLight,margin:"0 0 6px"},children:"Sistema"}),e.jsx("h1",{style:{fontFamily:"'DM Sans', sans-serif",fontSize:28,fontWeight:700,color:k.ink,margin:"0 0 28px",letterSpacing:-.5},children:"Configuracin"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[e.jsxs(rt,{style:{padding:24},children:[e.jsx(Mt,{t:"Marca",s:"Identidad visual aplicada"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:20},children:[e.jsx("div",{style:{background:k.ink,borderRadius:3,padding:"16px"},children:e.jsx(Ga,{size:44,color:"#fff"})}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 2px",fontFamily:"'DM Sans', sans-serif",fontSize:16,fontWeight:700,color:k.ink},children:"Habitaris"}),e.jsx("p",{style:{margin:"0 0 2px",fontSize:11,color:k.inkLight},children:"Tipografa: DM Sans (sans-serif)"}),e.jsx("p",{style:{margin:0,fontSize:11,color:k.inkLight},children:"Paleta: B&W + off-white. Manual 2025 "})]})]}),e.jsx("div",{style:{background:k.accentBg,borderRadius:2,padding:"12px 16px",border:`1px dashed ${k.borderMid}`},children:e.jsx("p",{style:{margin:0,fontSize:11,color:k.inkMid},children:"Una sola familia tipogrfica sans-serif segn manual. Sin serif."})})]}),e.jsxs(rt,{style:{padding:24},children:[e.jsx(Mt,{t:"Datos",s:"Almacenamiento local persistente"}),e.jsx("p",{style:{fontSize:12,color:k.inkMid,margin:"0 0 16px",lineHeight:1.6},children:"Los datos se guardan en tu navegador. No requieren servidor ni cuenta externa."}),e.jsx(ht,{v:"danger",icon:Je,on:async()=>{window.confirm("Eliminar TODOS los datos? Irreversible.")&&(Fe.delete("hab:v4"),window.location.reload())},children:"Borrar todos los datos"})]})]})]})}function Zh({lang:t}){const[i,o]=F.useState(t||"es");F.useEffect(()=>{t&&o(t)},[t]);const[n,s]=F.useState("dashboard"),[r,a]=F.useState(!1),[u,h]=F.useState([]),[b,j]=F.useState(null),[C,v]=F.useState(!0);F.useEffect(()=>{oh().then(y=>{h(y),v(!1)})},[]);const m=F.useCallback(async y=>{const g=u.some(S=>S.id===y.id)?u.map(S=>S.id===y.id?y:S):[...u,y];h(g),await Ds(g)},[u]),f=F.useCallback(async y=>{if(!window.confirm("Eliminar esta oferta?"))return;const g=u.filter(S=>S.id!==y);h(g),await Ds(g)},[u]),p=F.useCallback(async y=>{const g=u.find(E=>E.id===y);if(!g)return;const S={...g,id:zt(),createdAt:qt(),updatedAt:qt(),estado:"Borrador",proyecto:(g.proyecto||"")+" (copia)",relacionadaCon:y},A=[...u,S];h(A),await Ds(A)},[u]),[c,d]=F.useState(null),l=F.useCallback((y,g)=>{if(u.some(S=>S.briefingId===y.id)){alert("Ya existe una oferta creada desde este briefing");return}d(Ra(y)),g("offer-new")},[u]),x=F.useCallback(async y=>{const g=Qd(y);try{const S=Fe.getSync("hab:crm:clientes2"),A=S?JSON.parse(S)||[]:[],E=A.find(w=>w.email&&w.email===g.email);if(E){alert(` Ya existe un cliente con email ${g.email}: "${E.nombre}"`),s("clientes");return}A.push(g),Fe.set("hab:crm:clientes2",JSON.stringify(A)),alert(` Cliente "${g.nombre}" creado desde briefing`)}catch{alert("Error guardando cliente")}s("clientes")},[]);return C?e.jsxs(e.Fragment,{children:[e.jsx(Rl,{}),e.jsx("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:k.bg},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(Ga,{size:52,color:k.ink}),e.jsx("div",{style:{width:28,height:28,border:`2px solid ${k.border}`,borderTopColor:k.ink,borderRadius:"50%",animation:"spin .7s linear infinite",margin:"18px auto 0"}})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Rl,{}),e.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:k.bg,minWidth:0},children:[e.jsx(xh,{view:n,sv:s,lang:i,setLang:o,open:r,toggle:()=>a(!r)}),e.jsxs("main",{style:{marginLeft:r?200:0,flex:1,padding:"32px 36px",maxWidth:r?"calc(100vw - 200px)":"100vw",overflowX:"auto",transition:"margin-left .2s ease, max-width .2s ease"},children:[n==="dashboard"&&e.jsx(mh,{offers:u,sv:s,sei:j,lang:i}),n==="offers"&&e.jsx(bh,{offers:u,sv:s,sei:j,onDel:f,onDup:p}),(n==="offer-new"||n==="offer-edit")&&e.jsx(Ph,{lang:i,offers:u,editId:n==="offer-edit"?b:null,prefillData:n==="offer-new"?c:null,onSave:async y=>{d(null),await m(y)},onBack:()=>{d(null),s("offers")}}),n==="formularios"&&e.jsx(uh,{sv:s,onCreateOfferFromBriefing:l,onCreateClientFromBriefing:x}),n==="clientes"&&e.jsx(gh,{}),n==="proveedores"&&e.jsx(hh,{}),n==="encuestas"&&e.jsx(Xh,{offers:u}),n==="settings"&&e.jsx(Qh,{})]})]})]})}const ef=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input, select, textarea { font-family: 'DM Sans', sans-serif; outline: none; }
    button { font-family: 'DM Sans', sans-serif; cursor: pointer; }
    @keyframes fadeUp   { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    @keyframes fadeIn   { from { opacity:0; } to { opacity:1; } }
    @keyframes slideIn  { from { transform:translateX(-6px); opacity:0; } to { transform:translateX(0); opacity:1; } }
    @keyframes popIn    { from { transform:scale(.95); opacity:0; } to { transform:scale(1); opacity:1; } }
    .fade-up  { animation: fadeUp .22s ease both; }
    .fade-in  { animation: fadeIn .18s ease both; }
    .pop-in   { animation: popIn .18s ease both; }
    .mono     { font-family: 'DM Mono', monospace; }
  `}),D={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",sidebar:"#0D0D0D",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",borderMid:"#C8C5BE",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",greenLight:"#D0EBDA",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.05)",shadowMd:"0 8px 32px rgba(0,0,0,.12)",card:"#FFFFFF",greenL:"#D0EBDA",redL:"#FAE8E8",blueL:"#F0F0F0",amberL:"#FAF0E0",teal:"#0D7377",tealL:"#E0F4F4"},Se=D,Qi=()=>Math.random().toString(36).slice(2,9),xi=()=>new Date().toISOString().slice(0,10),tc=()=>new Date().toISOString(),Da=t=>{if(!t)return"";try{return new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"})}catch{return t}},tf=["Trmino indefinido","Trmino fijo","Obra o labor","Prestacin de servicios","Aprendizaje"],of=["Indefinido","Temporal","Formacin","Prcticas","Obra o servicio","Autnomo"],At=(t,i=0)=>t==null||t===""?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:i,maximumFractionDigits:i}).format(Number(t)),yi=(t,i=0)=>new Intl.NumberFormat("es-CO",{minimumFractionDigits:i,maximumFractionDigits:i}).format(Number(t)||0),Os=t=>`${(Number(t)||0).toFixed(1)}%`,mi={cargos:"hab:rrhh:cargos",asistencia:"hab:rrhh:asistencia",jornada:"hab:rrhh:jornada",activos:"hab:rrhh:activos",licencias:"hab:rrhh:licencias",gastos:"hab:rrhh:gastos",partes:"hab:rrhh:partes",empleados:"hab:rrhh:empleados",novedades:"hab:rrhh:novedades",fichas:"hab:rrhh:fichas",docs:"hab:rrhh:docs",equipos:"hab:rrhh:equipos"},bi=(t,i)=>{const[o,n]=F.useState(i),[s,r]=F.useState(!1);F.useEffect(()=>{Fe.get(t).then(u=>{u!=null&&n(u),r(!0)})},[t]);const a=F.useCallback(async u=>{const h=typeof u=="function"?u(o):u;n(h),Fe.set(t,h)},[t,o]);return[o,a,s]},nf={hDia:8,diasSemana:5,semanasAnio:50,pctProductivas:75,diasVacaciones:15,diasFestivos:18,diasAusencias:5},rf=()=>({id:Qi(),nombre:"",salarioBruto:0,prestaciones:52.18,segSocial:12.5,parafiscales:9,activo:!0,fechaIngreso:xi()}),Ls=(t="")=>({nombre:t,apellidos:"",email:"",telefono:"",fechaNacimiento:"",tipoDocumento:"CC",numeroDocumento:"",cargo:"",tipoContrato:"",fechaIngreso:"",salarioBruto:0,eps:"",afp:"",arl:"",cajaCompensacion:"",entidadBancaria:"",tipoCuenta:"",cuentaBancaria:""}),Ws=[{cat:"Equipos de Cmputo",vida:3,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"PCs, porttiles, tablets, servidores",icono:"",usoRef:1760},{cat:"Impresoras y Plotters",vida:3,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Impresoras, escneres, plotters",icono:"",usoRef:1200},{cat:"Equipos de Medicin",vida:5,metodo:"Lnea recta",base:"NIIF S.17",nota:"Distancimetros, niveles lser, estaciones totales",icono:"",usoRef:800},{cat:"Mobiliario y Enseres",vida:10,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Mesas, sillas, archivadores, muebles oficina",icono:"",usoRef:1760},{cat:"Equipos de Oficina",vida:5,metodo:"Lnea recta",base:"NIIF S.17",nota:"Telfonos, proyectores, pantallas externas",icono:"",usoRef:1200},{cat:"Vehculos",vida:5,metodo:"Lnea recta",base:"NIIF S.17 / Art.137 E.T.",nota:"Automviles, camionetas, motocicletas",icono:"",usoRef:1500},{cat:"Maquinaria y Equipo",vida:10,metodo:"Lnea recta",base:"NIIF S.17",nota:"Maquinaria de obra, herramientas especializadas",icono:"",usoRef:1200},{cat:"Mejoras Locativas",vida:10,metodo:"Lnea recta",base:"NIIF S.17 / NIC 16",nota:"Adecuaciones a espacios arrendados",icono:"",usoRef:1760},{cat:"Software licencia perpetua",vida:3,metodo:"Lnea recta",base:"NIIF S.18 Intangibles",nota:"CAD, BIM, render (licencias de compra nica)",icono:"",usoRef:1760},{cat:"Otro / Personalizado",vida:5,metodo:"Lnea recta",base:"Manual",nota:"Define la vida til manualmente",icono:"",usoRef:1760}],Pi=new Date().getFullYear(),sf=()=>({id:Qi(),nombre:"",categoria:"",valorCompra:0,anioCompra:Pi,vidaUtilAnios:5,metodo:"Lnea recta",usoAnual:1760,baseNiif:"",activo:!0,vidaUtilEditada:!1}),af=()=>({id:Qi(),nombre:"",plan:"",costoAnual:0,usuarios:1,activo:!0}),lf=()=>({id:Qi(),concepto:"",montoMensual:0,categoria:"Oficina"}),bn=[{id:"vacaciones",lbl:"Vacaciones",icono:"",color:"#111111",bg:"#E8F4EE",requiereDoc:!1,requiereFechas:!0,requiereHoras:!1},{id:"baja",lbl:"Baja Mdica",icono:"",color:"#B91C1C",bg:"#FAE8E8",requiereDoc:!0,requiereFechas:!0,requiereHoras:!1},{id:"permiso",lbl:"Permiso / Ausencia",icono:"",color:"#8C6A00",bg:"#FAF0E0",requiereDoc:!1,requiereFechas:!1,requiereHoras:!0},{id:"horasExtra",lbl:"Horas Extra",icono:"",color:"#3B3B3B",bg:"#F0F0F0",requiereDoc:!1,requiereFechas:!1,requiereHoras:!0},{id:"licEspecial",lbl:"Licencia Especial",icono:"",color:"#5B3A8C",bg:"#EDE8F4",requiereDoc:!0,requiereFechas:!0,requiereHoras:!1},{id:"otro",lbl:"Otro",icono:"",color:"#555555",bg:"#EDEBE7",requiereDoc:!1,requiereFechas:!1,requiereHoras:!1}],df=["Cita mdica personal","Cita mdica familiar","Trmite personal","Asuntos acadmicos / formacin","Duelo familiar","Matrimonio","Mudanza","Asuntos legales","Otro"],cf=["Licencia de maternidad","Licencia de paternidad","Licencia por luto","Licencia por matrimonio","Licencia por fuerza mayor","Otra licencia especial"],pf=(t="")=>({id:Qi(),empleadoNombre:t,tipo:"",estado:"Pendiente",fechaSolicitud:xi(),fechaInicio:xi(),fechaFin:"",dias:0,horas:0,motivo:"",descripcion:"",docNombre:"",docBase64:"",comentarioAdmin:"",fechaResolucion:""}),$l=()=>({id:Qi(),empleadoId:"",empleadoNombre:"",fecha:xi(),otCodigo:"",actividad:"",horasNormales:0,horasExtra:0,horasNoProd:0,descripcion:"",estado:"Borrador"}),uf=["encargado","supervisor","jefe_obra","residente","admin","superadmin"],Ht=({children:t})=>e.jsx("span",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",fontWeight:700,color:D.inkLight},children:t}),Ut=({children:t,color:i=D.inkLight,bg:o=D.accent})=>e.jsx("span",{style:{display:"inline-flex",alignItems:"center",fontSize:9,fontWeight:700,letterSpacing:1.2,textTransform:"uppercase",padding:"2px 8px",borderRadius:2,background:o,color:i,flexShrink:0},children:t}),si=({children:t,gap:i=12,align:o="flex-start",wrap:n=!1,style:s={}})=>e.jsx("div",{style:{display:"flex",gap:i,alignItems:o,flexWrap:n?"wrap":"nowrap",...s},children:t}),Ei=({children:t,flex:i=1,style:o={}})=>e.jsx("div",{style:{flex:i,minWidth:0,...o},children:t}),oo=({label:t,value:i,onChange:o,type:n="text",placeholder:s="",readOnly:r=!1,note:a="",...u})=>e.jsxs("div",{children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:D.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),e.jsx("input",{type:n,value:i??"",onChange:o,placeholder:s,readOnly:r,style:{width:"100%",padding:"7px 10px",border:`1px solid ${D.border}`,borderRadius:3,fontSize:12,color:D.ink,background:r?D.accent:D.surface,fontFamily:"'DM Sans',sans-serif"},...u}),a&&e.jsx("p",{style:{fontSize:10,color:D.inkLight,marginTop:3},children:a})]}),it=({children:t,onClick:i,variant:o="ghost",small:n,disabled:s,icon:r,style:a={}})=>{const u={primary:{background:D.ink,color:"#fff",border:"none"},ghost:{background:D.accent,color:D.inkMid,border:`1px solid ${D.border}`},danger:{background:D.redBg,color:D.red,border:`1px solid ${D.red}33`},success:{background:D.greenBg,color:D.green,border:`1px solid ${D.green}33`},outline:{background:"transparent",color:D.inkMid,border:`1px solid ${D.border}`}};return e.jsxs("button",{onClick:i,disabled:s,style:{display:"inline-flex",alignItems:"center",gap:5,padding:n?"5px 10px":"7px 14px",borderRadius:3,fontSize:n?10:11,fontWeight:600,letterSpacing:.5,transition:"opacity .12s",opacity:s?.45:1,...u[o],...a},children:[r&&e.jsx(r,{size:n?10:12}),t]})},vt=({value:t,onChange:i,placeholder:o,type:n="text",small:s,style:r={},readOnly:a})=>e.jsx("input",{type:n,value:t??"",onChange:u=>i==null?void 0:i(u.target.value),placeholder:o,readOnly:a,style:{width:"100%",padding:s?"5px 8px":"7px 10px",background:a?D.accent:D.surface,border:`1px solid ${D.border}`,borderRadius:3,fontSize:12,color:D.ink,transition:"border-color .12s",...r},onFocus:u=>!a&&(u.target.style.borderColor=D.borderMid),onBlur:u=>u.target.style.borderColor=D.border}),vi=({value:t,onChange:i,options:o,small:n,style:s={}})=>e.jsx("select",{value:t??"",onChange:r=>i(r.target.value),style:{width:"100%",padding:n?"5px 8px":"7px 10px",background:D.surface,border:`1px solid ${D.border}`,borderRadius:3,fontSize:12,color:D.ink,appearance:"none",...s},children:o.map(r=>e.jsx("option",{value:r.value??r,children:r.label??r},r.value??r))}),Pl=({label:t,value:i,onChange:o,options:n,...s})=>e.jsxs("div",{children:[t&&e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:D.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),e.jsx("select",{value:i??"",onChange:o,style:{width:"100%",padding:"7px 10px",background:D.surface,border:`1px solid ${D.border}`,borderRadius:3,fontSize:12,color:D.ink,appearance:"none"},children:(n||[]).map(r=>e.jsx("option",{value:r.value??r,children:r.label??r},r.value??r))})]}),dn=({children:t})=>e.jsx("label",{style:{display:"block",fontSize:10,fontWeight:600,color:D.inkLight,marginBottom:4,textTransform:"uppercase",letterSpacing:.8},children:t}),ic=({icon:t,children:i,color:o})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12},children:[t&&e.jsx(t,{size:15,style:{color:o||D.ink,flexShrink:0}}),e.jsx("span",{style:{fontSize:14,fontWeight:700,color:o||D.ink},children:i})]}),jt=({label:t,children:i,note:o})=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"180px 1fr",gap:12,alignItems:"center",marginBottom:10},children:[e.jsxs("div",{children:[e.jsx(Ht,{children:t}),o&&e.jsx("div",{style:{fontSize:9,color:D.inkLight,marginTop:2},children:o})]}),i]}),Zt=({children:t,style:i={}})=>e.jsx("div",{style:{background:D.surface,border:`1px solid ${D.border}`,borderRadius:4,padding:"18px 20px",boxShadow:D.shadow,...i},children:t}),so=({children:t,action:i})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("h3",{style:{fontSize:13,fontWeight:700,letterSpacing:.3,color:D.ink},children:t}),i]}),ti=({label:t,value:i,sub:o,color:n=D.ink,icon:s})=>e.jsxs("div",{style:{background:D.surface,border:`1px solid ${D.border}`,borderRadius:4,padding:"14px 16px",flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx(Ht,{children:t}),s&&e.jsx(s,{size:13,color:D.inkXLight})]}),e.jsx("div",{style:{marginTop:8,fontSize:22,fontWeight:700,color:n,lineHeight:1},className:"mono",children:i}),o&&e.jsx("div",{style:{marginTop:4,fontSize:10,color:D.inkLight},children:o})]});function gf({cargos:t,saveCargos:i,jornada:o}){const[n,s]=F.useState(null),[r,a]=F.useState(!1),u=F.useMemo(()=>{const c=o;return(c.diasSemana*c.semanasAnio-c.diasFestivos-c.diasAusencias)*c.hDia*(c.pctProductivas/100)},[o]),h=c=>{const d=Number(c.salarioBruto)||0,l=1+(Number(c.prestaciones)+Number(c.segSocial)+Number(c.parafiscales))/100;return d*l},b=c=>u>0?h(c)/u:0,j=()=>{s(rf()),a(!0)},C=c=>{s({...c}),a(!1)},v=()=>s(null),m=()=>{n.nombre&&(i(c=>r?[...c,n]:c.map(d=>d.id===n.id?n:d)),v())},f=c=>i(d=>d.filter(l=>l.id!==c)),p=(c,d)=>s(l=>({...l,[c]:d}));return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ti,{label:"Cargos activos",value:t.filter(c=>c.activo).length,icon:Ri}),e.jsx(ti,{label:"Masa salarial/mes",value:At(t.filter(c=>c.activo).reduce((c,d)=>c+h(d)/12,0)),icon:xr}),e.jsx(ti,{label:"Horas productivas/ao",value:yi(u),sub:"por empleado (config. en Jornada)",icon:ys,color:D.blue}),e.jsx(ti,{label:"Rango coste/hora",value:t.length?`${At(Math.min(...t.map(b)))}  ${At(Math.max(...t.map(b)))}`:"",sub:"sin estructura",icon:Yi,color:D.green})]}),e.jsxs(Zt,{children:[e.jsx(so,{action:e.jsxs(it,{variant:"primary",small:!0,onClick:j,children:[e.jsx(Ne,{size:12}),"Nuevo cargo"]}),children:"Cargos y Salarios"}),t.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:D.inkLight},children:[e.jsx(Ri,{size:32,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{fontSize:12},children:"Sin cargos registrados. Aade el primero."})]}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`2px solid ${D.border}`},children:["Cargo","Salario bruto/ao","Prestac.","Seg. Social","Parafiscal","Costo total/ao","Costo/hora",""].map(c=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:D.inkLight,fontWeight:700},children:c},c))})}),e.jsx("tbody",{children:t.map(c=>e.jsxs("tr",{style:{borderBottom:`1px solid ${D.border}`,transition:"background .1s"},onMouseEnter:d=>d.currentTarget.style.background=D.surfaceAlt,onMouseLeave:d=>d.currentTarget.style.background="",children:[e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("span",{style:{fontWeight:600,color:D.ink},children:c.nombre||""}),!c.activo&&e.jsx(Ut,{color:D.amber,bg:D.amberBg,style:{marginLeft:6},children:"Inactivo"})]}),e.jsx("td",{style:{padding:"10px 10px"},className:"mono",children:At(c.salarioBruto)}),e.jsx("td",{style:{padding:"10px 10px",color:D.inkMid},className:"mono",children:Os(c.prestaciones)}),e.jsx("td",{style:{padding:"10px 10px",color:D.inkMid},className:"mono",children:Os(c.segSocial)}),e.jsx("td",{style:{padding:"10px 10px",color:D.inkMid},className:"mono",children:Os(c.parafiscales)}),e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},className:"mono",children:At(h(c))}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Ut,{color:D.green,bg:D.greenBg,children:[At(b(c)),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(it,{small:!0,variant:"ghost",onClick:()=>C(c),children:e.jsx(ro,{size:11})}),e.jsx(it,{small:!0,variant:"danger",onClick:()=>f(c.id),children:e.jsx(Je,{size:11})})]})})]},c.id))})]})})]}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:v,children:e.jsxs("div",{className:"pop-in",style:{background:D.surface,borderRadius:6,padding:28,width:480,boxShadow:D.shadowMd},onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:20,fontSize:15,fontWeight:700},children:r?"Nuevo cargo":"Editar cargo"}),e.jsx(jt,{label:"Nombre del cargo",children:e.jsx(vt,{value:n.nombre,onChange:c=>p("nombre",c),placeholder:"Ej. Diseador Senior"})}),e.jsx(jt,{label:"Salario bruto anual",note:"COP  sin prestaciones",children:e.jsx(vt,{type:"number",value:n.salarioBruto,onChange:c=>p("salarioBruto",c)})}),e.jsxs("div",{style:{background:D.accent,borderRadius:3,padding:"12px 14px",marginBottom:12},children:[e.jsx("p",{style:{fontSize:10,color:D.inkLight,marginBottom:8},children:"CARGAS SOCIALES SOBRE SALARIO"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[{k:"prestaciones",lbl:"Prestaciones (%)",note:"~52.18"},{k:"segSocial",lbl:"Seg. Social (%)",note:"~12.5"},{k:"parafiscales",lbl:"Parafiscales (%)",note:"~9.0"}].map(c=>e.jsxs("div",{children:[e.jsx(Ht,{children:c.lbl}),e.jsx(vt,{type:"number",value:n[c.k],onChange:d=>p(c.k,d),small:!0,style:{marginTop:4}})]},c.k))})]}),n.salarioBruto>0&&e.jsxs("div",{style:{background:D.greenBg,borderRadius:3,padding:"10px 14px",marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontSize:11,color:D.green},children:"Costo total empleador/ao"}),e.jsx("strong",{style:{fontSize:13,color:D.green},className:"mono",children:At(h(n))})]}),e.jsx(jt,{label:"Estado",children:e.jsx(vi,{value:n.activo?"true":"false",onChange:c=>p("activo",c==="true"),options:[{value:"true",label:"Activo"},{value:"false",label:"Inactivo"}]})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:20,paddingTop:16,borderTop:`1px solid ${D.border}`},children:[e.jsx(it,{variant:"outline",onClick:v,children:"Cancelar"}),e.jsxs(it,{variant:"primary",onClick:m,children:[e.jsx(ko,{size:12}),"Guardar"]})]})]})})]})}function hf({jornada:t,saveJornada:i}){const[o,n]=F.useState({...t}),[s,r]=F.useState(!1),a=(f,p)=>n(c=>({...c,[f]:Number(p)||0})),u=F.useMemo(()=>o.diasSemana*o.semanasAnio-o.diasFestivos-o.diasAusencias,[o]),h=u*o.hDia,b=h*(o.pctProductivas/100),j=o.diasVacaciones*o.hDia,C=Math.max(0,b-j),v=async()=>{await i(o),r(!0),setTimeout(()=>r(!1),2e3)},m=(f,p,c,d="")=>e.jsxs("div",{style:{background:D.surface,border:`1px solid ${D.border}`,borderRadius:3,padding:"12px 14px"},children:[e.jsx(Ht,{children:f}),c&&e.jsx("div",{style:{fontSize:9,color:D.inkLight,marginTop:1,marginBottom:6},children:c}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginTop:c?0:6},children:[e.jsx(vt,{type:"number",value:o[p],onChange:l=>a(p,l),style:{flex:1}}),d&&e.jsx("span",{style:{fontSize:11,color:D.inkLight,whiteSpace:"nowrap"},children:d})]})]},p);return e.jsx("div",{className:"fade-up",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1.2fr",gap:16},children:[e.jsx("div",{children:e.jsxs(Zt,{children:[e.jsx(so,{children:"Configuracin de jornada"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[m("Horas por da","hDia",null,"h/da"),m("Das a la semana","diasSemana",null,"das"),m("Semanas al ao","semanasAnio",null,"semanas"),m("% Horas productivas","pctProductivas","Reuniones, dessp., admin.","%"),m("Das de vacaciones","diasVacaciones","Segn contrato","das/ao"),m("Festivos nacionales","diasFestivos","Colombia 2025","das"),m("Ausencias estimadas","diasAusencias","Prom. bajas / permisos","das/ao")]}),e.jsx("div",{style:{marginTop:14,display:"flex",justifyContent:"flex-end"},children:e.jsx(it,{variant:"primary",onClick:v,children:s?e.jsxs(e.Fragment,{children:[e.jsx(Vo,{size:12}),"Guardado"]}):e.jsxs(e.Fragment,{children:[e.jsx(ko,{size:12}),"Guardar"]})})})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxs(Zt,{children:[e.jsx(so,{children:"Clculo anual por empleado"}),[{lbl:"Das laborales brutos",val:yi(o.diasSemana*o.semanasAnio),unit:"das"},{lbl:"Menos festivos",val:` ${o.diasFestivos}`,unit:"das",color:D.red},{lbl:"Menos ausencias estimadas",val:` ${o.diasAusencias}`,unit:"das",color:D.amber},{lbl:"Das laborales efectivos",val:yi(u),unit:"das",bold:!0},null,{lbl:"Horas brutas totales",val:yi(h),unit:"h"},{lbl:"Horas productivas efectivas",val:yi(b),unit:"h",color:D.inkMid},{lbl:"Menos horas vacaciones",val:` ${j}`,unit:"h",color:D.red}].map((f,p)=>f===null?e.jsx("div",{style:{borderTop:`1px dashed ${D.border}`,margin:"6px 0"}},p):e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0"},children:[e.jsx("span",{style:{fontSize:12,color:D.inkMid},children:f.lbl}),e.jsxs("span",{style:{fontSize:12,fontWeight:f.bold?700:400,color:f.color||D.ink},className:"mono",children:[f.val," ",e.jsx("span",{style:{color:D.inkLight,fontSize:10},children:f.unit})]})]},p)),e.jsxs("div",{style:{marginTop:10,background:D.greenBg,borderRadius:3,padding:"12px 14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(Ht,{children:"Horas productivas netas / ao"}),e.jsx("div",{style:{fontSize:9,color:D.green,marginTop:2},children:"Base para clculo de coste/hora"})]}),e.jsx("span",{style:{fontSize:26,fontWeight:800,color:D.green},className:"mono",children:yi(C)})]})]}),e.jsxs(Zt,{children:[e.jsx(so,{children:"Cmo se usa este dato?"}),e.jsxs("p",{style:{fontSize:11,color:D.inkMid,lineHeight:1.6},children:["Las ",e.jsxs("strong",{children:[yi(C)," horas productivas"]})," son el denominador del clculo de coste/hora por cargo:"]}),e.jsxs("div",{style:{marginTop:10,background:D.accent,borderRadius:3,padding:"10px 12px",fontFamily:"'DM Mono', monospace",fontSize:11,color:D.inkMid,lineHeight:1.8},children:["Coste/hora = Costo empleador anual  ",yi(C)," h",e.jsx("br",{}),e.jsx("span",{style:{color:D.inkLight,fontSize:10},children:"+ fraccin de estructura (activos + licencias + gastos generales)"})]})]})]})]})})}function ff({activos:t,saveActivos:i,licencias:o,saveLicencias:n,gastos:s,saveGastos:r}){const[a,u]=F.useState("activos"),[h,b]=F.useState(null),[j,C]=F.useState(null),[v,m]=F.useState(null),f=t.reduce((y,g)=>y+(g.valorCompra/g.vidaUtilAnios||0),0),p=o.reduce((y,g)=>y+Number(g.costoAnual||0),0),c=s.reduce((y,g)=>y+Number(g.montoMensual||0),0),d=f+p+c*12,l=(y,g,S,A)=>{g(E=>A?[...E,S]:E.map(w=>w.id===S.id?S:w)),b(null),C(null),m(null)},x=(y,g)=>e.jsx("button",{onClick:()=>u(y),style:{padding:"6px 14px",background:a===y?D.ink:"transparent",color:a===y?"#fff":D.inkMid,border:`1px solid ${a===y?D.ink:D.border}`,borderRadius:3,fontSize:11,fontWeight:600,letterSpacing:.5,cursor:"pointer"},children:g});return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ti,{label:"Depreciacin anual activos",value:At(f),icon:wn}),e.jsx(ti,{label:"Licencias / ao",value:At(p),icon:Mc}),e.jsx(ti,{label:"Gastos generales / ao",value:At(c*12),icon:zo}),e.jsx(ti,{label:"Total estructura / ao",value:At(d),icon:Yi,color:D.blue,sub:"se prorratea sobre las horas productivas"})]}),e.jsxs(Zt,{children:[e.jsxs("div",{style:{display:"flex",gap:6,marginBottom:16},children:[x("activos","Activos NIIF"),x("licencias","Licencias Software"),x("gastos","Gastos Generales")]}),a==="activos"&&e.jsxs(e.Fragment,{children:[e.jsx(so,{action:e.jsxs(it,{small:!0,variant:"primary",onClick:()=>b({...sf(),isNew:!0}),children:[e.jsx(Ne,{size:12}),"Nuevo activo"]}),children:"Inventario de Activos"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${D.border}`,background:D.surfaceAlt},children:[["Activo","Categora NIIF","Ao compra","Valor compra","Vida til","Dep./ao","Dep. acumulada","Valor neto","Costo/hora"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:D.inkLight,fontWeight:700,whiteSpace:"nowrap"},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{textAlign:"center",padding:"36px 0",color:D.inkLight,fontSize:12},children:"Sin activos registrados. Pulsa Nuevo activo para aadir el primero."})}),t.map(y=>{const g=y.vidaUtilAnios>0?y.valorCompra/y.vidaUtilAnios:0,S=Math.min(Pi-Number(y.anioCompra||Pi),Number(y.vidaUtilAnios)),A=g*Math.max(0,S),E=Math.max(0,y.valorCompra-A),w=y.usoAnual>0?g/y.usoAnual:0,I=y.valorCompra>0?A/y.valorCompra*100:0,z=Ws.find(P=>P.cat===y.categoria),B=I>=90?D.red:I>=60?D.amber:D.green;return e.jsxs("tr",{style:{borderBottom:`1px solid ${D.border}`},onMouseEnter:P=>P.currentTarget.style.background=D.surfaceAlt,onMouseLeave:P=>P.currentTarget.style.background="",children:[e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("div",{style:{fontWeight:600,color:D.ink},children:y.nombre||""}),y.baseNiif&&e.jsx("div",{style:{fontSize:9,color:D.inkLight,marginTop:1},children:y.baseNiif})]}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[e.jsx("span",{children:(z==null?void 0:z.icono)||""}),e.jsx("span",{style:{fontSize:11,color:D.inkMid},children:y.categoria||""})]})}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",textAlign:"center",color:D.inkMid},children:y.anioCompra||""}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:At(y.valorCompra)}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsxs("span",{className:"mono",style:{fontSize:12,fontWeight:600},children:[y.vidaUtilAnios," aos"]}),y.vidaUtilEditada&&e.jsx(Ut,{color:D.amber,bg:D.amberBg,children:"Manual"})]}),e.jsx("div",{style:{fontSize:9,color:D.inkLight},children:y.metodo})]}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:At(g)}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("div",{className:"mono",style:{fontSize:12},children:At(A)}),e.jsx("div",{style:{marginTop:3,background:D.accent,borderRadius:2,height:3},children:e.jsx("div",{style:{width:`${Math.min(I,100)}%`,height:"100%",borderRadius:2,background:I>=90?D.red:I>=60?D.amber:D.blue}})}),e.jsxs("div",{style:{fontSize:9,color:D.inkLight,marginTop:1},children:[I.toFixed(0),"% amortizado"]})]}),e.jsxs("td",{style:{padding:"10px 10px"},children:[e.jsx("span",{className:"mono",style:{fontSize:12,fontWeight:700,color:B},children:At(E)}),E===0&&e.jsx("div",{style:{fontSize:9,color:D.red},children:"Totalmente amortizado"})]}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Ut,{color:D.blue,bg:D.blueBg,children:[At(w),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(it,{small:!0,variant:"ghost",onClick:()=>b({...y,isNew:!1}),children:e.jsx(ro,{size:11})}),e.jsx(it,{small:!0,variant:"danger",onClick:()=>i(P=>P.filter(q=>q.id!==y.id)),children:e.jsx(Je,{size:11})})]})})]},y.id)})]})]})}),t.length>0&&e.jsx("div",{style:{marginTop:12,display:"flex",gap:12,flexWrap:"wrap"},children:[{lbl:"Total en libros (valor neto)",val:At(t.reduce((y,g)=>{const A=(g.vidaUtilAnios>0?g.valorCompra/g.vidaUtilAnios:0)*Math.min(Pi-Number(g.anioCompra||Pi),Number(g.vidaUtilAnios));return y+Math.max(0,g.valorCompra-A)},0)),color:D.ink},{lbl:"Dep. anual total en estructura",val:At(t.reduce((y,g)=>y+(g.vidaUtilAnios>0?g.valorCompra/g.vidaUtilAnios:0),0)),color:D.blue},{lbl:"Activos totalmente amortizados",val:t.filter(y=>{const g=y.vidaUtilAnios>0?y.valorCompra/y.vidaUtilAnios:0;return y.valorCompra-g*Math.min(Pi-Number(y.anioCompra||Pi),Number(y.vidaUtilAnios))<=0}).length,color:D.red,isNum:!0}].map(y=>e.jsxs("div",{style:{background:D.surface,border:`1px solid ${D.border}`,borderRadius:3,padding:"10px 14px",flex:1,minWidth:160},children:[e.jsx(Ht,{children:y.lbl}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:y.color,marginTop:5},className:"mono",children:(y.isNum,y.val)})]},y.lbl))})]}),a==="licencias"&&e.jsxs(e.Fragment,{children:[e.jsx(so,{action:e.jsxs(it,{small:!0,variant:"primary",onClick:()=>C({...af(),isNew:!0}),children:[e.jsx(Ne,{size:12}),"Nueva licencia"]}),children:"Licencias de Software"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${D.border}`},children:[["Software","Plan","Usuarios","Costo/ao","Costo/mes","Costo/hora*"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:D.inkLight,fontWeight:700},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"30px 0",color:D.inkLight,fontSize:12},children:"Sin licencias registradas"})}),o.map(y=>e.jsxs("tr",{style:{borderBottom:`1px solid ${D.border}`},onMouseEnter:g=>g.currentTarget.style.background=D.surfaceAlt,onMouseLeave:g=>g.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},children:y.nombre||""}),e.jsx("td",{style:{padding:"10px 10px",color:D.inkMid},children:y.plan||""}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",textAlign:"center"},children:y.usuarios}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:At(y.costoAnual)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px",color:D.inkMid},children:At(y.costoAnual/12)}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs(Ut,{color:D.blue,bg:D.blueBg,children:[At(y.costoAnual/1760/y.usuarios||1),"/h"]})}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(it,{small:!0,variant:"ghost",onClick:()=>C({...y,isNew:!1}),children:e.jsx(ro,{size:11})}),e.jsx(it,{small:!0,variant:"danger",onClick:()=>n(g=>g.filter(S=>S.id!==y.id)),children:e.jsx(Je,{size:11})})]})})]},y.id))]})]}),e.jsx("p",{style:{fontSize:9,color:D.inkLight,marginTop:10},children:"* Basado en 1.760 h/ao. Se recalcula con la jornada configurada en la pestaa de Jornada."})]}),a==="gastos"&&e.jsxs(e.Fragment,{children:[e.jsx(so,{action:e.jsxs(it,{small:!0,variant:"primary",onClick:()=>m({...lf(),isNew:!0}),children:[e.jsx(Ne,{size:12}),"Nuevo gasto"]}),children:"Gastos Generales de Empresa"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${D.border}`},children:[["Concepto","Categora","Mensual","Anual"].map(y=>e.jsx("th",{style:{padding:"8px 10px",textAlign:"left",fontSize:9,letterSpacing:1.5,textTransform:"uppercase",color:D.inkLight,fontWeight:700},children:y},y)),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"30px 0",color:D.inkLight,fontSize:12},children:"Sin gastos registrados"})}),s.map(y=>e.jsxs("tr",{style:{borderBottom:`1px solid ${D.border}`},onMouseEnter:g=>g.currentTarget.style.background=D.surfaceAlt,onMouseLeave:g=>g.currentTarget.style.background="",children:[e.jsx("td",{style:{padding:"10px 10px",fontWeight:600},children:y.concepto||""}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsx(Ut,{children:y.categoria})}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:At(y.montoMensual)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:At(y.montoMensual*12)}),e.jsx("td",{style:{padding:"10px 10px"},children:e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(it,{small:!0,variant:"ghost",onClick:()=>m({...y,isNew:!1}),children:e.jsx(ro,{size:11})}),e.jsx(it,{small:!0,variant:"danger",onClick:()=>r(g=>g.filter(S=>S.id!==y.id)),children:e.jsx(Je,{size:11})})]})})]},y.id)),s.length>0&&e.jsxs("tr",{style:{background:D.accent,fontWeight:700},children:[e.jsx("td",{colSpan:2,style:{padding:"10px 10px",fontSize:11},children:"TOTAL GASTOS GENERALES"}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:At(c)}),e.jsx("td",{className:"mono",style:{padding:"10px 10px"},children:At(c*12)}),e.jsx("td",{})]})]})]})]})]}),h&&(()=>{const y=Ws.find(w=>w.cat===h.categoria),g=h.vidaUtilAnios>0?h.valorCompra/h.vidaUtilAnios:0,S=Math.min(Pi-Number(h.anioCompra||Pi),Number(h.vidaUtilAnios)),A=g*Math.max(0,S),E=Math.max(0,h.valorCompra-A);return e.jsxs(es,{title:h.isNew?"Nuevo activo NIIF":"Editar activo",onClose:()=>b(null),wide:!0,children:[e.jsxs("div",{style:{marginBottom:14},children:[e.jsx(Ht,{children:"Categora NIIF"}),e.jsx("div",{style:{marginTop:6,display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6},children:Ws.map(w=>e.jsxs("button",{onClick:()=>b(I=>({...I,categoria:w.cat,metodo:w.metodo,baseNiif:w.base,vidaUtilAnios:w.vida,usoAnual:w.usoRef,vidaUtilEditada:!1})),style:{padding:"8px 6px",borderRadius:3,border:`1px solid ${h.categoria===w.cat?D.ink:D.border}`,background:h.categoria===w.cat?D.ink:D.surface,color:h.categoria===w.cat?"#fff":D.inkMid,fontSize:10,cursor:"pointer",textAlign:"center",lineHeight:1.3,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("div",{style:{fontSize:18,marginBottom:3},children:w.icono}),e.jsx("div",{style:{fontWeight:h.categoria===w.cat?700:400},children:w.cat})]},w.cat))}),y&&e.jsxs("div",{style:{marginTop:8,background:D.blueBg,borderRadius:3,padding:"8px 12px",display:"flex",gap:12,alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,color:D.blue},children:"Norma aplicable: "}),e.jsx("span",{style:{fontSize:10,color:D.blue},children:y.base})]}),e.jsx("div",{style:{flex:2,fontSize:10,color:D.blue,opacity:.8},children:y.nota})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:8},children:[e.jsx(jt,{label:"Nombre del activo",children:e.jsx(vt,{value:h.nombre,onChange:w=>b(I=>({...I,nombre:w})),placeholder:"Ej. MacBook Pro 14 M3"})}),e.jsx(jt,{label:"Ao de compra",children:e.jsx(vt,{type:"number",value:h.anioCompra,onChange:w=>b(I=>({...I,anioCompra:w})),placeholder:String(Pi)})}),e.jsx(jt,{label:"Valor de compra (COP)",children:e.jsx(vt,{type:"number",value:h.valorCompra,onChange:w=>b(I=>({...I,valorCompra:w}))})}),e.jsx(jt,{label:"Horas de uso estimadas/ao",children:e.jsx(vt,{type:"number",value:h.usoAnual,onChange:w=>b(I=>({...I,usoAnual:w}))})})]}),e.jsxs("div",{style:{background:D.accent,borderRadius:3,padding:"12px 14px",marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(Ht,{children:"Vida til (aos)"}),e.jsx("button",{onClick:()=>b(w=>({...w,vidaUtilEditada:!w.vidaUtilEditada})),style:{fontSize:9,color:D.blue,background:"none",border:"none",cursor:"pointer",textDecoration:"underline"},children:h.vidaUtilEditada?" Restaurar valor NIIF":"Editar manualmente"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsxs("div",{children:[e.jsx(Ht,{children:"Vida til"}),e.jsx(vt,{type:"number",value:h.vidaUtilAnios,readOnly:!h.vidaUtilEditada,onChange:w=>b(I=>({...I,vidaUtilAnios:w,vidaUtilEditada:!0})),style:{marginTop:4,background:h.vidaUtilEditada?D.surface:D.accent}}),y&&!h.vidaUtilEditada&&e.jsxs("div",{style:{fontSize:9,color:D.green,marginTop:2},children:[" Segn ",y.base]})]}),e.jsxs("div",{children:[e.jsx(Ht,{children:"Mtodo"}),e.jsx(vt,{value:h.metodo,readOnly:!0,style:{marginTop:4,background:D.accent}})]}),e.jsxs("div",{children:[e.jsx(Ht,{children:"Norma"}),e.jsx(vt,{value:h.baseNiif,readOnly:!0,style:{marginTop:4,background:D.accent,fontSize:10}})]})]})]}),h.valorCompra>0&&h.vidaUtilAnios>0&&e.jsxs("div",{style:{background:D.greenBg,borderRadius:3,padding:"12px 14px",marginBottom:8},children:[e.jsx(Ht,{children:"Vista previa de depreciacin"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginTop:8},children:[{lbl:"Dep. anual",val:At(g)},{lbl:"Dep. acumulada",val:At(A)},{lbl:"Valor neto libros",val:At(E),bold:!0},{lbl:"Costo/hora uso",val:At(h.usoAnual>0?g/h.usoAnual:0)+"/h"}].map(w=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:D.green,marginBottom:3},children:w.lbl}),e.jsx("div",{style:{fontSize:13,fontWeight:w.bold?800:600,color:D.green},className:"mono",children:w.val})]},w.lbl))}),A>=h.valorCompra&&e.jsx("div",{style:{marginTop:8,fontSize:10,color:D.red,fontWeight:600},children:" Este activo est totalmente amortizado. Considera darlo de baja o actualizar el ao de compra."})]}),e.jsx(ts,{onCancel:()=>b(null),onSave:()=>l(t,i,h,h.isNew)})]})})(),j&&e.jsxs(es,{title:j.isNew?"Nueva licencia":"Editar licencia",onClose:()=>C(null),children:[[["nombre","Software","text"],["plan","Plan","text"],["usuarios","N usuarios","number"],["costoAnual","Costo anual (COP)","number"]].map(([y,g,S])=>e.jsx(jt,{label:g,children:e.jsx(vt,{type:S,value:j[y],onChange:A=>C(E=>({...E,[y]:A}))})},y)),e.jsx(ts,{onCancel:()=>C(null),onSave:()=>l(o,n,j,j.isNew)})]}),v&&e.jsxs(es,{title:v.isNew?"Nuevo gasto":"Editar gasto",onClose:()=>m(null),children:[e.jsx(jt,{label:"Concepto",children:e.jsx(vt,{value:v.concepto,onChange:y=>m(g=>({...g,concepto:y}))})}),e.jsx(jt,{label:"Categora",children:e.jsx(vi,{value:v.categoria,onChange:y=>m(g=>({...g,categoria:y})),options:["Oficina","Comunicaciones","Seguros","Suscripciones","Transporte","Otros"]})}),e.jsx(jt,{label:"Monto mensual (COP)",children:e.jsx(vt,{type:"number",value:v.montoMensual,onChange:y=>m(g=>({...g,montoMensual:y}))})}),e.jsx(ts,{onCancel:()=>m(null),onSave:()=>l(s,r,v,v.isNew)})]})]})}function xf({equipo:t,setEquipo:i,cargos:o,pais:n}){const[s,r]=F.useState(null),[a,u]=F.useState(""),h=n==="CO"?tf:of,b=()=>{var C;return{id:Qi(),nombre:"",documento:"",cargo:((C=o[0])==null?void 0:C.id)||"",email:"",telefono:"",tipoContrato:h[0],fechaIngreso:xi(),pin:"",activo:!0,pais:n,foto:null}},j=F.useMemo(()=>t.filter(C=>{var v,m;return!a||C.nombre.toLowerCase().includes(a.toLowerCase())||((v=C.documento)==null?void 0:v.includes(a))||((m=C.email)==null?void 0:m.toLowerCase().includes(a.toLowerCase()))}),[t,a]);return e.jsxs("div",{children:[e.jsxs(si,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsxs("div",{style:{flex:1,fontSize:16,fontWeight:700,color:Se.ink},children:["Equipo (",t.filter(C=>C.activo).length," activos)"]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ki,{size:13,style:{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",color:Se.inkLight}}),e.jsx("input",{value:a,onChange:C=>u(C.target.value),placeholder:"Buscar...",style:{padding:"7px 10px 7px 28px",border:`1px solid ${Se.border}`,borderRadius:6,fontSize:13,outline:"none",width:180}})]}),e.jsx(it,{icon:Ne,onClick:()=>r(b()),children:"Aadir empleado"})]}),s&&e.jsxs(Zt,{style:{marginBottom:16,border:`1px solid ${Se.green}`},children:[e.jsx(ic,{icon:Ri,children:"Nuevo empleado"}),e.jsxs(si,{gap:14,wrap:!0,children:[e.jsx(Ei,{children:e.jsx(oo,{label:"Nombre completo",req:!0,value:s.nombre,onChange:C=>r({...s,nombre:C.target.value})})}),e.jsx(Ei,{children:e.jsx(oo,{label:n==="CO"?"Cdula / CC":"DNI / NIE",req:!0,value:s.documento,onChange:C=>r({...s,documento:C.target.value})})}),e.jsx(Ei,{children:e.jsx(Pl,{label:"Cargo",value:s.cargo,onChange:C=>r({...s,cargo:C.target.value}),options:[{value:"",label:" Sin cargo "},...o.map(C=>({value:C.id,label:C.nombre}))]})})]}),e.jsxs(si,{gap:14,wrap:!0,children:[e.jsx(Ei,{children:e.jsx(oo,{label:"Email",type:"email",value:s.email,onChange:C=>r({...s,email:C.target.value})})}),e.jsx(Ei,{children:e.jsx(oo,{label:"Telfono",value:s.telefono,onChange:C=>r({...s,telefono:C.target.value})})}),e.jsx(Ei,{children:e.jsx(oo,{label:"Fecha ingreso",type:"date",value:s.fechaIngreso,onChange:C=>r({...s,fechaIngreso:C.target.value})})})]}),e.jsxs(si,{gap:14,wrap:!0,children:[e.jsx(Ei,{children:e.jsx(Pl,{label:"Tipo contrato",value:s.tipoContrato,onChange:C=>r({...s,tipoContrato:C.target.value}),options:h})}),e.jsxs(Ei,{children:[e.jsx(oo,{label:"PIN de 4 dgitos (para fichaje de obra)",type:"password",maxLength:4,value:s.pin,onChange:C=>r({...s,pin:C.target.value.replace(/\D/g,"").slice(0,4)}),placeholder:""}),e.jsx("div",{style:{fontSize:11,color:Se.inkLight,marginTop:-8},children:"El trabajador lo usa para fichar en obra"})]}),e.jsx(Ei,{children:e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(dn,{children:"Estado"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginTop:6},children:[e.jsx("input",{type:"checkbox",checked:s.activo,onChange:C=>r({...s,activo:C.target.checked}),style:{width:16,height:16}}),e.jsx("span",{style:{fontSize:13},children:"Empleado activo"})]})]})})]}),e.jsxs(si,{gap:8,children:[e.jsx(it,{icon:yt,onClick:()=>{i(C=>[...C,s]),r(null)},children:"Guardar"}),e.jsx(it,{variant:"secondary",onClick:()=>r(null),children:"Cancelar"})]})]}),e.jsx("div",{style:{overflowX:"auto",border:`1px solid ${Se.border}`,borderRadius:8},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:600},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Se.bg},children:["Empleado","Cargo","Tipo contrato","Ingreso","Estado","PIN",""].map(C=>e.jsx("th",{style:{padding:"8px 12px",fontSize:11,fontWeight:600,color:Se.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${Se.border}`},children:C},C))})}),e.jsxs("tbody",{children:[j.map((C,v)=>{const m=o.find(f=>f.id===C.cargo);return e.jsxs("tr",{style:{background:v%2===0?Se.card:Se.bg},children:[e.jsxs("td",{style:{padding:"10px 12px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:C.nombre}),e.jsx("div",{style:{fontSize:11,color:Se.inkLight},children:C.documento})]}),e.jsx("td",{style:{padding:"10px 12px",fontSize:13,color:Se.inkMid},children:(m==null?void 0:m.nombre)||""}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:Se.inkMid},children:C.tipoContrato}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:Se.inkMid},children:Da(C.fechaIngreso)}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx(Ut,{color:C.activo?Se.green:Se.inkLight,children:C.activo?"Activo":"Inactivo"})}),e.jsx("td",{style:{padding:"10px 12px",fontSize:12,color:Se.inkLight,fontFamily:"'DM Mono',monospace"},children:C.pin?"":""}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("button",{onClick:()=>i(f=>f.filter(p=>p.id!==C.id)),style:{background:"none",border:"none",cursor:"pointer",color:Se.red,padding:2},children:e.jsx(Je,{size:13})})})]},C.id)}),j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:"32px",textAlign:"center",color:Se.inkLight,fontSize:13},children:"Sin empleados."})})]})]})})]})}function mf({partes:t,setPartes:i,equipo:o,cargos:n,currentUser:s,pais:r}){const[a,u]=F.useState(null),[h,b]=F.useState(null),[j,C]=F.useState("todas"),[v,m]=F.useState({});F.useEffect(()=>{(async()=>{const g={};try{const S=Fe.listSync("hab:proj:actividades:").items;if(S!=null&&S.keys)for(const A of S.keys)try{const E=Fe.getSync(A);if(E){const w=JSON.parse(E),I=A.replace("hab:proj:actividades:","");g[I]=w}}catch{}}catch{}m(g)})()},[]);const f=!s||uf.includes(s.rol),p=[...new Set(t.map(g=>g.otId).filter(Boolean))],c=()=>({id:Qi(),fecha:xi(),encargadoId:(s==null?void 0:s.id)||"",encargadoNombre:(s==null?void 0:s.nombre)||"",otId:"",actividadId:"",actividadNombre:"",trabajadores:[],horasPorTrabajador:{},avance:0,notas:"",fotos:[],estado:"borrador",creadoEn:tc()}),d=F.useMemo(()=>s?o.filter(g=>g.activo):o,[o,s]),l=g=>v[g]||[],x=Object.keys(v),y=F.useMemo(()=>t.filter(g=>j==="todas"||g.otId===j),[t,j]);return e.jsxs("div",{children:[e.jsxs(si,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsxs("div",{style:{flex:1,fontSize:16,fontWeight:700,color:Se.ink},children:["Partes de Trabajo (",t.length,")"]}),!f&&e.jsx(Ut,{color:Se.amber,children:"Solo encargados y supervisores pueden crear partes"}),f&&e.jsx(it,{icon:Ne,onClick:()=>u(c()),children:"Nuevo parte"})]}),e.jsxs("div",{style:{background:Se.blueL,border:`1px solid ${Se.blue}22`,borderRadius:8,padding:"10px 14px",marginBottom:16,fontSize:12,color:Se.blue},children:[e.jsx("strong",{children:"Reglas de partes:"})," Solo el encargado/supervisor/jefe crea partes. Selecciona la OT  la actividad del Gantt (definida en el borrador de costes del CRM)  el equipo que trabaj. El avance del Gantt se actualiza automticamente."]}),a&&e.jsxs(Zt,{style:{marginBottom:16,border:`1px solid ${Se.green}`},children:[e.jsx(ic,{icon:Bt,color:Se.green,children:"Nuevo parte de trabajo"}),e.jsxs(si,{gap:14,wrap:!0,children:[e.jsx(Ei,{children:e.jsx(oo,{label:"Fecha",type:"date",value:a.fecha,onChange:g=>u({...a,fecha:g.target.value})})}),e.jsx(Ei,{children:e.jsx(oo,{label:"Encargado responsable",value:a.encargadoNombre||(s==null?void 0:s.nombre)||"",disabled:!0})})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(dn,{req:!0,children:"OT / Proyecto"}),x.length===0?e.jsx("div",{style:{padding:"10px 12px",background:Se.amberL,borderRadius:6,fontSize:12,color:Se.amber},children:' No hay OTs con actividades del Gantt. Ve al mdulo CRM, completa el borrador de costes de una oferta ganada y usa "Exportar al Gantt".'}):e.jsxs("select",{value:a.otId,onChange:g=>{u({...a,otId:g.target.value,actividadId:"",actividadNombre:""})},style:{width:"100%",padding:"8px 10px",border:`1px solid ${Se.border}`,borderRadius:6,fontSize:13,background:Se.card},children:[e.jsx("option",{value:"",children:" Seleccionar OT "}),x.map(g=>{var S,A;return e.jsx("option",{value:g,children:((A=(S=v[g])==null?void 0:S[0])==null?void 0:A.otNombre)||g},g)})]})]}),a.otId&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(dn,{req:!0,children:"Actividad del Gantt"}),e.jsxs("select",{value:a.actividadId,onChange:g=>{const S=l(a.otId).find(A=>A.id===g.target.value);u({...a,actividadId:g.target.value,actividadNombre:(S==null?void 0:S.nombre)||""})},style:{width:"100%",padding:"8px 10px",border:`1px solid ${Se.border}`,borderRadius:6,fontSize:13,background:Se.card},children:[e.jsx("option",{value:"",children:" Seleccionar actividad "}),l(a.otId).map(g=>e.jsxs("option",{value:g.id,children:[g.codigo,"  ",g.nombre," (",g.cantidad," ",g.unidad,")"]},g.id))]}),a.actividadId&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(dn,{children:"% Avance de esta actividad al finalizar hoy"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("input",{type:"range",min:0,max:100,step:5,value:a.avance,onChange:g=>u({...a,avance:parseInt(g.target.value)}),style:{flex:1}}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:15,color:Se.green,minWidth:40},children:[a.avance,"%"]})]})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(dn,{children:"Equipo que trabaj hoy en esta actividad"}),e.jsxs("div",{style:{border:`1px solid ${Se.border}`,borderRadius:6,overflow:"hidden"},children:[d.length===0&&e.jsx("div",{style:{padding:"12px",fontSize:12,color:Se.inkLight},children:"Sin empleados en el equipo. Ve a la pestaa Equipo para aadir trabajadores."}),d.map((g,S)=>{var E;const A=a.trabajadores.includes(g.id);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",background:A?Se.greenL:S%2===0?Se.card:Se.bg,borderBottom:`1px solid ${Se.border}`,cursor:"pointer"},onClick:()=>u(w=>{const I=A?w.trabajadores.filter(B=>B!==g.id):[...w.trabajadores,g.id],z={...w.horasPorTrabajador};return A?delete z[g.id]:z[g.id]=8,{...w,trabajadores:I,horasPorTrabajador:z}}),children:[e.jsx("input",{type:"checkbox",readOnly:!0,checked:A,style:{width:15,height:15,accentColor:Se.green}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:A?600:400,color:Se.ink},children:g.nombre}),e.jsx("div",{style:{fontSize:11,color:Se.inkLight},children:((E=n.find(w=>w.id===g.cargo))==null?void 0:E.nombre)||"Sin cargo"})]}),A&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},onClick:w=>w.stopPropagation(),children:[e.jsx("span",{style:{fontSize:11,color:Se.inkMid},children:"Horas:"}),e.jsx("input",{type:"number",min:"0",max:"24",step:"0.5",value:a.horasPorTrabajador[g.id]||8,onChange:w=>u(I=>({...I,horasPorTrabajador:{...I.horasPorTrabajador,[g.id]:parseFloat(w.target.value)||0}})),style:{width:56,border:`1px solid ${Se.green}`,borderRadius:4,padding:"3px 6px",fontSize:13,textAlign:"center",fontFamily:"'DM Mono',monospace"}})]})]},g.id)})]}),a.trabajadores.length>0&&e.jsxs("div",{style:{fontSize:12,color:Se.inkMid,marginTop:6},children:["Total horas parte: ",yi(Object.values(a.horasPorTrabajador).reduce((g,S)=>g+S,0),1)," h  ",a.trabajadores.length," personas"]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(dn,{children:"Observaciones / Notas de obra"}),e.jsx("textarea",{value:a.notas,onChange:g=>u({...a,notas:g.target.value}),rows:2,style:{width:"100%",boxSizing:"border-box",padding:"8px 10px",border:`1px solid ${Se.border}`,borderRadius:6,fontSize:13,resize:"vertical"},placeholder:"Incidencias, materiales consumidos, condiciones de trabajo..."})]}),e.jsxs(si,{gap:8,children:[e.jsx(it,{icon:yt,onClick:()=>{if(!a.otId||!a.actividadId){alert("Selecciona OT y actividad.");return}if(a.trabajadores.length===0){alert("Selecciona al menos un trabajador.");return}const g={...a,estado:"confirmado"};i(S=>[g,...S]);try{const S="hab:proj:actividades:"+a.otId,A=Fe.get(S);if(A!=null&&A.value){const w=JSON.parse(A).map(I=>I.id===a.actividadId?{...I,avance:a.avance}:I);Fe.set(S,JSON.stringify(w))}}catch{}u(null)},children:"Confirmar parte"}),e.jsx(it,{variant:"secondary",onClick:()=>u(null),children:"Cancelar"})]})]}),p.length>0&&e.jsx(si,{gap:6,style:{marginBottom:12},wrap:!0,children:["todas",...p].map(g=>e.jsx("button",{onClick:()=>C(g),style:{padding:"5px 12px",borderRadius:20,border:`1px solid ${j===g?Se.green:Se.border}`,background:j===g?Se.greenL:"transparent",fontSize:12,cursor:"pointer",color:j===g?Se.green:Se.inkMid},children:g==="todas"?"Todas las OTs":g},g))}),e.jsx("div",{style:{border:`1px solid ${Se.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Se.bg},children:["Fecha","OT / Actividad","Encargado","Equipo","Horas totales","Avance","Estado",""].map(g=>e.jsx("th",{style:{padding:"7px 10px",fontSize:11,fontWeight:600,color:Se.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${Se.border}`},children:g},g))})}),e.jsxs("tbody",{children:[y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:"32px",textAlign:"center",color:Se.inkLight,fontSize:13},children:"Sin partes de trabajo."})}),y.map((g,S)=>{var w;const A=Object.values(g.horasPorTrabajador||{}).reduce((I,z)=>I+z,0),E=g.estado==="confirmado"?Se.green:g.estado==="validado"?Se.blue:Se.amber;return e.jsxs("tr",{style:{background:S%2===0?Se.card:Se.bg,cursor:"pointer"},onClick:()=>b(g),onMouseEnter:I=>I.currentTarget.style.background=Se.blueL,onMouseLeave:I=>I.currentTarget.style.background=S%2===0?Se.card:Se.bg,children:[e.jsx("td",{style:{padding:"9px 10px",fontSize:12},children:Da(g.fecha)}),e.jsxs("td",{style:{padding:"9px 10px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:g.otId||""}),e.jsx("div",{style:{fontSize:11,color:Se.inkMid},children:g.actividadNombre})]}),e.jsx("td",{style:{padding:"9px 10px",fontSize:12,color:Se.inkMid},children:g.encargadoNombre||""}),e.jsxs("td",{style:{padding:"9px 10px",fontSize:12},children:[((w=g.trabajadores)==null?void 0:w.length)||0," personas"]}),e.jsxs("td",{style:{padding:"9px 10px",fontFamily:"'DM Mono',monospace",fontSize:13,fontWeight:600},children:[yi(A,1)," h"]}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:Se.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{width:`${g.avance||0}%`,height:"100%",background:g.avance>=80?Se.green:g.avance>=40?Se.amber:Se.blue,borderRadius:3}})}),e.jsxs("span",{style:{fontSize:11,color:Se.inkMid,minWidth:28,fontFamily:"'DM Mono',monospace"},children:[g.avance||0,"%"]})]})}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsx(Ut,{color:E,children:g.estado})}),e.jsx("td",{style:{padding:"9px 10px"},children:e.jsx("button",{onClick:I=>{I.stopPropagation(),i(z=>z.filter(B=>B.id!==g.id))},style:{background:"none",border:"none",cursor:"pointer",color:Se.red,padding:2},children:e.jsx(Je,{size:12})})})]},g.id)})]})]})}),h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:e.jsxs("div",{style:{background:Se.card,borderRadius:12,width:"100%",maxWidth:540,maxHeight:"85vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${Se.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:15},children:["Parte  ",Da(h.fecha)]}),e.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",cursor:"pointer",color:Se.inkLight},children:e.jsx(Ot,{size:18})})]}),e.jsxs("div",{style:{padding:18},children:[[["OT",h.otId],["Actividad",h.actividadNombre],["Encargado",h.encargadoNombre],["% Avance",h.avance+"%"],["Notas",h.notas||""]].map(([g,S])=>e.jsxs("div",{style:{display:"flex",gap:12,padding:"7px 0",borderBottom:`1px solid ${Se.border}`,fontSize:13},children:[e.jsx("span",{style:{fontWeight:600,color:Se.inkMid,minWidth:90},children:g}),e.jsx("span",{style:{color:Se.ink},children:S})]},g)),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{style:{fontWeight:600,fontSize:12,color:Se.inkMid,textTransform:"uppercase",letterSpacing:.5,marginBottom:8},children:"Equipo y horas"}),(h.trabajadores||[]).map(g=>{var E;const S=o.find(w=>w.id===g),A=((E=h.horasPorTrabajador)==null?void 0:E[g])||0;return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"5px 0",fontSize:13,borderBottom:`1px solid ${Se.border}`},children:[e.jsx("span",{children:(S==null?void 0:S.nombre)||g}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:600},children:[yi(A,1)," h"]})]},g)})]})]})]})})]})}function bf({equipo:t,asistencia:i,setAsistencia:o,pais:n}){var Y,ge;const[s,r]=F.useState("encargado"),[a,u]=F.useState(xi());F.useState(!1);const[h,b]=F.useState(1),[j,C]=F.useState(null),[v,m]=F.useState(""),[f,p]=F.useState(!1),[c,d]=F.useState(null),[l,x]=F.useState(null),[y,g]=F.useState(null),[S,A]=F.useState(null),E=F.useRef(null),w=F.useRef(null),I=F.useMemo(()=>i.filter(J=>J.fecha===a).sort((J,ye)=>J.timestamp<ye.timestamp?-1:1),[i,a]),z=F.useMemo(()=>{const J={};return I.forEach(ye=>{J[ye.empleadoId]||(J[ye.empleadoId]=[]),J[ye.empleadoId].push(ye)}),J},[I]),B=async()=>{try{A(null);const J=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}},audio:!1});w.current=J,E.current&&(E.current.srcObject=J)}catch(J){A("No se pudo acceder a la cmara: "+J.message+". Asegrate de dar permiso.")}},P=()=>{w.current&&(w.current.getTracks().forEach(J=>J.stop()),w.current=null)},q=()=>{if(!E.current)return;const J=document.createElement("canvas");J.width=E.current.videoWidth||640,J.height=E.current.videoHeight||480,J.getContext("2d").drawImage(E.current,0,0,J.width,J.height);const ye=J.toDataURL("image/jpeg",.7);d(ye),P(),navigator.geolocation?navigator.geolocation.getCurrentPosition(oe=>x({lat:oe.coords.latitude,lng:oe.coords.longitude,precision:Math.round(oe.coords.accuracy)}),oe=>g("GPS no disponible: "+oe.message),{timeout:8e3,maximumAge:0}):g("Geolocalizacin no disponible en este dispositivo."),b(4)},U=()=>{var oe;if(!c){alert("La foto es obligatoria.");return}const J=((oe=z[j.id])==null?void 0:oe.length)%2===0?"entrada":"salida",ye={id:Qi(),empleadoId:j.id,empleadoNombre:j.nombre,fecha:a,timestamp:tc(),tipo:J,foto:c,lat:(l==null?void 0:l.lat)||null,lng:(l==null?void 0:l.lng)||null,precision:(l==null?void 0:l.precision)||null,gpsError:y||null};o(L=>[...L,ye]),b(5),P()},$=()=>{b(1),C(null),m(""),p(!1),d(null),x(null),g(null),A(null),P()};return F.useEffect(()=>()=>P(),[]),e.jsxs("div",{children:[e.jsxs(si,{gap:8,style:{marginBottom:16},wrap:!0,children:[e.jsx("button",{onClick:()=>r("encargado"),style:{flex:1,padding:"10px 16px",borderRadius:8,border:`2px solid ${s==="encargado"?Se.green:Se.border}`,background:s==="encargado"?Se.greenL:Se.card,cursor:"pointer",fontFamily:"DM Sans,sans-serif",fontSize:13,fontWeight:s==="encargado"?600:400,color:s==="encargado"?Se.green:Se.inkMid},children:" Vista encargado  Panel del da"}),e.jsx("button",{onClick:()=>{r("fichaje"),$()},style:{flex:1,padding:"10px 16px",borderRadius:8,border:`2px solid ${s==="fichaje"?Se.teal:Se.border}`,background:s==="fichaje"?Se.tealL:Se.card,cursor:"pointer",fontFamily:"DM Sans,sans-serif",fontSize:13,fontWeight:s==="fichaje"?600:400,color:s==="fichaje"?Se.teal:Se.inkMid},children:" Fichaje del trabajador  Foto + GPS"})]}),s==="encargado"&&e.jsxs("div",{children:[e.jsxs(si,{align:"center",style:{marginBottom:16},wrap:!0,children:[e.jsx("div",{style:{fontSize:16,fontWeight:700,color:Se.ink,flex:1},children:"Asistencia de obra"}),e.jsx(oo,{label:"",type:"date",value:a,onChange:J=>u(J.target.value),style:{marginBottom:0,width:160}})]}),e.jsx(si,{gap:12,style:{marginBottom:16},wrap:!0,children:[["Presentes",Object.keys(z).filter(J=>z[J].some(ye=>ye.tipo==="entrada"&&!z[J].some(oe=>oe.tipo==="salida"&&oe.timestamp>ye.timestamp))).length.toString(),Se.green],["Fichajes hoy",I.length.toString(),Se.blue],["Sin fichar",t.filter(J=>J.activo&&!z[J.id]).length.toString(),Se.amber]].map(([J,ye,oe])=>e.jsxs("div",{style:{flex:1,minWidth:100,background:Se.card,border:`1px solid ${Se.border}`,borderRadius:8,padding:"10px 14px",borderLeft:`3px solid ${oe}`},children:[e.jsx("div",{style:{fontSize:11,color:Se.inkLight},children:J}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:oe,fontFamily:"'DM Mono',monospace"},children:ye})]},J))}),e.jsx(Zt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Se.bg},children:["Empleado","Entrada","Salida","Horas","Foto","GPS","Estado"].map(J=>e.jsx("th",{style:{padding:"8px 12px",fontSize:11,fontWeight:600,color:Se.inkLight,textTransform:"uppercase",letterSpacing:.4,textAlign:"left",borderBottom:`1px solid ${Se.border}`},children:J},J))})}),e.jsxs("tbody",{children:[t.filter(J=>J.activo).map((J,ye)=>{const oe=z[J.id]||[],L=oe.find(X=>X.tipo==="entrada"),R=oe.find(X=>X.tipo==="salida"),T=diffHours(L==null?void 0:L.timestamp,R==null?void 0:R.timestamp),W=L&&!R;return e.jsxs("tr",{style:{background:ye%2===0?Se.card:Se.bg},children:[e.jsxs("td",{style:{padding:"9px 12px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:J.nombre}),e.jsx("div",{style:{fontSize:11,color:Se.inkLight},children:J.documento})]}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontSize:13,color:L?Se.green:Se.inkLight},children:L?fmtTime(L.timestamp):""}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontSize:13,color:R?Se.red:Se.inkLight},children:R?fmtTime(R.timestamp):""}),e.jsx("td",{style:{padding:"9px 12px",fontFamily:"'DM Mono',monospace",fontWeight:600,fontSize:13},children:T?yi(T,1)+" h":""}),e.jsx("td",{style:{padding:"9px 12px"},children:L!=null&&L.foto?e.jsx("img",{src:L.foto,alt:"foto",style:{width:36,height:36,borderRadius:4,objectFit:"cover",cursor:"pointer",border:`1px solid ${Se.border}`},onClick:()=>{window.open().document.write(`<img src="${L.foto}" style="max-width:100%"/>`)}}):e.jsx("span",{style:{fontSize:11,color:Se.inkLight},children:""})}),e.jsx("td",{style:{padding:"9px 12px",fontSize:12},children:L!=null&&L.lat?e.jsxs("a",{href:`https://www.openstreetmap.org/?mlat=${L.lat}&mlon=${L.lng}&zoom=17`,target:"_blank",rel:"noreferrer",style:{color:Se.blue,fontSize:11},children:[" ",L.precision,"m"]}):e.jsx("span",{style:{fontSize:11,color:Se.inkLight},children:L!=null&&L.gpsError?"Sin GPS":""})}),e.jsx("td",{style:{padding:"9px 12px"},children:L?W?e.jsx(Ut,{color:Se.green,children:"En obra"}):e.jsx(Ut,{color:Se.inkLight,children:"Salida"}):e.jsx(Ut,{color:Se.amber,children:"Sin fichar"})})]},J.id)}),t.filter(J=>J.activo).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:"24px",textAlign:"center",color:Se.inkLight,fontSize:13},children:"Sin empleados activos."})})]})]})})]}),s==="fichaje"&&e.jsx("div",{style:{maxWidth:400,margin:"0 auto"},children:h===5?e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:Se.green,marginBottom:8},children:"Fichaje registrado"}),e.jsxs("div",{style:{fontSize:14,color:Se.inkMid,marginBottom:24},children:[j==null?void 0:j.nombre,"  ",((Y=z[j==null?void 0:j.id])==null?void 0:Y.length)%2===0?"SALIDA":"ENTRADA","  ",new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]}),c&&e.jsx("img",{src:c,style:{width:"100%",borderRadius:8,marginBottom:16}}),l&&e.jsxs("div",{style:{fontSize:12,color:Se.inkMid},children:[" GPS: ",l.lat.toFixed(5),", ",l.lng.toFixed(5)," (",l.precision,"m)"]}),y&&e.jsxs("div",{style:{fontSize:12,color:Se.amber},children:[" ",y]}),e.jsx(it,{onClick:$,style:{marginTop:20,width:"100%",justifyContent:"center"},children:"Nuevo fichaje"})]}):h===1?e.jsxs(Zt,{children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:20},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("div",{style:{fontSize:18,fontWeight:700,color:Se.ink},children:"Control de acceso"}),e.jsx("div",{style:{fontSize:13,color:Se.inkMid},children:"Selecciona tu nombre"})]}),e.jsxs("div",{style:{maxHeight:300,overflowY:"auto",border:`1px solid ${Se.border}`,borderRadius:8},children:[t.filter(J=>J.activo).map((J,ye)=>e.jsx("div",{onClick:()=>{C(J),b(2)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:`1px solid ${Se.border}`,background:ye%2===0?Se.card:Se.bg,fontSize:14,fontWeight:500,color:Se.ink},onMouseEnter:oe=>oe.currentTarget.style.background=Se.greenL,onMouseLeave:oe=>oe.currentTarget.style.background=ye%2===0?Se.card:Se.bg,children:J.nombre},J.id)),t.filter(J=>J.activo).length===0&&e.jsx("div",{style:{padding:20,fontSize:13,color:Se.inkLight,textAlign:"center"},children:"Sin empleados. El encargado debe registrarlos primero."})]})]}):h===2?e.jsxs(Zt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsxs("div",{style:{fontSize:18,fontWeight:700,color:Se.ink,marginBottom:4},children:["Hola, ",j==null?void 0:j.nombre]}),e.jsx("div",{style:{fontSize:13,color:Se.inkMid,marginBottom:20},children:"Introduce tu PIN de 4 dgitos"}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:12,marginBottom:16},children:[0,1,2,3].map(J=>e.jsx("div",{style:{width:14,height:14,borderRadius:"50%",background:J<v.length?Se.green:Se.border}},J))}),f&&e.jsx("div",{style:{color:Se.red,fontSize:12,marginBottom:12},children:"PIN incorrecto. Intntalo de nuevo."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,maxWidth:200,margin:"0 auto"},children:[1,2,3,4,5,6,7,8,9,"",0,""].map(J=>e.jsx("button",{onClick:()=>{if(J===""){m(oe=>oe.slice(0,-1));return}if(J==="")return;const ye=v+J;m(ye),ye.length===4&&(ye===(j==null?void 0:j.pin)?(p(!1),m(""),b(3),B()):(p(!0),m("")))},style:{padding:"14px 0",fontSize:18,fontWeight:600,border:`1px solid ${Se.border}`,borderRadius:8,background:J===""?Se.redL:Se.bg,cursor:J===""?"default":"pointer",color:Se.ink},children:J},J))}),e.jsx(it,{variant:"ghost",small:!0,onClick:$,style:{marginTop:16},children:"Volver"})]}):h===3?e.jsxs(Zt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:Se.ink,marginBottom:12},children:" Tmate una selfie"}),e.jsx("div",{style:{fontSize:13,color:Se.inkMid,marginBottom:12},children:"La foto es obligatoria para registrar tu asistencia."}),S?e.jsx("div",{style:{background:Se.redL,border:`1px solid ${Se.red}`,borderRadius:8,padding:12,fontSize:12,color:Se.red,marginBottom:12},children:S}):e.jsx("video",{ref:E,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",borderRadius:8,background:"#000",aspectRatio:"4/3",objectFit:"cover",marginBottom:12}}),e.jsxs(si,{gap:8,style:{justifyContent:"center"},wrap:!0,children:[!S&&e.jsx(it,{icon:xd,onClick:q,style:{width:"100%",justifyContent:"center",fontSize:15,padding:"12px"},children:"Capturar y registrar"}),S&&e.jsx(it,{onClick:B,style:{width:"100%",justifyContent:"center"},children:"Reintentar cmara"}),e.jsx(it,{variant:"ghost",small:!0,onClick:$,children:"Cancelar"})]})]}):h===4?e.jsxs(Zt,{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:Se.ink,marginBottom:12},children:"Confirmar registro"}),c&&e.jsx("img",{src:c,style:{width:"100%",borderRadius:8,marginBottom:12,border:`1px solid ${Se.border}`}}),e.jsxs("div",{style:{background:Se.bg,borderRadius:8,padding:"10px 14px",marginBottom:16,fontSize:13,textAlign:"left"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nombre:"})," ",j==null?void 0:j.nombre]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tipo:"})," ",((ge=z[j==null?void 0:j.id])==null?void 0:ge.length)%2===0?"ENTRADA":"SALIDA"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Hora:"})," ",new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"GPS:"})," ",l?`${l.lat.toFixed(4)}, ${l.lng.toFixed(4)} (${l.precision}m)`:y?"No disponible":"Obteniendo..."]})]}),e.jsxs(si,{gap:8,style:{justifyContent:"center"},wrap:!0,children:[e.jsx(it,{icon:yt,onClick:U,style:{flex:1,justifyContent:"center"},children:"Confirmar fichaje"}),e.jsx(it,{variant:"secondary",onClick:()=>{d(null),x(null),g(null),b(3),B()},children:"Repetir foto"})]}),e.jsx(it,{variant:"ghost",small:!0,onClick:$,style:{marginTop:8},children:"Cancelar"})]}):null})]})}function yf({novedades:t,saveNovedades:i}){const[o,n]=F.useState({tipo:"",estado:"",texto:""}),[s,r]=F.useState(null),[a,u]=F.useState(""),h=F.useMemo(()=>t.filter(m=>!(o.tipo&&m.tipo!==o.tipo||o.estado&&m.estado!==o.estado||o.texto&&!m.empleadoNombre.toLowerCase().includes(o.texto.toLowerCase()))),[t,o]),b=t.filter(m=>m.estado==="Pendiente").length,j=(m,f)=>{i(p=>p.map(c=>c.id===m?{...c,estado:f,comentarioAdmin:a,fechaResolucion:xi()}:c)),r(null),u("")},C=m=>bn.find(f=>f.id===m)||bn[5],v=m=>({Pendiente:{color:"#8C6A00",bg:"#FAF0E0"},"En revisin":{color:"#3B3B3B",bg:"#F0F0F0"},Aprobada:{color:"#111111",bg:"#E8F4EE"},Rechazada:{color:"#B91C1C",bg:"#FAE8E8"}})[m]||{color:"#555",bg:"#EDEBE7"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ti,{label:"Solicitudes pendientes",value:b,color:b>0?D.amber:D.ink,icon:bs}),e.jsx(ti,{label:"Aprobadas este mes",value:t.filter(m=>m.estado==="Aprobada").length,color:D.green,icon:Vo}),e.jsx(ti,{label:"Rechazadas",value:t.filter(m=>m.estado==="Rechazada").length,color:D.red,icon:Ot}),e.jsx(ti,{label:"Total novedades",value:t.length,icon:Cn})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:14,flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:180},children:[e.jsx(ki,{size:13,style:{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",color:D.inkLight}}),e.jsx("input",{value:o.texto,onChange:m=>n(f=>({...f,texto:m.target.value})),placeholder:"Buscar empleado",style:{width:"100%",paddingLeft:30,padding:"7px 10px 7px 30px",border:`1px solid ${D.border}`,borderRadius:3,fontSize:12,color:D.ink,background:D.surface}})]}),e.jsx(vi,{value:o.tipo,onChange:m=>n(f=>({...f,tipo:m})),style:{width:180},options:[{value:"",label:"Todos los tipos"},...bn.map(m=>({value:m.id,label:`${m.icono} ${m.lbl}`}))]}),e.jsx(vi,{value:o.estado,onChange:m=>n(f=>({...f,estado:m})),style:{width:150},options:[{value:"",label:"Todos los estados"},"Pendiente","En revisin","Aprobada","Rechazada"]})]}),e.jsx(Zt,{children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:`2px solid ${D.border}`,background:D.surfaceAlt},children:["Empleado","Tipo","Fecha solicitud","Perodo / Horas","Documento","Estado",""].map(m=>e.jsx("th",{style:{padding:"9px 10px",textAlign:"left",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:D.inkLight,fontWeight:700},children:m},m))})}),e.jsxs("tbody",{children:[h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"40px 0",color:D.inkLight,fontSize:12},children:t.length===0?"Sin novedades. Los empleados las crean desde su portal.":"Sin resultados."})}),h.map(m=>{const f=C(m.tipo),p=v(m.estado);return e.jsxs("tr",{style:{borderBottom:`1px solid ${D.border}`,cursor:"pointer"},onMouseEnter:c=>c.currentTarget.style.background=D.surfaceAlt,onMouseLeave:c=>c.currentTarget.style.background="",onClick:()=>{r(m),u(m.comentarioAdmin||"")},children:[e.jsx("td",{style:{padding:"11px 10px",fontWeight:600},children:m.empleadoNombre}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[e.jsx("span",{children:f.icono}),e.jsx("span",{style:{color:f.color,fontWeight:600,fontSize:11},children:f.lbl})]})}),e.jsx("td",{className:"mono",style:{padding:"11px 10px",color:D.inkLight,fontSize:11},children:m.fechaSolicitud}),e.jsxs("td",{style:{padding:"11px 10px",fontSize:11},children:[m.fechaInicio&&e.jsx("span",{className:"mono",children:m.fechaInicio}),m.fechaFin&&e.jsxs("span",{className:"mono",style:{color:D.inkLight},children:["  ",m.fechaFin]}),m.horas>0&&e.jsxs("span",{className:"mono",children:[" ",m.horas," h"]}),m.dias>0&&e.jsxs("span",{style:{color:D.inkMid},children:[" (",m.dias," das)"]})]}),e.jsx("td",{style:{padding:"11px 10px"},children:m.docNombre?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,color:D.green,fontSize:11},children:[e.jsx(ma,{size:11}),m.docNombre]}):e.jsx("span",{style:{color:D.inkXLight,fontSize:10},children:"Sin doc."})}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsx(Ut,{color:p.color,bg:p.bg,children:m.estado})}),e.jsx("td",{style:{padding:"11px 10px"},children:e.jsx(Xi,{size:14,color:D.inkXLight})})]},m.id)})]})]})}),s&&(()=>{const m=C(s.tipo),f=v(s.estado);return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(null),children:e.jsxs("div",{className:"pop-in",style:{background:D.surface,borderRadius:6,width:560,maxWidth:"95vw",maxHeight:"90vh",overflowY:"auto",boxShadow:D.shadowMd},onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{style:{padding:"18px 22px",borderBottom:`1px solid ${D.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",background:m.bg},children:[e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:26},children:m.icono}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,fontSize:14,color:m.color},children:m.lbl}),e.jsxs("div",{style:{fontSize:11,color:m.color,opacity:.7},children:[s.empleadoNombre,"  Solicitud ",s.fechaSolicitud]})]})]}),e.jsx(Ut,{color:f.color,bg:"rgba(255,255,255,.7)",children:s.estado})]}),e.jsxs("div",{style:{padding:"20px 22px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[{lbl:"Tipo",val:m.lbl},{lbl:"Estado",val:s.estado},s.fechaInicio&&{lbl:"Fecha inicio",val:s.fechaInicio},s.fechaFin&&{lbl:"Fecha fin",val:s.fechaFin},s.dias>0&&{lbl:"Das solicitados",val:`${s.dias} das`},s.horas>0&&{lbl:"Horas",val:`${s.horas} h`},s.motivo&&{lbl:"Motivo",val:s.motivo}].filter(Boolean).map(p=>e.jsxs("div",{style:{background:D.accent,borderRadius:3,padding:"10px 12px"},children:[e.jsx(Ht,{children:p.lbl}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:D.ink,marginTop:3},children:p.val})]},p.lbl))}),s.descripcion&&e.jsxs("div",{style:{background:D.accent,borderRadius:3,padding:"10px 12px",marginBottom:12},children:[e.jsx(Ht,{children:"Descripcin del empleado"}),e.jsx("p",{style:{fontSize:12,color:D.inkMid,marginTop:4,lineHeight:1.5},children:s.descripcion})]}),s.docNombre&&e.jsxs("div",{style:{background:D.blueBg,border:`1px solid ${D.blue}33`,borderRadius:3,padding:"10px 12px",marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[e.jsx(ma,{size:14,color:D.blue}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:D.blue},children:"Documento adjunto"}),e.jsx("div",{style:{fontSize:11,color:D.blue,opacity:.8},children:s.docNombre})]}),s.docBase64&&e.jsx("a",{href:s.docBase64,download:s.docNombre,style:{marginLeft:"auto",fontSize:10,color:D.blue,textDecoration:"underline"},children:"Descargar"})]}),s.fechaResolucion&&s.comentarioAdmin&&e.jsxs("div",{style:{background:s.estado==="Aprobada"?D.greenBg:D.redBg,borderRadius:3,padding:"10px 12px",marginBottom:12},children:[e.jsxs(Ht,{children:["Resolucin  ",s.fechaResolucion]}),e.jsx("p",{style:{fontSize:12,color:D.inkMid,marginTop:4},children:s.comentarioAdmin})]}),s.estado==="Pendiente"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:10},children:[e.jsx(Ht,{children:"Comentario para el empleado (opcional)"}),e.jsx("textarea",{value:a,onChange:p=>u(p.target.value),placeholder:"Motivo de aprobacin o rechazo",style:{width:"100%",marginTop:5,padding:"8px 10px",border:`1px solid ${D.border}`,borderRadius:3,fontSize:12,minHeight:70,resize:"vertical",fontFamily:"'DM Sans',sans-serif"}})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx(it,{variant:"outline",onClick:()=>r(null),children:"Cancelar"}),e.jsxs(it,{variant:"danger",onClick:()=>j(s.id,"Rechazada"),children:[e.jsx(Ot,{size:12}),"Rechazar"]}),e.jsxs(it,{variant:"success",onClick:()=>j(s.id,"Aprobada"),children:[e.jsx(yt,{size:12}),"Aprobar"]})]})]}),s.estado!=="Pendiente"&&e.jsx("div",{style:{textAlign:"right"},children:e.jsx(it,{variant:"outline",onClick:()=>r(null),children:"Cerrar"})})]})]})})})()]})}const Zr=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],un=[{value:"nomina",label:"Nmina",color:D.blue},{value:"contrato",label:"Contrato",color:D.green},{value:"certificado",label:"Certificado laboral",color:D.amber},{value:"retencion",label:"Retencin fuente",color:D.red},{value:"otro_laboral",label:"Otro documento",color:D.inkMid},{value:"otro",label:"Otro",color:D.inkLight}],vf=(t="")=>({id:Qi(),empleadoNombre:t,tipo:"nomina",nombre:"",docNombre:"",docBase64:null,anio:new Date().getFullYear(),mes:"",fechaSubida:xi()});function jf({docs:t,saveDocs:i,fichas:o,cargos:n}){const[s,r]=F.useState(null),[a,u]=F.useState(""),[h,b]=F.useState(""),[j,C]=F.useState(!1),v=F.useMemo(()=>{const l=new Set;return o.forEach(x=>l.add(x.nombre)),t.forEach(x=>l.add(x.empleadoNombre)),[...l].sort()},[o,t]),m=t.filter(l=>!(a&&l.empleadoNombre!==a||h&&l.tipo!==h)),f=l=>un.find(x=>x.value===l)||un[5],p=l=>{const x=l.target.files[0];if(!x)return;const y=new FileReader;y.onload=g=>r(S=>({...S,docNombre:x.name,docBase64:g.target.result})),y.readAsDataURL(x)},c=()=>{if(!s.empleadoNombre||!s.docNombre)return;const l={...s,fechaSubida:xi()};i(x=>j?[...x,l]:x.map(y=>y.id===l.id?l:y)),r(null)},d=(l="")=>{r({...vf(l)}),C(!0)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:18},children:[e.jsx(ti,{label:"Total documentos",value:t.length,icon:Bt}),e.jsx(ti,{label:"Empleados con docs",value:new Set(t.map(l=>l.empleadoNombre)).size,icon:Ri}),e.jsx(ti,{label:"Nminas subidas",value:t.filter(l=>l.tipo==="nomina").length,icon:zo,color:D.blue}),e.jsx(ti,{label:"Contratos",value:t.filter(l=>l.tipo==="contrato").length,icon:zn,color:D.green})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:14,alignItems:"center"},children:[e.jsx(vi,{value:a,onChange:u,style:{width:200},options:[{value:"",label:"Todos los empleados"},...v.map(l=>({value:l,label:l}))]}),e.jsx(vi,{value:h,onChange:b,style:{width:200},options:[{value:"",label:"Todos los tipos"},...un]}),e.jsx("div",{style:{flex:1}}),e.jsxs(it,{variant:"primary",small:!0,onClick:()=>d(a),children:[e.jsx(Ne,{size:12}),"Subir documento"]})]}),a===""?v.length===0?e.jsx(Zt,{children:e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:D.inkLight},children:[e.jsx(Bt,{size:32,style:{opacity:.2,marginBottom:10}}),e.jsx("p",{style:{fontSize:12},children:"Sin documentos an. Los empleados se crean desde sus fichas en el Portal."})]})}):v.map(l=>{var y;const x=t.filter(g=>g.empleadoNombre===l&&(!h||g.tipo===h));return x.length===0&&h?null:e.jsxs(Zt,{style:{marginBottom:12},children:[e.jsx(so,{action:e.jsxs(it,{small:!0,variant:"ghost",onClick:()=>d(l),children:[e.jsx(Ne,{size:11}),"Aadir"]}),children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:3,background:D.ink,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:800},children:(y=l[0])==null?void 0:y.toUpperCase()}),l,e.jsxs(Ut,{children:[x.length," docs"]})]})}),x.length===0?e.jsx("p",{style:{fontSize:11,color:D.inkLight},children:"Sin documentos para este empleado."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:8},children:x.map(g=>{const S=f(g.tipo);return e.jsxs("div",{style:{border:`1px solid ${D.border}`,borderRadius:4,padding:"12px 14px",background:D.surfaceAlt},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,color:S.color},children:S.label}),e.jsxs("div",{style:{display:"flex",gap:4},children:[g.docBase64&&e.jsx("a",{href:g.docBase64,download:g.docNombre,style:{fontSize:9,color:D.blue,textDecoration:"none",padding:"2px 6px",border:`1px solid ${D.blue}33`,borderRadius:2},children:""}),e.jsx("button",{onClick:()=>i(A=>A.filter(E=>E.id!==g.id)),style:{background:"none",border:"none",cursor:"pointer",color:D.red,fontSize:11,padding:"1px 4px"},children:""})]})]}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:D.ink,marginBottom:2},children:g.docNombre||g.nombre||""}),(g.anio||g.mes)&&e.jsxs("div",{style:{fontSize:10,color:D.inkLight},children:[g.mes?Zr[Number(g.mes)-1]:""," ",g.anio]}),e.jsxs("div",{style:{fontSize:9,color:D.inkXLight,marginTop:3},children:["Subido ",g.fechaSubida]})]},g.id)})})]},l)}):e.jsxs(Zt,{children:[e.jsxs(so,{action:e.jsxs(it,{small:!0,variant:"primary",onClick:()=>d(a),children:[e.jsx(Ne,{size:12}),"Subir"]}),children:["Documentos de ",a]}),m.length===0?e.jsx("p",{style:{textAlign:"center",color:D.inkLight,padding:"30px 0",fontSize:12},children:"Sin documentos."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:8},children:m.map(l=>{const x=f(l.tipo);return e.jsxs("div",{style:{border:`1px solid ${D.border}`,borderRadius:4,padding:"12px 14px",background:D.surfaceAlt},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:x.color,marginBottom:4},children:x.label}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:D.ink},children:l.docNombre||l.nombre||""}),(l.anio||l.mes)&&e.jsxs("div",{style:{fontSize:10,color:D.inkLight},children:[l.mes?Zr[Number(l.mes)-1]:""," ",l.anio]}),l.docBase64&&e.jsx("a",{href:l.docBase64,download:l.docNombre,style:{fontSize:10,color:D.blue,display:"block",marginTop:4},children:"Descargar "})]},l.id)})})]}),s&&e.jsxs(es,{title:j?"Subir documento":"Editar documento",onClose:()=>r(null),wide:!0,children:[e.jsx(jt,{label:"Empleado",children:v.length>0?e.jsx(vi,{value:s.empleadoNombre,onChange:l=>r(x=>({...x,empleadoNombre:l})),options:[{value:"",label:"Seleccionar empleado"},...v.map(l=>({value:l,label:l}))]}):e.jsx(vt,{value:s.empleadoNombre,onChange:l=>r(x=>({...x,empleadoNombre:l})),placeholder:"Nombre del empleado"})}),e.jsx(jt,{label:"Tipo de documento",children:e.jsx(vi,{value:s.tipo,onChange:l=>r(x=>({...x,tipo:l})),options:un})}),(s.tipo==="nomina"||s.tipo==="certificado"||s.tipo==="retencion")&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:10},children:[e.jsxs("div",{children:[e.jsx(Ht,{children:"Ao"}),e.jsx(vt,{type:"number",value:s.anio,onChange:l=>r(x=>({...x,anio:l})),style:{marginTop:4}})]}),e.jsxs("div",{children:[e.jsxs(Ht,{children:["Mes ",s.tipo==="certificado"||s.tipo==="retencion"?"(opcional)":""]}),e.jsx(vi,{value:s.mes,onChange:l=>r(x=>({...x,mes:l})),style:{marginTop:4},options:[{value:"",label:""},...Zr.map((l,x)=>({value:x+1,label:l}))]})]})]}),e.jsx(jt,{label:"Descripcin (opcional)",children:e.jsx(vt,{value:s.nombre,onChange:l=>r(x=>({...x,nombre:l})),placeholder:"Ej. Nmina mayo 2025"})}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx(Ht,{children:"Archivo"}),e.jsxs("div",{style:{marginTop:6,display:"flex",alignItems:"center",gap:10},children:[e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6,padding:"7px 14px",background:D.accent,border:`1px solid ${D.border}`,borderRadius:3,cursor:"pointer",fontSize:11,color:D.inkMid,fontWeight:600},children:[e.jsx(ma,{size:12}),"Seleccionar archivo",e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.xlsx",onChange:p,style:{display:"none"}})]}),s.docNombre&&e.jsxs("span",{style:{fontSize:11,color:D.green,display:"flex",alignItems:"center",gap:4},children:[e.jsx(Vo,{size:12}),s.docNombre]})]}),e.jsx("p",{style:{fontSize:9,color:D.inkLight,marginTop:5},children:"PDF, imagen o Word. Se almacena como base64 en el navegador."})]}),e.jsx(ts,{onCancel:()=>r(null),onSave:c,saveLabel:"Subir documento"})]})]})}function es({title:t,children:i,onClose:o,wide:n}){return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"},onClick:o,children:e.jsxs("div",{className:"pop-in",style:{background:D.surface,borderRadius:6,padding:28,width:n?600:480,maxWidth:"95vw",boxShadow:D.shadowMd,maxHeight:"90vh",overflowY:"auto"},onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:20,fontSize:15,fontWeight:700},children:t}),i]})})}function Sf({partes:t,savePartes:i,novedades:o,saveNovedades:n,fichas:s,saveFichas:r,docs:a,saveDocs:u,cargos:h,empleados:b,saveEmpleados:j}){const[C,v]=F.useState(""),[m,f]=F.useState(!1),[p,c]=F.useState("calendario"),[d,l]=F.useState(new Date().getFullYear()),[x,y]=F.useState(new Date().getMonth()),[g,S]=F.useState(null),[A,E]=F.useState(null),[w,I]=F.useState(null),[z,B]=F.useState(!1),[P,q]=F.useState(null),U=["Lu","Ma","Mi","Ju","Vi","Sa","Do"],$=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],Y=["OT-DIN_250101_01","OT-INT_250115_02","OT-INT_250201_03"],ge=t.filter(K=>K.empleadoNombre===C),J=o.filter(K=>K.empleadoNombre===C),ye=a.filter(K=>K.empleadoNombre===C),oe=s.find(K=>K.nombre===C)||Ls(C),L=K=>bn.find(Me=>Me.id===K)||bn[5],R=(K,Me)=>!K||!Me?0:Math.max(0,Math.round((new Date(Me)-new Date(K))/864e5)+1),T=(K,Me,We)=>`${K}-${String(Me+1).padStart(2,"0")}-${String(We).padStart(2,"0")}`,W=F.useMemo(()=>{const K=(new Date(d,x,1).getDay()+6)%7,Me=new Date(d,x+1,0).getDate();return[...Array(K).fill(null),...Array.from({length:Me},(We,tt)=>tt+1)]},[d,x]),X=F.useMemo(()=>{const K={};return ge.forEach(Me=>{var We;(K[We=Me.fecha]??(K[We]=[])).push({kind:"parte",obj:Me})}),J.forEach(Me=>{if(!Me.fechaInicio)return;const We=new Date(Me.fechaInicio),tt=Me.fechaFin?new Date(Me.fechaFin):We;for(let gt=new Date(We);gt<=tt;gt.setDate(gt.getDate()+1)){const St=gt.toISOString().slice(0,10);(K[St]??(K[St]=[])).push({kind:"novedad",obj:Me})}}),K},[ge,J]),M=J.filter(K=>K.estado==="Pendiente").length,O=ge.filter(K=>K.estado==="Aprobado").reduce((K,Me)=>K+Number(Me.horasNormales||0)+Number(Me.horasExtra||0),0),ne=J.filter(K=>K.tipo==="vacaciones"&&K.estado==="Aprobada").reduce((K,Me)=>K+Number(Me.dias||0),0),ie=J.find(K=>K.tipo==="baja"&&K.estado==="Aprobada"&&!K.fechaFin),re=(K,Me,We)=>K(tt=>({...tt,[Me]:We})),H=K=>({Borrador:{c:D.inkLight,bg:D.accent},Enviado:{c:D.blue,bg:D.blueBg},Aprobado:{c:D.green,bg:D.greenBg},Rechazado:{c:D.red,bg:D.redBg},Pendiente:{c:"#8C6A00",bg:"#FAF0E0"},Aprobada:{c:D.green,bg:D.greenBg},Rechazada:{c:D.red,bg:D.redBg}})[K]||{c:D.inkLight,bg:D.accent},se=()=>{if(!(A!=null&&A.otCodigo)||!(A!=null&&A.actividad))return;const K=!t.find(Me=>Me.id===A.id);i(Me=>K?[...Me,A]:Me.map(We=>We.id===A.id?A:We)),E(null)},N=K=>i(Me=>Me.map(We=>We.id===K?{...We,estado:"Enviado"}:We)),G=()=>{if(!(w!=null&&w.tipo))return;const K=R(w.fechaInicio,w.fechaFin),Me={...w,dias:K,empleadoNombre:C,estado:"Pendiente"},We=!o.find(tt=>tt.id===Me.id);n(tt=>We?[...tt,Me]:tt.map(gt=>gt.id===Me.id?Me:gt)),I(null)},ue=()=>{if(!P)return;const K={...P,nombre:C},Me=s.find(We=>We.nombre===C);r(We=>Me?We.map(tt=>tt.nombre===C?K:tt):[...We,K]),B(!1)},he={page:{minHeight:"100vh",background:D.bg,fontFamily:"'DM Sans',sans-serif"},card:{background:D.surface,border:`1px solid ${D.border}`,borderRadius:6,padding:"16px 18px",marginBottom:12},row:{display:"flex",gap:8,alignItems:"center"},col:{display:"flex",flexDirection:"column",gap:4},th:{padding:"7px 10px",fontSize:9,letterSpacing:1.2,textTransform:"uppercase",color:D.inkLight,fontWeight:700,textAlign:"left",borderBottom:`2px solid ${D.border}`},td:{padding:"9px 10px",borderBottom:`1px solid ${D.border}`,fontSize:12},overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",zIndex:300,display:"flex",alignItems:"center",justifyContent:"center"},modal:{background:D.surface,borderRadius:6,padding:24,width:460,maxWidth:"95vw",boxShadow:D.shadowMd,maxHeight:"90vh",overflowY:"auto"},navBtn:K=>({padding:"11px 14px",border:"none",background:"transparent",borderBottom:K?`2px solid ${D.ink}`:"2px solid transparent",color:K?D.ink:D.inkLight,fontSize:10,fontWeight:K?700:400,letterSpacing:.3,textTransform:"uppercase",cursor:"pointer",whiteSpace:"nowrap",flexShrink:0,display:"flex",alignItems:"center",gap:5}),calDay:(K,Me,We)=>({borderRadius:4,aspectRatio:"1",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:11,fontWeight:K.c?700:400,color:We?"#fff":K.c||D.ink,background:We?D.ink:K.bg||"transparent",border:Me?`1px solid ${D.ink}`:"1px solid transparent"}),kpiMini:K=>({flex:1,background:D.surface,border:`1px solid ${D.border}`,borderRadius:5,padding:"10px 12px",minWidth:0})};if(!m)return e.jsx("div",{style:{...he.page,display:"flex",alignItems:"center",justifyContent:"center",padding:20},children:e.jsxs("div",{style:{...he.card,width:360,overflow:"hidden",padding:0},children:[e.jsxs("div",{style:{background:D.ink,padding:"28px 24px",textAlign:"center"},children:[e.jsxs("svg",{width:34,height:34,viewBox:"0 0 34 34",fill:"none",style:{margin:"0 auto 12px",display:"block"},children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:"rgba(255,255,255,.25)",strokeWidth:"0.8"}),e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:"#fff",strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:"#fff"}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:"#fff"}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:"#fff"})]}),e.jsx("div",{style:{fontSize:14,fontWeight:800,letterSpacing:3,textTransform:"uppercase",color:"#fff"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:11,color:"rgba(255,255,255,.4)",marginTop:3},children:"Portal del Empleado"})]}),e.jsxs("div",{style:{padding:"20px 20px 16px"},children:[e.jsx("p",{style:{fontSize:11,color:D.inkLight,marginBottom:10,textAlign:"center"},children:"Introduce tu nombre completo para acceder"}),e.jsx(vt,{value:C,onChange:v,placeholder:"Ej. Mara Garca Lpez",style:{marginBottom:8},onKeyDown:K=>K.key==="Enter"&&C.trim()&&f(!0)}),e.jsx("button",{onClick:()=>C.trim()&&f(!0),style:{width:"100%",padding:"9px",background:D.ink,color:"#fff",border:"none",borderRadius:3,fontSize:12,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Entrar al portal"}),e.jsx("p",{style:{fontSize:9,color:D.inkXLight,marginTop:10,textAlign:"center",lineHeight:1.4},children:"Fase 1  En produccin se usar email + contrasea"})]})]})});const we=[{id:"calendario",lbl:" Calendario",badge:0},{id:"partes",lbl:" Mis Partes",badge:ge.filter(K=>K.estado==="Borrador").length},{id:"solicitudes",lbl:" Solicitudes",badge:M},{id:"viajes",lbl:" Viajes",badge:0},{id:"ficha",lbl:" Mi Ficha",badge:0},{id:"documentos",lbl:" Mis Docs",badge:0}],Ve=new Date().toISOString().slice(0,10),Ee=()=>{let K=x-1,Me=d;K<0&&(K=11,Me--),y(K),l(Me)},je=()=>{let K=x+1,Me=d;K>11&&(K=0,Me++),y(K),l(Me)},V=()=>e.jsxs("div",{className:"fade-up",children:[ie&&e.jsxs("div",{style:{background:D.redBg,border:`1px solid ${D.red}33`,borderRadius:4,padding:"10px 14px",marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:18},children:""}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:D.red},children:["Baja mdica activa desde ",ie.fechaInicio]}),e.jsx("div",{style:{fontSize:10,color:D.red,opacity:.7},children:ie.motivo})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginBottom:14},children:[["Horas aprobadas",`${O}h`,D.blue],["Das vacaciones",`${ne}d`,D.green],["Partes borrador",ge.filter(K=>K.estado==="Borrador").length,D.amber],["Sol. pendientes",M,M>0?D.amber:D.ink]].map(([K,Me,We])=>e.jsxs("div",{style:he.kpiMini(),children:[e.jsx("div",{style:{fontSize:9,letterSpacing:1,textTransform:"uppercase",color:D.inkLight,marginBottom:4},children:K}),e.jsx("div",{style:{fontSize:20,fontWeight:800,color:We,fontFamily:"'DM Mono',monospace"},children:Me})]},K))}),e.jsxs("div",{style:he.card,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("button",{onClick:Ee,style:{background:D.accent,border:`1px solid ${D.border}`,borderRadius:3,padding:"5px 12px",cursor:"pointer",fontSize:16},children:""}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:15,fontWeight:800,color:D.ink},children:[$[x]," ",d]}),e.jsx("div",{style:{fontSize:10,color:D.inkLight,marginTop:1},children:"Pulsa un da para ver / imputar"})]}),e.jsx("button",{onClick:je,style:{background:D.accent,border:`1px solid ${D.border}`,borderRadius:3,padding:"5px 12px",cursor:"pointer",fontSize:16},children:""})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,marginBottom:4},children:U.map(K=>e.jsx("div",{style:{textAlign:"center",fontSize:9,fontWeight:700,color:D.inkLight,padding:"4px 0",letterSpacing:.5},children:K},K))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2},children:W.map((K,Me)=>{if(!K)return e.jsx("div",{},`e${Me}`);const We=T(d,x,K),tt=X[We]||[],gt=We===Ve,St=We===g,Tt=new Date(d,x,K).getDay()%6===0;let Mi=null;return tt.some(pi=>pi.kind==="novedad"&&pi.obj.estado==="Rechazada")?Mi=D.red:tt.some(pi=>pi.kind==="novedad"&&pi.obj.estado==="Aprobada")?Mi=D.green:tt.some(pi=>pi.kind==="novedad"&&pi.obj.estado==="Pendiente")?Mi="#8C6A00":tt.some(pi=>pi.kind==="parte"&&pi.obj.estado==="Aprobado")?Mi=D.blue:tt.length&&(Mi="#555"),e.jsxs("div",{onClick:()=>{S(We===g?null:We)},style:{borderRadius:4,padding:"5px 2px",display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",background:St?D.ink:Tt?"#F8F7F4":"transparent",border:gt?`1px solid ${D.ink}`:"1px solid transparent",transition:"background .1s"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:St||gt?700:400,color:St?"#fff":Tt?D.inkLight:D.ink},children:K}),Mi&&e.jsx("div",{style:{width:4,height:4,borderRadius:"50%",background:St?"rgba(255,255,255,.7)":Mi,marginTop:2}})]},We)})})]}),g&&(()=>{const K=X[g]||[],Me=new Date(g+"T12:00:00").toLocaleDateString("es-CO",{weekday:"long",day:"numeric",month:"long"});return e.jsxs("div",{style:he.card,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:D.ink,textTransform:"capitalize"},children:Me}),e.jsxs(it,{small:!0,variant:"primary",onClick:()=>E({...$l(),fecha:g}),children:[e.jsx(Ne,{size:11}),"Imputar horas"]})]}),K.length===0&&e.jsx("p",{style:{fontSize:11,color:D.inkLight,textAlign:"center",padding:"12px 0"},children:"Sin registros para este da."}),K.map((We,tt)=>{const gt=H(We.obj.estado);if(We.kind==="parte"){const Tt=We.obj;return e.jsxs("div",{style:{background:D.surfaceAlt,borderRadius:4,padding:"10px 12px",marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{fontWeight:600,fontSize:12},children:[Tt.otCodigo,"  ",Tt.actividad]}),e.jsx(Ut,{color:gt.c,bg:gt.bg,children:Tt.estado})]}),e.jsxs("div",{style:{fontSize:11,color:D.inkMid,marginTop:4},children:[Tt.horasNormales,"h normales  ",Tt.horasExtra,"h extra"]}),Tt.estado==="Borrador"&&e.jsx("div",{style:{marginTop:6},children:e.jsx(it,{small:!0,variant:"primary",onClick:()=>N(Tt.id),children:"Enviar"})})]},tt)}const St=L(We.obj.tipo);return e.jsxs("div",{style:{background:St.bg,borderRadius:4,padding:"10px 12px",marginBottom:6},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{fontWeight:600,fontSize:12,color:St.color},children:[St.icono," ",St.lbl]}),e.jsx(Ut,{color:gt.c,bg:gt.bg,children:We.obj.estado})]}),We.obj.motivo&&e.jsx("div",{style:{fontSize:11,color:St.color,opacity:.8,marginTop:3},children:We.obj.motivo})]},tt)})]})})()]}),te=()=>e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:e.jsxs(it,{variant:"primary",small:!0,onClick:()=>E({...$l(),fecha:Ve}),children:[e.jsx(Ne,{size:11}),"Nuevo parte"]})}),ge.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:D.inkLight},children:[e.jsx(Cn,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin partes registrados."})]}):e.jsx("div",{style:{padding:0},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Fecha","OT","Actividad","H.Norm","H.Extra","Estado",""].map(K=>e.jsx("th",{style:he.th,children:K},K))})}),e.jsx("tbody",{children:ge.sort((K,Me)=>{var We;return((We=Me.fecha)==null?void 0:We.localeCompare(K.fecha))||0}).map(K=>{const Me=H(K.estado);return e.jsxs("tr",{onMouseEnter:We=>We.currentTarget.style.background=D.surfaceAlt,onMouseLeave:We=>We.currentTarget.style.background="",children:[e.jsx("td",{style:he.td,className:"mono",children:K.fecha}),e.jsx("td",{style:he.td,children:K.otCodigo}),e.jsx("td",{style:he.td,children:K.actividad}),e.jsx("td",{style:{...he.td,textAlign:"center"},children:K.horasNormales}),e.jsx("td",{style:{...he.td,textAlign:"center"},children:K.horasExtra||0}),e.jsx("td",{style:he.td,children:e.jsx(Ut,{color:Me.c,bg:Me.bg,children:K.estado})}),e.jsxs("td",{style:he.td,children:[K.estado==="Borrador"&&e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx(it,{small:!0,variant:"primary",onClick:()=>N(K.id),children:"Enviar"}),e.jsx(it,{small:!0,variant:"ghost",onClick:()=>E({...K}),children:e.jsx(ro,{size:11})}),e.jsx(it,{small:!0,variant:"danger",onClick:()=>i(We=>We.filter(tt=>tt.id!==K.id)),children:e.jsx(Je,{size:11})})]}),K.estado==="Rechazado"&&K.comentarioAdmin&&e.jsxs("span",{style:{fontSize:10,color:D.red},children:["Motivo: ",K.comentarioAdmin]})]})]},K.id)})})]})})]}),ce=()=>e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:e.jsxs(it,{variant:"primary",small:!0,onClick:()=>I({...pf(C)}),children:[e.jsx(Ne,{size:11}),"Nueva solicitud"]})}),J.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:D.inkLight},children:[e.jsx(bs,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin solicitudes."})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:J.sort((K,Me)=>{var We;return((We=Me.fechaSolicitud)==null?void 0:We.localeCompare(K.fechaSolicitud))||0}).map(K=>{const Me=L(K.tipo),We=H(K.estado);return e.jsx("div",{style:{...he.card,borderLeft:`3px solid ${Me.color}`,marginBottom:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:16},children:Me.icono}),e.jsx("span",{style:{fontWeight:700,fontSize:13,color:Me.color},children:Me.lbl}),e.jsx(Ut,{color:We.c,bg:We.bg,children:K.estado})]}),K.fechaInicio&&e.jsxs("div",{style:{fontSize:11,color:D.inkMid},children:[K.fechaInicio,K.fechaFin&&`  ${K.fechaFin}`," ",K.dias>0&&` ${K.dias} das`]}),K.horas>0&&e.jsxs("div",{style:{fontSize:11,color:D.inkMid},children:[K.horas,"h"]}),K.motivo&&e.jsx("div",{style:{fontSize:11,color:D.inkMid,marginTop:2},children:K.motivo}),K.comentarioAdmin&&e.jsxs("div",{style:{fontSize:11,color:We.c,marginTop:4,fontStyle:"italic"},children:["Admin: ",K.comentarioAdmin]})]}),e.jsx("div",{style:{fontSize:10,color:D.inkLight},children:K.fechaSolicitud})]})},K.id)})})]}),pe=()=>{const K=z?P:oe;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700,color:D.ink},children:"Mi Ficha Personal"}),z?e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx(it,{small:!0,variant:"outline",onClick:()=>B(!1),children:"Cancelar"}),e.jsxs(it,{small:!0,variant:"primary",onClick:ue,children:[e.jsx(ko,{size:11}),"Guardar"]})]}):e.jsxs(it,{small:!0,variant:"outline",onClick:()=>{q({...oe}),B(!0)},children:[e.jsx(ro,{size:11}),"Editar"]})]}),[{sec:"Datos Personales",fields:[["Nombre",K.nombre],["Apellidos",K.apellidos],["Email",K.email],["Telfono",K.telefono],["Fecha nacimiento",K.fechaNacimiento],["Documento",`${K.tipoDocumento} ${K.numeroDocumento}`]]},{sec:"Contrato",fields:[["Cargo",K.cargo],["Tipo contrato",K.tipoContrato],["Fecha ingreso",K.fechaIngreso],["Salario bruto",K.salarioBruto?`$ ${Number(K.salarioBruto).toLocaleString()}`:""]]},{sec:"Seguridad Social",fields:[["EPS",K.eps],["AFP",K.afp],["ARL",K.arl],["Caja compensacin",K.cajaCompensacion]]},{sec:"Datos Bancarios",fields:[["Entidad",K.entidadBancaria],["Tipo cuenta",K.tipoCuenta],["N cuenta",K.cuentaBancaria]]}].map(({sec:Me,fields:We})=>e.jsxs("div",{style:he.card,children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1.2,textTransform:"uppercase",color:D.inkLight,fontWeight:700,marginBottom:10},children:Me}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:We.map(([tt,gt])=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:D.inkLight,letterSpacing:.5,textTransform:"uppercase",marginBottom:2},children:tt}),z?e.jsx(vt,{value:P[Object.keys(Ls()).find(St=>Ls()[St]===gt||tt.toLowerCase().includes(St.toLowerCase()))||tt]||"",onChange:St=>q(Tt=>({...Tt,[tt.toLowerCase().replace(/\s/g,"")]:St})),small:!0}):e.jsx("div",{style:{fontSize:12,color:D.ink,fontWeight:gt?400:300},children:gt||e.jsx("span",{style:{color:D.inkXLight},children:""})})]},tt))})]},Me))]})},_=()=>e.jsx("div",{className:"fade-up",children:ye.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:D.inkLight},children:[e.jsx(zo,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Sin documentos compartidos todava."}),e.jsx("p",{style:{fontSize:11,color:D.inkXLight,marginTop:4},children:"Cuando RRHH suba tus documentos aparecern aqu."})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:ye.map(K=>{const Me=un.find(We=>We.value===K.tipo)||un[5];return e.jsxs("div",{style:{...he.card,display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:0},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:2},children:[e.jsx("span",{children:Me.label}),e.jsxs(Ut,{color:Me.color,bg:Me.color+"22",children:[Zr[K.mes-1]||""," ",K.anio]})]}),e.jsx("div",{style:{fontSize:11,color:D.inkMid},children:K.nombre||K.docNombre})]}),K.docBase64&&e.jsx("a",{href:K.docBase64,download:K.docNombre||"documento.pdf",children:e.jsxs(it,{small:!0,variant:"outline",children:[e.jsx(vn,{size:11}),"Descargar"]})})]},K.id)})})}),ae="habitaris_admin",Be=async()=>{try{const K=Fe.getSync(ae);return K?JSON.parse(K):{}}catch{return{}}},Q=async(K,Me)=>{const We=await Be();We[K]=Me,Fe.set(ae,JSON.stringify(We))},[me,le]=F.useState(()=>(Be().adm_viaticos||[]).filter(K=>K.solicitante===C)),[be,Te]=F.useState(!1),[$e,Ye]=F.useState(null),[bt,Ct]=F.useState({destino:"",dias:1,concepto:"",fecha:xi(),fechaRegreso:""}),ft=[{id:"vuelo_ida",lbl:"Vuelo ida",icon:""},{id:"vuelo_vuelta",lbl:"Vuelo vuelta",icon:""},{id:"hotel",lbl:"Hotel",icon:""},{id:"transporte",lbl:"Transporte",icon:""},{id:"alimentacion",lbl:"Alimentacin",icon:""},{id:"otros",lbl:"Otros",icon:""}],wi=()=>{const K={};ft.forEach(tt=>{K[tt.id]={estimado:0,real:0,detalle:""}});const Me={id:Math.random().toString(36).slice(2,10),solicitante:C,...bt,dias:parseInt(bt.dias)||1,estado:"solicitado",gastos:[],anticipoEntregado:0,itemsViaje:K,creadoDesde:"portal"},We=[...Be().adm_viaticos||[],Me];Q("adm_viaticos",We),le(We.filter(tt=>tt.solicitante===C)),Ye(Me.id),Ct({destino:"",dias:1,concepto:"",fecha:xi(),fechaRegreso:""}),Te(!1)},di=(K,Me,We,tt)=>{const gt=(Be().adm_viaticos||[]).map(St=>{if(St.id!==K)return St;const Tt={...St.itemsViaje||{}};return Tt[Me]={...Tt[Me]||{estimado:0,real:0,detalle:""},[We]:tt},{...St,itemsViaje:Tt}});Q("adm_viaticos",gt),le(gt.filter(St=>St.solicitante===C))},jr=(K,Me)=>{const We=(Be().adm_viaticos||[]).map(tt=>tt.id===K?{...tt,gastos:[...tt.gastos||[],{id:Math.random().toString(36).slice(2,10),...Me}]}:tt);Q("adm_viaticos",We),le(We.filter(tt=>tt.solicitante===C))},Zi=K=>ft.reduce((Me,We)=>{var tt;return Me+(parseFloat((tt=(K.itemsViaje||{})[We.id])==null?void 0:tt.estimado)||0)},0),Sr=K=>ft.reduce((Me,We)=>{var tt;return Me+(parseFloat((tt=(K.itemsViaje||{})[We.id])==null?void 0:tt.real)||0)},0)+(K.gastos||[]).reduce((Me,We)=>Me+We.monto,0),Cr={solicitado:{lbl:"Solicitado",c:D.amber},aprobado:{lbl:"Aprobado",c:D.blue},entregado:{lbl:"Anticipo entregado",c:"#5B3A8C"},legalizado:{lbl:"Legalizado",c:D.green},rechazado:{lbl:"Rechazado",c:D.red}};me.find(K=>K.id===$e);const[Gt,ci]=F.useState(null),Qa=()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700},children:" Mis Viajes y Viticos"}),e.jsx("p",{style:{margin:0,fontSize:10,color:D.inkLight},children:"Solicita viticos, registra gastos y legaliza"})]}),e.jsxs("button",{onClick:()=>Te(!0),style:{padding:"8px 16px",background:D.ink,color:"#fff",border:"none",borderRadius:5,fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:5},children:[e.jsx(Ne,{size:11})," Solicitar viaje"]})]}),me.length===0?e.jsxs("div",{style:{...he.card,textAlign:"center",padding:40,color:D.inkLight},children:[e.jsx(zo,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"No tienes solicitudes de viaje."}),e.jsx("p",{style:{fontSize:10,color:D.inkXLight},children:'Pulsa "Solicitar viaje" para crear una.'})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:me.map(K=>{const Me=Zi(K),We=Sr(K),tt=Cr[K.estado]||Cr.solicitado;return e.jsxs("div",{onClick:()=>Ye(K.id===$e?null:K.id),style:{...he.card,cursor:"pointer",marginBottom:0,border:$e===K.id?`2px solid ${D.ink}`:`1px solid ${D.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[K.destino," ",e.jsxs("span",{style:{fontSize:10,fontWeight:400,color:D.inkMid},children:[" ",K.dias," das  ",K.fecha,K.fechaRegreso?`  ${K.fechaRegreso}`:""]})]}),e.jsx("div",{style:{fontSize:10,color:D.inkMid,marginTop:2},children:K.concepto})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:tt.c+"22",color:tt.c},children:tt.lbl}),e.jsxs("div",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,marginTop:4},children:["Est: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Me),We>0&&e.jsxs("span",{style:{color:"#5B3A8C",marginLeft:8},children:["Real: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(We)]})]})]})]}),$e===K.id&&e.jsxs("div",{style:{marginTop:12,borderTop:`1px solid ${D.border}`,paddingTop:12},onClick:gt=>gt.stopPropagation(),children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:"Desglose estimado"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",marginBottom:12},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${D.border}`},children:"tem"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${D.border}`},children:"Detalle"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:D.blue,textAlign:"right",borderBottom:`1px solid ${D.border}`},children:"Estimado"}),(K.estado==="entregado"||K.estado==="legalizado")&&e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#5B3A8C",textAlign:"right",borderBottom:`1px solid ${D.border}`},children:"Real"})]})}),e.jsxs("tbody",{children:[ft.map((gt,St)=>{const Tt=(K.itemsViaje||{})[gt.id]||{estimado:0,real:0,detalle:""},Mi=K.estado==="solicitado"||K.estado==="aprobado",pi=K.estado==="entregado"||K.estado==="legalizado";return e.jsxs("tr",{style:{borderBottom:`1px solid ${D.border}`,background:St%2?"#FFFFFF":"#fff"},children:[e.jsxs("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:600},children:[gt.icon," ",gt.lbl]}),e.jsx("td",{style:{padding:"3px 4px"},children:Mi?e.jsx("input",{type:"text",value:Tt.detalle||"",placeholder:"Detalle...",onChange:Tn=>di(K.id,gt.id,"detalle",Tn.target.value),style:{width:"100%",border:`1px solid ${D.border}`,borderRadius:3,padding:"3px 6px",fontSize:9,background:"#fff",fontFamily:"'DM Sans',sans-serif"}}):e.jsx("span",{style:{fontSize:9,color:D.inkMid},children:Tt.detalle||""})}),e.jsx("td",{style:{padding:"3px 4px"},children:Mi?e.jsx("input",{type:"number",value:Tt.estimado||"",placeholder:"0",onChange:Tn=>di(K.id,gt.id,"estimado",Tn.target.value),style:{width:"100%",textAlign:"right",border:`1px solid ${D.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:D.blue,background:"#fff"}}):e.jsxs("div",{style:{textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:D.blue,padding:"3px 6px"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(parseFloat(Tt.estimado)||0)]})}),(K.estado==="entregado"||K.estado==="legalizado")&&e.jsx("td",{style:{padding:"3px 4px"},children:pi?e.jsx("input",{type:"number",value:Tt.real||"",placeholder:"0",onChange:Tn=>di(K.id,gt.id,"real",Tn.target.value),style:{width:"100%",textAlign:"right",border:`1px solid ${D.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",background:"#fff"}}):e.jsxs("div",{style:{textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",padding:"3px 6px"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(parseFloat(Tt.real)||0)]})})]},gt.id)}),e.jsxs("tr",{style:{borderTop:`2px solid ${D.ink}`,background:"#EDEBE7"},children:[e.jsx("td",{colSpan:2,style:{padding:"4px 8px",fontSize:10,fontWeight:800},children:"TOTAL"}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:D.blue},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Me)]}),(K.estado==="entregado"||K.estado==="legalizado")&&e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:"#5B3A8C"},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(Sr(K))]})]})]})]}),K.estado==="solicitado"&&e.jsx("div",{style:{background:D.amberBg,border:`1px solid ${D.amber}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:D.amber,fontWeight:600},children:" Pendiente de aprobacin por Administracin. Completa el desglose estimado arriba."}),K.estado==="aprobado"&&e.jsx("div",{style:{background:D.blueBg,border:`1px solid ${D.blue}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:D.blue,fontWeight:600},children:" Aprobado. Administracin gestionar la compra de tiquetes y hotel."}),K.estado==="entregado"&&e.jsxs("div",{style:{background:"#F0ECF6",border:"1px solid #5B3A8C33",borderRadius:4,padding:"8px 12px",fontSize:10,color:"#5B3A8C",fontWeight:600},children:[" Anticipo entregado: $",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(K.anticipoEntregado||0),'. Registra los gastos reales en la columna "Real" y aade gastos extra abajo.',e.jsx("button",{onClick:()=>ci({fecha:xi(),concepto:"",monto:0,soporte:""}),style:{display:"block",marginTop:6,padding:"4px 12px",background:"#5B3A8C",color:"#fff",border:"none",borderRadius:3,fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir gasto extra"})]}),K.estado==="legalizado"&&e.jsx("div",{style:{background:D.greenBg,border:`1px solid ${D.green}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:D.green,fontWeight:600},children:" Legalizado y cerrado."}),K.estado==="rechazado"&&e.jsx("div",{style:{background:D.redBg,border:`1px solid ${D.red}33`,borderRadius:4,padding:"8px 12px",fontSize:10,color:D.red,fontWeight:600},children:" Rechazado por Administracin."}),(K.gastos||[]).length>0&&e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Gastos extra"}),K.gastos.map(gt=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 8px",borderBottom:`1px solid ${D.border}`,fontSize:10},children:[e.jsxs("span",{children:[gt.fecha,"  ",gt.concepto]}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:D.red},children:["$",new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(gt.monto)]})]},gt.id))]})]})]},K.id)})}),be&&e.jsx("div",{style:he.overlay,onClick:()=>Te(!1),children:e.jsxs("div",{style:he.modal,onClick:K=>K.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:4,fontSize:14,fontWeight:700},children:" Solicitar viaje"}),e.jsx("p",{style:{fontSize:10,color:D.inkLight,marginBottom:14},children:"Despus de crear podrs completar el desglose (vuelos, hotel, etc.)"}),e.jsx(jt,{label:"Destino",children:e.jsx(vt,{value:bt.destino,onChange:K=>Ct({...bt,destino:K}),placeholder:"Ciudad / lugar"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 80px",gap:10},children:[e.jsx(jt,{label:"Concepto / motivo",children:e.jsx(vt,{value:bt.concepto,onChange:K=>Ct({...bt,concepto:K}),placeholder:"Visita obra, capacitacin..."})}),e.jsx(jt,{label:"Das",children:e.jsx(vt,{type:"number",value:bt.dias,onChange:K=>Ct({...bt,dias:K})})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(jt,{label:"Fecha ida",children:e.jsx(vt,{type:"date",value:bt.fecha,onChange:K=>Ct({...bt,fecha:K})})}),e.jsx(jt,{label:"Fecha regreso",children:e.jsx(vt,{type:"date",value:bt.fechaRegreso,onChange:K=>Ct({...bt,fechaRegreso:K})})})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${D.border}`},children:[e.jsx(it,{variant:"outline",onClick:()=>Te(!1),children:"Cancelar"}),e.jsxs(it,{variant:"primary",onClick:wi,disabled:!bt.destino,children:[e.jsx(ba,{size:12}),"Enviar solicitud"]})]})]})}),Gt&&e.jsx("div",{style:he.overlay,onClick:()=>ci(null),children:e.jsxs("div",{style:he.modal,onClick:K=>K.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:12,fontSize:14,fontWeight:700},children:"Gasto extra"}),e.jsx(jt,{label:"Fecha",children:e.jsx(vt,{type:"date",value:Gt.fecha,onChange:K=>ci({...Gt,fecha:K})})}),e.jsx(jt,{label:"Concepto",children:e.jsx(vt,{value:Gt.concepto,onChange:K=>ci({...Gt,concepto:K}),placeholder:"Taxi, imprevisto..."})}),e.jsx(jt,{label:"Monto",children:e.jsx(vt,{type:"number",value:Gt.monto,onChange:K=>ci({...Gt,monto:K})})}),e.jsx(jt,{label:"Soporte",children:e.jsx(vt,{value:Gt.soporte,onChange:K=>ci({...Gt,soporte:K}),placeholder:"Ref. factura"})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${D.border}`},children:[e.jsx(it,{variant:"outline",onClick:()=>ci(null),children:"Cancelar"}),e.jsxs(it,{variant:"primary",onClick:()=>{jr($e,{...Gt,monto:parseFloat(Gt.monto)||0}),ci(null)},children:[e.jsx(ko,{size:12}),"Guardar"]})]})]})})]}),eo=()=>A?e.jsx("div",{style:he.overlay,onClick:()=>E(null),children:e.jsxs("div",{style:he.modal,onClick:K=>K.stopPropagation(),children:[e.jsxs("h3",{style:{marginBottom:16,fontSize:14,fontWeight:700},children:["Imputar horas  ",A.fecha]}),e.jsx(jt,{label:"Fecha",children:e.jsx(vt,{type:"date",value:A.fecha,onChange:K=>re(E,"fecha",K)})}),e.jsx(jt,{label:"Orden de trabajo (OT)",children:e.jsx(vi,{value:A.otCodigo,onChange:K=>re(E,"otCodigo",K),options:[{value:"",label:"Seleccionar OT..."},...Y.map(K=>({value:K,label:K}))]})}),e.jsx(jt,{label:"Actividad",children:e.jsx(vt,{value:A.actividad,onChange:K=>re(E,"actividad",K),placeholder:"Ej. Diseo conceptual"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(jt,{label:"Horas normales",children:e.jsx(vt,{type:"number",value:A.horasNormales,onChange:K=>re(E,"horasNormales",Number(K))})}),e.jsx(jt,{label:"Horas extra",children:e.jsx(vt,{type:"number",value:A.horasExtra||0,onChange:K=>re(E,"horasExtra",Number(K))})})]}),e.jsx(jt,{label:"Descripcin (opcional)",children:e.jsx(vt,{value:A.descripcion||"",onChange:K=>re(E,"descripcion",K),placeholder:"Notas sobre el trabajo realizado"})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${D.border}`},children:[e.jsx(it,{variant:"outline",onClick:()=>E(null),children:"Cancelar"}),e.jsxs(it,{variant:"primary",onClick:se,children:[e.jsx(ko,{size:12}),"Guardar borrador"]})]})]})}):null,kr=()=>w?e.jsx("div",{style:he.overlay,onClick:()=>I(null),children:e.jsxs("div",{style:he.modal,onClick:K=>K.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:16,fontSize:14,fontWeight:700},children:"Nueva solicitud"}),e.jsx(jt,{label:"Tipo de solicitud",children:e.jsx(vi,{value:w.tipo,onChange:K=>re(I,"tipo",K),options:[{value:"",label:"Seleccionar..."},...bn.map(K=>({value:K.id,label:`${K.icono} ${K.lbl}`}))]})}),w.tipo&&(()=>{const K=L(w.tipo);return e.jsxs(e.Fragment,{children:[K.requiereFechas&&e.jsxs(e.Fragment,{children:[e.jsx(jt,{label:"Fecha inicio",children:e.jsx(vt,{type:"date",value:w.fechaInicio,onChange:Me=>re(I,"fechaInicio",Me)})}),e.jsx(jt,{label:"Fecha fin",children:e.jsx(vt,{type:"date",value:w.fechaFin,onChange:Me=>re(I,"fechaFin",Me)})})]}),K.requiereHoras&&e.jsx(jt,{label:"Horas",children:e.jsx(vt,{type:"number",value:w.horas||0,onChange:Me=>re(I,"horas",Number(Me))})}),e.jsx(jt,{label:"Motivo / Descripcin",children:e.jsx(vi,{value:w.motivo,onChange:Me=>re(I,"motivo",Me),options:[{value:"",label:"Seleccionar motivo..."},...(w.tipo==="licEspecial"?cf:df).map(Me=>({value:Me,label:Me}))]})}),e.jsx(jt,{label:"Descripcin adicional (opcional)",children:e.jsx(vt,{value:w.descripcion||"",onChange:Me=>re(I,"descripcion",Me),placeholder:"Aade detalle si lo deseas..."})}),K.requiereDoc&&e.jsxs(jt,{label:"Documento adjunto (opcional)",children:[e.jsx("input",{type:"file",accept:"application/pdf,image/*",onChange:Me=>{const We=Me.target.files[0];if(!We)return;const tt=new FileReader;tt.onload=gt=>I(St=>({...St,docNombre:We.name,docBase64:gt.target.result})),tt.readAsDataURL(We)},style:{fontSize:11}}),w.docNombre&&e.jsxs("div",{style:{fontSize:10,color:D.green,marginTop:3},children:[" ",w.docNombre]})]})]})})(),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:16,paddingTop:12,borderTop:`1px solid ${D.border}`},children:[e.jsx(it,{variant:"outline",onClick:()=>I(null),children:"Cancelar"}),e.jsxs(it,{variant:"primary",onClick:G,disabled:!w.tipo,children:[e.jsx(ba,{size:12}),"Enviar solicitud"]})]})]})}):null;return e.jsxs("div",{style:he.page,children:[e.jsxs("div",{style:{background:D.surface,borderBottom:`1px solid ${D.border}`,padding:"0 20px",display:"flex",overflowX:"auto"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"10px 12px 10px 0",borderRight:`1px solid ${D.border}`,marginRight:8,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:24,height:24,background:D.ink,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:10,fontWeight:800,color:"#fff",letterSpacing:.5},children:"H"})}),e.jsx("span",{style:{fontSize:11,fontWeight:700,color:D.ink},children:C})]}),we.map(K=>{const Me=p===K.id;return e.jsxs("button",{onClick:()=>c(K.id),style:he.navBtn(Me),children:[K.lbl,K.badge>0&&e.jsx("span",{style:{background:D.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:K.badge})]},K.id)}),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>f(!1),style:{...he.navBtn(!1),color:D.red},children:[e.jsx(_c,{size:11}),"Salir"]})]}),e.jsxs("div",{style:{padding:"20px 20px",maxWidth:900,margin:"0 auto",paddingBottom:40},children:[p==="calendario"&&e.jsx(V,{}),p==="partes"&&e.jsx(te,{}),p==="solicitudes"&&e.jsx(ce,{}),p==="viajes"&&e.jsx(Qa,{}),p==="ficha"&&e.jsx(pe,{}),p==="documentos"&&e.jsx(_,{})]}),e.jsx(eo,{}),e.jsx(kr,{})]})}function ts({onCancel:t,onSave:i,saveLabel:o="Guardar"}){return e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:20,paddingTop:16,borderTop:`1px solid ${D.border}`},children:[e.jsx(it,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsxs(it,{variant:"primary",onClick:i,children:[e.jsx(ko,{size:12}),o]})]})}const Ns=[{id:"dashboard",lbl:"Dashboard",I:Yi,desc:"KPIs y mtricas de RRHH"},{id:"cargos",lbl:"Cargos y Salarios",I:Ri,desc:"Plantilla y cargas sociales"},{id:"jornada",lbl:"Jornada Laboral",I:ys,desc:"Horas, festivos y productividad"},{id:"activos",lbl:"Activos y Estructura",I:wn,desc:"NIIF, licencias y gastos"},{id:"equipos",lbl:"Equipos de Trabajo",I:Ri,desc:"Configura equipos para APUs"},{id:"asistencia",lbl:"Asistencia Obra",I:xd,desc:"Control GPS+Foto de entrada/salida"},{id:"partes",lbl:"Partes de Trabajo",I:Cn,desc:"Vista admin  empleados imputan desde Portal"},{id:"novedades",lbl:"Novedades Nmina",I:Bt,desc:"Vacaciones, bajas, permisos y horas extra"},{id:"docs",lbl:"Documentos",I:zo,desc:"Nminas, contratos y certificados"},{id:"portal",lbl:"Portal Empleado",I:fn,desc:"Vista del trabajador"}];function Cf({pais:t="CO"}){var q,U;const[i,o]=F.useState("dashboard"),n={pais:t},[s,r]=bi(mi.cargos,[]),[a,u]=bi(mi.jornada,nf),[h,b]=bi(mi.activos,[]),[j,C]=bi(mi.licencias,[]),[v,m]=bi(mi.gastos,[]),[f,p]=bi(mi.equipos,[]),[c,d]=bi(mi.partes,[]),[l,x]=bi(mi.asistencia,[]),[y,g]=bi(mi.empleados,[]),[S,A]=bi(mi.novedades,[]),[E,w]=bi(mi.fichas,[]),[I,z]=bi(mi.docs,[]),B=c.filter($=>$.estado==="Enviado").length,P=S.filter($=>$.estado==="Pendiente").length;return e.jsxs(e.Fragment,{children:[e.jsx(ef,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:D.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:D.surface,borderBottom:`1px solid ${D.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:D.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:D.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:D.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:D.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase",color:D.ink},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:D.inkLight,marginLeft:10},children:"/ Recursos Humanos"})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[B>0&&e.jsxs("div",{style:{background:D.amberBg,border:`1px solid ${D.amber}33`,borderRadius:3,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>o("partes"),children:[e.jsx(li,{size:11,color:D.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:D.amber},children:[B," parte",B>1?"s":""," pendiente",B>1?"s":""]})]}),P>0&&e.jsxs("div",{style:{background:"#FAF0E0",border:"1px solid #8C6A0033",borderRadius:3,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>o("novedades"),children:[e.jsx(bs,{size:11,color:"#8C6A00"}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:"#8C6A00"},children:[P," nov. pendiente",P>1?"s":""]})]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:D.surface,borderRight:`1px solid ${D.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[Ns.map($=>{const Y=i===$.id;return e.jsxs("button",{onClick:()=>o($.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:Y?`3px solid ${D.ink}`:"3px solid transparent",background:Y?D.accent:"transparent",color:Y?D.ink:D.inkLight,fontSize:12,fontWeight:Y?700:400,cursor:"pointer",textAlign:"left",width:"100%",position:"relative",transition:"all .1s"},children:[e.jsx($.I,{size:13,style:{flexShrink:0}}),e.jsx("span",{style:{lineHeight:1.2},children:$.lbl}),$.id==="partes"&&B>0&&e.jsx("span",{style:{marginLeft:"auto",background:D.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:B}),$.id==="novedades"&&P>0&&e.jsx("span",{style:{marginLeft:"auto",background:"#8C6A00",color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:P})]},$.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:D.inkXLight,letterSpacing:.8,borderTop:`1px solid ${D.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:i==="portal"?e.jsx(Sf,{partes:c,savePartes:d,novedades:S,saveNovedades:A,fichas:E,saveFichas:w,docs:I,saveDocs:z,cargos:s,empleados:y,saveEmpleados:g}):e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:D.ink,letterSpacing:-.2},children:(q=Ns.find($=>$.id===i))==null?void 0:q.lbl}),e.jsx("p",{style:{fontSize:11,color:D.inkLight,marginTop:2},children:(U=Ns.find($=>$.id===i))==null?void 0:U.desc})]}),i==="dashboard"&&e.jsxs("div",{className:"fade-up",style:{padding:"20px 0"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Cargos",s.length,"#111"],[" Empleados",y.length,"#3B3B3B"],[" Partes",c.length,"#111"],[" Novedades pend.",S.filter($=>$.estado==="Pendiente").length,S.filter($=>$.estado==="Pendiente").length>0?"#8C6A00":"#111111"]].map(([$,Y,ge])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:$}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:ge},children:Y})]},$))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Horas aprobadas",c.filter($=>$.estado==="Aprobado").reduce(($,Y)=>$+Number(Y.horasNormales||0)+Number(Y.horasExtra||0),0)+"h","#111111"],[" Vacaciones aprobadas",S.filter($=>$.tipo==="vacaciones"&&$.estado==="Aprobada").reduce(($,Y)=>$+Number(Y.dias||0),0)+"d","#3B3B3B"],[" Bajas activas",S.filter($=>$.tipo==="baja"&&$.estado==="Aprobada").length,"#B91C1C"],[" Viticos pend.",[].filter($=>$.estado==="solicitado").length,"#8C6A00"]].map(([$,Y,ge])=>e.jsxs("div",{style:{background:"#fff",border:"1px solid #E0E0E0",borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:$}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:ge},children:Y})]},$))})]}),i==="cargos"&&e.jsx(gf,{cargos:s,saveCargos:r,jornada:a}),i==="jornada"&&e.jsx(hf,{jornada:a,saveJornada:u}),i==="activos"&&e.jsx(ff,{activos:h,saveActivos:b,licencias:j,saveLicencias:C,gastos:v,saveGastos:m}),i==="equipos"&&e.jsx(xf,{equipo:f,setEquipo:p,cargos:s,pais:(n==null?void 0:n.pais)||"CO"}),i==="asistencia"&&e.jsx(bf,{equipo:f,asistencia:l,setAsistencia:x,pais:(n==null?void 0:n.pais)||"CO"}),i==="partes"&&e.jsx(mf,{partes:c,setPartes:d,equipo:f,cargos:s,currentUser:null,pais:(n==null?void 0:n.pais)||"CO"}),i==="novedades"&&e.jsx(yf,{novedades:S,saveNovedades:A}),i==="docs"&&e.jsx(jf,{docs:I,saveDocs:z,fichas:E,cargos:s})]})})]})]})]})}const Z={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C0BDB8",border:"#E0E0E0",accent:"#EDEBE7",shadow:"0 1px 3px rgba(0,0,0,.06)",shadowMd:"0 4px 20px rgba(0,0,0,.09)",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",orange:"#7C3A1E",orangeBg:"#FDF0E8"},kf=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800;900&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'DM Sans',sans-serif;background:${Z.bg};}
    .mono{font-family:'DM Mono',monospace;}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    .fade-up{animation:fadeUp .18s ease both}
    input,button,select{font-family:'DM Sans',sans-serif;}
    input:focus,select:focus{outline:none;border-color:${Z.ink}!important;}
    ::-webkit-scrollbar{width:4px;height:4px;}
    ::-webkit-scrollbar-thumb{background:${Z.border};border-radius:2px;}
    table{border-collapse:collapse;}
  `});function gn(t,i){const[o,n]=F.useState(i);return useEffect(()=>{Fe.get(t).then(r=>{if(r)try{n(JSON.parse(r))}catch{}}).catch(()=>{})},[t]),[o,r=>{const a=typeof r=="function"?r(o):r;n(a);try{Fe.set(t,JSON.stringify(a))}catch{}}]}const qo={CO:{label:"Colombia",flag:"",ref:"NTC 2050 / RETIE",mono_V:120,tri_VLN:120,tri_VLL:208,FS:1.25,curvas:["C","D"],dV_max_rama:3,dV_max_total:5,breakers:[6,10,15,20,25,30,40,50,60,70,80,90,100,110,125,150,175,200]},ES:{label:"Espaa",flag:"",ref:"REBT ITC-BT-19",mono_V:230,tri_VLN:230,tri_VLL:400,FS:1.25,curvas:["B","C","D"],dV_max_rama:3,dV_max_total:5,breakers:[6,10,13,16,20,25,32,40,50,63,80,100,125,160,200,250]}},Ya=[1.5,2.5,4,6,10,16,25,35,50,70,95,120],oc={Cobre:.01786,Aluminio:.02857},nc={1.5:15,2.5:21,4:27,6:34,10:46,16:61,25:80,35:99,50:119,70:151,95:182,120:210},rc={1.5:null,2.5:null,4:20,6:26,10:35,16:46,25:60,35:75,50:90,70:115,95:138,120:160};function $a(t,i){const o=qo[i].breakers;return o.find(n=>n>=t)||o[o.length-1]}function sc(t,i){const o=i==="Cobre"?nc:rc;for(const n of Ya)if(o[n]&&o[n]>=t)return n;return 120}function ac(t,i,o,n,s,r){const a=oc[n],u=qo[r],h=s==="Monofsica"?u.mono_V:u.tri_VLL;return(s==="Monofsica"?2:Math.sqrt(3))*t*i*a/o/h*100}function lc(t,i,o,n,s,r){const a=oc[o],u=qo[s],h=n==="Monofsica"?u.mono_V:u.tri_VLL,b=n==="Monofsica"?2:Math.sqrt(3),j=h/(r*1e3),C=b*t*a/i;return h/(j+C)/1e3}const Xt=t=>isNaN(t)||t==null?"":Number(t).toLocaleString("es-CO",{maximumFractionDigits:2}),Us=t=>isNaN(t)||t==null?"":"$ "+Number(t).toLocaleString("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0}),$t=({label:t,value:i,onChange:o,unit:n,type:s="number",placeholder:r="",step:a,min:u})=>e.jsxs("div",{style:{marginBottom:10},children:[t&&e.jsxs("div",{style:{fontSize:9,color:Z.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:[t,n&&e.jsxs("span",{style:{color:Z.inkXLight,marginLeft:4},children:["(",n,")"]})]}),e.jsx("input",{type:s,value:i,onChange:h=>o(h.target.value),placeholder:r,step:a,min:u,style:{width:"100%",padding:"8px 10px",border:`1.5px solid ${Z.border}`,borderRadius:4,fontSize:12,background:Z.surface,color:Z.ink}})]}),qi=({label:t,value:i,onChange:o,options:n,small:s=!1})=>e.jsxs("div",{style:{marginBottom:s?0:10},children:[t&&e.jsx("div",{style:{fontSize:9,color:Z.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:t}),e.jsx("select",{value:i,onChange:r=>o(r.target.value),style:{width:"100%",padding:s?"6px 8px":"8px 10px",border:`1.5px solid ${Z.border}`,borderRadius:4,fontSize:12,background:Z.surface,color:Z.ink},children:n.map(r=>e.jsx("option",{value:r.v||r,children:r.l||r},r.v||r))})]}),wf=({ok:t,warn:i,text:o})=>e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:3,background:i?Z.amberBg:t?Z.greenBg:Z.redBg,border:`1px solid ${i?Z.amber:t?Z.green:Z.red}33`},children:[i?e.jsx(li,{size:9,color:Z.amber}):t?e.jsx(Vo,{size:9,color:Z.green}):e.jsx(li,{size:9,color:Z.red}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:i?Z.amber:t?Z.green:Z.red},children:o})]}),zs=({pais:t})=>e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:5,padding:"3px 10px",borderRadius:12,background:Z.accent,border:`1px solid ${Z.border}`,fontSize:10,color:Z.inkMid},children:[e.jsx("span",{children:qo[t].flag}),e.jsx("span",{style:{fontWeight:700},children:t==="CO"?"NTC 2050  RETIE":"REBT  ITC-BT"})]}),Dr=[{id:"dashboard",label:"Dashboard",I:Yi,desc:"Vista general de herramientas"},{id:"cuadro",label:"Cuadro de Cargas",I:el,desc:"Tabla completa circuito a circuito"},{id:"circuito",label:"Circuito Rpido",I:el,desc:"Clculo unitario de un circuito"},{id:"iluminacion",label:"Iluminacin",I:md,desc:"Diseo luminotcnico  RETILAP / CTE DB-HE3"},{id:"concreto",label:"Concreto",I:Dc,desc:"Volmenes y mezclas ACI 211"},{id:"cubicacion",label:"Cubicacin",I:bd,desc:"reas, volmenes y permetros"},{id:"materiales",label:"Materiales",I:wn,desc:"Presupuesto rpido de obra"},{id:"unidades",label:"Unidades",I:$c,desc:"Conversin entre sistemas"}],Ol=()=>({id:Date.now()+Math.random(),desc:"",tipo:"General",cant:1,wUnit:"",fp:.9,simult:1,material:"Cobre",longitud:"",seccionManual:"",curva:"C",fase:"L1"});function zf({pais:t}){const i=qo[t],[o,n]=gn("hab:herr:cuadro:red","Monofsica"),[s,r]=gn("hab:herr:cuadro:iccb","6"),[a,u]=gn("hab:herr:cuadro:filas",[Ol()]),[h,b]=gn("hab:herr:cuadro:nombre","Tablero General"),j=o==="Monofsica"?i.mono_V:i.tri_VLL,C=o==="Monofsica"?i.mono_V:i.tri_VLN,v=(E,w,I)=>u(z=>z.map(B=>B.id===E?{...B,[w]:I}:B)),m=()=>u(E=>[...E,Ol()]),f=E=>u(w=>w.filter(I=>I.id!==E)),p=F.useMemo(()=>a.map(E=>{const w=Number(E.cant)||0,I=Number(E.wUnit)||0,z=Number(E.fp)||1,B=Number(E.simult)||1,P=Number(E.longitud)||0,q=w*I*B,U=z>0?q/z:q,$=j>0&&U>0?U/C:0,Y=$*i.FS,ge=Y>0?$a(Y,t):null,J=Y>0?sc(Y,E.material):null,ye=Number(E.seccionManual)||J||0,oe=P>0&&$>0&&ye>0?ac(P,$,ye,E.material,o,t):null,L=P>0&&ye>0&&Number(s)>0?lc(P,ye,E.material,o,t,Number(s)):null,R=E.material==="Cobre"?nc[ye]:rc[ye],T=oe!==null?oe<=i.dV_max_rama:null,W=L!==null?L>.001:null;return{totalW:q,totalVA:U,I:$,Id:Y,breaker:ge,seccion:ye,secAuto:J,dV:oe,iccFin:L,dVok:T,iccOk:W,iMaxCond:R}}),[a,o,t,s,j,C,i]),c=p.reduce((E,w)=>E+w.totalW,0),d=p.reduce((E,w)=>E+w.totalVA,0),l=j>0?d/C:0,x=$a(l*i.FS,t),y=["General","Iluminacin","Tomacorriente","Motor","Aire Acondicionado","Calefaccin","Bomba","UPS","Carga EV","Otro"],g=o==="Monofsica"?["L1"]:["L1","L2","L3"],S={padding:"7px 8px",fontSize:8,letterSpacing:.8,textTransform:"uppercase",color:Z.inkLight,fontWeight:700,textAlign:"left",background:Z.bg,borderBottom:`2px solid ${Z.border}`,whiteSpace:"nowrap"},A={padding:"5px 6px",fontSize:11,borderBottom:`1px solid ${Z.border}`,verticalAlign:"middle"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:10,marginBottom:12,background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"14px 16px"},children:[e.jsx($t,{label:"Nombre del tablero",value:h,onChange:b,type:"text"}),e.jsx(qi,{label:"Tipo de red",value:o,onChange:n,options:[{v:"Monofsica",l:"Monofsica"},{v:"Trifsica",l:"Trifsica"}]}),e.jsx($t,{label:"Icc barra (kA)",value:s,onChange:r,step:"0.5",min:"1"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:Z.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Normativa"}),e.jsx("div",{style:{padding:"8px 0"},children:e.jsx(zs,{pais:t})})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:Z.inkMid},children:[e.jsxs("span",{style:{fontWeight:700,color:Z.ink},className:"mono",children:[Xt(c)," W"]})," totales ",e.jsxs("span",{style:{fontWeight:700,color:Z.blue,marginLeft:6},className:"mono",children:[Xt(d)," VA"]})," ",e.jsxs("span",{style:{fontWeight:700,color:Z.red,marginLeft:6},className:"mono",children:["I=",Xt(l)," A"]})," ",e.jsxs("span",{style:{fontWeight:700,color:Z.amber,marginLeft:6},children:["Breaker principal: ",x," A"]})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:6},children:e.jsxs("button",{onClick:m,style:{display:"flex",alignItems:"center",gap:5,padding:"7px 12px",background:Z.ink,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:11,fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:[e.jsx(Ne,{size:12}),"Circuito"]})})]}),e.jsx("div",{style:{overflowX:"auto",background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8},children:e.jsxs("table",{style:{width:"100%",minWidth:1200},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:S,children:"#"}),e.jsx("th",{style:{...S,minWidth:130},children:"Descripcin"}),e.jsx("th",{style:S,children:"Tipo"}),e.jsx("th",{style:{...S,width:50},children:"Cant"}),e.jsx("th",{style:{...S,width:70},children:"W unit"}),e.jsx("th",{style:{...S,width:50},children:"FP"}),e.jsx("th",{style:{...S,width:60},children:"Simult."}),e.jsx("th",{style:S,children:"Total W"}),e.jsx("th",{style:S,children:"Total VA"}),e.jsx("th",{style:S,children:"I (A)"}),e.jsx("th",{style:S,children:"IFS (A)"}),e.jsx("th",{style:S,children:"Breaker"}),e.jsx("th",{style:S,children:"Curva"}),e.jsx("th",{style:S,children:"Material"}),e.jsx("th",{style:{...S,width:60},children:"Long (m)"}),e.jsx("th",{style:S,children:"Secc mm"}),e.jsx("th",{style:S,children:"V %"}),e.jsx("th",{style:S,children:"Icc fin"}),o==="Trifsica"&&e.jsx("th",{style:S,children:"Fase"}),e.jsx("th",{style:S})]})}),e.jsx("tbody",{children:a.map((E,w)=>{const I=p[w];return e.jsxs("tr",{style:{background:w%2===0?Z.surface:Z.bg+"80"},children:[e.jsx("td",{style:{...A,color:Z.inkLight,fontWeight:700},children:w+1}),e.jsx("td",{style:A,children:e.jsx("input",{value:E.desc,onChange:z=>v(E.id,"desc",z.target.value),placeholder:"Ej: Iluminacin sala",style:{width:"100%",padding:"4px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("select",{value:E.tipo,onChange:z=>v(E.id,"tipo",z.target.value),style:{width:"100%",padding:"4px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:10,background:"transparent"},children:y.map(z=>e.jsx("option",{children:z},z))})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.cant,onChange:z=>v(E.id,"cant",z.target.value),min:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.wUnit,onChange:z=>v(E.id,"wUnit",z.target.value),placeholder:"0",style:{width:"100%",padding:"4px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.fp,onChange:z=>v(E.id,"fp",z.target.value),step:"0.01",min:"0.1",max:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.simult,onChange:z=>v(E.id,"simult",z.target.value),step:"0.1",min:"0.1",max:"1",style:{width:"100%",padding:"4px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsx("td",{style:{...A,fontWeight:I.totalW>0?600:400},className:"mono",children:I.totalW>0?Xt(I.totalW):""}),e.jsx("td",{style:{...A},className:"mono",children:I.totalVA>0?Xt(I.totalVA):""}),e.jsx("td",{style:{...A,color:Z.blue,fontWeight:600},className:"mono",children:I.I>0?Xt(I.I):""}),e.jsx("td",{style:{...A},className:"mono",children:I.Id>0?Xt(I.Id):""}),e.jsx("td",{style:{...A},children:I.breaker?e.jsxs("span",{style:{background:Z.ink,color:"#fff",borderRadius:3,padding:"2px 7px",fontSize:10,fontWeight:700,fontFamily:"'DM Mono',monospace"},children:[I.breaker,"A"]}):""}),e.jsx("td",{style:A,children:e.jsx("select",{value:E.curva,onChange:z=>v(E.id,"curva",z.target.value),style:{padding:"3px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent"},children:i.curvas.map(z=>e.jsx("option",{children:z},z))})}),e.jsx("td",{style:A,children:e.jsxs("select",{value:E.material,onChange:z=>v(E.id,"material",z.target.value),style:{padding:"3px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent",minWidth:70},children:[e.jsx("option",{children:"Cobre"}),e.jsx("option",{children:"Aluminio"})]})}),e.jsx("td",{style:A,children:e.jsx("input",{type:"number",value:E.longitud,onChange:z=>v(E.id,"longitud",z.target.value),placeholder:"0",style:{width:"100%",padding:"4px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent"}})}),e.jsxs("td",{style:A,children:[e.jsxs("select",{value:E.seccionManual||I.secAuto||"",onChange:z=>v(E.id,"seccionManual",z.target.value),style:{padding:"3px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:E.seccionManual?"transparent":Z.greenBg,minWidth:55},children:[e.jsx("option",{value:"",children:"Auto"}),Ya.map(z=>e.jsx("option",{value:z,children:z},z))]}),I.seccion>0&&e.jsxs("div",{style:{fontSize:8,color:Z.green,marginTop:1},className:"mono",children:[I.seccion,"mm"]})]}),e.jsx("td",{style:A,children:I.dV!==null?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:I.dVok?Z.green:Z.red},children:[Xt(I.dV),"%"]}),e.jsx("div",{style:{marginTop:2},children:e.jsx(wf,{ok:I.dVok,text:I.dVok?`${i.dV_max_rama}% `:`>${i.dV_max_rama}% `})})]}):e.jsx("span",{style:{color:Z.inkXLight},children:""})}),e.jsx("td",{style:A,children:I.iccFin!==null?e.jsxs("span",{className:"mono",style:{fontSize:11,color:Z.inkMid},children:[I.iccFin.toFixed(2)," kA"]}):e.jsx("span",{style:{color:Z.inkXLight},children:""})}),o==="Trifsica"&&e.jsx("td",{style:A,children:e.jsx("select",{value:E.fase,onChange:z=>v(E.id,"fase",z.target.value),style:{padding:"3px 6px",border:`1px solid ${Z.border}`,borderRadius:3,fontSize:11,background:"transparent"},children:g.map(z=>e.jsx("option",{children:z},z))})}),e.jsx("td",{style:A,children:e.jsx("button",{onClick:()=>f(E.id),style:{background:"none",border:"none",cursor:"pointer",color:Z.red,fontSize:16,lineHeight:1,padding:2},children:""})})]},E.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:Z.ink},children:[e.jsxs("td",{colSpan:7,style:{padding:"10px 12px",fontSize:10,fontWeight:700,color:"rgba(255,255,255,.5)",textTransform:"uppercase",letterSpacing:1},children:["TOTALES  ",a.length," circuitos  FS=",i.FS,"  ",j,"V"]}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#fff"},children:[Xt(c)," W"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#adf"},children:[Xt(d)," VA"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:13,fontWeight:800,color:"#faa"},children:[Xt(l)," A"]})}),e.jsx("td",{style:{padding:"10px 8px"},className:"mono",children:e.jsxs("span",{style:{fontSize:11,color:"rgba(255,255,255,.5)"},children:[Xt(l*i.FS)," A"]})}),e.jsx("td",{style:{padding:"10px 8px"},children:e.jsxs("span",{style:{background:"#fff",color:Z.ink,borderRadius:3,padding:"3px 8px",fontSize:12,fontWeight:800,fontFamily:"'DM Mono',monospace"},children:[x,"A"]})}),e.jsx("td",{colSpan:o==="Trifsica"?7:6}),e.jsx("td",{})]})})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10,flexWrap:"wrap"},children:[e.jsxs("div",{style:{fontSize:9,color:Z.inkLight},children:[e.jsx("span",{style:{background:Z.greenBg,padding:"1px 5px",borderRadius:2,fontSize:8},children:"Auto"})," Seccin calculada automticamente por corriente"]}),e.jsxs("div",{style:{fontSize:9,color:Z.inkLight},children:[" V max permitido: ",e.jsxs("strong",{children:[i.dV_max_rama,"%"]})," por circuito (",i.ref,")"]}),e.jsx("div",{style:{fontSize:9,color:Z.inkLight},children:" Resistividad Cu: 0.01786 mm/m  Al: 0.02857 mm/m  T=20C"})]})]})}function Ef({pais:t}){const i=qo[t],[o,n]=F.useState("Monofsica"),[s,r]=F.useState(""),[a,u]=F.useState("0.9"),[h,b]=F.useState("1.0"),[j,C]=F.useState(""),[v,m]=F.useState("Cobre"),[f,p]=F.useState("6"),[c,d]=F.useState(""),l=o==="Monofsica"?i.mono_V:i.tri_VLN;o==="Monofsica"?i.mono_V:i.tri_VLL;const x=Number(s)*Number(h)||0,y=a>0?x/Number(a):x,g=l>0&&y>0?y/l:0,S=g*i.FS,A=S>0?$a(S,t):null,E=S>0?sc(S,v):null,w=Number(c)||E||0,I=Number(j)>0&&g>0&&w>0?ac(Number(j),g,w,v,o,t):null,z=Number(j)>0&&w>0&&Number(f)>0?lc(Number(j),w,v,o,t,Number(f)):null,B=I!==null?I<=i.dV_max_rama:null,P=({label:q,val:U,unit:$,hi:Y,warn:ge})=>e.jsxs("div",{style:{background:Y?Z.ink:ge?Z.amberBg:Z.bg,border:`1px solid ${Y?Z.ink:ge?Z.amber+"44":Z.border}`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:Y?"rgba(255,255,255,.4)":Z.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:4},children:q}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:Y?"#fff":ge?Z.amber:Z.ink},children:U||""}),$&&e.jsx("div",{style:{fontSize:9,color:Y?"rgba(255,255,255,.4)":Z.inkLight,marginTop:2},children:$})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:Z.inkLight,fontWeight:700},children:"Datos del circuito"}),e.jsx(zs,{pais:t})]}),e.jsx(qi,{label:"Tipo de red",value:o,onChange:n,options:[{v:"Monofsica",l:`Monofsica (${i.mono_V}V)`},{v:"Trifsica",l:`Trifsica (${i.tri_VLL||""}V)`}]}),e.jsx($t,{label:"Potencia total instalada",value:s,onChange:r,unit:"W"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx($t,{label:"Factor de potencia",value:a,onChange:u,step:"0.01",min:"0.5",max:"1"}),e.jsx($t,{label:"Factor simultaneidad",value:h,onChange:b,step:"0.1",min:"0.1",max:"1"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx($t,{label:"Longitud circuito",value:j,onChange:C,unit:"m"}),e.jsx($t,{label:"Icc en barra (kA)",value:f,onChange:p,step:"0.5"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(qi,{label:"Material conductor",value:v,onChange:m,options:["Cobre","Aluminio"]}),e.jsx(qi,{label:"Seccin (vaco=auto)",value:c,onChange:d,options:[{v:"",l:"Auto"},...Ya.map(q=>({v:q,l:`${q} mm`}))]})]})]}),e.jsxs("div",{style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:Z.inkLight,fontWeight:700,marginBottom:14},children:"Resultados"}),g>0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(P,{label:`Potencia activa (${Number(h)})`,val:`${Xt(x)} W`}),e.jsx(P,{label:"Potencia aparente",val:`${Xt(y)} VA`})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(P,{label:`Corriente nominal (${l}V)`,val:`${Xt(g)} A`}),e.jsx(P,{label:`Corriente diseo (${i.FS})`,val:`${Xt(S)} A`})]}),e.jsx(P,{label:"Breaker recomendado",val:`${A} A  Curva ${i.curvas[0]}`,hi:!0}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(P,{label:`Seccin ${c?"manual":"auto (${material})"}`,val:`${w} mm`,warn:c&&Number(c)<(E||0)}),I!==null&&e.jsxs("div",{style:{background:B?Z.greenBg:Z.redBg,border:`1px solid ${B?Z.green:Z.red}33`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:B?Z.green:Z.red,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Cada de tensin"}),e.jsxs("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:B?Z.green:Z.red},children:[Xt(I),"%"]}),e.jsx("div",{style:{fontSize:9,color:B?Z.green:Z.red,marginTop:2},children:B?`  ${i.dV_max_rama}% (${i.ref})`:` Supera ${i.dV_max_rama}% mx`})]})]}),z!==null&&e.jsx(P,{label:"Corriente cortocircuito fin de lnea",val:`${z.toFixed(3)} kA`}),e.jsxs("div",{style:{background:Z.accent,borderRadius:4,padding:"8px 10px",fontSize:10,color:Z.inkMid,lineHeight:1.7,marginTop:4},children:[e.jsxs("strong",{children:["Normativa ",i.flag," ",t,":"]})," ",i.ref,"  FS=",i.FS,"  V_max=",i.dV_max_rama,"% por rama / ",i.dV_max_total,"% total"]})]}):e.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:Z.inkXLight,fontSize:12},children:"Completa los datos para ver resultados"})]})]})}function Af(){const[t,i]=F.useState(""),[o,n]=F.useState("21"),[s,r]=F.useState("normal"),a={14:{ce:280,ag:205,ar:810,gr:960},"17.5":{ce:310,ag:200,ar:790,gr:940},21:{ce:350,ag:195,ar:760,gr:920},28:{ce:400,ag:190,ar:720,gr:880},35:{ce:450,ag:185,ar:680,gr:850}},u=a[o]||a[21],h=Number(t)||0,b=({l:j,val:C,u:v,hi:m})=>e.jsxs("div",{style:{background:m?Z.ink:Z.bg,border:`1px solid ${m?Z.ink:Z.border}`,borderRadius:6,padding:"12px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:9,color:m?"rgba(255,255,255,.4)":Z.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:6},children:j}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:m?"#fff":Z.ink},children:C}),v&&e.jsx("div",{style:{fontSize:9,color:m?"rgba(255,255,255,.4)":Z.inkLight,marginTop:2},children:v})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:Z.inkLight,fontWeight:700,marginBottom:14},children:"Datos ACI 211"}),e.jsx($t,{label:"Volumen requerido",value:t,onChange:i,unit:"m"}),e.jsx(qi,{label:"Resistencia f'c",value:o,onChange:n,options:[{v:"14",l:"14 MPa (2000 PSI)  Ciclpeo"},{v:"17.5",l:"17.5 MPa (2500 PSI)  Cimientos"},{v:"21",l:"21 MPa (3000 PSI)  Estructural"},{v:"28",l:"28 MPa (4000 PSI)  Alta resist."},{v:"35",l:"35 MPa (5000 PSI)  Especial"}]}),e.jsx(qi,{label:"Tipo de agregado",value:s,onChange:r,options:[{v:"normal",l:"Normal (grava triturada)"},{v:"liviano",l:"Liviano (+8% agua)"}]}),e.jsxs("div",{style:{background:Z.blueBg,border:`1px solid ${Z.blue}22`,borderRadius:5,padding:"10px 12px",marginTop:8},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Z.blue,marginBottom:4,letterSpacing:1,textTransform:"uppercase"},children:"Dosificacin por m"}),e.jsxs("div",{style:{fontSize:11,color:Z.blue},children:["Ce: ",u.ce," kg  Ag: ",u.ag," L  Ar: ",u.ar," kg  Gr: ",u.gr," kg"]})]})]}),e.jsxs("div",{style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"20px"},children:[e.jsxs("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:Z.inkLight,fontWeight:700,marginBottom:14},children:["Cantidades para ",h||"?"," m"]}),h>0?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(b,{l:"Cemento",val:`${(u.ce*h).toFixed(0)} kg`,hi:!0}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(b,{l:"Sacos 50 kg",val:Math.ceil(u.ce*h/50),u:"sacos"}),e.jsx(b,{l:"Agua",val:`${(u.ag*h*(s==="liviano"?1.08:1)).toFixed(0)} L`})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(b,{l:"Arena",val:`${(u.ar*h).toFixed(0)} kg`}),e.jsx(b,{l:"Grava",val:`${(u.gr*h).toFixed(0)} kg`})]})]}):e.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:Z.inkXLight,fontSize:12},children:"Ingresa el volumen"})]})]})}function Ff(){const[t,i]=F.useState("losa"),[o,n]=F.useState(""),[s,r]=F.useState(""),[a,u]=F.useState(""),[h,b]=F.useState(""),[j,C]=F.useState("0.12"),v=F.useMemo(()=>{const f=Number(o)||0,p=Number(s)||0,c=Number(a)||0,d=Number(h)||0,l=Number(j)||0;return t==="losa"?{area:f*p,volumen:f*p*l,perimetro:2*(f+p)}:t==="columna"?{area:f*p,volumen:f*p*c,perimetro:2*(f+p)}:t==="viga"?{area:f*p,volumen:f*p*c,perimetro:2*(f+p)}:t==="cilindro"?{area:Math.PI*d*d,volumen:Math.PI*d*d*c,perimetro:2*Math.PI*d}:t==="muro"?{area:f*c,volumen:f*c*l,perimetro:2*(f+c)}:{area:0,volumen:0,perimetro:0}},[t,o,s,a,h,j]),m=({l:f,val:p,u:c,hi:d})=>e.jsxs("div",{style:{background:d?Z.ink:Z.bg,border:`1px solid ${d?Z.ink:Z.border}`,borderRadius:6,padding:"12px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:9,color:d?"rgba(255,255,255,.4)":Z.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:600,marginBottom:6},children:f}),e.jsx("div",{className:"mono",style:{fontSize:18,fontWeight:800,color:d?"#fff":Z.ink},children:p||""}),c&&e.jsx("div",{style:{fontSize:9,color:d?"rgba(255,255,255,.4)":Z.inkLight,marginTop:2},children:c})]});return e.jsxs("div",{className:"fade-up",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,maxWidth:800},children:[e.jsxs("div",{style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:Z.inkLight,fontWeight:700,marginBottom:14},children:"Elemento estructural"}),e.jsx(qi,{label:"Tipo",value:t,onChange:i,options:[{v:"losa",l:"Losa / Placa"},{v:"columna",l:"Columna"},{v:"viga",l:"Viga"},{v:"cilindro",l:"Pilote / Cilindro"},{v:"muro",l:"Muro / Pared"}]}),t!=="cilindro"&&e.jsx($t,{label:t==="muro"?"Longitud":"Ancho (a)",value:o,onChange:n,unit:"m"}),t==="losa"&&e.jsx($t,{label:"Largo (b)",value:s,onChange:r,unit:"m"}),(t==="columna"||t==="viga")&&e.jsx($t,{label:"Ancho (b)",value:s,onChange:r,unit:"m"}),t==="cilindro"&&e.jsx($t,{label:"Radio",value:h,onChange:b,unit:"m"}),t!=="losa"&&e.jsx($t,{label:"Altura / Longitud",value:a,onChange:u,unit:"m"}),(t==="losa"||t==="muro")&&e.jsx($t,{label:t==="losa"?"Espesor":"Ancho muro",value:j,onChange:C,unit:"m"})]}),e.jsxs("div",{style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"20px"},children:[e.jsx("div",{style:{fontSize:10,letterSpacing:1,textTransform:"uppercase",color:Z.inkLight,fontWeight:700,marginBottom:14},children:"Resultados"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(m,{l:"rea",val:v.area>0?`${v.area.toFixed(3)}`:"",u:"m",hi:!0}),e.jsx(m,{l:"Volumen",val:v.volumen>0?`${v.volumen.toFixed(4)}`:"",u:"m"}),e.jsx(m,{l:"Permetro",val:v.perimetro>0?`${v.perimetro.toFixed(2)}`:"",u:"m"}),v.volumen>0&&e.jsxs("div",{style:{background:Z.greenBg,border:`1px solid ${Z.green}22`,borderRadius:6,padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:9,color:Z.green,fontWeight:700,letterSpacing:1,textTransform:"uppercase",marginBottom:4},children:"Concreto estimado (f'c=21MPa +10%)"}),e.jsxs("div",{className:"mono",style:{fontSize:13,fontWeight:700,color:Z.green},children:[(v.volumen*1.1*350).toFixed(0)," kg cemento  ",Math.ceil(v.volumen*1.1*350/50)," sacos"]})]})]})]})]})}function Tf(){const[t,i]=gn("hab:herr:materiales",[]),[o,n]=F.useState({nombre:"",unidad:"m",cantidad:"",precioUnit:""}),s=(h,b)=>n(j=>({...j,[h]:b})),r=()=>{!o.nombre||!o.cantidad||!o.precioUnit||(i(h=>[...h,{...o,id:Date.now(),sub:Number(o.cantidad)*Number(o.precioUnit)}]),n({nombre:"",unidad:"m",cantidad:"",precioUnit:""}))},a=h=>i(b=>b.filter(j=>j.id!==h)),u=t.reduce((h,b)=>h+b.sub,0);return e.jsxs("div",{className:"fade-up",style:{maxWidth:900},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr auto",gap:8,marginBottom:12,background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"14px 16px",alignItems:"end"},children:[e.jsx($t,{label:"Material / tem",value:o.nombre,onChange:h=>s("nombre",h),type:"text",placeholder:"Ej. Concreto f'c=21MPa"}),e.jsx(qi,{label:"Unidad",value:o.unidad,onChange:h=>s("unidad",h),options:["m","m","ml","kg","und","gl","m"]}),e.jsx($t,{label:"Cantidad",value:o.cantidad,onChange:h=>s("cantidad",h)}),e.jsx($t,{label:"Precio unitario",value:o.precioUnit,onChange:h=>s("precioUnit",h)}),e.jsx("div",{style:{paddingBottom:0},children:e.jsx("button",{onClick:r,style:{padding:"9px 16px",background:Z.ink,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:12,fontWeight:700,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",height:36},children:"+ Aadir"})})]}),t.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:Z.inkXLight,fontSize:12,background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8},children:"Aade materiales para calcular"}):e.jsx("div",{style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Z.bg,borderBottom:`2px solid ${Z.border}`},children:["Material","Unidad","Cantidad","Precio Unit.","Subtotal",""].map(h=>e.jsx("th",{style:{padding:"9px 12px",textAlign:"left",fontSize:9,letterSpacing:1,textTransform:"uppercase",color:Z.inkLight,fontWeight:700},children:h},h))})}),e.jsx("tbody",{children:t.map(h=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Z.border}`},children:[e.jsx("td",{style:{padding:"10px 12px",fontWeight:500},children:h.nombre}),e.jsx("td",{style:{padding:"10px 12px",color:Z.inkMid},children:h.unidad}),e.jsx("td",{style:{padding:"10px 12px"},className:"mono",children:Number(h.cantidad).toLocaleString()}),e.jsx("td",{style:{padding:"10px 12px"},className:"mono",children:Us(Number(h.precioUnit))}),e.jsx("td",{style:{padding:"10px 12px",fontWeight:700},className:"mono",children:Us(h.sub)}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("button",{onClick:()=>a(h.id),style:{background:"none",border:"none",cursor:"pointer",color:Z.red,fontSize:16},children:""})})]},h.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{background:Z.ink},children:[e.jsx("td",{colSpan:4,style:{padding:"12px",fontSize:11,fontWeight:700,color:"rgba(255,255,255,.5)",textTransform:"uppercase",letterSpacing:1},children:"Total presupuesto de materiales"}),e.jsx("td",{style:{padding:"12px"},className:"mono",children:e.jsx("span",{style:{fontSize:16,fontWeight:800,color:"#fff"},children:Us(u)})}),e.jsx("td",{})]})})]})})]})}const Vs=[{id:"oficina_gral",lbl:"Oficina general",luxCO:500,luxES:500,veei:3,ugr:19,ra:80,cat:"Oficinas"},{id:"oficina_tec",lbl:"Oficina tcnica / Dibujo",luxCO:750,luxES:750,veei:3,ugr:16,ra:80,cat:"Oficinas"},{id:"sala_reuniones",lbl:"Sala de reuniones",luxCO:300,luxES:500,veei:3,ugr:19,ra:80,cat:"Oficinas"},{id:"recepcion",lbl:"Recepcin / Lobby",luxCO:300,luxES:300,veei:3.5,ugr:22,ra:80,cat:"Oficinas"},{id:"archivo",lbl:"Archivo / Bodega oficina",luxCO:200,luxES:200,veei:4,ugr:25,ra:60,cat:"Oficinas"},{id:"sala_estar",lbl:"Sala de estar",luxCO:150,luxES:200,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"dormitorio",lbl:"Dormitorio",luxCO:100,luxES:150,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"cocina_res",lbl:"Cocina residencial",luxCO:300,luxES:300,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"bano",lbl:"Bao",luxCO:200,luxES:200,veei:7.5,ugr:22,ra:80,cat:"Residencial"},{id:"circulacion",lbl:"Circulacin / Pasillo",luxCO:100,luxES:100,veei:7.5,ugr:25,ra:80,cat:"Residencial"},{id:"escalera",lbl:"Escaleras",luxCO:150,luxES:150,veei:4,ugr:25,ra:80,cat:"Residencial"},{id:"garaje",lbl:"Garaje / Parqueadero",luxCO:75,luxES:75,veei:5,ugr:25,ra:40,cat:"Residencial"},{id:"aula",lbl:"Aula de clase",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"laboratorio",lbl:"Laboratorio",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"biblioteca",lbl:"Biblioteca / Lectura",luxCO:500,luxES:500,veei:3.5,ugr:19,ra:80,cat:"Educacin"},{id:"comercio",lbl:"Comercio general",luxCO:300,luxES:300,veei:5,ugr:22,ra:80,cat:"Comercio"},{id:"supermercado",lbl:"Supermercado",luxCO:500,luxES:500,veei:5,ugr:22,ra:80,cat:"Comercio"},{id:"restaurante",lbl:"Restaurante",luxCO:200,luxES:200,veei:8,ugr:22,ra:80,cat:"Comercio"},{id:"hospital",lbl:"Hospital  general",luxCO:300,luxES:300,veei:4,ugr:19,ra:80,cat:"Salud"},{id:"consultorio",lbl:"Consultorio mdico",luxCO:500,luxES:500,veei:4,ugr:19,ra:90,cat:"Salud"},{id:"quirofano",lbl:"Quirfano",luxCO:1e3,luxES:1e3,veei:4,ugr:19,ra:90,cat:"Salud"},{id:"nave_ind",lbl:"Nave industrial general",luxCO:300,luxES:300,veei:4,ugr:25,ra:60,cat:"Industrial"},{id:"ind_fina",lbl:"Industria  trabajo fino",luxCO:500,luxES:500,veei:4,ugr:22,ra:80,cat:"Industrial"},{id:"almacen",lbl:"Almacn / Depsito",luxCO:150,luxES:100,veei:5,ugr:25,ra:60,cat:"Industrial"},{id:"ext_acera",lbl:"Acera / Andn exterior",luxCO:20,luxES:20,veei:null,ugr:null,ra:20,cat:"Exterior"},{id:"ext_parqueo",lbl:"Parqueadero exterior",luxCO:50,luxES:50,veei:null,ugr:null,ra:20,cat:"Exterior"}],qs=[{id:"panel_40w",lbl:"Panel LED 6060  40W",w:40,lm:4e3,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"panel_36w",lbl:"Panel LED 6060  36W",w:36,lm:3600,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"panel_24w",lbl:"Panel LED 3030  24W",w:24,lm:2400,tipo:"Empotrado",temp:"4000K",vida:5e4,irc:80},{id:"down_18w",lbl:"Downlight LED 20  18W",w:18,lm:1800,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"down_12w",lbl:"Downlight LED 15  12W",w:12,lm:1200,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"down_9w",lbl:"Downlight LED 12  9W",w:9,lm:900,tipo:"Empotrado",temp:"3000K",vida:4e4,irc:80},{id:"tubo_18w",lbl:"Tubo LED T8 120cm  18W",w:18,lm:2e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"tubo_9w",lbl:"Tubo LED T8 60cm  9W",w:9,lm:1e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"regleta_36w",lbl:"Regleta 2T8 LED  36W",w:36,lm:4e3,tipo:"Regleta",temp:"6500K",vida:3e4,irc:80},{id:"campana_100w",lbl:"Campana LED industrial  100W",w:100,lm:13e3,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"campana_150w",lbl:"Campana LED industrial  150W",w:150,lm:2e4,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"campana_200w",lbl:"Campana LED industrial  200W",w:200,lm:26e3,tipo:"Suspendido",temp:"5000K",vida:5e4,irc:70},{id:"aplique_12w",lbl:"Aplique de pared  12W",w:12,lm:1e3,tipo:"Aplique",temp:"3000K",vida:3e4,irc:80},{id:"plafon_24w",lbl:"Plafn LED 30  24W",w:24,lm:2200,tipo:"Adosado",temp:"4000K",vida:4e4,irc:80},{id:"plafon_18w",lbl:"Plafn LED 25  18W",w:18,lm:1600,tipo:"Adosado",temp:"4000K",vida:4e4,irc:80},{id:"spot_9w",lbl:"Spot LED GU10  9W",w:9,lm:800,tipo:"Spot",temp:"3000K",vida:25e3,irc:80},{id:"lineal_20w",lbl:"Perfil lineal LED  20W/m",w:20,lm:2200,tipo:"Lineal",temp:"4000K",vida:5e4,irc:90}];function Ll(t,i,o){const n=Math.min(.95,.25+.35*Math.log10(1+t)),s=1+(i-.5)*.15+(o-.3)*.1;return Math.min(.9,Math.max(.2,n*s))}function Bf({pais:t}){const[i,o]=F.useState(!1),[n,s]=F.useState("oficina_gral"),[r,a]=F.useState("5"),[u,h]=F.useState("4"),[b,j]=F.useState("2.8"),[C,v]=F.useState("0.85"),[m,f]=F.useState("0"),[p,c]=F.useState("0.7"),[d,l]=F.useState("0.5"),[x,y]=F.useState("0.2"),[g,S]=F.useState("panel_40w"),[A,E]=F.useState("0.8"),w=Vs.find(U=>U.id===n),I=qs.find(U=>U.id===g),z=F.useMemo(()=>{if(!w||!I)return null;const U=+r,$=+u,Y=+b,ge=+C,J=+m,ye=+A;if(U<=0||$<=0||Y<=0)return null;const oe=t==="CO"?w.luxCO:w.luxES,L=U*$,R=Y-ge-J;if(R<=0)return null;const T=U*$/(R*(U+$)),W=Ll(T,+p,+d),X=oe*L/(W*ye),M=Math.ceil(X/I.lm),O=Math.max(1,M),ne=U/$;let ie=Math.round(Math.sqrt(O/ne)),re=Math.ceil(O/Math.max(1,ie));ie<1&&(ie=1),re*ie<O&&re++;const H=re*ie,se=H*I.lm*W*ye/L,N=U/re,G=$/ie,ue=H*I.w,he=ue/L,we=se>0?ue*100/(L*se):0,Ve=Math.min(.95,.4+.3*W+.1*(T>2?1:T/2)),Ee=se>=oe,je=w.veei?we<=w.veei:!0,V=I.irc>=w.ra,te=Ve>=.6,ce=Math.max(N,G)<=1.5*R;return{luxReq:oe,S:L,h:R,K:T,CU:W,flujoTotal:X,nCalc:O,nReal:H,rows:re,cols:ie,luxReal:se,distL:N,distA:G,potTotal:ue,dpea:he,veei:we,unifEst:Ve,luxOk:Ee,veeiOk:je,ircOk:V,unifOk:te,distMaxOk:ce,allOk:Ee&&je&&V&&te&&ce}},[n,r,u,b,C,m,p,d,A,g,t,w,I]),B=F.useMemo(()=>{if(!w)return[];const U=+r,$=+u,Y=+b,ge=+C,J=+m,ye=+A;if(U<=0||$<=0||Y<=0)return[];const oe=t==="CO"?w.luxCO:w.luxES,L=U*$,R=Y-ge-J;if(R<=0)return[];const T=U*$/(R*(U+$)),W=Ll(T,+p,+d),X=[];return qs.forEach(M=>{if(M.irc<w.ra)return;const O=oe*L/(W*ye),ne=Math.ceil(O/M.lm),ie=Math.max(1,ne),re=U/$;let H=Math.round(Math.sqrt(ie/re)),se=Math.ceil(ie/Math.max(1,H));H<1&&(H=1),se*H<ie&&se++;const N=se*H,G=N*M.lm*W*ye/L,ue=U/se,he=$/H,we=N*M.w,Ve=G>0?we*100/(L*G):0,Ee=Math.min(.95,.4+.3*W+.1*(T>2?1:T/2)),je=G>=oe,V=w.veei?Ve<=w.veei:!0,te=Ee>=.6,ce=Math.max(ue,he)<=1.5*R;if(!(je&&V&&te&&ce))return;const _=M.lm/M.w,ae=we/L;X.push({lumOp:M,nReal:N,rows:se,cols:H,luxReal:Math.round(G),potTotal:we,dpea:ae.toFixed(1),veei:Ve.toFixed(2),eficacia:_.toFixed(0),distL:ue.toFixed(2),distA:he.toFixed(2)})}),X.sort((M,O)=>M.potTotal-O.potTotal),X.slice(0,5)},[n,r,u,b,C,m,p,d,A,t,w]),P=U=>{S(U.lumOp.id)},q={background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:16,marginBottom:12,boxShadow:Z.shadow};return e.jsxs("div",{className:"fade-up",style:{maxWidth:1100},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsxs("button",{onClick:()=>o(!i),style:{padding:"6px 14px",border:`1px solid ${Z.border}`,borderRadius:4,background:i?Z.blueBg:"#fff",color:i?Z.blue:Z.inkLight,fontSize:10,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" ",i?"Ocultar":"Ver"," tabla normativa  ",t==="CO"?"RETILAP":"UNE 12464-1"]}),e.jsx(zs,{pais:t})]}),i&&e.jsx("div",{style:{...q,background:Z.blueBg,maxHeight:220,overflowY:"auto",marginBottom:16},children:e.jsxs("table",{style:{width:"100%",fontSize:9},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"rgba(30,79,140,.06)"},children:["Cat.","Espacio","Lux mn (CO)","Lux mn (ES)","UGR mx","Ra mn","VEEI lm"].map(U=>e.jsx("th",{style:{padding:"4px 8px",textAlign:"left",fontWeight:700,color:Z.blue,borderBottom:`1px solid ${Z.blue}33`},children:U},U))})}),e.jsx("tbody",{children:Vs.map(U=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Z.border}`,background:U.id===n?"rgba(30,79,140,.08)":"transparent"},children:[e.jsx("td",{style:{padding:"3px 8px",color:Z.inkLight},children:U.cat}),e.jsx("td",{style:{padding:"3px 8px",fontWeight:U.id===n?700:400},children:U.lbl}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:U.luxCO}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:U.luxES}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:U.ugr??""}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:U.ra}),e.jsx("td",{style:{padding:"3px 8px"},className:"mono",children:U.veei??"N/A"})]},U.id))})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:q,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Tipo de espacio"}),e.jsx(qi,{value:n,onChange:s,options:Object.entries(Vs.reduce((U,$)=>((U[$.cat]=U[$.cat]||[]).push($),U),{})).flatMap(([U,$])=>[{v:"__"+U,l:` ${U} `},...$.map(Y=>({v:Y.id,l:`${Y.lbl}  ${t==="CO"?Y.luxCO:Y.luxES} lux`}))])}),w&&e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,fontSize:9},children:[e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:Z.amberBg,color:Z.amber,fontWeight:700},children:["Req: ",t==="CO"?w.luxCO:w.luxES," lux"]}),e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:Z.accent,color:Z.inkMid},children:["UGR  ",w.ugr??""]}),e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:Z.accent,color:Z.inkMid},children:["Ra  ",w.ra]}),w.veei&&e.jsxs("span",{style:{padding:"3px 8px",borderRadius:3,background:Z.accent,color:Z.inkMid},children:["VEEI  ",w.veei]})]})]}),e.jsxs("div",{style:q,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Dimensiones (m)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[e.jsx($t,{label:"Largo",value:r,onChange:a,step:"0.1",min:"0.1"}),e.jsx($t,{label:"Ancho",value:u,onChange:h,step:"0.1",min:"0.1"}),e.jsx($t,{label:"Alto total",value:b,onChange:j,step:"0.1",min:"0.5"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx($t,{label:"Plano de trabajo",value:C,onChange:v,step:"0.05",unit:"m"}),e.jsx($t,{label:"Suspensin luminaria",value:m,onChange:f,step:"0.05",unit:"m"})]})]}),e.jsxs("div",{style:q,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Reflectancias"}),[["Techo",p,c],["Paredes",d,l],["Suelo",x,y]].map(([U,$,Y])=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx("span",{style:{fontSize:10,width:55,fontWeight:500},children:U}),e.jsx("input",{type:"range",min:.1,max:.9,step:.05,value:$,onChange:ge=>Y(ge.target.value),style:{flex:1,accentColor:Z.blue}}),e.jsxs("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:Z.blue,minWidth:30},children:[($*100).toFixed(0),"%"]})]},U)),e.jsx("div",{style:{fontSize:8,color:Z.inkLight},children:"Techo blanco  70%  Pared clara  50%  Suelo oscuro  20%"})]}),e.jsxs("div",{style:q,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Luminaria"}),e.jsx(qi,{value:g,onChange:S,options:Object.entries(qs.reduce((U,$)=>((U[$.tipo]=U[$.tipo]||[]).push($),U),{})).flatMap(([U,$])=>[{v:"__"+U,l:` ${U} `},...$.map(Y=>({v:Y.id,l:`${Y.lbl}  ${Y.lm}lm`}))])}),I&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6,marginTop:8,fontSize:9},children:[{l:"Flujo",v:`${I.lm} lm`},{l:"Potencia",v:`${I.w} W`},{l:"Eficacia",v:`${Math.round(I.lm/I.w)} lm/W`},{l:"IRC",v:`${I.irc}`}].map(U=>e.jsxs("div",{style:{background:Z.bg,padding:"5px 8px",borderRadius:4,textAlign:"center"},children:[e.jsx("div",{className:"mono",style:{fontWeight:700,color:Z.blue},children:U.v}),e.jsx("div",{style:{color:Z.inkLight,fontSize:8},children:U.l})]},U.l))}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:9,color:Z.inkLight,letterSpacing:1,textTransform:"uppercase",fontWeight:700,marginBottom:4},children:"Factor de mantenimiento (Cm)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"range",min:.5,max:1,step:.05,value:A,onChange:U=>E(U.target.value),style:{flex:1,accentColor:Z.blue}}),e.jsx("span",{className:"mono",style:{fontSize:11,fontWeight:700,color:Z.blue,minWidth:24},children:A})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:8,color:Z.inkXLight},children:[e.jsx("span",{children:"Sucio 0.5"}),e.jsx("span",{children:"Limpio 1.0"})]})]})]})]}),e.jsx("div",{children:z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{...q,background:z.allOk?Z.greenBg:Z.redBg,border:`1px solid ${z.allOk?Z.green:Z.red}33`,textAlign:"center",padding:20},children:[e.jsx("div",{style:{fontSize:28,fontWeight:800,color:z.allOk?Z.green:Z.red},children:z.allOk?" CUMPLE":" NO CUMPLE"}),e.jsx("div",{style:{fontSize:10,color:Z.inkMid,marginTop:2},children:t==="CO"?"RETILAP  Res. 181331/2009":"CTE DB-HE3 / UNE-EN 12464-1"})]}),!z.allOk&&B.length>0&&e.jsxs("div",{style:{...q,background:"#FFFBE6",border:"1px solid #E6D44D55",padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#8C6A00",marginBottom:8},children:" Soluciones que S cumplen normativa"}),e.jsx("div",{style:{fontSize:9,color:Z.inkMid,marginBottom:8},children:'Haz clic en "Aplicar" para usar esa opcin automticamente'}),B.slice(0,3).map((U,$)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 10px",background:$===0?"#E8F4EE":"#fff",border:`1px solid ${$===0?Z.green+"44":Z.border}`,borderRadius:6,marginBottom:4},children:[$===0&&e.jsx("span",{style:{fontSize:14},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:$===0?Z.green:Z.ink},children:U.lumOp.lbl}),e.jsxs("div",{style:{fontSize:8,color:Z.inkMid},children:[U.nReal," uds (",U.rows,"",U.cols,")  ",U.luxReal," lux  ",U.potTotal,"W total  VEEI ",U.veei,"  ",U.eficacia," lm/W"]})]}),e.jsx("button",{onClick:()=>P(U),style:{padding:"4px 12px",background:$===0?Z.green:"#fff",color:$===0?"#fff":Z.blue,border:$===0?"none":`1px solid ${Z.blue}`,borderRadius:4,fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap"},children:"Aplicar"})]},U.lumOp.id))]}),z.allOk&&B.length>1&&e.jsxs("div",{style:{...q,background:Z.blueBg,border:`1px solid ${Z.blue}22`,padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:Z.blue,marginBottom:6},children:" Se puede optimizar?"}),B.filter(U=>U.lumOp.id!==g).slice(0,2).map(U=>{const $=z.potTotal-U.potTotal;return $>0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",background:"#fff",border:`1px solid ${Z.border}`,borderRadius:5,marginBottom:3},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600},children:U.lumOp.lbl}),e.jsxs("div",{style:{fontSize:8,color:Z.inkMid},children:[U.nReal," uds  ",U.luxReal," lux  ",U.potTotal,"W",e.jsxs("span",{style:{color:Z.green,fontWeight:700,marginLeft:4},children:[" Ahorra ",$,"W"]})]})]}),e.jsx("button",{onClick:()=>P(U),style:{padding:"3px 10px",background:"#fff",color:Z.blue,border:`1px solid ${Z.blue}`,borderRadius:3,fontSize:8,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cambiar"})]},U.lumOp.id):null})]}),!z.allOk&&B.length===0&&e.jsxs("div",{style:{...q,background:Z.redBg,border:`1px solid ${Z.red}33`,padding:14},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:Z.red,marginBottom:4},children:" Ninguna luminaria del catlogo cumple"}),e.jsx("div",{style:{fontSize:9,color:Z.inkMid},children:"Prueba a: aumentar reflectancias, reducir altura de suspensin, o el espacio requiere una luminaria de mayor flujo no incluida en el catlogo."})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:12},children:[{l:"Luminarias",v:z.nReal,u:`${z.rows}${z.cols}`,ok:!0},{l:"Iluminacin",v:Math.round(z.luxReal),u:`lux (req: ${z.luxReq})`,ok:z.luxOk},{l:"Potencia total",v:z.potTotal,u:"W",ok:!0},{l:"DPEA",v:z.dpea.toFixed(1),u:"W/m",ok:!0},{l:"VEEI",v:z.veei.toFixed(2),u:`W/m100lx${w!=null&&w.veei?` (lm: ${w.veei})`:""}`,ok:z.veeiOk},{l:"Superficie",v:z.S.toFixed(1),u:"m",ok:!0}].map(U=>e.jsxs("div",{style:{background:Z.surface,border:`1px solid ${U.ok?Z.border:Z.red}`,borderRadius:6,padding:"10px 12px",boxShadow:Z.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:U.ok?Z.inkLight:Z.red,textTransform:"uppercase",letterSpacing:.5},children:U.l}),e.jsx("div",{className:"mono",style:{fontSize:20,fontWeight:800,color:U.ok?Z.ink:Z.red,marginTop:2},children:U.v}),e.jsx("div",{style:{fontSize:8,color:Z.inkLight},children:U.u})]},U.l))}),e.jsxs("div",{style:q,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Verificaciones normativas"}),[{l:`Iluminacin  ${z.luxReq} lux`,v:`${Math.round(z.luxReal)} lux`,ok:z.luxOk},{l:`VEEI  ${(w==null?void 0:w.veei)??"N/A"}`,v:w!=null&&w.veei?z.veei.toFixed(2):"N/A",ok:z.veeiOk},{l:`IRC  ${w==null?void 0:w.ra}`,v:`${I==null?void 0:I.irc}`,ok:z.ircOk},{l:"Uniformidad  0.6",v:z.unifEst.toFixed(2),ok:z.unifOk},{l:`Dist. luminarias  ${(1.5*z.h).toFixed(2)}m`,v:`${Math.max(z.distL,z.distA).toFixed(2)}m`,ok:z.distMaxOk}].map(U=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"5px 0",borderBottom:`1px solid ${Z.accent}`},children:[e.jsx("span",{style:{fontSize:13},children:U.ok?"":""}),e.jsx("span",{style:{flex:1,fontSize:10,fontWeight:500},children:U.l}),e.jsx("span",{className:"mono",style:{fontSize:10,fontWeight:700,color:U.ok?Z.green:Z.red},children:U.v})]},U.l))]}),e.jsxs("div",{style:q,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Memoria de clculo"}),e.jsx("div",{style:{fontSize:9,lineHeight:2,color:Z.inkMid},children:[["Superficie (S)",`${r}  ${u} = ${z.S.toFixed(1)} m`],["Altura til (h)",`${b}  ${C}  ${m} = ${z.h.toFixed(2)} m`],["ndice local (K)",`(${r}${u}) / (${z.h.toFixed(2)}(${r}+${u})) = ${z.K.toFixed(2)}`],["Coef. utilizacin",`CU = ${z.CU.toFixed(3)} (t=${(p*100).toFixed(0)}%, p=${(d*100).toFixed(0)}%)`],["Flujo necesario",`(${z.luxReq}${z.S.toFixed(1)})/(${z.CU.toFixed(3)}${A}) = ${Math.round(z.flujoTotal).toLocaleString()} lm`],["N luminarias",`${Math.round(z.flujoTotal).toLocaleString()} / ${I.lm.toLocaleString()}  ${z.nCalc}  ${z.nReal} ud (${z.rows}${z.cols})`],["Separacin",`Largo: ${z.distL.toFixed(2)}m  Ancho: ${z.distA.toFixed(2)}m`]].map(([U,$])=>e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("span",{style:{fontWeight:700,color:Z.ink,minWidth:130},children:[U,":"]}),e.jsx("span",{className:"mono",style:{fontWeight:500},children:$})]},U))})]}),e.jsxs("div",{style:q,children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,marginBottom:8},children:" Disposicin en planta"}),e.jsxs("div",{style:{position:"relative",background:Z.bg,border:`2px solid ${Z.border}`,borderRadius:4,width:"100%",aspectRatio:`${r}/${u}`,maxHeight:200,overflow:"hidden"},children:[e.jsxs("div",{style:{position:"absolute",top:2,left:"50%",transform:"translateX(-50%)",fontSize:8,color:Z.inkLight},className:"mono",children:[r,"m"]}),e.jsxs("div",{style:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%) rotate(90deg)",fontSize:8,color:Z.inkLight},className:"mono",children:[u,"m"]}),Array.from({length:z.rows},(U,$)=>Array.from({length:z.cols},(Y,ge)=>{const J=(ge+.5)/z.cols*100,ye=($+.5)/z.rows*100;return e.jsx("div",{style:{position:"absolute",left:`${J}%`,top:`${ye}%`,transform:"translate(-50%,-50%)",width:12,height:12,borderRadius:"50%",background:"radial-gradient(circle,#FFD600 30%,#FFD60044 100%)",border:"2px solid #FFC107",boxShadow:"0 0 6px #FFD60055"}},`${$}-${ge}`)}))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:16,marginTop:6,fontSize:8,color:Z.inkLight},children:[e.jsxs("span",{children:[z.rows,"",z.cols," = ",z.nReal," luminarias"]}),e.jsxs("span",{children:["Sep: ",z.distL.toFixed(2),"m  ",z.distA.toFixed(2),"m"]})]})]})]}):e.jsxs("div",{style:{...q,textAlign:"center",padding:40,color:Z.inkLight},children:[e.jsx(md,{size:32,style:{opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600},children:"Completa los datos para ver el clculo"})]})})]})]})}function If(){const[t,i]=F.useState("longitud"),[o,n]=F.useState("m"),[s,r]=F.useState("ft"),[a,u]=F.useState(""),h={longitud:{l:"Longitud",u:{m:1,cm:.01,mm:.001,km:1e3,ft:.3048,in:.0254,yd:.9144}},area:{l:"rea",u:{"m":1,"cm":1e-4,"km":1e6,"ft":.092903,"in":64516e-8,ha:1e4,ac:4046.86}},volumen:{l:"Volumen",u:{"m":1,"cm":1e-6,l:.001,ml:1e-6,gal:.00378541,"ft":.0283168}},peso:{l:"Masa",u:{kg:1,g:.001,t:1e3,lb:.453592,oz:.0283495}},temperatura:{l:"Temperatura",special:!0},presion:{l:"Presin",u:{Pa:1,kPa:1e3,MPa:1e6,"kgf/cm":98066.5,PSI:6894.76,bar:1e5}}},b=h[t],j=b!=null&&b.u?Object.keys(b.u):["C","F","K"],C=(f,p,c)=>{let d;return p==="C"?d=f:p==="F"?d=(f-32)*5/9:d=f-273.15,c==="C"?d:c==="F"?d*9/5+32:d+273.15},v=F.useMemo(()=>{const f=Number(a);if(isNaN(f)||!a)return null;if(t==="temperatura")return C(f,o,s).toFixed(4);const p=(b==null?void 0:b.u)||{};return!p[o]||!p[s]?null:(f*p[o]/p[s]).toFixed(8).replace(/\.?0+$/,"")},[a,o,s,t]),m=f=>{var c;i(f);const p=(c=h[f])!=null&&c.u?Object.keys(h[f].u):["C","F","K"];n(p[0]||""),r(p[1]||""),u("")};return e.jsxs("div",{className:"fade-up",style:{maxWidth:620},children:[e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:16},children:Object.entries(h).map(([f,p])=>e.jsx("button",{onClick:()=>m(f),style:{padding:"6px 14px",border:`1px solid ${t===f?Z.ink:Z.border}`,borderRadius:20,background:t===f?Z.ink:"transparent",color:t===f?"#fff":Z.inkMid,fontSize:11,fontWeight:t===f?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:p.l},f))}),e.jsxs("div",{style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"24px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 50px 1fr",gap:10,alignItems:"end",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:Z.inkLight,textTransform:"uppercase",letterSpacing:.8,fontWeight:700,marginBottom:5},children:"De"}),e.jsx("select",{value:o,onChange:f=>n(f.target.value),style:{width:"100%",padding:"9px 10px",border:`1.5px solid ${Z.border}`,borderRadius:4,fontSize:12,background:Z.surface},children:j.map(f=>e.jsx("option",{children:f},f))})]}),e.jsx("div",{style:{textAlign:"center",fontSize:18,color:Z.inkXLight,paddingBottom:4},children:""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,color:Z.inkLight,textTransform:"uppercase",letterSpacing:.8,fontWeight:700,marginBottom:5},children:"A"}),e.jsx("select",{value:s,onChange:f=>r(f.target.value),style:{width:"100%",padding:"9px 10px",border:`1.5px solid ${Z.border}`,borderRadius:4,fontSize:12,background:Z.surface},children:j.map(f=>e.jsx("option",{children:f},f))})]})]}),e.jsx($t,{label:"Valor",value:a,onChange:u,placeholder:"Ingresa el valor..."}),v!==null?e.jsxs("div",{style:{background:Z.ink,borderRadius:6,padding:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:11,color:"rgba(255,255,255,.4)",marginBottom:6},children:[a," ",o," ="]}),e.jsx("div",{className:"mono",style:{fontSize:28,fontWeight:800,color:"#fff"},children:v}),e.jsx("div",{style:{fontSize:14,color:"rgba(255,255,255,.4)",marginTop:4},children:s})]}):e.jsx("div",{style:{textAlign:"center",padding:"20px 0",color:Z.inkXLight,fontSize:12},children:"Ingresa un valor"})]})]})}function Rf(){var r,a;const[t,i]=F.useState("dashboard"),[o,n]=gn("hab:config:pais","CO"),s=qo[o];return e.jsxs(e.Fragment,{children:[e.jsx(kf,{}),e.jsxs("div",{style:{minHeight:"100vh",background:Z.bg,fontFamily:"'DM Sans',sans-serif"},children:[e.jsxs("div",{style:{background:Z.ink,padding:"14px 28px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:800,letterSpacing:2,textTransform:"uppercase",color:"#fff"},children:"HABITARIS"}),e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,.3)",letterSpacing:1},children:"Herramientas Tcnicas"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.4)"},children:"Normativa:"}),e.jsx("div",{style:{display:"flex",background:"rgba(255,255,255,.08)",borderRadius:4,overflow:"hidden",border:"1px solid rgba(255,255,255,.12)"},children:["CO","ES"].map(u=>e.jsxs("button",{onClick:()=>n(u),style:{padding:"6px 14px",border:"none",background:o===u?"#fff":"transparent",color:o===u?Z.ink:"rgba(255,255,255,.5)",fontSize:11,fontWeight:o===u?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"flex",alignItems:"center",gap:5,transition:"all .12s"},children:[e.jsx("span",{style:{fontSize:13},children:u==="CO"?"":""}),u==="CO"?"Colombia":"Espaa"]},u))}),e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.35)"},children:s.ref})]})]}),e.jsx("div",{style:{background:Z.surface,borderBottom:`1px solid ${Z.border}`,display:"flex",overflowX:"auto",scrollbarWidth:"none",paddingLeft:16},children:Dr.map(u=>{const h=t===u.id;return e.jsxs("button",{onClick:()=>i(u.id),style:{display:"flex",alignItems:"center",gap:6,padding:"12px 16px",border:"none",background:"transparent",flexShrink:0,borderBottom:h?`2px solid ${Z.ink}`:"2px solid transparent",color:h?Z.ink:Z.inkLight,fontSize:11,fontWeight:h?700:400,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",letterSpacing:.2,transition:"color .1s"},children:[e.jsx(u.I,{size:12}),u.label]},u.id)})}),e.jsxs("div",{style:{padding:"24px 28px 60px"},children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:18,fontWeight:800,color:Z.ink,letterSpacing:-.2},children:(r=Dr.find(u=>u.id===t))==null?void 0:r.label}),e.jsx("p",{style:{fontSize:11,color:Z.inkLight,marginTop:2},children:(a=Dr.find(u=>u.id===t))==null?void 0:a.desc})]}),e.jsx(zs,{pais:o})]}),t==="dashboard"&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:14},children:Dr.filter(u=>u.id!=="dashboard").map(u=>e.jsxs("div",{onClick:()=>i(u.id),style:{background:Z.surface,border:`1px solid ${Z.border}`,borderRadius:8,padding:"20px 18px",cursor:"pointer",boxShadow:Z.shadow,transition:"all .15s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx(u.I,{size:18,color:Z.ink}),e.jsx("div",{style:{fontSize:14,fontWeight:700},children:u.label})]}),e.jsx("div",{style:{fontSize:10,color:Z.inkLight,lineHeight:1.5},children:u.desc})]},u.id))}),t==="cuadro"&&e.jsx(zf,{pais:o}),t==="circuito"&&e.jsx(Ef,{pais:o}),t==="iluminacion"&&e.jsx(Bf,{pais:o}),t==="concreto"&&e.jsx(Af,{}),t==="cubicacion"&&e.jsx(Ff,{}),t==="materiales"&&e.jsx(Tf,{}),t==="unidades"&&e.jsx(If,{})]})]})]})}const Pe={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",border:"#E0E0E0",borderMid:"#D5D2CC",accent:"#EDEBE7",accentBg:"#FFFFFF",success:"#111111",successBg:"#E8F4EE",warning:"#8C6A00",warningBg:"#FFF8E7",danger:"#B91C1C",dangerBg:"#FAE8E8",info:"#3B3B3B",infoBg:"#F0F0F0",sidebar:"#111",sidebarHover:"#222"},Wl=()=>Math.random().toString(36).slice(2,11)+Date.now().toString(36),Hs=()=>new Date().toISOString().split("T")[0],Qo={items:"hab:logistica:items",proveedores:"hab:logistica:proveedores",cotizaciones:"hab:logistica:cotizaciones"},go=[{id:"epp",label:"EPPs",icon:"",color:"#B91C1C",desc:"Elementos de proteccin personal"},{id:"dotacion",label:"Dotaciones",icon:"",color:"#5B3A8C",desc:"Uniformes, chalecos, calzado de dotacin"},{id:"herr_menor",label:"Herramienta menor",icon:"",color:"#8C6A00",desc:"Martillos, niveles, flexmetros, paletas, llanas"},{id:"herr_mayor",label:"Herramienta mayor",icon:"",color:"#3B3B3B",desc:"Taladros, pulidoras, cortadoras, mezcladoras"},{id:"equipo_obra",label:"Equipos de obra",icon:"",color:"#0D5E6E",desc:"Andamios, escaleras, formaletas, compresores"},{id:"equipo_medic",label:"Equipos de medicin",icon:"",color:"#111111",desc:"Niveles lser, distancimetros, estaciones"},{id:"equipo_computo",label:"Equipos de cmputo",icon:"",color:"#555",desc:"PCs, porttiles, tablets, monitores"},{id:"consumible",label:"Consumibles",icon:"",color:"#7C3A1E",desc:"Discos de corte, brocas, lijas, cintas"},{id:"seguridad",label:"Sealizacin / Seguridad",icon:"",color:"#B91C1C",desc:"Conos, cintas, seales, extintores, botiquines"},{id:"transporte",label:"Transporte / Vehculos",icon:"",color:"#555",desc:"Vehculos, carretillas, montacargas"}],Mf=["Cabeza","Ojos y cara","Odos","Respiratorio","Manos","Pies","Cuerpo","Trabajo en alturas","Otro"],_f=["ud","par","juego","m","m","kg","l","rollo","caja","gl"],To=({children:t,style:i})=>e.jsx("div",{style:{background:Pe.surface,borderRadius:8,border:`1px solid ${Pe.border}`,boxShadow:"0 1px 3px rgba(0,0,0,.04)",...i},children:t}),Bo=({children:t,on:i,sm:o,v:n,style:s,...r})=>{const a={display:"inline-flex",alignItems:"center",gap:5,border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",fontWeight:600,transition:"filter .15s",...s},u={pri:{background:Pe.ink,color:"#fff",padding:o?"5px 12px":"8px 18px",fontSize:o?10:12},sec:{background:Pe.accent,color:Pe.ink,padding:o?"5px 12px":"8px 18px",fontSize:o?10:12,border:`1px solid ${Pe.border}`},ghost:{background:"transparent",color:Pe.inkMid,padding:o?"4px 8px":"6px 12px",fontSize:o?10:11},danger:{background:Pe.dangerBg,color:Pe.danger,padding:o?"5px 12px":"8px 18px",fontSize:o?10:12,border:`1px solid ${Pe.danger}33`}};return e.jsx("button",{onClick:i,style:{...a,...u[n]||u.pri},onMouseEnter:h=>h.currentTarget.style.filter="brightness(1.1)",onMouseLeave:h=>h.currentTarget.style.filter="none",...r,children:t})},_n=({t,s:i})=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700,color:Pe.ink,margin:"0 0 2px"},children:t}),i&&e.jsx("p",{style:{fontSize:10,color:Pe.inkLight,margin:"0 0 10px"},children:i})]}),Qt=({lbl:t,val:i,on:o,type:n="text",ph:s,style:r})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Pe.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:t}),e.jsx("input",{type:n,value:i||"",onChange:o,placeholder:s,style:{width:"100%",padding:"6px 10px",border:`1px solid ${Pe.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Pe.bg,color:Pe.ink}})]});function Df(){var L;const[t,i]=F.useState([]),[o,n]=F.useState([]),[s,r]=F.useState({}),[a,u]=F.useState(!1);F.useEffect(()=>{(async()=>{const[R,T,W]=await Promise.all([Fe.get(Qo.items),Fe.get(Qo.proveedores),Fe.get(Qo.cotizaciones)]);R&&i(R),T&&n(T),W&&r(W),u(!0)})()},[]);const h=F.useCallback(R=>{const T=typeof R=="function"?R(t):R;i(T),Fe.set(Qo.items,T)},[t]),b=F.useCallback(R=>{const T=typeof R=="function"?R(o):R;n(T),Fe.set(Qo.proveedores,T)},[o]),j=F.useCallback(R=>{const T=typeof R=="function"?R(s):R;r(T),Fe.set(Qo.cotizaciones,T)},[s]),[C,v]=F.useState("dashboard"),[m,f]=F.useState("todos"),[p,c]=F.useState(""),[d,l]=F.useState(null),[x,y]=F.useState(null),[g,S]=F.useState(!1);F.useState(!1);const A=R=>R?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(R):"",E=F.useMemo(()=>{let R=t;if(m!=="todos"&&(R=R.filter(T=>T.familia===m)),p){const T=p.toLowerCase();R=R.filter(W=>(W.nombre||"").toLowerCase().includes(T)||(W.referencia||"").toLowerCase().includes(T))}return R},[t,m,p]),w=F.useMemo(()=>{const R={};return go.forEach(T=>R[T.id]={count:0,valor:0}),t.forEach(T=>{R[T.familia]&&(R[T.familia].count++,R[T.familia].valor+=(T.precio||0)*(T.stockActual||0))}),{total:t.length,byFam:R,provs:o.length,valorTotal:t.reduce((T,W)=>T+(W.precio||0)*(W.stockActual||0),0)}},[t,o]),I=(R="epp")=>({id:Wl(),nombre:"",familia:R,subfamilia:"",referencia:"",marca:"",unidad:"ud",precio:0,proveedorId:"",vidaUtil:12,reposicionMeses:12,stockMinimo:0,stockActual:0,asociadoACargo:!1,cargosAsociados:[],notas:"",activo:!0,fechaCreacion:Hs()}),z=()=>({id:Wl(),nombre:"",nit:"",contacto:"",telefono:"",email:"",ciudad:"",especialidad:"",notas:"",activo:!0}),B=R=>{h(T=>T.find(X=>X.id===R.id)?T.map(X=>X.id===R.id?R:X):[...T,R]),l(null),S(!1)},P=R=>h(T=>T.filter(W=>W.id!==R)),q=R=>{b(T=>T.find(X=>X.id===R.id)?T.map(X=>X.id===R.id?R:X):[...T,R]),y(null)},U=R=>b(T=>T.filter(W=>W.id!==R)),$=(R,T,W)=>{j(X=>{const M={...X};return M[R]||(M[R]={}),M[R][T]={precio:+W,fecha:Hs()},M})},Y=(R,T)=>{var W;return((W=s[R])==null?void 0:W[T])||{}},ge=R=>{const T=s[R]||{};let W=null,X=1/0;return Object.entries(T).forEach(([M,O])=>{O.precio>0&&O.precio<X&&(X=O.precio,W=M)}),W},[J,ye]=F.useState([]);F.useEffect(()=>{(()=>{try{const R=Fe.getSync("hab:rrhh:cargos");R&&ye(JSON.parse(R)||[])}catch{}})()},[]);const oe=()=>{const R=["Familia","Nombre","Referencia","Marca","Unidad","Precio","Stock","Vida til (meses)","Proveedor"],T=t.map(ne=>{var re;const ie=o.find(H=>H.id===ne.proveedorId);return[((re=go.find(H=>H.id===ne.familia))==null?void 0:re.label)||ne.familia,ne.nombre,ne.referencia,ne.marca,ne.unidad,ne.precio,ne.stockActual,ne.vidaUtil,(ie==null?void 0:ie.nombre)||""]}),W="\uFEFF"+[R,...T].map(ne=>ne.map(ie=>`"${ie}"`).join(",")).join(`
`),X=new Blob([W],{type:"text/csv;charset=utf-8;"}),M=URL.createObjectURL(X),O=document.createElement("a");O.href=M,O.download="logistica_inventario.csv",O.click(),URL.revokeObjectURL(M)};return a?e.jsxs("div",{style:{minHeight:"100vh",background:Pe.bg},children:[e.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
        *, *::before, *::after { box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: ${Pe.ink} !important; }
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-thumb { background: ${Pe.border}; border-radius: 2px; }
        @keyframes fadeUp { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:none; } }
        .fade { animation: fadeUp .15s ease both; }
      `}),e.jsxs("div",{style:{maxWidth:1400,margin:"0 auto",padding:"20px 24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:9,letterSpacing:2,textTransform:"uppercase",color:Pe.inkLight,margin:"0 0 3px"},children:"Logstica y recursos"}),e.jsx("h1",{style:{fontFamily:"'DM Sans',sans-serif",fontSize:24,fontWeight:800,color:Pe.ink,margin:0},children:"Almacn  EPPs  Herramientas  Equipos"})]}),e.jsx("div",{style:{display:"flex",gap:8},children:e.jsxs(Bo,{sm:!0,v:"sec",on:oe,children:[e.jsx(vn,{size:12})," Exportar CSV"]})})]}),e.jsx("div",{style:{display:"flex",borderBottom:`1px solid ${Pe.border}`,marginBottom:20},children:[{id:"dashboard",lbl:"Dashboard"},{id:"inventario",lbl:"Inventario"},{id:"proveedores",lbl:"Proveedores"},{id:"comparativo",lbl:"Comparativo precios"},{id:"compras",lbl:"Lista de compra"}].map(R=>e.jsx("button",{onClick:()=>v(R.id),style:{padding:"10px 16px",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",fontSize:11,fontWeight:600,letterSpacing:1,textTransform:"uppercase",background:"transparent",color:C===R.id?Pe.ink:Pe.inkLight,borderBottom:C===R.id?`2px solid ${Pe.ink}`:"2px solid transparent",transition:"all .15s",marginBottom:-1},children:R.lbl},R.id))}),C==="dashboard"&&e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" tems inventario",t.length,"#111"],[" Proveedores",o.length,"#3B3B3B"],[" Stock bajo",t.filter(R=>R.stockActual<=R.stockMinimo).length,t.filter(R=>R.stockActual<=R.stockMinimo).length>0?"#B91C1C":"#111111"],[" Valor inventario","$"+A(t.reduce((R,T)=>R+(T.stockActual||0)*(T.precioRef||0),0)),"#111"]].map(([R,T,W])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Pe.border}`,borderRadius:8,padding:"14px 16px",boxShadow:"0 1px 3px rgba(0,0,0,.06)"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:R}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:W},children:T})]},R))}),t.filter(R=>R.stockActual<=R.stockMinimo).length>0&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" Stock bajo: ",t.filter(R=>R.stockActual<=R.stockMinimo).map(R=>R.nombre).join(", ")]})]}),C==="inventario"&&e.jsxs("div",{className:"fade",children:[e.jsx("div",{style:{display:"flex",gap:8,marginBottom:14,flexWrap:"wrap"},children:go.map(R=>{var T;return e.jsxs("button",{onClick:()=>f(m===R.id?"todos":R.id),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 12px",border:`1px solid ${m===R.id?R.color:Pe.border}`,borderRadius:6,background:m===R.id?R.color+"15":"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",transition:"all .1s"},children:[e.jsx("span",{style:{fontSize:16},children:R.icon}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:m===R.id?R.color:Pe.inkMid},children:R.label}),e.jsx("div",{style:{fontSize:13,fontWeight:700,color:Pe.ink},children:((T=w.byFam[R.id])==null?void 0:T.count)||0})]})]},R.id)})}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(ki,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:Pe.inkLight}}),e.jsx("input",{value:p,onChange:R=>c(R.target.value),placeholder:"Buscar por nombre o referencia...",style:{width:"100%",padding:"8px 8px 8px 32px",border:`1px solid ${Pe.border}`,borderRadius:4,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:"#fff"}})]}),e.jsxs(Bo,{on:()=>{l(I(m==="todos"?"epp":m)),S(!0)},children:[e.jsx(Ne,{size:12})," Nuevo tem"]})]}),e.jsx(To,{style:{padding:0,overflow:"hidden"},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:900},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["","Nombre","Ref/Marca","Familia","Unid","Precio","Stock","Vida til","Proveedor",""].map((R,T)=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.4,borderBottom:`2px solid ${Pe.border}`,textAlign:T>=4?"center":"left"},children:R},T))})}),e.jsxs("tbody",{children:[E.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:10,style:{padding:32,textAlign:"center",color:Pe.inkLight,fontSize:13},children:["Sin tems",m!=="todos"?` en ${(L=go.find(R=>R.id===m))==null?void 0:L.label}`:"","."]})}),E.map((R,T)=>{const W=go.find(M=>M.id===R.familia),X=o.find(M=>M.id===R.proveedorId);return e.jsxs("tr",{style:{background:T%2===0?"#fff":"#FFFFFF",borderBottom:"1px solid #F5F5F5"},children:[e.jsx("td",{style:{padding:"5px 6px",fontSize:16,textAlign:"center"},children:(W==null?void 0:W.icon)||""}),e.jsxs("td",{style:{padding:"5px 8px"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,color:Pe.ink},children:R.nombre||"Sin nombre"}),R.notas&&e.jsx("div",{style:{fontSize:9,color:Pe.inkLight,marginTop:1},children:R.notas})]}),e.jsxs("td",{style:{padding:"5px 8px"},children:[e.jsx("div",{style:{fontSize:10,color:Pe.inkMid},children:R.referencia||""}),e.jsx("div",{style:{fontSize:9,color:Pe.inkLight},children:R.marca||""})]}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx("span",{style:{fontSize:9,fontWeight:600,color:(W==null?void 0:W.color)||Pe.inkMid,background:(W==null?void 0:W.color)+"15",padding:"2px 6px",borderRadius:3},children:(W==null?void 0:W.label)||R.familia})}),e.jsx("td",{style:{padding:"5px 6px",textAlign:"center",fontSize:10},children:R.unidad}),e.jsx("td",{style:{padding:"5px 6px",textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:600},children:A(R.precio)}),e.jsxs("td",{style:{padding:"5px 6px",textAlign:"center"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:600,color:R.stockActual<=R.stockMinimo?Pe.danger:Pe.ink},children:R.stockActual||0}),R.stockMinimo>0&&R.stockActual<=R.stockMinimo&&e.jsx("span",{style:{fontSize:8,color:Pe.danger,display:"block"},children:" bajo"})]}),e.jsxs("td",{style:{padding:"5px 6px",textAlign:"center",fontSize:10,color:Pe.inkMid},children:[R.vidaUtil||""," meses"]}),e.jsx("td",{style:{padding:"5px 8px",fontSize:10},children:(X==null?void 0:X.nombre)||""}),e.jsxs("td",{style:{padding:"5px 4px",textAlign:"center",whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>{l({...R}),S(!0)},style:{background:"none",border:"none",cursor:"pointer",color:Pe.inkLight,padding:3},children:e.jsx(ro,{size:12})}),e.jsx("button",{onClick:()=>P(R.id),style:{background:"none",border:"none",cursor:"pointer",color:Pe.danger,padding:3},children:e.jsx(Je,{size:12})})]})]},R.id)})]})]})})})]}),C==="proveedores"&&e.jsxs("div",{className:"fade",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx(_n,{t:`${o.length} proveedores registrados`,s:"Gestin de proveedores para cotizaciones"}),e.jsxs(Bo,{on:()=>y(z()),children:[e.jsx(Ne,{size:12})," Nuevo proveedor"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:12},children:[o.map(R=>e.jsxs(To,{style:{padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Pe.ink},children:R.nombre}),e.jsxs("div",{style:{fontSize:10,color:Pe.inkMid,marginTop:2},children:[R.nit&&`NIT: ${R.nit}  `,R.ciudad||""]})]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("button",{onClick:()=>y({...R}),style:{background:"none",border:"none",cursor:"pointer",color:Pe.inkLight,padding:3},children:e.jsx(ro,{size:12})}),e.jsx("button",{onClick:()=>U(R.id),style:{background:"none",border:"none",cursor:"pointer",color:Pe.danger,padding:3},children:e.jsx(Je,{size:12})})]})]}),R.contacto&&e.jsxs("div",{style:{fontSize:11,marginTop:6},children:[" ",R.contacto]}),R.telefono&&e.jsxs("div",{style:{fontSize:11,color:Pe.inkMid},children:[" ",R.telefono]}),R.email&&e.jsxs("div",{style:{fontSize:11,color:Pe.inkMid},children:[" ",R.email]}),R.especialidad&&e.jsx("div",{style:{fontSize:10,color:Pe.info,marginTop:4,fontWeight:600},children:R.especialidad})]},R.id)),o.length===0&&e.jsxs(To,{style:{padding:32,textAlign:"center",gridColumn:"1/-1"},children:[e.jsx(Pc,{size:28,style:{color:Pe.inkLight,opacity:.3,marginBottom:8}}),e.jsx("p",{style:{color:Pe.inkLight,fontSize:13},children:"Sin proveedores. Aade el primero."})]})]})]}),C==="comparativo"&&e.jsxs("div",{className:"fade",children:[e.jsx(_n,{t:"Comparativo de precios por proveedor",s:"Ingresa precios de cada proveedor para comparar"}),o.length===0?e.jsx(To,{style:{padding:32,textAlign:"center"},children:e.jsx("p",{style:{color:Pe.inkLight},children:"Primero aade proveedores en la pestaa Proveedores."})}):e.jsx(To,{style:{padding:0,overflow:"hidden",marginTop:12},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%",minWidth:500+o.length*120},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Pe.border}`,textAlign:"left",position:"sticky",left:0,background:"#EDEBE7",zIndex:2,minWidth:50},children:"#"}),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Pe.border}`,textAlign:"left",position:"sticky",left:50,background:"#EDEBE7",zIndex:2,minWidth:180},children:"TEM"}),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Pe.border}`,textAlign:"center",width:50},children:"UND"}),o.map(R=>e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,textTransform:"uppercase",borderBottom:`2px solid ${Pe.border}`,textAlign:"center",minWidth:110,color:Pe.info,background:Pe.infoBg},children:R.nombre},R.id)),e.jsx("th",{style:{padding:"7px 8px",fontSize:9,fontWeight:700,color:Pe.success,textTransform:"uppercase",borderBottom:`2px solid ${Pe.border}`,textAlign:"center",width:100,background:Pe.successBg},children:"MEJOR"})]})}),e.jsx("tbody",{children:t.map((R,T)=>{const W=ge(R.id),X=W?Y(R.id,W):{},M=go.find(O=>O.id===R.familia);return e.jsxs("tr",{style:{background:T%2===0?"#fff":"#FFFFFF",borderBottom:`1px solid ${Pe.border}`},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,color:"#999",position:"sticky",left:0,background:T%2===0?"#fff":"#FFFFFF",zIndex:1},children:T+1}),e.jsx("td",{style:{padding:"4px 8px",position:"sticky",left:50,background:T%2===0?"#fff":"#FFFFFF",zIndex:1},children:e.jsxs("span",{style:{fontSize:11,fontWeight:500},children:[M==null?void 0:M.icon," ",R.nombre]})}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontSize:10,color:Pe.inkMid},children:R.unidad}),o.map(O=>{const ne=Y(R.id,O.id),ie=W===O.id&&ne.precio>0;return e.jsx("td",{style:{padding:"3px 4px",textAlign:"center",background:ie?Pe.successBg:"transparent",borderLeft:`1px solid ${Pe.border}`},children:e.jsx("input",{type:"number",value:ne.precio||"",placeholder:"",onChange:re=>$(R.id,O.id,re.target.value),style:{border:`1px solid ${ie?Pe.success:Pe.border}`,borderRadius:3,padding:"3px 5px",fontSize:10,fontFamily:"'DM Mono',monospace",width:85,textAlign:"right",background:ie?"#D4EDDA":"#fff",fontWeight:ie?700:400}})},O.id)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700,color:Pe.success,background:Pe.successBg},children:X.precio>0?A(X.precio):""})]},R.id)})})]})})})]}),C==="compras"&&e.jsxs("div",{className:"fade",children:[e.jsx(_n,{t:"Lista de compra",s:"tems con stock bajo o sin stock, agrupados por proveedor"}),(()=>{const R=t.filter(W=>W.stockActual<=(W.stockMinimo||0));if(R.length===0)return e.jsxs(To,{style:{padding:32,textAlign:"center",marginTop:12},children:[e.jsx(wn,{size:28,style:{color:Pe.inkLight,opacity:.3,marginBottom:8}}),e.jsx("p",{style:{color:Pe.inkLight},children:"No hay tems con stock bajo. Define stock mnimo en cada tem para activar alertas."})]});const T={};return R.forEach(W=>{const X=ge(W.id)||W.proveedorId||"sin_prov";T[X]||(T[X]=[]),T[X].push(W)}),e.jsx("div",{style:{display:"grid",gap:12,marginTop:12},children:Object.entries(T).map(([W,X])=>{const M=o.find(O=>O.id===W);return e.jsxs(To,{style:{padding:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[" ",(M==null?void 0:M.nombre)||"Sin proveedor asignado"]}),(M==null?void 0:M.telefono)&&e.jsxs("div",{style:{fontSize:10,color:Pe.inkMid},children:[M.telefono,"  ",M.email||""]})]}),e.jsxs("span",{style:{fontSize:11,fontWeight:600,color:Pe.danger},children:[X.length," tem",X.length!==1?"s":""]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:11},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${Pe.border}`},children:[e.jsx("th",{style:{padding:"4px 6px",textAlign:"left",fontSize:9,color:"#888",fontWeight:700},children:"TEM"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:50},children:"UND"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:60},children:"STOCK"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:"#888",fontWeight:700,width:60},children:"MN"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"center",fontSize:9,color:Pe.danger,fontWeight:700,width:60},children:"PEDIR"}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"right",fontSize:9,color:"#888",fontWeight:700,width:80},children:"P.U."}),e.jsx("th",{style:{padding:"4px 6px",textAlign:"right",fontSize:9,color:"#888",fontWeight:700,width:90},children:"SUBTOTAL"})]})}),e.jsx("tbody",{children:X.map(O=>{var se;const ne=Math.max(0,(O.stockMinimo||1)-(O.stockActual||0)),ie=ge(O.id),H=(ie?Y(O.id,ie):{}).precio||O.precio||0;return e.jsxs("tr",{style:{borderBottom:"1px solid #F5F5F5"},children:[e.jsxs("td",{style:{padding:"4px 6px",fontWeight:500},children:[(se=go.find(N=>N.id===O.familia))==null?void 0:se.icon," ",O.nombre]}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",color:Pe.inkMid},children:O.unidad}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",color:Pe.danger,fontWeight:600},children:O.stockActual||0}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center"},children:O.stockMinimo||0}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"center",fontWeight:700,color:Pe.danger,background:Pe.dangerBg},children:ne}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10},children:A(H)}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600},children:A(H*ne)})]},O.id)})})]})]},W)})})})()]}),g&&d&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{S(!1),l(null)},children:e.jsxs("div",{onClick:R=>R.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:520,maxHeight:"85vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(_n,{t:d.fechaCreacion===Hs()?"Nuevo tem":"Editar tem",s:"Registro de recurso / material"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Qt,{lbl:"Nombre",val:d.nombre,on:R=>l({...d,nombre:R.target.value}),ph:"Ej: Casco de seguridad"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Pe.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Familia"}),e.jsx("select",{value:d.familia,onChange:R=>l({...d,familia:R.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${Pe.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Pe.bg},children:go.map(R=>e.jsxs("option",{value:R.id,children:[R.icon," ",R.label]},R.id))})]})]}),d.familia==="epp"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Pe.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Subfamilia EPP"}),e.jsxs("select",{value:d.subfamilia||"",onChange:R=>l({...d,subfamilia:R.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${Pe.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Pe.bg},children:[e.jsx("option",{value:"",children:" Seleccionar "}),Mf.map(R=>e.jsx("option",{value:R,children:R},R))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[e.jsx(Qt,{lbl:"Referencia",val:d.referencia,on:R=>l({...d,referencia:R.target.value}),ph:"Ref."}),e.jsx(Qt,{lbl:"Marca",val:d.marca,on:R=>l({...d,marca:R.target.value}),ph:"Marca"}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Pe.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Unidad"}),e.jsx("select",{value:d.unidad,onChange:R=>l({...d,unidad:R.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${Pe.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Pe.bg},children:_f.map(R=>e.jsx("option",{value:R,children:R},R))})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8},children:[e.jsx(Qt,{lbl:"Precio unitario",type:"number",val:d.precio,on:R=>l({...d,precio:+R.target.value})}),e.jsx(Qt,{lbl:"Stock actual",type:"number",val:d.stockActual,on:R=>l({...d,stockActual:+R.target.value})}),e.jsx(Qt,{lbl:"Stock mnimo",type:"number",val:d.stockMinimo,on:R=>l({...d,stockMinimo:+R.target.value})}),e.jsx(Qt,{lbl:"Vida til (meses)",type:"number",val:d.vidaUtil,on:R=>l({...d,vidaUtil:+R.target.value})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Pe.inkLight,marginBottom:3,textTransform:"uppercase",letterSpacing:1},children:"Proveedor principal"}),e.jsxs("select",{value:d.proveedorId||"",onChange:R=>l({...d,proveedorId:R.target.value}),style:{width:"100%",padding:"6px 10px",border:`1px solid ${Pe.border}`,borderRadius:3,fontSize:12,fontFamily:"'DM Sans',sans-serif",background:Pe.bg},children:[e.jsx("option",{value:"",children:" Sin asignar "}),o.map(R=>e.jsx("option",{value:R.id,children:R.nombre},R.id))]})]}),(d.familia==="epp"||d.familia==="dotacion")&&e.jsxs("div",{style:{marginBottom:8,background:Pe.warningBg,borderRadius:4,padding:"8px 10px"},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:600,color:Pe.warning,marginBottom:4,textTransform:"uppercase",letterSpacing:1},children:"Asociar a cargos (para clculo en APU)"}),e.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:[J.filter(R=>R.activo!==!1).map(R=>{const T=(d.cargosAsociados||[]).includes(R.id);return e.jsxs("button",{onClick:()=>{const W=d.cargosAsociados||[];l({...d,cargosAsociados:T?W.filter(X=>X!==R.id):[...W,R.id],asociadoACargo:!0})},style:{padding:"3px 8px",fontSize:10,cursor:"pointer",border:`1px solid ${T?Pe.warning:Pe.border}`,borderRadius:3,background:T?Pe.warning+"25":"#fff",color:T?Pe.warning:Pe.inkMid,fontFamily:"'DM Sans',sans-serif",fontWeight:T?600:400},children:[T?" ":"",R.nombre]},R.id)}),J.filter(R=>R.activo!==!1).length===0&&e.jsx("span",{style:{fontSize:10,color:Pe.inkLight},children:"Sin cargos en RRHH."})]})]}),e.jsx(Qt,{lbl:"Notas",val:d.notas,on:R=>l({...d,notas:R.target.value}),ph:"Observaciones..."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(Bo,{on:()=>B(d),style:{flex:1},children:[e.jsx(yt,{size:12})," Guardar"]}),e.jsx(Bo,{v:"sec",on:()=>{S(!1),l(null)},style:{flex:1},children:"Cancelar"})]})]})}),x&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>y(null),children:e.jsxs("div",{onClick:R=>R.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(_n,{t:"Proveedor",s:"Datos del proveedor"}),e.jsx(Qt,{lbl:"Nombre / Empresa",val:x.nombre,on:R=>y({...x,nombre:R.target.value}),ph:"Nombre"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Qt,{lbl:"NIT / CIF",val:x.nit,on:R=>y({...x,nit:R.target.value}),ph:"NIT"}),e.jsx(Qt,{lbl:"Ciudad",val:x.ciudad,on:R=>y({...x,ciudad:R.target.value}),ph:"Ciudad"})]}),e.jsx(Qt,{lbl:"Contacto",val:x.contacto,on:R=>y({...x,contacto:R.target.value}),ph:"Persona de contacto"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[e.jsx(Qt,{lbl:"Telfono",val:x.telefono,on:R=>y({...x,telefono:R.target.value}),ph:"+57..."}),e.jsx(Qt,{lbl:"Email",val:x.email,on:R=>y({...x,email:R.target.value}),ph:"email@..."})]}),e.jsx(Qt,{lbl:"Especialidad",val:x.especialidad,on:R=>y({...x,especialidad:R.target.value}),ph:"Ej: EPPs, ferretera, elctricos"}),e.jsx(Qt,{lbl:"Notas",val:x.notas,on:R=>y({...x,notas:R.target.value}),ph:"Observaciones"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs(Bo,{on:()=>q(x),style:{flex:1},children:[e.jsx(yt,{size:12})," Guardar"]}),e.jsx(Bo,{v:"sec",on:()=>y(null),style:{flex:1},children:"Cancelar"})]})]})})]})]}):e.jsx("div",{style:{padding:40,textAlign:"center",color:Pe.inkLight},children:"Cargando..."})}const $f=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #F5F4F1; -webkit-font-smoothing: antialiased; }
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #C8C5BE; border-radius: 2px; }
    input, select, textarea { font-family: 'DM Sans', sans-serif; outline: none; }
    button { font-family: 'DM Sans', sans-serif; cursor: pointer; }
    @keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    .fade-up { animation: fadeUp .22s ease both; }
  `}),Ce={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111111",inkMid:"#555555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.05)"},Xa=()=>Math.random().toString(36).slice(2,9),pr=()=>new Date().toISOString(),Pf=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",Of=t=>t?new Date(t).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"}):"",gs=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"",dc=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/6e4);if(o<60)return`hace ${o}m`;const n=Math.floor(o/60);return n<24?`hace ${n}h`:`hace ${Math.floor(n/24)}d`};function Nl(t,i){const[o,n]=F.useState(i),[s,r]=F.useState(!1);F.useEffect(()=>{(()=>{try{const u=Fe.getSync(t);u!=null&&u.value&&n(JSON.parse(u))}catch{}r(!0)})()},[t]);const a=F.useCallback(async u=>{const h=typeof u=="function"?u(o):u;n(h);try{Fe.set(t,JSON.stringify(h))}catch{}},[t,o]);return[o,a,s]}const jn=[{id:"ofertas",label:"Ofertas / CRM",icon:Cn,color:"#111111",desc:"Presupuestos y propuestas comerciales"},{id:"compras",label:"Compras / Insumos",icon:wn,color:"#0D5E6E",desc:"rdenes de compra y contratos proveedores"},{id:"rrhh",label:"RRHH",icon:Ri,color:"#3B3B3B",desc:"Contrataciones, vacaciones y novedades"},{id:"pagos",label:"Pagos / Tesorera",icon:xr,color:"#8C6A00",desc:"Pagos a proveedores, anticipos y facturas"},{id:"subcontratos",label:"Subcontratos",icon:zo,color:"#5B3A8C",desc:"Contratos con subcontratistas"},{id:"calidad",label:"Calidad / SST",icon:zn,color:"#B91C1C",desc:"No conformidades, inspecciones y permisos"}],Ul={pendiente:{label:"Pendiente",color:Ce.amber,bg:Ce.amberBg,icon:ys},aprobado:{label:"Aprobado",color:Ce.green,bg:Ce.greenBg,icon:Vo},rechazado:{label:"Rechazado",color:Ce.red,bg:Ce.redBg,icon:Lc},devuelto:{label:"Devuelto",color:"#D4840A",bg:"#FFF3E0",icon:vd}},Gs=[{id:"dashboard",lbl:"Dashboard",I:vs,desc:"Resumen general de aprobaciones"},{id:"ofertas",lbl:"Ofertas",I:Cn,desc:"Aprobaciones de presupuestos y propuestas"},{id:"compras",lbl:"Compras",I:wn,desc:"rdenes de compra y contratos"},{id:"rrhh",lbl:"RRHH",I:Ri,desc:"Contrataciones y novedades"},{id:"pagos",lbl:"Pagos",I:xr,desc:"Pagos y tesorera"},{id:"subcontratos",lbl:"Subcontratos",I:zo,desc:"Contratos subcontratistas"},{id:"calidad",lbl:"Calidad / SST",I:zn,desc:"No conformidades e inspecciones"},{id:"config",lbl:"Configuracin",I:yd,desc:"Cadenas de aprobacin y umbrales"}],Wi=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Ce.surface,border:`1px solid ${Ce.border}`,borderRadius:8,boxShadow:Ce.shadow,...i},...o,children:t}),cc=({estado:t})=>{const i=Ul[t]||Ul.pendiente,o=i.icon;return e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:4,background:i.bg,color:i.color,fontSize:10,fontWeight:700},children:[e.jsx(o,{size:11})," ",i.label]})},Hi=({children:t,v:i,sm:o,on:n,style:s,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Ce.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?Ce.redBg:Ce.ink,color:i==="sec"?Ce.inkMid:i==="danger"?Ce.red:"#fff",...s},...r,children:t});function Lf({pais:t="CO"}){var l,x;const[i,o]=F.useState("dashboard"),[n,s,r]=Nl("hab:aprobaciones:items",[]),[a,u,h]=Nl("hab:aprobaciones:config",{usuarios:[{id:"david",nombre:"David Parra Galera",cargo:"Director Ejecutivo",email:"david@habitaris.co",nivel:1,avatar:""},{id:"ana",nombre:"Ana Mara Daz Buitrago",cargo:"Directora Creativa",email:"ana@habitaris.co",nivel:1,avatar:""},{id:"residente",nombre:"Residente de obra",cargo:"Residente",email:"residente@habitaris.co",nivel:2,avatar:""},{id:"admin",nombre:"Coordinador Administrativo",cargo:"Admin",email:"admin@habitaris.co",nivel:3,avatar:""}],cadenas:{ofertas:{aprobadores:["david","ana"],umbral:0,umbralAlto:5e7,aprobadorAlto:"david"},compras:{aprobadores:["residente"],umbral:5e6,aprobadorAlto:"david",umbralAlto:2e7},rrhh:{aprobadores:["david","ana"],umbral:0},pagos:{aprobadores:["david"],umbral:0,umbralAlto:1e7,aprobadorAlto:"david"},subcontratos:{aprobadores:["david"],umbral:1e7,aprobadorAlto:"david"},calidad:{aprobadores:["residente","david"],umbral:0}},notificaciones:!0}),[b,j]=F.useState("david"),[C,v]=F.useState([]);F.useEffect(()=>{(()=>{try{const y=Fe.getSync("hab:crm:ofertas");y!=null&&y.value&&v(JSON.parse(y)||[])}catch{}})()},[]);const m=y=>{const g={id:Xa(),fecha:pr(),estado:"pendiente",historial:[],...y};return s(S=>[...S,g]),g},f=(y,g,S="")=>{s(A=>A.map(E=>{var I;return E.id!==y?E:{...E,estado:g==="aprobar"?"aprobado":g==="rechazar"?"rechazado":"devuelto",historial:[...E.historial||[],{accion:g,fecha:pr(),por:b,porNombre:((I=a.usuarios.find(z=>z.id===b))==null?void 0:I.nombre)||b,comentario:S}]}}))},p=F.useMemo(()=>{const y=n.filter(I=>I.estado==="pendiente"),g=y.filter(I=>{var B;const z=a.cadenas[I.modulo];return(B=z==null?void 0:z.aprobadores)==null?void 0:B.includes(b)}),S=n.filter(I=>I.estado==="aprobado"),A=n.filter(I=>I.estado==="rechazado"),E=n.filter(I=>I.estado==="devuelto"),w={};return jn.forEach(I=>{w[I.id]={total:n.filter(z=>z.modulo===I.id).length,pendientes:n.filter(z=>z.modulo===I.id&&z.estado==="pendiente").length}}),{pendientes:y.length,misPendientes:g.length,aprobados:S.length,rechazados:A.length,devueltos:E.length,byModule:w,total:n.length}},[n,b,a]),c=y=>n.filter(g=>g.modulo===y),d={border:`1px solid ${Ce.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx($f,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Ce.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Ce.surface,borderBottom:`1px solid ${Ce.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Ce.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Ce.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Ce.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Ce.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase",color:Ce.ink},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Ce.inkLight,marginLeft:10},children:"/ Aprobaciones"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p.misPendientes>0&&e.jsxs("div",{style:{background:Ce.amberBg,border:`1px solid ${Ce.amber}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(bs,{size:12,color:Ce.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:Ce.amber},children:[p.misPendientes," pendiente",p.misPendientes!==1?"s":""]})]}),e.jsx("select",{value:b,onChange:y=>j(y.target.value),style:{...d,fontSize:11,fontWeight:600,padding:"5px 8px",minWidth:160},children:a.usuarios.map(y=>e.jsxs("option",{value:y.id,children:[y.avatar," ",y.nombre]},y.id))})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:Ce.surface,borderRight:`1px solid ${Ce.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[Gs.map(y=>{const g=i===y.id,S=p.byModule[y.id],A=(S==null?void 0:S.pendientes)||0;return e.jsxs("button",{onClick:()=>o(y.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:g?`3px solid ${Ce.ink}`:"3px solid transparent",background:g?Ce.accent:"transparent",color:g?Ce.ink:Ce.inkLight,fontSize:12,fontWeight:g?700:400,cursor:"pointer",textAlign:"left",width:"100%",transition:"all .1s"},children:[e.jsx(y.I,{size:13,style:{flexShrink:0}}),e.jsx("span",{style:{flex:1,lineHeight:1.2},children:y.lbl}),A>0&&y.id!=="dashboard"&&y.id!=="config"&&e.jsx("span",{style:{background:Ce.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:A})]},y.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:Ce.inkXLight,letterSpacing:.8,borderTop:`1px solid ${Ce.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:Ce.ink,letterSpacing:-.2},children:(l=Gs.find(y=>y.id===i))==null?void 0:l.lbl}),e.jsx("p",{style:{fontSize:11,color:Ce.inkLight,marginTop:2},children:(x=Gs.find(y=>y.id===i))==null?void 0:x.desc})]}),i==="dashboard"&&e.jsx(Wf,{stats:p,aprobaciones:n,config:a,usuarioActivo:b,actuar:f,setTab:o,ofertas:C}),i==="config"&&e.jsx(Uf,{config:a,saveConfig:u}),["ofertas","compras","rrhh","pagos","subcontratos","calidad"].includes(i)&&e.jsx(Nf,{modulo:i,items:c(i),config:a,usuarioActivo:b,actuar:f,addAprobacion:m,ofertas:C})]})})]})]})]})}function Wf({stats:t,aprobaciones:i,config:o,usuarioActivo:n,actuar:s,setTab:r,ofertas:a}){const u=i.filter(j=>{var v;if(j.estado!=="pendiente")return!1;const C=o.cadenas[j.modulo];return(v=C==null?void 0:C.aprobadores)==null?void 0:v.includes(n)}).sort((j,C)=>C.fecha>j.fecha?1:-1),h=[...i].sort((j,C)=>C.fecha>j.fecha?1:-1).slice(0,10),b=o.usuarios.find(j=>j.id===n);return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{label:"Mis pendientes",val:t.misPendientes,color:Ce.amber,bg:Ce.amberBg},{label:"Total pendientes",val:t.pendientes,color:"#D4840A",bg:"#FFF3E0"},{label:"Aprobadas",val:t.aprobados,color:Ce.green,bg:Ce.greenBg},{label:"Rechazadas",val:t.rechazados,color:Ce.red,bg:Ce.redBg},{label:"Devueltas",val:t.devueltos,color:Ce.blue,bg:Ce.blueBg}].map(j=>e.jsxs(Wi,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",letterSpacing:1},children:j.label}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:j.color,marginTop:4},children:j.val})]},j.label))}),e.jsx(Wi,{style:{padding:"16px 20px",marginBottom:16,background:Ce.greenBg,border:`1px solid ${Ce.green}33`},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("span",{style:{fontSize:28},children:(b==null?void 0:b.avatar)||""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Ce.green},children:(b==null?void 0:b.nombre)||"Usuario"}),e.jsxs("div",{style:{fontSize:11,color:Ce.inkMid},children:[b==null?void 0:b.cargo,"  ",Object.entries(o.cadenas).filter(([,j])=>{var C;return(C=j.aprobadores)==null?void 0:C.includes(n)}).map(([j])=>j).join(", ")||"Sin mdulos asignados"]})]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs(Wi,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",background:Ce.amberBg,borderBottom:`1px solid ${Ce.border}`},children:e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:Ce.amber,display:"flex",alignItems:"center",gap:6},children:[e.jsx(ys,{size:13})," Mis pendientes (",u.length,")"]})}),e.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:u.length===0?e.jsxs("div",{style:{padding:24,textAlign:"center",color:Ce.inkLight,fontSize:12},children:[e.jsx(Vo,{size:24,style:{marginBottom:8,opacity:.3}}),e.jsx("div",{children:"Sin aprobaciones pendientes "})]}):u.map(j=>e.jsx(pc,{item:j,actuar:s,config:o,usuarioActivo:n,compact:!0,ofertas:a},j.id))})]}),e.jsxs(Wi,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",background:Ce.blueBg,borderBottom:`1px solid ${Ce.border}`},children:e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:Ce.blue,display:"flex",alignItems:"center",gap:6},children:[e.jsx(Sn,{size:13})," Por mdulo"]})}),jn.map(j=>{const C=t.byModule[j.id]||{},v=j.icon;return e.jsxs("div",{onClick:()=>r(j.id),style:{padding:"10px 16px",borderBottom:`1px solid ${Ce.border}`,cursor:"pointer",display:"flex",alignItems:"center",gap:10,transition:"background .1s"},onMouseEnter:m=>m.currentTarget.style.background=Ce.surfaceAlt,onMouseLeave:m=>m.currentTarget.style.background="transparent",children:[e.jsx("div",{style:{width:28,height:28,borderRadius:6,background:j.color+"15",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(v,{size:14,color:j.color})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600},children:j.label}),e.jsxs("div",{style:{fontSize:9,color:Ce.inkLight},children:[C.total||0," total"]})]}),C.pendientes>0&&e.jsx("span",{style:{background:Ce.amber,color:"#fff",fontSize:9,fontWeight:800,padding:"2px 7px",borderRadius:10},children:C.pendientes}),e.jsx(Xi,{size:12,color:Ce.inkLight})]},j.id)})]})]}),h.length>0&&e.jsxs(Wi,{style:{marginTop:16,padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${Ce.border}`},children:e.jsx("div",{style:{fontSize:12,fontWeight:700,color:Ce.ink},children:"Actividad reciente"})}),h.map(j=>{const C=(j.historial||[]).slice(-1)[0],v=jn.find(m=>m.id===j.modulo);return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11},children:[e.jsx(cc,{estado:j.estado}),e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:600},children:j.titulo||j.referencia||"Sin ttulo"}),e.jsx("span",{style:{color:Ce.inkLight,marginLeft:6,fontSize:9},children:v==null?void 0:v.label})]}),j.monto>0&&e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,color:Ce.inkMid},children:["$",gs(j.monto)]}),e.jsx("span",{style:{fontSize:9,color:Ce.inkLight},children:dc((C==null?void 0:C.fecha)||j.fecha)})]},j.id)})]}),i.length===0&&e.jsxs(Wi,{style:{padding:30,textAlign:"center",marginTop:16},children:[e.jsx(zn,{size:36,style:{color:Ce.inkLight,opacity:.3,marginBottom:12}}),e.jsx("div",{style:{fontSize:14,fontWeight:600,color:Ce.inkMid,marginBottom:6},children:"Sin aprobaciones registradas"}),e.jsx("div",{style:{fontSize:11,color:Ce.inkLight,marginBottom:16},children:"Las aprobaciones se generan desde cada mdulo (Ofertas, Compras, etc.) o puedes crear una demo."}),e.jsxs(Hi,{on:()=>{[{modulo:"ofertas",titulo:"OF-2026-001  Apto 301 Torre Norte",referencia:"OF-2026-001",monto:85e6,solicitante:"ana",tipo:"Presupuesto de ejecucin"},{modulo:"ofertas",titulo:"OF-2026-002  Diseo interior Oficinas",referencia:"OF-2026-002",monto:25e6,solicitante:"david",tipo:"Propuesta de diseo"},{modulo:"compras",titulo:"OC-001  Cemento y acero",referencia:"OC-001",monto:125e5,solicitante:"residente",tipo:"Orden de compra"},{modulo:"compras",titulo:"OC-002  Pisos porcelanato 60x60",referencia:"OC-002",monto:82e5,solicitante:"residente",tipo:"Orden de compra"},{modulo:"pagos",titulo:"PAG-001  Anticipo Ferretera El Tornillo",referencia:"PAG-001",monto:6e6,solicitante:"admin",tipo:"Pago a proveedor"},{modulo:"subcontratos",titulo:"SC-001  Instalaciones elctricas",referencia:"SC-001",monto:18e6,solicitante:"residente",tipo:"Subcontrato"},{modulo:"rrhh",titulo:"Contratacin auxiliar de obra",referencia:"RRHH-001",monto:28e5,solicitante:"residente",tipo:"Nueva contratacin"},{modulo:"calidad",titulo:"NC-001  Fisura en paete fachada",referencia:"NC-001",monto:0,solicitante:"residente",tipo:"No conformidad"}].forEach(C=>{const v=o.usuarios.find(m=>m.id===C.solicitante);saveAprobaciones(m=>[...m,{id:Xa(),fecha:pr(),estado:"pendiente",historial:[{accion:"solicitar",fecha:pr(),por:C.solicitante,porNombre:(v==null?void 0:v.nombre)||C.solicitante,comentario:""}],...C}])})},children:[e.jsx(Ne,{size:12})," Crear datos de ejemplo"]})]})]})}function pc({item:t,actuar:i,config:o,usuarioActivo:n,compact:s,ofertas:r}){var m,f,p,c;const[a,u]=F.useState(!1),[h,b]=F.useState(""),j=t.estado==="pendiente"&&((f=(m=o.cadenas[t.modulo])==null?void 0:m.aprobadores)==null?void 0:f.includes(n)),C=jn.find(d=>d.id===t.modulo),v=d=>{if(d!=="aprobar"&&!h.trim()){alert("Escribe un comentario");return}i(t.id,d,h),b(""),u(!1)};return e.jsxs("div",{style:{borderBottom:`1px solid ${Ce.border}`},children:[e.jsxs("div",{onClick:()=>u(!a),style:{padding:s?"8px 16px":"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,transition:"background .1s",background:a?Ce.surfaceAlt:"transparent"},onMouseEnter:d=>{a||(d.currentTarget.style.background="#FFFFFF")},onMouseLeave:d=>{a||(d.currentTarget.style.background="transparent")},children:[!s&&C&&e.jsx("div",{style:{width:24,height:24,borderRadius:4,background:C.color+"15",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(C.icon,{size:12,color:C.color})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.titulo||t.referencia||"Sin ttulo"}),e.jsxs("div",{style:{fontSize:9,color:Ce.inkLight,marginTop:1},children:[t.tipo||""," ",t.solicitante&&` por ${((c=(p=o.usuarios.find(d=>d.id===t.solicitante))==null?void 0:p.nombre)==null?void 0:c.split(" ")[0])||t.solicitante}`]})]}),t.monto>0&&e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:600,color:Ce.inkMid,flexShrink:0},children:["$",gs(t.monto)]}),e.jsx(cc,{estado:t.estado}),e.jsx("span",{style:{fontSize:9,color:Ce.inkLight,flexShrink:0},children:dc(t.fecha)}),a?e.jsx(kn,{size:12,color:Ce.inkLight}):e.jsx(Xi,{size:12,color:Ce.inkLight})]}),a&&e.jsxs("div",{style:{padding:"0 16px 14px",background:Ce.surfaceAlt},children:[(t.historial||[]).length>0&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Historial"}),(t.historial||[]).map((d,l)=>e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${Ce.border}`,paddingLeft:10,marginLeft:4},children:[e.jsxs("span",{style:{color:Ce.inkLight,minWidth:60},children:[Pf(d.fecha)," ",Of(d.fecha)]}),e.jsx("span",{style:{fontWeight:600},children:d.porNombre||d.por}),e.jsx("span",{style:{color:Ce.inkMid},children:d.accion==="solicitar"?"solicit aprobacin":d.accion==="aprobar"?" aprob":d.accion==="rechazar"?" rechaz":d.accion==="devolver"?" devolvi":d.accion}),d.comentario&&e.jsxs("span",{style:{color:Ce.amber,fontStyle:"italic"},children:[" ",d.comentario]})]},l))]}),j&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("input",{value:h,onChange:d=>b(d.target.value),placeholder:"Comentario (obligatorio para rechazar/devolver)...",style:{width:"100%",padding:"6px 10px",border:`1px solid ${Ce.border}`,borderRadius:4,fontSize:11,marginBottom:8,background:"#fff"}}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(Hi,{sm:!0,on:()=>v("aprobar"),children:[e.jsx(yt,{size:11})," Aprobar"]}),e.jsxs(Hi,{sm:!0,v:"sec",on:()=>v("devolver"),style:{color:Ce.amber,borderColor:Ce.amber+"44"},children:[e.jsx(vd,{size:11})," Devolver"]}),e.jsxs(Hi,{sm:!0,v:"danger",on:()=>v("rechazar"),children:[e.jsx(Ot,{size:11})," Rechazar"]})]})]})]})]})}function Nf({modulo:t,items:i,config:o,usuarioActivo:n,actuar:s,addAprobacion:r,ofertas:a}){const[u,h]=F.useState("todos"),[b,j]=F.useState(""),[C,v]=F.useState(!1),[m,f]=F.useState({titulo:"",referencia:"",monto:0,tipo:""}),p=jn.find(g=>g.id===t),c=i.filter(g=>!(u!=="todos"&&g.estado!==u||b&&!(g.titulo||"").toLowerCase().includes(b.toLowerCase())&&!(g.referencia||"").toLowerCase().includes(b.toLowerCase()))).sort((g,S)=>S.fecha>g.fecha?1:-1),d=i.filter(g=>g.estado==="pendiente").length,l=()=>{var g;m.titulo.trim()&&(r({modulo:t,titulo:m.titulo,referencia:m.referencia,monto:parseFloat(m.monto)||0,tipo:m.tipo,solicitante:n,historial:[{accion:"solicitar",fecha:pr(),por:n,porNombre:((g=o.usuarios.find(S=>S.id===n))==null?void 0:g.nombre)||n,comentario:""}]}),f({titulo:"",referencia:"",monto:0,tipo:""}),v(!1))},x=o.cadenas[t]||{},y=(x.aprobadores||[]).map(g=>o.usuarios.find(S=>S.id===g)).filter(Boolean);return e.jsxs("div",{className:"fade-up",children:[e.jsx(Wi,{style:{padding:"14px 18px",marginBottom:14,background:(p==null?void 0:p.color)+"08",border:`1px solid ${p==null?void 0:p.color}22`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p&&e.jsx(p.icon,{size:18,color:p.color}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:Ce.ink},children:p==null?void 0:p.label}),e.jsxs("div",{style:{fontSize:10,color:Ce.inkMid},children:[i.length," total  ",d," pendientes  Aprobadores: ",y.map(g=>g.nombre.split(" ")[0]).join(", ")||"Sin configurar",x.umbral>0&&`  Umbral: $${gs(x.umbral)}`]})]})]}),e.jsxs(Hi,{sm:!0,on:()=>v(!0),children:[e.jsx(Ne,{size:11})," Nueva solicitud"]})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["todos","Todos"],["pendiente","Pendientes"],["aprobado","Aprobados"],["rechazado","Rechazados"],["devuelto","Devueltos"]].map(([g,S],A,E)=>e.jsxs("button",{onClick:()=>h(g),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${Ce.border}`,borderLeft:A>0?"none":void 0,borderRadius:A===0?"4px 0 0 4px":A===E.length-1?"0 4px 4px 0":"0",background:u===g?Ce.ink:"#fff",color:u===g?"#fff":Ce.inkMid},children:[S," ",g==="pendiente"&&d>0?`(${d})`:""]},g))}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ki,{size:12,style:{position:"absolute",left:8,top:8,color:Ce.inkLight}}),e.jsx("input",{value:b,onChange:g=>j(g.target.value),placeholder:"Buscar...",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"6px 10px",fontSize:11,background:"#fff",paddingLeft:26,width:200}})]})]}),e.jsx(Wi,{style:{padding:0,overflow:"hidden"},children:c.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:Ce.inkLight,fontSize:12},children:["Sin aprobaciones ",u!=="todos"?`con estado "${u}"`:""," en ",p==null?void 0:p.label]}):c.map(g=>e.jsx(pc,{item:g,actuar:s,config:o,usuarioActivo:n,ofertas:a},g.id))}),C&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>v(!1),children:e.jsxs("div",{onClick:g=>g.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,marginBottom:4},children:"Nueva solicitud de aprobacin"}),e.jsxs("div",{style:{fontSize:11,color:Ce.inkLight,marginBottom:16},children:["Mdulo: ",p==null?void 0:p.label]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Ttulo / Descripcin"}),e.jsx("input",{value:m.titulo,onChange:g=>f({...m,titulo:g.target.value}),placeholder:"Ej: Orden de compra acero corrugado",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Referencia"}),e.jsx("input",{value:m.referencia,onChange:g=>f({...m,referencia:g.target.value}),placeholder:"OC-001",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Monto"}),e.jsx("input",{type:"number",value:m.monto||"",onChange:g=>f({...m,monto:g.target.value}),placeholder:"0",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%",fontFamily:"'DM Mono',monospace"}})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Tipo de solicitud"}),e.jsx("input",{value:m.tipo,onChange:g=>f({...m,tipo:g.target.value}),placeholder:"Ej: Orden de compra, Pago, Contrato...",style:{border:`1px solid ${Ce.border}`,borderRadius:4,padding:"8px 10px",fontSize:12,background:"#fff",width:"100%"}})]}),e.jsxs("div",{style:{background:Ce.surfaceAlt,borderRadius:4,padding:"8px 12px",fontSize:10,color:Ce.inkMid,marginBottom:12},children:[" Aprobadores configurados: ",e.jsx("strong",{children:y.map(g=>g.nombre.split(" ")[0]).join(", ")||"Ninguno"}),x.umbral>0&&e.jsxs("span",{children:["  Umbral auto: ",e.jsxs("strong",{children:["$",gs(x.umbral)]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs(Hi,{on:l,style:{flex:1},children:[e.jsx(ba,{size:11})," Solicitar aprobacin"]}),e.jsx(Hi,{v:"sec",on:()=>v(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function Uf({config:t,saveConfig:i}){F.useState(null);const[o,n]=F.useState({nombre:"",cargo:"",email:"",nivel:3,avatar:""}),[s,r]=F.useState(!1),a=(C,v,m)=>{i(f=>({...f,cadenas:{...f.cadenas,[C]:{...f.cadenas[C],[v]:m}}}))},u=(C,v)=>{const f=(t.cadenas[C]||{}).aprobadores||[],p=f.includes(v)?f.filter(c=>c!==v):[...f,v];a(C,"aprobadores",p)},h=()=>{o.nombre.trim()&&(i(C=>({...C,usuarios:[...C.usuarios,{...o,id:Xa()}]})),n({nombre:"",cargo:"",email:"",nivel:3,avatar:""}),r(!1))},b=C=>{i(v=>({...v,usuarios:v.usuarios.filter(m=>m.id!==C),cadenas:Object.fromEntries(Object.entries(v.cadenas).map(([m,f])=>[m,{...f,aprobadores:(f.aprobadores||[]).filter(p=>p!==C)}]))}))},j={border:`1px solid ${Ce.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs("div",{className:"fade-up",children:[e.jsxs(Wi,{style:{padding:18,marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Ce.ink},children:"Usuarios aprobadores"}),e.jsx("div",{style:{fontSize:10,color:Ce.inkLight},children:"Personas que participan en cadenas de aprobacin"})]}),e.jsxs(Hi,{sm:!0,on:()=>r(!0),children:[e.jsx(Ne,{size:11})," Aadir usuario"]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:10},children:t.usuarios.map(C=>e.jsxs("div",{style:{border:`1px solid ${Ce.border}`,borderRadius:6,padding:"10px 14px",background:Ce.surfaceAlt},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:20},children:C.avatar}),e.jsx("button",{onClick:()=>b(C.id),style:{background:"none",border:"none",cursor:"pointer",color:Ce.red,padding:2},children:e.jsx(Je,{size:11})})]}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:C.nombre}),e.jsx("div",{style:{fontSize:10,color:Ce.inkMid},children:C.cargo}),e.jsx("div",{style:{fontSize:9,color:Ce.inkLight,marginTop:2},children:C.email}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase"},children:"Nivel:"}),[1,2,3].map(v=>e.jsx("button",{onClick:()=>i(m=>({...m,usuarios:m.usuarios.map(f=>f.id===C.id?{...f,nivel:v}:f)})),style:{width:20,height:20,borderRadius:"50%",border:`1px solid ${C.nivel===v?Ce.green:Ce.border}`,background:C.nivel===v?Ce.greenBg:"#fff",color:C.nivel===v?Ce.green:Ce.inkLight,fontSize:9,fontWeight:700,cursor:"pointer"},children:v},v))]})]},C.id))})]}),e.jsxs(Wi,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:Ce.ink,marginBottom:4},children:"Cadenas de aprobacin por mdulo"}),e.jsx("div",{style:{fontSize:10,color:Ce.inkLight,marginBottom:14},children:"Define quin aprueba en cada mdulo y los umbrales de monto. Si el monto supera el umbral alto, se requiere el aprobador de nivel superior."}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:Ce.surfaceAlt},children:[e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",letterSpacing:.5,borderBottom:`2px solid ${Ce.border}`},children:"Mdulo"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Ce.border}`},children:"Aprobadores"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"right",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Ce.border}`,width:120},children:"Umbral estndar"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"right",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Ce.border}`,width:120},children:"Umbral alto"}),e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",borderBottom:`2px solid ${Ce.border}`,width:140},children:"Aprobador nivel alto"})]})}),e.jsx("tbody",{children:jn.map(C=>{const v=t.cadenas[C.id]||{},m=C.icon;return e.jsxs("tr",{style:{borderBottom:`1px solid ${Ce.border}`},children:[e.jsx("td",{style:{padding:"10px 12px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(m,{size:14,color:C.color}),e.jsx("span",{style:{fontSize:12,fontWeight:600},children:C.label})]})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:t.usuarios.map(f=>{const p=(v.aprobadores||[]).includes(f.id);return e.jsxs("button",{onClick:()=>u(C.id,f.id),style:{padding:"3px 8px",fontSize:9,fontWeight:600,borderRadius:4,cursor:"pointer",border:`1px solid ${p?Ce.green:Ce.border}`,background:p?Ce.greenBg:"#fff",color:p?Ce.green:Ce.inkLight},children:[p?e.jsx(jd,{size:8,style:{marginRight:3}}):e.jsx(Oc,{size:8,style:{marginRight:3}}),f.nombre.split(" ")[0]]},f.id)})})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("input",{type:"number",value:v.umbral||"",placeholder:"0",onChange:f=>a(C.id,"umbral",parseFloat(f.target.value)||0),style:{...j,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10}})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("input",{type:"number",value:v.umbralAlto||"",placeholder:"0",onChange:f=>a(C.id,"umbralAlto",parseFloat(f.target.value)||0),style:{...j,width:"100%",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10}})}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsxs("select",{value:v.aprobadorAlto||"",onChange:f=>a(C.id,"aprobadorAlto",f.target.value),style:{...j,width:"100%",fontSize:10},children:[e.jsx("option",{value:"",children:" Sin definir "}),t.usuarios.filter(f=>f.nivel<=1).map(f=>e.jsx("option",{value:f.id,children:f.nombre},f.id))]})})]},C.id)})})]})]}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:C=>C.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:400,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,marginBottom:12},children:"Nuevo usuario aprobador"}),[["nombre","Nombre completo","Ej: Carlos Rodrguez"],["cargo","Cargo","Ej: Residente de obra"],["email","Email","carlos@habitaris.co"]].map(([C,v,m])=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:v}),e.jsx("input",{value:o[C],onChange:f=>n({...o,[C]:f.target.value}),placeholder:m,style:{...j,width:"100%"}})]},C)),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Avatar"}),e.jsx("div",{style:{display:"flex",gap:4},children:["","","","","","","",""].map(C=>e.jsx("button",{onClick:()=>n({...o,avatar:C}),style:{width:28,height:28,borderRadius:4,cursor:"pointer",fontSize:16,border:`2px solid ${o.avatar===C?Ce.green:Ce.border}`,background:o.avatar===C?Ce.greenBg:"#fff"},children:C},C))})]}),e.jsxs("div",{style:{width:80},children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ce.inkLight,textTransform:"uppercase",marginBottom:3},children:"Nivel"}),e.jsxs("select",{value:o.nivel,onChange:C=>n({...o,nivel:+C.target.value}),style:{...j,width:"100%"},children:[e.jsx("option",{value:1,children:"1 (Director)"}),e.jsx("option",{value:2,children:"2 (Coordinador)"}),e.jsx("option",{value:3,children:"3 (Operativo)"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[e.jsxs(Hi,{on:h,style:{flex:1},children:[e.jsx(yt,{size:11})," Guardar"]}),e.jsx(Hi,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}const Vf=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'DM Sans',sans-serif;background:#F5F4F1;-webkit-font-smoothing:antialiased}
    ::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}
    input,select,textarea{font-family:'DM Sans',sans-serif;outline:none}
    button{font-family:'DM Sans',sans-serif;cursor:pointer}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .22s ease both}
  `}),De={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",purpleBg:"#F0ECF6",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Ks=()=>Math.random().toString(36).slice(2,9),$r=()=>new Date().toISOString().split("T")[0],Pr=(t,i)=>{const o=new Date(t);return o.setDate(o.getDate()+i),o.toISOString().split("T")[0]},Vl=(t,i)=>Math.round((new Date(i)-new Date(t))/864e5),Zo=t=>Math.min(100,Math.max(0,Math.round(t))),Js=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short"}):"";function Ys(t,i){const o="habitaris_proy",[n,s]=F.useState(()=>{try{const a=JSON.parse(Fe.getSync(o))||{};return a[t]!=null?a[t]:i}catch{return i}}),r=F.useCallback(a=>{const u=typeof a=="function"?a(n):a;s(u);try{const h=JSON.parse(Fe.getSync(o))||{};h[t]=u,Fe.set(o,JSON.stringify(h))}catch{}},[t,n]);return[n,r]}const ho=({children:t,style:i})=>e.jsx("div",{style:{background:De.surface,border:`1px solid ${De.border}`,borderRadius:8,boxShadow:De.shadow,...i},children:t}),Xs=({children:t,v:i,sm:o,on:n,style:s,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${De.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?De.redBg:De.ink,color:i==="sec"?De.inkMid:i==="danger"?De.red:"#fff",...s},...r,children:t}),qf=[{id:"dashboard",lbl:"Dashboard",I:Yi,desc:"KPIs y estado general"},{id:"gantt",lbl:"Cronograma",I:La,desc:"Diagrama de Gantt y programacin"},{id:"avances",lbl:"Avances",I:Yi,desc:"Registro de avance por actividad"},{id:"hitos",lbl:"Hitos",I:Sd,desc:"Hitos y entregables del proyecto"},{id:"tablero",lbl:"Tablero",I:Sn,desc:"Vista Kanban de tareas"},{id:"equipo",lbl:"Equipo",I:Ri,desc:"Asignacin de recursos"}];function Hf(){const[t,i]=F.useState("dashboard"),[o,n]=Ys("hab:proyectos:lista",[]),[s,r]=F.useState(null),[a,u]=Ys("hab:proyectos:actividades",[]),[h,b]=Ys("hab:proyectos:hitos",[]),j=o.find(g=>g.id===s),C=()=>{const g={id:Ks(),nombre:"Nuevo proyecto",inicio:$r(),fin:Pr($r(),90),estado:"activo",descripcion:"",color:De.purple};n(S=>[...S,g]),r(g.id)},v=(g,S)=>n(A=>A.map(E=>E.id===s?{...E,[g]:S}:E)),m=a.filter(g=>g.proyectoId===s),f=m.length>0?m.reduce((g,S)=>g+(S.avance||0),0)/m.length:0,p=()=>{const g={id:Ks(),proyectoId:s,nombre:"Nueva actividad",inicio:$r(),duracion:7,avance:0,responsable:"",predecessors:[],capitulo:""};u(S=>[...S,g])},c=(g,S,A)=>u(E=>E.map(w=>w.id===g?{...w,[S]:A}:w)),d=g=>u(S=>S.filter(A=>A.id!==g)),l=()=>{const g={id:Ks(),proyectoId:s,nombre:"Nuevo hito",fecha:$r(),completado:!1,descripcion:""};b(S=>[...S,g])},x=h.filter(g=>g.proyectoId===s),y={border:`1px solid ${De.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff",width:"100%"};return e.jsxs(e.Fragment,{children:[e.jsx(Vf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:De.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:De.surface,borderBottom:`1px solid ${De.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:De.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:De.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:De.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:De.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:De.inkLight,marginLeft:10},children:"/ Proyectos"})]})]}),j&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:12,fontWeight:600},children:j.nombre}),e.jsxs("span",{style:{fontSize:10,padding:"2px 8px",borderRadius:10,background:De.purpleBg,color:De.purple,fontWeight:700},children:[Zo(f),"%"]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:De.surface,borderRight:`1px solid ${De.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[e.jsxs("div",{style:{padding:"6px 12px 10px",borderBottom:`1px solid ${De.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase",letterSpacing:1,marginBottom:4},children:"Proyectos"}),o.map(g=>e.jsxs("button",{onClick:()=>r(g.id),style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",fontSize:11,fontWeight:s===g.id?700:400,border:"none",borderRadius:4,cursor:"pointer",marginBottom:2,background:s===g.id?De.purpleBg:"transparent",color:s===g.id?De.purple:De.inkMid},children:[" ",g.nombre]},g.id)),e.jsxs("button",{onClick:C,style:{display:"flex",alignItems:"center",gap:4,width:"100%",padding:"5px 10px",fontSize:10,border:`1px dashed ${De.border}`,borderRadius:4,background:"transparent",color:De.inkLight,marginTop:4},children:[e.jsx(Ne,{size:10})," Nuevo proyecto"]})]}),s&&qf.map(g=>{const S=t===g.id;return e.jsxs("button",{onClick:()=>i(g.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:S?`3px solid ${De.ink}`:"3px solid transparent",background:S?De.accent:"transparent",color:S?De.ink:De.inkLight,fontSize:12,fontWeight:S?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(g.I,{size:13})," ",g.lbl]},g.id)})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1200},children:s?e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs("div",{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Proyectos",o.length,"#111",`${o.filter(g=>g.estado==="activo").length} activos`],[" Avance global",`${Zo(f)}%`,f>=70?"#111111":f>=40?"#8C6A00":"#B91C1C",`${m.length} actividades`],[" Hitos",`${x.filter(g=>g.completado).length}/${x.length}`,"#3B3B3B",`${x.filter(g=>!g.completado).length} pendientes`],[" Actividades",m.length,"#111",j?`en ${j.nombre}`:""]].map(([g,S,A,E])=>e.jsxs(ho,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:g}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:A},children:S}),E&&e.jsx("div",{style:{fontSize:9,color:"#909090",marginTop:2},children:E})]},g))}),j&&e.jsxs(ho,{style:{marginBottom:12},children:[e.jsxs("div",{style:{fontSize:10,fontWeight:700,marginBottom:8},children:[" Avance  ",j.nombre]}),e.jsx("div",{style:{height:12,background:"#E0E0E0",borderRadius:6,overflow:"hidden",marginBottom:6},children:e.jsx("div",{style:{width:`${Zo(f)}%`,height:"100%",borderRadius:6,background:f>=70?"#111111":f>=40?"#8C6A00":"#B91C1C"}})}),e.jsxs("div",{style:{fontSize:9,color:"#909090"},children:["Inicio: ",j.inicio,"  Fin: ",j.fin,"  ",m.length," actividades"]})]})]}),t==="gantt"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:10,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Nombre del proyecto"}),e.jsx("input",{value:j.nombre,onChange:g=>v("nombre",g.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Inicio"}),e.jsx("input",{type:"date",value:j.inicio,onChange:g=>v("inicio",g.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Fin estimado"}),e.jsx("input",{type:"date",value:j.fin,onChange:g=>v("fin",g.target.value),style:y})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:De.inkLight,textTransform:"uppercase"},children:"Estado"}),e.jsxs("select",{value:j.estado,onChange:g=>v("estado",g.target.value),style:y,children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"pausado",children:"Pausado"}),e.jsx("option",{value:"finalizado",children:"Finalizado"})]})]})]}),e.jsxs(ho,{style:{padding:0,overflow:"hidden",marginBottom:16},children:[e.jsxs("div",{style:{padding:"10px 16px",borderBottom:`1px solid ${De.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Cronograma"}),e.jsxs(Xs,{sm:!0,on:p,children:[e.jsx(Ne,{size:10})," Actividad"]})]}),m.length===0?e.jsx("div",{style:{padding:30,textAlign:"center",color:De.inkLight,fontSize:12},children:"Sin actividades. Agrega la primera."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:800},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:De.surfaceAlt},children:["#","Actividad","Inicio","Dur.(das)","Fin","Avance %","Responsable",""].map(g=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:De.inkLight,textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:`2px solid ${De.border}`,whiteSpace:"nowrap"},children:g},g))})}),e.jsx("tbody",{children:m.map((g,S)=>{const A=Pr(g.inicio,g.duracion);return e.jsxs("tr",{style:{borderBottom:`1px solid ${De.border}`},children:[e.jsx("td",{style:{padding:"6px 10px",fontSize:10,color:De.inkLight},children:S+1}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:g.nombre,onChange:E=>c(g.id,"nombre",E.target.value),style:{border:"none",background:"transparent",fontSize:12,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:g.inicio,onChange:E=>c(g.id,"inicio",E.target.value),style:{border:`1px solid ${De.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"number",value:g.duracion,onChange:E=>c(g.id,"duracion",+E.target.value),style:{border:`1px solid ${De.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,width:50,textAlign:"center",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px",fontSize:10,color:De.inkMid,fontFamily:"'DM Mono',monospace"},children:Js(A)}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:De.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${g.avance||0}%`,background:g.avance>=100?De.green:De.purple,borderRadius:3,transition:"width .2s"}})}),e.jsx("input",{type:"number",value:g.avance||0,min:0,max:100,onChange:E=>c(g.id,"avance",Zo(+E.target.value)),style:{width:36,border:`1px solid ${De.border}`,borderRadius:3,padding:"2px 4px",fontSize:9,textAlign:"center",fontFamily:"'DM Mono',monospace",background:"#fff"}})]})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:g.responsable||"",onChange:E=>c(g.id,"responsable",E.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:11,width:100}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>d(g.id),style:{background:"none",border:"none",color:De.red,cursor:"pointer"},children:e.jsx(Je,{size:12})})})]},g.id)})})]})})]}),m.length>0&&e.jsxs(ho,{style:{padding:16,marginBottom:16},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:10},children:"Vista Gantt"}),(()=>{const g=m.reduce((E,w)=>w.inicio<E?w.inicio:E,m[0].inicio),S=m.reduce((E,w)=>{const I=Pr(w.inicio,w.duracion);return I>E?I:E},g),A=Math.max(Vl(g,S),1);return m.map(E=>{const I=Vl(g,E.inicio)/A*100,z=Math.max(E.duracion/A*100,2);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("div",{style:{width:120,fontSize:10,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:E.nombre}),e.jsx("div",{style:{flex:1,height:14,background:De.surfaceAlt,borderRadius:3,position:"relative",border:`1px solid ${De.border}`},children:e.jsx("div",{style:{position:"absolute",left:`${I}%`,width:`${z}%`,height:"100%",background:E.avance>=100?De.green:De.purple+"88",borderRadius:3},children:e.jsx("div",{style:{height:"100%",width:`${E.avance||0}%`,background:E.avance>=100?De.green:De.purple,borderRadius:3}})})}),e.jsxs("span",{style:{fontSize:9,fontFamily:"'DM Mono',monospace",color:De.inkLight,minWidth:30,textAlign:"right"},children:[E.avance||0,"%"]})]},E.id)})})()]}),e.jsxs(ho,{style:{padding:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Avance global del proyecto"}),e.jsxs("div",{style:{fontSize:10,color:De.inkLight},children:[m.length," actividades  ",m.filter(g=>g.avance>=100).length," completadas"]})]}),e.jsxs("div",{style:{fontSize:28,fontWeight:800,color:f>=100?De.green:De.purple},children:[Zo(f),"%"]})]}),e.jsx("div",{style:{height:8,background:De.border,borderRadius:4,marginTop:8,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${f}%`,background:f>=100?De.green:De.purple,borderRadius:4,transition:"width .3s"}})})]})]}),t==="avances"&&e.jsxs(ho,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Registro de avances"}),m.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:De.inkLight},children:"Agrega actividades primero en el Cronograma"}):m.map(g=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${De.border}`},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600},children:g.nombre}),e.jsxs("div",{style:{fontSize:9,color:De.inkLight},children:[g.responsable||"Sin asignar","  ",Js(g.inicio),"  ",Js(Pr(g.inicio,g.duracion))]})]}),e.jsxs("div",{style:{width:160,display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"range",min:0,max:100,value:g.avance||0,onChange:S=>c(g.id,"avance",+S.target.value),style:{flex:1,accentColor:De.purple}}),e.jsxs("span",{style:{fontSize:11,fontWeight:700,fontFamily:"'DM Mono',monospace",color:g.avance>=100?De.green:De.purple,minWidth:30},children:[g.avance||0,"%"]})]})]},g.id))]}),t==="hitos"&&e.jsxs(ho,{style:{padding:18},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"Hitos del proyecto"}),e.jsxs(Xs,{sm:!0,on:l,children:[e.jsx(Ne,{size:10})," Nuevo hito"]})]}),x.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:De.inkLight},children:"Sin hitos definidos"}):x.sort((g,S)=>g.fecha>S.fecha?1:-1).map(g=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${De.border}`},children:[e.jsx("button",{onClick:()=>b(S=>S.map(A=>A.id===g.id?{...A,completado:!A.completado}:A)),style:{width:24,height:24,borderRadius:"50%",border:`2px solid ${g.completado?De.green:De.border}`,background:g.completado?De.greenBg:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:g.completado&&e.jsx(yt,{size:12,color:De.green})}),e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:g.nombre,onChange:S=>b(A=>A.map(E=>E.id===g.id?{...E,nombre:S.target.value}:E)),style:{border:"none",background:"transparent",fontSize:13,fontWeight:600,width:"100%",textDecoration:g.completado?"line-through":"none",color:g.completado?De.inkLight:De.ink}})}),e.jsx("input",{type:"date",value:g.fecha,onChange:S=>b(A=>A.map(E=>E.id===g.id?{...E,fecha:S.target.value}:E)),style:{border:`1px solid ${De.border}`,borderRadius:3,padding:"3px 8px",fontSize:10,background:"#fff"}}),e.jsx(Sd,{size:12,color:g.completado?De.green:new Date(g.fecha)<new Date?De.red:De.amber}),e.jsx("button",{onClick:()=>b(S=>S.filter(A=>A.id!==g.id)),style:{background:"none",border:"none",color:De.red,cursor:"pointer"},children:e.jsx(Je,{size:12})})]},g.id))]}),t==="tablero"&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12},children:[{id:"pendiente",label:"Pendiente",color:De.inkLight,bg:De.surfaceAlt},{id:"en_curso",label:"En curso",color:De.blue,bg:De.blueBg},{id:"revision",label:"En revisin",color:De.amber,bg:De.amberBg},{id:"completado",label:"Completado",color:De.green,bg:De.greenBg}].map(g=>{const S=m.filter(A=>g.id==="completado"?A.avance>=100:g.id==="revision"?A.avance>=80&&A.avance<100:g.id==="en_curso"?A.avance>0&&A.avance<80:!A.avance||A.avance===0);return e.jsxs("div",{children:[e.jsxs("div",{style:{padding:"8px 12px",background:g.bg,borderRadius:"6px 6px 0 0",border:`1px solid ${De.border}`,borderBottom:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:11,fontWeight:700,color:g.color},children:g.label}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:g.color,background:g.color+"22",padding:"1px 6px",borderRadius:8},children:S.length})]}),e.jsx("div",{style:{border:`1px solid ${De.border}`,borderRadius:"0 0 6px 6px",minHeight:120,background:"#fff",padding:6},children:S.map(A=>e.jsxs("div",{style:{padding:"8px 10px",marginBottom:4,background:De.surfaceAlt,borderRadius:4,border:`1px solid ${De.border}`,fontSize:11},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:2},children:A.nombre}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:De.inkLight},children:[e.jsx("span",{children:A.responsable||""}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:[A.avance||0,"%"]})]})]},A.id))})]},g.id)})}),t==="equipo"&&e.jsxs(ho,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Asignacin de recursos"}),(()=>{const g=[...new Set(m.map(S=>S.responsable).filter(Boolean))];return g.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:De.inkLight},children:"Asigna responsables en las actividades del Cronograma"}):g.map(S=>{const A=m.filter(w=>w.responsable===S),E=A.reduce((w,I)=>w+(I.avance||0),0)/A.length;return e.jsxs("div",{style:{marginBottom:14,padding:"12px 16px",background:De.surfaceAlt,borderRadius:6,border:`1px solid ${De.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:700},children:[" ",S]}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:De.purple},children:[A.length," tareas  ",Zo(E),"% avance"]})]}),A.map(w=>e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",fontSize:10,padding:"3px 0"},children:[e.jsx("span",{style:{flex:1},children:w.nombre}),e.jsx("div",{style:{width:60,height:4,background:De.border,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${w.avance||0}%`,background:De.purple,borderRadius:2}})}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,minWidth:24,textAlign:"right"},children:[w.avance||0,"%"]})]},w.id))]},S)})})()]})]}):e.jsxs("div",{style:{textAlign:"center",padding:60,color:De.inkLight},children:[e.jsx(La,{size:40,style:{opacity:.3,marginBottom:12}}),e.jsx("div",{style:{fontSize:16,fontWeight:600,marginBottom:4},children:"Selecciona o crea un proyecto"}),e.jsx("div",{style:{fontSize:12,marginBottom:16},children:"Gestiona cronogramas, avances, hitos y equipo"}),e.jsxs(Xs,{on:C,children:[e.jsx(Ne,{size:12})," Crear proyecto"]})]})})]})]})]})}const Gf=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Xe={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",teal:"#0D5E6E",tealBg:"#E0F4F4",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Ii=()=>Math.random().toString(36).slice(2,9),Qs=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"";function Zs(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Fe.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const s=F.useCallback(async r=>{const a=typeof r=="function"?r(o):r;n(a);try{Fe.set(t,JSON.stringify(a))}catch{}},[t,o]);return[o,s]}const Dn=({children:t,style:i})=>e.jsx("div",{style:{background:Xe.surface,border:`1px solid ${Xe.border}`,borderRadius:8,boxShadow:Xe.shadow,...i},children:t}),fo=({children:t,v:i,sm:o,on:n,style:s,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Xe.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":Xe.ink,color:i==="sec"?Xe.inkMid:"#fff",...s},...r,children:t}),Or=[{id:"dashboard",lbl:"Dashboard",I:or,desc:"Resumen de la biblioteca"},{id:"apus",lbl:"APUs",I:or,desc:"Anlisis de precios unitarios normalizados"},{id:"materiales",lbl:"Materiales",I:Sn,desc:"Catlogo maestro de materiales y precios"},{id:"textos",lbl:"Textos tipo",I:Bt,desc:"Plantillas de alcance, exclusiones y clusulas"},{id:"categorias",lbl:"Categoras",I:Cd,desc:"Organizacin por captulos y familias"}],Kf=[{id:Ii(),codigo:"APU-001",nombre:"Paete liso sobre muro e=1.5cm",unidad:"m",costo:28500,categoria:"Paetes",insumos:[{nombre:"Mortero 1:4",unidad:"m",cantidad:.018,precio:38e4},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.45,precio:22e3},{nombre:"Mano de obra ayudante",unidad:"h",cantidad:.35,precio:14e3},{nombre:"Herramienta menor",unidad:"gl",cantidad:.03,precio:5e4}]},{id:Ii(),codigo:"APU-002",nombre:"Mampostera en bloque No.5 e=12cm",unidad:"m",costo:62e3,categoria:"Mampostera",insumos:[{nombre:"Bloque No.5 (12x20x40)",unidad:"ud",cantidad:12.5,precio:2200},{nombre:"Mortero de pega 1:4",unidad:"m",cantidad:.015,precio:38e4},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.65,precio:22e3},{nombre:"Mano de obra ayudante",unidad:"h",cantidad:.5,precio:14e3}]},{id:Ii(),codigo:"APU-003",nombre:"Estuco sobre muro",unidad:"m",costo:18500,categoria:"Acabados",insumos:[{nombre:"Estuco plstico",unidad:"kg",cantidad:1.5,precio:3200},{nombre:"Mano de obra oficial",unidad:"h",cantidad:.35,precio:22e3},{nombre:"Lija y herramienta",unidad:"gl",cantidad:.02,precio:3e4}]},{id:Ii(),codigo:"APU-004",nombre:"Pintura vinilo 2 manos tipo 1",unidad:"m",costo:14200,categoria:"Acabados",insumos:[{nombre:"Pintura vinilo tipo 1",unidad:"gl",cantidad:.065,precio:72e3},{nombre:"Rodillo y bandeja",unidad:"gl",cantidad:.01,precio:25e3},{nombre:"Mano de obra pintor",unidad:"h",cantidad:.3,precio:22e3}]},{id:Ii(),codigo:"APU-005",nombre:"Piso porcelanato 60x60",unidad:"m",costo:95e3,categoria:"Pisos",insumos:[{nombre:"Porcelanato 60x60",unidad:"m",cantidad:1.05,precio:55e3},{nombre:"Pegante para porcelanato",unidad:"kg",cantidad:5,precio:2800},{nombre:"Boquilla",unidad:"kg",cantidad:.5,precio:8500},{nombre:"Mano de obra enchapador",unidad:"h",cantidad:.8,precio:25e3}]}],Jf=[{id:Ii(),titulo:"Exclusiones estndar  Obra",categoria:"Exclusiones",texto:`Esta propuesta NO incluye, salvo acuerdo escrito:
- Licencias y permisos de construccin
- Obra de estructura o cimentacin no contemplada
- Suministro e instalacin de electrodomsticos
- Mudanzas y trasteos
- Diseo o rediseo arquitectnico
- Adecuaciones en zonas comunes
- Amoblamiento libre`},{id:Ii(),titulo:"Garantas estndar  Obra",categoria:"Garantas",texto:`Habitaris garantiza los trabajos ejecutados por un perodo de 12 meses:
- Estabilidad y solidez: 10 aos (Ley 1796)
- Impermeabilizacin: 5 aos
- Acabados y revestimientos: 1 ao
- Instalaciones: 1 ao
- Carpintera: 1 ao`},{id:Ii(),titulo:"Condiciones de pago  Obra integral",categoria:"Pagos",texto:`Forma de pago:
1. 50% Anticipo contra firma de contrato
2. 30% Contra avance del 50% de obra
3. 10% Contra finalizacin de obra
4. 10% Retencin de garanta (3 meses)`},{id:Ii(),titulo:"Trminos generales",categoria:"Trminos",texto:`Los precios incluyen materiales, mano de obra, herramienta y administracin.
Cualquier trabajo no contemplado se cotizar como adicional.
El cronograma podr ajustarse por fuerza mayor o cambios del cliente.`}];function Yf(){var m,f;const[t,i]=F.useState("dashboard"),[o,n]=Zs("hab:biblioteca:apus",[]),[s,r]=Zs("hab:biblioteca:textos",[]),[a,u]=Zs("hab:biblioteca:categorias",["Paetes","Mampostera","Acabados","Pisos","Instalaciones","Carpintera","Demoliciones","Impermeabilizacin"]),[h,b]=F.useState(""),[j,C]=F.useState(null),v={border:`1px solid ${Xe.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx(Gf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Xe.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Xe.surface,borderBottom:`1px solid ${Xe.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Xe.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Xe.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Xe.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Xe.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Xe.inkLight},children:"/ Biblioteca"})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:Xe.surface,borderRight:`1px solid ${Xe.border}`,paddingTop:8,overflowY:"auto"},children:Or.map(p=>e.jsxs("button",{onClick:()=>i(p.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===p.id?`3px solid ${Xe.ink}`:"3px solid transparent",background:t===p.id?Xe.accent:"transparent",color:t===p.id?Xe.ink:Xe.inkLight,fontSize:12,fontWeight:t===p.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(p.I,{size:13})," ",p.lbl]},p.id))}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700},children:(m=Or.find(p=>p.id===t))==null?void 0:m.lbl}),e.jsx("p",{style:{fontSize:11,color:Xe.inkLight,marginTop:2},children:(f=Or.find(p=>p.id===t))==null?void 0:f.desc})]}),t==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" APUs",o.length,"#111"],[" Materiales",materiales.length,"#3B3B3B"],[" Textos tipo",s.length,"#5B3A8C"],[" Categoras",a.length,"#8C6A00"]].map(([p,c,d])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Xe.border}`,borderRadius:8,padding:"14px 16px",boxShadow:Xe.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:d},children:c})]},p))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12},children:Or.filter(p=>p.id!=="dashboard").map(p=>e.jsxs("div",{onClick:()=>i(p.id),style:{background:Xe.surface,border:`1px solid ${Xe.border}`,borderRadius:8,padding:"18px 16px",cursor:"pointer",boxShadow:Xe.shadow},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[e.jsx(p.I,{size:16,color:Xe.ink}),e.jsx("div",{style:{fontSize:13,fontWeight:700},children:p.lbl})]}),e.jsx("div",{style:{fontSize:10,color:Xe.inkLight},children:p.desc})]},p.id))})]}),t==="apus"&&e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsxs("div",{style:{position:"relative",flex:1},children:[e.jsx(ki,{size:12,style:{position:"absolute",left:8,top:9,color:Xe.inkLight}}),e.jsx("input",{value:h,onChange:p=>b(p.target.value),placeholder:"Buscar APU...",style:{...v,width:"100%",paddingLeft:26}})]}),e.jsxs(fo,{sm:!0,on:()=>{const p={id:Ii(),codigo:`APU-${String(o.length+1).padStart(3,"0")}`,nombre:"Nuevo APU",unidad:"m",costo:0,categoria:"",insumos:[]};n(c=>[...c,p]),C(p.id)},children:[e.jsx(Ne,{size:10})," Nuevo APU"]}),o.length===0&&e.jsx(fo,{sm:!0,v:"sec",on:()=>n(Kf),children:" Cargar ejemplos"})]}),e.jsxs(Dn,{style:{padding:0,overflow:"hidden"},children:[o.filter(p=>!h||p.nombre.toLowerCase().includes(h.toLowerCase())||p.codigo.toLowerCase().includes(h.toLowerCase())).map(p=>e.jsxs("div",{style:{borderBottom:`1px solid ${Xe.border}`},children:[e.jsxs("div",{onClick:()=>C(j===p.id?null:p.id),style:{padding:"10px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:j===p.id?Xe.surfaceAlt:"transparent"},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:Xe.teal,background:Xe.tealBg,padding:"2px 6px",borderRadius:3},children:p.codigo}),e.jsx("span",{style:{flex:1,fontSize:12,fontWeight:600},children:p.nombre}),e.jsx("span",{style:{fontSize:9,color:Xe.inkLight,background:Xe.surfaceAlt,padding:"2px 6px",borderRadius:3},children:p.categoria||""}),e.jsx("span",{style:{fontSize:10,color:Xe.inkMid},children:p.unidad}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700,color:Xe.green},children:["$",Qs(p.costo)]}),j===p.id?e.jsx(Xi,{size:12,style:{transform:"rotate(90deg)"}}):e.jsx(Xi,{size:12})]}),j===p.id&&e.jsxs("div",{style:{padding:"0 16px 14px",background:Xe.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Xe.inkLight,textTransform:"uppercase"},children:"Nombre"}),e.jsx("input",{value:p.nombre,onChange:c=>n(d=>d.map(l=>l.id===p.id?{...l,nombre:c.target.value}:l)),style:{...v,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Xe.inkLight,textTransform:"uppercase"},children:"Cdigo"}),e.jsx("input",{value:p.codigo,onChange:c=>n(d=>d.map(l=>l.id===p.id?{...l,codigo:c.target.value}:l)),style:{...v,width:"100%",fontFamily:"'DM Mono',monospace"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Xe.inkLight,textTransform:"uppercase"},children:"Unidad"}),e.jsx("select",{value:p.unidad,onChange:c=>n(d=>d.map(l=>l.id===p.id?{...l,unidad:c.target.value}:l)),style:{...v,width:"100%"},children:["ud","m","m","m","ml","kg","gl","l","h","da"].map(c=>e.jsx("option",{children:c},c))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Xe.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsxs("select",{value:p.categoria||"",onChange:c=>n(d=>d.map(l=>l.id===p.id?{...l,categoria:c.target.value}:l)),style:{...v,width:"100%"},children:[e.jsx("option",{value:"",children:""}),a.map(c=>e.jsx("option",{children:c},c))]})]})]}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Xe.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Composicin"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:10},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Xe.accent},children:["Insumo","Und","Cantidad","P.Unit","Subtotal",""].map(c=>e.jsx("th",{style:{padding:"4px 8px",textAlign:c==="Subtotal"||c==="P.Unit"||c==="Cantidad"?"right":"left",fontSize:8,fontWeight:700,color:Xe.inkLight},children:c},c))})}),e.jsxs("tbody",{children:[(p.insumos||[]).map((c,d)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${Xe.border}`},children:[e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("input",{value:c.nombre,onChange:l=>{const x=[...p.insumos||[]];x[d]={...x[d],nombre:l.target.value},n(y=>y.map(g=>g.id===p.id?{...g,insumos:x}:g))},style:{border:"none",background:"transparent",width:"100%",fontSize:10}})}),e.jsx("td",{style:{padding:"4px 8px",width:40},children:e.jsx("input",{value:c.unidad,onChange:l=>{const x=[...p.insumos||[]];x[d]={...x[d],unidad:l.target.value},n(y=>y.map(g=>g.id===p.id?{...g,insumos:x}:g))},style:{border:"none",background:"transparent",width:30,fontSize:10,textAlign:"center"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:e.jsx("input",{type:"number",value:c.cantidad,onChange:l=>{const x=[...p.insumos||[]];x[d]={...x[d],cantidad:+l.target.value};const y=x.reduce((g,S)=>g+S.cantidad*S.precio,0);n(g=>g.map(S=>S.id===p.id?{...S,insumos:x,costo:Math.round(y)}:S))},style:{border:"none",background:"transparent",width:50,fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace"},children:e.jsx("input",{type:"number",value:c.precio,onChange:l=>{const x=[...p.insumos||[]];x[d]={...x[d],precio:+l.target.value};const y=x.reduce((g,S)=>g+S.cantidad*S.precio,0);n(g=>g.map(S=>S.id===p.id?{...S,insumos:x,costo:Math.round(y)}:S))},style:{border:"none",background:"transparent",width:70,fontSize:10,textAlign:"right",fontFamily:"'DM Mono',monospace"}})}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",Qs(Math.round(c.cantidad*c.precio))]}),e.jsx("td",{style:{padding:"4px 8px",width:24},children:e.jsx("button",{onClick:()=>{const l=(p.insumos||[]).filter((y,g)=>g!==d),x=l.reduce((y,g)=>y+g.cantidad*g.precio,0);n(y=>y.map(g=>g.id===p.id?{...g,insumos:l,costo:Math.round(x)}:g))},style:{background:"none",border:"none",color:Xe.red,cursor:"pointer"},children:e.jsx(Je,{size:10})})})]},d)),e.jsxs("tr",{style:{background:Xe.greenBg},children:[e.jsx("td",{colSpan:4,style:{padding:"6px 8px",fontWeight:700,fontSize:11},children:"COSTO DIRECTO"}),e.jsxs("td",{style:{padding:"6px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:Xe.green},children:["$",Qs(p.costo)]}),e.jsx("td",{})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs(fo,{sm:!0,v:"sec",on:()=>{const c=[...p.insumos||[],{nombre:"",unidad:"ud",cantidad:1,precio:0}];n(d=>d.map(l=>l.id===p.id?{...l,insumos:c}:l))},children:[e.jsx(Ne,{size:9})," Insumo"]}),e.jsxs(fo,{sm:!0,v:"sec",on:()=>{var c;return(c=navigator.clipboard)==null?void 0:c.writeText(JSON.stringify(p,null,2))},children:[e.jsx(xa,{size:9})," Copiar JSON"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{onClick:()=>n(c=>c.filter(d=>d.id!==p.id)),style:{background:"none",border:"none",color:Xe.red,fontSize:10,cursor:"pointer"},children:" Eliminar APU"})]})]})]},p.id)),o.length===0&&e.jsx("div",{style:{padding:30,textAlign:"center",color:Xe.inkLight},children:"Sin APUs. Carga los ejemplos o crea uno nuevo."})]})]}),t==="materiales"&&e.jsx("div",{className:"fade-up",children:e.jsxs(Dn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,marginBottom:4},children:"Catlogo maestro de materiales"}),e.jsx("div",{style:{fontSize:11,color:Xe.inkLight,marginBottom:14},children:"Los materiales del catlogo se sincronizan con el mdulo de Insumos del CRM."}),e.jsxs("div",{style:{padding:20,textAlign:"center",background:Xe.surfaceAlt,borderRadius:6,border:`1px solid ${Xe.border}`},children:[e.jsx(or,{size:24,style:{color:Xe.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:Xe.inkMid},children:"El catlogo maestro se gestiona desde el tab de Insumos en cada oferta del CRM"}),e.jsx("div",{style:{fontSize:10,color:Xe.inkLight,marginTop:4},children:"Los precios de proveedores se centralizan all con cotizaciones comparativas"})]})]})}),t==="textos"&&e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[e.jsx("div",{style:{flex:1}}),e.jsxs(fo,{sm:!0,on:()=>r(p=>[...p,{id:Ii(),titulo:"Nuevo texto",categoria:"",texto:""}]),children:[e.jsx(Ne,{size:10})," Nuevo texto"]}),s.length===0&&e.jsx(fo,{sm:!0,v:"sec",on:()=>r(Jf),children:" Cargar ejemplos"})]}),s.map(p=>e.jsxs(Dn,{style:{padding:16,marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6,alignItems:"center"},children:[e.jsx("input",{value:p.titulo,onChange:c=>r(d=>d.map(l=>l.id===p.id?{...l,titulo:c.target.value}:l)),style:{flex:1,border:"none",background:"transparent",fontSize:14,fontWeight:700}}),e.jsxs("select",{value:p.categoria||"",onChange:c=>r(d=>d.map(l=>l.id===p.id?{...l,categoria:c.target.value}:l)),style:{...v,width:120,fontSize:10},children:[e.jsx("option",{value:"",children:"Sin categora"}),["Alcance","Exclusiones","Garantas","Pagos","Trminos","Legal","Otro"].map(c=>e.jsx("option",{children:c},c))]}),e.jsxs(fo,{sm:!0,v:"sec",on:()=>{var c;return(c=navigator.clipboard)==null?void 0:c.writeText(p.texto)},children:[e.jsx(xa,{size:9})," Copiar"]}),e.jsx("button",{onClick:()=>r(c=>c.filter(d=>d.id!==p.id)),style:{background:"none",border:"none",color:Xe.red,cursor:"pointer"},children:e.jsx(Je,{size:12})})]}),e.jsx("textarea",{value:p.texto,onChange:c=>r(d=>d.map(l=>l.id===p.id?{...l,texto:c.target.value}:l)),rows:5,style:{width:"100%",border:`1px solid ${Xe.border}`,borderRadius:4,padding:"8px 10px",fontSize:11,resize:"vertical",lineHeight:1.6,background:Xe.surfaceAlt}})]},p.id)),s.length===0&&e.jsx(Dn,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Xe.inkLight},children:"Sin textos tipo. Carga los ejemplos o crea uno nuevo."})})]}),t==="categorias"&&e.jsx("div",{className:"fade-up",children:e.jsxs(Dn,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Categoras de APUs"}),a.map((p,c)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 0",borderBottom:`1px solid ${Xe.border}`},children:[e.jsx(Cd,{size:12,color:Xe.teal}),e.jsx("input",{value:p,onChange:d=>{const l=[...a];l[c]=d.target.value,u(l)},style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:500}}),e.jsxs("span",{style:{fontSize:9,color:Xe.inkLight},children:[o.filter(d=>d.categoria===p).length," APUs"]}),e.jsx("button",{onClick:()=>u(d=>d.filter((l,x)=>x!==c)),style:{background:"none",border:"none",color:Xe.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})]},c)),e.jsxs(fo,{sm:!0,v:"sec",on:()=>u(p=>[...p,"Nueva categora"]),style:{marginTop:10},children:[e.jsx(Ne,{size:10})," Aadir categora"]})]})})]})]})]})]})}const Xf=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),qe={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},ql=()=>Math.random().toString(36).slice(2,9),Hl=()=>new Date().toISOString().split("T")[0],Io=t=>t?new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t):"$0",Qf=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function Gl(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Fe.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const s=F.useCallback(async r=>{const a=typeof r=="function"?r(o):r;n(a);try{Fe.set(t,JSON.stringify(a))}catch{}},[t,o]);return[o,s]}const en=({children:t,style:i})=>e.jsx("div",{style:{background:qe.surface,border:`1px solid ${qe.border}`,borderRadius:8,boxShadow:qe.shadow,...i},children:t}),Lr=({children:t,v:i,sm:o,on:n,style:s,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${qe.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":qe.ink,color:i==="sec"?qe.inkMid:"#fff",cursor:"pointer",...s},...r,children:t}),Zf=[{id:"dashboard",lbl:"Dashboard",I:vs,desc:"Resumen financiero del perodo"},{id:"ingresos",lbl:"Ingresos",I:kd,desc:"Facturacin, cobros y anticipos"},{id:"egresos",lbl:"Egresos",I:wd,desc:"Pagos, compras y nmina"},{id:"facturas",lbl:"Facturas",I:zd,desc:"Emisin y seguimiento de facturas"},{id:"costos",lbl:"Costos reales",I:Ed,desc:"Comparacin presupuesto vs ejecucin"},{id:"informes",lbl:"Informes",I:Bt,desc:"Reportes financieros y tributarios"}];function ex(){const[t,i]=F.useState("dashboard"),[o,n]=Gl("hab:conta:movimientos",[]),[s,r]=Gl("hab:conta:facturas",[]),a=o.filter(c=>c.tipo==="ingreso"),u=o.filter(c=>c.tipo==="egreso"),h=a.reduce((c,d)=>c+(d.monto||0),0),b=u.reduce((c,d)=>c+(d.monto||0),0),j=h-b,C=c=>{const d={id:ql(),tipo:c,fecha:Hl(),concepto:"",monto:0,categoria:"",proyecto:"",estado:"registrado"};n(l=>[...l,d])},v=(c,d,l)=>n(x=>x.map(y=>y.id===c?{...y,[d]:l}:y)),m=c=>n(d=>d.filter(l=>l.id!==c)),f=()=>{const c={id:ql(),numero:`FV-${String(s.length+1).padStart(4,"0")}`,fecha:Hl(),cliente:"",concepto:"",subtotal:0,iva:0,total:0,estado:"borrador"};r(d=>[...d,c])},p={border:`1px solid ${qe.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"};return e.jsxs(e.Fragment,{children:[e.jsx(Xf,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:qe.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:qe.surface,borderBottom:`1px solid ${qe.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:qe.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:qe.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:qe.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:qe.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:qe.inkLight},children:"/ Contabilidad"})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:qe.surface,borderRight:`1px solid ${qe.border}`,paddingTop:8},children:Zf.map(c=>e.jsxs("button",{onClick:()=>i(c.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===c.id?`3px solid ${qe.ink}`:"3px solid transparent",background:t===c.id?qe.accent:"transparent",color:t===c.id?qe.ink:qe.inkLight,fontSize:12,fontWeight:t===c.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(c.I,{size:13})," ",c.lbl]},c.id))}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Ingresos",val:Io(h),color:qe.green,bg:qe.greenBg,icon:kd},{lbl:"Egresos",val:Io(b),color:qe.red,bg:qe.redBg,icon:wd},{lbl:"Balance",val:Io(j),color:j>=0?qe.green:qe.red,bg:j>=0?qe.greenBg:qe.redBg,icon:xr},{lbl:"Facturas",val:s.length,color:qe.blue,bg:qe.blueBg,icon:zd}].map(c=>e.jsx(en,{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:qe.inkLight,textTransform:"uppercase",letterSpacing:1},children:c.lbl}),e.jsx("div",{style:{fontSize:22,fontWeight:800,color:c.color,marginTop:4,fontFamily:"'DM Mono',monospace"},children:c.val})]}),e.jsx("div",{style:{width:32,height:32,borderRadius:8,background:c.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(c.icon,{size:16,color:c.color})})]})},c.lbl))}),e.jsxs(en,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${qe.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"ltimos movimientos"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(Lr,{sm:!0,on:()=>C("ingreso"),style:{background:qe.green},children:[e.jsx(Ne,{size:10})," Ingreso"]}),e.jsxs(Lr,{sm:!0,on:()=>C("egreso"),style:{background:qe.red},children:[e.jsx(Ne,{size:10})," Egreso"]})]})]}),o.length===0?e.jsx("div",{style:{padding:30,textAlign:"center",color:qe.inkLight},children:"Sin movimientos registrados"}):[...o].sort((c,d)=>d.fecha>c.fecha?1:-1).slice(0,15).map(c=>e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11},children:[e.jsx("span",{style:{fontSize:14},children:c.tipo==="ingreso"?"":""}),e.jsx("span",{style:{fontSize:10,color:qe.inkLight},children:Qf(c.fecha)}),e.jsx("span",{style:{flex:1,fontWeight:500},children:c.concepto||"Sin concepto"}),c.proyecto&&e.jsx("span",{style:{fontSize:9,padding:"2px 6px",background:qe.blueBg,color:qe.blue,borderRadius:3},children:c.proyecto}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:c.tipo==="ingreso"?qe.green:qe.red},children:[c.tipo==="ingreso"?"+":"","$",Io(c.monto)]})]},c.id))]})]}),(t==="ingresos"||t==="egresos")&&(()=>{const c=t==="ingresos"?"ingreso":"egreso",d=o.filter(l=>l.tipo===c);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:t==="ingresos"?"Registro de ingresos":"Registro de egresos"}),e.jsxs(Lr,{sm:!0,on:()=>C(c),style:{background:c==="ingreso"?qe.green:qe.red},children:[e.jsx(Ne,{size:10})," Nuevo ",c]})]}),e.jsx(en,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:qe.surfaceAlt},children:["Fecha","Concepto","Categora","Proyecto","Monto","Estado",""].map(l=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:qe.inkLight,textTransform:"uppercase",textAlign:l==="Monto"?"right":"left",borderBottom:`2px solid ${qe.border}`},children:l},l))})}),e.jsxs("tbody",{children:[d.sort((l,x)=>x.fecha>l.fecha?1:-1).map(l=>e.jsxs("tr",{style:{borderBottom:`1px solid ${qe.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.fecha,onChange:x=>v(l.id,"fecha",x.target.value),style:{...p,padding:"3px 6px",fontSize:10,border:"none",background:"transparent"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.concepto,onChange:x=>v(l.id,"concepto",x.target.value),placeholder:"Concepto...",style:{border:"none",background:"transparent",fontSize:12,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsxs("select",{value:l.categoria||"",onChange:x=>v(l.id,"categoria",x.target.value),style:{...p,fontSize:10,padding:"3px 6px",border:"none",background:"transparent"},children:[e.jsx("option",{value:"",children:""}),(c==="ingreso"?["Anticipo","Corte de obra","Diseo","Consultora","Otro"]:["Materiales","Mano de obra","Subcontrato","Equipos","Transporte","Servicios","Otro"]).map(x=>e.jsx("option",{children:x},x))]})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.proyecto||"",onChange:x=>v(l.id,"proyecto",x.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right"},children:e.jsx("input",{type:"number",value:l.monto||"",onChange:x=>v(l.id,"monto",+x.target.value),style:{border:`1px solid ${qe.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,width:100,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:l.estado,onChange:x=>v(l.id,"estado",x.target.value),style:{...p,fontSize:9,padding:"2px 6px"},children:["registrado","pendiente","pagado","anulado"].map(x=>e.jsx("option",{children:x},x))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>m(l.id),style:{background:"none",border:"none",color:qe.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})})]},l.id)),d.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:7,style:{padding:20,textAlign:"center",color:qe.inkLight},children:["Sin ",c,"s registrados"]})}),d.length>0&&e.jsxs("tr",{style:{background:c==="ingreso"?qe.greenBg:qe.redBg},children:[e.jsx("td",{colSpan:4,style:{padding:"8px 10px",fontWeight:700},children:"TOTAL"}),e.jsxs("td",{style:{padding:"8px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:c==="ingreso"?qe.green:qe.red},children:["$",Io(d.reduce((l,x)=>l+(x.monto||0),0))]}),e.jsx("td",{colSpan:2})]})]})]})})]})})(),t==="facturas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Facturacin"}),e.jsxs(Lr,{sm:!0,on:f,children:[e.jsx(Ne,{size:10})," Nueva factura"]})]}),e.jsx(en,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:qe.surfaceAlt},children:["N","Fecha","Cliente","Concepto","Subtotal","IVA","Total","Estado",""].map(c=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:qe.inkLight,textTransform:"uppercase",textAlign:["Subtotal","IVA","Total"].includes(c)?"right":"left",borderBottom:`2px solid ${qe.border}`},children:c},c))})}),e.jsxs("tbody",{children:[s.map(c=>e.jsxs("tr",{style:{borderBottom:`1px solid ${qe.border}`},children:[e.jsx("td",{style:{padding:"6px 10px",fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:700},children:c.numero}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:c.fecha,onChange:d=>r(l=>l.map(x=>x.id===c.id?{...x,fecha:d.target.value}:x)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:c.cliente,onChange:d=>r(l=>l.map(x=>x.id===c.id?{...x,cliente:d.target.value}:x)),placeholder:"Cliente",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:c.concepto,onChange:d=>r(l=>l.map(x=>x.id===c.id?{...x,concepto:d.target.value}:x)),placeholder:"Concepto",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right"},children:e.jsx("input",{type:"number",value:c.subtotal||"",onChange:d=>{const l=+d.target.value,x=Math.round(l*.19);r(y=>y.map(g=>g.id===c.id?{...g,subtotal:l,iva:x,total:l+x}:g))},style:{border:`1px solid ${qe.border}`,borderRadius:3,padding:"3px 6px",fontSize:10,width:80,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:qe.inkLight},children:Io(c.iva)}),e.jsx("td",{style:{padding:"6px 10px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:11,fontWeight:700},children:Io(c.total)}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:c.estado,onChange:d=>r(l=>l.map(x=>x.id===c.id?{...x,estado:d.target.value}:x)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${qe.border}`,borderRadius:3,background:c.estado==="pagada"?qe.greenBg:c.estado==="enviada"?qe.blueBg:"#fff"},children:["borrador","enviada","pagada","anulada"].map(d=>e.jsx("option",{children:d},d))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>r(d=>d.filter(l=>l.id!==c.id)),style:{background:"none",border:"none",color:qe.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})})]},c.id)),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:30,textAlign:"center",color:qe.inkLight},children:"Sin facturas"})})]})]})})]}),t==="costos"&&e.jsxs(en,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:4},children:"Control de costos reales"}),e.jsx("div",{style:{fontSize:11,color:qe.inkLight,marginBottom:14},children:"Comparacin entre presupuesto aprobado y ejecucin real"}),e.jsxs("div",{style:{padding:30,textAlign:"center",background:qe.surfaceAlt,borderRadius:6,border:`1px solid ${qe.border}`},children:[e.jsx(Ed,{size:32,style:{color:qe.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:qe.inkMid},children:"Se alimenta automticamente de los egresos registrados por proyecto"}),e.jsx("div",{style:{fontSize:10,color:qe.inkLight,marginTop:4},children:"Registra egresos asociados a un proyecto para ver el comparativo"})]})]}),t==="informes"&&e.jsxs(en,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:14},children:"Informes financieros"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[{lbl:"Estado de resultados",desc:"P&L por perodo con ingresos y gastos",icon:""},{lbl:"Flujo de caja real",desc:"Entradas y salidas por mes",icon:""},{lbl:"Cuentas por cobrar",desc:"Facturas pendientes de cobro",icon:""},{lbl:"Cuentas por pagar",desc:"Obligaciones pendientes con proveedores",icon:""},{lbl:"Retenciones",desc:"Retencin en la fuente, ICA, IVA",icon:""},{lbl:"Reporte DIAN",desc:"Informacin exgena y declaraciones",icon:""}].map(c=>e.jsxs("div",{style:{padding:"14px 16px",background:qe.surfaceAlt,borderRadius:6,border:`1px solid ${qe.border}`,cursor:"pointer"},onMouseEnter:d=>d.currentTarget.style.borderColor=qe.blue,onMouseLeave:d=>d.currentTarget.style.borderColor=qe.border,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontSize:18},children:c.icon}),e.jsx("span",{style:{fontSize:12,fontWeight:700},children:c.lbl})]}),e.jsx("div",{style:{fontSize:10,color:qe.inkLight},children:c.desc})]},c.lbl))})]})]})})]})]})]})}const tx=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),_e={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},$n=()=>Math.random().toString(36).slice(2,9),Pn=()=>new Date().toISOString().split("T")[0];function On(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Fe.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const s=F.useCallback(async r=>{const a=typeof r=="function"?r(o):r;n(a);try{Fe.set(t,JSON.stringify(a))}catch{}},[t,o]);return[o,s]}const _i=({children:t,style:i})=>e.jsx("div",{style:{background:_e.surface,border:`1px solid ${_e.border}`,borderRadius:8,boxShadow:_e.shadow,...i},children:t}),Ln=({children:t,v:i,sm:o,on:n,style:s,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${_e.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":_e.ink,color:i==="sec"?_e.inkMid:"#fff",cursor:"pointer",...s},...r,children:t}),ix=[{id:"dashboard",lbl:"Dashboard",I:Wc,desc:"Indicadores de seguridad"},{id:"inspecciones",lbl:"Inspecciones",I:Nc,desc:"Inspecciones programadas y realizadas"},{id:"incidentes",lbl:"Incidentes",I:li,desc:"Registro de accidentes e incidentes"},{id:"riesgos",lbl:"Matriz de riesgos",I:zn,desc:"Identificacin y valoracin de riesgos"},{id:"capacitaciones",lbl:"Capacitaciones",I:Ri,desc:"Programa de formacin SST"},{id:"permisos",lbl:"Permisos trabajo",I:Bt,desc:"Permisos de trabajo en alturas, caliente, confinado"},{id:"epps",lbl:"EPPs",I:ir,desc:"Control de entrega de EPPs y dotacin"}],ox=["Cada de alturas","Elctrico","Mecnico","Qumico","Biolgico","Ergonmico","Psicosocial","Trabajo en caliente","Espacio confinado","Excavaciones"],ea=[{id:1,lbl:"Bajo",color:_e.green,bg:_e.greenBg},{id:2,lbl:"Medio",color:_e.amber,bg:_e.amberBg},{id:3,lbl:"Alto",color:"#D4840A",bg:"#FFF3E0"},{id:4,lbl:"Crtico",color:_e.red,bg:_e.redBg}];function nx(){const[t,i]=F.useState("dashboard"),[o,n]=On("hab:sst:inspecciones",[]),[s,r]=On("hab:sst:incidentes",[]),[a,u]=On("hab:sst:riesgos",[]),[h,b]=On("hab:sst:capacitaciones",[]),[j,C]=On("hab:sst:permisos",[]),v={border:`1px solid ${_e.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},m=(()=>{if(s.length===0)return"";const f=[...s].sort((p,c)=>c.fecha>p.fecha?1:-1)[0];return Math.floor((Date.now()-new Date(f.fecha).getTime())/864e5)})();return e.jsxs(e.Fragment,{children:[e.jsx(tx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:_e.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:_e.surface,borderBottom:`1px solid ${_e.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:_e.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:_e.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:_e.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:_e.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:_e.inkLight},children:"/ SST"}),e.jsx("div",{style:{flex:1}}),s.filter(f=>f.estado==="abierto").length>0&&e.jsxs("div",{style:{background:_e.redBg,border:`1px solid ${_e.red}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(li,{size:12,color:_e.red}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:_e.red},children:[s.filter(f=>f.estado==="abierto").length," incidente",s.filter(f=>f.estado==="abierto").length!==1?"s":""," abierto",s.filter(f=>f.estado==="abierto").length!==1?"s":""]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:210,flexShrink:0,background:_e.surface,borderRight:`1px solid ${_e.border}`,paddingTop:8,overflowY:"auto"},children:ix.map(f=>{const p=t===f.id,c=f.id==="incidentes"?s.filter(d=>d.estado==="abierto").length:f.id==="inspecciones"?o.filter(d=>d.estado==="pendiente").length:0;return e.jsxs("button",{onClick:()=>i(f.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:p?`3px solid ${_e.ink}`:"3px solid transparent",background:p?_e.accent:"transparent",color:p?_e.ink:_e.inkLight,fontSize:12,fontWeight:p?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(f.I,{size:13})," ",e.jsx("span",{style:{flex:1},children:f.lbl}),c>0&&e.jsx("span",{style:{background:_e.red,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:c})]},f.id)})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Das sin incidentes",val:m,color:_e.green,bg:_e.greenBg},{lbl:"Inspecciones mes",val:o.filter(f=>{const p=new Date(f.fecha),c=new Date;return p.getMonth()===c.getMonth()&&p.getFullYear()===c.getFullYear()}).length,color:_e.blue,bg:_e.blueBg},{lbl:"Incidentes abiertos",val:s.filter(f=>f.estado==="abierto").length,color:_e.red,bg:_e.redBg},{lbl:"Riesgos altos",val:a.filter(f=>f.severidad>=3).length,color:_e.amber,bg:_e.amberBg},{lbl:"Capacitaciones",val:h.length,color:"#5B3A8C",bg:"#F0ECF6"}].map(f=>e.jsxs(_i,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase",letterSpacing:1},children:f.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:f.color,marginTop:4},children:f.val})]},f.lbl))}),e.jsxs(_i,{style:{padding:24,marginBottom:16,background:m===""||m>30?_e.greenBg:m>7?_e.amberBg:_e.redBg,border:`1px solid ${m===""||m>30?_e.green:m>7?_e.amber:_e.red}33`,textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:48,fontWeight:800,color:m===""||m>30?_e.green:m>7?_e.amber:_e.red},children:[" ",m]}),e.jsx("div",{style:{fontSize:14,fontWeight:700,color:_e.ink,marginTop:4},children:"Das sin incidentes"}),e.jsx("div",{style:{fontSize:11,color:_e.inkMid},children:"Seguridad es responsabilidad de todos"})]})]}),t==="inspecciones"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Inspecciones de seguridad"}),e.jsxs(Ln,{sm:!0,on:()=>n(f=>[...f,{id:$n(),fecha:Pn(),tipo:"General",ubicacion:"",inspector:"",estado:"pendiente",hallazgos:"",calificacion:0}]),children:[e.jsx(Ne,{size:10})," Nueva inspeccin"]})]}),e.jsx(_i,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:_e.surfaceAlt},children:["Fecha","Tipo","Ubicacin","Inspector","Estado","Hallazgos","Calif.",""].map(f=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${_e.border}`},children:f},f))})}),e.jsxs("tbody",{children:[o.sort((f,p)=>p.fecha>f.fecha?1:-1).map(f=>e.jsxs("tr",{style:{borderBottom:`1px solid ${_e.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:f.fecha,onChange:p=>n(c=>c.map(d=>d.id===f.id?{...d,fecha:p.target.value}:d)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.tipo,onChange:p=>n(c=>c.map(d=>d.id===f.id?{...d,tipo:p.target.value}:d)),style:{border:"none",background:"transparent",fontSize:11},children:["General","Alturas","Elctrica","Orden y aseo","EPPs","Herramientas","Sealizacin","Excavaciones"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.ubicacion,onChange:p=>n(c=>c.map(d=>d.id===f.id?{...d,ubicacion:p.target.value}:d)),placeholder:"Zona...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.inspector,onChange:p=>n(c=>c.map(d=>d.id===f.id?{...d,inspector:p.target.value}:d)),placeholder:"Nombre",style:{border:"none",background:"transparent",fontSize:11,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.estado,onChange:p=>n(c=>c.map(d=>d.id===f.id?{...d,estado:p.target.value}:d)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${_e.border}`,borderRadius:3,background:f.estado==="realizada"?_e.greenBg:f.estado==="pendiente"?_e.amberBg:"#fff"},children:["pendiente","realizada","cancelada"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.hallazgos||"",onChange:p=>n(c=>c.map(d=>d.id===f.id?{...d,hallazgos:p.target.value}:d)),placeholder:"Observaciones...",style:{border:"none",background:"transparent",fontSize:10,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"number",min:0,max:100,value:f.calificacion||"",onChange:p=>n(c=>c.map(d=>d.id===f.id?{...d,calificacion:+p.target.value}:d)),style:{width:36,border:`1px solid ${_e.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center",fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>n(p=>p.filter(c=>c.id!==f.id)),style:{background:"none",border:"none",color:_e.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})})]},f.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:_e.inkLight},children:"Sin inspecciones"})})]})]})})]}),t==="incidentes"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Registro de incidentes"}),e.jsxs(Ln,{sm:!0,on:()=>r(f=>[...f,{id:$n(),fecha:Pn(),tipo:"Incidente",descripcion:"",ubicacion:"",personas:"",severidad:1,estado:"abierto",accionCorrectiva:""}]),style:{background:_e.red},children:[e.jsx(Ne,{size:10})," Reportar incidente"]})]}),s.sort((f,p)=>p.fecha>f.fecha?1:-1).map(f=>{const p=ea.find(c=>c.id===f.severidad)||ea[0];return e.jsx(_i,{style:{padding:14,marginBottom:8,borderLeft:`4px solid ${p.color}`},children:e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"2px 6px",borderRadius:3,background:p.bg,color:p.color},children:p.lbl}),e.jsx("select",{value:f.tipo,onChange:c=>r(d=>d.map(l=>l.id===f.id?{...l,tipo:c.target.value}:l)),style:{border:"none",background:"transparent",fontSize:10,fontWeight:600},children:["Incidente","Accidente","Casi-accidente","Condicin insegura","Acto inseguro"].map(c=>e.jsx("option",{children:c},c))}),e.jsx("input",{type:"date",value:f.fecha,onChange:c=>r(d=>d.map(l=>l.id===f.id?{...l,fecha:c.target.value}:l)),style:{border:"none",background:"transparent",fontSize:10,color:_e.inkLight}}),e.jsx("div",{style:{flex:1}}),e.jsx("select",{value:f.estado,onChange:c=>r(d=>d.map(l=>l.id===f.id?{...l,estado:c.target.value}:l)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${_e.border}`,borderRadius:3,background:f.estado==="cerrado"?_e.greenBg:_e.redBg},children:["abierto","en investigacin","cerrado"].map(c=>e.jsx("option",{children:c},c))}),e.jsx("select",{value:f.severidad,onChange:c=>r(d=>d.map(l=>l.id===f.id?{...l,severidad:+c.target.value}:l)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${_e.border}`,borderRadius:3},children:ea.map(c=>e.jsx("option",{value:c.id,children:c.lbl},c.id))})]}),e.jsx("textarea",{value:f.descripcion,onChange:c=>r(d=>d.map(l=>l.id===f.id?{...l,descripcion:c.target.value}:l)),placeholder:"Descripcin del incidente...",rows:2,style:{width:"100%",border:`1px solid ${_e.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,resize:"vertical",background:_e.surfaceAlt}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:6},children:[e.jsx("input",{value:f.ubicacion||"",onChange:c=>r(d=>d.map(l=>l.id===f.id?{...l,ubicacion:c.target.value}:l)),placeholder:" Ubicacin",style:{...v,fontSize:10}}),e.jsx("input",{value:f.personas||"",onChange:c=>r(d=>d.map(l=>l.id===f.id?{...l,personas:c.target.value}:l)),placeholder:" Personas involucradas",style:{...v,fontSize:10}})]}),e.jsx("input",{value:f.accionCorrectiva||"",onChange:c=>r(d=>d.map(l=>l.id===f.id?{...l,accionCorrectiva:c.target.value}:l)),placeholder:" Accin correctiva...",style:{...v,width:"100%",fontSize:10,marginTop:6}})]}),e.jsx("button",{onClick:()=>r(c=>c.filter(d=>d.id!==f.id)),style:{background:"none",border:"none",color:_e.red,cursor:"pointer"},children:e.jsx(Je,{size:12})})]})},f.id)}),s.length===0&&e.jsx(_i,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:_e.inkLight},children:"Sin incidentes registrados "})})]}),t==="riesgos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Matriz de riesgos"}),e.jsxs(Ln,{sm:!0,on:()=>u(f=>[...f,{id:$n(),tipo:"Cada de alturas",actividad:"",control:"",severidad:2,probabilidad:2,responsable:""}]),children:[e.jsx(Ne,{size:10})," Nuevo riesgo"]})]}),e.jsx(_i,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:_e.surfaceAlt},children:["Tipo de riesgo","Actividad","Control existente","Sev.","Prob.","Nivel","Responsable",""].map(f=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${_e.border}`},children:f},f))})}),e.jsxs("tbody",{children:[a.map(f=>{const p=(f.severidad||1)*(f.probabilidad||1),c=p>=9?_e.red:p>=4?_e.amber:_e.green;return e.jsxs("tr",{style:{borderBottom:`1px solid ${_e.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.tipo,onChange:d=>u(l=>l.map(x=>x.id===f.id?{...x,tipo:d.target.value}:x)),style:{border:"none",background:"transparent",fontSize:11,fontWeight:600},children:ox.map(d=>e.jsx("option",{children:d},d))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.actividad||"",onChange:d=>u(l=>l.map(x=>x.id===f.id?{...x,actividad:d.target.value}:x)),placeholder:"Actividad...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.control||"",onChange:d=>u(l=>l.map(x=>x.id===f.id?{...x,control:d.target.value}:x)),placeholder:"Medida de control...",style:{border:"none",background:"transparent",fontSize:10,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.severidad,onChange:d=>u(l=>l.map(x=>x.id===f.id?{...x,severidad:+d.target.value}:x)),style:{width:42,fontSize:10,border:`1px solid ${_e.border}`,borderRadius:3,textAlign:"center"},children:[1,2,3,4].map(d=>e.jsx("option",{value:d,children:d},d))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.probabilidad,onChange:d=>u(l=>l.map(x=>x.id===f.id?{...x,probabilidad:+d.target.value}:x)),style:{width:42,fontSize:10,border:`1px solid ${_e.border}`,borderRadius:3,textAlign:"center"},children:[1,2,3,4].map(d=>e.jsx("option",{value:d,children:d},d))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("span",{style:{fontSize:10,fontWeight:700,padding:"2px 8px",borderRadius:3,background:c+"18",color:c},children:p})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.responsable||"",onChange:d=>u(l=>l.map(x=>x.id===f.id?{...x,responsable:d.target.value}:x)),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>u(d=>d.filter(l=>l.id!==f.id)),style:{background:"none",border:"none",color:_e.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})})]},f.id)}),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:_e.inkLight},children:"Sin riesgos identificados"})})]})]})})]}),t==="capacitaciones"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Programa de capacitaciones"}),e.jsxs(Ln,{sm:!0,on:()=>b(f=>[...f,{id:$n(),fecha:Pn(),tema:"",duracion:1,instructor:"",asistentes:0,estado:"programada"}]),children:[e.jsx(Ne,{size:10})," Nueva capacitacin"]})]}),h.sort((f,p)=>p.fecha>f.fecha?1:-1).map(f=>e.jsx(_i,{style:{padding:14,marginBottom:8},children:e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("input",{type:"date",value:f.fecha,onChange:p=>b(c=>c.map(d=>d.id===f.id?{...d,fecha:p.target.value}:d)),style:{border:`1px solid ${_e.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:f.tema,onChange:p=>b(c=>c.map(d=>d.id===f.id?{...d,tema:p.target.value}:d)),placeholder:"Tema de la capacitacin",style:{flex:1,border:"none",background:"transparent",fontSize:13,fontWeight:600}}),e.jsx("span",{style:{fontSize:9,color:_e.inkLight},children:"Duracin:"}),e.jsx("input",{type:"number",value:f.duracion,onChange:p=>b(c=>c.map(d=>d.id===f.id?{...d,duracion:+p.target.value}:d)),style:{width:36,border:`1px solid ${_e.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center"}}),e.jsx("span",{style:{fontSize:9,color:_e.inkLight},children:"h"}),e.jsx("input",{value:f.instructor||"",onChange:p=>b(c=>c.map(d=>d.id===f.id?{...d,instructor:p.target.value}:d)),placeholder:"Instructor",style:{width:100,border:`1px solid ${_e.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("span",{style:{fontSize:9,color:_e.inkLight},children:"Asist:"}),e.jsx("input",{type:"number",value:f.asistentes||"",onChange:p=>b(c=>c.map(d=>d.id===f.id?{...d,asistentes:+p.target.value}:d)),style:{width:36,border:`1px solid ${_e.border}`,borderRadius:3,padding:"2px 4px",fontSize:10,textAlign:"center"}}),e.jsx("select",{value:f.estado,onChange:p=>b(c=>c.map(d=>d.id===f.id?{...d,estado:p.target.value}:d)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${_e.border}`,borderRadius:3,background:f.estado==="realizada"?_e.greenBg:"#fff"},children:["programada","realizada","cancelada"].map(p=>e.jsx("option",{children:p},p))}),e.jsx("button",{onClick:()=>b(p=>p.filter(c=>c.id!==f.id)),style:{background:"none",border:"none",color:_e.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})]})},f.id)),h.length===0&&e.jsx(_i,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:_e.inkLight},children:"Sin capacitaciones programadas"})})]}),t==="permisos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Permisos de trabajo"}),e.jsxs(Ln,{sm:!0,on:()=>C(f=>[...f,{id:$n(),fecha:Pn(),tipo:"Alturas",actividad:"",ubicacion:"",responsable:"",vigencia:Pn(),estado:"activo"}]),children:[e.jsx(Ne,{size:10})," Nuevo permiso"]})]}),e.jsx(_i,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:_e.surfaceAlt},children:["Fecha","Tipo","Actividad","Ubicacin","Responsable","Vigencia","Estado",""].map(f=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:_e.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${_e.border}`},children:f},f))})}),e.jsxs("tbody",{children:[j.sort((f,p)=>p.fecha>f.fecha?1:-1).map(f=>e.jsxs("tr",{style:{borderBottom:`1px solid ${_e.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:f.fecha,onChange:p=>C(c=>c.map(d=>d.id===f.id?{...d,fecha:p.target.value}:d)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.tipo,onChange:p=>C(c=>c.map(d=>d.id===f.id?{...d,tipo:p.target.value}:d)),style:{border:"none",background:"transparent",fontSize:11,fontWeight:600},children:["Alturas","Trabajo en caliente","Espacio confinado","Excavaciones","Elctrico","Izaje de cargas"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.actividad||"",onChange:p=>C(c=>c.map(d=>d.id===f.id?{...d,actividad:p.target.value}:d)),placeholder:"Actividad...",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.ubicacion||"",onChange:p=>C(c=>c.map(d=>d.id===f.id?{...d,ubicacion:p.target.value}:d)),placeholder:"Zona",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:f.responsable||"",onChange:p=>C(c=>c.map(d=>d.id===f.id?{...d,responsable:p.target.value}:d)),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:f.vigencia,onChange:p=>C(c=>c.map(d=>d.id===f.id?{...d,vigencia:p.target.value}:d)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:f.estado,onChange:p=>C(c=>c.map(d=>d.id===f.id?{...d,estado:p.target.value}:d)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${_e.border}`,borderRadius:3,background:f.estado==="activo"?_e.greenBg:_e.redBg},children:["activo","cerrado","cancelado"].map(p=>e.jsx("option",{children:p},p))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>C(p=>p.filter(c=>c.id!==f.id)),style:{background:"none",border:"none",color:_e.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})})]},f.id)),j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:30,textAlign:"center",color:_e.inkLight},children:"Sin permisos"})})]})]})})]}),t==="epps"&&e.jsxs(_i,{style:{padding:18},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,marginBottom:4},children:"Control de EPPs y dotacin"}),e.jsx("div",{style:{fontSize:11,color:_e.inkLight,marginBottom:14},children:"El inventario de EPPs se gestiona desde el mdulo de Logstica"}),e.jsxs("div",{style:{padding:20,textAlign:"center",background:_e.surfaceAlt,borderRadius:6,border:`1px solid ${_e.border}`},children:[e.jsx(ir,{size:32,style:{color:_e.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:12,fontWeight:600,color:_e.inkMid},children:"El control de entrega y reposicin se sincroniza con Logstica  EPPs"})]})]})]})})]})]})]})}const ee={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",success:"#111111",successBg:"#EBEBEB",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},Ie={fontFamily:"'DM Sans',sans-serif"},uc="hab:formacion:",Wr=t=>{try{return JSON.parse(Fe.getSync(uc+t))||null}catch{return null}},Nr=(t,i)=>{Fe.set(uc+t,JSON.stringify(i))},is=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),Wn=[{id:"legal_sst",label:"Legal / SST",icon:"",color:"#B91C1C"},{id:"legal_corp",label:"Legal Corporativo",icon:"",color:"#3B3B3B"},{id:"operativo",label:"Operativo / Diseo",icon:"",color:"#5B3A8C"},{id:"admin",label:"Administrativo",icon:"",color:"#8C6A00"},{id:"tech",label:"Tecnologa / Herramientas",icon:"",color:"#0D5E6E"},{id:"cliente",label:"Atencin al Cliente",icon:"",color:"#111111"}],rx=[{id:"co_sst_induccion",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Induccin SG-SST",duracionMin:60,desc:"Induccin obligatoria al Sistema de Gestin de Seguridad y Salud en el Trabajo. Decreto 1072/2015, Art. 2.2.4.6.11.",contenido:"Poltica SST de la empresa, peligros y riesgos del cargo, plan de emergencias, reporte de incidentes, derechos y deberes del trabajador.",normativa:"Decreto 1072/2015  Resolucin 0312/2019",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_alturas",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Trabajo Seguro en Alturas",duracionMin:480,desc:"Curso obligatorio para todo trabajador que realice labores a 1.5m o ms sobre nivel inferior. Resolucin 4272/2021.",contenido:"Marco normativo, sistemas de proteccin contra cadas, permisos de trabajo, procedimientos de rescate, prcticas en campo.",normativa:"Resolucin 4272/2021  Resolucin 1409/2012",vigenciaMeses:12,renovable:!0,aplica:["obra","supervisores","instaladores"]},{id:"co_sst_primeros_auxilios",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Primeros Auxilios",duracionMin:120,desc:"Formacin bsica en primeros auxilios para brigadistas y personal designado. Decreto 1072/2015.",contenido:"Evaluacin de la escena, RCP bsico, control de hemorragias, inmovilizacin, quemaduras, traslado de heridos.",normativa:"Decreto 1072/2015  Resolucin 0312/2019",vigenciaMeses:24,renovable:!0,aplica:["brigadistas","obra"]},{id:"co_sst_emergencias",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Plan de Emergencias y Evacuacin",duracionMin:60,desc:"Capacitacin sobre el plan de emergencias de la empresa: rutas de evacuacin, puntos de encuentro, roles.",contenido:"Tipos de emergencia, alarmas, roles del brigadista, evacuacin, uso de extintores, simulacros.",normativa:"Decreto 1072/2015 Art. 2.2.4.6.25",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_ergonomia",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Biomecnico / Ergonoma",duracionMin:60,desc:"Prevencin de lesiones osteomusculares por posturas prolongadas, movimientos repetitivos y manejo de cargas.",contenido:"Higiene postural en oficina, pausas activas, levantamiento seguro de cargas, diseo del puesto de trabajo.",normativa:"Decreto 1072/2015  GTC 45",vigenciaMeses:12,renovable:!0,aplica:["oficina","todos"]},{id:"co_sst_quimicos",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Manejo Seguro de Productos Qumicos",duracionMin:60,desc:"Identificacin y manejo de pinturas, solventes, adhesivos y materiales peligrosos usados en remodelacin.",contenido:"SGA (Sistema Globalmente Armonizado), hojas de seguridad, almacenamiento, EPP, derrames, disposicin.",normativa:"Decreto 1496/2018  GTC 45",vigenciaMeses:12,renovable:!0,aplica:["obra","instaladores"]},{id:"co_sst_psicosocial",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Psicosocial y Salud Mental",duracionMin:60,desc:"Identificacin y prevencin de factores de riesgo psicosocial: estrs, acoso laboral, burnout.",contenido:"Resolucin 2646/2008, batera de riesgo psicosocial, estrategias de afrontamiento, canales de apoyo.",normativa:"Resolucin 2646/2008  Ley 1616/2013",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_sst_electrico",pais:"CO",cat:"legal_sst",obligatorio:!0,nombre:"Riesgo Elctrico (RETIE)",duracionMin:120,desc:"Seguridad en instalaciones elctricas durante remodelacin. Obligatorio si hay intervencin elctrica.",contenido:"RETIE, 5 reglas de oro, bloqueo/etiquetado, EPP dielctricos, permisos de trabajo.",normativa:"RETIE  Resolucin 90708/2013",vigenciaMeses:24,renovable:!0,aplica:["instaladores","obra"]},{id:"co_sst_espacios",pais:"CO",cat:"legal_sst",obligatorio:!1,nombre:"Espacios Confinados",duracionMin:120,desc:"Procedimientos para trabajos en espacios confinados (stanos, tanques, ductos).",contenido:"Identificacin de espacios confinados, monitoreo atmosfrico, permisos, rescate.",normativa:"Resolucin 0491/2020",vigenciaMeses:12,renovable:!0,aplica:["obra"]},{id:"co_datos",pais:"CO",cat:"legal_corp",obligatorio:!0,nombre:"Proteccin de Datos Personales (Habeas Data)",duracionMin:60,desc:"Ley 1581/2012 de proteccin de datos personales. Obligatorio para todo empleado que maneje datos de clientes.",contenido:"Principios de tratamiento de datos, autorizacin, derechos ARCO, incidentes de seguridad, responsabilidad.",normativa:"Ley 1581/2012  Decreto 1377/2013",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_acoso",pais:"CO",cat:"legal_corp",obligatorio:!0,nombre:"Prevencin del Acoso Laboral",duracionMin:60,desc:"Ley 1010/2006 de acoso laboral. Todo trabajador debe conocer conductas, mecanismos de denuncia y comit de convivencia.",contenido:"Tipos de acoso, comit de convivencia laboral, procedimiento de queja, medidas preventivas y correctivas.",normativa:"Ley 1010/2006  Resolucin 2646/2008",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"co_laft",pais:"CO",cat:"legal_corp",obligatorio:!1,nombre:"Prevencin LAFT (Lavado de Activos)",duracionMin:60,desc:"Prevencin de lavado de activos y financiacin del terrorismo. Recomendado para empresas con contratos de alto valor.",contenido:"Seales de alerta, debida diligencia, reporte de operaciones sospechosas, SAGRILAFT.",normativa:"Circular Externa SFC 055/2016",vigenciaMeses:12,renovable:!0,aplica:["directivos","comercial"]},{id:"co_nsr10",pais:"CO",cat:"operativo",obligatorio:!1,nombre:"Norma Sismo Resistente NSR-10",duracionMin:120,desc:"Conocimiento de la NSR-10 aplicable a diseo y remodelacin de estructuras.",contenido:"Ttulos A (requisitos generales), J (proteccin contra incendio), K (requisitos complementarios para diseo arquitectnico).",normativa:"NSR-10  Ley 400/1997",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"co_pot",pais:"CO",cat:"operativo",obligatorio:!1,nombre:"Normativa Urbanstica y POT",duracionMin:90,desc:"Plan de Ordenamiento Territorial, licencias urbansticas y norma aplicable a proyectos de remodelacin.",contenido:"Tipos de licencia, normas urbansticas, usos del suelo, ndices, retrocesos, alturas, trmites ante curaduras.",normativa:"Decreto 1077/2015  Decreto 1203/2017",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","directivos"]},{id:"co_proc_diseno",pais:"CO",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Diseo Habitaris",duracionMin:90,desc:"Protocolo interno de diseo: flujo del proyecto, entregables por fase, revisiones, aprobaciones del cliente.",contenido:"Brief  Concepto  Anteproyecto  Proyecto  Detalles tcnicos  Planos de obra. Checklist por fase, nomenclatura de archivos.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"co_proc_obra",pais:"CO",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Obra",duracionMin:90,desc:"Protocolo interno de ejecucin de obra: acta de inicio, control diario, bitcora, recepcin de materiales.",contenido:"Acta de vecindad, acta de inicio, bitcora diaria, control de avance, gestin de cambios, entrega parcial/final.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"co_admin_proc",pais:"CO",cat:"admin",obligatorio:!0,nombre:"Procedimientos Administrativos Internos",duracionMin:60,desc:"Protocolo interno: compras, caja chica, viticos, aprobaciones, archivo documental.",contenido:"Flujo de compras, aprobaciones por monto, rendicin de viticos, gestin documental, archivo digital.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["administrativos","todos"]},{id:"co_admin_factura",pais:"CO",cat:"admin",obligatorio:!1,nombre:"Facturacin Electrnica",duracionMin:60,desc:"Normativa y operacin de facturacin electrnica ante la DIAN.",contenido:"Resolucin de habilitacin, notas crdito/dbito, documento soporte, tiempos de envo, contingencia.",normativa:"Resolucin DIAN 000042/2020",vigenciaMeses:0,renovable:!1,aplica:["administrativos","contabilidad"]},{id:"co_bim",pais:"CO",cat:"tech",obligatorio:!1,nombre:"Metodologa BIM",duracionMin:240,desc:"Building Information Modeling aplicado a diseo interior y remodelacin.",contenido:"Conceptos BIM, modelado en Revit, familias, coordinacin de disciplinas, LOD, entregables BIM.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"co_soft_diseno",pais:"CO",cat:"tech",obligatorio:!1,nombre:"Software de Diseo (AutoCAD / SketchUp / Revit)",duracionMin:480,desc:"Capacitacin en herramientas de diseo utilizadas en la empresa.",contenido:"Segn software: interfaz, dibujo 2D/3D, renderizado, ploteo, exportacin de planos.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"co_suite_hab",pais:"CO",cat:"tech",obligatorio:!0,nombre:"Uso de la Suite Habitaris",duracionMin:60,desc:"Capacitacin en el uso de la plataforma de gestin: CRM, formularios, proyectos, RRHH.",contenido:"Mdulos de la suite, flujo de ofertas, formularios, gestin de proyectos, reportes.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"co_atencion",pais:"CO",cat:"cliente",obligatorio:!0,nombre:"Protocolo de Atencin al Cliente",duracionMin:60,desc:"Estndares de servicio, comunicacin con el cliente, manejo de quejas y expectativas.",contenido:"Primera impresin, escucha activa, gestin de expectativas, manejo de conflictos, seguimiento post-servicio.",normativa:"Procedimiento interno",vigenciaMeses:12,renovable:!0,aplica:["comercial","diseadores","todos"]},{id:"es_prl_general",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Prevencin de Riesgos Laborales  General",duracionMin:480,desc:"Formacin PRL adaptada al puesto de trabajo. Art. 19 LPRL. Obligatoria para todo trabajador.",contenido:"Conceptos bsicos PRL, riesgos generales y especficos del puesto, medidas preventivas, EPIs, sealizacin.",normativa:"Ley 31/1995 (LPRL) Art. 19  RD 39/1997",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"es_prl_oficina",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"PRL  Pantallas de Visualizacin de Datos",duracionMin:120,desc:"Riesgos ergonmicos en trabajo con ordenadores. Obligatorio para personal de oficina.",contenido:"Ergonoma del puesto, fatiga visual, pausas, configuracin de pantalla, mobiliario, ejercicios.",normativa:"RD 488/1997",vigenciaMeses:0,renovable:!1,aplica:["oficina","diseadores","administrativos"]},{id:"es_prl_construccion",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"PRL  Construccin (20h Convenio)",duracionMin:1200,desc:"Formacin obligatoria del Convenio General de Construccin para personal que visita/trabaja en obra.",contenido:"Parte troncal (14h): riesgos generales en obra, medidas preventivas. Parte especfica (6h): segn oficio.",normativa:"VI CGSC  RD 1627/1997",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores","arquitectos"]},{id:"es_prl_primeros_auxilios",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Primeros Auxilios",duracionMin:120,desc:"Formacin en primeros auxilios para personal designado. Art. 20 LPRL.",contenido:"Conducta PAS, RCP, DESA, hemorragias, fracturas, quemaduras, intoxicaciones.",normativa:"Ley 31/1995 Art. 20",vigenciaMeses:24,renovable:!0,aplica:["brigadistas","designados"]},{id:"es_prl_emergencias",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Plan de Emergencia y Evacuacin",duracionMin:60,desc:"Actuacin ante emergencias: incendio, evacuacin, confinamiento.",contenido:"Plan de autoproteccin, roles, uso de extintores y BIE, rutas de evacuacin, simulacros.",normativa:"Ley 31/1995 Art. 20  RD 393/2007",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_prl_coord",pais:"ES",cat:"legal_sst",obligatorio:!0,nombre:"Coordinacin de Actividades Empresariales (CAE)",duracionMin:60,desc:"Obligaciones cuando concurren varias empresas en un mismo centro de trabajo (obra).",contenido:"RD 171/2004, intercambio de informacin, instrucciones, vigilancia, recurso preventivo.",normativa:"RD 171/2004",vigenciaMeses:0,renovable:!1,aplica:["supervisores","directivos"]},{id:"es_rgpd",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Proteccin de Datos (RGPD + LOPDGDD)",duracionMin:120,desc:"Reglamento General de Proteccin de Datos y LOPDGDD. Obligatorio para todo personal que maneje datos.",contenido:"Principios, bases de legitimacin, derechos del interesado, brechas de seguridad, DPD, sanciones.",normativa:"Reglamento UE 2016/679  LO 3/2018",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_acoso",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Prevencin Acoso Sexual y por Razn de Sexo",duracionMin:60,desc:"LO 10/2022 obliga a TODAS las empresas a formar a su plantilla. Protocolo de actuacin.",contenido:"Definiciones legales, identificacin de conductas, procedimiento de denuncia, medidas cautelares, confidencialidad.",normativa:"LO 3/2007 Art. 48  LO 10/2022 Art. 12",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_igualdad",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Igualdad y Plan de Igualdad",duracionMin:60,desc:"Sensibilizacin en igualdad de oportunidades. Plan de igualdad obligatorio si 50 empleados.",contenido:"Marco normativo, brecha salarial, lenguaje inclusivo, corresponsabilidad, medidas del plan.",normativa:"LO 3/2007  RD 901/2020",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_lgtbi",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Igualdad LGTBI y Diversidad",duracionMin:60,desc:"Ley 4/2023 y RD 1026/2024. Obligatorio para empresas 50 empleados desde abril 2025.",contenido:"Diversidad sexual e identidad de gnero, protocolo frente a LGTBIfobia, entornos inclusivos.",normativa:"Ley 4/2023  RD 1026/2024",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_desconexion",pais:"ES",cat:"legal_corp",obligatorio:!0,nombre:"Desconexin Digital",duracionMin:30,desc:"Derecho a la desconexin digital fuera del horario laboral. LOPDGDD Art. 88.",contenido:"Poltica de desconexin, gestin del tiempo digital, prevencin de fatiga informtica, buenas prcticas.",normativa:"LO 3/2018 Art. 88",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_canal_denuncias",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Canal Interno de Denuncias",duracionMin:30,desc:"Ley 2/2023 (Whistleblowing). Obligatorio 50 empleados. Formacin sobre uso y proteccin del informante.",contenido:"Qu se puede denunciar, cmo funciona el canal, proteccin del informante, confidencialidad, plazos.",normativa:"Ley 2/2023",vigenciaMeses:12,renovable:!0,aplica:["todos"]},{id:"es_blanqueo",pais:"ES",cat:"legal_corp",obligatorio:!1,nombre:"Prevencin de Blanqueo de Capitales",duracionMin:60,desc:"Ley 10/2010. Obligatorio para promotores inmobiliarios y operaciones >15.000 en efectivo.",contenido:"Debida diligencia, identificacin del cliente, operaciones sospechosas, conservacin documental.",normativa:"Ley 10/2010 Art. 29",vigenciaMeses:12,renovable:!0,aplica:["directivos","comercial"]},{id:"es_cte",pais:"ES",cat:"operativo",obligatorio:!1,nombre:"Cdigo Tcnico de Edificacin (CTE)",duracionMin:120,desc:"Conocimiento del CTE aplicable a reformas y rehabilitacin.",contenido:"DB-HE (ahorro energtico), DB-SI (incendios), DB-SUA (seguridad de utilizacin), DB-HS (salubridad).",normativa:"RD 314/2006",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"es_proc_diseno",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Diseo Habitaris",duracionMin:90,desc:"Protocolo interno de diseo: flujo del proyecto, entregables, revisiones, aprobaciones.",contenido:"Brief  Concepto  Anteproyecto  Proyecto ejecutivo  Detalles. Checklist por fase.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["diseadores","arquitectos"]},{id:"es_proc_obra",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Procedimiento Operativo de Obra / Reforma",duracionMin:90,desc:"Protocolo interno de ejecucin: acta de replanteo, libro de rdenes, certificaciones.",contenido:"Licencia de obra, acta de replanteo, libro de rdenes, certificaciones parciales, acta de recepcin.",normativa:"Procedimiento interno  LOE",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"es_residuos",pais:"ES",cat:"operativo",obligatorio:!0,nombre:"Gestin de Residuos de Construccin (RCD)",duracionMin:60,desc:"Plan de gestin de residuos obligatorio en obra. Separacin, transporte y gestin autorizada.",contenido:"RD 105/2008, tipos de residuos, plan de gestin, documentos de control, gestores autorizados.",normativa:"RD 105/2008  Ley 7/2022",vigenciaMeses:0,renovable:!1,aplica:["obra","supervisores"]},{id:"es_bim",pais:"ES",cat:"tech",obligatorio:!1,nombre:"Metodologa BIM",duracionMin:240,desc:"Building Information Modeling. Licitacin pblica ya lo exige en muchos proyectos.",contenido:"Conceptos BIM, modelado Revit, IFC, coordinacin, LOD, entregables.",normativa:"",vigenciaMeses:0,renovable:!1,aplica:["arquitectos","diseadores","ingenieros"]},{id:"es_suite_hab",pais:"ES",cat:"tech",obligatorio:!0,nombre:"Uso de la Suite Habitaris",duracionMin:60,desc:"Capacitacin en el uso de la plataforma de gestin.",contenido:"CRM, formularios, proyectos, RRHH, reportes.",normativa:"Procedimiento interno",vigenciaMeses:0,renovable:!1,aplica:["todos"]},{id:"es_atencion",pais:"ES",cat:"cliente",obligatorio:!0,nombre:"Protocolo de Atencin al Cliente",duracionMin:60,desc:"Estndares de servicio, comunicacin, gestin de expectativas y reclamaciones.",contenido:"Primera impresin, escucha activa, gestin de quejas, libro de reclamaciones, seguimiento.",normativa:"Procedimiento interno",vigenciaMeses:12,renovable:!0,aplica:["comercial","diseadores","todos"]}],sx=[{id:"todos",label:"Todos los empleados"},{id:"directivos",label:"Directivos / Gerencia"},{id:"arquitectos",label:"Arquitectos"},{id:"diseadores",label:"Diseadores de interiores"},{id:"ingenieros",label:"Ingenieros"},{id:"obra",label:"Personal de obra"},{id:"supervisores",label:"Supervisores / Residentes"},{id:"instaladores",label:"Instaladores / Tcnicos"},{id:"administrativos",label:"Administrativos"},{id:"comercial",label:"Comercial / Ventas"},{id:"contabilidad",label:"Contabilidad / Finanzas"},{id:"oficina",label:"Personal de oficina"},{id:"brigadistas",label:"Brigadistas"},{id:"designados",label:"Designados especiales"}];function os(t){if(!t)return"";if(t<60)return`${t} min`;const i=Math.floor(t/60),o=t%60;return o?`${i}h ${o}min`:`${i}h`}function ns(t){return t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):""}function ax(t,i){const o=new Date(t);return o.setMonth(o.getMonth()+i),o.toISOString()}function Di(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}function lx({tabs:t,active:i,onChange:o,style:n}){return e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${ee.border}`,...n},children:t.map(s=>e.jsxs("button",{onClick:()=>o(s.id),style:{...Ie,padding:"10px 18px",fontSize:12,fontWeight:i===s.id?700:500,color:i===s.id?ee.accent:ee.inkLight,background:"none",border:"none",borderBottom:i===s.id?`2px solid ${ee.accent}`:"2px solid transparent",cursor:"pointer",transition:"all .15s"},children:[s.icon&&e.jsx("span",{style:{marginRight:6},children:s.icon}),s.label,s.badge!=null&&e.jsx("span",{style:{marginLeft:6,background:i===s.id?ee.accent:ee.border,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:s.badge})]},s.id))})}function ii({children:t,color:i,bg:o,style:n}){return e.jsx("span",{style:{...Ie,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o,...n},children:t})}function Kl({children:t,style:i,onClick:o}){return e.jsx("div",{onClick:o,style:{background:"#fff",border:`1px solid ${ee.border}`,borderRadius:10,padding:20,boxShadow:ee.shadow,transition:"all .15s",cursor:o?"pointer":void 0,...i},onMouseEnter:n=>{o&&(n.currentTarget.style.boxShadow=ee.shadowMd)},onMouseLeave:n=>{o&&(n.currentTarget.style.boxShadow=ee.shadow)},children:t})}function dx({value:t,onChange:i,placeholder:o}){return e.jsxs("div",{style:{position:"relative"},children:[e.jsx("span",{style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",fontSize:14,opacity:.4},children:""}),e.jsx("input",{value:t,onChange:n=>i(n.target.value),placeholder:o||"Buscar",style:{...Ie,width:"100%",padding:"8px 12px 8px 34px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:6,outline:"none",boxSizing:"border-box"},onFocus:n=>n.target.style.borderColor=ee.accent,onBlur:n=>n.target.style.borderColor=ee.border})]})}function cx({preguntas:t,onChange:i}){const o=()=>i([...t,{id:is(),texto:"",opciones:["","","",""],correcta:0}]),n=(a,u,h)=>{const b=[...t];b[a]={...b[a],[u]:h},i(b)},s=(a,u,h)=>{const b=[...t],j=[...b[a].opciones];j[u]=h,b[a]={...b[a],opciones:j},i(b)},r=a=>i(t.filter((u,h)=>h!==a));return e.jsxs("div",{children:[e.jsxs("div",{style:{...Ie,fontSize:12,fontWeight:600,color:ee.ink,marginBottom:10},children:["Cuestionario de evaluacin (",t.length," preguntas)"]}),t.map((a,u)=>e.jsxs("div",{style:{border:`1px solid ${ee.border}`,borderRadius:8,padding:14,marginBottom:10,background:ee.surface},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("span",{style:{...Ie,fontSize:11,fontWeight:600,color:ee.inkMid},children:["Pregunta ",u+1]}),e.jsx("button",{onClick:()=>r(u),style:{...Ie,fontSize:10,color:ee.danger,background:"none",border:"none",cursor:"pointer"},children:" Eliminar"})]}),e.jsx("input",{value:a.texto,onChange:h=>n(u,"texto",h.target.value),placeholder:"Escribe la pregunta",style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5,marginBottom:8,boxSizing:"border-box"}}),a.opciones.map((h,b)=>e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:4},children:[e.jsx("input",{type:"radio",name:`q_${a.id}`,checked:a.correcta===b,onChange:()=>n(u,"correcta",b),style:{accentColor:ee.accent}}),e.jsx("input",{value:h,onChange:j=>s(u,b,j.target.value),placeholder:`Opcin ${b+1}`,style:{...Ie,flex:1,padding:"5px 8px",fontSize:11,border:`1px solid ${ee.border}`,borderRadius:4}})]},b)),e.jsx("p",{style:{...Ie,fontSize:10,color:ee.inkLight,marginTop:4},children:" Marca el radio de la respuesta correcta"})]},a.id)),e.jsx("button",{onClick:o,style:{...Ie,padding:"7px 16px",fontSize:11,fontWeight:600,color:ee.accent,background:ee.accentBg,border:`1px solid ${ee.accent}33`,borderRadius:6,cursor:"pointer"},children:"+ Aadir pregunta"})]})}function px({preguntas:t,onComplete:i}){const[o,n]=F.useState({}),[s,r]=F.useState(!1),[a,u]=F.useState(null),h=(m,f)=>{s||n(p=>({...p,[m]:f}))},b=()=>{let m=0;t.forEach(p=>{o[p.id]===p.correcta&&m++});const f=Math.round(m/t.length*100);u(f),r(!0),i(f)},j=Object.keys(o).length,C=t.length,v=a!=null&&a>=70;return e.jsxs("div",{children:[!s&&e.jsxs("div",{style:{...Ie,fontSize:12,color:ee.inkMid,marginBottom:16},children:["Responde todas las preguntas. Necesitas ",e.jsx("b",{children:"70%"})," para aprobar. (",j,"/",C," respondidas)"]}),s&&e.jsxs("div",{style:{padding:20,borderRadius:10,marginBottom:20,textAlign:"center",background:v?ee.successBg:ee.dangerBg,border:`1px solid ${v?ee.success:ee.danger}33`},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:v?"":""}),e.jsxs("div",{style:{...Ie,fontSize:22,fontWeight:700,color:v?ee.success:ee.danger},children:[a,"%"]}),e.jsx("div",{style:{...Ie,fontSize:13,color:v?ee.success:ee.danger,marginTop:4},children:v?"Aprobado! Formacin completada.":"No aprobado. Puedes volver a intentarlo."})]}),t.map((m,f)=>{const p=o[m.id],c=s&&p===m.correcta,d=s&&p!==void 0&&p!==m.correcta;return e.jsxs("div",{style:{border:`1px solid ${s?c?ee.success+"55":d?ee.danger+"55":ee.border:ee.border}`,borderRadius:8,padding:14,marginBottom:10,background:"#fff"},children:[e.jsxs("div",{style:{...Ie,fontSize:12,fontWeight:600,color:ee.ink,marginBottom:10},children:[f+1,". ",m.texto]}),m.opciones.map((l,x)=>{if(!l)return null;const y=p===x,g=s&&x===m.correcta;let S=y?ee.accentBg:"transparent",A=y?ee.accent:ee.border;return s&&(g?(S=ee.successBg,A=ee.success):y&&!g&&(S=ee.dangerBg,A=ee.danger)),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",padding:"6px 10px",borderRadius:6,marginBottom:4,cursor:s?"default":"pointer",border:`1px solid ${A}`,background:S,transition:"all .15s"},onClick:()=>h(m.id,x),children:[e.jsx("input",{type:"radio",name:`take_${m.id}`,checked:y,readOnly:!0,style:{accentColor:s?g?ee.success:ee.danger:ee.accent}}),e.jsx("span",{style:{...Ie,fontSize:12,color:ee.ink},children:l}),s&&g&&e.jsx("span",{style:{marginLeft:"auto",fontSize:12},children:""})]},x)})]},m.id)}),!s&&e.jsx("button",{onClick:b,disabled:j<C,style:{...Ie,padding:"10px 28px",fontSize:13,fontWeight:700,color:"#fff",background:j<C?ee.inkLight:ee.accent,border:"none",borderRadius:8,cursor:j<C?"not-allowed":"pointer",marginTop:10},children:"Enviar respuestas"})]})}function ux({curso:t,trabajador:i,fecha:o,score:n}){return e.jsxs("div",{style:{border:`2px solid ${ee.accent}`,borderRadius:12,padding:40,textAlign:"center",background:"linear-gradient(135deg, #FFFFFF 0%, #EBEBEB 100%)",maxWidth:600,margin:"0 auto"},children:[e.jsx("div",{style:{fontSize:12,letterSpacing:3,color:ee.inkLight,textTransform:"uppercase",marginBottom:8},children:"Certificado de formacin"}),e.jsx("div",{style:{width:60,height:2,background:ee.accent,margin:"0 auto 20px"}}),e.jsx("div",{style:{...Ie,fontSize:10,color:ee.inkLight,marginBottom:4},children:"Se certifica que"}),e.jsx("div",{style:{...Ie,fontSize:22,fontWeight:700,color:ee.ink,marginBottom:16},children:i}),e.jsx("div",{style:{...Ie,fontSize:10,color:ee.inkLight,marginBottom:4},children:"ha completado satisfactoriamente la formacin"}),e.jsx("div",{style:{...Ie,fontSize:16,fontWeight:600,color:ee.accent,marginBottom:8},children:t.nombre}),e.jsxs("div",{style:{...Ie,fontSize:11,color:ee.inkMid,marginBottom:4},children:["Duracin: ",os(t.duracionMin)]}),n!=null&&e.jsxs("div",{style:{...Ie,fontSize:11,color:ee.inkMid,marginBottom:4},children:["Calificacin: ",n,"%"]}),t.normativa&&t.normativa!==""&&t.normativa!=="Procedimiento interno"&&e.jsxs("div",{style:{...Ie,fontSize:10,color:ee.inkLight,marginBottom:16},children:["Normativa: ",t.normativa]}),e.jsx("div",{style:{...Ie,fontSize:12,color:ee.ink,marginTop:20},children:ns(o)}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:30,paddingTop:20,borderTop:`1px solid ${ee.border}`},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:120,borderBottom:`1px solid ${ee.ink}`,marginBottom:4}}),e.jsx("div",{style:{...Ie,fontSize:9,color:ee.inkLight},children:"Responsable de Formacin"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:120,borderBottom:`1px solid ${ee.ink}`,marginBottom:4}}),e.jsx("div",{style:{...Ie,fontSize:9,color:ee.inkLight},children:"Gerencia"})]})]})]})}function gx(){const[t,i]=F.useState("catalogo"),[o,n]=F.useState(()=>Wr("cursos")||rx),[s,r]=F.useState(()=>Wr("asignaciones")||[]),[a,u]=F.useState(()=>Wr("completados")||[]),[h,b]=F.useState(()=>Wr("trabajadores")||[{id:"t1",nombre:"Ana Garca",cargo:"Diseadora de interiores",roles:["diseadores","oficina","todos"],pais:"CO"},{id:"t2",nombre:"Carlos Lpez",cargo:"Arquitecto",roles:["arquitectos","oficina","todos"],pais:"CO"},{id:"t3",nombre:"Mara Rodrguez",cargo:"Supervisora de obra",roles:["supervisores","obra","todos","brigadistas"],pais:"CO"},{id:"t4",nombre:"Pedro Martnez",cargo:"Instalador",roles:["instaladores","obra","todos"],pais:"CO"},{id:"t5",nombre:"Laura Snchez",cargo:"Administrativa",roles:["administrativos","oficina","todos"],pais:"CO"},{id:"t6",nombre:"David Torres",cargo:"Comercial",roles:["comercial","oficina","todos"],pais:"CO"}]),[j,C]=F.useState("CO"),[v,m]=F.useState("all"),[f,p]=F.useState(""),[c,d]=F.useState(null),[l,x]=F.useState(null),[y,g]=F.useState(null),[S,A]=F.useState(null),[E,w]=F.useState(null);F.useEffect(()=>Nr("cursos",o),[o]),F.useEffect(()=>Nr("asignaciones",s),[s]),F.useEffect(()=>Nr("completados",a),[a]),F.useEffect(()=>Nr("trabajadores",h),[h]);const I=F.useMemo(()=>o.filter(M=>{if(M.pais!==j||v!=="all"&&M.cat!==v)return!1;if(f){const O=f.toLowerCase();return M.nombre.toLowerCase().includes(O)||M.desc.toLowerCase().includes(O)||(M.normativa||"").toLowerCase().includes(O)}return!0}),[o,j,v,f]),z=F.useMemo(()=>{const M=h.filter(N=>N.pais===j),O=o.filter(N=>N.pais===j),ne=O.filter(N=>N.obligatorio);let ie=0,re=0,H=0,se=0;return M.forEach(N=>{const G=s.filter(ue=>ue.trabajadorId===N.id);ie+=G.length,G.forEach(ue=>{const he=a.find(we=>we.asignacionId===ue.id);if(he&&(re++,he.vencimiento)){const we=Di(he.vencimiento);we<0?se++:we<=60&&H++}})}),{trabajadores:M.length,cursos:O.length,obligatorios:ne.length,asignados:ie,completados:re,porVencer:H,vencidos:se,pctComp:ie?Math.round(re/ie*100):0}},[h,o,s,a,j]),B=(M,O)=>{s.find(ie=>ie.cursoId===M&&ie.trabajadorId===O)||r(ie=>[...ie,{id:is(),cursoId:M,trabajadorId:O,fechaAsignacion:new Date().toISOString()}])},P=()=>{const M=o.filter(ie=>ie.pais===j&&ie.obligatorio),O=h.filter(ie=>ie.pais===j);let ne=0;M.forEach(ie=>{O.forEach(re=>{ie.aplica.some(se=>se==="todos"||re.roles.includes(se))&&(s.find(N=>N.cursoId===ie.id&&N.trabajadorId===re.id)||(B(ie.id,re.id),ne++))})}),alert(ne?` Se asignaron ${ne} formaciones automticamente`:" Todas las formaciones obligatorias ya estn asignadas")},q=(M,O)=>{const ne=s.find(se=>se.id===M);if(!ne)return;const ie=o.find(se=>se.id===ne.cursoId),re=ie!=null&&ie.vigenciaMeses?ax(new Date,ie.vigenciaMeses):null,H={id:is(),asignacionId:M,cursoId:ne.cursoId,trabajadorId:ne.trabajadorId,fecha:new Date().toISOString(),score:O,vencimiento:re};u(se=>[...se.filter(N=>N.asignacionId!==M),H])},U=()=>{var ie;const M=c?o.find(re=>re.id===c):null;if(!M)return null;const O=s.filter(re=>re.cursoId===M.id),ne=Wn.find(re=>re.id===M.cat);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>d(null),children:e.jsxs("div",{onClick:re=>re.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:6},children:[e.jsxs(ii,{color:ne==null?void 0:ne.color,bg:(ne==null?void 0:ne.color)+"18",children:[ne==null?void 0:ne.icon," ",ne==null?void 0:ne.label]}),M.obligatorio&&e.jsx(ii,{color:ee.danger,bg:ee.dangerBg,children:"Obligatorio"}),e.jsx(ii,{color:ee.inkLight,bg:ee.bg,children:M.pais==="CO"?" Colombia":" Espaa"})]}),e.jsx("h2",{style:{...Ie,fontSize:20,fontWeight:700,color:ee.ink,margin:0},children:M.nombre})]}),e.jsx("button",{onClick:()=>d(null),style:{...Ie,fontSize:18,color:ee.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...Ie,fontSize:13,color:ee.inkMid,lineHeight:1.6,marginBottom:12},children:M.desc}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsxs("div",{style:{padding:12,background:ee.surface,borderRadius:8},children:[e.jsx("div",{style:{...Ie,fontSize:10,color:ee.inkLight,marginBottom:2},children:"Duracin"}),e.jsx("div",{style:{...Ie,fontSize:14,fontWeight:600,color:ee.ink},children:os(M.duracionMin)})]}),e.jsxs("div",{style:{padding:12,background:ee.surface,borderRadius:8},children:[e.jsx("div",{style:{...Ie,fontSize:10,color:ee.inkLight,marginBottom:2},children:"Vigencia"}),e.jsx("div",{style:{...Ie,fontSize:14,fontWeight:600,color:ee.ink},children:M.vigenciaMeses?`${M.vigenciaMeses} meses`:"Sin vencimiento"})]})]}),M.normativa&&M.normativa!==""&&e.jsxs("div",{style:{padding:10,background:ee.infoBg,borderRadius:8,marginBottom:12},children:[e.jsx("span",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.info},children:" Normativa: "}),e.jsx("span",{style:{...Ie,fontSize:11,color:ee.info},children:M.normativa})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{...Ie,fontSize:11,fontWeight:600,color:ee.inkMid,marginBottom:4},children:"Contenido temtico:"}),e.jsx("p",{style:{...Ie,fontSize:12,color:ee.inkMid,lineHeight:1.6,margin:0},children:M.contenido})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{...Ie,fontSize:11,fontWeight:600,color:ee.inkMid,marginBottom:4},children:"Aplica a:"}),e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:M.aplica.map(re=>{const H=sx.find(se=>se.id===re);return e.jsx(ii,{color:ee.inkMid,bg:ee.bg,children:(H==null?void 0:H.label)||re},re)})})]}),e.jsxs("div",{style:{border:`1px dashed ${ee.border}`,borderRadius:8,padding:16,textAlign:"center",marginBottom:16},children:[e.jsx("div",{style:{fontSize:28,marginBottom:6},children:""}),e.jsx("div",{style:{...Ie,fontSize:12,color:ee.inkLight},children:"Material del curso (vdeos, PDFs, presentaciones)"}),e.jsx("div",{style:{...Ie,fontSize:10,color:ee.inkLight,marginTop:4},children:"Sube contenido desde la pestaa de edicin del curso"})]}),((ie=M.preguntas)==null?void 0:ie.length)>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{...Ie,fontSize:12,fontWeight:600,color:ee.ink,marginBottom:8},children:[" Cuestionario (",M.preguntas.length," preguntas)"]}),e.jsx("p",{style:{...Ie,fontSize:11,color:ee.inkLight},children:"Los trabajadores deben aprobar con mnimo 70% para completar la formacin."})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs("div",{style:{...Ie,fontSize:12,fontWeight:600,color:ee.ink,marginBottom:10},children:[" Trabajadores asignados (",O.length,")"]}),O.length===0&&e.jsx("p",{style:{...Ie,fontSize:11,color:ee.inkLight},children:"Ningn trabajador asignado an."}),O.map(re=>{const H=h.find(ue=>ue.id===re.trabajadorId),se=a.find(ue=>ue.asignacionId===re.id),N=(se==null?void 0:se.vencimiento)&&Di(se.vencimiento)<0,G=(se==null?void 0:se.vencimiento)&&Di(se.vencimiento)>=0&&Di(se.vencimiento)<=60;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 0",borderBottom:`1px solid ${ee.border}`},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:ee.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:600,color:ee.accent},children:((H==null?void 0:H.nombre)||"?")[0]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ie,fontSize:12,fontWeight:600,color:ee.ink},children:H==null?void 0:H.nombre}),e.jsx("div",{style:{...Ie,fontSize:10,color:ee.inkLight},children:H==null?void 0:H.cargo})]}),se?e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(ii,{color:N?ee.danger:G?ee.warning:ee.success,bg:N?ee.dangerBg:G?ee.warningBg:ee.successBg,children:N?" Vencido":G?" Por vencer":` ${se.score||100}%`}),e.jsxs("div",{style:{...Ie,fontSize:9,color:ee.inkLight,marginTop:2},children:[ns(se.fecha),se.vencimiento&&`  ${ns(se.vencimiento)}`]})]}):e.jsx(ii,{color:ee.warning,bg:ee.warningBg,children:" Pendiente"})]},re.id)})]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:20},children:e.jsx("button",{onClick:()=>{g({...M}),d(null)},style:{...Ie,padding:"8px 20px",fontSize:12,fontWeight:600,color:ee.accent,background:ee.accentBg,border:`1px solid ${ee.accent}33`,borderRadius:6,cursor:"pointer"},children:" Editar curso"})})]})})},$=()=>{if(!y)return null;const M=!o.find(ie=>ie.id===y.id),O=(ie,re)=>g(H=>({...H,[ie]:re})),ne=()=>{n(M?ie=>[...ie,y]:ie=>ie.map(re=>re.id===y.id?y:re)),g(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>g(null),children:e.jsxs("div",{onClick:ie=>ie.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:680,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Ie,fontSize:18,fontWeight:700,color:ee.ink,marginBottom:16},children:M?" Nuevo curso":" Editar curso"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Pas"}),e.jsxs("select",{value:y.pais,onChange:ie=>O("pais",ie.target.value),style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5},children:[e.jsx("option",{value:"CO",children:" Colombia"}),e.jsx("option",{value:"ES",children:" Espaa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Categora"}),e.jsx("select",{value:y.cat,onChange:ie=>O("cat",ie.target.value),style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5},children:Wn.map(ie=>e.jsxs("option",{value:ie.id,children:[ie.icon," ",ie.label]},ie.id))})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Nombre del curso"}),e.jsx("input",{value:y.nombre||"",onChange:ie=>O("nombre",ie.target.value),style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:y.desc||"",onChange:ie=>O("desc",ie.target.value),rows:3,style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Contenido temtico"}),e.jsx("textarea",{value:y.contenido||"",onChange:ie=>O("contenido",ie.target.value),rows:3,style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Duracin (min)"}),e.jsx("input",{type:"number",value:y.duracionMin||"",onChange:ie=>O("duracionMin",parseInt(ie.target.value)||0),style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Vigencia (meses, 0=sin venc.)"}),e.jsx("input",{type:"number",value:y.vigenciaMeses||0,onChange:ie=>O("vigenciaMeses",parseInt(ie.target.value)||0),style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Normativa"}),e.jsx("input",{value:y.normativa||"",onChange:ie=>O("normativa",ie.target.value),style:{...Ie,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ee.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginBottom:12},children:[e.jsxs("label",{style:{...Ie,display:"flex",gap:6,alignItems:"center",fontSize:12,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:y.obligatorio||!1,onChange:ie=>O("obligatorio",ie.target.checked),style:{accentColor:ee.accent}}),"Formacin obligatoria"]}),e.jsxs("label",{style:{...Ie,display:"flex",gap:6,alignItems:"center",fontSize:12,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:y.renovable||!1,onChange:ie=>O("renovable",ie.target.checked),style:{accentColor:ee.accent}}),"Renovable peridicamente"]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{...Ie,fontSize:10,fontWeight:600,color:ee.inkLight},children:"Material (URLs de vdeo/documentos, uno por lnea)"}),e.jsx("textarea",{value:(y.material||[]).join(`
`),rows:3,onChange:ie=>O("material",ie.target.value.split(`
`).filter(re=>re.trim())),placeholder:`https://youtube.com/watch?v=...
https://drive.google.com/file/...`,style:{...Ie,width:"100%",padding:"7px 10px",fontSize:11,border:`1px solid ${ee.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsx(cx,{preguntas:y.preguntas||[],onChange:ie=>O("preguntas",ie)}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>g(null),style:{...Ie,padding:"8px 20px",fontSize:12,color:ee.inkMid,background:ee.bg,border:`1px solid ${ee.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:ne,style:{...Ie,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ee.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},Y=()=>{const M=l?h.find(ie=>ie.id===l):null;if(!M)return null;const O=s.filter(ie=>ie.trabajadorId===M.id),ne=a.filter(ie=>ie.trabajadorId===M.id);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>x(null),children:e.jsxs("div",{onClick:ie=>ie.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",gap:14,alignItems:"center"},children:[e.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:ee.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,color:ee.accent},children:M.nombre[0]}),e.jsxs("div",{children:[e.jsx("h2",{style:{...Ie,fontSize:18,fontWeight:700,color:ee.ink,margin:0},children:M.nombre}),e.jsx("div",{style:{...Ie,fontSize:12,color:ee.inkLight},children:M.cargo}),e.jsx("div",{style:{display:"flex",gap:4,marginTop:4},children:M.roles.map(ie=>e.jsx(ii,{color:ee.inkMid,bg:ee.bg,children:ie},ie))})]})]}),e.jsx("button",{onClick:()=>x(null),style:{...Ie,fontSize:18,color:ee.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{...Ie,fontSize:11,fontWeight:600,color:ee.inkMid},children:"Progreso formativo"}),e.jsxs("span",{style:{...Ie,fontSize:11,fontWeight:600,color:ee.accent},children:[ne.length,"/",O.length," completadas"]})]}),e.jsx("div",{style:{height:8,background:ee.bg,borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${O.length?ne.length/O.length*100:0}%`,background:ee.accent,borderRadius:4,transition:"width .3s"}})})]}),O.map(ie=>{var ue;const re=o.find(he=>he.id===ie.cursoId),H=a.find(he=>he.asignacionId===ie.id),se=Wn.find(he=>he.id===(re==null?void 0:re.cat)),N=(H==null?void 0:H.vencimiento)&&Di(H.vencimiento)<0,G=(H==null?void 0:H.vencimiento)&&Di(H.vencimiento)>=0&&Di(H.vencimiento)<=60;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:`1px solid ${ee.border}`},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:8,background:(se==null?void 0:se.color)+"18",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:se==null?void 0:se.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ie,fontSize:12,fontWeight:600,color:ee.ink},children:re==null?void 0:re.nombre}),e.jsxs("div",{style:{...Ie,fontSize:10,color:ee.inkLight},children:[os(re==null?void 0:re.duracionMin),"  ",re==null?void 0:re.normativa]})]}),e.jsx("div",{style:{display:"flex",gap:6,alignItems:"center"},children:H?e.jsxs(e.Fragment,{children:[e.jsx(ii,{color:N?ee.danger:G?ee.warning:ee.success,bg:N?ee.dangerBg:G?ee.warningBg:ee.successBg,children:N?"Vencido":G?`Vence ${ns(H.vencimiento)}`:` ${H.score||100}%`}),e.jsx("button",{onClick:()=>w(H),title:"Ver certificado",style:{...Ie,padding:"4px 8px",fontSize:10,color:ee.accent,background:ee.accentBg,border:`1px solid ${ee.accent}33`,borderRadius:4,cursor:"pointer"},children:""})]}):e.jsxs(e.Fragment,{children:[e.jsx(ii,{color:ee.warning,bg:ee.warningBg,children:"Pendiente"}),((ue=re==null?void 0:re.preguntas)==null?void 0:ue.length)>0?e.jsx("button",{onClick:()=>{A({cursoId:re.id,trabajadorId:M.id,asignacionId:ie.id}),x(null)},style:{...Ie,padding:"4px 10px",fontSize:10,fontWeight:600,color:"#fff",background:ee.accent,border:"none",borderRadius:4,cursor:"pointer"},children:" Evaluar"}):e.jsx("button",{onClick:()=>q(ie.id,100),style:{...Ie,padding:"4px 10px",fontSize:10,fontWeight:600,color:"#fff",background:ee.accent,border:"none",borderRadius:4,cursor:"pointer"},children:" Completar"})]})})]},ie.id)}),O.length===0&&e.jsx("p",{style:{...Ie,fontSize:12,color:ee.inkLight,textAlign:"center",padding:20},children:"No tiene formaciones asignadas"})]})})},ge=()=>{var ne;if(!S)return null;const M=o.find(ie=>ie.id===S.cursoId),O=h.find(ie=>ie.id===S.trabajadorId);return(ne=M==null?void 0:M.preguntas)!=null&&ne.length?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>A(null),children:e.jsxs("div",{onClick:ie=>ie.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsxs("h2",{style:{...Ie,fontSize:16,fontWeight:700,color:ee.ink,marginBottom:4},children:[" Evaluacin: ",M.nombre]}),e.jsxs("p",{style:{...Ie,fontSize:12,color:ee.inkLight,marginBottom:20},children:["Trabajador: ",O==null?void 0:O.nombre]}),e.jsx(px,{preguntas:M.preguntas,onComplete:ie=>{ie>=70&&q(S.asignacionId,ie)}}),e.jsx("button",{onClick:()=>A(null),style:{...Ie,marginTop:16,padding:"8px 20px",fontSize:12,color:ee.inkMid,background:ee.bg,border:`1px solid ${ee.border}`,borderRadius:6,cursor:"pointer"},children:"Cerrar"})]})}):null},J=()=>{if(!E)return null;const M=o.find(ne=>ne.id===E.cursoId),O=h.find(ne=>ne.id===E.trabajadorId);return!M||!O?null:e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>w(null),children:e.jsxs("div",{onClick:ne=>ne.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:680,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx(ux,{curso:M,trabajador:O.nombre,fecha:E.fecha,score:E.score}),e.jsx("div",{style:{textAlign:"center",marginTop:20},children:e.jsx("button",{onClick:()=>w(null),style:{...Ie,padding:"8px 24px",fontSize:12,color:ee.inkMid,background:ee.bg,border:`1px solid ${ee.border}`,borderRadius:6,cursor:"pointer"},children:"Cerrar"})})]})})},ye=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:16},children:[e.jsx("div",{style:{display:"flex",gap:2},children:[["CO"," Colombia"],["ES"," Espaa"]].map(([M,O])=>e.jsx("button",{onClick:()=>C(M),style:{...Ie,padding:"6px 14px",fontSize:11,fontWeight:j===M?700:500,color:j===M?"#fff":ee.inkMid,background:j===M?ee.accent:ee.surface,border:`1px solid ${j===M?ee.accent:ee.border}`,borderRadius:6,cursor:"pointer"},children:O},M))}),e.jsxs("select",{value:v,onChange:M=>m(M.target.value),style:{...Ie,padding:"6px 12px",fontSize:11,border:`1px solid ${ee.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todas las categoras"}),Wn.map(M=>e.jsxs("option",{value:M.id,children:[M.icon," ",M.label]},M.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx(dx,{value:f,onChange:p,placeholder:"Buscar por nombre, normativa"})}),e.jsx("button",{onClick:()=>g({id:is(),pais:j,cat:"operativo",nombre:"",desc:"",contenido:"",normativa:"",duracionMin:60,vigenciaMeses:0,obligatorio:!1,renovable:!1,aplica:["todos"],preguntas:[],material:[]}),style:{...Ie,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:ee.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo curso"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"},children:[{label:"Total cursos",val:z.cursos,icon:""},{label:"Obligatorios",val:z.obligatorios,icon:""},{label:"Completados",val:`${z.pctComp}%`,icon:""},{label:"Vencidos",val:z.vencidos,icon:"",danger:z.vencidos>0},{label:"Por vencer",val:z.porVencer,icon:"",warning:z.porVencer>0}].map((M,O)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"12px 16px",background:M.danger?ee.dangerBg:M.warning?ee.warningBg:"#fff",border:`1px solid ${M.danger?ee.danger+"33":M.warning?ee.warning+"33":ee.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...Ie,fontSize:10,color:ee.inkLight},children:[M.icon," ",M.label]}),e.jsx("div",{style:{...Ie,fontSize:20,fontWeight:700,color:M.danger?ee.danger:M.warning?ee.warning:ee.ink},children:M.val})]},O))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px,1fr))",gap:12},children:I.map(M=>{var re;const O=Wn.find(H=>H.id===M.cat),ne=s.filter(H=>H.cursoId===M.id).length,ie=a.filter(H=>H.cursoId===M.id).length;return e.jsxs(Kl,{onClick:()=>d(M.id),style:{borderLeft:`3px solid ${(O==null?void 0:O.color)||ee.accent}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(ii,{color:O==null?void 0:O.color,bg:(O==null?void 0:O.color)+"18",children:[O==null?void 0:O.icon," ",O==null?void 0:O.label]}),M.obligatorio&&e.jsx(ii,{color:ee.danger,bg:ee.dangerBg,children:"Obligatorio"})]}),e.jsx("div",{style:{...Ie,fontSize:14,fontWeight:700,color:ee.ink,marginBottom:4},children:M.nombre}),e.jsx("div",{style:{...Ie,fontSize:11,color:ee.inkLight,lineHeight:1.5,marginBottom:10,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:M.desc}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{...Ie,fontSize:10,color:ee.inkLight},children:[" ",os(M.duracionMin),"  ",M.vigenciaMeses?` ${M.vigenciaMeses}m`:""]}),e.jsxs("div",{style:{...Ie,fontSize:10,color:ee.inkMid},children:[" ",ne,"   ",ie]})]}),((re=M.preguntas)==null?void 0:re.length)>0&&e.jsxs("div",{style:{...Ie,fontSize:9,color:ee.accent,marginTop:6},children:[" ",M.preguntas.length," preguntas"]})]},M.id)})}),I.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:ee.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Ie,fontSize:13},children:"No se encontraron cursos con los filtros seleccionados"})]})]}),oe=()=>{const M=h.filter(O=>O.pais===j);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:16},children:[e.jsx("div",{style:{display:"flex",gap:2},children:[["CO",""],["ES",""]].map(([O,ne])=>e.jsx("button",{onClick:()=>C(O),style:{...Ie,padding:"6px 14px",fontSize:11,fontWeight:j===O?700:500,color:j===O?"#fff":ee.inkMid,background:j===O?ee.accent:ee.surface,border:`1px solid ${j===O?ee.accent:ee.border}`,borderRadius:6,cursor:"pointer"},children:ne},O))}),e.jsx("button",{onClick:P,style:{...Ie,padding:"7px 16px",fontSize:11,fontWeight:600,color:ee.info,background:ee.infoBg,border:`1px solid ${ee.info}33`,borderRadius:6,cursor:"pointer"},children:" Auto-asignar obligatorias"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px,1fr))",gap:12},children:M.map(O=>{const ne=s.filter(se=>se.trabajadorId===O.id),ie=a.filter(se=>se.trabajadorId===O.id),re=ie.filter(se=>se.vencimiento&&Di(se.vencimiento)<0).length,H=ne.length?Math.round(ie.length/ne.length*100):0;return e.jsxs(Kl,{onClick:()=>x(O.id),children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginBottom:12},children:[e.jsx("div",{style:{width:44,height:44,borderRadius:"50%",background:ee.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,color:ee.accent},children:O.nombre[0]}),e.jsxs("div",{children:[e.jsx("div",{style:{...Ie,fontSize:14,fontWeight:700,color:ee.ink},children:O.nombre}),e.jsx("div",{style:{...Ie,fontSize:11,color:ee.inkLight},children:O.cargo})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[e.jsxs("span",{style:{...Ie,fontSize:10,color:ee.inkLight},children:[ie.length,"/",ne.length," completadas"]}),e.jsxs("span",{style:{...Ie,fontSize:10,fontWeight:600,color:H===100?ee.success:H>50?ee.warning:ee.danger},children:[H,"%"]})]}),e.jsx("div",{style:{height:6,background:ee.bg,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${H}%`,background:H===100?ee.success:H>50?"#D4840A":ee.danger,borderRadius:3,transition:"width .3s"}})})]}),re>0&&e.jsxs(ii,{color:ee.danger,bg:ee.dangerBg,children:[" ",re," vencida(s)"]})]},O.id)})}),M.length===0&&e.jsx("div",{style:{textAlign:"center",padding:40,color:ee.inkLight},children:e.jsx("p",{style:{...Ie,fontSize:13},children:"No hay trabajadores registrados para este pas. Vinclalos desde RRHH."})})]})},L=()=>{const M=[];return s.forEach(O=>{const ne=a.find(H=>H.asignacionId===O.id),ie=o.find(H=>H.id===O.cursoId),re=h.find(H=>H.id===O.trabajadorId);if(!(!ie||!re||ie.pais!==j)){if(!ne)M.push({tipo:"pendiente",curso:ie,trab:re,asig:O,prioridad:ie.obligatorio?1:3});else if(ne.vencimiento){const H=Di(ne.vencimiento);H<0?M.push({tipo:"vencido",curso:ie,trab:re,comp:ne,dias:Math.abs(H),prioridad:0}):H<=60&&M.push({tipo:"por_vencer",curso:ie,trab:re,comp:ne,dias:H,prioridad:2})}}}),M.sort((O,ne)=>O.prioridad-ne.prioridad),e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:2,marginBottom:16},children:[["CO",""],["ES",""]].map(([O,ne])=>e.jsx("button",{onClick:()=>C(O),style:{...Ie,padding:"6px 14px",fontSize:11,fontWeight:j===O?700:500,color:j===O?"#fff":ee.inkMid,background:j===O?ee.accent:ee.surface,border:`1px solid ${j===O?ee.accent:ee.border}`,borderRadius:6,cursor:"pointer"},children:ne},O))}),M.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:40,marginBottom:8},children:""}),e.jsx("p",{style:{...Ie,fontSize:14,color:ee.success,fontWeight:600},children:"Todo al da"}),e.jsx("p",{style:{...Ie,fontSize:12,color:ee.inkLight},children:"No hay formaciones pendientes, vencidas ni por vencer."})]}):e.jsx("div",{children:M.map((O,ne)=>{const ie={vencido:ee.dangerBg,por_vencer:ee.warningBg,pendiente:ee.infoBg},re={vencido:ee.danger,por_vencer:ee.warning,pendiente:ee.info},H={vencido:"",por_vencer:"",pendiente:""},se={vencido:`Vencido hace ${O.dias} das`,por_vencer:`Vence en ${O.dias} das`,pendiente:"Pendiente de completar"};return e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:ie[O.tipo],border:`1px solid ${re[O.tipo]}22`,borderRadius:8,marginBottom:8},children:[e.jsx("span",{style:{fontSize:20},children:H[O.tipo]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ie,fontSize:12,fontWeight:600,color:ee.ink},children:O.curso.nombre}),e.jsxs("div",{style:{...Ie,fontSize:11,color:ee.inkMid},children:[O.trab.nombre,"  ",O.trab.cargo]})]}),e.jsx(ii,{color:re[O.tipo],bg:"rgba(255,255,255,.7)",children:se[O.tipo]}),O.curso.obligatorio&&e.jsx(ii,{color:ee.danger,bg:"rgba(255,255,255,.7)",children:"Obligatorio"})]},ne)})})]})},R=()=>{const M=j==="CO"?[{ley:"Decreto 1072/2015",desc:"Decreto nico Reglamentario del Sector Trabajo. Establece la obligatoriedad del SG-SST.",aplica:"Toda empresa"},{ley:"Resolucin 0312/2019",desc:"Estndares Mnimos del SG-SST ajustados por tamao de empresa y nivel de riesgo.",aplica:"Toda empresa"},{ley:"Resolucin 4272/2021",desc:"Requisitos mnimos de seguridad para trabajo en alturas (1.5m).",aplica:"Personal en obra"},{ley:"Resolucin 2646/2008",desc:"Factores de riesgo psicosocial en el trabajo y determinacin del origen de las patologas.",aplica:"Toda empresa"},{ley:"Ley 1616/2013",desc:"Ley de Salud Mental. Promocin de la salud mental en ambientes laborales.",aplica:"Toda empresa"},{ley:"Ley 1581/2012",desc:"Rgimen general de proteccin de datos personales (Habeas Data).",aplica:"Toda empresa que maneje datos"},{ley:"Ley 1010/2006",desc:"Medidas para prevenir, corregir y sancionar el acoso laboral.",aplica:"Toda empresa"},{ley:"Decreto 1496/2018",desc:"Sistema Globalmente Armonizado (SGA) para clasificacin y etiquetado de productos qumicos.",aplica:"Empresas con qumicos"},{ley:"Resolucin 0491/2020",desc:"Requisitos mnimos de seguridad para trabajo en espacios confinados.",aplica:"Personal en obra (si aplica)"},{ley:"RETIE",desc:"Reglamento Tcnico de Instalaciones Elctricas. Resolucin 90708/2013.",aplica:"Instaladores elctricos"},{ley:"NSR-10",desc:"Norma Sismo Resistente de Colombia. Ley 400/1997 y Decreto 926/2010.",aplica:"Arquitectos e ingenieros"}]:[{ley:"Ley 31/1995 (LPRL)",desc:"Ley de Prevencin de Riesgos Laborales. Art. 19: formacin obligatoria adaptada al puesto.",aplica:"Toda empresa"},{ley:"RD 39/1997 (RSP)",desc:"Reglamento de los Servicios de Prevencin. Niveles de formacin (bsico, intermedio, superior).",aplica:"Toda empresa"},{ley:"VI CGSC",desc:"VI Convenio General del Sector de la Construccin. Formacin por oficios (8h a 20h).",aplica:"Personal en obra"},{ley:"RD 1627/1997",desc:"Disposiciones mnimas de seguridad y salud en obras de construccin.",aplica:"Obras de construccin"},{ley:"RD 488/1997",desc:"Disposiciones sobre trabajo con pantallas de visualizacin de datos.",aplica:"Personal de oficina"},{ley:"RD 171/2004",desc:"Coordinacin de Actividades Empresariales (CAE).",aplica:"Concurrencia empresarial"},{ley:"RGPD (UE 2016/679)",desc:"Reglamento General de Proteccin de Datos de la Unin Europea.",aplica:"Toda empresa con datos"},{ley:"LO 3/2018 (LOPDGDD)",desc:"Ley Orgnica de Proteccin de Datos y Garanta de Derechos Digitales. Art. 88: desconexin digital.",aplica:"Toda empresa"},{ley:"LO 3/2007",desc:"Ley de Igualdad. Plan de igualdad obligatorio 50 empleados. Protocolo acoso sexual.",aplica:"Toda empresa"},{ley:"LO 10/2022",desc:"Ley de garanta integral de la libertad sexual. Formacin obligatoria para toda empresa.",aplica:"Toda empresa"},{ley:"Ley 4/2023",desc:"Igualdad real de personas trans y derechos LGTBI. RD 1026/2024 para 50 empleados.",aplica:"Empresas 50"},{ley:"Ley 2/2023",desc:"Proteccin del informante (Whistleblowing). Canal de denuncias obligatorio 50 empleados.",aplica:"Empresas 50"},{ley:"Ley 10/2010",desc:"Prevencin del blanqueo de capitales. Obligatorio para promotores inmobiliarios.",aplica:"Sector inmobiliario"},{ley:"RD 314/2006 (CTE)",desc:"Cdigo Tcnico de la Edificacin. Documentos bsicos aplicables a reformas.",aplica:"Arquitectos e ingenieros"},{ley:"RD 105/2008",desc:"Regulacin de residuos de construccin y demolicin (RCD).",aplica:"Obras de construccin"}];return e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:2,marginBottom:16},children:[["CO"," Colombia"],["ES"," Espaa"]].map(([O,ne])=>e.jsx("button",{onClick:()=>C(O),style:{...Ie,padding:"6px 14px",fontSize:11,fontWeight:j===O?700:500,color:j===O?"#fff":ee.inkMid,background:j===O?ee.accent:ee.surface,border:`1px solid ${j===O?ee.accent:ee.border}`,borderRadius:6,cursor:"pointer"},children:ne},O))}),e.jsx("div",{style:{background:ee.infoBg,border:`1px solid ${ee.info}22`,borderRadius:8,padding:14,marginBottom:16},children:e.jsxs("p",{style:{...Ie,fontSize:12,color:ee.info,margin:0},children:[" Referencia normativa para empresas de ",e.jsx("b",{children:"diseo, arquitectura y remodelacin"})," en ",j==="CO"?"Colombia":"Espaa",". Verifica siempre la vigencia con tu asesor legal/SST."]})}),M.map((O,ne)=>e.jsxs("div",{style:{display:"flex",gap:14,padding:"14px 0",borderBottom:`1px solid ${ee.border}`},children:[e.jsx("div",{style:{minWidth:160},children:e.jsx("div",{style:{...Ie,fontSize:12,fontWeight:700,color:ee.ink},children:O.ley})}),e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{...Ie,fontSize:12,color:ee.inkMid,lineHeight:1.5},children:O.desc})}),e.jsx("div",{style:{minWidth:130,textAlign:"right"},children:e.jsx(ii,{color:ee.inkMid,bg:ee.bg,children:O.aplica})})]},ne))]})},T=s.filter(M=>!a.find(O=>O.asignacionId===M.id)).length,W=a.filter(M=>M.vencimiento&&Di(M.vencimiento)<0).length,X=T+W;return e.jsxs("div",{style:{...Ie,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...Ie,fontSize:22,fontWeight:700,color:ee.ink,margin:"0 0 4px"},children:" Formacin"}),e.jsx("p",{style:{...Ie,fontSize:12,color:ee.inkLight,margin:0},children:"Gestin de formaciones obligatorias, operativas y corporativas"})]}),e.jsx(lx,{active:t,onChange:i,tabs:[{id:"catalogo",icon:"",label:"Catlogo de Cursos",badge:z.cursos},{id:"trabajadores",icon:"",label:"Trabajadores"},{id:"alertas",icon:"",label:"Alertas",badge:X||null},{id:"normativa",icon:"",label:"Normativa"}]}),e.jsxs("div",{style:{paddingTop:20},children:[t==="catalogo"&&ye(),t==="trabajadores"&&oe(),t==="alertas"&&L(),t==="normativa"&&R()]}),U(),$(),Y(),ge(),J()]})}const ve={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},at={fontFamily:"'DM Sans',sans-serif"},gc="hab:carnets:",hx=t=>{try{return JSON.parse(Fe.getSync(gc+t))||null}catch{return null}},fx=(t,i)=>{Fe.set(gc+t,JSON.stringify(i))},xx=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7);function yr(t,i=120,o="#111",n="transparent"){const r=i/21,a=(j,C)=>{let v=0;for(let m=0;m<j.length;m++)v=(v<<5)-v+j.charCodeAt(m)*(C+1)|0;return v};let u=[];const h=(j,C)=>{for(let v=0;v<7;v++)for(let m=0;m<7;m++){const f=m===0||m===6||v===0||v===6,p=m>=2&&m<=4&&v>=2&&v<=4;(f||p)&&u.push({x:j+m,y:C+v})}};h(0,0),h(14,0),h(0,14);for(let j=0;j<21;j++)for(let C=0;C<21;C++)!(C<8&&j<8||C>12&&j<8||C<8&&j>12)&&Math.abs(a(t,C*21+j))%3!==0&&u.push({x:C,y:j});const b=u.map(j=>`<rect x="${j.x*r}" y="${j.y*r}" width="${r}" height="${r}" fill="${o}" rx="0.5"/>`).join("");return`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${i}" viewBox="0 0 ${i} ${i}">${b}</svg>`}function mx(){var t,i,o,n,s,r,a,u,h,b,j;try{const C=JSON.parse(Fe.getSync("hab:config"))||{};return{nombre:((t=C.empresa)==null?void 0:t.nombre)||"Habitaris",nit:((i=C.empresa)==null?void 0:i.nit)||"901.922.136-8",direccion:((o=C.empresa)==null?void 0:o.direccion)||"Bogot D.C., Colombia",telefono:((n=C.empresa)==null?void 0:n.telefono)||"+57 350 566 1545",email:((s=C.empresa)==null?void 0:s.email)||"info@habitaris.co",web:((r=C.empresa)==null?void 0:r.web)||"www.habitaris.co",logo:((a=C.apariencia)==null?void 0:a.logo)||null,colorPrimario:((u=C.apariencia)==null?void 0:u.colorPrimario)||"#111111",colorAcento:((h=C.apariencia)==null?void 0:h.colorAcento)||"#111111",tipografia:((b=C.apariencia)==null?void 0:b.tipografia)||"DM Sans",slogan:((j=C.apariencia)==null?void 0:j.slogan)||"Diseo  Arquitectura  Remodelacin"}}catch{return{nombre:"Habitaris",colorPrimario:"#111",colorAcento:"#111111",tipografia:"DM Sans",slogan:"Diseo  Arquitectura  Remodelacin"}}}const bx=[{id:"e1",nombre:"Ana Garca Ruiz",cargo:"Diseadora de Interiores",departamento:"Diseo",email:"ana@habitaris.co",telefono:"+57 310 555 1234",foto:null,fechaIngreso:"2023-03-15",tipoDoc:"CC",documento:"1.020.456.789",rh:"O+",eps:"Sura",arl:"Sura"},{id:"e2",nombre:"Carlos Lpez Meja",cargo:"Arquitecto Senior",departamento:"Arquitectura",email:"carlos@habitaris.co",telefono:"+57 311 555 5678",foto:null,fechaIngreso:"2022-08-01",tipoDoc:"CC",documento:"80.456.123",rh:"A+",eps:"Compensar",arl:"Sura"},{id:"e3",nombre:"Mara Rodrguez Pea",cargo:"Directora de Obra",departamento:"Obra",email:"maria@habitaris.co",telefono:"+57 320 555 9012",foto:null,fechaIngreso:"2023-01-10",tipoDoc:"CC",documento:"52.789.456",rh:"B+",eps:"Sanitas",arl:"Positiva"},{id:"e4",nombre:"Pedro Martnez Torres",cargo:"Instalador Tcnico",departamento:"Obra",email:"pedro@habitaris.co",telefono:"+57 300 555 3456",foto:null,fechaIngreso:"2024-02-20",tipoDoc:"CC",documento:"1.098.765.432",rh:"O-",eps:"Nueva EPS",arl:"Positiva"},{id:"e5",nombre:"Laura Snchez Daz",cargo:"Gerente General",departamento:"Direccin",email:"laura@habitaris.co",telefono:"+57 315 555 7890",foto:null,fechaIngreso:"2022-01-01",tipoDoc:"CC",documento:"35.123.789",rh:"AB+",eps:"Sura",arl:"Sura"},{id:"e6",nombre:"David Torres Vargas",cargo:"Asesor Comercial",departamento:"Comercial",email:"david@habitaris.co",telefono:"+57 318 555 2345",foto:null,fechaIngreso:"2024-06-01",tipoDoc:"CC",documento:"1.015.432.876",rh:"A-",eps:"Compensar",arl:"Sura"}],Jl=[{id:"classic",label:"Clsico",desc:"Diseo limpio con franja superior de color"},{id:"modern",label:"Moderno",desc:"Degradado diagonal con tipografa bold"},{id:"minimal",label:"Minimalista",desc:"Blanco y negro con detalles de acento"},{id:"obra",label:"Obra / SST",desc:"Datos de emergencia, EPS, ARL, RH y contacto"}],Yl=[{id:"corporate",label:"Corporativa",desc:"Elegante con logo centrado y datos al reverso"},{id:"creative",label:"Creativa",desc:"Color de acento con layout asimtrico"},{id:"minimal_biz",label:"Minimalista",desc:"Tipografa limpia, mxima legibilidad"}];function yx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const s=yr(`https://${i.web}/team/${t.id}`,80,i.colorPrimario);return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:8,background:i.colorPrimario}}),e.jsxs("div",{style:{padding:"20px 24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100% - 8px)"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:s},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,textAlign:"center",lineHeight:1.5},children:[t.tipoDoc,": ",t.documento,e.jsx("br",{}),"RH: ",t.rh,"  EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),"Ingreso: ",new Date(t.fechaIngreso).toLocaleDateString("es-CO")]}),e.jsxs("div",{style:{fontSize:7,color:ve.inkLight,marginTop:8},children:["En caso de emergencia contactar al ",i.telefono]})]})]})}return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:56,background:i.colorPrimario,display:"flex",alignItems:"center",padding:"0 20px",gap:10},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:24,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:14,fontWeight:700,color:"#fff",letterSpacing:1.5},children:i.nombre.toUpperCase()})}),e.jsxs("div",{style:{padding:"14px 20px",display:"flex",gap:14},children:[e.jsx("div",{style:{width:64,height:76,borderRadius:8,background:ve.bg,border:`2px solid ${i.colorAcento}`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:28,fontWeight:700,color:i.colorAcento},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:ve.ink,marginBottom:2,lineHeight:1.2},children:t.nombre}),e.jsx("div",{style:{fontSize:10,fontWeight:600,color:i.colorAcento,marginBottom:6},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,lineHeight:1.5},children:[t.departamento,e.jsx("br",{}),t.email,e.jsx("br",{}),t.telefono]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:3,background:i.colorAcento}})]})}function vx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const s=yr(`https://${i.web}/team/${t.id}`,80,"#fff");return e.jsx("div",{style:{width:320,height:200,borderRadius:10,overflow:"hidden",background:`linear-gradient(135deg, ${i.colorPrimario} 0%, ${i.colorAcento} 100%)`,position:"relative",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:20},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:s},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,.7)",textAlign:"center",lineHeight:1.6},children:[t.tipoDoc,": ",t.documento,"  RH: ",t.rh,e.jsx("br",{}),"EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),"Emergencias: ",i.telefono]})]})})}return e.jsxs("div",{style:{width:320,height:200,borderRadius:10,overflow:"hidden",background:`linear-gradient(135deg, ${i.colorPrimario} 0%, ${i.colorAcento} 100%)`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{padding:"20px 24px",display:"flex",gap:16,height:"100%",boxSizing:"border-box"},children:[e.jsx("div",{style:{width:68,height:82,borderRadius:10,background:"rgba(255,255,255,.15)",border:"2px solid rgba(255,255,255,.3)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}):e.jsx("span",{style:{fontSize:30,fontWeight:800,color:"rgba(255,255,255,.6)"},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:800,color:"#fff",marginBottom:2,lineHeight:1.2,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:10,fontWeight:500,color:"rgba(255,255,255,.65)",marginBottom:10},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,.5)",lineHeight:1.6},children:[t.departamento,"  ",t.email,e.jsx("br",{}),t.telefono]})]})]}),e.jsx("div",{style:{position:"absolute",top:14,right:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:18,objectFit:"contain",opacity:.8}}):e.jsx("span",{style:{fontSize:10,fontWeight:700,color:"rgba(255,255,255,.4)",letterSpacing:1.5,textTransform:"uppercase"},children:i.nombre})})]})}function jx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const s=yr(`https://${i.web}/team/${t.id}`,80,ve.ink);return e.jsx("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",padding:20},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:s},style:{marginBottom:10}}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,textAlign:"center",lineHeight:1.6},children:[t.tipoDoc," ",t.documento,"  RH: ",t.rh,e.jsx("br",{}),"EPS: ",t.eps,"  ARL: ",t.arl,e.jsx("br",{}),i.telefono]})]})})}return e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{display:"flex",height:"100%"},children:[e.jsx("div",{style:{width:4,background:i.colorAcento}}),e.jsxs("div",{style:{flex:1,padding:"20px 22px",display:"flex",gap:14},children:[e.jsx("div",{style:{width:60,height:72,borderRadius:6,background:ve.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:26,fontWeight:700,color:ve.inkLight},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700,color:ve.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,marginBottom:8,textTransform:"uppercase",letterSpacing:.5},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,lineHeight:1.6},children:[t.departamento,e.jsx("br",{}),t.email,"  ",t.telefono]})]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:10,right:16,fontSize:8,fontWeight:600,color:ve.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:i.nombre})]})}function Sx({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{height:32,background:"#B91C1C",display:"flex",alignItems:"center",padding:"0 16px"},children:e.jsx("span",{style:{fontSize:10,fontWeight:700,color:"#fff",letterSpacing:1},children:" DATOS DE EMERGENCIA"})}),e.jsxs("div",{style:{padding:"10px 16px",fontSize:9,color:ve.ink,lineHeight:1.8},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"2px 10px"},children:[e.jsx("b",{children:"RH:"}),e.jsx("span",{style:{fontSize:14,fontWeight:800,color:"#B91C1C"},children:t.rh}),e.jsx("b",{children:"EPS:"}),e.jsx("span",{children:t.eps}),e.jsx("b",{children:"ARL:"}),e.jsx("span",{children:t.arl}),e.jsx("b",{children:"Doc:"}),e.jsxs("span",{children:[t.tipoDoc," ",t.documento]}),e.jsx("b",{children:"Ingreso:"}),e.jsx("span",{children:new Date(t.fechaIngreso).toLocaleDateString("es-CO")})]}),e.jsxs("div",{style:{marginTop:8,padding:"6px 10px",background:"#FFF3F3",borderRadius:4,border:"1px solid #B91C1C33"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#B91C1C"},children:"Contacto de emergencia empresa:"}),e.jsxs("div",{style:{fontSize:9,color:ve.ink},children:[i.telefono,"  ",i.email]})]})]}),e.jsxs("div",{style:{position:"absolute",bottom:6,right:10,fontSize:7,color:ve.inkLight},children:["Si encuentra esta tarjeta, devulvala a ",i.nombre]})]}):e.jsxs("div",{style:{width:320,height:200,background:"#fff",borderRadius:10,overflow:"hidden",border:`1px solid ${ve.border}`,position:"relative",fontFamily:`'${n}',sans-serif`},children:[e.jsxs("div",{style:{height:44,background:i.colorPrimario,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:20,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:12,fontWeight:700,color:"#fff",letterSpacing:1},children:i.nombre.toUpperCase()}),e.jsx("span",{style:{fontSize:8,fontWeight:600,color:"rgba(255,255,255,.5)",background:"rgba(255,255,255,.1)",padding:"2px 8px",borderRadius:3},children:"PERSONAL DE OBRA"})]}),e.jsxs("div",{style:{padding:"10px 16px",display:"flex",gap:12},children:[e.jsx("div",{style:{width:58,height:70,borderRadius:6,background:ve.bg,border:`2px solid ${i.colorAcento}`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:4}}):e.jsx("span",{style:{fontSize:24,fontWeight:700,color:i.colorAcento},children:t.nombre[0]})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:ve.ink,marginBottom:1},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,marginBottom:4},children:t.cargo}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("span",{style:{fontSize:18,fontWeight:800,color:"#B91C1C",padding:"2px 8px",background:"#FFF3F3",borderRadius:4},children:t.rh}),e.jsxs("div",{style:{fontSize:8,color:ve.inkLight,lineHeight:1.5},children:["EPS: ",t.eps,e.jsx("br",{}),"ARL: ",t.arl]})]})]})]}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:3,background:"#B91C1C"}})]})}const hc={classic:yx,modern:vx,minimal:jx,obra:Sx};function Cx({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsx("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",background:i.colorPrimario,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:`'${n}',sans-serif`},children:e.jsxs("div",{style:{textAlign:"center"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:32,objectFit:"contain",marginBottom:10}}):e.jsx("div",{style:{fontSize:18,fontWeight:800,color:"#fff",letterSpacing:2,marginBottom:6},children:i.nombre.toUpperCase()}),e.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,.45)",letterSpacing:2,textTransform:"uppercase"},children:i.slogan})]})}):e.jsxs("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${ve.border}`,fontFamily:`'${n}',sans-serif`,position:"relative"},children:[e.jsx("div",{style:{height:4,background:i.colorAcento}}),e.jsxs("div",{style:{padding:"22px 24px"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,color:ve.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,textTransform:"uppercase",letterSpacing:.8,marginBottom:14},children:t.cargo}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"3px 8px",fontSize:8,color:ve.inkMid},children:[e.jsx("span",{style:{color:ve.inkLight},children:""}),e.jsx("span",{children:t.email}),e.jsx("span",{style:{color:ve.inkLight},children:""}),e.jsx("span",{children:t.telefono}),e.jsx("span",{style:{color:ve.inkLight},children:""}),e.jsx("span",{children:i.direccion}),e.jsx("span",{style:{color:ve.inkLight},children:""}),e.jsx("span",{children:i.web})]})]}),e.jsx("div",{style:{position:"absolute",bottom:12,right:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:16,objectFit:"contain",opacity:.3}}):e.jsx("span",{style:{fontSize:8,fontWeight:700,color:ve.inkLight,letterSpacing:1.5,textTransform:"uppercase",opacity:.3},children:i.nombre})})]})}function kx({emp:t,brand:i,side:o}){const n=i.tipografia;if(o==="back"){const s=yr(`https://${i.web}/team/${t.id}`,70,"#fff");return e.jsxs("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",background:`linear-gradient(145deg, ${i.colorAcento} 0%, ${i.colorPrimario} 100%)`,fontFamily:`'${n}',sans-serif`,display:"flex",alignItems:"center",justifyContent:"center",gap:24,padding:"0 30px"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:s}}),e.jsxs("div",{style:{textAlign:"left"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:22,objectFit:"contain",marginBottom:8}}):e.jsx("div",{style:{fontSize:14,fontWeight:800,color:"#fff",letterSpacing:1.5,marginBottom:6},children:i.nombre}),e.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.5)",letterSpacing:1.5,textTransform:"uppercase",lineHeight:1.6},children:[i.slogan,e.jsx("br",{}),i.web]})]})]})}return e.jsxs("div",{style:{width:340,height:190,borderRadius:8,overflow:"hidden",position:"relative",background:"#fff",border:`1px solid ${ve.border}`,fontFamily:`'${n}',sans-serif`},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:100,height:"100%",background:`linear-gradient(180deg, ${i.colorAcento} 0%, ${i.colorPrimario} 100%)`},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("div",{style:{width:44,height:52,borderRadius:8,background:"rgba(255,255,255,.15)",border:"1.5px solid rgba(255,255,255,.25)",display:"flex",alignItems:"center",justifyContent:"center"},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:6}}):e.jsx("span",{style:{fontSize:22,fontWeight:800,color:"rgba(255,255,255,.6)"},children:t.nombre[0]})})})}),e.jsxs("div",{style:{marginLeft:112,padding:"22px 20px"},children:[e.jsx("div",{style:{fontSize:15,fontWeight:700,color:ve.ink,marginBottom:1,letterSpacing:-.3},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:600,color:i.colorAcento,textTransform:"uppercase",letterSpacing:.8,marginBottom:14},children:t.cargo}),e.jsxs("div",{style:{fontSize:8,color:ve.inkMid,lineHeight:1.8},children:[t.email,e.jsx("br",{}),t.telefono,e.jsx("br",{}),i.web]})]})]})}function wx({emp:t,brand:i,side:o}){const n=i.tipografia;return o==="back"?e.jsx("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${ve.border}`,fontFamily:`'${n}',sans-serif`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:28,objectFit:"contain",opacity:.2}}):e.jsx("div",{style:{fontSize:16,fontWeight:800,color:ve.ink,letterSpacing:3,opacity:.12},children:i.nombre.toUpperCase()}),e.jsx("div",{style:{fontSize:7,color:ve.inkLight,letterSpacing:2,textTransform:"uppercase",marginTop:8},children:i.slogan})]})}):e.jsxs("div",{style:{width:340,height:190,background:"#fff",borderRadius:8,overflow:"hidden",border:`1px solid ${ve.border}`,fontFamily:`'${n}',sans-serif`,position:"relative",padding:24,boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:[e.jsx("div",{style:{position:"absolute",top:20,right:20},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:14,objectFit:"contain",opacity:.25}}):e.jsx("span",{style:{fontSize:8,fontWeight:700,color:ve.inkLight,letterSpacing:1.5,textTransform:"uppercase",opacity:.3},children:i.nombre})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:16,fontWeight:700,color:ve.ink,marginBottom:1,letterSpacing:-.5},children:t.nombre}),e.jsx("div",{style:{fontSize:9,fontWeight:500,color:i.colorAcento,marginBottom:12},children:t.cargo}),e.jsxs("div",{style:{display:"flex",gap:16,fontSize:8,color:ve.inkLight},children:[e.jsx("span",{children:t.email}),e.jsx("span",{children:t.telefono}),e.jsx("span",{children:i.web})]})]})]})}const fc={corporate:Cx,creative:kx,minimal_biz:wx};function zx({emp:t,brand:i}){const o=i.tipografia,n=yr(`https://${i.web}/team/${t.id}`,100,i.colorAcento);return e.jsxs("div",{style:{width:320,borderRadius:16,overflow:"hidden",background:"#fff",boxShadow:"0 8px 32px rgba(0,0,0,.12)",fontFamily:`'${o}',sans-serif`},children:[e.jsxs("div",{style:{height:80,background:`linear-gradient(135deg, ${i.colorPrimario}, ${i.colorAcento})`,position:"relative",display:"flex",alignItems:"flex-end",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:12,left:16},children:i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:16,objectFit:"contain",opacity:.6}}):e.jsx("span",{style:{fontSize:9,fontWeight:700,color:"rgba(255,255,255,.5)",letterSpacing:1.5},children:i.nombre.toUpperCase()})}),e.jsx("div",{style:{width:72,height:72,borderRadius:"50%",background:"#fff",border:"3px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",transform:"translateY(36px)",boxShadow:"0 4px 12px rgba(0,0,0,.1)"},children:t.foto?e.jsx("img",{src:t.foto,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%"}}):e.jsx("span",{style:{fontSize:28,fontWeight:800,color:i.colorAcento},children:t.nombre[0]})})]}),e.jsxs("div",{style:{padding:"44px 24px 20px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:ve.ink,marginBottom:2},children:t.nombre}),e.jsx("div",{style:{fontSize:11,fontWeight:500,color:i.colorAcento,marginBottom:4},children:t.cargo}),e.jsxs("div",{style:{fontSize:10,color:ve.inkLight,marginBottom:16},children:[t.departamento,"  ",i.nombre]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"center",marginBottom:16},children:[{icon:"",label:"Email",val:t.email},{icon:"",label:"Llamar",val:t.telefono},{icon:"",label:"Web",val:i.web}].map((s,r)=>e.jsxs("div",{style:{flex:1,padding:"10px 6px",background:ve.surface,borderRadius:10,border:`1px solid ${ve.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:16,marginBottom:2},children:s.icon}),e.jsx("div",{style:{fontSize:8,fontWeight:600,color:ve.inkMid},children:s.label})]},r))}),e.jsxs("div",{style:{textAlign:"left",fontSize:10,color:ve.inkMid,lineHeight:1.8,padding:"0 8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:ve.inkLight},children:"Email"}),e.jsx("span",{children:t.email})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:ve.inkLight},children:"Telfono"}),e.jsx("span",{children:t.telefono})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:ve.inkLight},children:"Direccin"}),e.jsx("span",{children:i.direccion})]})]}),e.jsxs("div",{style:{marginTop:16,padding:16,background:ve.surface,borderRadius:12,display:"inline-block"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:n}}),e.jsx("div",{style:{fontSize:8,color:ve.inkLight,marginTop:4},children:"Escanea para guardar contacto"})]})]})]})}function Ex({empleados:t,brand:i,tipo:o,template:n}){const s=o==="carnet"?hc[n]:fc[n];return s?e.jsxs("div",{style:{background:"#fff",padding:20},children:[e.jsxs("div",{style:{...at,fontSize:11,color:ve.inkLight,marginBottom:16,textAlign:"center"},children:["Vista previa de impresin  ",t.length," ",o==="carnet"?"carnets":"tarjetas"," (frente y reverso)"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:t.map(r=>e.jsxs(hr.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{...at,fontSize:9,color:ve.inkLight,marginBottom:4},children:["Frente  ",r.nombre]}),e.jsx(s,{emp:r,brand:i,side:"front"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{...at,fontSize:9,color:ve.inkLight,marginBottom:4},children:"Reverso"}),e.jsx(s,{emp:r,brand:i,side:"back"})]})]},r.id))})]}):null}function Ax(){const t=F.useMemo(()=>mx(),[]),[i,o]=F.useState("carnets"),[n,s]=F.useState(()=>hx("empleados")||bx),[r,a]=F.useState(null),[u,h]=F.useState("classic"),[b,j]=F.useState("corporate"),[C,v]=F.useState("front"),[m,f]=F.useState(!1),[p,c]=F.useState([]),[d,l]=F.useState(null),[x,y]=F.useState("");F.useEffect(()=>fx("empleados",n),[n]);const g=F.useMemo(()=>{if(!x)return n;const q=x.toLowerCase();return n.filter(U=>U.nombre.toLowerCase().includes(q)||U.cargo.toLowerCase().includes(q)||U.departamento.toLowerCase().includes(q))},[n,x]),S=r?n.find(q=>q.id===r):g[0],A=q=>{c(U=>U.includes(q)?U.filter($=>$!==q):[...U,q])},E=[{id:"carnets",icon:"",label:"Carnets Corporativos"},{id:"tarjetas",icon:"",label:"Tarjetas de Visita"},{id:"virtual",icon:"",label:"Tarjeta Virtual"},{id:"empleados",icon:"",label:"Empleados"}],w=()=>{if(!d)return null;const q=!n.find(ge=>ge.id===d.id),U=(ge,J)=>l(ye=>({...ye,[ge]:J})),$=()=>{s(q?ge=>[...ge,d]:ge=>ge.map(J=>J.id===d.id?d:J)),l(null)},Y=[["nombre","Nombre completo","text"],["cargo","Cargo","text"],["departamento","Departamento","text"],["email","Email corporativo","email"],["telefono","Telfono","tel"],["tipoDoc","Tipo documento","text"],["documento","N documento","text"],["rh","Grupo sanguneo","text"],["eps","EPS","text"],["arl","ARL","text"],["fechaIngreso","Fecha ingreso","date"]];return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>l(null),children:e.jsxs("div",{onClick:ge=>ge.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:520,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...at,fontSize:16,fontWeight:700,color:ve.ink,marginBottom:16},children:q?" Nuevo empleado":" Editar empleado"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:Y.map(([ge,J,ye])=>e.jsxs("div",{style:{gridColumn:ge==="nombre"?"1 / -1":void 0},children:[e.jsx("label",{style:{...at,fontSize:10,fontWeight:600,color:ve.inkLight},children:J}),e.jsx("input",{type:ye,value:d[ge]||"",onChange:oe=>U(ge,oe.target.value),style:{...at,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})]},ge))}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("label",{style:{...at,fontSize:10,fontWeight:600,color:ve.inkLight},children:"Foto (URL)"}),e.jsx("input",{value:d.foto||"",onChange:ge=>U("foto",ge.target.value),placeholder:"https://ejemplo.com/foto.jpg",style:{...at,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>l(null),style:{...at,padding:"8px 20px",fontSize:12,color:ve.inkMid,background:ve.bg,border:`1px solid ${ve.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:$,style:{...at,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ve.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},I=()=>{var U;const q=hc[u];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[Jl.map($=>e.jsx("button",{onClick:()=>h($.id),style:{...at,padding:"8px 16px",fontSize:11,fontWeight:u===$.id?700:500,color:u===$.id?"#fff":ve.inkMid,background:u===$.id?ve.accent:ve.surface,border:`1px solid ${u===$.id?ve.accent:ve.border}`,borderRadius:6,cursor:"pointer"},children:$.label},$.id)),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>v($=>$==="front"?"back":"front"),style:{...at,padding:"8px 14px",fontSize:11,color:ve.info,background:ve.infoBg,border:`1px solid ${ve.info}33`,borderRadius:6,cursor:"pointer"},children:[" ",C==="front"?"Ver reverso":"Ver frente"]}),e.jsx("button",{onClick:()=>f(!m),style:{...at,padding:"8px 14px",fontSize:11,fontWeight:600,color:m?ve.danger:ve.inkMid,background:m?ve.dangerBg:ve.surface,border:`1px solid ${m?ve.danger+"33":ve.border}`,borderRadius:6,cursor:"pointer"},children:m?" Cancelar lote":" Imprimir lote"})]}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:x,onChange:$=>y($.target.value),placeholder:"Buscar",style:{...at,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})}),g.map($=>e.jsxs("div",{onClick:()=>{a($.id),m&&A($.id)},style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,transition:"all .1s",background:r===$.id?ve.accentBg:p.includes($.id)?ve.infoBg:"transparent",border:`1px solid ${r===$.id?ve.accent+"33":"transparent"}`},children:[m&&e.jsx("input",{type:"checkbox",checked:p.includes($.id),readOnly:!0,style:{accentColor:ve.accent}}),e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:ve.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:ve.accent,flexShrink:0},children:$.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...at,fontSize:11,fontWeight:600,color:ve.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:$.nombre}),e.jsx("div",{style:{...at,fontSize:9,color:ve.inkLight},children:$.cargo})]})]},$.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:m&&p.length>0?e.jsx(Ex,{empleados:n.filter($=>p.includes($.id)),brand:t,tipo:"carnet",template:u}):S?e.jsxs("div",{children:[e.jsxs("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginBottom:8},children:[C==="front"?"FRENTE":"REVERSO","  Plantilla: ",(U=Jl.find($=>$.id===u))==null?void 0:U.label]}),e.jsx("div",{style:{transform:"scale(1.2)",transformOrigin:"top center",marginBottom:40},children:e.jsx(q,{emp:S,brand:t,side:C})}),e.jsx("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginTop:60},children:"Tamao: 85.6mm  54mm (estndar ISO/IEC 7810 CR80)"})]}):e.jsxs("div",{style:{...at,textAlign:"center",padding:40,color:ve.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado para ver su carnet"})]})})]})]})},z=()=>{var U;const q=fc[b];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[Yl.map($=>e.jsx("button",{onClick:()=>j($.id),style:{...at,padding:"8px 16px",fontSize:11,fontWeight:b===$.id?700:500,color:b===$.id?"#fff":ve.inkMid,background:b===$.id?ve.accent:ve.surface,border:`1px solid ${b===$.id?ve.accent:ve.border}`,borderRadius:6,cursor:"pointer"},children:$.label},$.id)),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{onClick:()=>v($=>$==="front"?"back":"front"),style:{...at,padding:"8px 14px",fontSize:11,color:ve.info,background:ve.infoBg,border:`1px solid ${ve.info}33`,borderRadius:6,cursor:"pointer"},children:[" ",C==="front"?"Ver reverso":"Ver frente"]})]}),e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:x,onChange:$=>y($.target.value),placeholder:"Buscar",style:{...at,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})}),g.map($=>e.jsxs("div",{onClick:()=>a($.id),style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,background:r===$.id?ve.accentBg:"transparent",border:`1px solid ${r===$.id?ve.accent+"33":"transparent"}`},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:ve.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:ve.accent,flexShrink:0},children:$.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...at,fontSize:11,fontWeight:600,color:ve.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:$.nombre}),e.jsx("div",{style:{...at,fontSize:9,color:ve.inkLight},children:$.cargo})]})]},$.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:S?e.jsxs("div",{children:[e.jsxs("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginBottom:8},children:[C==="front"?"FRENTE":"REVERSO","  Plantilla: ",(U=Yl.find($=>$.id===b))==null?void 0:U.label]}),e.jsx("div",{style:{transform:"scale(1.15)",transformOrigin:"top center",marginBottom:30},children:e.jsx(q,{emp:S,brand:t,side:C})}),e.jsx("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginTop:50},children:"Tamao: 90mm  50mm (estndar europeo)"})]}):e.jsxs("div",{style:{...at,textAlign:"center",padding:40,color:ve.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado"})]})})]})]})},B=()=>e.jsx("div",{children:e.jsxs("div",{style:{display:"flex",gap:20},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{value:x,onChange:q=>y(q.target.value),placeholder:"Buscar",style:{...at,width:"100%",padding:"6px 10px",fontSize:11,border:`1px solid ${ve.border}`,borderRadius:5,boxSizing:"border-box"}})}),g.map(q=>e.jsxs("div",{onClick:()=>a(q.id),style:{display:"flex",gap:8,alignItems:"center",padding:"8px 10px",borderRadius:6,cursor:"pointer",marginBottom:2,background:r===q.id?ve.accentBg:"transparent",border:`1px solid ${r===q.id?ve.accent+"33":"transparent"}`},children:[e.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:ve.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:ve.accent,flexShrink:0},children:q.nombre[0]}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{...at,fontSize:11,fontWeight:600,color:ve.ink,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:q.nombre}),e.jsx("div",{style:{...at,fontSize:9,color:ve.inkLight},children:q.cargo})]})]},q.id))]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:S?e.jsxs("div",{children:[e.jsx("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginBottom:12},children:"TARJETA VIRTUAL  vista previa mvil"}),e.jsx(zx,{emp:S,brand:t}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center",marginTop:20},children:[e.jsx("button",{style:{...at,padding:"8px 18px",fontSize:11,fontWeight:600,color:ve.accent,background:ve.accentBg,border:`1px solid ${ve.accent}33`,borderRadius:6,cursor:"pointer"},children:" Copiar enlace"}),e.jsx("button",{style:{...at,padding:"8px 18px",fontSize:11,fontWeight:600,color:ve.info,background:ve.infoBg,border:`1px solid ${ve.info}33`,borderRadius:6,cursor:"pointer"},children:" Compartir WhatsApp"}),e.jsx("button",{style:{...at,padding:"8px 18px",fontSize:11,fontWeight:600,color:ve.inkMid,background:ve.surface,border:`1px solid ${ve.border}`,borderRadius:6,cursor:"pointer"},children:" Descargar vCard"})]}),e.jsx("div",{style:{...at,fontSize:10,color:ve.inkLight,textAlign:"center",marginTop:12},children:"El destinatario puede guardar el contacto directamente escaneando el QR"})]}):e.jsxs("div",{style:{...at,textAlign:"center",padding:40,color:ve.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{fontSize:13},children:"Selecciona un empleado"})]})})]})}),P=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:x,onChange:q=>y(q.target.value),placeholder:"Buscar por nombre, cargo, departamento",style:{...at,width:"100%",padding:"8px 12px",fontSize:12,border:`1px solid ${ve.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>l({id:xx(),nombre:"",cargo:"",departamento:"",email:"",telefono:"",tipoDoc:"CC",documento:"",rh:"O+",eps:"",arl:"",fechaIngreso:new Date().toISOString().slice(0,10),foto:null}),style:{...at,padding:"8px 18px",fontSize:11,fontWeight:700,color:"#fff",background:ve.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo empleado"})]}),e.jsx("div",{style:{background:"#fff",borderRadius:10,border:`1px solid ${ve.border}`,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:ve.surface},children:["","Nombre","Cargo","Departamento","Email","Doc","RH",""].map((q,U)=>e.jsx("th",{style:{...at,padding:"10px 12px",textAlign:"left",fontSize:10,fontWeight:600,color:ve.inkLight,borderBottom:`1px solid ${ve.border}`},children:q},U))})}),e.jsx("tbody",{children:g.map(q=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ve.border}`},onMouseEnter:U=>U.currentTarget.style.background=ve.surface,onMouseLeave:U=>U.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:ve.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:ve.accent},children:q.nombre[0]})}),e.jsx("td",{style:{...at,padding:"8px 12px",fontWeight:600,color:ve.ink},children:q.nombre}),e.jsx("td",{style:{...at,padding:"8px 12px",color:ve.inkMid},children:q.cargo}),e.jsx("td",{style:{...at,padding:"8px 12px",color:ve.inkMid},children:q.departamento}),e.jsx("td",{style:{...at,padding:"8px 12px",color:ve.inkLight,fontSize:11},children:q.email}),e.jsxs("td",{style:{...at,padding:"8px 12px",color:ve.inkLight,fontSize:11},children:[q.tipoDoc," ",q.documento]}),e.jsx("td",{style:{...at,padding:"8px 12px"},children:e.jsx("span",{style:{fontWeight:700,color:"#B91C1C",fontSize:13},children:q.rh})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("button",{onClick:()=>l({...q}),style:{...at,padding:"4px 10px",fontSize:10,color:ve.accent,background:ve.accentBg,border:`1px solid ${ve.accent}33`,borderRadius:4,cursor:"pointer"},children:""})})]},q.id))})]})}),e.jsx("p",{style:{...at,fontSize:10,color:ve.inkLight,marginTop:12},children:" Tip: En produccin, los empleados se vincularn automticamente desde el mdulo de RRHH."})]});return e.jsxs("div",{style:{...at,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...at,fontSize:22,fontWeight:700,color:ve.ink,margin:"0 0 4px"},children:" Identidad Corporativa"}),e.jsxs("p",{style:{...at,fontSize:12,color:ve.inkLight,margin:0},children:["Carnets corporativos, tarjetas de visita fsicas y virtuales con la identidad de ",t.nombre]})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${ve.border}`,marginBottom:20},children:E.map(q=>e.jsxs("button",{onClick:()=>o(q.id),style:{...at,padding:"10px 18px",fontSize:12,fontWeight:i===q.id?700:500,color:i===q.id?ve.accent:ve.inkLight,background:"none",border:"none",borderBottom:i===q.id?`2px solid ${ve.accent}`:"2px solid transparent",cursor:"pointer",transition:"all .15s"},children:[q.icon," ",q.label]},q.id))}),i==="carnets"&&I(),i==="tarjetas"&&z(),i==="virtual"&&B(),i==="empleados"&&P(),w()]})}const ke={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},Ue={fontFamily:"'DM Sans',sans-serif"},xc="hab:firmas:",Xl=t=>{try{return JSON.parse(Fe.getSync(xc+t))||null}catch{return null}},Ql=(t,i)=>{Fe.set(xc+t,JSON.stringify(i))},Ur=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),ta=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",ia=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function Zl({onSave:t,onCancel:i,signer:o,width:n=480,height:s=200}){const r=F.useRef(null),[a,u]=F.useState(!1),[h,b]=F.useState(!1),j=F.useRef(null);F.useEffect(()=>{const d=r.current;if(!d)return;const l=d.getContext("2d");l.fillStyle="#fff",l.fillRect(0,0,n,s),l.strokeStyle="#E0E0E0",l.lineWidth=1,l.setLineDash([4,4]),l.beginPath(),l.moveTo(30,s-40),l.lineTo(n-30,s-40),l.stroke(),l.setLineDash([]),l.fillStyle="#AAA",l.font="10px 'DM Sans', sans-serif",l.fillText("Firma aqu",30,s-20)},[n,s]);const C=d=>{const x=r.current.getBoundingClientRect(),y=d.touches?d.touches[0].clientX:d.clientX,g=d.touches?d.touches[0].clientY:d.clientY;return{x:(y-x.left)*(n/x.width),y:(g-x.top)*(s/x.height)}},v=d=>{d.preventDefault(),u(!0),j.current=C(d)},m=d=>{if(!a)return;d.preventDefault();const x=r.current.getContext("2d"),y=C(d);x.strokeStyle="#111",x.lineWidth=2.5,x.lineCap="round",x.lineJoin="round",x.beginPath(),x.moveTo(j.current.x,j.current.y),x.lineTo(y.x,y.y),x.stroke(),j.current=y,b(!0)},f=()=>{u(!1),j.current=null},p=()=>{const l=r.current.getContext("2d");l.fillStyle="#fff",l.fillRect(0,0,n,s),l.strokeStyle="#E0E0E0",l.lineWidth=1,l.setLineDash([4,4]),l.beginPath(),l.moveTo(30,s-40),l.lineTo(n-30,s-40),l.stroke(),l.setLineDash([]),l.fillStyle="#AAA",l.font="10px 'DM Sans', sans-serif",l.fillText("Firma aqu",30,s-20),b(!1)},c=()=>{if(!h)return;const d=r.current.toDataURL("image/png");t(d)};return e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:20,border:`1px solid ${ke.border}`},children:[o&&e.jsxs("div",{style:{...Ue,fontSize:12,color:ke.inkMid,marginBottom:12},children:["Firmante: ",e.jsx("b",{children:o})]}),e.jsx("div",{style:{border:`2px solid ${ke.border}`,borderRadius:8,overflow:"hidden",marginBottom:12,touchAction:"none",cursor:"crosshair"},children:e.jsx("canvas",{ref:r,width:n,height:s,style:{width:"100%",height:"auto",display:"block"},onMouseDown:v,onMouseMove:m,onMouseUp:f,onMouseLeave:f,onTouchStart:v,onTouchMove:m,onTouchEnd:f})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"space-between"},children:[e.jsx("button",{onClick:p,style:{...Ue,padding:"7px 16px",fontSize:11,color:ke.inkMid,background:ke.bg,border:`1px solid ${ke.border}`,borderRadius:6,cursor:"pointer"},children:" Limpiar"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[i&&e.jsx("button",{onClick:i,style:{...Ue,padding:"7px 16px",fontSize:11,color:ke.inkMid,background:ke.bg,border:`1px solid ${ke.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:c,disabled:!h,style:{...Ue,padding:"7px 20px",fontSize:11,fontWeight:700,color:"#fff",background:h?ke.accent:ke.inkLight,border:"none",borderRadius:6,cursor:h?"pointer":"not-allowed"},children:" Firmar"})]})]})]})}function Fx(t){let i=0;for(let o=0;o<t.length;o++)i=(i<<5)-i+t.charCodeAt(o)|0;return Math.abs(i).toString(16).toUpperCase().padStart(8,"0")}const Vr=[{id:"contrato",label:"Contrato",icon:"",color:"#3B3B3B"},{id:"acta",label:"Acta",icon:"",color:"#111111"},{id:"otros",label:"Otros / Anexo",icon:"",color:"#5B3A8C"},{id:"carta",label:"Carta / Comunicacin",icon:"",color:"#8C6A00"},{id:"poder",label:"Poder / Autorizacin",icon:"",color:"#0D5E6E"},{id:"poliza",label:"Pliza / Seguro",icon:"",color:"#B91C1C"},{id:"recibo",label:"Recibo / Paz y Salvo",icon:"",color:"#111111"},{id:"conformidad",label:"Acta de Conformidad",icon:"",color:"#0D7377"},{id:"otro",label:"Otro documento",icon:"",color:"#555"}],oa=[{id:"borrador",label:"Borrador",color:"#888",bg:"#F5F5F5"},{id:"pendiente",label:"Pendiente",color:"#8C6A00",bg:"#FFF8EE"},{id:"parcial",label:"Firma parcial",color:"#3B3B3B",bg:"#F0F0F0"},{id:"completado",label:"Firmado",color:"#111111",bg:"#EBEBEB"},{id:"rechazado",label:"Rechazado",color:"#B91C1C",bg:"#FDF0F0"},{id:"vencido",label:"Vencido",color:"#B91C1C",bg:"#FDF0F0"}],Tx=[{id:"d1",tipo:"contrato",titulo:"Contrato de Diseo Interior  Apto 502 Rosales",descripcion:"Contrato de prestacin de servicios de diseo interior para apartamento en Rosales, Bogot.",cliente:"Mara Fernanda Gmez",proyecto:"Apto 502 Rosales",valor:"$45.000.000 COP",firmantes:[{id:"f1",nombre:"Laura Snchez Daz",rol:"Representante Legal",email:"laura@habitaris.co",estado:"pendiente",firma:null,fechaFirma:null},{id:"f2",nombre:"Mara Fernanda Gmez",rol:"Cliente",email:"mfgomez@email.com",estado:"pendiente",firma:null,fechaFirma:null}],estado:"pendiente",fechaCreacion:"2026-02-20T10:00:00Z",fechaLimite:"2026-03-05",auditoria:[{fecha:"2026-02-20T10:00:00Z",accion:"Documento creado",usuario:"Sistema"}]},{id:"d2",tipo:"acta",titulo:"Acta de Inicio  Remodelacin Casa Chic",descripcion:"Acta de inicio de obras de remodelacin integral.",cliente:"Andrs Meja Ruiz",proyecto:"Casa Chic Norte",valor:"$120.000.000 COP",firmantes:[{id:"f3",nombre:"Carlos Lpez Meja",rol:"Director de Proyecto",email:"carlos@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo1",fecha:"2026-02-18T14:30:00Z"},fechaFirma:"2026-02-18T14:30:00Z"},{id:"f4",nombre:"Andrs Meja Ruiz",rol:"Propietario",email:"amejia@email.com",estado:"pendiente",firma:null,fechaFirma:null},{id:"f5",nombre:"Mara Rodrguez Pea",rol:"Directora de Obra",email:"maria@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo2",fecha:"2026-02-18T15:00:00Z"},fechaFirma:"2026-02-18T15:00:00Z"}],estado:"parcial",fechaCreacion:"2026-02-18T09:00:00Z",fechaLimite:"2026-02-28",auditoria:[{fecha:"2026-02-18T09:00:00Z",accion:"Documento creado",usuario:"Sistema"},{fecha:"2026-02-18T14:30:00Z",accion:"Firmado por Carlos Lpez Meja",usuario:"Carlos Lpez"},{fecha:"2026-02-18T15:00:00Z",accion:"Firmado por Mara Rodrguez Pea",usuario:"Mara Rodrguez"}]},{id:"d3",tipo:"conformidad",titulo:"Acta de Conformidad  Entrega Oficina 301",descripcion:"Acta de conformidad y recepcin final de obra de adecuacin de oficina.",cliente:"TechStar S.A.S",proyecto:"Oficina 301 WTC",valor:"$85.000.000 COP",firmantes:[{id:"f6",nombre:"Laura Snchez Daz",rol:"Gerente General",email:"laura@habitaris.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo3",fecha:"2026-02-10T11:00:00Z"},fechaFirma:"2026-02-10T11:00:00Z"},{id:"f7",nombre:"Roberto Acosta",rol:"Rep. Legal TechStar",email:"racosta@techstar.co",estado:"firmado",firma:{imagen:"data:image/png;base64,demo4",fecha:"2026-02-10T16:00:00Z"},fechaFirma:"2026-02-10T16:00:00Z"}],estado:"completado",fechaCreacion:"2026-02-10T08:00:00Z",fechaLimite:"2026-02-15",auditoria:[{fecha:"2026-02-10T08:00:00Z",accion:"Documento creado",usuario:"Sistema"},{fecha:"2026-02-10T11:00:00Z",accion:"Firmado por Laura Snchez Daz",usuario:"Laura Snchez"},{fecha:"2026-02-10T16:00:00Z",accion:"Firmado por Roberto Acosta",usuario:"Roberto Acosta"},{fecha:"2026-02-10T16:00:00Z",accion:"Documento completado  todas las firmas recogidas",usuario:"Sistema"}]}];function Nn({children:t,color:i,bg:o}){return e.jsx("span",{style:{...Ue,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o},children:t})}function Bx(){const[t,i]=F.useState("documentos"),[o,n]=F.useState(()=>Xl("docs")||Tx),[s,r]=F.useState(()=>Xl("firmas_guardadas")||[]),[a,u]=F.useState(""),[h,b]=F.useState("all"),[j,C]=F.useState("all"),[v,m]=F.useState(null),[f,p]=F.useState(null),[c,d]=F.useState(null);F.useState(null),F.useEffect(()=>Ql("docs",o),[o]),F.useEffect(()=>Ql("firmas_guardadas",s),[s]);const l=F.useMemo(()=>o.filter(z=>{var B,P;if(h!=="all"&&z.estado!==h||j!=="all"&&z.tipo!==j)return!1;if(a){const q=a.toLowerCase();return z.titulo.toLowerCase().includes(q)||((B=z.cliente)==null?void 0:B.toLowerCase().includes(q))||((P=z.proyecto)==null?void 0:P.toLowerCase().includes(q))}return!0}),[o,h,j,a]),x=F.useMemo(()=>{const z=o.length,B=o.filter(Y=>Y.estado==="pendiente"||Y.estado==="parcial").length,P=o.filter(Y=>Y.estado==="completado").length,q=o.filter(Y=>Y.estado==="rechazado").length,U=o.filter(Y=>Y.estado!=="completado"&&Y.fechaLimite&&new Date(Y.fechaLimite)<new Date).length,$=o.reduce((Y,ge)=>Y+ge.firmantes.filter(J=>J.estado==="pendiente").length,0);return{total:z,pendientes:B,completados:P,rechazados:q,vencidos:U,firmasPendientes:$}},[o]),y=(z,B,P)=>{n(q=>q.map(U=>{if(U.id!==z)return U;const $=U.firmantes.map(L=>L.id!==B?L:{...L,estado:"firmado",firma:{imagen:P,fecha:new Date().toISOString()},fechaFirma:new Date().toISOString()}),Y=$.every(L=>L.estado==="firmado"),ge=$.some(L=>L.estado==="firmado"),J=Y?"completado":ge?"parcial":U.estado,ye=$.find(L=>L.id===B),oe=[...U.auditoria,{fecha:new Date().toISOString(),accion:`Firmado por ${ye==null?void 0:ye.nombre}`,usuario:ye==null?void 0:ye.nombre}];return Y&&oe.push({fecha:new Date().toISOString(),accion:"Documento completado  todas las firmas recogidas",usuario:"Sistema"}),{...U,firmantes:$,estado:J,auditoria:oe}})),d(null)},g=()=>{var $;const z=v?o.find(Y=>Y.id===v):null;if(!z)return null;const B=Vr.find(Y=>Y.id===z.tipo),P=oa.find(Y=>Y.id===z.estado),q=Fx(z.id+z.titulo+z.fechaCreacion),U=z.fechaLimite&&new Date(z.fechaLimite)<new Date&&z.estado!=="completado";return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>m(null),children:e.jsxs("div",{onClick:Y=>Y.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:720,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:6},children:[e.jsxs(Nn,{color:B==null?void 0:B.color,bg:(B==null?void 0:B.color)+"18",children:[B==null?void 0:B.icon," ",B==null?void 0:B.label]}),e.jsx(Nn,{color:P==null?void 0:P.color,bg:P==null?void 0:P.bg,children:P==null?void 0:P.label}),U&&e.jsx(Nn,{color:ke.danger,bg:ke.dangerBg,children:" Vencido"})]}),e.jsx("h2",{style:{...Ue,fontSize:18,fontWeight:700,color:ke.ink,margin:0},children:z.titulo})]}),e.jsx("button",{onClick:()=>m(null),style:{...Ue,fontSize:18,color:ke.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...Ue,fontSize:12,color:ke.inkMid,lineHeight:1.6,marginBottom:16},children:z.descripcion}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:20},children:[{label:"Cliente",val:z.cliente},{label:"Proyecto",val:z.proyecto},{label:"Valor",val:z.valor},{label:"Creado",val:ia(z.fechaCreacion)},{label:"Fecha lmite",val:ia(z.fechaLimite)},{label:"Hash",val:`#${q}`}].map((Y,ge)=>e.jsxs("div",{style:{padding:10,background:ke.surface,borderRadius:6},children:[e.jsx("div",{style:{...Ue,fontSize:9,color:ke.inkLight,marginBottom:2},children:Y.label}),e.jsx("div",{style:{...Ue,fontSize:12,fontWeight:600,color:ke.ink},children:Y.val||""})]},ge))}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("div",{style:{...Ue,fontSize:13,fontWeight:700,color:ke.ink,marginBottom:12},children:" Firmantes"}),z.firmantes.map((Y,ge)=>{var oe;const J=Y.estado==="firmado",ye=Y.estado==="rechazado";return e.jsxs("div",{style:{display:"flex",gap:14,alignItems:"center",padding:"12px 16px",background:J?ke.accentBg:ye?ke.dangerBg:ke.surface,border:`1px solid ${J?ke.accent+"33":ye?ke.danger+"33":ke.border}`,borderRadius:8,marginBottom:8},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:J?ke.accent+"22":ye?ke.danger+"22":ke.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:700,color:J?ke.accent:ye?ke.danger:ke.inkLight},children:J?"":ye?"":ge+1}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Ue,fontSize:13,fontWeight:600,color:ke.ink},children:Y.nombre}),e.jsxs("div",{style:{...Ue,fontSize:10,color:ke.inkLight},children:[Y.rol,"  ",Y.email]}),J&&Y.fechaFirma&&e.jsxs("div",{style:{...Ue,fontSize:9,color:ke.accent,marginTop:2},children:["Firmado: ",ta(Y.fechaFirma)]}),ye&&Y.motivoRechazo&&e.jsxs("div",{style:{...Ue,fontSize:9,color:ke.danger,marginTop:2},children:["Motivo: ",Y.motivoRechazo]})]}),J&&((oe=Y.firma)==null?void 0:oe.imagen)&&Y.firma.imagen.startsWith("data:image")&&e.jsx("div",{style:{border:`1px solid ${ke.border}`,borderRadius:6,overflow:"hidden",background:"#fff"},children:e.jsx("img",{src:Y.firma.imagen,alt:"Firma",style:{height:50,objectFit:"contain"}})}),Y.estado==="pendiente"&&z.estado!=="rechazado"&&e.jsx("div",{style:{display:"flex",gap:6},children:e.jsx("button",{onClick:()=>{d({docId:z.id,firmanteId:Y.id,nombre:Y.nombre}),m(null)},style:{...Ue,padding:"6px 14px",fontSize:10,fontWeight:700,color:"#fff",background:ke.accent,border:"none",borderRadius:5,cursor:"pointer"},children:" Firmar"})})]},Y.id)})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx("span",{style:{...Ue,fontSize:10,color:ke.inkLight},children:"Progreso de firmas"}),e.jsxs("span",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.accent},children:[z.firmantes.filter(Y=>Y.estado==="firmado").length,"/",z.firmantes.length]})]}),e.jsx("div",{style:{height:6,background:ke.bg,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",borderRadius:3,transition:"width .3s",width:`${z.firmantes.filter(Y=>Y.estado==="firmado").length/z.firmantes.length*100}%`,background:z.estado==="completado"?ke.accent:z.estado==="rechazado"?ke.danger:ke.warning}})})]}),e.jsxs("div",{children:[e.jsx("div",{style:{...Ue,fontSize:13,fontWeight:700,color:ke.ink,marginBottom:10},children:" Trazabilidad / Auditora"}),e.jsx("div",{style:{borderLeft:`2px solid ${ke.border}`,paddingLeft:16,marginLeft:8},children:z.auditoria.map((Y,ge)=>e.jsxs("div",{style:{marginBottom:12,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-22,top:2,width:12,height:12,borderRadius:"50%",background:ge===z.auditoria.length-1?ke.accent:ke.bg,border:`2px solid ${ge===z.auditoria.length-1?ke.accent:ke.border}`}}),e.jsx("div",{style:{...Ue,fontSize:10,color:ke.inkLight},children:ta(Y.fecha)}),e.jsx("div",{style:{...Ue,fontSize:12,color:ke.ink},children:Y.accion}),e.jsxs("div",{style:{...Ue,fontSize:10,color:ke.inkLight},children:["por ",Y.usuario]})]},ge))})]}),z.estado==="completado"&&e.jsxs("div",{style:{marginTop:20,padding:20,borderRadius:10,background:"linear-gradient(135deg, #EBEBEB 0%, #F0F0F0 100%)",border:`1px solid ${ke.accent}33`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:28,marginBottom:8},children:""}),e.jsx("div",{style:{...Ue,fontSize:14,fontWeight:700,color:ke.accent},children:"Documento firmado digitalmente"}),e.jsxs("div",{style:{...Ue,fontSize:11,color:ke.inkMid,marginTop:4},children:["Hash de integridad: ",e.jsxs("code",{style:{background:"#fff",padding:"2px 8px",borderRadius:4,fontSize:10},children:["SHA-",q,"-",z.firmantes.length,"F"]})]}),e.jsxs("div",{style:{...Ue,fontSize:10,color:ke.inkLight,marginTop:4},children:[z.firmantes.length," firmante(s)  Completado: ",ta(($=z.auditoria[z.auditoria.length-1])==null?void 0:$.fecha)]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20},children:[e.jsx("button",{onClick:()=>{p({...z,firmantes:z.firmantes.map(Y=>({...Y}))}),m(null)},style:{...Ue,padding:"8px 18px",fontSize:11,color:ke.accent,background:ke.accentBg,border:`1px solid ${ke.accent}33`,borderRadius:6,cursor:"pointer"},children:" Editar"}),e.jsx("button",{style:{...Ue,padding:"8px 18px",fontSize:11,color:ke.info,background:ke.infoBg,border:`1px solid ${ke.info}33`,borderRadius:6,cursor:"pointer"},children:" Enviar por email"}),e.jsx("button",{style:{...Ue,padding:"8px 18px",fontSize:11,color:ke.inkMid,background:ke.surface,border:`1px solid ${ke.border}`,borderRadius:6,cursor:"pointer"},children:" Descargar PDF"})]})]})})},S=()=>c?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1001,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>d(null),children:e.jsxs("div",{onClick:z=>z.stopPropagation(),style:{maxWidth:560,width:"100%"},children:[e.jsx("div",{style:{...Ue,fontSize:14,fontWeight:700,color:"#fff",marginBottom:12,textAlign:"center"},children:" Firma Digital"}),e.jsx(Zl,{signer:c.nombre,onSave:z=>y(c.docId,c.firmanteId,z),onCancel:()=>d(null)}),s.length>0&&e.jsxs("div",{style:{background:"#fff",borderRadius:10,padding:14,marginTop:12,border:`1px solid ${ke.border}`},children:[e.jsx("div",{style:{...Ue,fontSize:11,fontWeight:600,color:ke.inkMid,marginBottom:8},children:"O usar firma guardada:"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:s.map(z=>e.jsxs("div",{onClick:()=>y(c.docId,c.firmanteId,z.imagen),style:{border:`1px solid ${ke.border}`,borderRadius:6,padding:4,cursor:"pointer",background:"#fff",transition:"all .15s"},onMouseEnter:B=>B.currentTarget.style.borderColor=ke.accent,onMouseLeave:B=>B.currentTarget.style.borderColor=ke.border,children:[e.jsx("img",{src:z.imagen,alt:z.nombre,style:{height:40,objectFit:"contain"}}),e.jsx("div",{style:{...Ue,fontSize:8,color:ke.inkLight,textAlign:"center"},children:z.nombre})]},z.id))})]})]})}):null,A=()=>{if(!f)return null;const z=!o.find(Y=>Y.id===f.id),B=(Y,ge)=>p(J=>({...J,[Y]:ge})),P=()=>B("firmantes",[...f.firmantes,{id:Ur(),nombre:"",rol:"",email:"",estado:"pendiente",firma:null,fechaFirma:null}]),q=(Y,ge,J)=>{const ye=[...f.firmantes];ye[Y]={...ye[Y],[ge]:J},B("firmantes",ye)},U=Y=>B("firmantes",f.firmantes.filter((ge,J)=>J!==Y)),$=()=>{const Y={...f};z?(Y.fechaCreacion=new Date().toISOString(),Y.auditoria=[{fecha:new Date().toISOString(),accion:"Documento creado",usuario:"Sistema"}],Y.estado="pendiente",n(ge=>[...ge,Y])):(Y.auditoria=[...Y.auditoria,{fecha:new Date().toISOString(),accion:"Documento editado",usuario:"Sistema"}],n(ge=>ge.map(J=>J.id===Y.id?Y:J))),p(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>p(null),children:e.jsxs("div",{onClick:Y=>Y.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...Ue,fontSize:16,fontWeight:700,color:ke.ink,marginBottom:16},children:z?" Nuevo documento para firma":" Editar documento"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Tipo de documento"}),e.jsx("select",{value:f.tipo,onChange:Y=>B("tipo",Y.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5},children:Vr.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.icon," ",Y.label]},Y.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Fecha lmite de firma"}),e.jsx("input",{type:"date",value:f.fechaLimite||"",onChange:Y=>B("fechaLimite",Y.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Ttulo del documento"}),e.jsx("input",{value:f.titulo||"",onChange:Y=>B("titulo",Y.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:f.descripcion||"",onChange:Y=>B("descripcion",Y.target.value),rows:2,style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Cliente"}),e.jsx("input",{value:f.cliente||"",onChange:Y=>B("cliente",Y.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Proyecto"}),e.jsx("input",{value:f.proyecto||"",onChange:Y=>B("proyecto",Y.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.inkLight},children:"Valor"}),e.jsx("input",{value:f.valor||"",onChange:Y=>B("valor",Y.target.value),style:{...Ue,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${ke.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{...Ue,fontSize:12,fontWeight:600,color:ke.ink,marginBottom:8},children:[" Firmantes (",f.firmantes.length,")"]}),f.firmantes.map((Y,ge)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8,marginBottom:6,alignItems:"end"},children:[e.jsxs("div",{children:[ge===0&&e.jsx("label",{style:{...Ue,fontSize:9,color:ke.inkLight},children:"Nombre"}),e.jsx("input",{value:Y.nombre,onChange:J=>q(ge,"nombre",J.target.value),placeholder:"Nombre completo",style:{...Ue,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[ge===0&&e.jsx("label",{style:{...Ue,fontSize:9,color:ke.inkLight},children:"Rol"}),e.jsx("input",{value:Y.rol,onChange:J=>q(ge,"rol",J.target.value),placeholder:"Ej: Rep. Legal",style:{...Ue,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsxs("div",{children:[ge===0&&e.jsx("label",{style:{...Ue,fontSize:9,color:ke.inkLight},children:"Email"}),e.jsx("input",{value:Y.email,onChange:J=>q(ge,"email",J.target.value),placeholder:"email@...",style:{...Ue,width:"100%",padding:"6px 8px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:4,boxSizing:"border-box"}})]}),e.jsx("button",{onClick:()=>U(ge),style:{...Ue,padding:"6px 8px",fontSize:10,color:ke.danger,background:"none",border:"none",cursor:"pointer"},children:""})]},Y.id||ge)),e.jsx("button",{onClick:P,style:{...Ue,padding:"5px 14px",fontSize:10,color:ke.accent,background:ke.accentBg,border:`1px solid ${ke.accent}33`,borderRadius:5,cursor:"pointer",marginTop:4},children:"+ Aadir firmante"})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>p(null),style:{...Ue,padding:"8px 20px",fontSize:12,color:ke.inkMid,background:ke.bg,border:`1px solid ${ke.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:$,style:{...Ue,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:ke.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},E=()=>e.jsxs("div",{children:[e.jsx("div",{style:{...Ue,fontSize:13,fontWeight:700,color:ke.ink,marginBottom:12},children:"Mis firmas guardadas"}),e.jsx("p",{style:{...Ue,fontSize:12,color:ke.inkLight,marginBottom:16},children:"Guarda tus firmas frecuentes para reutilizarlas rpidamente al firmar documentos."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px,1fr))",gap:12,marginBottom:20},children:s.map(z=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${ke.border}`,borderRadius:10,padding:16,textAlign:"center"},children:[e.jsx("div",{style:{border:`1px solid ${ke.border}`,borderRadius:6,overflow:"hidden",marginBottom:8,background:"#fff"},children:e.jsx("img",{src:z.imagen,alt:z.nombre,style:{height:70,objectFit:"contain",display:"block",margin:"0 auto"}})}),e.jsx("div",{style:{...Ue,fontSize:12,fontWeight:600,color:ke.ink},children:z.nombre}),e.jsx("div",{style:{...Ue,fontSize:10,color:ke.inkLight},children:ia(z.fecha)}),e.jsx("button",{onClick:()=>r(B=>B.filter(P=>P.id!==z.id)),style:{...Ue,marginTop:8,padding:"4px 12px",fontSize:10,color:ke.danger,background:ke.dangerBg,border:`1px solid ${ke.danger}33`,borderRadius:4,cursor:"pointer"},children:" Eliminar"})]},z.id))}),e.jsxs("div",{style:{maxWidth:520},children:[e.jsx("div",{style:{...Ue,fontSize:12,fontWeight:600,color:ke.inkMid,marginBottom:8},children:"Crear nueva firma guardada"}),e.jsx(Zl,{onSave:z=>{const B=prompt("Nombre para esta firma (ej: 'Mi firma formal'):");B&&r(P=>[...P,{id:Ur(),nombre:B,imagen:z,fecha:new Date().toISOString()}])}})]})]}),w=()=>e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Total",val:x.total,icon:""},{label:"Pendientes",val:x.pendientes,icon:"",warn:x.pendientes>0},{label:"Firmados",val:x.completados,icon:""},{label:"Firmas pendientes",val:x.firmasPendientes,icon:"",warn:x.firmasPendientes>0},{label:"Vencidos",val:x.vencidos,icon:"",danger:x.vencidos>0}].map((z,B)=>e.jsxs("div",{style:{flex:1,minWidth:110,padding:"10px 14px",background:z.danger?ke.dangerBg:z.warn?ke.warningBg:"#fff",border:`1px solid ${z.danger?ke.danger+"33":z.warn?ke.warning+"33":ke.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...Ue,fontSize:9,color:ke.inkLight},children:[z.icon," ",z.label]}),e.jsx("div",{style:{...Ue,fontSize:18,fontWeight:700,color:z.danger?ke.danger:z.warn?ke.warning:ke.ink},children:z.val})]},B))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("select",{value:h,onChange:z=>b(z.target.value),style:{...Ue,padding:"6px 12px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todos los estados"}),oa.map(z=>e.jsx("option",{value:z.id,children:z.label},z.id))]}),e.jsxs("select",{value:j,onChange:z=>C(z.target.value),style:{...Ue,padding:"6px 12px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),Vr.map(z=>e.jsxs("option",{value:z.id,children:[z.icon," ",z.label]},z.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx("input",{value:a,onChange:z=>u(z.target.value),placeholder:"Buscar por ttulo, cliente, proyecto",style:{...Ue,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${ke.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>p({id:Ur(),tipo:"contrato",titulo:"",descripcion:"",cliente:"",proyecto:"",valor:"",firmantes:[{id:Ur(),nombre:"",rol:"",email:"",estado:"pendiente",firma:null,fechaFirma:null}],estado:"borrador",fechaCreacion:null,fechaLimite:"",auditoria:[]}),style:{...Ue,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:ke.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo documento"})]}),l.map(z=>{const B=Vr.find(Y=>Y.id===z.tipo),P=oa.find(Y=>Y.id===z.estado),q=z.firmantes.filter(Y=>Y.estado==="firmado").length,U=z.firmantes.length,$=z.fechaLimite&&new Date(z.fechaLimite)<new Date&&z.estado!=="completado";return e.jsxs("div",{onClick:()=>m(z.id),style:{display:"flex",gap:14,alignItems:"center",padding:"14px 18px",background:"#fff",border:`1px solid ${ke.border}`,borderRadius:10,marginBottom:8,cursor:"pointer",transition:"all .15s",boxShadow:ke.shadow},onMouseEnter:Y=>Y.currentTarget.style.boxShadow=ke.shadowMd,onMouseLeave:Y=>Y.currentTarget.style.boxShadow=ke.shadow,children:[e.jsx("div",{style:{width:42,height:42,borderRadius:10,background:(B==null?void 0:B.color)+"15",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0},children:B==null?void 0:B.icon}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{...Ue,fontSize:13,fontWeight:700,color:ke.ink,marginBottom:2},children:z.titulo}),e.jsxs("div",{style:{...Ue,fontSize:11,color:ke.inkLight},children:[z.cliente,"  ",z.proyecto," ",z.valor&&` ${z.valor}`]})]}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexShrink:0},children:[e.jsxs("div",{style:{textAlign:"center",marginRight:8},children:[e.jsxs("div",{style:{...Ue,fontSize:10,fontWeight:600,color:ke.inkMid},children:[q,"/",U]}),e.jsx("div",{style:{width:40,height:4,background:ke.bg,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${q/U*100}%`,borderRadius:2,background:z.estado==="completado"?ke.accent:ke.warning}})})]}),e.jsx(Nn,{color:P==null?void 0:P.color,bg:P==null?void 0:P.bg,children:P==null?void 0:P.label}),$&&e.jsx(Nn,{color:ke.danger,bg:ke.dangerBg,children:""})]})]},z.id)}),l.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:ke.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Ue,fontSize:13},children:"No se encontraron documentos"})]})]}),I=[{id:"documentos",icon:"",label:"Documentos",badge:x.pendientes||null},{id:"firmas",icon:"",label:"Mis Firmas"}];return e.jsxs("div",{style:{...Ue,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...Ue,fontSize:22,fontWeight:700,color:ke.ink,margin:"0 0 4px"},children:" Firma Digital"}),e.jsx("p",{style:{...Ue,fontSize:12,color:ke.inkLight,margin:0},children:"Firma y gestin de documentos digitales con trazabilidad completa"})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${ke.border}`,marginBottom:20},children:I.map(z=>e.jsxs("button",{onClick:()=>i(z.id),style:{...Ue,padding:"10px 18px",fontSize:12,fontWeight:t===z.id?700:500,color:t===z.id?ke.accent:ke.inkLight,background:"none",border:"none",borderBottom:t===z.id?`2px solid ${ke.accent}`:"2px solid transparent",cursor:"pointer"},children:[z.icon," ",z.label,z.badge&&e.jsx("span",{style:{marginLeft:6,background:ke.warning,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:z.badge})]},z.id))}),t==="documentos"&&w(),t==="firmas"&&E(),g(),S(),A()]})}const Ae={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},He={fontFamily:"'DM Sans',sans-serif"},mc="hab:legal:",qr=t=>{try{return JSON.parse(Fe.getSync(mc+t))||null}catch{return null}},Hr=(t,i)=>{Fe.set(mc+t,JSON.stringify(i))},na=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7),tn=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function Ro({children:t,color:i,bg:o}){return e.jsx("span",{style:{...He,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o},children:t})}function ed(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}const Gr=[{id:"contratos",label:"Contratos",icon:"",color:"#3B3B3B"},{id:"otrosies",label:"Otroses / Modificaciones",icon:"",color:"#5B3A8C"},{id:"actas",label:"Actas",icon:"",color:"#111111"},{id:"cartas",label:"Cartas / Comunicaciones",icon:"",color:"#8C6A00"},{id:"poderes",label:"Poderes / Autorizaciones",icon:"",color:"#0D5E6E"},{id:"formatos",label:"Formatos Internos",icon:"",color:"#555"}],Ix=[{id:"tpl_contrato_diseno",cat:"contratos",nombre:"Contrato de Diseo Interior",desc:"Contrato de prestacin de servicios de diseo interior. Incluye alcance, fases, entregables, honorarios y forma de pago.",variables:["nombre_cliente","documento_cliente","direccion_inmueble","descripcion_alcance","valor_honorarios","forma_pago","plazo_dias","fecha"],contenido:`CONTRATO DE PRESTACIN DE SERVICIOS DE DISEO INTERIOR

Entre {{empresa_nombre}}, con NIT {{empresa_nit}}, representada por {{rep_legal}}, en adelante EL CONTRATISTA, y {{nombre_cliente}}, identificado con {{documento_cliente}}, en adelante EL CLIENTE.

OBJETO: El CONTRATISTA se compromete a prestar servicios profesionales de diseo interior para el inmueble ubicado en {{direccion_inmueble}}.

ALCANCE: {{descripcion_alcance}}

VALOR Y FORMA DE PAGO: El valor total de los honorarios es de {{valor_honorarios}}, pagaderos as: {{forma_pago}}.

PLAZO: {{plazo_dias}} das calendario a partir de la firma del presente contrato.

OBLIGACIONES DEL CONTRATISTA:
1. Elaborar propuesta de diseo segn briefing aprobado
2. Presentar renders y planos tcnicos
3. Entregar memoria descriptiva y presupuesto de obra
4. Realizar seguimiento durante la ejecucin (si aplica)

OBLIGACIONES DEL CLIENTE:
1. Suministrar informacin veraz del inmueble
2. Realizar los pagos en los plazos acordados
3. Aprobar o solicitar ajustes en los plazos establecidos

Se firma en {{ciudad}} a los {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_obra",cat:"contratos",nombre:"Contrato de Obra / Remodelacin",desc:"Contrato de ejecucin de obra de remodelacin. Incluye presupuesto, cronograma, garantas y penalizaciones.",variables:["nombre_cliente","documento_cliente","direccion_inmueble","descripcion_obra","valor_obra","anticipo_pct","plazo_dias","fecha"],contenido:`CONTRATO DE OBRA PARA REMODELACIN

Entre {{empresa_nombre}}, NIT {{empresa_nit}}, en adelante EL CONTRATISTA, y {{nombre_cliente}}, identificado con {{documento_cliente}}, en adelante EL PROPIETARIO.

OBJETO: Ejecucin de obras de remodelacin en {{direccion_inmueble}} segn diseo aprobado.

DESCRIPCIN: {{descripcion_obra}}

VALOR: {{valor_obra}} (IVA incluido). ANTICIPO: {{anticipo_pct}}% contra firma. El saldo se pagar segn avance de obra certificado.

PLAZO: {{plazo_dias}} das calendario.

GARANTAS:
- Estabilidad de obra: 5 aos
- Acabados: 1 ao
- Instalaciones: 2 aos

Se firma en {{ciudad}} a los {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_laboral",cat:"contratos",nombre:"Contrato Laboral a Trmino Fijo",desc:"Contrato laboral para personal vinculado a proyectos con trmino definido.",variables:["nombre_empleado","documento_empleado","cargo","salario","fecha_inicio","fecha_fin","funciones"],contenido:`CONTRATO INDIVIDUAL DE TRABAJO A TRMINO FIJO

EMPLEADOR: {{empresa_nombre}}, NIT {{empresa_nit}}
TRABAJADOR: {{nombre_empleado}}, C.C. {{documento_empleado}}
CARGO: {{cargo}}

El EMPLEADOR contrata los servicios del TRABAJADOR para desempear el cargo de {{cargo}} con las siguientes funciones: {{funciones}}

REMUNERACIN: {{salario}} mensuales, pagaderos quincenalmente.
VIGENCIA: Del {{fecha_inicio}} al {{fecha_fin}}.

JORNADA: 48 horas semanales.

El presente contrato se rige por el Cdigo Sustantivo del Trabajo.`,pais:"CO",obligatorio:!1},{id:"tpl_contrato_prest_serv",cat:"contratos",nombre:"Contrato de Prestacin de Servicios",desc:"Para contratistas independientes, proveedores y consultores.",variables:["nombre_contratista","documento_contratista","objeto","valor","plazo","entregables"],contenido:`CONTRATO DE PRESTACIN DE SERVICIOS PROFESIONALES

CONTRATANTE: {{empresa_nombre}}
CONTRATISTA: {{nombre_contratista}}, {{documento_contratista}}

OBJETO: {{objeto}}
VALOR: {{valor}}
PLAZO: {{plazo}}
ENTREGABLES: {{entregables}}

El CONTRATISTA acta como independiente, sin subordinacin laboral. Es responsable de sus propias obligaciones tributarias y de seguridad social.`,pais:"CO",obligatorio:!1},{id:"tpl_otrosi",cat:"otrosies",nombre:"Otros Modificatorio",desc:"Modificacin de clusulas de un contrato vigente.",variables:["numero_contrato","fecha_contrato","clausulas_modificadas","nuevo_texto"],contenido:`OTROS MODIFICATORIO AL CONTRATO {{numero_contrato}}

Las partes acuerdan modificar las siguientes clusulas del contrato de fecha {{fecha_contrato}}:

CLUSULAS MODIFICADAS: {{clausulas_modificadas}}

NUEVO TEXTO: {{nuevo_texto}}

Las dems clusulas permanecen vigentes e inalteradas.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_inicio",cat:"actas",nombre:"Acta de Inicio de Obra",desc:"Acta de inicio de ejecucin de obra con datos del proyecto, participantes y compromisos.",variables:["proyecto","direccion","contrato_ref","participantes","observaciones","fecha"],contenido:`ACTA DE INICIO DE OBRA

PROYECTO: {{proyecto}}
DIRECCIN: {{direccion}}
CONTRATO REF: {{contrato_ref}}
FECHA: {{fecha}}

PARTICIPANTES:
{{participantes}}

Se da inicio formal a las obras de acuerdo con el contrato referenciado, el diseo aprobado y el cronograma pactado.

OBSERVACIONES: {{observaciones}}

Se firma por las partes como constancia.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_vecindad",cat:"actas",nombre:"Acta de Vecindad",desc:"Registro del estado de inmuebles vecinos antes de iniciar obra.",variables:["proyecto","direccion_obra","inmuebles_vecinos","estado_actual","registro_fotografico","fecha"],contenido:`ACTA DE VECINDAD

PROYECTO: {{proyecto}}
DIRECCIN OBRA: {{direccion_obra}}
FECHA: {{fecha}}

INMUEBLES INSPECCIONADOS:
{{inmuebles_vecinos}}

ESTADO ACTUAL REGISTRADO:
{{estado_actual}}

Se adjunta registro fotogrfico de {{registro_fotografico}} fotografas como soporte.

Esta acta tiene carcter probatorio del estado previo de los inmuebles vecinos.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_entrega",cat:"actas",nombre:"Acta de Entrega / Recepcin Final",desc:"Acta de recepcin final de obra con checklist de verificacin.",variables:["proyecto","cliente","items_verificados","observaciones","pendientes","garantias","fecha"],contenido:`ACTA DE ENTREGA Y RECEPCIN FINAL

PROYECTO: {{proyecto}}
CLIENTE: {{cliente}}
FECHA: {{fecha}}

Se procede a la entrega formal del proyecto con los siguientes tems verificados:
{{items_verificados}}

OBSERVACIONES: {{observaciones}}
PENDIENTES (si aplica): {{pendientes}}

GARANTAS:
{{garantias}}

El CLIENTE declara recibir a satisfaccin.`,pais:"CO",obligatorio:!1},{id:"tpl_acta_comite",cat:"actas",nombre:"Acta de Comit de Obra",desc:"Registro de reuniones de seguimiento de obra.",variables:["numero","proyecto","asistentes","temas","compromisos","proxima_reunion","fecha"],contenido:`ACTA DE COMIT DE OBRA N {{numero}}

PROYECTO: {{proyecto}}
FECHA: {{fecha}}
ASISTENTES: {{asistentes}}

TEMAS TRATADOS:
{{temas}}

COMPROMISOS:
{{compromisos}}

PRXIMA REUNIN: {{proxima_reunion}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_cobro",cat:"cartas",nombre:"Carta de Cobro / Recordatorio de Pago",desc:"Comunicacin formal recordando saldos pendientes.",variables:["destinatario","concepto","valor_adeudado","fecha_vencimiento","plazo_respuesta","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Recordatorio de pago  {{concepto}}

Cordial saludo.

Permtanos recordarle que a la fecha se encuentra pendiente el pago de {{valor_adeudado}} correspondiente a {{concepto}}, con fecha de vencimiento {{fecha_vencimiento}}.

Agradecemos realizar el pago en un plazo de {{plazo_respuesta}} das.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_terminacion",cat:"cartas",nombre:"Carta de Terminacin de Contrato",desc:"Comunicacin formal de terminacin de relacin contractual.",variables:["destinatario","contrato_ref","motivo","fecha_efectiva","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Terminacin contrato {{contrato_ref}}

Por medio de la presente le comunicamos la terminacin del contrato referenciado por el siguiente motivo: {{motivo}}

La terminacin ser efectiva a partir del {{fecha_efectiva}}.

Quedan vigentes las obligaciones pendientes y las garantas pactadas.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_carta_garantia",cat:"cartas",nombre:"Carta de Reclamacin de Garanta",desc:"Comunicacin de activacin de garanta por defectos post-entrega.",variables:["destinatario","proyecto","items_garantia","plazo_respuesta","fecha"],contenido:`{{ciudad}}, {{fecha}}

Seor(a)
{{destinatario}}

Ref: Reclamacin de garanta  {{proyecto}}

Nos permitimos reportar los siguientes tems que requieren atencin bajo la garanta del proyecto:

{{items_garantia}}

Solicitamos atencin en un plazo de {{plazo_respuesta}} das hbiles.

Atentamente,
{{empresa_nombre}}`,pais:"CO",obligatorio:!1},{id:"tpl_poder",cat:"poderes",nombre:"Poder Especial",desc:"Autorizacin para actuar en nombre de la empresa ante trmites especficos.",variables:["apoderado","documento_apoderado","facultades","vigencia","fecha"],contenido:`PODER ESPECIAL

{{rep_legal}}, en calidad de representante legal de {{empresa_nombre}}, NIT {{empresa_nit}}, confiere poder especial a {{apoderado}}, identificado con {{documento_apoderado}}, para:

{{facultades}}

VIGENCIA: {{vigencia}}

Otorgado en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_paz_salvo",cat:"formatos",nombre:"Paz y Salvo",desc:"Certificacin de cumplimiento de obligaciones contractuales.",variables:["beneficiario","contrato_ref","concepto","fecha"],contenido:`PAZ Y SALVO

{{empresa_nombre}} certifica que {{beneficiario}} se encuentra a paz y salvo por concepto de {{concepto}} del contrato {{contrato_ref}}.

Se expide en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1},{id:"tpl_cert_laboral",cat:"formatos",nombre:"Certificacin Laboral",desc:"Certificado de vinculacin laboral con cargo y salario.",variables:["nombre_empleado","documento_empleado","cargo","fecha_ingreso","salario","fecha"],contenido:`CERTIFICACIN LABORAL

{{empresa_nombre}}, NIT {{empresa_nit}}, certifica que {{nombre_empleado}}, identificado con C.C. {{documento_empleado}}, labora en esta empresa desde el {{fecha_ingreso}} desempeando el cargo de {{cargo}}, con un salario mensual de {{salario}}.

Se expide a solicitud del interesado en {{ciudad}} el {{fecha}}.`,pais:"CO",obligatorio:!1}],td=[{id:"rcextra",label:"RC Extracontractual",icon:"",color:"#B91C1C"},{id:"todo_riesgo",label:"Todo Riesgo Construccin",icon:"",color:"#3B3B3B"},{id:"cumplimiento",label:"Cumplimiento",icon:"",color:"#111111"},{id:"calidad",label:"Calidad / Estabilidad",icon:"",color:"#5B3A8C"},{id:"prestaciones",label:"Prestaciones Sociales",icon:"",color:"#8C6A00"},{id:"vehicular",label:"Vehicular / SOAT",icon:"",color:"#0D5E6E"},{id:"otro",label:"Otro seguro",icon:"",color:"#555"}],Rx=[{id:"s1",tipo:"todo_riesgo",aseguradora:"Seguros Bolvar",poliza:"POL-2026-001245",proyecto:"Casa Chic Norte",valor_asegurado:"$120.000.000",prima:"$3.600.000",vigencia_inicio:"2026-01-15",vigencia_fin:"2026-07-15",beneficiario:"Andrs Meja Ruiz",estado:"vigente",notas:"Cubre daos durante ejecucin de obra"},{id:"s2",tipo:"rcextra",aseguradora:"Sura",poliza:"RC-2026-778899",proyecto:"General empresa",valor_asegurado:"$500.000.000",prima:"$8.500.000",vigencia_inicio:"2026-01-01",vigencia_fin:"2026-12-31",beneficiario:"Habitaris S.A.S",estado:"vigente",notas:"Responsabilidad civil por daos a terceros"},{id:"s3",tipo:"cumplimiento",aseguradora:"Liberty Seguros",poliza:"CUM-2025-556677",proyecto:"Oficina 301 WTC",valor_asegurado:"$85.000.000",prima:"$2.125.000",vigencia_inicio:"2025-06-01",vigencia_fin:"2026-06-01",beneficiario:"TechStar S.A.S",estado:"por_vencer",notas:"Garanta de cumplimiento del contrato"},{id:"s4",tipo:"calidad",aseguradora:"Seguros Bolvar",poliza:"CAL-2025-112233",proyecto:"Apto 502 Rosales",valor_asegurado:"$45.000.000",prima:"$675.000",vigencia_inicio:"2025-03-01",vigencia_fin:"2030-03-01",beneficiario:"Mara Fernanda Gmez",estado:"vigente",notas:"Garanta de estabilidad de obra  5 aos"}],ra=[{id:"abierto",label:"Abierto",color:"#3B3B3B",bg:"#F0F0F0"},{id:"en_curso",label:"En curso",color:"#8C6A00",bg:"#FFF8EE"},{id:"favorable",label:"Favorable",color:"#111111",bg:"#EBEBEB"},{id:"cerrado",label:"Cerrado",color:"#555",bg:"#F5F5F5"},{id:"perdido",label:"Desfavorable",color:"#B91C1C",bg:"#FDF0F0"}],Mx=[{id:"p1",tipo:"Reclamacin de garanta",contraparte:"Proveedor XYZ Pisos",proyecto:"Oficina 301 WTC",descripcion:"Reclamacin por defectos en piso laminado instalado. Present levantamiento a los 3 meses.",estado:"en_curso",fecha_inicio:"2026-01-20",abogado:"Dr. Martn Velsquez",valor_pretension:"$8.500.000",seguimiento:[{fecha:"2026-01-20",nota:"Se enva carta de reclamacin al proveedor"},{fecha:"2026-01-30",nota:"Proveedor responde negando responsabilidad"},{fecha:"2026-02-10",nota:"Se enva informe pericial con registro fotogrfico"},{fecha:"2026-02-20",nota:"Reunin de conciliacin programada para marzo 5"}]},{id:"p2",tipo:"Incumplimiento contractual",contraparte:"Cliente: Roberto Pineda",proyecto:"Remodelacin Apto 801 Virrey",descripcion:"Cliente se rehsa a pagar saldo final ($18M) alegando inconformidad no sustentada.",estado:"abierto",fecha_inicio:"2026-02-01",abogado:"Dra. Carolina Mendoza",valor_pretension:"$18.000.000",seguimiento:[{fecha:"2026-02-01",nota:"Se enva carta de cobro prejudicial"},{fecha:"2026-02-15",nota:"Sin respuesta del cliente. Se prepara demanda ejecutiva."}]}];function _x(){const[t,i]=F.useState("plantillas"),[o,n]=F.useState(()=>qr("plantillas")||Ix),[s,r]=F.useState(()=>qr("documentos_gen")||[]),[a,u]=F.useState(()=>qr("seguros")||Rx),[h,b]=F.useState(()=>qr("procesos")||Mx),[j,C]=F.useState(""),[v,m]=F.useState("all"),[f,p]=F.useState(null),[c,d]=F.useState(null),[l,x]=F.useState(null),[y,g]=F.useState(null),[S,A]=F.useState(null),[E,w]=F.useState(null);F.useEffect(()=>Hr("plantillas",o),[o]),F.useEffect(()=>Hr("documentos_gen",s),[s]),F.useEffect(()=>Hr("seguros",a),[a]),F.useEffect(()=>Hr("procesos",h),[h]);const I=F.useMemo(()=>{const oe=a.filter(T=>new Date(T.vigencia_fin)>=new Date),L=a.filter(T=>{const W=ed(T.vigencia_fin);return W>=0&&W<=60}),R=a.filter(T=>new Date(T.vigencia_fin)<new Date);return{total:a.length,vigentes:oe.length,porVencer:L.length,vencidos:R.length}},[a]),z=()=>{const oe=o.filter(L=>v!=="all"&&L.cat!==v?!1:j?L.nombre.toLowerCase().includes(j.toLowerCase())||L.desc.toLowerCase().includes(j.toLowerCase()):!0);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16,alignItems:"center"},children:[e.jsxs("select",{value:v,onChange:L=>m(L.target.value),style:{...He,padding:"6px 12px",fontSize:11,border:`1px solid ${Ae.border}`,borderRadius:6,background:"#fff"},children:[e.jsx("option",{value:"all",children:"Todas las categoras"}),Gr.map(L=>e.jsxs("option",{value:L.id,children:[L.icon," ",L.label]},L.id))]}),e.jsx("div",{style:{flex:1,minWidth:180},children:e.jsx("input",{value:j,onChange:L=>C(L.target.value),placeholder:"Buscar plantilla",style:{...He,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${Ae.border}`,borderRadius:6,boxSizing:"border-box"}})})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px,1fr))",gap:12},children:oe.map(L=>{const R=Gr.find(T=>T.id===L.cat);return e.jsxs("div",{onClick:()=>p(L.id),style:{background:"#fff",border:`1px solid ${Ae.border}`,borderLeft:`3px solid ${R==null?void 0:R.color}`,borderRadius:10,padding:18,cursor:"pointer",boxShadow:Ae.shadow,transition:"all .15s"},onMouseEnter:T=>T.currentTarget.style.boxShadow=Ae.shadowMd,onMouseLeave:T=>T.currentTarget.style.boxShadow=Ae.shadow,children:[e.jsx("div",{style:{display:"flex",gap:6,marginBottom:8},children:e.jsxs(Ro,{color:R==null?void 0:R.color,bg:(R==null?void 0:R.color)+"18",children:[R==null?void 0:R.icon," ",R==null?void 0:R.label]})}),e.jsx("div",{style:{...He,fontSize:14,fontWeight:700,color:Ae.ink,marginBottom:4},children:L.nombre}),e.jsx("div",{style:{...He,fontSize:11,color:Ae.inkLight,lineHeight:1.5,marginBottom:8,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:L.desc}),e.jsxs("div",{style:{...He,fontSize:10,color:Ae.inkLight},children:[" ",L.variables.length," campos  ",L.pais==="CO"?"":""]})]},L.id)})})]})},B=()=>{const oe=f?o.find(R=>R.id===f):null;if(!oe)return null;const L=Gr.find(R=>R.id===oe.cat);return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>p(null),children:e.jsxs("div",{onClick:R=>R.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:720,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[e.jsxs("div",{children:[e.jsxs(Ro,{color:L==null?void 0:L.color,bg:(L==null?void 0:L.color)+"18",children:[L==null?void 0:L.icon," ",L==null?void 0:L.label]}),e.jsx("h2",{style:{...He,fontSize:18,fontWeight:700,color:Ae.ink,margin:"8px 0 4px"},children:oe.nombre}),e.jsx("p",{style:{...He,fontSize:12,color:Ae.inkLight,margin:0},children:oe.desc})]}),e.jsx("button",{onClick:()=>p(null),style:{...He,fontSize:18,color:Ae.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...He,fontSize:11,fontWeight:600,color:Ae.inkMid,marginBottom:6},children:"Campos variables:"}),e.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:oe.variables.map(R=>e.jsx(Ro,{color:Ae.info,bg:Ae.infoBg,children:`{{${R}}}`},R))})]}),e.jsx("div",{style:{background:Ae.surface,border:`1px solid ${Ae.border}`,borderRadius:8,padding:20,marginBottom:16,maxHeight:300,overflow:"auto"},children:e.jsx("pre",{style:{...He,fontSize:11,color:Ae.inkMid,lineHeight:1.7,whiteSpace:"pre-wrap",margin:0},children:oe.contenido})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>{w({plantilla:oe,variables:{}}),p(null)},style:{...He,padding:"8px 20px",fontSize:12,fontWeight:700,color:"#fff",background:Ae.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Generar documento"}),e.jsx("button",{style:{...He,padding:"8px 18px",fontSize:12,color:Ae.inkMid,background:Ae.bg,border:`1px solid ${Ae.border}`,borderRadius:6,cursor:"pointer"},children:" Editar plantilla"})]})]})})},P=()=>{if(!E)return null;const{plantilla:oe,variables:L}=E,R=(M,O)=>w(ne=>({...ne,variables:{...ne.variables,[M]:O}})),T={empresa_nombre:"Habitaris S.A.S",empresa_nit:"901.922.136-8",rep_legal:"Laura Snchez Daz",ciudad:"Bogot D.C.",fecha:new Date().toLocaleDateString("es-CO",{day:"numeric",month:"long",year:"numeric"})},W=oe.contenido.replace(/\{\{(\w+)\}\}/g,(M,O)=>L[O]||T[O]||`[${O}]`),X=()=>{const M={id:na(),plantillaId:oe.id,titulo:`${oe.nombre}  ${L[oe.variables[0]]||"Sin datos"}`,contenido:W,variables:{...T,...L},fecha:new Date().toISOString()};r(O=>[...O,M]),w(null),alert(" Documento generado y guardado")};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>w(null),children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:800,width:"100%",maxHeight:"90vh",overflow:"auto",padding:28},children:[e.jsxs("h2",{style:{...He,fontSize:16,fontWeight:700,color:Ae.ink,marginBottom:4},children:[" Generar: ",oe.nombre]}),e.jsx("p",{style:{...He,fontSize:11,color:Ae.inkLight,marginBottom:16},children:"Completa los campos y genera el documento."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:16},children:oe.variables.map(M=>e.jsxs("div",{children:[e.jsx("label",{style:{...He,fontSize:10,fontWeight:600,color:Ae.inkLight},children:M.replace(/_/g," ")}),e.jsx("input",{value:L[M]||"",onChange:O=>R(M,O.target.value),style:{...He,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ae.border}`,borderRadius:5,boxSizing:"border-box"}})]},M))}),e.jsx("div",{style:{...He,fontSize:11,fontWeight:600,color:Ae.inkMid,marginBottom:6},children:"Vista previa:"}),e.jsx("div",{style:{background:Ae.surface,border:`1px solid ${Ae.border}`,borderRadius:8,padding:20,marginBottom:16,maxHeight:300,overflow:"auto"},children:e.jsx("pre",{style:{...He,fontSize:11,color:Ae.ink,lineHeight:1.7,whiteSpace:"pre-wrap",margin:0},children:W})}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>w(null),style:{...He,padding:"8px 20px",fontSize:12,color:Ae.inkMid,background:Ae.bg,border:`1px solid ${Ae.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{style:{...He,padding:"8px 18px",fontSize:12,color:Ae.info,background:Ae.infoBg,border:`1px solid ${Ae.info}33`,borderRadius:6,cursor:"pointer"},children:" Enviar a Firma Digital"}),e.jsx("button",{onClick:X,style:{...He,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:Ae.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar documento"})]})]})})},q=()=>e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Total plizas",val:I.total,icon:""},{label:"Vigentes",val:I.vigentes,icon:""},{label:"Por vencer (60d)",val:I.porVencer,icon:"",warn:I.porVencer>0},{label:"Vencidas",val:I.vencidos,icon:"",danger:I.vencidos>0}].map((oe,L)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"10px 14px",background:oe.danger?Ae.dangerBg:oe.warn?Ae.warningBg:"#fff",border:`1px solid ${oe.danger?Ae.danger+"33":oe.warn?Ae.warning+"33":Ae.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...He,fontSize:9,color:Ae.inkLight},children:[oe.icon," ",oe.label]}),e.jsx("div",{style:{...He,fontSize:18,fontWeight:700,color:oe.danger?Ae.danger:oe.warn?Ae.warning:Ae.ink},children:oe.val})]},L))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:j,onChange:oe=>C(oe.target.value),placeholder:"Buscar pliza, proyecto, aseguradora",style:{...He,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${Ae.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>g({id:na(),tipo:"todo_riesgo",aseguradora:"",poliza:"",proyecto:"",valor_asegurado:"",prima:"",vigencia_inicio:"",vigencia_fin:"",beneficiario:"",estado:"vigente",notas:""}),style:{...He,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:Ae.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nueva pliza"})]}),a.map(oe=>{const L=td.find(X=>X.id===oe.tipo),R=ed(oe.vigencia_fin),T=R<0,W=R>=0&&R<=60;return e.jsxs("div",{onClick:()=>d(oe.id),style:{display:"flex",gap:14,alignItems:"center",padding:"14px 18px",background:"#fff",border:`1px solid ${T?Ae.danger+"44":W?Ae.warning+"44":Ae.border}`,borderRadius:10,marginBottom:8,cursor:"pointer",boxShadow:Ae.shadow,transition:"all .15s"},onMouseEnter:X=>X.currentTarget.style.boxShadow=Ae.shadowMd,onMouseLeave:X=>X.currentTarget.style.boxShadow=Ae.shadow,children:[e.jsx("div",{style:{width:42,height:42,borderRadius:10,background:(L==null?void 0:L.color)+"15",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0},children:L==null?void 0:L.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...He,fontSize:13,fontWeight:700,color:Ae.ink},children:L==null?void 0:L.label}),e.jsxs("div",{style:{...He,fontSize:11,color:Ae.inkLight},children:[oe.aseguradora,"  Pliza: ",oe.poliza]}),e.jsxs("div",{style:{...He,fontSize:10,color:Ae.inkLight},children:[oe.proyecto,"  Beneficiario: ",oe.beneficiario]})]}),e.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[e.jsx("div",{style:{...He,fontSize:12,fontWeight:600,color:Ae.ink},children:oe.valor_asegurado}),e.jsxs("div",{style:{...He,fontSize:10,color:Ae.inkLight},children:[tn(oe.vigencia_inicio),"  ",tn(oe.vigencia_fin)]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(Ro,{color:T?Ae.danger:W?Ae.warning:Ae.accent,bg:T?Ae.dangerBg:W?Ae.warningBg:Ae.accentBg,children:T?`Vencida hace ${Math.abs(R)}d`:W?`Vence en ${R}d`:"Vigente"})})]})]},oe.id)})]}),U=()=>{if(!y)return null;const oe=!a.find(T=>T.id===y.id),L=(T,W)=>g(X=>({...X,[T]:W})),R=()=>{u(oe?T=>[...T,y]:T=>T.map(W=>W.id===y.id?y:W)),g(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>g(null),children:e.jsxs("div",{onClick:T=>T.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:580,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...He,fontSize:16,fontWeight:700,color:Ae.ink,marginBottom:16},children:oe?" Nueva pliza":" Editar pliza"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[["tipo","Tipo",!0],["aseguradora","Aseguradora"],["poliza","N Pliza"],["proyecto","Proyecto"],["valor_asegurado","Valor asegurado"],["prima","Prima"],["vigencia_inicio","Inicio vigencia","date"],["vigencia_fin","Fin vigencia","date"],["beneficiario","Beneficiario"],["notas","Notas"]].map(([T,W,X])=>e.jsxs("div",{style:{gridColumn:T==="notas"?"1/-1":void 0},children:[e.jsx("label",{style:{...He,fontSize:10,fontWeight:600,color:Ae.inkLight},children:W}),X===!0?e.jsx("select",{value:y[T],onChange:M=>L(T,M.target.value),style:{...He,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ae.border}`,borderRadius:5},children:td.map(M=>e.jsxs("option",{value:M.id,children:[M.icon," ",M.label]},M.id))}):e.jsx("input",{type:X||"text",value:y[T]||"",onChange:M=>L(T,M.target.value),style:{...He,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ae.border}`,borderRadius:5,boxSizing:"border-box"}})]},T))}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>g(null),style:{...He,padding:"8px 20px",fontSize:12,color:Ae.inkMid,background:Ae.bg,border:`1px solid ${Ae.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:R,style:{...He,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:Ae.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},$=()=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:j,onChange:oe=>C(oe.target.value),placeholder:"Buscar proceso",style:{...He,width:"100%",padding:"6px 12px",fontSize:11,border:`1px solid ${Ae.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{onClick:()=>A({id:na(),tipo:"",contraparte:"",proyecto:"",descripcion:"",estado:"abierto",fecha_inicio:new Date().toISOString().slice(0,10),abogado:"",valor_pretension:"",seguimiento:[]}),style:{...He,padding:"7px 16px",fontSize:11,fontWeight:700,color:"#fff",background:Ae.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo proceso"})]}),h.map(oe=>{const L=ra.find(R=>R.id===oe.estado);return e.jsxs("div",{onClick:()=>x(oe.id),style:{background:"#fff",border:`1px solid ${Ae.border}`,borderRadius:10,padding:18,marginBottom:10,cursor:"pointer",boxShadow:Ae.shadow,transition:"all .15s"},onMouseEnter:R=>R.currentTarget.style.boxShadow=Ae.shadowMd,onMouseLeave:R=>R.currentTarget.style.boxShadow=Ae.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:6},children:[e.jsxs("div",{children:[e.jsx("div",{style:{...He,fontSize:14,fontWeight:700,color:Ae.ink},children:oe.tipo}),e.jsxs("div",{style:{...He,fontSize:11,color:Ae.inkLight},children:["vs. ",oe.contraparte,"  ",oe.proyecto]})]}),e.jsx(Ro,{color:L==null?void 0:L.color,bg:L==null?void 0:L.bg,children:L==null?void 0:L.label})]}),e.jsx("div",{style:{...He,fontSize:11,color:Ae.inkMid,marginBottom:6,lineHeight:1.5},children:oe.descripcion}),e.jsxs("div",{style:{display:"flex",gap:16,...He,fontSize:10,color:Ae.inkLight},children:[e.jsxs("span",{children:[" ",oe.abogado]}),e.jsxs("span",{children:[" ",oe.valor_pretension]}),e.jsxs("span",{children:[" ",tn(oe.fecha_inicio)]}),e.jsxs("span",{children:[" ",oe.seguimiento.length," notas"]})]})]},oe.id)}),h.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:40,color:Ae.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...He,fontSize:13},children:"No hay procesos legales registrados"})]})]}),Y=()=>{const oe=l?h.find(X=>X.id===l):null;if(!oe)return null;const L=ra.find(X=>X.id===oe.estado),[R,T]=F.useState(""),W=()=>{R.trim()&&(b(X=>X.map(M=>M.id===oe.id?{...M,seguimiento:[...M.seguimiento,{fecha:new Date().toISOString().slice(0,10),nota:R}]}:M)),T(""))};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>x(null),children:e.jsxs("div",{onClick:X=>X.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:640,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx(Ro,{color:L==null?void 0:L.color,bg:L==null?void 0:L.bg,children:L==null?void 0:L.label}),e.jsx("h2",{style:{...He,fontSize:18,fontWeight:700,color:Ae.ink,margin:"8px 0 2px"},children:oe.tipo}),e.jsxs("div",{style:{...He,fontSize:12,color:Ae.inkLight},children:["vs. ",oe.contraparte,"  ",oe.proyecto]})]}),e.jsx("button",{onClick:()=>x(null),style:{...He,fontSize:18,color:Ae.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsx("p",{style:{...He,fontSize:12,color:Ae.inkMid,lineHeight:1.6,marginBottom:16},children:oe.descripcion}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:20},children:[{label:"Abogado",val:oe.abogado},{label:"Valor pretensin",val:oe.valor_pretension},{label:"Fecha inicio",val:tn(oe.fecha_inicio)}].map((X,M)=>e.jsxs("div",{style:{padding:10,background:Ae.surface,borderRadius:6},children:[e.jsx("div",{style:{...He,fontSize:9,color:Ae.inkLight},children:X.label}),e.jsx("div",{style:{...He,fontSize:12,fontWeight:600,color:Ae.ink},children:X.val})]},M))}),e.jsx("div",{style:{...He,fontSize:13,fontWeight:700,color:Ae.ink,marginBottom:10},children:" Seguimiento"}),e.jsx("div",{style:{borderLeft:`2px solid ${Ae.border}`,paddingLeft:16,marginLeft:8,marginBottom:16},children:oe.seguimiento.map((X,M)=>e.jsxs("div",{style:{marginBottom:12,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-22,top:2,width:10,height:10,borderRadius:"50%",background:M===oe.seguimiento.length-1?Ae.accent:Ae.bg,border:`2px solid ${M===oe.seguimiento.length-1?Ae.accent:Ae.border}`}}),e.jsx("div",{style:{...He,fontSize:10,color:Ae.inkLight},children:tn(X.fecha)}),e.jsx("div",{style:{...He,fontSize:12,color:Ae.ink},children:X.nota})]},M))}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("input",{value:R,onChange:X=>T(X.target.value),placeholder:"Aadir nota de seguimiento",onKeyDown:X=>X.key==="Enter"&&W(),style:{...He,flex:1,padding:"7px 12px",fontSize:12,border:`1px solid ${Ae.border}`,borderRadius:6}}),e.jsx("button",{onClick:W,style:{...He,padding:"7px 16px",fontSize:11,fontWeight:600,color:"#fff",background:Ae.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nota"})]})]})})},ge=()=>{if(!S)return null;const oe=!h.find(T=>T.id===S.id),L=(T,W)=>A(X=>({...X,[T]:W})),R=()=>{b(oe?T=>[...T,S]:T=>T.map(W=>W.id===S.id?S:W)),A(null)};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>A(null),children:e.jsxs("div",{onClick:T=>T.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:540,width:"100%",maxHeight:"85vh",overflow:"auto",padding:28},children:[e.jsx("h2",{style:{...He,fontSize:16,fontWeight:700,color:Ae.ink,marginBottom:16},children:oe?" Nuevo proceso":" Editar"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[[["tipo","Tipo de proceso"],["contraparte","Contraparte"],["proyecto","Proyecto vinculado"],["abogado","Abogado responsable"],["valor_pretension","Valor pretensin"],["fecha_inicio","Fecha inicio","date"]].map(([T,W,X])=>e.jsxs("div",{children:[e.jsx("label",{style:{...He,fontSize:10,fontWeight:600,color:Ae.inkLight},children:W}),e.jsx("input",{type:X||"text",value:S[T]||"",onChange:M=>L(T,M.target.value),style:{...He,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ae.border}`,borderRadius:5,boxSizing:"border-box"}})]},T)),e.jsxs("div",{style:{gridColumn:"1/-1"},children:[e.jsx("label",{style:{...He,fontSize:10,fontWeight:600,color:Ae.inkLight},children:"Estado"}),e.jsx("select",{value:S.estado,onChange:T=>L("estado",T.target.value),style:{...He,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ae.border}`,borderRadius:5},children:ra.map(T=>e.jsx("option",{value:T.id,children:T.label},T.id))})]}),e.jsxs("div",{style:{gridColumn:"1/-1"},children:[e.jsx("label",{style:{...He,fontSize:10,fontWeight:600,color:Ae.inkLight},children:"Descripcin"}),e.jsx("textarea",{value:S.descripcion||"",onChange:T=>L("descripcion",T.target.value),rows:3,style:{...He,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${Ae.border}`,borderRadius:5,resize:"vertical",boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:20,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>A(null),style:{...He,padding:"8px 20px",fontSize:12,color:Ae.inkMid,background:Ae.bg,border:`1px solid ${Ae.border}`,borderRadius:6,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:R,style:{...He,padding:"8px 24px",fontSize:12,fontWeight:700,color:"#fff",background:Ae.accent,border:"none",borderRadius:6,cursor:"pointer"},children:" Guardar"})]})]})})},J=()=>e.jsx("div",{children:s.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40,color:Ae.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...He,fontSize:13},children:"No hay documentos generados an. Ve a Plantillas y genera uno."})]}):s.map(oe=>{const L=o.find(T=>T.id===oe.plantillaId),R=Gr.find(T=>T.id===(L==null?void 0:L.cat));return e.jsxs("div",{style:{background:"#fff",border:`1px solid ${Ae.border}`,borderRadius:10,padding:16,marginBottom:8,boxShadow:Ae.shadow},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsxs("div",{children:[e.jsxs(Ro,{color:R==null?void 0:R.color,bg:(R==null?void 0:R.color)+"18",children:[R==null?void 0:R.icon," ",R==null?void 0:R.label]}),e.jsx("div",{style:{...He,fontSize:13,fontWeight:700,color:Ae.ink,marginTop:4},children:oe.titulo})]}),e.jsx("div",{style:{...He,fontSize:10,color:Ae.inkLight},children:tn(oe.fecha)})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{style:{...He,padding:"5px 12px",fontSize:10,color:Ae.info,background:Ae.infoBg,border:`1px solid ${Ae.info}33`,borderRadius:4,cursor:"pointer"},children:" Ver"}),e.jsx("button",{style:{...He,padding:"5px 12px",fontSize:10,color:Ae.accent,background:Ae.accentBg,border:`1px solid ${Ae.accent}33`,borderRadius:4,cursor:"pointer"},children:" Enviar a firma"}),e.jsx("button",{style:{...He,padding:"5px 12px",fontSize:10,color:Ae.inkMid,background:Ae.surface,border:`1px solid ${Ae.border}`,borderRadius:4,cursor:"pointer"},children:" PDF"})]})]},oe.id)})}),ye=[{id:"plantillas",icon:"",label:"Plantillas",badge:o.length},{id:"generados",icon:"",label:"Docs Generados",badge:s.length||null},{id:"seguros",icon:"",label:"Seguros / Plizas",badge:I.porVencer+I.vencidos||null},{id:"procesos",icon:"",label:"Procesos Legales",badge:h.filter(oe=>oe.estado==="abierto"||oe.estado==="en_curso").length||null}];return e.jsxs("div",{style:{...He,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...He,fontSize:22,fontWeight:700,color:Ae.ink,margin:"0 0 4px"},children:" Legal"}),e.jsx("p",{style:{...He,fontSize:12,color:Ae.inkLight,margin:0},children:"Plantillas contractuales, gestin de plizas, seguimiento de procesos legales"})]}),e.jsx("div",{style:{display:"flex",gap:2,borderBottom:`1px solid ${Ae.border}`,marginBottom:20},children:ye.map(oe=>e.jsxs("button",{onClick:()=>i(oe.id),style:{...He,padding:"10px 16px",fontSize:12,fontWeight:t===oe.id?700:500,color:t===oe.id?Ae.accent:Ae.inkLight,background:"none",border:"none",borderBottom:t===oe.id?`2px solid ${Ae.accent}`:"2px solid transparent",cursor:"pointer"},children:[oe.icon," ",oe.label,oe.badge&&e.jsx("span",{style:{marginLeft:6,background:t===oe.id?Ae.accent:Ae.border,color:"#fff",padding:"1px 7px",borderRadius:10,fontSize:10},children:oe.badge})]},oe.id))}),t==="plantillas"&&z(),t==="generados"&&J(),t==="seguros"&&q(),t==="procesos"&&$(),B(),P(),U(),Y(),ge()]})}const Dx=()=>e.jsx("style",{children:`
    @import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'DM Sans',sans-serif;background:#F5F4F1;-webkit-font-smoothing:antialiased}
    ::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}
    input,select,textarea{font-family:'DM Sans',sans-serif;outline:none}
    button{font-family:'DM Sans',sans-serif;cursor:pointer}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .fade-up{animation:fadeUp .22s ease both}
  `}),de={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",purpleBg:"#F0ECF6",teal:"#0D5E6E",tealBg:"#E0F4F4",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Dt=()=>Math.random().toString(36).slice(2,9),Wo=()=>new Date().toISOString().split("T")[0],io=()=>new Date().toISOString(),bc=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",$x=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/36e5);return o<1?"hace momentos":o<24?`hace ${o}h`:`hace ${Math.floor(o/24)}d`};function on(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Fe.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const s=F.useCallback(async r=>{const a=typeof r=="function"?r(o):r;n(a);try{Fe.set(t,JSON.stringify(a))}catch{}},[t,o]);return[o,s]}const ai=({children:t,style:i})=>e.jsx("div",{style:{background:de.surface,border:`1px solid ${de.border}`,borderRadius:8,boxShadow:de.shadow,...i},children:t}),co=({children:t,v:i,sm:o,on:n,style:s,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${de.border}`:"none",borderRadius:5,cursor:"pointer",background:i==="sec"?"#fff":i==="danger"?de.redBg:de.ink,color:i==="sec"?de.inkMid:i==="danger"?de.red:"#fff",...s},...r,children:t}),Yn=({label:t,color:i,bg:o})=>e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:3,padding:"2px 7px",borderRadius:3,background:o,color:i,fontSize:9,fontWeight:700},children:t}),sa=[{id:"dashboard",lbl:"Dashboard",I:vs,desc:"Indicadores generales de calidad"},{id:"nc",lbl:"No conformidades",I:li,desc:"Registro y gestin de no conformidades"},{id:"auditorias",lbl:"Auditoras",I:Na,desc:"Auditoras internas y externas programadas"},{id:"protocolos",lbl:"Protocolos",I:Bt,desc:"Protocolos de ensayo, pruebas y recepcin"},{id:"checklists",lbl:"Listas de chequeo",I:yt,desc:"Listas de verificacin por actividad"},{id:"entregas",lbl:"Actas de entrega",I:Sn,desc:"Actas parciales y finales de obra"},{id:"indicadores",lbl:"Indicadores KPI",I:Uc,desc:"Mtricas y metas de calidad"}],Xn=[{id:"menor",lbl:"Menor",color:de.amber,bg:de.amberBg},{id:"mayor",lbl:"Mayor",color:"#D4840A",bg:"#FFF3E0"},{id:"critica",lbl:"Crtica",color:de.red,bg:de.redBg}],Px=["Materiales fuera de especificacin","Dimensiones fuera de tolerancia","Acabado defectuoso","Instalacin incorrecta","Falta de planeidad","Fisuras o grietas","Humedad o filtracin","Incumplimiento de planos","Incumplimiento de norma","Falta de documentacin","Otro"],Ox=["Interna","Externa","Seguimiento","Pre-entrega","Recepcin materiales"],Lx=["Ensayo de resistencia (concreto)","Prueba hidrosttica","Prueba de estanqueidad","Verificacin de niveles","Prueba de aislamiento elctrico","Ensayo de compactacin","Verificacin de planeidad","Prueba de carga","Inspeccin visual de soldadura","Prueba de adherencia (pintura)","Otro"];function Wx(){var x,y;const[t,i]=F.useState("dashboard"),[o,n]=on("hab:calidad:nc",[]),[s,r]=on("hab:calidad:auditorias",[]),[a,u]=on("hab:calidad:protocolos",[]),[h,b]=on("hab:calidad:checklists",[]),[j,C]=on("hab:calidad:entregas",[]),[v,m]=on("hab:calidad:indicadores",[{id:Dt(),nombre:"Tasa de NC por actividad",meta:5,actual:3.2,unidad:"%",periodo:"mensual"},{id:Dt(),nombre:"NC cerradas en plazo",meta:90,actual:78,unidad:"%",periodo:"mensual"},{id:Dt(),nombre:"Auditoras realizadas",meta:4,actual:2,unidad:"ud",periodo:"trimestral"},{id:Dt(),nombre:"Satisfaccin cliente",meta:4.5,actual:4.2,unidad:"/5",periodo:"por proyecto"},{id:Dt(),nombre:"Reprocesos",meta:2,actual:1,unidad:"%",periodo:"mensual"}]),f={border:`1px solid ${de.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},p=o.filter(g=>g.estado==="abierta"||g.estado==="en_proceso").length,c=o.filter(g=>g.estado==="cerrada").length,d=s.filter(g=>g.estado==="programada").length,l=o.filter(g=>g.severidad==="critica"&&g.estado!=="cerrada").length;return e.jsxs(e.Fragment,{children:[e.jsx(Dx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:de.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:de.surface,borderBottom:`1px solid ${de.border}`,padding:"11px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:de.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:de.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:de.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:de.ink})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:de.inkLight,marginLeft:10},children:"/ Calidad y Auditora"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[l>0&&e.jsxs("div",{style:{background:de.redBg,border:`1px solid ${de.red}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>i("nc"),children:[e.jsx(li,{size:12,color:de.red}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:de.red},children:[l," NC crtica",l!==1?"s":""]})]}),d>0&&e.jsxs("div",{style:{background:de.blueBg,border:`1px solid ${de.blue}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5,cursor:"pointer"},onClick:()=>i("auditorias"),children:[e.jsx(Na,{size:12,color:de.blue}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:de.blue},children:[d," auditora",d!==1?"s":""," pendiente",d!==1?"s":""]})]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsxs("div",{style:{width:210,flexShrink:0,background:de.surface,borderRight:`1px solid ${de.border}`,display:"flex",flexDirection:"column",paddingTop:8,overflowY:"auto"},children:[sa.map(g=>{const S=t===g.id,A=g.id==="nc"?p:g.id==="auditorias"?d:0;return e.jsxs("button",{onClick:()=>i(g.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:S?`3px solid ${de.ink}`:"3px solid transparent",background:S?de.accent:"transparent",color:S?de.ink:de.inkLight,fontSize:12,fontWeight:S?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(g.I,{size:13})," ",e.jsx("span",{style:{flex:1,lineHeight:1.2},children:g.lbl}),A>0&&e.jsx("span",{style:{background:g.id==="nc"?de.red:de.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:A})]},g.id)}),e.jsx("div",{style:{flex:1}}),e.jsx("div",{style:{padding:"10px 16px",fontSize:9,color:de.inkXLight,letterSpacing:.8,borderTop:`1px solid ${de.border}`},children:"Auto-guardado activo"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingBottom:40},children:e.jsxs("div",{style:{padding:"24px 28px",maxWidth:1100},children:[e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("h2",{style:{fontSize:19,fontWeight:700,color:de.ink,letterSpacing:-.2},children:(x=sa.find(g=>g.id===t))==null?void 0:x.lbl}),e.jsx("p",{style:{fontSize:11,color:de.inkLight,marginTop:2},children:(y=sa.find(g=>g.id===t))==null?void 0:y.desc})]}),t==="dashboard"&&e.jsx(Nx,{ncs:o,auditorias:s,indicadores:v,ncAbiertas:p,ncCerradas:c,audPendientes:d,ncCriticas:l,setTab:i}),t==="nc"&&e.jsx(Ux,{ncs:o,saveNcs:n,inp:f}),t==="auditorias"&&e.jsx(Vx,{auditorias:s,saveAud:r,inp:f}),t==="protocolos"&&e.jsx(qx,{protocolos:a,saveProt:u,inp:f}),t==="checklists"&&e.jsx(Hx,{checklists:h,saveCheck:b,inp:f}),t==="entregas"&&e.jsx(Gx,{entregas:j,saveEntregas:C,inp:f}),t==="indicadores"&&e.jsx(Kx,{indicadores:v,saveKpi:m,inp:f})]})})]})]})]})}function Nx({ncs:t,auditorias:i,indicadores:o,ncAbiertas:n,ncCerradas:s,audPendientes:r,ncCriticas:a,setTab:u}){const h=t.length,b=h>0?Math.round(s/h*100):100;return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"NC abiertas",val:n,color:de.red,bg:de.redBg},{lbl:"NC crticas",val:a,color:a>0?de.red:de.green,bg:a>0?de.redBg:de.greenBg},{lbl:"Tasa de cierre",val:`${b}%`,color:b>=80?de.green:de.amber,bg:b>=80?de.greenBg:de.amberBg},{lbl:"Auditoras pend.",val:r,color:de.blue,bg:de.blueBg},{lbl:"Total NC",val:h,color:de.inkMid,bg:de.surfaceAlt}].map(j=>e.jsxs(ai,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase",letterSpacing:1},children:j.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:j.color,marginTop:4},children:j.val})]},j.lbl))}),e.jsxs(ai,{style:{padding:20,marginBottom:16,textAlign:"center",background:b>=80&&a===0?de.greenBg:a>0?de.redBg:de.amberBg,border:`1px solid ${b>=80&&a===0?de.green:a>0?de.red:de.amber}33`},children:[e.jsxs("div",{style:{fontSize:40,fontWeight:800,color:b>=80&&a===0?de.green:a>0?de.red:de.amber},children:[b>=80&&a===0?"":a>0?"":""," ",b,"%"]}),e.jsx("div",{style:{fontSize:14,fontWeight:700,color:de.ink,marginTop:4},children:"ndice de conformidad"}),e.jsx("div",{style:{fontSize:11,color:de.inkMid},children:a>0?`${a} no conformidad(es) crtica(s) requieren atencin inmediata`:n>0?`${n} NC abiertas pendientes de resolucin`:"Sistema de calidad sin hallazgos abiertos"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs(ai,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:de.redBg,borderBottom:`1px solid ${de.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,fontWeight:700,color:de.red},children:"NC recientes"}),e.jsx("button",{onClick:()=>u("nc"),style:{background:"none",border:"none",fontSize:9,color:de.red,fontWeight:600,cursor:"pointer"},children:"Ver todas "})]}),t.length===0?e.jsx("div",{style:{padding:20,textAlign:"center",color:de.inkLight,fontSize:11},children:"Sin no conformidades "}):[...t].sort((j,C)=>C.fecha>j.fecha?1:-1).slice(0,5).map(j=>{var v;const C=Xn.find(m=>m.id===j.severidad)||Xn[0];return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:8,fontSize:10},children:[e.jsx(Yn,{label:C.lbl,color:C.color,bg:C.bg}),e.jsx("span",{style:{flex:1,fontWeight:500},children:((v=j.descripcion)==null?void 0:v.slice(0,50))||"Sin descripcin"}),e.jsx(Yn,{label:j.estado,color:j.estado==="cerrada"?de.green:de.amber,bg:j.estado==="cerrada"?de.greenBg:de.amberBg})]},j.id)})]}),e.jsxs(ai,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:de.blueBg,borderBottom:`1px solid ${de.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,fontWeight:700,color:de.blue},children:"Indicadores clave"}),e.jsx("button",{onClick:()=>u("indicadores"),style:{background:"none",border:"none",fontSize:9,color:de.blue,fontWeight:600,cursor:"pointer"},children:"Configurar "})]}),o.slice(0,5).map(j=>{const C=j.unidad==="%"?j.actual<=j.meta:j.actual>=j.meta,v=j.meta>0?Math.min(j.actual/j.meta*100,100):0;return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:3},children:[e.jsx("span",{style:{fontWeight:600},children:j.nombre}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,color:C?de.green:de.amber},children:[j.actual,j.unidad," / ",j.meta,j.unidad]})]}),e.jsx("div",{style:{height:4,background:de.border,borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${v}%`,background:C?de.green:de.amber,borderRadius:2,transition:"width .3s"}})})]},j.id)})]})]}),t.length===0&&i.length===0&&e.jsxs(ai,{style:{padding:24,textAlign:"center",marginTop:16},children:[e.jsx(Na,{size:32,style:{color:de.inkLight,opacity:.3,marginBottom:8}}),e.jsx("div",{style:{fontSize:13,fontWeight:600,color:de.inkMid,marginBottom:12},children:"Sin datos de calidad an"}),e.jsxs(co,{on:()=>{const j=[{id:Dt(),fecha:io(),numero:"NC-001",proyecto:"Torre Norte Apto 301",ubicacion:"Bao principal",categoria:"Fisuras o grietas",severidad:"mayor",descripcion:"Fisura longitudinal en paete de muro, longitud aprox 1.2m. Zona hmeda del bao principal.",estado:"abierta",responsable:"Residente",accionCorrectiva:"",fechaLimite:(()=>{const v=new Date;return v.setDate(v.getDate()+7),v.toISOString().split("T")[0]})(),evidencias:"Foto tomada",seguimiento:[]},{id:Dt(),fecha:io(),numero:"NC-002",proyecto:"Torre Norte Apto 301",ubicacion:"Cocina",categoria:"Dimensiones fuera de tolerancia",severidad:"menor",descripcion:"Mesn de cocina 2cm ms corto de lo especificado en plano. No afecta funcionalidad.",estado:"en_proceso",responsable:"Contratista carpintera",accionCorrectiva:"Se ajustar la pieza en la prxima visita",fechaLimite:(()=>{const v=new Date;return v.setDate(v.getDate()+5),v.toISOString().split("T")[0]})(),evidencias:"",seguimiento:[{fecha:io(),nota:"Se contact al proveedor para rehacer pieza",por:"Residente"}]},{id:Dt(),fecha:io(),numero:"NC-003",proyecto:"Oficinas Chic",ubicacion:"Piso 4 - Zona abierta",categoria:"Acabado defectuoso",severidad:"critica",descripcion:"Porcelanato presenta manchas de xido en 15m de la zona abierta. Material de lote defectuoso.",estado:"abierta",responsable:"Proveedor Cermicas",accionCorrectiva:"",fechaLimite:Wo(),evidencias:"Fotos y video",seguimiento:[]},{id:Dt(),fecha:io(),numero:"NC-004",proyecto:"Casa Campestre Cha",ubicacion:"Cubierta",categoria:"Humedad o filtracin",severidad:"mayor",descripcion:"Filtracin en unin de cubierta con muro fachada norte. Se evidencia humedad en cielo raso.",estado:"cerrada",responsable:"Impermeabilizador",accionCorrectiva:"Se resell junta con membrana asfltica y se verific estanqueidad",fechaLimite:Wo(),evidencias:"Antes/despus",seguimiento:[{fecha:io(),nota:"Reparacin ejecutada",por:"Residente"},{fecha:io(),nota:"Prueba de estanqueidad OK, se cierra NC",por:"Director"}]}];saveNcs(j);const C=[{id:Dt(),fecha:Wo(),tipo:"Interna",proyecto:"Torre Norte",auditor:"David Parra",alcance:"Revisin acabados pisos 1-3",estado:"programada",hallazgos:"",calificacion:0},{id:Dt(),fecha:(()=>{const v=new Date;return v.setDate(v.getDate()-7),v.toISOString().split("T")[0]})(),tipo:"Pre-entrega",proyecto:"Casa Campestre Cha",auditor:"Ana Mara Daz",alcance:"Verificacin general pre-entrega al cliente",estado:"realizada",hallazgos:"3 hallazgos menores en acabados de pintura",calificacion:85}];saveAud(C)},children:[e.jsx(Ne,{size:12})," Crear datos de ejemplo"]})]})]})}function Ux({ncs:t,saveNcs:i,inp:o}){const[n,s]=F.useState("todos"),[r,a]=F.useState(""),[u,h]=F.useState(null),b=()=>{const m={id:Dt(),fecha:io(),numero:`NC-${String(t.length+1).padStart(3,"0")}`,proyecto:"",ubicacion:"",categoria:"Otro",severidad:"menor",descripcion:"",estado:"abierta",responsable:"",accionCorrectiva:"",fechaLimite:"",evidencias:"",seguimiento:[]};i(f=>[...f,m]),h(m.id)},j=(m,f,p)=>i(c=>c.map(d=>d.id===m?{...d,[f]:p}:d)),C=(m,f)=>{i(p=>p.map(c=>c.id===m?{...c,seguimiento:[...c.seguimiento||[],{fecha:io(),nota:f,por:"Usuario"}]}:c))},v=t.filter(m=>!(n!=="todos"&&m.estado!==n||r&&!(m.descripcion||"").toLowerCase().includes(r.toLowerCase())&&!(m.numero||"").toLowerCase().includes(r.toLowerCase())&&!(m.proyecto||"").toLowerCase().includes(r.toLowerCase()))).sort((m,f)=>f.fecha>m.fecha?1:-1);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["todos","Todas"],["abierta","Abiertas"],["en_proceso","En proceso"],["cerrada","Cerradas"]].map(([m,f],p,c)=>e.jsxs("button",{onClick:()=>s(m),style:{padding:"5px 12px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${de.border}`,borderLeft:p>0?"none":void 0,borderRadius:p===0?"4px 0 0 4px":p===c.length-1?"0 4px 4px 0":"0",background:n===m?de.ink:"#fff",color:n===m?"#fff":de.inkMid},children:[f," ",m==="abierta"?`(${t.filter(d=>d.estado==="abierta").length})`:""]},m))}),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ki,{size:12,style:{position:"absolute",left:8,top:9,color:de.inkLight}}),e.jsx("input",{value:r,onChange:m=>a(m.target.value),placeholder:"Buscar NC...",style:{...o,paddingLeft:26,width:200}})]}),e.jsxs(co,{sm:!0,on:b,style:{background:de.red},children:[e.jsx(Ne,{size:10})," Nueva NC"]})]}),e.jsx(ai,{style:{padding:0,overflow:"hidden"},children:v.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:de.inkLight,fontSize:12},children:["Sin no conformidades ",n!=="todos"?`con estado "${n}"`:""]}):v.map(m=>{const f=Xn.find(d=>d.id===m.severidad)||Xn[0],p=u===m.id,c=m.fechaLimite&&new Date(m.fechaLimite)<new Date&&m.estado!=="cerrada";return e.jsxs("div",{style:{borderBottom:`1px solid ${de.border}`},children:[e.jsxs("div",{onClick:()=>h(p?null:m.id),style:{padding:"10px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:p?de.surfaceAlt:"transparent",borderLeft:`4px solid ${f.color}`},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:de.blue,background:de.blueBg,padding:"2px 6px",borderRadius:3},children:m.numero}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.descripcion||"Sin descripcin"}),e.jsxs("div",{style:{fontSize:9,color:de.inkLight,marginTop:1},children:[m.proyecto||"Sin proyecto","  ",m.ubicacion||"Sin ubicacin","  ",m.categoria]})]}),e.jsx(Yn,{label:f.lbl,color:f.color,bg:f.bg}),c&&e.jsx(Yn,{label:"VENCIDA",color:de.red,bg:de.redBg}),e.jsx(Yn,{label:m.estado,color:m.estado==="cerrada"?de.green:m.estado==="en_proceso"?de.blue:de.amber,bg:m.estado==="cerrada"?de.greenBg:m.estado==="en_proceso"?de.blueBg:de.amberBg}),e.jsx("span",{style:{fontSize:9,color:de.inkLight},children:$x(m.fecha)}),p?e.jsx(kn,{size:12}):e.jsx(Xi,{size:12})]}),p&&e.jsxs("div",{style:{padding:"0 16px 14px 20px",background:de.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:8,marginTop:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:m.proyecto||"",onChange:d=>j(m.id,"proyecto",d.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Ubicacin"}),e.jsx("input",{value:m.ubicacion||"",onChange:d=>j(m.id,"ubicacion",d.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Responsable"}),e.jsx("input",{value:m.responsable||"",onChange:d=>j(m.id,"responsable",d.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Fecha lmite"}),e.jsx("input",{type:"date",value:m.fechaLimite||"",onChange:d=>j(m.id,"fechaLimite",d.target.value),style:{...o,width:"100%"}})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsx("select",{value:m.categoria,onChange:d=>j(m.id,"categoria",d.target.value),style:{...o,width:"100%"},children:Px.map(d=>e.jsx("option",{children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Severidad"}),e.jsx("select",{value:m.severidad,onChange:d=>j(m.id,"severidad",d.target.value),style:{...o,width:"100%"},children:Xn.map(d=>e.jsx("option",{value:d.id,children:d.lbl},d.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Estado"}),e.jsx("select",{value:m.estado,onChange:d=>j(m.id,"estado",d.target.value),style:{...o,width:"100%",background:m.estado==="cerrada"?de.greenBg:m.estado==="en_proceso"?de.blueBg:"#fff"},children:["abierta","en_proceso","cerrada"].map(d=>e.jsx("option",{value:d,children:d},d))})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Descripcin del hallazgo"}),e.jsx("textarea",{value:m.descripcion||"",onChange:d=>j(m.id,"descripcion",d.target.value),rows:2,style:{...o,width:"100%",resize:"vertical",lineHeight:1.5}})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Accin correctiva"}),e.jsx("textarea",{value:m.accionCorrectiva||"",onChange:d=>j(m.id,"accionCorrectiva",d.target.value),rows:2,placeholder:"Describir la accin correctiva aplicada o propuesta...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5,background:m.estado==="cerrada"?de.greenBg:"#fff"}})]}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:de.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Seguimiento"}),(m.seguimiento||[]).map((d,l)=>{var x;return e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${de.border}`,paddingLeft:10,marginLeft:4,marginBottom:2},children:[e.jsx("span",{style:{color:de.inkLight,minWidth:60,fontSize:9},children:bc((x=d.fecha)==null?void 0:x.split("T")[0])}),e.jsx("span",{style:{fontWeight:600,fontSize:9},children:d.por}),e.jsx("span",{style:{color:de.inkMid},children:d.nota})]},l)}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:4},children:[e.jsx("input",{id:`seg-nc-${m.id}`,placeholder:"Aadir nota de seguimiento...",style:{...o,flex:1,fontSize:10}}),e.jsxs(co,{sm:!0,v:"sec",on:()=>{const d=document.getElementById(`seg-nc-${m.id}`);d!=null&&d.value.trim()&&(C(m.id,d.value),d.value="")},children:[e.jsx(Ne,{size:9})," Aadir"]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:e.jsx("button",{onClick:()=>i(d=>d.filter(l=>l.id!==m.id)),style:{background:"none",border:"none",color:de.red,fontSize:10,cursor:"pointer"},children:" Eliminar NC"})})]})]},m.id)})})]})}function Vx({auditorias:t,saveAud:i,inp:o}){const n=()=>{i(r=>[...r,{id:Dt(),fecha:Wo(),tipo:"Interna",proyecto:"",auditor:"",alcance:"",estado:"programada",hallazgos:"",calificacion:0,items:[]}])},s=(r,a,u)=>i(h=>h.map(b=>b.id===r?{...b,[a]:u}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:n,children:[e.jsx(Ne,{size:10})," Nueva auditora"]})}),t.sort((r,a)=>a.fecha>r.fecha?1:-1).map(r=>e.jsxs(ai,{style:{padding:16,marginBottom:10,borderLeft:`4px solid ${r.estado==="realizada"?de.green:r.estado==="programada"?de.blue:de.inkLight}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{type:"date",value:r.fecha,onChange:a=>s(r.id,"fecha",a.target.value),style:{border:`1px solid ${de.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("select",{value:r.tipo,onChange:a=>s(r.id,"tipo",a.target.value),style:{...o,width:140,fontSize:11,fontWeight:600},children:Ox.map(a=>e.jsx("option",{children:a},a))}),e.jsx("input",{value:r.proyecto||"",onChange:a=>s(r.id,"proyecto",a.target.value),placeholder:"Proyecto",style:{flex:1,...o,fontWeight:600}}),e.jsx("input",{value:r.auditor||"",onChange:a=>s(r.id,"auditor",a.target.value),placeholder:"Auditor",style:{width:140,...o,fontSize:10}}),e.jsx("select",{value:r.estado,onChange:a=>s(r.id,"estado",a.target.value),style:{fontSize:9,padding:"3px 8px",border:`1px solid ${de.border}`,borderRadius:3,background:r.estado==="realizada"?de.greenBg:r.estado==="programada"?de.blueBg:"#fff"},children:["programada","en_curso","realizada","cancelada"].map(a=>e.jsx("option",{children:a},a))}),e.jsx("button",{onClick:()=>i(a=>a.filter(u=>u.id!==r.id)),style:{background:"none",border:"none",color:de.red,cursor:"pointer"},children:e.jsx(Je,{size:12})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Alcance"}),e.jsx("input",{value:r.alcance||"",onChange:a=>s(r.id,"alcance",a.target.value),placeholder:"reas y actividades a auditar",style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Calificacin (%)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"range",min:0,max:100,value:r.calificacion||0,onChange:a=>s(r.id,"calificacion",+a.target.value),style:{flex:1,accentColor:r.calificacion>=80?de.green:de.amber}}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:12,fontWeight:700,color:r.calificacion>=80?de.green:r.calificacion>=50?de.amber:de.red},children:[r.calificacion||0,"%"]})]})]})]}),r.estado==="realizada"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Hallazgos"}),e.jsx("textarea",{value:r.hallazgos||"",onChange:a=>s(r.id,"hallazgos",a.target.value),rows:2,placeholder:"Resumen de hallazgos...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5}})]})]},r.id)),t.length===0&&e.jsx(ai,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:de.inkLight},children:"Sin auditoras programadas"})})]})}function qx({protocolos:t,saveProt:i,inp:o}){const n=()=>{i(r=>[...r,{id:Dt(),fecha:Wo(),tipo:"Otro",proyecto:"",ubicacion:"",responsable:"",resultado:"pendiente",valor:"",valorRef:"",observaciones:""}])},s=(r,a,u)=>i(h=>h.map(b=>b.id===r?{...b,[a]:u}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:n,children:[e.jsx(Ne,{size:10})," Nuevo protocolo"]})}),e.jsx(ai,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:de.surfaceAlt},children:["Fecha","Tipo de ensayo/prueba","Proyecto","Ubicacin","Valor","Ref.","Resultado","Responsable",""].map(r=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${de.border}`},children:r},r))})}),e.jsxs("tbody",{children:[t.sort((r,a)=>a.fecha>r.fecha?1:-1).map(r=>e.jsxs("tr",{style:{borderBottom:`1px solid ${de.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:r.fecha,onChange:a=>s(r.id,"fecha",a.target.value),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:r.tipo,onChange:a=>s(r.id,"tipo",a.target.value),style:{border:"none",background:"transparent",fontSize:10,fontWeight:600},children:Lx.map(a=>e.jsx("option",{children:a},a))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.proyecto||"",onChange:a=>s(r.id,"proyecto",a.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.ubicacion||"",onChange:a=>s(r.id,"ubicacion",a.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:80}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.valor||"",onChange:a=>s(r.id,"valor",a.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:60,fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.valorRef||"",onChange:a=>s(r.id,"valorRef",a.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:60,fontFamily:"'DM Mono',monospace"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("select",{value:r.resultado,onChange:a=>s(r.id,"resultado",a.target.value),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${de.border}`,borderRadius:3,background:r.resultado==="conforme"?de.greenBg:r.resultado==="no_conforme"?de.redBg:"#fff"},children:[["pendiente","Pendiente"],["conforme","Conforme"],["no_conforme","No conforme"]].map(([a,u])=>e.jsx("option",{value:a,children:u},a))})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:r.responsable||"",onChange:a=>s(r.id,"responsable",a.target.value),placeholder:"",style:{border:"none",background:"transparent",fontSize:10,width:70}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>i(a=>a.filter(u=>u.id!==r.id)),style:{background:"none",border:"none",color:de.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})})]},r.id)),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:30,textAlign:"center",color:de.inkLight},children:"Sin protocolos registrados"})})]})]})})]})}function Hx({checklists:t,saveCheck:i,inp:o}){const[n,s]=F.useState(null),r=()=>{const b={id:Dt(),nombre:"Nueva lista de chequeo",proyecto:"",fecha:Wo(),responsable:"",items:[{id:Dt(),texto:"Verificar niveles y plomos",ok:!1},{id:Dt(),texto:"Verificar dimensiones segn plano",ok:!1},{id:Dt(),texto:"Verificar acabado superficial",ok:!1},{id:Dt(),texto:"Verificar juntas y sellantes",ok:!1},{id:Dt(),texto:"Verificar limpieza del rea",ok:!1}]};i(j=>[...j,b]),s(b.id)},a=(b,j,C)=>i(v=>v.map(m=>m.id===b?{...m,[j]:C}:m)),u=(b,j)=>{i(C=>C.map(v=>v.id===b?{...v,items:v.items.map(m=>m.id===j?{...m,ok:!m.ok}:m)}:v))},h=b=>{i(j=>j.map(C=>C.id===b?{...C,items:[...C.items,{id:Dt(),texto:"",ok:!1}]}:C))};return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:r,children:[e.jsx(Ne,{size:10})," Nueva lista"]})}),t.map(b=>{const j=b.items.filter(f=>f.ok).length,C=b.items.length,v=C>0?Math.round(j/C*100):0,m=n===b.id;return e.jsxs(ai,{style:{marginBottom:10,padding:0,overflow:"hidden"},children:[e.jsxs("div",{onClick:()=>s(m?null:b.id),style:{padding:"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:m?de.surfaceAlt:"transparent"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",border:`3px solid ${v>=100?de.green:de.border}`,display:"flex",alignItems:"center",justifyContent:"center",background:v>=100?de.greenBg:"transparent",flexShrink:0},children:v>=100?e.jsx(Vo,{size:16,color:de.green}):e.jsxs("span",{style:{fontSize:9,fontWeight:800,fontFamily:"'DM Mono',monospace",color:de.inkMid},children:[v,"%"]})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:b.nombre}),e.jsxs("div",{style:{fontSize:9,color:de.inkLight},children:[b.proyecto||"Sin proyecto","  ",j,"/",C," items  ",bc(b.fecha)]})]}),e.jsx("div",{style:{width:80,height:6,background:de.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${v}%`,background:v>=100?de.green:de.blue,borderRadius:3}})}),m?e.jsx(kn,{size:12}):e.jsx(Xi,{size:12})]}),m&&e.jsxs("div",{style:{padding:"0 16px 14px",background:de.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",gap:8,marginBottom:10},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Nombre"}),e.jsx("input",{value:b.nombre,onChange:f=>a(b.id,"nombre",f.target.value),style:{...o,width:"100%",fontWeight:700}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:b.proyecto||"",onChange:f=>a(b.id,"proyecto",f.target.value),style:{...o,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase"},children:"Responsable"}),e.jsx("input",{value:b.responsable||"",onChange:f=>a(b.id,"responsable",f.target.value),style:{...o,width:"100%"}})]})]}),b.items.map((f,p)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"5px 0",borderBottom:`1px solid ${de.border}`},children:[e.jsx("button",{onClick:()=>u(b.id,f.id),style:{width:22,height:22,borderRadius:4,border:`2px solid ${f.ok?de.green:de.border}`,background:f.ok?de.greenBg:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:f.ok&&e.jsx(yt,{size:12,color:de.green})}),e.jsx("input",{value:f.texto,onChange:c=>{i(d=>d.map(l=>l.id===b.id?{...l,items:l.items.map(x=>x.id===f.id?{...x,texto:c.target.value}:x)}:l))},placeholder:"Descripcin del item...",style:{flex:1,border:"none",background:"transparent",fontSize:11,textDecoration:f.ok?"line-through":"none",color:f.ok?de.inkLight:de.ink}}),e.jsx("button",{onClick:()=>i(c=>c.map(d=>d.id===b.id?{...d,items:d.items.filter(l=>l.id!==f.id)}:d)),style:{background:"none",border:"none",color:de.red,cursor:"pointer"},children:e.jsx(Je,{size:10})})]},f.id)),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[e.jsxs(co,{sm:!0,v:"sec",on:()=>h(b.id),children:[e.jsx(Ne,{size:9})," Aadir item"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{onClick:()=>i(f=>f.filter(p=>p.id!==b.id)),style:{background:"none",border:"none",color:de.red,fontSize:10,cursor:"pointer"},children:" Eliminar lista"})]})]})]},b.id)}),t.length===0&&e.jsx(ai,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:de.inkLight},children:"Sin listas de chequeo. Crea la primera."})})]})}function Gx({entregas:t,saveEntregas:i,inp:o}){const n=()=>{i(r=>[...r,{id:Dt(),fecha:Wo(),tipo:"parcial",proyecto:"",cliente:"",descripcion:"",items:[],estado:"borrador",observaciones:"",firmaCliente:!1,firmaHabitaris:!1}])},s=(r,a,u)=>i(h=>h.map(b=>b.id===r?{...b,[a]:u}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:n,children:[e.jsx(Ne,{size:10})," Nueva acta"]})}),t.sort((r,a)=>a.fecha>r.fecha?1:-1).map(r=>e.jsxs(ai,{style:{padding:16,marginBottom:10,borderLeft:`4px solid ${r.estado==="firmada"?de.green:r.estado==="enviada"?de.blue:de.inkLight}`},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[e.jsx("input",{type:"date",value:r.fecha,onChange:a=>s(r.id,"fecha",a.target.value),style:{border:`1px solid ${de.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsxs("select",{value:r.tipo,onChange:a=>s(r.id,"tipo",a.target.value),style:{...o,width:100,fontSize:11,fontWeight:600},children:[e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"final",children:"Final"}),e.jsx("option",{value:"provisional",children:"Provisional"})]}),e.jsx("input",{value:r.proyecto||"",onChange:a=>s(r.id,"proyecto",a.target.value),placeholder:"Proyecto",style:{flex:1,...o,fontWeight:600}}),e.jsx("input",{value:r.cliente||"",onChange:a=>s(r.id,"cliente",a.target.value),placeholder:"Cliente",style:{width:140,...o,fontSize:10}}),e.jsx("select",{value:r.estado,onChange:a=>s(r.id,"estado",a.target.value),style:{fontSize:9,padding:"3px 8px",border:`1px solid ${de.border}`,borderRadius:3,background:r.estado==="firmada"?de.greenBg:r.estado==="enviada"?de.blueBg:"#fff"},children:["borrador","enviada","firmada"].map(a=>e.jsx("option",{children:a},a))}),e.jsx("button",{onClick:()=>i(a=>a.filter(u=>u.id!==r.id)),style:{background:"none",border:"none",color:de.red,cursor:"pointer"},children:e.jsx(Je,{size:12})})]}),e.jsx("textarea",{value:r.descripcion||"",onChange:a=>s(r.id,"descripcion",a.target.value),rows:2,placeholder:"Descripcin de los trabajos entregados...",style:{...o,width:"100%",resize:"vertical",lineHeight:1.5,marginBottom:6}}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",fontSize:10},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.firmaHabitaris||!1,onChange:a=>s(r.id,"firmaHabitaris",a.target.checked)}),e.jsx("span",{style:{fontWeight:600},children:"Firma Habitaris"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r.firmaCliente||!1,onChange:a=>s(r.id,"firmaCliente",a.target.checked)}),e.jsx("span",{style:{fontWeight:600},children:"Firma Cliente"})]}),e.jsx("input",{value:r.observaciones||"",onChange:a=>s(r.id,"observaciones",a.target.value),placeholder:"Observaciones...",style:{flex:1,...o,fontSize:10}})]})]},r.id)),t.length===0&&e.jsx(ai,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:de.inkLight},children:"Sin actas de entrega"})})]})}function Kx({indicadores:t,saveKpi:i,inp:o}){const n=()=>{i(r=>[...r,{id:Dt(),nombre:"Nuevo indicador",meta:0,actual:0,unidad:"%",periodo:"mensual"}])},s=(r,a,u)=>i(h=>h.map(b=>b.id===r?{...b,[a]:u}:b));return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:14},children:e.jsxs(co,{sm:!0,on:n,children:[e.jsx(Ne,{size:10})," Nuevo indicador"]})}),e.jsx(ai,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:de.surfaceAlt},children:["Indicador","Meta","Actual","Unidad","Perodo","Cumplimiento",""].map(r=>e.jsx("th",{style:{padding:"8px 12px",fontSize:8,fontWeight:700,color:de.inkLight,textTransform:"uppercase",textAlign:["Meta","Actual"].includes(r)?"right":"left",borderBottom:`2px solid ${de.border}`},children:r},r))})}),e.jsx("tbody",{children:t.map(r=>{const a=r.meta>0?Math.min(r.actual/r.meta*100,150):0,u=r.unidad==="%"&&(r.nombre.toLowerCase().includes("reproceso")||r.nombre.toLowerCase().includes("nc por"))?r.actual<=r.meta:r.actual>=r.meta;return e.jsxs("tr",{style:{borderBottom:`1px solid ${de.border}`},children:[e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("input",{value:r.nombre,onChange:h=>s(r.id,"nombre",h.target.value),style:{border:"none",background:"transparent",fontSize:12,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"8px 12px",textAlign:"right"},children:e.jsx("input",{type:"number",value:r.meta||"",onChange:h=>s(r.id,"meta",+h.target.value),style:{width:50,border:`1px solid ${de.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,textAlign:"right",fontFamily:"'DM Mono',monospace",background:"#fff"}})}),e.jsx("td",{style:{padding:"8px 12px",textAlign:"right"},children:e.jsx("input",{type:"number",value:r.actual||"",onChange:h=>s(r.id,"actual",+h.target.value),style:{width:50,border:`1px solid ${de.border}`,borderRadius:3,padding:"3px 6px",fontSize:11,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,background:u?de.greenBg:de.amberBg,color:u?de.green:de.amber}})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("select",{value:r.unidad,onChange:h=>s(r.id,"unidad",h.target.value),style:{border:"none",background:"transparent",fontSize:10},children:["%","ud","/5","das","h"].map(h=>e.jsx("option",{children:h},h))})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("select",{value:r.periodo,onChange:h=>s(r.id,"periodo",h.target.value),style:{border:"none",background:"transparent",fontSize:10},children:["mensual","trimestral","semestral","anual","por proyecto"].map(h=>e.jsx("option",{children:h},h))})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{flex:1,height:6,background:de.border,borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${Math.min(a,100)}%`,background:u?de.green:de.amber,borderRadius:3,transition:"width .3s"}})}),e.jsx("span",{style:{fontSize:9,fontWeight:700,color:u?de.green:de.amber},children:u?"":""})]})}),e.jsx("td",{style:{padding:"8px 12px"},children:e.jsx("button",{onClick:()=>i(h=>h.filter(b=>b.id!==r.id)),style:{background:"none",border:"none",color:de.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})})]},r.id)})})]})})]})}const Jx=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Oe={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Un=()=>Math.random().toString(36).slice(2,9),aa=()=>new Date().toISOString().split("T")[0],id=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"",Yx=t=>{if(!t)return"";const i=Date.now()-new Date(t).getTime(),o=Math.floor(i/36e5);return o<24?`hace ${o}h`:`hace ${Math.floor(o/24)}d`};function Kr(t,i){const[o,n]=F.useState(i);F.useEffect(()=>{(()=>{try{const r=Fe.getSync(t);r!=null&&r.value&&n(JSON.parse(r))}catch{}})()},[t]);const s=F.useCallback(async r=>{const a=typeof r=="function"?r(o):r;n(a);try{Fe.set(t,JSON.stringify(a))}catch{}},[t,o]);return[o,s]}const $i=({children:t,style:i})=>e.jsx("div",{style:{background:Oe.surface,border:`1px solid ${Oe.border}`,borderRadius:8,boxShadow:Oe.shadow,...i},children:t}),nn=({children:t,v:i,sm:o,on:n,style:s,...r})=>e.jsx("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:5,padding:o?"5px 10px":"8px 16px",fontSize:o?10:11,fontWeight:600,border:i==="sec"?`1px solid ${Oe.border}`:"none",borderRadius:5,background:i==="sec"?"#fff":Oe.ink,color:i==="sec"?Oe.inkMid:"#fff",cursor:"pointer",...s},...r,children:t}),Xx=[{id:"dashboard",lbl:"Dashboard",I:vs,desc:"Resumen de postventa y satisfaccin"},{id:"tickets",lbl:"Tickets",I:ms,desc:"Solicitudes y reclamos de clientes"},{id:"garantias",lbl:"Garantas",I:Bt,desc:"Control de garantas vigentes"},{id:"visitas",lbl:"Visitas",I:Ad,desc:"Visitas de inspeccin y correccin"},{id:"encuestas",lbl:"Satisfaccin",I:Vc,desc:"Encuestas y calificaciones"}],Vn=[{id:"baja",lbl:"Baja",color:Oe.green,bg:Oe.greenBg},{id:"media",lbl:"Media",color:Oe.amber,bg:Oe.amberBg},{id:"alta",lbl:"Alta",color:"#D4840A",bg:"#FFF3E0"},{id:"urgente",lbl:"Urgente",color:Oe.red,bg:Oe.redBg}],Qx=["Impermeabilizacin","Pintura","Grietas/fisuras","Instalaciones hidrulicas","Instalaciones elctricas","Carpintera","Pisos","Cielos","Cerraduras/chapas","Otro"];function Zx(){const[t,i]=F.useState("dashboard"),[o,n]=Kr("hab:postventa:tickets",[]),[s,r]=Kr("hab:postventa:garantias",[]),[a,u]=Kr("hab:postventa:visitas",[]),[h,b]=Kr("hab:postventa:encuestas",[]),[j,C]=F.useState(null),v={border:`1px solid ${Oe.border}`,borderRadius:4,padding:"6px 10px",fontSize:12,background:"#fff"},m=()=>{const l={id:Un(),fecha:new Date().toISOString(),numero:`TK-${String(o.length+1).padStart(4,"0")}`,cliente:"",proyecto:"",categoria:"Otro",prioridad:"media",descripcion:"",estado:"abierto",contacto:"",telefono:"",email:"",seguimiento:[],resolucion:""};n(x=>[...x,l]),C(l.id)},f=(l,x,y)=>n(g=>g.map(S=>S.id===l?{...S,[x]:y}:S)),p=(l,x)=>{n(y=>y.map(g=>g.id===l?{...g,seguimiento:[...g.seguimiento||[],{id:Un(),fecha:new Date().toISOString(),nota:x,por:"Habitaris"}]}:g))},c=o.filter(l=>l.estado==="abierto"||l.estado==="en_proceso"),d=h.length>0?(h.reduce((l,x)=>l+(x.calificacion||0),0)/h.length).toFixed(1):"";return e.jsxs(e.Fragment,{children:[e.jsx(Jx,{}),e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:Oe.bg,overflow:"hidden"},children:[e.jsxs("div",{style:{background:Oe.surface,borderBottom:`1px solid ${Oe.border}`,padding:"11px 28px",display:"flex",alignItems:"center",gap:14},children:[e.jsxs("svg",{width:26,height:26,viewBox:"0 0 34 34",fill:"none",children:[e.jsx("rect",{x:"2.5",y:"4.5",width:"25",height:"25",stroke:Oe.ink,strokeWidth:"1.2"}),e.jsx("rect",{x:"7.5",y:"10",width:"4",height:"13",fill:Oe.ink}),e.jsx("rect",{x:"7.5",y:"15.5",width:"13",height:"3",fill:Oe.ink}),e.jsx("rect",{x:"16.5",y:"10",width:"4",height:"13",fill:Oe.ink})]}),e.jsx("span",{style:{fontSize:13,fontWeight:800,letterSpacing:3.5,textTransform:"uppercase"},children:"HABITARIS"}),e.jsx("span",{style:{fontSize:11,color:Oe.inkLight},children:"/ Postventa"}),e.jsx("div",{style:{flex:1}}),c.length>0&&e.jsxs("div",{style:{background:Oe.amberBg,border:`1px solid ${Oe.amber}33`,borderRadius:4,padding:"5px 10px",display:"flex",alignItems:"center",gap:5},children:[e.jsx(li,{size:12,color:Oe.amber}),e.jsxs("span",{style:{fontSize:10,fontWeight:700,color:Oe.amber},children:[c.length," ticket",c.length!==1?"s":""," abierto",c.length!==1?"s":""]})]})]}),e.jsxs("div",{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx("div",{style:{width:200,flexShrink:0,background:Oe.surface,borderRight:`1px solid ${Oe.border}`,paddingTop:8},children:Xx.map(l=>{const x=l.id==="tickets"?c.length:0;return e.jsxs("button",{onClick:()=>i(l.id),style:{display:"flex",alignItems:"center",gap:9,padding:"10px 16px",border:"none",borderLeft:t===l.id?`3px solid ${Oe.ink}`:"3px solid transparent",background:t===l.id?Oe.accent:"transparent",color:t===l.id?Oe.ink:Oe.inkLight,fontSize:12,fontWeight:t===l.id?700:400,cursor:"pointer",textAlign:"left",width:"100%"},children:[e.jsx(l.I,{size:13})," ",e.jsx("span",{style:{flex:1},children:l.lbl}),x>0&&e.jsx("span",{style:{background:Oe.amber,color:"#fff",fontSize:8,fontWeight:800,padding:"1px 5px",borderRadius:8},children:x})]},l.id)})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"24px 28px",maxWidth:1100},children:e.jsxs("div",{className:"fade-up",children:[t==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[{lbl:"Tickets abiertos",val:c.length,color:Oe.amber,bg:Oe.amberBg},{lbl:"Total tickets",val:o.length,color:Oe.blue,bg:Oe.blueBg},{lbl:"Resueltos",val:o.filter(l=>l.estado==="cerrado").length,color:Oe.green,bg:Oe.greenBg},{lbl:"Garantas activas",val:s.filter(l=>new Date(l.vencimiento)>new Date).length,color:"#5B3A8C",bg:"#F0ECF6"},{lbl:"Satisfaccin",val:d,color:parseFloat(d)>=4?Oe.green:Oe.amber,bg:parseFloat(d)>=4?Oe.greenBg:Oe.amberBg}].map(l=>e.jsxs($i,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase",letterSpacing:1},children:l.lbl}),e.jsx("div",{style:{fontSize:26,fontWeight:800,color:l.color,marginTop:4},children:l.val})]},l.lbl))}),e.jsxs($i,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:`1px solid ${Oe.border}`,display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Tickets recientes"}),e.jsxs(nn,{sm:!0,on:m,children:[e.jsx(Ne,{size:10})," Nuevo ticket"]})]}),o.length===0?e.jsxs("div",{style:{padding:30,textAlign:"center",color:Oe.inkLight},children:[e.jsx(Ad,{size:28,style:{opacity:.3,marginBottom:8}}),e.jsx("div",{children:"Sin tickets de postventa"})]}):[...o].sort((l,x)=>x.fecha>l.fecha?1:-1).slice(0,8).map(l=>{var y,g;const x=Vn.find(S=>S.id===l.prioridad)||Vn[1];return e.jsxs("div",{style:{padding:"8px 16px",borderBottom:"1px solid #F5F5F5",display:"flex",alignItems:"center",gap:10,fontSize:11,cursor:"pointer"},onClick:()=>{i("tickets"),C(l.id)},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:700,color:Oe.blue},children:l.numero}),e.jsxs("span",{style:{flex:1,fontWeight:500},children:[((y=l.descripcion)==null?void 0:y.slice(0,60))||"Sin descripcin",((g=l.descripcion)==null?void 0:g.length)>60?"...":""]}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:x.bg,color:x.color,fontWeight:700},children:x.lbl}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:l.estado==="cerrado"?Oe.greenBg:l.estado==="en_proceso"?Oe.blueBg:Oe.amberBg,color:l.estado==="cerrado"?Oe.green:l.estado==="en_proceso"?Oe.blue:Oe.amber,fontWeight:700},children:l.estado}),e.jsx("span",{style:{fontSize:9,color:Oe.inkLight},children:Yx(l.fecha)})]},l.id)})]})]}),t==="tickets"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Tickets de postventa"}),e.jsxs(nn,{sm:!0,on:m,children:[e.jsx(Ne,{size:10})," Nuevo ticket"]})]}),o.sort((l,x)=>x.fecha>l.fecha?1:-1).map(l=>{var g;const x=Vn.find(S=>S.id===l.prioridad)||Vn[1],y=j===l.id;return e.jsxs($i,{style:{marginBottom:8,padding:0,overflow:"hidden",borderLeft:`4px solid ${x.color}`},children:[e.jsxs("div",{onClick:()=>C(y?null:l.id),style:{padding:"12px 16px",cursor:"pointer",display:"flex",alignItems:"center",gap:10,background:y?Oe.surfaceAlt:"transparent"},children:[e.jsx("span",{style:{fontFamily:"'DM Mono',monospace",fontSize:10,fontWeight:700,color:Oe.blue},children:l.numero}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:600},children:[l.cliente||"Cliente","  ",l.proyecto||"Proyecto"]}),e.jsxs("div",{style:{fontSize:10,color:Oe.inkLight},children:[l.categoria,"  ",id((g=l.fecha)==null?void 0:g.split("T")[0])]})]}),e.jsx("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:3,background:x.bg,color:x.color,fontWeight:700},children:x.lbl}),e.jsx("select",{value:l.estado,onChange:S=>{S.stopPropagation(),f(l.id,"estado",S.target.value)},style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Oe.border}`,borderRadius:3,background:l.estado==="cerrado"?Oe.greenBg:l.estado==="en_proceso"?Oe.blueBg:Oe.amberBg},children:["abierto","en_proceso","cerrado"].map(S=>e.jsx("option",{value:S,children:S},S))}),y?e.jsx(Xi,{size:12,style:{transform:"rotate(90deg)"}}):e.jsx(Xi,{size:12})]}),y&&e.jsxs("div",{style:{padding:"0 16px 14px",background:Oe.surfaceAlt},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase"},children:"Cliente"}),e.jsx("input",{value:l.cliente||"",onChange:S=>f(l.id,"cliente",S.target.value),style:{...v,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase"},children:"Proyecto"}),e.jsx("input",{value:l.proyecto||"",onChange:S=>f(l.id,"proyecto",S.target.value),style:{...v,width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase"},children:"Categora"}),e.jsx("select",{value:l.categoria,onChange:S=>f(l.id,"categoria",S.target.value),style:{...v,width:"100%"},children:Qx.map(S=>e.jsx("option",{children:S},S))})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:8},children:[e.jsx("input",{value:l.contacto||"",onChange:S=>f(l.id,"contacto",S.target.value),placeholder:" Contacto",style:v}),e.jsx("input",{value:l.telefono||"",onChange:S=>f(l.id,"telefono",S.target.value),placeholder:" Telfono",style:v}),e.jsx("input",{value:l.email||"",onChange:S=>f(l.id,"email",S.target.value),placeholder:" Email",style:v})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase"},children:"Descripcin del problema"}),e.jsx("textarea",{value:l.descripcion||"",onChange:S=>f(l.id,"descripcion",S.target.value),rows:3,style:{...v,width:"100%",resize:"vertical",lineHeight:1.5}})]}),e.jsx("div",{style:{display:"flex",gap:8,marginBottom:8},children:e.jsx("select",{value:l.prioridad,onChange:S=>f(l.id,"prioridad",S.target.value),style:{...v,width:100},children:Vn.map(S=>e.jsx("option",{value:S.id,children:S.lbl},S.id))})}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase",marginBottom:4,marginTop:8},children:"Seguimiento"}),(l.seguimiento||[]).map(S=>{var A;return e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 0",fontSize:10,borderLeft:`2px solid ${Oe.border}`,paddingLeft:10,marginLeft:4,marginBottom:2},children:[e.jsx("span",{style:{color:Oe.inkLight,minWidth:60},children:id((A=S.fecha)==null?void 0:A.split("T")[0])}),e.jsx("span",{style:{fontWeight:600},children:S.por}),e.jsx("span",{style:{color:Oe.inkMid},children:S.nota})]},S.id)}),e.jsxs("div",{style:{display:"flex",gap:6,marginTop:4},children:[e.jsx("input",{id:`seg-${l.id}`,placeholder:"Aadir nota de seguimiento...",style:{...v,flex:1,fontSize:10}}),e.jsxs(nn,{sm:!0,v:"sec",on:()=>{const S=document.getElementById(`seg-${l.id}`);S!=null&&S.value.trim()&&(p(l.id,S.value),S.value="")},children:[e.jsx(Ne,{size:9})," Aadir"]})]}),l.estado==="cerrado"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase"},children:"Resolucin"}),e.jsx("textarea",{value:l.resolucion||"",onChange:S=>f(l.id,"resolucion",S.target.value),rows:2,placeholder:"Descripcin de la solucin aplicada...",style:{...v,width:"100%",resize:"vertical",background:Oe.greenBg}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:e.jsx("button",{onClick:()=>n(S=>S.filter(A=>A.id!==l.id)),style:{background:"none",border:"none",color:Oe.red,fontSize:10,cursor:"pointer"},children:" Eliminar ticket"})})]})]},l.id)}),o.length===0&&e.jsx($i,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Oe.inkLight},children:"Sin tickets. Crea el primero."})})]}),t==="garantias"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Control de garantas"}),e.jsxs(nn,{sm:!0,on:()=>r(l=>[...l,{id:Un(),proyecto:"",cliente:"",concepto:"",inicio:aa(),vencimiento:(()=>{const x=new Date;return x.setFullYear(x.getFullYear()+1),x.toISOString().split("T")[0]})(),estado:"vigente"}]),children:[e.jsx(Ne,{size:10})," Nueva garanta"]})]}),e.jsx($i,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:Oe.surfaceAlt},children:["Proyecto","Cliente","Concepto","Inicio","Vencimiento","Estado",""].map(l=>e.jsx("th",{style:{padding:"8px 10px",fontSize:8,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase",textAlign:"left",borderBottom:`2px solid ${Oe.border}`},children:l},l))})}),e.jsxs("tbody",{children:[s.map(l=>{const x=new Date(l.vencimiento)>new Date;return e.jsxs("tr",{style:{borderBottom:`1px solid ${Oe.border}`},children:[e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.proyecto||"",onChange:y=>r(g=>g.map(S=>S.id===l.id?{...S,proyecto:y.target.value}:S)),placeholder:"Proyecto",style:{border:"none",background:"transparent",fontSize:11,fontWeight:600,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.cliente||"",onChange:y=>r(g=>g.map(S=>S.id===l.id?{...S,cliente:y.target.value}:S)),placeholder:"Cliente",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{value:l.concepto||"",onChange:y=>r(g=>g.map(S=>S.id===l.id?{...S,concepto:y.target.value}:S)),placeholder:"Concepto",style:{border:"none",background:"transparent",fontSize:11,width:"100%"}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.inicio,onChange:y=>r(g=>g.map(S=>S.id===l.id?{...S,inicio:y.target.value}:S)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("input",{type:"date",value:l.vencimiento,onChange:y=>r(g=>g.map(S=>S.id===l.id?{...S,vencimiento:y.target.value}:S)),style:{border:"none",background:"transparent",fontSize:10}})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"2px 6px",borderRadius:3,background:x?Oe.greenBg:Oe.redBg,color:x?Oe.green:Oe.red},children:x?"Vigente":"Vencida"})}),e.jsx("td",{style:{padding:"6px 10px"},children:e.jsx("button",{onClick:()=>r(y=>y.filter(g=>g.id!==l.id)),style:{background:"none",border:"none",color:Oe.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})})]},l.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:30,textAlign:"center",color:Oe.inkLight},children:"Sin garantas registradas"})})]})]})})]}),t==="visitas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Visitas de postventa"}),e.jsxs(nn,{sm:!0,on:()=>u(l=>[...l,{id:Un(),fecha:aa(),proyecto:"",cliente:"",motivo:"",responsable:"",estado:"programada",observaciones:""}]),children:[e.jsx(Ne,{size:10})," Nueva visita"]})]}),a.sort((l,x)=>x.fecha>l.fecha?1:-1).map(l=>e.jsxs($i,{style:{padding:14,marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{type:"date",value:l.fecha,onChange:x=>u(y=>y.map(g=>g.id===l.id?{...g,fecha:x.target.value}:g)),style:{border:`1px solid ${Oe.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:l.proyecto||"",onChange:x=>u(y=>y.map(g=>g.id===l.id?{...g,proyecto:x.target.value}:g)),placeholder:"Proyecto",style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:600}}),e.jsx("input",{value:l.cliente||"",onChange:x=>u(y=>y.map(g=>g.id===l.id?{...g,cliente:x.target.value}:g)),placeholder:"Cliente",style:{width:120,...v,fontSize:10}}),e.jsx("input",{value:l.responsable||"",onChange:x=>u(y=>y.map(g=>g.id===l.id?{...g,responsable:x.target.value}:g)),placeholder:"Responsable",style:{width:100,...v,fontSize:10}}),e.jsx("select",{value:l.estado,onChange:x=>u(y=>y.map(g=>g.id===l.id?{...g,estado:x.target.value}:g)),style:{fontSize:9,padding:"2px 6px",border:`1px solid ${Oe.border}`,borderRadius:3,background:l.estado==="realizada"?Oe.greenBg:"#fff"},children:["programada","realizada","cancelada"].map(x=>e.jsx("option",{children:x},x))}),e.jsx("button",{onClick:()=>u(x=>x.filter(y=>y.id!==l.id)),style:{background:"none",border:"none",color:Oe.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:6},children:[e.jsx("input",{value:l.motivo||"",onChange:x=>u(y=>y.map(g=>g.id===l.id?{...g,motivo:x.target.value}:g)),placeholder:"Motivo de la visita",style:{...v,fontSize:10}}),e.jsx("input",{value:l.observaciones||"",onChange:x=>u(y=>y.map(g=>g.id===l.id?{...g,observaciones:x.target.value}:g)),placeholder:"Observaciones",style:{...v,fontSize:10}})]})]},l.id)),a.length===0&&e.jsx($i,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Oe.inkLight},children:"Sin visitas programadas"})})]}),t==="encuestas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Encuestas de satisfaccin"}),e.jsxs(nn,{sm:!0,on:()=>b(l=>[...l,{id:Un(),fecha:aa(),proyecto:"",cliente:"",calificacion:5,comentario:""}]),children:[e.jsx(Ne,{size:10})," Nueva encuesta"]})]}),h.length>0&&e.jsxs($i,{style:{padding:16,marginBottom:14,textAlign:"center",background:parseFloat(d)>=4?Oe.greenBg:Oe.amberBg},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,color:Oe.inkLight,textTransform:"uppercase"},children:"Satisfaccin promedio"}),e.jsxs("div",{style:{fontSize:36,fontWeight:800,color:parseFloat(d)>=4?Oe.green:Oe.amber},children:["".repeat(Math.round(parseFloat(d)||0))," ",d,"/5"]}),e.jsxs("div",{style:{fontSize:11,color:Oe.inkMid},children:[h.length," encuestas realizadas"]})]}),h.sort((l,x)=>x.fecha>l.fecha?1:-1).map(l=>e.jsxs($i,{style:{padding:14,marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"date",value:l.fecha,onChange:x=>b(y=>y.map(g=>g.id===l.id?{...g,fecha:x.target.value}:g)),style:{border:`1px solid ${Oe.border}`,borderRadius:3,padding:"4px 8px",fontSize:10}}),e.jsx("input",{value:l.proyecto||"",onChange:x=>b(y=>y.map(g=>g.id===l.id?{...g,proyecto:x.target.value}:g)),placeholder:"Proyecto",style:{flex:1,border:"none",background:"transparent",fontSize:12,fontWeight:600}}),e.jsx("input",{value:l.cliente||"",onChange:x=>b(y=>y.map(g=>g.id===l.id?{...g,cliente:x.target.value}:g)),placeholder:"Cliente",style:{width:120,...v,fontSize:10}}),e.jsx("div",{style:{display:"flex",gap:2},children:[1,2,3,4,5].map(x=>e.jsx("button",{onClick:()=>b(y=>y.map(g=>g.id===l.id?{...g,calificacion:x}:g)),style:{background:"none",border:"none",fontSize:18,cursor:"pointer",opacity:x<=l.calificacion?1:.2},children:""},x))}),e.jsx("button",{onClick:()=>b(x=>x.filter(y=>y.id!==l.id)),style:{background:"none",border:"none",color:Oe.red,cursor:"pointer"},children:e.jsx(Je,{size:11})})]}),e.jsx("input",{value:l.comentario||"",onChange:x=>b(y=>y.map(g=>g.id===l.id?{...g,comentario:x.target.value}:g)),placeholder:"Comentarios del cliente...",style:{...v,width:"100%",marginTop:6,fontSize:10}})]},l.id)),h.length===0&&e.jsx($i,{style:{padding:30,textAlign:"center"},children:e.jsx("div",{style:{color:Oe.inkLight},children:"Sin encuestas. Crea la primera."})})]})]})})]})]})]})}const em=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),ze={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},wo=()=>Math.random().toString(36).slice(2,10),ei=()=>new Date().toISOString().split("T")[0],wt=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),Si=({children:t,style:i,...o})=>e.jsx("div",{style:{background:ze.surface,border:`1px solid ${ze.border}`,borderRadius:8,padding:16,boxShadow:ze.shadow,...i},...o,children:t}),_t=({children:t,on:i,v:o,style:n,...s})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${ze.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?ze.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...s,children:t}),mt=({lbl:t,val:i,on:o,ph:n,type:s,style:r,...a})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),e.jsx("input",{type:s||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${ze.border}`,borderRadius:4,fontSize:11,background:"#fff"},...a})]}),Uo=({t,s:i})=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700},children:t}),i&&e.jsx("p",{style:{margin:0,fontSize:10,color:ze.inkMid},children:i})]}),yn=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),Vi={border:`1px solid ${ze.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},od=[{id:"dashboard",lbl:" Dashboard",icon:Yi},{id:"caja",lbl:" Caja Chica",icon:xr},{id:"tarjeta",lbl:" Legalizaciones",icon:qc},{id:"viaticos",lbl:" Viticos",icon:zo},{id:"flujo",lbl:" Flujo Empresa",icon:Yi},{id:"cxc",lbl:" CxC / CxP",icon:Bt}];function tm({data:t,save:i}){var S;const o=t.adm_cajas||[],n=A=>i("adm_cajas",typeof A=="function"?A(o):A),[s,r]=F.useState(((S=o[0])==null?void 0:S.id)||null),[a,u]=F.useState(!1),[h,b]=F.useState(!1),[j,C]=F.useState({nombre:"",fondoInicial:0,responsable:""}),[v,m]=F.useState({fecha:ei(),tipo:"salida",concepto:"",monto:0,responsable:"",soporte:"",proyecto:""}),f=o.find(A=>A.id===s),p=(f==null?void 0:f.movimientos)||[],c=((f==null?void 0:f.fondoInicial)||0)+p.reduce((A,E)=>A+(E.tipo==="entrada"?E.monto:-E.monto),0),d=()=>{const A={id:wo(),...j,fondoInicial:parseFloat(j.fondoInicial)||0,movimientos:[],estado:"abierta",fechaCreacion:ei()};n([...o,A]),r(A.id),C({nombre:"",fondoInicial:0,responsable:""}),u(!1)},l=()=>{const A={id:wo(),...v,monto:parseFloat(v.monto)||0};n(o.map(E=>E.id===s?{...E,movimientos:[...E.movimientos,A]}:E)),m({fecha:ei(),tipo:"salida",concepto:"",monto:0,responsable:"",soporte:"",proyecto:""}),b(!1)},x=A=>n(o.map(E=>E.id===s?{...E,movimientos:E.movimientos.filter(w=>w.id!==A)}:E)),y=()=>n(o.map(A=>A.id===s?{...A,estado:"cerrada",fechaCierre:ei()}:A)),g=()=>{const A=p.filter(w=>w.tipo==="salida").reduce((w,I)=>w+I.monto,0)-p.filter(w=>w.tipo==="entrada").reduce((w,I)=>w+I.monto,0);if(A<=0)return;const E={id:wo(),fecha:ei(),tipo:"entrada",concepto:"Reposicin de caja chica",monto:A,responsable:"Admin",soporte:"",proyecto:""};n(o.map(w=>w.id===s?{...w,movimientos:[...w.movimientos,E]}:w))};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:ze.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Caja chica"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Control de fondos menores"})]}),e.jsxs(_t,{on:()=>u(!0),children:[e.jsx(Ne,{size:11})," Nueva caja"]})]}),o.length===0?e.jsx(Si,{style:{textAlign:"center",padding:40,color:ze.inkLight},children:'Sin cajas creadas. Pulsa "+ Nueva caja" para empezar.'}):e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx("div",{style:{width:200,flexShrink:0},children:o.map(A=>{const E=(A.fondoInicial||0)+(A.movimientos||[]).reduce((w,I)=>w+(I.tipo==="entrada"?I.monto:-I.monto),0);return e.jsxs(Si,{onClick:()=>r(A.id),style:{padding:"10px 12px",marginBottom:6,cursor:"pointer",border:s===A.id?`2px solid ${ze.green}`:`1px solid ${ze.border}`},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:A.nombre}),e.jsx("div",{style:{fontSize:9,color:ze.inkMid},children:A.responsable}),e.jsxs("div",{style:{fontSize:14,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E>=0?ze.green:ze.red,marginTop:4},children:["$",wt(E)]}),e.jsx(yn,{color:A.estado==="abierta"?ze.green:ze.red,children:A.estado==="abierta"?"Abierta":"Cerrada"})]},A.id)})}),f&&e.jsxs(Si,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#EDEBE7",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:f.nombre}),e.jsxs("div",{style:{fontSize:9,color:ze.inkMid},children:["Fondo: $",wt(f.fondoInicial),"  Responsable: ",f.responsable]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Saldo actual"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:c>=0?ze.green:ze.red},children:["$",wt(c)]})]})]}),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${ze.border}`,display:"flex",gap:6},children:[f.estado==="abierta"&&e.jsxs(e.Fragment,{children:[e.jsxs(_t,{on:()=>b(!0),children:[e.jsx(Ne,{size:10})," Movimiento"]}),e.jsx(_t,{v:"sec",on:g,children:" Reponer"}),e.jsx(_t,{v:"sec",on:y,children:" Cerrar caja"})]}),f.estado==="cerrada"&&e.jsxs(yn,{color:ze.red,children:["Caja cerrada el ",f.fechaCierre]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Tipo","Concepto","Proyecto","Responsable","Soporte","Monto",""].map(A=>e.jsx("th",{style:{padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`1px solid ${ze.border}`,textAlign:A==="Monto"?"right":"left"},children:A},A))})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:20,textAlign:"center",color:ze.inkLight,fontSize:11},children:"Sin movimientos"})}):p.map((A,E)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ze.border}`,background:E%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"5px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:A.fecha}),e.jsx("td",{style:{padding:"5px 8px"},children:e.jsx(yn,{color:A.tipo==="entrada"?ze.green:ze.red,children:A.tipo==="entrada"?" Entrada":" Salida"})}),e.jsx("td",{style:{padding:"5px 8px",fontSize:10,fontWeight:500},children:A.concepto}),e.jsx("td",{style:{padding:"5px 8px",fontSize:9,color:ze.inkMid},children:A.proyecto||""}),e.jsx("td",{style:{padding:"5px 8px",fontSize:9,color:ze.inkMid},children:A.responsable}),e.jsx("td",{style:{padding:"5px 8px",fontSize:8,color:ze.blue},children:A.soporte||""}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:A.tipo==="entrada"?ze.green:ze.red},children:[A.tipo==="entrada"?"+":"","$",wt(A.monto)]}),e.jsx("td",{style:{padding:"3px 4px"},children:f.estado==="abierta"&&e.jsx("button",{onClick:()=>x(A.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},A.id))})]})})]})]}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>u(!1),children:e.jsxs("div",{onClick:A=>A.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:400,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Uo,{t:"Nueva caja chica",s:"Fondo rotatorio para gastos menores"}),e.jsx(mt,{lbl:"Nombre",val:j.nombre,on:A=>C({...j,nombre:A.target.value}),ph:"Caja obra Chic"}),e.jsx(mt,{lbl:"Fondo inicial",val:j.fondoInicial,on:A=>C({...j,fondoInicial:A.target.value}),type:"number",ph:"500000"}),e.jsx(mt,{lbl:"Responsable",val:j.responsable,on:A=>C({...j,responsable:A.target.value}),ph:"Almacenista"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(_t,{on:d,style:{flex:1},children:[e.jsx(yt,{size:11})," Crear"]}),e.jsx(_t,{v:"sec",on:()=>u(!1),style:{flex:1},children:"Cancelar"})]})]})}),h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:A=>A.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:420,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Uo,{t:"Nuevo movimiento",s:f==null?void 0:f.nombre}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[e.jsx(mt,{lbl:"Fecha",val:v.fecha,on:A=>m({...v,fecha:A.target.value}),type:"date",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Tipo"}),e.jsxs("select",{value:v.tipo,onChange:A=>m({...v,tipo:A.target.value}),style:{...Vi,width:"100%"},children:[e.jsx("option",{value:"salida",children:" Salida"}),e.jsx("option",{value:"entrada",children:" Entrada"})]})]})]}),e.jsx(mt,{lbl:"Concepto",val:v.concepto,on:A=>m({...v,concepto:A.target.value}),ph:"Taxi obra, material menor..."}),e.jsx(mt,{lbl:"Monto",val:v.monto,on:A=>m({...v,monto:A.target.value}),type:"number",ph:"25000"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Proyecto",val:v.proyecto,on:A=>m({...v,proyecto:A.target.value}),ph:"Chic 94",style:{flex:1}}),e.jsx(mt,{lbl:"Responsable",val:v.responsable,on:A=>m({...v,responsable:A.target.value}),ph:"Quien gasta",style:{flex:1}})]}),e.jsx(mt,{lbl:"Soporte / factura",val:v.soporte,on:A=>m({...v,soporte:A.target.value}),ph:"Ref. factura o soporte"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(_t,{on:l,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar"]}),e.jsx(_t,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function im({data:t,save:i}){const o=t.adm_tarjeta||[],n=d=>i("adm_tarjeta",typeof d=="function"?d(o):d),[s,r]=F.useState(!1),[a,u]=F.useState("todos"),[h,b]=F.useState({fecha:ei(),concepto:"",monto:0,tarjeta:"Corp. Visa",proyecto:"",centroCosto:"",factura:"",correoRef:"",estado:"pendiente"}),j=()=>{n([...o,{id:wo(),...h,monto:parseFloat(h.monto)||0}]),b({fecha:ei(),concepto:"",monto:0,tarjeta:"Corp. Visa",proyecto:"",centroCosto:"",factura:"",correoRef:"",estado:"pendiente"}),r(!1)},C=(d,l,x)=>n(o.map(y=>y.id===d?{...y,[l]:x}:y)),v=d=>n(o.filter(l=>l.id!==d)),m=a==="todos"?o:o.filter(d=>d.estado===a),f=o.filter(d=>d.estado==="pendiente"),p=f.reduce((d,l)=>d+l.monto,0),c={pendiente:{lbl:"Pendiente",color:ze.amber},legalizado:{lbl:"Legalizado",color:ze.blue},aprobado:{lbl:"Aprobado",color:ze.green},rechazado:{lbl:"Rechazado",color:ze.red}};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:ze.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Tarjeta corporativa"}),e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Legalizaciones  ",f.length," pendientes  $",wt(p)]})]}),e.jsxs(_t,{on:()=>r(!0),children:[e.jsx(Ne,{size:11})," Nuevo movimiento"]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:[["todos","Todos"],["pendiente","Pendientes"],["legalizado","Legalizados"],["aprobado","Aprobados"],["rechazado","Rechazados"]].map(([d,l],x,y)=>e.jsxs("button",{onClick:()=>u(d),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${ze.border}`,borderLeft:x>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:x===0?"5px 0 0 5px":x===y.length-1?"0 5px 5px 0":"0",background:a===d?"#111":"#fff",color:a===d?"#fff":ze.inkMid},children:[l," ",d!=="todos"&&e.jsxs("span",{style:{marginLeft:3,fontSize:8},children:["(",o.filter(g=>d==="todos"||g.estado===d).length,")"]})]},d))}),e.jsx(Si,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Tarjeta","Concepto","Proyecto","Centro costo","Factura","Correo ref.","Monto","Estado",""].map(d=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${ze.border}`,textAlign:d==="Monto"?"right":"left"},children:d},d))})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:24,textAlign:"center",color:ze.inkLight,fontSize:11},children:"Sin movimientos"})}):m.map((d,l)=>{var x,y;return e.jsxs("tr",{style:{borderBottom:`1px solid ${ze.border}`,background:l%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:d.fecha}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9},children:d.tarjeta}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:500},children:d.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ze.inkMid},children:d.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ze.inkMid},children:d.centroCosto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:ze.blue},children:d.factura||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:ze.inkMid},children:d.correoRef||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11},children:["$",wt(d.monto)]}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("select",{value:d.estado,onChange:g=>C(d.id,"estado",g.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:((x=c[d.estado])==null?void 0:x.color)+"22",color:(y=c[d.estado])==null?void 0:y.color},children:Object.entries(c).map(([g,S])=>e.jsx("option",{value:g,children:S.lbl},g))})}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>v(d.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},d.id)})})]})}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Uo,{t:"Nuevo movimiento tarjeta",s:"Registrar gasto para legalizar"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Fecha",val:h.fecha,on:d=>b({...h,fecha:d.target.value}),type:"date",style:{flex:1}}),e.jsx(mt,{lbl:"Tarjeta",val:h.tarjeta,on:d=>b({...h,tarjeta:d.target.value}),ph:"Corp. Visa",style:{flex:1}})]}),e.jsx(mt,{lbl:"Concepto",val:h.concepto,on:d=>b({...h,concepto:d.target.value}),ph:"Almuerzo equipo, materiales..."}),e.jsx(mt,{lbl:"Monto",val:h.monto,on:d=>b({...h,monto:d.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Proyecto",val:h.proyecto,on:d=>b({...h,proyecto:d.target.value}),ph:"Opcional",style:{flex:1}}),e.jsx(mt,{lbl:"Centro de costo",val:h.centroCosto,on:d=>b({...h,centroCosto:d.target.value}),ph:"Admin, Obra...",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Ref. factura",val:h.factura,on:d=>b({...h,factura:d.target.value}),ph:"FV-001234",style:{flex:1}}),e.jsx(mt,{lbl:"Correo referencia",val:h.correoRef,on:d=>b({...h,correoRef:d.target.value}),ph:"Asunto email",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(_t,{on:j,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar"]}),e.jsx(_t,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function om({data:t,save:i}){const o=t.adm_viaticos||[],n=E=>i("adm_viaticos",typeof E=="function"?E(o):E),[s,r]=F.useState(!1),[a,u]=F.useState(null),[h,b]=F.useState(!1),[j,C]=F.useState({solicitante:"",destino:"",dias:1,concepto:"",fecha:ei(),fechaRegreso:""}),[v,m]=F.useState({fecha:ei(),concepto:"",monto:0,soporte:""}),f=[{id:"vuelo_ida",lbl:" Vuelo ida",icon:""},{id:"vuelo_vuelta",lbl:" Vuelo vuelta",icon:""},{id:"hotel",lbl:" Hotel",icon:""},{id:"transporte",lbl:" Transporte terrestre",icon:""},{id:"alimentacion",lbl:" Alimentacin",icon:""},{id:"otros",lbl:" Otros",icon:""}],p=o.find(E=>E.id===a),c={solicitado:{lbl:"Solicitado",color:ze.amber},aprobado:{lbl:"Aprobado",color:ze.blue},entregado:{lbl:"Anticipo entregado",color:"#5B3A8C"},legalizado:{lbl:"Legalizado",color:ze.green},rechazado:{lbl:"Rechazado",color:ze.red}},d=E=>{const w=E.itemsViaje||{},I=f.reduce((P,q)=>{var U;return P+(parseFloat((U=w[q.id])==null?void 0:U.estimado)||0)},0),z=f.reduce((P,q)=>{var U;return P+(parseFloat((U=w[q.id])==null?void 0:U.real)||0)},0),B=(E.gastos||[]).reduce((P,q)=>P+q.monto,0);return{estimado:I,real:z,gastosExtra:B,totalReal:z+B}},l=()=>{const E={};f.forEach(I=>{E[I.id]={estimado:0,real:0,detalle:""}});const w={id:wo(),...j,dias:parseInt(j.dias)||1,estado:"solicitado",gastos:[],anticipoEntregado:0,itemsViaje:E};n([...o,w]),u(w.id),C({solicitante:"",destino:"",dias:1,concepto:"",fecha:ei(),fechaRegreso:""}),r(!1)},x=(E,w,I)=>n(o.map(z=>z.id===E?{...z,[w]:I}:z)),y=(E,w,I,z)=>{n(o.map(B=>{if(B.id!==E)return B;const P={...B.itemsViaje||{}};return P[w]={...P[w]||{estimado:0,real:0,detalle:""},[I]:z},{...B,itemsViaje:P}}))},g=()=>{const E={id:wo(),...v,monto:parseFloat(v.monto)||0};n(o.map(w=>w.id===a?{...w,gastos:[...w.gastos,E]}:w)),m({fecha:ei(),concepto:"",monto:0,soporte:""}),b(!1)},S=E=>n(o.map(w=>w.id===a?{...w,gastos:w.gastos.filter(I=>I.id!==E)}:w)),A=E=>{n(o.filter(w=>w.id!==E)),a===E&&u(null)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:ze.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Viticos"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Solicitudes, anticipos y legalizaciones"})]}),e.jsxs(_t,{on:()=>r(!0),children:[e.jsx(Ne,{size:11})," Nueva solicitud"]})]}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx("div",{style:{width:280,flexShrink:0},children:o.length===0?e.jsx(Si,{style:{textAlign:"center",padding:20,color:ze.inkLight,fontSize:11},children:"Sin solicitudes"}):o.map(E=>{var z,B;const w=d(E),I=(E.anticipoEntregado||0)-w.totalReal;return e.jsxs(Si,{onClick:()=>u(E.id),style:{padding:"10px 12px",marginBottom:6,cursor:"pointer",border:a===E.id?`2px solid ${ze.green}`:`1px solid ${ze.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:E.solicitante}),e.jsx(yn,{color:((z=c[E.estado])==null?void 0:z.color)||ze.amber,children:((B=c[E.estado])==null?void 0:B.lbl)||E.estado})]}),e.jsxs("div",{style:{fontSize:9,color:ze.inkMid},children:[E.destino,"  ",E.dias," das  ",E.fecha]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:4,fontSize:8},children:[e.jsxs("span",{children:["Est: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",wt(w.estimado)]})]}),e.jsxs("span",{children:["Real: ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",wt(w.totalReal)]})]}),e.jsxs("span",{style:{color:I>=0?ze.green:ze.red},children:[I>=0?"Sobra":"Debe",": ",e.jsxs("strong",{style:{fontFamily:"'DM Mono',monospace"},children:["$",wt(Math.abs(I))]})]})]})]},E.id)})}),p?e.jsxs(Si,{style:{flex:1,padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#EDEBE7",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:14,fontWeight:700},children:[p.solicitante,"  ",p.destino]}),e.jsxs("div",{style:{fontSize:9,color:ze.inkMid},children:[p.concepto,"  ",p.dias," das  ",p.fecha,p.fechaRegreso?`  ${p.fechaRegreso}`:""]})]}),e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[e.jsx("select",{value:p.estado,onChange:E=>x(p.id,"estado",E.target.value),style:{...Vi,fontSize:9,fontWeight:600},children:Object.entries(c).map(([E,w])=>e.jsx("option",{value:E,children:w.lbl},E))}),e.jsx("button",{onClick:()=>A(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},title:"Eliminar",children:e.jsx(Je,{size:12})})]})]}),(()=>{const E=d(p),w=(p.anticipoEntregado||0)-E.totalReal;return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6,padding:"10px 16px",borderBottom:`1px solid ${ze.border}`},children:[["Estimado",wt(E.estimado),ze.ink],["Anticipo",wt(p.anticipoEntregado||0),ze.blue],["Real tems",wt(E.real),"#5B3A8C"],["Otros gastos",wt(E.gastosExtra),ze.red],[w>=0?"Saldo a favor":"Saldo a deber",wt(Math.abs(w)),w>=0?ze.green:ze.red]].map(([I,z,B])=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:I}),e.jsxs("div",{style:{fontSize:13,fontWeight:800,fontFamily:"'DM Mono',monospace",color:B},children:["$",z]})]},I))})})(),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${ze.border}`,display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:9,fontWeight:600,color:ze.inkMid},children:"Anticipo entregado:"}),e.jsx("input",{type:"number",value:p.anticipoEntregado||"",placeholder:"0",onChange:E=>x(p.id,"anticipoEntregado",parseFloat(E.target.value)||0),style:{...Vi,width:130,fontFamily:"'DM Mono',monospace",fontWeight:700}})]}),e.jsxs("div",{style:{padding:"10px 16px",borderBottom:`1px solid ${ze.border}`},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1,marginBottom:8},children:"Desglose del viaje  Estimado vs Real"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F5F4F1"},children:[e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${ze.border}`,width:"30%"},children:"TEM"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"left",borderBottom:`1px solid ${ze.border}`,width:"25%"},children:"DETALLE"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:ze.blue,textAlign:"right",borderBottom:`1px solid ${ze.border}`,width:"18%"},children:"ESTIMADO"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#5B3A8C",textAlign:"right",borderBottom:`1px solid ${ze.border}`,width:"18%"},children:"REAL"}),e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textAlign:"right",borderBottom:`1px solid ${ze.border}`,width:"9%"},children:"DIF."})]})}),e.jsxs("tbody",{children:[f.map((E,w)=>{const I=(p.itemsViaje||{})[E.id]||{estimado:0,real:0,detalle:""},z=parseFloat(I.estimado)||0,P=(parseFloat(I.real)||0)-z;return e.jsxs("tr",{style:{borderBottom:`1px solid ${ze.border}`,background:w%2?"#FFFFFF":"#fff"},children:[e.jsxs("td",{style:{padding:"5px 8px",fontSize:10,fontWeight:600},children:[E.icon," ",E.lbl.replace(/^[^\s]+ /,"")]}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"text",value:I.detalle||"",placeholder:"Aerolnea, hotel...",onChange:q=>y(p.id,E.id,"detalle",q.target.value),style:{...Vi,width:"100%",fontSize:9,padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"number",value:I.estimado||"",placeholder:"0",onChange:q=>y(p.id,E.id,"estimado",q.target.value),style:{...Vi,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:ze.blue,padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"3px 4px"},children:e.jsx("input",{type:"number",value:I.real||"",placeholder:"0",onChange:q=>y(p.id,E.id,"real",q.target.value),style:{...Vi,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:600,color:"#5B3A8C",padding:"3px 6px"}})}),e.jsx("td",{style:{padding:"4px 8px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:700,color:P===0?ze.inkLight:P>0?ze.red:ze.green},children:P===0?"":P>0?`+${wt(P)}`:`${wt(Math.abs(P))}`})]},E.id)}),(()=>{const E=d(p),w=E.real-E.estimado;return e.jsxs("tr",{style:{borderTop:`2px solid ${ze.ink}`,background:"#EDEBE7"},children:[e.jsx("td",{colSpan:2,style:{padding:"5px 8px",fontSize:10,fontWeight:800},children:"TOTAL TEMS"}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:ze.blue},children:["$",wt(E.estimado)]}),e.jsxs("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:11,fontFamily:"'DM Mono',monospace",fontWeight:800,color:"#5B3A8C"},children:["$",wt(E.real)]}),e.jsx("td",{style:{padding:"5px 8px",textAlign:"right",fontSize:9,fontFamily:"'DM Mono',monospace",fontWeight:700,color:w===0?ze.inkLight:w>0?ze.red:ze.green},children:w===0?"":w>0?`+${wt(w)}`:`${wt(Math.abs(w))}`})]})})()]})]})]}),e.jsxs("div",{style:{padding:"8px 16px",borderBottom:`1px solid ${ze.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Otros gastos (no previstos)"}),e.jsxs(_t,{on:()=>b(!0),style:{padding:"4px 10px",fontSize:9},children:[e.jsx(Ne,{size:9})," Gasto"]})]}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Concepto","Soporte","Monto",""].map(E=>e.jsx("th",{style:{padding:"4px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`1px solid ${ze.border}`,textAlign:E==="Monto"?"right":"left"},children:E},E))})}),e.jsx("tbody",{children:(p.gastos||[]).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{padding:12,textAlign:"center",color:ze.inkLight,fontSize:9},children:"Sin gastos adicionales"})}):(p.gastos||[]).map((E,w)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ze.border}`,background:w%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:E.fecha}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10},children:E.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:ze.blue},children:E.soporte||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:ze.red},children:["$",wt(E.monto)]}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>S(E.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},E.id))})]})]}):e.jsx(Si,{style:{flex:1,textAlign:"center",padding:40,color:ze.inkLight},children:"Selecciona una solicitud"})]}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:E=>E.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:440,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Uo,{t:"Nueva solicitud de viticos",s:"Se crear con desglose de tems para estimar costos"}),e.jsx(mt,{lbl:"Solicitante",val:j.solicitante,on:E=>C({...j,solicitante:E.target.value}),ph:"Nombre completo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Destino",val:j.destino,on:E=>C({...j,destino:E.target.value}),ph:"Ciudad / lugar",style:{flex:1}}),e.jsx(mt,{lbl:"Das",val:j.dias,on:E=>C({...j,dias:E.target.value}),type:"number",style:{flex:"0 0 65px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Fecha ida",val:j.fecha,on:E=>C({...j,fecha:E.target.value}),type:"date",style:{flex:1}}),e.jsx(mt,{lbl:"Fecha regreso",val:j.fechaRegreso,on:E=>C({...j,fechaRegreso:E.target.value}),type:"date",style:{flex:1}})]}),e.jsx(mt,{lbl:"Concepto / motivo",val:j.concepto,on:E=>C({...j,concepto:E.target.value}),ph:"Visita obra, capacitacin, reunin cliente..."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(_t,{on:l,style:{flex:1},children:[e.jsx(yt,{size:11})," Crear solicitud"]}),e.jsx(_t,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})}),h&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(!1),children:e.jsxs("div",{onClick:E=>E.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:380,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Uo,{t:"Gasto adicional",s:(p==null?void 0:p.solicitante)+"  "+(p==null?void 0:p.destino)}),e.jsx(mt,{lbl:"Fecha",val:v.fecha,on:E=>m({...v,fecha:E.target.value}),type:"date"}),e.jsx(mt,{lbl:"Concepto",val:v.concepto,on:E=>m({...v,concepto:E.target.value}),ph:"Imprevisto, taxi extra..."}),e.jsx(mt,{lbl:"Monto",val:v.monto,on:E=>m({...v,monto:E.target.value}),type:"number"}),e.jsx(mt,{lbl:"Soporte",val:v.soporte,on:E=>m({...v,soporte:E.target.value}),ph:"Ref. factura"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(_t,{on:g,style:{flex:1},children:[e.jsx(yt,{size:11})," Aadir"]}),e.jsx(_t,{v:"sec",on:()=>b(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function nm({data:t,save:i}){const o=t.adm_flujo||[],n=g=>i("adm_flujo",typeof g=="function"?g(o):g),[s,r]=F.useState(!1),[a,u]=F.useState(()=>{const g=new Date;return`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`}),[h,b]=F.useState({fecha:ei(),tipo:"ingreso",categoria:"",concepto:"",monto:0,proyecto:"",factura:"",estado:"realizado"}),j=["Cobro proyecto","Anticipo cliente","Reembolso","Otro ingreso"],C=["Nmina","Proveedores","Arriendo","Servicios","Impuestos","Seguros","Transporte","Materiales","Otro egreso"],v=()=>{n([...o,{id:wo(),...h,monto:parseFloat(h.monto)||0}]),b({fecha:ei(),tipo:"ingreso",categoria:"",concepto:"",monto:0,proyecto:"",factura:"",estado:"realizado"}),r(!1)},m=g=>n(o.filter(S=>S.id!==g)),f=o.filter(g=>{var S;return(S=g.fecha)==null?void 0:S.startsWith(a)}),p=f.filter(g=>g.tipo==="ingreso").reduce((g,S)=>g+S.monto,0),c=f.filter(g=>g.tipo==="egreso").reduce((g,S)=>g+S.monto,0),l=o.filter(g=>g.fecha<=a+"-31"&&g.estado==="realizado").reduce((g,S)=>g+(S.tipo==="ingreso"?S.monto:-S.monto),0),x=f.filter(g=>g.estado==="proyectado");x.filter(g=>g.tipo==="ingreso").reduce((g,S)=>g+S.monto,0),x.filter(g=>g.tipo==="egreso").reduce((g,S)=>g+S.monto,0);const y=[...new Set(o.map(g=>{var S;return(S=g.fecha)==null?void 0:S.slice(0,7)}).filter(Boolean))].sort();return y.includes(a)||y.push(a),y.sort(),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:10,color:ze.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:"Flujo de caja empresa"}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Ingresos, egresos y proyeccin"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:a,onChange:g=>u(g.target.value),style:{...Vi,fontWeight:600},children:y.map(g=>e.jsx("option",{value:g,children:g},g))}),e.jsxs(_t,{on:()=>r(!0),children:[e.jsx(Ne,{size:11})," Movimiento"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[["Ingresos mes",wt(p),ze.green,""],["Egresos mes",wt(c),ze.red,""],["Neto mes",wt(p-c),p-c>=0?ze.green:ze.red,""],["Saldo acumulado",wt(l),l>=0?ze.green:ze.red,""]].map(([g,S,A,E])=>e.jsxs(Si,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:[E," ",g]}),e.jsxs("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:A,marginTop:2},children:["$",S]})]},g))}),l<0&&e.jsxs("div",{style:{background:ze.redBg,border:`1px solid ${ze.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(li,{size:14,color:ze.red}),e.jsx("div",{style:{fontSize:10,color:ze.red,fontWeight:600},children:" Saldo acumulado negativo. Revisa cobros pendientes o reduce egresos."})]}),e.jsx(Si,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Tipo","Categora","Concepto","Proyecto","Factura","Estado","Monto",""].map(g=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${ze.border}`,textAlign:g==="Monto"?"right":"left"},children:g},g))})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:ze.inkLight,fontSize:11},children:["Sin movimientos en ",a]})}):f.sort((g,S)=>g.fecha.localeCompare(S.fecha)).map((g,S)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${ze.border}`,background:S%2?"#FFFFFF":"#fff",opacity:g.estado==="proyectado"?.6:1},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace"},children:g.fecha}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx(yn,{color:g.tipo==="ingreso"?ze.green:ze.red,children:g.tipo==="ingreso"?" Ingreso":" Egreso"})}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ze.inkMid},children:g.categoria||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:500},children:g.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ze.inkMid},children:g.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:8,color:ze.blue},children:g.factura||""}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx(yn,{color:g.estado==="realizado"?ze.green:ze.amber,children:g.estado==="realizado"?"Realizado":"Proyectado"})}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11,color:g.tipo==="ingreso"?ze.green:ze.red},children:[g.tipo==="ingreso"?"+":"","$",wt(g.monto)]}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>m(g.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},g.id))})]})}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:g=>g.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Uo,{t:"Nuevo movimiento",s:"Ingreso o egreso de la empresa"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Fecha",val:h.fecha,on:g=>b({...h,fecha:g.target.value}),type:"date",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Tipo"}),e.jsxs("select",{value:h.tipo,onChange:g=>b({...h,tipo:g.target.value,categoria:""}),style:{...Vi,width:"100%"},children:[e.jsx("option",{value:"ingreso",children:" Ingreso"}),e.jsx("option",{value:"egreso",children:" Egreso"})]})]}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Estado"}),e.jsxs("select",{value:h.estado,onChange:g=>b({...h,estado:g.target.value}),style:{...Vi,width:"100%"},children:[e.jsx("option",{value:"realizado",children:"Realizado"}),e.jsx("option",{value:"proyectado",children:"Proyectado"})]})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Categora"}),e.jsxs("select",{value:h.categoria,onChange:g=>b({...h,categoria:g.target.value}),style:{...Vi,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),(h.tipo==="ingreso"?j:C).map(g=>e.jsx("option",{children:g},g))]})]}),e.jsx(mt,{lbl:"Concepto",val:h.concepto,on:g=>b({...h,concepto:g.target.value}),ph:"Descripcin"}),e.jsx(mt,{lbl:"Monto",val:h.monto,on:g=>b({...h,monto:g.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Proyecto",val:h.proyecto,on:g=>b({...h,proyecto:g.target.value}),ph:"Opcional",style:{flex:1}}),e.jsx(mt,{lbl:"Factura",val:h.factura,on:g=>b({...h,factura:g.target.value}),ph:"FV-001234",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(_t,{on:v,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar"]}),e.jsx(_t,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function rm({data:t,save:i}){const o=t.adm_cuentas||[],n=l=>i("adm_cuentas",typeof l=="function"?l(o):l),[s,r]=F.useState("cobrar"),[a,u]=F.useState(!1),[h,b]=F.useState({tipo:"cobrar",tercero:"",concepto:"",monto:0,fechaEmision:ei(),fechaVence:"",factura:"",proyecto:"",estado:"vigente"}),j=o.filter(l=>l.tipo===s),C=j.filter(l=>l.estado==="vigente").reduce((l,x)=>l+x.monto,0),v=j.filter(l=>l.estado==="vencida").reduce((l,x)=>l+x.monto,0),m=j.filter(l=>l.estado==="pagada").reduce((l,x)=>l+x.monto,0),f=()=>{n([...o,{id:wo(),...h,tipo:s,monto:parseFloat(h.monto)||0}]),b({tipo:s,tercero:"",concepto:"",monto:0,fechaEmision:ei(),fechaVence:"",factura:"",proyecto:"",estado:"vigente"}),u(!1)},p=(l,x,y)=>n(o.map(g=>g.id===l?{...g,[x]:y}:g)),c=l=>n(o.filter(x=>x.id!==l));F.useEffect(()=>{const l=ei(),x=o.map(y=>y.estado==="vigente"&&y.fechaVence&&y.fechaVence<l?{...y,estado:"vencida"}:y);JSON.stringify(x)!==JSON.stringify(o)&&n(x)},[]);const d={vigente:{lbl:"Vigente",color:ze.blue},vencida:{lbl:"Vencida",color:ze.red},pagada:{lbl:s==="cobrar"?"Cobrada":"Pagada",color:ze.green},parcial:{lbl:"Parcial",color:ze.amber}};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{margin:0,fontSize:10,color:ze.inkLight,letterSpacing:1.5,textTransform:"uppercase"},children:["Cuentas por ",s==="cobrar"?"cobrar":"pagar"]}),e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:s==="cobrar"?"Lo que nos deben":"Lo que debemos"})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[["cobrar"," Por cobrar"],["pagar"," Por pagar"]].map(([l,x],y)=>e.jsx("button",{onClick:()=>r(l),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${ze.border}`,borderLeft:y>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:y===0?"5px 0 0 5px":"0 5px 5px 0",background:s===l?"#111":"#fff",color:s===l?"#fff":ze.inkMid},children:x},l))}),e.jsxs(_t,{on:()=>u(!0),children:[e.jsx(Ne,{size:11})," Nueva cuenta"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12,marginBottom:16},children:[["Vigentes",wt(C),ze.blue],["Vencidas",wt(v),ze.red],[s==="cobrar"?"Cobradas":"Pagadas",wt(m),ze.green]].map(([l,x,y])=>e.jsxs(Si,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:l}),e.jsxs("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y,marginTop:2},children:["$",x]})]},l))}),v>0&&e.jsxs("div",{style:{background:ze.redBg,border:`1px solid ${ze.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(li,{size:14,color:ze.red}),e.jsxs("div",{style:{fontSize:10,color:ze.red,fontWeight:600},children:[j.filter(l=>l.estado==="vencida").length," ",s==="cobrar"?"facturas por cobrar":"facturas por pagar"," vencidas por $",wt(v)]})]}),e.jsx(Si,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Factura","Tercero","Concepto","Proyecto","Emitida","Vence","Monto","Estado",""].map(l=>e.jsx("th",{style:{padding:"6px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${ze.border}`,textAlign:l==="Monto"?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:ze.inkLight,fontSize:11},children:"Sin cuentas registradas"})}):j.sort((l,x)=>(l.fechaVence||"").localeCompare(x.fechaVence||"")).map((l,x)=>{var y,g;return e.jsxs("tr",{style:{borderBottom:`1px solid ${ze.border}`,background:l.estado==="vencida"?"#FAE8E844":x%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l.factura||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10,fontWeight:600},children:l.tercero}),e.jsx("td",{style:{padding:"4px 8px",fontSize:10},children:l.concepto}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,color:ze.inkMid},children:l.proyecto||""}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,fontFamily:"'DM Mono',monospace"},children:l.fechaEmision}),e.jsx("td",{style:{padding:"4px 8px",fontSize:9,fontFamily:"'DM Mono',monospace",color:l.estado==="vencida"?ze.red:ze.ink,fontWeight:l.estado==="vencida"?700:400},children:l.fechaVence||""}),e.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:11},children:["$",wt(l.monto)]}),e.jsx("td",{style:{padding:"4px 8px"},children:e.jsx("select",{value:l.estado,onChange:S=>p(l.id,"estado",S.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:((y=d[l.estado])==null?void 0:y.color)+"22",color:(g=d[l.estado])==null?void 0:g.color},children:Object.entries(d).map(([S,A])=>e.jsx("option",{value:S,children:A.lbl},S))})}),e.jsx("td",{style:{padding:"3px"},children:e.jsx("button",{onClick:()=>c(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},l.id)})})]})}),a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>u(!1),children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx(Uo,{t:`Nueva cuenta por ${s}`,s:s==="cobrar"?"Factura emitida a cliente":"Factura recibida de proveedor"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Tercero",val:h.tercero,on:l=>b({...h,tercero:l.target.value}),ph:s==="cobrar"?"Cliente":"Proveedor",style:{flex:1}}),e.jsx(mt,{lbl:"Nro. factura",val:h.factura,on:l=>b({...h,factura:l.target.value}),ph:"FV-001234",style:{flex:1}})]}),e.jsx(mt,{lbl:"Concepto",val:h.concepto,on:l=>b({...h,concepto:l.target.value}),ph:"Anticipo 30%, Acta parcial..."}),e.jsx(mt,{lbl:"Monto",val:h.monto,on:l=>b({...h,monto:l.target.value}),type:"number"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(mt,{lbl:"Fecha emisin",val:h.fechaEmision,on:l=>b({...h,fechaEmision:l.target.value}),type:"date",style:{flex:1}}),e.jsx(mt,{lbl:"Fecha vencimiento",val:h.fechaVence,on:l=>b({...h,fechaVence:l.target.value}),type:"date",style:{flex:1}})]}),e.jsx(mt,{lbl:"Proyecto",val:h.proyecto,on:l=>b({...h,proyecto:l.target.value}),ph:"Opcional"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(_t,{on:f,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar"]}),e.jsx(_t,{v:"sec",on:()=>u(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function sm(){const t="habitaris_admin",[i,o]=F.useState({});F.useEffect(()=>{Fe.get(t).then(S=>{try{S&&o(JSON.parse(S))}catch{}}).catch(()=>{})},[]);const n=(S,A)=>o(E=>{const w={...E,[S]:A};return Fe.set(t,JSON.stringify(w)),w}),[s,r]=F.useState("dashboard"),a=i.adm_cajas||[],u=i.adm_tarjeta||[],h=i.adm_viaticos||[],b=i.adm_flujo||[],j=i.adm_cuentas||[],C=a.reduce((S,A)=>{const E=A.movimientos||[];return S+(A.fondoInicial||0)+E.reduce((w,I)=>w+(I.tipo==="entrada"?I.monto:-I.monto),0)},0),v=u.filter(S=>S.estado==="pendiente"),m=h.filter(S=>S.estado==="solicitado"||S.estado==="aprobado"),p=new Date().toISOString().split("T")[0].slice(0,7),c=b.filter(S=>{var A;return(A=S.fecha)==null?void 0:A.startsWith(p)}),d=c.filter(S=>S.tipo==="ingreso").reduce((S,A)=>S+A.monto,0),l=c.filter(S=>S.tipo==="egreso").reduce((S,A)=>S+A.monto,0),x=j.filter(S=>S.tipo==="cobrar"&&S.estado==="vencida").reduce((S,A)=>S+A.monto,0),y=j.filter(S=>S.tipo==="pagar"&&S.estado==="vencida").reduce((S,A)=>S+A.monto,0),g=S=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(S||0);return e.jsxs(e.Fragment,{children:[e.jsx(em,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Administracin"}),e.jsx("div",{style:{fontSize:10,color:ze.inkMid},children:"Caja chica  Tarjeta  Viticos  Flujo empresa  CxC / CxP"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:od.map((S,A)=>e.jsx("button",{onClick:()=>r(S.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${ze.border}`,borderLeft:A>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:A===0?"6px 0 0 6px":A===od.length-1?"0 6px 6px 0":"0",background:s===S.id?"#111":"#fff",color:s===S.id?"#fff":ze.inkMid,borderBottom:s===S.id?"2px solid #fff":`1px solid ${ze.border}`},children:S.lbl},S.id))}),s==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Saldo cajas","$"+g(C),C>=0?"#111111":"#B91C1C"],[" Legaliz. pend.",v.length,v.length>0?"#8C6A00":"#111111"],[" Viticos pend.",m.length,m.length>0?"#8C6A00":"#111111"],[" Flujo neto mes","$"+g(d-l),d-l>=0?"#111111":"#B91C1C"]].map(([S,A,E])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${ze.border}`,borderRadius:8,padding:"14px 16px",boxShadow:ze.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:S}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E},children:A})]},S))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Ingresos mes","$"+g(d),"#111111"],[" Egresos mes","$"+g(l),"#B91C1C"],[" CxC vencidas","$"+g(x),x>0?"#B91C1C":"#111111"],[" CxP vencidas","$"+g(y),y>0?"#B91C1C":"#111111"]].map(([S,A,E])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${ze.border}`,borderRadius:8,padding:"14px 16px",boxShadow:ze.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:S}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E},children:A})]},S))}),(x>0||y>0||v.length>0)&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" ",[x>0&&`CxC vencidas $${g(x)}`,y>0&&`CxP vencidas $${g(y)}`,v.length>0&&`${v.length} legalizaciones pendientes`].filter(Boolean).join("  ")]})]}),s==="caja"&&e.jsx(tm,{data:i,save:n}),s==="tarjeta"&&e.jsx(im,{data:i,save:n}),s==="viaticos"&&e.jsx(om,{data:i,save:n}),s==="flujo"&&e.jsx(nm,{data:i,save:n}),s==="cxc"&&e.jsx(rm,{data:i,save:n})]})]})}const am=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Ke={bg:"#F5F4F1",surface:"#FFFFFF",surfaceAlt:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},vr=()=>Math.random().toString(36).slice(2,10),Gi=()=>new Date().toISOString().split("T")[0],Wt=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),rs=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:1}).format(t||0),Ki=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Ke.surface,border:`1px solid ${Ke.border}`,borderRadius:8,padding:16,boxShadow:Ke.shadow,...i},...o,children:t}),ni=({children:t,on:i,v:o,style:n,...s})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${Ke.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?Ke.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...s,children:t}),ct=({lbl:t,val:i,on:o,ph:n,type:s,style:r,children:a,...u})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),a||e.jsx("input",{type:s||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${Ke.border}`,borderRadius:4,fontSize:11,background:"#fff"},...u})]}),ss=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),Ci={border:`1px solid ${Ke.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},Ni={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${Ke.border}`,textAlign:"left"},nt={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${Ke.border}`},nd="habitaris_flotas",rd=[{id:"dashboard",lbl:" Dashboard"},{id:"vehiculos",lbl:" Vehculos"},{id:"km",lbl:" Partes KM"},{id:"combustible",lbl:" Combustible"},{id:"docs",lbl:" Documentacin"},{id:"manto",lbl:" Mantenimiento"}],lm=["Camioneta","Camin","Volqueta","Furgn","Automvil","Motocicleta","Maquinaria","Otro"],la={activo:{lbl:"Activo",c:Ke.green},taller:{lbl:"En taller",c:Ke.amber},inactivo:{lbl:"Inactivo",c:Ke.red}};function dm({vehs:t,setVehs:i}){const[o,n]=F.useState(!1),[s,r]=F.useState(null),[a,u]=F.useState(""),[h,b]=F.useState({placa:"",marca:"",modelo:"",anio:new Date().getFullYear(),tipo:"Camioneta",conductor:"",proyecto:"",kmActual:0,estado:"activo",color:"",vin:"",observaciones:""}),j=()=>b({placa:"",marca:"",modelo:"",anio:new Date().getFullYear(),tipo:"Camioneta",conductor:"",proyecto:"",kmActual:0,estado:"activo",color:"",vin:"",observaciones:""}),C=l=>{b({...l}),r(l.id),n(!0)},v=()=>{j(),r(null),n(!0)},m=()=>{h.placa&&(i(s?t.map(l=>l.id===s?{...h,id:s}:l):[...t,{...h,id:vr(),fechaRegistro:Gi()}]),n(!1),j(),r(null))},f=l=>i(t.filter(x=>x.id!==l)),p=t.filter(l=>{var y,g,S,A;const x=a.toLowerCase();return!x||((y=l.placa)==null?void 0:y.toLowerCase().includes(x))||((g=l.marca)==null?void 0:g.toLowerCase().includes(x))||((S=l.conductor)==null?void 0:S.toLowerCase().includes(x))||((A=l.proyecto)==null?void 0:A.toLowerCase().includes(x))}),c=t.filter(l=>l.estado==="activo").length,d=t.filter(l=>l.estado==="taller").length;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Flota vehicular  ",t.length," vehculos"]}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ke.inkMid},children:[c," activos  ",d," en taller"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ki,{size:12,style:{position:"absolute",left:8,top:8,color:Ke.inkLight}}),e.jsx("input",{value:a,onChange:l=>u(l.target.value),placeholder:"Buscar placa, marca, conductor...",style:{...Ci,paddingLeft:26,width:220}})]}),e.jsxs(ni,{on:v,children:[e.jsx(Ne,{size:11})," Nuevo vehculo"]})]})]}),e.jsx(Ki,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Tipo","Marca / Modelo","Ao","Conductor","Proyecto","KM actual","Estado",""].map(l=>e.jsx("th",{style:{...Ni,textAlign:l==="KM actual"?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ke.inkLight,fontSize:11},children:"Sin vehculos registrados"})}):p.map((l,x)=>{const y=la[l.estado]||la.activo;return e.jsxs("tr",{style:{background:x%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:12},children:l.placa}),e.jsx("td",{style:{...nt,fontSize:9},children:l.tipo}),e.jsxs("td",{style:{...nt,fontWeight:600},children:[l.marca," ",l.modelo]}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace"},children:l.anio}),e.jsx("td",{style:{...nt,fontSize:9,color:Ke.inkMid},children:l.conductor||""}),e.jsx("td",{style:{...nt,fontSize:9,color:Ke.inkMid},children:l.proyecto||""}),e.jsx("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:Wt(l.kmActual)}),e.jsx("td",{style:nt,children:e.jsx(ss,{color:y.c,children:y.lbl})}),e.jsxs("td",{style:{...nt,whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:()=>C(l),style:{background:"none",border:"none",cursor:"pointer",color:Ke.blue,marginRight:4},children:e.jsx(ro,{size:11})}),e.jsx("button",{onClick:()=>f(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})]})]},l.id)})})]})}),o&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{n(!1),r(null)},children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:500,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:s?"Editar vehculo":"Nuevo vehculo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Placa",val:h.placa,on:l=>b({...h,placa:l.target.value.toUpperCase()}),ph:"ABC-123",style:{flex:"0 0 120px"}}),e.jsx(ct,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:h.tipo,onChange:l=>b({...h,tipo:l.target.value}),style:{...Ci,width:"100%"},children:lm.map(l=>e.jsx("option",{children:l},l))})}),e.jsx(ct,{lbl:"Estado",style:{flex:1},children:e.jsx("select",{value:h.estado,onChange:l=>b({...h,estado:l.target.value}),style:{...Ci,width:"100%"},children:Object.entries(la).map(([l,x])=>e.jsx("option",{value:l,children:x.lbl},l))})})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Marca",val:h.marca,on:l=>b({...h,marca:l.target.value}),ph:"Toyota",style:{flex:1}}),e.jsx(ct,{lbl:"Modelo",val:h.modelo,on:l=>b({...h,modelo:l.target.value}),ph:"Hilux",style:{flex:1}}),e.jsx(ct,{lbl:"Ao",val:h.anio,on:l=>b({...h,anio:l.target.value}),type:"number",style:{flex:"0 0 80px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Color",val:h.color,on:l=>b({...h,color:l.target.value}),ph:"Blanco",style:{flex:1}}),e.jsx(ct,{lbl:"VIN / Chasis",val:h.vin,on:l=>b({...h,vin:l.target.value}),ph:"Opcional",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Conductor asignado",val:h.conductor,on:l=>b({...h,conductor:l.target.value}),ph:"Nombre",style:{flex:1}}),e.jsx(ct,{lbl:"Proyecto",val:h.proyecto,on:l=>b({...h,proyecto:l.target.value}),ph:"Obra asignada",style:{flex:1}})]}),e.jsx(ct,{lbl:"KM actual",val:h.kmActual,on:l=>b({...h,kmActual:l.target.value}),type:"number"}),e.jsx(ct,{lbl:"Observaciones",val:h.observaciones,on:l=>b({...h,observaciones:l.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ni,{on:m,style:{flex:1},children:[e.jsx(yt,{size:11})," ",s?"Guardar":"Crear"]}),e.jsx(ni,{v:"sec",on:()=>{n(!1),r(null)},style:{flex:1},children:"Cancelar"})]})]})})]})}function cm({vehs:t,setVehs:i,partes:o,setPartes:n}){const[s,r]=F.useState(!1),[a,u]=F.useState(()=>{const p=new Date;return`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}`}),[h,b]=F.useState({vehId:"",fecha:Gi(),kmInicio:0,kmFin:0,conductor:"",proyecto:"",ruta:"",observaciones:""}),j=()=>{const p=t.find(d=>d.id===h.vehId);if(!p)return;const c={id:vr(),...h,kmInicio:parseFloat(h.kmInicio)||0,kmFin:parseFloat(h.kmFin)||0,placa:p.placa};n([...o,c]),c.kmFin>(parseFloat(p.kmActual)||0)&&i(t.map(d=>d.id===h.vehId?{...d,kmActual:c.kmFin}:d)),b({vehId:"",fecha:Gi(),kmInicio:0,kmFin:0,conductor:"",proyecto:"",ruta:"",observaciones:""}),r(!1)},C=p=>n(o.filter(c=>c.id!==p)),v=o.filter(p=>{var c;return(c=p.fecha)==null?void 0:c.startsWith(a)}).sort((p,c)=>p.fecha.localeCompare(c.fecha)),m=v.reduce((p,c)=>p+Math.max(0,(c.kmFin||0)-(c.kmInicio||0)),0),f=[...new Set(o.map(p=>{var c;return(c=p.fecha)==null?void 0:c.slice(0,7)}).filter(Boolean))];return f.includes(a)||f.push(a),f.sort(),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Partes de kilmetros"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ke.inkMid},children:[a,"  ",v.length," registros  ",Wt(m)," km total"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:a,onChange:p=>u(p.target.value),style:{...Ci,fontWeight:600},children:f.map(p=>e.jsx("option",{value:p,children:p},p))}),e.jsxs(ni,{on:()=>r(!0),children:[e.jsx(Ne,{size:11})," Registro"]})]})]}),e.jsx(Ki,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","Placa","Conductor","Proyecto","Ruta","KM inicio","KM fin","Recorrido",""].map(p=>e.jsx("th",{style:{...Ni,textAlign:["KM inicio","KM fin","Recorrido"].includes(p)?"right":"left"},children:p},p))})}),e.jsxs("tbody",{children:[v.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ke.inkLight,fontSize:11},children:["Sin registros en ",a]})}):v.map((p,c)=>{const d=Math.max(0,(p.kmFin||0)-(p.kmInicio||0));return e.jsxs("tr",{style:{background:c%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace"},children:p.fecha}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:p.placa}),e.jsx("td",{style:{...nt,fontSize:9},children:p.conductor||""}),e.jsx("td",{style:{...nt,fontSize:9,color:Ke.inkMid},children:p.proyecto||""}),e.jsx("td",{style:{...nt,fontSize:9},children:p.ruta||""}),e.jsx("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Wt(p.kmInicio)}),e.jsx("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Wt(p.kmFin)}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,color:Ke.green},children:[Wt(d)," km"]}),e.jsx("td",{style:nt,children:e.jsx("button",{onClick:()=>C(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},p.id)}),v.length>0&&e.jsxs("tr",{style:{background:"#EDEBE7"},children:[e.jsx("td",{colSpan:7,style:{...nt,fontWeight:800,borderTop:`2px solid ${Ke.ink}`},children:"TOTAL MES"}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:800,color:Ke.green,fontSize:12,borderTop:`2px solid ${Ke.ink}`},children:[Wt(m)," km"]}),e.jsx("td",{style:{...nt,borderTop:`2px solid ${Ke.ink}`}})]})]})]})}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nuevo registro KM"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:h.vehId,onChange:p=>{const c=t.find(d=>d.id===p.target.value);b({...h,vehId:p.target.value,kmInicio:(c==null?void 0:c.kmActual)||0,conductor:(c==null?void 0:c.conductor)||h.conductor})},style:{...Ci,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.filter(p=>p.estado==="activo").map(p=>e.jsxs("option",{value:p.id,children:[p.placa,"  ",p.marca," ",p.modelo]},p.id))]})}),e.jsx(ct,{lbl:"Fecha",val:h.fecha,on:p=>b({...h,fecha:p.target.value}),type:"date",style:{flex:"0 0 140px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"KM inicio",val:h.kmInicio,on:p=>b({...h,kmInicio:p.target.value}),type:"number",style:{flex:1}}),e.jsx(ct,{lbl:"KM fin",val:h.kmFin,on:p=>b({...h,kmFin:p.target.value}),type:"number",style:{flex:1}}),e.jsxs("div",{style:{flex:1,marginBottom:8},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:2},children:"Recorrido"}),e.jsxs("div",{style:{padding:"6px 8px",fontSize:14,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Ke.green},children:[Wt(Math.max(0,(parseFloat(h.kmFin)||0)-(parseFloat(h.kmInicio)||0)))," km"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Conductor",val:h.conductor,on:p=>b({...h,conductor:p.target.value}),ph:"Nombre",style:{flex:1}}),e.jsx(ct,{lbl:"Proyecto",val:h.proyecto,on:p=>b({...h,proyecto:p.target.value}),ph:"Obra",style:{flex:1}})]}),e.jsx(ct,{lbl:"Ruta / destino",val:h.ruta,on:p=>b({...h,ruta:p.target.value}),ph:"Bogot  Obra Chic  Bogot"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ni,{on:j,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar"]}),e.jsx(ni,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function pm({vehs:t,tanqueos:i,setTanqueos:o}){const[n,s]=F.useState(!1),[r,a]=F.useState(()=>{const l=new Date;return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`}),[u,h]=F.useState({vehId:"",fecha:Gi(),litros:0,valorTotal:0,km:0,estacion:"",tipoCombus:"Diesel",factura:""}),b=["Diesel","Gasolina corriente","Gasolina extra","Gas natural","Elctrico"],j=()=>{const l=t.find(x=>x.id===u.vehId);l&&(o([...i,{id:vr(),...u,litros:parseFloat(u.litros)||0,valorTotal:parseFloat(u.valorTotal)||0,km:parseFloat(u.km)||0,placa:l.placa}]),h({vehId:"",fecha:Gi(),litros:0,valorTotal:0,km:0,estacion:"",tipoCombus:"Diesel",factura:""}),s(!1))},C=l=>o(i.filter(x=>x.id!==l)),v=i.filter(l=>{var x;return(x=l.fecha)==null?void 0:x.startsWith(r)}),m=v.reduce((l,x)=>l+x.litros,0),f=v.reduce((l,x)=>l+x.valorTotal,0),p=m>0?f/m:0,c=[...new Set(i.map(l=>{var x;return(x=l.fecha)==null?void 0:x.slice(0,7)}).filter(Boolean))];c.includes(r)||c.push(r),c.sort();const d={};return v.forEach(l=>{d[l.placa]||(d[l.placa]={litros:0,gasto:0,tanqueos:0}),d[l.placa].litros+=l.litros,d[l.placa].gasto+=l.valorTotal,d[l.placa].tanqueos++}),e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Consumo de combustible"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ke.inkMid},children:[r,"  ",v.length," tanqueos"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("select",{value:r,onChange:l=>a(l.target.value),style:{...Ci,fontWeight:600},children:c.map(l=>e.jsx("option",{value:l,children:l},l))}),e.jsxs(ni,{on:()=>s(!0),children:[e.jsx(Ne,{size:11})," Tanqueo"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Litros total",rs(m)+" L",Ke.blue],[" Gasto total","$"+Wt(f),Ke.red],[" $/Litro prom.","$"+Wt(p),Ke.ink],[" Vehculos",Object.keys(d).length+"",Ke.ink]].map(([l,x,y])=>e.jsxs(Ki,{style:{padding:"10px 14px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:l}),e.jsx("div",{style:{fontSize:16,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y,marginTop:2},children:x})]},l))}),Object.keys(d).length>0&&e.jsxs(Ki,{style:{padding:0,overflow:"hidden",marginBottom:14},children:[e.jsx("div",{style:{padding:"8px 12px",background:"#EDEBE7",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Resumen por vehculo"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ni,children:"Placa"}),e.jsx("th",{style:{...Ni,textAlign:"right"},children:"Tanqueos"}),e.jsx("th",{style:{...Ni,textAlign:"right"},children:"Litros"}),e.jsx("th",{style:{...Ni,textAlign:"right"},children:"Gasto"}),e.jsx("th",{style:{...Ni,textAlign:"right"},children:"$/Litro"})]})}),e.jsx("tbody",{children:Object.entries(d).sort((l,x)=>x[1].gasto-l[1].gasto).map(([l,x],y)=>e.jsxs("tr",{style:{background:y%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l}),e.jsx("td",{style:{...nt,textAlign:"right"},children:x.tanqueos}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[rs(x.litros)," L"]}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600,color:Ke.red},children:["$",Wt(x.gasto)]}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:["$",Wt(x.litros>0?x.gasto/x.litros:0)]})]},l))})]})]}),e.jsx(Ki,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F5F4F1"},children:["Fecha","Placa","Tipo","Estacin","Litros","Valor","KM","Factura",""].map(l=>e.jsx("th",{style:{...Ni,textAlign:["Litros","Valor","KM"].includes(l)?"right":"left"},children:l},l))})}),e.jsx("tbody",{children:v.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ke.inkLight,fontSize:11},children:["Sin tanqueos en ",r]})}):v.sort((l,x)=>l.fecha.localeCompare(x.fecha)).map((l,x)=>e.jsxs("tr",{style:{background:x%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace"},children:l.fecha}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:l.placa}),e.jsx("td",{style:{...nt,fontSize:9},children:l.tipoCombus}),e.jsx("td",{style:{...nt,fontSize:9},children:l.estacion||""}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:[rs(l.litros)," L"]}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",Wt(l.valorTotal)]}),e.jsx("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:Wt(l.km)}),e.jsx("td",{style:{...nt,fontSize:8,color:Ke.blue},children:l.factura||""}),e.jsx("td",{style:nt,children:e.jsx("button",{onClick:()=>C(l.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},l.id))})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>s(!1),children:e.jsxs("div",{onClick:l=>l.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Registrar tanqueo"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:u.vehId,onChange:l=>h({...u,vehId:l.target.value}),style:{...Ci,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(l=>e.jsxs("option",{value:l.id,children:[l.placa,"  ",l.marca," ",l.modelo]},l.id))]})}),e.jsx(ct,{lbl:"Fecha",val:u.fecha,on:l=>h({...u,fecha:l.target.value}),type:"date",style:{flex:"0 0 140px"}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Tipo combustible",style:{flex:1},children:e.jsx("select",{value:u.tipoCombus,onChange:l=>h({...u,tipoCombus:l.target.value}),style:{...Ci,width:"100%"},children:b.map(l=>e.jsx("option",{children:l},l))})}),e.jsx(ct,{lbl:"Estacin",val:u.estacion,on:l=>h({...u,estacion:l.target.value}),ph:"Terpel Cra 7",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Litros",val:u.litros,on:l=>h({...u,litros:l.target.value}),type:"number",style:{flex:1}}),e.jsx(ct,{lbl:"Valor total",val:u.valorTotal,on:l=>h({...u,valorTotal:l.target.value}),type:"number",style:{flex:1}}),e.jsx(ct,{lbl:"KM odmetro",val:u.km,on:l=>h({...u,km:l.target.value}),type:"number",style:{flex:1}})]}),e.jsx(ct,{lbl:"Ref. factura",val:u.factura,on:l=>h({...u,factura:l.target.value}),ph:"FV-00123"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ni,{on:j,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar"]}),e.jsx(ni,{v:"sec",on:()=>s(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function um({vehs:t,docVehs:i,setDocVehs:o}){const[n,s]=F.useState(!1),[r,a]=F.useState({vehId:"",tipo:"soat",fechaExpedicion:Gi(),fechaVence:"",entidad:"",poliza:"",costo:0,observaciones:""}),u=[{id:"soat",lbl:"SOAT",icon:""},{id:"tecno",lbl:"Tecnomecnica",icon:""},{id:"seguro",lbl:"Seguro todo riesgo",icon:""},{id:"tarjeta_prop",lbl:"Tarjeta de propiedad",icon:""},{id:"licencia_trans",lbl:"Licencia de trnsito",icon:""},{id:"revision_gas",lbl:"Revisin de gases",icon:""},{id:"poliza_rce",lbl:"Pliza RCE",icon:""},{id:"otro",lbl:"Otro",icon:""}],h=()=>{const p=t.find(c=>c.id===r.vehId);p&&(o([...i,{id:vr(),...r,costo:parseFloat(r.costo)||0,placa:p.placa}]),a({vehId:"",tipo:"soat",fechaExpedicion:Gi(),fechaVence:"",entidad:"",poliza:"",costo:0,observaciones:""}),s(!1))},b=p=>o(i.filter(c=>c.id!==p)),j=Gi(),C=new Date;C.setDate(C.getDate()+30);const v=C.toISOString().split("T")[0],m=i.filter(p=>p.fechaVence&&p.fechaVence<j),f=i.filter(p=>p.fechaVence&&p.fechaVence>=j&&p.fechaVence<=v);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Documentacin vehicular"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ke.inkMid},children:[i.length," documentos  ",m.length," vencidos  ",f.length," por vencer"]})]}),e.jsxs(ni,{on:()=>s(!0),children:[e.jsx(Ne,{size:11})," Documento"]})]}),(m.length>0||f.length>0)&&e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:14},children:[m.length>0&&e.jsxs("div",{style:{flex:1,background:Ke.redBg,border:`1px solid ${Ke.red}33`,borderRadius:6,padding:"8px 12px",display:"flex",alignItems:"center",gap:6},children:[e.jsx(li,{size:14,color:Ke.red}),e.jsxs("div",{style:{fontSize:10,color:Ke.red,fontWeight:600},children:[" ",m.length," documento",m.length>1?"s":""," vencido",m.length>1?"s":"",": ",m.map(p=>{var c;return p.placa+" "+((c=u.find(d=>d.id===p.tipo))==null?void 0:c.lbl)}).join(", ")]})]}),f.length>0&&e.jsxs("div",{style:{flex:1,background:Ke.amberBg,border:`1px solid ${Ke.amber}33`,borderRadius:6,padding:"8px 12px",display:"flex",alignItems:"center",gap:6},children:[e.jsx(li,{size:14,color:Ke.amber}),e.jsxs("div",{style:{fontSize:10,color:Ke.amber,fontWeight:600},children:[" ",f.length," por vencer en 30 das"]})]})]}),e.jsx(Ki,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Documento","Entidad","Pliza/Nro","Expedicin","Vencimiento","Costo","Estado",""].map(p=>e.jsx("th",{style:{...Ni,textAlign:p==="Costo"?"right":"left"},children:p},p))})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ke.inkLight,fontSize:11},children:"Sin documentos"})}):i.sort((p,c)=>(p.fechaVence||"z").localeCompare(c.fechaVence||"z")).map((p,c)=>{const d=u.find(y=>y.id===p.tipo)||u[7],l=p.fechaVence&&p.fechaVence<j,x=p.fechaVence&&!l&&p.fechaVence<=v;return e.jsxs("tr",{style:{background:l?"#FAE8E844":x?"#FAF0E044":c%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:p.placa}),e.jsxs("td",{style:{...nt,fontWeight:600},children:[d.icon," ",d.lbl]}),e.jsx("td",{style:{...nt,fontSize:9},children:p.entidad||""}),e.jsx("td",{style:{...nt,fontSize:9,fontFamily:"'DM Mono',monospace"},children:p.poliza||""}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontSize:9},children:p.fechaExpedicion}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontSize:9,fontWeight:l||x?700:400,color:l?Ke.red:x?Ke.amber:Ke.ink},children:p.fechaVence||"N/A"}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace"},children:["$",Wt(p.costo)]}),e.jsx("td",{style:nt,children:l?e.jsx(ss,{color:Ke.red,children:"Vencido"}):x?e.jsx(ss,{color:Ke.amber,children:"Por vencer"}):e.jsx(ss,{color:Ke.green,children:"Vigente"})}),e.jsx("td",{style:nt,children:e.jsx("button",{onClick:()=>b(p.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},p.id)})})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>s(!1),children:e.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:460,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nuevo documento"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:r.vehId,onChange:p=>a({...r,vehId:p.target.value}),style:{...Ci,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(p=>e.jsxs("option",{value:p.id,children:[p.placa,"  ",p.marca," ",p.modelo]},p.id))]})}),e.jsx(ct,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:r.tipo,onChange:p=>a({...r,tipo:p.target.value}),style:{...Ci,width:"100%"},children:u.map(p=>e.jsxs("option",{value:p.id,children:[p.icon," ",p.lbl]},p.id))})})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Entidad / aseguradora",val:r.entidad,on:p=>a({...r,entidad:p.target.value}),ph:"Sura, Colpatria...",style:{flex:1}}),e.jsx(ct,{lbl:"Nro. pliza / doc",val:r.poliza,on:p=>a({...r,poliza:p.target.value}),ph:"POL-123",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Fecha expedicin",val:r.fechaExpedicion,on:p=>a({...r,fechaExpedicion:p.target.value}),type:"date",style:{flex:1}}),e.jsx(ct,{lbl:"Fecha vencimiento",val:r.fechaVence,on:p=>a({...r,fechaVence:p.target.value}),type:"date",style:{flex:1}})]}),e.jsx(ct,{lbl:"Costo",val:r.costo,on:p=>a({...r,costo:p.target.value}),type:"number"}),e.jsx(ct,{lbl:"Observaciones",val:r.observaciones,on:p=>a({...r,observaciones:p.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ni,{on:h,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar"]}),e.jsx(ni,{v:"sec",on:()=>s(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function gm({vehs:t,mantos:i,setMantos:o}){const[n,s]=F.useState(!1),[r,a]=F.useState("todos"),[u,h]=F.useState({vehId:"",tipo:"preventivo",descripcion:"",fechaProg:"",fechaReal:"",kmProg:0,kmReal:0,taller:"",costo:0,estado:"programado",factura:"",observaciones:""}),b=[{id:"preventivo",lbl:" Preventivo",desc:"Cambio aceite, filtros, revisin general"},{id:"correctivo",lbl:" Correctivo",desc:"Reparacin de falla o avera"},{id:"llantas",lbl:" Llantas",desc:"Cambio, rotacin o alineacin"},{id:"frenos",lbl:" Frenos",desc:"Pastillas, discos, lquido"},{id:"electrico",lbl:" Elctrico",desc:"Batera, alternador, luces"},{id:"carroceria",lbl:" Carrocera",desc:"Pintura, latonera, vidrios"},{id:"otro",lbl:" Otro",desc:"Otro tipo de mantenimiento"}],j={programado:{lbl:"Programado",c:Ke.blue},en_curso:{lbl:"En curso",c:Ke.amber},completado:{lbl:"Completado",c:Ke.green},cancelado:{lbl:"Cancelado",c:Ke.red}},C=()=>{const x=t.find(y=>y.id===u.vehId);x&&(o([...i,{id:vr(),...u,kmProg:parseFloat(u.kmProg)||0,kmReal:parseFloat(u.kmReal)||0,costo:parseFloat(u.costo)||0,placa:x.placa}]),h({vehId:"",tipo:"preventivo",descripcion:"",fechaProg:"",fechaReal:"",kmProg:0,kmReal:0,taller:"",costo:0,estado:"programado",factura:"",observaciones:""}),s(!1))},v=(x,y,g)=>o(i.map(S=>S.id===x?{...S,[y]:g}:S)),m=x=>o(i.filter(y=>y.id!==x)),f=r==="todos"?i:i.filter(x=>x.estado===r),p=i.filter(x=>x.estado==="completado").reduce((x,y)=>x+y.costo,0),c=i.filter(x=>x.estado==="programado"),d=Gi(),l=c.filter(x=>x.fechaProg&&x.fechaProg<d);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Plan de mantenimiento"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:Ke.inkMid},children:[i.length," registros  ",c.length," programados  $",Wt(p)," invertido"]})]}),e.jsxs(ni,{on:()=>s(!0),children:[e.jsx(Ne,{size:11})," Mantenimiento"]})]}),l.length>0&&e.jsxs("div",{style:{background:Ke.redBg,border:`1px solid ${Ke.red}33`,borderRadius:6,padding:"8px 14px",marginBottom:14,display:"flex",alignItems:"center",gap:8},children:[e.jsx(li,{size:14,color:Ke.red}),e.jsxs("div",{style:{fontSize:10,color:Ke.red,fontWeight:600},children:[" ",l.length," mantenimiento",l.length>1?"s":""," vencido",l.length>1?"s":"",": ",l.map(x=>x.placa).join(", ")]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14},children:[["todos","Todos"],["programado","Programados"],["en_curso","En curso"],["completado","Completados"]].map(([x,y],g,S)=>e.jsx("button",{onClick:()=>a(x),style:{padding:"6px 14px",fontSize:10,fontWeight:600,cursor:"pointer",border:`1px solid ${Ke.border}`,borderLeft:g>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:g===0?"5px 0 0 5px":g===S.length-1?"0 5px 5px 0":"0",background:r===x?"#111":"#fff",color:r===x?"#fff":Ke.inkMid},children:y},x))}),e.jsx(Ki,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Placa","Tipo","Descripcin","Taller","F. programada","F. real","Costo","Estado",""].map(x=>e.jsx("th",{style:{...Ni,textAlign:x==="Costo"?"right":"left"},children:x},x))})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:Ke.inkLight,fontSize:11},children:"Sin mantenimientos"})}):f.sort((x,y)=>(x.fechaProg||"z").localeCompare(y.fechaProg||"z")).map((x,y)=>{const g=b.find(E=>E.id===x.tipo)||b[6],S=j[x.estado]||j.programado,A=x.estado==="programado"&&x.fechaProg&&x.fechaProg<d;return e.jsxs("tr",{style:{background:A?"#FAE8E844":y%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontWeight:700},children:x.placa}),e.jsx("td",{style:{...nt,fontSize:9},children:g.lbl}),e.jsx("td",{style:{...nt,fontSize:10,maxWidth:200},children:x.descripcion||""}),e.jsx("td",{style:{...nt,fontSize:9},children:x.taller||""}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontSize:9,color:A?Ke.red:Ke.ink,fontWeight:A?700:400},children:x.fechaProg||""}),e.jsx("td",{style:{...nt,fontFamily:"'DM Mono',monospace",fontSize:9},children:x.fechaReal||""}),e.jsxs("td",{style:{...nt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:600},children:["$",Wt(x.costo)]}),e.jsx("td",{style:nt,children:e.jsx("select",{value:x.estado,onChange:E=>v(x.id,"estado",E.target.value),style:{fontSize:8,fontWeight:700,padding:"2px 6px",borderRadius:10,border:"none",cursor:"pointer",background:S.c+"22",color:S.c},children:Object.entries(j).map(([E,w])=>e.jsx("option",{value:E,children:w.lbl},E))})}),e.jsx("td",{style:nt,children:e.jsx("button",{onClick:()=>m(x.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},x.id)})})]})}),n&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>s(!1),children:e.jsxs("div",{onClick:x=>x.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:500,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Programar mantenimiento"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Vehculo",style:{flex:1},children:e.jsxs("select",{value:u.vehId,onChange:x=>h({...u,vehId:x.target.value}),style:{...Ci,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),t.map(x=>e.jsxs("option",{value:x.id,children:[x.placa,"  ",x.marca," ",x.modelo]},x.id))]})}),e.jsx(ct,{lbl:"Tipo",style:{flex:1},children:e.jsx("select",{value:u.tipo,onChange:x=>h({...u,tipo:x.target.value}),style:{...Ci,width:"100%"},children:b.map(x=>e.jsx("option",{value:x.id,children:x.lbl},x.id))})})]}),e.jsx(ct,{lbl:"Descripcin",val:u.descripcion,on:x=>h({...u,descripcion:x.target.value}),ph:"Cambio aceite 10W-40, filtro aceite, filtro aire..."}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Fecha programada",val:u.fechaProg,on:x=>h({...u,fechaProg:x.target.value}),type:"date",style:{flex:1}}),e.jsx(ct,{lbl:"Fecha real",val:u.fechaReal,on:x=>h({...u,fechaReal:x.target.value}),type:"date",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"KM programado",val:u.kmProg,on:x=>h({...u,kmProg:x.target.value}),type:"number",style:{flex:1}}),e.jsx(ct,{lbl:"KM real",val:u.kmReal,on:x=>h({...u,kmReal:x.target.value}),type:"number",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(ct,{lbl:"Taller",val:u.taller,on:x=>h({...u,taller:x.target.value}),ph:"Nombre taller",style:{flex:1}}),e.jsx(ct,{lbl:"Costo",val:u.costo,on:x=>h({...u,costo:x.target.value}),type:"number",style:{flex:1}})]}),e.jsx(ct,{lbl:"Ref. factura",val:u.factura,on:x=>h({...u,factura:x.target.value}),ph:"FV-00123"}),e.jsx(ct,{lbl:"Observaciones",val:u.observaciones,on:x=>h({...u,observaciones:x.target.value}),ph:"Notas"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ni,{on:C,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar"]}),e.jsx(ni,{v:"sec",on:()=>s(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function hm(){const[t,i]=F.useState({});F.useEffect(()=>{Fe.get(nd).then(B=>{try{B&&i(JSON.parse(B))}catch{}}).catch(()=>{})},[]);const o=(B,P)=>i(q=>{const U={...q,[B]:typeof P=="function"?P(q[B]):P};return Fe.set(nd,JSON.stringify(U)),U}),n=t.vehiculos||[],s=B=>o("vehiculos",typeof B=="function"?B(n):B),r=t.partesKm||[],a=B=>o("partesKm",typeof B=="function"?B(r):B),u=t.tanqueos||[],h=B=>o("tanqueos",typeof B=="function"?B(u):B),b=t.docVehs||[],j=B=>o("docVehs",typeof B=="function"?B(b):B),C=t.mantos||[],v=B=>o("mantos",typeof B=="function"?B(C):B),[m,f]=F.useState("dashboard"),p=Gi(),c=p.slice(0,7),d=new Date;d.setDate(d.getDate()+30);const l=d.toISOString().split("T")[0],x=n.filter(B=>B.estado==="activo").length,y=n.filter(B=>B.estado==="taller").length,g=b.filter(B=>B.fechaVence&&B.fechaVence<p).length,S=b.filter(B=>B.fechaVence&&B.fechaVence>=p&&B.fechaVence<=l).length,A=C.filter(B=>B.estado==="programado"&&B.fechaProg&&B.fechaProg<p).length,E=r.filter(B=>{var P;return(P=B.fecha)==null?void 0:P.startsWith(c)}).reduce((B,P)=>B+Math.max(0,(P.kmFin||0)-(P.kmInicio||0)),0),w=u.filter(B=>{var P;return(P=B.fecha)==null?void 0:P.startsWith(c)}).reduce((B,P)=>B+P.valorTotal,0),I=u.filter(B=>{var P;return(P=B.fecha)==null?void 0:P.startsWith(c)}).reduce((B,P)=>B+P.litros,0),z=C.filter(B=>B.estado==="completado").reduce((B,P)=>B+P.costo,0);return e.jsxs(e.Fragment,{children:[e.jsx(am,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Control de Flotas"}),e.jsx("div",{style:{fontSize:10,color:Ke.inkMid},children:"Vehculos  Kilmetros  Combustible  Documentos  Mantenimiento"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:rd.map((B,P)=>e.jsx("button",{onClick:()=>f(B.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${Ke.border}`,borderLeft:P>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:P===0?"6px 0 0 6px":P===rd.length-1?"0 6px 6px 0":"0",background:m===B.id?"#111":"#fff",color:m===B.id?"#fff":Ke.inkMid},children:B.lbl},B.id))}),m==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Vehculos activos",`${x}/${n.length}`,Ke.ink],[" En taller",y,y>0?"#8C6A00":"#111111"],[" KM mes",`${Wt(E)} km`,"#3B3B3B"],[" Combustible mes",`$${Wt(w)}`,"#B91C1C"]].map(([B,P,q])=>e.jsxs(Ki,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:B}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:q},children:P})]},B))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Docs vencidos",g,g>0?"#B91C1C":"#111111"],[" Docs por vencer",S,S>0?"#8C6A00":"#111111"],[" Mantos vencidos",A,A>0?"#B91C1C":"#111111"],[" Costo mantos total",`$${Wt(z)}`,Ke.ink]].map(([B,P,q])=>e.jsxs(Ki,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:B}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:q},children:P})]},B))}),I>0&&e.jsx(Ki,{style:{marginBottom:12,padding:"10px 14px"},children:e.jsxs("div",{style:{fontSize:9,fontWeight:600,color:Ke.inkMid},children:[" Precio promedio/litro: ",e.jsxs("strong",{style:{color:Ke.ink},children:["$",Wt(w/I)]}),"  Litros mes: ",e.jsxs("strong",{children:[rs(I)," L"]})]})}),(g>0||A>0)&&e.jsxs("div",{style:{background:"#FAE8E8",border:"1px solid #B91C1C33",borderRadius:6,padding:"10px 14px",fontSize:10,color:"#B91C1C",fontWeight:600},children:[" ",[g>0&&`${g} documentos vencidos`,A>0&&`${A} mantenimientos vencidos`].filter(Boolean).join("  ")]})]}),m==="vehiculos"&&e.jsx(dm,{vehs:n,setVehs:s}),m==="km"&&e.jsx(cm,{vehs:n,setVehs:s,partes:r,setPartes:a}),m==="combustible"&&e.jsx(pm,{vehs:n,tanqueos:u,setTanqueos:h}),m==="docs"&&e.jsx(um,{vehs:n,docVehs:b,setDocVehs:j}),m==="manto"&&e.jsx(gm,{vehs:n,mantos:C,setMantos:v})]})]})}const fm=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),et={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},hn=()=>Math.random().toString(36).slice(2,10),Co=()=>new Date().toISOString().split("T")[0],yo=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),ur=({children:t,style:i,...o})=>e.jsx("div",{style:{background:et.surface,border:`1px solid ${et.border}`,borderRadius:8,padding:16,boxShadow:et.shadow,...i},...o,children:t}),ao=({children:t,on:i,v:o,style:n,...s})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${et.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?et.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...s,children:t}),hi=({lbl:t,val:i,on:o,ph:n,type:s,style:r,children:a,...u})=>e.jsxs("div",{style:{marginBottom:8,...r},children:[e.jsx("label",{style:{display:"block",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:2},children:t}),a||e.jsx("input",{type:s||"text",value:i,onChange:o,placeholder:n||"",style:{width:"100%",padding:"6px 8px",border:`1px solid ${et.border}`,borderRadius:4,fontSize:11,background:"#fff"},...u})]}),Pa=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),Ti={border:`1px solid ${et.border}`,borderRadius:3,padding:"4px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},hs={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${et.border}`,textAlign:"left"},Rt={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${et.border}`},sd="habitaris_compras",ad=[{id:"dashboard",lbl:" Dashboard"},{id:"oc",lbl:" rdenes de Compra"},{id:"recep",lbl:" Recepcin"},{id:"eval",lbl:" Evaluacin Proveedores"}];function xm({ocs:t,setOCs:i}){var A,E;const[o,n]=F.useState(!1),[s,r]=F.useState(null),[a,u]=F.useState(""),[h,b]=F.useState("todos"),[j,C]=F.useState({proveedor:"",proyecto:"",solicitante:"",fechaEntrega:"",condicionPago:"Contado",observaciones:"",items:[{id:hn(),desc:"",und:"",cant:0,valorUnit:0}]}),v={borrador:{lbl:"Borrador",c:et.inkLight},pendiente:{lbl:"Pendiente",c:et.amber},aprobada:{lbl:"Aprobada",c:et.blue},enviada:{lbl:"Enviada prov.",c:"#5B3A8C"},parcial:{lbl:"Recibida parcial",c:et.amber},completa:{lbl:"Completa",c:et.green},cancelada:{lbl:"Cancelada",c:et.red}},m=["Contado","Crdito 30 das","Crdito 60 das","Anticipo 50%","Contra entrega"],f=()=>{const w=j.items.filter(P=>P.desc.trim()).map(P=>({...P,cant:parseFloat(P.cant)||0,valorUnit:parseFloat(P.valorUnit)||0}));if(!j.proveedor||w.length===0)return;const I=w.reduce((P,q)=>P+q.cant*q.valorUnit,0),z=`OC-${String(t.length+1).padStart(4,"0")}`,B={id:hn(),num:z,...j,items:w,total:I,estado:"borrador",fecha:Co(),historial:[{fecha:Co(),accion:"Creada",usuario:"Admin"}]};i([...t,B]),r(B.id),C({proveedor:"",proyecto:"",solicitante:"",fechaEntrega:"",condicionPago:"Contado",observaciones:"",items:[{id:hn(),desc:"",und:"",cant:0,valorUnit:0}]}),n(!1)},p=(w,I)=>{i(t.map(z=>{var B;return z.id!==w?z:{...z,estado:I,historial:[...z.historial||[],{fecha:Co(),accion:`Estado  ${(B=v[I])==null?void 0:B.lbl}`,usuario:"Admin"}]}}))},c=w=>{i(t.filter(I=>I.id!==w)),s===w&&r(null)},d=()=>C({...j,items:[...j.items,{id:hn(),desc:"",und:"",cant:0,valorUnit:0}]}),l=(w,I,z)=>C({...j,items:j.items.map((B,P)=>P===w?{...B,[I]:z}:B)}),x=w=>C({...j,items:j.items.filter((I,z)=>z!==w)}),y=t.filter(w=>{var z,B,P;if(h!=="todos"&&w.estado!==h)return!1;const I=a.toLowerCase();return!I||((z=w.num)==null?void 0:z.toLowerCase().includes(I))||((B=w.proveedor)==null?void 0:B.toLowerCase().includes(I))||((P=w.proyecto)==null?void 0:P.toLowerCase().includes(I))}),g=t.find(w=>w.id===s),S=t.filter(w=>w.estado==="pendiente").reduce((w,I)=>w+I.total,0);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["rdenes de Compra  ",t.length," OCs"]}),e.jsxs("p",{style:{margin:0,fontSize:10,color:et.inkMid},children:[t.filter(w=>w.estado==="pendiente").length," pendientes  $",yo(S)," por aprobar"]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ki,{size:12,style:{position:"absolute",left:8,top:8,color:et.inkLight}}),e.jsx("input",{value:a,onChange:w=>u(w.target.value),placeholder:"Buscar OC, proveedor...",style:{...Ti,paddingLeft:26,width:200}})]}),e.jsxs(ao,{on:()=>n(!0),children:[e.jsx(Ne,{size:11})," Nueva OC"]})]})]}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:14,flexWrap:"wrap"},children:[["todos","Todos"],...Object.entries(v).map(([w,I])=>[w,I.lbl])].map(([w,I],z,B)=>e.jsxs("button",{onClick:()=>b(w),style:{padding:"5px 12px",fontSize:9,fontWeight:600,cursor:"pointer",border:`1px solid ${et.border}`,borderLeft:z>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",borderRadius:z===0?"5px 0 0 5px":z===B.length-1?"0 5px 5px 0":"0",background:h===w?"#111":"#fff",color:h===w?"#fff":et.inkMid},children:[I," ",e.jsxs("span",{style:{fontSize:7,marginLeft:2},children:["(",t.filter(P=>w==="todos"||P.estado===w).length,")"]})]},w))}),e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsx(ur,{style:{flex:1,padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Nro.","Fecha","Proveedor","Proyecto","tems","Total","Entrega","Estado"].map(w=>e.jsx("th",{style:{...hs,textAlign:w==="Total"?"right":"left"},children:w},w))})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{padding:24,textAlign:"center",color:et.inkLight,fontSize:11},children:"Sin rdenes"})}):y.sort((w,I)=>I.fecha.localeCompare(w.fecha)).map((w,I)=>{var B;const z=v[w.estado]||v.borrador;return e.jsxs("tr",{onClick:()=>r(w.id===s?null:w.id),style:{cursor:"pointer",background:s===w.id?"#F0F0F022":I%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Rt,fontFamily:"'DM Mono',monospace",fontWeight:700,color:et.blue},children:w.num}),e.jsx("td",{style:{...Rt,fontFamily:"'DM Mono',monospace",fontSize:9},children:w.fecha}),e.jsx("td",{style:{...Rt,fontWeight:600},children:w.proveedor}),e.jsx("td",{style:{...Rt,fontSize:9,color:et.inkMid},children:w.proyecto||""}),e.jsx("td",{style:{...Rt,fontSize:9},children:((B=w.items)==null?void 0:B.length)||0}),e.jsxs("td",{style:{...Rt,textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700},children:["$",yo(w.total)]}),e.jsx("td",{style:{...Rt,fontFamily:"'DM Mono',monospace",fontSize:9},children:w.fechaEntrega||""}),e.jsx("td",{style:Rt,children:e.jsx(Pa,{color:z.c,children:z.lbl})})]},w.id)})})]})}),g&&e.jsxs(ur,{style:{width:360,flexShrink:0,padding:0,overflow:"hidden",alignSelf:"flex-start"},children:[e.jsxs("div",{style:{padding:"12px 14px",background:"#EDEBE7"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:g.num}),e.jsx("button",{onClick:()=>c(g.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:12})})]}),e.jsxs("div",{style:{fontSize:9,color:et.inkMid,marginTop:2},children:[g.proveedor,"  ",g.proyecto||"Sin proyecto","  ",g.fecha]})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:`1px solid ${et.border}`,display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:9,fontWeight:600,color:et.inkMid},children:"Estado:"}),e.jsx("select",{value:g.estado,onChange:w=>p(g.id,w.target.value),style:{fontSize:9,fontWeight:700,padding:"3px 8px",borderRadius:10,border:"none",cursor:"pointer",background:(((A=v[g.estado])==null?void 0:A.c)||et.inkLight)+"22",color:((E=v[g.estado])==null?void 0:E.c)||et.inkLight},children:Object.entries(v).map(([w,I])=>e.jsx("option",{value:w,children:I.lbl},w))})]}),e.jsxs("div",{style:{padding:"8px 14px",borderBottom:`1px solid ${et.border}`,fontSize:9},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Solicitante:"})," ",g.solicitante||""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Condicin pago:"})," ",g.condicionPago]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Entrega esperada:"})," ",g.fechaEntrega||""]}),g.observaciones&&e.jsx("div",{style:{marginTop:4,color:et.inkMid},children:g.observaciones})]}),e.jsxs("div",{style:{padding:"6px 0"},children:[e.jsx("div",{style:{padding:"0 14px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"tems"}),(g.items||[]).map((w,I)=>e.jsxs("div",{style:{padding:"4px 14px",borderBottom:`1px solid ${et.border}`,display:"flex",justifyContent:"space-between",fontSize:9},children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[w.cant," ",w.und]}),"  ",w.desc]}),e.jsxs("div",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700},children:["$",yo(w.cant*w.valorUnit)]})]},w.id||I)),e.jsxs("div",{style:{padding:"6px 14px",display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:11,borderTop:`2px solid ${et.ink}`},children:[e.jsx("span",{children:"TOTAL"}),e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace"},children:["$",yo(g.total)]})]})]}),(g.historial||[]).length>0&&e.jsxs("div",{style:{padding:"8px 14px",borderTop:`1px solid ${et.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"Historial"}),g.historial.map((w,I)=>e.jsxs("div",{style:{fontSize:8,color:et.inkMid,marginBottom:2},children:[w.fecha,"  ",w.accion]},I))]})]})]}),o&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>n(!1),children:e.jsxs("div",{onClick:w=>w.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:600,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Nueva Orden de Compra"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(hi,{lbl:"Proveedor",val:j.proveedor,on:w=>C({...j,proveedor:w.target.value}),ph:"Nombre proveedor",style:{flex:1}}),e.jsx(hi,{lbl:"Proyecto",val:j.proyecto,on:w=>C({...j,proyecto:w.target.value}),ph:"Obra / proyecto",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(hi,{lbl:"Solicitante",val:j.solicitante,on:w=>C({...j,solicitante:w.target.value}),ph:"Quien solicita",style:{flex:1}}),e.jsx(hi,{lbl:"Fecha entrega",val:j.fechaEntrega,on:w=>C({...j,fechaEntrega:w.target.value}),type:"date",style:{flex:1}}),e.jsx(hi,{lbl:"Condicin pago",style:{flex:1},children:e.jsx("select",{value:j.condicionPago,onChange:w=>C({...j,condicionPago:w.target.value}),style:{...Ti,width:"100%"},children:m.map(w=>e.jsx("option",{children:w},w))})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"tems"}),e.jsx("button",{onClick:d,style:{fontSize:9,color:et.blue,background:"none",border:"none",cursor:"pointer",fontWeight:600,fontFamily:"'DM Sans',sans-serif"},children:"+ Aadir lnea"})]}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Descripcin","Und","Cant","Valor unit.","Subtotal",""].map(w=>e.jsx("th",{style:{padding:"3px 4px",fontSize:7,fontWeight:700,color:"#888",textAlign:["Cant","Valor unit.","Subtotal"].includes(w)?"right":"left",borderBottom:`1px solid ${et.border}`},children:w},w))})}),e.jsx("tbody",{children:j.items.map((w,I)=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"2px 2px"},children:e.jsx("input",{value:w.desc,onChange:z=>l(I,"desc",z.target.value),placeholder:"Material o servicio",style:{...Ti,width:"100%",fontSize:10}})}),e.jsx("td",{style:{padding:"2px 2px",width:50},children:e.jsx("input",{value:w.und,onChange:z=>l(I,"und",z.target.value),placeholder:"m",style:{...Ti,width:"100%",fontSize:10,textAlign:"center"}})}),e.jsx("td",{style:{padding:"2px 2px",width:65},children:e.jsx("input",{type:"number",value:w.cant,onChange:z=>l(I,"cant",z.target.value),style:{...Ti,width:"100%",fontSize:10,textAlign:"right"}})}),e.jsx("td",{style:{padding:"2px 2px",width:90},children:e.jsx("input",{type:"number",value:w.valorUnit,onChange:z=>l(I,"valorUnit",z.target.value),style:{...Ti,width:"100%",fontSize:10,textAlign:"right"}})}),e.jsxs("td",{style:{padding:"2px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,width:90},children:["$",yo((parseFloat(w.cant)||0)*(parseFloat(w.valorUnit)||0))]}),e.jsx("td",{style:{padding:"2px",width:20},children:j.items.length>1&&e.jsx("button",{onClick:()=>x(I),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:9})})})]},w.id))})]}),e.jsxs("div",{style:{textAlign:"right",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:12,marginTop:6},children:["Total: $",yo(j.items.reduce((w,I)=>w+(parseFloat(I.cant)||0)*(parseFloat(I.valorUnit)||0),0))]})]}),e.jsx(hi,{lbl:"Observaciones",val:j.observaciones,on:w=>C({...j,observaciones:w.target.value}),ph:"Notas adicionales"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ao,{on:f,style:{flex:1},children:[e.jsx(yt,{size:11})," Crear OC"]}),e.jsx(ao,{v:"sec",on:()=>n(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function mm({ocs:t,setOCs:i,recepciones:o,setRecepciones:n}){const[s,r]=F.useState(!1),[a,u]=F.useState(""),[h,b]=F.useState({ocId:"",fecha:Co(),recibidoPor:"",observaciones:"",items:[]}),j=t.filter(m=>["aprobada","enviada","parcial"].includes(m.estado)),C=m=>{const f=t.find(d=>d.id===m);if(!f)return;const p={};o.filter(d=>d.ocId===m).forEach(d=>{(d.items||[]).forEach(l=>{p[l.itemId]=(p[l.itemId]||0)+(l.cantRecibida||0)})});const c=(f.items||[]).map(d=>({itemId:d.id,desc:d.desc,und:d.und,cantOC:d.cant,cantYaRecibida:p[d.id]||0,cantRecibida:0,conforme:!0,observacion:""}));b({ocId:m,fecha:Co(),recibidoPor:"",observaciones:"",items:c}),u(m)},v=()=>{if(!h.ocId||h.items.every(p=>(parseFloat(p.cantRecibida)||0)===0))return;const m={id:hn(),...h,items:h.items.map(p=>({...p,cantRecibida:parseFloat(p.cantRecibida)||0}))};n([...o,m]);const f=t.find(p=>p.id===h.ocId);if(f){const p={};[...o.filter(d=>d.ocId===h.ocId),m].forEach(d=>{(d.items||[]).forEach(l=>{p[l.itemId]=(p[l.itemId]||0)+l.cantRecibida})});const c=(f.items||[]).every(d=>(p[d.id]||0)>=d.cant);i(t.map(d=>d.id===h.ocId?{...d,estado:c?"completa":"parcial",historial:[...d.historial||[],{fecha:Co(),accion:c?"Recepcin completa":"Recepcin parcial",usuario:h.recibidoPor||"Admin"}]}:d))}b({ocId:"",fecha:Co(),recibidoPor:"",observaciones:"",items:[]}),r(!1)};return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Recepcin de mercanca"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:et.inkMid},children:[o.length," recepciones  ",j.length," OCs pendientes"]})]}),e.jsxs(ao,{on:()=>r(!0),children:[e.jsx(Ne,{size:11})," Nueva recepcin"]})]}),e.jsx(ur,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#EDEBE7"},children:["Fecha","OC","Proveedor","Recibido por","tems","Conformes","Observaciones"].map(m=>e.jsx("th",{style:hs,children:m},m))})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:24,textAlign:"center",color:et.inkLight,fontSize:11},children:"Sin recepciones"})}):o.sort((m,f)=>f.fecha.localeCompare(m.fecha)).map((m,f)=>{const p=t.find(l=>l.id===m.ocId),c=(m.items||[]).filter(l=>l.cantRecibida>0).length,d=(m.items||[]).filter(l=>l.cantRecibida>0&&l.conforme).length;return e.jsxs("tr",{style:{background:f%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Rt,fontFamily:"'DM Mono',monospace"},children:m.fecha}),e.jsx("td",{style:{...Rt,fontFamily:"'DM Mono',monospace",fontWeight:700,color:et.blue},children:(p==null?void 0:p.num)||""}),e.jsx("td",{style:{...Rt,fontWeight:600},children:(p==null?void 0:p.proveedor)||""}),e.jsx("td",{style:{...Rt,fontSize:9},children:m.recibidoPor||""}),e.jsx("td",{style:{...Rt,fontSize:9},children:c}),e.jsx("td",{style:Rt,children:d===c?e.jsx(Pa,{color:et.green,children:" Todo conforme"}):e.jsxs(Pa,{color:et.red,children:[d,"/",c," conformes"]})}),e.jsx("td",{style:{...Rt,fontSize:8,color:et.inkMid,maxWidth:150,overflow:"hidden",textOverflow:"ellipsis"},children:m.observaciones||""})]},m.id)})})]})}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:m=>m.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:650,maxHeight:"90vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Recepcin de mercanca"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(hi,{lbl:"Orden de compra",style:{flex:1},children:e.jsxs("select",{value:h.ocId,onChange:m=>C(m.target.value),style:{...Ti,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar OC "}),j.map(m=>e.jsxs("option",{value:m.id,children:[m.num,"  ",m.proveedor," ($",yo(m.total),")"]},m.id))]})}),e.jsx(hi,{lbl:"Fecha",val:h.fecha,on:m=>b({...h,fecha:m.target.value}),type:"date",style:{flex:"0 0 140px"}}),e.jsx(hi,{lbl:"Recibido por",val:h.recibidoPor,on:m=>b({...h,recibidoPor:m.target.value}),ph:"Almacenista",style:{flex:1}})]}),h.items.length>0&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:6},children:"tems de la OC"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Descripcin","Und","Pedido","Ya recibido","Recibir ahora","Conforme?","Obs."].map(m=>e.jsx("th",{style:{padding:"3px 6px",fontSize:7,fontWeight:700,color:"#888",textAlign:["Pedido","Ya recibido","Recibir ahora"].includes(m)?"right":"left",borderBottom:`1px solid ${et.border}`},children:m},m))})}),e.jsx("tbody",{children:h.items.map((m,f)=>{const p=m.cantOC-m.cantYaRecibida;return e.jsxs("tr",{style:{borderBottom:`1px solid ${et.border}`,background:f%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{padding:"4px 6px",fontSize:10},children:m.desc}),e.jsx("td",{style:{padding:"4px 6px",fontSize:9,textAlign:"center"},children:m.und}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10},children:m.cantOC}),e.jsx("td",{style:{padding:"4px 6px",textAlign:"right",fontFamily:"'DM Mono',monospace",fontSize:10,color:et.inkMid},children:m.cantYaRecibida}),e.jsx("td",{style:{padding:"2px 4px",width:80},children:e.jsx("input",{type:"number",value:m.cantRecibida,max:p,onChange:c=>b({...h,items:h.items.map((d,l)=>l===f?{...d,cantRecibida:c.target.value}:d)}),style:{...Ti,width:"100%",textAlign:"right",fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:et.green}})}),e.jsx("td",{style:{padding:"2px 4px",textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:m.conforme,onChange:c=>b({...h,items:h.items.map((d,l)=>l===f?{...d,conforme:c.target.checked}:d)})})}),e.jsx("td",{style:{padding:"2px 4px",width:100},children:e.jsx("input",{value:m.observacion||"",placeholder:"Nota",onChange:c=>b({...h,items:h.items.map((d,l)=>l===f?{...d,observacion:c.target.value}:d)}),style:{...Ti,width:"100%",fontSize:8}})})]},m.itemId)})})]})]}),e.jsx(hi,{lbl:"Observaciones generales",val:h.observaciones,on:m=>b({...h,observaciones:m.target.value}),ph:"Notas sobre la recepcin"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ao,{on:v,style:{flex:1},children:[e.jsx(yt,{size:11})," Registrar recepcin"]}),e.jsx(ao,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function bm({ocs:t,recepciones:i,evaluaciones:o,setEvaluaciones:n}){const[s,r]=F.useState(!1),[a,u]=F.useState({proveedor:"",periodo:"",calidad:5,puntualidad:5,precio:5,comunicacion:5,documentacion:5,observaciones:""}),h=[{id:"calidad",lbl:"Calidad del material/servicio",icon:""},{id:"puntualidad",lbl:"Puntualidad en entregas",icon:""},{id:"precio",lbl:"Competitividad de precios",icon:""},{id:"comunicacion",lbl:"Comunicacin y respuesta",icon:""},{id:"documentacion",lbl:"Documentacin y facturacin",icon:""}],b=()=>{if(!a.proveedor)return;const c=(a.calidad+a.puntualidad+a.precio+a.comunicacion+a.documentacion)/5;n([...o,{id:hn(),...a,promedio:Math.round(c*10)/10,fecha:Co()}]),u({proveedor:"",periodo:"",calidad:5,puntualidad:5,precio:5,comunicacion:5,documentacion:5,observaciones:""}),r(!1)},j=c=>n(o.filter(d=>d.id!==c)),C=[...new Set(t.map(c=>c.proveedor).filter(Boolean))],v={};o.forEach(c=>{v[c.proveedor]||(v[c.proveedor]={evals:[],sum:0}),v[c.proveedor].evals.push(c),v[c.proveedor].sum+=c.promedio});const m=Object.entries(v).map(([c,d])=>({prov:c,count:d.evals.length,promedio:Math.round(d.sum/d.evals.length*10)/10,last:d.evals.sort((l,x)=>x.fecha.localeCompare(l.fecha))[0]})).sort((c,d)=>d.promedio-c.promedio),f=c=>c>=8?et.green:c>=5?et.amber:et.red,p=({val:c,max:d=10})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{width:80,height:6,background:"#E0E0E0",borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{width:`${c/d*100}%`,height:"100%",background:f(c),borderRadius:3}})}),e.jsx("span",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:f(c)},children:c})]});return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:"Evaluacin de proveedores"}),e.jsxs("p",{style:{margin:0,fontSize:10,color:et.inkMid},children:[o.length," evaluaciones  ",m.length," proveedores calificados"]})]}),e.jsxs(ao,{on:()=>r(!0),children:[e.jsx(Ne,{size:11})," Evaluar"]})]}),m.length>0&&e.jsxs(ur,{style:{padding:0,overflow:"hidden",marginBottom:16},children:[e.jsx("div",{style:{padding:"8px 14px",background:"#EDEBE7",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:" Ranking general"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["#","Proveedor","Evaluaciones","Promedio","Tendencia"].map(c=>e.jsx("th",{style:{...hs,textAlign:c==="#"?"center":"left"},children:c},c))})}),e.jsx("tbody",{children:m.map((c,d)=>{var l;return e.jsxs("tr",{style:{background:d%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Rt,textAlign:"center",fontWeight:800,fontSize:12,color:d===0?"#D4A700":d===1?"#888":d===2?"#A0522D":et.ink},children:d===0?"":d===1?"":d===2?"":d+1}),e.jsx("td",{style:{...Rt,fontWeight:700},children:c.prov}),e.jsxs("td",{style:{...Rt,fontSize:9},children:[c.count," eval",c.count>1?"s":""]}),e.jsx("td",{style:Rt,children:e.jsx(p,{val:c.promedio})}),e.jsxs("td",{style:{...Rt,fontSize:9,color:et.inkMid},children:["ltima: ",(l=c.last)==null?void 0:l.fecha]})]},c.prov)})})]})]}),e.jsxs(ur,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"8px 14px",background:"#F5F4F1",fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:1},children:"Historial de evaluaciones"}),e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Fecha","Proveedor","Perodo","Calidad","Puntualidad","Precio","Comun.","Doc.","Promedio",""].map(c=>e.jsx("th",{style:{...hs,textAlign:["Calidad","Puntualidad","Precio","Comun.","Doc.","Promedio"].includes(c)?"center":"left"},children:c},c))})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:24,textAlign:"center",color:et.inkLight,fontSize:11},children:"Sin evaluaciones"})}):o.sort((c,d)=>d.fecha.localeCompare(c.fecha)).map((c,d)=>e.jsxs("tr",{style:{background:d%2?"#FFFFFF":"#fff"},children:[e.jsx("td",{style:{...Rt,fontFamily:"'DM Mono',monospace",fontSize:9},children:c.fecha}),e.jsx("td",{style:{...Rt,fontWeight:600},children:c.proveedor}),e.jsx("td",{style:{...Rt,fontSize:9},children:c.periodo||""}),["calidad","puntualidad","precio","comunicacion","documentacion"].map(l=>e.jsx("td",{style:{...Rt,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:f(c[l])},children:c[l]},l)),e.jsx("td",{style:{...Rt,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:12,color:f(c.promedio)},children:c.promedio}),e.jsx("td",{style:Rt,children:e.jsx("button",{onClick:()=>j(c.id),style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:10})})})]},c.id))})]})]}),s&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{onClick:c=>c.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:24,width:480,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700,marginBottom:14},children:"Evaluar proveedor"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs(hi,{lbl:"Proveedor",style:{flex:1},children:[e.jsxs("select",{value:a.proveedor,onChange:c=>u({...a,proveedor:c.target.value}),style:{...Ti,width:"100%"},children:[e.jsx("option",{value:"",children:" Seleccionar "}),C.map(c=>e.jsx("option",{children:c},c)),e.jsx("option",{value:"__otro",children:"+ Otro..."})]}),a.proveedor==="__otro"&&e.jsx("input",{value:"",onChange:c=>u({...a,proveedor:c.target.value}),placeholder:"Nombre proveedor",style:{...Ti,width:"100%",marginTop:4}})]}),e.jsx(hi,{lbl:"Perodo",val:a.periodo,on:c=>u({...a,periodo:c.target.value}),ph:"Ene-Mar 2026",style:{flex:1}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:8},children:"Calificacin (1-10)"}),h.map(c=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[e.jsxs("div",{style:{width:180,fontSize:10},children:[c.icon," ",c.lbl]}),e.jsx("input",{type:"range",min:"1",max:"10",value:a[c.id],onChange:d=>u({...a,[c.id]:parseInt(d.target.value)}),style:{flex:1,accentColor:f(a[c.id])}}),e.jsx("div",{style:{width:28,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:800,fontSize:14,color:f(a[c.id])},children:a[c.id]})]},c.id)),e.jsxs("div",{style:{textAlign:"right",fontSize:12,fontWeight:800,fontFamily:"'DM Mono',monospace",color:f((a.calidad+a.puntualidad+a.precio+a.comunicacion+a.documentacion)/5),marginTop:4},children:["Promedio: ",((a.calidad+a.puntualidad+a.precio+a.comunicacion+a.documentacion)/5).toFixed(1)]})]}),e.jsx(hi,{lbl:"Observaciones",val:a.observaciones,on:c=>u({...a,observaciones:c.target.value}),ph:"Notas sobre desempeo"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsxs(ao,{on:b,style:{flex:1},children:[e.jsx(yt,{size:11})," Guardar evaluacin"]}),e.jsx(ao,{v:"sec",on:()=>r(!1),style:{flex:1},children:"Cancelar"})]})]})})]})}function ym(){const[t,i]=F.useState({});useEffect(()=>{Fe.get(sd).then(p=>{try{p&&i(JSON.parse(p))}catch{}}).catch(()=>{})},[]);const o=(p,c)=>i(d=>{const l={...d,[p]:typeof c=="function"?c(d[p]):c};return Fe.set(sd,JSON.stringify(l)),l}),n=t.ocs||[],s=p=>o("ocs",typeof p=="function"?p(n):p),r=t.recepciones||[],a=p=>o("recepciones",typeof p=="function"?p(r):p),u=t.evaluaciones||[],h=p=>o("evaluaciones",typeof p=="function"?p(u):p),[b,j]=F.useState("dashboard"),C=n.filter(p=>p.estado==="pendiente"),v=n.filter(p=>p.estado==="completa"),m=n.filter(p=>p.estado!=="cancelada").reduce((p,c)=>p+c.total,0),f=u.length>0?u.reduce((p,c)=>p+c.promedio,0)/u.length:0;return e.jsxs(e.Fragment,{children:[e.jsx(fm,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Compras"}),e.jsx("div",{style:{fontSize:10,color:et.inkMid},children:"rdenes de compra  Recepcin  Evaluacin proveedores"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:ad.map((p,c)=>e.jsx("button",{onClick:()=>j(p.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${et.border}`,borderLeft:c>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:c===0?"6px 0 0 6px":c===ad.length-1?"0 6px 6px 0":"0",background:b===p.id?"#111":"#fff",color:b===p.id?"#fff":et.inkMid},children:p.lbl},p.id))}),b==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:[[" Total OCs",n.length,"#111"],[" Pendientes",C.length,C.length>0?"#8C6A00":"#111111"],[" Completas",v.length,"#111111"],[" Valor total",`$${yo(m)}`,"#111"]].map(([p,c,d])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${et.border}`,borderRadius:8,padding:"14px 16px",boxShadow:et.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:d},children:c})]},p))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12,marginBottom:16},children:[[" Recepciones",r.length,"#3B3B3B"],[" Evaluaciones",u.length,"#111"],[" Nota media proveedores",f>0?f.toFixed(1):"",f>=8?"#111111":f>=5?"#8C6A00":"#B91C1C"]].map(([p,c,d])=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${et.border}`,borderRadius:8,padding:"14px 16px",boxShadow:et.shadow},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:p}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:d},children:c})]},p))})]}),b==="oc"&&e.jsx(xm,{ocs:n,setOCs:s}),b==="recep"&&e.jsx(mm,{ocs:n,setOCs:s,recepciones:r,setRecepciones:a}),b==="eval"&&e.jsx(bm,{ocs:n,recepciones:r,evaluaciones:u,setEvaluaciones:h})]})]})}const vm=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),Re={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#5B3A8C",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},Et=t=>new Intl.NumberFormat("es-CO",{maximumFractionDigits:0}).format(t||0),jm=()=>new Date().toISOString().split("T")[0],xo=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Re.surface,border:`1px solid ${Re.border}`,borderRadius:8,padding:16,boxShadow:Re.shadow,...i},...o,children:t}),da=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),ca=[{id:"general",lbl:" General",color:Re.ink},{id:"proyectos",lbl:" Proyectos",color:"#5B3A8C"},{id:"admin",lbl:" Administracin",color:"#6B5B8C"},{id:"compras",lbl:" Compras",color:"#0D5E6E"},{id:"flotas",lbl:" Flotas",color:"#2E5E4E"},{id:"rrhh",lbl:" RRHH",color:"#3B3B3B"},{id:"crm",lbl:" CRM / Ofertas",color:"#111111"},{id:"formularios",lbl:" Formularios",color:"#5B3A8C"}],rn=t=>{try{const i=Fe.getSync(t);return i?JSON.parse(i):{}}catch{return{}}};function Sm(){return F.useMemo(()=>{const t=rn("habitaris_crm"),i=rn("habitaris_admin"),o=rn("habitaris_flotas"),n=rn("habitaris_compras"),s=jm(),r=i.adm_cajas||[],a=i.adm_tarjeta||[],u=i.adm_viaticos||[],h=i.adm_flujo||[],b=i.adm_cuentas||[],j=r.reduce((_,ae)=>{const Be=ae.movimientos||[];return _+(ae.fondoInicial||0)+Be.reduce((Q,me)=>Q+(me.tipo==="entrada"?me.monto:-me.monto),0)},0),C=a.filter(_=>_.estado==="pendiente"),v=u.filter(_=>_.estado==="solicitado"||_.estado==="aprobado"),m=(()=>{const _=new Date,ae=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}`,Be=h.filter(le=>{var be;return(be=le.fecha)==null?void 0:be.startsWith(ae)}),Q=Be.filter(le=>le.tipo==="ingreso").reduce((le,be)=>le+be.monto,0),me=Be.filter(le=>le.tipo==="egreso").reduce((le,be)=>le+be.monto,0);return{ing:Q,egr:me,neto:Q-me}})(),f=b.filter(_=>_.tipo==="cobrar"),p=b.filter(_=>_.tipo==="pagar"),c=f.filter(_=>_.estado==="vigente").reduce((_,ae)=>_+ae.monto,0),d=f.filter(_=>_.estado==="vencida").reduce((_,ae)=>_+ae.monto,0),l=p.filter(_=>_.estado==="vigente").reduce((_,ae)=>_+ae.monto,0),x=p.filter(_=>_.estado==="vencida").reduce((_,ae)=>_+ae.monto,0),y=n.ocs||[],g=n.recepciones||[],S=n.evaluaciones||[],A=y.filter(_=>_.estado==="pendiente"),E=y.filter(_=>_.estado==="enviada"||_.estado==="parcial"),w=y.filter(_=>_.estado!=="cancelada").reduce((_,ae)=>_+ae.total,0),I=o.vehiculos||[];o.partesKm;const z=o.tanqueos||[],B=o.docVehs||[],P=o.mantos||[],q=I.filter(_=>_.estado==="activo").length,U=I.filter(_=>_.estado==="taller").length,$=B.filter(_=>_.fechaVence&&_.fechaVence<s),Y=P.filter(_=>_.estado==="programado"&&_.fechaProg&&_.fechaProg<s),ge=new Date;ge.setDate(ge.getDate()+30);const J=ge.toISOString().split("T")[0],ye=B.filter(_=>_.fechaVence&&_.fechaVence>=s&&_.fechaVence<=J),oe=(()=>{const _=new Date,ae=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}`;return z.filter(Be=>{var Q;return(Q=Be.fecha)==null?void 0:Q.startsWith(ae)}).reduce((Be,Q)=>Be+Q.valorTotal,0)})(),L=t.deals||[],R=L.filter(_=>_.estado==="Ganada"),T=R.reduce((_,ae)=>_+(ae.presupuestoFinal||ae.presupuesto||0),0),W=L.filter(_=>["Contacto","Visita","Propuesta","Negociacin"].includes(_.estado)),X=W.reduce((_,ae)=>_+(ae.presupuesto||0),0),M=rn("habitaris_proy"),O=M["hab:proyectos:lista"]||[],ne=M["hab:proyectos:actividades"]||[],ie=M["hab:proyectos:hitos"]||[],re=O.filter(_=>_.estado==="activo"),H=O.filter(_=>_.estado==="completado"),se=re.map(_=>{const ae=ne.filter(Q=>Q.proyectoId===_.id),Be=ae.length>0?ae.reduce((Q,me)=>Q+(me.avance||0),0)/ae.length:0;return{id:_.id,nombre:_.nombre,avance:Math.round(Be),acts:ae.length,fin:_.fin}}),N=se.length>0?Math.round(se.reduce((_,ae)=>_+ae.avance,0)/se.length):0,G=ie.filter(_=>_.completado).length,ue=ie.filter(_=>!_.completado).length,he=se.filter(_=>{if(!_.fin)return!1;const ae=Math.round((new Date(_.fin)-new Date)/864e5);return ae<0||ae<30&&_.avance<70}),Ve=rn("habitaris_formularios").forms||[],Ee=[];Fe.listSync("hab:briefing:").items.forEach(_=>{try{Ee.push(JSON.parse(_.value))}catch{}});const V=[],te=Ee.filter(_=>!V.includes(_.id)),ce={};te.forEach(_=>{const ae=Ve.find(Q=>Q.id===_.formularioId),Be=(ae==null?void 0:ae.modulo)||"general";ce[Be]||(ce[Be]=[]),ce[Be].push({..._,_formNombre:(ae==null?void 0:ae.nombre)||_.formularioNombre||"Formulario"})});const pe=[];return Object.entries(ce).forEach(([_,ae])=>{const Be=_==="crm"?"CRM":_==="sst"?"SST":_.charAt(0).toUpperCase()+_.slice(1);pe.push({mod:_,sev:"alta",icon:"",msg:`${ae.length} formulario${ae.length>1?"s":""} sin asignar en ${Be}`,color:Re.purple,isForm:!0,count:ae.length})}),d>0&&pe.push({mod:"admin",sev:"alta",icon:"",msg:`${f.filter(_=>_.estado==="vencida").length} CxC vencidas por $${Et(d)}`,color:Re.red}),x>0&&pe.push({mod:"admin",sev:"alta",icon:"",msg:`${p.filter(_=>_.estado==="vencida").length} CxP vencidas por $${Et(x)}`,color:Re.red}),C.length>0&&pe.push({mod:"admin",sev:"media",icon:"",msg:`${C.length} legalizaciones tarjeta pendientes ($${Et(C.reduce((_,ae)=>_+ae.monto,0))})`,color:Re.amber}),v.length>0&&pe.push({mod:"admin",sev:"media",icon:"",msg:`${v.length} solicitudes viticos pendientes`,color:Re.amber}),m.neto<0&&pe.push({mod:"admin",sev:"alta",icon:"",msg:`Flujo caja negativo este mes: $${Et(m.neto)}`,color:Re.red}),$.length>0&&pe.push({mod:"flotas",sev:"alta",icon:"",msg:`${$.length} documentos vehiculares vencidos`,color:Re.red}),ye.length>0&&pe.push({mod:"flotas",sev:"media",icon:"",msg:`${ye.length} documentos por vencer en 30 das`,color:Re.amber}),Y.length>0&&pe.push({mod:"flotas",sev:"alta",icon:"",msg:`${Y.length} mantenimientos vencidos`,color:Re.red}),U>0&&pe.push({mod:"flotas",sev:"baja",icon:"",msg:`${U} vehculos en taller`,color:Re.blue}),A.length>0&&pe.push({mod:"compras",sev:"media",icon:"",msg:`${A.length} OCs pendientes de aprobacin ($${Et(A.reduce((_,ae)=>_+ae.total,0))})`,color:Re.amber}),E.length>0&&pe.push({mod:"compras",sev:"baja",icon:"",msg:`${E.length} OCs esperando recepcin`,color:Re.blue}),he.length>0&&pe.push({mod:"proyectos",sev:"alta",icon:"",msg:`${he.length} proyecto${he.length>1?"s":""} con retraso: ${he.map(_=>_.nombre).join(", ")}`,color:Re.red}),ue>0&&pe.push({mod:"proyectos",sev:"baja",icon:"",msg:`${ue} hito${ue>1?"s":""} pendiente${ue>1?"s":""}`,color:Re.blue}),{admin:{saldoCajas:j,tarjetaPend:C.length,viaticosPend:v.length,flujoMes:m,cxcVigente:c,cxcVencida:d,cxpVigente:l,cxpVencida:x},compras:{total:y.length,pendientes:A.length,totalCompras:w,recepciones:g.length,evals:S.length},flotas:{total:I.length,activos:q,taller:U,docsVencidos:$.length,docsPorVencer:ye.length,mantosVencidos:Y.length,gastoCombustible:oe},crm:{deals:L.length,ganados:R.length,totalVentas:T,pipeline:X,enCurso:W.length},proyectos:{total:O.length,activos:re.length,completados:H.length,avancePromedio:N,actividades:ne.length,hitosCompletos:G,hitosPendientes:ue,retrasados:he.length,avancesProy:se},formularios:{total:Ee.length,sinProcesar:te.length,sinProcesarPorModulo:ce},alertas:pe}},[])}function Cm(){var p;const[t,i]=F.useState("general"),o=Sm(),n=t==="general"?o.alertas:o.alertas.filter(c=>c.mod===t),s=n.filter(c=>c.sev==="alta"),r=({icon:c,label:d,value:l,sub:x,color:y,trend:g})=>e.jsx(xo,{style:{padding:"14px 16px",minWidth:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:[c," ",d]}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:y||Re.ink},children:l}),x&&e.jsx("div",{style:{fontSize:9,color:Re.inkMid,marginTop:2},children:x})]}),g&&e.jsxs("div",{style:{fontSize:9,fontWeight:700,color:g>=0?Re.green:Re.red,display:"flex",alignItems:"center",gap:2},children:[g>=0?e.jsx(Yi,{size:10}):e.jsx(Hc,{size:10})," ",g>=0?"+":"",g,"%"]})]})}),a=()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Ventas (ganadas)",value:`$${Et(o.crm.totalVentas)}`,sub:`${o.crm.ganados} proyectos ganados`,color:Re.green}),e.jsx(r,{icon:"",label:"Pipeline activo",value:`$${Et(o.crm.pipeline)}`,sub:`${o.crm.enCurso} oportunidades`,color:Re.blue}),e.jsx(r,{icon:"",label:"Flujo caja mes",value:`$${Et(o.admin.flujoMes.neto)}`,sub:`Ing: $${Et(o.admin.flujoMes.ing)}  Egr: $${Et(o.admin.flujoMes.egr)}`,color:o.admin.flujoMes.neto>=0?Re.green:Re.red}),e.jsx(r,{icon:"",label:"Compras activas",value:`$${Et(o.compras.totalCompras)}`,sub:`${o.compras.total} OCs  ${o.compras.pendientes} pendientes`,color:Re.ink})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"CxC vigentes",value:`$${Et(o.admin.cxcVigente)}`,sub:o.admin.cxcVencida>0?` $${Et(o.admin.cxcVencida)} vencidas`:"",color:Re.blue}),e.jsx(r,{icon:"",label:"CxP vigentes",value:`$${Et(o.admin.cxpVigente)}`,sub:o.admin.cxpVencida>0?` $${Et(o.admin.cxpVencida)} vencidas`:"",color:Re.red}),e.jsx(r,{icon:"",label:"Flota",value:`${o.flotas.activos}/${o.flotas.total}`,sub:`${o.flotas.taller} en taller  $${Et(o.flotas.gastoCombustible)} combustible/mes`,color:Re.ink}),e.jsx(r,{icon:"",label:"Saldo cajas chicas",value:`$${Et(o.admin.saldoCajas)}`,sub:`${o.admin.tarjetaPend} legaliz. pend.`,color:o.admin.saldoCajas>=0?Re.green:Re.red})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Proyectos activos",value:o.proyectos.activos,sub:`${o.proyectos.total} total  ${o.proyectos.completados} completados`,color:Re.ink}),e.jsx(r,{icon:"",label:"Avance promedio",value:`${o.proyectos.avancePromedio}%`,color:o.proyectos.avancePromedio>=70?Re.green:o.proyectos.avancePromedio>=40?Re.amber:Re.red}),e.jsx(r,{icon:"",label:"Retrasados",value:o.proyectos.retrasados,color:o.proyectos.retrasados>0?Re.red:Re.green}),e.jsx(r,{icon:"",label:"Formularios sin asignar",value:o.formularios.sinProcesar,color:o.formularios.sinProcesar>0?Re.purple:Re.green,sub:o.formularios.sinProcesar>0?Object.entries(o.formularios.sinProcesarPorModulo).map(([c,d])=>`${c}: ${d.length}`).join("  "):"Todo al da"})]}),o.formularios.sinProcesar>0&&e.jsx(xo,{style:{padding:"14px 18px",marginBottom:20,background:"#F3EEFF",border:"1px solid #5B3A8C33"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"#5B3A8C",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,flexShrink:0},children:o.formularios.sinProcesar}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#5B3A8C"},children:" Formularios sin asignar"}),e.jsxs("div",{style:{fontSize:10,color:"#7A5AAA",marginTop:2},children:[Object.entries(o.formularios.sinProcesarPorModulo).map(([c,d])=>{const l=c==="crm"?"CRM/Ofertas":c==="sst"?"SST":c.charAt(0).toUpperCase()+c.slice(1);return`${d.length} en ${l}`}).join("  "),"  ","Ve a ",e.jsx("strong",{children:"Formularios  Respuestas"})," para procesar"]})]})]})})]}),f={general:a,admin:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Saldo cajas chicas",value:`$${Et(o.admin.saldoCajas)}`,color:o.admin.saldoCajas>=0?Re.green:Re.red}),e.jsx(r,{icon:"",label:"Legaliz. pendientes",value:o.admin.tarjetaPend,color:o.admin.tarjetaPend>0?Re.amber:Re.green}),e.jsx(r,{icon:"",label:"Viticos pendientes",value:o.admin.viaticosPend,color:o.admin.viaticosPend>0?Re.amber:Re.green}),e.jsx(r,{icon:"",label:"Flujo neto mes",value:`$${Et(o.admin.flujoMes.neto)}`,color:o.admin.flujoMes.neto>=0?Re.green:Re.red})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"CxC vigentes",value:`$${Et(o.admin.cxcVigente)}`,color:Re.blue}),e.jsx(r,{icon:"",label:"CxC vencidas",value:`$${Et(o.admin.cxcVencida)}`,color:o.admin.cxcVencida>0?Re.red:Re.green}),e.jsx(r,{icon:"",label:"CxP vigentes",value:`$${Et(o.admin.cxpVigente)}`,color:Re.amber}),e.jsx(r,{icon:"",label:"CxP vencidas",value:`$${Et(o.admin.cxpVencida)}`,color:o.admin.cxpVencida>0?Re.red:Re.green})]})]}),compras:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total OCs",value:o.compras.total,color:Re.ink}),e.jsx(r,{icon:"",label:"OCs pendientes",value:o.compras.pendientes,color:o.compras.pendientes>0?Re.amber:Re.green}),e.jsx(r,{icon:"",label:"Valor compras",value:`$${Et(o.compras.totalCompras)}`,color:Re.ink}),e.jsx(r,{icon:"",label:"Recepciones",value:o.compras.recepciones,color:Re.blue})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Evaluaciones proveedores",value:o.compras.evals,color:Re.ink}),e.jsxs(xo,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:" Tasa de recepcin"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Re.green},children:[o.compras.total>0?Math.round(o.compras.recepciones/o.compras.total*100):0,"%"]})]})]})]}),flotas:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total vehculos",value:o.flotas.total,sub:`${o.flotas.activos} activos`,color:Re.ink}),e.jsx(r,{icon:"",label:"En taller",value:o.flotas.taller,color:o.flotas.taller>0?Re.amber:Re.green}),e.jsx(r,{icon:"",label:"Combustible mes",value:`$${Et(o.flotas.gastoCombustible)}`,color:Re.red}),e.jsx(r,{icon:"",label:"Docs vencidos",value:o.flotas.docsVencidos,sub:`${o.flotas.docsPorVencer} por vencer`,color:o.flotas.docsVencidos>0?Re.red:Re.green})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Mantenimientos vencidos",value:o.flotas.mantosVencidos,color:o.flotas.mantosVencidos>0?Re.red:Re.green}),e.jsx(r,{icon:"",label:"Docs por vencer (30d)",value:o.flotas.docsPorVencer,color:o.flotas.docsPorVencer>0?Re.amber:Re.green})]})]}),rrhh:()=>e.jsx("div",{className:"fade-up",children:e.jsxs(xo,{style:{padding:20,textAlign:"center",color:Re.inkMid},children:[e.jsx(Ri,{size:32,style:{opacity:.2,marginBottom:8}}),e.jsx("p",{style:{fontSize:12},children:"Los KPIs de RRHH se alimentan del mdulo de RRHH."}),e.jsxs("p",{style:{fontSize:10,color:Re.inkXLight},children:["Viticos pendientes: ",o.admin.viaticosPend]})]})}),crm:()=>e.jsx("div",{className:"fade-up",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total ofertas",value:o.crm.deals,color:Re.ink}),e.jsx(r,{icon:"",label:"Ganadas",value:o.crm.ganados,color:Re.green}),e.jsx(r,{icon:"",label:"Ventas totales",value:`$${Et(o.crm.totalVentas)}`,color:Re.green}),e.jsx(r,{icon:"",label:"Pipeline",value:`$${Et(o.crm.pipeline)}`,sub:`${o.crm.enCurso} activas`,color:Re.blue})]})}),proyectos:()=>e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Total proyectos",value:o.proyectos.total,sub:`${o.proyectos.activos} activos  ${o.proyectos.completados} completados`,color:Re.ink}),e.jsx(r,{icon:"",label:"Avance promedio",value:`${o.proyectos.avancePromedio}%`,color:o.proyectos.avancePromedio>=70?Re.green:o.proyectos.avancePromedio>=40?Re.amber:Re.red}),e.jsx(r,{icon:"",label:"Retrasados",value:o.proyectos.retrasados,color:o.proyectos.retrasados>0?Re.red:Re.green}),e.jsx(r,{icon:"",label:"Hitos",value:`${o.proyectos.hitosCompletos}/${o.proyectos.hitosCompletos+o.proyectos.hitosPendientes}`,sub:`${o.proyectos.hitosPendientes} pendientes`,color:Re.blue})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:12,marginBottom:20},children:[e.jsx(r,{icon:"",label:"Actividades totales",value:o.proyectos.actividades,color:Re.ink}),e.jsxs(xo,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:" Tasa de completitud"}),e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Re.green},children:[o.proyectos.total>0?Math.round(o.proyectos.completados/o.proyectos.total*100):0,"%"]})]})]}),(o.proyectos.avancesProy||[]).length>0&&e.jsxs(xo,{style:{marginBottom:16},children:[e.jsx("div",{style:{fontSize:10,fontWeight:700,marginBottom:10},children:" Avance por proyecto activo"}),o.proyectos.avancesProy.map(c=>e.jsxs("div",{style:{marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3},children:[e.jsx("span",{style:{fontSize:10,fontWeight:600},children:c.nombre}),e.jsxs("span",{style:{fontSize:10,fontFamily:"'DM Mono',monospace",fontWeight:700,color:c.avance>=70?Re.green:c.avance>=40?Re.amber:Re.red},children:[c.avance,"%"]})]}),e.jsx("div",{style:{height:8,background:Re.accent,borderRadius:4,overflow:"hidden"},children:e.jsx("div",{style:{width:`${c.avance}%`,height:"100%",borderRadius:4,background:c.avance>=70?Re.green:c.avance>=40?Re.amber:Re.red,transition:"width .3s"}})}),e.jsxs("div",{style:{fontSize:8,color:Re.inkLight,marginTop:2},children:[c.acts," actividades  Fin: ",c.fin||""]})]},c.id))]})]})}[t]||a;return e.jsxs(e.Fragment,{children:[e.jsx(vm,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Dashboard"}),e.jsxs("div",{style:{fontSize:10,color:Re.inkMid},children:["Vista consolidada de la empresa  ",new Date().toLocaleDateString("es-CO",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:ca.map((c,d)=>e.jsx("button",{onClick:()=>i(c.id),style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${Re.border}`,borderLeft:d>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:d===0?"6px 0 0 6px":d===ca.length-1?"0 6px 6px 0":"0",background:t===c.id?c.color:"#fff",color:t===c.id?"#fff":Re.inkMid},children:c.lbl},c.id))}),e.jsx(f,{}),n.length>0&&e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,marginBottom:10,display:"flex",alignItems:"center",gap:6},children:[e.jsx(li,{size:14,color:s.length>0?Re.red:Re.amber}),"Alertas ",t!=="general"&&` ${((p=ca.find(c=>c.id===t))==null?void 0:p.lbl)||""}`,e.jsx(da,{color:s.length>0?Re.red:Re.amber,children:n.length})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:n.sort((c,d)=>{const l={alta:0,media:1,baja:2};return(l[c.sev]||2)-(l[d.sev]||2)}).map((c,d)=>e.jsxs("div",{style:{background:c.sev==="alta"?Re.redBg:c.sev==="media"?Re.amberBg:Re.blueBg,border:`1px solid ${c.color}33`,borderRadius:6,padding:"8px 14px",display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:16},children:c.icon}),e.jsx("div",{style:{flex:1,fontSize:10,fontWeight:600,color:c.color},children:c.msg}),e.jsx(da,{color:c.color,children:c.sev}),t==="general"&&e.jsx(da,{color:Re.inkLight,children:c.mod})]},d))})]}),n.length===0&&e.jsxs(xo,{style:{textAlign:"center",padding:20,color:Re.green,marginBottom:20},children:[e.jsx("div",{style:{fontSize:16,marginBottom:4},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Sin alertas activas"}),e.jsx("div",{style:{fontSize:10,color:Re.inkMid},children:"Todo en orden"})]}),(t==="general"||t==="admin")&&e.jsxs(xo,{style:{marginBottom:20},children:[e.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:12},children:" Flujo de caja empresa  Mes actual"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:16},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Ingresos"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Re.green},children:["$",Et(o.admin.flujoMes.ing)]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Egresos"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:Re.red},children:["$",Et(o.admin.flujoMes.egr)]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase"},children:" Neto"}),e.jsxs("div",{style:{fontSize:20,fontWeight:800,fontFamily:"'DM Mono',monospace",color:o.admin.flujoMes.neto>=0?Re.green:Re.red},children:["$",Et(o.admin.flujoMes.neto)]})]})]}),e.jsxs("div",{style:{marginTop:12,height:16,background:Re.accent,borderRadius:8,overflow:"hidden",display:"flex"},children:[o.admin.flujoMes.ing>0&&e.jsx("div",{style:{width:`${o.admin.flujoMes.ing/(o.admin.flujoMes.ing+o.admin.flujoMes.egr)*100}%`,background:Re.green,borderRadius:"8px 0 0 8px",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:7,color:"#fff",fontWeight:700},children:"Ingresos"})}),o.admin.flujoMes.egr>0&&e.jsx("div",{style:{width:`${o.admin.flujoMes.egr/(o.admin.flujoMes.ing+o.admin.flujoMes.egr)*100}%`,background:Re.red,borderRadius:"0 8px 8px 0",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:7,color:"#fff",fontWeight:700},children:"Egresos"})})]})]}),e.jsx("div",{style:{textAlign:"center",padding:"10px 0",fontSize:9,color:Re.inkXLight},children:"Habitaris Suite  Dashboard actualizado en tiempo real desde cloud store"})]})]})}const Qn="habitaris_config",Do={empresa:{nombre:"Habitaris",razonSocial:"Habitaris S.A.S.",nit:"901.922.136-8",eslogan:"Diseo  Interiorismo  Arquitectura",domicilio:"Bogot D.C.",telefono:"+57 350 5661545",web:"habitaris.co"},correo:{emailPrincipal:"comercial@habitaris.co",emailjs_serviceId:"service_6x3478l",emailjs_templateId:"template_lzgrxc6",emailjs_publicKey:"64nk2FHknwpLqc1p4"},app:{url:"https://habitaris-suite.vercel.app"},whatsapp:{numero:"573505661545",mensajePlantilla:`Hola {{nombre}},

 *{{formulario}}*

Te adjunto el formulario para que lo completes. brelo en tu navegador.

Gracias.

 {{empresa}}`},legal:{avisoPrivacidad:"En {{razonSocial}} (NIT {{nit}}, domicilio {{domicilio}}, email: {{email}}, tel: {{telefono}}), tratamos tus datos personales para procesar tu solicitud de briefing, enviar cotizaciones y gestionar proyectos. Cumplimos con la Ley 1581/2012 y Rgimen de Proteccin de Datos. Derechos (acceso, rectificacin, supresin, revocacin): va {{email}}.",habeasData:"Al enviar este formulario autorizo a {{razonSocial}}, para el uso de mis datos personales con el fin de elaborar propuestas de diseo, coordinar servicios relacionados y, en caso de ser necesario, compartirlos con proveedores o contratistas de confianza exclusivamente para la correcta ejecucin del proyecto. En todo momento se garantizar la confidencialidad y proteccin de mi informacin, conforme a la normativa de Habeas Data en Colombia (Ley 1581 de 2012).",confirmacion:"La informacin entregada es verdica y ser utilizada nicamente para la elaboracin de la propuesta de diseo. {{razonSocial}} garantiza la confidencialidad de los datos y no los compartir con terceros, salvo con proveedores o contratistas de confianza cuando sea necesario para la correcta ejecucin del proyecto, previa autorizacin del cliente."},formularios:{mensajeExitoDefault:"Gracias por completar el formulario. Nos pondremos en contacto pronto.",firmaEmail:`{{razonSocial}}
{{eslogan}}`},apariencia:{logo:"",colorPrimario:"#111111",colorSecundario:"#3B3B3B",colorAcento:"#111111",tipografia:"DM Sans",slogan:"Diseo  Interiorismo  Arquitectura"},supabase:{url:"https://xlzkasdskatnikuavefh.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM"}};function ji(){var t,i;try{const o=Fe.getSync(Qn);if(!o)return Fe.set(Qn,JSON.stringify(Do)),Do;const n=JSON.parse(o),s=yc(Do,n);return(t=s.supabase)!=null&&t.url||(s.supabase={...s.supabase,url:Do.supabase.url}),(i=s.supabase)!=null&&i.anonKey||(s.supabase={...s.supabase,anonKey:Do.supabase.anonKey}),Fe.set(Qn,JSON.stringify(s)),s}catch{return Do}}function km(t,i){if(!t)return t;const o=i||ji();return t.replace(/\{\{razonSocial\}\}/g,o.empresa.razonSocial).replace(/\{\{nit\}\}/g,o.empresa.nit).replace(/\{\{domicilio\}\}/g,o.empresa.domicilio).replace(/\{\{email\}\}/g,o.correo.emailPrincipal).replace(/\{\{telefono\}\}/g,o.empresa.telefono).replace(/\{\{empresa\}\}/g,o.empresa.nombre).replace(/\{\{eslogan\}\}/g,o.empresa.eslogan).replace(/\{\{web\}\}/g,o.empresa.web)}function yc(t,i){const o={...t};for(const n of Object.keys(i))i[n]&&typeof i[n]=="object"&&!Array.isArray(i[n])&&t[n]?o[n]=yc(t[n],i[n]):o[n]=i[n];return o}const Ge={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",green:"#111111",greenBg:"#E8F4EE",blue:"#3B3B3B",blueBg:"#F0F0F0",amber:"#8C6A00",amberBg:"#FFF4E0",red:"#B91C1C",redBg:"#FAE8E8",purple:"#5B3A8C",gold:"#111111",shadow:"0 1px 4px rgba(0,0,0,.06)"},wm={fontFamily:"'DM Sans',sans-serif"},pa=({children:t,style:i,...o})=>e.jsx("div",{style:{background:Ge.surface,border:`1px solid ${Ge.border}`,borderRadius:8,padding:16,boxShadow:Ge.shadow,...i},...o,children:t}),gr=({children:t,on:i,v:o,style:n,...s})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${Ge.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?Ge.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...s,children:t}),as={border:`1px solid ${Ge.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff",width:"100%"},ld=[{id:"empresa",label:"Empresa",icon:bd,color:Ge.ink},{id:"correo",label:"Correo / EmailJS",icon:fr,color:Ge.blue},{id:"app",label:"App / Deploy",icon:Kc,color:Ge.green},{id:"whatsapp",label:"WhatsApp",icon:ms,color:"#25D366"},{id:"legal",label:"Textos legales",icon:zn,color:Ge.red},{id:"formularios",label:"Formularios",icon:Bt,color:Ge.purple},{id:"apariencia",label:"Marca / Apariencia",icon:Jc,color:Ge.gold},{id:"supabase",label:"Base de datos",icon:or,color:"#3ECF8E"}],zm={empresa:[{key:"nombre",label:"Nombre comercial",placeholder:"Habitaris"},{key:"razonSocial",label:"Razn social",placeholder:"Habitaris S.A.S."},{key:"nit",label:"NIT",placeholder:"901.922.136-8"},{key:"eslogan",label:"Eslogan / Subttulo",placeholder:"Diseo  Interiorismo  Arquitectura"},{key:"domicilio",label:"Domicilio",placeholder:"Bogot D.C."},{key:"telefono",label:"Telfono principal",placeholder:"+57 350 5661545"},{key:"web",label:"Sitio web / dominio",placeholder:"habitaris.co"}],correo:[{key:"emailPrincipal",label:"Email principal (remitente)",placeholder:"comercial@habitaris.co"},{key:"emailjs_serviceId",label:"EmailJS Service ID",placeholder:"service_xxxxxxx"},{key:"emailjs_templateId",label:"EmailJS Template ID",placeholder:"template_xxxxxxx"},{key:"emailjs_publicKey",label:"EmailJS Public Key",placeholder:"xxxxxxxxxxxxxxxxx"}],app:[{key:"url",label:"URL de la app (Vercel)",placeholder:"https://habitaris-suite.vercel.app"}],whatsapp:[{key:"numero",label:"Nmero WhatsApp (con cdigo pas)",placeholder:"573505661545"},{key:"mensajePlantilla",label:"Mensaje plantilla",placeholder:`Hola {{nombre}},
 *{{formulario}}*...`,area:!0}],legal:[{key:"avisoPrivacidad",label:"Aviso de privacidad",placeholder:"En {{razonSocial}} (NIT {{nit}}...",area:!0},{key:"habeasData",label:"Autorizacin habeas data (Ley 1581)",placeholder:"Al enviar este formulario autorizo a {{razonSocial}}...",area:!0},{key:"confirmacion",label:"Texto de confirmacin",placeholder:"La informacin entregada es verdica...",area:!0}],formularios:[{key:"mensajeExitoDefault",label:"Mensaje de xito por defecto",placeholder:"Gracias por completar el formulario."},{key:"firmaEmail",label:"Firma en emails",placeholder:`{{razonSocial}}
{{eslogan}}`,area:!0}],apariencia:[{key:"colorPrimario",label:"Color primario (header, botones)",placeholder:"#111111",color:!0},{key:"colorSecundario",label:"Color secundario (enlaces, badges)",placeholder:"#3B3B3B",color:!0},{key:"colorAcento",label:"Color acento (destacados, progreso)",placeholder:"#111111",color:!0},{key:"slogan",label:"Slogan / Tagline",placeholder:"Diseo  Interiorismo  Arquitectura"}],supabase:[{key:"url",label:"Project URL",placeholder:"https://xxxxx.supabase.co"},{key:"anonKey",label:"Anon Public Key",placeholder:"eyJhbGciOiJIUzI1NiIs..."}]};function Em(){var m,f;const[t,i]=F.useState(()=>ji()),[o,n]=F.useState("empresa"),[s,r]=F.useState(!1),[a,u]=F.useState(!1),h=(p,c,d)=>{i(l=>({...l,[p]:{...l[p],[c]:d}})),u(!0),r(!1)},b=()=>{Fe.set(Qn,JSON.stringify(t)),u(!1),r(!0),setTimeout(()=>r(!1),3e3)},j=()=>{confirm("Restablecer toda la configuracin a los valores por defecto? Se perdern los cambios.")&&(Fe.delete(Qn),i(Do),u(!1))},C=ld.find(p=>p.id===o),v=zm[o]||[];return e.jsxs("div",{style:{...wm,maxWidth:1100,margin:"0 auto",padding:"20px 16px 80px"},children:[e.jsx("style",{children:`
        .fade-up{animation:fadeUp .3s ease}
        @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .cfg-inp:focus{outline:none;border-color:${Ge.green}!important;box-shadow:0 0 0 2px ${Ge.green}22}
      `}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:22,fontWeight:700},children:" Configuracin"}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:11,color:Ge.inkMid},children:"Ajustes generales de la aplicacin  Todos los mdulos leen de aqu"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a&&e.jsx("span",{style:{fontSize:9,color:Ge.amber,fontWeight:600},children:" Sin guardar"}),s&&e.jsx("span",{style:{fontSize:9,color:Ge.green,fontWeight:600},children:" Guardado"}),e.jsxs(gr,{v:"sec",on:j,children:[e.jsx(Gc,{size:10})," Restablecer"]}),e.jsxs(gr,{on:b,children:[e.jsx(ko,{size:10})," Guardar configuracin"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{width:200,flexShrink:0},children:[e.jsx(pa,{style:{padding:8},children:ld.map(p=>{const c=p.icon,d=o===p.id;return e.jsxs("button",{onClick:()=>n(p.id),style:{display:"flex",alignItems:"center",gap:8,width:"100%",padding:"8px 10px",border:"none",borderRadius:6,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",background:d?"#111":"transparent",color:d?"#fff":Ge.inkMid,fontSize:11,fontWeight:d?700:500,textAlign:"left",transition:"all .15s",marginBottom:2},children:[e.jsx(c,{size:13,color:d?"#fff":p.color}),p.label]},p.id)})}),e.jsxs(pa,{style:{marginTop:12,padding:"12px 14px",background:Ge.blueBg,border:`1px solid ${Ge.blue}22`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ge.blue,textTransform:"uppercase",marginBottom:4},children:" Variables dinmicas"}),e.jsxs("div",{style:{fontSize:9,color:Ge.blue,lineHeight:1.6},children:["En textos legales puedes usar:",e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{razonSocial}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{nit}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{email}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{telefono}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{domicilio}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{empresa}}"}),e.jsx("br",{}),e.jsx("code",{style:{fontSize:8},children:"{{eslogan}}"})," ",e.jsx("code",{style:{fontSize:8},children:"{{web}}"}),e.jsx("br",{}),"Se reemplazan automticamente."]})]})]}),e.jsx("div",{style:{flex:1},className:"fade-up",children:e.jsxs(pa,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[C&&e.jsx(C.icon,{size:16,color:C.color}),e.jsx("h2",{style:{margin:0,fontSize:16,fontWeight:700},children:C==null?void 0:C.label})]}),o==="apariencia"&&e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:20,borderBottom:`1px solid ${Ge.border}`,paddingBottom:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:8},children:" Logo de la empresa"}),e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:[e.jsx("div",{style:{width:120,height:60,border:`2px dashed ${Ge.border}`,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",background:"#fff",flexShrink:0},children:(m=t.apariencia)!=null&&m.logo?e.jsx("img",{src:t.apariencia.logo,alt:"Logo",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}):e.jsx("span",{style:{fontSize:9,color:Ge.inkLight},children:"Sin logo"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("input",{type:"file",accept:"image/png,image/svg+xml,image/jpeg",onChange:p=>{var l;const c=(l=p.target.files)==null?void 0:l[0];if(!c)return;if(c.size>5e5){alert("El logo debe pesar menos de 500KB");return}const d=new FileReader;d.onload=x=>h("apariencia","logo",x.target.result),d.readAsDataURL(c)},style:{fontSize:10,marginBottom:6}}),e.jsx("div",{style:{fontSize:8,color:Ge.inkLight},children:"PNG, SVG o JPG  mx 500KB  Se usa en header, formularios, PDFs y emails"}),((f=t.apariencia)==null?void 0:f.logo)&&e.jsx("button",{onClick:()=>h("apariencia","logo",""),style:{marginTop:4,fontSize:9,color:Ge.red,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar logo"})]})]})]})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:14},children:v.map(p=>{var c,d,l,x;return e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:4,letterSpacing:.5},children:p.label}),p.color?e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"color",value:((c=t[o])==null?void 0:c[p.key])||p.placeholder,onChange:y=>h(o,p.key,y.target.value),style:{width:40,height:32,border:"none",borderRadius:4,cursor:"pointer"}}),e.jsx("input",{className:"cfg-inp",value:((d=t[o])==null?void 0:d[p.key])||"",onChange:y=>h(o,p.key,y.target.value),placeholder:p.placeholder,style:{...as,width:140,fontFamily:"'DM Mono',monospace",fontSize:10}})]}):p.area?e.jsx("textarea",{className:"cfg-inp",rows:4,value:((l=t[o])==null?void 0:l[p.key])||"",onChange:y=>h(o,p.key,y.target.value),placeholder:p.placeholder,style:{...as,resize:"vertical",lineHeight:1.6}}):e.jsx("input",{className:"cfg-inp",value:((x=t[o])==null?void 0:x[p.key])||"",onChange:y=>h(o,p.key,y.target.value),placeholder:p.placeholder,style:as})]},p.key)})}),o==="legal"&&e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ge.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:8},children:" Vista previa (variables reemplazadas)"}),v.map(p=>{var c;return e.jsxs("div",{style:{marginBottom:10,padding:"8px 12px",background:Ge.bg,borderRadius:4,border:`1px solid ${Ge.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ge.inkLight,marginBottom:3},children:p.label}),e.jsx("div",{style:{fontSize:10,color:Ge.ink,lineHeight:1.5,whiteSpace:"pre-wrap"},children:km(((c=t.legal)==null?void 0:c[p.key])||"",t)})]},p.key)})]}),o==="apariencia"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ge.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:8},children:" Tipografa"}),e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=DM Sans:wght@400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap');"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:["DM Sans","Inter","Poppins","DM Sans","Playfair Display"].map(p=>{var d,l;const c=(((d=t.apariencia)==null?void 0:d.tipografia)||"DM Sans")===p;return e.jsxs("button",{onClick:()=>h("apariencia","tipografia",p),style:{padding:"10px 16px",borderRadius:8,cursor:"pointer",fontFamily:`'${p}',sans-serif`,border:c?`2px solid ${((l=t.apariencia)==null?void 0:l.colorPrimario)||"#111"}`:`1px solid ${Ge.border}`,background:c?"#111":"#fff",color:c?"#fff":Ge.ink,fontSize:13,fontWeight:600,transition:"all .15s",minWidth:100,textAlign:"center"},children:[e.jsx("div",{children:p}),e.jsx("div",{style:{fontSize:9,fontWeight:400,marginTop:2,opacity:.6},children:"Aa Bb Cc 123"})]},p)})})]}),e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ge.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:8},children:" Paletas predefinidas"}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[{name:"Elegante oscuro",p:"#111111",s:"#3B3B3B",a:"#111111"},{name:"Profesional azul",p:"#1E3A5F",s:"#2E7D96",a:"#E8B931"},{name:"Natural verde",p:"#1B4332",s:"#52796F",a:"#D4A373"},{name:"Moderno violeta",p:"#2D1B69",s:"#5B3A8C",a:"#F4A261"},{name:"Clido terracota",p:"#6B3A2A",s:"#A0522D",a:"#DEB887"},{name:"Minimalista",p:"#333333",s:"#666666",a:"#999999"}].map(p=>e.jsxs("button",{onClick:()=>{h("apariencia","colorPrimario",p.p),h("apariencia","colorSecundario",p.s),h("apariencia","colorAcento",p.a)},style:{padding:"8px 12px",borderRadius:6,cursor:"pointer",border:`1px solid ${Ge.border}`,background:"#fff",fontFamily:"'DM Sans',sans-serif",textAlign:"center",transition:"all .15s"},children:[e.jsxs("div",{style:{display:"flex",gap:4,marginBottom:4,justifyContent:"center"},children:[e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.p}}),e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.s}}),e.jsx("div",{style:{width:18,height:18,borderRadius:"50%",background:p.a}})]}),e.jsx("div",{style:{fontSize:8,color:Ge.inkMid,fontWeight:600},children:p.name})]},p.name))})]}),e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ge.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:8},children:" Vista previa en vivo"}),(()=>{var S,A,E,w;const p=t.apariencia||{},c=p.colorPrimario||"#111",d=p.colorSecundario||"#3B3B3B",l=p.colorAcento||"#111111",x=p.tipografia||"DM Sans",y=p.slogan||((S=t.empresa)==null?void 0:S.eslogan)||"Diseo  Interiorismo  Arquitectura",g=((A=t.empresa)==null?void 0:A.nombre)||"Habitaris";return e.jsxs("div",{style:{borderRadius:10,overflow:"hidden",border:`1px solid ${Ge.border}`,boxShadow:"0 2px 12px rgba(0,0,0,.08)"},children:[e.jsxs("div",{style:{background:c,padding:"14px 20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[p.logo?e.jsx("img",{src:p.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("div",{style:{fontFamily:`'${x}',sans-serif`,fontWeight:700,fontSize:14,letterSpacing:3,color:"#fff",textTransform:"uppercase"},children:g}),e.jsx("div",{style:{fontSize:7,letterSpacing:2,color:"rgba(255,255,255,.4)",textTransform:"uppercase",fontFamily:`'${x}',sans-serif`},children:y})]}),e.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,.5)",fontFamily:`'${x}',sans-serif`},children:"Paso 1 de 5"})]}),e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${l},${l}88,${l})`}}),e.jsxs("div",{style:{padding:"20px 24px",background:"#fff"},children:[e.jsx("h3",{style:{fontFamily:`'${x}',sans-serif`,fontSize:16,fontWeight:700,margin:"0 0 4px",color:c},children:"Briefing Inicial"}),e.jsx("p",{style:{fontFamily:`'${x}',sans-serif`,fontSize:11,color:"#888",margin:"0 0 14px"},children:"Cuntanos sobre tu proyecto"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsx("div",{style:{padding:"6px 14px",borderRadius:16,background:c,color:"#fff",fontSize:10,fontWeight:600,fontFamily:`'${x}',sans-serif`},children:"Diseo interior"}),e.jsx("div",{style:{padding:"6px 14px",borderRadius:16,border:`1px solid ${Ge.border}`,color:Ge.inkMid,fontSize:10,fontWeight:400,fontFamily:`'${x}',sans-serif`},children:"Obra nueva"})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{style:{padding:"8px 20px",background:c,color:"#fff",border:"none",borderRadius:6,fontSize:11,fontWeight:700,fontFamily:`'${x}',sans-serif`,cursor:"default"},children:"Siguiente "}),e.jsx("button",{style:{padding:"8px 20px",background:"#fff",color:d,border:`1px solid ${d}44`,borderRadius:6,fontSize:11,fontWeight:600,fontFamily:`'${x}',sans-serif`,cursor:"default"},children:" Atrs"})]})]}),e.jsxs("div",{style:{padding:"10px 24px",background:Ge.bg,borderTop:`1px solid ${Ge.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontFamily:`'${x}',sans-serif`,fontSize:9,color:Ge.inkLight},children:[((E=t.empresa)==null?void 0:E.razonSocial)||"Empresa S.A.S.","  ",((w=t.empresa)==null?void 0:w.domicilio)||"Bogot"]}),e.jsxs("div",{style:{display:"flex",gap:4},children:[e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:c}}),e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:d}}),e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:l}})]})]})]})})()]})]}),o==="correo"&&e.jsxs("div",{style:{marginTop:20,borderTop:`1px solid ${Ge.border}`,paddingTop:14},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:8},children:" Probar conexin"}),e.jsx(Am,{config:t})]}),o==="supabase"&&e.jsx("div",{style:{marginTop:20,borderTop:`1px solid ${Ge.border}`,paddingTop:14},children:e.jsx(Fm,{config:t})})]})},o)]})]})}function Am({config:t}){const[i,o]=F.useState(""),[n,s]=F.useState(""),[r,a]=F.useState(!1),u=async()=>{if(i){a(!0),s("Enviando...");try{const h=await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:t.correo.emailjs_serviceId,template_id:t.correo.emailjs_templateId,user_id:t.correo.emailjs_publicKey,template_params:{client_name:"Test",client_email:i,form_name:"Email de prueba",from_name:t.empresa.nombre,form_link:"Este es un email de prueba desde Habitaris."}})});s(h.ok?" Email enviado correctamente":" Error: "+h.status)}catch(h){s(" Error: "+h.message)}a(!1)}};return e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-end"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:8,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase"},children:"Email de prueba"}),e.jsx("input",{value:i,onChange:h=>o(h.target.value),placeholder:"tu@email.com",style:as})]}),e.jsxs(gr,{on:u,disabled:r,style:{whiteSpace:"nowrap"},children:[e.jsx(fr,{size:10})," ",r?"Enviando...":"Enviar test"]}),n&&e.jsx("span",{style:{fontSize:9,color:n.startsWith("")?Ge.green:n.startsWith("")?Ge.red:Ge.amber,fontWeight:600},children:n})]})}function Fm({config:t}){var f,p,c,d;const[i,o]=F.useState(!1),[n,s]=F.useState(""),[r,a]=F.useState(!1),[u,h]=F.useState(null),[b,j]=F.useState(!1),C=async()=>{o(!0),s("Probando...");const l=await Ng();s(l.ok?" Conexin exitosa":" "+l.error),o(!1)},v=async()=>{a(!0),h(null);const l=await Ug();h(l),a(!1)},m=((f=t.supabase)==null?void 0:f.url)&&((p=t.supabase)==null?void 0:p.anonKey);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{padding:"12px 16px",background:"#E8F8EE",border:"1px solid #3ECF8E33",borderRadius:6},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#1B7A4B",marginBottom:4},children:" Cmo configurar Supabase?"}),e.jsxs("div",{style:{fontSize:10,color:"#2D6A4F",lineHeight:1.6},children:["1. Ve a ",e.jsx("strong",{children:"supabase.com"}),"  Crea cuenta gratis",e.jsx("br",{}),"2. Nuevo proyecto  Nombre: ",e.jsx("code",{style:{fontSize:9},children:"habitaris-suite"}),"  Regin: So Paulo",e.jsx("br",{}),"3. Settings  API  Copia ",e.jsx("strong",{children:"Project URL"})," y ",e.jsx("strong",{children:"anon public"})," key",e.jsx("br",{}),"4. Pgalos arriba y guarda configuracin",e.jsx("br",{}),'5. Haz clic en "Crear tablas" abajo']})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:8},children:" Probar conexin"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs(gr,{on:C,v:m?"":"sec",disabled:i||!m,children:[e.jsx(or,{size:10})," ",i?"Probando...":"Probar conexin"]}),n&&e.jsx("span",{style:{fontSize:9,fontWeight:600,color:n.startsWith("")?Ge.green:n.startsWith("")?Ge.red:Ge.amber},children:n}),!m&&e.jsx("span",{style:{fontSize:9,color:Ge.amber},children:" Primero configura URL y Key arriba"})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:8},children:" Crear tablas"}),e.jsxs("p",{style:{fontSize:10,color:Ge.inkMid,marginBottom:8},children:["Se crearn 3 tablas: ",e.jsx("code",{style:{fontSize:9},children:"form_events"})," (estadsticas), ",e.jsx("code",{style:{fontSize:9},children:"form_responses"})," (respuestas), ",e.jsx("code",{style:{fontSize:9},children:"form_links"})," (enlaces)."]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(gr,{on:v,v:"sec",disabled:r||!m,children:r?"Creando...":" Verificar / Crear tablas"}),e.jsxs("button",{onClick:()=>j(!b),style:{fontSize:9,color:Ge.blue,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textDecoration:"underline"},children:[b?"Ocultar":"Ver"," SQL manual"]})]}),u&&e.jsx("div",{style:{marginTop:10,padding:"10px 14px",borderRadius:6,background:u.ok?"#E8F8EE":"#FFF4E0",border:`1px solid ${u.ok?"#3ECF8E":"#F59E0B"}33`},children:u.ok?e.jsxs("span",{style:{fontSize:10,color:"#1B7A4B",fontWeight:600},children:[" ",u.msg||"Tablas listas"]}):u.error==="manual_sql"?e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:10,color:Ge.amber,fontWeight:600},children:[" Tablas faltantes: ",u.missing.join(", ")]}),e.jsx("p",{style:{fontSize:9,color:Ge.inkMid,marginTop:4},children:'Necesitas ejecutar el SQL manualmente en Supabase  SQL Editor. Haz clic en "Ver SQL manual" y copia el cdigo.'})]}):e.jsxs("span",{style:{fontSize:10,color:Ge.red,fontWeight:600},children:[" ",u.error]})}),b&&e.jsxs("div",{style:{marginTop:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:8,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase"},children:"SQL para copiar en Supabase  SQL Editor"}),e.jsx("button",{onClick:()=>{var l;(l=navigator.clipboard)==null||l.writeText(Ta()),alert(" SQL copiado")},style:{fontSize:9,color:Ge.blue,background:"none",border:"none",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Copiar"})]}),e.jsx("pre",{style:{fontSize:9,background:"#1a1a2e",color:"#e0e0e0",padding:14,borderRadius:6,overflow:"auto",maxHeight:300,lineHeight:1.5,fontFamily:"'DM Mono',monospace"},children:Ta()})]})]}),m&&e.jsxs("div",{style:{padding:"10px 14px",background:Ge.bg,borderRadius:6,border:`1px solid ${Ge.border}`},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:Ge.inkMid,textTransform:"uppercase",marginBottom:6},children:"Estado de conexin"}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{fontSize:10},children:[e.jsx("span",{style:{color:"#3ECF8E",fontWeight:700},children:""})," URL: ",e.jsxs("code",{style:{fontSize:9},children:[(c=t.supabase.url)==null?void 0:c.replace("https://","").slice(0,20),"..."]})]}),e.jsxs("div",{style:{fontSize:10},children:[e.jsx("span",{style:{color:"#3ECF8E",fontWeight:700},children:""})," Key: ",e.jsxs("code",{style:{fontSize:9},children:[(d=t.supabase.anonKey)==null?void 0:d.slice(0,20),"..."]})]})]})]})]})}const Tm=()=>e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif;background:#F5F4F1}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#C8C5BE;border-radius:2px}input,select,textarea,button{font-family:'DM Sans',sans-serif;outline:none}button{cursor:pointer}@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-up{animation:fadeUp .22s ease both}"}),fe={bg:"#F5F4F1",surface:"#FFFFFF",ink:"#111",inkMid:"#555",inkLight:"#909090",inkXLight:"#C8C5BE",border:"#E0E0E0",accent:"#EDEBE7",green:"#111111",greenBg:"#E8F4EE",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FAF0E0",blue:"#3B3B3B",blueBg:"#F0F0F0",purple:"#111111",shadow:"0 1px 3px rgba(0,0,0,.06),0 4px 16px rgba(0,0,0,.05)"},xt=()=>Math.random().toString(36).slice(2,10),Ji=()=>new Date().toISOString().split("T")[0],Bm={fontFamily:"'DM Sans',sans-serif"};function ua(t,i){if(!(i!=null&&i.campos))return null;const o=i.campos.filter(m=>{var f;return(f=m.scoring)==null?void 0:f.enabled});if(o.length===0)return null;let n=0,s=0,r=0,a=0,u=0;const h=[];o.forEach(m=>{const f=m.scoring.weight||1,p=m.mapKey||m.id;let c=t[p];if(c===void 0)return;s+=f;const d=m.scoring.rules||{};let l="neutral";if(Array.isArray(c)){const y=c.map(g=>d[g]||"neutral");y.includes("red")?l="red":y.every(g=>g==="green")?l="green":l="neutral"}else l=d[String(c)]||"neutral";let x=0;l==="green"?(x=f,r++):l==="neutral"?(x=f*.5,u++):(x=0,a++),n+=x,h.push({label:m.label,value:Array.isArray(c)?c.join(", "):String(c),flag:l,points:x,maxPoints:f})});const b=s>0?Math.round(n/s*100)/10:0,j=b>=7?"green":b>=4?"yellow":"red";return{score:b,level:j,levelLabel:j==="green"?" Cliente potencial":j==="yellow"?" Revisar":" No califica",conclusion:j==="green"?"Perfil alineado con los servicios. Recomendacin: contactar en las prximas 24h.":j==="yellow"?"Algunos puntos requieren validacin. Recomendacin: agendar llamada exploratoria.":"Expectativas no alineadas con los servicios. Recomendacin: responder cortsmente y archivar.",greens:r,reds:a,yellows:u,totalPoints:n,maxPoints:s,details:h}}const Im=async t=>{try{const i=ji();return(await fetch("https://api.emailjs.com/api/v1.0/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:i.correo.emailjs_serviceId,template_id:i.correo.emailjs_templateId,user_id:i.correo.emailjs_publicKey,template_params:t})})).ok}catch{return!1}},Nt=({children:t,style:i,...o})=>e.jsx("div",{style:{background:fe.surface,border:`1px solid ${fe.border}`,borderRadius:8,padding:16,boxShadow:fe.shadow,...i},...o,children:t}),So=({children:t,on:i,v:o,style:n,...s})=>e.jsx("button",{onClick:i,style:{padding:"7px 16px",borderRadius:5,border:o==="sec"?`1px solid ${fe.border}`:"none",background:o==="sec"?"#fff":o==="danger"?"#B91C1C":"#111",color:o==="sec"?fe.inkMid:"#fff",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",display:"inline-flex",alignItems:"center",gap:5,...n},...s,children:t}),Zn=({children:t,color:i})=>e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:i+"22",color:i},children:t}),kt={border:`1px solid ${fe.border}`,borderRadius:4,padding:"6px 8px",fontSize:11,fontFamily:"'DM Sans',sans-serif",background:"#fff"},fs={padding:"5px 8px",fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",borderBottom:`2px solid ${fe.border}`,textAlign:"left"},Kt={padding:"5px 8px",fontSize:10,borderBottom:`1px solid ${fe.border}`},Jr="habitaris_formularios",dd=[{id:"dashboard",lbl:" Dashboard"},{id:"mis_forms",lbl:" Mis formularios"},{id:"constructor",lbl:" Constructor"},{id:"enviados",lbl:" Enviados"},{id:"respuestas",lbl:" Respuestas"},{id:"estadisticas",lbl:" Estadsticas"},{id:"plantillas",lbl:" Plantillas"}],Yr=[{tipo:"text",lbl:"Texto corto",icon:"",desc:"Una lnea de texto"},{tipo:"textarea",lbl:"Texto largo",icon:"",desc:"Prrafo multilnea"},{tipo:"number",lbl:"Nmero",icon:"",desc:"Valor numrico"},{tipo:"email",lbl:"Email",icon:"",desc:"Correo electrnico"},{tipo:"tel",lbl:"Telfono",icon:"",desc:"Nmero telefnico"},{tipo:"date",lbl:"Fecha",icon:"",desc:"Selector de fecha"},{tipo:"select",lbl:"Desplegable",icon:"",desc:"Lista de opciones"},{tipo:"radio",lbl:"Opcin nica",icon:"",desc:"Elegir una opcin"},{tipo:"chips",lbl:"Seleccin mltiple",icon:"",desc:"Elegir varias opciones"},{tipo:"rango",lbl:"Rango/Escala",icon:"",desc:"Rango numrico"},{tipo:"rating",lbl:"Valoracin",icon:"",desc:"Estrellas 1-5"},{tipo:"yesno",lbl:"S / No",icon:"",desc:"Pregunta de s o no"},{tipo:"seccion",lbl:"Seccin",icon:"",desc:"Encabezado de seccin"},{tipo:"info",lbl:"Texto informativo",icon:"",desc:"Prrafo informativo (sin respuesta)"}],Es=[{id:"general",lbl:"General"},{id:"crm",lbl:"CRM / Ofertas"},{id:"rrhh",lbl:"RRHH"},{id:"sst",lbl:"SST"},{id:"calidad",lbl:"Calidad"},{id:"postventa",lbl:"Postventa"},{id:"proyectos",lbl:"Proyectos"},{id:"logistica",lbl:"Logstica"},{id:"compras",lbl:"Compras"},{id:"flotas",lbl:"Flotas"},{id:"admin",lbl:"Administracin"}],Rm={Amazonas:["Leticia","Otra"],Antioquia:["Medelln","Bello","Envigado","Itag","Rionegro","Sabaneta","Apartad","Otra"],Arauca:["Arauca","Saravena","Otra"],Atlntico:["Barranquilla","Soledad","Malambo","Otra"],"Bogot D.C.":["Bogot"],Bolvar:["Cartagena","Magangu","Turbaco","Otra"],Boyac:["Tunja","Duitama","Sogamoso","Otra"],Caldas:["Manizales","Villamara","La Dorada","Otra"],Caquet:["Florencia","Otra"],Casanare:["Yopal","Aguazul","Otra"],Cauca:["Popayn","Santander de Quilichao","Otra"],Cesar:["Valledupar","Aguachica","Otra"],Choc:["Quibd","Otra"],Crdoba:["Montera","Ceret","Lorica","Otra"],Cundinamarca:["Soacha","Cha","Zipaquir","Facatativ","Girardot","Fusagasug","Mosquera","Madrid","Cajic","Otra"],Guaina:["Inrida","Otra"],Guaviare:["San Jos del Guaviare","Otra"],Huila:["Neiva","Pitalito","Garzn","Otra"],"La Guajira":["Riohacha","Maicao","Otra"],Magdalena:["Santa Marta","Cinaga","Otra"],Meta:["Villavicencio","Acacas","Granada","Otra"],Nario:["Pasto","Ipiales","Tumaco","Otra"],"Norte de Santander":["Ccuta","Ocaa","Pamplona","Otra"],Putumayo:["Mocoa","Puerto Ass","Otra"],Quindo:["Armenia","Calarc","Otra"],Risaralda:["Pereira","Dosquebradas","Santa Rosa de Cabal","Otra"],"San Andrs y Providencia":["San Andrs","Providencia","Otra"],Santander:["Bucaramanga","Floridablanca","Girn","Piedecuesta","Barrancabermeja","Otra"],Sucre:["Sincelejo","Corozal","Otra"],Tolima:["Ibagu","Espinal","Melgar","Otra"],"Valle del Cauca":["Cali","Palmira","Buenaventura","Tulu","Buga","Jamund","Yumbo","Otra"],Vaups:["Mit","Otra"],Vichada:["Puerto Carreo","Otra"]},vc=[{id:"briefing_inicial",version:6,nombre:"Briefing Inicial Habitaris",modulo:"crm",desc:"Formulario completo de briefing para nuevos proyectos",campos:[{id:"f_privacidad",tipo:"info",label:"Aviso de Privacidad: En Habitaris SAS (NIT 901.922.136-8, domicilio Bogot D.C., email: comercial.co, tel: +57 350 5661545), tratamos tus datos personales para procesar tu solicitud de briefing, enviar cotizaciones y gestionar proyectos. Cumplimos con la Ley 1581/2012 y Rgimen de Proteccin de Datos. Derechos (acceso, rectificacin, supresin, revocacin): va comercial.co.",desc:"",required:!1,opciones:[],logica:null},{id:"f_acepta_priv",tipo:"yesno",label:"Aceptas el aviso de privacidad?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"aceptaPrivacidad"},{id:"s1",tipo:"seccion",label:"Datos del cliente",desc:"Informacin personal y de contacto",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_nombre",tipo:"text",label:"Nombre y apellidos",placeholder:"Escribe tu nombre completo",required:!0,opciones:[],logica:null,mapKey:"nombre"},{id:"f_tipo_doc_co",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["Cdula de ciudadana (CC)","Cdula de extranjera (CE)","NIT","Pasaporte"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_es",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["DNI","NIE","CIF","Pasaporte"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_mx",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["CURP","RFC","INE","Pasaporte"],logica:{fieldId:"f_pais",value:"Mxico"},mapKey:"tipoDocumento"},{id:"f_tipo_doc_otro",tipo:"select",label:"Tipo de documento",placeholder:"",required:!0,opciones:["Documento de identidad","Pasaporte","Otro"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa","Mxico"]},mapKey:"tipoDocumento"},{id:"f_num_doc",tipo:"text",label:"Nmero de documento",placeholder:"Ej: 1.234.567.890",required:!0,opciones:[],logica:null,mapKey:"numDocumento"},{id:"f_email",tipo:"email",label:"Correo electrnico",placeholder:"name@example.com",required:!0,opciones:[],logica:null,mapKey:"email"},{id:"f_pais",tipo:"select",label:"Pas del proyecto",placeholder:"",required:!0,opciones:["Colombia","Espaa","Mxico","Chile","Per","Ecuador","Argentina","Panam","Estados Unidos","Otro"],logica:null,mapKey:"pais"},{id:"f_tel",tipo:"tel_combo",label:"Telfono de contacto",placeholder:"Ej: 3505661545",required:!0,opciones:["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"],logica:null,mapKey:"telefono",codMapKey:"codigoTel",paisRef:"f_pais"},{id:"f_propietario",tipo:"select",label:"Cul es tu relacin con el inmueble?",placeholder:"",required:!0,opciones:["Soy el propietario","Estoy en arriendo","Acto en nombre del propietario","Acto en nombre de un tercero"],logica:null,mapKey:"propietario",scoring:{enabled:!0,weight:2,rules:{"Soy el propietario":"green","Estoy en arriendo":"neutral","Acto en nombre del propietario":"red","Acto en nombre de un tercero":"red"}}},{id:"s3",tipo:"seccion",label:"Ubicacin del proyecto",desc:"Dnde est el inmueble?",required:!1,opciones:[],logica:null},{id:"f_depto_co",tipo:"select",label:"Departamento",placeholder:"",required:!0,opciones:["Amazonas","Antioquia","Arauca","Atlntico","Bogot D.C.","Bolvar","Boyac","Caldas","Caquet","Casanare","Cauca","Cesar","Choc","Crdoba","Cundinamarca","Guaina","Guaviare","Huila","La Guajira","Magdalena","Meta","Nario","Norte de Santander","Putumayo","Quindo","Risaralda","San Andrs y Providencia","Santander","Sucre","Tolima","Valle del Cauca","Vaups","Vichada"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"departamento"},{id:"f_depto_es",tipo:"select",label:"Comunidad autnoma",placeholder:"",required:!0,opciones:["Andaluca","Aragn","Asturias","Baleares","Canarias","Cantabria","Castilla-La Mancha","Castilla y Len","Catalua","Ceuta","Comunidad Valenciana","Extremadura","Galicia","La Rioja","Madrid","Melilla","Murcia","Navarra","Pas Vasco"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"departamento"},{id:"f_depto_mx",tipo:"select",label:"Estado",placeholder:"",required:!0,opciones:["Aguascalientes","Baja California","Baja California Sur","Campeche","Chiapas","Chihuahua","Ciudad de Mxico","Coahuila","Colima","Durango","Estado de Mxico","Guanajuato","Guerrero","Hidalgo","Jalisco","Michoacn","Morelos","Nayarit","Nuevo Len","Oaxaca","Puebla","Quertaro","Quintana Roo","San Luis Potos","Sinaloa","Sonora","Tabasco","Tamaulipas","Tlaxcala","Veracruz","Yucatn","Zacatecas"],logica:{fieldId:"f_pais",value:"Mxico"},mapKey:"departamento"},{id:"f_depto_otro",tipo:"text",label:"Regin / Estado / Provincia",placeholder:"Escribe tu regin",required:!0,opciones:[],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa","Mxico"]},mapKey:"departamento"},{id:"f_ciudad_co",tipo:"select",label:"Ciudad o poblacin",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"ciudad",dynamicOpciones:{dependsOn:"f_depto_co",map:Rm}},{id:"f_ciudad_otro",tipo:"text",label:"Ciudad o poblacin",placeholder:"Escribe la ciudad",required:!0,opciones:[],logica:{fieldId:"f_pais",notValue:"Colombia"},mapKey:"ciudad"},{id:"f_direccion",tipo:"text",label:"Direccin del proyecto",placeholder:"Ej: Calle 100 #15-20 / Av. de la Constitucin 5",required:!0,opciones:[],logica:null,mapKey:"direccion"},{id:"f_tipo_vivienda",tipo:"select",label:"Tipo de inmueble",placeholder:"",required:!0,opciones:["Apartamento","Casa","Local comercial","Oficina","Finca / Rural","Otro"],logica:null,mapKey:"tipoVivienda"},{id:"f_num_apto",tipo:"text",label:"Nmero de apartamento / piso",placeholder:"Ej: Apto 501, Piso 3",required:!0,opciones:[],logica:{fieldId:"f_tipo_vivienda",value:"Apartamento"},mapKey:"numApto"},{id:"f_edificio",tipo:"text",label:"Nombre del edificio, conjunto o urbanizacin",placeholder:"Ej: Edificio Torres del Parque",required:!1,opciones:[],logica:null,mapKey:"edificio"},{id:"f_cod_postal",tipo:"text",label:"Cdigo postal",placeholder:"Ej: 110111",required:!1,opciones:[],logica:null,mapKey:"codigoPostal"},{id:"s3b",tipo:"seccion",label:"Datos del inmueble",desc:"Caractersticas del espacio",required:!1,opciones:[],logica:null},{id:"f_area",tipo:"text",label:"rea aproximada en m",placeholder:"Ej: 85",required:!0,opciones:[],logica:null,mapKey:"area"},{id:"f_habitaciones",tipo:"text",label:"Nmero de habitaciones/reas a intervenir",placeholder:"Ej: 3",required:!0,opciones:[],logica:null,mapKey:"habitaciones"},{id:"f_espacios",tipo:"chips",label:"Qu espacios incluye el proyecto?",placeholder:"",required:!0,opciones:["Sala","Comedor","Cocina","Habitaciones","Baos","Terraza / Balcn","Estudio / Oficina","Local comercial","Jardn / Patio","Fachada"],logica:null,mapKey:"espacios"},{id:"s2",tipo:"seccion",label:"Sobre el servicio",desc:"Qu necesitas?",required:!1,opciones:[],logica:null},{id:"f_servicio",tipo:"chips",label:"Qu servicio te interesa?",placeholder:"",required:!0,opciones:["Diseo arquitectnico / Obra nueva","Diseo arquitectnico / Reforma","Interiorismo / Diseo de interiores","Biointeriorismo","Supervisin de obra (Presencial)","Supervisin de obra (Online)","Asesora de Compras"],logica:null,mapKey:"servicios"},{id:"f_tipo_proy",tipo:"select",label:"El proyecto es residencial, comercial o rural?",placeholder:"",required:!0,opciones:["Residencial","Comercial","Rural"],logica:null,mapKey:"tipoProyecto"},{id:"s4",tipo:"seccion",label:"Estilo y diseo",desc:"Tus preferencias estticas",required:!1,opciones:[],logica:null},{id:"f_estilo",tipo:"chips",label:"Estilo preferido",placeholder:"",required:!0,opciones:["Bio-natural / Orgnico","Bohemio","Clsico","Escandinavo","Industrial","Minimalista","Moderno","Rstico","Otro"],logica:null,mapKey:"estilo"},{id:"f_colores",tipo:"textarea",label:"Colores, materiales y elementos clave",placeholder:"Describe los colores y materiales que te gustan...",required:!0,opciones:[],logica:null,mapKey:"colores"},{id:"f_links_ref",tipo:"textarea",label:"Pega aqu los links de tus ideas o referentes (Pinterest, Instagram, etc.)",placeholder:"https://...",required:!1,opciones:[],logica:null,mapKey:"linksReferentes"},{id:"s5",tipo:"seccion",label:"Expectativas del proyecto",desc:"Qu esperas lograr?",required:!1,opciones:[],logica:null},{id:"f_lograr",tipo:"chips",label:"Qu esperas lograr con este proyecto?",placeholder:"",required:!0,opciones:["Inspiracin o ideas generales","Planos base y distribucin funcional","Diseo integral con renders, acabados y mobiliario","Supervisin y acompaamiento durante la ejecucin"],logica:null,mapKey:"expectativas",scoring:{enabled:!0,weight:3,rules:{"Inspiracin o ideas generales":"red","Planos base y distribucin funcional":"neutral","Diseo integral con renders, acabados y mobiliario":"green","Supervisin y acompaamiento durante la ejecucin":"green"}}},{id:"f_importante",tipo:"chips",label:"Lo ms importante para ti en el proyecto",placeholder:"",required:!0,opciones:["Esttica / Diseo","Funcionalidad","Presupuesto ajustado","Tiempo de entrega","Exclusividad / Personalizacin"],logica:null,mapKey:"prioridades",scoring:{enabled:!0,weight:2,rules:{"Esttica / Diseo":"green",Funcionalidad:"green","Presupuesto ajustado":"red","Tiempo de entrega":"neutral","Exclusividad / Personalizacin":"green"}}},{id:"s6",tipo:"seccion",label:"Presupuesto y financiacin",desc:"Informacin econmica del proyecto",required:!1,opciones:[],logica:null},{id:"f_presupuesto_co",tipo:"select",label:"Presupuesto estimado (COP)",placeholder:"",required:!0,opciones:["Menos de $10.000.000","$10.000.000 - $30.000.000","$30.000.000 - $60.000.000","$60.000.000 - $100.000.000","Ms de $100.000.000"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de $10.000.000":"red","$10.000.000 - $30.000.000":"neutral","$30.000.000 - $60.000.000":"green","$60.000.000 - $100.000.000":"green","Ms de $100.000.000":"green"}}},{id:"f_presupuesto_es",tipo:"select",label:"Presupuesto estimado (EUR)",placeholder:"",required:!0,opciones:["Menos de 10.000","10.000 - 30.000","30.000 - 60.000","60.000 - 100.000","Ms de 100.000"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de 10.000":"red","10.000 - 30.000":"neutral","30.000 - 60.000":"green","60.000 - 100.000":"green","Ms de 100.000":"green"}}},{id:"f_presupuesto_otro",tipo:"select",label:"Presupuesto estimado (USD)",placeholder:"",required:!0,opciones:["Menos de $5.000","$5.000 - $15.000","$15.000 - $30.000","$30.000 - $50.000","Ms de $50.000"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa"]},mapKey:"presupuesto",scoring:{enabled:!0,weight:5,rules:{"Menos de $5.000":"red","$5.000 - $15.000":"neutral","$15.000 - $30.000":"green","$30.000 - $50.000":"green","Ms de $50.000":"green"}}},{id:"f_honorarios",tipo:"select",label:"Tu presupuesto incluye los honorarios de diseo?",placeholder:"",required:!0,opciones:["S, incluye diseo y ejecucin","Solo ejecucin/materiales, el diseo aparte","No, espero que el diseo est incluido sin costo","No estoy seguro"],logica:null,mapKey:"honorariosDiseo",scoring:{enabled:!0,weight:5,rules:{"S, incluye diseo y ejecucin":"green","Solo ejecucin/materiales, el diseo aparte":"green","No, espero que el diseo est incluido sin costo":"red","No estoy seguro":"neutral"}}},{id:"f_financiar",tipo:"select",label:"Cmo planeas financiar el proyecto?",placeholder:"",required:!0,opciones:["Con recursos propios","Crdito bancario o leasing habitacional","Con apoyo de un tercero","An no lo tengo definido"],logica:null,mapKey:"financiacion",scoring:{enabled:!0,weight:3,rules:{"Con recursos propios":"green","Crdito bancario o leasing habitacional":"neutral","Con apoyo de un tercero":"neutral","An no lo tengo definido":"red"}}},{id:"f_invertido",tipo:"select",label:"Has invertido antes en diseo profesional?",placeholder:"",required:!0,opciones:["S","No, pero estoy dispuesto","No, nunca lo hara"],logica:null,mapKey:"inversionPrevia",scoring:{enabled:!0,weight:3,rules:{S:"green","No, pero estoy dispuesto":"neutral","No, nunca lo hara":"red"}}},{id:"f_gratuito",tipo:"select",label:"Esperas que el diseo sea gratuito o solo de referencia?",placeholder:"",required:!0,opciones:["S, solo busco ideas generales","No, estoy dispuesto a pagar por un diseo profesional"],logica:null,mapKey:"expectativaPago",scoring:{enabled:!0,weight:4,rules:{"S, solo busco ideas generales":"red","No, estoy dispuesto a pagar por un diseo profesional":"green"}}},{id:"f_exceder",tipo:"select",label:"Aceptaras una propuesta que supere tu presupuesto, si garantiza calidad y durabilidad?",placeholder:"",required:!0,opciones:["S, puedo ajustarme","No, solo lo hago si es ms barato"],logica:null,mapKey:"flexibilidad",scoring:{enabled:!0,weight:4,rules:{"S, puedo ajustarme":"green","No, solo lo hago si es ms barato":"red"}}},{id:"f_anticipo",tipo:"yesno",label:"Dispuesto a pagar anticipo 30-50%?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"anticipo",scoring:{enabled:!0,weight:5,rules:{S:"green",No:"red"}}},{id:"f_contratistas",tipo:"select",label:"Quieres que te recomendemos contratistas de confianza para la obra?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"contratistas"},{id:"s7",tipo:"seccion",label:"Plazos",desc:"Tiempos del proyecto",required:!1,opciones:[],logica:null},{id:"f_plazo",tipo:"select",label:"Plazo esperado para finalizacin",placeholder:"",required:!0,opciones:["1 - 3 meses","3 - 6 meses","> 6 Meses"],logica:null,mapKey:"plazo",scoring:{enabled:!0,weight:2,rules:{"1 - 3 meses":"red","3 - 6 meses":"neutral","> 6 Meses":"green"}}},{id:"f_inicio",tipo:"date",label:"Fecha tentativa de inicio",placeholder:"",required:!0,opciones:[],logica:null,mapKey:"fechaInicio"},{id:"s8",tipo:"seccion",label:"Informacin de facturacin",desc:"Datos para facturacin electrnica",required:!1,opciones:[],logica:null},{id:"f_mismos_datos",tipo:"yesno",label:"Los datos de facturacin son los mismos del cliente?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"mismosDatosFactura"},{id:"f_fact_info_si",tipo:"info",label:" Se usarn los datos ingresados en la seccin 'Datos del cliente' para la facturacin. Podrs revisarlos antes de confirmar.",desc:"",required:!1,opciones:[],logica:{fieldId:"f_mismos_datos",value:"S"}},{id:"f_razon_social",tipo:"text",label:"Nombre o razn social para facturacin",placeholder:"Escribe tu respuesta aqu...",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"razonSocial"},{id:"f_tipo_doc_fact_co",tipo:"select",label:"Tipo de documento (facturacin)",placeholder:"",required:!0,opciones:["Cdula de ciudadana (CC)","Cdula de extranjera (CE)","NIT","Pasaporte"],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"tipoDocFactura"},{id:"f_num_doc_fact",tipo:"text",label:"Nmero de documento (facturacin)",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"numDocFactura"},{id:"f_email_fact",tipo:"email",label:"Email para envo de factura",placeholder:"name@example.com",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"emailFactura"},{id:"f_dir_fact",tipo:"text",label:"Direccin de facturacin",placeholder:"",required:!0,opciones:[],logica:{fieldId:"f_mismos_datos",value:"No"},mapKey:"dirFacturacion"},{id:"f_forma_pago_co",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Enlace PSE","Tarjeta de Crdito/Dbito","Transferencia bancaria","Nequi / Daviplata"],logica:{fieldId:"f_pais",value:"Colombia"},mapKey:"formaPago"},{id:"f_forma_pago_es",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Bizum","Tarjeta de Crdito/Dbito","Transferencia bancaria","PayPal"],logica:{fieldId:"f_pais",value:"Espaa"},mapKey:"formaPago"},{id:"f_forma_pago_otro",tipo:"select",label:"Forma de pago preferida",placeholder:"",required:!0,opciones:["Tarjeta de Crdito/Dbito","Transferencia bancaria","PayPal"],logica:{fieldId:"f_pais",notValues:["Colombia","Espaa"]},mapKey:"formaPago"},{id:"f_retenciones",tipo:"yesno",label:"Aplican retenciones especiales?",placeholder:"",required:!0,opciones:["S","No"],logica:null,mapKey:"retenciones"},{id:"f_det_ret",tipo:"textarea",label:"Detalle de retenciones",placeholder:"Escribe tu respuesta aqu...",required:!0,opciones:[],logica:{fieldId:"f_retenciones",value:"S"},mapKey:"detalleRetenciones"},{id:"s9",tipo:"seccion",label:"Autorizaciones legales",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_confirmacion",tipo:"info",label:" Confirmacin: La informacin entregada es verdica y ser utilizada nicamente para la elaboracin de la propuesta de diseo. Habitaris S.A.S. garantiza la confidencialidad de los datos y no los compartir con terceros, salvo con proveedores o contratistas de confianza cuando sea necesario para la correcta ejecucin del proyecto, previa autorizacin del cliente.",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_acepta_conf",tipo:"yesno",label:"Confirmas que la informacin es verdica?",placeholder:"",required:!0,opciones:["S","No"],logica:{fieldId:"f_acepta_priv",value:"S"},mapKey:"confirmacion"},{id:"f_habeas",tipo:"info",label:" Autorizacin de tratamiento de datos personales: Al enviar este formulario autorizo a Habitaris S.A.S., para el uso de mis datos personales con el fin de elaborar propuestas de diseo, coordinar servicios relacionados y, en caso de ser necesario, compartirlos con proveedores o contratistas de confianza exclusivamente para la correcta ejecucin del proyecto. En todo momento se garantizar la confidencialidad y proteccin de mi informacin, conforme a la normativa de Habeas Data en Colombia (Ley 1581 de 2012).",desc:"",required:!1,opciones:[],logica:{fieldId:"f_acepta_priv",value:"S"}},{id:"f_acepta_habeas",tipo:"yesno",label:"Autorizas el tratamiento de datos personales?",placeholder:"",required:!0,opciones:["S","No"],logica:{fieldId:"f_acepta_priv",value:"S"},mapKey:"habeasData"}],config:{titulo:"BRIEFING INICIAL",subtitulo:"Cuntanos sobre tu proyecto para preparar la mejor propuesta",mensajeExito:"Gracias por diligenciar el Briefing de tu proyecto. Nos pondremos en contacto contigo pronto.",telRespuesta:"573505661545"}},{id:"encuesta_satisfaccion",nombre:"Encuesta de satisfaccin",modulo:"postventa",desc:"Evaluar experiencia del cliente post-entrega",campos:[{id:xt(),tipo:"seccion",label:"Tu experiencia",desc:"Aydanos a mejorar",required:!1,opciones:[],logica:null},{id:xt(),tipo:"text",label:"Nombre",placeholder:"Tu nombre",required:!0,opciones:[],logica:null},{id:xt(),tipo:"text",label:"Proyecto/Inmueble",placeholder:"Nombre del proyecto o direccin",required:!0,opciones:[],logica:null},{id:xt(),tipo:"rating",label:"Calidad de la construccin",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"rating",label:"Cumplimiento de plazos",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"rating",label:"Atencin al cliente",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"rating",label:"Relacin calidad/precio",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"yesno",label:"Recomendaras nuestros servicios?",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"textarea",label:"Comentarios adicionales",placeholder:"Tu opinin nos importa...",required:!1,opciones:[],logica:null}],config:{titulo:"Encuesta de satisfaccin",subtitulo:"Tu opinin nos ayuda a mejorar",mensajeExito:"Gracias por tu tiempo! Tu opinin es muy valiosa para nosotros."}},{id:"inspeccion_sst",nombre:"Inspeccin SST",modulo:"sst",desc:"Checklist de seguridad en obra",campos:[{id:xt(),tipo:"seccion",label:"Informacin general",desc:"",required:!1,opciones:[],logica:null},{id:xt(),tipo:"text",label:"Proyecto/Obra",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"text",label:"Inspector",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"date",label:"Fecha de inspeccin",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"seccion",label:"Checklist de seguridad",desc:"Evale cada aspecto",required:!1,opciones:[],logica:null},{id:xt(),tipo:"radio",label:"EPPs: Personal usa casco?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:xt(),tipo:"radio",label:"EPPs: Personal usa arns en alturas?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:xt(),tipo:"radio",label:"EPPs: Personal usa botas de seguridad?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:xt(),tipo:"radio",label:"Sealizacin: reas demarcadas?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:xt(),tipo:"radio",label:"Orden y aseo: rea de trabajo limpia?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:xt(),tipo:"radio",label:"Herramientas: En buen estado?",placeholder:"",required:!0,opciones:["Cumple","No cumple","N/A"],logica:null},{id:xt(),tipo:"textarea",label:"Hallazgos y observaciones",placeholder:"Detalle los hallazgos...",required:!1,opciones:[],logica:null},{id:xt(),tipo:"radio",label:"Resultado general",placeholder:"",required:!0,opciones:["Aprobado","Aprobado con observaciones","No aprobado"],logica:null}],config:{titulo:"Inspeccin de Seguridad y Salud",subtitulo:"Checklist de verificacin en obra",mensajeExito:"Inspeccin registrada correctamente."}},{id:"recepcion_material",nombre:"Recepcin de material",modulo:"logistica",desc:"Registrar recepcin en almacn",campos:[{id:xt(),tipo:"text",label:"Orden de compra / Referencia",placeholder:"OC-0001",required:!0,opciones:[],logica:null},{id:xt(),tipo:"text",label:"Proveedor",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"date",label:"Fecha recepcin",placeholder:"",required:!0,opciones:[],logica:null},{id:xt(),tipo:"text",label:"Recibido por",placeholder:"Nombre almacenista",required:!0,opciones:[],logica:null},{id:xt(),tipo:"textarea",label:"Materiales recibidos",placeholder:"Detalle tems, cantidades...",required:!0,opciones:[],logica:null},{id:xt(),tipo:"radio",label:"Estado del material conforme?",placeholder:"",required:!0,opciones:["Conforme","No conforme","Parcialmente conforme"],logica:null},{id:xt(),tipo:"textarea",label:"Observaciones",placeholder:"Notas sobre estado, faltantes...",required:!1,opciones:[],logica:null}],config:{titulo:"Recepcin de material",subtitulo:"Registro de entrada al almacn",mensajeExito:"Recepcin registrada."}}];function Mm({forms:t,setForms:i,editId:o,setEditId:n,onSaved:s,envios:r,addEnvio:a}){var ue,he,we,Ve,Ee,je;const u=o?t.find(V=>V.id===o):null,[h,b]=F.useState((u==null?void 0:u.nombre)||""),[j,C]=F.useState((u==null?void 0:u.modulo)||"general"),[v,m]=F.useState((u==null?void 0:u.campos)||[]),[f,p]=F.useState((u==null?void 0:u.config)||{titulo:"",subtitulo:"",mensajeExito:"Gracias por tu respuesta!",telRespuesta:"",vista:"pasos",colorAccent:"#111111",botonTexto:""}),[c,d]=F.useState(null),[l,x]=F.useState(!1),[y,g]=F.useState(!1),[S,A]=F.useState({nombre:"",email:"",tel:""}),[E,w]=F.useState("Colombia"),[I,z]=F.useState(""),[B,P]=F.useState(""),[q,U]=F.useState(0),[$,Y]=F.useState("");F.useState(null);const ge=V=>{const te=Yr.find(pe=>pe.tipo===V),ce={id:xt(),tipo:V,label:(te==null?void 0:te.lbl)||V,placeholder:"",required:!1,opciones:V==="rating"?[]:V==="yesno"?["S","No"]:[],logica:null,desc:""};["select","radio","chips","rango"].includes(V)&&(ce.opciones=["Opcin 1","Opcin 2"]),m([...v,ce]),d(v.length)},J=(V,te,ce)=>m(v.map((pe,_)=>_===V?{...pe,[te]:ce}:pe)),ye=V=>{m(v.filter((te,ce)=>ce!==V)),c===V?d(null):c>V&&d(c-1)},oe=(V,te)=>{const ce=V+te;if(ce<0||ce>=v.length)return;const pe=[...v];[pe[V],pe[ce]]=[pe[ce],pe[V]],m(pe),d(ce)},L=()=>{if(!h.trim())return;const V={id:(u==null?void 0:u.id)||xt(),nombre:h,modulo:j,campos:v,config:{...f,titulo:f.titulo||h},createdAt:(u==null?void 0:u.createdAt)||Ji(),updatedAt:Ji(),activo:!0};i(u?t.map(te=>te.id===V.id?V:te):[...t,V]),s(V)},R=(V,te)=>{const ce=ji(),pe={id:(u==null?void 0:u.id)||"form",nombre:h,campos:v,config:{...f,titulo:f.titulo||h,paisProyecto:te||"Colombia"},cliente:V||null},_=JSON.stringify(pe),ae=(f.telRespuesta||ce.whatsapp.numero||"").replace(/[^0-9]/g,"");return ce.empresa.nombre.toUpperCase(),ce.empresa.eslogan,`<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>${f.titulo||h||"Formulario"}</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:#F5F4F1;color:#111}
.hdr{background:#111;padding:14px 24px}.hdr-in{max-width:640px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
.logo{font-weight:700;font-size:14px;letter-spacing:3px;color:#fff}.logo-sub{font-size:7px;letter-spacing:2px;color:rgba(255,255,255,.4);text-transform:uppercase;margin-top:2px}
.prog{max-width:640px;margin:8px auto 0;height:3px;background:rgba(255,255,255,.1);border-radius:2px}.prog-bar{height:100%;background:#111111;border-radius:2px;transition:width .3s;width:0%}
.wrap{max-width:640px;margin:0 auto;padding:28px 20px 120px}
.client-b{background:#F0F0F0;border:1px solid rgba(30,79,140,.2);border-radius:8px;padding:12px 16px;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.client-av{width:36px;height:36px;border-radius:50%;background:#3B3B3B;color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700}
.client-n{font-size:13px;font-weight:700;color:#3B3B3B}.client-e{font-size:10px;color:#5A8BC2;margin-top:2px}
.title{text-align:center;margin-bottom:28px}.title h1{font-size:22px;font-weight:700;margin:0 0 6px}.title p{font-size:13px;color:#555}
.card{background:#fff;border-radius:10px;padding:24px 28px;border:1px solid #E0E0E0;box-shadow:0 2px 12px rgba(0,0,0,.04)}
.fld{margin-bottom:16px}.lbl{font-size:11px;font-weight:600;display:block;margin-bottom:5px}.req{color:#B91C1C}
.inp{width:100%;padding:10px 14px;border:1px solid #E0E0E0;border-radius:6px;font-size:14px;font-family:'DM Sans',sans-serif;color:#111;background:#fff;box-sizing:border-box}
.inp:disabled{background:#F0F0F0;border-color:rgba(30,79,140,.27);color:#3B3B3B;font-weight:600}
textarea.inp{resize:vertical}select.inp{appearance:auto}
.sec{margin-top:24px;margin-bottom:12px;padding-top:16px;border-top:2px solid #111}.sec h3{font-size:14px;font-weight:700}.sec p{font-size:11px;color:#909090;margin-top:4px}
.info-b{margin-bottom:16px;padding:12px 16px;background:#F0F0F0;border-radius:8px;border:1px solid rgba(30,79,140,.2);font-size:13px;color:#3B3B3B}
.radio-g{display:flex;flex-direction:column;gap:6px;margin-top:4px}.radio-g label{display:flex;align-items:center;gap:8px;font-size:13px;padding:6px 10px;border-radius:6px;cursor:pointer}
.radio-g label.sel{background:#F0F0F0;border:1px solid rgba(30,79,140,.2)}.radio-g input{accent-color:#111}
.chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}.chip{padding:6px 14px;font-size:12px;border-radius:20px;border:1px solid #E0E0E0;background:#fff;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.chip.sel{background:#111;color:#fff;border-color:#111;font-weight:700}
.stars{display:flex;gap:6px;margin-top:4px}.star{font-size:28px;cursor:pointer;background:none;border:none;transition:all .15s}
.yn{display:flex;gap:8px;margin-top:6px}.yn-btn{padding:10px 24px;font-size:14px;border-radius:24px;border:1px solid #E0E0E0;background:#fff;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s}
.yn-btn.sel{background:#111;color:#fff;border-color:#111;font-weight:700}
.sticky{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:2px solid #111;padding:12px 20px;z-index:200;box-shadow:0 -4px 20px rgba(0,0,0,.08)}
.sticky-in{max-width:640px;margin:0 auto;display:flex;justify-content:center}
.submit{padding:14px 40px;background:#111;color:#fff;border:none;border-radius:6px;font-size:15px;font-weight:700;cursor:pointer;letter-spacing:.5px;font-family:'DM Sans',sans-serif}
.err{font-size:12px;color:#B91C1C;text-align:center;margin:12px 0}
.ok{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#F5F4F1}
.ok-card{background:#fff;border-radius:12px;padding:40px;max-width:480px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,.08)}
.lock{font-size:8px;color:#3B3B3B;font-weight:400}
</style></head><body>
<div id="app"></div>
<script>
const DEF=${_};
const cfg=DEF.config||{};const campos=DEF.campos||[];const cliente=DEF.cliente||null;
const empresaNombre="${ce.empresa.nombre.toUpperCase().replace(/"/g,'\\"')}";
const empresaEslogan="${ce.empresa.eslogan.replace(/"/g,'\\"')}";
const vals={};let submitted=false;
// One-time use check
const privField=campos.find(c=>c.mapKey==='aceptaPrivacidad');
const privId=privField?privField.id:'f_acepta_priv';
const formKey='hab_used_'+(DEF.id||'')+'_'+(cliente?cliente.email||cliente.nombre:'');
if(store.getSync(formKey)){submitted=true;}
// Prefill client fields
if(cliente){campos.forEach(c=>{
  if(cliente.email&&(c.mapKey==="email"||c.tipo==="email"))vals[c.id]=cliente.email;
  if(cliente.nombre&&(c.mapKey==="nombre"||(c.tipo==="text"&&c.label.toLowerCase().includes("nombre"))))vals[c.id]=cliente.nombre;
  if(cliente.tel&&(c.mapKey==="telefono"||c.tipo==="tel"))vals[c.id]=cliente.tel;
});}
// Prefill country from config
const paisProy=cfg.paisProyecto||"Colombia";
const paisCodeMap={"Colombia":"+57","Espaa":"+34","Mxico":"+52","Chile":"+56","Per":"+51","Ecuador":"+593","Argentina":"+54","Panam":"+507","Estados Unidos":"+1","Otro":"+"};
campos.forEach(c=>{
  if(c.mapKey==="pais")vals[c.id]=paisProy;
});
function isLocked(c){if(!cliente)return false;
  if(cliente.email&&(c.mapKey==="email"||c.tipo==="email"))return true;
  if(cliente.nombre&&(c.mapKey==="nombre"||(c.tipo==="text"&&c.label.toLowerCase().includes("nombre"))))return true;
  if(cliente.tel&&cliente.tel.trim()&&(c.mapKey==="telefono"||c.tipo==="tel"||c.tipo==="tel_combo"))return true;
  if(c.mapKey==="pais")return true;
  return false;}
function isVisible(c){if(!c.logica||!c.logica.fieldId)return true;
  if(!c.logica.value&&!c.logica.notValues&&!c.logica.notValue)return true;
  const dv=vals[c.logica.fieldId];
  if(c.logica.notValues){return !c.logica.notValues.includes(String(dv||""));}
  if(c.logica.notValue){return String(dv||"")!==c.logica.notValue;}
  const ex=c.logica.value;
  if(Array.isArray(dv))return dv.includes(ex);return String(dv||"")===ex;}
function render(){
  const app=document.getElementById("app");
  if(submitted){app.innerHTML=\`<div class="ok"><div class="ok-card"><div style="font-size:48px;margin-bottom:12px"></div><h2 style="font-size:20px;font-weight:700;color:#111111;margin:0 0 8px">Enviado!</h2><p style="font-size:13px;color:#555;line-height:1.6">\${cfg.mensajeExito||"Gracias por completar el formulario."}</p></div></div>\`;return;}
  // Privacy gate: if user declined, show goodbye
  if(vals[privId]==='No'){app.innerHTML=\`<div class="ok"><div class="ok-card"><div style="font-size:48px;margin-bottom:12px"></div><h2 style="font-size:20px;font-weight:700;color:#111;margin:0 0 8px">Gracias por tu tiempo</h2><p style="font-size:13px;color:#555;line-height:1.6">Para poder continuar con el briefing, necesitamos tu autorizacin para el tratamiento de datos personales. Si cambias de opinin, vuelve a abrir este formulario.</p></div></div>\`;return;}
  const privAccepted=vals[privId]==='S';
  const privInfoField=campos.find(c=>c.tipo==='info'&&c.label&&c.label.includes('Aviso de Privacidad'));
  const visibleCampos=privAccepted?campos:campos.filter(c=>c.id===privId||(privInfoField&&c.id===privInfoField.id));
  const totalReq=visibleCampos.filter(c=>c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)).length;
  const filledReq=visibleCampos.filter(c=>c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)&&vals[c.id]&&(Array.isArray(vals[c.id])?vals[c.id].length>0:true)).length;
  const pct=totalReq>0?Math.round((filledReq/totalReq)*100):0;
  let h=\`<div class="hdr"><div class="hdr-in"><div><div class="logo">\${empresaNombre}</div><div class="logo-sub">\${empresaEslogan}</div></div><div style="font-size:10px;color:rgba(255,255,255,.4)">\${pct}% completo</div></div><div class="prog"><div class="prog-bar" style="width:\${pct}%"></div></div></div>\`;
  h+=\`<div class="wrap">\`;
  if(cliente){h+=\`<div class="client-b"><div class="client-av">\${(cliente.nombre||cliente.email||"?")[0].toUpperCase()}</div><div><div class="client-n">Formulario para: \${cliente.nombre||cliente.email}</div>\${cliente.email?\`<div class="client-e">\${cliente.email}</div>\`:""}</div></div>\`;}
  h+=\`<div class="title"><h1>\${cfg.titulo||DEF.nombre||"Formulario"}</h1>\${cfg.subtitulo?\`<p>\${cfg.subtitulo}</p>\`:""}</div>\`;
  h+=\`<div class="card">\`;
  visibleCampos.forEach((c,i)=>{
    if(!isVisible(c))return;
    if(c.tipo==="seccion"){h+=\`<div class="sec"><h3>\${c.label}</h3>\${c.desc?\`<p>\${c.desc}</p>\`:""}</div>\`;return;}
    if(c.tipo==="info"){h+=\`<div class="info-b">\${c.label}</div>\`;return;}
    const locked=isLocked(c);const v=vals[c.id]||"";const req=c.required?\`<span class="req"> *</span>\`:"";
    h+=\`<div class="fld">\`;
    if(locked){
      h+=\`<label class="lbl">\${c.label} <span class="lock"> prellenado</span></label>\`;
      if(c.tipo==="tel_combo"){
        const codVal=vals["_cod_"+c.id]||"+57";
        h+=\`<div style="display:flex;gap:0"><div class="inp" style="width:90px;flex-shrink:0;border-radius:6px 0 0 6px;border-right:none;font-weight:700;font-size:13px;color:#3B3B3B;background:#F0F0F0;display:flex;align-items:center;justify-content:center;border-color:rgba(30,79,140,.27)">\${codVal}</div><input class="inp" value="\${v}" disabled style="flex:1;border-radius:0 6px 6px 0"/></div>\`;
      }else if(c.tipo==="select"){h+=\`<select class="inp" disabled><option>\${v}</option></select>\`;}
      else{h+=\`<input class="inp" value="\${v}" disabled/>\`;}
    }else if(c.tipo==="tel_combo"){
      const paisVal=c.paisRef?vals[c.paisRef]:paisProy;
      const defCode=paisCodeMap[paisVal]||"+57";
      if(!vals["_cod_"+c.id])vals["_cod_"+c.id]=defCode;
      const codVal=vals["_cod_"+c.id];
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<div style="display:flex;gap:0"><select class="inp" style="width:90px;flex-shrink:0;border-radius:6px 0 0 6px;border-right:none;font-weight:700;font-size:13px;color:#3B3B3B;background:#F5F4F1" onchange="vals['_cod_'+'\${c.id}']=this.value;render()">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<option value="\${o}" \${codVal===o?"selected":""}>\${o}</option>\`;});
      h+=\`</select><input class="inp" type="tel" value="\${v}" placeholder="\${c.placeholder||""}" style="flex:1;border-radius:0 6px 6px 0" onchange="vals['\${c.id}']=this.value;render()"/></div>\`;
    }else if(["text","email","tel","number","date"].includes(c.tipo)){
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<input class="inp" type="\${c.tipo}" value="\${v}" placeholder="\${c.placeholder||""}" onchange="vals['\${c.id}']=this.value;render()"/>\`;
    }else if(c.tipo==="textarea"){
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<textarea class="inp" rows="3" placeholder="\${c.placeholder||""}" onchange="vals['\${c.id}']=this.value;render()">\${v}</textarea>\`;
    }else if(c.tipo==="select"||c.tipo==="rango"){
      let opts=c.opciones||[];
      if(c.dynamicOpciones){const dv=vals[c.dynamicOpciones.dependsOn]||"";opts=(c.dynamicOpciones.map&&c.dynamicOpciones.map[dv])||c.dynamicOpciones.fallback||[];}
      h+=\`<label class="lbl">\${c.label}\${req}</label>\`;
      h+=\`<select class="inp" onchange="vals['\${c.id}']=this.value;render()"><option value="">Seleccionar...</option>\`;
      opts.forEach(o=>{h+=\`<option value="\${o}" \${v===o?"selected":""}>\${o}</option>\`;});
      h+=\`</select>\`;
    }else if(c.tipo==="radio"){
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="radio-g">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<label class="\${v===o?"sel":""}"><input type="radio" name="r\${c.id}" \${v===o?"checked":""} onchange="vals['\${c.id}']='\${o}';render()"/> \${o}</label>\`;});
      h+=\`</div>\`;
    }else if(c.tipo==="chips"){
      const sel=Array.isArray(vals[c.id])?vals[c.id]:[];
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="chips">\`;
      (c.opciones||[]).forEach(o=>{h+=\`<span class="chip \${sel.includes(o)?"sel":""}" onclick="var s=Array.isArray(vals['\${c.id}'])?vals['\${c.id}']:[];if(s.includes('\${o}'))s=s.filter(x=>x!=='\${o}');else s.push('\${o}');vals['\${c.id}']=s;render()">\${o}</span>\`;});
      h+=\`</div>\`;
    }else if(c.tipo==="rating"){
      const stars=parseInt(v)||0;
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="stars">\`;
      for(let n=1;n<=5;n++){h+=\`<button class="star" style="opacity:\${n<=stars?1:.3};filter:\${n<=stars?"none":"grayscale(1)"}" onclick="vals['\${c.id}']=\${n};render()"></button>\`;}
      h+=\`</div>\${stars>0?\`<div style="font-size:11px;color:#555;margin-top:4px">\${stars} de 5</div>\`:""}\`;
    }else if(c.tipo==="yesno"){
      h+=\`<label class="lbl">\${c.label}\${req}</label><div class="yn">\`;
      ["S","No"].forEach(o=>{h+=\`<button class="yn-btn \${v===o?"sel":""}" onclick="vals['\${c.id}']='\${o}';render()">\${o}</button>\`;});
      h+=\`</div>\`;
    }
    h+=\`</div>\`;
  });
  h+=\`</div><div id="err" class="err"></div></div>\`;
  h+=\`<div class="sticky"><div class="sticky-in"><button class="submit" onclick="doSubmit()">Enviar formulario</button></div></div>\`;
  app.innerHTML=h;
}
function doSubmit(){
  document.getElementById("err").textContent="";
  for(const c of campos){
    if(c.required&&c.tipo!=="seccion"&&c.tipo!=="info"&&isVisible(c)&&!isLocked(c)){
      const v=vals[c.id];if(!v||(Array.isArray(v)&&v.length===0)){document.getElementById("err").textContent='El campo "'+c.label+'" es obligatorio.';return;}
    }
  }
  const lines=campos.filter(c=>c.tipo!=="seccion"&&c.tipo!=="info"&&vals[c.id]).map(c=>{
    let v=Array.isArray(vals[c.id])?vals[c.id].join(", "):vals[c.id];
    if(c.tipo==="tel_combo"){const code=vals["_cod_"+c.id]||"";v=code+" "+v;}
    return" "+c.label+": "+v;});
  const cl=cliente?" Cliente: "+(cliente.nombre||"")+" ("+(cliente.email||"")+")\\n":"";
  const msg=" RESPUESTA: "+(DEF.nombre||"Formulario")+"\\n\\n"+cl+lines.join("\\n")+"\\n\\nFecha: "+new Date().toISOString().split("T")[0];
  const tel="${ae}";
  submitted=true;store.set(formKey,'1');render();
  setTimeout(()=>{window.open("https://wa.me/"+(tel?tel:"")+"?text="+encodeURIComponent(msg),"_blank");},600);
}
render();
<\/script></body></html>`},[T,W]=F.useState(""),X=()=>{var Q,me,le,be,Te,$e,Ye,bt,Ct,ft,wi;if(!S.email&&!S.nombre)return;const V={nombre:S.nombre,email:S.email,tel:((S.codTel||"+57").replace(/[^0-9+]/g,"")+" "+S.tel).trim()},te=R(V,E),ce=new Blob([te],{type:"text/html"}),pe=URL.createObjectURL(ce);z(pe),P(`formulario-${(h||"form").replace(/\s+/g,"-").toLowerCase()}-${(S.nombre||"cliente").replace(/\s+/g,"-").toLowerCase()}.html`);const _=xt()+Date.now().toString(36),ae=ji(),Be=(((Q=ae.app)==null?void 0:Q.url)||"").replace(/\/$/,"");if(Be){const di={linkId:_,maxUsos:q||0,fechaCaducidad:$||""},jr={id:(u==null?void 0:u.id)||"form",nombre:h,campos:v,config:{...f,titulo:f.titulo||h,paisProyecto:E},cliente:V||null,linkConfig:di,modulo:j,marca:{logo:((me=ae.apariencia)==null?void 0:me.logo)||"",colorPrimario:((le=ae.apariencia)==null?void 0:le.colorPrimario)||"#111",colorSecundario:((be=ae.apariencia)==null?void 0:be.colorSecundario)||"#3B3B3B",colorAcento:((Te=ae.apariencia)==null?void 0:Te.colorAcento)||"#111111",tipografia:(($e=ae.apariencia)==null?void 0:$e.tipografia)||"DM Sans",slogan:((Ye=ae.apariencia)==null?void 0:Ye.slogan)||((bt=ae.empresa)==null?void 0:bt.eslogan)||"",empresa:((Ct=ae.empresa)==null?void 0:Ct.nombre)||"Habitaris",razonSocial:((ft=ae.empresa)==null?void 0:ft.razonSocial)||"",domicilio:((wi=ae.empresa)==null?void 0:wi.domicilio)||""}},Zi=Jd(jr);W(`${Be}/form#${Zi}`)}a({id:xt(),formId:(u==null?void 0:u.id)||"nuevo",formNombre:h||"(sin nombre)",cliente:V,fecha:Ji(),hora:new Date().toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}),linkId:_,maxUsos:q||0,expiry:$||""})},[M,O]=F.useState(!1),[ne,ie]=F.useState(!1),re=()=>{if(!I)return;const V=document.createElement("a");V.href=I,V.download=B||"formulario.html",V.click()},H=()=>{const V=ji(),te=S.nombre||"cliente",ce=T?`

 ${T}`:"",pe=V.whatsapp.mensajePlantilla.replace(/\{\{nombre\}\}/g,te).replace(/\{\{formulario\}\}/g,h||"Formulario").replace(/\{\{empresa\}\}/g,V.empresa.nombre)+ce,_=S.tel?(S.codTel||"+57").replace(/[^0-9]/g,"")+S.tel.replace(/[^0-9]/g,""):"";window.open(`https://wa.me/${_}?text=${encodeURIComponent(pe)}`,"_blank")},se=async()=>{if(!S.email){alert("Ingresa el email del cliente");return}const V=ji();O(!0);const te=await Im({client_name:S.nombre||"Cliente",client_email:S.email,form_name:h||"Formulario",from_name:V.empresa.nombre,form_link:T||"En breve recibirs el formulario por WhatsApp."});O(!1),te?(ie(!0),setTimeout(()=>ie(!1),5e3)):alert("Error al enviar. Revisa Configuracin  Correo / EmailJS.")},N=()=>{A({nombre:"",email:"",tel:"",codTel:""}),z(""),P(""),W(""),w("Colombia"),g(!0)},G=c!==null?v[c]:null;return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:[e.jsx("input",{value:h,onChange:V=>b(V.target.value),placeholder:"Nombre del formulario",style:{...kt,fontSize:16,fontWeight:700,padding:"8px 12px",flex:1,maxWidth:400}}),e.jsx("select",{value:j,onChange:V=>C(V.target.value),style:{...kt,width:160},children:Es.map(V=>e.jsx("option",{value:V.id,children:V.lbl},V.id))})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs(So,{v:"sec",on:()=>x(!l),children:[e.jsx(fn,{size:11})," ",l?"Editor":"Vista previa"]}),e.jsxs(So,{v:"sec",on:N,children:[e.jsx(Yc,{size:11})," Compartir"]}),e.jsxs(So,{on:L,children:[e.jsx(yt,{size:11})," ",u?"Actualizar":"Guardar"]})]})]}),e.jsxs(Nt,{style:{padding:"8px 14px",marginBottom:14,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Ttulo pblico"}),e.jsx("input",{value:f.titulo,onChange:V=>p({...f,titulo:V.target.value}),placeholder:h,style:{...kt,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Subttulo"}),e.jsx("input",{value:f.subtitulo||"",onChange:V=>p({...f,subtitulo:V.target.value}),placeholder:"Descripcin breve",style:{...kt,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{flex:1,minWidth:150},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Mensaje de xito"}),e.jsx("input",{value:f.mensajeExito||"",onChange:V=>p({...f,mensajeExito:V.target.value}),placeholder:"Gracias!",style:{...kt,width:"100%",fontSize:10}})]}),e.jsxs("div",{style:{width:130},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Tel WhatsApp"}),e.jsx("input",{value:f.telRespuesta||"",onChange:V=>p({...f,telRespuesta:V.target.value}),placeholder:"573001234567",style:{...kt,width:"100%",fontSize:10}})]})]}),e.jsxs(Nt,{style:{padding:"8px 14px",marginBottom:14,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{minWidth:120},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Vista del formulario"}),e.jsx("div",{style:{display:"flex",gap:4,marginTop:3},children:[{v:"pasos",l:" Paso a paso"},{v:"scroll",l:" Completo"}].map(V=>e.jsx("button",{type:"button",onClick:()=>p({...f,vista:V.v}),style:{...Bm,padding:"4px 10px",fontSize:9,fontWeight:(f.vista||"pasos")===V.v?700:400,borderRadius:4,border:(f.vista||"pasos")===V.v?`2px solid ${fe.ink}`:`1px solid ${fe.border}`,background:(f.vista||"pasos")===V.v?fe.ink:"#fff",color:(f.vista||"pasos")===V.v?"#fff":fe.inkMid,cursor:"pointer"},children:V.l},V.v))})]}),e.jsxs("div",{style:{minWidth:100},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Color del botn"}),e.jsxs("div",{style:{display:"flex",gap:4,marginTop:3,alignItems:"center"},children:[["#111111","#3B3B3B","#111111","#111111","#8B2252"].map(V=>e.jsx("button",{type:"button",onClick:()=>p({...f,colorAccent:V}),style:{width:20,height:20,borderRadius:"50%",background:V,border:(f.colorAccent||"#111111")===V?"3px solid #111111":"2px solid #ddd",cursor:"pointer",padding:0}},V)),e.jsx("input",{type:"color",value:f.colorAccent||"#111111",onChange:V=>p({...f,colorAccent:V.target.value}),style:{width:20,height:20,border:"none",padding:0,cursor:"pointer",borderRadius:4}})]})]}),e.jsxs("div",{style:{flex:1,minWidth:120},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Texto del botn enviar"}),e.jsx("input",{value:f.botonTexto||"",onChange:V=>p({...f,botonTexto:V.target.value}),placeholder:"Enviar formulario",style:{...kt,width:"100%",fontSize:10}})]})]}),l?e.jsxs(Nt,{style:{maxWidth:640,margin:"0 auto",padding:"32px 28px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[e.jsx("h2",{style:{fontSize:20,fontWeight:700,margin:"0 0 4px"},children:f.titulo||h||"Formulario"}),f.subtitulo&&e.jsx("p",{style:{fontSize:12,color:fe.inkMid},children:f.subtitulo})]}),v.map(V=>(Yr.find(te=>te.tipo===V.tipo),V.tipo==="seccion"?e.jsxs("div",{style:{marginTop:20,marginBottom:8,paddingTop:14,borderTop:`2px solid ${fe.ink}`},children:[e.jsx("h3",{style:{fontSize:14,fontWeight:700},children:V.label}),V.desc&&e.jsx("p",{style:{fontSize:10,color:fe.inkMid,marginTop:2},children:V.desc})]},V.id):V.tipo==="info"?e.jsx("div",{style:{marginBottom:12,padding:"10px 14px",background:fe.blueBg,borderRadius:6,fontSize:11,color:fe.blue},children:V.label},V.id):e.jsxs("div",{style:{marginBottom:14},children:[e.jsxs("label",{style:{display:"block",fontSize:11,fontWeight:600,marginBottom:4},children:[V.label,V.required&&e.jsx("span",{style:{color:fe.red},children:" *"})]}),(V.tipo==="text"||V.tipo==="email"||V.tipo==="tel"||V.tipo==="number"||V.tipo==="date")&&e.jsx("input",{type:V.tipo,placeholder:V.placeholder,disabled:!0,style:{...kt,width:"100%",background:"#FFFFFF"}}),V.tipo==="textarea"&&e.jsx("textarea",{rows:2,placeholder:V.placeholder,disabled:!0,style:{...kt,width:"100%",resize:"vertical",background:"#FFFFFF"}}),V.tipo==="select"&&e.jsxs("select",{disabled:!0,style:{...kt,width:"100%",background:"#FFFFFF"},children:[e.jsx("option",{children:"Seleccionar..."}),(V.opciones||[]).map(te=>e.jsx("option",{children:te},te))]}),V.tipo==="radio"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:4},children:(V.opciones||[]).map(te=>e.jsxs("label",{style:{fontSize:11,display:"flex",alignItems:"center",gap:6,padding:"4px 8px",borderRadius:4,background:"#FFFFFF"},children:[e.jsx("input",{type:"radio",name:V.id,disabled:!0}),te]},te))}),V.tipo==="chips"&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:4},children:(V.opciones||[]).map(te=>e.jsx("span",{style:{fontSize:10,padding:"4px 12px",borderRadius:14,border:`1px solid ${fe.border}`,background:"#fff"},children:te},te))}),V.tipo==="rango"&&e.jsxs("select",{disabled:!0,style:{...kt,width:"100%",background:"#FFFFFF"},children:[e.jsx("option",{children:"Seleccionar..."}),(V.opciones||[]).map(te=>e.jsx("option",{children:te},te))]}),V.tipo==="rating"&&e.jsx("div",{style:{display:"flex",gap:4,marginTop:4},children:[1,2,3,4,5].map(te=>e.jsx("span",{style:{fontSize:20,opacity:.3},children:""},te))}),V.tipo==="yesno"&&e.jsx("div",{style:{display:"flex",gap:8,marginTop:4},children:["S","No"].map(te=>e.jsx("span",{style:{fontSize:10,padding:"6px 16px",borderRadius:14,border:`1px solid ${fe.border}`,background:"#fff",fontWeight:600},children:te},te))})]},V.id)))]}):e.jsxs("div",{style:{display:"flex",gap:14},children:[e.jsxs(Nt,{style:{width:180,flexShrink:0,padding:8,alignSelf:"flex-start",position:"sticky",top:20},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",padding:"4px 8px",marginBottom:4},children:"Bloques"}),Yr.map(V=>e.jsxs("button",{onClick:()=>ge(V.tipo),style:{display:"flex",alignItems:"center",gap:6,width:"100%",padding:"6px 8px",border:"none",background:"transparent",borderRadius:4,cursor:"pointer",fontSize:10,color:fe.ink,fontFamily:"'DM Sans',sans-serif",textAlign:"left"},onMouseEnter:te=>te.currentTarget.style.background=fe.accent,onMouseLeave:te=>te.currentTarget.style.background="transparent",children:[e.jsx("span",{children:V.icon})," ",V.lbl]},V.tipo))]}),e.jsxs("div",{style:{flex:1},children:[v.length===0&&e.jsxs(Nt,{style:{textAlign:"center",padding:40,color:fe.inkLight},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("div",{style:{fontSize:14,fontWeight:600},children:"Aade bloques desde el panel izquierdo"}),e.jsx("div",{style:{fontSize:10,marginTop:4},children:"Arrastra y configura los campos de tu formulario"})]}),v.map((V,te)=>{var _,ae,Be;const ce=Yr.find(Q=>Q.tipo===V.tipo),pe=c===te;return e.jsxs("div",{onClick:()=>d(te),style:{background:"#fff",border:`1px solid ${pe?fe.blue:fe.border}`,borderRadius:6,padding:"10px 12px",marginBottom:6,cursor:"pointer",boxShadow:pe?"0 0 0 2px #3B3B3B22":"none",transition:"all .15s",display:"flex",alignItems:"center",gap:8},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("button",{onClick:Q=>{Q.stopPropagation(),oe(te,-1)},style:{background:"none",border:"none",cursor:"pointer",padding:0,color:te===0?fe.inkXLight:fe.inkMid},children:e.jsx(Wa,{size:10})}),e.jsx("button",{onClick:Q=>{Q.stopPropagation(),oe(te,1)},style:{background:"none",border:"none",cursor:"pointer",padding:0,color:te===v.length-1?fe.inkXLight:fe.inkMid},children:e.jsx(kn,{size:10})})]}),e.jsx("span",{style:{fontSize:14},children:(ce==null?void 0:ce.icon)||""}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:11,fontWeight:600},children:[V.label,V.required&&e.jsx("span",{style:{color:fe.red,fontSize:9,marginLeft:4},children:"obligatorio"}),((_=V.scoring)==null?void 0:_.enabled)&&e.jsx("span",{style:{fontSize:9,marginLeft:4},children:""})]}),e.jsxs("div",{style:{fontSize:8,color:fe.inkLight},children:[ce==null?void 0:ce.lbl," ",V.logica?` Condicional: si "${((ae=v.find(Q=>{var me;return Q.id===((me=V.logica)==null?void 0:me.fieldId)}))==null?void 0:ae.label)||"?"}" = "${((Be=V.logica)==null?void 0:Be.value)||"?"}"`:""]})]}),e.jsx("button",{onClick:Q=>{Q.stopPropagation(),J(te,"required",!V.required)},title:V.required?"Obligatorio":"Opcional",style:{background:"none",border:"none",cursor:"pointer",color:V.required?fe.red:fe.inkXLight},children:V.required?e.jsx(Xc,{size:16}):e.jsx(Qc,{size:16})}),e.jsx("button",{onClick:Q=>{Q.stopPropagation(),ye(te)},style:{background:"none",border:"none",cursor:"pointer",color:"#C44"},children:e.jsx(Je,{size:12})})]},V.id)})]}),G&&e.jsxs(Nt,{style:{width:260,flexShrink:0,padding:12,alignSelf:"flex-start",position:"sticky",top:20},children:[e.jsxs("div",{style:{fontSize:10,fontWeight:700,marginBottom:10,display:"flex",alignItems:"center",gap:6},children:[e.jsx(yd,{size:12})," Configurar campo"]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Etiqueta / Pregunta"}),e.jsx("input",{value:G.label,onChange:V=>J(c,"label",V.target.value),style:{...kt,width:"100%"}})]}),G.tipo!=="seccion"&&G.tipo!=="info"&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Placeholder"}),e.jsx("input",{value:G.placeholder||"",onChange:V=>J(c,"placeholder",V.target.value),style:{...kt,width:"100%"}})]}),(G.tipo==="seccion"||G.tipo==="info")&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Descripcin"}),e.jsx("textarea",{value:G.desc||"",onChange:V=>J(c,"desc",V.target.value),rows:2,style:{...kt,width:"100%",resize:"vertical"}})]}),["select","radio","chips","rango"].includes(G.tipo)&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Opciones (una por lnea)"}),e.jsx("textarea",{value:(G.opciones||[]).join(`
`),onChange:V=>J(c,"opciones",V.target.value.split(`
`).filter(Boolean)),rows:4,style:{...kt,width:"100%",resize:"vertical",fontFamily:"'DM Mono',monospace",fontSize:10}})]}),G.tipo!=="seccion"&&G.tipo!=="info"&&e.jsx("div",{style:{marginBottom:8},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:10,fontWeight:600},children:[e.jsx("input",{type:"checkbox",checked:G.required,onChange:V=>J(c,"required",V.target.checked),style:{accentColor:fe.red}}),"Obligatorio"]})}),G.tipo!=="seccion"&&G.tipo!=="info"&&v.filter(V=>V.id!==G.id&&V.tipo!=="seccion"&&V.tipo!=="info").length>0&&e.jsxs("div",{style:{marginBottom:8,borderTop:`1px solid ${fe.border}`,paddingTop:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Lgica condicional"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:9},children:"Mostrar si"}),e.jsxs("select",{value:((ue=G.logica)==null?void 0:ue.fieldId)||"",onChange:V=>{var ce;const te=V.target.value;J(c,"logica",te?{fieldId:te,value:((ce=G.logica)==null?void 0:ce.value)||""}:null)},style:{...kt,fontSize:9,flex:1},children:[e.jsx("option",{value:"",children:"Sin condicin"}),v.filter(V=>V.id!==G.id&&V.tipo!=="seccion"&&V.tipo!=="info").map(V=>e.jsx("option",{value:V.id,children:V.label},V.id))]})]}),((he=G.logica)==null?void 0:he.fieldId)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:4},children:[e.jsx("span",{style:{fontSize:9},children:"= "}),e.jsx("input",{value:((we=G.logica)==null?void 0:we.value)||"",onChange:V=>J(c,"logica",{...G.logica,value:V.target.value}),placeholder:"valor",style:{...kt,fontSize:9,flex:1}})]})]}),e.jsxs("div",{style:{borderTop:`1px solid ${fe.border}`,paddingTop:8},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Clave de mapeo (integracin)"}),e.jsx("input",{value:G.mapKey||"",onChange:V=>J(c,"mapKey",V.target.value),placeholder:"ej: nombre, email",style:{...kt,width:"100%",fontSize:9}})]}),["select","radio","chips","yesno","rango"].includes(G.tipo)&&e.jsxs("div",{style:{borderTop:`1px solid ${fe.border}`,paddingTop:8,marginTop:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",fontSize:10,fontWeight:700,marginBottom:6},children:[e.jsx("input",{type:"checkbox",checked:!!((Ve=G.scoring)!=null&&Ve.enabled),onChange:V=>{const te=G.scoring?{...G.scoring,enabled:V.target.checked}:{enabled:V.target.checked,weight:1,rules:{}};J(c,"scoring",te)},style:{accentColor:"#111111"}})," Regla de scoring"]}),((Ee=G.scoring)==null?void 0:Ee.enabled)&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:6},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Peso"}),e.jsx("select",{value:((je=G.scoring)==null?void 0:je.weight)||1,onChange:V=>J(c,"scoring",{...G.scoring,weight:parseInt(V.target.value)}),style:{...kt,width:60,fontSize:9},children:[1,2,3,4,5].map(V=>e.jsxs("option",{value:V,children:[V," pts"]},V))})]}),e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:4},children:"Clasificar opciones"}),(G.opciones||["S","No"]).map(V=>{var ce,pe;const te=((pe=(ce=G.scoring)==null?void 0:ce.rules)==null?void 0:pe[V])||"neutral";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:3},children:[e.jsx("div",{style:{flex:1,fontSize:9,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:V}),[{v:"green",l:""},{v:"neutral",l:""},{v:"red",l:""}].map(_=>e.jsx("button",{type:"button",onClick:()=>{var Be;const ae={...((Be=G.scoring)==null?void 0:Be.rules)||{},[V]:_.v};J(c,"scoring",{...G.scoring,rules:ae})},style:{width:22,height:22,border:te===_.v?"2px solid #111":"1px solid #ddd",borderRadius:4,background:te===_.v?"#F5F4F1":"#fff",cursor:"pointer",fontSize:12,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:_.l},_.v))]},V)})]})]})]})]}),y&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"flex-start",justifyContent:"center",paddingTop:40,overflowY:"auto"},onClick:()=>g(!1),children:e.jsxs("div",{onClick:V=>V.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:460,maxHeight:"85vh",overflowY:"auto",boxShadow:"0 12px 40px rgba(0,0,0,0.2)",marginBottom:40},children:[e.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:700,marginBottom:4},children:" Enviar formulario a cliente"}),e.jsxs("p",{style:{margin:"0 0 16px",fontSize:10,color:fe.inkMid},children:[h||"Sin nombre","  Se genera un archivo HTML que el cliente abre en su navegador"]}),e.jsxs("div",{style:{background:fe.accent,borderRadius:6,padding:"12px 14px",marginBottom:14},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",marginBottom:8},children:" Datos del cliente"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:6},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Nombre *"}),e.jsx("input",{value:S.nombre,onChange:V=>{A({...S,nombre:V.target.value}),z("")},placeholder:"Juan Prez",style:{...kt,width:"100%",fontSize:11}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Email"}),e.jsx("input",{value:S.email,onChange:V=>{A({...S,email:V.target.value}),z("")},placeholder:"juan@empresa.com",type:"email",style:{...kt,width:"100%",fontSize:11}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"WhatsApp"}),e.jsxs("div",{style:{display:"flex",gap:0},children:[e.jsx("select",{value:S.codTel||{Colombia:"+57",Espaa:"+34",Mxico:"+52",Chile:"+56",Per:"+51",Ecuador:"+593",Argentina:"+54",Panam:"+507","Estados Unidos":"+1"}[E]||"+57",onChange:V=>{A({...S,codTel:V.target.value}),z("")},style:{...kt,width:80,flexShrink:0,borderRadius:"6px 0 0 6px",borderRight:"none",fontWeight:700,fontSize:11,color:"#3B3B3B",background:"#F5F4F1"},children:["+57","+34","+52","+56","+51","+593","+54","+507","+1","+44"].map(V=>e.jsx("option",{value:V,children:V},V))}),e.jsx("input",{value:S.tel,onChange:V=>{A({...S,tel:V.target.value}),z("")},placeholder:"3001234567",style:{...kt,flex:1,fontSize:11,borderRadius:"0 6px 6px 0"}})]})]})]}),e.jsxs("div",{style:{background:"#F5F0FF",borderRadius:6,padding:"12px 14px",marginBottom:14,border:"1px solid #11111122"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#111111",textTransform:"uppercase",marginBottom:8},children:" Pas del proyecto"}),e.jsx("select",{value:E,onChange:V=>{w(V.target.value),z("")},style:{...kt,width:"100%",fontSize:11,marginBottom:8},children:["Colombia","Espaa","Mxico","Chile","Per","Ecuador","Argentina","Panam","Estados Unidos","Otro"].map(V=>e.jsx("option",{value:V,children:V},V))}),e.jsx("div",{style:{fontSize:8,color:"#111111",lineHeight:1.4},children:" Define la divisa, departamentos/comunidades, tipo de documento y cdigo telefnico del formulario"})]}),e.jsxs("div",{style:{background:"#F5F0FF",borderRadius:6,padding:"12px 14px",marginBottom:14,border:"1px solid #11111122"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#111111",textTransform:"uppercase",marginBottom:8},children:" Control del enlace"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Mximo de envos"}),e.jsxs("select",{value:q,onChange:V=>{U(parseInt(V.target.value)),z("")},style:{...kt,width:"100%",fontSize:11},children:[e.jsx("option",{value:0,children:" Ilimitado"}),e.jsx("option",{value:1,children:"1 vez"}),e.jsx("option",{value:2,children:"2 veces"}),e.jsx("option",{value:3,children:"3 veces"}),e.jsx("option",{value:5,children:"5 veces"}),e.jsx("option",{value:10,children:"10 veces"})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:"Fecha de caducidad"}),e.jsx("input",{type:"date",value:$,onChange:V=>{Y(V.target.value),z("")},min:new Date().toISOString().split("T")[0],style:{...kt,width:"100%",fontSize:11}})]})]}),e.jsxs("div",{style:{fontSize:8,color:"#111111",marginTop:6,lineHeight:1.4},children:[q>0?` El cliente podr enviar mximo ${q} ${q===1?"vez":"veces"}`:" Sin lmite de envos",$?`   Caduca el ${new Date($+"T23:59:59").toLocaleDateString("es-CO",{day:"numeric",month:"short",year:"numeric"})}`:"  Sin caducidad"]})]}),I?e.jsxs("div",{style:{marginBottom:10,padding:"8px 10px",background:fe.greenBg,borderRadius:4,border:`1px solid ${fe.green}33`,fontSize:9,color:fe.green,fontWeight:600},children:[" Formulario listo para ",S.nombre||S.email,"  ",e.jsx("strong",{children:B}),T&&e.jsx("div",{style:{marginTop:4,fontSize:8,color:fe.inkMid,fontWeight:400},children:" Link pblico generado  se enviar por email y WhatsApp automticamente"})]}):e.jsx(So,{on:X,style:{width:"100%",justifyContent:"center",marginBottom:14,padding:"10px 0"},disabled:!S.nombre,children:" Generar formulario personalizado"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,opacity:I?1:.4,pointerEvents:I?"auto":"none"},children:[e.jsxs("button",{onClick:re,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${fe.border}`,borderRadius:6,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:fe.greenBg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Bt,{size:14,color:fe.green})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:" Descargar formulario (.html)"}),e.jsx("div",{style:{fontSize:8,color:fe.inkMid},children:"Archivo que puedes adjuntar por WhatsApp o email"})]})]}),e.jsxs("button",{onClick:H,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${fe.border}`,borderRadius:6,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:"#E8F8E8",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ms,{size:14,color:"#25D366"})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:"Abrir WhatsApp"}),e.jsx("div",{style:{fontSize:8,color:fe.inkMid},children:S.tel?`Mensaje al ${S.codTel||"+57"} ${S.tel}`:"Adjunta el archivo descargado"})]})]}),e.jsxs("button",{onClick:se,disabled:M,style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",border:`1px solid ${ne?fe.green:fe.border}`,borderRadius:6,background:ne?fe.greenBg:"#fff",cursor:M?"wait":"pointer",fontFamily:"'DM Sans',sans-serif",textAlign:"left",opacity:M?.6:1},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,background:ne?fe.greenBg:fe.amberBg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(fr,{size:14,color:ne?fe.green:fe.amber})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:11,fontWeight:700},children:M?"Enviando...":ne?" Email enviado con link":` Enviar email con link (${ji().correo.emailPrincipal})`}),e.jsx("div",{style:{fontSize:8,color:fe.inkMid},children:ne?`Enviado a ${S.email} con link directo`:S.email?"El cliente recibe email con link al formulario":"Ingresa email del cliente"})]})]})]}),e.jsxs("div",{style:{marginTop:12,padding:"8px 10px",background:fe.accent,borderRadius:4,fontSize:8,color:fe.inkMid,lineHeight:1.5},children:[" ",e.jsx("strong",{children:"Flujo recomendado:"}),e.jsx("br",{}),"1 ",e.jsx("strong",{children:"Email"}),"  el cliente recibe un link directo al formulario",e.jsx("br",{}),"2 ",e.jsx("strong",{children:"WhatsApp"}),"  tambin incluye el link al formulario",e.jsx("br",{}),"3 ",e.jsx("strong",{children:"Descargar"}),"  archivo .html de respaldo (funciona sin internet)"]}),e.jsx(So,{v:"sec",on:()=>g(!1),style:{width:"100%",marginTop:10,justifyContent:"center"},children:"Cerrar"})]})})]})}function _m({forms:t,setForms:i,onEdit:o,onNew:n}){const[s,r]=F.useState(""),a=t.filter(b=>{var C,v;const j=s.toLowerCase();return!j||((C=b.nombre)==null?void 0:C.toLowerCase().includes(j))||((v=b.modulo)==null?void 0:v.toLowerCase().includes(j))}),u=b=>{confirm("Eliminar formulario?")&&i(t.filter(j=>j.id!==b))},h=b=>i([...t,{...b,id:xt(),nombre:b.nombre+" (copia)",createdAt:Ji(),updatedAt:Ji()}]);return e.jsxs("div",{className:"fade-up",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Mis formularios  ",t.length]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ki,{size:12,style:{position:"absolute",left:8,top:8,color:fe.inkLight}}),e.jsx("input",{value:s,onChange:b=>r(b.target.value),placeholder:"Buscar...",style:{...kt,paddingLeft:26,width:180}})]}),e.jsxs(So,{on:n,children:[e.jsx(Ne,{size:11})," Nuevo formulario"]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280,1fr))",gap:12},children:a.map(b=>{const j=(b.campos||[]).filter(m=>m.tipo!=="seccion"&&m.tipo!=="info").length,C=(b.campos||[]).filter(m=>m.required).length,v=Es.find(m=>m.id===b.modulo);return e.jsxs(Nt,{style:{padding:0,overflow:"hidden",cursor:"pointer"},onClick:()=>o(b.id),children:[e.jsxs("div",{style:{padding:"14px 16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:b.nombre}),e.jsxs("div",{style:{fontSize:9,color:fe.inkMid,marginTop:2},children:[j," campos  ",C," obligatorios"]})]}),e.jsx(Zn,{color:fe.blue,children:(v==null?void 0:v.lbl)||"General"})]}),e.jsxs("div",{style:{fontSize:8,color:fe.inkLight,marginTop:6},children:["Creado: ",b.createdAt,"  Editado: ",b.updatedAt]})]}),e.jsxs("div",{style:{borderTop:`1px solid ${fe.border}`,display:"flex",padding:"0"},children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),o(b.id)},style:{flex:1,padding:"6px 0",border:"none",background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:fe.blue,fontFamily:"'DM Sans',sans-serif"},children:" Editar"}),e.jsx("button",{onClick:m=>{m.stopPropagation(),h(b)},style:{flex:1,padding:"6px 0",border:"none",borderLeft:`1px solid ${fe.border}`,background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:fe.inkMid,fontFamily:"'DM Sans',sans-serif"},children:" Duplicar"}),e.jsx("button",{onClick:m=>{m.stopPropagation(),u(b.id)},style:{flex:1,padding:"6px 0",border:"none",borderLeft:`1px solid ${fe.border}`,background:"transparent",cursor:"pointer",fontSize:9,fontWeight:600,color:fe.red,fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]},b.id)})})]})}function Dm({forms:t,respuestas:i,onReload:o,loading:n,onDelete:s,onClearAll:r}){const[a,u]=F.useState(""),[h,b]=F.useState(null),[j,C]=F.useState(new Set),[v,m]=F.useState(!1),[f,p]=F.useState(""),[c,d]=F.useState(null),[l,x]=F.useState(!1),[y,g]=F.useState(!1),[S,A]=F.useState(()=>{try{return JSON.parse(Fe.getSync("hab:form:procesados")||"[]")}catch{return[]}}),[E,w]=F.useState("todos");F.useEffect(()=>{Promise.resolve(!1).then(x)},[]);const I=T=>C(W=>{const X=new Set(W);return X.has(T)?X.delete(T):X.add(T),X}),z=T=>C(W=>W.size===T.length?new Set:new Set(T)),B=Fe.getSync("hab:form:deletePass")||"",P=B||y,q=async T=>{if(!P){U(T);return}if(y){if(B){d(T),p(""),m(!0);return}return}B&&(d(T),p(""),m(!0))},U=T=>{T.type==="single"&&s?s(T.target):T.type==="selected"&&s?(j.forEach(W=>{const X=i.find(M=>M.id===W);X&&s(X)}),C(new Set)):T.type==="all"&&r&&(r(),C(new Set)),m(!1),d(null)},$=()=>{f===B?U(c):alert("Contrasea incorrecta")},Y=(T,W)=>{const X=[...S,T];A(X),Fe.set("hab:form:procesados",JSON.stringify(X))},ge=(T,W)=>{const X=S.filter(M=>M!==T);A(X),Fe.set("hab:form:procesados",JSON.stringify(X))},J=T=>T.processed||S.includes(T.id),ye=async T=>{var W,X,M,O,ne;try{let ie=[];try{const G=Fe.getSync("hab:crm:clientes2");G&&(ie=JSON.parse(G)||[])}catch{}const re=ie.find(G=>G.email&&G.email===T.clienteEmail);let H;if(re)H=re.id;else{const G={id:Math.random().toString(36).slice(2,9),nombre:T.razonSocial||T.clienteNombre||"",tipo:T.razonSocial?"Empresa":"Persona natural",nit:T.documento||"",email:T.clienteEmail||"",telMovil:T.clienteTel||T.telefono||"",prefijoMovil:"+57",ciudad:T.ciudad||"",pais:"CO",notas:[T.edificio?`Proyecto: ${T.edificio}`:"",T.tipoProyecto?`Tipo: ${T.tipoProyecto}`:"",T.area?`rea: ${T.area} m`:"",T.presupuesto?`Presupuesto: ${Number(T.presupuesto).toLocaleString("es-CO")}`:""].filter(Boolean).join(" | "),emailFactura:T.emailFactura||T.clienteEmail||"",dirFacturacion:T.dirFacturacion||"",briefingId:T.id,fechaAlta:new Date().toISOString().split("T")[0]};ie.push(G),H=G.id,Fe.set("hab:crm:clientes2",JSON.stringify(ie))}let se=[];try{const G=Fe.getSync("hab:v4");G&&(se=JSON.parse(G)||[])}catch{}const N={id:Math.random().toString(36).slice(2,9)+Date.now().toString(36),nombre:[T.edificio,(W=T.clienteNombre)==null?void 0:W.split(" ").slice(-1)[0]].filter(Boolean).join("  ")||"Nuevo proyecto",cliente:T.clienteNombre||T.razonSocial||"",clienteId:H,email:T.clienteEmail||"",telefono:T.clienteTel||T.telefono||"",direccion:[T.ciudad,T.edificio].filter(Boolean).join("  "),tipoProyecto:T.tipoProyecto||"",estado:"borrador",fechaOferta:new Date().toISOString().split("T")[0],presupuestoCliente:T.presupuesto?Number(String(T.presupuesto).replace(/[^0-9]/g,"")):0,m2:T.area||"",notas:[(X=T.servicios)!=null&&X.length?`Servicios: ${Array.isArray(T.servicios)?T.servicios.join(", "):T.servicios}`:"",(M=T.estilo)!=null&&M.length?`Estilo: ${Array.isArray(T.estilo)?T.estilo.join(", "):T.estilo}`:"",(O=T.espacios)!=null&&O.length?`Espacios: ${Array.isArray(T.espacios)?T.espacios.join(", "):T.espacios}`:"",T.colores?`Materiales: ${T.colores}`:"",(ne=T.expectativas)!=null&&ne.length?`Expectativas: ${Array.isArray(T.expectativas)?T.expectativas.join("; "):T.expectativas}`:"",T.linksReferentes?`Referencias: ${T.linksReferentes}`:""].filter(Boolean).join(`
`),razonSocial:T.razonSocial||"",documento:T.documento||"",emailFactura:T.emailFactura||T.clienteEmail||"",dirFacturacion:T.dirFacturacion||"",retencion:T.retenciones==="S",detalleRet:T.detalleRetenciones||"",anticipoAcept:T.anticipo||"",formaPago:T.formaPago||"",briefingId:T.id,lineas:[],capitulos:[],cronograma:[]};se.push(N),Fe.set("hab:v4",JSON.stringify(se)),Y(T.id,T._sbId),alert(` Procesado:

 Cliente: ${re?"ya exista":"creado"}  ${T.clienteNombre||T.clienteEmail}
 Oferta borrador creada en CRM (hab:v4)

Ve a CRM  Ofertas para continuar.`)}catch(ie){console.error("procesarRespuesta error:",ie),alert("Error procesando respuesta: "+ie.message)}};let oe=a?i.filter(T=>T.formularioId===a):i;E==="pendiente"&&(oe=oe.filter(T=>!J(T))),E==="procesado"&&(oe=oe.filter(T=>J(T)));const L=i.filter(T=>!J(T)),R=T=>{var N,G;const W=ji(),X=t.find(ue=>ue.id===T.formularioId)||t.find(ue=>ue.nombre===T.formularioNombre),M=(X==null?void 0:X.campos)||[],O=["id","fecha","formularioId","formularioNombre","clienteNombre","clienteEmail","clienteTel"],ne=[];let ie={title:"Informacin general",fields:[]};M.forEach(ue=>{if(ue.tipo==="seccion")ie.fields.length>0&&ne.push(ie),ie={title:ue.label,desc:ue.desc||"",fields:[]};else if(ue.tipo!=="info"){const he=ue.mapKey||ue.id;let we=T[he];we===void 0&&Object.entries(T).filter(([Ve])=>!O.includes(Ve)).forEach(([Ve,Ee])=>{(Ve===ue.label||Ve===ue.mapKey)&&(we=Ee)}),we!==void 0&&ie.fields.push({label:ue.label,value:Array.isArray(we)?we.join(", "):String(we),tipo:ue.tipo})}}),ie.fields.length>0&&ne.push(ie),(ne.length===0||ne.every(ue=>ue.fields.length===0))&&(ne.length=0,ne.push({title:"Respuestas",desc:"",fields:Object.entries(T).filter(([ue])=>!O.includes(ue)).map(([ue,he])=>({label:ue,value:Array.isArray(he)?he.join(", "):String(he),tipo:"text"}))}));const re=new Date().toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}),H=`<!DOCTYPE html><html><head><meta charset="utf-8">
<style>
@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;color:#111;background:#fff}
@page{size:A4;margin:0}
.page{width:210mm;min-height:297mm;margin:0 auto;padding:0;position:relative}

/* Header */
.header{background:#111;color:#fff;padding:28px 36px;display:flex;justify-content:space-between;align-items:center}
.logo{font-size:18px;font-weight:800;letter-spacing:5px;text-transform:uppercase}
.logo-sub{font-size:7px;letter-spacing:3px;color:rgba(255,255,255,.4);text-transform:uppercase;margin-top:2px}
.header-right{text-align:right}
.header-right div{font-size:8px;color:rgba(255,255,255,.5);letter-spacing:1px}

/* Gold bar */
.gold-bar{height:3px;background:linear-gradient(90deg,#111111,#E8D48B,#111111)}

/* Title block */
.title-block{padding:28px 36px 20px;border-bottom:1px solid #E0E0E0}
.doc-type{font-size:8px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#909090;margin-bottom:4px}
.doc-title{font-size:22px;font-weight:700;line-height:1.2;margin-bottom:6px}
.doc-meta{display:flex;gap:24px;margin-top:10px}
.meta-item{font-size:9px;color:#555}
.meta-item strong{color:#111;font-weight:700}

/* Client card */
.client-card{margin:20px 36px;background:#F5F4F1;border:1px solid #E0E0E0;border-radius:6px;padding:16px 20px;display:flex;align-items:center;gap:14px}
.client-avatar{width:42px;height:42px;border-radius:50%;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;flex-shrink:0}
.client-info{flex:1}
.client-name{font-size:14px;font-weight:700}
.client-email{font-size:10px;color:#3B3B3B;margin-top:2px}
.client-tel{font-size:9px;color:#909090;margin-top:1px}

/* Sections */
.section{margin:20px 36px}
.section-title{font-size:12px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:#111;padding-bottom:6px;border-bottom:2px solid #111;margin-bottom:12px;display:flex;align-items:center;gap:6px}
.section-desc{font-size:9px;color:#909090;margin:-8px 0 12px;font-weight:400}

/* Fields */
.field{margin-bottom:10px;display:flex;border-bottom:1px solid #F0EEEA;padding-bottom:8px}
.field-label{width:180px;flex-shrink:0;font-size:9px;font-weight:700;color:#555;text-transform:uppercase;letter-spacing:.5px;padding-top:2px}
.field-value{flex:1;font-size:12px;font-weight:500;color:#111}
.field-rating{color:#111111;font-size:14px;letter-spacing:2px}

/* Footer */
.footer{position:fixed;bottom:0;left:0;right:0;background:#111;color:#fff;padding:12px 36px;display:flex;justify-content:space-between;align-items:center;font-size:7px;letter-spacing:2px}
.footer-gold{height:2px;background:linear-gradient(90deg,#111111,#E8D48B,#111111)}

/* Print */
@media print{
  body{-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .page{width:100%;min-height:auto}
  .no-print{display:none!important}
}
</style></head><body>
<div class="page">
  <!-- Header -->
  <div class="header">
    <div>
      <div class="logo">${W.empresa.nombre.toUpperCase()}</div>
      <div class="logo-sub">${W.empresa.eslogan}</div>
    </div>
    <div class="header-right">
      <div>INFORME DE FORMULARIO</div>
      <div style="margin-top:4px;font-size:9px;color:rgba(255,255,255,.7)">${re}</div>
    </div>
  </div>
  <div class="gold-bar"></div>

  <!-- Title -->
  <div class="title-block">
    <div class="doc-type">Formulario</div>
    <div class="doc-title">${T.formularioNombre||(X==null?void 0:X.nombre)||"Respuesta"}</div>
    <div class="doc-meta">
      <div class="meta-item"><strong>Fecha respuesta:</strong> ${T.fecha}</div>
      <div class="meta-item"><strong>ID:</strong> ${((N=T.id)==null?void 0:N.slice(0,8))||""}</div>
      ${X?`<div class="meta-item"><strong>Mdulo:</strong> ${((G=Es.find(ue=>ue.id===X.modulo))==null?void 0:G.lbl)||"General"}</div>`:""}
      <div class="meta-item"><strong>Campos:</strong> ${ne.reduce((ue,he)=>ue+he.fields.length,0)}</div>
    </div>
  </div>

  <!-- Client card -->
  ${T.clienteNombre||T.clienteEmail?`
  <div class="client-card">
    <div class="client-avatar">${(T.clienteNombre||T.clienteEmail||"?")[0].toUpperCase()}</div>
    <div class="client-info">
      ${T.clienteNombre?`<div class="client-name">${T.clienteNombre}</div>`:""}
      ${T.clienteEmail?`<div class="client-email">${T.clienteEmail}</div>`:""}
      ${T.clienteTel?`<div class="client-tel"> ${T.clienteTel}</div>`:""}
    </div>
  </div>`:""}

  <!-- Scoring -->
  ${function(){var ue=ua(T,X);if(!ue)return"";var he={green:{bg:"#E8F4EE",border:"#111111",text:"#111111"},yellow:{bg:"#FAF0E0",border:"#8C6A00",text:"#8C6A00"},red:{bg:"#FAE8E8",border:"#B91C1C",text:"#B91C1C"}},we=he[ue.level],Ve=ue.details.map(function(Ee){var je=Ee.flag==="green"?"#111111":Ee.flag==="red"?"#B91C1C":"#8C6A00",V=Ee.flag==="green"?"":Ee.flag==="red"?"":"";return'<tr style="border-bottom:1px solid #F0EEEA"><td style="padding:6px 12px;font-weight:600">'+Ee.label+'</td><td style="padding:6px 12px">'+Ee.value+'</td><td style="padding:6px 12px;text-align:center;font-weight:700;color:'+je+';font-family:DM Mono,monospace">'+Ee.points+"/"+Ee.maxPoints+'</td><td style="padding:6px 12px;text-align:center">'+V+"</td></tr>"}).join("");return'<div style="margin:20px 36px;border:1px solid '+we.border+'44;border-radius:8px;overflow:hidden"><div style="display:flex;align-items:center;gap:16px;padding:16px 20px;background:'+we.bg+'"><div style="font-size:28px;font-weight:800;font-family:DM Mono,monospace;color:'+we.text+'">'+ue.score.toFixed(1)+'<span style="font-size:12px">/10</span></div><div style="flex:1"><div style="font-size:14px;font-weight:700;color:'+we.text+'">'+ue.levelLabel+'</div><div style="font-size:9px;color:'+we.text+';opacity:.8;margin-top:2px">'+ue.conclusion+'</div></div><div style="display:flex;gap:10px"><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#111111">'+ue.greens+'</div><div style="font-size:8px;color:#888"></div></div><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#8C6A00">'+ue.yellows+'</div><div style="font-size:8px;color:#888"></div></div><div style="text-align:center"><div style="font-size:14px;font-weight:800;color:#B91C1C">'+ue.reds+'</div><div style="font-size:8px;color:#888"></div></div></div></div><table style="width:100%;border-collapse:collapse;font-size:10px"><thead><tr style="background:#F5F4F1"><th style="padding:6px 12px;text-align:left;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Criterio</th><th style="padding:6px 12px;text-align:left;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Respuesta</th><th style="padding:6px 12px;text-align:center;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0">Puntos</th><th style="padding:6px 12px;text-align:center;font-size:8px;font-weight:700;color:#888;text-transform:uppercase;border-bottom:1px solid #E0E0E0"></th></tr></thead><tbody>'+Ve+"</tbody></table></div>"}()}

  <!-- Sections -->
  ${ne.map((ue,he)=>`
  <div class="section">
    <div class="section-title"><span style="color:#111111"></span> ${ue.title}</div>
    ${ue.desc?`<div class="section-desc">${ue.desc}</div>`:""}
    ${ue.fields.map(we=>`
    <div class="field">
      <div class="field-label">${we.label}</div>
      <div class="field-value">${we.tipo==="rating"?`<span class="field-rating">${"".repeat(parseInt(we.value)||0)}${"".repeat(5-(parseInt(we.value)||0))}</span> <span style="font-size:10px;color:#909090">(${we.value}/5)</span>`:we.tipo==="yesno"?`<span style="display:inline-block;padding:2px 12px;border-radius:10px;font-size:10px;font-weight:700;background:${we.value==="S"?"#E8F4EE":"#FAE8E8"};color:${we.value==="S"?"#111111":"#B91C1C"}">${we.value}</span>`:we.value}</div>
    </div>`).join("")}
  </div>`).join("")}

  <!-- Confidentiality -->
  <div style="margin:30px 36px;padding:12px 16px;background:#F5F4F1;border-radius:4px;border-left:3px solid #111111">
    <div style="font-size:7px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#909090;margin-bottom:4px">CONFIDENCIALIDAD</div>
    <div style="font-size:8px;color:#555;line-height:1.6">Este documento contiene informacin confidencial de ${W.empresa.nombre} y su cliente. Queda prohibida su reproduccin o distribucin sin autorizacin expresa.</div>
  </div>

  <!-- Footer -->
  <div class="footer-gold" style="position:fixed;bottom:28px;left:0;right:0"></div>
  <div class="footer">
    <span>${W.empresa.nombre.toUpperCase()}  ${T.formularioNombre||""}  ${T.clienteNombre||""}</span>
    <span>${re}</span>
  </div>
</div>

<!-- Print button -->
<div class="no-print" style="position:fixed;top:12px;right:12px;display:flex;gap:8px;z-index:100">
  <button onclick="window.print()" style="padding:10px 24px;background:#111;color:#fff;border:none;border-radius:6px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;letter-spacing:1px"> Imprimir / PDF</button>
  <button onclick="window.close()" style="padding:10px 16px;background:#fff;color:#111;border:1px solid #E0E0E0;border-radius:6px;font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer"> Cerrar</button>
</div>
</body></html>`,se=window.open("","_blank");se.document.write(H),se.document.close()};return e.jsxs("div",{className:"fade-up",children:[L.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",background:"#F3EEFF",border:"1px solid #11111133",borderRadius:8,marginBottom:14},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:"#111111",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:700,flexShrink:0},children:L.length}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#111111"},children:[" Tienes ",L.length," formulario",L.length>1?"s":""," sin asignar"]}),e.jsx("div",{style:{fontSize:9,color:"#555555",marginTop:2},children:'Haz clic en "Procesar" para crear cliente y borrador de oferta en CRM automticamente'})]}),e.jsx("button",{onClick:()=>w("pendiente"),style:{padding:"6px 14px",fontSize:10,fontWeight:700,background:"#111111",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Ver pendientes"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Respuestas  ",i.length]}),o&&e.jsxs("button",{onClick:o,disabled:n,style:{padding:"4px 10px",fontSize:9,fontWeight:600,cursor:n?"wait":"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${fe.border}`,borderRadius:4,background:"#fff",color:fe.inkMid,opacity:n?.5:1},children:[" ",n?"Cargando...":"Recargar"]}),j.size>0&&e.jsxs("button",{onClick:()=>q({type:"selected"}),style:{padding:"4px 14px",fontSize:9,fontWeight:700,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:"none",borderRadius:4,background:fe.red,color:"#fff"},children:[" Eliminar seleccionados (",j.size,")"]}),j.size===0&&r&&i.length>0&&e.jsx("button",{onClick:()=>q({type:"all"}),style:{padding:"4px 10px",fontSize:9,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${fe.red}44`,borderRadius:4,background:"#fff",color:fe.red},children:" Limpiar todo"}),e.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[l&&e.jsx("button",{onClick:async()=>{y?confirm("Desactivar Touch ID / biometra?")&&g(!1):alert("No se pudo registrar. Intenta de nuevo.")},style:{background:"none",border:`1px solid ${y?"#111111":"#ddd"}`,borderRadius:4,cursor:"pointer",fontSize:10,padding:"3px 8px",color:y?"#111111":"#888"},title:y?"Touch ID activo  clic para desactivar":"Activar Touch ID",children:y?" Touch ID":" Activar Touch ID"}),e.jsx("button",{onClick:()=>{const T=Fe.getSync("hab:form:deletePass")||"",W=prompt("Contrasea para eliminar (dejar vaco para desactivar):",T);W!==null&&(W?Fe.set("hab:form:deletePass",W):Fe.delete("hab:form:deletePass"))},style:{background:"none",border:"none",cursor:"pointer",fontSize:12,opacity:.4},title:B?" Contrasea activa  clic para cambiar":" Sin contrasea  clic para configurar",children:B?"":""})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{display:"flex",gap:0},children:[{v:"todos",l:"Todos"},{v:"pendiente",l:" Pendientes"},{v:"procesado",l:" Procesados"}].map((T,W)=>e.jsx("button",{onClick:()=>w(T.v),style:{padding:"5px 12px",fontSize:9,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",border:`1px solid ${fe.border}`,borderLeft:W>0?"none":void 0,borderRadius:W===0?"4px 0 0 4px":W===2?"0 4px 4px 0":"0",background:E===T.v?"#111":"#fff",color:E===T.v?"#fff":fe.inkMid},children:T.l},T.v))}),e.jsxs("select",{value:a,onChange:T=>u(T.target.value),style:{...kt,width:200},children:[e.jsx("option",{value:"",children:"Todos los formularios"}),t.map(T=>e.jsx("option",{value:T.id,children:T.nombre},T.id))]})]})]}),e.jsx(Nt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F0F0F0"},children:[e.jsx("th",{style:{...fs,width:30},children:e.jsx("input",{type:"checkbox",checked:oe.length>0&&j.size===oe.length,onChange:()=>z(oe.map(T=>T.id)),style:{cursor:"pointer"}})}),["Fecha","Hora","Formulario","Cliente","Email","Score","Estado","Acciones"].map(T=>e.jsx("th",{style:fs,children:T},T))]})}),e.jsx("tbody",{children:oe.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,style:{padding:24,textAlign:"center",color:fe.inkLight,fontSize:11},children:["Sin respuestas",E!=="todos"?" con este filtro":""]})}):oe.sort((T,W)=>(W.fecha||"").localeCompare(T.fecha||"")).map(T=>{var ie;const W=J(T),X=T.created_at?new Date(T.created_at):null,M=X?X.toISOString().split("T")[0]:T.fecha||"",O=X?X.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}):"",ne=(h==null?void 0:h.id)===T.id;return e.jsxs(hr.Fragment,{children:[e.jsxs("tr",{style:{cursor:"pointer",background:j.has(T.id)?"#FDF5F5":ne?"#F0EEFF":W?"":"#FDFBFF",transition:"background .15s"},onClick:()=>b(ne?null:T),children:[e.jsx("td",{style:{...Kt,width:30},onClick:re=>re.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:j.has(T.id),onChange:()=>I(T.id),style:{cursor:"pointer"}})}),e.jsx("td",{style:{...Kt,fontFamily:"'DM Mono',monospace",fontSize:9},children:M}),e.jsx("td",{style:{...Kt,fontSize:9},children:O}),e.jsx("td",{style:{...Kt,fontWeight:600,fontSize:10},children:T.formularioNombre||((ie=t.find(re=>re.id===T.formularioId))==null?void 0:ie.nombre)||""}),e.jsx("td",{style:{...Kt,fontWeight:600,fontSize:10},children:T.clienteNombre||""}),e.jsx("td",{style:{...Kt,fontSize:9,color:fe.blue},children:T.clienteEmail||""}),e.jsx("td",{style:{...Kt,textAlign:"center"},children:(()=>{const re=t.find(ue=>ue.id===T.formularioId)||t.find(ue=>ue.nombre===T.formularioNombre),H=ua(T,re);if(!H)return e.jsx("span",{style:{fontSize:8,color:fe.inkLight},children:""});const se=H.level==="green"?fe.green:H.level==="red"?fe.red:fe.amber,N=H.level==="green"?fe.greenBg:H.level==="red"?fe.redBg:fe.amberBg,G=H.level==="green"?"":H.level==="red"?"":"";return e.jsxs("span",{style:{fontSize:9,fontWeight:700,padding:"2px 8px",borderRadius:10,background:N,color:se},children:[G," ",H.score.toFixed(1)]})})()}),e.jsx("td",{style:Kt,children:W?e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:fe.greenBg,color:fe.green},children:" Procesado"}):e.jsx("span",{style:{fontSize:8,fontWeight:700,padding:"2px 8px",borderRadius:10,background:"#F3EEFF",color:"#111111"},children:" Pendiente"})}),e.jsxs("td",{style:{...Kt,whiteSpace:"nowrap"},children:[e.jsx("button",{onClick:re=>{re.stopPropagation(),b(ne?null:T)},style:{background:"none",border:"none",cursor:"pointer",marginRight:4},title:"Ver detalle",children:ne?e.jsx(Wa,{size:11,color:fe.blue}):e.jsx(kn,{size:11,color:fe.blue})}),e.jsx("button",{onClick:re=>{re.stopPropagation(),R(T)},style:{background:"none",border:"none",cursor:"pointer",marginRight:4},title:"Generar informe",children:e.jsx(Bt,{size:11,color:fe.ink})}),!W&&e.jsx("button",{onClick:re=>{re.stopPropagation(),ye(T)},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:"#111111",color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},title:"Crear cliente + oferta en CRM",children:" Procesar"}),W&&e.jsx("button",{onClick:re=>{re.stopPropagation(),ge(T.id,T._sbId)},style:{padding:"3px 8px",fontSize:8,fontWeight:600,background:"#fff",color:fe.inkMid,border:`1px solid ${fe.border}`,borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},title:"Marcar como pendiente",children:""}),s&&e.jsx("button",{onClick:re=>{re.stopPropagation(),q({type:"single",target:T})},style:{background:"none",border:"none",cursor:"pointer",marginLeft:4,opacity:.5},title:"Eliminar respuesta",children:e.jsx(Je,{size:11,color:fe.red})})]})]}),ne&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:0,borderBottom:`2px solid ${fe.blue}33`},children:e.jsxs("div",{style:{padding:"14px 16px",background:"#F8F7FF"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[e.jsxs("h3",{style:{fontSize:12,fontWeight:700,margin:0},children:[" Detalle  ",T.clienteNombre||T.fecha]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[!W&&e.jsx(So,{v:"pri",on:()=>ye(T),children:" Procesar  CRM"}),W&&e.jsx("span",{style:{fontSize:9,fontWeight:700,padding:"4px 12px",borderRadius:10,background:fe.greenBg,color:fe.green},children:" Procesado"}),e.jsxs(So,{v:"sec",on:()=>R(T),children:[e.jsx(Bt,{size:10})," Informe"]})]})]}),(()=>{const re=t.find(G=>G.id===T.formularioId)||t.find(G=>G.nombre===T.formularioNombre),H=ua(T,re);if(!H)return null;const N={green:{bg:"#E8F4EE",border:"#111111",text:"#111111"},yellow:{bg:"#FAF0E0",border:"#8C6A00",text:"#8C6A00"},red:{bg:"#FAE8E8",border:"#B91C1C",text:"#B91C1C"}}[H.level];return e.jsxs("div",{style:{marginBottom:12,border:`1px solid ${N.border}33`,borderRadius:6,overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 14px",background:N.bg},children:[e.jsxs("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:N.text},children:[H.score.toFixed(1),e.jsx("span",{style:{fontSize:10},children:"/10"})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:11,fontWeight:700,color:N.text},children:H.levelLabel}),e.jsx("div",{style:{fontSize:8,color:N.text,opacity:.8},children:H.conclusion})]}),e.jsx("div",{style:{display:"flex",gap:6},children:[["",H.greens,fe.green],["",H.yellows,fe.amber],["",H.reds,fe.red]].map(([G,ue,he])=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:12,fontWeight:800,color:he},children:ue}),e.jsx("div",{style:{fontSize:7},children:G})]},G))})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:4,padding:"8px 14px",background:"#fff"},children:H.details.map((G,ue)=>{const he=G.flag==="green"?fe.green:G.flag==="red"?fe.red:fe.amber,we=G.flag==="green"?"":G.flag==="red"?"":"";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 8px",background:fe.bg,borderRadius:4,fontSize:9},children:[e.jsx("span",{children:we}),e.jsx("span",{style:{fontWeight:600,flex:1},children:G.label}),e.jsx("span",{style:{color:fe.inkMid},children:G.value}),e.jsxs("span",{style:{fontWeight:700,color:he,fontFamily:"'DM Mono',monospace"},children:[G.points,"/",G.maxPoints]})]},ue)})})]})})(),(()=>{const re=N=>T[N]!==void 0?Array.isArray(T[N])?T[N].join(", "):String(T[N]):null,H=(N,G)=>G?e.jsxs("div",{style:{padding:"4px 8px",background:"#fff",borderRadius:4,border:`1px solid ${fe.border}`},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:N}),e.jsx("div",{style:{fontSize:10,fontWeight:600,marginTop:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:G})]}):null,se=(N,G)=>e.jsxs("div",{style:{gridColumn:"1/-1",fontSize:9,fontWeight:700,color:fe.inkMid,marginTop:6,paddingBottom:2,borderBottom:`1px solid ${fe.border}`},children:[N," ",G]});return e.jsxs("div",{children:[(T.clienteNombre||T.clienteEmail)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",background:fe.blueBg,borderRadius:6,border:`1px solid ${fe.blue}22`,marginBottom:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:fe.blue,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700},children:(T.clienteNombre||T.clienteEmail||"?")[0].toUpperCase()}),e.jsxs("div",{style:{flex:1},children:[T.clienteNombre&&e.jsx("div",{style:{fontSize:12,fontWeight:700,color:fe.blue},children:T.clienteNombre}),e.jsxs("div",{style:{display:"flex",gap:12,fontSize:9,color:fe.inkMid,marginTop:2},children:[T.clienteEmail&&e.jsxs("span",{children:[" ",T.clienteEmail]}),T.clienteTel&&e.jsxs("span",{children:[" ",T.clienteTel]}),re("tipoDocumento")&&e.jsxs("span",{children:[" ",re("tipoDocumento")," ",re("numDocumento")||""]})]})]}),re("propietario")&&e.jsx("div",{style:{padding:"3px 10px",borderRadius:12,fontSize:8,fontWeight:700,background:re("propietario")==="Soy el propietario"?fe.greenBg:fe.amberBg,color:re("propietario")==="Soy el propietario"?fe.green:fe.amber},children:re("propietario")})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6},children:[se("","Ubicacin"),H("Pas",re("pais")),H("Departamento/Regin",re("departamento")),H("Ciudad",re("ciudad")),H("Direccin",re("direccion")),H("Inmueble",re("tipoVivienda")),H("rea m",re("area")),se("","Proyecto y Diseo"),H("Servicios",re("servicios")),H("Tipo proyecto",re("tipoProyecto")),H("Estilo",re("estilo")),H("Espacios",re("espacios")),H("Expectativas",re("expectativas")),H("Prioridades",re("prioridades")),se("","Presupuesto"),H("Presupuesto",re("presupuesto")),H("Honorarios diseo",re("honorariosDiseo")),H("Financiacin",re("financiacion")),H("Anticipo 30-50%",re("anticipo")),H("Forma de pago",re("formaPago")),H("Flexibilidad",re("flexibilidad")),se("","Plazos"),H("Plazo",re("plazo")),H("Fecha inicio",re("fechaInicio"))]})]})})()]})})})]},T.id)})})]})}),v&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>m(!1),children:e.jsxs("div",{onClick:T=>T.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:340,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:32,textAlign:"center",marginBottom:8},children:""}),e.jsx("h3",{style:{margin:"0 0 4px",fontSize:14,fontWeight:700,textAlign:"center"},children:"Confirmar eliminacin"}),e.jsx("p",{style:{margin:"0 0 16px",fontSize:10,color:fe.inkMid,textAlign:"center"},children:(c==null?void 0:c.type)==="all"?"Eliminar TODAS las respuestas":(c==null?void 0:c.type)==="selected"?`Eliminar ${j.size} respuesta${j.size>1?"s":""}`:"Eliminar respuesta"}),e.jsx("input",{type:"password",value:f,onChange:T=>p(T.target.value),onKeyDown:T=>{T.key==="Enter"&&$()},placeholder:"Ingresa la contrasea",autoFocus:!0,style:{...kt,width:"100%",fontSize:12,marginBottom:12,textAlign:"center"}}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>m(!1),style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:600,border:`1px solid ${fe.border}`,borderRadius:4,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"}),e.jsx("button",{onClick:$,style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:700,border:"none",borderRadius:4,background:fe.red,color:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]})})]})}function $m({forms:t,setForms:i,onEdit:o}){const n=s=>{var r,a;try{const u=t.find(C=>C.sourceTemplate===s.id||C.nombre===s.nombre);if(u){u.sourceTemplate||i(t.map(C=>C.id===u.id?{...C,sourceTemplate:s.id}:C)),o(u.id);return}const h={};s.campos.forEach(C=>{h[C.id]=xt()});const b=s.campos.map(C=>{const v={...C,id:h[C.id]};return v.logica&&v.logica.fieldId&&h[v.logica.fieldId]&&(v.logica={...v.logica,fieldId:h[v.logica.fieldId]}),v.paisRef&&h[v.paisRef]&&(v.paisRef=h[v.paisRef]),v.dynamicOpciones&&v.dynamicOpciones.dependsOn&&h[v.dynamicOpciones.dependsOn]&&(v.dynamicOpciones={...v.dynamicOpciones,dependsOn:h[v.dynamicOpciones.dependsOn]}),v}),j={id:xt(),nombre:s.nombre,modulo:s.modulo||"general",campos:b,config:{...s.config||{},titulo:((r=s.config)==null?void 0:r.titulo)||s.nombre,vista:((a=s.config)==null?void 0:a.vista)||"pasos"},createdAt:Ji(),updatedAt:Ji(),activo:!0,sourceTemplate:s.id};i([...t,j]),o(j.id)}catch(u){console.error("Error al usar plantilla:",u),alert("Error al crear formulario desde plantilla")}};return e.jsxs("div",{className:"fade-up",children:[e.jsx("h2",{style:{margin:0,fontSize:18,fontWeight:700,marginBottom:14},children:"Plantillas prediseadas"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280,1fr))",gap:12},children:vc.map(s=>{const r=Es.find(u=>u.id===s.modulo),a=t.find(u=>u.sourceTemplate===s.id||u.nombre===s.nombre);return e.jsxs(Nt,{style:{padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"14px 16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:700},children:s.nombre}),e.jsx(Zn,{color:fe.purple,children:(r==null?void 0:r.lbl)||"General"})]}),e.jsx("div",{style:{fontSize:10,color:fe.inkMid,marginTop:4},children:s.desc}),e.jsxs("div",{style:{fontSize:8,color:fe.inkLight,marginTop:4},children:[s.campos.filter(u=>u.tipo!=="seccion").length," campos  ",s.campos.filter(u=>u.required).length," obligatorios"]})]}),e.jsx("div",{style:{borderTop:`1px solid ${fe.border}`,padding:0},children:e.jsx("button",{onClick:()=>n(s),style:{width:"100%",padding:"8px 0",border:"none",background:"transparent",cursor:"pointer",fontSize:10,fontWeight:700,color:a?fe.blue:fe.green,fontFamily:"'DM Sans',sans-serif"},children:a?" Editar formulario existente":" Usar esta plantilla"})})]},s.id)})})]})}function Pm({forms:t}){const[i,o]=F.useState(!0),[n,s]=F.useState(null),[r,a]=F.useState("all"),[u,h]=F.useState(null);if(F.useEffect(()=>{if(Ui()){o(!1);return}Promise.resolve({}).then(S=>{s(S),o(!1)}).catch(()=>o(!1))},[]),F.useEffect(()=>{h(null)},[r]),i)return e.jsx(Nt,{style:{padding:28,textAlign:"center"},children:e.jsx("div",{style:{fontSize:11,color:fe.inkMid},children:"Cargando estadsticas..."})});const b=(n==null?void 0:n.events)||[],j=(n==null?void 0:n.responses)||[],C=b.filter(S=>S.event_type==="open"),v=b.filter(S=>S.event_type==="submit"),m=b.filter(S=>S.event_type==="close"&&S.duration_seconds>0),f=m.length>0?Math.round(m.reduce((S,A)=>S+A.duration_seconds,0)/m.length):0,p=C.length>0?Math.round(v.length/C.length*100):0,c=S=>S<60?`${S}s`:S<3600?`${Math.floor(S/60)}m ${S%60}s`:`${Math.floor(S/3600)}h ${Math.floor(S%3600/60)}m`,d={};b.forEach(S=>{const A=(S.form_id||"")+"_"+(S.client_email||S.client_name||"anon");d[A]||(d[A]={form_id:S.form_id,form_name:S.form_name||S.form_id,client_name:S.client_name||"",client_email:S.client_email||"",opens:0,submits:0,lastDate:null,duration:0,durationCount:0}),S.event_type==="open"&&d[A].opens++,S.event_type==="submit"&&d[A].submits++,S.event_type==="close"&&S.duration_seconds>0&&(d[A].duration+=S.duration_seconds,d[A].durationCount++);const E=S.created_at?new Date(S.created_at):null;E&&(!d[A].lastDate||E>d[A].lastDate)&&(d[A].lastDate=E)});let l=Object.values(d);r!=="all"&&(l=l.filter(S=>S.form_id===r)),l.sort((S,A)=>(A.lastDate||0)-(S.lastDate||0));const x=[...new Set(b.map(S=>S.form_id).concat(j.map(S=>S.form_id)))],y={padding:"8px 10px",textAlign:"left",fontWeight:700,fontSize:8,textTransform:"uppercase",color:fe.inkMid,borderBottom:`1px solid ${fe.border}`},g={padding:"8px 10px",fontSize:11,borderBottom:`1px solid ${fe.border}`,verticalAlign:"middle"};return e.jsxs("div",{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginBottom:16},children:[[" Aperturas",C.length,"#3B3B3B"],[" Envos",v.length,"#111111"],[" Conversin",`${p}%`,"#111111"],[" Tiempo promedio",c(f),"#8C6A00"]].map(([S,A,E])=>e.jsxs(Nt,{style:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:S}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E},children:A})]},S))}),e.jsx(Nt,{style:{padding:"14px 16px",marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{fontSize:9,fontWeight:700,color:fe.inkMid,textTransform:"uppercase"},children:"Filtrar por formulario:"}),e.jsxs("select",{value:r,onChange:S=>a(S.target.value),style:{...kt,width:260,fontSize:11},children:[e.jsx("option",{value:"all",children:" Todos los formularios"}),t.map(S=>e.jsx("option",{value:S.id,children:S.nombre},S.id)),x.filter(S=>!t.find(A=>A.id===S)).map(S=>e.jsxs("option",{value:S,children:["ID: ",S]},S))]})]})}),u&&e.jsxs(Nt,{style:{padding:"16px",marginBottom:16},children:[e.jsx("h3",{style:{margin:"0 0 12px",fontSize:14,fontWeight:700},children:" Detalle del formulario"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:14},children:[["Aperturas",u.totalOpens,"#3B3B3B"],["Envos",u.totalSubmits,"#111111"],["Conversin",u.conversionRate+"%","#111111"],["Tiempo prom.",c(u.avgDurationSec),"#8C6A00"]].map(([S,A,E])=>e.jsxs("div",{style:{padding:"10px 12px",background:fe.bg,borderRadius:6,border:`1px solid ${fe.border}`},children:[e.jsx("div",{style:{fontSize:7,fontWeight:700,color:"#888",textTransform:"uppercase"},children:S}),e.jsx("div",{style:{fontSize:18,fontWeight:800,fontFamily:"'DM Mono',monospace",color:E},children:A})]},S))})]}),e.jsxs(Nt,{style:{padding:0,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"14px 16px",borderBottom:`1px solid ${fe.border}`},children:e.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:700},children:" Formularios recibidos"})}),l.length===0?e.jsx("div",{style:{fontSize:11,color:fe.inkMid,textAlign:"center",padding:28},children:"No hay actividad registrada an."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:fe.bg},children:["Estado","Fecha","Hora","Formulario","Cliente","Aperturas","Envos","Tiempo","Conversin"].map(S=>e.jsx("th",{style:y,children:S},S))})}),e.jsx("tbody",{children:l.map((S,A)=>{const E=S.submits>0,w=S.opens>0?Math.round(S.submits/S.opens*100):0,I=S.durationCount>0?Math.round(S.duration/S.durationCount):0,z=S.lastDate?S.lastDate.toISOString().split("T")[0]:"",B=S.lastDate?S.lastDate.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}):"";return e.jsxs("tr",{style:{background:A%2===0?"#fff":"#FFFFFF"},children:[e.jsx("td",{style:g,children:e.jsx("span",{style:{fontSize:9,padding:"3px 10px",borderRadius:10,fontWeight:700,color:E?fe.green:fe.amber,background:E?fe.greenBg:fe.amberBg},children:E?" Recibido":" Pendiente"})}),e.jsx("td",{style:{...g,fontFamily:"'DM Mono',monospace",fontSize:9},children:z}),e.jsx("td",{style:{...g,fontSize:9},children:B}),e.jsx("td",{style:{...g,fontWeight:600},children:S.form_name}),e.jsxs("td",{style:g,children:[e.jsx("div",{style:{fontWeight:600,fontSize:11},children:S.client_name||""}),S.client_email&&e.jsx("div",{style:{fontSize:9,color:fe.blue},children:S.client_email})]}),e.jsx("td",{style:{...g,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#3B3B3B"},children:S.opens}),e.jsx("td",{style:{...g,textAlign:"center",fontFamily:"'DM Mono',monospace",fontWeight:700,color:"#111111"},children:S.submits}),e.jsx("td",{style:{...g,textAlign:"center",fontSize:10,color:fe.inkMid},children:I>0?c(I):""}),e.jsx("td",{style:{...g,textAlign:"center"},children:e.jsxs("span",{style:{fontFamily:"'DM Mono',monospace",fontWeight:700,fontSize:10,color:w>=50?fe.green:w>0?fe.amber:fe.inkLight},children:[w,"%"]})})]},A)})})]})})]})]})}function Om({envios:t,onBlock:i,onDelete:o,respuestas:n}){const[s,r]=F.useState("pendiente"),a=w=>w.blocked?"bloqueado":n.some(I=>{var z;return I.clienteEmail===((z=w.cliente)==null?void 0:z.email)&&I.formularioId===w.formId})?"respondido":"pendiente",u={todos:t.length,pendiente:0,respondido:0,bloqueado:0};t.forEach(w=>{u[a(w)]++});const h=s==="todos"?t:t.filter(w=>a(w)===s),[b,j]=F.useState(new Set),[C,v]=F.useState(!1),[m,f]=F.useState(""),[p,c]=F.useState(null),d=w=>j(I=>{const z=new Set(I);return z.has(w)?z.delete(w):z.add(w),z}),l=()=>j(w=>w.size===t.length?new Set:new Set(t.map(I=>I.id))),x=Fe.getSync("hab:form:deletePass")||"",g=x||!1,S=async w=>{if(!g){A(w);return}x&&(c(w),f(""),v(!0))},A=async w=>{if(w.type==="single")await o(w.target.linkId||w.target.id);else if(w.type==="selected"){for(const I of b){const z=t.find(B=>B.id===I);z&&await o(z.linkId||z.id)}j(new Set)}else if(w.type==="all"){for(const I of t)await o(I.linkId||I.id);j(new Set)}v(!1),c(null)},E=()=>{m===x?A(p):alert("Contrasea incorrecta")};return e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsxs("h2",{style:{margin:0,fontSize:18,fontWeight:700},children:["Formularios enviados  ",h.length]}),b.size>0&&e.jsxs("button",{onClick:()=>S({type:"selected"}),style:{padding:"5px 14px",fontSize:9,fontWeight:700,background:fe.red,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[" Eliminar seleccionados (",b.size,")"]}),b.size===0&&t.length>0&&e.jsx("button",{onClick:()=>S({type:"all"}),style:{padding:"5px 14px",fontSize:9,fontWeight:600,background:"#fff",color:fe.red,border:`1px solid ${fe.red}44`,borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Limpiar todo"})]})}),e.jsx("div",{style:{display:"flex",gap:6,marginBottom:10},children:[["pendiente"," Pendientes"],["respondido"," Respondidos"],["bloqueado"," Bloqueados"],["todos","Todos"]].map(([w,I])=>e.jsxs("button",{onClick:()=>{r(w),j(new Set)},style:{padding:"5px 12px",fontSize:10,fontWeight:s===w?700:500,background:s===w?"#111":"#fff",color:s===w?"#fff":"#555",border:s===w?"1px solid #111":"1px solid #E0E0E0",borderRadius:4,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:[I," (",u[w],")"]},w))}),e.jsx(Nt,{style:{padding:0,overflow:"hidden"},children:e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#F0F0F0"},children:[e.jsx("th",{style:{...fs,width:30},children:e.jsx("input",{type:"checkbox",checked:t.length>0&&b.size===t.length,onChange:l,style:{cursor:"pointer"}})}),["Fecha","Hora","Formulario","Cliente","Email","Telfono","Estado","Acciones"].map(w=>e.jsx("th",{style:fs,children:w},w))]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{padding:24,textAlign:"center",color:fe.inkLight,fontSize:11},children:s==="todos"?"No has enviado formularios an":"Sin resultados para este filtro"})}):[...h].reverse().map(w=>{var B,P,q;const I=n.some(U=>{var $;return U.clienteEmail===(($=w.cliente)==null?void 0:$.email)&&U.formularioId===w.formId}),z=w.blocked;return e.jsxs("tr",{style:{background:b.has(w.id)||z?"#FDF5F5":""},children:[e.jsx("td",{style:{...Kt,width:30},children:e.jsx("input",{type:"checkbox",checked:b.has(w.id),onChange:()=>d(w.id),style:{cursor:"pointer"}})}),e.jsx("td",{style:{...Kt,fontFamily:"'DM Mono',monospace",fontSize:9},children:w.fecha}),e.jsx("td",{style:{...Kt,fontSize:9},children:w.hora}),e.jsx("td",{style:{...Kt,fontWeight:600},children:w.formNombre}),e.jsx("td",{style:{...Kt,fontWeight:600},children:((B=w.cliente)==null?void 0:B.nombre)||""}),e.jsx("td",{style:{...Kt,fontSize:9,color:fe.blue},children:((P=w.cliente)==null?void 0:P.email)||""}),e.jsx("td",{style:{...Kt,fontSize:9},children:((q=w.cliente)==null?void 0:q.tel)||""}),e.jsx("td",{style:Kt,children:z?e.jsx(Zn,{color:fe.red,children:" Bloqueado"}):I?e.jsx(Zn,{color:fe.green,children:" Respondido"}):e.jsx(Zn,{color:fe.amber,children:" Pendiente"})}),e.jsxs("td",{style:{...Kt,whiteSpace:"nowrap"},children:[z?e.jsx("button",{onClick:()=>{i(w.linkId||w.id,!1)},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:fe.green,color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Desbloquear"}):e.jsx("button",{onClick:()=>{confirm("Bloquear este enlace?")&&i(w.linkId||w.id,!0)},style:{padding:"3px 10px",fontSize:8,fontWeight:700,background:fe.red,color:"#fff",border:"none",borderRadius:3,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Bloquear"}),e.jsx("button",{onClick:()=>S({type:"single",target:w}),style:{background:"none",border:"none",cursor:"pointer",marginLeft:4,opacity:.5},children:e.jsx(Je,{size:11,color:fe.red})})]})]},w.id)})})]})}),C&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>v(!1),children:e.jsxs("div",{onClick:w=>w.stopPropagation(),style:{background:"#fff",borderRadius:8,padding:28,width:340,boxShadow:"0 12px 40px rgba(0,0,0,0.2)"},children:[e.jsx("div",{style:{fontSize:32,textAlign:"center",marginBottom:8},children:""}),e.jsx("h3",{style:{margin:"0 0 4px",fontSize:14,fontWeight:700,textAlign:"center"},children:"Confirmar eliminacin"}),e.jsx("p",{style:{margin:"0 0 16px",fontSize:10,color:fe.inkMid,textAlign:"center"},children:(p==null?void 0:p.type)==="all"?"Eliminar TODOS los envos":(p==null?void 0:p.type)==="selected"?`Eliminar ${b.size} envo${b.size>1?"s":""}`:"Eliminar envo"}),e.jsx("input",{type:"password",value:m,onChange:w=>f(w.target.value),onKeyDown:w=>{w.key==="Enter"&&E()},placeholder:"Ingresa la contrasea",autoFocus:!0,style:{...kt,width:"100%",fontSize:12,marginBottom:12,textAlign:"center"}}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>v(!1),style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:600,border:`1px solid ${fe.border}`,borderRadius:4,background:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:"Cancelar"}),e.jsx("button",{onClick:E,style:{flex:1,padding:"8px 0",fontSize:11,fontWeight:700,border:"none",borderRadius:4,background:fe.red,color:"#fff",cursor:"pointer",fontFamily:"'DM Sans',sans-serif"},children:" Eliminar"})]})]})})]})}function Lm(){const[t,i]=F.useState(()=>{try{const B=JSON.parse(Fe.getSync(Jr))||{};return B.forms||(B.forms=[]),B}catch{return{forms:[]}}});F.useEffect(()=>{(()=>{var B;try{const P=Fe.getSync(Jr);if(P!=null&&P.value){const q=JSON.parse(P);(B=q==null?void 0:q.forms)!=null&&B.length&&i(U=>{const $=new Set((U.forms||[]).map(J=>J.id)),Y=(q.forms||[]).filter(J=>!$.has(J.id)),ge={...q,forms:[...U.forms||[],...Y]};return Fe.set(Jr,JSON.stringify(ge)),ge})}}catch(P){console.warn("Cloud load forms:",P)}})()},[]);const o=(B,P)=>i(q=>{const U={...q,[B]:typeof P=="function"?P(q[B]):P};return Fe.set(Jr,JSON.stringify(U)),U}),n=t.forms||[],s=B=>o("forms",typeof B=="function"?B(n):B);F.useEffect(()=>{(()=>{try{const B=Fe.getSync("hab:form:procesados");if(B!=null&&B.value){const P=JSON.parse(B),q=JSON.parse(Fe.getSync("hab:form:procesados")||"[]"),U=[...new Set([...q,...P])];Fe.set("hab:form:procesados",JSON.stringify(U))}}catch{}})()},[]),F.useEffect(()=>{const B=t.forms||[];let P=[...B],q=!1;vc.forEach(U=>{var Y,ge;const $=B.find(J=>J.sourceTemplate===U.id||J.nombre===U.nombre);if($){if(U.version&&(!$.templateVersion||$.templateVersion<U.version)){const J={};U.campos.forEach(oe=>{J[oe.id]=xt()});const ye=U.campos.map(oe=>{const L={...oe,id:J[oe.id]};return L.logica&&L.logica.fieldId&&J[L.logica.fieldId]&&(L.logica={...L.logica,fieldId:J[L.logica.fieldId]}),L.paisRef&&J[L.paisRef]&&(L.paisRef=J[L.paisRef]),L.dynamicOpciones&&L.dynamicOpciones.dependsOn&&J[L.dynamicOpciones.dependsOn]&&(L.dynamicOpciones={...L.dynamicOpciones,dependsOn:J[L.dynamicOpciones.dependsOn]}),L});P=P.map(oe=>{var L,R;return oe.id===$.id?{...oe,campos:ye,config:{...U.config||{},titulo:((L=U.config)==null?void 0:L.titulo)||U.nombre,vista:((R=U.config)==null?void 0:R.vista)||"pasos"},updatedAt:Ji(),templateVersion:U.version,sourceTemplate:U.id}:oe}),q=!0}}else{const J={};U.campos.forEach(oe=>{J[oe.id]=xt()});const ye=U.campos.map(oe=>{const L={...oe,id:J[oe.id]};return L.logica&&L.logica.fieldId&&J[L.logica.fieldId]&&(L.logica={...L.logica,fieldId:J[L.logica.fieldId]}),L.paisRef&&J[L.paisRef]&&(L.paisRef=J[L.paisRef]),L.dynamicOpciones&&L.dynamicOpciones.dependsOn&&J[L.dynamicOpciones.dependsOn]&&(L.dynamicOpciones={...L.dynamicOpciones,dependsOn:J[L.dynamicOpciones.dependsOn]}),L});P.push({id:xt(),nombre:U.nombre,modulo:U.modulo||"general",campos:ye,config:{...U.config||{},titulo:((Y=U.config)==null?void 0:Y.titulo)||U.nombre,vista:((ge=U.config)==null?void 0:ge.vista)||"pasos"},createdAt:Ji(),updatedAt:Ji(),activo:!0,sourceTemplate:U.id,templateVersion:U.version||1}),q=!0}}),q&&o("forms",P)},[]);const[r,a]=F.useState([]),[u,h]=F.useState(!0),b=async()=>{h(!0);try{if(Ui()){const B=await Qg();if(B){a(B.map(P=>({id:P.link_id||P.id,formId:P.form_id,formNombre:P.form_name||"",cliente:{nombre:P.client_name||"",email:P.client_email||"",tel:P.client_tel||""},fecha:P.created_at?new Date(P.created_at).toLocaleDateString("es-CO"):"",hora:P.created_at?new Date(P.created_at).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}):"",linkId:P.link_id,maxUsos:P.max_uses||0,expiry:P.expires_at||"",blocked:!P.active}))),h(!1);return}}}catch(B){console.warn("loadEnvios error:",B)}a(t.envios||[]),h(!1)};F.useEffect(()=>{b()},[]);const j=async B=>{var P,q,U;if(Ui())try{await Kg({form_id:B.formId,form_name:B.formNombre,link_id:B.linkId,client_name:((P=B.cliente)==null?void 0:P.nombre)||null,client_email:((q=B.cliente)==null?void 0:q.email)||null,client_tel:((U=B.cliente)==null?void 0:U.tel)||null,max_uses:B.maxUsos||0,expires_at:B.expiry?new Date(B.expiry).toISOString():null}),await b()}catch($){console.warn("addEnvio SB error:",$)}else o("envios",[...t.envios||[],B])},C=async(B,P)=>{if(Ui())try{P?await Yg(B):await Xg(B),await b()}catch(q){console.warn("blockEnvio error:",q)}},v=async B=>{var P,q;try{const U=ji(),$=(P=U==null?void 0:U.supabase)==null?void 0:P.url,Y=(q=U==null?void 0:U.supabase)==null?void 0:q.anonKey;$&&Y&&await fetch($+"/rest/v1/form_links?link_id=eq."+encodeURIComponent(B),{method:"DELETE",headers:{apikey:Y,Authorization:"Bearer "+Y,Prefer:"return=minimal"}}),await b()}catch(U){console.warn("deleteEnvio error:",U)}},[m,f]=F.useState([]),[p,c]=F.useState(!1),d=async()=>{c(!0);const B=[],P=new Set;if(Ui())try{const U=await Gg();U&&U.length>0&&U.forEach($=>{const Y=$.data||{},ge={...Y,_sbId:$.id,id:Y.id||$.id,formularioId:$.form_id||Y.formularioId,formularioNombre:$.form_name||Y.formularioNombre,clienteNombre:$.client_name||Y.clienteNombre,clienteEmail:$.client_email||Y.clienteEmail,clienteTel:$.client_tel||Y.clienteTel,fecha:Y.fecha||($.created_at?$.created_at.split("T")[0]:""),created_at:$.created_at||null,processed:$.processed||!1};P.has(ge.id)||(P.add(ge.id),B.push(ge))})}catch(U){console.warn("Error loading Supabase responses:",U)}Fe.listSync("hab:form:resp:").items.forEach(U=>{try{const $=JSON.parse(U.value);$&&all.push($)}catch{}}),f(B),c(!1)};F.useEffect(()=>{d()},[]);const l=async B=>{B._sbId;const P=Fe.listSync("hab:briefing:").items;for(const q of P)try{const U=JSON.parse(q.value);if((U==null?void 0:U.id)===B.id){Fe.delete(q.key);break}}catch{}f(q=>q.filter(U=>U.id!==B.id))},x=async()=>{Ui();const B=Fe.listSync("hab:briefing:").items;for(const P of B)Fe.delete(P.key);f([])},[y,g]=F.useState(()=>"dashboard"),S=B=>{g(B);try{Fe.set("hab:form:tab",B)}catch{}},[A,E]=F.useState(null),w=B=>{E(B||null),S("constructor")},I=()=>{E(null),S("constructor")},z=B=>{E(B.id),S("mis_forms")};return e.jsxs(e.Fragment,{children:[e.jsx(Tm,{}),e.jsxs("div",{style:{padding:"30px 36px",maxWidth:1400,margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:22,fontWeight:800,letterSpacing:1},children:" Formularios"}),e.jsx("div",{style:{fontSize:10,color:fe.inkMid},children:"Constructor  Plantillas  Respuestas  Compartir"})]})}),e.jsx("div",{style:{display:"flex",gap:0,marginBottom:20},children:dd.map((B,P)=>e.jsx("button",{onClick:()=>{S(B.id),B.id!=="constructor"&&E(null)},style:{padding:"10px 18px",fontSize:11,fontWeight:600,cursor:"pointer",border:`1px solid ${fe.border}`,borderLeft:P>0?"none":void 0,fontFamily:"'DM Sans',sans-serif",whiteSpace:"nowrap",borderRadius:P===0?"6px 0 0 6px":P===dd.length-1?"0 6px 6px 0":"0",background:y===B.id?"#111":"#fff",color:y===B.id?"#fff":fe.inkMid},children:B.lbl},B.id))}),y==="dashboard"&&e.jsxs("div",{className:"fade-up",children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:16},children:(()=>{const B=[],P=m.filter(q=>!B.includes(q.id)).length;return[[" Formularios",n.length,"#111"],[" Enviados",r.length,"#3B3B3B"],[" Respuestas",m.length,"#111111"],[" Sin asignar",P,(P>0,"#111111")]]})().map(([B,P,q])=>e.jsxs(Nt,{style:{padding:"14px 16px",cursor:B.includes("Sin asignar")&&P>0?"pointer":void 0},onClick:B.includes("Sin asignar")&&P>0?()=>S("respuestas"):void 0,children:[e.jsx("div",{style:{fontSize:8,fontWeight:700,color:"#888",textTransform:"uppercase",letterSpacing:.5,marginBottom:4},children:B}),e.jsx("div",{style:{fontSize:22,fontWeight:800,fontFamily:"'DM Mono',monospace",color:q},children:P})]},B))}),(()=>{const B=[],P=m.filter(q=>!B.includes(q.id)).length;return P===0?null:e.jsx(Nt,{style:{padding:"12px 16px",marginBottom:16,background:"#F3EEFF",border:"1px solid #11111133",cursor:"pointer"},onClick:()=>S("respuestas"),children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"#111111",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700},children:P}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,color:"#111111"},children:[" Tienes ",P," formulario",P>1?"s":""," sin asignar"]}),e.jsx("div",{style:{fontSize:9,color:"#555555",marginTop:1},children:"Haz clic para ir a Respuestas y procesarlos  crear cliente + borrador oferta"})]})]})})})(),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12},children:[e.jsxs(Nt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:I,children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Crear formulario"}),e.jsx("div",{style:{fontSize:9,color:fe.inkMid,marginTop:2},children:"Desde cero con el constructor"})]}),e.jsxs(Nt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:()=>S("plantillas"),children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Usar plantilla"}),e.jsx("div",{style:{fontSize:9,color:fe.inkMid,marginTop:2},children:"Briefing, SST, encuestas..."})]}),e.jsxs(Nt,{style:{padding:"18px 16px",cursor:"pointer",textAlign:"center"},onClick:()=>S("respuestas"),children:[e.jsx("div",{style:{fontSize:24,marginBottom:6},children:""}),e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Ver respuestas"}),e.jsxs("div",{style:{fontSize:9,color:fe.inkMid,marginTop:2},children:[m.length," respuestas recibidas"]})]})]})]}),y==="mis_forms"&&e.jsx(_m,{forms:n,setForms:s,onEdit:w,onNew:I}),y==="constructor"&&e.jsx(Mm,{forms:n,setForms:s,editId:A,setEditId:E,onSaved:z,envios:r,addEnvio:j}),y==="enviados"&&e.jsx(Om,{envios:r,onBlock:C,onDelete:v,respuestas:m}),y==="respuestas"&&e.jsx(Dm,{forms:n,respuestas:m,onReload:d,loading:p,onDelete:l,onClearAll:x}),y==="estadisticas"&&e.jsx(Pm,{forms:n}),y==="plantillas"&&e.jsx($m,{forms:n,setForms:s,onEdit:w})]})]})}const Qe={ink:"#111",inkMid:"#444",inkLight:"#888",inkXLight:"#C8C5BE",bg:"#F5F4F1",surface:"#FFFFFF",border:"#E0E0E0",green:"#111111",greenBg:"#E8F4EE",greenLight:"#D4EDDF",red:"#B91C1C",redBg:"#FAE8E8",amber:"#8C6A00",amberBg:"#FFF8EE",blue:"#3B3B3B",blueBg:"#F0F0F0",shadow:"0 1px 4px rgba(0,0,0,.06), 0 8px 32px rgba(0,0,0,.08)"},Li={fontFamily:"'DM Sans',sans-serif"},cd=(t,i="COP")=>!t&&t!==0?"":new Intl.NumberFormat("es-CO",{style:"currency",currency:i,minimumFractionDigits:0,maximumFractionDigits:0}).format(t),pd=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric"}):"";function mo({title:t,icon:i,children:o}){return e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("h3",{style:{...Li,fontSize:13,fontWeight:700,color:Qe.ink,margin:"0 0 12px",display:"flex",alignItems:"center",gap:8,textTransform:"uppercase",letterSpacing:.5},children:[e.jsx("span",{children:i})," ",t]}),e.jsx("div",{style:{background:Qe.surface,borderRadius:12,padding:20,border:"1px solid "+Qe.border},children:o})]})}function ga({label:t,value:i,highlight:o}){return e.jsxs("div",{style:{flex:1,minWidth:140,background:o?Qe.greenBg:"#FFFFFF",borderRadius:10,padding:"14px 16px",border:"1px solid "+(o?Qe.greenLight:Qe.border)},children:[e.jsx("p",{style:{...Li,margin:"0 0 4px",fontSize:9,fontWeight:600,textTransform:"uppercase",letterSpacing:1,color:Qe.inkLight},children:t}),e.jsx("p",{style:{...Li,margin:0,fontSize:18,fontWeight:700,color:o?Qe.green:Qe.ink},children:i})]})}function Wm({token:t}){const[i,o]=F.useState(null),[n,s]=F.useState(!0),[r,a]=F.useState(null),[u,h]=F.useState(null),[b,j]=F.useState(""),[C,v]=F.useState(!1),[m,f]=F.useState(!1);if(F.useEffect(()=>{if(!t){a("no_token"),s(!1);return}Og(t).then(x=>{x?o(x):a("not_found"),s(!1)}).catch(()=>{a("error"),s(!1)})},[t]),n)return e.jsx("div",{style:{...Li,minHeight:"100vh",background:Qe.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16,animation:"pulse 1.5s ease infinite"},children:""}),e.jsx("p",{style:{fontSize:14,color:Qe.inkMid},children:"Cargando oferta..."}),e.jsx("style",{children:"@keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}"})]})});if(r||!i)return e.jsx("div",{style:{...Li,minHeight:"100vh",background:Qe.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:Qe.surface,borderRadius:16,padding:48,textAlign:"center",boxShadow:Qe.shadow,maxWidth:420},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("h2",{style:{margin:"0 0 8px",fontSize:18,color:Qe.ink},children:"Enlace no vlido"}),e.jsx("p",{style:{margin:0,fontSize:13,color:Qe.inkMid,lineHeight:1.6},children:"Este enlace de oferta no existe o ha expirado."})]})});if(i.status!=="pendiente"||m){const x={aprobada:{icon:"",label:"Oferta Aprobada",color:Qe.green,bg:Qe.greenBg},rechazada:{icon:"",label:"Oferta Rechazada",color:Qe.red,bg:Qe.redBg},devuelta:{icon:"",label:"Oferta Devuelta",color:Qe.amber,bg:Qe.amberBg}},y=x[i.status]||x.aprobada,g=i.offer_data||{};return e.jsx("div",{style:{...Li,minHeight:"100vh",background:Qe.bg,display:"flex",alignItems:"center",justifyContent:"center",padding:20},children:e.jsxs("div",{style:{background:Qe.surface,borderRadius:16,padding:48,textAlign:"center",boxShadow:Qe.shadow,maxWidth:480},children:[e.jsx("div",{style:{fontSize:56,marginBottom:16},children:y.icon}),e.jsx("h2",{style:{margin:"0 0 8px",fontSize:22,color:y.color,fontWeight:700},children:y.label}),e.jsxs("p",{style:{margin:"0 0 6px",fontSize:14,color:Qe.inkMid},children:[g.ref||"Oferta","  ",g.cliente||""]}),e.jsxs("p",{style:{margin:"0 0 20px",fontSize:12,color:Qe.inkLight},children:["Respondida el ",pd(i.client_responded_at)]}),i.client_comments&&e.jsxs("div",{style:{background:y.bg,borderRadius:8,padding:16,textAlign:"left"},children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:y.color},children:"Sus comentarios"}),e.jsx("p",{style:{margin:0,fontSize:13,color:Qe.ink,lineHeight:1.6,whiteSpace:"pre-wrap"},children:i.client_comments})]}),e.jsx("p",{style:{margin:"24px 0 0",fontSize:11,color:Qe.inkLight},children:"Si necesita hacer cambios, contacte con su representante."})]})})}const p=i.offer_data||{},c=p.divisa||"COP",d=x=>x?e.jsx("div",{style:{fontSize:13,color:Qe.ink,lineHeight:1.7,whiteSpace:"pre-wrap"},children:x}):e.jsx("p",{style:{margin:0,fontSize:13,color:Qe.inkLight,fontStyle:"italic"},children:"No especificado"}),l=async()=>{if(u){if(u==="devolver"&&!b.trim()){alert("Por favor, indique los cambios que necesita.");return}v(!0);try{const y=await Lg(t,{aprobar:"aprobada",rechazar:"rechazada",devolver:"devuelta"}[u],b);o(y),f(!0)}catch(x){alert("Error al enviar. Intente de nuevo."),console.error(x)}v(!1)}};return e.jsxs("div",{style:{...Li,minHeight:"100vh",background:Qe.bg},children:[e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0;padding:0}body{font-family:'DM Sans',sans-serif}"}),e.jsx("div",{style:{background:"#111",color:"#fff",padding:"28px 0"},children:e.jsx("div",{style:{maxWidth:760,margin:"0 auto",padding:"0 24px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:10,letterSpacing:2,textTransform:"uppercase",color:"rgba(255,255,255,.5)",marginBottom:4},children:["Propuesta Comercial  ",i.revision||"Rev.01"]}),e.jsx("h1",{style:{fontSize:24,fontWeight:700,margin:0},children:p.ref||"Oferta"})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("p",{style:{fontSize:12,color:"rgba(255,255,255,.7)",margin:0},children:p.firmante||"Habitaris"}),e.jsx("p",{style:{fontSize:11,color:"rgba(255,255,255,.4)",margin:0},children:pd(p.fecha)})]})]})})}),e.jsxs("div",{style:{maxWidth:760,margin:"0 auto",padding:"32px 24px 120px"},children:[e.jsxs("div",{style:{background:Qe.blueBg,border:"1px solid "+Qe.blue+"33",borderRadius:12,padding:"16px 20px",marginBottom:28,display:"flex",alignItems:"center",gap:12},children:[e.jsx("span",{style:{fontSize:24},children:""}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:13,fontWeight:600,color:Qe.blue,margin:"0 0 2px"},children:"Pendiente de su respuesta"}),e.jsx("p",{style:{fontSize:11,color:Qe.inkMid,margin:0},children:"Revise los detalles y apruebe, rechace o solicite cambios al final."})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:28,flexWrap:"wrap"},children:[e.jsx(ga,{label:"Proyecto",value:p.proyecto||p.titulo||""}),e.jsx(ga,{label:"PVP sin IVA ("+c+")",value:cd(p.pvp,c)}),e.jsx(ga,{label:"PVP con IVA ("+c+")",value:cd(p.pvpIva,c),highlight:!0})]}),e.jsx(mo,{title:"Datos del proyecto",icon:"",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,fontSize:13},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:Qe.inkLight,fontSize:11},children:"Cliente"}),e.jsx("br",{}),e.jsx("strong",{children:p.cliente||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Qe.inkLight,fontSize:11},children:"Proyecto"}),e.jsx("br",{}),e.jsx("strong",{children:p.proyecto||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Qe.inkLight,fontSize:11},children:"Ubicacin"}),e.jsx("br",{}),e.jsx("strong",{children:p.ubicacion||""})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:Qe.inkLight,fontSize:11},children:"Revisin"}),e.jsx("br",{}),e.jsx("strong",{children:i.revision})]})]})}),p.alcance&&e.jsx(mo,{title:"Alcance del servicio",icon:"",children:d(p.alcance)}),p.fases&&e.jsx(mo,{title:"Fases del proyecto",icon:"",children:d(p.fases)}),p.exclusiones&&e.jsx(mo,{title:"Exclusiones",icon:"",children:d(p.exclusiones)}),p.condPago&&e.jsx(mo,{title:"Condiciones de pago",icon:"",children:d(p.condPago)}),p.plazo&&e.jsx(mo,{title:"Plazo de ejecucin",icon:"",children:d(p.plazo)}),p.garantias&&e.jsx(mo,{title:"Garantas",icon:"",children:d(p.garantias)}),p.terminos&&e.jsx(mo,{title:"Trminos y condiciones",icon:"",children:d(p.terminos)}),p.notaLegal&&e.jsxs("div",{style:{background:"#FFFFFF",borderRadius:10,padding:16,marginBottom:28,border:"1px solid "+Qe.border},children:[e.jsx("p",{style:{fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:1,color:Qe.inkLight,margin:"0 0 6px"},children:"Nota legal"}),e.jsx("p",{style:{fontSize:11,color:Qe.inkMid,lineHeight:1.6,margin:0},children:p.notaLegal})]}),e.jsxs("div",{style:{background:Qe.surface,borderRadius:16,padding:28,boxShadow:Qe.shadow,border:"2px solid "+Qe.border},children:[e.jsx("h3",{style:{fontSize:16,fontWeight:700,color:Qe.ink,margin:"0 0 6px"},children:"Su decisin"}),e.jsx("p",{style:{fontSize:12,color:Qe.inkMid,margin:"0 0 20px",lineHeight:1.5},children:"Seleccione una opcin y aada comentarios si lo desea."}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"},children:[{id:"aprobar",icon:"",label:"Aprobar oferta",color:Qe.green,bg:Qe.greenBg,desc:"Acepto las condiciones"},{id:"devolver",icon:"",label:"Solicitar cambios",color:Qe.amber,bg:Qe.amberBg,desc:"Necesito modificaciones"},{id:"rechazar",icon:"",label:"Rechazar oferta",color:Qe.red,bg:Qe.redBg,desc:"No me interesa"}].map(x=>e.jsxs("button",{onClick:()=>h(x.id),style:{...Li,flex:1,minWidth:160,padding:"16px 14px",borderRadius:12,cursor:"pointer",textAlign:"left",background:u===x.id?x.bg:Qe.surface,border:"2px solid "+(u===x.id?x.color:Qe.border),transition:"all .15s"},children:[e.jsx("div",{style:{fontSize:22,marginBottom:6},children:x.icon}),e.jsx("div",{style:{fontSize:12,fontWeight:700,color:u===x.id?x.color:Qe.ink,marginBottom:2},children:x.label}),e.jsx("div",{style:{fontSize:10,color:Qe.inkLight,lineHeight:1.4},children:x.desc})]},x.id))}),u&&e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{display:"block",fontSize:11,fontWeight:600,color:Qe.ink,marginBottom:6},children:u==="devolver"?"Describa los cambios que necesita *":"Comentarios (opcional)"}),e.jsx("textarea",{value:b,onChange:x=>j(x.target.value),placeholder:u==="devolver"?"Indique qu ajustes necesita...":"Puede aadir notas...",rows:4,style:{...Li,width:"100%",padding:12,borderRadius:8,border:"1px solid "+Qe.border,fontSize:13,resize:"vertical",background:"#FFFFFF"}})]}),u&&e.jsx("button",{onClick:l,disabled:C,style:{...Li,width:"100%",padding:"14px 24px",borderRadius:10,fontSize:14,fontWeight:700,border:"none",cursor:C?"wait":"pointer",color:"#fff",background:u==="aprobar"?Qe.green:u==="rechazar"?Qe.red:Qe.amber,opacity:C?.6:1},children:C?"Enviando...":u==="aprobar"?" Confirmar aprobacin":u==="rechazar"?" Confirmar rechazo":" Enviar solicitud de cambios"})]}),e.jsx("div",{style:{textAlign:"center",marginTop:40,padding:"20px 0",borderTop:"1px solid "+Qe.border},children:e.jsxs("p",{style:{fontSize:11,color:Qe.inkLight,margin:0},children:["Propuesta enviada por ",e.jsx("strong",{style:{color:Qe.ink},children:p.firmante||"Habitaris"})]})})]})]})}const xe={ink:"#111",inkMid:"#444",inkLight:"#888",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",accent:"#111111",accentBg:"#EBEBEB",info:"#3B3B3B",infoBg:"#F0F0F0",warning:"#8C6A00",warningBg:"#FFF8EE",danger:"#B91C1C",dangerBg:"#FDF0F0",shadow:"0 1px 4px rgba(0,0,0,.06)",shadowMd:"0 4px 16px rgba(0,0,0,.10)"},Le={fontFamily:"'DM Sans',sans-serif"},jc="hab:portal:",Sc=t=>{try{return JSON.parse(store.getSync(jc+t))||null}catch{return null}},Nm=(t,i)=>store.set(jc+t,JSON.stringify(i)),ri=t=>t?new Date(t).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"";function Um(t){return t?Math.ceil((new Date(t)-new Date)/(1e3*60*60*24)):1/0}function er({children:t,color:i,bg:o,style:n}){return e.jsx("span",{style:{...Le,display:"inline-block",padding:"2px 10px",borderRadius:10,fontSize:10,fontWeight:600,color:i,background:o,...n},children:t})}function Cc(){var t,i,o,n,s,r,a,u;try{const h=JSON.parse(store.getSync("hab:config"))||{};return{nombre:((t=h.empresa)==null?void 0:t.nombre)||"Habitaris",logo:((i=h.apariencia)==null?void 0:i.logo)||null,colorPrimario:((o=h.apariencia)==null?void 0:o.colorPrimario)||"#111111",colorAcento:((n=h.apariencia)==null?void 0:n.colorAcento)||"#111111",tipografia:((s=h.apariencia)==null?void 0:s.tipografia)||"DM Sans",telefono:((r=h.empresa)==null?void 0:r.telefono)||"+57 350 566 1545",email:((a=h.empresa)==null?void 0:a.email)||"info@habitaris.co",web:((u=h.empresa)==null?void 0:u.web)||"www.habitaris.co"}}catch{return{nombre:"Habitaris",colorPrimario:"#111",colorAcento:"#111111",tipografia:"DM Sans"}}}const kc=[{id:"resumen",label:"Resumen del proyecto",icon:"",desc:"Estado general, progreso, datos clave"},{id:"documentos",label:"Documentos",icon:"",desc:"Contratos, planos, presupuestos, actas"},{id:"firmas",label:"Firmas pendientes",icon:"",desc:"Documentos que requieren firma del cliente"},{id:"avance",label:"Avance de obra",icon:"",desc:"Progreso por fase, fotos, bitcora"},{id:"pagos",label:"Pagos y facturas",icon:"",desc:"Estado de cuenta, facturas, recibos"},{id:"cronograma",label:"Cronograma",icon:"",desc:"Fases del proyecto con fechas"},{id:"comunicaciones",label:"Comunicaciones",icon:"",desc:"Mensajes y notificaciones del equipo"},{id:"garantias",label:"Garantas",icon:"",desc:"Plizas, garantas post-entrega"}],tr=[{id:"briefing",label:"Briefing",color:"#888",bg:"#F5F5F5",pct:5},{id:"diseno",label:"Diseo",color:"#5B3A8C",bg:"#F3EEF9",pct:20},{id:"aprobacion",label:"Aprobacin",color:"#8C6A00",bg:"#FFF8EE",pct:30},{id:"licencias",label:"Licencias",color:"#3B3B3B",bg:"#F0F0F0",pct:35},{id:"obra",label:"En obra",color:"#D4840A",bg:"#FFF3E0",pct:60},{id:"acabados",label:"Acabados",color:"#0D7377",bg:"#E6F5F5",pct:85},{id:"entrega",label:"Entrega",color:"#111111",bg:"#EBEBEB",pct:95},{id:"postventa",label:"Postventa",color:"#111111",bg:"#EBEBEB",pct:100}],wc=[{id:"portal_1",clienteId:"c1",clienteNombre:"Mara Fernanda Gmez",clienteEmail:"mfgomez@email.com",proyecto:"Diseo Interior  Apto 502 Rosales",estado:"diseno",progreso:25,ofertaRef:"OFR-2026-001",valorContrato:"$45.000.000 COP",equipoAsignado:[{nombre:"Ana Garca",cargo:"Diseadora lder"},{nombre:"Carlos Lpez",cargo:"Arquitecto"}],fechaInicio:"2026-02-15",fechaEstimadaFin:"2026-06-15",seccionesActivas:["resumen","documentos","firmas","pagos","cronograma","comunicaciones"],accessToken:"mfg502ros",documentos:[{id:"doc1",nombre:"Contrato de Diseo Interior",tipo:"contrato",fecha:"2026-02-15",estado:"firmado",descargable:!0},{id:"doc2",nombre:"Brief de Diseo Aprobado",tipo:"brief",fecha:"2026-02-18",estado:"aprobado",descargable:!0},{id:"doc3",nombre:"Propuesta de Concepto v1",tipo:"diseo",fecha:"2026-02-25",estado:"en_revision",descargable:!0},{id:"doc4",nombre:"Presupuesto Estimado de Obra",tipo:"presupuesto",fecha:"2026-02-20",estado:"pendiente",descargable:!1}],firmasPendientes:[{id:"fp1",documento:"Aprobacin de Concepto de Diseo",fechaLimite:"2026-03-10",estado:"pendiente"}],pagos:[{id:"pago1",concepto:"Anticipo  Diseo (50%)",valor:"$22.500.000",fecha:"2026-02-15",estado:"pagado"},{id:"pago2",concepto:"Segundo pago  Diseo (30%)",valor:"$13.500.000",fecha:"2026-04-01",estado:"pendiente"},{id:"pago3",concepto:"Pago final  Diseo (20%)",valor:"$9.000.000",fecha:"2026-06-15",estado:"pendiente"}],cronograma:[{fase:"Briefing y levantamiento",inicio:"2026-02-15",fin:"2026-02-22",completado:100},{fase:"Concepto de diseo",inicio:"2026-02-23",fin:"2026-03-10",completado:60},{fase:"Anteproyecto",inicio:"2026-03-11",fin:"2026-04-05",completado:0},{fase:"Proyecto ejecutivo",inicio:"2026-04-06",fin:"2026-05-15",completado:0},{fase:"Detalles tcnicos y planos de obra",inicio:"2026-05-16",fin:"2026-06-10",completado:0},{fase:"Entrega final",inicio:"2026-06-11",fin:"2026-06-15",completado:0}],comunicaciones:[{id:"com1",fecha:"2026-02-25",de:"Ana Garca",mensaje:"Hola Mara Fernanda, ya tenemos lista la primera propuesta de concepto. La subimos al portal para tu revisin. Esperamos tus comentarios!"},{id:"com2",fecha:"2026-02-20",de:"Sistema",mensaje:"Se ha generado tu portal de cliente. Aqu podrs seguir el avance de tu proyecto."},{id:"com3",fecha:"2026-02-15",de:"Laura Snchez",mensaje:"Bienvenida! Estamos encantados de iniciar este proyecto contigo. Tu diseadora lder ser Ana Garca."}],garantias:[]},{id:"portal_2",clienteId:"c2",clienteNombre:"Andrs Meja Ruiz",clienteEmail:"amejia@email.com",proyecto:"Remodelacin Integral  Casa Chic Norte",estado:"obra",progreso:55,ofertaRef:"OFR-2025-089",valorContrato:"$120.000.000 COP",equipoAsignado:[{nombre:"Carlos Lpez",cargo:"Director de proyecto"},{nombre:"Mara Rodrguez",cargo:"Directora de obra"},{nombre:"Pedro Martnez",cargo:"Instalador tcnico"}],fechaInicio:"2025-10-01",fechaEstimadaFin:"2026-04-30",seccionesActivas:["resumen","documentos","firmas","avance","pagos","cronograma","comunicaciones","garantias"],accessToken:"amr_chico",documentos:[{id:"doc5",nombre:"Contrato de Obra",tipo:"contrato",fecha:"2025-10-01",estado:"firmado",descargable:!0},{id:"doc6",nombre:"Acta de Inicio",tipo:"acta",fecha:"2025-10-05",estado:"firmado",descargable:!0},{id:"doc7",nombre:"Acta de Vecindad",tipo:"acta",fecha:"2025-10-05",estado:"firmado",descargable:!0},{id:"doc8",nombre:"Planos Aprobados",tipo:"planos",fecha:"2025-09-20",estado:"aprobado",descargable:!0},{id:"doc9",nombre:"Acta Comit #8",tipo:"acta",fecha:"2026-02-20",estado:"aprobado",descargable:!0},{id:"doc10",nombre:"Otros  Cambio de acabados bao",tipo:"otrosi",fecha:"2026-02-10",estado:"firmado",descargable:!0}],firmasPendientes:[{id:"fp2",documento:"Acta de Comit #9  Febrero",fechaLimite:"2026-03-01",estado:"pendiente"},{id:"fp3",documento:"Aprobacin cambio cocina integral",fechaLimite:"2026-03-05",estado:"pendiente"}],pagos:[{id:"pago4",concepto:"Anticipo (30%)",valor:"$36.000.000",fecha:"2025-10-01",estado:"pagado"},{id:"pago5",concepto:"Avance 1  Demolicin y estructura (20%)",valor:"$24.000.000",fecha:"2025-11-15",estado:"pagado"},{id:"pago6",concepto:"Avance 2  Instalaciones (20%)",valor:"$24.000.000",fecha:"2026-01-15",estado:"pagado"},{id:"pago7",concepto:"Avance 3  Acabados (20%)",valor:"$24.000.000",fecha:"2026-03-15",estado:"pendiente"},{id:"pago8",concepto:"Pago final (10%)",valor:"$12.000.000",fecha:"2026-04-30",estado:"pendiente"}],cronograma:[{fase:"Demolicin y preparacin",inicio:"2025-10-05",fin:"2025-10-30",completado:100},{fase:"Estructura y mampostera",inicio:"2025-11-01",fin:"2025-12-15",completado:100},{fase:"Instalaciones (elctrica, hidrulica)",inicio:"2025-12-16",fin:"2026-01-31",completado:100},{fase:"Paetes y pisos",inicio:"2026-02-01",fin:"2026-02-28",completado:70},{fase:"Carpintera y acabados",inicio:"2026-03-01",fin:"2026-04-10",completado:0},{fase:"Limpieza y entrega",inicio:"2026-04-11",fin:"2026-04-30",completado:0}],avanceObra:[{fecha:"2026-02-24",nota:"Avance de pisos en sala y comedor al 80%. Pendiente habitaciones.",fotos:3},{fecha:"2026-02-17",nota:"Inicio de instalacin de piso en sala principal. Material lleg completo.",fotos:5},{fecha:"2026-02-10",nota:"Paetes terminados en toda la casa. Se inicia alistamiento de pisos.",fotos:4},{fecha:"2026-01-30",nota:"Pruebas de presin hidrulica OK. Instalacin elctrica completada.",fotos:6}],comunicaciones:[{id:"com4",fecha:"2026-02-24",de:"Mara Rodrguez",mensaje:"Andrs, el avance de pisos va al 80% en sala. Esta semana arrancamos habitaciones. Te sub las fotos al portal."},{id:"com5",fecha:"2026-02-10",de:"Carlos Lpez",mensaje:"Otros del cambio de acabados del bao ya est firmado por ambas partes. Queda en el portal."},{id:"com6",fecha:"2026-02-01",de:"Sistema",mensaje:"Nuevo documento pendiente de firma: Acta de Comit #9"}],garantias:[{tipo:"Todo Riesgo Construccin",aseguradora:"Seguros Bolvar",vigencia:"2026-07-15",poliza:"POL-2026-001245"},{tipo:"RC Extracontractual",aseguradora:"Sura",vigencia:"2026-12-31",poliza:"RC-2026-778899"}]},{id:"portal_3",clienteId:"c3",clienteNombre:"TechStar S.A.S",clienteEmail:"admin@techstar.co",proyecto:"Adecuacin Oficina 301  WTC Bogot",estado:"postventa",progreso:100,ofertaRef:"OFR-2025-045",valorContrato:"$85.000.000 COP",equipoAsignado:[{nombre:"Ana Garca",cargo:"Diseadora"},{nombre:"Mara Rodrguez",cargo:"Directora de obra"}],fechaInicio:"2025-06-01",fechaEstimadaFin:"2025-12-15",seccionesActivas:["resumen","documentos","pagos","garantias"],accessToken:"ts_301wtc",documentos:[{id:"doc11",nombre:"Contrato de Obra",tipo:"contrato",fecha:"2025-06-01",estado:"firmado",descargable:!0},{id:"doc12",nombre:"Acta de Entrega Final",tipo:"acta",fecha:"2025-12-10",estado:"firmado",descargable:!0},{id:"doc13",nombre:"Acta de Conformidad",tipo:"acta",fecha:"2025-12-10",estado:"firmado",descargable:!0},{id:"doc14",nombre:"Planos As-Built",tipo:"planos",fecha:"2025-12-12",estado:"entregado",descargable:!0}],firmasPendientes:[],pagos:[{id:"pago9",concepto:"Anticipo (30%)",valor:"$25.500.000",fecha:"2025-06-01",estado:"pagado"},{id:"pago10",concepto:"Avance 1 (30%)",valor:"$25.500.000",fecha:"2025-08-15",estado:"pagado"},{id:"pago11",concepto:"Avance 2 (30%)",valor:"$25.500.000",fecha:"2025-11-01",estado:"pagado"},{id:"pago12",concepto:"Retencin final (10%)",valor:"$8.500.000",fecha:"2025-12-15",estado:"pagado"}],cronograma:[],comunicaciones:[],garantias:[{tipo:"Estabilidad de obra",aseguradora:"Seguros Bolvar",vigencia:"2030-12-10",poliza:"CAL-2025-112233"},{tipo:"Cumplimiento",aseguradora:"Liberty Seguros",vigencia:"2026-06-01",poliza:"CUM-2025-556677"}]}];function Vm(){try{const t=new URLSearchParams(window.location.search);return t.get("token")||t.get("t")||null}catch{return null}}function zc({portal:t,brand:i}){const[o,n]=F.useState("resumen"),s=i.tipografia||"DM Sans",r=i.colorPrimario,a=i.colorAcento,u=tr.find(l=>l.id===t.estado),h=kc.filter(l=>t.seccionesActivas.includes(l.id)),d={resumen:()=>{var l,x,y;return e.jsxs("div",{children:[e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:24,marginBottom:16,border:`1px solid ${xe.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:10,color:xe.inkLight,textTransform:"uppercase",letterSpacing:1},children:"Estado actual"}),e.jsx("div",{style:{...Le,fontSize:18,fontWeight:700,color:u==null?void 0:u.color},children:u==null?void 0:u.label})]}),e.jsxs("div",{style:{...Le,fontSize:32,fontWeight:800,color:a},children:[t.progreso,"%"]})]}),e.jsx("div",{style:{height:10,background:xe.bg,borderRadius:5,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${t.progreso}%`,background:a,borderRadius:5,transition:"width .5s"}})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12},children:tr.slice(0,7).map(g=>e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",margin:"0 auto 4px",background:t.progreso>=g.pct?a:xe.border}}),e.jsx("div",{style:{...Le,fontSize:8,color:t.progreso>=g.pct?xe.ink:xe.inkLight},children:g.label})]},g.id))})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px,1fr))",gap:12,marginBottom:16},children:[{label:"Valor contrato",val:t.valorContrato,icon:""},{label:"Inicio",val:ri(t.fechaInicio),icon:""},{label:"Entrega estimada",val:ri(t.fechaEstimadaFin),icon:""},{label:"Oferta ref.",val:t.ofertaRef,icon:""}].map((g,S)=>e.jsxs("div",{style:{background:"#fff",border:`1px solid ${xe.border}`,borderRadius:10,padding:16},children:[e.jsxs("div",{style:{...Le,fontSize:10,color:xe.inkLight},children:[g.icon," ",g.label]}),e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.ink,marginTop:2},children:g.val})]},S))}),e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:20,border:`1px solid ${xe.border}`,marginBottom:16},children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:700,color:xe.ink,marginBottom:12},children:" Tu equipo"}),e.jsx("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:t.equipoAsignado.map((g,S)=>e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"8px 14px",background:xe.surface,borderRadius:8},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:a+"22",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:a},children:g.nombre[0]}),e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:12,fontWeight:600,color:xe.ink},children:g.nombre}),e.jsx("div",{style:{...Le,fontSize:10,color:xe.inkLight},children:g.cargo})]})]},S))})]}),t.firmasPendientes.length>0&&e.jsxs("div",{style:{background:xe.warningBg,border:`1px solid ${xe.warning}33`,borderRadius:10,padding:16,marginBottom:12},children:[e.jsxs("div",{style:{...Le,fontSize:12,fontWeight:700,color:xe.warning},children:[" Tienes ",t.firmasPendientes.length," documento(s) pendiente(s) de firma"]}),e.jsx("div",{style:{...Le,fontSize:11,color:xe.warning,marginTop:4},children:'Ve a la seccin "Firmas pendientes" para revisarlos y firmar.'})]}),t.pagos.filter(g=>g.estado==="pendiente").length>0&&e.jsxs("div",{style:{background:xe.infoBg,border:`1px solid ${xe.info}33`,borderRadius:10,padding:16},children:[e.jsxs("div",{style:{...Le,fontSize:12,fontWeight:700,color:xe.info},children:[" Prximo pago: ",(l=t.pagos.find(g=>g.estado==="pendiente"))==null?void 0:l.concepto]}),e.jsxs("div",{style:{...Le,fontSize:11,color:xe.info,marginTop:4},children:[(x=t.pagos.find(g=>g.estado==="pendiente"))==null?void 0:x.valor,"  ",ri((y=t.pagos.find(g=>g.estado==="pendiente"))==null?void 0:y.fecha)]})]})]})},documentos:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Documentos del proyecto"}),t.documentos.map(l=>{const y={firmado:{c:xe.accent,bg:xe.accentBg},aprobado:{c:xe.accent,bg:xe.accentBg},en_revision:{c:xe.warning,bg:xe.warningBg},pendiente:{c:xe.info,bg:xe.infoBg},entregado:{c:xe.accent,bg:xe.accentBg}}[l.estado]||{c:xe.inkLight,bg:xe.bg};return e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"14px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{fontSize:24},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:600,color:xe.ink},children:l.nombre}),e.jsxs("div",{style:{...Le,fontSize:10,color:xe.inkLight},children:[l.tipo,"  ",ri(l.fecha)]})]}),e.jsx(er,{color:y.c,bg:y.bg,children:l.estado}),l.descargable&&e.jsx("button",{style:{...Le,padding:"6px 12px",fontSize:10,fontWeight:600,color:a,background:a+"15",border:`1px solid ${a}33`,borderRadius:5,cursor:"pointer"},children:" Descargar"})]},l.id)})]}),firmas:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Documentos pendientes de firma"}),t.firmasPendientes.length===0?e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8},children:""}),e.jsx("p",{style:{...Le,fontSize:13,color:xe.accent},children:"No tienes documentos pendientes de firma"})]}):t.firmasPendientes.map(l=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"16px 18px",background:"#fff",border:`1px solid ${xe.warning}44`,borderRadius:10,marginBottom:10},children:[e.jsx("div",{style:{fontSize:28},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:700,color:xe.ink},children:l.documento}),e.jsxs("div",{style:{...Le,fontSize:11,color:xe.inkLight},children:["Fecha lmite: ",ri(l.fechaLimite)]})]}),e.jsx("button",{style:{...Le,padding:"8px 20px",fontSize:12,fontWeight:700,color:"#fff",background:a,border:"none",borderRadius:6,cursor:"pointer"},children:" Firmar ahora"})]},l.id))]}),avance:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Avance de obra"}),(t.avanceObra||[]).length===0?e.jsx("p",{style:{...Le,fontSize:12,color:xe.inkLight},children:"An no hay registros de avance."}):e.jsx("div",{style:{borderLeft:`2px solid ${xe.border}`,paddingLeft:20,marginLeft:10},children:t.avanceObra.map((l,x)=>e.jsxs("div",{style:{marginBottom:20,position:"relative"},children:[e.jsx("div",{style:{position:"absolute",left:-27,top:2,width:12,height:12,borderRadius:"50%",background:x===0?a:xe.bg,border:`2px solid ${x===0?a:xe.border}`}}),e.jsx("div",{style:{...Le,fontSize:10,fontWeight:600,color:a},children:ri(l.fecha)}),e.jsx("div",{style:{...Le,fontSize:13,color:xe.ink,marginTop:4,lineHeight:1.6},children:l.nota}),l.fotos>0&&e.jsxs("div",{style:{...Le,fontSize:10,color:xe.inkLight,marginTop:4},children:[" ",l.fotos," foto(s) adjuntas"]})]},x))})]}),pagos:()=>{const l=t.pagos.filter(S=>S.estado==="pagado"),x=t.pagos.filter(S=>S.estado==="pendiente"),y=l.length,g=t.pagos.length;return e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:12},children:" Estado de pagos"}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16},children:[e.jsxs("div",{style:{flex:1,padding:16,background:xe.accentBg,borderRadius:10,border:`1px solid ${xe.accent}33`},children:[e.jsx("div",{style:{...Le,fontSize:10,color:xe.accent},children:"Pagado"}),e.jsxs("div",{style:{...Le,fontSize:20,fontWeight:700,color:xe.accent},children:[y,"/",g]})]}),x.length>0&&e.jsxs("div",{style:{flex:1,padding:16,background:xe.warningBg,borderRadius:10,border:`1px solid ${xe.warning}33`},children:[e.jsx("div",{style:{...Le,fontSize:10,color:xe.warning},children:"Prximo pago"}),e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.warning},children:x[0].valor}),e.jsx("div",{style:{...Le,fontSize:10,color:xe.warning},children:ri(x[0].fecha)})]})]}),t.pagos.map(S=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:8,marginBottom:6},children:[e.jsx("div",{style:{fontSize:18},children:S.estado==="pagado"?"":""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Le,fontSize:12,fontWeight:600,color:xe.ink},children:S.concepto}),e.jsx("div",{style:{...Le,fontSize:10,color:xe.inkLight},children:ri(S.fecha)})]}),e.jsx("div",{style:{...Le,fontSize:13,fontWeight:700,color:S.estado==="pagado"?xe.accent:xe.ink},children:S.valor}),e.jsx(er,{color:S.estado==="pagado"?xe.accent:xe.warning,bg:S.estado==="pagado"?xe.accentBg:xe.warningBg,children:S.estado==="pagado"?"Pagado":"Pendiente"})]},S.id))]})},cronograma:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Cronograma del proyecto"}),t.cronograma.map((l,x)=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"12px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:8,marginBottom:6},children:[e.jsx("div",{style:{width:40,textAlign:"center"},children:e.jsx("div",{style:{...Le,fontSize:18,fontWeight:800,color:l.completado===100?xe.accent:l.completado>0?xe.warning:xe.inkLight},children:l.completado===100?"":`${l.completado}%`})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Le,fontSize:12,fontWeight:600,color:xe.ink},children:l.fase}),e.jsxs("div",{style:{...Le,fontSize:10,color:xe.inkLight},children:[ri(l.inicio),"  ",ri(l.fin)]}),e.jsx("div",{style:{height:4,background:xe.bg,borderRadius:2,marginTop:4,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${l.completado}%`,borderRadius:2,background:l.completado===100?xe.accent:a}})})]})]},x))]}),comunicaciones:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Comunicaciones"}),t.comunicaciones.map(l=>e.jsxs("div",{style:{display:"flex",gap:12,padding:"14px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:a+"22",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:a,flexShrink:0},children:l.de[0]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{...Le,fontSize:12,fontWeight:600,color:xe.ink},children:l.de}),e.jsx("span",{style:{...Le,fontSize:10,color:xe.inkLight},children:ri(l.fecha)})]}),e.jsx("div",{style:{...Le,fontSize:12,color:xe.inkMid,lineHeight:1.6},children:l.mensaje})]})]},l.id))]}),garantias:()=>e.jsxs("div",{children:[e.jsx("div",{style:{...Le,fontSize:14,fontWeight:700,color:xe.ink,marginBottom:16},children:" Garantas y plizas"}),(t.garantias||[]).length===0?e.jsx("p",{style:{...Le,fontSize:12,color:xe.inkLight},children:"Las garantas se activarn al finalizar el proyecto."}):t.garantias.map((l,x)=>e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",padding:"14px 16px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:10,marginBottom:8},children:[e.jsx("div",{style:{fontSize:24},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{...Le,fontSize:13,fontWeight:600,color:xe.ink},children:l.tipo}),e.jsxs("div",{style:{...Le,fontSize:10,color:xe.inkLight},children:[l.aseguradora,"  Pliza: ",l.poliza]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{...Le,fontSize:11,color:xe.inkMid},children:"Vigente hasta"}),e.jsx("div",{style:{...Le,fontSize:12,fontWeight:600,color:Um(l.vigencia)<60?xe.warning:xe.accent},children:ri(l.vigencia)})]})]},x))]})};return e.jsxs("div",{style:{minHeight:"100vh",background:xe.bg,fontFamily:`'${s}',sans-serif`},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${s.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:r,padding:"0 24px",height:56,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[i.logo?e.jsx("img",{src:i.logo,alt:"",style:{height:26,objectFit:"contain"}}):e.jsx("span",{style:{fontSize:15,fontWeight:700,color:"#fff",letterSpacing:1.5},children:i.nombre.toUpperCase()}),e.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,.4)",letterSpacing:1},children:"PORTAL CLIENTE"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"rgba(255,255,255,.12)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:700,color:"rgba(255,255,255,.6)"},children:t.clienteNombre[0]}),e.jsx("span",{style:{fontSize:11,color:"rgba(255,255,255,.6)"},children:t.clienteNombre})]})]}),i.colorAcento&&e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${a},${a}88)`}}),e.jsxs("div",{style:{padding:"24px 24px 0",maxWidth:960,margin:"0 auto"},children:[e.jsx("div",{style:{...Le,fontSize:10,color:xe.inkLight,textTransform:"uppercase",letterSpacing:1.5,marginBottom:4},children:"Proyecto"}),e.jsx("h1",{style:{...Le,fontSize:22,fontWeight:700,color:xe.ink,margin:"0 0 20px"},children:t.proyecto})]}),e.jsxs("div",{style:{display:"flex",maxWidth:960,margin:"0 auto",padding:"0 24px 40px",gap:20},children:[e.jsx("div",{style:{width:200,flexShrink:0},children:h.map(l=>e.jsxs("button",{onClick:()=>n(l.id),style:{...Le,display:"flex",gap:8,alignItems:"center",width:"100%",padding:"10px 14px",fontSize:12,fontWeight:o===l.id?700:500,textAlign:"left",color:o===l.id?a:xe.inkMid,background:o===l.id?a+"12":"transparent",border:"none",borderRadius:8,cursor:"pointer",marginBottom:2,transition:"all .15s"},children:[e.jsx("span",{children:l.icon})," ",l.label,l.id==="firmas"&&t.firmasPendientes.length>0&&e.jsx("span",{style:{marginLeft:"auto",background:xe.warning,color:"#fff",padding:"1px 6px",borderRadius:8,fontSize:9},children:t.firmasPendientes.length})]},l.id))}),e.jsx("div",{style:{flex:1,minWidth:0},children:d[o]?d[o]():e.jsx("p",{children:"Seccin no disponible"})})]}),e.jsx("div",{style:{textAlign:"center",padding:"20px 24px 30px",borderTop:`1px solid ${xe.border}`},children:e.jsxs("p",{style:{...Le,fontSize:10,color:xe.inkLight},children:[i.nombre,"  ",i.telefono,"  ",i.email]})})]})}function qm(){const t=F.useMemo(()=>Cc(),[]),[i,o]=F.useState(()=>Sc("portales")||wc),[n,s]=F.useState(null);F.useState(null);const[r,a]=F.useState(null),[u,h]=F.useState("");F.useEffect(()=>Nm("portales",i),[i]);const b=F.useMemo(()=>{if(!u)return i;const v=u.toLowerCase();return i.filter(m=>m.clienteNombre.toLowerCase().includes(v)||m.proyecto.toLowerCase().includes(v))},[i,u]),j=()=>{const v=n?i.find(c=>c.id===n):null;if(!v)return null;const m=tr.find(c=>c.id===v.estado),f=c=>{o(d=>d.map(l=>{if(l.id!==v.id)return l;const x=l.seccionesActivas.includes(c)?l.seccionesActivas.filter(y=>y!==c):[...l.seccionesActivas,c];return{...l,seccionesActivas:x}}))},p=(c,d)=>{o(l=>l.map(x=>x.id===v.id?{...x,[c]:d}:x))};return e.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",padding:20},onClick:()=>s(null),children:e.jsxs("div",{onClick:c=>c.stopPropagation(),style:{background:"#fff",borderRadius:14,maxWidth:700,width:"100%",maxHeight:"88vh",overflow:"auto",padding:28},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx(er,{color:m==null?void 0:m.color,bg:m==null?void 0:m.bg,children:m==null?void 0:m.label}),e.jsx("h2",{style:{...Le,fontSize:18,fontWeight:700,color:xe.ink,margin:"8px 0 2px"},children:v.proyecto}),e.jsxs("div",{style:{...Le,fontSize:12,color:xe.inkLight},children:["Cliente: ",v.clienteNombre,"  ",v.clienteEmail]})]}),e.jsx("button",{onClick:()=>s(null),style:{...Le,fontSize:18,color:xe.inkLight,background:"none",border:"none",cursor:"pointer"},children:""})]}),e.jsxs("div",{style:{background:xe.infoBg,border:`1px solid ${xe.info}22`,borderRadius:8,padding:14,marginBottom:16},children:[e.jsx("div",{style:{...Le,fontSize:10,fontWeight:600,color:xe.info,marginBottom:4},children:" Enlace del cliente"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("code",{style:{...Le,flex:1,fontSize:11,background:"#fff",padding:"6px 10px",borderRadius:4,border:`1px solid ${xe.border}`,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:`${window.location.origin}/portal?token=${v.accessToken}`}),e.jsx("button",{onClick:()=>{var c;(c=navigator.clipboard)==null||c.writeText(`${window.location.origin}/portal?token=${v.accessToken}`),alert(" Enlace copiado")},style:{...Le,padding:"6px 12px",fontSize:10,fontWeight:600,color:xe.info,background:"#fff",border:`1px solid ${xe.info}33`,borderRadius:5,cursor:"pointer"},children:" Copiar"}),e.jsx("button",{style:{...Le,padding:"6px 12px",fontSize:10,fontWeight:600,color:"#fff",background:"#25D366",border:"none",borderRadius:5,cursor:"pointer"},children:" WhatsApp"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:xe.inkLight},children:"Estado del proyecto"}),e.jsx("select",{value:v.estado,onChange:c=>p("estado",c.target.value),style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${xe.border}`,borderRadius:5},children:tr.map(c=>e.jsx("option",{value:c.id,children:c.label},c.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...Le,fontSize:10,fontWeight:600,color:xe.inkLight},children:"Progreso (%)"}),e.jsx("input",{type:"number",min:0,max:100,value:v.progreso,onChange:c=>p("progreso",parseInt(c.target.value)||0),style:{...Le,width:"100%",padding:"7px 10px",fontSize:12,border:`1px solid ${xe.border}`,borderRadius:5,boxSizing:"border-box"}})]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...Le,fontSize:12,fontWeight:700,color:xe.ink,marginBottom:8},children:" Secciones visibles para el cliente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:kc.map(c=>e.jsxs("label",{style:{...Le,display:"flex",gap:8,alignItems:"center",padding:"8px 12px",background:v.seccionesActivas.includes(c.id)?xe.accentBg:xe.surface,border:`1px solid ${v.seccionesActivas.includes(c.id)?xe.accent+"33":xe.border}`,borderRadius:6,cursor:"pointer",fontSize:12},children:[e.jsx("input",{type:"checkbox",checked:v.seccionesActivas.includes(c.id),onChange:()=>f(c.id),style:{accentColor:xe.accent}}),e.jsx("span",{children:c.icon}),e.jsx("span",{style:{fontWeight:v.seccionesActivas.includes(c.id)?600:400},children:c.label})]},c.id))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:16},children:[e.jsxs("div",{style:{padding:10,background:xe.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...Le,fontSize:16,fontWeight:700,color:xe.ink},children:v.documentos.length}),e.jsx("div",{style:{...Le,fontSize:9,color:xe.inkLight},children:"Documentos"})]}),e.jsxs("div",{style:{padding:10,background:xe.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...Le,fontSize:16,fontWeight:700,color:xe.warning},children:v.firmasPendientes.length}),e.jsx("div",{style:{...Le,fontSize:9,color:xe.inkLight},children:"Firmas pend."})]}),e.jsxs("div",{style:{padding:10,background:xe.surface,borderRadius:6,textAlign:"center"},children:[e.jsxs("div",{style:{...Le,fontSize:16,fontWeight:700,color:xe.accent},children:[v.pagos.filter(c=>c.estado==="pagado").length,"/",v.pagos.length]}),e.jsx("div",{style:{...Le,fontSize:9,color:xe.inkLight},children:"Pagos"})]}),e.jsxs("div",{style:{padding:10,background:xe.surface,borderRadius:6,textAlign:"center"},children:[e.jsx("div",{style:{...Le,fontSize:16,fontWeight:700,color:xe.ink},children:v.comunicaciones.length}),e.jsx("div",{style:{...Le,fontSize:9,color:xe.inkLight},children:"Mensajes"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>{a(v),s(null)},style:{...Le,padding:"8px 18px",fontSize:11,fontWeight:600,color:xe.info,background:xe.infoBg,border:`1px solid ${xe.info}33`,borderRadius:6,cursor:"pointer"},children:" Vista previa cliente"}),e.jsx("button",{style:{...Le,padding:"8px 18px",fontSize:11,fontWeight:600,color:xe.accent,background:xe.accentBg,border:`1px solid ${xe.accent}33`,borderRadius:6,cursor:"pointer"},children:" Aadir documento"}),e.jsx("button",{style:{...Le,padding:"8px 18px",fontSize:11,fontWeight:600,color:xe.warning,background:xe.warningBg,border:`1px solid ${xe.warning}33`,borderRadius:6,cursor:"pointer"},children:" Enviar mensaje"})]})]})})},C=()=>r?e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1001,background:"rgba(0,0,0,.6)"},onClick:()=>a(null),children:[e.jsx("div",{style:{position:"absolute",top:10,right:20,zIndex:2},children:e.jsx("button",{onClick:()=>a(null),style:{...Le,padding:"8px 18px",fontSize:12,fontWeight:700,color:"#fff",background:"rgba(0,0,0,.6)",border:"none",borderRadius:8,cursor:"pointer"},children:" Cerrar vista previa"})}),e.jsx("div",{onClick:v=>v.stopPropagation(),style:{height:"100%",overflow:"auto"},children:e.jsx(zc,{portal:r,brand:t})})]}):null;return e.jsxs("div",{style:{...Le,padding:24},children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("h1",{style:{...Le,fontSize:22,fontWeight:700,color:xe.ink,margin:"0 0 4px"},children:" Portal de Clientes"}),e.jsx("p",{style:{...Le,fontSize:12,color:xe.inkLight,margin:0},children:"Gestiona los entornos de acceso de tus clientes: documentos, firmas, avances y pagos"})]}),e.jsx("div",{style:{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"},children:[{label:"Portales activos",val:i.length,icon:""},{label:"En diseo",val:i.filter(v=>v.estado==="diseno").length,icon:""},{label:"En obra",val:i.filter(v=>["obra","acabados"].includes(v.estado)).length,icon:""},{label:"Firmas pendientes",val:i.reduce((v,m)=>v+m.firmasPendientes.length,0),icon:"",warn:!0},{label:"Completados",val:i.filter(v=>v.estado==="postventa").length,icon:""}].map((v,m)=>e.jsxs("div",{style:{flex:1,minWidth:120,padding:"10px 14px",background:"#fff",border:`1px solid ${xe.border}`,borderRadius:8},children:[e.jsxs("div",{style:{...Le,fontSize:9,color:xe.inkLight},children:[v.icon," ",v.label]}),e.jsx("div",{style:{...Le,fontSize:18,fontWeight:700,color:xe.ink},children:v.val})]},m))}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx("input",{value:u,onChange:v=>h(v.target.value),placeholder:"Buscar por cliente o proyecto",style:{...Le,width:"100%",padding:"8px 12px",fontSize:12,border:`1px solid ${xe.border}`,borderRadius:6,boxSizing:"border-box"}})}),e.jsx("button",{style:{...Le,padding:"8px 18px",fontSize:11,fontWeight:700,color:"#fff",background:xe.accent,border:"none",borderRadius:6,cursor:"pointer"},children:"+ Nuevo portal"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px,1fr))",gap:12},children:b.map(v=>{const m=tr.find(c=>c.id===v.estado),f=v.firmasPendientes.length,p=v.pagos.filter(c=>c.estado==="pendiente").length;return e.jsxs("div",{onClick:()=>s(v.id),style:{background:"#fff",border:`1px solid ${xe.border}`,borderRadius:12,padding:20,cursor:"pointer",boxShadow:xe.shadow,transition:"all .15s"},onMouseEnter:c=>c.currentTarget.style.boxShadow=xe.shadowMd,onMouseLeave:c=>c.currentTarget.style.boxShadow=xe.shadow,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:10},children:[e.jsx(er,{color:m==null?void 0:m.color,bg:m==null?void 0:m.bg,children:m==null?void 0:m.label}),e.jsxs("span",{style:{...Le,fontSize:18,fontWeight:800,color:xe.accent},children:[v.progreso,"%"]})]}),e.jsx("div",{style:{...Le,fontSize:15,fontWeight:700,color:xe.ink,marginBottom:2},children:v.proyecto}),e.jsx("div",{style:{...Le,fontSize:12,color:xe.inkLight,marginBottom:10},children:v.clienteNombre}),e.jsx("div",{style:{height:6,background:xe.bg,borderRadius:3,overflow:"hidden",marginBottom:12},children:e.jsx("div",{style:{height:"100%",width:`${v.progreso}%`,background:xe.accent,borderRadius:3}})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("span",{style:{...Le,fontSize:10,color:xe.inkLight},children:[" ",v.documentos.length," docs"]}),f>0&&e.jsxs(er,{color:xe.warning,bg:xe.warningBg,children:[" ",f," firmas"]}),p>0&&e.jsxs("span",{style:{...Le,fontSize:10,color:xe.inkLight},children:[" ",p," pagos pend."]})]}),e.jsxs("div",{style:{...Le,fontSize:10,color:xe.inkLight,marginTop:8},children:[ri(v.fechaInicio),"  ",ri(v.fechaEstimadaFin),"  ",v.seccionesActivas.length," secciones activas"]})]},v.id)})}),j(),C()]})}function Hm(){const t=window.location.hash.slice(1);if(t&&t.length>=20&&t.length<=30&&/^[A-Za-z0-9]+$/.test(t))return e.jsx(Wm,{token:t});const i=F.useMemo(()=>Cc(),[]),o=Vm(),n=Sc("portales")||wc;if(o){const s=n.find(r=>r.accessToken===o);return s?e.jsx(zc,{portal:s,brand:i}):e.jsx("div",{style:{minHeight:"100vh",background:xe.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),e.jsx("h2",{style:{...Le,fontSize:20,fontWeight:700,color:xe.ink},children:"Portal no encontrado"}),e.jsxs("p",{style:{...Le,fontSize:13,color:xe.inkLight},children:["El enlace no es vlido o ha expirado. Contacta a ",i.nombre,"."]}),e.jsxs("p",{style:{...Le,fontSize:12,color:xe.inkLight,marginTop:8},children:[i.telefono,"  ",i.email]})]})})}return e.jsx(qm,{})}const Xr="https://xlzkasdskatnikuavefh.supabase.co",ud="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhsemthc2Rza2F0bmlrdWF2ZWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE3NzQsImV4cCI6MjA4NzQ2Nzc3NH0.SR9tIpvL0YnV9CNrRq4T-xetifuNQOJZE0OnQpwtYLM",xs="hab:session",Mo={h:{apikey:ud,Authorization:`Bearer ${ud}`,"Content-Type":"application/json",Prefer:"return=representation"},async q(t,i=""){try{const o=await fetch(`${Xr}/rest/v1/${t}?${i}`,{headers:this.h});return o.ok?await o.json():null}catch{return null}},async i(t,i){try{const o=await fetch(`${Xr}/rest/v1/${t}`,{method:"POST",headers:this.h,body:JSON.stringify(i)});return o.ok?await o.json():null}catch{return null}},async u(t,i,o){try{const n=await fetch(`${Xr}/rest/v1/${t}?${i}`,{method:"PATCH",headers:this.h,body:JSON.stringify(o)});return n.ok?await n.json():null}catch{return null}},async d(t,i){try{return(await fetch(`${Xr}/rest/v1/${t}?${i}`,{method:"DELETE",headers:this.h})).ok}catch{return!1}}},ut={ink:"#111",inkMid:"#555",inkLight:"#999",bg:"#F5F5F5",surface:"#FFFFFF",border:"#E0E0E0",green:"#2D6A2E",greenBg:"#EAFAEA",blue:"#3B3B3B",blueBg:"#F0F0F0",amber:"#8C6A00",amberBg:"#FFF8E0",red:"#B91C1C",redBg:"#FAE8E8",gold:"#111",shadow:"0 1px 4px rgba(0,0,0,.06)"};async function ha(t){const i=new TextEncoder().encode(t+"_hab_2026"),o=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(o)).map(n=>n.toString(16).padStart(2,"0")).join("")}const Gm={superadmin:{label:"Super Admin",color:ut.gold},admin:{label:"Administrador",color:ut.blue},gerente:{label:"Gerente",color:ut.green},disenador:{label:"Diseador",color:"#5B3A8C"},ingeniero:{label:"Ingeniero",color:"#0D5E6E"},comercial:{label:"Comercial",color:ut.amber},contable:{label:"Contable",color:ut.red},auxiliar:{label:"Auxiliar",color:ut.inkLight}};function Km(){try{const t=sessionStorage.getItem(xs);if(!t)return null;const i=JSON.parse(t);return Date.now()-i.ts>24*60*60*1e3?(sessionStorage.removeItem(xs),null):i}catch{return null}}function fa(t){sessionStorage.setItem(xs,JSON.stringify({id:t.id,email:t.email,nombre:t.nombre,rol:t.rol,ts:Date.now()}))}function Jm(){return!!Km()}function Ym(){sessionStorage.removeItem(xs)}function Xm({onSuccess:t}){var z;const[i,o]=F.useState("login"),[n,s]=F.useState(""),[r,a]=F.useState(""),[u,h]=F.useState(""),[b,j]=F.useState(!1),[C,v]=F.useState(""),[m,f]=F.useState(!0),[p,c]=F.useState(null),[d,l]=F.useState(null);F.useEffect(()=>{x()},[]);async function x(){f(!0);const P=new URLSearchParams(window.location.search).get("invite");if(P){const U=await Mo.q("users",`invite_token=eq.${P}&estado=eq.pendiente&limit=1`);if(U&&U.length>0){c(U[0]),l(P),s(U[0].email),o("invite"),f(!1);return}}const q=await Mo.q("users","email=eq.dparra@habitaris.co&limit=1");if(q&&q.length>0&&!q[0].password_hash){o("setup"),s("dparra@habitaris.co"),f(!1);return}o("login"),f(!1)}async function y(){if(v(""),!n||!r){v("Ingresa email y contrasea");return}f(!0);const B=await Mo.q("users",`email=eq.${n.toLowerCase().trim()}&limit=1`);if(!B||B.length===0){v("Usuario no encontrado"),f(!1);return}const P=B[0];if(P.estado==="inactivo"){v("Cuenta desactivada. Contacta al administrador."),f(!1);return}if(!P.password_hash){v("Configura tu contrasea desde el enlace de invitacin."),f(!1);return}if(await ha(r)!==P.password_hash){v("Contrasea incorrecta"),f(!1);return}await Mo.u("users",`id=eq.${P.id}`,{ultimo_login:new Date().toISOString()}),fa(P),f(!1),t()}async function g(){if(v(""),!r||r.length<6){v("Mnimo 6 caracteres");return}if(r!==u){v("No coinciden");return}f(!0);const B=await ha(r),P=await Mo.q("users","email=eq.dparra@habitaris.co&limit=1");P&&P.length>0?(await Mo.u("users",`id=eq.${P[0].id}`,{password_hash:B,estado:"activo",ultimo_login:new Date().toISOString()}),fa({...P[0],estado:"activo"}),window.history.replaceState({},"",window.location.pathname),f(!1),t()):(v("Error"),f(!1))}async function S(){if(v(""),!r||r.length<6){v("Mnimo 6 caracteres");return}if(r!==u){v("No coinciden");return}f(!0);const B=await ha(r);await Mo.u("users",`id=eq.${p.id}`,{password_hash:B,estado:"activo",invite_token:null,ultimo_login:new Date().toISOString()}),fa({...p,estado:"activo"}),window.history.replaceState({},"",window.location.pathname),f(!1),t()}const[A,E]=F.useState("Habitaris");F.useEffect(()=>{Fe.get("habitaris_config").then(B=>{var P;try{const q=JSON.parse(B||"{}");(P=q.empresa)!=null&&P.nombre&&E(q.empresa.nombre)}catch{}}).catch(()=>{})},[]);const w={width:"100%",padding:"10px 12px 10px 34px",border:`1px solid ${ut.border}`,borderRadius:8,fontSize:13,fontFamily:"'DM Sans',sans-serif",background:"#FFFFFF"},I={...w,paddingLeft:12};return m&&i==="login"?e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg,#F8F7F4,#EDEBE7)",fontFamily:"'DM Sans',sans-serif"},children:[e.jsx("style",{children:"*{box-sizing:border-box}@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');"}),e.jsx("div",{style:{color:ut.inkLight,fontSize:14},children:"Cargando..."})]}):e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg,#F8F7F4,#EDEBE7)",fontFamily:"'DM Sans',sans-serif",padding:20},children:[e.jsx("style",{children:`*{box-sizing:border-box}@import url('https://fonts.googleapis.com/css2?family=DM Sans:wght@300;400;500;600;700;800&display=swap');.li:focus{outline:none;border-color:${ut.green}!important;box-shadow:0 0 0 3px ${ut.green}18}`}),e.jsxs("div",{style:{width:"100%",maxWidth:400,background:"#fff",borderRadius:16,boxShadow:"0 4px 24px rgba(0,0,0,.08)",padding:"36px 32px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[e.jsx("div",{style:{width:52,height:52,borderRadius:0,background:"transparent",display:"inline-flex",alignItems:"center",justifyContent:"center",marginBottom:14},children:e.jsxs("svg",{width:"52",height:"52",viewBox:"0 0 52 52",fill:"none",children:[e.jsx("rect",{x:"6",y:"8",width:"36",height:"36",stroke:"#111",strokeWidth:"1.8",fill:"none"}),e.jsx("line",{x1:"3",y1:"6",x2:"15",y2:"6",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"3",y1:"6",x2:"3",y2:"18",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"45",y1:"46",x2:"33",y2:"46",stroke:"#111",strokeWidth:"1.5"}),e.jsx("line",{x1:"45",y1:"46",x2:"45",y2:"34",stroke:"#111",strokeWidth:"1.5"}),e.jsx("rect",{x:"15",y:"16",width:"6.5",height:"18",fill:"#111"}),e.jsx("rect",{x:"15",y:"23",width:"18",height:"5.5",fill:"#111"}),e.jsx("rect",{x:"26.5",y:"16",width:"6.5",height:"18",fill:"#111"})]})}),e.jsxs("h1",{style:{margin:0,fontSize:20,fontWeight:700,color:ut.ink},children:[A," ",e.jsx("span",{style:{fontWeight:300,color:ut.inkLight},children:"Suite"})]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:11,color:ut.inkLight},children:i==="setup"?"Configura tu acceso de administrador":i==="invite"?`Bienvenid@, ${p==null?void 0:p.nombre}. Configura tu contrasea`:"Acceso exclusivo para usuarios autorizados"})]}),C&&e.jsxs("div",{style:{background:ut.redBg,border:`1px solid ${ut.red}33`,borderRadius:8,padding:"8px 12px",marginBottom:14,fontSize:11,color:ut.red,display:"flex",alignItems:"center",gap:6},children:[e.jsx(Ot,{size:13}),C]}),i==="login"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:ut.inkMid,textTransform:"uppercase",letterSpacing:.5,display:"block",marginBottom:4},children:"Email"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(fr,{size:14,color:ut.inkLight,style:{position:"absolute",left:10,top:11}}),e.jsx("input",{className:"li",value:n,onChange:B=>s(B.target.value),placeholder:"tu@email.com",type:"email",onKeyDown:B=>B.key==="Enter"&&y(),style:w})]})]}),e.jsxs("div",{style:{marginBottom:18},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:ut.inkMid,textTransform:"uppercase",letterSpacing:.5,display:"block",marginBottom:4},children:"Contrasea"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(jd,{size:14,color:ut.inkLight,style:{position:"absolute",left:10,top:11}}),e.jsx("input",{className:"li",value:r,onChange:B=>a(B.target.value),placeholder:"",type:b?"text":"password",onKeyDown:B=>B.key==="Enter"&&y(),style:w}),e.jsx("button",{onClick:()=>j(!b),style:{position:"absolute",right:8,top:8,border:"none",background:"none",cursor:"pointer"},children:b?e.jsx(Zc,{size:15,color:ut.inkLight}):e.jsx(fn,{size:15,color:ut.inkLight})})]})]}),e.jsx("button",{onClick:y,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:ut.ink,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Verificando...":"Iniciar sesin"}),e.jsx("p",{style:{textAlign:"center",marginTop:18,fontSize:10,color:ut.inkLight},children:"No tienes cuenta? Solicita acceso al administrador"})]}),i==="setup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{background:ut.amberBg,border:`1px solid ${ut.amber}33`,borderRadius:8,padding:"10px 12px",marginBottom:14,fontSize:10,color:ut.amber},children:[e.jsx("strong",{children:" Primera vez:"})," Contrasea para Super Admin (dparra@habitaris.co)"]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:ut.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Email"}),e.jsx("input",{value:"dparra@habitaris.co",disabled:!0,style:{...I,background:"#f0f0f0",color:ut.inkMid}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:ut.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Nueva contrasea"}),e.jsx("input",{className:"li",value:r,onChange:B=>a(B.target.value),placeholder:"Mnimo 6 caracteres",type:b?"text":"password",style:I})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:ut.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Confirmar"}),e.jsx("input",{className:"li",value:u,onChange:B=>h(B.target.value),placeholder:"Repite la contrasea",type:b?"text":"password",onKeyDown:B=>B.key==="Enter"&&g(),style:I})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:14,fontSize:10,color:ut.inkMid,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:b,onChange:()=>j(!b)})," Mostrar"]}),e.jsx("button",{onClick:g,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:ut.green,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Configurando...":" Crear mi cuenta"})]}),i==="invite"&&p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{background:ut.blueBg,border:`1px solid ${ut.blue}33`,borderRadius:8,padding:"10px 12px",marginBottom:14,fontSize:10,color:ut.blue},children:[e.jsx("strong",{children:""})," Invitad@ como ",e.jsx("strong",{children:(z=Gm[p.rol])==null?void 0:z.label}),". Configura tu contrasea."]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:ut.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Email"}),e.jsx("input",{value:p.email,disabled:!0,style:{...I,background:"#f0f0f0",color:ut.inkMid}})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:ut.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Nueva contrasea"}),e.jsx("input",{className:"li",value:r,onChange:B=>a(B.target.value),placeholder:"Mnimo 6 caracteres",type:b?"text":"password",style:I})]}),e.jsxs("div",{style:{marginBottom:14},children:[e.jsx("label",{style:{fontSize:9,fontWeight:700,color:ut.inkMid,textTransform:"uppercase",display:"block",marginBottom:4},children:"Confirmar"}),e.jsx("input",{className:"li",value:u,onChange:B=>h(B.target.value),placeholder:"Repite",type:b?"text":"password",onKeyDown:B=>B.key==="Enter"&&S(),style:I})]}),e.jsx("button",{onClick:S,disabled:m,style:{width:"100%",padding:"11px",borderRadius:8,border:"none",background:ut.blue,color:"#fff",fontSize:13,fontWeight:600,fontFamily:"'DM Sans',sans-serif",cursor:"pointer",opacity:m?.6:1},children:m?"Configurando...":" Activar mi cuenta"})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:20,fontSize:9,color:ut.inkLight},children:[A," Suite  Acceso protegido"]})]})]})}const Oa=[{id:"dashboard",label:"Dashboard",icon:"",desc:"KPIs financieros, alertas, flujo caja, vista consolidada empresa",color:"#111111",component:Cm,ready:!0},{id:"formularios",label:"Formularios",icon:"",desc:"Constructor, plantillas, lgica condicional, compartir WhatsApp/email",color:"#111111",component:Lm,ready:!0},{id:"crm",label:"CRM / Ofertas",icon:"",desc:"Ofertas, clientes, proveedores, APU, borrador y presupuesto",color:"#111111",component:Zh,ready:!0},{id:"rrhh",label:"RRHH",icon:"",desc:"Equipo, cargos, partes de trabajo, asistencia y nmina",color:"#111111",component:Cf,ready:!0},{id:"herramientas",label:"Herramientas Tcnicas",icon:"",desc:"Cuadro de cargas, concreto, cubicacin, materiales, unidades",color:"#111111",component:Rf,ready:!0},{id:"logistica",label:"Logstica",icon:"",desc:"Almacn, EPPs, dotaciones, herramientas, equipos, compras y proveedores",color:"#111111",component:Df,ready:!0},{id:"compras",label:"Compras",icon:"",desc:"rdenes de compra, recepcin mercanca, evaluacin proveedores",color:"#111111",component:ym,ready:!0},{id:"aprobaciones",label:"Aprobaciones",icon:"",desc:"Flujos de aprobacin, cadenas, umbrales y permisos por mdulo",color:"#111111",component:Lf,ready:!0},{id:"proyectos",label:"Proyectos",icon:"",desc:"Gantt, avances, seguimiento de obra y control de calidad",color:"#111111",component:Hf,ready:!0},{id:"biblioteca",label:"Biblioteca",icon:"",desc:"APUs normalizados, materiales, precios unitarios y textos tipo",color:"#111111",component:Yf,ready:!0},{id:"contabilidad",label:"Contabilidad",icon:"",desc:"Facturacin, costos reales, ingresos, egresos e informes",color:"#555555",component:ex,ready:!0},{id:"sst",label:"SST",icon:"",desc:"Seguridad y salud en el trabajo, inspecciones y riesgos",color:"#111111",component:nx,ready:!0},{id:"formacion",label:"Formacin",icon:"",desc:"Cursos obligatorios y operativos, evaluaciones, certificados, control de vencimientos",color:"#111111",component:gx,ready:!0},{id:"carnets",label:"Identidad Corporativa",icon:"",desc:"Carnets, tarjetas de visita fsicas y virtuales, QR de contacto, branding del equipo",color:"#111111",component:Ax,ready:!0},{id:"firmas",label:"Firma Digital",icon:"",desc:"Firma de documentos con pad digital, trazabilidad, firmas guardadas y certificados",color:"#111111",component:Bx,ready:!0},{id:"legal",label:"Legal",icon:"",desc:"Plantillas contractuales, plizas/seguros, procesos legales, comunicaciones",color:"#111111",component:_x,ready:!0},{id:"calidad",label:"Calidad y Auditora",icon:"",desc:"No conformidades, auditoras, protocolos, checklists e indicadores",color:"#111111",component:Wx,ready:!0},{id:"postventa",label:"Postventa",icon:"",desc:"Garantas, incidencias y atencin al cliente post-entrega",color:"#111111",component:Zx,ready:!0},{id:"admin",label:"Administracin",icon:"",desc:"Caja chica, tarjeta corporativa, viticos, flujo empresa, CxC/CxP",color:"#111111",component:sm,ready:!0},{id:"flotas",label:"Control de Flotas",icon:"",desc:"Vehculos, kilmetros, combustible, documentacin, mantenimiento",color:"#111111",component:hm,ready:!0},{id:"config",label:"Configuracin",icon:"",desc:"Empresa, correo, WhatsApp, legal, apariencia  ajustes globales",color:"#555555",component:Em,ready:!0}],vo={fontFamily:"'DM Sans',sans-serif"};function Qm(){return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",flexDirection:"column",gap:16},children:[e.jsx("div",{style:{width:40,height:40,border:"3px solid #E4E1DB",borderTopColor:"#111111",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),e.jsx("style",{children:"@keyframes spin{to{transform:rotate(360deg)}}"}),e.jsx("p",{style:{...vo,fontSize:13,color:"#888"},children:"Cargando mdulo"})]})}function Ec({lang:t,setLang:i}){return e.jsx("div",{style:{display:"flex",gap:4},children:[["es"," Espaol"],["en"," English"]].map(([o,n])=>e.jsx("button",{onClick:()=>i(o),style:{...vo,padding:"4px 10px",borderRadius:4,border:"none",cursor:"pointer",fontSize:10,fontWeight:600,background:t===o?"#111111":"rgba(255,255,255,0.12)",color:t===o?"#fff":"rgba(255,255,255,0.55)",transition:"all .15s"},children:n},o))})}function Zm({onSelect:t,lang:i,setLang:o,onLogout:n}){var j;const s=Oa.filter(C=>C.ready),r=Oa.filter(C=>!C.ready),a=F.useMemo(()=>ji(),[]),u=a.apariencia||{},h=u.colorPrimario||"#111",b=u.tipografia||"DM Sans";return e.jsxs("div",{style:{minHeight:"100vh",background:"#F0EEE9"},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${b.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsxs("div",{style:{background:h,padding:"0 28px",height:52,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[u.logo?e.jsx("img",{src:u.logo,alt:"Logo",style:{height:28,objectFit:"contain"}}):e.jsx("span",{dangerouslySetInnerHTML:{__html:'<svg width="120" height="28" viewBox="0 0 120 28" fill="none"><rect x="3" y="4" width="20" height="20" stroke="white" strokeWidth="1.2" fill="none"/><line x1="1" y1="2.5" x2="8" y2="2.5" stroke="white" strokeWidth="1"/><line x1="1.5" y1="2.5" x2="1.5" y2="9.5" stroke="white" strokeWidth="1"/><line x1="25" y1="25.5" x2="18" y2="25.5" stroke="white" strokeWidth="1"/><line x1="24.5" y1="25.5" x2="24.5" y2="18.5" stroke="white" strokeWidth="1"/><rect x="8" y="8" width="3.5" height="11" fill="white"/><rect x="8" y="12" width="10" height="3" fill="white"/><rect x="14.5" y="8" width="3.5" height="11" fill="white"/><text x="30" y="19.5" fill="white" font-family="DM Sans, sans-serif" font-size="15" font-weight="400" letter-spacing="3">abitaris</text></svg>'}}),u.slogan&&e.jsx("span",{style:{fontFamily:`'${b}',sans-serif`,fontSize:8,letterSpacing:1.5,color:"rgba(255,255,255,.35)",textTransform:"uppercase"},children:u.slogan})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(Ec,{lang:i,setLang:o}),n&&e.jsx("button",{onClick:n,style:{...vo,padding:"4px 12px",borderRadius:4,border:"1px solid rgba(255,255,255,0.15)",cursor:"pointer",fontSize:10,fontWeight:600,background:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.55)",transition:"all .15s"},onMouseEnter:C=>C.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:C=>C.currentTarget.style.background="rgba(255,255,255,0.08)",children:" Salir"})]})]}),u.colorAcento&&e.jsx("div",{style:{height:3,background:`linear-gradient(90deg,${u.colorAcento},${u.colorAcento}88,${u.colorAcento})`}}),e.jsxs("div",{style:{maxWidth:920,margin:"0 auto",padding:"48px 28px 40px"},children:[e.jsx("p",{style:{fontFamily:`'${b}',sans-serif`,fontSize:10,color:"#888",letterSpacing:1.5,textTransform:"uppercase",marginBottom:6},children:"Suite de gestin"}),e.jsx("h1",{style:{fontFamily:`'${b}',sans-serif`,fontSize:30,fontWeight:700,color:"#111",marginBottom:4,letterSpacing:-.5},children:"Selecciona un mdulo"}),e.jsxs("p",{style:{fontFamily:`'${b}',sans-serif`,fontSize:13,color:"#888",marginBottom:40},children:[((j=a.empresa)==null?void 0:j.nombre)||"Habitaris","  ",i==="es"?"Espaol":"English"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(240px,1fr))",gap:14,marginBottom:36},children:s.map(C=>e.jsxs("button",{onClick:()=>t(C.id),style:{background:"#fff",border:"1px solid #E4E1DB",borderRadius:10,padding:22,textAlign:"left",cursor:"pointer",transition:"all .15s",boxShadow:"0 1px 4px rgba(0,0,0,.06)",fontFamily:"'DM Sans',sans-serif"},onMouseEnter:v=>{v.currentTarget.style.boxShadow="0 4px 16px rgba(0,0,0,.10)",v.currentTarget.style.borderColor=C.color},onMouseLeave:v=>{v.currentTarget.style.boxShadow="0 1px 4px rgba(0,0,0,.06)",v.currentTarget.style.borderColor="#E4E1DB"},children:[e.jsx("div",{style:{fontSize:26,marginBottom:10},children:C.icon}),e.jsx("div",{style:{...vo,fontSize:14,fontWeight:700,color:"#111",marginBottom:4},children:C.label}),e.jsx("div",{style:{...vo,fontSize:11,color:"#888",lineHeight:1.5,marginBottom:12},children:C.desc}),e.jsx("div",{style:{...vo,fontSize:10,fontWeight:700,color:C.color,textTransform:"uppercase",letterSpacing:.8},children:"Abrir "})]},C.id))}),e.jsx("p",{style:{...vo,fontSize:10,color:"#AAA",letterSpacing:1.5,textTransform:"uppercase",marginBottom:10},children:"Prximamente"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(190px,1fr))",gap:10},children:r.map(C=>e.jsxs("div",{style:{background:"#FAFAF8",border:"1px solid #E4E1DB",borderRadius:8,padding:"13px 15px",opacity:.6,fontFamily:"'DM Sans',sans-serif"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7,marginBottom:4},children:[e.jsx("span",{style:{fontSize:17},children:C.icon}),e.jsx("span",{style:{fontSize:12,fontWeight:600,color:"#555"},children:C.label})]}),e.jsx("div",{style:{fontSize:10,color:"#999",lineHeight:1.5,marginBottom:7},children:C.desc}),e.jsx("div",{style:{fontSize:9,fontWeight:700,color:"#AAA",textTransform:"uppercase",letterSpacing:.8},children:"En desarrollo"})]},C.id))}),e.jsx("p",{style:{...vo,marginTop:40,fontSize:11,color:"#AAA",textAlign:"center"},children:"v1.0  Habitaris S.A.S  NIT 901.922.136-8  Bogot D.C."})]})]})}function e0({mod:t,onBack:i,lang:o,setLang:n,onLogout:s}){const a=F.useMemo(()=>ji(),[]).apariencia||{},u=a.colorPrimario||"#111",h=a.tipografia||"DM Sans";return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,height:48,background:u,zIndex:1e3,display:"flex",alignItems:"center",padding:"0 18px",gap:14,fontFamily:`'${h}',sans-serif`},children:[e.jsx("style",{children:`@import url('https://fonts.googleapis.com/css2?family=${h.replace(/ /g,"+")}:wght@300;400;500;600;700;800&display=swap');`}),e.jsx("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:5,padding:"5px 12px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:5,cursor:"pointer",color:"rgba(255,255,255,0.65)",fontSize:12,fontWeight:500,transition:"all .15s",fontFamily:`'${h}',sans-serif`},onMouseEnter:b=>b.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:b=>b.currentTarget.style.background="rgba(255,255,255,0.1)",children:" Mdulos"}),e.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.15)"}}),e.jsx("span",{style:{fontSize:13,color:"rgba(255,255,255,0.35)"},children:t.icon}),a.logo?e.jsx("img",{src:a.logo,alt:"Logo",style:{height:22,objectFit:"contain"}}):e.jsx("span",{dangerouslySetInnerHTML:{__html:'<svg width="100" height="22" viewBox="0 0 100 22" fill="none"><rect x="2" y="3" width="16" height="16" stroke="white" strokeWidth="1" fill="none"/><line x1="0.5" y1="1.5" x2="6" y2="1.5" stroke="white" strokeWidth="0.8"/><line x1="1" y1="1.5" x2="1" y2="7" stroke="white" strokeWidth="0.8"/><line x1="19.5" y1="20.5" x2="14" y2="20.5" stroke="white" strokeWidth="0.8"/><line x1="19" y1="20.5" x2="19" y2="15" stroke="white" strokeWidth="0.8"/><rect x="6" y="6.5" width="3" height="9" fill="white"/><rect x="6" y="9.5" width="8" height="2.5" fill="white"/><rect x="11" y="6.5" width="3" height="9" fill="white"/><text x="24" y="15.5" fill="white" font-family="DM Sans, sans-serif" font-size="12" font-weight="400" letter-spacing="2.5">abitaris</text></svg>'}}),e.jsxs("span",{style:{fontSize:13,color:"rgba(255,255,255,0.4)"},children:["/ ",t.label]}),e.jsx("div",{style:{flex:1}}),e.jsx(Ec,{lang:o,setLang:n}),s&&e.jsx("button",{onClick:s,style:{marginLeft:8,padding:"4px 10px",borderRadius:4,border:"1px solid rgba(255,255,255,0.15)",cursor:"pointer",fontSize:10,fontWeight:600,background:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.55)",fontFamily:`'${h}',sans-serif`,transition:"all .15s"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255,255,255,0.18)",onMouseLeave:b=>b.currentTarget.style.background="rgba(255,255,255,0.08)",children:" Salir"}),e.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:2,background:`linear-gradient(90deg, ${t.color}, ${t.color}44)`}})]})}function t0(){const[t,i]=F.useState(!1),[o,n]=F.useState(()=>sessionStorage.getItem("hab:active_module")||null),[s,r]=F.useState("es"),[a,u]=F.useState(Jm());if(hr.useEffect(()=>{Fe.init("habitaris").then(()=>i(!0)).catch(()=>i(!0))},[]),!t)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"DM Sans,sans-serif",color:"#999"},children:"Cargando..."});const h=Oa.find(f=>f.id===o),b=f=>{sessionStorage.setItem("hab:active_module",f),n(f)},j=()=>{sessionStorage.removeItem("hab:active_module"),n(null)},C=()=>{Ym(),u(!1)},v=window.location.pathname;if(v.startsWith("/portal"))return e.jsx(Hm,{});if(v.startsWith("/form"))return e.jsx(eh,{});if(!a)return e.jsx(Xm,{onSuccess:()=>u(!0)});if(!o||!(h!=null&&h.component))return e.jsx(Zm,{onSelect:b,lang:s,setLang:r,onLogout:C});const m=h.component;return e.jsxs("div",{style:{minHeight:"100vh",background:"#F0EEE9",paddingTop:48},children:[e.jsx(e0,{mod:h,onBack:j,lang:s,setLang:r,onLogout:C}),e.jsx(F.Suspense,{fallback:e.jsx(Qm,{}),children:e.jsx(m,{lang:s})})]})}ya.createRoot(document.getElementById("root")).render(e.jsx(hr.StrictMode,{children:e.jsx(t0,{})}));
